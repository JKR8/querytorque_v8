```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2002-02-01' AND CAST('2002-04-02' AS DATE)",
        "filtered_shipments": "SELECT cs1.cs_order_number, cs1.cs_ext_ship_cost, cs1.cs_net_profit, cs1.cs_ship_addr_sk, cs1.cs_call_center_sk FROM catalog_sales cs1 JOIN filtered_dates ON cs1.cs_ship_date_sk = d_date_sk",
        "main_query": "SELECT COUNT(DISTINCT cs_order_number) AS \"order count\", SUM(cs_ext_ship_cost) AS \"total shipping cost\", SUM(cs_net_profit) AS \"total net profit\" FROM filtered_shipments fs JOIN customer_address ON fs.cs_ship_addr_sk = ca_address_sk JOIN call_center ON fs.cs_call_center_sk = cc_call_center_sk WHERE ca_state = 'GA' AND cc_county = 'Williamson County' AND EXISTS (SELECT 1 FROM catalog_sales cs2 WHERE fs.cs_order_number = cs2.cs_order_number AND fs.cs_ship_addr_sk <> cs2.cs_warehouse_sk) AND NOT EXISTS (SELECT 1 FROM catalog_returns cr1 WHERE fs.cs_order_number = cr1.cr_order_number) GROUP BY () ORDER BY COUNT(DISTINCT cs_order_number) LIMIT 100"
      },
      "invariants_kept": [
        "output columns unchanged",
        "same filtering conditions",
        "same aggregation results"
      ],
      "expected_speedup": "1.5x",
      "risk": "low"
    },
    {
      "id": "rs_02",
      "transform": "early_filter",
      "nodes": {
        "filtered_addresses": "SELECT ca_address_sk FROM customer_address WHERE ca_state = 'GA'",
        "filtered_centers": "SELECT cc_call_center_sk FROM call_center WHERE cc_county = 'Williamson County'",
        "filtered_shipments": "SELECT cs1.cs_order_number, cs1.cs_ext_ship_cost, cs1.cs_net_profit, cs1.cs_ship_addr_sk, cs1.cs_call_center_sk, cs1.cs_warehouse_sk FROM catalog_sales cs1 JOIN filtered_dates ON cs1.cs_ship_date_sk = d_date_sk WHERE cs1.cs_ship_addr_sk IN (SELECT ca_address_sk FROM filtered_addresses) AND cs1.cs_call_center_sk IN (SELECT cc_call_center_sk FROM filtered_centers)",
        "multi_warehouse_orders": "SELECT cs_order_number FROM catalog_sales WHERE cs_warehouse_sk IS NOT NULL GROUP BY cs_order_number HAVING COUNT(DISTINCT cs_warehouse_sk) > 1",
        "returned_orders": "SELECT DISTINCT cr_order_number FROM catalog_returns",
        "main_query": "SELECT COUNT(DISTINCT fs.cs_order_number) AS \"order count\", SUM(fs.cs_ext_ship_cost) AS \"total shipping cost\", SUM(fs.cs_net_profit) AS \"total net profit\" FROM filtered_shipments fs WHERE fs.cs_order_number IN (SELECT cs_order_number FROM multi_warehouse_orders) AND fs.cs_order_number NOT IN (SELECT cr_order_number FROM returned_orders) GROUP BY () ORDER BY COUNT(DISTINCT fs.cs_order_number) LIMIT 100"
      },
      "invariants_kept": [
        "same filtering logic",
        "same EXISTS/NOT EXISTS semantics",
        "same result rows"
      ],
      "expected_speedup": "2.2x",
      "risk": "medium"
    }
  ],
  "explanation": "Applied two complementary rewrites: 1) Isolated date filter into CTE to reduce catalog_sales scan early (date_cte_isolate). 2) Converted EXISTS/NOT EXISTS to semi-joins and anti-joins using IN/NOT IN with pre-filtered CTEs for customer_address and call_center, and pre-aggregated warehouse counts to identify multi-warehouse orders (early_filter). This allows the optimizer to push filters earlier and avoid repeated subquery execution per row."
}
```