```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "or_to_union",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk, d_qoy FROM date_dim WHERE d_month_seq IN (1200, 1201, 1202, 1203, 1204, 1205, 1206, 1207, 1208, 1209, 1210, 1211)",
        "main_query": "WITH filtered_dates AS (SELECT * FROM filtered_dates), union_branches AS (SELECT i_manufact_id, d_qoy, SUM(ss_sales_price) AS sum_sales FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN item ON ss_item_sk = i_item_sk JOIN store ON ss_store_sk = s_store_sk WHERE i_category IN ('Books','Children','Electronics') AND i_class IN ('personal','portable','reference','self-help') AND i_brand IN ('scholaramalgamalg #14','scholaramalgamalg #7','exportiunivamalg #9','scholaramalgamalg #9') GROUP BY i_manufact_id, d_qoy UNION ALL SELECT i_manufact_id, d_qoy, SUM(ss_sales_price) AS sum_sales FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN item ON ss_item_sk = i_item_sk JOIN store ON ss_store_sk = s_store_sk WHERE i_category IN ('Women','Music','Men') AND i_class IN ('accessories','classical','fragrances','pants') AND i_brand IN ('amalgimporto #1','edu packscholar #1','exportiimporto #1','importoamalg #1') GROUP BY i_manufact_id, d_qoy) SELECT i_manufact_id, sum_sales, avg_quarterly_sales FROM (SELECT i_manufact_id, d_qoy, sum_sales, AVG(sum_sales) OVER (PARTITION BY i_manufact_id) AS avg_quarterly_sales FROM union_branches) AS tmp1 WHERE CASE WHEN avg_quarterly_sales > 0 THEN ABS(sum_sales - avg_quarterly_sales) / avg_quarterly_sales ELSE NULL END > 0.1 ORDER BY avg_quarterly_sales, sum_sales, i_manufact_id LIMIT 100"
      },
      "invariants_kept": [
        "output columns unchanged",
        "same rows after grouping",
        "window function computed correctly",
        "final filtering condition preserved"
      ],
      "expected_speedup": "3.2x",
      "risk": "low"
    }
  ],
  "explanation": "Split the complex OR condition into two UNION ALL branches. Each branch has focused predicates that allow better index utilization and filter pushdown. Date filter isolated into CTE for early reduction. The OR condition was split into: 1) Books/Children/Electronics category with specific classes/brands, and 2) Women/Music/Men category with different classes/brands. The UNION ALL preserves duplicates correctly since categories are mutually exclusive. Window function computed after union to maintain correct partitioning by i_manufact_id."
}
```