```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "materialize_cte",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_dom BETWEEN 1 AND 2 AND d_year IN (1999, 2000, 2001)",
        "filtered_stores": "SELECT s_store_sk FROM store WHERE s_county IN ('Orange County', 'Bronx County', 'Franklin Parish', 'Williamson County')",
        "filtered_hd": "SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential IN ('Unknown', '>10000') AND hd_vehicle_count > 0 AND (hd_dep_count * 1.000) / hd_vehicle_count > 1",
        "grouped_sales": "SELECT ss_ticket_number, ss_customer_sk, COUNT(*) AS cnt FROM store_sales JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk JOIN filtered_stores ON store_sales.ss_store_sk = filtered_stores.s_store_sk JOIN filtered_hd ON store_sales.ss_hdemo_sk = filtered_hd.hd_demo_sk GROUP BY ss_ticket_number, ss_customer_sk",
        "main_query": "SELECT c_last_name, c_first_name, c_salutation, c_preferred_cust_flag, ss_ticket_number, cnt FROM grouped_sales JOIN customer ON ss_customer_sk = c_customer_sk WHERE cnt BETWEEN 1 AND 5 ORDER BY cnt DESC, c_last_name ASC"
      },
      "invariants_kept": [
        "same result rows",
        "same ordering",
        "same column output",
        "same grouping and aggregation"
      ],
      "expected_speedup": "2.5x",
      "risk": "low"
    }
  ],
  "explanation": "Created CTEs for filtered dimension tables (date_dim, store, household_demographics) to push filters early and reduce the rows from store_sales that need to be joined. This eliminates the correlated subquery pattern and allows each dimension table to be scanned once with tight filters before joining with the large fact table."
}
```