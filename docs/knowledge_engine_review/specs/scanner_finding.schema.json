{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://querytorque.io/schemas/scanner_finding.json",
  "title": "Scanner Finding",
  "description": "LLM-extracted finding from plan-space scanner observations",
  "type": "object",
  "required": ["schema_version", "id", "claim", "category", "supporting_queries", "evidence", "confidence", "implication"],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "2.0"
    },
    "id": {
      "type": "string",
      "pattern": "^SF-[0-9]+$",
      "description": "Finding identifier (e.g., SF-001)"
    },
    "category": {
      "type": "string",
      "enum": [
        "join_sensitivity",
        "memory",
        "parallelism",
        "jit",
        "cost_model",
        "join_order",
        "scan_method",
        "interaction",
        "config_sensitivity"
      ],
      "description": "Category of this finding"
    },
    "claim": {
      "type": "string",
      "minLength": 10,
      "maxLength": 500,
      "description": "Human-readable claim about engine behavior"
    },
    "evidence": {
      "type": "object",
      "description": "Supporting evidence",
      "required": ["summary", "count"],
      "properties": {
        "summary": {
          "type": "string",
          "description": "Summary of supporting evidence"
        },
        "count": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of supporting observations"
        },
        "contradicting": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of contradicting observations"
        },
        "supporting_queries": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Queries that support this finding"
        }
      }
    },
    "mechanism": {
      "type": "string",
      "description": "Technical explanation of why this happens"
    },
    "boundaries": {
      "type": "object",
      "description": "When this finding applies",
      "properties": {
        "applies_when": {
          "type": "string",
          "description": "Conditions where this finding applies"
        },
        "does_not_apply_when": {
          "type": "string",
          "description": "Conditions where this finding does not apply"
        },
        "boundary_conditions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of boundary conditions"
        }
      }
    },
    "confidence": {
      "type": "string",
      "enum": ["high", "medium", "low"],
      "description": "Confidence level in this finding"
    },
    "confidence_rationale": {
      "type": "string",
      "description": "Explanation for confidence level"
    },
    "implication": {
      "type": "string",
      "minLength": 10,
      "description": "What workers should do based on this finding"
    },
    "engine_specific": {
      "type": "object",
      "description": "Engine-specific details",
      "properties": {
        "engine": {
          "type": "string",
          "enum": ["duckdb", "postgresql"]
        },
        "version_tested": {
          "type": "string"
        },
        "set_local_relevant": {
          "type": "boolean",
          "description": "Whether this finding relates to SET LOCAL configs"
        },
        "relevant_configs": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "SET LOCAL configs related to this finding"
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Extraction metadata",
      "properties": {
        "extracted_at": {
          "type": "string",
          "format": "date-time"
        },
        "blackboard_hash": {
          "type": "string",
          "description": "Hash of source blackboard data"
        },
        "extraction_model": {
          "type": "string",
          "description": "Model used for extraction"
        },
        "reviewed": {
          "type": "boolean",
          "description": "Whether this finding has been human-reviewed"
        },
        "reviewed_at": {
          "type": ["string", "null"],
          "format": "date-time"
        },
        "reviewed_by": {
          "type": ["string", "null"]
        }
      }
    }
  }
}
