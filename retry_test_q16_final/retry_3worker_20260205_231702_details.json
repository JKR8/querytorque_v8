{
  "timestamp": "20260205_231702",
  "config": {
    "database": "/mnt/d/TPC-DS/tpcds_sf5.duckdb",
    "queries": [
      "q16"
    ],
    "worker_examples": {
      "1": [
        "decorrelate",
        "pushdown",
        "early_filter"
      ],
      "2": [
        "date_cte_isolate",
        "materialize_cte",
        "union_cte_split"
      ],
      "3": [
        "or_to_union",
        "intersect_to_exists"
      ]
    }
  },
  "summary": {
    "total_queries": 1,
    "improved": 1,
    "fixed": 0,
    "total_time_minutes": 2.8938162525494895
  },
  "results": [
    {
      "query_id": "q16",
      "best_worker": 3,
      "best_speedup": 0.9102287483028634,
      "best_status": "pass",
      "all_workers": [
        {
          "worker_id": 2,
          "query_id": "q16",
          "examples_used": [
            "date_cte_isolate",
            "materialize_cte",
            "union_cte_split"
          ],
          "status": "fail",
          "speedup": 0,
          "error_message": "Original query execution failed: Binder Error: Ambiguous reference to column name \"cs_order_number\" (use: \"cs1.cs_order_number\" or \"mwo.cs_order_number\")",
          "error_category": "other",
          "original_time_ms": 0,
          "optimized_time_ms": 0,
          "optimized_sql": null,
          "prompt_tokens": 3150,
          "response_tokens": 441,
          "llm_time_ms": 89284.82270240784
        },
        {
          "worker_id": 3,
          "query_id": "q16",
          "examples_used": [
            "or_to_union",
            "intersect_to_exists"
          ],
          "status": "pass",
          "speedup": 0.9102287483028634,
          "error_message": null,
          "error_category": null,
          "original_time_ms": 0,
          "optimized_time_ms": 0,
          "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2002-02-01' AND CAST('2002-04-02' AS DATE)), filtered_address AS (SELECT ca_address_sk FROM customer_address WHERE ca_state = 'GA'), filtered_center AS (SELECT cc_call_center_sk FROM call_center WHERE cc_county = 'Williamson County')\nSELECT COUNT(DISTINCT cs_order_number) AS \"order count\", SUM(cs_ext_ship_cost) AS \"total shipping cost\", SUM(cs_net_profit) AS \"total net profit\" FROM catalog_sales AS cs1, date_dim, customer_address, call_center WHERE d_date BETWEEN '2002-02-01' AND CAST('2002-04-02' AS DATE) AND cs1.cs_ship_date_sk = d_date_sk AND cs1.cs_ship_addr_sk = ca_address_sk AND ca_state = 'GA' AND cs1.cs_call_center_sk = cc_call_center_sk AND cc_county = 'Williamson County' AND EXISTS(SELECT * FROM catalog_sales AS cs2 WHERE cs1.cs_order_number = cs2.cs_order_number AND cs1.cs_warehouse_sk <> cs2.cs_warehouse_sk) AND NOT EXISTS(SELECT * FROM catalog_returns AS cr1 WHERE cs1.cs_order_number = cr1.cr_order_number) ORDER BY COUNT(DISTINCT cs_order_number) LIMIT 100",
          "prompt_tokens": 2194,
          "response_tokens": 991,
          "llm_time_ms": 127592.16403961182
        },
        {
          "worker_id": 1,
          "query_id": "q16",
          "examples_used": [
            "decorrelate",
            "pushdown",
            "early_filter"
          ],
          "status": "fail",
          "speedup": 0.770591667848558,
          "error_message": "SEMANTIC ERROR: Value mismatch - row counts match but VALUES differ\nSample differences: [ValueDifference(row_index=0, column='order count', original_value=1256, optimized_value=987), ValueDifference(row_index=0, column='total net profit', original_value=Decimal('-1260013.99'), optimized_value=Decimal('-1215757.11')), ValueDifference(row_index=0, column='total shipping cost', original_value=Decimal('5806855.42'), optimized_value=Decimal('5449590.11'))]\nOriginal row 0: {'order count': 1256, 'total shipping cost': Decimal('5806855.42'), 'total net profit': Decimal('-1260013.99')}\nOptimized row 0: {'order count': 987, 'total shipping cost': Decimal('5449590.11'), 'total net profit': Decimal('-1215757.11')}\nYour optimized SQL that failed:\n```sql\nWITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2002-02-01' AND CAST('2002-04-02' AS DATE)), filtered_addresses AS (SELECT ca_address_sk FROM customer_address WHERE ca_state = 'GA'), filtered_centers AS (SELECT cc_call_center_sk FROM call_center WHERE cc_county = 'Williamson County'), base_sales AS (SELECT cs_order_number, cs_warehouse_sk, cs_ext_ship_cost, cs_net_profit FROM catalog_sales WHERE cs_ship_date_sk IN (SELECT d_date_sk FROM filtered_dates) AND cs_ship_addr_sk IN (SELECT ca_address_sk FROM filtered_addresses) AND cs_call_center_sk IN (SELECT cc_call_center_sk FROM filtered_centers)), multi_warehouse_orders AS (SELECT cs_order_number FROM base_sales GROUP BY cs_order_number HAVING COUNT(DISTINCT cs_warehouse_sk) > 1), orders_with_returns AS (SELECT cr_order_number FROM catalog_returns WHERE cr_order_number IN (SELECT cs_order_number FROM base_sales)), qualified_orders AS (SELECT m.cs_order_number, b.cs_ext_ship_cost, b.cs_net_profit FROM multi_warehouse_orders AS m JOIN base_sales AS b ON m.cs_order_number = b.cs_order_number WHERE NOT m.cs_order_number IN (SELECT cr_order_number FROM orders_with_returns)) SELECT COUNT(DISTINCT cs_order_number) AS \"order count\", SUM(cs_ext_ship_cost) AS \"total shipping cost\", SUM(cs_net_profit) AS \"total net profit\" FROM qualified_orders ORDER BY 1 LIMIT 100\n```",
          "error_category": "semantic",
          "original_time_ms": 0,
          "optimized_time_ms": 0,
          "optimized_sql": null,
          "prompt_tokens": 2758,
          "response_tokens": 514,
          "llm_time_ms": 173039.68334197998
        }
      ],
      "original_speedup": 0.06,
      "improvement": 0.8502287483028634,
      "timestamp": "2026-02-05T23:19:55.909397"
    }
  ]
}