{"main_query": "WITH quantity_aggregates AS (\n  SELECT \n    CASE \n      WHEN ss_quantity BETWEEN 1 AND 20 THEN 1\n      WHEN ss_quantity BETWEEN 21 AND 40 THEN 2\n      WHEN ss_quantity BETWEEN 41 AND 60 THEN 3\n      WHEN ss_quantity BETWEEN 61 AND 80 THEN 4\n      WHEN ss_quantity BETWEEN 81 AND 100 THEN 5\n    END AS bucket,\n    COUNT(*) as cnt,\n    AVG(ss_ext_sales_price) as avg_ext_price,\n    AVG(ss_net_profit) as avg_net_profit\n  FROM store_sales\n  WHERE ss_quantity BETWEEN 1 AND 100\n  GROUP BY \n    CASE \n      WHEN ss_quantity BETWEEN 1 AND 20 THEN 1\n      WHEN ss_quantity BETWEEN 21 AND 40 THEN 2\n      WHEN ss_quantity BETWEEN 41 AND 60 THEN 3\n      WHEN ss_quantity BETWEEN 61 AND 80 THEN 4\n      WHEN ss_quantity BETWEEN 81 AND 100 THEN 5\n    END\n)\nSELECT \n  CASE WHEN (SELECT cnt FROM quantity_aggregates WHERE bucket = 1) > 2972190 \n       THEN (SELECT avg_ext_price FROM quantity_aggregates WHERE bucket = 1)\n       ELSE (SELECT avg_net_profit FROM quantity_aggregates WHERE bucket = 1) END AS bucket1,\n  CASE WHEN (SELECT cnt FROM quantity_aggregates WHERE bucket = 2) > 4505785 \n       THEN (SELECT avg_ext_price FROM quantity_aggregates WHERE bucket = 2)\n       ELSE (SELECT avg_net_profit FROM quantity_aggregates WHERE bucket = 2) END AS bucket2,\n  CASE WHEN (SELECT cnt FROM quantity_aggregates WHERE bucket = 3) > 1575726 \n       THEN (SELECT avg_ext_price FROM quantity_aggregates WHERE bucket = 3)\n       ELSE (SELECT avg_net_profit FROM quantity_aggregates WHERE bucket = 3) END AS bucket3,\n  CASE WHEN (SELECT cnt FROM quantity_aggregates WHERE bucket = 4) > 3188917 \n       THEN (SELECT avg_ext_price FROM quantity_aggregates WHERE bucket = 4)\n       ELSE (SELECT avg_net_profit FROM quantity_aggregates WHERE bucket = 4) END AS bucket4,\n  CASE WHEN (SELECT cnt FROM quantity_aggregates WHERE bucket = 5) > 3525216 \n       THEN (SELECT avg_ext_price FROM quantity_aggregates WHERE bucket = 5)\n       ELSE (SELECT avg_net_profit FROM quantity_aggregates WHERE bucket = 5) END AS bucket5\nFROM reason \nWHERE r_reason_sk = 1"}