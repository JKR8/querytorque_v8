```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "or_to_union",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_dow IN (6, 0) AND d_year IN (1999, 2000, 2001)",
        "filtered_stores": "SELECT s_store_sk FROM store WHERE s_city IN ('Fairview', 'Midway')",
        "store_sales_hd_dep": "SELECT ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city, ss_coupon_amt, ss_net_profit FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN filtered_stores ON ss_store_sk = s_store_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN customer_address ON ss_addr_sk = ca_address_sk WHERE hd_dep_count = 4",
        "store_sales_hd_vehicle": "SELECT ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city, ss_coupon_amt, ss_net_profit FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN filtered_stores ON ss_store_sk = s_store_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN customer_address ON ss_addr_sk = ca_address_sk WHERE hd_vehicle_count = 3 AND (hd_dep_count != 4 OR hd_dep_count IS NULL)",
        "dn": "SELECT ss_ticket_number, ss_customer_sk, ca_city AS bought_city, SUM(ss_coupon_amt) AS amt, SUM(ss_net_profit) AS profit FROM (SELECT * FROM store_sales_hd_dep UNION ALL SELECT * FROM store_sales_hd_vehicle) t GROUP BY ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city",
        "main_query": "SELECT c_last_name, c_first_name, ca_city, bought_city, ss_ticket_number, amt, profit FROM dn, customer, customer_address AS current_addr WHERE ss_customer_sk = c_customer_sk AND customer.c_current_addr_sk = current_addr.ca_address_sk AND current_addr.ca_city <> bought_city ORDER BY c_last_name NULLS FIRST, c_first_name NULLS FIRST, ca_city NULLS FIRST, bought_city NULLS FIRST, ss_ticket_number NULLS FIRST LIMIT 100"
      },
      "invariants_kept": [
        "output columns unchanged",
        "same grain (ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city)",
        "same result rows after aggregation",
        "same ordering and limit"
      ],
      "expected_speedup": "2.5x",
      "risk": "low"
    }
  ],
  "explanation": "The OR condition on household_demographics (hd_dep_count=4 OR hd_vehicle_count=3) forces a full table scan with both filters. By splitting into UNION ALL branches, each branch can use index access on the respective column if available. The second branch excludes rows already captured by the first branch to avoid duplicates. Date and store filters are extracted into CTEs for early filtering and reuse across both branches."
}
```