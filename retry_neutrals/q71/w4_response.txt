```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_moy = 11 AND d_year = 1999",
        "filtered_times": "SELECT t_time_sk, t_hour, t_minute FROM time_dim WHERE t_meal_time = 'breakfast' OR t_meal_time = 'dinner'",
        "main_query": "SELECT i_brand_id AS brand_id, i_brand AS brand, t_hour, t_minute, SUM(ext_price) AS ext_price FROM (SELECT ws_ext_sales_price AS ext_price, ws_sold_date_sk AS sold_date_sk, ws_item_sk AS sold_item_sk, ws_sold_time_sk AS time_sk FROM web_sales WHERE EXISTS (SELECT 1 FROM filtered_dates WHERE d_date_sk = ws_sold_date_sk) UNION ALL SELECT cs_ext_sales_price AS ext_price, cs_sold_date_sk AS sold_date_sk, cs_item_sk AS sold_item_sk, cs_sold_time_sk AS time_sk FROM catalog_sales WHERE EXISTS (SELECT 1 FROM filtered_dates WHERE d_date_sk = cs_sold_date_sk) UNION ALL SELECT ss_ext_sales_price AS ext_price, ss_sold_date_sk AS sold_date_sk, ss_item_sk AS sold_item_sk, ss_sold_time_sk AS time_sk FROM store_sales WHERE EXISTS (SELECT 1 FROM filtered_dates WHERE d_date_sk = ss_sold_date_sk)) AS tmp JOIN item ON sold_item_sk = i_item_sk AND i_manager_id = 1 JOIN filtered_times ON time_sk = t_time_sk GROUP BY i_brand, i_brand_id, t_hour, t_minute ORDER BY ext_price DESC NULLS FIRST, i_brand_id NULLS FIRST, t_hour NULLS FIRST"
      },
      "invariants_kept": [
        "same result rows",
        "same output columns",
        "same grouping semantics",
        "same ordering"
      ],
      "expected_speedup": "1.2x",
      "risk": "low"
    },
    {
      "id": "rs_02",
      "transform": "or_to_union",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_moy = 11 AND d_year = 1999",
        "filtered_times_breakfast": "SELECT t_time_sk, t_hour, t_minute FROM time_dim WHERE t_meal_time = 'breakfast'",
        "filtered_times_dinner": "SELECT t_time_sk, t_hour, t_minute FROM time_dim WHERE t_meal_time = 'dinner'",
        "main_query": "SELECT i_brand_id AS brand_id, i_brand AS brand, t_hour, t_minute, SUM(ext_price) AS ext_price FROM (SELECT ws_ext_sales_price AS ext_price, ws_sold_date_sk AS sold_date_sk, ws_item_sk AS sold_item_sk, ws_sold_time_sk AS time_sk FROM web_sales WHERE EXISTS (SELECT 1 FROM filtered_dates WHERE d_date_sk = ws_sold_date_sk) UNION ALL SELECT cs_ext_sales_price AS ext_price, cs_sold_date_sk AS sold_date_sk, cs_item_sk AS sold_item_sk, cs_sold_time_sk AS time_sk FROM catalog_sales WHERE EXISTS (SELECT 1 FROM filtered_dates WHERE d_date_sk = cs_sold_date_sk) UNION ALL SELECT ss_ext_sales_price AS ext_price, ss_sold_date_sk AS sold_date_sk, ss_item_sk AS sold_item_sk, ss_sold_time_sk AS time_sk FROM store_sales WHERE EXISTS (SELECT 1 FROM filtered_dates WHERE d_date_sk = ss_sold_date_sk)) AS tmp JOIN item ON sold_item_sk = i_item_sk AND i_manager_id = 1 JOIN filtered_times_breakfast ON time_sk = t_time_sk GROUP BY i_brand, i_brand_id, t_hour, t_minute UNION ALL SELECT i_brand_id AS brand_id, i_brand AS brand, t_hour, t_minute, SUM(ext_price) AS ext_price FROM (SELECT ws_ext_sales_price AS ext_price, ws_sold_date_sk AS sold_date_sk, ws_item_sk AS sold_item_sk, ws_sold_time_sk AS time_sk FROM web_sales WHERE EXISTS (SELECT 1 FROM filtered_dates WHERE d_date_sk = ws_sold_date_sk) UNION ALL SELECT cs_ext_sales_price AS ext_price, cs_sold_date_sk AS sold_date_sk, cs_item_sk AS sold_item_sk, cs_sold_time_sk AS time_sk FROM catalog_sales WHERE EXISTS (SELECT 1 FROM filtered_dates WHERE d_date_sk = cs_sold_date_sk) UNION ALL SELECT ss_ext_sales_price AS ext_price, ss_sold_date_sk AS sold_date_sk, ss_item_sk AS sold_item_sk, ss_sold_time_sk AS time_sk FROM store_sales WHERE EXISTS (SELECT 1 FROM filtered_dates WHERE d_date_sk = ss_sold_date_sk)) AS tmp JOIN item ON sold_item_sk = i_item_sk AND i_manager_id = 1 JOIN filtered_times_dinner ON time_sk = t_time_sk GROUP BY i_brand, i_brand_id, t_hour, t_minute ORDER BY ext_price DESC NULLS FIRST, i_brand_id NULLS FIRST, t_hour NULLS FIRST"
      },
      "invariants_kept": [
        "same result rows (union all without overlap)",
        "same output columns",
        "same grouping semantics",
        "same ordering"
      ],
      "expected_speedup": "2.5x",
      "risk": "medium"
    }
  ],
  "explanation": "Applied two complementary optimizations: 1) DATE_CTE_ISOLATE: Created filtered_dates CTE to avoid scanning date_dim three times (once per sales table). This transforms correlated joins into efficient semi-joins. 2) OR_TO_UNION: Split the OR condition on time_dim into separate branches for 'breakfast' and 'dinner', allowing each branch to use focused indexes/partitions. The UNION ALL works because meal_time categories are mutually exclusive. Combined, these transforms reduce redundant scans and enable better predicate pushdown."
}
```