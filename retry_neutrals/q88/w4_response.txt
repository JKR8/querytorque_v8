```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "or_to_union",
      "nodes": {
        "filtered_store": "SELECT s_store_sk FROM store WHERE s_store_name = 'ese'",
        "filtered_hh": "SELECT hd_demo_sk FROM household_demographics WHERE (hd_dep_count = 4 AND hd_vehicle_count <= 6) OR (hd_dep_count = 2 AND hd_vehicle_count <= 4) OR (hd_dep_count = 0 AND hd_vehicle_count <= 2)",
        "time_slots": "SELECT t_time_sk, CASE WHEN t_hour = 8 AND t_minute >= 30 THEN 1 WHEN t_hour = 9 AND t_minute < 30 THEN 2 WHEN t_hour = 9 AND t_minute >= 30 THEN 3 WHEN t_hour = 10 AND t_minute < 30 THEN 4 WHEN t_hour = 10 AND t_minute >= 30 THEN 5 WHEN t_hour = 11 AND t_minute < 30 THEN 6 WHEN t_hour = 11 AND t_minute >= 30 THEN 7 WHEN t_hour = 12 AND t_minute < 30 THEN 8 END AS time_slot FROM time_dim WHERE (t_hour = 8 AND t_minute >= 30) OR (t_hour = 9) OR (t_hour = 10) OR (t_hour = 11) OR (t_hour = 12 AND t_minute < 30)",
        "qualified_sales": "SELECT ss.sales_price, ts.time_slot FROM (SELECT ss_sold_time_sk, ss_hdemo_sk, ss_store_sk, 1 AS sales_price FROM store_sales) ss JOIN time_slots ts ON ss.ss_sold_time_sk = ts.t_time_sk JOIN filtered_hh hh ON ss.ss_hdemo_sk = hh.hd_demo_sk JOIN filtered_store s ON ss.ss_store_sk = s.s_store_sk WHERE ts.time_slot IS NOT NULL",
        "main_query": "SELECT SUM(CASE WHEN time_slot = 1 THEN sales_price END) AS h8_30_to_9, SUM(CASE WHEN time_slot = 2 THEN sales_price END) AS h9_to_9_30, SUM(CASE WHEN time_slot = 3 THEN sales_price END) AS h9_30_to_10, SUM(CASE WHEN time_slot = 4 THEN sales_price END) AS h10_to_10_30, SUM(CASE WHEN time_slot = 5 THEN sales_price END) AS h10_30_to_11, SUM(CASE WHEN time_slot = 6 THEN sales_price END) AS h11_to_11_30, SUM(CASE WHEN time_slot = 7 THEN sales_price END) AS h11_30_to_12, SUM(CASE WHEN time_slot = 8 THEN sales_price END) AS h12_to_12_30 FROM qualified_sales"
      },
      "invariants_kept": [
        "same output columns",
        "same row count (single row)",
        "same aggregation logic (counts)"
      ],
      "expected_speedup": "6x",
      "risk": "medium"
    }
  ],
  "explanation": "The original query scans store_sales 8 times with different time filters. Each scan also joins with household_demographics and store. By extracting the common filters (store name and household demographics OR conditions) into CTEs and combining the 8 time slots into a single CASE expression in the time_dim CTE, we can scan store_sales once and compute all 8 counts via conditional aggregation. The OR condition in household_demographics is pre-materialized as a filtered CTE to avoid repeated evaluation."
}
```