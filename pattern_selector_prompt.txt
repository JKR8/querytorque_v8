SYSTEM:
You are a SQL pattern matcher. Given a SQL query, rank the top 12 most relevant optimization patterns from the numbered list. Return ONLY a JSON array of 12 numbers ordered best match first. Example: [5,2,11,1,8,3,9,7,4,6,10,12]. No explanation.

USER:
### Patterns

# | Signals
---|---
1 | Consolidate repeated scans of the same fact table (one per t; aggregate, join, or_predicate, repeated_scan, subquery
2 | Decorrelate multiple correlated EXISTS subqueries into pre-m; aggregate, correlated, decorrelate, exists, group_by, join, materialize, or_predicate, order_by
3 | Extract date filtering into a separate CTE to enable predica; aggregate, distinct, group_by, having, join, order_by, pushdown, subquery
4 | Convert correlated subquery to separate CTE with GROUP BY, t; aggregate, correlated, cte, group_by, join, order_by, subquery
5 | When multiple CTEs each perform GROUP BY + WINDOW (cumulativ; aggregate, between, case, cte, group_by, join, order_by, subquery, window
6 | Pre-filter ALL dimension tables into CTEs before joining wit; aggregate, group_by, join, or_predicate, order_by
7 | Filter dimension tables FIRST, then join to fact tables to r; aggregate, case, group_by, join, order_by, subquery
8 | Convert INTERSECT subquery pattern to multiple EXISTS clause; aggregate, between, cte, group_by, having, in, intersect, join, order_by, rollup, subquery, union
9 | Extract repeated subquery patterns into a CTE to avoid recom; aggregate, between, cte, distinct, in, join, order_by, subquery
10 | When query uses multiple date_dim aliases with different fil; aggregate, between, group_by, in, join, order_by
11 | Pre-filter multiple dimension tables (date + store) into sep; aggregate, case, group_by, join, order_by
12 | Convert cascading INTERSECT operations into correlated EXIST; aggregate, between, correlated, cte, group_by, having, in, intersect, join, materialize, order_by, rollup, subquery, union
13 | Split OR conditions on different columns into UNION ALL bran; aggregate, group_by, in, join, or_predicate, order_by
14 | Pre-filter dimension table into CTE, then pre-join with fact; aggregate, case, group_by, in, join, or_predicate, order_by, subquery, window
15 | Push filters from outer query into CTEs/subqueries to reduce; aggregate, between, case, subquery
16 | Replace GROUP BY ROLLUP with explicit UNION ALL of pre-aggre; aggregate, case, cte, group_by, grouping, in, join, order_by, rank, rollup, window
17 | Extract shared dimension filters (date, item, promotion) int; aggregate, between, cte, group_by, join, order_by, rollup, subquery, union
18 | Consolidate multiple subqueries scanning the same table into; aggregate, between, case, subquery
19 | Split a generic UNION ALL CTE into specialized CTEs when the; aggregate, case, cte, group_by, in, join, order_by, union

### Example

SQL with correlated subquery, OR predicates, and star-schema date/store joins:
Answer: [4,13,3,6,7,15,11,14,2,9,18,1]

### SQL:
SELECT c_last_name, c_first_name, ca_city, bought_city, ss_ticket_number, amt, profit
FROM (
    SELECT ss_ticket_number, ss_customer_sk, ca_city AS bought_city,
           SUM(ss_coupon_amt) AS amt, SUM(ss_net_profit) AS profit
    FROM store_sales
    JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk
    JOIN store ON store_sales.ss_store_sk = store.s_store_sk
    JOIN household_demographics ON store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk
    JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk
    WHERE (household_demographics.hd_dep_count = 4 OR household_demographics.hd_vehicle_count = 3)
      AND date_dim.d_dow IN (6, 0)
      AND date_dim.d_year IN (1999, 1999+1, 1999+2)
      AND store.s_city IN ('Fairview', 'Midway')
    GROUP BY ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city
) dn
JOIN customer ON dn.ss_customer_sk = customer.c_customer_sk
JOIN customer_address ON customer.c_current_addr_sk = customer_address.ca_address_sk
WHERE customer_address.ca_city <> bought_city
ORDER BY c_last_name, c_first_name, ca_city, bought_city, ss_ticket_number
LIMIT 100

Answer: