```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "or_to_union",
      "nodes": {
        "filtered_dates_1999": "SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE d_year = 1999",
        "filtered_dates_1998_12": "SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE d_year = 1998 AND d_moy = 12",
        "filtered_dates_2000_01": "SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE d_year = 2000 AND d_moy = 1",
        "v1_base": "SELECT i.i_category, i.i_brand, cc.cc_name, fd.d_year, fd.d_moy, SUM(cs.cs_sales_price) AS sum_sales FROM catalog_sales cs JOIN filtered_dates_1999 fd ON cs.cs_sold_date_sk = fd.d_date_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk GROUP BY i.i_category, i.i_brand, cc.cc_name, fd.d_year, fd.d_moy UNION ALL SELECT i.i_category, i.i_brand, cc.cc_name, fd.d_year, fd.d_moy, SUM(cs.cs_sales_price) AS sum_sales FROM catalog_sales cs JOIN filtered_dates_1998_12 fd ON cs.cs_sold_date_sk = fd.d_date_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk GROUP BY i.i_category, i.i_brand, cc.cc_name, fd.d_year, fd.d_moy UNION ALL SELECT i.i_category, i.i_brand, cc.cc_name, fd.d_year, fd.d_moy, SUM(cs.cs_sales_price) AS sum_sales FROM catalog_sales cs JOIN filtered_dates_2000_01 fd ON cs.cs_sold_date_sk = fd.d_date_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk GROUP BY i.i_category, i.i_brand, cc.cc_name, fd.d_year, fd.d_moy",
        "v1": "SELECT i_category, i_brand, cc_name, d_year, d_moy, sum_sales, AVG(sum_sales) OVER (PARTITION BY i_category, i_brand, cc_name, d_year) AS avg_monthly_sales, RANK() OVER (PARTITION BY i_category, i_brand, cc_name ORDER BY d_year, d_moy) AS rn FROM v1_base",
        "v2": "SELECT v1.i_category, v1.i_brand, v1.cc_name, v1.d_year, v1.d_moy, v1.avg_monthly_sales, v1.sum_sales, v1_lag.sum_sales AS psum, v1_lead.sum_sales AS nsum FROM v1, v1 AS v1_lag, v1 AS v1_lead WHERE v1.i_category = v1_lag.i_category AND v1.i_category = v1_lead.i_category AND v1.i_brand = v1_lag.i_brand AND v1.i_brand = v1_lead.i_brand AND v1.cc_name = v1_lag.cc_name AND v1.cc_name = v1_lead.cc_name AND v1.rn = v1_lag.rn + 1 AND v1.rn = v1_lead.rn - 1",
        "main_query": "SELECT * FROM v2 WHERE d_year = 1999 AND avg_monthly_sales > 0 AND CASE WHEN avg_monthly_sales > 0 THEN ABS(sum_sales - avg_monthly_sales) / avg_monthly_sales ELSE NULL END > 0.1 ORDER BY sum_sales - avg_monthly_sales NULLS FIRST, 1, 2, 3, 4, 5, 6, 7, 8, 9 LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same ordering",
        "same column output",
        "same grouping and aggregation"
      ],
      "expected_speedup": "2.5x",
      "risk": "medium"
    }
  ],
  "explanation": "Split the OR condition on date_dim into three UNION ALL branches, each with a specific date filter. This allows each branch to use an efficient date_dim scan and join with catalog_sales only for the relevant date range. The window functions are computed on the combined result (v1) after unioning the aggregated branches (v1_base). This reduces the catalog_sales scan from full table to only three targeted date ranges."
}
```