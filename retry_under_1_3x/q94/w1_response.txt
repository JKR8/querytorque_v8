```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "decorrelate",
      "nodes": {
        "date_range": "SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1999-02-01' AND CAST('1999-04-02' AS DATE)",
        "filtered_ca": "SELECT ca_address_sk FROM customer_address WHERE ca_state = 'IL'",
        "filtered_web_site": "SELECT web_site_sk FROM web_site WHERE web_company_name = 'pri'",
        "multi_warehouse_orders": "SELECT ws_order_number FROM web_sales GROUP BY ws_order_number HAVING COUNT(DISTINCT ws_warehouse_sk) > 1",
        "returned_orders": "SELECT DISTINCT wr_order_number FROM web_returns",
        "filtered_ws": "SELECT ws_order_number, ws_ext_ship_cost, ws_net_profit FROM web_sales ws1 JOIN date_range dr ON ws1.ws_ship_date_sk = dr.d_date_sk JOIN filtered_ca ca ON ws1.ws_ship_addr_sk = ca.ca_address_sk JOIN filtered_web_site ws ON ws1.ws_web_site_sk = ws.web_site_sk",
        "main_query": "SELECT COUNT(DISTINCT fws.ws_order_number) AS \"order count\", SUM(fws.ws_ext_ship_cost) AS \"total shipping cost\", SUM(fws.ws_net_profit) AS \"total net profit\" FROM filtered_ws fws JOIN multi_warehouse_orders mwo ON fws.ws_order_number = mwo.ws_order_number LEFT JOIN returned_orders ro ON fws.ws_order_number = ro.wr_order_number WHERE ro.wr_order_number IS NULL ORDER BY COUNT(DISTINCT fws.ws_order_number) LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same output columns",
        "same aggregation results"
      ],
      "expected_speedup": "3.5x",
      "risk": "medium"
    }
  ],
  "explanation": "Decorrelated both EXISTS/NOT EXISTS subqueries by precomputing: (1) multi-warehouse orders from entire web_sales, (2) returned orders from web_returns. Isolated date, customer_address, and web_site filters into separate CTEs for early filtering. This reduces the correlated subqueries from O(nÂ²) behavior to hash joins and eliminates repeated full table scans."
}
```