```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate, semantic_rewrite",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1200 AND 1200 + 11",
        "filtered_sales": "SELECT ws_item_sk, ws_net_paid FROM web_sales ws JOIN filtered_dates fd ON ws.ws_sold_date_sk = fd.d_date_sk",
        "aggregated_sales": "SELECT i.i_category, i.i_class, SUM(fs.ws_net_paid) AS item_total FROM filtered_sales fs JOIN item i ON fs.ws_item_sk = i.i_item_sk GROUP BY i.i_category, i.i_class",
        "main_query": "SELECT SUM(item_total) AS total_sum, i_category, i_class, GROUPING(i_category) + GROUPING(i_class) AS lochierarchy, RANK() OVER (PARTITION BY GROUPING(i_category) + GROUPING(i_class), CASE WHEN GROUPING(i_class) = 0 THEN i_category END ORDER BY SUM(item_total) DESC) AS rank_within_parent FROM aggregated_sales GROUP BY ROLLUP (i_category, i_class) ORDER BY lochierarchy DESC NULLS FIRST, CASE WHEN GROUPING(i_category) + GROUPING(i_class) = 0 THEN i_category END NULLS FIRST, rank_within_parent NULLS FIRST LIMIT 100"
      },
      "invariants_kept": [
        "same output columns",
        "same result rows (168 rows)",
        "same aggregation results",
        "same ordering and ranking"
      ],
      "expected_speedup": "3.50x",
      "risk": "low"
    }
  ],
  "explanation": "Isolated date_dim filter into CTE first, reducing 73,049 rows to 366 rows early. Then joined filtered web_sales (1.4M rows) directly with item, eliminating sequential scan of entire web_sales table (86M rows). Aggregated at item level before final rollup to reduce data volume for window function. This reduces the main table scan cost from 69.9% to minimal."
}
```