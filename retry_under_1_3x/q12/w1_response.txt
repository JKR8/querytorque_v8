```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "filtered_date": "SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-02-22' AS DATE) AND CAST('1999-03-24' AS DATE)",
        "filtered_item": "SELECT i_item_sk, i_item_id, i_item_desc, i_category, i_class, i_current_price FROM item WHERE i_category IN ('Sports', 'Books', 'Home')",
        "aggregated_sales": "SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, SUM(ws_ext_sales_price) AS itemrevenue FROM web_sales JOIN filtered_date ON ws_sold_date_sk = d_date_sk JOIN filtered_item ON ws_item_sk = i_item_sk GROUP BY i_item_id, i_item_desc, i_category, i_class, i_current_price",
        "main_query": "SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, itemrevenue, itemrevenue * 100.0000 / SUM(itemrevenue) OVER (PARTITION BY i_class) AS revenueratio FROM aggregated_sales ORDER BY i_category, i_class, i_item_id, i_item_desc, revenueratio LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same ordering",
        "same column output",
        "same window function semantics"
      ],
      "expected_speedup": "3.50x",
      "risk": "low"
    }
  ],
  "explanation": "Isolated date_dim filter into CTE to reduce fact table join from 31 rows vs full scan. Pushed item category filter early. Preserved window function semantics by computing ratio after aggregation. This reduces web_sales scanning by early filtering with dimension tables, especially critical given the date filter reduces date_dim to 31 rows."
}
```