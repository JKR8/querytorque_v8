```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "materialize_cte",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2000-01-27' AND CAST('2000-04-26' AS DATE)",
        "item_avg_discount": "SELECT ws_item_sk, 1.3 * AVG(ws_ext_discount_amt) AS threshold FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk GROUP BY ws_item_sk",
        "main_query": "SELECT SUM(ws_ext_discount_amt) AS \"Excess Discount Amount\" FROM web_sales JOIN item ON i_item_sk = ws_item_sk JOIN filtered_dates ON ws_sold_date_sk = d_date_sk JOIN item_avg_discount ON web_sales.ws_item_sk = item_avg_discount.ws_item_sk WHERE i_manufact_id = 350 AND ws_ext_discount_amt > item_avg_discount.threshold ORDER BY SUM(ws_ext_discount_amt) LIMIT 100"
      },
      "invariants_kept": [
        "same result rows", 
        "same aggregation",
        "same ordering"
      ],
      "expected_speedup": "3x",
      "risk": "low"
    }
  ],
  "explanation": "Rewrote correlated subquery into a precomputed CTE that calculates the average discount threshold per item for the date range. The main query now joins with this CTE instead of executing the correlated subquery for each row. Also isolated date filtering into a separate CTE to avoid scanning date_dim multiple times."
}
```