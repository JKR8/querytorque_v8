```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1999-02-01' AND CAST('1999-04-02' AS DATE)",
        "filtered_address": "SELECT ca_address_sk FROM customer_address WHERE ca_state = 'IL'",
        "filtered_website": "SELECT web_site_sk FROM web_site WHERE web_company_name = 'pri'",
        "multi_warehouse_orders": "SELECT ws_order_number FROM web_sales GROUP BY ws_order_number HAVING COUNT(DISTINCT ws_warehouse_sk) > 1",
        "returned_orders": "SELECT DISTINCT wr_order_number FROM web_returns",
        "filtered_web_sales": "SELECT ws1.ws_order_number, ws1.ws_ext_ship_cost, ws1.ws_net_profit FROM web_sales ws1 JOIN filtered_dates ON ws1.ws_ship_date_sk = filtered_dates.d_date_sk JOIN filtered_address ON ws1.ws_ship_addr_sk = filtered_address.ca_address_sk JOIN filtered_website ON ws1.ws_web_site_sk = filtered_website.web_site_sk",
        "main_query": "SELECT COUNT(DISTINCT fws.ws_order_number) AS \"order count\", SUM(fws.ws_ext_ship_cost) AS \"total shipping cost\", SUM(fws.ws_net_profit) AS \"total net profit\" FROM filtered_web_sales fws JOIN multi_warehouse_orders mwo ON fws.ws_order_number = mwo.ws_order_number LEFT JOIN returned_orders ro ON fws.ws_order_number = ro.wr_order_number WHERE ro.wr_order_number IS NULL ORDER BY COUNT(DISTINCT fws.ws_order_number) LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same ordering",
        "same column output",
        "same aggregation"
      ],
      "expected_speedup": "3.5x",
      "risk": "low"
    }
  ],
  "explanation": "1. Isolated date_dim, customer_address, and web_site filters into separate CTEs to reduce early join cardinality (date filter reduces 73,049→61 rows, address filter 750,000→7,941 rows). 2. Decorrelated EXISTS subquery by pre-computing multi-warehouse orders via GROUP BY (transforms correlated subquery to join). 3. Decorrelated NOT EXISTS subquery by pre-computing returned orders and using anti-join. 4. Combined all filtered dimension joins in a single CTE to reduce repeated scans of web_sales. This reduces web_sales scan from 3x to 1x and enables early filtering before expensive EXISTS/NOT EXISTS evaluation."
}
```