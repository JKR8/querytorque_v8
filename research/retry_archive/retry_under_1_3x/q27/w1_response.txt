```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "early_filter",
      "nodes": {
        "filtered_date_dim": "SELECT d_date_sk FROM date_dim WHERE d_year = 2002",
        "filtered_store": "SELECT s_store_sk, s_state FROM store WHERE s_state = 'TN'",
        "filtered_customer_demographics": "SELECT cd_demo_sk FROM customer_demographics WHERE cd_gender = 'M' AND cd_marital_status = 'S' AND cd_education_status = 'College'",
        "results": "SELECT i.i_item_id, s.s_state, 0 AS g_state, ss.ss_quantity AS agg1, ss.ss_list_price AS agg2, ss.ss_coupon_amt AS agg3, ss.ss_sales_price AS agg4 FROM store_sales ss JOIN filtered_date_dim fd ON ss.ss_sold_date_sk = fd.d_date_sk JOIN filtered_store s ON ss.ss_store_sk = s.s_store_sk JOIN filtered_customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk"
      },
      "invariants_kept": [
        "output columns unchanged",
        "same result rows",
        "same filtering semantics"
      ],
      "expected_speedup": "3.5x",
      "risk": "low"
    },
    {
      "id": "rs_02",
      "transform": "semantic_rewrite",
      "nodes": {
        "main_query": "SELECT i_item_id, s_state, g_state, agg1, agg2, agg3, agg4 FROM (SELECT CASE WHEN GROUPING(i_item_id, s_state) = 0 THEN i_item_id WHEN GROUPING(i_item_id, s_state) = 1 THEN NULL ELSE NULL END AS i_item_id, CASE WHEN GROUPING(i_item_id, s_state) = 0 THEN s_state ELSE NULL END AS s_state, CASE WHEN GROUPING(i_item_id, s_state) = 0 THEN 0 ELSE 1 END AS g_state, AVG(agg1) AS agg1, AVG(agg2) AS agg2, AVG(agg3) AS agg3, AVG(agg4) AS agg4 FROM results GROUP BY GROUPING SETS ((i_item_id, s_state), (i_item_id), ())) AS foo ORDER BY i_item_id NULLS FIRST, s_state NULLS FIRST LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same ordering",
        "same output columns",
        "same aggregation logic"
      ],
      "expected_speedup": "1.8x",
      "risk": "low"
    }
  ],
  "explanation": "1. Push all dimension table filters (date_dim, store, customer_demographics) into separate CTEs before joining with store_sales. This reduces the large fact table join from scanning 4.9M rows to only relevant filtered rows. 2. Replace UNION ALL of three separate aggregations with a single GROUP BY GROUPING SETS that computes all three levels in one pass over the results CTE."
}
```