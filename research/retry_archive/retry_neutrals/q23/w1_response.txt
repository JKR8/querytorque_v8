```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "date_years": "SELECT d_date_sk, d_date FROM date_dim WHERE d_year IN (2000, 2001, 2002, 2003)",
        "date_month": "SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2000 AND d_moy = 2",
        "frequent_ss_items": "SELECT itemdesc, i_item_sk AS item_sk, d_date AS solddate, COUNT(*) AS cnt FROM store_sales, date_years, (SELECT SUBSTRING(i_item_desc, 1, 30) AS itemdesc, * FROM item) AS sq1 WHERE ss_sold_date_sk = d_date_sk AND ss_item_sk = i_item_sk GROUP BY itemdesc, i_item_sk, d_date HAVING COUNT(*) > 4",
        "max_store_sales": "SELECT MAX(csales) AS tpcds_cmax FROM (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS csales FROM store_sales, customer, date_years WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk = d_date_sk GROUP BY c_customer_sk) AS sq2",
        "best_ss_customer": "SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS ssales FROM store_sales, customer, max_store_sales WHERE ss_customer_sk = c_customer_sk GROUP BY c_customer_sk HAVING SUM(ss_quantity * ss_sales_price) > (50 / 100.0) * MAX(tpcds_cmax)",
        "main_query": "SELECT c_last_name, c_first_name, sales FROM (SELECT c_last_name, c_first_name, SUM(cs_quantity * cs_list_price) AS sales FROM catalog_sales, customer, date_month, frequent_ss_items, best_ss_customer WHERE cs_sold_date_sk = d_date_sk AND cs_item_sk = item_sk AND cs_bill_customer_sk = best_ss_customer.c_customer_sk AND cs_bill_customer_sk = customer.c_customer_sk GROUP BY c_last_name, c_first_name UNION ALL SELECT c_last_name, c_first_name, SUM(ws_quantity * ws_list_price) AS sales FROM web_sales, customer, date_month, frequent_ss_items, best_ss_customer WHERE ws_sold_date_sk = d_date_sk AND ws_item_sk = item_sk AND ws_bill_customer_sk = best_ss_customer.c_customer_sk AND ws_bill_customer_sk = customer.c_customer_sk GROUP BY c_last_name, c_first_name) AS sq3 ORDER BY c_last_name NULLS FIRST, c_first_name NULLS FIRST, sales NULLS FIRST LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same output columns",
        "same grain",
        "same ordering"
      ],
      "expected_speedup": "2.8x",
      "risk": "low"
    },
    {
      "id": "rs_02",
      "transform": "pushdown",
      "nodes": {
        "filtered_frequent_ss_items": "SELECT itemdesc, i_item_sk AS item_sk, d_date AS solddate, COUNT(*) AS cnt FROM store_sales, date_years, (SELECT SUBSTRING(i_item_desc, 1, 30) AS itemdesc, * FROM item) AS sq1 WHERE ss_sold_date_sk = d_date_sk AND ss_item_sk = i_item_sk AND d_year = 2000 GROUP BY itemdesc, i_item_sk, d_date HAVING COUNT(*) > 4",
        "filtered_max_store_sales": "SELECT MAX(csales) AS tpcds_cmax FROM (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS csales FROM store_sales, customer, date_years WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 2000 GROUP BY c_customer_sk) AS sq2",
        "frequent_ss_items": "SELECT * FROM filtered_frequent_ss_items",
        "max_store_sales": "SELECT * FROM filtered_max_store_sales",
        "best_ss_customer": "SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS ssales FROM store_sales, customer, max_store_sales WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk IN (SELECT d_date_sk FROM date_years WHERE d_year = 2000) GROUP BY c_customer_sk HAVING SUM(ss_quantity * ss_sales_price) > (50 / 100.0) * MAX(tpcds_cmax)",
        "main_query": "SELECT c_last_name, c_first_name, sales FROM (SELECT c_last_name, c_first_name, SUM(cs_quantity * cs_list_price) AS sales FROM catalog_sales, customer, date_month, frequent_ss_items, best_ss_customer WHERE cs_sold_date_sk = d_date_sk AND cs_item_sk = item_sk AND cs_bill_customer_sk = best_ss_customer.c_customer_sk AND cs_bill_customer_sk = customer.c_customer_sk GROUP BY c_last_name, c_first_name UNION ALL SELECT c_last_name, c_first_name, SUM(ws_quantity * ws_list_price) AS sales FROM web_sales, customer, date_month, frequent_ss_items, best_ss_customer WHERE ws_sold_date_sk = d_date_sk AND ws_item_sk = item_sk AND ws_bill_customer_sk = best_ss_customer.c_customer_sk AND ws_bill_customer_sk = customer.c_customer_sk GROUP BY c_last_name, c_first_name) AS sq3 ORDER BY c_last_name NULLS FIRST, c_first_name NULLS FIRST, sales NULLS FIRST LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same output columns",
        "same grain"
      ],
      "expected_speedup": "1.9x",
      "risk": "medium"
    }
  ],
  "explanation": "Applied two sequential optimizations: 1) DATE_CTE_ISOLATE to pre-filter date_dim tables and reuse them across all CTEs, avoiding repeated scans and filters. This isolates the year/month filtering into reusable CTEs. 2) PUSHDOWN to further restrict CTE computations to only year 2000 data (since main query only uses 2000), reducing the working set for expensive aggregations. The date_years CTE remains for broader ranges but filtered versions are created for pushdown. Risk is medium for pushdown as it changes HAVING clause scope, but semantics preserved due to main query's date constraints."
}
```