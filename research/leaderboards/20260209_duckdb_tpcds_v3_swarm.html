<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DuckDB TPC-DS SF10 Leaderboard — V3 Swarm (2026-02-09)</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #fff; --bg2: #f8fafc; --bg3: #f1f5f9; --brd: #e2e8f0; --brd2: #cbd5e1;
  --t1: #0f172a; --t2: #475569; --t3: #94a3b8;
  --grn: #16a34a; --grn2: #dcfce7;
  --red: #dc2626; --red2: #fef2f2;
  --amb: #d97706; --amb2: #fffbeb;
  --blu: #2563eb; --blu2: #eff6ff;
  --mono: 'DM Mono', monospace;
  --sans: 'DM Sans', -apple-system, system-ui, sans-serif;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: var(--sans); background: var(--bg); color: var(--t1);
  padding: 32px 40px; line-height: 1.6; -webkit-font-smoothing: antialiased;
}
::selection { background: #dbeafe; }

h1 {
  font-size: 28px; font-weight: 700; letter-spacing: -.03em;
  color: var(--t1); margin-bottom: 2px;
}
.subtitle {
  font-size: 15px; color: var(--t2); margin-bottom: 28px;
}
.subtitle span { font-family: var(--mono); font-size: 13px; color: var(--t3); }

/* ——— summary cards ——— */
.summary { display: flex; gap: 12px; margin-bottom: 28px; flex-wrap: wrap; }
.stat {
  background: var(--bg); border: 1px solid var(--brd); border-radius: 10px;
  padding: 16px 22px; min-width: 130px; transition: border-color .2s, box-shadow .2s;
}
.stat:hover { border-color: var(--brd2); box-shadow: 0 1px 6px rgba(0,0,0,.025); }
.stat .label {
  font-size: 11px; font-family: var(--mono); color: var(--t3);
  letter-spacing: .1em; text-transform: uppercase; display: block;
}
.stat .value { font-size: 28px; font-weight: 700; margin-top: 4px; display: block; }
.stat.win .value { color: var(--grn); }
.stat.improved .value { color: var(--blu); }
.stat.neutral .value { color: var(--t3); }
.stat.regression .value { color: var(--red); }
.stat.error .value { color: var(--amb); }
.stat.avg .value { color: var(--t1); }

/* ——— filters ——— */
.filters {
  margin-bottom: 20px; display: flex; gap: 10px;
  flex-wrap: wrap; align-items: center;
}
.filters label {
  font-size: 13px; font-family: var(--mono); color: var(--t3);
  letter-spacing: .04em; text-transform: uppercase;
}
.filters select, .filters input {
  font-family: var(--sans); font-size: 14px; color: var(--t1);
  background: var(--bg); border: 1px solid var(--brd); border-radius: 6px;
  padding: 6px 12px; outline: none; transition: border-color .15s;
}
.filters select:focus, .filters input:focus {
  border-color: var(--brd2); box-shadow: 0 0 0 3px rgba(148,163,184,.06);
}
.filters input::placeholder { color: var(--t3); }

/* ——— table ——— */
table { width: 100%; border-collapse: collapse; font-size: 15px; }
th {
  background: var(--bg2); color: var(--t3); text-align: left;
  padding: 10px 14px; border-bottom: 2px solid var(--brd);
  font-size: 11px; font-family: var(--mono); letter-spacing: .08em;
  text-transform: uppercase; cursor: pointer; user-select: none; white-space: nowrap;
}
th:hover { color: var(--t1); }
th .arrow { font-size: 9px; margin-left: 4px; }
td { padding: 10px 14px; border-bottom: 1px solid var(--brd); }
tr:hover td { background: var(--bg2); }
tbody tr { transition: background .1s; }

.status-WIN { color: var(--grn); font-weight: 600; }
.status-IMPROVED { color: var(--blu); }
.status-NEUTRAL { color: var(--t3); }
.status-REGRESSION { color: var(--red); }
.status-error, .status-parse_error, .status-wrong_results { color: var(--amb); }

.speedup { font-weight: 600; font-variant-numeric: tabular-nums; font-family: var(--mono); }
.speedup-high { color: var(--grn); }
.speedup-mid { color: var(--blu); }
.speedup-low { color: var(--t2); }
.speedup-reg { color: var(--red); }

.ms { font-variant-numeric: tabular-nums; font-family: var(--mono); color: var(--t2); }
.transform { color: #7c3aed; font-family: var(--mono); font-size: 13px; }
.source { color: var(--t3); font-size: 13px; }
.source-analyst {
  color: #7c3aed; font-weight: 600; font-family: var(--mono); font-size: 13px;
}
.rows-yes { color: var(--grn); }
.rows-no { color: var(--red); font-weight: 700; }
.num { text-align: right; }

#updated {
  font-size: 12px; font-family: var(--mono); color: var(--t3);
  margin-top: 20px; letter-spacing: .02em;
}

@media (max-width: 768px) {
  body { padding: 20px 16px; }
  h1 { font-size: 22px; }
  table { font-size: 13px; }
  th, td { padding: 8px 8px; }
  .stat { min-width: 100px; padding: 12px 14px; }
  .stat .value { font-size: 22px; }
}
</style>
</head>
<body>

<h1>DuckDB TPC-DS SF10 Leaderboard</h1>
<div class="subtitle" id="subtitle">Loading...</div>

<div class="summary" id="summary"></div>

<div class="filters">
  <label>Status</label>
  <select id="statusFilter">
    <option value="all">All</option>
    <option value="WIN">WIN</option>
    <option value="IMPROVED">IMPROVED</option>
    <option value="NEUTRAL">NEUTRAL</option>
    <option value="REGRESSION">REGRESSION</option>
    <option value="error">ERROR</option>
  </select>
  <label>Runtime</label>
  <select id="runtimeFilter">
    <option value="0">Any</option>
    <option value="100">100ms+</option>
    <option value="500">500ms+</option>
    <option value="1000">1s+</option>
  </select>
  <label>Search</label>
  <input type="text" id="search" placeholder="query, transform, source..." size="24">
</div>

<table>
  <thead>
    <tr>
      <th data-col="rank">#</th>
      <th data-col="query_id">Query</th>
      <th data-col="status">Status</th>
      <th data-col="speedup" class="num">Speedup</th>
      <th data-col="original_ms" class="num">Orig (ms)</th>
      <th data-col="optimized_ms" class="num">Opt (ms)</th>
      <th data-col="rows_match">Rows</th>
      <th data-col="transforms">Transform</th>
      <th data-col="source">Source</th>
    </tr>
  </thead>
  <tbody id="tbody"></tbody>
</table>

<div id="updated"></div>

<script>
const INLINE_DATA = {
  "benchmark": "tpcds",
  "engine": "duckdb",
  "scale_factor": 10,
  "updated_at": "2026-02-08T04:28:19.195064+00:00",
  "source": "Consolidated: V2 Standard + Evo + Retry3W/4W + Swarm (2026-02-08)",
  "summary": {
    "total": 101,
    "wins": 92,
    "improved": 4,
    "neutral": 3,
    "regression": 2,
    "errors": 0,
    "avg_speedup": 1.8656
  },
  "queries": [
    {
      "query_id": "q88",
      "status": "WIN",
      "speedup": 6.2374,
      "original_ms": 1415.64,
      "optimized_ms": 226.96,
      "transforms": [
        "dimension_cte_isolate",
        "date_cte_isolate",
        "decorrelate",
        "single_pass_aggregation",
        "multi_dimension_prefetch"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q40",
      "status": "WIN",
      "speedup": 5.2323,
      "original_ms": 78.61,
      "optimized_ms": 15.02,
      "transforms": [
        "prefetch_fact_join",
        "multi_dimension_prefetch",
        "single_pass_aggregation"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q95",
      "status": "WIN",
      "speedup": 4.6867,
      "original_ms": 2784.22,
      "optimized_ms": 594.06,
      "transforms": [
        "prefetch_fact_join",
        "multi_dimension_prefetch",
        "single_pass_aggregation"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q9",
      "status": "WIN",
      "speedup": 4.47,
      "original_ms": 2206.17,
      "optimized_ms": 493.55,
      "transforms": [
        "decorrelate",
        "materialize_cte"
      ],
      "source": "Retry3W",
      "rows_match": true
    },
    {
      "query_id": "q81",
      "status": "WIN",
      "speedup": 4.3813,
      "original_ms": 355.19,
      "optimized_ms": 81.07,
      "transforms": [
        "decorrelate"
      ],
      "source": "unvalidated",
      "rows_match": true
    },
    {
      "query_id": "q11",
      "status": "WIN",
      "speedup": 4.0,
      "original_ms": 6017.12,
      "optimized_ms": 1504.28,
      "transforms": [
        "single_pass_aggregation",
        "date_cte_isolate",
        "prefetch_fact_join"
      ],
      "source": "Evo",
      "rows_match": true
    },
    {
      "query_id": "q63",
      "status": "WIN",
      "speedup": 3.77,
      "original_ms": 387.19,
      "optimized_ms": 102.7,
      "transforms": [
        "or_to_union"
      ],
      "source": "Retry3W",
      "rows_match": true
    },
    {
      "query_id": "q46",
      "status": "WIN",
      "speedup": 3.23,
      "original_ms": 859.94,
      "optimized_ms": 266.24,
      "transforms": [
        "or_to_union"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q15",
      "status": "WIN",
      "speedup": 3.17,
      "original_ms": 150.38,
      "optimized_ms": 47.44,
      "transforms": [
        "or_to_union"
      ],
      "source": "Evo",
      "rows_match": true
    },
    {
      "query_id": "q1",
      "status": "WIN",
      "speedup": 2.92,
      "original_ms": 239.26,
      "optimized_ms": 81.94,
      "transforms": [
        "decorrelate"
      ],
      "source": "Kimi",
      "rows_match": true
    },
    {
      "query_id": "q4",
      "status": "WIN",
      "speedup": 2.91,
      "original_ms": 10208.82,
      "optimized_ms": 3508.19,
      "transforms": [
        "single_pass_aggregation",
        "date_cte_isolate",
        "prefetch_fact_join"
      ],
      "source": "analyst_mode",
      "rows_match": true
    },
    {
      "query_id": "q42",
      "status": "WIN",
      "speedup": 2.8,
      "original_ms": 217.87,
      "optimized_ms": 77.81,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q93",
      "status": "WIN",
      "speedup": 2.73,
      "original_ms": 2860.55,
      "optimized_ms": 1047.82,
      "transforms": [
        "decorrelate"
      ],
      "source": "Kimi",
      "rows_match": true
    },
    {
      "query_id": "q43",
      "status": "WIN",
      "speedup": 2.71,
      "original_ms": 618.94,
      "optimized_ms": 228.39,
      "transforms": [
        "early_filter"
      ],
      "source": "Retry3W",
      "rows_match": true
    },
    {
      "query_id": "q77",
      "status": "WIN",
      "speedup": 2.56,
      "original_ms": 420.65,
      "optimized_ms": 164.32,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q70",
      "status": "WIN",
      "speedup": 2.5213,
      "original_ms": 739.9,
      "optimized_ms": 293.46,
      "transforms": [
        "early_filter",
        "pushdown",
        "materialize_cte"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q52",
      "status": "WIN",
      "speedup": 2.5,
      "original_ms": 238.82,
      "optimized_ms": 95.53,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q36",
      "status": "WIN",
      "speedup": 2.4685,
      "original_ms": 879.23,
      "optimized_ms": 356.18,
      "transforms": [
        "date_cte_isolate",
        "multi_dimension_prefetch"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q21",
      "status": "WIN",
      "speedup": 2.43,
      "original_ms": 71.07,
      "optimized_ms": 29.25,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q14",
      "status": "WIN",
      "speedup": 2.3949,
      "original_ms": 5289.77,
      "optimized_ms": 2208.79,
      "transforms": [
        "decorrelate",
        "intersect_to_exists",
        "date_cte_isolate",
        "multi_date_range_cte",
        "prefetch_fact_join"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q35",
      "status": "WIN",
      "speedup": 2.3619,
      "original_ms": 734.71,
      "optimized_ms": 311.07,
      "transforms": [
        "prefetch_fact_join",
        "single_pass_aggregation",
        "or_to_union",
        "date_cte_isolate"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q29",
      "status": "WIN",
      "speedup": 2.35,
      "original_ms": 692.5,
      "optimized_ms": 294.68,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Retry3W",
      "rows_match": true
    },
    {
      "query_id": "q99",
      "status": "WIN",
      "speedup": 2.3323,
      "original_ms": 313.89,
      "optimized_ms": 134.58,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q23",
      "status": "WIN",
      "speedup": 2.33,
      "original_ms": 24403.59,
      "optimized_ms": 10473.64,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q47",
      "status": "WIN",
      "speedup": 2.31,
      "original_ms": 2705.8,
      "optimized_ms": 1171.34,
      "transforms": [
        "or_to_union"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q59",
      "status": "WIN",
      "speedup": 2.2287,
      "original_ms": 1794.06,
      "optimized_ms": 804.96,
      "transforms": [
        "single_pass_aggregation",
        "prefetch_fact_join",
        "multi_dimension_prefetch"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q2",
      "status": "WIN",
      "speedup": 2.0971,
      "original_ms": 937.05,
      "optimized_ms": 446.83,
      "transforms": [
        "pushdown"
      ],
      "source": "unvalidated",
      "rows_match": true
    },
    {
      "query_id": "q80",
      "status": "WIN",
      "speedup": 2.06,
      "original_ms": 1553.28,
      "optimized_ms": 754.02,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q39",
      "status": "WIN",
      "speedup": 2.02,
      "original_ms": 452.21,
      "optimized_ms": 223.87,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q97",
      "status": "WIN",
      "speedup": 1.98,
      "original_ms": 2642.65,
      "optimized_ms": 1334.67,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q26",
      "status": "WIN",
      "speedup": 1.93,
      "original_ms": 166.96,
      "optimized_ms": 86.51,
      "transforms": [
        "or_to_union"
      ],
      "source": "Retry3W",
      "rows_match": true
    },
    {
      "query_id": "q69",
      "status": "WIN",
      "speedup": 1.92,
      "original_ms": 441.33,
      "optimized_ms": 229.86,
      "transforms": [
        "decorrelate"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q87",
      "status": "WIN",
      "speedup": 1.9134,
      "original_ms": 928.43,
      "optimized_ms": 485.21,
      "transforms": [
        "decorrelate",
        "date_cte_isolate",
        "dimension_cte_isolate"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q5",
      "status": "WIN",
      "speedup": 1.89,
      "original_ms": 1169.49,
      "optimized_ms": 618.78,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Retry3W",
      "rows_match": true
    },
    {
      "query_id": "q65",
      "status": "WIN",
      "speedup": 1.8449,
      "original_ms": 1494.63,
      "optimized_ms": 810.15,
      "transforms": [
        "prefetch_fact_join",
        "multi_dimension_prefetch",
        "single_pass_aggregation"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q85",
      "status": "WIN",
      "speedup": 1.83,
      "original_ms": 459.82,
      "optimized_ms": 251.27,
      "transforms": [
        "or_to_union"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q51",
      "status": "WIN",
      "speedup": 1.82,
      "original_ms": 7935.14,
      "optimized_ms": 4359.97,
      "transforms": [
        "prefetch_fact_join"
      ],
      "source": "analyst_mode",
      "rows_match": true
    },
    {
      "query_id": "q32",
      "status": "WIN",
      "speedup": 1.8164,
      "original_ms": 13.65,
      "optimized_ms": 7.51,
      "transforms": [
        "decorrelate",
        "prefetch_fact_join"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q92",
      "status": "WIN",
      "speedup": 1.8126,
      "original_ms": 70.73,
      "optimized_ms": 39.02,
      "transforms": [
        "decorrelate"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q54",
      "status": "WIN",
      "speedup": 1.81,
      "original_ms": 389.15,
      "optimized_ms": 215.0,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q78",
      "status": "WIN",
      "speedup": 1.81,
      "original_ms": 9002.15,
      "optimized_ms": 4973.56,
      "transforms": [
        "pushdown"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q94",
      "status": "WIN",
      "speedup": 1.739,
      "original_ms": 174.95,
      "optimized_ms": 100.6,
      "transforms": [
        "prefetch_fact_join"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q22",
      "status": "WIN",
      "speedup": 1.69,
      "original_ms": 7654.7,
      "optimized_ms": 4529.41,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Retry3W",
      "rows_match": true
    },
    {
      "query_id": "q64",
      "status": "WIN",
      "speedup": 1.6469,
      "original_ms": 1419.94,
      "optimized_ms": 862.16,
      "transforms": [
        "date_cte_isolate",
        "dimension_cte_isolate"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q96",
      "status": "WIN",
      "speedup": 1.64,
      "original_ms": 253.36,
      "optimized_ms": 154.49,
      "transforms": [
        "early_filter"
      ],
      "source": "Retry3W",
      "rows_match": true
    },
    {
      "query_id": "q58",
      "status": "WIN",
      "speedup": 1.64,
      "original_ms": 269.02,
      "optimized_ms": 164.04,
      "transforms": [
        "materialize_cte"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q90",
      "status": "WIN",
      "speedup": 1.6391,
      "original_ms": 75.16,
      "optimized_ms": 45.85,
      "transforms": [
        "decorrelate",
        "single_pass_aggregation",
        "multi_dimension_prefetch"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q62",
      "status": "WIN",
      "speedup": 1.6153,
      "original_ms": 199.2,
      "optimized_ms": 123.32,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q27",
      "status": "WIN",
      "speedup": 1.5832,
      "original_ms": 730.61,
      "optimized_ms": 461.48,
      "transforms": [
        "date_cte_isolate",
        "multi_dimension_prefetch"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q75",
      "status": "WIN",
      "speedup": 1.5797,
      "original_ms": 1597.81,
      "optimized_ms": 1011.44,
      "transforms": [
        "decorrelate",
        "union_cte_split",
        "date_cte_isolate",
        "dimension_cte_isolate",
        "prefetch_fact_join"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q73",
      "status": "WIN",
      "speedup": 1.57,
      "original_ms": 450.09,
      "optimized_ms": 286.68,
      "transforms": [
        "or_to_union"
      ],
      "source": "Retry3W",
      "rows_match": true
    },
    {
      "query_id": "q18",
      "status": "WIN",
      "speedup": 1.5658,
      "original_ms": 287.78,
      "optimized_ms": 183.79,
      "transforms": [
        "dimension_cte_isolate",
        "date_cte_isolate",
        "multi_dimension_prefetch"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q67",
      "status": "WIN",
      "speedup": 1.501,
      "original_ms": 10268.99,
      "optimized_ms": 6841.39,
      "transforms": [
        "decorrelate",
        "date_cte_isolate",
        "dimension_cte_isolate"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q57",
      "status": "WIN",
      "speedup": 1.4869,
      "original_ms": 670.24,
      "optimized_ms": 450.75,
      "transforms": [
        "prefetch_fact_join"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q38",
      "status": "WIN",
      "speedup": 1.44,
      "original_ms": 1598.84,
      "optimized_ms": 1110.31,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Retry3W",
      "rows_match": true
    },
    {
      "query_id": "q41",
      "status": "WIN",
      "speedup": 1.4286,
      "original_ms": 17.35,
      "optimized_ms": 12.15,
      "transforms": [
        "decorrelate",
        "single_pass_aggregation",
        "dimension_cte_isolate"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q68",
      "status": "WIN",
      "speedup": 1.42,
      "original_ms": 889.66,
      "optimized_ms": 626.52,
      "transforms": [
        "or_to_union"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q86",
      "status": "WIN",
      "speedup": 1.3893,
      "original_ms": 131.66,
      "optimized_ms": 94.77,
      "transforms": [
        "prefetch_fact_join"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q72",
      "status": "WIN",
      "speedup": 1.38,
      "original_ms": 1467.27,
      "optimized_ms": 1063.24,
      "transforms": [
        "semantic_rewrite"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q44",
      "status": "WIN",
      "speedup": 1.3654,
      "original_ms": 4.35,
      "optimized_ms": 3.18,
      "transforms": [
        "materialize_cte"
      ],
      "source": "state_0",
      "rows_match": true
    },
    {
      "query_id": "q74",
      "status": "WIN",
      "speedup": 1.36,
      "original_ms": 4129.73,
      "optimized_ms": 3036.57,
      "transforms": [
        "pushdown"
      ],
      "source": "Kimi",
      "rows_match": true
    },
    {
      "query_id": "q56",
      "status": "WIN",
      "speedup": 1.3527,
      "original_ms": 329.78,
      "optimized_ms": 243.79,
      "transforms": [
        "decorrelate",
        "date_cte_isolate",
        "multi_dimension_prefetch"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q61",
      "status": "WIN",
      "speedup": 1.3392,
      "original_ms": 10.73,
      "optimized_ms": 8.01,
      "transforms": [
        "prefetch_fact_join",
        "single_pass_aggregation",
        "multi_dimension_prefetch"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q45",
      "status": "WIN",
      "speedup": 1.339,
      "original_ms": 105.29,
      "optimized_ms": 78.64,
      "transforms": [
        "decorrelate",
        "intersect_to_exists",
        "date_cte_isolate",
        "multi_dimension_prefetch"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q6",
      "status": "WIN",
      "speedup": 1.33,
      "original_ms": 418.9,
      "optimized_ms": 314.96,
      "transforms": [
        "decorrelate",
        "date_cte_isolate",
        "dimension_cte_isolate",
        "prefetch_fact_join"
      ],
      "source": "Kimi",
      "rows_match": true
    },
    {
      "query_id": "q28",
      "status": "WIN",
      "speedup": 1.33,
      "original_ms": 3730.71,
      "optimized_ms": 2805.05,
      "transforms": [
        "semantic_rewrite"
      ],
      "source": "Kimi",
      "rows_match": true
    },
    {
      "query_id": "q31",
      "status": "WIN",
      "speedup": 1.33,
      "original_ms": 661.33,
      "optimized_ms": 497.24,
      "transforms": [
        "pushdown"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q10",
      "status": "WIN",
      "speedup": 1.32,
      "original_ms": 290.32,
      "optimized_ms": 219.94,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q37",
      "status": "WIN",
      "speedup": 1.3,
      "original_ms": 124.4,
      "optimized_ms": 95.69,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Retry3W",
      "rows_match": true
    },
    {
      "query_id": "q98",
      "status": "WIN",
      "speedup": 1.26,
      "original_ms": 384.96,
      "optimized_ms": 305.52,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q84",
      "status": "WIN",
      "speedup": 1.2554,
      "original_ms": 52.98,
      "optimized_ms": 42.2,
      "transforms": [
        "or_to_union",
        "intersect_to_exists",
        "multi_dimension_prefetch"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q16",
      "status": "WIN",
      "speedup": 1.2527,
      "original_ms": 24.5,
      "optimized_ms": 19.56,
      "transforms": [
        "date_cte_isolate",
        "multi_dimension_prefetch"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q23a",
      "status": "WIN",
      "speedup": 1.2438,
      "original_ms": 7580.46,
      "optimized_ms": 6094.49,
      "transforms": [
        "decorrelate",
        "date_cte_isolate",
        "prefetch_fact_join"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q83",
      "status": "WIN",
      "speedup": 1.24,
      "original_ms": 75.64,
      "optimized_ms": 61.0,
      "transforms": [
        "materialize_cte"
      ],
      "source": "Kimi",
      "rows_match": true
    },
    {
      "query_id": "q30",
      "status": "WIN",
      "speedup": 1.239,
      "original_ms": 133.91,
      "optimized_ms": 108.08,
      "transforms": [
        "decorrelate",
        "materialize_cte"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q12",
      "status": "WIN",
      "speedup": 1.23,
      "original_ms": 110.27,
      "optimized_ms": 89.65,
      "transforms": [
        "prefetch_fact_join"
      ],
      "source": "Retry3W",
      "rows_match": true
    },
    {
      "query_id": "q66",
      "status": "WIN",
      "speedup": 1.23,
      "original_ms": 444.51,
      "optimized_ms": 361.39,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Kimi",
      "rows_match": true
    },
    {
      "query_id": "q13",
      "status": "WIN",
      "speedup": 1.2111,
      "original_ms": 602.55,
      "optimized_ms": 497.53,
      "transforms": [
        "dimension_cte_isolate",
        "multi_dimension_prefetch",
        "date_cte_isolate"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q82",
      "status": "WIN",
      "speedup": 1.2058,
      "original_ms": 135.13,
      "optimized_ms": 112.07,
      "transforms": [
        "prefetch_fact_join",
        "multi_dimension_prefetch",
        "single_pass_aggregation"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q53",
      "status": "WIN",
      "speedup": 1.2056,
      "original_ms": 236.25,
      "optimized_ms": 195.95,
      "transforms": [
        "decorrelate",
        "or_to_union",
        "date_cte_isolate",
        "dimension_cte_isolate"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q17",
      "status": "WIN",
      "speedup": 1.19,
      "original_ms": 864.36,
      "optimized_ms": 726.35,
      "transforms": [
        "date_cte_isolate",
        "multi_date_range_cte",
        "prefetch_fact_join"
      ],
      "source": "Kimi",
      "rows_match": true
    },
    {
      "query_id": "q3",
      "status": "WIN",
      "speedup": 1.19,
      "original_ms": 296.3,
      "optimized_ms": 248.99,
      "transforms": [
        "date_cte_isolate",
        "dimension_cte_isolate"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q79",
      "status": "WIN",
      "speedup": 1.1785,
      "original_ms": 589.47,
      "optimized_ms": 500.21,
      "transforms": [
        "date_cte_isolate",
        "multi_dimension_prefetch"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q23b",
      "status": "WIN",
      "speedup": 1.1753,
      "original_ms": 7331.38,
      "optimized_ms": 6237.74,
      "transforms": [
        "decorrelate",
        "intersect_to_exists",
        "date_cte_isolate",
        "prefetch_fact_join"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q19",
      "status": "WIN",
      "speedup": 1.16,
      "original_ms": 389.37,
      "optimized_ms": 335.66,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q60",
      "status": "WIN",
      "speedup": 1.151,
      "original_ms": 318.99,
      "optimized_ms": 277.14,
      "transforms": [
        "decorrelate",
        "date_cte_isolate",
        "multi_dimension_prefetch"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q33",
      "status": "WIN",
      "speedup": 1.1482,
      "original_ms": 280.38,
      "optimized_ms": 244.19,
      "transforms": [
        "decorrelate",
        "date_cte_isolate",
        "multi_dimension_prefetch"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q7",
      "status": "WIN",
      "speedup": 1.1453,
      "original_ms": 549.12,
      "optimized_ms": 479.45,
      "transforms": [
        "prefetch_fact_join",
        "dimension_cte_isolate"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q49",
      "status": "WIN",
      "speedup": 1.138,
      "original_ms": 384.55,
      "optimized_ms": 337.91,
      "transforms": [
        "date_cte_isolate",
        "dimension_cte_isolate",
        "decorrelate",
        "union_cte_split",
        "prefetch_fact_join"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q20",
      "status": "WIN",
      "speedup": 1.13,
      "original_ms": 71.56,
      "optimized_ms": 63.33,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Retry4W",
      "rows_match": true
    },
    {
      "query_id": "q48",
      "status": "WIN",
      "speedup": 1.1127,
      "original_ms": 677.66,
      "optimized_ms": 609.03,
      "transforms": [
        "early_filter",
        "pushdown",
        "materialize_cte"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q76",
      "status": "WIN",
      "speedup": 1.1089,
      "original_ms": 340.38,
      "optimized_ms": 306.95,
      "transforms": [
        "or_to_union",
        "intersect_to_exists",
        "decorrelate",
        "date_cte_isolate",
        "dimension_cte_isolate"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q50",
      "status": "IMPROVED",
      "speedup": 1.0956,
      "original_ms": 747.0,
      "optimized_ms": 681.79,
      "transforms": [
        "date_cte_isolate",
        "dimension_cte_isolate",
        "multi_date_range_cte"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q55",
      "status": "IMPROVED",
      "speedup": 1.0786,
      "original_ms": 197.22,
      "optimized_ms": 182.84,
      "transforms": [
        "date_cte_isolate",
        "dimension_cte_isolate"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q8",
      "status": "IMPROVED",
      "speedup": 1.0651,
      "original_ms": 711.81,
      "optimized_ms": 668.29,
      "transforms": [
        "date_cte_isolate",
        "dimension_cte_isolate",
        "decorrelate",
        "multi_dimension_prefetch"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q89",
      "status": "IMPROVED",
      "speedup": 1.0643,
      "original_ms": 448.41,
      "optimized_ms": 421.32,
      "transforms": [
        "or_to_union",
        "date_cte_isolate",
        "multi_dimension_prefetch"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q71",
      "status": "NEUTRAL",
      "speedup": 1.0422,
      "original_ms": 326.55,
      "optimized_ms": 313.32,
      "transforms": [
        "decorrelate",
        "date_cte_isolate",
        "multi_dimension_prefetch"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q34",
      "status": "NEUTRAL",
      "speedup": 1.0306,
      "original_ms": 357.13,
      "optimized_ms": 346.54,
      "transforms": [
        "date_cte_isolate",
        "dimension_cte_isolate",
        "multi_dimension_prefetch"
      ],
      "source": "Swarm",
      "rows_match": true
    },
    {
      "query_id": "q25",
      "status": "NEUTRAL",
      "speedup": 0.98,
      "original_ms": 515.35,
      "optimized_ms": 525.87,
      "transforms": [
        "date_cte_isolate"
      ],
      "source": "Kimi",
      "rows_match": true
    },
    {
      "query_id": "q91",
      "status": "REGRESSION",
      "speedup": 0.89,
      "original_ms": 43.33,
      "optimized_ms": 48.69,
      "transforms": [
        "or_to_union"
      ],
      "source": "Retry3W",
      "rows_match": true
    },
    {
      "query_id": "q24",
      "status": "REGRESSION",
      "speedup": 0.87,
      "original_ms": 780.29,
      "optimized_ms": 896.89,
      "transforms": [
        "pushdown"
      ],
      "source": "Kimi",
      "rows_match": true
    }
  ]
};

let DATA = null;
let sortCol = 'speedup';
let sortAsc = false;

function normalizeLeaderboard(raw) {
  const keep = ['query_id', 'status', 'speedup', 'original_ms', 'optimized_ms', 'transforms', 'source', 'rows_match'];
  const queries = Array.isArray(raw.queries) ? raw.queries.map(q => {
    const out = {};
    for (const k of keep) out[k] = q[k];
    return out;
  }) : [];

  return {
    benchmark: raw.benchmark || 'tpcds',
    engine: raw.engine || 'duckdb',
    scale_factor: raw.scale_factor || 10,
    updated_at: raw.updated_at || null,
    source: raw.source || 'leaderboard.json',
    summary: raw.summary || {},
    queries,
  };
}

async function load() {
  if (INLINE_DATA) {
    DATA = normalizeLeaderboard(INLINE_DATA);
  } else {
    try {
      const resp = await fetch('leaderboard.json', { cache: 'no-store' });
      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
      DATA = normalizeLeaderboard(await resp.json());
    } catch (err) {
      document.getElementById('subtitle').innerHTML = '<span>Failed to load leaderboard.json</span>';
      document.getElementById('updated').textContent = 'Open this page via a local web server so fetch() can access leaderboard.json.';
      return;
    }
  }

  renderSummary();
  renderTable();
  document.getElementById('subtitle').innerHTML =
    `<span>${DATA.queries.length} queries</span> &middot; Engine: ${DATA.engine} &middot; SF${DATA.scale_factor} &middot; <span>3-run validated</span>`;

  if (DATA.updated_at) {
    const dt = new Date(DATA.updated_at);
    const valid = !Number.isNaN(dt.getTime());
    document.getElementById('updated').textContent = valid
      ? 'Updated ' + dt.toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric', hour:'2-digit', minute:'2-digit'})
      : 'Updated ' + DATA.updated_at;
  } else {
    document.getElementById('updated').textContent = 'Updated time unavailable';
  }
}

function renderSummary() {
  const q = DATA.queries;
  const wins = q.filter(x => x.speedup >= 1.10 && !isError(x)).length;
  const improved = q.filter(x => x.speedup >= 1.05 && x.speedup < 1.10 && !isError(x)).length;
  const neutral = q.filter(x => x.speedup >= 0.95 && x.speedup < 1.05 && !isError(x)).length;
  const regression = q.filter(x => x.speedup > 0 && x.speedup < 0.95 && !isError(x)).length;
  const errors = q.filter(x => isError(x)).length;
  const validSpeeds = q.filter(x => x.speedup > 0 && !isError(x)).map(x => x.speedup);
  const avg = validSpeeds.length ? (validSpeeds.reduce((a,b)=>a+b,0)/validSpeeds.length) : 0;

  document.getElementById('summary').innerHTML = [
    mkStat('Wins', wins, 'win'),
    mkStat('Improved', improved, 'improved'),
    mkStat('Neutral', neutral, 'neutral'),
    mkStat('Regression', regression, 'regression'),
    mkStat('Error', errors, 'error'),
    mkStat('Avg Speedup', avg.toFixed(2) + 'x', 'avg'),
  ].join('');
}

function mkStat(label, value, cls) {
  return `<div class="stat ${cls}"><span class="label">${label}</span><span class="value">${value}</span></div>`;
}

function isError(q) {
  const status = String(q.status || '').toUpperCase();
  return ['ERROR', 'PARSE_ERROR', 'WRONG_RESULTS', 'FAIL'].includes(status);
}

function qnum(qid) {
  const m = qid.match(/q(\d+)/);
  return m ? parseInt(m[1]) : 9999;
}

function getFiltered() {
  let q = [...DATA.queries];
  const sf = document.getElementById('statusFilter').value;
  const rf = parseInt(document.getElementById('runtimeFilter').value);
  const search = document.getElementById('search').value.toLowerCase().trim();

  if (sf !== 'all') {
    if (sf === 'error') q = q.filter(x => isError(x));
    else q = q.filter(x => x.status === sf);
  }
  if (rf > 0) q = q.filter(x => (x.original_ms || 0) >= rf);
  if (search) q = q.filter(x =>
    x.query_id.toLowerCase().includes(search) ||
    (x.transforms || []).join(' ').toLowerCase().includes(search) ||
    (x.source || '').toLowerCase().includes(search)
  );
  return q;
}

function renderTable() {
  let q = getFiltered();

  q.sort((a, b) => {
    let va, vb;
    if (sortCol === 'query_id' || sortCol === 'rank') { va = qnum(a.query_id); vb = qnum(b.query_id); }
    else if (['transforms','source','status'].includes(sortCol)) {
      va = sortCol === 'transforms' ? (a.transforms||[]).join(',') : (a[sortCol]||'');
      vb = sortCol === 'transforms' ? (b.transforms||[]).join(',') : (b[sortCol]||'');
      return sortAsc ? va.localeCompare(vb) : vb.localeCompare(va);
    }
    else if (sortCol === 'rows_match') { va = a.rows_match ? 1 : 0; vb = b.rows_match ? 1 : 0; }
    else { va = a[sortCol] || 0; vb = b[sortCol] || 0; }
    return sortAsc ? va - vb : vb - va;
  });

  document.getElementById('tbody').innerHTML = q.map((r, i) => {
    const sp = r.speedup || 0;
    const spClass = sp >= 1.5 ? 'speedup-high' : sp >= 1.1 ? 'speedup-mid' : sp >= 0.95 ? 'speedup-low' : 'speedup-reg';
    const origMs = r.original_ms ? r.original_ms.toFixed(0) : '\u2014';
    const optMs = r.optimized_ms ? r.optimized_ms.toFixed(0) : '\u2014';
    const rowsClass = r.rows_match === true ? 'rows-yes' : r.rows_match === false ? 'rows-no' : '';
    const rowsText = r.rows_match === true ? '\u2713' : r.rows_match === false ? 'NO' : '\u2014';
    const transforms = (r.transforms || []).join(', ') || '\u2014';
    const srcClass = (r.source || '').includes('analyst') ? 'source-analyst' : 'source';

    return `<tr>
      <td class="num" style="color:var(--t3);font-size:13px">${i+1}</td>
      <td style="font-weight:600">${r.query_id}</td>
      <td class="status-${r.status}">${r.status}</td>
      <td class="num speedup ${spClass}">${sp > 0 ? sp.toFixed(2) + 'x' : '\u2014'}</td>
      <td class="num ms">${origMs}</td>
      <td class="num ms">${optMs}</td>
      <td class="${rowsClass}" style="text-align:center">${rowsText}</td>
      <td class="transform">${transforms}</td>
      <td class="${srcClass}">${r.source || '\u2014'}</td>
    </tr>`;
  }).join('');

  document.querySelectorAll('th').forEach(th => {
    const col = th.dataset.col;
    const existing = th.querySelector('.arrow');
    if (existing) existing.remove();
    if (col === sortCol) {
      const span = document.createElement('span');
      span.className = 'arrow';
      span.textContent = sortAsc ? ' \u25B2' : ' \u25BC';
      th.appendChild(span);
    }
  });
}

document.querySelectorAll('th').forEach(th => {
  th.addEventListener('click', () => {
    const col = th.dataset.col;
    if (col === sortCol) sortAsc = !sortAsc;
    else { sortCol = col; sortAsc = false; }
    renderTable();
  });
});

document.getElementById('statusFilter').addEventListener('change', renderTable);
document.getElementById('runtimeFilter').addEventListener('change', renderTable);
document.getElementById('search').addEventListener('input', renderTable);

load();
</script>
</body>
</html>
