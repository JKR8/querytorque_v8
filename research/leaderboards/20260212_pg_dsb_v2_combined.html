<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PostgreSQL DSB SF10 Leaderboard â€” V2 Combined (2026-02-12)</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #fff; --bg2: #f8fafc; --bg3: #f1f5f9; --brd: #e2e8f0; --brd2: #cbd5e1;
  --t1: #0f172a; --t2: #475569; --t3: #94a3b8;
  --grn: #16a34a; --grn2: #dcfce7;
  --red: #dc2626; --red2: #fef2f2;
  --amb: #d97706; --amb2: #fffbeb;
  --blu: #2563eb; --blu2: #eff6ff;
  --mono: 'DM Mono', monospace;
  --sans: 'DM Sans', -apple-system, system-ui, sans-serif;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: var(--sans); background: var(--bg); color: var(--t1);
  padding: 32px 40px; line-height: 1.6; -webkit-font-smoothing: antialiased;
}
::selection { background: #dbeafe; }

h1 {
  font-size: 28px; font-weight: 700; letter-spacing: -.03em;
  color: var(--t1); margin-bottom: 2px;
}
.subtitle {
  font-size: 15px; color: var(--t2); margin-bottom: 28px;
}
.subtitle span { font-family: var(--mono); font-size: 13px; color: var(--t3); }

.summary { display: flex; gap: 12px; margin-bottom: 28px; flex-wrap: wrap; }
.stat {
  background: var(--bg); border: 1px solid var(--brd); border-radius: 10px;
  padding: 16px 22px; min-width: 130px; transition: border-color .2s, box-shadow .2s;
}
.stat:hover { border-color: var(--brd2); box-shadow: 0 1px 6px rgba(0,0,0,.025); }
.stat .label {
  font-size: 11px; font-family: var(--mono); color: var(--t3);
  letter-spacing: .1em; text-transform: uppercase; display: block;
}
.stat .value { font-size: 28px; font-weight: 700; margin-top: 4px; display: block; }
.stat.win .value { color: var(--grn); }
.stat.improved .value { color: var(--blu); }
.stat.neutral .value { color: var(--t3); }
.stat.regression .value { color: var(--red); }
.stat.avg .value { color: var(--t1); }

.filters {
  margin-bottom: 20px; display: flex; gap: 10px;
  flex-wrap: wrap; align-items: center;
}
.filters label {
  font-size: 13px; font-family: var(--mono); color: var(--t3);
  letter-spacing: .04em; text-transform: uppercase;
}
.filters select, .filters input {
  font-family: var(--sans); font-size: 14px; color: var(--t1);
  background: var(--bg); border: 1px solid var(--brd); border-radius: 6px;
  padding: 6px 12px; outline: none; transition: border-color .15s;
}
.filters select:focus, .filters input:focus {
  border-color: var(--brd2); box-shadow: 0 0 0 3px rgba(148,163,184,.06);
}
.filters input::placeholder { color: var(--t3); }

table { width: 100%; border-collapse: collapse; font-size: 15px; }
th {
  background: var(--bg2); color: var(--t3); text-align: left;
  padding: 10px 14px; border-bottom: 2px solid var(--brd);
  font-size: 11px; font-family: var(--mono); letter-spacing: .08em;
  text-transform: uppercase; cursor: pointer; user-select: none; white-space: nowrap;
}
th:hover { color: var(--t1); }
th .arrow { font-size: 9px; margin-left: 4px; }
td { padding: 10px 14px; border-bottom: 1px solid var(--brd); }
tr:hover td { background: var(--bg2); }
tbody tr { transition: background .1s; }

.status-WIN { color: var(--grn); font-weight: 600; }
.status-IMPROVED { color: var(--blu); }
.status-NEUTRAL { color: var(--t3); }
.status-REGRESSION { color: var(--red); }

.speedup { font-weight: 600; font-variant-numeric: tabular-nums; font-family: var(--mono); }
.speedup-high { color: var(--grn); }
.speedup-mid { color: var(--blu); }
.speedup-low { color: var(--t2); }
.speedup-reg { color: var(--red); }

.ms { font-variant-numeric: tabular-nums; font-family: var(--mono); color: var(--t2); }
.source { color: var(--t3); font-size: 13px; }
.source-rewrite { color: #7c3aed; font-weight: 600; font-family: var(--mono); font-size: 13px; }
.source-config { color: #0891b2; font-weight: 600; font-family: var(--mono); font-size: 13px; }
.config-type { font-family: var(--mono); font-size: 13px; color: var(--t2); }
.both-yes { color: var(--grn); font-size: 13px; }
.num { text-align: right; }

#updated {
  font-size: 12px; font-family: var(--mono); color: var(--t3);
  margin-top: 20px; letter-spacing: .02em;
}

@media (max-width: 768px) {
  body { padding: 20px 16px; }
  h1 { font-size: 22px; }
  table { font-size: 13px; }
  th, td { padding: 8px 8px; }
  .stat { min-width: 100px; padding: 12px 14px; }
  .stat .value { font-size: 22px; }
}
</style>
</head>
<body>

<h1>PostgreSQL DSB SF10 Leaderboard</h1>
<div class="subtitle" id="subtitle">Loading...</div>

<div class="summary" id="summary"></div>

<div class="filters">
  <label>Status</label>
  <select id="statusFilter">
    <option value="all">All</option>
    <option value="WIN">WIN</option>
    <option value="IMPROVED">IMPROVED</option>
    <option value="NEUTRAL">NEUTRAL</option>
  </select>
  <label>Source</label>
  <select id="sourceFilter">
    <option value="all">All</option>
    <option value="rewrite">Rewrite</option>
    <option value="config">Config</option>
    <option value="none">None</option>
  </select>
  <label>Search</label>
  <input type="text" id="search" placeholder="query, config type..." size="24">
</div>

<table>
  <thead>
    <tr>
      <th data-col="rank">#</th>
      <th data-col="query_id">Query</th>
      <th data-col="status">Status</th>
      <th data-col="speedup" class="num">Speedup</th>
      <th data-col="best_source">Best Source</th>
      <th data-col="rewrite_speedup" class="num">Rewrite</th>
      <th data-col="config_speedup" class="num">Config</th>
      <th data-col="config_type">Config Type</th>
      <th data-col="both_help">Both</th>
    </tr>
  </thead>
  <tbody id="tbody"></tbody>
</table>

<div id="updated"></div>

<script>
const INLINE_DATA = {
  "benchmark": "dsb",
  "engine": "postgresql",
  "scale_factor": 10,
  "updated_at": "2026-02-12T19:25:58",
  "source": "V2 Swarm (76 sessions) + Config Tuning (52 queries, 3-race validated)",
  "summary": {
    "total": 52,
    "wins": 29,
    "improved": 11,
    "neutral": 12,
    "regression": 0
  },
  "queries": [
    {
      "query_id": "query092_multi",
      "status": "WIN",
      "speedup": 8043.91,
      "best_source": "rewrite",
      "rewrite_speedup": 8043.91,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query032_multi",
      "status": "WIN",
      "speedup": 1465.16,
      "best_source": "rewrite",
      "rewrite_speedup": 1465.16,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query081_multi",
      "status": "WIN",
      "speedup": 438.93,
      "best_source": "rewrite",
      "rewrite_speedup": 438.93,
      "config_speedup": 1.74,
      "config_type": "hint+config",
      "config_gap_pct": 42.5,
      "both_help": true
    },
    {
      "query_id": "query010_multi",
      "status": "WIN",
      "speedup": 30.18,
      "best_source": "rewrite",
      "rewrite_speedup": 30.18,
      "config_speedup": 1.71,
      "config_type": "config",
      "config_gap_pct": 41.5,
      "both_help": true
    },
    {
      "query_id": "query039_multi",
      "status": "WIN",
      "speedup": 29.48,
      "best_source": "rewrite",
      "rewrite_speedup": 29.48,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query001_multi",
      "status": "WIN",
      "speedup": 27.8,
      "best_source": "rewrite",
      "rewrite_speedup": 27.8,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query101_spj_spj",
      "status": "WIN",
      "speedup": 11.47,
      "best_source": "rewrite",
      "rewrite_speedup": 11.47,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query101_agg",
      "status": "WIN",
      "speedup": 10.92,
      "best_source": "rewrite",
      "rewrite_speedup": 10.92,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query100_spj_spj",
      "status": "WIN",
      "speedup": 9.09,
      "best_source": "config",
      "rewrite_speedup": 0.61,
      "config_speedup": 9.09,
      "config_type": "config",
      "config_gap_pct": 89.0,
      "both_help": false
    },
    {
      "query_id": "query083_multi",
      "status": "WIN",
      "speedup": 8.56,
      "best_source": "rewrite",
      "rewrite_speedup": 8.56,
      "config_speedup": 3.14,
      "config_type": "hint+config",
      "config_gap_pct": 68.2,
      "both_help": true
    },
    {
      "query_id": "query072_spj_spj",
      "status": "WIN",
      "speedup": 7.18,
      "best_source": "rewrite",
      "rewrite_speedup": 7.18,
      "config_speedup": 1.47,
      "config_type": "hint+config",
      "config_gap_pct": 31.9,
      "both_help": true
    },
    {
      "query_id": "query013_agg",
      "status": "WIN",
      "speedup": 7.02,
      "best_source": "rewrite",
      "rewrite_speedup": 7.02,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query102_spj_spj",
      "status": "WIN",
      "speedup": 5.95,
      "best_source": "config",
      "rewrite_speedup": 0.51,
      "config_speedup": 5.95,
      "config_type": "config",
      "config_gap_pct": 83.2,
      "both_help": false
    },
    {
      "query_id": "query100_agg",
      "status": "WIN",
      "speedup": 5.71,
      "best_source": "config",
      "rewrite_speedup": 1.27,
      "config_speedup": 5.71,
      "config_type": "hint+config",
      "config_gap_pct": 82.5,
      "both_help": true
    },
    {
      "query_id": "query072_agg",
      "status": "WIN",
      "speedup": 5.35,
      "best_source": "config",
      "rewrite_speedup": null,
      "config_speedup": 5.35,
      "config_type": "hint",
      "config_gap_pct": 81.3,
      "both_help": false
    },
    {
      "query_id": "query064_multi",
      "status": "WIN",
      "speedup": 3.81,
      "best_source": "rewrite",
      "rewrite_speedup": 3.81,
      "config_speedup": 1.21,
      "config_type": "hint",
      "config_gap_pct": 17.1,
      "both_help": true
    },
    {
      "query_id": "query027_agg",
      "status": "WIN",
      "speedup": 3.76,
      "best_source": "config",
      "rewrite_speedup": 0.46,
      "config_speedup": 3.76,
      "config_type": "config",
      "config_gap_pct": 73.4,
      "both_help": false
    },
    {
      "query_id": "query025_agg",
      "status": "WIN",
      "speedup": 3.1,
      "best_source": "rewrite",
      "rewrite_speedup": 3.1,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query014_multi",
      "status": "WIN",
      "speedup": 3.02,
      "best_source": "config",
      "rewrite_speedup": 1.98,
      "config_speedup": 3.02,
      "config_type": "hint+config",
      "config_gap_pct": 66.9,
      "both_help": true
    },
    {
      "query_id": "query058_multi",
      "status": "WIN",
      "speedup": 2.51,
      "best_source": "config",
      "rewrite_speedup": null,
      "config_speedup": 2.51,
      "config_type": "hint",
      "config_gap_pct": 60.2,
      "both_help": false
    },
    {
      "query_id": "query027_spj_spj",
      "status": "WIN",
      "speedup": 2.35,
      "best_source": "config",
      "rewrite_speedup": 0.43,
      "config_speedup": 2.35,
      "config_type": "hint+config",
      "config_gap_pct": 57.5,
      "both_help": false
    },
    {
      "query_id": "query102_agg",
      "status": "WIN",
      "speedup": 2.11,
      "best_source": "config",
      "rewrite_speedup": 1.26,
      "config_speedup": 2.11,
      "config_type": "config",
      "config_gap_pct": 52.5,
      "both_help": true
    },
    {
      "query_id": "query059_multi",
      "status": "WIN",
      "speedup": 2.07,
      "best_source": "rewrite",
      "rewrite_speedup": 2.07,
      "config_speedup": 1.05,
      "config_type": "config",
      "config_gap_pct": 4.7,
      "both_help": true
    },
    {
      "query_id": "query069_multi",
      "status": "WIN",
      "speedup": 1.98,
      "best_source": "rewrite",
      "rewrite_speedup": 1.98,
      "config_speedup": 1.22,
      "config_type": "config",
      "config_gap_pct": 17.9,
      "both_help": true
    },
    {
      "query_id": "query030_multi",
      "status": "WIN",
      "speedup": 1.86,
      "best_source": "rewrite",
      "rewrite_speedup": 1.86,
      "config_speedup": 1.14,
      "config_type": "config",
      "config_gap_pct": 12.5,
      "both_help": true
    },
    {
      "query_id": "query075_multi",
      "status": "WIN",
      "speedup": 1.85,
      "best_source": "config",
      "rewrite_speedup": 0.3,
      "config_speedup": 1.85,
      "config_type": "config",
      "config_gap_pct": 46.0,
      "both_help": false
    },
    {
      "query_id": "query031_multi",
      "status": "WIN",
      "speedup": 1.79,
      "best_source": "rewrite",
      "rewrite_speedup": 1.79,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query038_multi",
      "status": "WIN",
      "speedup": 1.78,
      "best_source": "rewrite",
      "rewrite_speedup": 1.78,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query065_multi",
      "status": "WIN",
      "speedup": 1.75,
      "best_source": "rewrite",
      "rewrite_speedup": 1.75,
      "config_speedup": 1.09,
      "config_type": "hint+config",
      "config_gap_pct": 8.6,
      "both_help": true
    },
    {
      "query_id": "query050_spj_spj",
      "status": "IMPROVED",
      "speedup": 1.39,
      "best_source": "config",
      "rewrite_speedup": null,
      "config_speedup": 1.39,
      "config_type": "config",
      "config_gap_pct": 28.2,
      "both_help": false
    },
    {
      "query_id": "query080_multi",
      "status": "IMPROVED",
      "speedup": 1.39,
      "best_source": "rewrite",
      "rewrite_speedup": 1.39,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query091_spj_spj",
      "status": "IMPROVED",
      "speedup": 1.21,
      "best_source": "config",
      "rewrite_speedup": null,
      "config_speedup": 1.21,
      "config_type": "config",
      "config_gap_pct": 17.4,
      "both_help": false
    },
    {
      "query_id": "query091_agg",
      "status": "IMPROVED",
      "speedup": 1.19,
      "best_source": "config",
      "rewrite_speedup": 1.18,
      "config_speedup": 1.19,
      "config_type": "config",
      "config_gap_pct": 16.0,
      "both_help": true
    },
    {
      "query_id": "query099_agg",
      "status": "IMPROVED",
      "speedup": 1.18,
      "best_source": "rewrite",
      "rewrite_speedup": 1.18,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query087_multi",
      "status": "IMPROVED",
      "speedup": 1.15,
      "best_source": "rewrite",
      "rewrite_speedup": 1.15,
      "config_speedup": 1.13,
      "config_type": "config",
      "config_gap_pct": 11.4,
      "both_help": true
    },
    {
      "query_id": "query050_agg",
      "status": "IMPROVED",
      "speedup": 1.09,
      "best_source": "rewrite",
      "rewrite_speedup": 1.09,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query084_spj_spj",
      "status": "IMPROVED",
      "speedup": 1.08,
      "best_source": "config",
      "rewrite_speedup": 1.04,
      "config_speedup": 1.08,
      "config_type": "config",
      "config_gap_pct": 7.0,
      "both_help": true
    },
    {
      "query_id": "query018_agg",
      "status": "IMPROVED",
      "speedup": 1.07,
      "best_source": "rewrite",
      "rewrite_speedup": 1.07,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query023_multi",
      "status": "IMPROVED",
      "speedup": 1.07,
      "best_source": "config",
      "rewrite_speedup": 1.01,
      "config_speedup": 1.07,
      "config_type": "config",
      "config_gap_pct": 6.2,
      "both_help": true
    },
    {
      "query_id": "query025_spj_spj",
      "status": "IMPROVED",
      "speedup": 1.06,
      "best_source": "rewrite",
      "rewrite_speedup": 1.06,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query018_spj_spj",
      "status": "NEUTRAL",
      "speedup": 1.04,
      "best_source": "rewrite",
      "rewrite_speedup": 1.04,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query085_agg",
      "status": "NEUTRAL",
      "speedup": 1.04,
      "best_source": "rewrite",
      "rewrite_speedup": 1.04,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query013_spj_spj",
      "status": "NEUTRAL",
      "speedup": 1.03,
      "best_source": "rewrite",
      "rewrite_speedup": 1.03,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query019_agg",
      "status": "NEUTRAL",
      "speedup": 1.02,
      "best_source": "rewrite",
      "rewrite_speedup": 1.02,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query019_spj_spj",
      "status": "NEUTRAL",
      "speedup": 1.02,
      "best_source": "rewrite",
      "rewrite_speedup": 1.02,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query094_multi",
      "status": "NEUTRAL",
      "speedup": 1.02,
      "best_source": "rewrite",
      "rewrite_speedup": 1.02,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query040_spj_spj",
      "status": "NEUTRAL",
      "speedup": 1.01,
      "best_source": "rewrite",
      "rewrite_speedup": 1.01,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query054_multi",
      "status": "NEUTRAL",
      "speedup": 1.01,
      "best_source": "rewrite",
      "rewrite_speedup": 1.01,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query040_agg",
      "status": "NEUTRAL",
      "speedup": 1.0,
      "best_source": "none",
      "rewrite_speedup": 0.97,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query084_agg",
      "status": "NEUTRAL",
      "speedup": 1.0,
      "best_source": "none",
      "rewrite_speedup": 0.92,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query085_spj_spj",
      "status": "NEUTRAL",
      "speedup": 1.0,
      "best_source": "none",
      "rewrite_speedup": null,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    },
    {
      "query_id": "query099_spj_spj",
      "status": "NEUTRAL",
      "speedup": 1.0,
      "best_source": "none",
      "rewrite_speedup": 0.97,
      "config_speedup": null,
      "config_type": null,
      "config_gap_pct": null,
      "both_help": false
    }
  ]
};

let DATA = null;
let sortCol = 'speedup';
let sortAsc = false;

function qnum(qid) {
  const m = qid.match(/(\d+)/);
  return m ? parseInt(m[1]) : 9999;
}

async function load() {
  if (INLINE_DATA) {
    DATA = INLINE_DATA;
  } else {
    document.getElementById('subtitle').innerHTML = '<span>No data available</span>';
    return;
  }

  renderSummary();
  renderTable();
  document.getElementById('subtitle').innerHTML =
    `<span>${DATA.queries.length} queries</span> &middot; Engine: ${DATA.engine} &middot; SF${DATA.scale_factor} &middot; <span>V2 Swarm + Config Tuning</span>`;

  if (DATA.updated_at) {
    const dt = new Date(DATA.updated_at);
    const valid = !Number.isNaN(dt.getTime());
    document.getElementById('updated').textContent = valid
      ? 'Updated ' + dt.toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric', hour:'2-digit', minute:'2-digit'})
      : 'Updated ' + DATA.updated_at;
  }
}

function renderSummary() {
  const q = DATA.queries;
  const s = DATA.summary;
  const validSpeeds = q.filter(x => x.speedup > 0).map(x => x.speedup);
  const avg = validSpeeds.length ? (validSpeeds.reduce((a,b)=>a+b,0)/validSpeeds.length) : 0;

  document.getElementById('summary').innerHTML = [
    mkStat('Wins', s.wins, 'win'),
    mkStat('Improved', s.improved, 'improved'),
    mkStat('Neutral', s.neutral, 'neutral'),
    mkStat('Regression', s.regression, 'regression'),
    mkStat('Avg Speedup', avg.toFixed(2) + 'x', 'avg'),
  ].join('');
}

function mkStat(label, value, cls) {
  return `<div class="stat ${cls}"><span class="label">${label}</span><span class="value">${value}</span></div>`;
}

function getFiltered() {
  let q = [...DATA.queries];
  const sf = document.getElementById('statusFilter').value;
  const srcf = document.getElementById('sourceFilter').value;
  const search = document.getElementById('search').value.toLowerCase().trim();

  if (sf !== 'all') q = q.filter(x => x.status === sf);
  if (srcf !== 'all') q = q.filter(x => x.best_source === srcf);
  if (search) q = q.filter(x =>
    x.query_id.toLowerCase().includes(search) ||
    (x.config_type || '').toLowerCase().includes(search) ||
    (x.best_source || '').toLowerCase().includes(search)
  );
  return q;
}

function renderTable() {
  let q = getFiltered();

  q.sort((a, b) => {
    let va, vb;
    if (sortCol === 'query_id' || sortCol === 'rank') { va = qnum(a.query_id); vb = qnum(b.query_id); }
    else if (['best_source','status','config_type'].includes(sortCol)) {
      va = a[sortCol] || '';
      vb = b[sortCol] || '';
      return sortAsc ? va.localeCompare(vb) : vb.localeCompare(va);
    }
    else if (sortCol === 'both_help') { va = a.both_help ? 1 : 0; vb = b.both_help ? 1 : 0; }
    else { va = a[sortCol] || 0; vb = b[sortCol] || 0; }
    return sortAsc ? va - vb : vb - va;
  });

  document.getElementById('tbody').innerHTML = q.map((r, i) => {
    const sp = r.speedup || 0;
    const spClass = sp >= 1.5 ? 'speedup-high' : sp >= 1.1 ? 'speedup-mid' : sp >= 0.95 ? 'speedup-low' : 'speedup-reg';
    const srcClass = r.best_source === 'rewrite' ? 'source-rewrite' : r.best_source === 'config' ? 'source-config' : 'source';
    const rw = r.rewrite_speedup ? r.rewrite_speedup.toFixed(2) + 'x' : '\u2014';
    const cf = r.config_speedup ? r.config_speedup.toFixed(2) + 'x' : '\u2014';

    return `<tr>
      <td class="num" style="color:var(--t3);font-size:13px">${i+1}</td>
      <td style="font-weight:600">${r.query_id}</td>
      <td class="status-${r.status}">${r.status}</td>
      <td class="num speedup ${spClass}">${sp > 0 ? sp.toFixed(2) + 'x' : '\u2014'}</td>
      <td class="${srcClass}">${r.best_source || '\u2014'}</td>
      <td class="num ms">${rw}</td>
      <td class="num ms">${cf}</td>
      <td class="config-type">${r.config_type || '\u2014'}</td>
      <td class="${r.both_help ? 'both-yes' : ''}" style="text-align:center">${r.both_help ? '\u2713' : '\u2014'}</td>
    </tr>`;
  }).join('');

  document.querySelectorAll('th').forEach(th => {
    const col = th.dataset.col;
    const existing = th.querySelector('.arrow');
    if (existing) existing.remove();
    if (col === sortCol) {
      const span = document.createElement('span');
      span.className = 'arrow';
      span.textContent = sortAsc ? ' \u25B2' : ' \u25BC';
      th.appendChild(span);
    }
  });
}

document.querySelectorAll('th').forEach(th => {
  th.addEventListener('click', () => {
    const col = th.dataset.col;
    if (col === sortCol) sortAsc = !sortAsc;
    else { sortCol = col; sortAsc = false; }
    renderTable();
  });
});

document.getElementById('statusFilter').addEventListener('change', renderTable);
document.getElementById('sourceFilter').addEventListener('change', renderTable);
document.getElementById('search').addEventListener('input', renderTable);

load();
</script>
</body>
</html>