{
  "id": "MIN_BASELINE_THRESHOLD",
  "severity": "MEDIUM",
  "overridable": true,
  "description": "Be conservative with CTE-based transforms on queries with very short baseline runtimes. CTE materialization overhead can dominate when the query is already fast.",
  "failure_rate": "Caused 0.14x-0.59x regressions on queries under 50ms",
  "observed_failures": [
    {
      "query": "Q25",
      "regression": "0.50x (31ms -> 62ms)",
      "baseline_ms": 31,
      "transform": "prefetch_fact_join with 6 CTEs",
      "type": "CTE_OVERHEAD_ON_FAST_QUERY"
    },
    {
      "query": "Q90",
      "regression": "0.59x (16ms -> 27ms)",
      "baseline_ms": 16,
      "transform": "multi_dimension_prefetch with 4 CTEs + UNION ALL",
      "type": "CTE_OVERHEAD_ON_FAST_QUERY"
    },
    {
      "query": "Q16",
      "regression": "0.14x (18ms -> 126ms)",
      "baseline_ms": 18,
      "transform": "materialize_cte with 2 full-scan CTEs",
      "type": "CTE_OVERHEAD_ON_FAST_QUERY"
    }
  ],
  "constraint_rules": [
    {
      "rule": "CHECK_BASELINE_RUNTIME",
      "description": "If the Execution Plan shows estimated or actual runtime under 50ms, prefer minimal rewrites. DuckDB already optimizes simple star-join patterns efficiently."
    }
  ],
  "override_conditions": [
    "The transform reduces scan count (e.g., 3 scans â†’ 1 scan) even on a fast query",
    "The query is a component of a larger pipeline where cumulative savings matter",
    "The transform simplifies the query structure without adding CTEs (e.g., pushdown, decorrelate)"
  ],
  "prompt_instruction": "DEFAULT: If baseline is under 100ms, prefer minimal rewrites. CTE materialization overhead (hash tables, intermediate storage) can exceed filtering benefit on fast queries. HOWEVER: transforms that reduce scan count without adding CTEs (pushdown, decorrelate) may still help. The exploration worker MAY attempt structural changes on fast queries if the transform is scan-reducing, not CTE-adding."
}
