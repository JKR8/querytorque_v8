1. **Early filtering via predicate pushdown**: By joining `store` inside the CTE and filtering `s_state='SD'` before aggregation, we reduce the input to the GROUP BY from all store returns to only those 53 SD stores, significantly cutting aggregation cost.

2. **Window function eliminates correlated subquery**: The `AVG() OVER (PARTITION BY ctr_store_sk)` computes the per-store average in a single pass without requiring the CTE to be scanned twice or joined to itself. This avoids O(nÂ²) operations and materialization overhead.

3. **Reduced customer table access**: By filtering to qualifying customers (those exceeding 1.2x average) before the final join, we minimize the rows that must access the customer table, transforming the expensive 73% cost sequential scan into a more efficient join on a filtered result set.

4. **Explicit joins**: Converting comma joins to explicit JOIN syntax helps the optimizer better understand table relationships and select optimal join orders.