{
  "stats": {
    "total_iterations": 2,
    "tree_size": 3,
    "successful_expansions": 2,
    "failed_expansions": 0,
    "validation_calls": 2,
    "llm_ranking_calls": 3,
    "root_visits": 2,
    "total_attempts": 2
  },
  "attempts": [
    {
      "iteration": 1,
      "parent_path": [],
      "transform_id": "date_cte_isolate",
      "duration_ms": 32294,
      "llm_success": true,
      "llm_error": null,
      "sql_changed": true,
      "validated": true,
      "validation_status": "ValidationStatus.PASS",
      "validation_error": null,
      "speedup": 1.1439,
      "original_rows": 0,
      "optimized_rows": 0,
      "uct_score": 0.0,
      "parent_visits": 0,
      "reward": 1.1439,
      "output_sql": "WITH filtered_dates AS (\n  SELECT\n    d_date_sk\n  FROM date_dim\n  WHERE\n    d_year = 2001 AND d_qoy < 4\n)\nSELECT\n  ca_state,\n  cd_gender,\n  cd_marital_status,\n  cd_dep_count,\n  COUNT(*) AS cnt1,\n  MAX(cd_dep_count),\n  SUM(cd_dep_count),\n  MAX(cd_dep_count),\n  cd_dep_employed_count,\n  COUNT(*) AS cnt2,\n  MAX(cd_dep_employed_count),\n  SUM(cd_dep_employed_count),\n  MAX(cd_dep_employed_count),\n  cd_dep_college_count,\n  COUNT(*) AS cnt3,\n  MAX(cd_dep_college_count),\n  SUM(cd_dep_college_count),\n  MAX(cd_dep_college_count)\nFROM customer AS c, customer_address AS ca, customer_demographics\nWHERE\n  c.c_current_addr_sk = ca.ca_address_sk\n  AND cd_demo_sk = c.c_current_cdemo_sk\n  AND EXISTS(\n    SELECT\n      *\n    FROM store_sales\n    JOIN filtered_dates\n      ON ss_sold_date_sk = d_date_sk\n    WHERE\n      c.c_customer_sk = ss_customer_sk\n  )\n  AND (\n    EXISTS(\n      SELECT\n        *\n      FROM web_sales\n      JOIN filtered_dates\n        ON ws_sold_date_sk = d_date_sk\n      WHERE\n        c.c_customer_sk = ws_bill_customer_sk\n    )\n    OR EXISTS(\n      SELECT\n        *\n      FROM catalog_sales\n      JOIN filtered_dates\n        ON cs_sold_date_sk = d_date_sk\n      WHERE\n        c.c_customer_sk = cs_ship_customer_sk\n    )\n  )\nGROUP BY\n  ca_state,\n  cd_gender,\n  cd_marital_status,\n  cd_dep_count,\n  cd_dep_employed_count,\n  cd_dep_college_count\nORDER BY\n  ca_state,\n  cd_gender,\n  cd_marital_status,\n  cd_dep_count,\n  cd_dep_employed_count,\n  cd_dep_college_count\nLIMIT 100"
    },
    {
      "iteration": 2,
      "parent_path": [
        "date_cte_isolate"
      ],
      "transform_id": "flatten_subq",
      "duration_ms": 29793,
      "llm_success": true,
      "llm_error": null,
      "sql_changed": true,
      "validated": true,
      "validation_status": "ValidationStatus.PASS",
      "validation_error": null,
      "speedup": 2.8137,
      "original_rows": 0,
      "optimized_rows": 0,
      "uct_score": 0.0,
      "parent_visits": 1,
      "reward": 2.8137,
      "output_sql": "WITH filtered_dates AS (\n  SELECT\n    d_date_sk\n  FROM date_dim\n  WHERE\n    d_year = 2001 AND d_qoy < 4\n)\nSELECT\n  ca_state,\n  cd_gender,\n  cd_marital_status,\n  cd_dep_count,\n  COUNT(*) AS cnt1,\n  MAX(cd_dep_count),\n  SUM(cd_dep_count),\n  MAX(cd_dep_count),\n  cd_dep_employed_count,\n  COUNT(*) AS cnt2,\n  MAX(cd_dep_employed_count),\n  SUM(cd_dep_employed_count),\n  MAX(cd_dep_employed_count),\n  cd_dep_college_count,\n  COUNT(*) AS cnt3,\n  MAX(cd_dep_college_count),\n  SUM(cd_dep_college_count),\n  MAX(cd_dep_college_count)\nFROM customer AS c\nJOIN customer_address AS ca\n  ON c.c_current_addr_sk = ca.ca_address_sk\nJOIN customer_demographics AS cd\n  ON cd.cd_demo_sk = c.c_current_cdemo_sk\n/* Convert EXISTS for store_sales to SEMI JOIN */\nJOIN (\n  SELECT DISTINCT\n    ss_customer_sk\n  FROM store_sales\n  JOIN filtered_dates\n    ON ss_sold_date_sk = d_date_sk\n) AS ss\n  ON c.c_customer_sk = ss.ss_customer_sk\n/* Convert EXISTS for web_sales OR catalog_sales to LEFT JOIN with OR condition */\nLEFT JOIN (\n  SELECT DISTINCT\n    ws_bill_customer_sk\n  FROM web_sales\n  JOIN filtered_dates\n    ON ws_sold_date_sk = d_date_sk\n) AS ws\n  ON c.c_customer_sk = ws.ws_bill_customer_sk\nLEFT JOIN (\n  SELECT DISTINCT\n    cs_ship_customer_sk\n  FROM catalog_sales\n  JOIN filtered_dates\n    ON cs_sold_date_sk = d_date_sk\n) AS cs\n  ON c.c_customer_sk = cs.cs_ship_customer_sk\nWHERE\n  NOT ws.ws_bill_customer_sk IS NULL OR NOT cs.cs_ship_customer_sk IS NULL\nGROUP BY\n  ca_state,\n  cd_gender,\n  cd_marital_status,\n  cd_dep_count,\n  cd_dep_employed_count,\n  cd_dep_college_count\nORDER BY\n  ca_state,\n  cd_gender,\n  cd_marital_status,\n  cd_dep_count,\n  cd_dep_employed_count,\n  cd_dep_college_count\nLIMIT 100"
    }
  ],
  "selections": [
    {
      "node_path": [],
      "candidates": [
        {
          "transform_id": "push_pred",
          "uct_score": 0.1,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "reorder_join",
          "uct_score": 0.2,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "materialize_cte",
          "uct_score": 0.0333,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "inline_cte",
          "uct_score": 0.0333,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "flatten_subq",
          "uct_score": 0.5,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "remove_redundant",
          "uct_score": 0.0333,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "multi_push_pred",
          "uct_score": 0.0333,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "or_to_union",
          "uct_score": 0.3,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "correlated_to_cte",
          "uct_score": 0.0333,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "date_cte_isolate",
          "uct_score": 0.7,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "consolidate_scans",
          "uct_score": 0.0333,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        }
      ],
      "selected": "date_cte_isolate",
      "reason": "puct_action"
    },
    {
      "node_path": [],
      "candidates": [
        {
          "transform_id": "push_pred",
          "uct_score": 0.4243,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "reorder_join",
          "uct_score": 0.2828,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "materialize_cte",
          "uct_score": 0.0471,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "inline_cte",
          "uct_score": 0.0471,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "flatten_subq",
          "uct_score": 0.9899,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "remove_redundant",
          "uct_score": 0.1414,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "multi_push_pred",
          "uct_score": 0.0471,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "or_to_union",
          "uct_score": 0.7071,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "correlated_to_cte",
          "uct_score": 0.0471,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "date_cte_isolate",
          "uct_score": 1.1606,
          "visits": 1,
          "avg_reward": 1.1439,
          "is_valid": true,
          "speedup": 1.1439,
          "status": "tried"
        },
        {
          "transform_id": "consolidate_scans",
          "uct_score": 0.0471,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        }
      ],
      "selected": "date_cte_isolate",
      "reason": "puct_action"
    },
    {
      "node_path": [
        "date_cte_isolate"
      ],
      "candidates": [
        {
          "transform_id": "push_pred",
          "uct_score": 0.2828,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "reorder_join",
          "uct_score": 0.4243,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "materialize_cte",
          "uct_score": 0.0566,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "inline_cte",
          "uct_score": 0.0566,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "flatten_subq",
          "uct_score": 0.9899,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "remove_redundant",
          "uct_score": 0.1414,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "multi_push_pred",
          "uct_score": 0.0566,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "or_to_union",
          "uct_score": 0.7071,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "correlated_to_cte",
          "uct_score": 0.0566,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        },
        {
          "transform_id": "consolidate_scans",
          "uct_score": 0.0566,
          "visits": 0,
          "avg_reward": 0.0,
          "is_valid": false,
          "speedup": 1.0,
          "status": "untried"
        }
      ],
      "selected": "flatten_subq",
      "reason": "puct_action"
    }
  ],
  "tree": {
    "transforms": [],
    "depth": 0,
    "visits": 2,
    "avg_reward": 1.9788,
    "is_valid": false,
    "speedup": 1.0,
    "error": null,
    "children": {
      "date_cte_isolate": {
        "transforms": [
          "date_cte_isolate"
        ],
        "depth": 1,
        "visits": 2,
        "avg_reward": 1.9788,
        "is_valid": true,
        "speedup": 1.1439,
        "error": null,
        "children": {
          "flatten_subq": {
            "transforms": [
              "date_cte_isolate",
              "flatten_subq"
            ],
            "depth": 2,
            "visits": 1,
            "avg_reward": 2.8137,
            "is_valid": true,
            "speedup": 2.8137,
            "error": null
          }
        }
      }
    }
  }
}