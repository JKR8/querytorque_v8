{
  "query_num": 82,
  "status": "success",
  "original_sql": "-- start query 82 in stream 0 using template query82.tpl\nselect i_item_id\n       ,i_item_desc\n       ,i_current_price\n from item, inventory, date_dim, store_sales\n where i_current_price between 17 and 17+30\n and inv_item_sk = i_item_sk\n and d_date_sk=inv_date_sk\n and d_date between cast('1999-07-09' as date) and (cast('1999-07-09' as date) + INTERVAL 60 DAY)\n and i_manufact_id in (639,169,138,339)\n and inv_quantity_on_hand between 100 and 500\n and ss_item_sk = i_item_sk\n group by i_item_id,i_item_desc,i_current_price\n order by i_item_id\n LIMIT 100;\n\n-- end query 82 in stream 0 using template query82.tpl\n",
  "optimized_sql": "WITH filtered_item AS (SELECT i_item_sk, i_item_id, i_item_desc, i_current_price FROM item WHERE i_current_price BETWEEN 17 AND 17 + 30 AND i_manufact_id IN (639, 169, 138, 339)), filtered_inventory AS (SELECT inv_item_sk, inv_date_sk FROM inventory WHERE inv_quantity_on_hand BETWEEN 100 AND 500), filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-07-09' AS DATE) AND (CAST('1999-07-09' AS DATE) + INTERVAL '60' DAY)), filtered_sales AS (SELECT ss_item_sk FROM store_sales)\nSELECT i.i_item_id, i.i_item_desc, i.i_current_price FROM filtered_item AS i JOIN filtered_inventory AS inv ON i.i_item_sk = inv.inv_item_sk JOIN filtered_dates AS d ON inv.inv_date_sk = d.d_date_sk JOIN filtered_sales AS ss ON i.i_item_sk = ss.ss_item_sk GROUP BY i.i_item_id, i.i_item_desc, i.i_current_price ORDER BY i.i_item_id LIMIT 100",
  "raw_response": " ```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"early_filter\",\n      \"nodes\": {\n        \"filtered_item\": \"SELECT i_item_sk, i_item_id, i_item_desc, i_current_price FROM item WHERE i_current_price BETWEEN 17 AND 17 + 30 AND i_manufact_id IN (639, 169, 138, 339)\",\n        \"filtered_inventory\": \"SELECT inv_item_sk, inv_date_sk FROM inventory WHERE inv_quantity_on_hand BETWEEN 100 AND 500\",\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-07-09' AS DATE) AND (CAST('1999-07-09' AS DATE) + INTERVAL '60' DAY)\",\n        \"filtered_sales\": \"SELECT ss_item_sk FROM store_sales\",\n        \"main_query\": \"SELECT i.i_item_id, i.i_item_desc, i.i_current_price FROM filtered_item i JOIN filtered_inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN filtered_dates d ON inv.inv_date_sk = d.d_date_sk JOIN filtered_sales ss ON i.i_item_sk = ss.ss_item_sk GROUP BY i.i_item_id, i.i_item_desc, i.i_current_price ORDER BY i.i_item_id LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"output columns unchanged\",\n        \"same grouping and ordering\",\n        \"same limit\",\n        \"all join predicates preserved\"\n      ],\n      \"expected_speedup\": \"4.2x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Pushed selective predicates down to base tables before joins. Item filters (price range, manufacturer ID), inventory filter (quantity on hand), and date filter (60-day window) are applied in separate CTEs to reduce scan sizes. Projection pruning removes unused columns from intermediate results. Store_sales is projected to only the join key. This minimizes data movement through the join pipeline while preserving the exact semantics of the original query.\"\n}\n```",
  "error": null,
  "latency_ms": 301458.9336049976,
  "tokens_in": 1552,
  "tokens_out": 3909
}