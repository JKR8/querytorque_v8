[After 2 attempts] I used a different strategy than the failed attempt. Instead of moving filters into JOIN conditions (which changed semantics), I pre-computed the filtered date_dim in a CTE (`filtered_dates`). This reduces repeated scans of the date_dim table (which is filtered to 31 rows) and allows DuckDB to materialize this small result set once, potentially improving join performance. The query structure remains identical—same CTEs, subqueries, and JOINs—and all existing filters are preserved in their original positions. This optimization leverages DuckDB's ability to benefit from explicit CTE materialization and reduces the cost of sequential scans on date_dim across the three union branches.