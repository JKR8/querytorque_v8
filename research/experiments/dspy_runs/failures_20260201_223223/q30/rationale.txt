[After 2 attempts] Used a different strategy: kept the CTE unchanged (includes all states for correct subquery averages) but added explicit materialization (`MATERIALIZED`) to the CTE. This ensures the CTE is computed once and reused, avoiding recomputation in the subquery and main scan, which should improve performance given DuckDB's hints. The filter `ca_state = 'IN'` remains in the outer query only, preserving the original logic and avoiding the previous failure. This approach leverages DuckDB's optimization for materialized CTEs and parallel hash joins without restructuring the query or adding new conditions.