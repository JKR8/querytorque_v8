[After 3 attempts] Used a different strategy: 1) Maintained original grouping with ALL customer attributes (including c_preferred_cust_flag, c_login, c_email_address) to preserve correct aggregation, 2) Added WHERE d.d_year IN (1999, 2000) early to filter date_dim before joins, reducing data volume, 3) Used conditional aggregation (pivoting) to transform year_total CTE into columns for each sale_type/year combination, eliminating the need for 6 self-joins, 4) Applied business logic directly on pivoted columns, simplifying the WHERE clause. This approach reduces join complexity while maintaining the original query's semantics and correct row counts.