[After 2 attempts] Used a different strategy: instead of CTEs (which failed due to missing columns), I rewrote the query with explicit JOIN syntax and moved all filters to the WHERE clause. This maintains the original logic but structures it in a standard ANSI SQL format that may allow the optimizer to better apply predicate pushdown and reduce intermediate row counts early in the execution plan. The join conditions and filters are directly applied, avoiding the syntax error from the previous attempt. This approach leverages the existing row estimates (filtered scans) without introducing complex subqueries or CTEs.