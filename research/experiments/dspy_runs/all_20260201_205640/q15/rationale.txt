1. **Early date filtering**: Created a CTE `filtered_dates` to filter date_dim first (reducing to 91 rows), then joined early with catalog_sales to immediately reduce the large catalog_sales dataset by date constraints before other joins.
2. **OR condition decomposition**: The original WHERE clause had an OR condition across three different predicates (zip codes, states, price), which prevents efficient index usage and predicate pushdown. By splitting into three separate UNION ALL branches, each branch can be optimized independentlyâ€”potentially using indexes on ca_zip, ca_state, or cs_sales_price.
3. **Reduced join cardinality**: By filtering catalog_sales through date_dim first, we reduce the rows flowing into subsequent joins with customer and customer_address, lowering hash join costs.
4. **Maintained semantics**: UNION ALL ensures identical results as the original OR logic (since rows may satisfy multiple conditions, but duplicates are acceptable in aggregation due to GROUP BY on ca_zip).
5. **Potential for parallel execution**: The UNION ALL branches can be executed in parallel, leveraging modern database parallelism.