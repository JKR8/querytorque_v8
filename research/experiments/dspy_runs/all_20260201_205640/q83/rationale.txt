1. **Created reusable date filter**: The `date_filter` CTE computes the relevant `d_date_sk` values once (161 rows) instead of repeating the nested subquery three times. This eliminates redundant scans of the 73,049-row date_dim table.

2. **Simplified date logic**: Replaced the complex nested subqueries with a simple IN clause and DISTINCT to get unique date_sk values, reducing parsing and execution overhead.

3. **Improved join order**: By filtering dates first, we reduce the join size early. The date_filter CTE (161 rows) is small and can be efficiently joined with the returns tables.

4. **Maintained semantics**: The optimized query produces identical results by:
   - Using the same date values ('2001-06-06', '2001-09-02', '2001-11-11')
   - Preserving all aggregation and calculation logic
   - Maintaining the same join conditions and grouping

5. **Expected performance improvements**:
   - Reduced repeated date_dim scans from 3 to 1
   - Smaller intermediate results for joins
   - Simpler query structure for better optimizer decisions
   - Potential for better use of indexes if available on date_dim(d_date)