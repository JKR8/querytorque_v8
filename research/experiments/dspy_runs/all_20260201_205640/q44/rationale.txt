[After 2 attempts] Used a different strategy from the failed attempt: Instead of trying to compute both ranks in a single pass over the same items (which gave wrong results), I computed the threshold value once, then computed item aggregates once, and then created two separate ranking CTEs from the same aggregates. This maintains the original query's logic where ascending and descending rankings are computed independently, allowing different items to occupy the same rank position in each ordering. The optimization reduces redundant calculations by computing the threshold and item aggregates only once each, while preserving the correct result set of 10 rows.