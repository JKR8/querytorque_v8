1. **Replaced date filter with direct d_date_sk range**: The original OR conditions on d_year and d_moy are replaced with a BETWEEN clause on d_date_sk (2450815 to 2452654) based on row_estimates, enabling potential index usage and reducing predicate complexity.
2. **Used explicit JOIN syntax**: Improves readability and may help the optimizer.
3. **Replaced self-joins with LAG/LEAD**: The v2 subquery originally performed self-joins on v1 using rn arithmetic; using LAG and LEAD window functions eliminates multiple self-joins, reducing hash join operations and computational overhead.
4. **Simplified final WHERE clause**: Removed redundant `avg_monthly_sales > 0` check and consolidated the CASE expression into a direct mathematical condition, improving clarity and potential predicate pushdown.
5. **Maintained semantics**: All changes preserve the original query logic while targeting performance bottlenecks identified in the execution plan (window functions and hash operations).