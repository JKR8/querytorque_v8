Your previous witness data did NOT make the query return any rows.
Output ONLY corrected JSON (same format).

## Query analysis
TABLES:
  catalog_returns
  catalog_sales
  date_dim
  item
  store_returns
  store_sales
  web_returns
  web_sales

FILTERS:
  all_sales.sales_cnt > 0
  all_sales.d_year = 1999 - 1
  all_sales.d_year = 1999
  web_returns.wr_reason_sk IN (8, 18, 20, 23, 41)
  item.i_category = 'Children'
  ws_sales_price / ws_list_price BETWEEN 69 * 0.01 AND 89 * 0.01
  catalog_returns.cr_reason_sk IN (8, 18, 20, 23, 41)
  cs_sales_price / cs_list_price BETWEEN 69 * 0.01 AND 89 * 0.01
  store_returns.sr_reason_sk IN (8, 18, 20, 23, 41)
  ss_sales_price / ss_list_price BETWEEN 69 * 0.01 AND 89 * 0.01

AGGREGATES:
  GROUP BY: date_dim.d_year, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id

CTEs:
  all_sales:
    FROM: web_sales, item, date_dim, web_returns, catalog_sales, item, date_dim, catalog_returns, store_sales, item, date_dim, store_returns
    WHERE: item.i_category = 'Children', ws_sales_price / ws_list_price BETWEEN 69 * 0.01 AND 89 * 0.01
    GROUP BY: date_dim.d_year, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id
    OUTPUT: date_dim.d_year, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id, sales_cnt = SUM(sales_cnt), sales_amt = SUM(sales_amt)

NOTES:
  Division in filter: ws_sales_price / ws_list_price — denominator must be > 0
  Division in filter: ws_sales_price / ws_list_price — denominator must be > 0
  Division in filter: cs_sales_price / cs_list_price — denominator must be > 0
  Division in filter: ss_sales_price / ss_list_price — denominator must be > 0

COLUMNS NEEDED (table.column : type):
  catalog_returns: cr_reason_sk (INTEGER)
  catalog_sales: cs_list_price (DECIMAL(7), cs_sales_price (DECIMAL(7)
  date_dim: d_year (INTEGER)
  item: i_brand_id (INTEGER), i_category (VARCHAR), i_category_id (INTEGER), i_class_id (INTEGER), i_manufact_id (INTEGER)
  store_returns: sr_reason_sk (INTEGER)
  store_sales: ss_list_price (DECIMAL(7), ss_sales_price (DECIMAL(7)
  web_returns: wr_reason_sk (INTEGER)
  web_sales: ws_list_price (DECIMAL(7), ws_sales_price (DECIMAL(7)

## Feedback
Insert errors:
INSERT INTO catalog_returns (cr_reason_sk, cr_order_number, cr_item_sk, cr_return_quantity, cr_return_amount) VALUES (8,... -> Conversion Error: Could not convert string 'ORD1000' to INT32

LINE 1: ..., cr_item_sk, cr_return_quantity, cr_return_amount) VALUES (8, 'ORD1000', 1000, 0, 0.0);
                                                                          ^
INSERT INTO catalog_returns (cr_reason_sk, cr_order_number, cr_item_sk, cr_return_quantity, cr_return_amount) VALUES (8,... -> Conversion Error: Could not convert string 'ORD1001' to INT32

LINE 1: ..., cr_item_sk, cr_return_quantity, cr_return_amount) VALUES (8, 'ORD1001', 1001, 0, 0.0);
                                                                          ^
INSERT INTO catalog_returns (cr_reason_sk, cr_order_number, cr_item_sk, cr_return_quantity, cr_return_amount) VALUES (8,... -> Conversion Error: Could not convert string 'ORD1002' to INT32

LINE 1: ..., cr_item_sk, cr_return_quantity, cr_return_amount) VALUES (8, 'ORD1002', 1002, 0, 0.0);
                                                                          ^
INSERT INTO catalog_returns (cr_reason_sk, cr_order_number, cr_item_sk, cr_return_quantity, cr_return_amount) VALUES (8,... -> Conversion Error: Could not convert string 'ORD1003' to INT32

LINE 1: ..., cr_item_sk, cr_return_quantity, cr_return_amount) VALUES (8, 'ORD1003', 1003, 0, 0.0);
                                                                          ^
INSERT INTO catalog_sales (cs_item_sk, cs_sold_date_sk, cs_order_number, cs_quantity, cs_list_price, cs_sales_price, cs_... -> Conversion Error: Could not convert string 'ORD1000' to INT32

LINE 1: ..., cs_sales_price, cs_ext_sales_price) VALUES (1000, 2000, 'ORD1000', 10, 100.0, 80.0, 800.0);
                                                                     ^
INSERT INTO catalog_sales (cs_item_sk, cs_sold_date_sk, cs_order_number, cs_quantity, cs_list_price, cs_sales_price, cs_... -> Conversion Error: Could not convert string 'ORD1001' to INT32

LINE 1: ..., cs_sales_price, cs_ext_sales_price) VALUES (1001, 2001, 'ORD1001', 8, 100.0, 80.0, 640.0);
                                                                     ^
INSERT INTO catalog_sales (cs_item_sk, cs_sold_date_sk, cs_order_number, cs_quantity, cs_list_price, cs_sales_price, cs_... -> Conversion Error: Could not convert string 'ORD1002' to INT32

LINE 1: ..., cs_sales_price, cs_ext_sales_price) VALUES (1002, 2000, 'ORD1002', 10, 100.0, 80.0, 800.0);
                                                                     ^
INSERT INTO catalog_sales (cs_item_sk, cs_sold_date_sk, cs_order_number, cs_quantity, cs_list_price, cs_sales_price, cs_... -> Conversion Error: Could not convert string 'ORD1003' to INT32

LINE 1: ..., cs_sales_price, cs_ext_sales_price) VALUES (1003, 2001, 'ORD1003', 8, 100.0, 80.0, 640.0);
                                                                     ^

Table/CTE diagnostics:
Table catalog_returns is EMPTY — needs rows
Table catalog_sales is EMPTY — needs rows
Table date_dim: 2 rows
Table item: 4 rows
Table store_returns is EMPTY — needs rows
Table store_sales is EMPTY — needs rows
Table web_returns is EMPTY — needs rows
Table web_sales is EMPTY — needs rows
CTE 'all_sales': 0 rows
  -> CTE returns 0 rows! Check join keys and WHERE filters.

## Your previous data
{
  "reasoning": "We need at least 2 rows from the final query. The query joins all_sales CTE for curr_yr (d_year=1999) and prev_yr (d_year=1998) on brand, class, category, manufacturer. Need prev_yr.sales_cnt > 0 and curr_yr.sales_cnt / prev_yr.sales_cnt < 0.9. So we need at least two groups (brand, class, category, manufacturer) that satisfy these conditions. We'll create two groups with same brand, class, category, manufacturer IDs but different d_year (1998 and 1999). For each group, we need sales_cnt values such that prev_yr.sales_cnt > 0 and curr_yr.sales_cnt < 0.9 * prev_yr.sales_cnt. Choose prev_yr.sales_cnt = 10, curr_yr.sales_cnt = 8 (8/10=0.8<0.9). To generate these sales_cnt in CTE, we need underlying rows from catalog_sales, store_sales, or web_sales with appropriate filters. We'll use catalog_sales for simplicity. Need item.i_category='Children', cs_sales_price/cs_list_price between 0.69 and 0.89, cr_reason_sk in (8,18,20,23,41). We'll create two items (same brand/class/category/manufacturer), two date_dim rows (d_year 1998 and 1999). For each item and year, create catalog_sales row with cs_quantity=10 (for prev_yr) and cs_quantity=8 (for curr_yr) and matching catalog_returns row with cr_return_quantity=0 so sales_cnt = cs_quantity - 0 = cs_quantity. Ensure cs_sales_price/cs_list_price ratio in range: set cs_list_price=100, cs_sales_price=80 (ratio=0.8). Also need cr_reason_sk in allowed set (choose 8). For prev_yr (1998) we need sales_cnt>0, so cs_quantity=10. For curr_yr (1999) cs_quantity=8. We'll create two groups: Group A with (i_brand_id=1000, i_class_id=1000, i_category_id=1000, i_manufact_id=1000) and Group B with (i_brand_id=1001, i_class_id=1001, i_category_id=1001, i_manufact_id=1001). Each group will have rows for 1998 and 1999. This yields two rows in final result.",
  "tables": {
    "catalog_returns": {
      "columns": [
        "cr_reason_sk",
        "cr_order_number",
        "cr_item_sk",
        "cr_return_quantity",
        "cr_return_amount"
      ],
      "rows": [
        [
          8,
          "ORD1000",
          1000,
          0,
          0.0
        ],
        [
          8,
          "ORD1001",
          1001,
          0,
          0.0
        ],
        [
          8,
          "ORD1002",
          1002,
          0,
          0.0
        ],
        [
          8,
          "ORD1003",
          1003,
          0,
          0.0
        ]
      ]
    },
    "catalog_sales": {
      "columns": [
        "cs_item_sk",
        "cs_sold_date_sk",
        "cs_order_number",
        "cs_quantity",
        "cs_list_price",
        "cs_sales_price",
        "cs_ext_sales_price"
      ],
      "rows": [
        [
          1000,
          2000,
          "ORD1000",
          10,
          100.0,
          80.0,
          800.0
        ],
        [
          1001,
          2001,
          "ORD1001",
          8,
          100.0,
          80.0,
          640.0
        ],
        [
          1002,
          2000,
          "ORD1002",
          10,
          100.0,
          80.0,
          800.0
        ],
        [
          1003,
          2001,
          "ORD1003",
          8,
          100.0,
          80.0,
          640.0
        ]
      ]
    },
    "date_dim": {
      "columns": [
        "d_date_sk",
        "d_year"
      ],
      "rows": [
        [
          2000,
          1998
        ],
        [
          2001,
          1999
        ]
      ]
    },
    "item": {
      "columns": [
        "i_item_sk",
        "i_brand_id",
        "i_class_id",
        "i_category_id",
        "i_manufact_id",
        "i_category"
      ],
      "rows": [
        [
          1000,
          1000,
          1000,
          1000,
          1000,
          "Children"
        ],
        [
          1001,
          1000,
          1000,
          1000,
          1000,
          "Children"
        ],
        [
          1002,
          1001,
          1001,
          1001,
          1001,
          "Children"
        ],
        [
          1003,
          1001,
          1001,
          1001,
          1001,
          "Children"
        ]
      ]
    },
    "store_returns": {
      "columns": [
        "sr_reason_sk"
      ],
      "rows": []
    },
    "store_sales": {
      "columns": [
        "ss_list_price",
        "ss_sales_price"
      ],
      "rows": []
    },
    "web_returns": {
      "columns": [
        "wr_reason_sk"
      ],
      "rows": []
    },
    "web_sales": {
      "columns": [
        "ws_list_price",
        "ws_sales_price"
      ],
      "rows": []
    }
  }
}

## SQL
WITH all_sales AS (
 SELECT d_year
       ,i_brand_id
       ,i_class_id
       ,i_category_id
       ,i_manufact_id
       ,SUM(sales_cnt) AS sales_cnt
       ,SUM(sales_amt) AS sales_amt
 FROM (SELECT d_year
             ,i_brand_id
             ,i_class_id
             ,i_category_id
             ,i_manufact_id
             ,cs_quantity - COALESCE(cr_return_quantity,0) AS sales_cnt
             ,cs_ext_sales_price - COALESCE(cr_return_amount,0.0) AS sales_amt
       FROM catalog_sales JOIN item ON i_item_sk=cs_item_sk
                          JOIN date_dim ON d_date_sk=cs_sold_date_sk
                          LEFT JOIN catalog_returns ON (cs_order_number=cr_order_number
                                                    AND cs_item_sk=cr_item_sk)
       WHERE i_category='Children'
       and cs_sales_price / cs_list_price BETWEEN 69 * 0.01 AND 89 * 0.01
       and cr_reason_sk in (8, 18, 20, 23, 41)
       UNION
       SELECT d_year
             ,i_brand_id
             ,i_class_id
             ,i_category_id
             ,i_manufact_id
             ,ss_quantity - COALESCE(sr_return_quantity,0) AS sales_cnt
             ,ss_ext_sales_price - COALESCE(sr_return_amt,0.0) AS sales_amt
       FROM store_sales JOIN item ON i_item_sk=ss_item_sk
                        JOIN date_dim ON d_date_sk=ss_sold_date_sk
                        LEFT JOIN store_returns ON (ss_ticket_number=sr_ticket_number
                                                AND ss_item_sk=sr_item_sk)
       WHERE i_category='Children'
       and ss_sales_price / ss_list_price BETWEEN 69 * 0.01 AND 89 * 0.01
       and sr_reason_sk in (8, 18, 20, 23, 41)
       UNION
       SELECT d_year
             ,i_brand_id
             ,i_class_id
             ,i_category_id
             ,i_manufact_id
             ,ws_quantity - COALESCE(wr_return_quantity,0) AS sales_cnt
             ,ws_ext_sales_price - COALESCE(wr_return_amt,0.0) AS sales_amt
       FROM web_sales JOIN item ON i_item_sk=ws_item_sk
                      JOIN date_dim ON d_date_sk=ws_sold_date_sk
                      LEFT JOIN web_returns ON (ws_order_number=wr_order_number
                                            AND ws_item_sk=wr_item_sk)
       WHERE i_category='Children'
       and ws_sales_price / ws_list_price BETWEEN 69 * 0.01 AND 89 * 0.01
       and wr_reason_sk in (8, 18, 20, 23, 41)) sales_detail
GROUP BY d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id)
 SELECT  prev_yr.d_year AS prev_year
                          ,curr_yr.d_year AS year
                          ,curr_yr.i_brand_id
                          ,curr_yr.i_class_id
                          ,curr_yr.i_category_id
                          ,curr_yr.i_manufact_id
                          ,prev_yr.sales_cnt AS prev_yr_cnt
                          ,curr_yr.sales_cnt AS curr_yr_cnt
                          ,curr_yr.sales_cnt-prev_yr.sales_cnt AS sales_cnt_diff
                          ,curr_yr.sales_amt-prev_yr.sales_amt AS sales_amt_diff
 FROM all_sales curr_yr, all_sales prev_yr
 WHERE curr_yr.i_brand_id=prev_yr.i_brand_id
   AND curr_yr.i_class_id=prev_yr.i_class_id
   AND curr_yr.i_category_id=prev_yr.i_category_id
   AND curr_yr.i_manufact_id=prev_yr.i_manufact_id
   AND curr_yr.d_year=1999
   AND prev_yr.d_year=1999-1
   AND prev_yr.sales_cnt > 0
   AND CAST(curr_yr.sales_cnt AS DECIMAL(17,2))/CAST(prev_yr.sales_cnt AS DECIMAL(17,2))<0.9
 ORDER BY sales_cnt_diff,sales_amt_diff
 limit 100;


Common mistakes:
- Missing FK rows (every _sk join needs matching rows on BOTH sides)
- Aggregate math wrong (need value > avg*1.2 but only 1 row per group = impossible)
- Division by zero (denominator columns must be > 0)
- Date or string values don't match FILTERS exactly
