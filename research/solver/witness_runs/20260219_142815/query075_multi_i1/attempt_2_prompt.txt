Your previous witness data did NOT make the query return any rows.
Output ONLY corrected JSON (same format).

## Query analysis
TABLES:
  catalog_returns
  catalog_sales
  date_dim
  item
  store_returns
  store_sales
  web_returns
  web_sales

FILTERS:
  all_sales.sales_cnt > 0
  all_sales.d_year = 1999 - 1
  all_sales.d_year = 1999
  web_returns.wr_reason_sk IN (7, 25, 26, 52, 69)
  item.i_category = 'Home'
  ws_sales_price / ws_list_price BETWEEN 34 * 0.01 AND 54 * 0.01
  catalog_returns.cr_reason_sk IN (7, 25, 26, 52, 69)
  cs_sales_price / cs_list_price BETWEEN 34 * 0.01 AND 54 * 0.01
  store_returns.sr_reason_sk IN (7, 25, 26, 52, 69)
  ss_sales_price / ss_list_price BETWEEN 34 * 0.01 AND 54 * 0.01

AGGREGATES:
  GROUP BY: date_dim.d_year, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id

CTEs:
  all_sales:
    FROM: web_sales, item, date_dim, web_returns, catalog_sales, item, date_dim, catalog_returns, store_sales, item, date_dim, store_returns
    WHERE: item.i_category = 'Home', ws_sales_price / ws_list_price BETWEEN 34 * 0.01 AND 54 * 0.01
    GROUP BY: date_dim.d_year, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id
    OUTPUT: date_dim.d_year, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id, sales_cnt = SUM(sales_cnt), sales_amt = SUM(sales_amt)

NOTES:
  Division in filter: ws_sales_price / ws_list_price — denominator must be > 0
  Division in filter: ws_sales_price / ws_list_price — denominator must be > 0
  Division in filter: cs_sales_price / cs_list_price — denominator must be > 0
  Division in filter: ss_sales_price / ss_list_price — denominator must be > 0

COLUMNS NEEDED (table.column : type):
  catalog_returns: cr_reason_sk (INTEGER)
  catalog_sales: cs_list_price (DECIMAL(7), cs_sales_price (DECIMAL(7)
  date_dim: d_year (INTEGER)
  item: i_brand_id (INTEGER), i_category (VARCHAR), i_category_id (INTEGER), i_class_id (INTEGER), i_manufact_id (INTEGER)
  store_returns: sr_reason_sk (INTEGER)
  store_sales: ss_list_price (DECIMAL(7), ss_sales_price (DECIMAL(7)
  web_returns: wr_reason_sk (INTEGER)
  web_sales: ws_list_price (DECIMAL(7), ws_sales_price (DECIMAL(7)

## Feedback
Table/CTE diagnostics:
Table catalog_returns: 2 rows
Table catalog_sales: 2 rows
Table date_dim: 2 rows
Table item: 2 rows
Table store_returns: 2 rows
Table store_sales: 2 rows
Table web_returns: 2 rows
Table web_sales: 2 rows
CTE 'all_sales': 0 rows
  -> CTE returns 0 rows! Check join keys and WHERE filters.

No SQL errors, but query returned 0 rows. The data satisfied the schema but NOT the query logic. Check: join FK matches, WHERE filter values, aggregate math.

## Your previous data
{
  "reasoning": "Need at least 2 rows in final output. The query joins all_sales CTE for year 1999 and 1998 (1999-1) on same brand/class/category/manufacturer. Need sales_cnt > 0 for 1998 and curr_yr.sales_cnt/prev_yr.sales_cnt < 0.9. Create two groups with same brand/class/category/manufacturer IDs but different years. For group 1: 1998 sales_cnt = 100, 1999 sales_cnt = 80 (80/100=0.8<0.9). For group 2: 1998 sales_cnt = 200, 1999 sales_cnt = 150 (150/200=0.75<0.9). Need underlying data from three UNION sources with appropriate filters: i_category='Home', price ratios between 0.34-0.54, reason_sk in (7,25,26,52,69). Use same item IDs across all sales types to ensure grouping works.",
  "tables": {
    "catalog_returns": {
      "columns": [
        "cr_reason_sk"
      ],
      "rows": [
        [
          7
        ],
        [
          25
        ]
      ]
    },
    "catalog_sales": {
      "columns": [
        "cs_list_price",
        "cs_sales_price"
      ],
      "rows": [
        [
          100.0,
          40.0
        ],
        [
          200.0,
          80.0
        ]
      ]
    },
    "date_dim": {
      "columns": [
        "d_year"
      ],
      "rows": [
        [
          1998
        ],
        [
          1999
        ]
      ]
    },
    "item": {
      "columns": [
        "i_brand_id",
        "i_category",
        "i_category_id",
        "i_class_id",
        "i_manufact_id"
      ],
      "rows": [
        [
          1000,
          "Home",
          1,
          1,
          1
        ],
        [
          1001,
          "Home",
          2,
          2,
          2
        ]
      ]
    },
    "store_returns": {
      "columns": [
        "sr_reason_sk"
      ],
      "rows": [
        [
          26
        ],
        [
          52
        ]
      ]
    },
    "store_sales": {
      "columns": [
        "ss_list_price",
        "ss_sales_price"
      ],
      "rows": [
        [
          100.0,
          40.0
        ],
        [
          200.0,
          80.0
        ]
      ]
    },
    "web_returns": {
      "columns": [
        "wr_reason_sk"
      ],
      "rows": [
        [
          69
        ],
        [
          7
        ]
      ]
    },
    "web_sales": {
      "columns": [
        "ws_list_price",
        "ws_sales_price"
      ],
      "rows": [
        [
          100.0,
          40.0
        ],
        [
          200.0,
          80.0
        ]
      ]
    }
  }
}

## SQL
WITH all_sales AS (
 SELECT d_year
       ,i_brand_id
       ,i_class_id
       ,i_category_id
       ,i_manufact_id
       ,SUM(sales_cnt) AS sales_cnt
       ,SUM(sales_amt) AS sales_amt
 FROM (SELECT d_year
             ,i_brand_id
             ,i_class_id
             ,i_category_id
             ,i_manufact_id
             ,cs_quantity - COALESCE(cr_return_quantity,0) AS sales_cnt
             ,cs_ext_sales_price - COALESCE(cr_return_amount,0.0) AS sales_amt
       FROM catalog_sales JOIN item ON i_item_sk=cs_item_sk
                          JOIN date_dim ON d_date_sk=cs_sold_date_sk
                          LEFT JOIN catalog_returns ON (cs_order_number=cr_order_number
                                                    AND cs_item_sk=cr_item_sk)
       WHERE i_category='Home'
       and cs_sales_price / cs_list_price BETWEEN 34 * 0.01 AND 54 * 0.01
       and cr_reason_sk in (7, 25, 26, 52, 69)
       UNION
       SELECT d_year
             ,i_brand_id
             ,i_class_id
             ,i_category_id
             ,i_manufact_id
             ,ss_quantity - COALESCE(sr_return_quantity,0) AS sales_cnt
             ,ss_ext_sales_price - COALESCE(sr_return_amt,0.0) AS sales_amt
       FROM store_sales JOIN item ON i_item_sk=ss_item_sk
                        JOIN date_dim ON d_date_sk=ss_sold_date_sk
                        LEFT JOIN store_returns ON (ss_ticket_number=sr_ticket_number
                                                AND ss_item_sk=sr_item_sk)
       WHERE i_category='Home'
       and ss_sales_price / ss_list_price BETWEEN 34 * 0.01 AND 54 * 0.01
       and sr_reason_sk in (7, 25, 26, 52, 69)
       UNION
       SELECT d_year
             ,i_brand_id
             ,i_class_id
             ,i_category_id
             ,i_manufact_id
             ,ws_quantity - COALESCE(wr_return_quantity,0) AS sales_cnt
             ,ws_ext_sales_price - COALESCE(wr_return_amt,0.0) AS sales_amt
       FROM web_sales JOIN item ON i_item_sk=ws_item_sk
                      JOIN date_dim ON d_date_sk=ws_sold_date_sk
                      LEFT JOIN web_returns ON (ws_order_number=wr_order_number
                                            AND ws_item_sk=wr_item_sk)
       WHERE i_category='Home'
       and ws_sales_price / ws_list_price BETWEEN 34 * 0.01 AND 54 * 0.01
       and wr_reason_sk in (7, 25, 26, 52, 69)) sales_detail
GROUP BY d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id)
 SELECT  prev_yr.d_year AS prev_year
                          ,curr_yr.d_year AS year
                          ,curr_yr.i_brand_id
                          ,curr_yr.i_class_id
                          ,curr_yr.i_category_id
                          ,curr_yr.i_manufact_id
                          ,prev_yr.sales_cnt AS prev_yr_cnt
                          ,curr_yr.sales_cnt AS curr_yr_cnt
                          ,curr_yr.sales_cnt-prev_yr.sales_cnt AS sales_cnt_diff
                          ,curr_yr.sales_amt-prev_yr.sales_amt AS sales_amt_diff
 FROM all_sales curr_yr, all_sales prev_yr
 WHERE curr_yr.i_brand_id=prev_yr.i_brand_id
   AND curr_yr.i_class_id=prev_yr.i_class_id
   AND curr_yr.i_category_id=prev_yr.i_category_id
   AND curr_yr.i_manufact_id=prev_yr.i_manufact_id
   AND curr_yr.d_year=1999
   AND prev_yr.d_year=1999-1
   AND prev_yr.sales_cnt > 0
   AND CAST(curr_yr.sales_cnt AS DECIMAL(17,2))/CAST(prev_yr.sales_cnt AS DECIMAL(17,2))<0.9
 ORDER BY sales_cnt_diff,sales_amt_diff
 limit 100;


Common mistakes:
- Missing FK rows (every _sk join needs matching rows on BOTH sides)
- Aggregate math wrong (need value > avg*1.2 but only 1 row per group = impossible)
- Division by zero (denominator columns must be > 0)
- Date or string values don't match FILTERS exactly
