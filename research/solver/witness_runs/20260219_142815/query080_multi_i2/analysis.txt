TABLES:
  catalog_page
  catalog_returns
  catalog_sales
  date_dim
  item
  promotion
  store
  store_returns
  store_sales
  web_returns
  web_sales
  web_site

JOINS:
  store_sales.ss_promo_sk = promotion.p_promo_sk
  store_sales.ss_item_sk = item.i_item_sk
  store_sales.ss_store_sk = store.s_store_sk
  store_sales.ss_sold_date_sk = date_dim.d_date_sk
  catalog_sales.cs_promo_sk = promotion.p_promo_sk
  catalog_sales.cs_item_sk = item.i_item_sk
  catalog_sales.cs_catalog_page_sk = catalog_page.cp_catalog_page_sk
  catalog_sales.cs_sold_date_sk = date_dim.d_date_sk
  web_sales.ws_promo_sk = promotion.p_promo_sk
  web_sales.ws_item_sk = item.i_item_sk
  web_sales.ws_web_site_sk = web_site.web_site_sk
  web_sales.ws_sold_date_sk = date_dim.d_date_sk

FILTERS:
  item.i_category IN ('Men', 'Music')
  store_sales.ss_wholesale_cost BETWEEN 21 AND 36
  promotion.p_channel_event = 'N'
  promotion.p_channel_press = 'N'
  promotion.p_channel_radio = 'N'
  promotion.p_channel_tv = 'N'
  promotion.p_channel_email = 'Y'
  item.i_current_price > 50
  date_dim.d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30' DAY
  catalog_sales.cs_wholesale_cost BETWEEN 21 AND 36
  web_sales.ws_wholesale_cost BETWEEN 21 AND 36

AGGREGATES:
  GROUP BY: store.s_store_id
  GROUP BY: catalog_page.cp_catalog_page_id
  GROUP BY: web_site.web_site_id

CTEs:
  ssr:
    FROM: store_sales, store_returns, date_dim, store, item, promotion
    WHERE: store_sales.ss_wholesale_cost BETWEEN 21 AND 36, promotion.p_channel_event = 'N', promotion.p_channel_press = 'N', promotion.p_channel_radio = 'N', promotion.p_channel_tv = 'N', promotion.p_channel_email = 'Y', store_sales.ss_promo_sk = promotion.p_promo_sk (JOIN), store_sales.ss_item_sk = item.i_item_sk (JOIN), store_sales.ss_store_sk = store.s_store_sk (JOIN), store_sales.ss_sold_date_sk = date_dim.d_date_sk (JOIN), date_dim.d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30' DAY
    GROUP BY: store.s_store_id
    OUTPUT: store_id = store.s_store_id, sales = SUM(ss_ext_sales_price), returns = SUM(COALESCE(sr_return_amt, 0)), profit = SUM(ss_net_profit - COALESCE(sr_net_loss, 0))
  csr:
    FROM: catalog_sales, catalog_returns, date_dim, catalog_page, item, promotion
    WHERE: catalog_sales.cs_wholesale_cost BETWEEN 21 AND 36, promotion.p_channel_event = 'N', promotion.p_channel_press = 'N', promotion.p_channel_radio = 'N', promotion.p_channel_tv = 'N', promotion.p_channel_email = 'Y', catalog_sales.cs_promo_sk = promotion.p_promo_sk (JOIN), catalog_sales.cs_item_sk = item.i_item_sk (JOIN), catalog_sales.cs_catalog_page_sk = catalog_page.cp_catalog_page_sk (JOIN), catalog_sales.cs_sold_date_sk = date_dim.d_date_sk (JOIN), date_dim.d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30' DAY
    GROUP BY: catalog_page.cp_catalog_page_id
    OUTPUT: catalog_page_id = catalog_page.cp_catalog_page_id, sales = SUM(cs_ext_sales_price), returns = SUM(COALESCE(cr_return_amount, 0)), profit = SUM(cs_net_profit - COALESCE(cr_net_loss, 0))
  wsr:
    FROM: web_sales, web_returns, date_dim, web_site, item, promotion
    WHERE: web_sales.ws_wholesale_cost BETWEEN 21 AND 36, promotion.p_channel_event = 'N', promotion.p_channel_press = 'N', promotion.p_channel_radio = 'N', promotion.p_channel_tv = 'N', promotion.p_channel_email = 'Y', web_sales.ws_promo_sk = promotion.p_promo_sk (JOIN), web_sales.ws_item_sk = item.i_item_sk (JOIN), web_sales.ws_web_site_sk = web_site.web_site_sk (JOIN), web_sales.ws_sold_date_sk = date_dim.d_date_sk (JOIN), date_dim.d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30' DAY
    GROUP BY: web_site.web_site_id
    OUTPUT: web_site.web_site_id, sales = SUM(ws_ext_sales_price), returns = SUM(COALESCE(wr_return_amt, 0)), profit = SUM(ws_net_profit - COALESCE(wr_net_loss, 0))

COLUMNS NEEDED (table.column : type):
  catalog_page: cp_catalog_page_id (VARCHAR), cp_catalog_page_sk (INTEGER)
  catalog_returns: cr_net_loss (DECIMAL(7), cr_return_amount (DECIMAL(7)
  catalog_sales: cs_catalog_page_sk (INTEGER), cs_ext_sales_price (DECIMAL(7), cs_item_sk (INTEGER), cs_net_profit (DECIMAL(7), cs_promo_sk (INTEGER), cs_sold_date_sk (INTEGER), cs_wholesale_cost (DECIMAL(7)
  date_dim: d_date (DATE), d_date_sk (INTEGER)
  item: i_category (VARCHAR), i_current_price (DECIMAL(7), i_item_sk (INTEGER)
  promotion: p_channel_email (VARCHAR), p_channel_event (VARCHAR), p_channel_press (VARCHAR), p_channel_radio (VARCHAR), p_channel_tv (VARCHAR), p_promo_sk (INTEGER)
  store: s_store_id (VARCHAR), s_store_sk (INTEGER)
  store_returns: sr_net_loss (DECIMAL(7), sr_return_amt (DECIMAL(7)
  store_sales: ss_ext_sales_price (DECIMAL(7), ss_item_sk (INTEGER), ss_net_profit (DECIMAL(7), ss_promo_sk (INTEGER), ss_sold_date_sk (INTEGER), ss_store_sk (INTEGER), ss_wholesale_cost (DECIMAL(7)
  web_returns: wr_net_loss (DECIMAL(7), wr_return_amt (DECIMAL(7)
  web_sales: ws_ext_sales_price (DECIMAL(7), ws_item_sk (INTEGER), ws_net_profit (DECIMAL(7), ws_promo_sk (INTEGER), ws_sold_date_sk (INTEGER), ws_web_site_sk (INTEGER), ws_wholesale_cost (DECIMAL(7)
  web_site: web_site_id (VARCHAR), web_site_sk (INTEGER)