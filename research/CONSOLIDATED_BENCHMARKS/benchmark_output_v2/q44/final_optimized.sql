WITH store_avg_profit AS (SELECT AVG(ss_net_profit) AS store_avg_net_profit FROM store_sales WHERE ss_store_sk = 146 AND ss_addr_sk IS NULL GROUP BY ss_store_sk), item_performance AS (SELECT ss_item_sk AS item_sk, AVG(ss_net_profit) AS avg_net_profit FROM store_sales WHERE ss_store_sk = 146 GROUP BY ss_item_sk HAVING AVG(ss_net_profit) > 0.9 * (SELECT store_avg_net_profit FROM store_avg_profit)), ascending_ranks AS (SELECT item_sk, RANK() OVER (ORDER BY avg_net_profit ASC) AS rnk FROM item_performance WHERE rnk < 11), descending_ranks AS (SELECT item_sk, RANK() OVER (ORDER BY avg_net_profit DESC) AS rnk FROM item_performance WHERE rnk < 11)
SELECT asceding.rnk, i1.i_product_name AS best_performing, i2.i_product_name AS worst_performing FROM ascending_ranks AS asceding JOIN descending_ranks AS descending ON asceding.rnk = descending.rnk JOIN item AS i1 ON asceding.item_sk = i1.i_item_sk JOIN item AS i2 ON descending.item_sk = i2.i_item_sk ORDER BY asceding.rnk LIMIT 100