```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2000-2-01' AND (CAST('2000-2-01' AS DATE) + INTERVAL '60' DAY)",
        "filtered_addresses": "SELECT ca_address_sk FROM customer_address WHERE ca_state = 'OK'",
        "filtered_websites": "SELECT web_site_sk FROM web_site WHERE web_company_name = 'pri'",
        "filtered_sales": "SELECT ws_order_number, ws_ext_ship_cost, ws_net_profit, ws_warehouse_sk FROM web_sales ws1 JOIN filtered_dates ON ws1.ws_ship_date_sk = filtered_dates.d_date_sk JOIN filtered_addresses ON ws1.ws_ship_addr_sk = filtered_addresses.ca_address_sk JOIN filtered_websites ON ws1.ws_web_site_sk = filtered_websites.web_site_sk",
        "multi_warehouse_orders": "SELECT ws_order_number FROM web_sales GROUP BY ws_order_number HAVING COUNT(DISTINCT ws_warehouse_sk) > 1",
        "returned_orders": "SELECT DISTINCT wr_order_number FROM web_returns",
        "main_query": "SELECT COUNT(DISTINCT ws_order_number) AS \"order count\", SUM(ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws_net_profit) AS \"total net profit\" FROM filtered_sales ws1 WHERE EXISTS (SELECT 1 FROM multi_warehouse_orders mwo WHERE ws1.ws_order_number = mwo.ws_order_number) AND NOT EXISTS (SELECT 1 FROM returned_orders ro WHERE ws1.ws_order_number = ro.wr_order_number) ORDER BY COUNT(DISTINCT ws_order_number) LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same output columns",
        "same aggregation logic"
      ],
      "expected_speedup": "2.5x",
      "risk": "low"
    },
    {
      "id": "rs_02",
      "transform": "decorrelate",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2000-2-01' AND (CAST('2000-2-01' AS DATE) + INTERVAL '60' DAY)",
        "filtered_addresses": "SELECT ca_address_sk FROM customer_address WHERE ca_state = 'OK'",
        "filtered_websites": "SELECT web_site_sk FROM web_site WHERE web_company_name = 'pri'",
        "candidate_sales": "SELECT ws_order_number, ws_ext_ship_cost, ws_net_profit, ws_warehouse_sk FROM web_sales ws1 JOIN filtered_dates ON ws1.ws_ship_date_sk = filtered_dates.d_date_sk JOIN filtered_addresses ON ws1.ws_ship_addr_sk = filtered_addresses.ca_address_sk JOIN filtered_websites ON ws1.ws_web_site_sk = filtered_websites.web_site_sk",
        "warehouse_variants": "SELECT ws_order_number FROM web_sales ws2 GROUP BY ws_order_number HAVING COUNT(DISTINCT ws_warehouse_sk) > 1",
        "sales_without_returns": "SELECT ws_order_number FROM candidate_sales cs WHERE NOT EXISTS (SELECT 1 FROM web_returns wr WHERE cs.ws_order_number = wr.wr_order_number)",
        "main_query": "SELECT COUNT(DISTINCT cs.ws_order_number) AS \"order count\", SUM(cs.ws_ext_ship_cost) AS \"total shipping cost\", SUM(cs.ws_net_profit) AS \"total net profit\" FROM candidate_sales cs JOIN warehouse_variants wv ON cs.ws_order_number = wv.ws_order_number WHERE NOT EXISTS (SELECT 1 FROM web_returns wr WHERE cs.ws_order_number = wr.wr_order_number) ORDER BY COUNT(DISTINCT cs.ws_order_number) LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same output columns",
        "same aggregation logic"
      ],
      "expected_speedup": "3.0x",
      "risk": "medium"
    }
  ],
  "explanation": "Applied multiple rewrites: (1) date_cte_isolate - extracted date, address, and website filters into CTEs to reduce join cardinality early. (2) decorrelate - transformed correlated EXISTS subqueries into semi-joins and precomputed warehouse variants. The multi-warehouse condition is computed once globally rather than per-row, and the NOT EXISTS is handled after filtering the candidate sales."
}
```