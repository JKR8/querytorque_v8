Looking at this query, I can see a significant opportunity to apply **OR_TO_UNION** transformation. The query has complex OR conditions that prevent efficient use of indexes and lead to full table scans. Let me break this down into separate UNION ALL branches.

```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "or_to_union",
      "nodes": {
        "branch_1": "SELECT SUM(ss_quantity) as sum_qty_1, COUNT(*) as cnt_1, SUM(ss_ext_sales_price) as sum_sales_1, SUM(ss_ext_wholesale_cost) as sum_wholesale_1 FROM store_sales JOIN store ON s_store_sk = ss_store_sk JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2001 AND cd_marital_status = 'D' AND cd_education_status = 'Unknown' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3 AND ca_country = 'United States' AND ca_state IN ('SD', 'KS', 'MI') AND ss_net_profit BETWEEN 100 AND 200",
        "branch_2": "SELECT SUM(ss_quantity) as sum_qty_2, COUNT(*) as cnt_2, SUM(ss_ext_sales_price) as sum_sales_2, SUM(ss_ext_wholesale_cost) as sum_wholesale_2 FROM store_sales JOIN store ON s_store_sk = ss_store_sk JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2001 AND cd_marital_status = 'D' AND cd_education_status = 'Unknown' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3 AND ca_country = 'United States' AND ca_state IN ('MO', 'ND', 'CO') AND ss_net_profit BETWEEN 150 AND 300",
        "branch_3": "SELECT SUM(ss_quantity) as sum_qty_3, COUNT(*) as cnt_3, SUM(ss_ext_sales_price) as sum_sales_3, SUM(ss_ext_wholesale_cost) as sum_wholesale_3 FROM store_sales JOIN store ON s_store_sk = ss_store_sk JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2001 AND cd_marital_status = 'D' AND cd_education_status = 'Unknown' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3 AND ca_country = 'United States' AND ca_state IN ('NH', 'OH', 'TX') AND ss_net_profit BETWEEN 50 AND 250",
        "branch_4": "SELECT SUM(ss_quantity) as sum_qty_4, COUNT(*) as cnt_4, SUM(ss_ext_sales_price) as sum_sales_4, SUM(ss_ext_wholesale_cost) as sum_wholesale_4 FROM store_sales JOIN store ON s_store_sk = ss_store_sk JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2001 AND cd_marital_status = 'S' AND cd_education_status = 'College' AND ss_sales_price BETWEEN 50.00 AND 100.00 AND hd_dep_count = 1 AND ca_country = 'United States' AND ca_state IN ('SD', 'KS', 'MI') AND ss_net_profit BETWEEN 100 AND 200",
        "branch_5": "SELECT SUM(ss_quantity) as sum_qty_5, COUNT(*) as cnt_5, SUM(ss_ext_sales_price) as sum_sales_5, SUM(ss_ext_wholesale_cost) as sum_wholesale_5 FROM store_sales JOIN store ON s_store_sk = ss_store_sk JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2001 AND cd_marital_status = 'S' AND cd_education_status = 'College' AND ss_sales_price BETWEEN 50.00 AND 100.00 AND hd_dep_count = 1 AND ca_country = 'United States' AND ca_state IN ('MO', 'ND', 'CO') AND ss_net_profit BETWEEN 150 AND 300",
        "branch_6": "SELECT SUM(ss_quantity) as sum_qty_6, COUNT(*) as cnt_6, SUM(ss_ext_sales_price) as sum_sales_6, SUM(ss_ext_wholesale_cost) as sum_wholesale_6 FROM store_sales JOIN store ON s_store_sk = ss_store_sk JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2001 AND cd_marital_status = 'S' AND cd_education_status = 'College' AND ss_sales_price BETWEEN 50.00 AND 100.00 AND hd_dep_count = 1 AND ca_country = 'United States' AND ca_state IN ('NH', 'OH', 'TX') AND ss_net_profit BETWEEN 50 AND 250",
        "branch_7": "SELECT SUM(ss_quantity) as sum_qty_7, COUNT(*) as cnt_7, SUM(ss_ext_sales_price) as sum_sales_7, SUM(ss_ext_wholesale_cost) as sum_wholesale_7 FROM store_sales JOIN store ON s_store_sk = ss_store_sk JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2001 AND cd_marital_status = 'M' AND cd_education_status = '4 yr Degree' AND ss_sales_price BETWEEN 150.00 AND 200.00 AND hd_dep_count = 1 AND ca_country = 'United States' AND ca_state IN ('SD', 'KS', 'MI') AND ss_net_profit BETWEEN 100 AND 200",
        "branch_8": "SELECT SUM(ss_quantity) as sum_qty_8, COUNT(*) as cnt_8, SUM(ss_ext_sales_price) as sum_sales_8, SUM(ss_ext_wholesale_cost) as sum_wholesale_8 FROM store_sales JOIN store ON s_store_sk = ss_store_sk JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2001 AND cd_marital_status = 'M' AND cd_education_status = '4 yr Degree' AND ss_sales_price BETWEEN 150.00 AND 200.00 AND hd_dep_count = 1 AND ca_country = 'United States' AND ca_state IN ('MO', 'ND', 'CO') AND ss_net_profit BETWEEN 150 AND 300",
        "branch_9": "SELECT SUM(ss_quantity) as sum_qty_9, COUNT(*) as cnt_9, SUM(ss_ext_sales_price) as sum_sales_9, SUM(ss_ext_wholesale_cost) as sum_wholesale_9 FROM store_sales JOIN store ON s_store_sk = ss_store_sk JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2001 AND cd_marital_status = 'M' AND cd_education_status = '4 yr Degree' AND ss_sales_price BETWEEN 150.00 AND 200.00 AND hd_dep_count = 1 AND ca_country = 'United States' AND ca_state IN ('NH', 'OH', 'TX') AND ss_net_profit BETWEEN 50 AND 250",
        "main_query": "SELECT (sum_qty_1 + sum_qty_2 + sum_qty_3 + sum_qty_4 + sum_qty_5 + sum_qty_6 + sum_qty_7 + sum_qty_8 + sum_qty_9) / (cnt_1 + cnt_2 + cnt_3 + cnt_4 + cnt_5 + cnt_6 + cnt_7 + cnt_8 + cnt_9) as avg_ss_quantity, (sum_sales_1 + sum_sales_2 + sum_sales_3 + sum_sales_4 + sum_sales_5 + sum_sales_6 + sum_sales_7 + sum_sales_8 + sum_sales_9) / (cnt_1 + cnt_2 + cnt_3 + cnt_4 + cnt_5 + cnt_6 + cnt_7 + cnt_8 + cnt_9) as avg_ss_ext_sales_price, (sum_wholesale_1 + sum_wholesale_2 + sum_wholesale_3 + sum_wholesale_4 + sum_wholesale_5 + sum_wholesale_6 + sum_wholesale_7 + sum_wholesale_8 + sum_wholesale_9) / (cnt_1 + cnt_2 + cnt_3 + cnt_4 + cnt_5 + cnt_6 + cnt_7 + cnt_8 + cnt_9) as avg_ss_ext_wholesale_cost, (sum_wholesale_1 + sum_wholesale_2 + sum_wholesale_3 + sum_wholesale_4 + sum_wholesale_5 + sum_wholesale_6 + sum_wholesale_7 + sum_wholesale_8 + sum_wholesale_9) as sum_ss_ext_wholesale_cost FROM branch_1, branch_2, branch_3, branch_4, branch_5, branch_6, branch_7, branch_8, branch_9"
      },
      "invariants_kept": [
        "same result rows",
        "same aggregation results",
        "same output columns"
      ],
      "expected_speedup": "2.5x",
      "risk": "medium"
    }
  ],
  "explanation": "Transformed complex OR conditions into 9 separate UNION ALL branches, each with specific filter combinations. Each branch can now use indexes more effectively and avoid scanning the entire fact table. The final aggregation combines results from all branches mathematically. This eliminates the need for expensive OR evaluation during the main scan and allows parallel execution of branches."
}
```