 ```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "early_filter",
      "nodes": {
        "filtered_d1": "SELECT d_date_sk, d_week_seq, d_date FROM date_dim WHERE d_year = 2002",
        "filtered_cd": "SELECT cd_demo_sk FROM customer_demographics WHERE cd_marital_status = 'W'",
        "filtered_hd": "SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential = '501-1000'",
        "main_query": "SELECT i_item_desc, w_warehouse_name, d1.d_week_seq, SUM(CASE WHEN p_promo_sk IS NULL THEN 1 ELSE 0 END) AS no_promo, SUM(CASE WHEN NOT p_promo_sk IS NULL THEN 1 ELSE 0 END) AS promo, COUNT(*) AS total_cnt FROM catalog_sales JOIN filtered_d1 d1 ON (cs_sold_date_sk = d1.d_date_sk) JOIN inventory ON (cs_item_sk = inv_item_sk AND inv_quantity_on_hand < cs_quantity) JOIN warehouse ON (w_warehouse_sk = inv_warehouse_sk) JOIN item ON (i_item_sk = cs_item_sk) JOIN filtered_cd ON (cs_bill_cdemo_sk = cd_demo_sk) JOIN filtered_hd ON (cs_bill_hdemo_sk = hd_demo_sk) JOIN date_dim AS d2 ON (inv_date_sk = d2.d_date_sk AND d1.d_week_seq = d2.d_week_seq) JOIN date_dim AS d3 ON (cs_ship_date_sk = d3.d_date_sk AND d3.d_date > d1.d_date + 5) LEFT OUTER JOIN promotion ON (cs_promo_sk = p_promo_sk) LEFT OUTER JOIN catalog_returns ON (cr_item_sk = cs_item_sk AND cr_order_number = cs_order_number) GROUP BY i_item_desc, w_warehouse_name, d1.d_week_seq ORDER BY total_cnt DESC, i_item_desc, w_warehouse_name, d1.d_week_seq LIMIT 100"
      },
      "invariants_kept": [
        "output columns unchanged",
        "grain preserved (i_item_desc, w_warehouse_name, d_week_seq)",
        "required predicates preserved",
        "same result set"
      ],
      "expected_speedup": "3.50x",
      "risk": "low"
    }
  ],
  "explanation": "Applied early_filter to push down selective predicates on dimension tables (date_dim d1, customer_demographics, household_demographics) before joining to the large catalog_sales fact table. Also pushed join conditions (inv_quantity_on_hand < cs_quantity, d_week_seq equality, and d3.d_date > d1.d_date + 5) into respective JOIN ON clauses to enable early filtering at the join operators. This reduces the intermediate result size significantly by filtering early on high-cardinality dimensions (year=2002, marital_status='W', buy_potential='501-1000') rather than after the joins."
}
```