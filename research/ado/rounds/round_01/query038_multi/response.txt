```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "main_query": "WITH filtered_dates AS (\n  SELECT d_date_sk, d_date\n  FROM date_dim\n  WHERE d_month_seq BETWEEN 1189 AND 1189 + 11\n)\nSELECT COUNT(*)\nFROM (\n  SELECT DISTINCT c_last_name, c_first_name, d_date\n  FROM store_sales\n  JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk\n  JOIN customer ON store_sales.ss_customer_sk = customer.c_customer_sk\n  WHERE c_birth_month IN (4, 9, 10, 12)\n    AND ss_list_price BETWEEN 25 AND 84\n    AND ss_wholesale_cost BETWEEN 34 AND 54\n  INTERSECT\n  SELECT DISTINCT c_last_name, c_first_name, d_date\n  FROM catalog_sales\n  JOIN filtered_dates ON catalog_sales.cs_sold_date_sk = filtered_dates.d_date_sk\n  JOIN customer ON catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n  WHERE c_birth_month IN (4, 9, 10, 12)\n    AND cs_list_price BETWEEN 25 AND 84\n    AND cs_wholesale_cost BETWEEN 34 AND 54\n  INTERSECT\n  SELECT DISTINCT c_last_name, c_first_name, d_date\n  FROM web_sales\n  JOIN filtered_dates ON web_sales.ws_sold_date_sk = filtered_dates.d_date_sk\n  JOIN customer ON web_sales.ws_bill_customer_sk = customer.c_customer_sk\n  WHERE c_birth_month IN (4, 9, 10, 12)\n    AND ws_list_price BETWEEN 25 AND 84\n    AND ws_wholesale_cost BETWEEN 34 AND 54\n) AS hot_cust\nLIMIT 100"
      },
      "invariants_kept": ["Output columns unchanged", "Result cardinality preserved", "All literal values preserved", "INTERSECT semantics maintained"],
      "expected_speedup": "1.2x-1.5x",
      "risk": "low"
    },
    {
      "id": "rs_02",
      "transform": "early_filter",
      "nodes": {
        "main_query": "WITH filtered_dates AS (\n  SELECT d_date_sk, d_date\n  FROM date_dim\n  WHERE d_month_seq BETWEEN 1189 AND 1189 + 11\n), filtered_customers AS (\n  SELECT c_customer_sk, c_last_name, c_first_name\n  FROM customer\n  WHERE c_birth_month IN (4, 9, 10, 12)\n)\nSELECT COUNT(*)\nFROM (\n  SELECT DISTINCT c_last_name, c_first_name, d_date\n  FROM store_sales\n  JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk\n  JOIN filtered_customers ON store_sales.ss_customer_sk = filtered_customers.c_customer_sk\n  WHERE ss_list_price BETWEEN 25 AND 84\n    AND ss_wholesale_cost BETWEEN 34 AND 54\n  INTERSECT\n  SELECT DISTINCT c_last_name, c_first_name, d_date\n  FROM catalog_sales\n  JOIN filtered_dates ON catalog_sales.cs_sold_date_sk = filtered_dates.d_date_sk\n  JOIN filtered_customers ON catalog_sales.cs_bill_customer_sk = filtered_customers.c_customer_sk\n  WHERE cs_list_price BETWEEN 25 AND 84\n    AND cs_wholesale_cost BETWEEN 34 AND 54\n  INTERSECT\n  SELECT DISTINCT c_last_name, c_first_name, d_date\n  FROM web_sales\n  JOIN filtered_dates ON web_sales.ws_sold_date_sk = filtered_dates.d_date_sk\n  JOIN filtered_customers ON web_sales.ws_bill_customer_sk = filtered_customers.c_customer_sk\n  WHERE ws_list_price BETWEEN 25 AND 84\n    AND ws_wholesale_cost BETWEEN 34 AND 54\n) AS hot_cust\nLIMIT 100"
      },
      "invariants_kept": ["Output columns unchanged", "Result cardinality preserved", "All literal values preserved", "INTERSECT semantics maintained"],
      "expected_speedup": "1.5x-2x",
      "risk": "low"
    }
  ],
  "explanation": "Applied two optimizations: 1) Date CTE Isolation to filter date_dim once and reuse across all three sales channels, reducing repeated date filtering. 2) Early filtering of customer table to pre-filter by birth_month before joining with large fact tables. Both optimizations preserve the INTERSECT semantics while reducing the data volume joined in each branch."
}
```