```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "early_filter",
      "nodes": {
        "main_query": "WITH filtered_date AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 2002\n),\nfiltered_cd AS (\n  SELECT cd_demo_sk\n  FROM customer_demographics\n  WHERE cd_gender = 'M'\n    AND cd_marital_status = 'S'\n    AND cd_education_status = 'Advanced Degree'\n),\nfiltered_store AS (\n  SELECT s_store_sk, s_state\n  FROM store\n  WHERE s_state = 'VA'\n),\nfiltered_item AS (\n  SELECT i_item_sk, i_item_id\n  FROM item\n  WHERE i_category = 'Jewelry'\n)\nSELECT i.i_item_id, s.s_state, GROUPING(s.s_state) AS g_state,\n       AVG(ss.ss_quantity) AS agg1,\n       AVG(ss.ss_list_price) AS agg2,\n       AVG(ss.ss_coupon_amt) AS agg3,\n       AVG(ss.ss_sales_price) AS agg4\nFROM store_sales ss\nJOIN filtered_date d ON ss.ss_sold_date_sk = d.d_date_sk\nJOIN filtered_cd cd ON ss.ss_cdemo_sk = cd.cd_demo_sk\nJOIN filtered_store s ON ss.ss_store_sk = s.s_store_sk\nJOIN filtered_item i ON ss.ss_item_sk = i.i_item_sk\nGROUP BY ROLLUP (i.i_item_id, s.s_state)\nORDER BY i.i_item_id, s.s_state\nLIMIT 100"
      },
      "invariants_kept": [
        "Same output columns and grain",
        "Same literal values preserved (M, S, Advanced Degree, 2002, VA, Jewelry)",
        "Same grouping and aggregation logic",
        "Same result row count"
      ],
      "expected_speedup": "3x-5x",
      "risk": "low"
    }
  ],
  "explanation": "Transformed star schema query by creating filtered CTEs for each dimension table before joining with the large fact table (store_sales). This forces early application of selective filters (cd_gender='M', cd_marital_status='S', cd_education_status='Advanced Degree', d_year=2002, s_state='VA', i_category='Jewelry') to reduce the working set before joins and aggregation. This follows the STAR_SCHEMA_DIMENSION_FILTER_FIRST pattern and QT-OPT-003 Date CTE Isolation principle, ensuring dimension filters are applied before expensive fact table scans. All literal values are preserved exactly as in the original query."
}
```