-- benchmark: dsb
-- query_id: query032
-- source_sql: research/ado/queries_dsb_sf10_duckdb/multi_block_queries/query032.sql
-- database: /mnt/d/TPC-DS/dsb_sf10.duckdb
-- statement_count: 1
-- client_elapsed_ms: 20.938
-- execution_time_ms: 0.000

analyzed_plan
┌─────────────────────────────────────┐
│┌───────────────────────────────────┐│
││    Query Profiling Information    ││
│└───────────────────────────────────┘│
└─────────────────────────────────────┘
EXPLAIN ANALYZE select  sum(cs_ext_discount_amt)  as "excess discount amount" from    catalog_sales    ,item    ,date_dim where (i_manufact_id in (117, 306, 658, 849, 891) or i_manager_id BETWEEN 28 and 57) and i_item_sk = cs_item_sk and d_date between '1999-01-14' and         cast('1999-01-14' as date) + interval '90 day' and d_date_sk = cs_sold_date_sk and cs_ext_discount_amt      > (          select             1.3 * avg(cs_ext_discount_amt)          from             catalog_sales            ,date_dim          where               cs_item_sk = i_item_sk           and d_date between '1999-01-14' and                              cast('1999-01-14' as date) + interval '90 day'           and d_date_sk = cs_sold_date_sk           and cs_list_price between 236 and 265           and cs_sales_price / cs_list_price BETWEEN 45 * 0.01 AND 65 * 0.01       ) order by sum(cs_ext_discount_amt) limit 100
┌────────────────────────────────────────────────┐
│┌──────────────────────────────────────────────┐│
││              Total Time: 0.0195s             ││
│└──────────────────────────────────────────────┘│
└────────────────────────────────────────────────┘
┌───────────────────────┐
│         QUERY         │
└───────────┬───────────┘
┌───────────┴───────────┐
│    EXPLAIN_ANALYZE    │
│    ────────────────   │
│         0 rows        │
│        (0.00s)        │
└───────────┬───────────┘
┌───────────┴───────────┐
│         TOP_N         │
│    ────────────────   │
│        Top: 100       │
│                       │
│       Order By:       │
│   sum(dsb_sf10.main   │
│     .catalog_sales    │
│ .cs_ext_discount_amt) │
│           ASC         │
│                       │
│         1 row         │
│        (0.00s)        │
└───────────┬───────────┘
┌───────────┴───────────┐
│  UNGROUPED_AGGREGATE  │
│    ────────────────   │
│      Aggregates:      │
│        sum(#0)        │
│                       │
│         1 row         │
│        (0.00s)        │
└───────────┬───────────┘
┌───────────┴───────────┐
│       PROJECTION      │
│    ────────────────   │
│  cs_ext_discount_amt  │
│                       │
│        937 rows       │
│        (0.00s)        │
└───────────┬───────────┘
┌───────────┴───────────┐
│       PROJECTION      │
│    ────────────────   │
│           #0          │
│                       │
│        937 rows       │
│        (0.00s)        │
└───────────┬───────────┘
┌───────────┴───────────┐
│         FILTER        │
│    ────────────────   │
│(CAST(cs_ext_discount_a│
│    mt AS DOUBLE) >    │
│        SUBQUERY)      │
│                       │
│        937 rows       │
│        (0.00s)        │
└───────────┬───────────┘
┌───────────┴───────────┐
│    LEFT_DELIM_JOIN    │
│    ────────────────   │
│    Join Type: LEFT    │
│                       │
│      Conditions:      │
│    i_item_sk IS NOT   │
│      DISTINCT FROM    ├───────────────────────────────────────────────────────────────────────────────────────┬───────────────────────────────────────────────────────────────────────────────────────────────────┐
│        i_item_sk      │                                                                                       │                                                                                                   │
│                       │                                                                                       │                                                                                                   │
│     Delim Index: 1    │                                                                                       │                                                                                                   │
│                       │                                                                                       │                                                                                                   │
│         0 rows        │                                                                                       │                                                                                                   │
│        (0.01s)        │                                                                                       │                                                                                                   │
└───────────┬───────────┘                                                                                       │                                                                                                   │
┌───────────┴───────────┐                                                                           ┌───────────┴───────────┐                                                                           ┌───────────┴───────────┐
│       HASH_JOIN       │                                                                           │       HASH_JOIN       │                                                                           │     HASH_GROUP_BY     │
│    ────────────────   │                                                                           │    ────────────────   │                                                                           │    ────────────────   │
│    Join Type: INNER   │                                                                           │    Join Type: LEFT    │                                                                           │       Groups: #0      │
│                       │                                                                           │                       │                                                                           │                       │
│      Conditions:      │                                                                           │      Conditions:      │                                                                           │                       │
│ cs_item_sk = i_item_sk├─────────────────────────────────────┐                                     │    i_item_sk IS NOT   ├────────────┐                                                              │                       │
│                       │                                     │                                     │      DISTINCT FROM    │            │                                                              │                       │
│                       │                                     │                                     │        i_item_sk      │            │                                                              │                       │
│                       │                                     │                                     │                       │            │                                                              │                       │
│      135,916 rows     │                                     │                                     │      135,916 rows     │            │                                                              │      16,950 rows      │
│        (0.00s)        │                                     │                                     │        (0.00s)        │            │                                                              │        (0.00s)        │
└───────────┬───────────┘                                     │                                     └───────────┬───────────┘            │                                                              └───────────────────────┘
┌───────────┴───────────┐                         ┌───────────┴───────────┐                         ┌───────────┴───────────┐┌───────────┴───────────┐
│       HASH_JOIN       │                         │       PROJECTION      │                         │    COLUMN_DATA_SCAN   ││       PROJECTION      │
│    ────────────────   │                         │    ────────────────   │                         │                       ││    ────────────────   │
│    Join Type: INNER   │                         │           #1          │                         │                       ││       (1.3 * avg      │
│                       │                         │                       │                         │                       ││ (cs_ext_discount_amt))│
│      Conditions:      │                         │                       │                         │                       ││       i_item_sk       │
│   cs_sold_date_sk =   ├────────────┐            │                       │                         │                       ││                       │
│        d_date_sk      │            │            │                       │                         │                       ││                       │
│                       │            │            │                       │                         │                       ││                       │
│      408,343 rows     │            │            │      33,871 rows      │                         │      135,916 rows     ││        722 rows       │
│        (0.00s)        │            │            │        (0.00s)        │                         │        (0.00s)        ││        (0.00s)        │
└───────────┬───────────┘            │            └───────────┬───────────┘                         └───────────────────────┘└───────────┬───────────┘
┌───────────┴───────────┐┌───────────┴───────────┐┌───────────┴───────────┐                                                  ┌───────────┴───────────┐
│       TABLE_SCAN      ││         FILTER        ││         FILTER        │                                                  │       PROJECTION      │
│    ────────────────   ││    ────────────────   ││    ────────────────   │                                                  │    ────────────────   │
│         Table:        ││   (d_date_sk BETWEEN  ││     (IN (...) OR (    │                                                  │__internal_decompress_i│
│     catalog_sales     ││  2450815 AND 2452653) ││  (i_manager_id >= 28) │                                                  │ ntegral_bigint(#0, 1) │
│                       ││                       ││  AND (i_manager_id <= │                                                  │           #1          │
│         Type:         ││                       ││          57)))        │                                                  │                       │
│    Sequential Scan    ││                       ││                       │                                                  │                       │
│                       ││                       ││                       │                                                  │                       │
│      Projections:     ││                       ││                       │                                                  │                       │
│       cs_item_sk      ││                       ││                       │                                                  │                       │
│    cs_sold_date_sk    ││                       ││                       │                                                  │                       │
│  cs_ext_discount_amt  ││                       ││                       │                                                  │                       │
│                       ││                       ││                       │                                                  │                       │
│      408,343 rows     ││        91 rows        ││      33,871 rows      │                                                  │        722 rows       │
│        (0.02s)        ││        (0.00s)        ││        (0.00s)        │                                                  │        (0.00s)        │
└───────────────────────┘└───────────┬───────────┘└───────────┬───────────┘                                                  └───────────┬───────────┘
                         ┌───────────┴───────────┐┌───────────┴───────────┐                                                  ┌───────────┴───────────┐
                         │       TABLE_SCAN      ││       HASH_JOIN       │                                                  │     HASH_GROUP_BY     │
                         │    ────────────────   ││    ────────────────   │                                                  │    ────────────────   │
                         │    Table: date_dim    ││    Join Type: MARK    │                                                  │       Groups: #0      │
                         │                       ││                       │                                                  │                       │
                         │         Type:         ││      Conditions:      │                                                  │      Aggregates:      │
                         │    Sequential Scan    ││   i_manufact_id = #0  │                                                  │        avg(#1)        │
                         │                       ││                       │                                                  │                       │
                         │      Projections:     ││                       │                                                  │                       │
                         │       d_date_sk       ││                       │                                                  │                       │
                         │                       ││                       │                                                  │                       │
                         │        Filters:       ││                       ├────────────┐                                     │                       │
                         │    (CAST(d_date AS    ││                       │            │                                     │                       │
                         │   TIMESTAMP) BETWEEN  ││                       │            │                                     │                       │
                         │ '1999-01-14 00:00:00':││                       │            │                                     │                       │
                         │  :TIMESTAMP AND '1999 ││                       │            │                                     │                       │
                         │   -04-14 00:00:00':   ││                       │            │                                     │                       │
                         │      :TIMESTAMP)      ││                       │            │                                     │                       │
                         │                       ││                       │            │                                     │                       │
                         │        91 rows        ││      102,000 rows     │            │                                     │        722 rows       │
                         │        (0.00s)        ││        (0.00s)        │            │                                     │        (0.00s)        │
                         └───────────────────────┘└───────────┬───────────┘            │                                     └───────────┬───────────┘
                                                  ┌───────────┴───────────┐┌───────────┴───────────┐                         ┌───────────┴───────────┐
                                                  │       TABLE_SCAN      ││    COLUMN_DATA_SCAN   │                         │       PROJECTION      │
                                                  │    ────────────────   ││                       │                         │    ────────────────   │
                                                  │      Table: item      ││                       │                         │       i_item_sk       │
                                                  │                       ││                       │                         │  cs_ext_discount_amt  │
                                                  │         Type:         ││                       │                         │                       │
                                                  │    Sequential Scan    ││                       │                         │                       │
                                                  │                       ││                       │                         │                       │
                                                  │      Projections:     ││                       │                         │                       │
                                                  │     i_manufact_id     ││                       │                         │                       │
                                                  │      i_manager_id     ││                       │                         │                       │
                                                  │       i_item_sk       ││                       │                         │                       │
                                                  │                       ││                       │                         │                       │
                                                  │      102,000 rows     ││         5 rows        │                         │        736 rows       │
                                                  │        (0.00s)        ││        (0.00s)        │                         │        (0.00s)        │
                                                  └───────────────────────┘└───────────────────────┘                         └───────────┬───────────┘
                                                                                                                             ┌───────────┴───────────┐
                                                                                                                             │       PROJECTION      │
                                                                                                                             │    ────────────────   │
                                                                                                                             │           #0          │
                                                                                                                             │__internal_compress_int│
                                                                                                                             │ egral_uinteger(#1, 1) │
                                                                                                                             │           #2          │
                                                                                                                             │                       │
                                                                                                                             │        736 rows       │
                                                                                                                             │        (0.00s)        │
                                                                                                                             └───────────┬───────────┘
                                                                                                                             ┌───────────┴───────────┐
                                                                                                                             │       HASH_JOIN       │
                                                                                                                             │    ────────────────   │
                                                                                                                             │    Join Type: INNER   │
                                                                                                                             │                       │
                                                                                                                             │      Conditions:      ├────────────┐
                                                                                                                             │ i_item_sk = cs_item_sk│            │
                                                                                                                             │                       │            │
                                                                                                                             │        736 rows       │            │
                                                                                                                             │        (0.00s)        │            │
                                                                                                                             └───────────┬───────────┘            │
                                                                                                                             ┌───────────┴───────────┐┌───────────┴───────────┐
                                                                                                                             │       DELIM_SCAN      ││       HASH_JOIN       │
                                                                                                                             │    ────────────────   ││    ────────────────   │
                                                                                                                             │     Delim Index: 1    ││    Join Type: INNER   │
                                                                                                                             │                       ││                       │
                                                                                                                             │                       ││      Conditions:      │
                                                                                                                             │                       ││   cs_sold_date_sk =   ├────────────┐
                                                                                                                             │                       ││        d_date_sk      │            │
                                                                                                                             │                       ││                       │            │
                                                                                                                             │         0 rows        ││       2,164 rows      │            │
                                                                                                                             │        (0.00s)        ││        (0.00s)        │            │
                                                                                                                             └───────────────────────┘└───────────┬───────────┘            │
                                                                                                                                                      ┌───────────┴───────────┐┌───────────┴───────────┐
                                                                                                                                                      │       PROJECTION      ││         FILTER        │
                                                                                                                                                      │    ────────────────   ││    ────────────────   │
                                                                                                                                                      │           #0          ││   (d_date_sk BETWEEN  │
                                                                                                                                                      │           #1          ││  2450815 AND 2452653) │
                                                                                                                                                      │           #4          ││                       │
                                                                                                                                                      │                       ││                       │
                                                                                                                                                      │       2,164 rows      ││        91 rows        │
                                                                                                                                                      │        (0.00s)        ││        (0.00s)        │
                                                                                                                                                      └───────────┬───────────┘└───────────┬───────────┘
                                                                                                                                                      ┌───────────┴───────────┐┌───────────┴───────────┐
                                                                                                                                                      │         FILTER        ││       TABLE_SCAN      │
                                                                                                                                                      │    ────────────────   ││    ────────────────   │
                                                                                                                                                      │ ((CAST(cs_sales_price ││    Table: date_dim    │
                                                                                                                                                      │    AS DOUBLE) / CAST  ││                       │
                                                                                                                                                      │   (cs_list_price AS   ││         Type:         │
                                                                                                                                                      │  DOUBLE)) BETWEEN 0.45││    Sequential Scan    │
                                                                                                                                                      │        AND 0.65)      ││                       │
                                                                                                                                                      │                       ││      Projections:     │
                                                                                                                                                      │                       ││       d_date_sk       │
                                                                                                                                                      │                       ││                       │
                                                                                                                                                      │                       ││        Filters:       │
                                                                                                                                                      │                       ││    (CAST(d_date AS    │
                                                                                                                                                      │                       ││   TIMESTAMP) BETWEEN  │
                                                                                                                                                      │                       ││ '1999-01-14 00:00:00':│
                                                                                                                                                      │                       ││  :TIMESTAMP AND '1999 │
                                                                                                                                                      │                       ││   -04-14 00:00:00':   │
                                                                                                                                                      │                       ││      :TIMESTAMP)      │
                                                                                                                                                      │                       ││                       │
                                                                                                                                                      │       2,164 rows      ││        91 rows        │
                                                                                                                                                      │        (0.00s)        ││        (0.00s)        │
                                                                                                                                                      └───────────┬───────────┘└───────────────────────┘
                                                                                                                                                      ┌───────────┴───────────┐
                                                                                                                                                      │       TABLE_SCAN      │
                                                                                                                                                      │    ────────────────   │
                                                                                                                                                      │         Table:        │
                                                                                                                                                      │     catalog_sales     │
                                                                                                                                                      │                       │
                                                                                                                                                      │         Type:         │
                                                                                                                                                      │    Sequential Scan    │
                                                                                                                                                      │                       │
                                                                                                                                                      │      Projections:     │
                                                                                                                                                      │       cs_item_sk      │
                                                                                                                                                      │    cs_sold_date_sk    │
                                                                                                                                                      │     cs_list_price     │
                                                                                                                                                      │     cs_sales_price    │
                                                                                                                                                      │  cs_ext_discount_amt  │
                                                                                                                                                      │                       │
                                                                                                                                                      │        Filters:       │
                                                                                                                                                      │ cs_list_price>=236.00 │
                                                                                                                                                      │   AND cs_list_price<  │
                                                                                                                                                      │        =265.00        │
                                                                                                                                                      │                       │
                                                                                                                                                      │      10,789 rows      │
                                                                                                                                                      │        (0.03s)        │
                                                                                                                                                      └───────────────────────┘

