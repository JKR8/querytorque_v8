-- benchmark: dsb
-- query_id: query072
-- source_sql: research/ado/queries_dsb_sf10_duckdb/agg_queries/query072.sql
-- database: /mnt/d/TPC-DS/dsb_sf10.duckdb
-- statement_count: 1
-- client_elapsed_ms: 149.928
-- execution_time_ms: 0.000

analyzed_plan
┌─────────────────────────────────────┐
│┌───────────────────────────────────┐│
││    Query Profiling Information    ││
│└───────────────────────────────────┘│
└─────────────────────────────────────┘
EXPLAIN ANALYZE select  i_item_desc       ,w_warehouse_name       ,d1.d_week_seq       ,sum(case when p_promo_sk is null then 1 else 0 end) no_promo       ,sum(case when p_promo_sk is not null then 1 else 0 end) promo       ,count(*) total_cnt from catalog_sales join inventory on (cs_item_sk = inv_item_sk) join warehouse on (w_warehouse_sk=inv_warehouse_sk) join item on (i_item_sk = cs_item_sk) join customer_demographics on (cs_bill_cdemo_sk = cd_demo_sk) join household_demographics on (cs_bill_hdemo_sk = hd_demo_sk) join date_dim d1 on (cs_sold_date_sk = d1.d_date_sk) join date_dim d2 on (inv_date_sk = d2.d_date_sk) join date_dim d3 on (cs_ship_date_sk = d3.d_date_sk) left outer join promotion on (cs_promo_sk=p_promo_sk) left outer join catalog_returns on (cr_item_sk = cs_item_sk and cr_order_number = cs_order_number) where d1.d_week_seq = d2.d_week_seq   and inv_quantity_on_hand < cs_quantity   and d3.d_date > d1.d_date + interval '3 day'   and hd_buy_potential = '1001-5000'   and d1.d_year = 2001   and cd_marital_status = 'U'   and cd_dep_count between 5 and 7   and i_category IN ('Books', 'Home', 'Sports')   and cs_wholesale_cost BETWEEN 80 AND 100 group by i_item_desc,w_warehouse_name,d1.d_week_seq order by total_cnt desc, i_item_desc, w_warehouse_name, d1.d_week_seq limit 100
┌────────────────────────────────────────────────┐
│┌──────────────────────────────────────────────┐│
││              Total Time: 0.148s              ││
│└──────────────────────────────────────────────┘│
└────────────────────────────────────────────────┘
┌───────────────────┐
│       QUERY       │
└─────────┬─────────┘
┌─────────┴─────────┐
│  EXPLAIN_ANALYZE  │
│    ────────────   │
│       0 rows      │
│      (0.00s)      │
└─────────┬─────────┘
┌─────────┴─────────┐
│       TOP_N       │
│    ────────────   │
│      Top: 100     │
│                   │
│     Order By:     │
│ count_star() DESC │
│ dsb_sf10.main.item│
│  .i_item_desc ASC │
│   dsb_sf10.main   │
│     .warehouse    │
│ .w_warehouse_name │
│         ASC       │
│ d1.d_week_seq ASC │
│                   │
│      100 rows     │
│      (0.00s)      │
└─────────┬─────────┘
┌─────────┴─────────┐
│     PROJECTION    │
│    ────────────   │
│         #0        │
│         #1        │
│__internal_decompre│
│ ss_integral_bigint│
│      (#2, 1)      │
│         #3        │
│         #4        │
│         #5        │
│                   │
│      668 rows     │
│      (0.00s)      │
└─────────┬─────────┘
┌─────────┴─────────┐
│   HASH_GROUP_BY   │
│    ────────────   │
│      Groups:      │
│         #0        │
│         #1        │
│         #2        │
│                   │
│    Aggregates:    │
│      sum(#3)      │
│      sum(#4)      │
│    count_star()   │
│                   │
│      668 rows     │
│      (0.00s)      │
└─────────┬─────────┘
┌─────────┴─────────┐
│     PROJECTION    │
│    ────────────   │
│    i_item_desc    │
│  w_warehouse_name │
│     d_week_seq    │
│    CASE  WHEN (   │
│   (p_promo_sk IS  │
│   NULL)) THEN (1) │
│     ELSE 0 END    │
│    CASE  WHEN (   │
│ (p_promo_sk IS NOT│
│   NULL)) THEN (1) │
│     ELSE 0 END    │
│                   │
│      668 rows     │
│      (0.00s)      │
└─────────┬─────────┘
┌─────────┴─────────┐
│     PROJECTION    │
│    ────────────   │
│__internal_compress│
│ _integral_uinteger│
│      (#0, 1)      │
│__internal_compress│
│ _integral_uinteger│
│      (#1, 2)      │
│__internal_compress│
│_integral_usmallint│
│      (#3, 1)      │
│         #2        │
│         #4        │
│         #5        │
│                   │
│      668 rows     │
│      (0.00s)      │
└─────────┬─────────┘
┌─────────┴─────────┐
│     HASH_JOIN     │
│    ────────────   │
│     Join Type:    │
│       RIGHT       │
│                   │
│    Conditions:    │
│    cr_item_sk =   ├──────────┐
│     cs_item_sk    │          │
│ cr_order_number = │          │
│   cs_order_number │          │
│                   │          │
│      668 rows     │          │
│      (0.00s)      │          │
└─────────┬─────────┘          │
┌─────────┴─────────┐┌─────────┴─────────┐
│     TABLE_SCAN    ││     HASH_JOIN     │
│    ────────────   ││    ────────────   │
│       Table:      ││     Join Type:    │
│  catalog_returns  ││        LEFT       │
│                   ││                   │
│       Type:       ││    Conditions:    │
│  Sequential Scan  ││   cs_promo_sk =   │
│                   ││     p_promo_sk    ├──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│    Projections:   ││                   │                                                                                                                                                                                  │
│     cr_item_sk    ││                   │                                                                                                                                                                                  │
│  cr_order_number  ││                   │                                                                                                                                                                                  │
│                   ││                   │                                                                                                                                                                                  │
│    284,671 rows   ││      668 rows     │                                                                                                                                                                                  │
│      (0.00s)      ││      (0.00s)      │                                                                                                                                                                                  │
└───────────────────┘└─────────┬─────────┘                                                                                                                                                                                  │
                     ┌─────────┴─────────┐                                                                                                                                                                        ┌─────────┴─────────┐
                     │     HASH_JOIN     │                                                                                                                                                                        │     TABLE_SCAN    │
                     │    ────────────   │                                                                                                                                                                        │    ────────────   │
                     │     Join Type:    │                                                                                                                                                                        │       Table:      │
                     │       INNER       │                                                                                                                                                                        │     promotion     │
                     │                   │                                                                                                                                                                        │                   │
                     │    Conditions:    │                                                                                                                                                                        │       Type:       │
                     │ inv_warehouse_sk =├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐          │  Sequential Scan  │
                     │   w_warehouse_sk  │                                                                                                                                                             │          │                   │
                     │                   │                                                                                                                                                             │          │    Projections:   │
                     │                   │                                                                                                                                                             │          │     p_promo_sk    │
                     │                   │                                                                                                                                                             │          │                   │
                     │      668 rows     │                                                                                                                                                             │          │      500 rows     │
                     │      (0.00s)      │                                                                                                                                                             │          │      (0.00s)      │
                     └─────────┬─────────┘                                                                                                                                                             │          └───────────────────┘
                     ┌─────────┴─────────┐                                                                                                                                                   ┌─────────┴─────────┐
                     │     HASH_JOIN     │                                                                                                                                                   │     TABLE_SCAN    │
                     │    ────────────   │                                                                                                                                                   │    ────────────   │
                     │     Join Type:    │                                                                                                                                                   │       Table:      │
                     │       INNER       │                                                                                                                                                   │     warehouse     │
                     │                   │                                                                                                                                                   │                   │
                     │    Conditions:    │                                                                                                                                                   │       Type:       │
                     │   inv_item_sk =   │                                                                                                                                                   │  Sequential Scan  │
                     │     cs_item_sk    │                                                                                                                                                   │                   │
                     │   inv_date_sk =   ├──────────┐                                                                                                                                        │    Projections:   │
                     │      d_date_sk    │          │                                                                                                                                        │   w_warehouse_sk  │
                     │CAST(inv_quantity_o│          │                                                                                                                                        │  w_warehouse_name │
                     │ n_hand AS BIGINT) │          │                                                                                                                                        │                   │
                     │   < cs_quantity   │          │                                                                                                                                        │                   │
                     │                   │          │                                                                                                                                        │                   │
                     │      668 rows     │          │                                                                                                                                        │      10 rows      │
                     │      (0.43s)      │          │                                                                                                                                        │      (0.00s)      │
                     └─────────┬─────────┘          │                                                                                                                                        └───────────────────┘
                     ┌─────────┴─────────┐┌─────────┴─────────┐
                     │     TABLE_SCAN    ││     HASH_JOIN     │
                     │    ────────────   ││    ────────────   │
                     │       Table:      ││     Join Type:    │
                     │     inventory     ││       INNER       │
                     │                   ││                   │
                     │       Type:       ││    Conditions:    │
                     │  Sequential Scan  ││    d_week_seq =   │
                     │                   ││     d_week_seq    │
                     │    Projections:   ││                   ├──────────┐
                     │    inv_item_sk    ││                   │          │
                     │  inv_warehouse_sk ││                   │          │
                     │    inv_date_sk    ││                   │          │
                     │inv_quantity_on_han││                   │          │
                     │         d         ││                   │          │
                     │                   ││                   │          │
                     │  26,975,940 rows  ││    11,018 rows    │          │
                     │      (0.67s)      ││      (0.00s)      │          │
                     └───────────────────┘└─────────┬─────────┘          │
                                          ┌─────────┴─────────┐┌─────────┴─────────┐
                                          │     TABLE_SCAN    ││     HASH_JOIN     │
                                          │    ────────────   ││    ────────────   │
                                          │       Table:      ││     Join Type:    │
                                          │      date_dim     ││       INNER       │
                                          │                   ││                   │
                                          │       Type:       ││    Conditions:    │
                                          │  Sequential Scan  ││    d_date_sk =    │
                                          │                   ││   cs_ship_date_sk │
                                          │    Projections:   ││   CAST(d_date AS  │
                                          │     d_date_sk     ││    TIMESTAMP) >   ├──────────┐
                                          │     d_week_seq    ││ (d_date + '3 days'│          │
                                          │                   ││    ::INTERVAL)    │          │
                                          │      Filters:     ││                   │          │
                                          │ d_date_sk>=2450815││                   │          │
                                          │   AND d_date_sk<  ││                   │          │
                                          │      =2452635     ││                   │          │
                                          │                   ││                   │          │
                                          │      371 rows     ││     1,574 rows    │          │
                                          │      (0.00s)      ││      (0.00s)      │          │
                                          └───────────────────┘└─────────┬─────────┘          │
                                                               ┌─────────┴─────────┐┌─────────┴─────────┐
                                                               │     TABLE_SCAN    ││     HASH_JOIN     │
                                                               │    ────────────   ││    ────────────   │
                                                               │       Table:      ││     Join Type:    │
                                                               │      date_dim     ││       INNER       │
                                                               │                   ││                   │
                                                               │       Type:       ││    Conditions:    │
                                                               │  Sequential Scan  ││    i_item_sk =    │
                                                               │                   ││     cs_item_sk    │
                                                               │    Projections:   ││                   │
                                                               │     d_date_sk     ││                   ├──────────┐
                                                               │       d_date      ││                   │          │
                                                               │                   ││                   │          │
                                                               │      Filters:     ││                   │          │
                                                               │ d_date_sk>=2450817││                   │          │
                                                               │   AND d_date_sk<  ││                   │          │
                                                               │      =2452743     ││                   │          │
                                                               │                   ││                   │          │
                                                               │      444 rows     ││     1,613 rows    │          │
                                                               │      (0.00s)      ││      (0.00s)      │          │
                                                               └───────────────────┘└─────────┬─────────┘          │
                                                                                    ┌─────────┴─────────┐┌─────────┴─────────┐
                                                                                    │     PROJECTION    ││     HASH_JOIN     │
                                                                                    │    ────────────   ││    ────────────   │
                                                                                    │         #0        ││     Join Type:    │
                                                                                    │         #2        ││       INNER       │
                                                                                    │                   ││                   │
                                                                                    │                   ││    Conditions:    ├──────────┐
                                                                                    │                   ││    cd_demo_sk =   │          │
                                                                                    │                   ││  cs_bill_cdemo_sk │          │
                                                                                    │                   ││                   │          │
                                                                                    │    30,434 rows    ││     5,515 rows    │          │
                                                                                    │      (0.00s)      ││      (0.02s)      │          │
                                                                                    └─────────┬─────────┘└─────────┬─────────┘          │
                                                                                    ┌─────────┴─────────┐┌─────────┴─────────┐┌─────────┴─────────┐
                                                                                    │       FILTER      ││       FILTER      ││     HASH_JOIN     │
                                                                                    │    ────────────   ││    ────────────   ││    ────────────   │
                                                                                    │  ((i_category =   ││ (cd_demo_sk >= 2) ││     Join Type:    │
                                                                                    │    'Books') OR    ││                   ││       INNER       │
                                                                                    │   (i_category =   ││                   ││                   │
                                                                                    │    'Home') OR     ││                   ││    Conditions:    ├───────────────────────────────┐
                                                                                    │   (i_category =   ││                   ││ cs_bill_hdemo_sk =│                               │
                                                                                    │     'Sports'))    ││                   ││     hd_demo_sk    │                               │
                                                                                    │                   ││                   ││                   │                               │
                                                                                    │    30,434 rows    ││    109,750 rows   ││    95,351 rows    │                               │
                                                                                    │      (0.00s)      ││      (0.00s)      ││      (0.01s)      │                               │
                                                                                    └─────────┬─────────┘└─────────┬─────────┘└─────────┬─────────┘                               │
                                                                                    ┌─────────┴─────────┐┌─────────┴─────────┐┌─────────┴─────────┐                     ┌─────────┴─────────┐
                                                                                    │     TABLE_SCAN    ││     TABLE_SCAN    ││     HASH_JOIN     │                     │     TABLE_SCAN    │
                                                                                    │    ────────────   ││    ────────────   ││    ────────────   │                     │    ────────────   │
                                                                                    │    Table: item    ││       Table:      ││     Join Type:    │                     │       Table:      │
                                                                                    │                   ││customer_demographi││       INNER       │                     │household_demograph│
                                                                                    │       Type:       ││         cs        ││                   │                     │        ics        │
                                                                                    │  Sequential Scan  ││                   ││    Conditions:    │                     │                   │
                                                                                    │                   ││       Type:       ││ cs_sold_date_sk = │                     │       Type:       │
                                                                                    │    Projections:   ││  Sequential Scan  ││      d_date_sk    │                     │  Sequential Scan  │
                                                                                    │     i_item_sk     ││                   ││                   │                     │                   │
                                                                                    │     i_category    ││    Projections:   ││                   │                     │    Projections:   │
                                                                                    │    i_item_desc    ││     cd_demo_sk    ││                   ├──────────┐          │     hd_demo_sk    │
                                                                                    │                   ││                   ││                   │          │          │                   │
                                                                                    │      Filters:     ││      Filters:     ││                   │          │          │      Filters:     │
                                                                                    │     optional:     ││ cd_marital_status=││                   │          │          │ hd_buy_potential= │
                                                                                    │   i_category IN ( ││        'U'        ││                   │          │          │    '1001-5000'    │
                                                                                    │ 'Books', 'Home',  ││  cd_dep_count>=5  ││                   │          │          │                   │
                                                                                    │     'Sports')     ││  AND cd_dep_count<││                   │          │          │                   │
                                                                                    │                   ││         =7        ││                   │          │          │                   │
                                                                                    │                   ││                   ││                   │          │          │                   │
                                                                                    │    101,987 rows   ││    109,750 rows   ││    566,664 rows   │          │          │     1,200 rows    │
                                                                                    │      (0.01s)      ││      (0.01s)      ││      (0.01s)      │          │          │      (0.00s)      │
                                                                                    └───────────────────┘└───────────────────┘└─────────┬─────────┘          │          └───────────────────┘
                                                                                                                              ┌─────────┴─────────┐┌─────────┴─────────┐
                                                                                                                              │     TABLE_SCAN    ││       FILTER      │
                                                                                                                              │    ────────────   ││    ────────────   │
                                                                                                                              │       Table:      ││ (d_date_sk BETWEEN│
                                                                                                                              │   catalog_sales   ││     2450815 AND   │
                                                                                                                              │                   ││      2452653)     │
                                                                                                                              │       Type:       ││                   │
                                                                                                                              │  Sequential Scan  ││                   │
                                                                                                                              │                   ││                   │
                                                                                                                              │    Projections:   ││                   │
                                                                                                                              │     cs_item_sk    ││                   │
                                                                                                                              │  cs_bill_cdemo_sk ││                   │
                                                                                                                              │  cs_bill_hdemo_sk ││                   │
                                                                                                                              │  cs_sold_date_sk  ││                   │
                                                                                                                              │  cs_ship_date_sk  ││                   │
                                                                                                                              │    cs_promo_sk    ││                   │
                                                                                                                              │  cs_order_number  ││                   │
                                                                                                                              │    cs_quantity    ││                   │
                                                                                                                              │                   ││                   │
                                                                                                                              │      Filters:     ││                   │
                                                                                                                              │ cs_wholesale_cost>││                   │
                                                                                                                              │     =80.00 AND    ││                   │
                                                                                                                              │  cs_wholesale_cost││                   │
                                                                                                                              │      <=100.00     ││                   │
                                                                                                                              │                   ││                   │
                                                                                                                              │    566,664 rows   ││      365 rows     │
                                                                                                                              │      (0.19s)      ││      (0.00s)      │
                                                                                                                              └───────────────────┘└─────────┬─────────┘
                                                                                                                                                   ┌─────────┴─────────┐
                                                                                                                                                   │     TABLE_SCAN    │
                                                                                                                                                   │    ────────────   │
                                                                                                                                                   │       Table:      │
                                                                                                                                                   │      date_dim     │
                                                                                                                                                   │                   │
                                                                                                                                                   │       Type:       │
                                                                                                                                                   │  Sequential Scan  │
                                                                                                                                                   │                   │
                                                                                                                                                   │    Projections:   │
                                                                                                                                                   │     d_date_sk     │
                                                                                                                                                   │     d_week_seq    │
                                                                                                                                                   │       d_date      │
                                                                                                                                                   │                   │
                                                                                                                                                   │      Filters:     │
                                                                                                                                                   │    d_year=2001    │
                                                                                                                                                   │                   │
                                                                                                                                                   │      365 rows     │
                                                                                                                                                   │      (0.00s)      │
                                                                                                                                                   └───────────────────┘

