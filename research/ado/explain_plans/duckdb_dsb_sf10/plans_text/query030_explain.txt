-- benchmark: dsb
-- query_id: query030
-- source_sql: research/ado/queries_dsb_sf10_duckdb/multi_block_queries/query030.sql
-- database: /mnt/d/TPC-DS/dsb_sf10.duckdb
-- statement_count: 1
-- client_elapsed_ms: 76.162
-- execution_time_ms: 0.000

analyzed_plan
┌─────────────────────────────────────┐
│┌───────────────────────────────────┐│
││    Query Profiling Information    ││
│└───────────────────────────────────┘│
└─────────────────────────────────────┘
EXPLAIN ANALYZE with customer_total_return as  (select wr_returning_customer_sk as ctr_customer_sk  ,ca_state as ctr_state ,wr_reason_sk as ctr_reason_sk ,sum(wr_return_amt) as ctr_total_return  from web_returns      ,date_dim      ,customer_address      ,item  where wr_returned_date_sk = d_date_sk    and d_year =2001    and wr_returning_addr_sk = ca_address_sk    and wr_item_sk = i_item_sk    and i_manager_id BETWEEN 69 and 78    and wr_return_amt / wr_return_quantity between 28 and 57  group by wr_returning_customer_sk          ,ca_state, wr_reason_sk)   select  c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag        ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address        ,c_last_review_date_sk,ctr_total_return  from customer_total_return ctr1      ,customer_address      ,customer  where ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2  			  from customer_total_return ctr2                   	  where ctr1.ctr_state = ctr2.ctr_state)        and ca_address_sk = c_current_addr_sk        and ca_state in ('IA', 'MT', 'NE', 'TX')        and ctr1.ctr_customer_sk = c_customer_sk        and ctr1.ctr_reason_sk in (3, 31)       and c_birth_year BETWEEN 1938 AND 1944  order by c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag                   ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address                   ,c_last_review_date_sk,ctr_total_return limit 100
┌────────────────────────────────────────────────┐
│┌──────────────────────────────────────────────┐│
││              Total Time: 0.0745s             ││
│└──────────────────────────────────────────────┘│
└────────────────────────────────────────────────┘
┌───────────────────┐
│       QUERY       │
└─────────┬─────────┘
┌─────────┴─────────┐
│  EXPLAIN_ANALYZE  │
│    ────────────   │
│       0 rows      │
│      (0.00s)      │
└─────────┬─────────┘
┌─────────┴─────────┐
│        CTE        │
│    ────────────   │
│     CTE Name:     │
│customer_total_retu│
│         rn        │
│                   ├─────────────────────────────────────────────────────────────────────────┐
│    Table Index:   │                                                                         │
│         0         │                                                                         │
│                   │                                                                         │
│       0 rows      │                                                                         │
│      (0.00s)      │                                                                         │
└─────────┬─────────┘                                                                         │
┌─────────┴─────────┐                                                               ┌─────────┴─────────┐
│     PROJECTION    │                                                               │       TOP_N       │
│    ────────────   │                                                               │    ────────────   │
│__internal_decompre│                                                               │      Top: 100     │
│ ss_integral_bigint│                                                               │                   │
│      (#0, 1)      │                                                               │     Order By:     │
│__internal_decompre│                                                               │   dsb_sf10.main   │
│   ss_string(#1)   │                                                               │     .customer     │
│__internal_decompre│                                                               │ .c_customer_id ASC│
│ ss_integral_bigint│                                                               │   dsb_sf10.main   │
│      (#2, 1)      │                                                               │     .customer     │
│         #3        │                                                               │ .c_salutation ASC │
│                   │                                                               │   dsb_sf10.main   │
│                   │                                                               │     .customer     │
│                   │                                                               │ .c_first_name ASC │
│                   │                                                               │   dsb_sf10.main   │
│                   │                                                               │     .customer     │
│                   │                                                               │  .c_last_name ASC │
│                   │                                                               │   dsb_sf10.main   │
│                   │                                                               │     .customer     │
│                   │                                                               │.c_preferred_cust_f│
│                   │                                                               │      lag ASC      │
│                   │                                                               │   dsb_sf10.main   │
│                   │                                                               │     .customer     │
│                   │                                                               │  .c_birth_day ASC │
│                   │                                                               │   dsb_sf10.main   │
│                   │                                                               │     .customer     │
│                   │                                                               │ .c_birth_month ASC│
│                   │                                                               │   dsb_sf10.main   │
│                   │                                                               │     .customer     │
│                   │                                                               │ .c_birth_year ASC │
│                   │                                                               │   dsb_sf10.main   │
│                   │                                                               │     .customer     │
│                   │                                                               │  .c_birth_country │
│                   │                                                               │         ASC       │
│                   │                                                               │   dsb_sf10.main   │
│                   │                                                               │ .customer.c_login │
│                   │                                                               │         ASC       │
│                   │                                                               │   dsb_sf10.main   │
│                   │                                                               │     .customer     │
│                   │                                                               │  .c_email_address │
│                   │                                                               │         ASC       │
│                   │                                                               │   dsb_sf10.main   │
│                   │                                                               │     .customer     │
│                   │                                                               │.c_last_review_date│
│                   │                                                               │      _sk ASC      │
│                   │                                                               │ctr1.ctr_total_retu│
│                   │                                                               │       rn ASC      │
│                   │                                                               │                   │
│      909 rows     │                                                               │       0 rows      │
│      (0.00s)      │                                                               │      (0.00s)      │
└─────────┬─────────┘                                                               └─────────┬─────────┘
┌─────────┴─────────┐                                                               ┌─────────┴─────────┐
│   HASH_GROUP_BY   │                                                               │     PROJECTION    │
│    ────────────   │                                                               │    ────────────   │
│      Groups:      │                                                               │   c_customer_id   │
│         #0        │                                                               │    c_salutation   │
│         #1        │                                                               │    c_first_name   │
│         #2        │                                                               │    c_last_name    │
│                   │                                                               │c_preferred_cust_fl│
│    Aggregates:    │                                                               │         ag        │
│      sum(#3)      │                                                               │    c_birth_day    │
│                   │                                                               │   c_birth_month   │
│                   │                                                               │    c_birth_year   │
│                   │                                                               │  c_birth_country  │
│                   │                                                               │      c_login      │
│                   │                                                               │  c_email_address  │
│                   │                                                               │c_last_review_date_│
│                   │                                                               │         sk        │
│                   │                                                               │  ctr_total_return │
│                   │                                                               │                   │
│      909 rows     │                                                               │       0 rows      │
│      (0.00s)      │                                                               │      (0.00s)      │
└─────────┬─────────┘                                                               └─────────┬─────────┘
┌─────────┴─────────┐                                                               ┌─────────┴─────────┐
│     PROJECTION    │                                                               │     PROJECTION    │
│    ────────────   │                                                               │    ────────────   │
│wr_returning_custom│                                                               │         #0        │
│       er_sk       │                                                               │         #1        │
│      ca_state     │                                                               │         #2        │
│    wr_reason_sk   │                                                               │         #3        │
│   wr_return_amt   │                                                               │         #4        │
│                   │                                                               │         #5        │
│                   │                                                               │         #6        │
│                   │                                                               │         #7        │
│                   │                                                               │         #8        │
│                   │                                                               │         #9        │
│                   │                                                               │        #10        │
│                   │                                                               │        #11        │
│                   │                                                               │        #12        │
│                   │                                                               │                   │
│      909 rows     │                                                               │       0 rows      │
│      (0.00s)      │                                                               │      (0.00s)      │
└─────────┬─────────┘                                                               └─────────┬─────────┘
┌─────────┴─────────┐                                                               ┌─────────┴─────────┐
│     PROJECTION    │                                                               │       FILTER      │
│    ────────────   │                                                               │    ────────────   │
│__internal_compress│                                                               │(CAST(ctr_total_ret│
│ _string_uinteger( │                                                               │  urn AS DOUBLE) > │
│        #0)        │                                                               │      SUBQUERY)    │
│         #1        │                                                               │                   │
│__internal_compress│                                                               │                   │
│ _integral_uinteger│                                                               │                   │
│      (#2, 1)      │                                                               │                   │
│__internal_compress│                                                               │                   │
│ _integral_utinyint│                                                               │                   │
│      (#3, 1)      │                                                               │                   │
│                   │                                                               │                   │
│      909 rows     │                                                               │       0 rows      │
│      (0.00s)      │                                                               │      (0.00s)      │
└─────────┬─────────┘                                                               └─────────┬─────────┘
┌─────────┴─────────┐                                                               ┌─────────┴─────────┐
│     HASH_JOIN     │                                                               │  LEFT_DELIM_JOIN  │
│    ────────────   │                                                               │    ────────────   │
│     Join Type:    │                                                               │     Join Type:    │
│       INNER       │                                                               │        LEFT       │
│                   │                                                               │                   │
│    Conditions:    │                                                               │    Conditions:    │
│  ca_address_sk =  │                                                               │  ctr_state IS NOT │
│ wr_returning_addr_├──────────┐                                                    │    DISTINCT FROM  ├────────────────────────────────────────────────────┬──────────────────────────────────────────────────────────────┐
│         sk        │          │                                                    │      ctr_state    │                                                    │                                                              │
│                   │          │                                                    │                   │                                                    │                                                              │
│                   │          │                                                    │    Delim Index:   │                                                    │                                                              │
│                   │          │                                                    │         1         │                                                    │                                                              │
│                   │          │                                                    │                   │                                                    │                                                              │
│      909 rows     │          │                                                    │       0 rows      │                                                    │                                                              │
│      (0.00s)      │          │                                                    │      (0.00s)      │                                                    │                                                              │
└─────────┬─────────┘          │                                                    └─────────┬─────────┘                                                    │                                                              │
┌─────────┴─────────┐┌─────────┴─────────┐                                          ┌─────────┴─────────┐                                          ┌─────────┴─────────┐                                          ┌─────────┴─────────┐
│     TABLE_SCAN    ││     HASH_JOIN     │                                          │     HASH_JOIN     │                                          │     HASH_JOIN     │                                          │   HASH_GROUP_BY   │
│    ────────────   ││    ────────────   │                                          │    ────────────   │                                          │    ────────────   │                                          │    ────────────   │
│       Table:      ││     Join Type:    │                                          │     Join Type:    │                                          │     Join Type:    │                                          │    Groups: #13    │
│  customer_address ││       INNER       │                                          │       INNER       │                                          │        LEFT       │                                          │                   │
│                   ││                   │                                          │                   │                                          │                   │                                          │                   │
│       Type:       ││    Conditions:    │                                          │    Conditions:    │                                          │    Conditions:    │                                          │                   │
│  Sequential Scan  ││    i_item_sk =    │                                          │  ca_address_sk =  │                                          │  ctr_state IS NOT │                                          │                   │
│                   ││     wr_item_sk    ├──────────┐                               │  c_current_addr_sk├──────────┐                               │    DISTINCT FROM  ├──────────┐                               │                   │
│    Projections:   ││                   │          │                               │                   │          │                               │      ctr_state    │          │                               │                   │
│   ca_address_sk   ││                   │          │                               │                   │          │                               │                   │          │                               │                   │
│      ca_state     ││                   │          │                               │                   │          │                               │                   │          │                               │                   │
│                   ││                   │          │                               │                   │          │                               │                   │          │                               │                   │
│    249,054 rows   ││      915 rows     │          │                               │       1 row       │          │                               │       1 row       │          │                               │       1 row       │
│      (0.00s)      ││      (0.00s)      │          │                               │      (0.00s)      │          │                               │      (0.00s)      │          │                               │      (0.00s)      │
└───────────────────┘└─────────┬─────────┘          │                               └─────────┬─────────┘          │                               └─────────┬─────────┘          │                               └───────────────────┘
                     ┌─────────┴─────────┐┌─────────┴─────────┐                     ┌─────────┴─────────┐┌─────────┴─────────┐                     ┌─────────┴─────────┐┌─────────┴─────────┐
                     │     TABLE_SCAN    ││     HASH_JOIN     │                     │     PROJECTION    ││     HASH_JOIN     │                     │  COLUMN_DATA_SCAN ││     PROJECTION    │
                     │    ────────────   ││    ────────────   │                     │    ────────────   ││    ────────────   │                     │                   ││    ────────────   │
                     │    Table: item    ││     Join Type:    │                     │         #0        ││     Join Type:    │                     │                   ││(avg(ctr_total_retu│
                     │                   ││       INNER       │                     │                   ││       INNER       │                     │                   ││     rn) * 1.2)    │
                     │       Type:       ││                   │                     │                   ││                   │                     │                   ││     ctr_state     │
                     │  Sequential Scan  ││    Conditions:    │                     │                   ││    Conditions:    │                     │                   ││                   │
                     │                   ││wr_returned_date_sk│                     │                   ││  c_customer_sk =  │                     │                   ││                   │
                     │    Projections:   ││     = d_date_sk   │                     │                   ││   ctr_customer_sk │                     │                   ││                   │
                     │     i_item_sk     ││                   ├──────────┐          │                   ││                   ├──────────┐          │                   ││                   │
                     │                   ││                   │          │          │                   ││                   │          │          │                   ││                   │
                     │      Filters:     ││                   │          │          │                   ││                   │          │          │                   ││                   │
                     │  i_manager_id>=69 ││                   │          │          │                   ││                   │          │          │                   ││                   │
                     │  AND i_manager_id<││                   │          │          │                   ││                   │          │          │                   ││                   │
                     │        =78        ││                   │          │          │                   ││                   │          │          │                   ││                   │
                     │                   ││                   │          │          │                   ││                   │          │          │                   ││                   │
                     │     2,997 rows    ││    30,285 rows    │          │          │    10,213 rows    ││       2 rows      │          │          │       1 row       ││       1 row       │
                     │      (0.00s)      ││      (0.00s)      │          │          │      (0.00s)      ││      (0.00s)      │          │          │      (0.00s)      ││      (0.00s)      │
                     └───────────────────┘└─────────┬─────────┘          │          └─────────┬─────────┘└─────────┬─────────┘          │          └───────────────────┘└─────────┬─────────┘
                                          ┌─────────┴─────────┐┌─────────┴─────────┐┌─────────┴─────────┐┌─────────┴─────────┐┌─────────┴─────────┐                     ┌─────────┴─────────┐
                                          │     PROJECTION    ││       FILTER      ││       FILTER      ││     TABLE_SCAN    ││     PROJECTION    │                     │   HASH_GROUP_BY   │
                                          │    ────────────   ││    ────────────   ││    ────────────   ││    ────────────   ││    ────────────   │                     │    ────────────   │
                                          │         #0        ││ (d_date_sk BETWEEN││ ((ca_state = 'IA')││       Table:      ││         #0        │                     │     Groups: #0    │
                                          │         #1        ││     2450821 AND   ││   OR (ca_state =  ││      customer     ││         #1        │                     │                   │
                                          │         #2        ││      2452997)     ││ 'MT') OR (ca_state││                   ││         #3        │                     │    Aggregates:    │
                                          │         #3        ││                   ││     = 'NE') OR    ││       Type:       ││                   │                     │      avg(#1)      │
                                          │         #5        ││                   ││ (ca_state = 'TX'))││  Sequential Scan  ││                   │                     │                   │
                                          │         #6        ││                   ││                   ││                   ││                   │                     │                   │
                                          │                   ││                   ││                   ││      Filters:     ││                   │                     │                   │
                                          │                   ││                   ││                   ││ c_birth_year>=1938││                   │                     │                   │
                                          │                   ││                   ││                   ││  AND c_birth_year<││                   │                     │                   │
                                          │                   ││                   ││                   ││       =1944       ││                   │                     │                   │
                                          │                   ││                   ││                   ││                   ││                   │                     │                   │
                                          │    30,285 rows    ││      365 rows     ││    10,213 rows    ││    41,615 rows    ││      41 rows      │                     │       1 row       │
                                          │      (0.00s)      ││      (0.00s)      ││      (0.00s)      ││      (0.10s)      ││      (0.00s)      │                     │      (0.00s)      │
                                          └─────────┬─────────┘└─────────┬─────────┘└─────────┬─────────┘└───────────────────┘└─────────┬─────────┘                     └─────────┬─────────┘
                                          ┌─────────┴─────────┐┌─────────┴─────────┐┌─────────┴─────────┐                     ┌─────────┴─────────┐                     ┌─────────┴─────────┐
                                          │       FILTER      ││     TABLE_SCAN    ││     TABLE_SCAN    │                     │       FILTER      │                     │     PROJECTION    │
                                          │    ────────────   ││    ────────────   ││    ────────────   │                     │    ────────────   │                     │    ────────────   │
                                          │((CAST(wr_return_am││       Table:      ││       Table:      │                     │ ((ctr_reason_sk = │                     │     ctr_state     │
                                          │   t AS DOUBLE) /  ││      date_dim     ││  customer_address │                     │ 3) OR (ctr_reason_│                     │  ctr_total_return │
                                          │ CAST(wr_return_qua││                   ││                   │                     │     sk = 31))     │                     │                   │
                                          │ ntity AS DOUBLE)) ││       Type:       ││       Type:       │                     │                   │                     │                   │
                                          │  BETWEEN 28.0 AND ││  Sequential Scan  ││  Sequential Scan  │                     │                   │                     │                   │
                                          │        57.0)      ││                   ││                   │                     │                   │                     │                   │
                                          │                   ││    Projections:   ││      Filters:     │                     │                   │                     │                   │
                                          │                   ││     d_date_sk     ││ optional: ca_state│                     │                   │                     │                   │
                                          │                   ││                   ││  IN ('IA', 'MT',  │                     │                   │                     │                   │
                                          │                   ││      Filters:     ││    'NE', 'TX')    │                     │                   │                     │                   │
                                          │                   ││    d_year=2001    ││                   │                     │                   │                     │                   │
                                          │                   ││                   ││                   │                     │                   │                     │                   │
                                          │    30,285 rows    ││      365 rows     ││    63,757 rows    │                     │      41 rows      │                     │      19 rows      │
                                          │      (0.00s)      ││      (0.00s)      ││      (0.00s)      │                     │      (0.00s)      │                     │      (0.00s)      │
                                          └─────────┬─────────┘└───────────────────┘└───────────────────┘                     └─────────┬─────────┘                     └─────────┬─────────┘
                                          ┌─────────┴─────────┐                                                               ┌─────────┴─────────┐                     ┌─────────┴─────────┐
                                          │     TABLE_SCAN    │                                                               │      CTE_SCAN     │                     │     HASH_JOIN     │
                                          │    ────────────   │                                                               │    ────────────   │                     │    ────────────   │
                                          │       Table:      │                                                               │    CTE Index: 0   │                     │     Join Type:    │
                                          │    web_returns    │                                                               │                   │                     │       INNER       │
                                          │                   │                                                               │                   │                     │                   │
                                          │       Type:       │                                                               │                   │                     │    Conditions:    │
                                          │  Sequential Scan  │                                                               │                   │                     │    ctr_state =    │
                                          │                   │                                                               │                   │                     │      ctr_state    │
                                          │    Projections:   │                                                               │                   │                     │                   │
                                          │wr_returned_date_sk│                                                               │                   │                     │                   │
                                          │wr_returning_addr_s│                                                               │                   │                     │                   ├──────────┐
                                          │         k         │                                                               │                   │                     │                   │          │
                                          │     wr_item_sk    │                                                               │                   │                     │                   │          │
                                          │   wr_return_amt   │                                                               │                   │                     │                   │          │
                                          │ wr_return_quantity│                                                               │                   │                     │                   │          │
                                          │wr_returning_custom│                                                               │                   │                     │                   │          │
                                          │       er_sk       │                                                               │                   │                     │                   │          │
                                          │    wr_reason_sk   │                                                               │                   │                     │                   │          │
                                          │                   │                                                               │                   │                     │                   │          │
                                          │    137,616 rows   │                                                               │      909 rows     │                     │      19 rows      │          │
                                          │      (0.10s)      │                                                               │      (0.00s)      │                     │      (0.00s)      │          │
                                          └───────────────────┘                                                               └───────────────────┘                     └─────────┬─────────┘          │
                                                                                                                                                                        ┌─────────┴─────────┐┌─────────┴─────────┐
                                                                                                                                                                        │      CTE_SCAN     ││     DELIM_SCAN    │
                                                                                                                                                                        │    ────────────   ││    ────────────   │
                                                                                                                                                                        │    CTE Index: 0   ││    Delim Index:   │
                                                                                                                                                                        │                   ││         1         │
                                                                                                                                                                        │                   ││                   │
                                                                                                                                                                        │      909 rows     ││       0 rows      │
                                                                                                                                                                        │      (0.00s)      ││      (0.00s)      │
                                                                                                                                                                        └───────────────────┘└───────────────────┘

