-- benchmark: tpcds
-- query_id: query_40
-- source_sql: /mnt/d/TPC-DS/queries_duckdb_converted/query_40.sql
-- database: /mnt/d/TPC-DS/tpcds_sf10.duckdb
-- statement_count: 1
-- client_elapsed_ms: 55.846
-- execution_time_ms: 0.000

analyzed_plan
┌─────────────────────────────────────┐
│┌───────────────────────────────────┐│
││    Query Profiling Information    ││
│└───────────────────────────────────┘│
└─────────────────────────────────────┘
EXPLAIN ANALYZE select     w_state   ,i_item_id   ,sum(case when (cast(d_date as date) < cast ('2001-04-02' as date))   		then cs_sales_price - coalesce(cr_refunded_cash,0) else 0 end) as sales_before   ,sum(case when (cast(d_date as date) >= cast ('2001-04-02' as date))   		then cs_sales_price - coalesce(cr_refunded_cash,0) else 0 end) as sales_after  from    catalog_sales left outer join catalog_returns on        (cs_order_number = cr_order_number          and cs_item_sk = cr_item_sk)   ,warehouse    ,item   ,date_dim  where      i_current_price between 0.99 and 1.49  and i_item_sk          = cs_item_sk  and cs_warehouse_sk    = w_warehouse_sk   and cs_sold_date_sk    = d_date_sk  and d_date between (cast ('2001-04-02' as date) - INTERVAL 30 DAY)                 and (cast ('2001-04-02' as date) + INTERVAL 30 DAY)   group by     w_state,i_item_id  order by w_state,i_item_id  LIMIT 100
┌────────────────────────────────────────────────┐
│┌──────────────────────────────────────────────┐│
││              Total Time: 0.0548s             ││
│└──────────────────────────────────────────────┘│
└────────────────────────────────────────────────┘
┌───────────────────────────┐
│           QUERY           │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│      EXPLAIN_ANALYZE      │
│    ────────────────────   │
│           0 rows          │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│           TOP_N           │
│    ────────────────────   │
│          Top: 100         │
│                           │
│         Order By:         │
│ tpcds_sf10.main.warehouse │
│        .w_state ASC       │
│    tpcds_sf10.main.item   │
│       .i_item_id ASC      │
│                           │
│          100 rows         │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│__internal_decompress_strin│
│           g(#0)           │
│             #1            │
│             #2            │
│             #3            │
│                           │
│         5,419 rows        │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│       HASH_GROUP_BY       │
│    ────────────────────   │
│          Groups:          │
│             #0            │
│             #1            │
│                           │
│        Aggregates:        │
│          sum(#2)          │
│          sum(#3)          │
│                           │
│         5,419 rows        │
│          (0.01s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│          w_state          │
│         i_item_id         │
│   CASE  WHEN ((d_date <   │
│ '2001-04-02'::DATE)) THEN │
│  ((CAST(cs_sales_price AS │
│  DECIMAL(13,2)) - COALESCE│
│ (CAST(cr_refunded_cash AS │
│   DECIMAL(12,2)), 0.00))) │
│        ELSE 0.00 END      │
│  CASE  WHEN ((d_date >=   │
│ '2001-04-02'::DATE)) THEN │
│  ((CAST(cs_sales_price AS │
│  DECIMAL(13,2)) - COALESCE│
│ (CAST(cr_refunded_cash AS │
│   DECIMAL(12,2)), 0.00))) │
│        ELSE 0.00 END      │
│                           │
│        17,762 rows        │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│             #0            │
│             #1            │
│             #2            │
│             #3            │
│__internal_compress_string_│
│        uinteger(#4)       │
│                           │
│        17,762 rows        │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         HASH_JOIN         │
│    ────────────────────   │
│      Join Type: INNER     │
│                           │
│        Conditions:        │
│     cs_warehouse_sk =     ├─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│       w_warehouse_sk      │                                                                                                     │
│                           │                                                                                                     │
│        17,762 rows        │                                                                                                     │
│          (0.00s)          │                                                                                                     │
└─────────────┬─────────────┘                                                                                                     │
┌─────────────┴─────────────┐                                                                                       ┌─────────────┴─────────────┐
│         HASH_JOIN         │                                                                                       │         TABLE_SCAN        │
│    ────────────────────   │                                                                                       │    ────────────────────   │
│      Join Type: INNER     │                                                                                       │      Table: warehouse     │
│                           │                                                                                       │   Type: Sequential Scan   │
│        Conditions:        │                                                                                       │                           │
│   cs_item_sk = i_item_sk  ├────────────────────────────────────────────────────────────────────────┐              │        Projections:       │
│                           │                                                                        │              │       w_warehouse_sk      │
│                           │                                                                        │              │          w_state          │
│                           │                                                                        │              │                           │
│        17,762 rows        │                                                                        │              │          10 rows          │
│          (0.00s)          │                                                                        │              │          (0.00s)          │
└─────────────┬─────────────┘                                                                        │              └───────────────────────────┘
┌─────────────┴─────────────┐                                                          ┌─────────────┴─────────────┐
│         HASH_JOIN         │                                                          │         TABLE_SCAN        │
│    ────────────────────   │                                                          │    ────────────────────   │
│      Join Type: INNER     │                                                          │        Table: item        │
│                           │                                                          │   Type: Sequential Scan   │
│        Conditions:        │                                                          │                           │
│cs_sold_date_sk = d_date_sk│                                                          │        Projections:       │
│                           │                                                          │         i_item_sk         │
│                           ├───────────────────────────────────────────┐              │         i_item_id         │
│                           │                                           │              │                           │
│                           │                                           │              │          Filters:         │
│                           │                                           │              │ i_current_price>=0.99 AND │
│                           │                                           │              │    i_current_price<=1.49  │
│                           │                                           │              │                           │
│        276,995 rows       │                                           │              │         6,464 rows        │
│          (0.00s)          │                                           │              │          (0.00s)          │
└─────────────┬─────────────┘                                           │              └───────────────────────────┘
┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐
│         HASH_JOIN         │                             │           FILTER          │
│    ────────────────────   │                             │    ────────────────────   │
│      Join Type: LEFT      │                             │ (d_date_sk BETWEEN 2450815│
│                           │                             │        AND 2452653)       │
│        Conditions:        │                             │                           │
│     cs_order_number =     ├──────────────┐              │                           │
│       cr_order_number     │              │              │                           │
│  cs_item_sk = cr_item_sk  │              │              │                           │
│                           │              │              │                           │
│        276,995 rows       │              │              │          61 rows          │
│          (0.17s)          │              │              │          (0.00s)          │
└─────────────┬─────────────┘              │              └─────────────┬─────────────┘
┌─────────────┴─────────────┐┌─────────────┴─────────────┐┌─────────────┴─────────────┐
│         TABLE_SCAN        ││         TABLE_SCAN        ││         TABLE_SCAN        │
│    ────────────────────   ││    ────────────────────   ││    ────────────────────   │
│    Table: catalog_sales   ││           Table:          ││      Table: date_dim      │
│   Type: Sequential Scan   ││      catalog_returns      ││   Type: Sequential Scan   │
│                           ││                           ││                           │
│        Projections:       ││   Type: Sequential Scan   ││        Projections:       │
│      cs_order_number      ││                           ││         d_date_sk         │
│         cs_item_sk        ││        Projections:       ││           d_date          │
│      cs_warehouse_sk      ││      cr_order_number      ││                           │
│      cs_sold_date_sk      ││         cr_item_sk        ││          Filters:         │
│       cs_sales_price      ││      cr_refunded_cash     ││ (CAST(d_date AS TIMESTAMP)│
│                           ││                           ││  BETWEEN '2001-03-03 00:00│
│                           ││                           ││ :00'::TIMESTAMP AND '2001 │
│                           ││                           ││     -05-02 00:00:00':     │
│                           ││                           ││        :TIMESTAMP)        │
│                           ││                           ││                           │
│        276,995 rows       ││       1,441,224 rows      ││          61 rows          │
│          (0.01s)          ││          (0.21s)          ││          (0.00s)          │
└───────────────────────────┘└───────────────────────────┘└───────────────────────────┘

