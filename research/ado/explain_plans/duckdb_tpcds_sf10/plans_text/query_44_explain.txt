-- benchmark: tpcds
-- query_id: query_44
-- source_sql: /mnt/d/TPC-DS/queries_duckdb_converted/query_44.sql
-- database: /mnt/d/TPC-DS/tpcds_sf10.duckdb
-- statement_count: 1
-- client_elapsed_ms: 7.613
-- execution_time_ms: 0.000

analyzed_plan
┌─────────────────────────────────────┐
│┌───────────────────────────────────┐│
││    Query Profiling Information    ││
│└───────────────────────────────────┘│
└─────────────────────────────────────┘
EXPLAIN ANALYZE select asceding.rnk, i1.i_product_name best_performing, i2.i_product_name worst_performing from(select *      from (select item_sk,rank() over (order by rank_col asc) rnk            from (select ss_item_sk item_sk,avg(ss_net_profit) rank_col                   from store_sales ss1                  where ss_store_sk = 146                  group by ss_item_sk                  having avg(ss_net_profit) > 0.9*(select avg(ss_net_profit) rank_col                                                   from store_sales                                                   where ss_store_sk = 146                                                     and ss_addr_sk is null                                                   group by ss_store_sk))V1)V11      where rnk  < 11) asceding,     (select *      from (select item_sk,rank() over (order by rank_col desc) rnk            from (select ss_item_sk item_sk,avg(ss_net_profit) rank_col                  from store_sales ss1                  where ss_store_sk = 146                  group by ss_item_sk                  having avg(ss_net_profit) > 0.9*(select avg(ss_net_profit) rank_col                                                   from store_sales                                                   where ss_store_sk = 146                                                     and ss_addr_sk is null                                                   group by ss_store_sk))V2)V21      where rnk  < 11) descending, item i1, item i2 where asceding.rnk = descending.rnk    and i1.i_item_sk=asceding.item_sk   and i2.i_item_sk=descending.item_sk order by asceding.rnk  LIMIT 100
┌────────────────────────────────────────────────┐
│┌──────────────────────────────────────────────┐│
││              Total Time: 0.0056s             ││
│└──────────────────────────────────────────────┘│
└────────────────────────────────────────────────┘
┌───────────────────────────┐
│           QUERY           │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│      EXPLAIN_ANALYZE      │
│    ────────────────────   │
│           0 rows          │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│           TOP_N           │
│    ────────────────────   │
│          Top: 100         │
│                           │
│         Order By:         │
│      asceding.rnk ASC     │
│                           │
│           0 rows          │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│            rnk            │
│      best_performing      │
│      worst_performing     │
│                           │
│           0 rows          │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         HASH_JOIN         │
│    ────────────────────   │
│      Join Type: INNER     │
│   Conditions: rnk = rnk   ├────────────────────────────────────────────────────────────────────────┐
│                           │                                                                        │
│           0 rows          │                                                                        │
│          (0.00s)          │                                                                        │
└─────────────┬─────────────┘                                                                        │
┌─────────────┴─────────────┐                                                          ┌─────────────┴─────────────┐
│         HASH_JOIN         │                                                          │         HASH_JOIN         │
│    ────────────────────   │                                                          │    ────────────────────   │
│      Join Type: INNER     │                                                          │      Join Type: INNER     │
│                           │                                                          │                           │
│        Conditions:        ├──────────────┐                                           │        Conditions:        ├──────────────┐
│    i_item_sk = item_sk    │              │                                           │    i_item_sk = item_sk    │              │
│                           │              │                                           │                           │              │
│           0 rows          │              │                                           │           0 rows          │              │
│          (0.00s)          │              │                                           │          (0.00s)          │              │
└─────────────┬─────────────┘              │                                           └─────────────┬─────────────┘              │
┌─────────────┴─────────────┐┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐┌─────────────┴─────────────┐
│         TABLE_SCAN        ││         PROJECTION        │                             │         TABLE_SCAN        ││         PROJECTION        │
│    ────────────────────   ││    ────────────────────   │                             │    ────────────────────   ││    ────────────────────   │
│        Table: item        ││             #0            │                             │        Table: item        ││             #0            │
│   Type: Sequential Scan   ││             #2            │                             │   Type: Sequential Scan   ││             #2            │
│                           ││                           │                             │                           ││                           │
│        Projections:       ││                           │                             │        Projections:       ││                           │
│         i_item_sk         ││                           │                             │         i_item_sk         ││                           │
│       i_product_name      ││                           │                             │       i_product_name      ││                           │
│                           ││                           │                             │                           ││                           │
│         2,048 rows        ││           0 rows          │                             │         2,048 rows        ││           0 rows          │
│          (0.00s)          ││          (0.00s)          │                             │          (0.00s)          ││          (0.00s)          │
└───────────────────────────┘└─────────────┬─────────────┘                             └───────────────────────────┘└─────────────┬─────────────┘
                             ┌─────────────┴─────────────┐                                                          ┌─────────────┴─────────────┐
                             │           FILTER          │                                                          │           FILTER          │
                             │    ────────────────────   │                                                          │    ────────────────────   │
                             │         (rnk < 11)        │                                                          │         (rnk < 11)        │
                             │                           │                                                          │                           │
                             │           0 rows          │                                                          │           0 rows          │
                             │          (0.00s)          │                                                          │          (0.00s)          │
                             └─────────────┬─────────────┘                                                          └─────────────┬─────────────┘
                             ┌─────────────┴─────────────┐                                                          ┌─────────────┴─────────────┐
                             │         PROJECTION        │                                                          │         PROJECTION        │
                             │    ────────────────────   │                                                          │    ────────────────────   │
                             │             #0            │                                                          │             #0            │
                             │             #1            │                                                          │             #1            │
                             │             #2            │                                                          │             #2            │
                             │                           │                                                          │                           │
                             │           0 rows          │                                                          │           0 rows          │
                             │          (0.00s)          │                                                          │          (0.00s)          │
                             └─────────────┬─────────────┘                                                          └─────────────┬─────────────┘
                             ┌─────────────┴─────────────┐                                                          ┌─────────────┴─────────────┐
                             │           WINDOW          │                                                          │           WINDOW          │
                             │    ────────────────────   │                                                          │    ────────────────────   │
                             │        Projections:       │                                                          │        Projections:       │
                             │   RANK() OVER (ORDER BY   │                                                          │   RANK() OVER (ORDER BY   │
                             │  rank_col ASC NULLS LAST) │                                                          │  rank_col DESC NULLS LAST)│
                             │                           │                                                          │                           │
                             │           0 rows          │                                                          │           0 rows          │
                             │          (0.00s)          │                                                          │          (0.00s)          │
                             └─────────────┬─────────────┘                                                          └─────────────┬─────────────┘
                             ┌─────────────┴─────────────┐                                                          ┌─────────────┴─────────────┐
                             │         PROJECTION        │                                                          │         PROJECTION        │
                             │    ────────────────────   │                                                          │    ────────────────────   │
                             │          item_sk          │                                                          │          item_sk          │
                             │          rank_col         │                                                          │          rank_col         │
                             │                           │                                                          │                           │
                             │           0 rows          │                                                          │           0 rows          │
                             │          (0.00s)          │                                                          │          (0.00s)          │
                             └─────────────┬─────────────┘                                                          └─────────────┬─────────────┘
                             ┌─────────────┴─────────────┐                                                          ┌─────────────┴─────────────┐
                             │      NESTED_LOOP_JOIN     │                                                          │      NESTED_LOOP_JOIN     │
                             │    ────────────────────   │                                                          │    ────────────────────   │
                             │      Join Type: INNER     │                                                          │      Join Type: INNER     │
                             │                           │                                                          │                           │
                             │        Conditions:        │                                                          │        Conditions:        │
                             │ avg(ss_net_profit) > (0.9 ├──────────────┐                                           │ avg(ss_net_profit) > (0.9 ├──────────────┐
                             │        * SUBQUERY)        │              │                                           │        * SUBQUERY)        │              │
                             │                           │              │                                           │                           │              │
                             │           0 rows          │              │                                           │           0 rows          │              │
                             │          (0.00s)          │              │                                           │          (0.00s)          │              │
                             └─────────────┬─────────────┘              │                                           └─────────────┬─────────────┘              │
                             ┌─────────────┴─────────────┐┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐┌─────────────┴─────────────┐
                             │       HASH_GROUP_BY       ││         PROJECTION        │                             │       HASH_GROUP_BY       ││         PROJECTION        │
                             │    ────────────────────   ││    ────────────────────   │                             │    ────────────────────   ││    ────────────────────   │
                             │         Groups: #0        ││ CASE  WHEN ((#1 > 1)) THEN│                             │         Groups: #0        ││ CASE  WHEN ((#1 > 1)) THEN│
                             │    Aggregates: avg(#1)    ││   ("error"('More than one │                             │    Aggregates: avg(#1)    ││   ("error"('More than one │
                             │                           ││      row returned by a    │                             │                           ││      row returned by a    │
                             │                           ││     subquery used as an   │                             │                           ││     subquery used as an   │
                             │                           ││     expression - scalar   │                             │                           ││     expression - scalar   │
                             │                           ││     subqueries can only   │                             │                           ││     subqueries can only   │
                             │                           ││    return a single row.   │                             │                           ││    return a single row.   │
                             │                           ││          Use "SET         │                             │                           ││          Use "SET         │
                             │                           ││ scalar_subquery_error_on_m│                             │                           ││ scalar_subquery_error_on_m│
                             │                           ││   ultiple_rows=false" to  │                             │                           ││   ultiple_rows=false" to  │
                             │                           ││     revert to previous    │                             │                           ││     revert to previous    │
                             │                           ││   behavior of returning a │                             │                           ││   behavior of returning a │
                             │                           ││ random row.')) ELSE #0 END│                             │                           ││ random row.')) ELSE #0 END│
                             │                           ││                           │                             │                           ││                           │
                             │           0 rows          ││           1 row           │                             │           0 rows          ││           1 row           │
                             │          (0.00s)          ││          (0.00s)          │                             │          (0.00s)          ││          (0.00s)          │
                             └─────────────┬─────────────┘└─────────────┬─────────────┘                             └─────────────┬─────────────┘└─────────────┬─────────────┘
                             ┌─────────────┴─────────────┐┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐┌─────────────┴─────────────┐
                             │         PROJECTION        ││    UNGROUPED_AGGREGATE    │                             │         PROJECTION        ││    UNGROUPED_AGGREGATE    │
                             │    ────────────────────   ││    ────────────────────   │                             │    ────────────────────   ││    ────────────────────   │
                             │         ss_item_sk        ││        Aggregates:        │                             │         ss_item_sk        ││        Aggregates:        │
                             │       ss_net_profit       ││        "first"(#0)        │                             │       ss_net_profit       ││        "first"(#0)        │
                             │                           ││        count_star()       │                             │                           ││        count_star()       │
                             │                           ││                           │                             │                           ││                           │
                             │           0 rows          ││           1 row           │                             │           0 rows          ││           1 row           │
                             │          (0.00s)          ││          (0.00s)          │                             │          (0.00s)          ││          (0.00s)          │
                             └─────────────┬─────────────┘└─────────────┬─────────────┘                             └─────────────┬─────────────┘└─────────────┬─────────────┘
                             ┌─────────────┴─────────────┐┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐┌─────────────┴─────────────┐
                             │        EMPTY_RESULT       ││         PROJECTION        │                             │        EMPTY_RESULT       ││         PROJECTION        │
                             │    ────────────────────   ││    ────────────────────   │                             │    ────────────────────   ││    ────────────────────   │
                             │                           ││             #0            │                             │                           ││             #0            │
                             │                           ││                           │                             │                           ││                           │
                             │           0 rows          ││           0 rows          │                             │           0 rows          ││           0 rows          │
                             │          (0.00s)          ││          (0.00s)          │                             │          (0.00s)          ││          (0.00s)          │
                             └───────────────────────────┘└─────────────┬─────────────┘                             └───────────────────────────┘└─────────────┬─────────────┘
                                                          ┌─────────────┴─────────────┐                                                          ┌─────────────┴─────────────┐
                                                          │         PROJECTION        │                                                          │         PROJECTION        │
                                                          │    ────────────────────   │                                                          │    ────────────────────   │
                                                          │          rank_col         │                                                          │          rank_col         │
                                                          │                           │                                                          │                           │
                                                          │           0 rows          │                                                          │           0 rows          │
                                                          │          (0.00s)          │                                                          │          (0.00s)          │
                                                          └─────────────┬─────────────┘                                                          └─────────────┬─────────────┘
                                                          ┌─────────────┴─────────────┐                                                          ┌─────────────┴─────────────┐
                                                          │         PROJECTION        │                                                          │         PROJECTION        │
                                                          │    ────────────────────   │                                                          │    ────────────────────   │
                                                          │__internal_decompress_integ│                                                          │__internal_decompress_integ│
                                                          │     ral_integer(#0, 1)    │                                                          │     ral_integer(#0, 1)    │
                                                          │             #1            │                                                          │             #1            │
                                                          │                           │                                                          │                           │
                                                          │           0 rows          │                                                          │           0 rows          │
                                                          │          (0.00s)          │                                                          │          (0.00s)          │
                                                          └─────────────┬─────────────┘                                                          └─────────────┬─────────────┘
                                                          ┌─────────────┴─────────────┐                                                          ┌─────────────┴─────────────┐
                                                          │   PERFECT_HASH_GROUP_BY   │                                                          │   PERFECT_HASH_GROUP_BY   │
                                                          │    ────────────────────   │                                                          │    ────────────────────   │
                                                          │         Groups: #0        │                                                          │         Groups: #0        │
                                                          │    Aggregates: avg(#1)    │                                                          │    Aggregates: avg(#1)    │
                                                          │                           │                                                          │                           │
                                                          │           0 rows          │                                                          │           0 rows          │
                                                          │          (0.00s)          │                                                          │          (0.00s)          │
                                                          └─────────────┬─────────────┘                                                          └─────────────┬─────────────┘
                                                          ┌─────────────┴─────────────┐                                                          ┌─────────────┴─────────────┐
                                                          │         PROJECTION        │                                                          │         PROJECTION        │
                                                          │    ────────────────────   │                                                          │    ────────────────────   │
                                                          │        ss_store_sk        │                                                          │        ss_store_sk        │
                                                          │       ss_net_profit       │                                                          │       ss_net_profit       │
                                                          │                           │                                                          │                           │
                                                          │           0 rows          │                                                          │           0 rows          │
                                                          │          (0.00s)          │                                                          │          (0.00s)          │
                                                          └─────────────┬─────────────┘                                                          └─────────────┬─────────────┘
                                                          ┌─────────────┴─────────────┐                                                          ┌─────────────┴─────────────┐
                                                          │         PROJECTION        │                                                          │         PROJECTION        │
                                                          │    ────────────────────   │                                                          │    ────────────────────   │
                                                          │__internal_compress_integra│                                                          │__internal_compress_integra│
                                                          │     l_utinyint(#0, 1)     │                                                          │     l_utinyint(#0, 1)     │
                                                          │             #1            │                                                          │             #1            │
                                                          │                           │                                                          │                           │
                                                          │           0 rows          │                                                          │           0 rows          │
                                                          │          (0.00s)          │                                                          │          (0.00s)          │
                                                          └─────────────┬─────────────┘                                                          └─────────────┬─────────────┘
                                                          ┌─────────────┴─────────────┐                                                          ┌─────────────┴─────────────┐
                                                          │        EMPTY_RESULT       │                                                          │        EMPTY_RESULT       │
                                                          │    ────────────────────   │                                                          │    ────────────────────   │
                                                          │           0 rows          │                                                          │           0 rows          │
                                                          │          (0.00s)          │                                                          │          (0.00s)          │
                                                          └───────────────────────────┘                                                          └───────────────────────────┘

