-- benchmark: tpcds
-- query_id: query_31
-- source_sql: /mnt/d/TPC-DS/queries_duckdb_converted/query_31.sql
-- database: /mnt/d/TPC-DS/tpcds_sf10.duckdb
-- statement_count: 1
-- client_elapsed_ms: 128.348
-- execution_time_ms: 0.000

analyzed_plan
┌─────────────────────────────────────┐
│┌───────────────────────────────────┐│
││    Query Profiling Information    ││
│└───────────────────────────────────┘│
└─────────────────────────────────────┘
EXPLAIN ANALYZE with ss as  (select ca_county,d_qoy, d_year,sum(ss_ext_sales_price) as store_sales  from store_sales,date_dim,customer_address  where ss_sold_date_sk = d_date_sk   and ss_addr_sk=ca_address_sk  group by ca_county,d_qoy, d_year),  ws as  (select ca_county,d_qoy, d_year,sum(ws_ext_sales_price) as web_sales  from web_sales,date_dim,customer_address  where ws_sold_date_sk = d_date_sk   and ws_bill_addr_sk=ca_address_sk  group by ca_county,d_qoy, d_year)  select          ss1.ca_county        ,ss1.d_year        ,ws2.web_sales/ws1.web_sales web_q1_q2_increase        ,ss2.store_sales/ss1.store_sales store_q1_q2_increase        ,ws3.web_sales/ws2.web_sales web_q2_q3_increase        ,ss3.store_sales/ss2.store_sales store_q2_q3_increase  from         ss ss1        ,ss ss2        ,ss ss3        ,ws ws1        ,ws ws2        ,ws ws3  where     ss1.d_qoy = 1     and ss1.d_year = 2000     and ss1.ca_county = ss2.ca_county     and ss2.d_qoy = 2     and ss2.d_year = 2000  and ss2.ca_county = ss3.ca_county     and ss3.d_qoy = 3     and ss3.d_year = 2000     and ss1.ca_county = ws1.ca_county     and ws1.d_qoy = 1     and ws1.d_year = 2000     and ws1.ca_county = ws2.ca_county     and ws2.d_qoy = 2     and ws2.d_year = 2000     and ws1.ca_county = ws3.ca_county     and ws3.d_qoy = 3     and ws3.d_year =2000     and case when ws1.web_sales > 0 then ws2.web_sales/ws1.web_sales else null end         > case when ss1.store_sales > 0 then ss2.store_sales/ss1.store_sales else null end     and case when ws2.web_sales > 0 then ws3.web_sales/ws2.web_sales else null end        > case when ss2.store_sales > 0 then ss3.store_sales/ss2.store_sales else null end  order by web_q1_q2_increase
┌────────────────────────────────────────────────┐
│┌──────────────────────────────────────────────┐│
││              Total Time: 0.126s              ││
│└──────────────────────────────────────────────┘│
└────────────────────────────────────────────────┘
┌─────────────────┐
│      QUERY      │
└────────┬────────┘
┌────────┴────────┐
│ EXPLAIN_ANALYZE │
│    ──────────   │
│      0 rows     │
│     (0.00s)     │
└────────┬────────┘
┌────────┴────────┐
│       CTE       │
│    ──────────   │
│    CTE Name:    │
│        ss       │
│                 │
│   Table Index:  ├───────────────────────────────────────────────┐
│        0        │                                               │
│                 │                                               │
│      0 rows     │                                               │
│     (0.00s)     │                                               │
└────────┬────────┘                                               │
┌────────┴────────┐                                      ┌────────┴────────┐
│    PROJECTION   │                                      │       CTE       │
│    ──────────   │                                      │    ──────────   │
│        #0       │                                      │    CTE Name:    │
│__internal_decomp│                                      │        ws       │
│ress_integral_int│                                      │                 │
│   eger(#1, 1)   │                                      │   Table Index:  │
│__internal_decomp│                                      │        10       ├───────────────────────────────────────────────┐
│ress_integral_int│                                      │                 │                                               │
│  eger(#2, 1900) │                                      │                 │                                               │
│        #3       │                                      │                 │                                               │
│                 │                                      │                 │                                               │
│    5,541 rows   │                                      │      0 rows     │                                               │
│     (0.00s)     │                                      │     (0.00s)     │                                               │
└────────┬────────┘                                      └────────┬────────┘                                               │
┌────────┴────────┐                                      ┌────────┴────────┐                                      ┌────────┴────────┐
│  HASH_GROUP_BY  │                                      │    PROJECTION   │                                      │     ORDER_BY    │
│    ──────────   │                                      │    ──────────   │                                      │    ──────────   │
│     Groups:     │                                      │        #0       │                                      │ (ws2.web_sales /│
│        #0       │                                      │__internal_decomp│                                      │  ws1.web_sales) │
│        #1       │                                      │ress_integral_int│                                      │        ASC      │
│        #2       │                                      │   eger(#1, 1)   │                                      │                 │
│                 │                                      │__internal_decomp│                                      │                 │
│   Aggregates:   │                                      │ress_integral_int│                                      │                 │
│     sum(#3)     │                                      │  eger(#2, 1900) │                                      │                 │
│                 │                                      │        #3       │                                      │                 │
│                 │                                      │                 │                                      │                 │
│    5,541 rows   │                                      │    5,535 rows   │                                      │     307 rows    │
│     (0.29s)     │                                      │     (0.00s)     │                                      │     (0.00s)     │
└────────┬────────┘                                      └────────┬────────┘                                      └────────┬────────┘
┌────────┴────────┐                                      ┌────────┴────────┐                                      ┌────────┴────────┐
│    PROJECTION   │                                      │  HASH_GROUP_BY  │                                      │    PROJECTION   │
│    ──────────   │                                      │    ──────────   │                                      │    ──────────   │
│    ca_county    │                                      │     Groups:     │                                      │    ca_county    │
│      d_qoy      │                                      │        #0       │                                      │      d_year     │
│      d_year     │                                      │        #1       │                                      │web_q1_q2_increas│
│ss_ext_sales_pric│                                      │        #2       │                                      │        e        │
│        e        │                                      │                 │                                      │store_q1_q2_incre│
│                 │                                      │   Aggregates:   │                                      │       ase       │
│                 │                                      │     sum(#3)     │                                      │web_q2_q3_increas│
│                 │                                      │                 │                                      │        e        │
│                 │                                      │                 │                                      │store_q2_q3_incre│
│                 │                                      │                 │                                      │       ase       │
│                 │                                      │                 │                                      │                 │
│  3,022,624 rows │                                      │    5,535 rows   │                                      │     307 rows    │
│     (0.01s)     │                                      │     (0.09s)     │                                      │     (0.00s)     │
└────────┬────────┘                                      └────────┬────────┘                                      └────────┬────────┘
┌────────┴────────┐                                      ┌────────┴────────┐                                      ┌────────┴────────┐
│    PROJECTION   │                                      │    PROJECTION   │                                      │    PROJECTION   │
│    ──────────   │                                      │    ──────────   │                                      │    ──────────   │
│        #0       │                                      │    ca_county    │                                      │    ca_county    │
│__internal_compre│                                      │      d_qoy      │                                      │      d_year     │
│ss_integral_utiny│                                      │      d_year     │                                      │  CAST(web_sales │
│    int(#1, 1)   │                                      │ws_ext_sales_pric│                                      │    AS DOUBLE)   │
│__internal_compre│                                      │        e        │                                      │    web_sales    │
│ss_integral_utiny│                                      │                 │                                      │ CAST(store_sales│
│  int(#2, 1900)  │                                      │                 │                                      │    AS DOUBLE)   │
│        #3       │                                      │                 │                                      │   store_sales   │
│                 │                                      │                 │                                      │    web_sales    │
│                 │                                      │                 │                                      │   store_sales   │
│                 │                                      │                 │                                      │                 │
│  3,022,624 rows │                                      │   811,689 rows  │                                      │     307 rows    │
│     (0.03s)     │                                      │     (0.00s)     │                                      │     (0.00s)     │
└────────┬────────┘                                      └────────┬────────┘                                      └────────┬────────┘
┌────────┴────────┐                                      ┌────────┴────────┐                                      ┌────────┴────────┐
│    HASH_JOIN    │                                      │    PROJECTION   │                                      │    HASH_JOIN    │
│    ──────────   │                                      │    ──────────   │                                      │    ──────────   │
│    Join Type:   │                                      │        #0       │                                      │    Join Type:   │
│      INNER      │                                      │__internal_compre│                                      │      INNER      │
│                 │                                      │ss_integral_utiny│                                      │                 │
│   Conditions:   │                                      │    int(#1, 1)   │                                      │   Conditions:   │
│   ss_addr_sk =  │                                      │__internal_compre│                                      │   ca_county =   │
│   ca_address_sk │                                      │ss_integral_utiny│                                      │     ca_county   │
│                 │                                      │  int(#2, 1900)  │                                      │   ca_county =   │
│                 │                                      │        #3       │                                      │     ca_county   │
│                 │                                      │                 │                                      │   ca_county =   │
│                 │                                      │                 │                                      │     ca_county   │
│                 │                                      │                 │                                      │   CASE  WHEN (  │
│                 │                                      │                 │                                      │ (store_sales > 0│
│                 │                                      │                 │                                      │   .00)) THEN (  │
│                 │                                      │                 │                                      │(CAST(store_sales│
│                 │                                      │                 │                                      │   AS DOUBLE) /  │
│                 │                                      │                 │                                      │ CAST(store_sales│
│                 │                                      │                 │                                      │   AS DOUBLE)))  │
│                 │                                      │                 │                                      │  ELSE NULL END <│
│                 │                                      │                 │                                      │   CASE  WHEN (  │
│                 │                                      │                 │                                      │  (web_sales > 0 │
│                 │                                      │                 │                                      │   .00)) THEN (  │
│                 ├────────────────────────────┐         │                 │                                      │ (CAST(web_sales ├───────────────────────────────────────────────┐
│                 │                            │         │                 │                                      │   AS DOUBLE) /  │                                               │
│                 │                            │         │                 │                                      │  CAST(web_sales │                                               │
│                 │                            │         │                 │                                      │   AS DOUBLE)))  │                                               │
│                 │                            │         │                 │                                      │   ELSE NULL END │                                               │
│                 │                            │         │                 │                                      │   CASE  WHEN (  │                                               │
│                 │                            │         │                 │                                      │ (store_sales > 0│                                               │
│                 │                            │         │                 │                                      │   .00)) THEN (  │                                               │
│                 │                            │         │                 │                                      │(CAST(store_sales│                                               │
│                 │                            │         │                 │                                      │   AS DOUBLE) /  │                                               │
│                 │                            │         │                 │                                      │ CAST(store_sales│                                               │
│                 │                            │         │                 │                                      │   AS DOUBLE)))  │                                               │
│                 │                            │         │                 │                                      │  ELSE NULL END <│                                               │
│                 │                            │         │                 │                                      │   CASE  WHEN (  │                                               │
│                 │                            │         │                 │                                      │  (web_sales > 0 │                                               │
│                 │                            │         │                 │                                      │   .00)) THEN (  │                                               │
│                 │                            │         │                 │                                      │ (CAST(web_sales │                                               │
│                 │                            │         │                 │                                      │   AS DOUBLE) /  │                                               │
│                 │                            │         │                 │                                      │  CAST(web_sales │                                               │
│                 │                            │         │                 │                                      │   AS DOUBLE)))  │                                               │
│                 │                            │         │                 │                                      │   ELSE NULL END │                                               │
│                 │                            │         │                 │                                      │                 │                                               │
│  3,022,624 rows │                            │         │   811,689 rows  │                                      │     307 rows    │                                               │
│     (0.04s)     │                            │         │     (0.01s)     │                                      │     (0.00s)     │                                               │
└────────┬────────┘                            │         └────────┬────────┘                                      └────────┬────────┘                                               │
┌────────┴────────┐                   ┌────────┴────────┐┌────────┴────────┐                                      ┌────────┴────────┐                                      ┌────────┴────────┐
│    HASH_JOIN    │                   │    TABLE_SCAN   ││    HASH_JOIN    │                                      │    HASH_JOIN    │                                      │    HASH_JOIN    │
│    ──────────   │                   │    ──────────   ││    ──────────   │                                      │    ──────────   │                                      │    ──────────   │
│    Join Type:   │                   │      Table:     ││    Join Type:   │                                      │    Join Type:   │                                      │    Join Type:   │
│      INNER      │                   │ customer_address││      INNER      │                                      │      INNER      │                                      │      INNER      │
│                 │                   │                 ││                 │                                      │                 │                                      │                 │
│   Conditions:   │                   │      Type:      ││   Conditions:   │                                      │   Conditions:   │                                      │   Conditions:   │
│ ss_sold_date_sk │                   │ Sequential Scan ││ ws_bill_addr_sk │                                      │   ca_county =   │                                      │   ca_county =   │
│   = d_date_sk   ├─────────┐         │                 ││ = ca_address_sk ├────────────────────────────┐         │     ca_county   ├────────────────────────────┐         │     ca_county   ├────────────────────────────┐
│                 │         │         │   Projections:  ││                 │                            │         │   ca_county =   │                            │         │   ca_county =   │                            │
│                 │         │         │  ca_address_sk  ││                 │                            │         │     ca_county   │                            │         │     ca_county   │                            │
│                 │         │         │    ca_county    ││                 │                            │         │                 │                            │         │                 │                            │
│                 │         │         │                 ││                 │                            │         │                 │                            │         │                 │                            │
│  3,022,624 rows │         │         │   250,000 rows  ││   811,689 rows  │                            │         │    1,846 rows   │                            │         │    1,840 rows   │                            │
│     (0.04s)     │         │         │     (0.00s)     ││     (0.02s)     │                            │         │     (0.00s)     │                            │         │     (0.00s)     │                            │
└────────┬────────┘         │         └─────────────────┘└────────┬────────┘                            │         └────────┬────────┘                            │         └────────┬────────┘                            │
┌────────┴────────┐┌────────┴────────┐                   ┌────────┴────────┐                   ┌────────┴────────┐┌────────┴────────┐                   ┌────────┴────────┐┌────────┴────────┐                   ┌────────┴────────┐
│    TABLE_SCAN   ││      FILTER     │                   │    HASH_JOIN    │                   │    TABLE_SCAN   ││    HASH_JOIN    │                   │    PROJECTION   ││    HASH_JOIN    │                   │    PROJECTION   │
│    ──────────   ││    ──────────   │                   │    ──────────   │                   │    ──────────   ││    ──────────   │                   │    ──────────   ││    ──────────   │                   │    ──────────   │
│      Table:     ││  (((d_qoy = 3)  │                   │    Join Type:   │                   │      Table:     ││    Join Type:   │                   │        #0       ││    Join Type:   │                   │        #0       │
│   store_sales   ││   AND (d_year = │                   │      INNER      │                   │ customer_address││      INNER      │                   │        #2       ││      INNER      │                   │        #3       │
│                 ││   2000)) OR ((  │                   │                 │                   │                 ││                 │                   │        #3       ││                 │                   │                 │
│      Type:      ││ (d_qoy = 1) AND │                   │   Conditions:   │                   │      Type:      ││   Conditions:   │                   │                 ││   Conditions:   │                   │                 │
│ Sequential Scan ││ (d_year = 2000))│                   │ ws_sold_date_sk │                   │ Sequential Scan ││   ca_county =   │                   │                 ││   ca_county =   │                   │                 │
│                 ││  OR ((d_qoy = 2)│                   │   = d_date_sk   │                   │                 ││     ca_county   │                   │                 ││     ca_county   │                   │                 │
│   Projections:  ││   AND (d_year = │                   │                 ├─────────┐         │   Projections:  ││                 ├─────────┐         │                 ││                 ├─────────┐         │                 │
│ ss_sold_date_sk ││     2000))))    │                   │                 │         │         │  ca_address_sk  ││                 │         │         │                 ││                 │         │         │                 │
│    ss_addr_sk   ││                 │                   │                 │         │         │    ca_county    ││                 │         │         │                 ││                 │         │         │                 │
│ss_ext_sales_pric││                 │                   │                 │         │         │                 ││                 │         │         │                 ││                 │         │         │                 │
│        e        ││                 │                   │                 │         │         │                 ││                 │         │         │                 ││                 │         │         │                 │
│                 ││                 │                   │                 │         │         │                 ││                 │         │         │                 ││                 │         │         │                 │
│  3,022,624 rows ││     274 rows    │                   │   811,689 rows  │         │         │   250,000 rows  ││    1,846 rows   │         │         │    1,847 rows   ││    1,844 rows   │         │         │    1,843 rows   │
│     (0.30s)     ││     (0.00s)     │                   │     (0.01s)     │         │         │     (0.00s)     ││     (0.00s)     │         │         │     (0.00s)     ││     (0.00s)     │         │         │     (0.00s)     │
└─────────────────┘└────────┬────────┘                   └────────┬────────┘         │         └─────────────────┘└────────┬────────┘         │         └────────┬────────┘└────────┬────────┘         │         └────────┬────────┘
                   ┌────────┴────────┐                   ┌────────┴────────┐┌────────┴────────┐                   ┌────────┴────────┐┌────────┴────────┐┌────────┴────────┐┌────────┴────────┐┌────────┴────────┐┌────────┴────────┐
                   │    TABLE_SCAN   │                   │    TABLE_SCAN   ││      FILTER     │                   │    PROJECTION   ││    PROJECTION   ││      FILTER     ││    PROJECTION   ││    PROJECTION   ││      FILTER     │
                   │    ──────────   │                   │    ──────────   ││    ──────────   │                   │    ──────────   ││    ──────────   ││    ──────────   ││    ──────────   ││    ──────────   ││    ──────────   │
                   │      Table:     │                   │      Table:     ││  (((d_qoy = 3)  │                   │        #0       ││        #0       ││ ((d_qoy = 1) AND││        #0       ││        #0       ││ ((d_qoy = 1) AND│
                   │     date_dim    │                   │    web_sales    ││   AND (d_year = │                   │        #3       ││        #3       ││ (d_year = 2000))││        #3       ││        #3       ││ (d_year = 2000))│
                   │                 │                   │                 ││   2000)) OR ((  │                   │                 ││                 ││                 ││                 ││                 ││                 │
                   │      Type:      │                   │      Type:      ││ (d_qoy = 1) AND │                   │                 ││                 ││                 ││                 ││                 ││                 │
                   │ Sequential Scan │                   │ Sequential Scan ││ (d_year = 2000))│                   │                 ││                 ││                 ││                 ││                 ││                 │
                   │                 │                   │                 ││  OR ((d_qoy = 2)│                   │                 ││                 ││                 ││                 ││                 ││                 │
                   │   Projections:  │                   │   Projections:  ││   AND (d_year = │                   │                 ││                 ││                 ││                 ││                 ││                 │
                   │    d_date_sk    │                   │ ws_sold_date_sk ││     2000))))    │                   │                 ││                 ││                 ││                 ││                 ││                 │
                   │      d_qoy      │                   │ ws_bill_addr_sk ││                 │                   │                 ││                 ││                 ││                 ││                 ││                 │
                   │      d_year     │                   │ws_ext_sales_pric││                 │                   │                 ││                 ││                 ││                 ││                 ││                 │
                   │                 │                   │        e        ││                 │                   │                 ││                 ││                 ││                 ││                 ││                 │
                   │     Filters:    │                   │                 ││                 │                   │                 ││                 ││                 ││                 ││                 ││                 │
                   │    d_date_sk>   │                   │                 ││                 │                   │                 ││                 ││                 ││                 ││                 ││                 │
                   │   =2450816 AND  │                   │                 ││                 │                   │                 ││                 ││                 ││                 ││                 ││                 │
                   │    d_date_sk<   │                   │                 ││                 │                   │                 ││                 ││                 ││                 ││                 ││                 │
                   │     =2452642    │                   │                 ││                 │                   │                 ││                 ││                 ││                 ││                 ││                 │
                   │                 │                   │                 ││                 │                   │                 ││                 ││                 ││                 ││                 ││                 │
                   │    1,827 rows   │                   │   811,689 rows  ││     274 rows    │                   │    1,847 rows   ││    1,847 rows   ││    1,847 rows   ││    1,845 rows   ││    1,847 rows   ││    1,843 rows   │
                   │     (0.00s)     │                   │     (0.25s)     ││     (0.00s)     │                   │     (0.00s)     ││     (0.00s)     ││     (0.00s)     ││     (0.00s)     ││     (0.00s)     ││     (0.00s)     │
                   └─────────────────┘                   └─────────────────┘└────────┬────────┘                   └────────┬────────┘└────────┬────────┘└────────┬────────┘└────────┬────────┘└────────┬────────┘└────────┬────────┘
                                                                            ┌────────┴────────┐                   ┌────────┴────────┐┌────────┴────────┐┌────────┴────────┐┌────────┴────────┐┌────────┴────────┐┌────────┴────────┐
                                                                            │    TABLE_SCAN   │                   │      FILTER     ││      FILTER     ││     CTE_SCAN    ││      FILTER     ││      FILTER     ││     CTE_SCAN    │
                                                                            │    ──────────   │                   │    ──────────   ││    ──────────   ││    ──────────   ││    ──────────   ││    ──────────   ││    ──────────   │
                                                                            │      Table:     │                   │ ((d_qoy = 2) AND││ ((d_qoy = 3) AND││    CTE Index:   ││ ((d_qoy = 2) AND││ ((d_qoy = 3) AND││    CTE Index:   │
                                                                            │     date_dim    │                   │ (d_year = 2000))││ (d_year = 2000))││        0        ││ (d_year = 2000))││ (d_year = 2000))││        10       │
                                                                            │                 │                   │                 ││                 ││                 ││                 ││                 ││                 │
                                                                            │      Type:      │                   │                 ││                 ││                 ││                 ││                 ││                 │
                                                                            │ Sequential Scan │                   │                 ││                 ││                 ││                 ││                 ││                 │
                                                                            │                 │                   │                 ││                 ││                 ││                 ││                 ││                 │
                                                                            │   Projections:  │                   │                 ││                 ││                 ││                 ││                 ││                 │
                                                                            │    d_date_sk    │                   │                 ││                 ││                 ││                 ││                 ││                 │
                                                                            │      d_qoy      │                   │                 ││                 ││                 ││                 ││                 ││                 │
                                                                            │      d_year     │                   │                 ││                 ││                 ││                 ││                 ││                 │
                                                                            │                 │                   │                 ││                 ││                 ││                 ││                 ││                 │
                                                                            │     Filters:    │                   │                 ││                 ││                 ││                 ││                 ││                 │
                                                                            │    d_date_sk>   │                   │                 ││                 ││                 ││                 ││                 ││                 │
                                                                            │   =2450816 AND  │                   │                 ││                 ││                 ││                 ││                 ││                 │
                                                                            │    d_date_sk<   │                   │                 ││                 ││                 ││                 ││                 ││                 │
                                                                            │     =2452642    │                   │                 ││                 ││                 ││                 ││                 ││                 │
                                                                            │                 │                   │                 ││                 ││                 ││                 ││                 ││                 │
                                                                            │    1,827 rows   │                   │    1,847 rows   ││    1,847 rows   ││    5,541 rows   ││    1,845 rows   ││    1,847 rows   ││    5,535 rows   │
                                                                            │     (0.00s)     │                   │     (0.00s)     ││     (0.00s)     ││     (0.00s)     ││     (0.00s)     ││     (0.00s)     ││     (0.00s)     │
                                                                            └─────────────────┘                   └────────┬────────┘└────────┬────────┘└─────────────────┘└────────┬────────┘└────────┬────────┘└─────────────────┘
                                                                                                                  ┌────────┴────────┐┌────────┴────────┐                   ┌────────┴────────┐┌────────┴────────┐
                                                                                                                  │     CTE_SCAN    ││     CTE_SCAN    │                   │     CTE_SCAN    ││     CTE_SCAN    │
                                                                                                                  │    ──────────   ││    ──────────   │                   │    ──────────   ││    ──────────   │
                                                                                                                  │    CTE Index:   ││    CTE Index:   │                   │    CTE Index:   ││    CTE Index:   │
                                                                                                                  │        0        ││        0        │                   │        10       ││        10       │
                                                                                                                  │                 ││                 │                   │                 ││                 │
                                                                                                                  │    5,541 rows   ││    5,541 rows   │                   │    5,535 rows   ││    5,535 rows   │
                                                                                                                  │     (0.00s)     ││     (0.00s)     │                   │     (0.00s)     ││     (0.00s)     │
                                                                                                                  └─────────────────┘└─────────────────┘                   └─────────────────┘└─────────────────┘

