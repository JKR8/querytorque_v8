-- benchmark: tpcds
-- query_id: query_34
-- source_sql: /mnt/d/TPC-DS/queries_duckdb_converted/query_34.sql
-- database: /mnt/d/TPC-DS/tpcds_sf10.duckdb
-- statement_count: 1
-- client_elapsed_ms: 86.408
-- execution_time_ms: 0.000

analyzed_plan
┌─────────────────────────────────────┐
│┌───────────────────────────────────┐│
││    Query Profiling Information    ││
│└───────────────────────────────────┘│
└─────────────────────────────────────┘
EXPLAIN ANALYZE select c_last_name        ,c_first_name        ,c_salutation        ,c_preferred_cust_flag        ,ss_ticket_number        ,cnt from    (select ss_ticket_number           ,ss_customer_sk           ,count(*) cnt     from store_sales,date_dim,store,household_demographics     where store_sales.ss_sold_date_sk = date_dim.d_date_sk     and store_sales.ss_store_sk = store.s_store_sk       and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk     and (date_dim.d_dom between 1 and 3 or date_dim.d_dom between 25 and 28)     and (household_demographics.hd_buy_potential = '1001-5000' or          household_demographics.hd_buy_potential = '0-500')     and household_demographics.hd_vehicle_count > 0     and (case when household_demographics.hd_vehicle_count > 0  	then household_demographics.hd_dep_count/ household_demographics.hd_vehicle_count  	else null  	end)  > 1.2     and date_dim.d_year in (1998,1998+1,1998+2)     and store.s_county in ('Ziebach County','Daviess County','Walker County','Richland County',                            'Barrow County','Franklin Parish','Williamson County','Luce County')     group by ss_ticket_number,ss_customer_sk) dn,customer     where ss_customer_sk = c_customer_sk       and cnt between 15 and 20     order by c_last_name,c_first_name,c_salutation,c_preferred_cust_flag desc, ss_ticket_number
┌────────────────────────────────────────────────┐
│┌──────────────────────────────────────────────┐│
││              Total Time: 0.0848s             ││
│└──────────────────────────────────────────────┘│
└────────────────────────────────────────────────┘
┌───────────────────────────┐
│           QUERY           │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│      EXPLAIN_ANALYZE      │
│    ────────────────────   │
│           0 rows          │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│__internal_decompress_strin│
│           g(#0)           │
│__internal_decompress_strin│
│           g(#1)           │
│__internal_decompress_strin│
│           g(#2)           │
│__internal_decompress_strin│
│           g(#3)           │
│             #4            │
│             #5            │
│                           │
│         4,543 rows        │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│          ORDER_BY         │
│    ────────────────────   │
│  tpcds_sf10.main.customer │
│      .c_last_name ASC     │
│  tpcds_sf10.main.customer │
│     .c_first_name ASC     │
│  tpcds_sf10.main.customer │
│     .c_salutation ASC     │
│  tpcds_sf10.main.customer │
│.c_preferred_cust_flag DESC│
│  dn.ss_ticket_number ASC  │
│                           │
│         4,543 rows        │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│__internal_compress_string_│
│        uhugeint(#0)       │
│__internal_compress_string_│
│        uhugeint(#1)       │
│__internal_compress_string_│
│        ubigint(#2)        │
│__internal_compress_string_│
│        utinyint(#3)       │
│             #4            │
│             #5            │
│                           │
│         4,543 rows        │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         HASH_JOIN         │
│    ────────────────────   │
│      Join Type: INNER     │
│                           │
│        Conditions:        │
│      c_customer_sk =      ├──────────────┐
│       ss_customer_sk      │              │
│                           │              │
│         4,543 rows        │              │
│          (0.01s)          │              │
└─────────────┬─────────────┘              │
┌─────────────┴─────────────┐┌─────────────┴─────────────┐
│         TABLE_SCAN        ││           FILTER          │
│    ────────────────────   ││    ────────────────────   │
│      Table: customer      ││  (cnt BETWEEN 15 AND 20)  │
│   Type: Sequential Scan   ││                           │
│                           ││                           │
│        Projections:       ││                           │
│       c_customer_sk       ││                           │
│        c_last_name        ││                           │
│        c_first_name       ││                           │
│        c_salutation       ││                           │
│   c_preferred_cust_flag   ││                           │
│                           ││                           │
│        499,575 rows       ││         4,543 rows        │
│          (0.02s)          ││          (0.00s)          │
└───────────────────────────┘└─────────────┬─────────────┘
                             ┌─────────────┴─────────────┐
                             │       HASH_GROUP_BY       │
                             │    ────────────────────   │
                             │          Groups:          │
                             │             #0            │
                             │             #1            │
                             │                           │
                             │        Aggregates:        │
                             │        count_star()       │
                             │                           │
                             │        49,636 rows        │
                             │          (0.05s)          │
                             └─────────────┬─────────────┘
                             ┌─────────────┴─────────────┐
                             │         PROJECTION        │
                             │    ────────────────────   │
                             │      ss_ticket_number     │
                             │       ss_customer_sk      │
                             │                           │
                             │        514,574 rows       │
                             │          (0.00s)          │
                             └─────────────┬─────────────┘
                             ┌─────────────┴─────────────┐
                             │         PROJECTION        │
                             │    ────────────────────   │
                             │             #0            │
                             │             #1            │
                             │__internal_compress_integra│
                             │     l_utinyint(#2, 1)     │
                             │                           │
                             │        514,574 rows       │
                             │          (0.00s)          │
                             └─────────────┬─────────────┘
                             ┌─────────────┴─────────────┐
                             │         HASH_JOIN         │
                             │    ────────────────────   │
                             │      Join Type: INNER     │
                             │                           │
                             │        Conditions:        ├────────────────────────────────────────────────────────────────────────┐
                             │  ss_store_sk = s_store_sk │                                                                        │
                             │                           │                                                                        │
                             │        514,574 rows       │                                                                        │
                             │          (0.01s)          │                                                                        │
                             └─────────────┬─────────────┘                                                                        │
                             ┌─────────────┴─────────────┐                                                          ┌─────────────┴─────────────┐
                             │         HASH_JOIN         │                                                          │           FILTER          │
                             │    ────────────────────   │                                                          │    ────────────────────   │
                             │      Join Type: INNER     │                                                          │    (s_store_sk <= 100)    │
                             │                           │                                                          │                           │
                             │        Conditions:        ├───────────────────────────────────────────┐              │                           │
                             │ss_sold_date_sk = d_date_sk│                                           │              │                           │
                             │                           │                                           │              │                           │
                             │        524,562 rows       │                                           │              │          99 rows          │
                             │          (0.07s)          │                                           │              │          (0.00s)          │
                             └─────────────┬─────────────┘                                           │              └─────────────┬─────────────┘
                             ┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐┌─────────────┴─────────────┐
                             │         HASH_JOIN         │                             │           FILTER          ││         PROJECTION        │
                             │    ────────────────────   │                             │    ────────────────────   ││    ────────────────────   │
                             │      Join Type: INNER     │                             │ (d_date_sk BETWEEN 2450816││             #0            │
                             │                           │                             │        AND 2452642)       ││                           │
                             │        Conditions:        ├──────────────┐              │                           ││                           │
                             │  ss_hdemo_sk = hd_demo_sk │              │              │                           ││                           │
                             │                           │              │              │                           ││                           │
                             │       2,274,144 rows      │              │              │          251 rows         ││          101 rows         │
                             │          (0.09s)          │              │              │          (0.00s)          ││          (0.00s)          │
                             └─────────────┬─────────────┘              │              └─────────────┬─────────────┘└─────────────┬─────────────┘
                             ┌─────────────┴─────────────┐┌─────────────┴─────────────┐┌─────────────┴─────────────┐┌─────────────┴─────────────┐
                             │         TABLE_SCAN        ││         PROJECTION        ││         TABLE_SCAN        ││           FILTER          │
                             │    ────────────────────   ││    ────────────────────   ││    ────────────────────   ││    ────────────────────   │
                             │     Table: store_sales    ││             #0            ││      Table: date_dim      ││          IN (...)         │
                             │   Type: Sequential Scan   ││                           ││   Type: Sequential Scan   ││                           │
                             │                           ││                           ││                           ││                           │
                             │        Projections:       ││                           ││        Projections:       ││                           │
                             │      ss_sold_date_sk      ││                           ││         d_date_sk         ││                           │
                             │        ss_store_sk        ││                           ││                           ││                           │
                             │        ss_hdemo_sk        ││                           ││          Filters:         ││                           │
                             │      ss_ticket_number     ││                           ││ ((d_dom <= 3) OR ((d_dom >││                           │
                             │       ss_customer_sk      ││                           ││ = 25) AND (d_dom <= 28))) ││                           │
                             │                           ││                           ││  d_year>=1998 AND d_year< ││                           │
                             │                           ││                           ││           =2000           ││                           │
                             │                           ││                           ││                           ││                           │
                             │       9,875,252 rows      ││         1,040 rows        ││          252 rows         ││          101 rows         │
                             │          (0.53s)          ││          (0.00s)          ││          (0.00s)          ││          (0.00s)          │
                             └───────────────────────────┘└─────────────┬─────────────┘└───────────────────────────┘└─────────────┬─────────────┘
                                                          ┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐
                                                          │           FILTER          │                             │         HASH_JOIN         │
                                                          │    ────────────────────   │                             │    ────────────────────   │
                                                          │   (((hd_buy_potential =   │                             │      Join Type: MARK      │
                                                          │      '1001-5000') OR      │                             │                           │
                                                          │ (hd_buy_potential = '0-500│                             │        Conditions:        │
                                                          │   ')) AND (CASE  WHEN (   │                             │       s_county = #0       │
                                                          │  (hd_vehicle_count > 0))  │                             │                           │
                                                          │  THEN ((CAST(hd_dep_count │                             │                           ├──────────────┐
                                                          │      AS DOUBLE) / CAST    │                             │                           │              │
                                                          │    (hd_vehicle_count AS   │                             │                           │              │
                                                          │  DOUBLE))) ELSE NULL END >│                             │                           │              │
                                                          │            1.2))          │                             │                           │              │
                                                          │                           │                             │                           │              │
                                                          │         1,040 rows        │                             │          102 rows         │              │
                                                          │          (0.00s)          │                             │          (0.00s)          │              │
                                                          └─────────────┬─────────────┘                             └─────────────┬─────────────┘              │
                                                          ┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐┌─────────────┴─────────────┐
                                                          │         TABLE_SCAN        │                             │         TABLE_SCAN        ││      COLUMN_DATA_SCAN     │
                                                          │    ────────────────────   │                             │    ────────────────────   ││                           │
                                                          │           Table:          │                             │        Table: store       ││                           │
                                                          │   household_demographics  │                             │   Type: Sequential Scan   ││                           │
                                                          │                           │                             │                           ││                           │
                                                          │   Type: Sequential Scan   │                             │        Projections:       ││                           │
                                                          │                           │                             │         s_store_sk        ││                           │
                                                          │        Projections:       │                             │          s_county         ││                           │
                                                          │         hd_demo_sk        │                             │                           ││                           │
                                                          │      hd_buy_potential     │                             │          Filters:         ││                           │
                                                          │      hd_vehicle_count     │                             │  optional: s_county IN (  ││                           │
                                                          │        hd_dep_count       │                             │ 'Ziebach County', 'Daviess││                           │
                                                          │                           │                             │  County', 'Walker County',││                           │
                                                          │          Filters:         │                             │     'Richland County',    ││                           │
                                                          │ optional: hd_buy_potential│                             │ 'Barrow County', 'Franklin││                           │
                                                          │      ='1001-5000' OR      │                             │    Parish', 'Williamson   ││                           │
                                                          │  hd_buy_potential='0-500' │                             │   County', 'Luce County') ││                           │
                                                          │     hd_vehicle_count>0    │                             │                           ││                           │
                                                          │                           │                             │                           ││                           │
                                                          │         4,800 rows        │                             │          102 rows         ││           8 rows          │
                                                          │          (0.00s)          │                             │          (0.00s)          ││          (0.00s)          │
                                                          └───────────────────────────┘                             └───────────────────────────┘└───────────────────────────┘

