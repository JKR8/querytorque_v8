-- benchmark: tpcds
-- query_id: query_24
-- source_sql: /mnt/d/TPC-DS/queries_duckdb_converted/query_24.sql
-- database: /mnt/d/TPC-DS/tpcds_sf10.duckdb
-- statement_count: 2
-- client_elapsed_ms: 108.437
-- execution_time_ms: 0.000

analyzed_plan
┌─────────────────────────────────────┐
│┌───────────────────────────────────┐│
││    Query Profiling Information    ││
│└───────────────────────────────────┘│
└─────────────────────────────────────┘
EXPLAIN ANALYZE with ssales as (select c_last_name       ,c_first_name       ,s_store_name       ,ca_state       ,s_state       ,i_color       ,i_current_price       ,i_manager_id       ,i_units       ,i_size       ,sum(ss_net_profit) netpaid from store_sales     ,store_returns     ,store     ,item     ,customer     ,customer_address where ss_ticket_number = sr_ticket_number   and ss_item_sk = sr_item_sk   and ss_customer_sk = c_customer_sk   and ss_item_sk = i_item_sk   and ss_store_sk = s_store_sk   and c_current_addr_sk = ca_address_sk   and c_birth_country <> upper(ca_country)   and s_zip = ca_zip and s_market_id=8 group by c_last_name         ,c_first_name         ,s_store_name         ,ca_state         ,s_state         ,i_color         ,i_current_price         ,i_manager_id         ,i_units         ,i_size) select c_last_name       ,c_first_name       ,s_store_name       ,sum(netpaid) paid from ssales where i_color = 'beige' group by c_last_name         ,c_first_name         ,s_store_name having sum(netpaid) > (select 0.05*avg(netpaid)                                  from ssales) order by c_last_name         ,c_first_name         ,s_store_name 
┌────────────────────────────────────────────────┐
│┌──────────────────────────────────────────────┐│
││              Total Time: 0.106s              ││
│└──────────────────────────────────────────────┘│
└────────────────────────────────────────────────┘
┌───────────────────────────┐
│           QUERY           │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│      EXPLAIN_ANALYZE      │
│    ────────────────────   │
│           0 rows          │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│            CTE            │
│    ────────────────────   │
│      CTE Name: ssales     │
│       Table Index: 0      ├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                           │                                                                                                                                                               │
│           0 rows          │                                                                                                                                                               │
│          (0.00s)          │                                                                                                                                                               │
└─────────────┬─────────────┘                                                                                                                                                               │
┌─────────────┴─────────────┐                                                                                                                                                 ┌─────────────┴─────────────┐
│         PROJECTION        │                                                                                                                                                 │          ORDER_BY         │
│    ────────────────────   │                                                                                                                                                 │    ────────────────────   │
│__internal_decompress_strin│                                                                                                                                                 │   ssales.c_last_name ASC  │
│           g(#0)           │                                                                                                                                                 │  ssales.c_first_name ASC  │
│__internal_decompress_strin│                                                                                                                                                 │  ssales.s_store_name ASC  │
│           g(#1)           │                                                                                                                                                 │                           │
│__internal_decompress_strin│                                                                                                                                                 │                           │
│           g(#2)           │                                                                                                                                                 │                           │
│__internal_decompress_strin│                                                                                                                                                 │                           │
│           g(#3)           │                                                                                                                                                 │                           │
│__internal_decompress_strin│                                                                                                                                                 │                           │
│           g(#4)           │                                                                                                                                                 │                           │
│__internal_decompress_strin│                                                                                                                                                 │                           │
│           g(#5)           │                                                                                                                                                 │                           │
│             #6            │                                                                                                                                                 │                           │
│__internal_decompress_integ│                                                                                                                                                 │                           │
│     ral_integer(#7, 1)    │                                                                                                                                                 │                           │
│__internal_decompress_strin│                                                                                                                                                 │                           │
│           g(#8)           │                                                                                                                                                 │                           │
│__internal_decompress_strin│                                                                                                                                                 │                           │
│           g(#9)           │                                                                                                                                                 │                           │
│            #10            │                                                                                                                                                 │                           │
│                           │                                                                                                                                                 │                           │
│          233 rows         │                                                                                                                                                 │           1 row           │
│          (0.00s)          │                                                                                                                                                 │          (0.00s)          │
└─────────────┬─────────────┘                                                                                                                                                 └─────────────┬─────────────┘
┌─────────────┴─────────────┐                                                                                                                                                 ┌─────────────┴─────────────┐
│       HASH_GROUP_BY       │                                                                                                                                                 │         PROJECTION        │
│    ────────────────────   │                                                                                                                                                 │    ────────────────────   │
│          Groups:          │                                                                                                                                                 │        c_last_name        │
│             #0            │                                                                                                                                                 │        c_first_name       │
│             #1            │                                                                                                                                                 │        s_store_name       │
│             #2            │                                                                                                                                                 │            paid           │
│             #3            │                                                                                                                                                 │                           │
│             #4            │                                                                                                                                                 │                           │
│             #5            │                                                                                                                                                 │                           │
│             #6            │                                                                                                                                                 │                           │
│             #7            │                                                                                                                                                 │                           │
│             #8            │                                                                                                                                                 │                           │
│             #9            │                                                                                                                                                 │                           │
│                           │                                                                                                                                                 │                           │
│    Aggregates: sum(#10)   │                                                                                                                                                 │                           │
│                           │                                                                                                                                                 │                           │
│          233 rows         │                                                                                                                                                 │           1 row           │
│          (0.01s)          │                                                                                                                                                 │          (0.00s)          │
└─────────────┬─────────────┘                                                                                                                                                 └─────────────┬─────────────┘
┌─────────────┴─────────────┐                                                                                                                                                 ┌─────────────┴─────────────┐
│         PROJECTION        │                                                                                                                                                 │      NESTED_LOOP_JOIN     │
│    ────────────────────   │                                                                                                                                                 │    ────────────────────   │
│        c_last_name        │                                                                                                                                                 │      Join Type: INNER     │
│        c_first_name       │                                                                                                                                                 │                           │
│        s_store_name       │                                                                                                                                                 │        Conditions:        │
│          ca_state         │                                                                                                                                                 │    CAST(sum(netpaid) AS   │
│          s_state          │                                                                                                                                                 │     DOUBLE) > SUBQUERY    │
│          i_color          │                                                                                                                                                 │                           │
│      i_current_price      │                                                                                                                                                 │                           ├──────────────┐
│        i_manager_id       │                                                                                                                                                 │                           │              │
│          i_units          │                                                                                                                                                 │                           │              │
│           i_size          │                                                                                                                                                 │                           │              │
│       ss_net_profit       │                                                                                                                                                 │                           │              │
│                           │                                                                                                                                                 │                           │              │
│          233 rows         │                                                                                                                                                 │           1 row           │              │
│          (0.00s)          │                                                                                                                                                 │          (0.00s)          │              │
└─────────────┬─────────────┘                                                                                                                                                 └─────────────┬─────────────┘              │
┌─────────────┴─────────────┐                                                                                                                                                 ┌─────────────┴─────────────┐┌─────────────┴─────────────┐
│         PROJECTION        │                                                                                                                                                 │       HASH_GROUP_BY       ││         PROJECTION        │
│    ────────────────────   │                                                                                                                                                 │    ────────────────────   ││    ────────────────────   │
│             #0            │                                                                                                                                                 │          Groups:          ││ CASE  WHEN ((#1 > 1)) THEN│
│             #1            │                                                                                                                                                 │             #0            ││   ("error"('More than one │
│             #7            │                                                                                                                                                 │             #1            ││      row returned by a    │
│__internal_compress_string_│                                                                                                                                                 │             #2            ││     subquery used as an   │
│        ubigint(#11)       │                                                                                                                                                 │                           ││     expression - scalar   │
│__internal_compress_string_│                                                                                                                                                 │    Aggregates: sum(#3)    ││     subqueries can only   │
│       uinteger(#12)       │                                                                                                                                                 │                           ││    return a single row.   │
│__internal_compress_string_│                                                                                                                                                 │                           ││          Use "SET         │
│       uinteger(#10)       │                                                                                                                                                 │                           ││ scalar_subquery_error_on_m│
│__internal_compress_string_│                                                                                                                                                 │                           ││   ultiple_rows=false" to  │
│        uhugeint(#8)       │                                                                                                                                                 │                           ││     revert to previous    │
│__internal_compress_string_│                                                                                                                                                 │                           ││   behavior of returning a │
│        uhugeint(#9)       │                                                                                                                                                 │                           ││ random row.')) ELSE #0 END│
│__internal_compress_string_│                                                                                                                                                 │                           ││                           │
│        uhugeint(#2)       │                                                                                                                                                 │                           ││                           │
│             #3            │                                                                                                                                                 │                           ││                           │
│__internal_compress_integra│                                                                                                                                                 │                           ││                           │
│     l_utinyint(#4, 1)     │                                                                                                                                                 │                           ││                           │
│__internal_compress_string_│                                                                                                                                                 │                           ││                           │
│        ubigint(#5)        │                                                                                                                                                 │                           ││                           │
│__internal_compress_string_│                                                                                                                                                 │                           ││                           │
│        uhugeint(#6)       │                                                                                                                                                 │                           ││                           │
│                           │                                                                                                                                                 │                           ││                           │
│          233 rows         │                                                                                                                                                 │           1 row           ││           1 row           │
│          (0.00s)          │                                                                                                                                                 │          (0.00s)          ││          (0.00s)          │
└─────────────┬─────────────┘                                                                                                                                                 └─────────────┬─────────────┘└─────────────┬─────────────┘
┌─────────────┴─────────────┐                                                                                                                                                 ┌─────────────┴─────────────┐┌─────────────┴─────────────┐
│         HASH_JOIN         │                                                                                                                                                 │         PROJECTION        ││    UNGROUPED_AGGREGATE    │
│    ────────────────────   │                                                                                                                                                 │    ────────────────────   ││    ────────────────────   │
│      Join Type: INNER     │                                                                                                                                                 │        c_last_name        ││        Aggregates:        │
│                           │                                                                                                                                                 │        c_first_name       ││        "first"(#0)        │
│        Conditions:        │                                                                                                                                                 │        s_store_name       ││        count_star()       │
│  sr_item_sk = ss_item_sk  ├──────────────┐                                                                                                                                  │          netpaid          ││                           │
│     sr_ticket_number =    │              │                                                                                                                                  │                           ││                           │
│      ss_ticket_number     │              │                                                                                                                                  │                           ││                           │
│                           │              │                                                                                                                                  │                           ││                           │
│          233 rows         │              │                                                                                                                                  │           1 row           ││           1 row           │
│          (0.02s)          │              │                                                                                                                                  │          (0.00s)          ││          (0.00s)          │
└─────────────┬─────────────┘              │                                                                                                                                  └─────────────┬─────────────┘└─────────────┬─────────────┘
┌─────────────┴─────────────┐┌─────────────┴─────────────┐                                                                                                                    ┌─────────────┴─────────────┐┌─────────────┴─────────────┐
│         TABLE_SCAN        ││         HASH_JOIN         │                                                                                                                    │           FILTER          ││         PROJECTION        │
│    ────────────────────   ││    ────────────────────   │                                                                                                                    │    ────────────────────   ││    ────────────────────   │
│    Table: store_returns   ││      Join Type: INNER     │                                                                                                                    │    (i_color = 'beige')    ││             #0            │
│   Type: Sequential Scan   ││                           │                                                                                                                    │                           ││                           │
│                           ││        Conditions:        │                                                                                                                    │                           ││                           │
│        Projections:       ││   i_item_sk = ss_item_sk  ├──────────────┐                                                                                                     │                           ││                           │
│      sr_ticket_number     ││                           │              │                                                                                                     │                           ││                           │
│         sr_item_sk        ││                           │              │                                                                                                     │                           ││                           │
│                           ││                           │              │                                                                                                     │                           ││                           │
│       2,795,210 rows      ││         2,552 rows        │              │                                                                                                     │           1 row           ││           1 row           │
│          (0.01s)          ││          (0.00s)          │              │                                                                                                     │          (0.00s)          ││          (0.00s)          │
└───────────────────────────┘└─────────────┬─────────────┘              │                                                                                                     └─────────────┬─────────────┘└─────────────┬─────────────┘
                             ┌─────────────┴─────────────┐┌─────────────┴─────────────┐                                                                                       ┌─────────────┴─────────────┐┌─────────────┴─────────────┐
                             │         TABLE_SCAN        ││         HASH_JOIN         │                                                                                       │          CTE_SCAN         ││         PROJECTION        │
                             │    ────────────────────   ││    ────────────────────   │                                                                                       │    ────────────────────   ││    ────────────────────   │
                             │        Table: item        ││      Join Type: INNER     │                                                                                       │        CTE Index: 0       ││   (0.05 * avg(netpaid))   │
                             │   Type: Sequential Scan   ││                           │                                                                                       │                           ││                           │
                             │                           ││        Conditions:        │                                                                                       │                           ││                           │
                             │        Projections:       ││      ss_customer_sk =     │                                                                                       │                           ││                           │
                             │         i_item_sk         ││        c_customer_sk      │                                                                                       │                           ││                           │
                             │          i_color          ││  ss_store_sk = s_store_sk ├──────────────┐                                                                        │                           ││                           │
                             │      i_current_price      ││                           │              │                                                                        │                           ││                           │
                             │        i_manager_id       ││                           │              │                                                                        │                           ││                           │
                             │          i_units          ││                           │              │                                                                        │                           ││                           │
                             │           i_size          ││                           │              │                                                                        │                           ││                           │
                             │                           ││                           │              │                                                                        │                           ││                           │
                             │        101,892 rows       ││         2,552 rows        │              │                                                                        │          233 rows         ││           1 row           │
                             │          (0.00s)          ││          (0.30s)          │              │                                                                        │          (0.00s)          ││          (0.00s)          │
                             └───────────────────────────┘└─────────────┬─────────────┘              │                                                                        └───────────────────────────┘└─────────────┬─────────────┘
                                                          ┌─────────────┴─────────────┐┌─────────────┴─────────────┐                                                                                       ┌─────────────┴─────────────┐
                                                          │         TABLE_SCAN        ││         HASH_JOIN         │                                                                                       │    UNGROUPED_AGGREGATE    │
                                                          │    ────────────────────   ││    ────────────────────   │                                                                                       │    ────────────────────   │
                                                          │     Table: store_sales    ││      Join Type: INNER     │                                                                                       │    Aggregates: avg(#0)    │
                                                          │   Type: Sequential Scan   ││                           │                                                                                       │                           │
                                                          │                           ││        Conditions:        │                                                                                       │                           │
                                                          │        Projections:       ││    c_current_addr_sk =    │                                                                                       │                           │
                                                          │      ss_ticket_number     ││        ca_address_sk      │                                                                                       │                           │
                                                          │         ss_item_sk        ││  c_birth_country != upper │                                                                                       │                           │
                                                          │       ss_customer_sk      ││        (ca_country)       ├──────────────┐                                                                        │                           │
                                                          │        ss_store_sk        ││                           │              │                                                                        │                           │
                                                          │       ss_net_profit       ││                           │              │                                                                        │                           │
                                                          │                           ││                           │              │                                                                        │                           │
                                                          │          Filters:         ││                           │              │                                                                        │                           │
                                                          │ ss_ticket_number<=2399999 ││                           │              │                                                                        │                           │
                                                          │                           ││                           │              │                                                                        │                           │
                                                          │      25,760,074 rows      ││         5,026 rows        │              │                                                                        │           1 row           │
                                                          │          (0.46s)          ││          (0.01s)          │              │                                                                        │          (0.00s)          │
                                                          └───────────────────────────┘└─────────────┬─────────────┘              │                                                                        └─────────────┬─────────────┘
                                                                                       ┌─────────────┴─────────────┐┌─────────────┴─────────────┐                                                          ┌─────────────┴─────────────┐
                                                                                       │         TABLE_SCAN        ││         HASH_JOIN         │                                                          │         PROJECTION        │
                                                                                       │    ────────────────────   ││    ────────────────────   │                                                          │    ────────────────────   │
                                                                                       │      Table: customer      ││      Join Type: INNER     │                                                          │          netpaid          │
                                                                                       │   Type: Sequential Scan   ││                           │                                                          │                           │
                                                                                       │                           ││        Conditions:        │                                                          │                           │
                                                                                       │        Projections:       ││       ca_zip = s_zip      │                                                          │                           │
                                                                                       │       c_customer_sk       ││                           │                                                          │                           │
                                                                                       │     c_current_addr_sk     ││                           ├──────────────┐                                           │                           │
                                                                                       │      c_birth_country      ││                           │              │                                           │                           │
                                                                                       │        c_last_name        ││                           │              │                                           │                           │
                                                                                       │        c_first_name       ││                           │              │                                           │                           │
                                                                                       │                           ││                           │              │                                           │                           │
                                                                                       │        499,776 rows       ││         2,665 rows        │              │                                           │          233 rows         │
                                                                                       │          (0.02s)          ││          (0.00s)          │              │                                           │          (0.00s)          │
                                                                                       └───────────────────────────┘└─────────────┬─────────────┘              │                                           └─────────────┬─────────────┘
                                                                                                                    ┌─────────────┴─────────────┐┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐
                                                                                                                    │         TABLE_SCAN        ││           FILTER          │                             │          CTE_SCAN         │
                                                                                                                    │    ────────────────────   ││    ────────────────────   │                             │    ────────────────────   │
                                                                                                                    │           Table:          ││    (s_store_sk <= 100)    │                             │        CTE Index: 0       │
                                                                                                                    │      customer_address     ││                           │                             │                           │
                                                                                                                    │                           ││                           │                             │                           │
                                                                                                                    │   Type: Sequential Scan   ││                           │                             │                           │
                                                                                                                    │                           ││                           │                             │                           │
                                                                                                                    │        Projections:       ││                           │                             │                           │
                                                                                                                    │       ca_address_sk       ││                           │                             │                           │
                                                                                                                    │         ca_country        ││                           │                             │                           │
                                                                                                                    │           ca_zip          ││                           │                             │                           │
                                                                                                                    │          ca_state         ││                           │                             │                           │
                                                                                                                    │                           ││                           │                             │                           │
                                                                                                                    │        81,274 rows        ││           9 rows          │                             │          233 rows         │
                                                                                                                    │          (0.01s)          ││          (0.00s)          │                             │          (0.00s)          │
                                                                                                                    └───────────────────────────┘└─────────────┬─────────────┘                             └───────────────────────────┘
                                                                                                                                                 ┌─────────────┴─────────────┐
                                                                                                                                                 │         TABLE_SCAN        │
                                                                                                                                                 │    ────────────────────   │
                                                                                                                                                 │        Table: store       │
                                                                                                                                                 │   Type: Sequential Scan   │
                                                                                                                                                 │                           │
                                                                                                                                                 │        Projections:       │
                                                                                                                                                 │         s_store_sk        │
                                                                                                                                                 │           s_zip           │
                                                                                                                                                 │        s_store_name       │
                                                                                                                                                 │          s_state          │
                                                                                                                                                 │                           │
                                                                                                                                                 │          Filters:         │
                                                                                                                                                 │       s_market_id=8       │
                                                                                                                                                 │                           │
                                                                                                                                                 │           9 rows          │
                                                                                                                                                 │          (0.00s)          │
                                                                                                                                                 └───────────────────────────┘

