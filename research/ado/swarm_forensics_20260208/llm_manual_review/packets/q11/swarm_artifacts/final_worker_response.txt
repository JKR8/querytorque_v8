```sql
WITH filtered_dates AS (
  SELECT d_date_sk, d_year
  FROM date_dim
  WHERE d_year IN (2001, 2002)
),
customer_sales AS (
  SELECT
    c.c_customer_id AS customer_id,
    c.c_first_name AS customer_first_name,
    c.c_last_name AS customer_last_name,
    c.c_birth_country AS customer_birth_country,
    SUM(CASE 
          WHEN ss.ss_customer_sk IS NOT NULL AND fd.d_year = 2001 
          THEN ss_ext_list_price - ss_ext_discount_amt 
          ELSE 0.0 
        END) AS store_2001,
    SUM(CASE 
          WHEN ss.ss_customer_sk IS NOT NULL AND fd.d_year = 2002 
          THEN ss_ext_list_price - ss_ext_discount_amt 
          ELSE 0.0 
        END) AS store_2002,
    SUM(CASE 
          WHEN ws.ws_bill_customer_sk IS NOT NULL AND fd_ws.d_year = 2001 
          THEN ws_ext_list_price - ws_ext_discount_amt 
          ELSE 0.0 
        END) AS web_2001,
    SUM(CASE 
          WHEN ws.ws_bill_customer_sk IS NOT NULL AND fd_ws.d_year = 2002 
          THEN ws_ext_list_price - ws_ext_discount_amt 
          ELSE 0.0 
        END) AS web_2002
  FROM customer c
  LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk
  LEFT JOIN filtered_dates fd ON ss.ss_sold_date_sk = fd.d_date_sk
  LEFT JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk
  LEFT JOIN filtered_dates fd_ws ON ws.ws_sold_date_sk = fd_ws.d_date_sk
  GROUP BY 
    c.c_customer_id,
    c.c_first_name,
    c.c_last_name,
    c.c_birth_country
  HAVING 
    store_2001 > 0 AND web_2001 > 0
)
SELECT
  customer_id,
  customer_first_name,
  customer_last_name,
  customer_birth_country
FROM customer_sales
WHERE 
  CASE 
    WHEN web_2001 > 0 THEN web_2002 / web_2001 
    ELSE 0.0 
  END > 
  CASE 
    WHEN store_2001 > 0 THEN store_2002 / store_2001 
    ELSE 0.0 
  END
ORDER BY
  customer_id,
  customer_first_name,
  customer_last_name,
  customer_birth_country
LIMIT 100
```

**Changes**: Replaced the 4-way self-join on the `year_total` CTE with a single-pass aggregation that computes store and web sales for both years simultaneously. Pre-filtered date_dim to only 2001-2002, used conditional aggregation to compute all metrics in one pass, and applied the ratio comparison directly in the WHERE clause.

**Expected speedup**: 2-3x by eliminating redundant scans of store_sales/web_sales tables and removing the expensive 4-way self-join with cartesian explosion. The single-pass aggregation with early HAVING filter reduces intermediate data volume significantly.