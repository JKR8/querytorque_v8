```sql
WITH filtered_dates AS (
  SELECT d_date_sk
  FROM date_dim
  WHERE d_date BETWEEN CAST('2002-01-26' AS DATE) 
    AND (CAST('2002-01-26' AS DATE) + INTERVAL '30' DAY)
),
filtered_items AS (
  SELECT 
    i_item_sk,
    i_item_id,
    i_item_desc,
    i_category,
    i_class,
    i_current_price
  FROM item
  WHERE i_category IN ('Shoes', 'Books', 'Women')
),
joined_sales AS (
  SELECT 
    i.i_item_id,
    i.i_item_desc,
    i.i_category,
    i.i_class,
    i.i_current_price,
    cs.cs_ext_sales_price
  FROM catalog_sales cs
  JOIN filtered_items i ON cs.cs_item_sk = i.i_item_sk
  JOIN filtered_dates d ON cs.cs_sold_date_sk = d.d_date_sk
)
SELECT
  i_item_id,
  i_item_desc,
  i_category,
  i_class,
  i_current_price,
  SUM(cs_ext_sales_price) AS itemrevenue,
  SUM(cs_ext_sales_price) * 100 / 
    SUM(SUM(cs_ext_sales_price)) OVER (PARTITION BY i_class) AS revenueratio
FROM joined_sales
GROUP BY
  i_item_id,
  i_item_desc,
  i_category,
  i_class,
  i_current_price
ORDER BY
  i_category,
  i_class,
  i_item_id,
  i_item_desc,
  revenueratio
LIMIT 100
```

**Changes**: Restructured with staged CTEs: first filtered dimensions, then pre-joined fact table with filtered dimensions, finally single-pass aggregation with deferred window computation. This reduces early table scans and allows DuckDB to optimize join order.

**Expected speedup**: 2-3x via early reduction of fact table joins and minimized intermediate materialization.