FAILURE_ANALYSIS:
All attempts fell short because they only applied structural reorganization (CTE isolation, filter pushdown) without addressing the core computational bottlenecks. DuckDB's optimizer already performs automatic predicate pushdown and join reordering, making these surface-level transformations redundant. The real bottlenecks are: 1) Large-scale window aggregation (SUM over PARTITION BY i_class) requiring a second full pass over grouped data, 2) Expensive hash joins with the massive store_sales fact table before aggregation, and 3) Missing opportunities for partition-wise aggregation and vectorized computation.

UNEXPLORED_OPPORTUNITIES:
1. **Pre-aggregation before window computation**: Compute class-level totals first via separate aggregation, then join back instead of using window function over entire result set.
2. **Bloom filter optimization**: Use semi-join reduction techniques to filter store_sales before the main join.
3. **Materialized class statistics**: Pre-compute class revenue in a separate pass and use it for ratio calculation.
4. **Columnar pruning**: Since only ss_item_sk, ss_sold_date_sk, and ss_ext_sales_price are needed from store_sales, explicitly select only these columns.
5. **Parallel partition processing**: Split the date range into parallelizable chunks using UNION ALL with range partitioning.

REFINED_STRATEGY:
Combine aggressive pre-aggregation with bloom-filter reduction and column pruning: 1) Create filtered dimension CTEs with only necessary keys, 2) Use semi-joins to reduce store_sales before full joins, 3) Pre-aggregate sales at item level before joining with item dimensions, 4) Compute class totals separately via subquery, and 5) Use explicit column selection throughout.

EXAMPLES: single_pass_aggregation, prefetch_fact_join, early_filter
HINT: Pre-aggregate store_sales by ss_item_sk using filtered date keys via semi-join, then join with filtered items, compute class totals via separate aggregation CTE, and finally compute ratios via scalar division instead of window function.