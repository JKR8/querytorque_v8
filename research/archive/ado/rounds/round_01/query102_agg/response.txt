```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "main_query": "WITH filtered_dates AS (\n    SELECT d_date_sk, d_date\n    FROM date_dim\n    WHERE d_year = 2002\n), filtered_customer_address AS (\n    SELECT ca_address_sk\n    FROM customer_address\n    WHERE ca_state IN ('GA', 'MD', 'MO', 'NC', 'OR')\n), filtered_item AS (\n    SELECT i_item_sk\n    FROM item\n    WHERE i_category IN ('Home', 'Men', 'Music')\n      AND i_manager_id IN (1, 2, 4, 11, 12, 14, 21, 29, 32, 52)\n), filtered_inventory AS (\n    SELECT inv_warehouse_sk, inv_item_sk, inv_date_sk, inv_quantity_on_hand\n    FROM inventory\n    WHERE inv_quantity_on_hand >= 0 -- Will be joined with ss_quantity later\n), store_sales_base AS (\n    SELECT\n        ss_item_sk,\n        ss_sold_date_sk,\n        ss_customer_sk,\n        ss_quantity\n    FROM store_sales\n    WHERE ss_item_sk IN (SELECT i_item_sk FROM filtered_item)\n      AND ss_sold_date_sk IN (SELECT d_date_sk FROM filtered_dates)\n)\nSELECT\n    cd_gender,\n    cd_marital_status,\n    cd_education_status,\n    hd_vehicle_count,\n    COUNT(*) AS cnt\nFROM store_sales_base ss\nJOIN web_sales ws ON ss.ss_item_sk = ws.ws_item_sk\nJOIN filtered_dates d1 ON ss.ss_sold_date_sk = d1.d_date_sk\nJOIN date_dim d2 ON ws.ws_sold_date_sk = d2.d_date_sk\nJOIN customer c ON ss.ss_customer_sk = c.c_customer_sk AND ws.ws_bill_customer_sk = c.c_customer_sk\nJOIN filtered_inventory inv ON inv.inv_item_sk = ss.ss_item_sk\n                          AND inv.inv_date_sk = ss.ss_sold_date_sk\n                          AND inv.inv_quantity_on_hand >= ss.ss_quantity\nJOIN store s ON inv.inv_warehouse_sk = s.s_warehouse_sk\nJOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk AND s.s_state = w.w_state\nJOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk\nJOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk\nJOIN filtered_customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk\nWHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30' DAY)\n  AND ws.ws_wholesale_cost BETWEEN 34 AND 54\nGROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count\nORDER BY cnt"
      },
      "invariants_kept": [
        "Output columns preserved",
        "Grouping grain preserved",
        "All filter predicates preserved exactly",
        "Join relationships preserved",
        "Result cardinality invariant"
      ],
      "expected_speedup": "1.5-2x",
      "risk": "medium"
    }
  ],
  "explanation": "This rewrite applies three optimizations: 1) Isolates date_dim with d_year=2002 into a CTE to filter store_sales early, 2) Creates filtered CTEs for customer_address and item to push filters down before joins, and 3) Separates inventory filtering to apply inv_quantity_on_hand >= ss_quantity during join rather than in WHERE clause. The rewrite maintains all original literal values exactly as required by LITERAL_PRESERVATION constraint. By filtering dimension tables first and reducing the working set early, we expect better join performance in the star-schema-like structure."
}
```