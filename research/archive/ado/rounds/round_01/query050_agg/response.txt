```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "main_query": "WITH filtered_d2 AS (\n  SELECT d_date_sk, d_date\n  FROM date_dim\n  WHERE d_year = 2002\n    AND d_moy = 8\n)\nSELECT s_store_name,\n       s_company_id,\n       s_street_number,\n       s_street_name,\n       s_street_type,\n       s_suite_number,\n       s_city,\n       s_county,\n       s_state,\n       s_zip,\n       SUM(CASE\n           WHEN (sr_returned_date_sk - ss_sold_date_sk <= 30) THEN 1\n           ELSE 0\n       END) AS \"30 days\",\n       SUM(CASE\n           WHEN (sr_returned_date_sk - ss_sold_date_sk > 30)\n                AND (sr_returned_date_sk - ss_sold_date_sk <= 60) THEN 1\n           ELSE 0\n       END) AS \"31-60 days\",\n       SUM(CASE\n           WHEN (sr_returned_date_sk - ss_sold_date_sk > 60)\n                AND (sr_returned_date_sk - ss_sold_date_sk <= 90) THEN 1\n           ELSE 0\n       END) AS \"61-90 days\",\n       SUM(CASE\n           WHEN (sr_returned_date_sk - ss_sold_date_sk > 90)\n                AND (sr_returned_date_sk - ss_sold_date_sk <= 120) THEN 1\n           ELSE 0\n       END) AS \"91-120 days\",\n       SUM(CASE\n           WHEN (sr_returned_date_sk - ss_sold_date_sk > 120) THEN 1\n           ELSE 0\n       END) AS \">120 days\"\nFROM store_sales,\n     store_returns,\n     store,\n     date_dim AS d1,\n     filtered_d2 AS d2\nWHERE ss_ticket_number = sr_ticket_number\n  AND ss_item_sk = sr_item_sk\n  AND ss_sold_date_sk = d1.d_date_sk\n  AND sr_returned_date_sk = d2.d_date_sk\n  AND ss_customer_sk = sr_customer_sk\n  AND ss_store_sk = s_store_sk\n  AND d1.d_date BETWEEN (d2.d_date - INTERVAL '120' DAY) AND d2.d_date\nGROUP BY s_store_name,\n         s_company_id,\n         s_street_number,\n         s_street_name,\n         s_street_type,\n         s_suite_number,\n         s_city,\n         s_county,\n         s_state,\n         s_zip\nORDER BY s_store_name,\n         s_company_id,\n         s_street_number,\n         s_street_name,\n         s_street_type,\n         s_suite_number,\n         s_city,\n         s_county,\n         s_state,\n         s_zip\nLIMIT 100"
      },
      "invariants_kept": [
        "Output columns unchanged",
        "Grouping grain unchanged",
        "All predicates preserved exactly",
        "All literal values preserved (2002, 8, 120)",
        "Result cardinality unchanged"
      ],
      "expected_speedup": "1.5x-2x",
      "risk": "low"
    }
  ],
  "explanation": "Created a CTE (filtered_d2) to isolate the filtered date_dim scan (d_year=2002, d_moy=8) before joining with large fact tables. This reduces the intermediate join size by pushing the selective filter early, mimicking the Date CTE Isolation pattern from TPC-DS optimizations. The CTE is joined as d2 while preserving all original join conditions and literal values. The rewrite maintains all semantic invariants while enabling the optimizer to start with a smaller dimension table."
}
```