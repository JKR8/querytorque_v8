```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "d1_filtered": "SELECT d_date_sk FROM date_dim WHERE d_moy = 5 AND d_year = 1999",
        "d2_filtered": "SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 5 AND 5+2 AND d_year = 1999",
        "d3_filtered": "SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 5 AND 5+2 AND d_year = 1999",
        "main_query": "WITH d1_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_moy = 5 AND d_year = 1999), d2_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 5 AND 5+2 AND d_year = 1999), d3_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 5 AND 5+2 AND d_year = 1999) SELECT i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name, SUM(ss.ss_net_profit) AS store_sales_profit, SUM(sr.sr_net_loss) AS store_returns_loss, SUM(cs.cs_net_profit) AS catalog_sales_profit FROM store_sales ss JOIN d1_filtered d1 ON ss.ss_sold_date_sk = d1.d_date_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN store_returns sr ON ss.ss_customer_sk = sr.sr_customer_sk AND ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number JOIN d2_filtered d2 ON sr.sr_returned_date_sk = d2.d_date_sk JOIN catalog_sales cs ON sr.sr_customer_sk = cs.cs_bill_customer_sk AND sr.sr_item_sk = cs.cs_item_sk JOIN d3_filtered d3 ON cs.cs_sold_date_sk = d3.d_date_sk GROUP BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name ORDER BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name LIMIT 100"
      },
      "invariants_kept": [
        "Same output columns and grain",
        "Same literal values in filters (1999, 5, 5+2)",
        "Same join conditions and aggregation logic"
      ],
      "expected_speedup": "2x",
      "risk": "low"
    }
  ],
  "explanation": "Isolated date_dim filters into CTEs to push down date predicates early. This reduces the size of fact tables before joining. Changed implicit joins to explicit JOIN syntax for clarity and better optimization hints. All literal values preserved exactly as in original query."
}
```