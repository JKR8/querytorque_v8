```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "main_query": "WITH d1_filtered AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_moy = 6\n    AND d_year = 2002\n),\nd2_filtered AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_moy BETWEEN 6 AND 8\n    AND d_year = 2002\n),\nd3_filtered AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_moy BETWEEN 6 AND 8\n    AND d_year = 2002\n)\nSELECT MIN(i_item_id), MIN(i_item_desc), MIN(s_store_id), MIN(s_store_name), MIN(ss_net_profit), MIN(sr_net_loss), MIN(cs_net_profit), MIN(ss_item_sk), MIN(sr_ticket_number), MIN(cs_order_number)\nFROM store_sales\nJOIN d1_filtered ON store_sales.ss_sold_date_sk = d1_filtered.d_date_sk\nJOIN store ON s_store_sk = ss_store_sk\nJOIN item ON i_item_sk = ss_item_sk\nJOIN store_returns ON ss_customer_sk = sr_customer_sk AND ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number\nJOIN d2_filtered ON store_returns.sr_returned_date_sk = d2_filtered.d_date_sk\nJOIN catalog_sales ON sr_customer_sk = cs_bill_customer_sk AND sr_item_sk = cs_item_sk\nJOIN d3_filtered ON catalog_sales.cs_sold_date_sk = d3_filtered.d_date_sk"
      },
      "invariants_kept": [
        "All original join conditions preserved",
        "All original filter literals preserved exactly (d_moy=6, d_year=2002, etc.)",
        "Output columns unchanged",
        "Aggregation grain unchanged (single row result)",
        "All table relationships maintained"
      ],
      "expected_speedup": "2x-3x",
      "risk": "low"
    }
  ],
  "explanation": "Applied Date CTE Isolation to filter date_dim tables early before joining with large fact tables. This reduces the initial join cardinality by pushing date filters (d1.d_moy=6, d1.d_year=2002; d2/d3 d_moy BETWEEN 6 AND 8, d_year=2002) into CTEs. The rewrite isolates three date dimension instances (d1, d2, d3) as filtered CTEs containing only relevant date keys, then joins fact tables to these pre-filtered dimension sets. This optimization is particularly effective because the date filters are highly selective and applied before expensive multi-way joins between large fact tables (store_sales, store_returns, catalog_sales)."
}
```