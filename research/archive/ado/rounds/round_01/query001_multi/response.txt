```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "decorrelate",
      "nodes": {
        "main_query": "WITH customer_total_return AS (\n  SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_REFUNDED_CASH) AS ctr_total_return \n  FROM store_returns\n  JOIN date_dim ON sr_returned_date_sk = d_date_sk \n  WHERE d_year = 2000 \n    AND sr_return_amt / sr_return_quantity BETWEEN 16 AND 75 \n  GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk\n),\nstore_avg_returns AS (\n  SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS avg_return_threshold\n  FROM customer_total_return\n  GROUP BY ctr_store_sk\n)\nSELECT c_customer_id \nFROM customer_total_return AS ctr1\nJOIN store_avg_returns AS avg ON ctr1.ctr_store_sk = avg.ctr_store_sk\nJOIN store ON s_store_sk = ctr1.ctr_store_sk\nJOIN customer ON ctr1.ctr_customer_sk = c_customer_sk\nJOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk\nWHERE ctr1.ctr_total_return > avg.avg_return_threshold\n  AND ctr1.ctr_reason_sk BETWEEN 25 AND 28\n  AND s_state IN ('MI', 'ND', 'TX')\n  AND cd_marital_status IN ('M', 'M')\n  AND cd_education_status IN ('College', 'College')\n  AND cd_gender = 'M'\n  AND c_birth_month = 9\n  AND c_birth_year BETWEEN 1979 AND 1985\nORDER BY c_customer_id \nLIMIT 100"
      },
      "invariants_kept": [
        "same result rows", 
        "same output columns",
        "all literal values preserved"
      ],
      "expected_speedup": "2-3x",
      "risk": "low"
    }
  ],
  "explanation": "Decorrelated the subquery by precomputing store-level average thresholds in a CTE, enabling efficient join instead of correlated execution. This eliminates N+1 pattern and allows better join ordering optimization."
}
```