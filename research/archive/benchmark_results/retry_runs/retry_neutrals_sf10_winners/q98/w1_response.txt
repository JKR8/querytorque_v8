```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "date_filtered": "SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-02-22' AS DATE) AND CAST('1999-03-24' AS DATE)",
        "item_filtered": "SELECT i_item_sk, i_item_id, i_item_desc, i_category, i_class, i_current_price FROM item WHERE i_category IN ('Sports', 'Books', 'Home')",
        "filtered_sales": "SELECT ss_item_sk, ss_ext_sales_price, i_item_sk, i_item_id, i_item_desc, i_category, i_class, i_current_price FROM store_sales ss JOIN date_filtered df ON ss.ss_sold_date_sk = df.d_date_sk JOIN item_filtered it ON ss.ss_item_sk = it.i_item_sk",
        "main_query": "SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, SUM(ss_ext_sales_price) AS itemrevenue, SUM(ss_ext_sales_price) * 100.0000 / SUM(SUM(ss_ext_sales_price)) OVER (PARTITION BY i_class) AS revenueratio FROM filtered_sales GROUP BY i_item_id, i_item_desc, i_category, i_class, i_current_price ORDER BY i_category NULLS FIRST, i_class NULLS FIRST, i_item_id NULLS FIRST, i_item_desc NULLS FIRST, revenueratio NULLS FIRST"
      },
      "invariants_kept": [
        "same result rows",
        "same output columns",
        "same ordering",
        "same grain"
      ],
      "expected_speedup": "3.5x",
      "risk": "low"
    }
  ],
  "explanation": "Isolated date_dim filter into CTE to reduce join cardinality early. The date filter reduces date_dim from 73K rows to 31 rows before joining with store_sales. Created item_filtered CTE to push category filter early. This prevents full table scans and reduces hash join sizes significantly. The window function computation remains correct as we preserve all required columns for partition by i_class."
}
```