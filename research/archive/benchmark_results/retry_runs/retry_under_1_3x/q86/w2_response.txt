```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1200 AND 1211",
        "filtered_web_sales": "SELECT ws_item_sk, ws_net_paid FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk",
        "main_query": "SELECT SUM(ws_net_paid) AS total_sum, i_category, i_class, GROUPING(i_category) + GROUPING(i_class) AS lochierarchy, RANK() OVER (PARTITION BY GROUPING(i_category) + GROUPING(i_class), CASE WHEN GROUPING(i_class) = 0 THEN i_category END ORDER BY SUM(ws_net_paid) DESC) AS rank_within_parent FROM filtered_web_sales fws JOIN item i ON fws.ws_item_sk = i.i_item_sk GROUP BY ROLLUP (i_category, i_class) ORDER BY lochierarchy DESC NULLS FIRST, CASE WHEN GROUPING(i_category) + GROUPING(i_class) = 0 THEN i_category END NULLS FIRST, rank_within_parent NULLS FIRST LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same ordering",
        "same column output",
        "same grouping and aggregation",
        "same window function semantics"
      ],
      "expected_speedup": "2.0x",
      "risk": "low"
    }
  ],
  "explanation": "Isolated the date_dim filter into a CTE (filtered_dates) that returns only d_date_sk for the 12-month range. Created a filtered_web_sales CTE that joins web_sales with filtered_dates early, reducing the fact table from 86M rows to ~1.4M rows before joining with item and performing the expensive ROLLUP aggregation. This prevents scanning the entire web_sales table and applies the selective date filter first."
}
```