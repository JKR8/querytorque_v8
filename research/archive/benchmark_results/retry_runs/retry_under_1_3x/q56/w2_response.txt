```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_year = 2001 AND d_moy = 2",
        "filtered_addresses": "SELECT ca_address_sk FROM customer_address WHERE ca_gmt_offset = -5",
        "filtered_items": "SELECT i_item_sk, i_item_id FROM item WHERE i_color IN ('slate', 'blanched', 'burnished')",
        "filtered_store_sales": "SELECT ss_item_sk, ss_ext_sales_price FROM store_sales JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk JOIN filtered_addresses ON store_sales.ss_addr_sk = filtered_addresses.ca_address_sk",
        "filtered_web_sales": "SELECT ws_item_sk, ws_ext_sales_price FROM web_sales JOIN filtered_dates ON web_sales.ws_sold_date_sk = filtered_dates.d_date_sk JOIN filtered_addresses ON web_sales.ws_bill_addr_sk = filtered_addresses.ca_address_sk",
        "ss": "SELECT filtered_items.i_item_id, SUM(ss_ext_sales_price) AS total_sales FROM filtered_store_sales JOIN filtered_items ON filtered_store_sales.ss_item_sk = filtered_items.i_item_sk GROUP BY filtered_items.i_item_id",
        "ws": "SELECT filtered_items.i_item_id, SUM(ws_ext_sales_price) AS total_sales FROM filtered_web_sales JOIN filtered_items ON filtered_web_sales.ws_item_sk = filtered_items.i_item_sk GROUP BY filtered_items.i_item_id"
      },
      "invariants_kept": [
        "same result rows",
        "same ordering",
        "same column output",
        "same grouping and aggregation"
      ],
      "expected_speedup": "3.0x",
      "risk": "low"
    },
    {
      "id": "rs_02",
      "transform": "materialize_cte",
      "nodes": {
        "filtered_items_materialized": "SELECT i_item_sk, i_item_id FROM item WHERE i_color IN ('slate', 'blanched', 'burnished')"
      },
      "invariants_kept": [
        "same result rows",
        "same column output"
      ],
      "expected_speedup": "1.5x",
      "risk": "medium",
      "note": "Materialize the filtered items CTE since it's used by both ws and ss CTEs. This prevents recomputation of the same subquery multiple times."
    }
  ],
  "explanation": "The main cost drivers are large sequential scans of fact tables (store_sales, web_sales) without early filtering. Extracting date and address filters into CTEs allows early filtering of fact tables before expensive joins. The item filter is applied in a CTE and reused across both sales channels. Date CTE isolates the date_dim filter (d_year=2001 AND d_moy=2) which is highly selective (73,049 â†’ 28 rows)."
}
```