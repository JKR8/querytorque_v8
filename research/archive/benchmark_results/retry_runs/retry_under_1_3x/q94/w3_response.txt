```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "materialize_cte",
      "nodes": {
        "filtered_date": "SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1999-02-01' AND CAST('1999-04-02' AS DATE)",
        "filtered_customer": "SELECT ca_address_sk FROM customer_address WHERE ca_state = 'IL'",
        "filtered_website": "SELECT web_site_sk FROM web_site WHERE web_company_name = 'pri'",
        "multi_warehouse_orders": "SELECT DISTINCT ws_order_number FROM web_sales ws2 GROUP BY ws_order_number HAVING COUNT(DISTINCT ws_warehouse_sk) > 1",
        "returned_orders": "SELECT DISTINCT wr_order_number FROM web_returns",
        "main_query": "SELECT COUNT(DISTINCT ws_order_number) AS \"order count\", SUM(ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws_net_profit) AS \"total net profit\" FROM web_sales AS ws1 JOIN filtered_date ON ws1.ws_ship_date_sk = filtered_date.d_date_sk JOIN filtered_customer ON ws1.ws_ship_addr_sk = filtered_customer.ca_address_sk JOIN filtered_website ON ws1.ws_web_site_sk = filtered_website.web_site_sk JOIN multi_warehouse_orders mwo ON ws1.ws_order_number = mwo.ws_order_number LEFT JOIN returned_orders ro ON ws1.ws_order_number = ro.wr_order_number WHERE ro.wr_order_number IS NULL GROUP BY () ORDER BY COUNT(DISTINCT ws_order_number) LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same aggregation",
        "same ordering"
      ],
      "expected_speedup": "2.5x",
      "risk": "low"
    }
  ],
  "explanation": "Materialized both EXISTS subqueries into CTEs: multi_warehouse_orders finds orders with multiple warehouses using aggregation instead of correlated subquery, and returned_orders precomputes all returned order numbers. Also pre-filtered dimension tables (date_dim, customer_address, web_site) into CTEs to reduce join sizes. Converted NOT EXISTS to LEFT JOIN + IS NULL. This reduces correlated subquery overhead and allows the optimizer to use pre-filtered dimension tables."
}
```