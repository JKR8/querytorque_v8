```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "materialize_cte",
      "nodes": {
        "filtered_date": "SELECT d_date_sk FROM date_dim WHERE d_year = 1998 AND d_moy = 11",
        "filtered_store": "SELECT s_store_sk FROM store WHERE s_gmt_offset = -5",
        "filtered_customer_address": "SELECT ca_address_sk FROM customer_address WHERE ca_gmt_offset = -5",
        "filtered_item": "SELECT i_item_sk FROM item WHERE i_category = 'Jewelry'",
        "main_query": "WITH promo_filtered AS (SELECT p_promo_sk FROM promotion WHERE p_channel_dmail = 'Y' OR p_channel_email = 'Y' OR p_channel_tv = 'Y'), base_sales AS (SELECT ss_ext_sales_price, ss_promo_sk FROM store_sales JOIN filtered_date ON ss_sold_date_sk = d_date_sk JOIN filtered_store ON ss_store_sk = s_store_sk JOIN customer ON ss_customer_sk = c_customer_sk JOIN filtered_customer_address ON ca_address_sk = c_current_addr_sk JOIN filtered_item ON ss_item_sk = i_item_sk) SELECT (SELECT SUM(ss_ext_sales_price) FROM base_sales WHERE ss_promo_sk IN (SELECT p_promo_sk FROM promo_filtered)) AS promotions, (SELECT SUM(ss_ext_sales_price) FROM base_sales) AS total, CAST((SELECT SUM(ss_ext_sales_price) FROM base_sales WHERE ss_promo_sk IN (SELECT p_promo_sk FROM promo_filtered)) AS DECIMAL(15,4)) / CAST((SELECT SUM(ss_ext_sales_price) FROM base_sales) AS DECIMAL(15,4)) * 100 ORDER BY promotions, total LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same column output",
        "same aggregation values"
      ],
      "expected_speedup": "2.5x",
      "risk": "low"
    }
  ],
  "explanation": "The original query had two separate subqueries scanning the same fact table with nearly identical joins. This rewrite: 1) Creates CTEs for filtered dimension tables (date, store, customer_address, item) to reduce join sizes early. 2) Creates a CTE for filtered promotions to avoid repeatedly scanning the promotion table. 3) Creates a single base_sales CTE that performs the common joins once, storing ss_ext_sales_price and ss_promo_sk. 4) Computes both promotions and total from this single base_sales CTE using subqueries. This reduces the number of fact table scans from two to one and reduces redundant dimension table processing."
}
```