WITH promo_filtered AS (SELECT p_promo_sk FROM promotion WHERE p_channel_dmail = 'Y' OR p_channel_email = 'Y' OR p_channel_tv = 'Y'), base_sales AS (SELECT ss_ext_sales_price, ss_promo_sk FROM store_sales JOIN filtered_date ON ss_sold_date_sk = d_date_sk JOIN filtered_store ON ss_store_sk = s_store_sk JOIN customer ON ss_customer_sk = c_customer_sk JOIN filtered_customer_address ON ca_address_sk = c_current_addr_sk JOIN filtered_item ON ss_item_sk = i_item_sk) SELECT (SELECT SUM(ss_ext_sales_price) FROM base_sales WHERE ss_promo_sk IN (SELECT p_promo_sk FROM promo_filtered)) AS promotions, (SELECT SUM(ss_ext_sales_price) FROM base_sales) AS total, CAST((SELECT SUM(ss_ext_sales_price) FROM base_sales WHERE ss_promo_sk IN (SELECT p_promo_sk FROM promo_filtered)) AS DECIMAL(15, 4)) / CAST((SELECT SUM(ss_ext_sales_price) FROM base_sales) AS DECIMAL(15, 4)) * 100 ORDER BY promotions, total LIMIT 100