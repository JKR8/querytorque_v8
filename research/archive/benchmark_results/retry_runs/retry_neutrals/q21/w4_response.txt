```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "early_filter",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN CAST('2000-02-10' AS DATE) AND CAST('2000-04-10' AS DATE)",
        "filtered_items": "SELECT i_item_sk, i_item_id FROM item WHERE i_current_price BETWEEN 0.99 AND 1.49",
        "main_query": "SELECT w_warehouse_name, i_item_id, SUM(CASE WHEN (CAST(d_date AS DATE) < CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) AS inv_before, SUM(CASE WHEN (CAST(d_date AS DATE) >= CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) AS inv_after FROM inventory JOIN filtered_dates ON inv_date_sk = d_date_sk JOIN filtered_items ON inv_item_sk = i_item_sk JOIN warehouse ON inv_warehouse_sk = w_warehouse_sk GROUP BY w_warehouse_name, i_item_id HAVING SUM(CASE WHEN (CAST(d_date AS DATE) < CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) > 0 AND (CASE WHEN SUM(CASE WHEN (CAST(d_date AS DATE) < CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) > 0 THEN (SUM(CASE WHEN (CAST(d_date AS DATE) >= CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) * 1.000) / SUM(CASE WHEN (CAST(d_date AS DATE) < CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) ELSE NULL END) BETWEEN 2.000 / 3.000 AND 3.000 / 2.000 ORDER BY w_warehouse_name NULLS FIRST, i_item_id NULLS FIRST LIMIT 100"
      },
      "invariants_kept": [
        "same output columns",
        "same grain (w_warehouse_name, i_item_id)",
        "same row count (filtered by ratio condition)"
      ],
      "expected_speedup": "2x",
      "risk": "low"
    }
  ],
  "explanation": "Created filtered CTEs for date_dim (61 rows) and item (6,464 rows) to dramatically reduce the rows processed in inventory scan. Combined the outer filter condition into HAVING clause to avoid materializing intermediate results. This reduces inventory scan from ~1.6B rows to joining with pre-filtered dimension tables."
}
```