```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "or_to_union",
      "nodes": {
        "date_filter": "SELECT d_date_sk FROM date_dim WHERE d_year = 2000",
        "filtered_sales": "SELECT ss_quantity, ss_sales_price, ss_net_profit, ss_cdemo_sk, ss_addr_sk, ss_store_sk FROM store_sales JOIN date_filter ON store_sales.ss_sold_date_sk = date_filter.d_date_sk",
        "main_query": "SELECT SUM(ss_quantity) FROM (SELECT ss_quantity FROM filtered_sales fs JOIN store ON store.s_store_sk = fs.ss_store_sk JOIN customer_demographics cd ON cd.cd_demo_sk = fs.ss_cdemo_sk JOIN customer_address ca ON ca.ca_address_sk = fs.ss_addr_sk WHERE cd.cd_marital_status = 'M' AND cd.cd_education_status = '4 yr Degree' AND fs.ss_sales_price BETWEEN 100.00 AND 150.00 AND ca.ca_country = 'United States' AND ca.ca_state IN ('CO', 'OH', 'TX') AND fs.ss_net_profit BETWEEN 0 AND 2000 UNION ALL SELECT ss_quantity FROM filtered_sales fs JOIN store ON store.s_store_sk = fs.ss_store_sk JOIN customer_demographics cd ON cd.cd_demo_sk = fs.ss_cdemo_sk JOIN customer_address ca ON ca.ca_address_sk = fs.ss_addr_sk WHERE cd.cd_marital_status = 'M' AND cd.cd_education_status = '4 yr Degree' AND fs.ss_sales_price BETWEEN 100.00 AND 150.00 AND ca.ca_country = 'United States' AND ca.ca_state IN ('OR', 'MN', 'KY') AND fs.ss_net_profit BETWEEN 150 AND 3000 UNION ALL SELECT ss_quantity FROM filtered_sales fs JOIN store ON store.s_store_sk = fs.ss_store_sk JOIN customer_demographics cd ON cd.cd_demo_sk = fs.ss_cdemo_sk JOIN customer_address ca ON ca.ca_address_sk = fs.ss_addr_sk WHERE cd.cd_marital_status = 'M' AND cd.cd_education_status = '4 yr Degree' AND fs.ss_sales_price BETWEEN 100.00 AND 150.00 AND ca.ca_country = 'United States' AND ca.ca_state IN ('VA', 'CA', 'MS') AND fs.ss_net_profit BETWEEN 50 AND 25000 UNION ALL SELECT ss_quantity FROM filtered_sales fs JOIN store ON store.s_store_sk = fs.ss_store_sk JOIN customer_demographics cd ON cd.cd_demo_sk = fs.ss_cdemo_sk JOIN customer_address ca ON ca.ca_address_sk = fs.ss_addr_sk WHERE cd.cd_marital_status = 'D' AND cd.cd_education_status = '2 yr Degree' AND fs.ss_sales_price BETWEEN 50.00 AND 100.00 AND ca.ca_country = 'United States' AND ca.ca_state IN ('CO', 'OH', 'TX') AND fs.ss_net_profit BETWEEN 0 AND 2000 UNION ALL SELECT ss_quantity FROM filtered_sales fs JOIN store ON store.s_store_sk = fs.ss_store_sk JOIN customer_demographics cd ON cd.cd_demo_sk = fs.ss_cdemo_sk JOIN customer_address ca ON ca.ca_address_sk = fs.ss_addr_sk WHERE cd.cd_marital_status = 'D' AND cd.cd_education_status = '2 yr Degree' AND fs.ss_sales_price BETWEEN 50.00 AND 100.00 AND ca.ca_country = 'United States' AND ca.ca_state IN ('OR', 'MN', 'KY') AND fs.ss_net_profit BETWEEN 150 AND 3000 UNION ALL SELECT ss_quantity FROM filtered_sales fs JOIN store ON store.s_store_sk = fs.ss_store_sk JOIN customer_demographics cd ON cd.cd_demo_sk = fs.ss_cdemo_sk JOIN customer_address ca ON ca.ca_address_sk = fs.ss_addr_sk WHERE cd.cd_marital_status = 'D' AND cd.cd_education_status = '2 yr Degree' AND fs.ss_sales_price BETWEEN 50.00 AND 100.00 AND ca.ca_country = 'United States' AND ca.ca_state IN ('VA', 'CA', 'MS') AND fs.ss_net_profit BETWEEN 50 AND 25000 UNION ALL SELECT ss_quantity FROM filtered_sales fs JOIN store ON store.s_store_sk = fs.ss_store_sk JOIN customer_demographics cd ON cd.cd_demo_sk = fs.ss_cdemo_sk JOIN customer_address ca ON ca.ca_address_sk = fs.ss_addr_sk WHERE cd.cd_marital_status = 'S' AND cd.cd_education_status = 'College' AND fs.ss_sales_price BETWEEN 150.00 AND 200.00 AND ca.ca_country = 'United States' AND ca.ca_state IN ('CO', 'OH', 'TX') AND fs.ss_net_profit BETWEEN 0 AND 2000 UNION ALL SELECT ss_quantity FROM filtered_sales fs JOIN store ON store.s_store_sk = fs.ss_store_sk JOIN customer_demographics cd ON cd.cd_demo_sk = fs.ss_cdemo_sk JOIN customer_address ca ON ca.ca_address_sk = fs.ss_addr_sk WHERE cd.cd_marital_status = 'S' AND cd.cd_education_status = 'College' AND fs.ss_sales_price BETWEEN 150.00 AND 200.00 AND ca.ca_country = 'United States' AND ca.ca_state IN ('OR', 'MN', 'KY') AND fs.ss_net_profit BETWEEN 150 AND 3000 UNION ALL SELECT ss_quantity FROM filtered_sales fs JOIN store ON store.s_store_sk = fs.ss_store_sk JOIN customer_demographics cd ON cd.cd_demo_sk = fs.ss_cdemo_sk JOIN customer_address ca ON ca.ca_address_sk = fs.ss_addr_sk WHERE cd.cd_marital_status = 'S' AND cd.cd_education_status = 'College' AND fs.ss_sales_price BETWEEN 150.00 AND 200.00 AND ca.ca_country = 'United States' AND ca.ca_state IN ('VA', 'CA', 'MS') AND fs.ss_net_profit BETWEEN 50 AND 25000) AS all_branches"
      },
      "invariants_kept": [
        "same result rows",
        "same column output",
        "same aggregation result"
      ],
      "expected_speedup": "2.5x",
      "risk": "low"
    }
  ],
  "explanation": "Applied two key optimizations: 1) Date CTE isolation to filter store_sales by year 2000 early, reducing the fact table cardinality before expensive joins. 2) OR-to-UNION-ALL decomposition to split the complex OR conditions into 9 independent branches, each with specific conditions on customer_demographics and customer_address. This allows each branch to use more efficient join strategies and indexes, and enables parallel execution. The UNION ALL approach avoids the overhead of evaluating multiple OR conditions repeatedly during joins."
}
```