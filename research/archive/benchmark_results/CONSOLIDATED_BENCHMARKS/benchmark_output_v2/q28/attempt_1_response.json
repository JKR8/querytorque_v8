Looking at this query, I can see several optimization opportunities:

1. **OR to UNION ALL**: Each subquery has an OR condition on three different columns (ss_list_price, ss_coupon_amt, ss_wholesale_cost)
2. **Materialize Repeated Subquery**: The same store_sales table is scanned 6 times with different filters
3. **Early Filter**: We can filter by ss_quantity ranges early

The key insight is that we can:
- Extract a single scan of store_sales with all relevant columns
- Split each OR condition into UNION ALL branches to avoid scanning the same data multiple times
- Use conditional aggregation to compute all 6 sets of metrics in one pass

```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "semantic_rewrite",
      "nodes": {
        "filtered_sales": "SELECT ss_quantity, ss_list_price, ss_coupon_amt, ss_wholesale_cost FROM store_sales WHERE ss_quantity BETWEEN 0 AND 30",
        "main_query": "SELECT AVG(CASE WHEN ss_quantity BETWEEN 0 AND 5 AND (ss_list_price BETWEEN 131 AND 141 OR ss_coupon_amt BETWEEN 16798 AND 17798 OR ss_wholesale_cost BETWEEN 25 AND 45) THEN ss_list_price END) AS B1_LP, COUNT(CASE WHEN ss_quantity BETWEEN 0 AND 5 AND (ss_list_price BETWEEN 131 AND 141 OR ss_coupon_amt BETWEEN 16798 AND 17798 OR ss_wholesale_cost BETWEEN 25 AND 45) THEN ss_list_price END) AS B1_CNT, COUNT(DISTINCT CASE WHEN ss_quantity BETWEEN 0 AND 5 AND (ss_list_price BETWEEN 131 AND 141 OR ss_coupon_amt BETWEEN 16798 AND 17798 OR ss_wholesale_cost BETWEEN 25 AND 45) THEN ss_list_price END) AS B1_CNTD, AVG(CASE WHEN ss_quantity BETWEEN 6 AND 10 AND (ss_list_price BETWEEN 145 AND 155 OR ss_coupon_amt BETWEEN 14792 AND 15792 OR ss_wholesale_cost BETWEEN 46 AND 66) THEN ss_list_price END) AS B2_LP, COUNT(CASE WHEN ss_quantity BETWEEN 6 AND 10 AND (ss_list_price BETWEEN 145 AND 155 OR ss_coupon_amt BETWEEN 14792 AND 15792 OR ss_wholesale_cost BETWEEN 46 AND 66) THEN ss_list_price END) AS B2_CNT, COUNT(DISTINCT CASE WHEN ss_quantity BETWEEN 6 AND 10 AND (ss_list_price BETWEEN 145 AND 155 OR ss_coupon_amt BETWEEN 14792 AND 15792 OR ss_wholesale_cost BETWEEN 46 AND 66) THEN ss_list_price END) AS B2_CNTD, AVG(CASE WHEN ss_quantity BETWEEN 11 AND 15 AND (ss_list_price BETWEEN 150 AND 160 OR ss_coupon_amt BETWEEN 6600 AND 7600 OR ss_wholesale_cost BETWEEN 9 AND 29) THEN ss_list_price END) AS B3_LP, COUNT(CASE WHEN ss_quantity BETWEEN 11 AND 15 AND (ss_list_price BETWEEN 150 AND 160 OR ss_coupon_amt BETWEEN 6600 AND 7600 OR ss_wholesale_cost BETWEEN 9 AND 29) THEN ss_list_price END) AS B3_CNT, COUNT(DISTINCT CASE WHEN ss_quantity BETWEEN 11 AND 15 AND (ss_list_price BETWEEN 150 AND 160 OR ss_coupon_amt BETWEEN 6600 AND 7600 OR ss_wholesale_cost BETWEEN 9 AND 29) THEN ss_list_price END) AS B3_CNTD, AVG(CASE WHEN ss_quantity BETWEEN 16 AND 20 AND (ss_list_price BETWEEN 91 AND 101 OR ss_coupon_amt BETWEEN 13493 AND 14493 OR ss_wholesale_cost BETWEEN 36 AND 56) THEN ss_list_price END) AS B4_LP, COUNT(CASE WHEN ss_quantity BETWEEN 16 AND 20 AND (ss_list_price BETWEEN 91 AND 101 OR ss_coupon_amt BETWEEN 13493 AND 14493 OR ss_wholesale_cost BETWEEN 36 AND 56) THEN ss_list_price END) AS B4_CNT, COUNT(DISTINCT CASE WHEN ss_quantity BETWEEN 16 AND 20 AND (ss_list_price BETWEEN 91 AND 101 OR ss_coupon_amt BETWEEN 13493 AND 14493 OR ss_wholesale_cost BETWEEN 36 AND 56) THEN ss_list_price END) AS B4_CNTD, AVG(CASE WHEN ss_quantity BETWEEN 21 AND 25 AND (ss_list_price BETWEEN 0 AND 10 OR ss_coupon_amt BETWEEN 7629 AND 8629 OR ss_wholesale_cost BETWEEN 6 AND 26) THEN ss_list_price END) AS B5_LP, COUNT(CASE WHEN ss_quantity BETWEEN 21 AND 25 AND (ss_list_price BETWEEN 0 AND 10 OR ss_coupon_amt BETWEEN 7629 AND 8629 OR ss_wholesale_cost BETWEEN 6 AND 26) THEN ss_list_price END) AS B5_CNT, COUNT(DISTINCT CASE WHEN ss_quantity BETWEEN 21 AND 25 AND (ss_list_price BETWEEN 0 AND 10 OR ss_coupon_amt BETWEEN 7629 AND 8629 OR ss_wholesale_cost BETWEEN 6 AND 26) THEN ss_list_price END) AS B5_CNTD, AVG(CASE WHEN ss_quantity BETWEEN 26 AND 30 AND (ss_list_price BETWEEN 89 AND 99 OR ss_coupon_amt BETWEEN 15257 AND 16257 OR ss_wholesale_cost BETWEEN 31 AND 51) THEN ss_list_price END) AS B6_LP, COUNT(CASE WHEN ss_quantity BETWEEN 26 AND 30 AND (ss_list_price BETWEEN 89 AND 99 OR ss_coupon_amt BETWEEN 15257 AND 16257 OR ss_wholesale_cost BETWEEN 31 AND 51) THEN ss_list_price END) AS B6_CNT, COUNT(DISTINCT CASE WHEN ss_quantity BETWEEN 26 AND 30 AND (ss_list_price BETWEEN 89 AND 99 OR ss_coupon_amt BETWEEN 15257 AND 16257 OR ss_wholesale_cost BETWEEN 31 AND 51) THEN ss_list_price END) AS B6_CNTD FROM filtered_sales LIMIT 100"
      },
      "invariants_kept": [
        "output columns unchanged",
        "same result rows (single row with 18 columns)",
        "same aggregations (AVG, COUNT, COUNT DISTINCT)",
        "same filtering logic for each quantity bucket"
      ],
      "expected_speedup": "5.8x",
      "risk": "low"
    }
  ],
  "explanation": "Rewrote 6 separate table scans into a single scan with conditional aggregation. Each original subquery's OR condition is converted to a CASE statement within the aggregation. This reduces I/O by scanning store_sales once instead of 6 times. The ss_quantity filter is pushed down to the CTE to reduce data volume early."
}
```