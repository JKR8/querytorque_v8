```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1188 AND 1188 + 11",
        "filtered_inventory": "SELECT inv_item_sk, inv_quantity_on_hand FROM inventory JOIN filtered_dates ON inv_date_sk = d_date_sk",
        "main_query": "SELECT i_product_name, i_brand, i_class, i_category, AVG(inv_quantity_on_hand) AS qoh FROM filtered_inventory JOIN item ON inv_item_sk = i_item_sk GROUP BY ROLLUP (i_product_name, i_brand, i_class, i_category) ORDER BY qoh, i_product_name, i_brand, i_class, i_category LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same ordering",
        "same column output",
        "same grouping and aggregation with ROLLUP"
      ],
      "expected_speedup": "3.0x",
      "risk": "low"
    }
  ],
  "explanation": "Extracted date_dim filter into a CTE to isolate the date range selection (365 rows vs 73,049). Joined this CTE with inventory early to reduce the inventory scan from 47.9M rows to only rows matching the 365 date keys. This prevents scanning the entire inventory table before applying the date filter."
}
```