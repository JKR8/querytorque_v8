```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "or_to_union",
      "nodes": {
        "filtered_sales": "SELECT ss.ss_ticket_number, ss.ss_customer_sk FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk WHERE d.d_dom BETWEEN 1 AND 3 AND hd.hd_buy_potential = '1001-5000' AND hd.hd_vehicle_count > 0 AND (CASE WHEN hd.hd_vehicle_count > 0 THEN hd.hd_dep_count / hd.hd_vehicle_count ELSE NULL END) > 1.2 AND d.d_year IN (1998, 1999, 2000) AND s.s_county IN ('Ziebach County', 'Daviess County', 'Walker County', 'Richland County', 'Barrow County', 'Franklin Parish', 'Williamson County', 'Luce County') UNION ALL SELECT ss.ss_ticket_number, ss.ss_customer_sk FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk WHERE d.d_dom BETWEEN 1 AND 3 AND hd.hd_buy_potential = '0-500' AND hd.hd_vehicle_count > 0 AND (CASE WHEN hd.hd_vehicle_count > 0 THEN hd.hd_dep_count / hd.hd_vehicle_count ELSE NULL END) > 1.2 AND d.d_year IN (1998, 1999, 2000) AND s.s_county IN ('Ziebach County', 'Daviess County', 'Walker County', 'Richland County', 'Barrow County', 'Franklin Parish', 'Williamson County', 'Luce County') UNION ALL SELECT ss.ss_ticket_number, ss.ss_customer_sk FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk WHERE d.d_dom BETWEEN 25 AND 28 AND hd.hd_buy_potential = '1001-5000' AND hd.hd_vehicle_count > 0 AND (CASE WHEN hd.hd_vehicle_count > 0 THEN hd.hd_dep_count / hd.hd_vehicle_count ELSE NULL END) > 1.2 AND d.d_year IN (1998, 1999, 2000) AND s.s_county IN ('Ziebach County', 'Daviess County', 'Walker County', 'Richland County', 'Barrow County', 'Franklin Parish', 'Williamson County', 'Luce County') UNION ALL SELECT ss.ss_ticket_number, ss.ss_customer_sk FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk WHERE d.d_dom BETWEEN 25 AND 28 AND hd.hd_buy_potential = '0-500' AND hd.hd_vehicle_count > 0 AND (CASE WHEN hd.hd_vehicle_count > 0 THEN hd.hd_dep_count / hd.hd_vehicle_count ELSE NULL END) > 1.2 AND d.d_year IN (1998, 1999, 2000) AND s.s_county IN ('Ziebach County', 'Daviess County', 'Walker County', 'Richland County', 'Barrow County', 'Franklin Parish', 'Williamson County', 'Luce County')",
        "ticket_counts": "SELECT ss_ticket_number, ss_customer_sk, COUNT(*) AS cnt FROM filtered_sales GROUP BY ss_ticket_number, ss_customer_sk",
        "main_query": "SELECT c.c_last_name, c.c_first_name, c.c_salutation, c.c_preferred_cust_flag, tc.ss_ticket_number, tc.cnt FROM ticket_counts tc JOIN customer c ON tc.ss_customer_sk = c.c_customer_sk WHERE tc.cnt BETWEEN 15 AND 20 ORDER BY c.c_last_name, c.c_first_name, c.c_salutation, c.c_preferred_cust_flag DESC, tc.ss_ticket_number"
      },
      "invariants_kept": [
        "output columns unchanged",
        "same aggregation grain (ss_ticket_number, ss_customer_sk)",
        "same row count after filtering (OR conditions are mutually exclusive)",
        "same ordering"
      ],
      "expected_speedup": "2.00x",
      "risk": "low"
    }
  ],
  "explanation": "Applied OR_TO_UNION transform to split the two OR conditions (d_dom ranges and hd_buy_potential values) into four mutually exclusive UNION ALL branches. This eliminates the OR predicates that prevent index usage and partition pruning, allowing each branch to be optimized independently. All common predicates (year, county, vehicle count, derived ratio) are pushed down to each branch. The subquery is materialized as ticket_counts CTE, then joined with customer in main_query preserving the original semantics."
}
```