# DeepSeek V3 - TPC-DS Optimization Results

**Provider:** DeepSeek V3
**Database:** DuckDB SF100 (100GB)
**Optimizer:** DSPy pipeline
**Date:** 2026-02-01

---

## Summary

| Metric | Value |
|--------|-------|
| Queries Optimized | 82/99 |
| Average Speedup | 1.14x |
| Wins (>=1.2x) | 20 |
| Regressions (<1.0x) | 29 |
| **Validated (Sample)** | **72/82** |
| **Failed Validation** | **10** |

---

## Full Results

| Query | Status | Original | Optimized | Speedup | Pattern | Sample |
|-------|--------|----------|-----------|---------|---------|--------|
| q1 | pass | 20.3ms | 15.0ms | 1.35x | `CTE` | pass |
| q2 | fail | - | - | - | `-` | - |
| q3 | pass | 7.8ms | 7.8ms | 1.00x | `CTE_DATE` | pass |
| q4 | pass | 667.4ms | 533.1ms | 1.25x | `UNION` | pass |
| q5 | pass | 20.7ms | 22.8ms | 0.91x | `UNION` | pass |
| q6 | pass | 31.8ms | 29.5ms | 1.08x | `CTE_DATE` | pass |
| q7 | pass | 40.7ms | 42.5ms | 0.96x | `PRED` | pass |
| q8 | pass | 472.5ms | 450.3ms | 1.05x | `CTE_DATE` | pass |
| q9 | pass | 32.6ms | 32.6ms | 1.00x | `ORIG` | pass |
| q10 | pass | 35.7ms | 31.8ms | 1.12x | `CTE_DATE` | pass |
| q11 | fail | - | - | - | `-` | - |
| q12 | pass | 31.1ms | 33.2ms | 0.94x | `CTE` | pass |
| q13 | fail | - | - | - | `-` | - |
| q14 | fail | - | - | - | `-` | - |
| q15 | pass | 108.7ms | 36.5ms | **2.98x** | `UNION` | pass |
| q16 | pass | 15.9ms | 13.7ms | 1.16x | `EXISTS` | fail |
| q17 | pass | 24.2ms | 19.6ms | 1.23x | `CTE_DATE` | pass |
| q18 | pass | 60.1ms | 59.5ms | 1.01x | `CTE_DATE` | pass |
| q19 | pass | 23.5ms | 23.5ms | 1.00x | `ORIG` | pass |
| q20 | pass | 36.0ms | 33.3ms | 1.08x | `CTE_DATE` | pass |
| q21 | pass | 7.9ms | 8.7ms | 0.91x | `PRED` | pass |
| q22 | pass | 294.8ms | 312.5ms | 0.94x | `PRED` | pass |
| q23 | pass | 1035.6ms | 444.7ms | **2.33x** | `UNION` | fail |
| q24 | pass | 110.8ms | 51.3ms | **2.16x** | `UNION` | pass |
| q25 | pass | 11.6ms | 11.6ms | 1.00x | `ORIG` | pass |
| q26 | pass | 28.8ms | 27.9ms | 1.03x | `PRED` | pass |
| q27 | pass | 44.5ms | 44.3ms | 1.01x | `PRED` | pass |
| q28 | pass | 40.6ms | 40.6ms | 1.00x | `ORIG` | pass |
| q29 | pass | 21.4ms | 17.0ms | 1.26x | `CTE_DATE` | pass |
| q30 | fail | - | - | - | `-` | - |
| q31 | pass | 50.6ms | 46.4ms | 1.09x | `CTE_DATE` | pass |
| q32 | pass | 11.6ms | 10.1ms | 1.15x | `CTE_DATE` | pass |
| q33 | fail | - | - | - | `-` | - |
| q34 | pass | 13.2ms | 13.2ms | 1.00x | `ORIG` | pass |
| q35 | fail | - | - | - | `-` | - |
| q36 | pass | 65.8ms | 64.7ms | 1.02x | `PRED` | pass |
| q37 | pass | 14.1ms | 17.1ms | 0.83x | `PRED` | pass |
| q38 | fail | - | - | - | `-` | - |
| q39 | pass | 577.6ms | 236.3ms | **2.44x** | `CTE_DATE` | pass |
| q40 | pass | 59.3ms | 53.7ms | 1.10x | `PRED` | pass |
| q41 | pass | 80.9ms | 47.9ms | **1.69x** | `PRED` | pass |
| q42 | pass | 27.4ms | 25.9ms | 1.06x | `PRED` | pass |
| q43 | pass | 40.7ms | 49.7ms | 0.82x | `PRED` | pass |
| q44 | pass | 53.5ms | 48.2ms | 1.11x | `CTE` | pass |
| q45 | pass | 245.9ms | 108.8ms | **2.26x** | `UNION` | pass |
| q46 | pass | 328.4ms | 417.3ms | 0.79x | `PRED` | pass |
| q47 | pass | 535.6ms | 433.6ms | 1.24x | `CTE_DATE` | pass |
| q48 | pass | - | - | 1.01x | `ORIG` | pass |
| q49 | fail | - | - | - | `-` | - |
| q50 | pass | 57.2ms | 52.9ms | 1.08x | `PRED` | pass |
| q51 | pass | 505.9ms | 442.3ms | 1.14x | `CTE_DATE` | fail |
| q52 | pass | 45.9ms | 46.8ms | 0.98x | `CTE_DATE` | pass |
| q53 | fail | - | - | - | `-` | - |
| q54 | pass | 196.3ms | 215.6ms | 0.91x | `UNION` | pass |
| q55 | pass | 45.1ms | 45.4ms | 0.99x | `PRED` | pass |
| q56 | fail | - | - | - | `-` | - |
| q57 | pass | 506.9ms | 934.5ms | 0.54x | `CTE_DATE` | pass |
| q58 | pass | 61.5ms | 55.5ms | 1.11x | `CTE_DATE` | fail |
| q59 | fail | - | - | - | `-` | - |
| q60 | pass | 188.1ms | 194.5ms | 0.97x | `UNION` | pass |
| q61 | pass | 29.6ms | 23.9ms | 1.24x | `PRED` | pass |
| q62 | pass | 42.7ms | 34.4ms | 1.24x | `CTE_DATE` | pass |
| q63 | pass | 56.0ms | 151.8ms | 0.37x | `PRED` | pass |
| q64 | pass | 96.5ms | 82.6ms | 1.17x | `CTE` | fail |
| q65 | pass | 230.5ms | 199.5ms | 1.16x | `CTE` | fail |
| q66 | pass | 64.1ms | 58.0ms | 1.10x | `UNION` | pass |
| q67 | pass | 1439.5ms | 1642.6ms | 0.88x | `CTE_DATE` | pass |
| q68 | pass | 299.5ms | 422.7ms | 0.71x | `PRED` | pass |
| q69 | pass | 442.7ms | 362.2ms | 1.22x | `CTE_DATE` | pass |
| q70 | fail | - | - | - | `-` | - |
| q71 | pass | 261.4ms | 259.1ms | 1.01x | `UNION` | pass |
| q72 | pass | 266.3ms | 337.0ms | 0.79x | `CTE_DATE` | pass |
| q73 | pass | 123.2ms | 143.1ms | 0.86x | `CTE` | pass |
| q74 | pass | 738.5ms | 449.5ms | **1.64x** | `UNION` | pass |
| q75 | pass | 270.0ms | 272.3ms | 0.99x | `UNION` | fail |
| q76 | pass | 42.3ms | 88.5ms | 0.48x | `UNION` | pass |
| q77 | fail | - | - | - | `-` | - |
| q78 | pass | 319.0ms | 405.5ms | 0.79x | `CTE_DATE` | pass |
| q79 | pass | 180.4ms | 173.9ms | 1.04x | `PRED` | fail |
| q80 | pass | 92.3ms | 95.4ms | 0.97x | `UNION` | pass |
| q81 | fail | - | - | - | `-` | - |
| q82 | pass | 59.8ms | 48.6ms | 1.23x | `PRED` | pass |
| q83 | pass | 69.1ms | 89.8ms | 0.77x | `CTE_DATE` | fail |
| q84 | pass | 248.7ms | 230.7ms | 1.08x | `CTE` | pass |
| q85 | pass | 82.4ms | 70.4ms | 1.17x | `CTE_DATE` | fail |
| q86 | pass | 89.0ms | 127.5ms | 0.70x | `CTE_DATE` | pass |
| q87 | pass | 404.4ms | 409.5ms | 0.99x | `UNION` | pass |
| q88 | pass | 52.4ms | 33.5ms | **1.56x** | `PRED` | pass |
| q89 | pass | 185.1ms | 246.1ms | 0.75x | `CTE_DATE` | pass |
| q90 | pass | 57.1ms | 43.3ms | 1.32x | `PRED` | pass |
| q91 | pass | 149.6ms | 164.1ms | 0.91x | `CTE_DATE` | pass |
| q92 | pass | 101.0ms | 49.0ms | **2.06x** | `CTE_DATE` | pass |
| q93 | fail | - | - | - | `-` | - |
| q94 | fail | - | - | - | `-` | - |
| q95 | pass | 244.3ms | 108.7ms | **2.25x** | `MAT_CTE` | pass |
| q96 | pass | 26.6ms | 22.7ms | 1.17x | `CTE` | pass |
| q97 | pass | 124.8ms | 134.1ms | 0.93x | `CTE_DATE` | pass |
| q98 | pass | 168.8ms | 152.0ms | 1.11x | `PRED` | pass |
| q99 | pass | 48.5ms | 51.8ms | 0.94x | `PRED` | pass |

---

## Failed Validations (Semantic Errors)

These optimizations produce different results than the original query:

| Query | Pattern | Issue |
|-------|---------|-------|
| q16 | `EXISTS` | Values mismatch |
| q23 | `UNION` | Values mismatch |
| q51 | `CTE_DATE` | Values mismatch |
| q58 | `CTE_DATE` | Values mismatch |
| q64 | `CTE` | Values mismatch |
| q65 | `CTE` | Values mismatch |
| q75 | `UNION` | Values mismatch |
| q79 | `PRED` | Values mismatch |
| q83 | `CTE_DATE` | Values mismatch |
| q85 | `CTE_DATE` | Values mismatch |

---

## Top Wins (>=1.2x speedup)

| Query | Speedup | Pattern | Notes |
|-------|---------|---------|-------|
| q15 | 2.98x | `UNION` | OR conditions split into 3 UNION ALL branches |
| q39 | 2.44x | `CTE_DATE` | Split month-specific inventory into separate CTEs |
| q23 | 2.33x | `UNION` | Early date filtering (failed validation) |
| q45 | 2.26x | `UNION` | Materialized subquery for customer filtering |
| q95 | 2.25x | `MAT_CTE` | Web sales with early date filtering + EXISTS |
| q24 | 2.16x | `UNION` | Scan consolidation for store returns |
| q92 | 2.06x | `CTE_DATE` | Early date + item filtering with CTE |
| q41 | 1.69x | `PRED` | Simplified item filtering logic |
| q74 | 1.64x | `UNION` | Customer year-over-year with early filtering |
| q88 | 1.56x | `PRED` | Time-based aggregation with predicate pushdown |
| q1 | 1.35x | `CTE` | Store returns aggregation with CTE |
| q90 | 1.32x | `PRED` | Morning/afternoon sales ratio |
| q29 | 1.26x | `CTE_DATE` | Store sales/returns with item filtering |
| q4 | 1.25x | `UNION` | Customer lifetime value with early date filtering |
| q47 | 1.24x | `CTE_DATE` | Monthly sales comparison |
| q61 | 1.24x | `PRED` | Promotion analysis with predicate pushdown |
| q62 | 1.24x | `CTE_DATE` | Shipping mode analysis |
| q17 | 1.23x | `CTE_DATE` | Store/catalog sales correlation |
| q82 | 1.23x | `PRED` | Inventory analysis with date pushdown |
| q69 | 1.22x | `CTE_DATE` | Customer demographics with early filtering |

---

## Run Configuration

```yaml
optimizer: DSPy
model: deepseek-chat (V3)
database: DuckDB SF100
validation: 1-1-2-2 benchmark checksum
warmup_runs: 1
benchmark_runs: 3
```
