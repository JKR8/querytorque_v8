100% ▕██████████████████████████████████████▏ (00:00:02.32 elapsed)     
┌─────────────────────────────────────┐
│┌───────────────────────────────────┐│
││    Query Profiling Information    ││
│└───────────────────────────────────┘│
└─────────────────────────────────────┘
EXPLAIN ANALYZE WITH web_v1 as ( select ws_item_sk item_sk, d_date,   sum(sum(ws_sales_price)) over (partition by ws_item_sk order by d_date rows between unbounded preceding and current row) cume_sales from web_sales, date_dim where ws_sold_date_sk=d_date_sk and d_month_seq between 1216 and 1216+11 and ws_item_sk is not NULL group by ws_item_sk, d_date), store_v1 as ( select ss_item_sk item_sk, d_date,   sum(sum(ss_sales_price)) over (partition by ss_item_sk order by d_date rows between unbounded preceding and current row) cume_sales from store_sales, date_dim where ss_sold_date_sk=d_date_sk and d_month_seq between 1216 and 1216+11 and ss_item_sk is not NULL group by ss_item_sk, d_date) select * from (select item_sk, d_date, web_sales, store_sales,   max(web_sales) over (partition by item_sk order by d_date rows between unbounded preceding and current row) web_cumulative,   max(store_sales) over (partition by item_sk order by d_date rows between unbounded preceding and current row) store_cumulative from (select case when web.item_sk is not null then web.item_sk else store.item_sk end item_sk,   case when web.d_date is not null then web.d_date else store.d_date end d_date,   web.cume_sales web_sales, store.cume_sales store_sales from web_v1 web full outer join store_v1 store on (web.item_sk = store.item_sk and web.d_date = store.d_date))x )y where web_cumulative > store_cumulative order by item_sk, d_date LIMIT 100
┌────────────────────────────────────────────────┐
│┌──────────────────────────────────────────────┐│
││               Total Time: 2.32s              ││
│└──────────────────────────────────────────────┘│
└────────────────────────────────────────────────┘
┌───────────────────────────┐
│           QUERY           │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│      EXPLAIN_ANALYZE      │
│    ────────────────────   │
│           0 rows          │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│           TOP_N           │
│    ────────────────────   │
│          Top: 100         │
│                           │
│         Order By:         │
│       y.item_sk ASC       │
│        y.d_date ASC       │
│                           │
│          100 rows         │
│          (0.02s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│           FILTER          │
│    ────────────────────   │
│     (web_cumulative >     │
│      store_cumulative)    │
│                           │
│        178,690 rows       │
│          (0.06s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│             #0            │
│             #1            │
│             #2            │
│             #3            │
│             #4            │
│             #5            │
│                           │
│       5,541,413 rows      │
│          (0.01s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│           WINDOW          │
│    ────────────────────   │
│        Projections:       │
│    max(web_sales) OVER    │
│   (PARTITION BY item_sk   │
│  ORDER BY d_date ASC NULLS│
│      LAST ROWS BETWEEN    │
│   UNBOUNDED PRECEDING AND │
│        CURRENT ROW)       │
│   max(store_sales) OVER   │
│   (PARTITION BY item_sk   │
│  ORDER BY d_date ASC NULLS│
│      LAST ROWS BETWEEN    │
│   UNBOUNDED PRECEDING AND │
│        CURRENT ROW)       │
│                           │
│       5,541,413 rows      │
│          (7.66s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│          item_sk          │
│           d_date          │
│         web_sales         │
│        store_sales        │
│                           │
│       5,541,413 rows      │
│          (0.03s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         HASH_JOIN         │
│    ────────────────────   │
│      Join Type: FULL      │
│                           │
│        Conditions:        │
│     item_sk = item_sk     ├───────────────────────────────────────────┐
│      d_date = d_date      │                                           │
│                           │                                           │
│       5,541,413 rows      │                                           │
│          (0.60s)          │                                           │
└─────────────┬─────────────┘                                           │
┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐
│         PROJECTION        │                             │         PROJECTION        │
│    ────────────────────   │                             │    ────────────────────   │
│          item_sk          │                             │          item_sk          │
│           d_date          │                             │           d_date          │
│         cume_sales        │                             │         cume_sales        │
│                           │                             │                           │
│       4,591,986 rows      │                             │       1,367,938 rows      │
│          (0.00s)          │                             │          (0.00s)          │
└─────────────┬─────────────┘                             └─────────────┬─────────────┘
┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐
│         PROJECTION        │                             │         PROJECTION        │
│    ────────────────────   │                             │    ────────────────────   │
│             #0            │                             │             #0            │
│             #1            │                             │             #1            │
│             #2            │                             │             #2            │
│             #3            │                             │             #3            │
│                           │                             │                           │
│       4,591,986 rows      │                             │       1,367,938 rows      │
│          (0.00s)          │                             │          (0.00s)          │
└─────────────┬─────────────┘                             └─────────────┬─────────────┘
┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐
│           WINDOW          │                             │           WINDOW          │
│    ────────────────────   │                             │    ────────────────────   │
│        Projections:       │                             │        Projections:       │
│  sum(sum(ss_sales_price)) │                             │  sum(sum(ws_sales_price)) │
│     OVER (PARTITION BY    │                             │     OVER (PARTITION BY    │
│     ss_item_sk ORDER BY   │                             │     ws_item_sk ORDER BY   │
│    d_date ASC NULLS LAST  │                             │    d_date ASC NULLS LAST  │
│   ROWS BETWEEN UNBOUNDED  │                             │   ROWS BETWEEN UNBOUNDED  │
│ PRECEDING AND CURRENT ROW)│                             │ PRECEDING AND CURRENT ROW)│
│                           │                             │                           │
│       4,591,986 rows      │                             │       1,367,938 rows      │
│          (4.62s)          │                             │          (0.87s)          │
└─────────────┬─────────────┘                             └─────────────┬─────────────┘
┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐
│       HASH_GROUP_BY       │                             │       HASH_GROUP_BY       │
│    ────────────────────   │                             │    ────────────────────   │
│          Groups:          │                             │          Groups:          │
│             #0            │                             │             #0            │
│             #1            │                             │             #1            │
│                           │                             │                           │
│    Aggregates: sum(#2)    │                             │    Aggregates: sum(#2)    │
│                           │                             │                           │
│       4,591,986 rows      │                             │       1,367,938 rows      │
│          (1.85s)          │                             │          (0.35s)          │
└─────────────┬─────────────┘                             └─────────────┬─────────────┘
┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐
│         PROJECTION        │                             │         PROJECTION        │
│    ────────────────────   │                             │    ────────────────────   │
│         ss_item_sk        │                             │         ws_item_sk        │
│           d_date          │                             │           d_date          │
│       ss_sales_price      │                             │       ws_sales_price      │
│                           │                             │                           │
│       5,505,948 rows      │                             │       1,437,873 rows      │
│          (0.00s)          │                             │          (0.00s)          │
└─────────────┬─────────────┘                             └─────────────┬─────────────┘
┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐
│         HASH_JOIN         │                             │         HASH_JOIN         │
│    ────────────────────   │                             │    ────────────────────   │
│      Join Type: INNER     │                             │      Join Type: INNER     │
│                           │                             │                           │
│        Conditions:        ├──────────────┐              │        Conditions:        ├──────────────┐
│ss_sold_date_sk = d_date_sk│              │              │ws_sold_date_sk = d_date_sk│              │
│                           │              │              │                           │              │
│       5,505,948 rows      │              │              │       1,437,873 rows      │              │
│          (0.05s)          │              │              │          (0.03s)          │              │
└─────────────┬─────────────┘              │              └─────────────┬─────────────┘              │
┌─────────────┴─────────────┐┌─────────────┴─────────────┐┌─────────────┴─────────────┐┌─────────────┴─────────────┐
│         TABLE_SCAN        ││           FILTER          ││         TABLE_SCAN        ││           FILTER          │
│    ────────────────────   ││    ────────────────────   ││    ────────────────────   ││    ────────────────────   │
│     Table: store_sales    ││ (d_date_sk BETWEEN 2450816││      Table: web_sales     ││ (d_date_sk BETWEEN 2450816│
│   Type: Sequential Scan   ││        AND 2452642)       ││   Type: Sequential Scan   ││        AND 2452642)       │
│                           ││                           ││                           ││                           │
│        Projections:       ││                           ││        Projections:       ││                           │
│      ss_sold_date_sk      ││                           ││      ws_sold_date_sk      ││                           │
│         ss_item_sk        ││                           ││         ws_item_sk        ││                           │
│       ss_sales_price      ││                           ││       ws_sales_price      ││                           │
│                           ││                           ││                           ││                           │
│       5,505,948 rows      ││          365 rows         ││       1,437,873 rows      ││          365 rows         │
│          (4.32s)          ││          (0.00s)          ││          (1.81s)          ││          (0.00s)          │
└───────────────────────────┘└─────────────┬─────────────┘└───────────────────────────┘└─────────────┬─────────────┘
                             ┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐
                             │         TABLE_SCAN        │                             │         TABLE_SCAN        │
                             │    ────────────────────   │                             │    ────────────────────   │
                             │      Table: date_dim      │                             │      Table: date_dim      │
                             │   Type: Sequential Scan   │                             │   Type: Sequential Scan   │
                             │                           │                             │                           │
                             │        Projections:       │                             │        Projections:       │
                             │         d_date_sk         │                             │         d_date_sk         │
                             │           d_date          │                             │           d_date          │
                             │                           │                             │                           │
                             │          Filters:         │                             │          Filters:         │
                             │   d_month_seq>=1216 AND   │                             │   d_month_seq>=1216 AND   │
                             │      d_month_seq<=1227    │                             │      d_month_seq<=1227    │
                             │                           │                             │                           │
                             │          365 rows         │                             │          365 rows         │
                             │          (0.00s)          │                             │          (0.00s)          │
                             └───────────────────────────┘                             └───────────────────────────┘

