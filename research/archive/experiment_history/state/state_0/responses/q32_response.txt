Looking at this query, I see a correlated subquery computing average discount amounts for each item within a date range. The main query then sums discount amounts for manufacturer 29 items where the discount exceeds 1.3x the item's average. The execution plan shows multiple full scans of catalog_sales.

**Key optimization opportunities:**
1. **Date CTE Isolation**: Both outer query and subquery use the same date range filter
2. **Correlated subquery to pre-computed CTE**: The subquery computes per-item averages that can be pre-calculated
3. **Pushdown opportunities**: Manufacturer filter can be pushed earlier

**Approach:**
- Create a date CTE to filter date_dim once
- Pre-compute per-item average discounts in the date range
- Join this with catalog_sales for manufacturer 29

```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "semantic_rewrite",
      "nodes": {
        "date_range": "SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1999-01-07' AND (CAST('1999-01-07' AS DATE) + INTERVAL '90' DAY)",
        "item_avg_discount": "SELECT cs_item_sk, 1.3 * AVG(cs_ext_discount_amt) AS avg_discount_threshold FROM catalog_sales JOIN date_range ON cs_sold_date_sk = d_date_sk GROUP BY cs_item_sk",
        "main_query": "SELECT SUM(cs.cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN date_range d ON cs.cs_sold_date_sk = d.d_date_sk JOIN item_avg_discount avg ON cs.cs_item_sk = avg.cs_item_sk WHERE i.i_manufact_id = 29 AND cs.cs_ext_discount_amt > avg.avg_discount_threshold LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same column output",
        "same aggregation"
      ],
      "expected_speedup": "2.5x",
      "risk": "low"
    }
  ],
  "explanation": "Created two CTEs: 1) date_range filters date_dim once for both main query and subquery, avoiding duplicate filtering. 2) item_avg_discount pre-computes 1.3x average discount per item for the date range, eliminating the correlated subquery. Main query joins these CTEs, applying manufacturer filter and comparing discount amounts to pre-computed thresholds."
}
```