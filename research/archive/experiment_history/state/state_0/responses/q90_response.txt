```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "multi_dimension_prefetch",
      "nodes": {
        "filtered_household_demographics": "SELECT hd_demo_sk FROM household_demographics WHERE hd_dep_count = 2",
        "filtered_web_page": "SELECT wp_web_page_sk FROM web_page WHERE wp_char_count BETWEEN 5000 AND 5200",
        "filtered_time_am": "SELECT t_time_sk FROM time_dim WHERE t_hour BETWEEN 10 AND 11",
        "filtered_time_pm": "SELECT t_time_sk FROM time_dim WHERE t_hour BETWEEN 16 AND 17",
        "filtered_web_data": "SELECT 1 AS am_flag, NULL AS pm_flag FROM web_sales AS ws JOIN filtered_household_demographics AS hd ON ws.ws_ship_hdemo_sk = hd.hd_demo_sk JOIN filtered_time_am AS t ON ws.ws_sold_time_sk = t.t_time_sk JOIN filtered_web_page AS wp ON ws.ws_web_page_sk = wp.wp_web_page_sk UNION ALL SELECT NULL AS am_flag, 1 AS pm_flag FROM web_sales AS ws JOIN filtered_household_demographics AS hd ON ws.ws_ship_hdemo_sk = hd.hd_demo_sk JOIN filtered_time_pm AS t ON ws.ws_sold_time_sk = t.t_time_sk JOIN filtered_web_page AS wp ON ws.ws_web_page_sk = wp.wp_web_page_sk",
        "counts": "SELECT COUNT(am_flag) AS amc, COUNT(pm_flag) AS pmc FROM filtered_web_data",
        "main_query": "SELECT CAST(amc AS DECIMAL(15,4)) / CAST(pmc AS DECIMAL(15,4)) AS am_pm_ratio FROM counts ORDER BY am_pm_ratio LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same ordering",
        "same column output",
        "same grouping and aggregation"
      ],
      "expected_speedup": "2.5x",
      "risk": "low"
    }
  ],
  "explanation": "1. Pre-filtered all three dimension tables (household_demographics, web_page, time_dim) into separate CTEs with only needed columns. 2. Split the OR condition on time_dim into two separate time range CTEs (am and pm). 3. Used UNION ALL to combine the AM and PM branches - this eliminates the OR predicate and allows separate efficient joins for each time range. 4. Each branch joins web_sales with pre-filtered dimension tables, significantly reducing intermediate result sizes. 5. Preserved exact literal values and CASE logic structure from original query."
}
```