```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "prefetch_fact_join",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('2000-08-23' AS DATE) AND CAST('2000-09-06' AS DATE)",
        "ssr": "SELECT s_store_id, SUM(sales_price) AS sales, SUM(profit) AS profit, SUM(return_amt) AS returns_, SUM(net_loss) AS profit_loss FROM (SELECT ss_store_sk AS store_sk, ss_sold_date_sk AS date_sk, ss_ext_sales_price AS sales_price, ss_net_profit AS profit, CAST(0 AS DECIMAL(7,2)) AS return_amt, CAST(0 AS DECIMAL(7,2)) AS net_loss FROM store_sales JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk UNION ALL SELECT sr_store_sk AS store_sk, sr_returned_date_sk AS date_sk, CAST(0 AS DECIMAL(7,2)) AS sales_price, CAST(0 AS DECIMAL(7,2)) AS profit, sr_return_amt AS return_amt, sr_net_loss AS net_loss FROM store_returns JOIN filtered_dates ON store_returns.sr_returned_date_sk = filtered_dates.d_date_sk) AS salesreturns JOIN store ON salesreturns.store_sk = store.s_store_sk GROUP BY s_store_id",
        "wsr": "SELECT web_site_id, SUM(sales_price) AS sales, SUM(profit) AS profit, SUM(return_amt) AS returns_, SUM(net_loss) AS profit_loss FROM (SELECT ws_web_site_sk AS wsr_web_site_sk, ws_sold_date_sk AS date_sk, ws_ext_sales_price AS sales_price, ws_net_profit AS profit, CAST(0 AS DECIMAL(7,2)) AS return_amt, CAST(0 AS DECIMAL(7,2)) AS net_loss FROM web_sales JOIN filtered_dates ON web_sales.ws_sold_date_sk = filtered_dates.d_date_sk UNION ALL SELECT ws_web_site_sk AS wsr_web_site_sk, wr_returned_date_sk AS date_sk, CAST(0 AS DECIMAL(7,2)) AS sales_price, CAST(0 AS DECIMAL(7,2)) AS profit, wr_return_amt AS return_amt, wr_net_loss AS net_loss FROM web_returns LEFT OUTER JOIN web_sales ON (wr_item_sk = ws_item_sk AND wr_order_number = ws_order_number) JOIN filtered_dates ON web_returns.wr_returned_date_sk = filtered_dates.d_date_sk) AS salesreturns JOIN web_site ON salesreturns.wsr_web_site_sk = web_site.web_site_sk GROUP BY web_site_id"
      },
      "invariants_kept": [
        "same result rows",
        "same column output",
        "same grouping and aggregation",
        "same literal values"
      ],
      "expected_speedup": "2.0x",
      "risk": "low"
    }
  ],
  "explanation": "Applied prefetch_fact_join pattern to isolate date filtering into a dedicated CTE (filtered_dates) that is joined directly with fact tables (store_sales, store_returns, web_sales, web_returns) before UNION ALL. This reduces the rows flowing into the UNION and subsequent joins by applying the date filter early. The transformation preserves all original literal values and logical semantics."
}
```