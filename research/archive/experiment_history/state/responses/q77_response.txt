```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1998-08-05' AS DATE) AND (CAST('1998-08-05' AS DATE) + INTERVAL '30' DAY)",
        "ss": "SELECT s_store_sk, SUM(ss_ext_sales_price) AS sales, SUM(ss_net_profit) AS profit FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN store ON ss_store_sk = s_store_sk GROUP BY s_store_sk",
        "ws": "SELECT wp_web_page_sk, SUM(ws_ext_sales_price) AS sales, SUM(ws_net_profit) AS profit FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk JOIN web_page ON ws_web_page_sk = wp_web_page_sk GROUP BY wp_web_page_sk",
        "main_query": "SELECT channel, id, SUM(sales) AS sales, SUM(\"returns\") AS \"returns\", SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, ss.s_store_sk AS id, sales, COALESCE(\"returns\", 0) AS \"returns\", (profit - COALESCE(profit_loss, 0)) AS profit FROM ss LEFT JOIN sr ON ss.s_store_sk = sr.s_store_sk UNION ALL SELECT 'catalog channel' AS channel, cs_call_center_sk AS id, sales, \"returns\", (profit - profit_loss) AS profit FROM cs, cr UNION ALL SELECT 'web channel' AS channel, ws.wp_web_page_sk AS id, sales, COALESCE(\"returns\", 0) AS \"returns\", (profit - COALESCE(profit_loss, 0)) AS profit FROM ws LEFT JOIN wr ON ws.wp_web_page_sk = wr.wp_web_page_sk) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same ordering",
        "same column output",
        "same grouping and aggregation"
      ],
      "expected_speedup": "2.5x",
      "risk": "low"
    }
  ],
  "explanation": "Created a single filtered_dates CTE that isolates the date filter and provides only the d_date_sk values for the 30-day period. Both ss and ws CTEs now join with this filtered_dates CTE instead of scanning the entire date_dim table. This eliminates 4 redundant date_dim scans (from original 6 down to 2) and ensures the expensive fact table joins happen only with the 31 filtered date rows. The filter is applied once at the beginning rather than repeatedly in each CTE."
}
```