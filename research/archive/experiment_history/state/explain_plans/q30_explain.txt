-- Q30 EXPLAIN ANALYZE (SF10)
-- State: baseline
-- Best speedup: 1.00x
-- Source SQL: /mnt/d/TPC-DS/queries_duckdb_converted/query_30.sql

analyzed_plan
┌─────────────────────────────────────┐
│┌───────────────────────────────────┐│
││    Query Profiling Information    ││
│└───────────────────────────────────┘│
└─────────────────────────────────────┘
EXPLAIN ANALYZE with customer_total_return as  (select wr_returning_customer_sk as ctr_customer_sk         ,ca_state as ctr_state,   	sum(wr_return_amt) as ctr_total_return  from web_returns      ,date_dim      ,customer_address  where wr_returned_date_sk = d_date_sk     and d_year =2002    and wr_returning_addr_sk = ca_address_sk   group by wr_returning_customer_sk          ,ca_state)   select c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag        ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address        ,c_last_review_date_sk,ctr_total_return  from customer_total_return ctr1      ,customer_address      ,customer  where ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2  			  from customer_total_return ctr2                    	  where ctr1.ctr_state = ctr2.ctr_state)        and ca_address_sk = c_current_addr_sk        and ca_state = 'IN'        and ctr1.ctr_customer_sk = c_customer_sk  order by c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag                   ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address                   ,c_last_review_date_sk,ctr_total_return  LIMIT 100
┌────────────────────────────────────────────────┐
│┌──────────────────────────────────────────────┐│
││              Total Time: 0.238s              ││
│└──────────────────────────────────────────────┘│
└────────────────────────────────────────────────┘
┌─────────────────────┐
│        QUERY        │
└──────────┬──────────┘
┌──────────┴──────────┐
│   EXPLAIN_ANALYZE   │
│    ──────────────   │
│        0 rows       │
│       (0.00s)       │
└──────────┬──────────┘
┌──────────┴──────────┐
│         CTE         │
│    ──────────────   │
│      CTE Name:      │
│customer_total_return│
│                     ├─────────────────────────────────────────────────────────┐
│    Table Index: 0   │                                                         │
│                     │                                                         │
│        0 rows       │                                                         │
│       (0.00s)       │                                                         │
└──────────┬──────────┘                                                         │
┌──────────┴──────────┐                                              ┌──────────┴──────────┐
│      PROJECTION     │                                              │        TOP_N        │
│    ──────────────   │                                              │    ──────────────   │
│          #0         │                                              │       Top: 100      │
│__internal_decompress│                                              │                     │
│     _string(#1)     │                                              │      Order By:      │
│          #2         │                                              │   tpcds_sf10.main   │
│                     │                                              │      .customer      │
│                     │                                              │  .c_customer_id ASC │
│                     │                                              │   tpcds_sf10.main   │
│                     │                                              │      .customer      │
│                     │                                              │  .c_salutation ASC  │
│                     │                                              │   tpcds_sf10.main   │
│                     │                                              │      .customer      │
│                     │                                              │  .c_first_name ASC  │
│                     │                                              │   tpcds_sf10.main   │
│                     │                                              │      .customer      │
│                     │                                              │   .c_last_name ASC  │
│                     │                                              │   tpcds_sf10.main   │
│                     │                                              │      .customer      │
│                     │                                              │.c_preferred_cust_fla│
│                     │                                              │        g ASC        │
│                     │                                              │   tpcds_sf10.main   │
│                     │                                              │      .customer      │
│                     │                                              │   .c_birth_day ASC  │
│                     │                                              │   tpcds_sf10.main   │
│                     │                                              │      .customer      │
│                     │                                              │  .c_birth_month ASC │
│                     │                                              │   tpcds_sf10.main   │
│                     │                                              │      .customer      │
│                     │                                              │  .c_birth_year ASC  │
│                     │                                              │   tpcds_sf10.main   │
│                     │                                              │      .customer      │
│                     │                                              │ .c_birth_country ASC│
│                     │                                              │   tpcds_sf10.main   │
│                     │                                              │.customer.c_login ASC│
│                     │                                              │   tpcds_sf10.main   │
│                     │                                              │      .customer      │
│                     │                                              │ .c_email_address ASC│
│                     │                                              │   tpcds_sf10.main   │
│                     │                                              │      .customer      │
│                     │                                              │.c_last_review_date_s│
│                     │                                              │        k ASC        │
│                     │                                              │ctr1.ctr_total_return│
│                     │                                              │          ASC        │
│                     │                                              │                     │
│     131,755 rows    │                                              │       100 rows      │
│       (0.00s)       │                                              │       (0.00s)       │
└──────────┬──────────┘                                              └──────────┬──────────┘
┌──────────┴──────────┐                                              ┌──────────┴──────────┐
│    HASH_GROUP_BY    │                                              │      PROJECTION     │
│    ──────────────   │                                              │    ──────────────   │
│       Groups:       │                                              │          #0         │
│          #0         │                                              │          #1         │
│          #1         │                                              │          #2         │
│                     │                                              │          #3         │
│     Aggregates:     │                                              │          #4         │
│       sum(#2)       │                                              │          #5         │
│                     │                                              │          #6         │
│                     │                                              │          #7         │
│                     │                                              │          #8         │
│                     │                                              │          #9         │
│                     │                                              │         #10         │
│                     │                                              │         #11         │
│                     │                                              │         #12         │
│                     │                                              │                     │
│     131,755 rows    │                                              │       913 rows      │
│       (0.05s)       │                                              │       (0.00s)       │
└──────────┬──────────┘                                              └──────────┬──────────┘
┌──────────┴──────────┐                                              ┌──────────┴──────────┐
│      PROJECTION     │                                              │        FILTER       │
│    ──────────────   │                                              │    ──────────────   │
│wr_returning_customer│                                              │(CAST(ctr_total_retur│
│         _sk         │                                              │    n AS DOUBLE) >   │
│       ca_state      │                                              │       SUBQUERY)     │
│    wr_return_amt    │                                              │                     │
│                     │                                              │                     │
│     134,125 rows    │                                              │       913 rows      │
│       (0.00s)       │                                              │       (0.00s)       │
└──────────┬──────────┘                                              └──────────┬──────────┘
┌──────────┴──────────┐                                              ┌──────────┴──────────┐
│      PROJECTION     │                                              │   LEFT_DELIM_JOIN   │
│    ──────────────   │                                              │    ──────────────   │
│__internal_compress_s│                                              │   Join Type: LEFT   │
│  tring_uinteger(#0) │                                              │                     │
│          #1         │                                              │     Conditions:     │
│          #2         │                                              │   ctr_state IS NOT  │
│                     │                                              │     DISTINCT FROM   ├─────────────────────────────────────────────────────────┬────────────────────────────────────────────────────────────────────┐
│                     │                                              │       ctr_state     │                                                         │                                                                    │
│                     │                                              │                     │                                                         │                                                                    │
│                     │                                              │    Delim Index: 1   │                                                         │                                                                    │
│                     │                                              │                     │                                                         │                                                                    │
│     134,125 rows    │                                              │        0 rows       │                                                         │                                                                    │
│       (0.00s)       │                                              │       (0.00s)       │                                                         │                                                                    │
└──────────┬──────────┘                                              └──────────┬──────────┘                                                         │                                                                    │
┌──────────┴──────────┐                                              ┌──────────┴──────────┐                                              ┌──────────┴──────────┐                                              ┌──────────┴──────────┐
│      HASH_JOIN      │                                              │      HASH_JOIN      │                                              │      HASH_JOIN      │                                              │    HASH_GROUP_BY    │
│    ──────────────   │                                              │    ──────────────   │                                              │    ──────────────   │                                              │    ──────────────   │
│      Join Type:     │                                              │      Join Type:     │                                              │   Join Type: LEFT   │                                              │     Groups: #12     │
│        INNER        │                                              │        INNER        │                                              │                     │                                              │                     │
│                     │                                              │                     │                                              │     Conditions:     │                                              │                     │
│     Conditions:     ├───────────┐                                  │     Conditions:     ├──────────────────────────────────┐           │   ctr_state IS NOT  ├───────────┐                                  │                     │
│   ca_address_sk =   │           │                                  │ c_current_addr_sk = │                                  │           │     DISTINCT FROM   │           │                                  │                     │
│ wr_returning_addr_sk│           │                                  │     ca_address_sk   │                                  │           │       ctr_state     │           │                                  │                     │
│                     │           │                                  │                     │                                  │           │                     │           │                                  │                     │
│     134,125 rows    │           │                                  │      3,649 rows     │                                  │           │      3,649 rows     │           │                                  │       51 rows       │
│       (0.03s)       │           │                                  │       (0.05s)       │                                  │           │       (0.00s)       │           │                                  │       (0.00s)       │
└──────────┬──────────┘           │                                  └──────────┬──────────┘                                  │           └──────────┬──────────┘           │                                  └─────────────────────┘
┌──────────┴──────────┐┌──────────┴──────────┐                       ┌──────────┴──────────┐                       ┌──────────┴──────────┐┌──────────┴──────────┐┌──────────┴──────────┐
│      TABLE_SCAN     ││      HASH_JOIN      │                       │      HASH_JOIN      │                       │      TABLE_SCAN     ││   COLUMN_DATA_SCAN  ││      PROJECTION     │
│    ──────────────   ││    ──────────────   │                       │    ──────────────   │                       │    ──────────────   ││                     ││    ──────────────   │
│        Table:       ││      Join Type:     │                       │      Join Type:     │                       │        Table:       ││                     ││(avg(ctr_total_return│
│   customer_address  ││        INNER        │                       │        INNER        │                       │   customer_address  ││                     ││       ) * 1.2)      │
│                     ││                     │                       │                     │                       │                     ││                     ││      ctr_state      │
│        Type:        ││     Conditions:     │                       │     Conditions:     │                       │        Type:        ││                     ││                     │
│   Sequential Scan   ││ wr_returned_date_sk │                       │   c_customer_sk =   │                       │   Sequential Scan   ││                     ││                     │
│                     ││     = d_date_sk     ├───────────┐           │    ctr_customer_sk  ├───────────┐           │                     ││                     ││                     │
│     Projections:    ││                     │           │           │                     │           │           │       Filters:      ││                     ││                     │
│    ca_address_sk    ││                     │           │           │                     │           │           │    ca_state='IN'    ││                     ││                     │
│       ca_state      ││                     │           │           │                     │           │           │                     ││                     ││                     │
│                     ││                     │           │           │                     │           │           │                     ││                     ││                     │
│     249,998 rows    ││     137,371 rows    │           │           │     131,645 rows    │           │           │      7,077 rows     ││      3,649 rows     ││       50 rows       │
│       (0.00s)       ││       (0.00s)       │           │           │       (0.07s)       │           │           │       (0.00s)       ││       (0.00s)       ││       (0.00s)       │
└─────────────────────┘└──────────┬──────────┘           │           └──────────┬──────────┘           │           └─────────────────────┘└─────────────────────┘└──────────┬──────────┘
                       ┌──────────┴──────────┐┌──────────┴──────────┐┌──────────┴──────────┐┌──────────┴──────────┐                                              ┌──────────┴──────────┐
                       │      TABLE_SCAN     ││        FILTER       ││      TABLE_SCAN     ││       CTE_SCAN      │                                              │    HASH_GROUP_BY    │
                       │    ──────────────   ││    ──────────────   ││    ──────────────   ││    ──────────────   │                                              │    ──────────────   │
                       │        Table:       ││  (d_date_sk BETWEEN ││   Table: customer   ││     CTE Index: 0    │                                              │      Groups: #0     │
                       │     web_returns     ││ 2450821 AND 2452997)││                     ││                     │                                              │                     │
                       │                     ││                     ││        Type:        ││                     │                                              │     Aggregates:     │
                       │        Type:        ││                     ││   Sequential Scan   ││                     │                                              │       avg(#1)       │
                       │   Sequential Scan   ││                     ││                     ││                     │                                              │                     │
                       │                     ││                     ││                     ││                     │                                              │                     │
                       │     Projections:    ││                     ││                     ││                     │                                              │                     │
                       │ wr_returned_date_sk ││                     ││                     ││                     │                                              │                     │
                       │ wr_returning_addr_sk││                     ││                     ││                     │                                              │                     │
                       │wr_returning_customer││                     ││                     ││                     │                                              │                     │
                       │         _sk         ││                     ││                     ││                     │                                              │                     │
                       │    wr_return_amt    ││                     ││                     ││                     │                                              │                     │
                       │                     ││                     ││                     ││                     │                                              │                     │
                       │     137,371 rows    ││       365 rows      ││     499,731 rows    ││     131,755 rows    │                                              │       50 rows       │
                       │       (0.28s)       ││       (0.00s)       ││       (0.22s)       ││       (0.00s)       │                                              │       (0.02s)       │
                       └─────────────────────┘└──────────┬──────────┘└─────────────────────┘└─────────────────────┘                                              └──────────┬──────────┘
                                              ┌──────────┴──────────┐                                                                                            ┌──────────┴──────────┐
                                              │      TABLE_SCAN     │                                                                                            │      PROJECTION     │
                                              │    ──────────────   │                                                                                            │    ──────────────   │
                                              │   Table: date_dim   │                                                                                            │      ctr_state      │
                                              │                     │                                                                                            │   ctr_total_return  │
                                              │        Type:        │                                                                                            │                     │
                                              │   Sequential Scan   │                                                                                            │                     │
                                              │                     │                                                                                            │                     │
                                              │     Projections:    │                                                                                            │                     │
                                              │      d_date_sk      │                                                                                            │                     │
                                              │                     │                                                                                            │                     │
                                              │       Filters:      │                                                                                            │                     │
                                              │     d_year=2002     │                                                                                            │                     │
                                              │                     │                                                                                            │                     │
                                              │       365 rows      │                                                                                            │     127,710 rows    │
                                              │       (0.00s)       │                                                                                            │       (0.00s)       │
                                              └─────────────────────┘                                                                                            └──────────┬──────────┘
                                                                                                                                                                 ┌──────────┴──────────┐
                                                                                                                                                                 │      HASH_JOIN      │
                                                                                                                                                                 │    ──────────────   │
                                                                                                                                                                 │      Join Type:     │
                                                                                                                                                                 │        INNER        │
                                                                                                                                                                 │                     │
                                                                                                                                                                 │     Conditions:     ├───────────┐
                                                                                                                                                                 │ctr_state = ctr_state│           │
                                                                                                                                                                 │                     │           │
                                                                                                                                                                 │     127,710 rows    │           │
                                                                                                                                                                 │       (0.00s)       │           │
                                                                                                                                                                 └──────────┬──────────┘           │
                                                                                                                                                                 ┌──────────┴──────────┐┌──────────┴──────────┐
                                                                                                                                                                 │       CTE_SCAN      ││      DELIM_SCAN     │
                                                                                                                                                                 │    ──────────────   ││    ──────────────   │
                                                                                                                                                                 │     CTE Index: 0    ││    Delim Index: 1   │
                                                                                                                                                                 │                     ││                     │
                                                                                                                                                                 │     131,755 rows    ││        0 rows       │
                                                                                                                                                                 │       (0.00s)       ││       (0.00s)       │
                                                                                                                                                                 └─────────────────────┘└─────────────────────┘
