-- Q89 EXPLAIN ANALYZE (SF10)
-- State: baseline
-- Best speedup: 1.00x
-- Source SQL: /mnt/d/TPC-DS/queries_duckdb_converted/query_89.sql

analyzed_plan
┌─────────────────────────────────────┐
│┌───────────────────────────────────┐│
││    Query Profiling Information    ││
│└───────────────────────────────────┘│
└─────────────────────────────────────┘
EXPLAIN ANALYZE select * from( select i_category, i_class, i_brand,        s_store_name, s_company_name,        d_moy,        sum(ss_sales_price) sum_sales,        avg(sum(ss_sales_price)) over          (partition by i_category, i_brand, s_store_name, s_company_name)          avg_monthly_sales from item, store_sales, date_dim, store where ss_item_sk = i_item_sk and       ss_sold_date_sk = d_date_sk and       ss_store_sk = s_store_sk and       d_year in (1999) and         ((i_category in ('Jewelry','Shoes','Electronics') and           i_class in ('semi-precious','athletic','portable')          )       or (i_category in ('Men','Music','Women') and           i_class in ('accessories','rock','maternity')          )) group by i_category, i_class, i_brand,          s_store_name, s_company_name, d_moy) tmp1 where case when (avg_monthly_sales <> 0) then (abs(sum_sales - avg_monthly_sales) / avg_monthly_sales) else null end > 0.1 order by sum_sales - avg_monthly_sales, s_store_name  LIMIT 100
┌────────────────────────────────────────────────┐
│┌──────────────────────────────────────────────┐│
││              Total Time: 0.183s              ││
│└──────────────────────────────────────────────┘│
└────────────────────────────────────────────────┘
┌───────────────────────────┐
│           QUERY           │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│      EXPLAIN_ANALYZE      │
│    ────────────────────   │
│           0 rows          │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│             #0            │
│             #1            │
│             #2            │
│             #3            │
│             #4            │
│             #5            │
│             #6            │
│             #7            │
│                           │
│          100 rows         │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│           TOP_N           │
│    ────────────────────   │
│          Top: 100         │
│                           │
│         Order By:         │
│           #8 ASC          │
│   tmp1.s_store_name ASC   │
│                           │
│          100 rows         │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│         i_category        │
│          i_class          │
│          i_brand          │
│        s_store_name       │
│       s_company_name      │
│           d_moy           │
│         sum_sales         │
│     avg_monthly_sales     │
│ (CAST(sum_sales AS DOUBLE)│
│    - avg_monthly_sales)   │
│                           │
│         4,104 rows        │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│           FILTER          │
│    ────────────────────   │
│       (CASE  WHEN (       │
│ (avg_monthly_sales != 0.0)│
│     ) THEN ((abs((CAST    │
│  (sum_sales AS DOUBLE) -  │
│    avg_monthly_sales)) /  │
│  avg_monthly_sales)) ELSE │
│       NULL END > 0.1)     │
│                           │
│         4,104 rows        │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│             #0            │
│             #1            │
│             #2            │
│             #3            │
│             #4            │
│             #5            │
│             #6            │
│             #7            │
│                           │
│         4,414 rows        │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│           WINDOW          │
│    ────────────────────   │
│        Projections:       │
│  avg(sum(ss_sales_price)) │
│     OVER (PARTITION BY    │
│    i_category, i_brand,   │
│        s_store_name,      │
│       s_company_name)     │
│                           │
│         4,414 rows        │
│          (0.03s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│__internal_decompress_strin│
│           g(#0)           │
│__internal_decompress_strin│
│           g(#1)           │
│             #2            │
│__internal_decompress_strin│
│           g(#3)           │
│__internal_decompress_strin│
│           g(#4)           │
│__internal_decompress_integ│
│     ral_integer(#5, 1)    │
│             #6            │
│                           │
│         4,414 rows        │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│       HASH_GROUP_BY       │
│    ────────────────────   │
│          Groups:          │
│             #0            │
│             #1            │
│             #2            │
│             #3            │
│             #4            │
│             #5            │
│                           │
│    Aggregates: sum(#6)    │
│                           │
│         4,414 rows        │
│          (0.26s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│         i_category        │
│          i_class          │
│          i_brand          │
│        s_store_name       │
│       s_company_name      │
│           d_moy           │
│       ss_sales_price      │
│                           │
│        593,016 rows       │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│__internal_compress_string_│
│        uhugeint(#2)       │
│__internal_compress_string_│
│        uhugeint(#3)       │
│             #4            │
│             #0            │
│__internal_compress_integra│
│     l_utinyint(#1, 1)     │
│__internal_compress_string_│
│        ubigint(#5)        │
│__internal_compress_string_│
│        ubigint(#6)        │
│                           │
│        593,016 rows       │
│          (0.03s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         HASH_JOIN         │
│    ────────────────────   │
│      Join Type: INNER     │
│                           │
│        Conditions:        ├────────────────────────────────────────────────────────────────────────┐
│  ss_store_sk = s_store_sk │                                                                        │
│                           │                                                                        │
│        593,016 rows       │                                                                        │
│          (0.00s)          │                                                                        │
└─────────────┬─────────────┘                                                                        │
┌─────────────┴─────────────┐                                                          ┌─────────────┴─────────────┐
│         HASH_JOIN         │                                                          │         TABLE_SCAN        │
│    ────────────────────   │                                                          │    ────────────────────   │
│      Join Type: INNER     │                                                          │        Table: store       │
│                           │                                                          │   Type: Sequential Scan   │
│        Conditions:        │                                                          │                           │
│   ss_item_sk = i_item_sk  │                                                          │        Projections:       │
│                           │                                                          │         s_store_sk        │
│                           ├───────────────────────────────────────────┐              │        s_store_name       │
│                           │                                           │              │       s_company_name      │
│                           │                                           │              │                           │
│                           │                                           │              │          Filters:         │
│                           │                                           │              │      s_store_sk<=100      │
│                           │                                           │              │                           │
│        593,016 rows       │                                           │              │          100 rows         │
│          (0.36s)          │                                           │              │          (0.00s)          │
└─────────────┬─────────────┘                                           │              └───────────────────────────┘
┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐
│         HASH_JOIN         │                             │           FILTER          │
│    ────────────────────   │                             │    ────────────────────   │
│      Join Type: INNER     │                             │ ((((i_category = 'Jewelry'│
│                           │                             │ ) OR (i_category = 'Shoes'│
│        Conditions:        │                             │    ) OR (i_category =     │
│ss_sold_date_sk = d_date_sk│                             │   'Electronics')) AND (   │
│                           │                             │ (i_class = 'semi-precious'│
│                           │                             │ ) OR (i_class = 'athletic'│
│                           │                             │ ) OR (i_class = 'portable'│
│                           ├──────────────┐              │  ))) OR (((i_category =   │
│                           │              │              │  'Men') OR (i_category =  │
│                           │              │              │ 'Music') OR (i_category = │
│                           │              │              │ 'Women')) AND ((i_class = │
│                           │              │              │ 'accessories') OR (i_class│
│                           │              │              │  = 'rock') OR (i_class =  │
│                           │              │              │      'maternity'))))      │
│                           │              │              │                           │
│       5,375,888 rows      │              │              │        11,448 rows        │
│          (0.15s)          │              │              │          (0.00s)          │
└─────────────┬─────────────┘              │              └─────────────┬─────────────┘
┌─────────────┴─────────────┐┌─────────────┴─────────────┐┌─────────────┴─────────────┐
│         TABLE_SCAN        ││           FILTER          ││         TABLE_SCAN        │
│    ────────────────────   ││    ────────────────────   ││    ────────────────────   │
│     Table: store_sales    ││ (d_date_sk BETWEEN 2450816││        Table: item        │
│   Type: Sequential Scan   ││        AND 2452642)       ││   Type: Sequential Scan   │
│                           ││                           ││                           │
│        Projections:       ││                           ││        Projections:       │
│         ss_item_sk        ││                           ││         i_item_sk         │
│      ss_sold_date_sk      ││                           ││         i_category        │
│        ss_store_sk        ││                           ││          i_class          │
│       ss_sales_price      ││                           ││          i_brand          │
│                           ││                           ││                           │
│       5,375,888 rows      ││          365 rows         ││        102,000 rows       │
│          (0.81s)          ││          (0.00s)          ││          (0.00s)          │
└───────────────────────────┘└─────────────┬─────────────┘└───────────────────────────┘
                             ┌─────────────┴─────────────┐
                             │         TABLE_SCAN        │
                             │    ────────────────────   │
                             │      Table: date_dim      │
                             │   Type: Sequential Scan   │
                             │                           │
                             │        Projections:       │
                             │         d_date_sk         │
                             │           d_moy           │
                             │                           │
                             │    Filters: d_year=1999   │
                             │                           │
                             │          365 rows         │
                             │          (0.00s)          │
                             └───────────────────────────┘
