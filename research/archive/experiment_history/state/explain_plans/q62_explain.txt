-- Q62 EXPLAIN ANALYZE (SF10)
-- State: optimized (kimi, 1.23x)
-- Best speedup: 1.23x
-- Source SQL: /mnt/c/Users/jakc9/Documents/QueryTorque_V8/research/CONSOLIDATED_BENCHMARKS/kimi_q31-q99_optimization/q62/output_optimized.sql

analyzed_plan
┌─────────────────────────────────────┐
│┌───────────────────────────────────┐│
││    Query Profiling Information    ││
│└───────────────────────────────────┘│
└─────────────────────────────────────┘
EXPLAIN ANALYZE WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1194 AND 1194 + 11), filtered_sales AS (SELECT ws_warehouse_sk, ws_ship_mode_sk, ws_web_site_sk, (ws_ship_date_sk - ws_sold_date_sk) AS days_diff FROM web_sales JOIN filtered_dates ON ws_ship_date_sk = d_date_sk) SELECT SUBSTRING(w_warehouse_name, 1, 20), sm_type, web_name, SUM(CASE WHEN days_diff <= 30 THEN 1 ELSE 0 END) AS "30 days", SUM(CASE WHEN days_diff > 30 AND days_diff <= 60 THEN 1 ELSE 0 END) AS "31-60 days", SUM(CASE WHEN days_diff > 60 AND days_diff <= 90 THEN 1 ELSE 0 END) AS "61-90 days", SUM(CASE WHEN days_diff > 90 AND days_diff <= 120 THEN 1 ELSE 0 END) AS "91-120 days", SUM(CASE WHEN days_diff > 120 THEN 1 ELSE 0 END) AS ">120 days" FROM filtered_sales JOIN warehouse ON ws_warehouse_sk = w_warehouse_sk JOIN ship_mode ON ws_ship_mode_sk = sm_ship_mode_sk JOIN web_site ON ws_web_site_sk = web_site_sk GROUP BY SUBSTRING(w_warehouse_name, 1, 20), sm_type, web_name ORDER BY SUBSTRING(w_warehouse_name, 1, 20), sm_type, web_name LIMIT 100
┌────────────────────────────────────────────────┐
│┌──────────────────────────────────────────────┐│
││              Total Time: 0.0536s             ││
│└──────────────────────────────────────────────┘│
└────────────────────────────────────────────────┘
┌───────────────────────────┐
│           QUERY           │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│      EXPLAIN_ANALYZE      │
│    ────────────────────   │
│           0 rows          │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│           TOP_N           │
│    ────────────────────   │
│          Top: 100         │
│                           │
│         Order By:         │
│      main."substring"     │
│ (tpcds_sf10.main.warehouse│
│ .w_warehouse_name, 1, 20) │
│             ASC           │
│ tpcds_sf10.main.ship_mode │
│        .sm_type ASC       │
│  tpcds_sf10.main.web_site │
│       .web_name ASC       │
│                           │
│          100 rows         │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│             #0            │
│__internal_decompress_strin│
│           g(#1)           │
│__internal_decompress_strin│
│           g(#2)           │
│             #3            │
│             #4            │
│             #5            │
│             #6            │
│             #7            │
│                           │
│          420 rows         │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│       HASH_GROUP_BY       │
│    ────────────────────   │
│          Groups:          │
│             #0            │
│             #1            │
│             #2            │
│                           │
│        Aggregates:        │
│          sum(#3)          │
│          sum(#4)          │
│          sum(#5)          │
│          sum(#6)          │
│          sum(#7)          │
│                           │
│          420 rows         │
│          (0.14s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│        "substring"        │
│ (w_warehouse_name, 1, 20) │
│          sm_type          │
│          web_name         │
│ CASE  WHEN ((days_diff <= │
│  30)) THEN (1) ELSE 0 END │
│ CASE  WHEN (((days_diff > │
│  30) AND (days_diff <= 60)│
│   )) THEN (1) ELSE 0 END  │
│ CASE  WHEN (((days_diff > │
│  60) AND (days_diff <= 90)│
│   )) THEN (1) ELSE 0 END  │
│ CASE  WHEN (((days_diff > │
│  90) AND (days_diff <= 120│
│  ))) THEN (1) ELSE 0 END  │
│  CASE  WHEN ((days_diff > │
│  120)) THEN (1) ELSE 0 END│
│                           │
│       1,441,612 rows      │
│          (0.12s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│             #0            │
│             #1            │
│__internal_compress_string_│
│        uhugeint(#2)       │
│__internal_compress_string_│
│        ubigint(#3)        │
│                           │
│       1,441,612 rows      │
│          (0.03s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         HASH_JOIN         │
│    ────────────────────   │
│      Join Type: INNER     │
│                           │
│        Conditions:        │
│      ws_web_site_sk =     ├─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│         web_site_sk       │                                                                                                     │
│                           │                                                                                                     │
│       1,441,612 rows      │                                                                                                     │
│          (0.01s)          │                                                                                                     │
└─────────────┬─────────────┘                                                                                                     │
┌─────────────┴─────────────┐                                                                                       ┌─────────────┴─────────────┐
│         HASH_JOIN         │                                                                                       │         TABLE_SCAN        │
│    ────────────────────   │                                                                                       │    ────────────────────   │
│      Join Type: INNER     │                                                                                       │      Table: web_site      │
│                           │                                                                                       │   Type: Sequential Scan   │
│        Conditions:        │                                                                                       │                           │
│     ws_ship_mode_sk =     ├────────────────────────────────────────────────────────────────────────┐              │        Projections:       │
│       sm_ship_mode_sk     │                                                                        │              │        web_site_sk        │
│                           │                                                                        │              │          web_name         │
│                           │                                                                        │              │                           │
│       1,441,612 rows      │                                                                        │              │          42 rows          │
│          (0.01s)          │                                                                        │              │          (0.00s)          │
└─────────────┬─────────────┘                                                                        │              └───────────────────────────┘
┌─────────────┴─────────────┐                                                          ┌─────────────┴─────────────┐
│         HASH_JOIN         │                                                          │         TABLE_SCAN        │
│    ────────────────────   │                                                          │    ────────────────────   │
│      Join Type: INNER     │                                                          │      Table: ship_mode     │
│                           │                                                          │   Type: Sequential Scan   │
│        Conditions:        │                                                          │                           │
│     ws_warehouse_sk =     ├───────────────────────────────────────────┐              │        Projections:       │
│       w_warehouse_sk      │                                           │              │      sm_ship_mode_sk      │
│                           │                                           │              │          sm_type          │
│                           │                                           │              │                           │
│       1,441,612 rows      │                                           │              │          20 rows          │
│          (0.01s)          │                                           │              │          (0.00s)          │
└─────────────┬─────────────┘                                           │              └───────────────────────────┘
┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐
│         PROJECTION        │                             │         TABLE_SCAN        │
│    ────────────────────   │                             │    ────────────────────   │
│      ws_warehouse_sk      │                             │      Table: warehouse     │
│      ws_ship_mode_sk      │                             │   Type: Sequential Scan   │
│       ws_web_site_sk      │                             │                           │
│         days_diff         │                             │        Projections:       │
│                           │                             │       w_warehouse_sk      │
│                           │                             │      w_warehouse_name     │
│                           │                             │                           │
│       1,441,612 rows      │                             │          10 rows          │
│          (0.01s)          │                             │          (0.00s)          │
└─────────────┬─────────────┘                             └───────────────────────────┘
┌─────────────┴─────────────┐
│         HASH_JOIN         │
│    ────────────────────   │
│      Join Type: INNER     │
│                           │
│        Conditions:        ├──────────────┐
│ws_ship_date_sk = d_date_sk│              │
│                           │              │
│       1,441,612 rows      │              │
│          (0.02s)          │              │
└─────────────┬─────────────┘              │
┌─────────────┴─────────────┐┌─────────────┴─────────────┐
│         TABLE_SCAN        ││           FILTER          │
│    ────────────────────   ││    ────────────────────   │
│      Table: web_sales     ││ (d_date_sk BETWEEN 2450817│
│   Type: Sequential Scan   ││        AND 2452762)       │
│                           ││                           │
│        Projections:       ││                           │
│      ws_ship_date_sk      ││                           │
│      ws_warehouse_sk      ││                           │
│      ws_ship_mode_sk      ││                           │
│       ws_web_site_sk      ││                           │
│      ws_sold_date_sk      ││                           │
│                           ││                           │
│       1,441,612 rows      ││          366 rows         │
│          (0.12s)          ││          (0.00s)          │
└───────────────────────────┘└─────────────┬─────────────┘
                             ┌─────────────┴─────────────┐
                             │         TABLE_SCAN        │
                             │    ────────────────────   │
                             │      Table: date_dim      │
                             │   Type: Sequential Scan   │
                             │                           │
                             │        Projections:       │
                             │         d_date_sk         │
                             │                           │
                             │          Filters:         │
                             │   d_month_seq>=1194 AND   │
                             │      d_month_seq<=1205    │
                             │                           │
                             │          366 rows         │
                             │          (0.00s)          │
                             └───────────────────────────┘
