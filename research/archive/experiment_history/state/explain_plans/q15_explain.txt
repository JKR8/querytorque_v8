-- Q15 EXPLAIN ANALYZE (SF10)
-- State: optimized (kimi, 2.78x)
-- Best speedup: 2.78x
-- Source SQL: /mnt/c/Users/jakc9/Documents/QueryTorque_V8/research/CONSOLIDATED_BENCHMARKS/kimi_q1-q30_optimization/q15/output_optimized.sql

analyzed_plan
┌─────────────────────────────────────┐
│┌───────────────────────────────────┐│
││    Query Profiling Information    ││
│└───────────────────────────────────┘│
└─────────────────────────────────────┘
EXPLAIN ANALYZE WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_qoy = 1 AND d_year = 2001), filtered_sales AS (SELECT cs_sales_price, ca_zip FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE SUBSTRING(ca_zip, 1, 5) IN ('85669', '86197', '88274', '83405', '86475', '85392', '85460', '80348', '81792') UNION ALL SELECT cs_sales_price, ca_zip FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ca_state IN ('CA', 'WA', 'GA') UNION ALL SELECT cs_sales_price, ca_zip FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE cs_sales_price > 500) SELECT ca_zip, SUM(cs_sales_price) FROM filtered_sales GROUP BY ca_zip ORDER BY ca_zip LIMIT 100
┌────────────────────────────────────────────────┐
│┌──────────────────────────────────────────────┐│
││              Total Time: 0.0712s             ││
│└──────────────────────────────────────────────┘│
└────────────────────────────────────────────────┘
┌─────────────────┐
│      QUERY      │
└────────┬────────┘
┌────────┴────────┐
│ EXPLAIN_ANALYZE │
│    ──────────   │
│      0 rows     │
│     (0.00s)     │
└────────┬────────┘
┌────────┴────────┐
│      TOP_N      │
│    ──────────   │
│     Top: 100    │
│                 │
│    Order By:    │
│  filtered_sales │
│   .ca_zip ASC   │
│                 │
│     100 rows    │
│     (0.00s)     │
└────────┬────────┘
┌────────┴────────┐
│    PROJECTION   │
│    ──────────   │
│__internal_decomp│
│ ress_string(#0) │
│        #1       │
│                 │
│     520 rows    │
│     (0.00s)     │
└────────┬────────┘
┌────────┴────────┐
│  HASH_GROUP_BY  │
│    ──────────   │
│    Groups: #0   │
│                 │
│   Aggregates:   │
│     sum(#1)     │
│                 │
│     520 rows    │
│     (0.00s)     │
└────────┬────────┘
┌────────┴────────┐
│    PROJECTION   │
│    ──────────   │
│      ca_zip     │
│  cs_sales_price │
│                 │
│   33,303 rows   │
│     (0.00s)     │
└────────┬────────┘
┌────────┴────────┐
│    PROJECTION   │
│    ──────────   │
│        #0       │
│__internal_compre│
│ss_string_ubigint│
│       (#1)      │
│                 │
│   33,303 rows   │
│     (0.00s)     │
└────────┬────────┘
┌────────┴────────┐
│      UNION      │
│    ──────────   │
│      0 rows     ├──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│     (0.00s)     │                                                                                                                                              │
└────────┬────────┘                                                                                                                                              │
┌────────┴────────┐                                                                                                                                     ┌────────┴────────┐
│      UNION      │                                                                                                                                     │    PROJECTION   │
│    ──────────   │                                                                                                                                     │    ──────────   │
│                 │                                                                                                                                     │  cs_sales_price │
│                 ├──────────────────────────────────────────────────────────────────┐                                                                  │      ca_zip     │
│                 │                                                                  │                                                                  │                 │
│      0 rows     │                                                                  │                                                                  │      0 rows     │
│     (0.00s)     │                                                                  │                                                                  │     (0.00s)     │
└────────┬────────┘                                                                  │                                                                  └────────┬────────┘
┌────────┴────────┐                                                         ┌────────┴────────┐                                                         ┌────────┴────────┐
│    PROJECTION   │                                                         │    PROJECTION   │                                                         │    HASH_JOIN    │
│    ──────────   │                                                         │    ──────────   │                                                         │    ──────────   │
│  cs_sales_price │                                                         │  cs_sales_price │                                                         │    Join Type:   │
│      ca_zip     │                                                         │      ca_zip     │                                                         │      INNER      │
│                 │                                                         │                 │                                                         │                 │
│                 │                                                         │                 │                                                         │   Conditions:   │
│                 │                                                         │                 │                                                         │ ca_address_sk = ├─────────┐
│                 │                                                         │                 │                                                         │ c_current_addr_s│         │
│                 │                                                         │                 │                                                         │        k        │         │
│                 │                                                         │                 │                                                         │                 │         │
│     53 rows     │                                                         │   33,250 rows   │                                                         │      0 rows     │         │
│     (0.00s)     │                                                         │     (0.00s)     │                                                         │     (0.00s)     │         │
└────────┬────────┘                                                         └────────┬────────┘                                                         └────────┬────────┘         │
┌────────┴────────┐                                                         ┌────────┴────────┐                                                         ┌────────┴────────┐┌────────┴────────┐
│    HASH_JOIN    │                                                         │    HASH_JOIN    │                                                         │    TABLE_SCAN   ││    HASH_JOIN    │
│    ──────────   │                                                         │    ──────────   │                                                         │    ──────────   ││    ──────────   │
│    Join Type:   │                                                         │    Join Type:   │                                                         │      Table:     ││    Join Type:   │
│      INNER      │                                                         │      INNER      │                                                         │ customer_address││      INNER      │
│                 │                                                         │                 │                                                         │                 ││                 │
│   Conditions:   │                                                         │   Conditions:   │                                                         │      Type:      ││   Conditions:   │
│ c_customer_sk = │                                                         │ c_customer_sk = │                                                         │ Sequential Scan ││ c_customer_sk = │
│ cs_bill_customer│                                                         │ cs_bill_customer│                                                         │                 ││ cs_bill_customer│
│       _sk       │                                                         │       _sk       │                                                         │   Projections:  ││       _sk       │
│                 ├────────────────────────────┐                            │                 ├────────────────────────────┐                            │  ca_address_sk  ││                 ├─────────┐
│                 │                            │                            │                 │                            │                            │      ca_zip     ││                 │         │
│                 │                            │                            │                 │                            │                            │                 ││                 │         │
│                 │                            │                            │                 │                            │                            │     Filters:    ││                 │         │
│                 │                            │                            │                 │                            │                            │    optional:    ││                 │         │
│                 │                            │                            │                 │                            │                            │  Dynamic Filter ││                 │         │
│                 │                            │                            │                 │                            │                            │     (ca_zip)    ││                 │         │
│                 │                            │                            │                 │                            │                            │                 ││                 │         │
│     53 rows     │                            │                            │   33,250 rows   │                            │                            │    6,144 rows   ││      0 rows     │         │
│     (0.02s)     │                            │                            │     (0.02s)     │                            │                            │     (0.00s)     ││     (0.00s)     │         │
└────────┬────────┘                            │                            └────────┬────────┘                            │                            └─────────────────┘└────────┬────────┘         │
┌────────┴────────┐                   ┌────────┴────────┐                   ┌────────┴────────┐                   ┌────────┴────────┐                                      ┌────────┴────────┐┌────────┴────────┐
│    HASH_JOIN    │                   │    HASH_JOIN    │                   │    HASH_JOIN    │                   │    HASH_JOIN    │                                      │    TABLE_SCAN   ││    HASH_JOIN    │
│    ──────────   │                   │    ──────────   │                   │    ──────────   │                   │    ──────────   │                                      │    ──────────   ││    ──────────   │
│    Join Type:   │                   │    Join Type:   │                   │    Join Type:   │                   │    Join Type:   │                                      │      Table:     ││    Join Type:   │
│      INNER      │                   │      INNER      │                   │      INNER      │                   │      INNER      │                                      │     customer    ││      INNER      │
│                 │                   │                 │                   │                 │                   │                 │                                      │                 ││                 │
│   Conditions:   │                   │   Conditions:   │                   │   Conditions:   │                   │   Conditions:   │                                      │      Type:      ││   Conditions:   │
│c_current_addr_sk│                   │ cs_sold_date_sk │                   │c_current_addr_sk│                   │ cs_sold_date_sk │                                      │ Sequential Scan ││ cs_sold_date_sk │
│  = ca_address_sk├─────────┐         │   = d_date_sk   ├─────────┐         │  = ca_address_sk├─────────┐         │   = d_date_sk   ├─────────┐                            │                 ││   = d_date_sk   ├─────────┐
│                 │         │         │                 │         │         │                 │         │         │                 │         │                            │   Projections:  ││                 │         │
│                 │         │         │                 │         │         │                 │         │         │                 │         │                            │  c_customer_sk  ││                 │         │
│                 │         │         │                 │         │         │                 │         │         │                 │         │                            │c_current_addr_sk││                 │         │
│                 │         │         │                 │         │         │                 │         │         │                 │         │                            │                 ││                 │         │
│     39 rows     │         │         │   409,682 rows  │         │         │   39,869 rows   │         │         │   409,682 rows  │         │                            │   10,240 rows   ││      0 rows     │         │
│     (0.00s)     │         │         │     (0.00s)     │         │         │     (0.00s)     │         │         │     (0.00s)     │         │                            │     (0.00s)     ││     (0.00s)     │         │
└────────┬────────┘         │         └────────┬────────┘         │         └────────┬────────┘         │         └────────┬────────┘         │                            └─────────────────┘└────────┬────────┘         │
┌────────┴────────┐┌────────┴────────┐┌────────┴────────┐┌────────┴────────┐┌────────┴────────┐┌────────┴────────┐┌────────┴────────┐┌────────┴────────┐                                      ┌────────┴────────┐┌────────┴────────┐
│    TABLE_SCAN   ││    TABLE_SCAN   ││    TABLE_SCAN   ││      FILTER     ││    TABLE_SCAN   ││    PROJECTION   ││    TABLE_SCAN   ││      FILTER     │                                      │   EMPTY_RESULT  ││      FILTER     │
│    ──────────   ││    ──────────   ││    ──────────   ││    ──────────   ││    ──────────   ││    ──────────   ││    ──────────   ││    ──────────   │                                      │    ──────────   ││    ──────────   │
│      Table:     ││      Table:     ││      Table:     ││    (d_date_sk   ││      Table:     ││        #0       ││      Table:     ││    (d_date_sk   │                                      │                 ││    (d_date_sk   │
│     customer    ││ customer_address││  catalog_sales  ││  BETWEEN 2450815││     customer    ││        #2       ││  catalog_sales  ││  BETWEEN 2450815│                                      │                 ││  BETWEEN 2450815│
│                 ││                 ││                 ││   AND 2452653)  ││                 ││                 ││                 ││   AND 2452653)  │                                      │                 ││   AND 2452653)  │
│      Type:      ││      Type:      ││      Type:      ││                 ││      Type:      ││                 ││      Type:      ││                 │                                      │                 ││                 │
│ Sequential Scan ││ Sequential Scan ││ Sequential Scan ││                 ││ Sequential Scan ││                 ││ Sequential Scan ││                 │                                      │                 ││                 │
│                 ││                 ││                 ││                 ││                 ││                 ││                 ││                 │                                      │                 ││                 │
│   Projections:  ││   Projections:  ││   Projections:  ││                 ││   Projections:  ││                 ││   Projections:  ││                 │                                      │                 ││                 │
│  c_customer_sk  ││  ca_address_sk  ││ cs_sold_date_sk ││                 ││  c_customer_sk  ││                 ││ cs_sold_date_sk ││                 │                                      │                 ││                 │
│c_current_addr_sk││      ca_zip     ││cs_bill_customer_││                 ││c_current_addr_sk││                 ││cs_bill_customer_││                 │                                      │                 ││                 │
│                 ││                 ││        sk       ││                 ││                 ││                 ││        sk       ││                 │                                      │                 ││                 │
│                 ││     Filters:    ││  cs_sales_price ││                 ││                 ││                 ││  cs_sales_price ││                 │                                      │                 ││                 │
│                 ││   ("substring"  ││                 ││                 ││                 ││                 ││                 ││                 │                                      │                 ││                 │
│                 ││  (ca_zip, 1, 5) ││                 ││                 ││                 ││                 ││                 ││                 │                                      │                 ││                 │
│                 ││   IN ('85669',  ││                 ││                 ││                 ││                 ││                 ││                 │                                      │                 ││                 │
│                 ││ '86197', '88274'││                 ││                 ││                 ││                 ││                 ││                 │                                      │                 ││                 │
│                 ││   , '83405',    ││                 ││                 ││                 ││                 ││                 ││                 │                                      │                 ││                 │
│                 ││ '86475', '85392'││                 ││                 ││                 ││                 ││                 ││                 │                                      │                 ││                 │
│                 ││   , '85460',    ││                 ││                 ││                 ││                 ││                 ││                 │                                      │                 ││                 │
│                 ││ '80348', '81792'││                 ││                 ││                 ││                 ││                 ││                 │                                      │                 ││                 │
│                 ││        ))       ││                 ││                 ││                 ││                 ││                 ││                 │                                      │                 ││                 │
│                 ││                 ││                 ││                 ││                 ││                 ││                 ││                 │                                      │                 ││                 │
│   466,680 rows  ││     18 rows     ││   409,682 rows  ││     91 rows     ││   499,984 rows  ││   19,838 rows   ││   409,682 rows  ││     91 rows     │                                      │      0 rows     ││     91 rows     │
│     (0.00s)     ││     (0.02s)     ││     (0.03s)     ││     (0.00s)     ││     (0.00s)     ││     (0.00s)     ││     (0.00s)     ││     (0.00s)     │                                      │     (0.00s)     ││     (0.00s)     │
└─────────────────┘└─────────────────┘└─────────────────┘└────────┬────────┘└─────────────────┘└────────┬────────┘└─────────────────┘└────────┬────────┘                                      └─────────────────┘└────────┬────────┘
                                                         ┌────────┴────────┐                   ┌────────┴────────┐                   ┌────────┴────────┐                                                         ┌────────┴────────┐
                                                         │    TABLE_SCAN   │                   │      FILTER     │                   │    TABLE_SCAN   │                                                         │    TABLE_SCAN   │
                                                         │    ──────────   │                   │    ──────────   │                   │    ──────────   │                                                         │    ──────────   │
                                                         │      Table:     │                   │ ((ca_state = 'CA│                   │      Table:     │                                                         │      Table:     │
                                                         │     date_dim    │                   │ ') OR (ca_state │                   │     date_dim    │                                                         │     date_dim    │
                                                         │                 │                   │   = 'WA') OR    │                   │                 │                                                         │                 │
                                                         │      Type:      │                   │ (ca_state = 'GA'│                   │      Type:      │                                                         │      Type:      │
                                                         │ Sequential Scan │                   │        ))       │                   │ Sequential Scan │                                                         │ Sequential Scan │
                                                         │                 │                   │                 │                   │                 │                                                         │                 │
                                                         │   Projections:  │                   │                 │                   │   Projections:  │                                                         │   Projections:  │
                                                         │    d_date_sk    │                   │                 │                   │    d_date_sk    │                                                         │    d_date_sk    │
                                                         │                 │                   │                 │                   │                 │                                                         │                 │
                                                         │     Filters:    │                   │                 │                   │     Filters:    │                                                         │     Filters:    │
                                                         │     d_qoy=1     │                   │                 │                   │     d_qoy=1     │                                                         │     d_qoy=1     │
                                                         │   d_year=2001   │                   │                 │                   │   d_year=2001   │                                                         │   d_year=2001   │
                                                         │                 │                   │                 │                   │                 │                                                         │                 │
                                                         │     91 rows     │                   │   19,838 rows   │                   │     91 rows     │                                                         │     91 rows     │
                                                         │     (0.00s)     │                   │     (0.00s)     │                   │     (0.00s)     │                                                         │     (0.00s)     │
                                                         └─────────────────┘                   └────────┬────────┘                   └─────────────────┘                                                         └─────────────────┘
                                                                                               ┌────────┴────────┐
                                                                                               │    TABLE_SCAN   │
                                                                                               │    ──────────   │
                                                                                               │      Table:     │
                                                                                               │ customer_address│
                                                                                               │                 │
                                                                                               │      Type:      │
                                                                                               │ Sequential Scan │
                                                                                               │                 │
                                                                                               │   Projections:  │
                                                                                               │  ca_address_sk  │
                                                                                               │     ca_state    │
                                                                                               │      ca_zip     │
                                                                                               │                 │
                                                                                               │     Filters:    │
                                                                                               │    optional:    │
                                                                                               │   ca_state IN ( │
                                                                                               │'CA', 'WA', 'GA')│
                                                                                               │                 │
                                                                                               │   250,000 rows  │
                                                                                               │     (0.01s)     │
                                                                                               └─────────────────┘
