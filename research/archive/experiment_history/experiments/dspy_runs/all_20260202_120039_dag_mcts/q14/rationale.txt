I tried a different approach: instead of pushing the `d_moy = 11` filter into CTEs (which changed semantics), I focused on materialization and avoiding recomputation. I created a new CTE `brand_class_category` that materializes the INTERSECT result, which is referenced by `cross_items`. This avoids recomputing the complex INTERSECT three times. I also materialized `avg_sales` and `cross_items` to benefit DuckDB's optimizer. The semantics remain identical to the original because I didn't add any new filters or change any logic. This should reduce the cost of repeated scans while maintaining correct results.