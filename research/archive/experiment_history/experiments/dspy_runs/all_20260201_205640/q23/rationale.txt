1. **CTE Materialization Hints**: Added `/*+ MATERIALIZE */` hints to force materialization of CTEs that are referenced multiple times, preventing redundant computation and enabling better query optimization.

2. **EXISTS instead of IN**: Changed IN subqueries to EXISTS clauses, which can be more efficient as they stop searching after finding the first match and work better with NULL values.

3. **Explicit JOIN Syntax**: Converted implicit joins (comma-separated tables) to explicit JOIN syntax for better readability and optimizer understanding.

4. **BETWEEN Operator**: Used `BETWEEN` for year ranges instead of multiple OR conditions, which is cleaner and often optimized better.

5. **Early Filtering**: The date filters (`d_year = 2000 AND d_moy = 5`) are applied immediately in the main query branches, reducing the dataset before joins.

6. **Eliminated Redundant CTE Reference**: The `max_store_sales` CTE is now referenced directly in the `best_ss_customer` CTE without the unnecessary `SELECT *` wrapper.

7. **Maintained Semantic Equivalence**: All changes preserve the original query logic while improving execution efficiency through better join strategies, reduced data movement, and optimized subquery execution.

These optimizations target the high-cost HASH_GROUP_BY and HASH_JOIN operations identified in the execution plan by reducing the data volume early in the query processing pipeline and providing clearer optimization hints to the query planner.