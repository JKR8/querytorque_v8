1. **Pushed date filters into CTEs**: Created filtered CTEs for date_dim (filtered_dates for quarters '2001Q1','2001Q2','2001Q3' and filtered_d1 for '2001Q1' only) to reduce the date_dim rows early (from 38,912 to ~220 and 91 rows respectively).
2. **Pre-joined fact tables with filtered dates**: Created filtered_store_sales, filtered_store_returns, and filtered_catalog_sales CTEs that join the fact tables with the filtered date dimensions before the main query. This reduces the size of fact table rows participating in subsequent joins (e.g., store_sales from 80,502 rows to only those matching '2001Q1').
3. **Maintained semantic equivalence**: All original joins and filters are preserved; only the order of operations is changed to filter earlier.
4. **Expected performance improvement**: By reducing the intermediate result sizes of the large fact tables (store_sales, store_returns, catalog_sales) before the complex multi-table joins, we lower the cost of hash joins and aggregations. This addresses the high sequential scan costs (67% and 27.5%) by making them more selective early in the execution.