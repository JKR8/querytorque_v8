[After 2 attempts] I used a different strategy from the failed attempt by avoiding the separate date_filter CTE that caused the syntax error. Instead, I directly joined each sales table with date_dim and applied the filter `d_year = 2000` in the WHERE clause of each CTE. This pushes the date filter early, reducing the rows scanned in the large sales tables before grouping. I also replaced the original LEFT JOIN with IS NULL condition with explicit anti-joins using NOT EXISTS, which can be more efficient in some databases by preventing unnecessary join processing for returned items. The `ss` CTE now includes the `d_year = 2000` filter, aligning with the final WHERE condition, to further reduce its size. This approach aims to lower the cost of sequential scans and hash group-bys by filtering rows earlier in the pipeline.