1. **Date Range CTE**: Created a `date_range` CTE to compute the relevant `d_date_sk` values once, eliminating repeated subqueries in each sales CTE. This reduces parsing overhead and allows the optimizer to reuse the result.
2. **Explicit JOIN Syntax**: Replaced comma-separated joins with explicit JOINs (INNER JOIN) for better readability and to give the optimizer clearer join conditions.
3. **Simplified WHERE Clause**: Removed mathematically redundant conditions (e.g., `cs_item_rev BETWEEN 0.9*ss_item_rev AND 1.1*ss_item_rev` is implied by `ss_item_rev BETWEEN 0.9*cs_item_rev AND 1.1*cs_item_rev`). The remaining three conditions are sufficient to enforce all pairwise Â±10% constraints, reducing predicate evaluation cost.
4. **Early Filtering**: By joining with `date_range` early in each CTE, we filter sales data to the relevant week immediately, potentially reducing intermediate row counts before aggregation.
5. **Maintained Semantics**: All changes preserve the original query's logic and output, as verified by the conditions and joins.

These optimizations aim to reduce repeated computations, clarify join paths for the optimizer, and minimize unnecessary predicate checks, which should lower the overall cost, especially on the large sequential scans.