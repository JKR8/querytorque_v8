1. **Predicate pushdown via CTE**: Created a CTE `filtered_dates` that pre-filters `date_dim` to only rows where `d_month_seq BETWEEN 1183 AND 1183 + 11`. This reduces the date_dim table from potentially thousands of rows to exactly 365 rows (as shown in row estimates) before any joins occur.
2. **Materialization hint**: Used `MATERIALIZED` in the CTE to ensure DuckDB computes this result once and reuses it across all three INTERSECT subqueries, avoiding repeated filtering.
3. **Early filtering benefit**: By moving the date filter into the CTE, the hash joins in each subquery now join sales tables with a much smaller date dimension (365 rows instead of full table), reducing join cost and intermediate result sizes.
4. **Constraint compliance**: Maintained the original query structure with INTERSECT operations, same CTEs/subqueries, and no new WHERE conditionsâ€”only moved the existing `d_month_seq` filter earlier via CTE.

This optimization leverages DuckDB's strength with CTE materialization and reduces the cardinality of the date dimension early in the execution plan, which should lower hash join costs and improve overall performance while preserving identical semantics.