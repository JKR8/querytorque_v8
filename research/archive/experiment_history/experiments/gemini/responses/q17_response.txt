{
  "operations": [
    {
      "op": "add_cte",
      "after": "start",
      "name": "filtered_ss",
      "sql": "select ss_ticket_number, ss_customer_sk, ss_item_sk, ss_store_sk, ss_quantity from store_sales, date_dim where ss_sold_date_sk = d_date_sk and d_quarter_name = '2001Q1'"
    },
    {
      "op": "add_cte",
      "after": "filtered_ss",
      "name": "filtered_sr",
      "sql": "select sr_ticket_number, sr_customer_sk, sr_item_sk, sr_return_quantity from store_returns, date_dim where sr_returned_date_sk = d_date_sk and d_quarter_name in ('2001Q1','2001Q2','2001Q3')"
    },
    {
      "op": "add_cte",
      "after": "filtered_sr",
      "name": "filtered_cs",
      "sql": "select cs_bill_customer_sk, cs_item_sk, cs_quantity from catalog_sales, date_dim where cs_sold_date_sk = d_date_sk and d_quarter_name in ('2001Q1','2001Q2','2001Q3')"
    },
    {
      "op": "replace_clause",
      "target": "main_query.from",
      "sql": "from filtered_ss\n     ,filtered_sr\n     ,filtered_cs\n     ,store\n     ,item"
    },
    {
      "op": "replace_clause",
      "target": "main_query.where",
      "sql": "where i_item_sk = ss_item_sk\n   and s_store_sk = ss_store_sk\n   and ss_customer_sk = sr_customer_sk\n   and ss_item_sk = sr_item_sk\n   and ss_ticket_number = sr_ticket_number\n   and sr_customer_sk = cs_bill_customer_sk\n   and sr_item_sk = cs_item_sk"
    }
  ],
  "semantic_warnings": [],
  "explanation": "Pushed date filters for store_sales, store_returns, and catalog_sales into dedicated CTEs. This helps the optimizer by reducing the size of the fact tables before the expensive multi-way join."
}