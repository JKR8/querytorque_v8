```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "semantic_rewrite",
      "nodes": {
        "main_query": "WITH filtered_store_sales AS (\n  SELECT\n    ss_list_price,\n    CASE\n      WHEN ss_quantity BETWEEN 0 AND 5 THEN 1\n      WHEN ss_quantity BETWEEN 6 AND 10 THEN 2\n      WHEN ss_quantity BETWEEN 11 AND 15 THEN 3\n      WHEN ss_quantity BETWEEN 16 AND 20 THEN 4\n      WHEN ss_quantity BETWEEN 21 AND 25 THEN 5\n      WHEN ss_quantity BETWEEN 26 AND 30 THEN 6\n    END as bucket\n  FROM store_sales\n  WHERE (\n    (ss_quantity BETWEEN 0 AND 5 AND (ss_list_price BETWEEN 131 AND 141 OR ss_coupon_amt BETWEEN 16798 AND 17798 OR ss_wholesale_cost BETWEEN 25 AND 45))\n    OR\n    (ss_quantity BETWEEN 6 AND 10 AND (ss_list_price BETWEEN 145 AND 155 OR ss_coupon_amt BETWEEN 14792 AND 15792 OR ss_wholesale_cost BETWEEN 46 AND 66))\n    OR\n    (ss_quantity BETWEEN 11 AND 15 AND (ss_list_price BETWEEN 150 AND 160 OR ss_coupon_amt BETWEEN 6600 AND 7600 OR ss_wholesale_cost BETWEEN 9 AND 29))\n    OR\n    (ss_quantity BETWEEN 16 AND 20 AND (ss_list_price BETWEEN 91 AND 101 OR ss_coupon_amt BETWEEN 13493 AND 14493 OR ss_wholesale_cost BETWEEN 36 AND 56))\n    OR\n    (ss_quantity BETWEEN 21 AND 25 AND (ss_list_price BETWEEN 0 AND 10 OR ss_coupon_amt BETWEEN 7629 AND 8629 OR ss_wholesale_cost BETWEEN 6 AND 26))\n    OR\n    (ss_quantity BETWEEN 26 AND 30 AND (ss_list_price BETWEEN 89 AND 99 OR ss_coupon_amt BETWEEN 15257 AND 16257 OR ss_wholesale_cost BETWEEN 31 AND 51))\n  )\n)\nSELECT\n  AVG(CASE WHEN bucket = 1 THEN ss_list_price END) AS B1_LP,\n  COUNT(CASE WHEN bucket = 1 THEN ss_list_price END) AS B1_CNT,\n  COUNT(DISTINCT CASE WHEN bucket = 1 THEN ss_list_price END) AS B1_CNTD,\n  AVG(CASE WHEN bucket = 2 THEN ss_list_price END) AS B2_LP,\n  COUNT(CASE WHEN bucket = 2 THEN ss_list_price END) AS B2_CNT,\n  COUNT(DISTINCT CASE WHEN bucket = 2 THEN ss_list_price END) AS B2_CNTD,\n  AVG(CASE WHEN bucket = 3 THEN ss_list_price END) AS B3_LP,\n  COUNT(CASE WHEN bucket = 3 THEN ss_list_price END) AS B3_CNT,\n  COUNT(DISTINCT CASE WHEN bucket = 3 THEN ss_list_price END) AS B3_CNTD,\n  AVG(CASE WHEN bucket = 4 THEN ss_list_price END) AS B4_LP,\n  COUNT(CASE WHEN bucket = 4 THEN ss_list_price END) AS B4_CNT,\n  COUNT(DISTINCT CASE WHEN bucket = 4 THEN ss_list_price END) AS B4_CNTD,\n  AVG(CASE WHEN bucket = 5 THEN ss_list_price END) AS B5_LP,\n  COUNT(CASE WHEN bucket = 5 THEN ss_list_price END) AS B5_CNT,\n  COUNT(DISTINCT CASE WHEN bucket = 5 THEN ss_list_price END) AS B5_CNTD,\n  AVG(CASE WHEN bucket = 6 THEN ss_list_price END) AS B6_LP,\n  COUNT(CASE WHEN bucket = 6 THEN ss_list_price END) AS B6_CNT,\n  COUNT(DISTINCT CASE WHEN bucket = 6 THEN ss_list_price END) AS B6_CNTD\nFROM filtered_store_sales\nGROUP BY ()\nLIMIT 100"
      },
      "invariants_kept": [
        "same output columns",
        "same row count (1 row)",
        "same aggregate calculations"
      ],
      "expected_speedup": "3.5x",
      "risk": "low"
    }
  ],
  "explanation": "Consolidated 6 separate scans of store_sales into a single pass using conditional aggregation. Each row is assigned a bucket (1-6) based on ss_quantity range, and only rows satisfying the original OR conditions for their bucket are processed. All aggregates are computed in one scan using CASE expressions within AVG/COUNT/COUNT(DISTINCT), preserving exact literal values from the original query. This reduces 6 sequential scans to 1 scan while maintaining identical results."
}
```