WITH date_filter AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq BETWEEN 1200 AND 1200 + 11), web_sales_filtered AS (SELECT ws_bill_customer_sk, d_date FROM web_sales JOIN date_filter ON ws_sold_date_sk = d_date_sk), store_sales_filtered AS (SELECT ss_customer_sk, d_date FROM store_sales JOIN date_filter AS sf ON ss_sold_date_sk = sf.d_date_sk), catalog_sales_filtered AS (SELECT cs_bill_customer_sk, d_date FROM catalog_sales JOIN date_filter AS cf ON cs_sold_date_sk = cf.d_date_sk)
SELECT COUNT(*) FROM (SELECT DISTINCT c_last_name, c_first_name, wsf.d_date FROM web_sales_filtered AS wsf JOIN customer ON wsf.ws_bill_customer_sk = customer.c_customer_sk WHERE EXISTS(SELECT 1 FROM store_sales_filtered AS ssf JOIN customer AS sc ON ssf.ss_customer_sk = sc.c_customer_sk WHERE sc.c_last_name = customer.c_last_name AND sc.c_first_name = customer.c_first_name AND ssf.d_date = wsf.d_date) AND EXISTS(SELECT 1 FROM catalog_sales_filtered AS csf JOIN customer AS cc ON csf.cs_bill_customer_sk = cc.c_customer_sk WHERE cc.c_last_name = customer.c_last_name AND cc.c_first_name = customer.c_first_name AND csf.d_date = wsf.d_date)) AS hot_cust LIMIT 100