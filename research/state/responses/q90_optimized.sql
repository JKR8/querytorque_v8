WITH filtered_household_demographics AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_dep_count = 2), filtered_web_page AS (SELECT wp_web_page_sk FROM web_page WHERE wp_char_count BETWEEN 5000 AND 5200), filtered_time_am AS (SELECT t_time_sk FROM time_dim WHERE t_hour BETWEEN 10 AND 11), filtered_time_pm AS (SELECT t_time_sk FROM time_dim WHERE t_hour BETWEEN 16 AND 17), filtered_web_data AS (SELECT 1 AS am_flag, NULL AS pm_flag FROM web_sales AS ws JOIN filtered_household_demographics AS hd ON ws.ws_ship_hdemo_sk = hd.hd_demo_sk JOIN filtered_time_am AS t ON ws.ws_sold_time_sk = t.t_time_sk JOIN filtered_web_page AS wp ON ws.ws_web_page_sk = wp.wp_web_page_sk UNION ALL SELECT NULL AS am_flag, 1 AS pm_flag FROM web_sales AS ws JOIN filtered_household_demographics AS hd ON ws.ws_ship_hdemo_sk = hd.hd_demo_sk JOIN filtered_time_pm AS t ON ws.ws_sold_time_sk = t.t_time_sk JOIN filtered_web_page AS wp ON ws.ws_web_page_sk = wp.wp_web_page_sk), counts AS (SELECT COUNT(am_flag) AS amc, COUNT(pm_flag) AS pmc FROM filtered_web_data)
SELECT CAST(amc AS DECIMAL(15, 4)) / CAST(pmc AS DECIMAL(15, 4)) AS am_pm_ratio FROM counts ORDER BY am_pm_ratio LIMIT 100