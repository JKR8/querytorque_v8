-- Q6 EXPLAIN ANALYZE (SF10)
-- State: optimized (kimi, 1.33x)
-- Best speedup: 1.33x
-- Source SQL: /mnt/c/Users/jakc9/Documents/QueryTorque_V8/research/CONSOLIDATED_BENCHMARKS/kimi_q1-q30_optimization/q6/output_optimized.sql

analyzed_plan
┌─────────────────────────────────────┐
│┌───────────────────────────────────┐│
││    Query Profiling Information    ││
│└───────────────────────────────────┘│
└─────────────────────────────────────┘
EXPLAIN ANALYZE WITH target_month AS (SELECT DISTINCT d_month_seq FROM date_dim WHERE d_year = 2002 AND d_moy = 3), category_avg AS (SELECT i_category, AVG(i_current_price) * 1.2 AS price_threshold FROM item GROUP BY i_category) SELECT a.ca_state AS state, COUNT(*) AS cnt FROM customer_address AS a JOIN customer AS c ON a.ca_address_sk = c.c_current_addr_sk JOIN store_sales AS s ON c.c_customer_sk = s.ss_customer_sk JOIN date_dim AS d ON s.ss_sold_date_sk = d.d_date_sk JOIN target_month AS tm ON d.d_month_seq = tm.d_month_seq JOIN item AS i ON s.ss_item_sk = i.i_item_sk JOIN category_avg AS ca ON i.i_category = ca.i_category WHERE i.i_current_price > ca.price_threshold GROUP BY a.ca_state HAVING COUNT(*) >= 10 ORDER BY cnt, a.ca_state LIMIT 100
┌────────────────────────────────────────────────┐
│┌──────────────────────────────────────────────┐│
││              Total Time: 0.0534s             ││
│└──────────────────────────────────────────────┘│
└────────────────────────────────────────────────┘
┌───────────────────────────┐
│           QUERY           │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│      EXPLAIN_ANALYZE      │
│    ────────────────────   │
│           0 rows          │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│           TOP_N           │
│    ────────────────────   │
│          Top: 100         │
│                           │
│         Order By:         │
│      count_star() ASC     │
│       a.ca_state ASC      │
│                           │
│          51 rows          │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│           FILTER          │
│    ────────────────────   │
│    (count_star() >= 10)   │
│                           │
│          51 rows          │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│__internal_decompress_strin│
│           g(#0)           │
│             #1            │
│                           │
│          52 rows          │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│       HASH_GROUP_BY       │
│    ────────────────────   │
│         Groups: #0        │
│                           │
│        Aggregates:        │
│        count_star()       │
│                           │
│          52 rows          │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│          ca_state         │
│                           │
│        25,108 rows        │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         PROJECTION        │
│    ────────────────────   │
│__internal_compress_string_│
│        uinteger(#0)       │
│             #1            │
│__internal_compress_integra│
│  l_usmallint(#2, 2450816) │
│__internal_compress_integra│
│     l_usmallint(#3, 0)    │
│                           │
│        25,108 rows        │
│          (0.00s)          │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         HASH_JOIN         │
│    ────────────────────   │
│      Join Type: INNER     │
│                           │
│        Conditions:        │
│      c_customer_sk =      ├───────────────────────────────────────────┐
│       ss_customer_sk      │                                           │
│                           │                                           │
│        25,108 rows        │                                           │
│          (0.01s)          │                                           │
└─────────────┬─────────────┘                                           │
┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐
│         HASH_JOIN         │                             │         HASH_JOIN         │
│    ────────────────────   │                             │    ────────────────────   │
│      Join Type: INNER     │                             │      Join Type: INNER     │
│                           │                             │                           │
│        Conditions:        │                             │        Conditions:        │
│    c_current_addr_sk =    ├──────────────┐              │ss_sold_date_sk = d_date_sk├────────────────────────────────────────────────────────────────────────┐
│        ca_address_sk      │              │              │                           │                                                                        │
│                           │              │              │                           │                                                                        │
│        499,965 rows       │              │              │        25,736 rows        │                                                                        │
│          (0.01s)          │              │              │          (0.00s)          │                                                                        │
└─────────────┬─────────────┘              │              └─────────────┬─────────────┘                                                                        │
┌─────────────┴─────────────┐┌─────────────┴─────────────┐┌─────────────┴─────────────┐                                                          ┌─────────────┴─────────────┐
│         TABLE_SCAN        ││         TABLE_SCAN        ││         HASH_JOIN         │                                                          │         HASH_JOIN         │
│    ────────────────────   ││    ────────────────────   ││    ────────────────────   │                                                          │    ────────────────────   │
│      Table: customer      ││           Table:          ││      Join Type: INNER     │                                                          │      Join Type: INNER     │
│   Type: Sequential Scan   ││      customer_address     ││                           │                                                          │                           │
│                           ││                           ││        Conditions:        │                                                          │        Conditions:        │
│        Projections:       ││   Type: Sequential Scan   ││   ss_item_sk = i_item_sk  │                                                          │ d_month_seq = d_month_seq │
│     c_current_addr_sk     ││                           ││                           ├──────────────┐                                           │                           ├──────────────┐
│       c_customer_sk       ││        Projections:       ││                           │              │                                           │                           │              │
│                           ││       ca_address_sk       ││                           │              │                                           │                           │              │
│                           ││          ca_state         ││                           │              │                                           │                           │              │
│                           ││                           ││                           │              │                                           │                           │              │
│        499,965 rows       ││        250,000 rows       ││        25,736 rows        │              │                                           │          31 rows          │              │
│          (0.01s)          ││          (0.01s)          ││          (0.04s)          │              │                                           │          (0.00s)          │              │
└───────────────────────────┘└───────────────────────────┘└─────────────┬─────────────┘              │                                           └─────────────┬─────────────┘              │
                                                          ┌─────────────┴─────────────┐┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐┌─────────────┴─────────────┐
                                                          │         TABLE_SCAN        ││         HASH_JOIN         │                             │         TABLE_SCAN        ││         PROJECTION        │
                                                          │    ────────────────────   ││    ────────────────────   │                             │    ────────────────────   ││    ────────────────────   │
                                                          │     Table: store_sales    ││      Join Type: INNER     │                             │      Table: date_dim      ││__internal_decompress_integ│
                                                          │   Type: Sequential Scan   ││                           │                             │   Type: Sequential Scan   ││     ral_integer(#0, 0)    │
                                                          │                           ││        Conditions:        │                             │                           ││                           │
                                                          │        Projections:       ││  i_category = i_category  │                             │        Projections:       ││                           │
                                                          │       ss_customer_sk      ││  CAST(i_current_price AS  │                             │         d_date_sk         ││                           │
                                                          │      ss_sold_date_sk      ││  DOUBLE) > price_threshold├──────────────┐              │        d_month_seq        ││                           │
                                                          │         ss_item_sk        ││                           │              │              │                           ││                           │
                                                          │                           ││                           │              │              │          Filters:         ││                           │
                                                          │                           ││                           │              │              │   d_date_sk>=2450816 AND  ││                           │
                                                          │                           ││                           │              │              │     d_date_sk<=2452642    ││                           │
                                                          │                           ││                           │              │              │                           ││                           │
                                                          │        259,875 rows       ││        10,174 rows        │              │              │          31 rows          ││           1 row           │
                                                          │          (0.21s)          ││          (0.00s)          │              │              │          (0.00s)          ││          (0.00s)          │
                                                          └───────────────────────────┘└─────────────┬─────────────┘              │              └───────────────────────────┘└─────────────┬─────────────┘
                                                                                       ┌─────────────┴─────────────┐┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐
                                                                                       │         TABLE_SCAN        ││         PROJECTION        │                             │       HASH_GROUP_BY       │
                                                                                       │    ────────────────────   ││    ────────────────────   │                             │    ────────────────────   │
                                                                                       │        Table: item        ││         i_category        │                             │         Groups: #0        │
                                                                                       │   Type: Sequential Scan   ││      price_threshold      │                             │                           │
                                                                                       │                           ││                           │                             │                           │
                                                                                       │        Projections:       ││                           │                             │                           │
                                                                                       │         i_item_sk         ││                           │                             │                           │
                                                                                       │         i_category        ││                           │                             │                           │
                                                                                       │      i_current_price      ││                           │                             │                           │
                                                                                       │                           ││                           │                             │                           │
                                                                                       │        101,768 rows       ││          11 rows          │                             │           1 row           │
                                                                                       │          (0.00s)          ││          (0.00s)          │                             │          (0.00s)          │
                                                                                       └───────────────────────────┘└─────────────┬─────────────┘                             └─────────────┬─────────────┘
                                                                                                                    ┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐
                                                                                                                    │         PROJECTION        │                             │         PROJECTION        │
                                                                                                                    │    ────────────────────   │                             │    ────────────────────   │
                                                                                                                    │__internal_decompress_strin│                             │        d_month_seq        │
                                                                                                                    │           g(#0)           │                             │                           │
                                                                                                                    │             #1            │                             │                           │
                                                                                                                    │                           │                             │                           │
                                                                                                                    │          11 rows          │                             │          31 rows          │
                                                                                                                    │          (0.00s)          │                             │          (0.00s)          │
                                                                                                                    └─────────────┬─────────────┘                             └─────────────┬─────────────┘
                                                                                                                    ┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐
                                                                                                                    │       HASH_GROUP_BY       │                             │         PROJECTION        │
                                                                                                                    │    ────────────────────   │                             │    ────────────────────   │
                                                                                                                    │         Groups: #0        │                             │__internal_compress_integra│
                                                                                                                    │    Aggregates: avg(#1)    │                             │     l_usmallint(#0, 0)    │
                                                                                                                    │                           │                             │                           │
                                                                                                                    │          11 rows          │                             │          31 rows          │
                                                                                                                    │          (0.01s)          │                             │          (0.00s)          │
                                                                                                                    └─────────────┬─────────────┘                             └─────────────┬─────────────┘
                                                                                                                    ┌─────────────┴─────────────┐                             ┌─────────────┴─────────────┐
                                                                                                                    │         PROJECTION        │                             │         TABLE_SCAN        │
                                                                                                                    │    ────────────────────   │                             │    ────────────────────   │
                                                                                                                    │         i_category        │                             │      Table: date_dim      │
                                                                                                                    │      i_current_price      │                             │   Type: Sequential Scan   │
                                                                                                                    │                           │                             │                           │
                                                                                                                    │                           │                             │        Projections:       │
                                                                                                                    │                           │                             │        d_month_seq        │
                                                                                                                    │                           │                             │                           │
                                                                                                                    │                           │                             │          Filters:         │
                                                                                                                    │                           │                             │        d_year=2002        │
                                                                                                                    │                           │                             │          d_moy=3          │
                                                                                                                    │                           │                             │                           │
                                                                                                                    │        102,000 rows       │                             │          31 rows          │
                                                                                                                    │          (0.00s)          │                             │          (0.00s)          │
                                                                                                                    └─────────────┬─────────────┘                             └───────────────────────────┘
                                                                                                                    ┌─────────────┴─────────────┐
                                                                                                                    │         PROJECTION        │
                                                                                                                    │    ────────────────────   │
                                                                                                                    │__internal_compress_string_│
                                                                                                                    │        uhugeint(#0)       │
                                                                                                                    │             #1            │
                                                                                                                    │                           │
                                                                                                                    │        102,000 rows       │
                                                                                                                    │          (0.00s)          │
                                                                                                                    └─────────────┬─────────────┘
                                                                                                                    ┌─────────────┴─────────────┐
                                                                                                                    │         TABLE_SCAN        │
                                                                                                                    │    ────────────────────   │
                                                                                                                    │        Table: item        │
                                                                                                                    │   Type: Sequential Scan   │
                                                                                                                    │                           │
                                                                                                                    │        Projections:       │
                                                                                                                    │         i_category        │
                                                                                                                    │      i_current_price      │
                                                                                                                    │                           │
                                                                                                                    │        102,000 rows       │
                                                                                                                    │          (0.00s)          │
                                                                                                                    └───────────────────────────┘
