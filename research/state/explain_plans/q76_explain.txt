-- Q76 EXPLAIN ANALYZE (SF10)
-- State: optimized (kimi, 1.10x)
-- Best speedup: 1.10x
-- Source SQL: /mnt/c/Users/jakc9/Documents/QueryTorque_V8/research/CONSOLIDATED_BENCHMARKS/kimi_q31-q99_optimization/q76/output_optimized.sql

analyzed_plan
┌─────────────────────────────────────┐
│┌───────────────────────────────────┐│
││    Query Profiling Information    ││
│└───────────────────────────────────┘│
└─────────────────────────────────────┘
EXPLAIN ANALYZE WITH store_sales_agg AS (SELECT 'store' AS channel, 'ss_hdemo_sk' AS col_name, d_year, d_qoy, i_category, COUNT(*) AS sales_cnt, SUM(ss_ext_sales_price) AS sales_amt FROM store_sales, item, date_dim WHERE ss_hdemo_sk IS NULL AND ss_sold_date_sk = d_date_sk AND ss_item_sk = i_item_sk GROUP BY d_year, d_qoy, i_category), web_sales_agg AS (SELECT 'web' AS channel, 'ws_bill_addr_sk' AS col_name, d_year, d_qoy, i_category, COUNT(*) AS sales_cnt, SUM(ws_ext_sales_price) AS sales_amt FROM web_sales, item, date_dim WHERE ws_bill_addr_sk IS NULL AND ws_sold_date_sk = d_date_sk AND ws_item_sk = i_item_sk GROUP BY d_year, d_qoy, i_category), catalog_sales_agg AS (SELECT 'catalog' AS channel, 'cs_warehouse_sk' AS col_name, d_year, d_qoy, i_category, COUNT(*) AS sales_cnt, SUM(cs_ext_sales_price) AS sales_amt FROM catalog_sales, item, date_dim WHERE cs_warehouse_sk IS NULL AND cs_sold_date_sk = d_date_sk AND cs_item_sk = i_item_sk GROUP BY d_year, d_qoy, i_category) SELECT channel, col_name, d_year, d_qoy, i_category, sales_cnt, sales_amt FROM store_sales_agg UNION ALL SELECT channel, col_name, d_year, d_qoy, i_category, sales_cnt, sales_amt FROM web_sales_agg UNION ALL SELECT channel, col_name, d_year, d_qoy, i_category, sales_cnt, sales_amt FROM catalog_sales_agg ORDER BY channel, col_name, d_year, d_qoy, i_category LIMIT 100
┌────────────────────────────────────────────────┐
│┌──────────────────────────────────────────────┐│
││              Total Time: 0.0858s             ││
│└──────────────────────────────────────────────┘│
└────────────────────────────────────────────────┘
┌───────────────────────┐
│         QUERY         │
└───────────┬───────────┘
┌───────────┴───────────┐
│    EXPLAIN_ANALYZE    │
│    ────────────────   │
│         0 rows        │
│        (0.00s)        │
└───────────┬───────────┘
┌───────────┴───────────┐
│         TOP_N         │
│    ────────────────   │
│        Top: 100       │
│                       │
│       Order By:       │
│      channel ASC      │
│      col_name ASC     │
│       d_year ASC      │
│       d_qoy ASC       │
│     i_category ASC    │
│                       │
│        100 rows       │
│        (0.00s)        │
└───────────┬───────────┘
┌───────────┴───────────┐
│         UNION         │
│    ────────────────   │
│         0 rows        ├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│        (0.00s)        │                                                                                                                                         │
└───────────┬───────────┘                                                                                                                                         │
┌───────────┴───────────┐                                                                                                                             ┌───────────┴───────────┐
│         UNION         │                                                                                                                             │       PROJECTION      │
│    ────────────────   │                                                                                                                             │    ────────────────   │
│                       │                                                                                                                             │        channel        │
│                       │                                                                                                                             │        col_name       │
│                       │                                                                                                                             │         d_year        │
│                       │                                                                                                                             │         d_qoy         │
│                       ├──────────────────────────────────────────────────────────────┐                                                              │       i_category      │
│                       │                                                              │                                                              │       sales_cnt       │
│                       │                                                              │                                                              │       sales_amt       │
│                       │                                                              │                                                              │                       │
│         0 rows        │                                                              │                                                              │        230 rows       │
│        (0.00s)        │                                                              │                                                              │        (0.00s)        │
└───────────┬───────────┘                                                              │                                                              └───────────┬───────────┘
┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  ┌───────────┴───────────┐
│       PROJECTION      │                                                  │       PROJECTION      │                                                  │       PROJECTION      │
│    ────────────────   │                                                  │    ────────────────   │                                                  │    ────────────────   │
│        channel        │                                                  │        channel        │                                                  │__internal_decompress_i│
│        col_name       │                                                  │        col_name       │                                                  │  ntegral_integer(#0,  │
│         d_year        │                                                  │         d_year        │                                                  │          1900)        │
│         d_qoy         │                                                  │         d_qoy         │                                                  │__internal_decompress_i│
│       i_category      │                                                  │       i_category      │                                                  │ ntegral_integer(#1, 1)│
│       sales_cnt       │                                                  │       sales_cnt       │                                                  │__internal_decompress_s│
│       sales_amt       │                                                  │       sales_amt       │                                                  │       tring(#2)       │
│                       │                                                  │                       │                                                  │           #3          │
│                       │                                                  │                       │                                                  │           #4          │
│                       │                                                  │                       │                                                  │                       │
│        231 rows       │                                                  │        199 rows       │                                                  │        230 rows       │
│        (0.00s)        │                                                  │        (0.00s)        │                                                  │        (0.00s)        │
└───────────┬───────────┘                                                  └───────────┬───────────┘                                                  └───────────┬───────────┘
┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  ┌───────────┴───────────┐
│       PROJECTION      │                                                  │       PROJECTION      │                                                  │     HASH_GROUP_BY     │
│    ────────────────   │                                                  │    ────────────────   │                                                  │    ────────────────   │
│__internal_decompress_i│                                                  │__internal_decompress_i│                                                  │        Groups:        │
│  ntegral_integer(#0,  │                                                  │  ntegral_integer(#0,  │                                                  │           #0          │
│          1900)        │                                                  │          1900)        │                                                  │           #1          │
│__internal_decompress_i│                                                  │__internal_decompress_i│                                                  │           #2          │
│ ntegral_integer(#1, 1)│                                                  │ ntegral_integer(#1, 1)│                                                  │                       │
│__internal_decompress_s│                                                  │__internal_decompress_s│                                                  │      Aggregates:      │
│       tring(#2)       │                                                  │       tring(#2)       │                                                  │      count_star()     │
│           #3          │                                                  │           #3          │                                                  │        sum(#3)        │
│           #4          │                                                  │           #4          │                                                  │                       │
│                       │                                                  │                       │                                                  │                       │
│        231 rows       │                                                  │        199 rows       │                                                  │        230 rows       │
│        (0.00s)        │                                                  │        (0.00s)        │                                                  │        (0.01s)        │
└───────────┬───────────┘                                                  └───────────┬───────────┘                                                  └───────────┬───────────┘
┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  ┌───────────┴───────────┐
│     HASH_GROUP_BY     │                                                  │     HASH_GROUP_BY     │                                                  │       PROJECTION      │
│    ────────────────   │                                                  │    ────────────────   │                                                  │    ────────────────   │
│        Groups:        │                                                  │        Groups:        │                                                  │         d_year        │
│           #0          │                                                  │           #0          │                                                  │         d_qoy         │
│           #1          │                                                  │           #1          │                                                  │       i_category      │
│           #2          │                                                  │           #2          │                                                  │   cs_ext_sales_price  │
│                       │                                                  │                       │                                                  │                       │
│      Aggregates:      │                                                  │      Aggregates:      │                                                  │                       │
│      count_star()     │                                                  │      count_star()     │                                                  │                       │
│        sum(#3)        │                                                  │        sum(#3)        │                                                  │                       │
│                       │                                                  │                       │                                                  │                       │
│        231 rows       │                                                  │        199 rows       │                                                  │      35,754 rows      │
│        (0.04s)        │                                                  │        (0.00s)        │                                                  │        (0.00s)        │
└───────────┬───────────┘                                                  └───────────┬───────────┘                                                  └───────────┬───────────┘
┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  ┌───────────┴───────────┐
│       PROJECTION      │                                                  │       PROJECTION      │                                                  │       PROJECTION      │
│    ────────────────   │                                                  │    ────────────────   │                                                  │    ────────────────   │
│         d_year        │                                                  │         d_year        │                                                  │           #0          │
│         d_qoy         │                                                  │         d_qoy         │                                                  │__internal_compress_int│
│       i_category      │                                                  │       i_category      │                                                  │   egral_utinyint(#1,  │
│   ss_ext_sales_price  │                                                  │   ws_ext_sales_price  │                                                  │          1900)        │
│                       │                                                  │                       │                                                  │__internal_compress_int│
│                       │                                                  │                       │                                                  │ egral_utinyint(#2, 1) │
│                       │                                                  │                       │                                                  │__internal_compress_str│
│                       │                                                  │                       │                                                  │    ing_uhugeint(#3)   │
│                       │                                                  │                       │                                                  │                       │
│      649,094 rows     │                                                  │        843 rows       │                                                  │      35,754 rows      │
│        (0.00s)        │                                                  │        (0.00s)        │                                                  │        (0.00s)        │
└───────────┬───────────┘                                                  └───────────┬───────────┘                                                  └───────────┬───────────┘
┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  ┌───────────┴───────────┐
│       PROJECTION      │                                                  │       PROJECTION      │                                                  │       HASH_JOIN       │
│    ────────────────   │                                                  │    ────────────────   │                                                  │    ────────────────   │
│           #0          │                                                  │           #0          │                                                  │    Join Type: INNER   │
│__internal_compress_int│                                                  │__internal_compress_int│                                                  │                       │
│   egral_utinyint(#1,  │                                                  │   egral_utinyint(#1,  │                                                  │      Conditions:      │
│          1900)        │                                                  │          1900)        │                                                  │ cs_item_sk = i_item_sk│
│__internal_compress_int│                                                  │__internal_compress_int│                                                  │                       ├─────────────────────────────────────┐
│ egral_utinyint(#2, 1) │                                                  │ egral_utinyint(#2, 1) │                                                  │                       │                                     │
│__internal_compress_str│                                                  │__internal_compress_str│                                                  │                       │                                     │
│    ing_uhugeint(#3)   │                                                  │    ing_uhugeint(#3)   │                                                  │                       │                                     │
│                       │                                                  │                       │                                                  │                       │                                     │
│      649,094 rows     │                                                  │        843 rows       │                                                  │      35,754 rows      │                                     │
│        (0.02s)        │                                                  │        (0.00s)        │                                                  │        (0.00s)        │                                     │
└───────────┬───────────┘                                                  └───────────┬───────────┘                                                  └───────────┬───────────┘                                     │
┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                         ┌───────────┴───────────┐
│       HASH_JOIN       │                                                  │       HASH_JOIN       │                                                  │       HASH_JOIN       │                         │       TABLE_SCAN      │
│    ────────────────   │                                                  │    ────────────────   │                                                  │    ────────────────   │                         │    ────────────────   │
│    Join Type: INNER   │                                                  │    Join Type: INNER   │                                                  │    Join Type: INNER   │                         │      Table: item      │
│                       │                                                  │                       │                                                  │                       │                         │                       │
│      Conditions:      │                                                  │      Conditions:      │                                                  │      Conditions:      │                         │         Type:         │
│ ss_item_sk = i_item_sk│                                                  │ ws_item_sk = i_item_sk│                                                  │   cs_sold_date_sk =   │                         │    Sequential Scan    │
│                       ├─────────────────────────────────────┐            │                       ├─────────────────────────────────────┐            │        d_date_sk      ├────────────┐            │                       │
│                       │                                     │            │                       │                                     │            │                       │            │            │      Projections:     │
│                       │                                     │            │                       │                                     │            │                       │            │            │       i_item_sk       │
│                       │                                     │            │                       │                                     │            │                       │            │            │       i_category      │
│                       │                                     │            │                       │                                     │            │                       │            │            │                       │
│      649,094 rows     │                                     │            │        843 rows       │                                     │            │      35,754 rows      │            │            │      102,000 rows     │
│        (0.00s)        │                                     │            │        (0.00s)        │                                     │            │        (0.02s)        │            │            │        (0.00s)        │
└───────────┬───────────┘                                     │            └───────────┬───────────┘                                     │            └───────────┬───────────┘            │            └───────────────────────┘
┌───────────┴───────────┐                         ┌───────────┴───────────┐┌───────────┴───────────┐                         ┌───────────┴───────────┐┌───────────┴───────────┐┌───────────┴───────────┐
│       HASH_JOIN       │                         │       TABLE_SCAN      ││       HASH_JOIN       │                         │       TABLE_SCAN      ││       TABLE_SCAN      ││       TABLE_SCAN      │
│    ────────────────   │                         │    ────────────────   ││    ────────────────   │                         │    ────────────────   ││    ────────────────   ││    ────────────────   │
│    Join Type: INNER   │                         │      Table: item      ││    Join Type: INNER   │                         │      Table: item      ││         Table:        ││    Table: date_dim    │
│                       │                         │                       ││                       │                         │                       ││     catalog_sales     ││                       │
│      Conditions:      │                         │         Type:         ││      Conditions:      │                         │         Type:         ││                       ││         Type:         │
│   ss_sold_date_sk =   │                         │    Sequential Scan    ││   ws_sold_date_sk =   │                         │    Sequential Scan    ││         Type:         ││    Sequential Scan    │
│        d_date_sk      │                         │                       ││        d_date_sk      │                         │                       ││    Sequential Scan    ││                       │
│                       │                         │      Projections:     ││                       │                         │      Projections:     ││                       ││      Projections:     │
│                       │                         │       i_item_sk       ││                       │                         │       i_item_sk       ││      Projections:     ││       d_date_sk       │
│                       ├────────────┐            │       i_category      ││                       ├────────────┐            │       i_category      ││    cs_sold_date_sk    ││         d_year        │
│                       │            │            │                       ││                       │            │            │                       ││       cs_item_sk      ││         d_qoy         │
│                       │            │            │                       ││                       │            │            │                       ││   cs_ext_sales_price  ││                       │
│                       │            │            │                       ││                       │            │            │                       ││                       ││        Filters:       │
│                       │            │            │                       ││                       │            │            │                       ││        Filters:       ││ d_date_sk>=2450815 AND│
│                       │            │            │                       ││                       │            │            │                       ││  (cs_warehouse_sk IS  ││   d_date_sk<=2452653  │
│                       │            │            │                       ││                       │            │            │                       ││          NULL)        ││                       │
│                       │            │            │                       ││                       │            │            │                       ││                       ││                       │
│      649,094 rows     │            │            │      102,000 rows     ││        843 rows       │            │            │      102,000 rows     ││      35,754 rows      ││       1,839 rows      │
│        (0.05s)        │            │            │        (0.00s)        ││        (0.00s)        │            │            │        (0.00s)        ││        (0.30s)        ││        (0.00s)        │
└───────────┬───────────┘            │            └───────────────────────┘└───────────┬───────────┘            │            └───────────────────────┘└───────────────────────┘└───────────────────────┘
┌───────────┴───────────┐┌───────────┴───────────┐                         ┌───────────┴───────────┐┌───────────┴───────────┐
│       TABLE_SCAN      ││       TABLE_SCAN      │                         │       TABLE_SCAN      ││       TABLE_SCAN      │
│    ────────────────   ││    ────────────────   │                         │    ────────────────   ││    ────────────────   │
│         Table:        ││    Table: date_dim    │                         │    Table: web_sales   ││    Table: date_dim    │
│      store_sales      ││                       │                         │                       ││                       │
│                       ││         Type:         │                         │         Type:         ││         Type:         │
│         Type:         ││    Sequential Scan    │                         │    Sequential Scan    ││    Sequential Scan    │
│    Sequential Scan    ││                       │                         │                       ││                       │
│                       ││      Projections:     │                         │      Projections:     ││      Projections:     │
│      Projections:     ││       d_date_sk       │                         │    ws_sold_date_sk    ││       d_date_sk       │
│    ss_sold_date_sk    ││         d_year        │                         │       ws_item_sk      ││         d_year        │
│       ss_item_sk      ││         d_qoy         │                         │   ws_ext_sales_price  ││         d_qoy         │
│   ss_ext_sales_price  ││                       │                         │                       ││                       │
│                       ││        Filters:       │                         │        Filters:       ││        Filters:       │
│        Filters:       ││ d_date_sk>=2450816 AND│                         │  (ws_bill_addr_sk IS  ││ d_date_sk>=2450816 AND│
│ (ss_hdemo_sk IS NULL) ││   d_date_sk<=2452642  │                         │          NULL)        ││   d_date_sk<=2452642  │
│                       ││                       │                         │                       ││                       │
│      649,094 rows     ││       1,827 rows      │                         │        843 rows       ││       1,827 rows      │
│        (0.32s)        ││        (0.00s)        │                         │        (0.05s)        ││        (0.00s)        │
└───────────────────────┘└───────────────────────┘                         └───────────────────────┘└───────────────────────┘
