WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_moy = 12 AND d_year = 2000), filtered_items AS (SELECT i_item_sk, i_brand_id, i_brand FROM item WHERE i_manager_id = 100), prefetch_sales AS (SELECT ss_item_sk, ss_ext_sales_price, d_date_sk FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk)
SELECT i_brand_id AS brand_id, i_brand AS brand, SUM(ss_ext_sales_price) AS ext_price FROM filtered_items JOIN prefetch_sales ON ss_item_sk = i_item_sk GROUP BY i_brand, i_brand_id ORDER BY ext_price DESC, i_brand_id LIMIT 100