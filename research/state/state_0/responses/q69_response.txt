Looking at the query, I can see three key optimization opportunities:

1. **Multiple date_dim scans** - The same date filter (d_year=2000 AND d_moy BETWEEN 1 AND 3) appears in three separate correlated subqueries
2. **Customer address filter** - ca_state IN ('TX', 'VA', 'MI') can be pre-filtered
3. **Correlated subqueries** - EXISTS/NOT EXISTS subqueries scanning large fact tables multiple times

The most impactful optimization will be to pre-filter date_dim and create a set of customer keys that meet the date criteria for each sales channel, then use those pre-filtered sets for the EXISTS checks.

```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "semantic_rewrite",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_year = 2000 AND d_moy BETWEEN 1 AND 3",
        "filtered_addresses": "SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('TX', 'VA', 'MI')",
        "store_sales_customers": "SELECT DISTINCT ss_customer_sk FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk",
        "web_sales_customers": "SELECT DISTINCT ws_bill_customer_sk FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk",
        "catalog_sales_customers": "SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk",
        "main_query": "SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c JOIN filtered_addresses AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics AS cd ON cd_demo_sk = c.c_current_cdemo_sk WHERE EXISTS (SELECT 1 FROM store_sales_customers AS ssc WHERE ssc.ss_customer_sk = c.c_customer_sk) AND NOT EXISTS (SELECT 1 FROM web_sales_customers AS wsc WHERE wsc.ws_bill_customer_sk = c.c_customer_sk) AND NOT EXISTS (SELECT 1 FROM catalog_sales_customers AS csc WHERE csc.cs_ship_customer_sk = c.c_customer_sk) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100"
      },
      "invariants_kept": [
        "same result rows", 
        "same ordering",
        "same column output",
        "same grouping grain"
      ],
      "expected_speedup": "3.5x",
      "risk": "medium"
    }
  ],
  "explanation": "Created filtered CTEs for date_dim (used 3 times in subqueries) and customer_address. Materialized DISTINCT customer keys for each sales channel that meet the date criteria, transforming correlated subqueries into efficient set membership checks. This reduces date_dim scans from 3 to 1 and avoids repeated full fact table scans in correlated subqueries."
}
```