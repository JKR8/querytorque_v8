```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE (d_year = 2001 OR (d_year = 2000 AND d_moy = 12) OR (d_year = 2002 AND d_moy = 1))",
        "filtered_sales": "SELECT ss_item_sk, ss_store_sk, d_year, d_moy, ss_sales_price FROM store_sales JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk",
        "v1": "SELECT i_category, i_brand, s_store_name, s_company_name, d_year, d_moy, SUM(ss_sales_price) AS sum_sales, AVG(SUM(ss_sales_price)) OVER (PARTITION BY i_category, i_brand, s_store_name, s_company_name, d_year) AS avg_monthly_sales, RANK() OVER (PARTITION BY i_category, i_brand, s_store_name, s_company_name ORDER BY d_year, d_moy) AS rn FROM item JOIN filtered_sales ON item.i_item_sk = filtered_sales.ss_item_sk JOIN store ON filtered_sales.ss_store_sk = store.s_store_sk GROUP BY i_category, i_brand, s_store_name, s_company_name, d_year, d_moy"
      },
      "invariants_kept": [
        "same result rows",
        "same column output",
        "same window function semantics",
        "same grouping and aggregation"
      ],
      "expected_speedup": "4.00x",
      "risk": "low"
    }
  ],
  "explanation": "Applied DATE_CTE_ISOLATE pattern: created a CTE (filtered_dates) to isolate date dimension filtering, then joined it early with the fact table (store_sales) in filtered_sales CTE. This reduces the fact table scan from 345M rows to only rows matching the date filter (3 date conditions: 2001 year, Dec 2000, Jan 2002). The filtered_sales CTE materializes the reduced fact rows before joining with other dimensions (item, store), dramatically reducing the data volume for the expensive GROUP BY and window function operations. Preserved all original OR conditions exactly without ORâ†’UNION transformation."
}
```