{
  "operations": [
    {
      "op": "replace_clause",
      "target": "main_query.select",
      "sql": "select ca_zip, sum(cs_sales_price)"
    },
    {
      "op": "replace_clause",
      "target": "main_query.from",
      "sql": "from (\n   select ca_zip, cs_sales_price\n   from catalog_sales, customer, customer_address, date_dim\n   where cs_bill_customer_sk = c_customer_sk\n     and c_current_addr_sk = ca_address_sk\n     and (substr(ca_zip,1,5) in ('85669', '86197','88274','83405','86475', '85392', '85460', '80348', '81792')\n          or ca_state in ('CA','WA','GA'))\n     and cs_sold_date_sk = d_date_sk\n     and d_qoy = 1 and d_year = 2001\n   union all\n   select ca_zip, cs_sales_price\n   from catalog_sales, customer, customer_address, date_dim\n   where cs_bill_customer_sk = c_customer_sk\n     and c_current_addr_sk = ca_address_sk\n     and cs_sales_price > 500\n     and not (substr(ca_zip,1,5) in ('85669', '86197','88274','83405','86475', '85392', '85460', '80348', '81792')\n              or ca_state in ('CA','WA','GA'))\n     and cs_sold_date_sk = d_date_sk\n     and d_qoy = 1 and d_year = 2001\n ) x"
    },
    {
      "op": "replace_clause",
      "target": "main_query.where",
      "sql": ""
    }
  ],
  "semantic_warnings": [
    "Decomposed OR condition into UNION ALL to allow independent index/scan optimizations."
  ],
  "explanation": "Split the query into two branches using UNION ALL: one filtering efficiently on customer address (zip/state) and the other on sales price. This allows the optimizer to use specific access paths for each filter, avoiding a full table scan forced by the OR condition."
}