{
  "source": "v1_standard",
  "original_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/packages/qt-sql/qt_sql/benchmarks/duckdb_tpcds/queries/query_14.sql",
  "optimized_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/research/archive/benchmark_results/CONSOLIDATED_BENCHMARKS/benchmark_output_v1_standard/q14/iteration_1_optimized.sql",
  "validation": [
    {
      "iteration": 1,
      "status": "success",
      "speedup": 0.9365204076523962,
      "improved": false
    },
    {
      "iteration": 2,
      "status": "success",
      "speedup": 1.8266350715481703,
      "improved": true
    },
    {
      "iteration": 3,
      "status": "success",
      "speedup": 0.9710097679640299,
      "improved": false
    },
    {
      "iteration": 4,
      "status": "success",
      "speedup": 1.0134130715230298,
      "improved": false
    },
    {
      "iteration": 5,
      "status": "validation_failed",
      "error": "SEMANTIC ERROR: Value mismatch - row counts match but VALUES differ\nSample differences: [ValueDifference(row_index=89, column='sum(number_sales)', original_value=3510, optimized_value=59), ValueDifference(row_index=89, column='sum(sales)', original_value=Decimal('18191700.77'), optimized_value=Decimal('312388.50')), ValueDifference(row_index=90, column='i_class_id', original_value=3, optimized_value=2), ValueDifference(row_index=90, column='sum(number_sales)', original_value=4013, optimized_value=3569), ValueDifference(row_index=90, column='sum(sales)', original_value=Decimal('20093180.76'), optimized_value=Decimal('18504089.27'))]\nOriginal row 0: {'channel': 'catalog', 'i_brand_id': 1001001, 'i_class_id': 1, 'i_category_id': 1, 'sum(sales)': Decimal('65894234.26'), 'sum(number_sales)': 13069}\nOptimized row 0: {'channel': 'catalog', 'i_brand_id': 1001001, 'i_class_id': 1, 'i_category_id': 1, 'sum(sales)': Decimal('65894234.26'), 'sum(number_sales)': 13069}\nYour optimized SQL that failed:\n```sql\nWITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2000 + 2 AND d_moy = 11), store_items AS (SELECT DISTINCT ss_item_sk FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk), catalog_items AS (SELECT DISTINCT cs_item_sk FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk), web_items AS (SELECT DISTINCT ws_item_sk FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk), cross_items_flat AS (SELECT i.i_item_sk AS ss_item_sk FROM item AS i WHERE i.i_item_sk IN (SELECT ss_item_sk FROM store_items) AND i.i_item_sk IN (SELECT cs_item_sk FROM catalog_items) AND i.i_item_sk IN (SELECT ws_item_sk FROM web_items)), cross_items AS (SELECT i_item_sk AS ss_item_sk FROM item, (SELECT iss.i_brand_id AS brand_id, iss.i_class_id AS class_id, iss.i_category_id AS category_id FROM store_sales, item AS iss, date_dim AS d1 WHERE ss_item_sk = iss.i_item_sk AND ss_sold_date_sk = d1.d_date_sk AND d1.d_year BETWEEN 2000 AND 2000 + 2 INTERSECT SELECT ics.i_brand_id, ics.i_class_id, ics.i_category_id FROM catalog_sales, item AS ics, date_dim AS d2 WHERE cs_item_sk = ics.i_item_sk AND cs_sold_date_sk = d2.d_date_sk AND d2.d_year BETWEEN 2000 AND 2000 + 2 INTERSECT SELECT iws.i_brand_id, iws.i_class_id, iws.i_category_id FROM web_sales, item AS iws, date_dim AS d3 WHERE ws_item_sk = iws.i_item_sk AND ws_sold_date_sk = d3.d_date_sk AND d3.d_year BETWEEN 2000 AND 2000 + 2) WHERE i_brand_id = brand_id AND i_class_id = class_id AND i_category_id = category_id), avg_sales AS (SELECT AVG(quantity * list_price) AS average_sales FROM (SELECT ss_quantity AS quantity, ss_list_price AS list_price FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_year BETWEEN 2000 AND 2000 + 2 UNION ALL SELECT cs_quantity AS quantity, cs_list_price AS list_price FROM catalog_sales, date_dim WHERE cs_sold_date_sk = d_date_sk AND d_year BETWEEN 2000 AND 2000 + 2 UNION ALL SELECT ws_quantity AS quantity, ws_list_price AS list_price FROM web_sales, date_dim WHERE ws_sold_date_sk = d_date_sk AND d_year BETWEEN 2000 AND 2000 + 2) AS x) SELECT channel, i_brand_id, i_class_id, i_category_id, SUM(sales), SUM(number_sales) FROM (SELECT 'store' AS channel, i.i_brand_id, i.i_class_id, i.i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales JOIN item AS i ON ss_item_sk = i.i_item_sk JOIN filtered_dates ON ss_sold_date_sk = d_date_sk WHERE i.i_item_sk IN (SELECT ss_item_sk FROM cross_items_flat) GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales) UNION ALL SELECT 'catalog' AS channel, i.i_brand_id, i.i_class_id, i.i_category_id, SUM(cs_quantity * cs_list_price) AS sales, COUNT(*) AS number_sales FROM catalog_sales JOIN item AS i ON cs_item_sk = i.i_item_sk JOIN filtered_dates ON cs_sold_date_sk = d_date_sk WHERE i.i_item_sk IN (SELECT ss_item_sk FROM cross_items_flat) GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id HAVING SUM(cs_quantity * cs_list_price) > (SELECT average_sales FROM avg_sales) UNION ALL SELECT 'web' AS channel, i.i_brand_id, i.i_class_id, i.i_category_id, SUM(ws_quantity * ws_list_price) AS sales, COUNT(*) AS number_sales FROM web_sales JOIN item AS i ON ws_item_sk = i.i_item_sk JOIN filtered_dates ON ws_sold_date_sk = d_date_sk WHERE i.i_item_sk IN (SELECT ss_item_sk FROM cross_items_flat) GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id HAVING SUM(ws_quantity * ws_list_price) > (SELECT average_sales FROM avg_sales)) AS y GROUP BY ROLLUP (channel, i_brand_id, i_class_id, i_category_id) ORDER BY channel, i_brand_id, i_class_id, i_category_id LIMIT 100\n```"
    }
  ]
}