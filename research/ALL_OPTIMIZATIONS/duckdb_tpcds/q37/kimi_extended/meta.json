{
  "source": "kimi_extended",
  "original_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/packages/qt-sql/qt_sql/benchmarks/duckdb_tpcds/queries/query_37.sql",
  "optimized_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/research/archive/benchmark_results/CONSOLIDATED_BENCHMARKS/kimi_q31-q99_optimization/q37/output_optimized.sql",
  "validation": {
    "query_num": 37,
    "status": "success",
    "original_sql": "-- start query 37 in stream 0 using template query37.tpl\nselect i_item_id\n       ,i_item_desc\n       ,i_current_price\n from item, inventory, date_dim, catalog_sales\n where i_current_price between 45 and 45 + 30\n and inv_item_sk = i_item_sk\n and d_date_sk=inv_date_sk\n and d_date between cast('1999-02-21' as date) and (cast('1999-02-21' as date) + INTERVAL 60 DAY)\n and i_manufact_id in (856,707,1000,747)\n and inv_quantity_on_hand between 100 and 500\n and cs_item_sk = i_item_sk\n group by i_item_id,i_item_desc,i_current_price\n order by i_item_id\n LIMIT 100;\n\n-- end query 37 in stream 0 using template query37.tpl\n",
    "optimized_sql": "WITH filtered_items AS (SELECT i_item_sk, i_item_id, i_item_desc, i_current_price FROM item WHERE i_current_price BETWEEN 45 AND 45 + 30 AND i_manufact_id IN (856, 707, 1000, 747)), filtered_inventory AS (SELECT inv_item_sk, inv_date_sk FROM inventory WHERE inv_quantity_on_hand BETWEEN 100 AND 500), filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-02-21' AS DATE) AND (CAST('1999-02-21' AS DATE) + INTERVAL '60' DAY))\nSELECT fi.i_item_id, fi.i_item_desc, fi.i_current_price FROM filtered_items AS fi JOIN filtered_inventory AS inv ON fi.i_item_sk = inv.inv_item_sk JOIN filtered_dates AS d ON inv.inv_date_sk = d.d_date_sk JOIN catalog_sales AS cs ON fi.i_item_sk = cs.cs_item_sk GROUP BY fi.i_item_id, fi.i_item_desc, fi.i_current_price ORDER BY fi.i_item_id LIMIT 100",
    "raw_response": " ```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"early_filter\",\n      \"nodes\": {\n        \"filtered_items\": \"SELECT i_item_sk, i_item_id, i_item_desc, i_current_price FROM item WHERE i_current_price BETWEEN 45 AND 45 + 30 AND i_manufact_id IN (856, 707, 1000, 747)\",\n        \"filtered_inventory\": \"SELECT inv_item_sk, inv_date_sk FROM inventory WHERE inv_quantity_on_hand BETWEEN 100 AND 500\",\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-02-21' AS DATE) AND (CAST('1999-02-21' AS DATE) + INTERVAL '60' DAY)\",\n        \"main_query\": \"SELECT fi.i_item_id, fi.i_item_desc, fi.i_current_price FROM filtered_items fi JOIN filtered_inventory inv ON fi.i_item_sk = inv.inv_item_sk JOIN filtered_dates d ON inv.inv_date_sk = d.d_date_sk JOIN catalog_sales cs ON fi.i_item_sk = cs.cs_item_sk GROUP BY fi.i_item_id, fi.i_item_desc, fi.i_current_price ORDER BY fi.i_item_id LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"output columns unchanged\",\n        \"same grouping keys and aggregation\",\n        \"same ordering\",\n        \"same predicate semantics\"\n      ],\n      \"expected_speedup\": \"3.5x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Pushed all selective predicates (item price/manufacturer, inventory quantity, date range) down to base tables before joining. Projected only necessary columns to reduce I/O. This reduces the size of intermediate joins significantly by filtering early rather than after the cross-product of all four tables.\"\n}\n```",
    "error": null,
    "latency_ms": 483652.80564500426,
    "tokens_in": 1553,
    "tokens_out": 3486
  }
}