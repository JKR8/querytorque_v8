{
  "source": "kimi_extended",
  "original_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/packages/qt-sql/qt_sql/benchmarks/duckdb_tpcds/queries/query_55.sql",
  "optimized_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/research/archive/benchmark_results/CONSOLIDATED_BENCHMARKS/kimi_q31-q99_optimization/q55/output_optimized.sql",
  "validation": {
    "query_num": 55,
    "status": "success",
    "original_sql": "-- start query 55 in stream 0 using template query55.tpl\nselect i_brand_id brand_id, i_brand brand,\n \tsum(ss_ext_sales_price) ext_price\n from date_dim, store_sales, item\n where d_date_sk = ss_sold_date_sk\n \tand ss_item_sk = i_item_sk\n \tand i_manager_id=100\n \tand d_moy=12\n \tand d_year=2000\n group by i_brand, i_brand_id\n order by ext_price desc, i_brand_id\n LIMIT 100;\n\n-- end query 55 in stream 0 using template query55.tpl\n",
    "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2000 AND d_moy = 12), filtered_items AS (SELECT i_item_sk, i_brand_id, i_brand FROM item WHERE i_manager_id = 100)\nSELECT i_brand_id AS brand_id, i_brand AS brand, SUM(ss_ext_sales_price) AS ext_price FROM store_sales JOIN filtered_dates AS fd ON ss_sold_date_sk = fd.d_date_sk JOIN filtered_items AS fi ON ss_item_sk = fi.i_item_sk GROUP BY i_brand, i_brand_id ORDER BY ext_price DESC, i_brand_id LIMIT 100",
    "raw_response": " ```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"early_filter\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_year = 2000 AND d_moy = 12\",\n        \"filtered_items\": \"SELECT i_item_sk, i_brand_id, i_brand FROM item WHERE i_manager_id = 100\",\n        \"main_query\": \"SELECT i_brand_id AS brand_id, i_brand AS brand, SUM(ss_ext_sales_price) AS ext_price FROM store_sales JOIN filtered_dates fd ON ss_sold_date_sk = fd.d_date_sk JOIN filtered_items fi ON ss_item_sk = fi.i_item_sk GROUP BY i_brand, i_brand_id ORDER BY ext_price DESC, i_brand_id LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"output columns unchanged\",\n        \"grain preserved (i_brand, i_brand_id)\",\n        \"required predicates applied (d_year=2000, d_moy=12, i_manager_id=100)\"\n      ],\n      \"expected_speedup\": \"2.0x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Pushed down selective predicates to dimension tables (date_dim and item) to reduce join cardinality before aggregating. Filtering date_dim for December 2000 and items for manager 100 early minimizes the fact table scan and join overhead.\"\n}\n```",
    "error": null,
    "latency_ms": 25458.960331001435,
    "tokens_in": 1506,
    "tokens_out": 2007
  }
}