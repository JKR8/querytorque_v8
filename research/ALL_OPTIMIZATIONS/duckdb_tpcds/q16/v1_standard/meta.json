{
  "source": "v1_standard",
  "original_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/packages/qt-sql/qt_sql/benchmarks/duckdb_tpcds/queries/query_16.sql",
  "optimized_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/research/archive/benchmark_results/CONSOLIDATED_BENCHMARKS/benchmark_output_v1_standard/q16/iteration_1_optimized.sql",
  "validation": [
    {
      "iteration": 1,
      "status": "validation_failed",
      "error": "Original query execution failed: Binder Error: Ambiguous reference to column name \"cs_order_number\" (use: \"fcs1.cs_order_number\" or \"mwo.cs_order_number\")"
    },
    {
      "iteration": 2,
      "status": "validation_failed",
      "error": "SEMANTIC ERROR: Value mismatch - row counts match but VALUES differ\nSample differences: [ValueDifference(row_index=0, column='total net profit', original_value=Decimal('-1809502.30'), optimized_value=Decimal('-1807652.01')), ValueDifference(row_index=0, column='total shipping cost', original_value=Decimal('8716675.26'), optimized_value=Decimal('8718986.19'))]\nOriginal row 0: {'order count': 1796, 'total shipping cost': Decimal('8716675.26'), 'total net profit': Decimal('-1809502.30')}\nOptimized row 0: {'order count': 1796, 'total shipping cost': Decimal('8718986.19'), 'total net profit': Decimal('-1807652.01')}\nYour optimized SQL that failed:\n```sql\nWITH date_range AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2002-4-01' AND (CAST('2002-4-01' AS DATE) + INTERVAL '60' DAY)), multi_warehouse_orders AS (SELECT cs_order_number FROM catalog_sales GROUP BY cs_order_number HAVING COUNT(DISTINCT cs_warehouse_sk) > 1), non_returned_orders AS (SELECT cr_order_number FROM catalog_returns) SELECT COUNT(DISTINCT cs1.cs_order_number) AS \"order count\", SUM(cs1.cs_ext_ship_cost) AS \"total shipping cost\", SUM(cs1.cs_net_profit) AS \"total net profit\" FROM catalog_sales AS cs1 JOIN date_range AS dr ON cs1.cs_ship_date_sk = dr.d_date_sk JOIN customer_address ON cs1.cs_ship_addr_sk = ca_address_sk JOIN call_center ON cs1.cs_call_center_sk = cc_call_center_sk JOIN multi_warehouse_orders AS mwo ON cs1.cs_order_number = mwo.cs_order_number LEFT JOIN non_returned_orders AS nro ON cs1.cs_order_number = nro.cr_order_number WHERE ca_state = 'WV' AND cc_county IN ('Ziebach County', 'Luce County', 'Richland County', 'Daviess County', 'Barrow County') AND nro.cr_order_number IS NULL ORDER BY COUNT(DISTINCT cs1.cs_order_number) LIMIT 100\n```"
    },
    {
      "iteration": 3,
      "status": "validation_failed",
      "error": "SEMANTIC ERROR: Value mismatch - row counts match but VALUES differ\nSample differences: [ValueDifference(row_index=0, column='total net profit', original_value=Decimal('-1809502.30'), optimized_value=Decimal('-1807652.01')), ValueDifference(row_index=0, column='total shipping cost', original_value=Decimal('8716675.26'), optimized_value=Decimal('8718986.19'))]\nOriginal row 0: {'order count': 1796, 'total shipping cost': Decimal('8716675.26'), 'total net profit': Decimal('-1809502.30')}\nOptimized row 0: {'order count': 1796, 'total shipping cost': Decimal('8718986.19'), 'total net profit': Decimal('-1807652.01')}\nYour optimized SQL that failed:\n```sql\nWITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2002-4-01' AND (CAST('2002-4-01' AS DATE) + INTERVAL '60' DAY)), filtered_addresses AS (SELECT ca_address_sk FROM customer_address WHERE ca_state = 'WV'), filtered_call_centers AS (SELECT cc_call_center_sk FROM call_center WHERE cc_county IN ('Ziebach County', 'Luce County', 'Richland County', 'Daviess County', 'Barrow County')), multi_warehouse_orders AS (SELECT DISTINCT cs_order_number FROM catalog_sales GROUP BY cs_order_number HAVING COUNT(DISTINCT cs_warehouse_sk) > 1), returned_orders AS (SELECT DISTINCT cr_order_number FROM catalog_returns) SELECT COUNT(DISTINCT cs1.cs_order_number) AS \"order count\", SUM(cs1.cs_ext_ship_cost) AS \"total shipping cost\", SUM(cs1.cs_net_profit) AS \"total net profit\" FROM catalog_sales AS cs1 JOIN filtered_dates ON cs1.cs_ship_date_sk = d_date_sk JOIN filtered_addresses ON cs1.cs_ship_addr_sk = ca_address_sk JOIN filtered_call_centers ON cs1.cs_call_center_sk = cc_call_center_sk JOIN multi_warehouse_orders AS mwo ON cs1.cs_order_number = mwo.cs_order_number LEFT JOIN returned_orders AS ro ON cs1.cs_order_number = ro.cr_order_number WHERE ro.cr_order_number IS NULL ORDER BY COUNT(DISTINCT cs1.cs_order_number) LIMIT 100\n```"
    },
    {
      "iteration": 4,
      "status": "validation_failed",
      "error": "SEMANTIC ERROR: Value mismatch - row counts match but VALUES differ\nSample differences: [ValueDifference(row_index=0, column='total net profit', original_value=Decimal('-1809502.30'), optimized_value=Decimal('-1807652.01')), ValueDifference(row_index=0, column='total shipping cost', original_value=Decimal('8716675.26'), optimized_value=Decimal('8718986.19'))]\nOriginal row 0: {'order count': 1796, 'total shipping cost': Decimal('8716675.26'), 'total net profit': Decimal('-1809502.30')}\nOptimized row 0: {'order count': 1796, 'total shipping cost': Decimal('8718986.19'), 'total net profit': Decimal('-1807652.01')}\nYour optimized SQL that failed:\n```sql\nWITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2002-4-01' AND (CAST('2002-4-01' AS DATE) + INTERVAL '60' DAY)), filtered_addresses AS (SELECT ca_address_sk FROM customer_address WHERE ca_state = 'WV'), filtered_call_centers AS (SELECT cc_call_center_sk FROM call_center WHERE cc_county IN ('Ziebach County', 'Luce County', 'Richland County', 'Daviess County', 'Barrow County')), multi_warehouse_orders AS (SELECT cs_order_number FROM catalog_sales GROUP BY cs_order_number HAVING COUNT(DISTINCT cs_warehouse_sk) > 1), returned_orders AS (SELECT cr_order_number FROM catalog_returns) SELECT COUNT(DISTINCT cs1.cs_order_number) AS \"order count\", SUM(cs1.cs_ext_ship_cost) AS \"total shipping cost\", SUM(cs1.cs_net_profit) AS \"total net profit\" FROM catalog_sales AS cs1 JOIN filtered_dates AS fd ON cs1.cs_ship_date_sk = fd.d_date_sk JOIN filtered_addresses AS fa ON cs1.cs_ship_addr_sk = fa.ca_address_sk JOIN filtered_call_centers AS fc ON cs1.cs_call_center_sk = fc.cc_call_center_sk JOIN multi_warehouse_orders AS mwo ON cs1.cs_order_number = mwo.cs_order_number LEFT JOIN returned_orders AS ro ON cs1.cs_order_number = ro.cr_order_number WHERE ro.cr_order_number IS NULL ORDER BY COUNT(DISTINCT cs1.cs_order_number) LIMIT 100\n```"
    },
    {
      "iteration": 5,
      "status": "validation_failed",
      "error": "Original query execution failed: Binder Error: Referenced table \"fcs2\" not found!\nCandidate tables: \"cs2\", \"fcs1\"\n\nLINE 1: ... AS fcs2 WHERE fcs2.cs_order_number = fcs1.cs_order_number AND fcs2.rowid <> fcs1.rowid)), non_returned_orders AS (SELECT...\n                                                                          ^"
    }
  ]
}