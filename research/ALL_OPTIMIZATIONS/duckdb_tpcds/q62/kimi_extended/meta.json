{
  "source": "kimi_extended",
  "original_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/packages/qt-sql/qt_sql/benchmarks/duckdb_tpcds/queries/query_62.sql",
  "optimized_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/research/archive/benchmark_results/CONSOLIDATED_BENCHMARKS/kimi_q31-q99_optimization/q62/output_optimized.sql",
  "validation": {
    "query_num": 62,
    "status": "success",
    "original_sql": "-- start query 62 in stream 0 using template query62.tpl\nselect \n   substr(w_warehouse_name,1,20)\n  ,sm_type\n  ,web_name\n  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\" \n  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk > 30) and \n                 (ws_ship_date_sk - ws_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\" \n  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk > 60) and \n                 (ws_ship_date_sk - ws_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\" \n  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk > 90) and\n                 (ws_ship_date_sk - ws_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\" \n  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\" \nfrom\n   web_sales\n  ,warehouse\n  ,ship_mode\n  ,web_site\n  ,date_dim\nwhere\n    d_month_seq between 1194 and 1194 + 11\nand ws_ship_date_sk   = d_date_sk\nand ws_warehouse_sk   = w_warehouse_sk\nand ws_ship_mode_sk   = sm_ship_mode_sk\nand ws_web_site_sk    = web_site_sk\ngroup by\n   substr(w_warehouse_name,1,20)\n  ,sm_type\n  ,web_name\norder by substr(w_warehouse_name,1,20)\n        ,sm_type\n       ,web_name\n LIMIT 100;\n\n-- end query 62 in stream 0 using template query62.tpl\n",
    "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1194 AND 1194 + 11), filtered_sales AS (SELECT ws_warehouse_sk, ws_ship_mode_sk, ws_web_site_sk, (ws_ship_date_sk - ws_sold_date_sk) AS days_diff FROM web_sales JOIN filtered_dates ON ws_ship_date_sk = d_date_sk)\nSELECT SUBSTRING(w_warehouse_name, 1, 20), sm_type, web_name, SUM(CASE WHEN days_diff <= 30 THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN days_diff > 30 AND days_diff <= 60 THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN days_diff > 60 AND days_diff <= 90 THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN days_diff > 90 AND days_diff <= 120 THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN days_diff > 120 THEN 1 ELSE 0 END) AS \">120 days\" FROM filtered_sales JOIN warehouse ON ws_warehouse_sk = w_warehouse_sk JOIN ship_mode ON ws_ship_mode_sk = sm_ship_mode_sk JOIN web_site ON ws_web_site_sk = web_site_sk GROUP BY SUBSTRING(w_warehouse_name, 1, 20), sm_type, web_name ORDER BY SUBSTRING(w_warehouse_name, 1, 20), sm_type, web_name LIMIT 100",
    "raw_response": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"early_filter\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1194 AND 1194 + 11\",\n        \"filtered_sales\": \"SELECT ws_warehouse_sk, ws_ship_mode_sk, ws_web_site_sk, (ws_ship_date_sk - ws_sold_date_sk) AS days_diff FROM web_sales JOIN filtered_dates ON ws_ship_date_sk = d_date_sk\",\n        \"main_query\": \"SELECT SUBSTRING(w_warehouse_name, 1, 20), sm_type, web_name, SUM(CASE WHEN days_diff <= 30 THEN 1 ELSE 0 END) AS \\\"30 days\\\", SUM(CASE WHEN days_diff > 30 AND days_diff <= 60 THEN 1 ELSE 0 END) AS \\\"31-60 days\\\", SUM(CASE WHEN days_diff > 60 AND days_diff <= 90 THEN 1 ELSE 0 END) AS \\\"61-90 days\\\", SUM(CASE WHEN days_diff > 90 AND days_diff <= 120 THEN 1 ELSE 0 END) AS \\\"91-120 days\\\", SUM(CASE WHEN days_diff > 120 THEN 1 ELSE 0 END) AS \\\">120 days\\\" FROM filtered_sales JOIN warehouse ON ws_warehouse_sk = w_warehouse_sk JOIN ship_mode ON ws_ship_mode_sk = sm_ship_mode_sk JOIN web_site ON ws_web_site_sk = web_site_sk GROUP BY SUBSTRING(w_warehouse_name, 1, 20), sm_type, web_name ORDER BY SUBSTRING(w_warehouse_name, 1, 20), sm_type, web_name LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"output columns unchanged\",\n        \"grouping keys preserved\",\n        \"aggregation semantics identical\",\n        \"inner join semantics maintained\"\n      ],\n      \"expected_speedup\": \"2.5x\",\n      \"risk\": \"low\"\n    }\n  ]\n}\n```",
    "error": null,
    "latency_ms": 163282.58411800198,
    "tokens_in": 1789,
    "tokens_out": 4076
  }
}