{
  "source": "kimi_extended",
  "original_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/packages/qt-sql/qt_sql/benchmarks/duckdb_tpcds/queries/query_96.sql",
  "optimized_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/research/archive/benchmark_results/CONSOLIDATED_BENCHMARKS/kimi_q31-q99_optimization/q96/output_optimized.sql",
  "validation": {
    "query_num": 96,
    "status": "success",
    "original_sql": "-- start query 96 in stream 0 using template query96.tpl\nselect count(*) \nfrom store_sales\n    ,household_demographics \n    ,time_dim, store\nwhere ss_sold_time_sk = time_dim.t_time_sk   \n    and ss_hdemo_sk = household_demographics.hd_demo_sk \n    and ss_store_sk = s_store_sk\n    and time_dim.t_hour = 8\n    and time_dim.t_minute >= 30\n    and household_demographics.hd_dep_count = 3\n    and store.s_store_name = 'ese'\norder by count(*)\n LIMIT 100;\n\n-- end query 96 in stream 0 using template query96.tpl\n",
    "optimized_sql": "WITH filtered_time AS (SELECT t_time_sk FROM time_dim WHERE t_hour = 8 AND t_minute >= 30), filtered_household AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_dep_count = 3), filtered_store AS (SELECT s_store_sk FROM store WHERE s_store_name = 'ese')\nSELECT COUNT(*) FROM store_sales JOIN filtered_time ON ss_sold_time_sk = filtered_time.t_time_sk JOIN filtered_household ON ss_hdemo_sk = filtered_household.hd_demo_sk JOIN filtered_store ON ss_store_sk = filtered_store.s_store_sk ORDER BY COUNT(*) LIMIT 100",
    "raw_response": " ```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"early_filter\",\n      \"nodes\": {\n        \"filtered_time\": \"SELECT t_time_sk FROM time_dim WHERE t_hour = 8 AND t_minute >= 30\",\n        \"filtered_household\": \"SELECT hd_demo_sk FROM household_demographics WHERE hd_dep_count = 3\",\n        \"filtered_store\": \"SELECT s_store_sk FROM store WHERE s_store_name = 'ese'\",\n        \"main_query\": \"SELECT COUNT(*) FROM store_sales JOIN filtered_time ON ss_sold_time_sk = filtered_time.t_time_sk JOIN filtered_household ON ss_hdemo_sk = filtered_household.hd_demo_sk JOIN filtered_store ON ss_store_sk = filtered_store.s_store_sk ORDER BY COUNT(*) LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"output columns unchanged\",\n        \"same count result\",\n        \"same ordering\",\n        \"all required predicates applied\"\n      ],\n      \"expected_speedup\": \"3.50x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Applied early_filter to push selective predicates on dimension tables (time_dim, household_demographics, store) into separate CTEs before joining with the large fact table (store_sales). This reduces the cardinality of dimension scans and the size of hash tables built for joins. The filters s_store_name='ese' and hd_dep_count=3 are highly selective, and filtering time_dim early eliminates irrelevant time slots before the join.\"\n}\n```",
    "error": null,
    "latency_ms": 36567.37082499603,
    "tokens_in": 1486,
    "tokens_out": 2376
  }
}