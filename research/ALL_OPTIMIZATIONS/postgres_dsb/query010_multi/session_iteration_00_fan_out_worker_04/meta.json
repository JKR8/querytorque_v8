{
  "source": "session_iteration_00_fan_out_worker_04",
  "original_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/packages/qt-sql/qt_sql/benchmarks/postgres_dsb/queries/query010_multi.sql",
  "optimized_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/packages/qt-sql/qt_sql/benchmarks/postgres_dsb/swarm_sessions/query010_multi/iteration_00_fan_out/worker_04/optimized.sql",
  "validation": {
    "worker_id": 4,
    "strategy": "novel_or_to_union_restructure",
    "examples_used": [
      "pg_self_join_decomposition",
      "early_filter_decorrelate",
      "pg_dimension_prefetch_star"
    ],
    "optimized_sql": "WITH filtered_date AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 1998\n      AND d_moy BETWEEN 4 AND 7\n),\nfiltered_item AS (\n    SELECT i_item_sk\n    FROM item\n    WHERE i_category IN ('Children', 'Electronics', 'Men')\n      AND i_manager_id BETWEEN 51 AND 60\n),\nstore_customers AS (\n    SELECT DISTINCT ss_customer_sk\n    FROM store_sales\n    JOIN filtered_date ON ss_sold_date_sk = filtered_date.d_date_sk\n    JOIN filtered_item ON ss_item_sk = filtered_item.i_item_sk\n    WHERE ss_sales_price / ss_list_price BETWEEN 0.11 AND 0.21\n),\nweb_customers AS (\n    SELECT DISTINCT ws_bill_customer_sk\n    FROM web_sales\n    JOIN filtered_date ON ws_sold_date_sk = filtered_date.d_date_sk\n    JOIN filtered_item ON ws_item_sk = filtered_item.i_item_sk\n    WHERE ws_sales_price / ws_list_price BETWEEN 0.11 AND 0.21\n),\ncatalog_customers AS (\n    SELECT DISTINCT cs_ship_customer_sk\n    FROM catalog_sales\n    JOIN filtered_date ON cs_sold_date_sk = filtered_date.d_date_sk\n    JOIN filtered_item ON cs_item_sk = filtered_item.i_item_sk\n    WHERE cs_sales_price / cs_list_price BETWEEN 0.11 AND 0.21\n),\ncombined_web_catalog AS (\n    SELECT ws_bill_customer_sk AS customer_sk FROM web_customers\n    UNION\n    SELECT cs_ship_customer_sk FROM catalog_customers\n)\nSELECT\n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  COUNT(*) AS cnt1,\n  cd_purchase_estimate,\n  COUNT(*) AS cnt2,\n  cd_credit_rating,\n  COUNT(*) AS cnt3,\n  cd_dep_count,\n  COUNT(*) AS cnt4,\n  cd_dep_employed_count,\n  COUNT(*) AS cnt5,\n  cd_dep_college_count,\n  COUNT(*) AS cnt6\nFROM customer c\nJOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk\nJOIN customer_demographics cd ON cd_demo_sk = c.c_current_cdemo_sk\nJOIN store_customers sc ON c.c_customer_sk = sc.ss_customer_sk\nJOIN combined_web_catalog cc ON c.c_customer_sk = cc.customer_sk\nWHERE ca_county IN (\n    'Hickman County',\n    'Ohio County',\n    'Parke County',\n    'Pointe Coupee Parish',\n    'Siskiyou County'\n  )\n  AND c.c_birth_month IN (3, 8)\n  AND cd_marital_status IN ('S', 'U', 'M')\n  AND cd_education_status IN ('Secondary', 'Advanced Degree', '4 yr Degree')\n  AND cd_gender = 'M'\nGROUP BY\n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  cd_purchase_estimate,\n  cd_credit_rating,\n  cd_dep_count,\n  cd_dep_employed_count,\n  cd_dep_college_count\nORDER BY\n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  cd_purchase_estimate,\n  cd_credit_rating,\n  cd_dep_count,\n  cd_dep_employed_count,\n  cd_dep_college_count\nLIMIT 100;",
    "speedup": 1.4669747128631876,
    "status": "WIN",
    "transforms": [
      "materialize_cte",
      "or_to_union"
    ],
    "hint": "Transform the OR condition between web_sales and catalog_sales EXISTS clauses into a UNION in a derived table or CTE. Alternatively, try converting EXISTS to IN with a deduplicated subquery and apply early decorrelation techniques.",
    "error_message": null
  }
}