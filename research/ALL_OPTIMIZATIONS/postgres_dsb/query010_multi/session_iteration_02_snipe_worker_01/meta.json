{
  "source": "session_iteration_02_snipe_worker_01",
  "original_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/packages/qt-sql/qt_sql/benchmarks/postgres_dsb/queries/query010_multi.sql",
  "optimized_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/packages/qt-sql/qt_sql/benchmarks/postgres_dsb/swarm_sessions/query010_multi/iteration_02_snipe/worker_01/optimized.sql",
  "validation": {
    "worker_id": 1,
    "strategy": "snipe_2",
    "examples_used": [
      "early_filter_decorrelate",
      "pg_dimension_prefetch_star",
      "pg_self_join_decomposition"
    ],
    "optimized_sql": "WITH filtered_date AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 1998\n      AND d_moy BETWEEN 4 AND 7\n),\nfiltered_item AS (\n    SELECT i_item_sk\n    FROM item\n    WHERE i_category IN ('Children', 'Electronics', 'Men')\n      AND i_manager_id BETWEEN 51 AND 60\n),\nstore_sales_customers AS (\n    SELECT DISTINCT ss_customer_sk\n    FROM store_sales\n    JOIN filtered_date ON ss_sold_date_sk = d_date_sk\n    JOIN filtered_item ON ss_item_sk = i_item_sk\n    WHERE ss_sales_price / ss_list_price BETWEEN 0.11 AND 0.21\n),\neligible_customers AS (\n    SELECT \n        c.c_customer_sk,\n        cd.cd_gender,\n        cd.cd_marital_status,\n        cd.cd_education_status,\n        cd.cd_purchase_estimate,\n        cd.cd_credit_rating,\n        cd.cd_dep_count,\n        cd.cd_dep_employed_count,\n        cd.cd_dep_college_count\n    FROM store_sales_customers ssc\n    JOIN customer c ON ssc.ss_customer_sk = c.c_customer_sk\n    JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk\n    JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk\n    WHERE ca.ca_county IN ('Hickman County', 'Ohio County', 'Parke County', 'Pointe Coupee Parish', 'Siskiyou County')\n      AND c.c_birth_month IN (3, 8)\n      AND cd.cd_marital_status IN ('S', 'U', 'M')\n      AND cd.cd_education_status IN ('Secondary', 'Advanced Degree', '4 yr Degree')\n      AND cd.cd_gender = 'M'\n      AND (EXISTS (\n          SELECT 1\n          FROM web_sales\n          JOIN filtered_date ON ws_sold_date_sk = d_date_sk\n          JOIN filtered_item ON ws_item_sk = i_item_sk\n          WHERE ws_bill_customer_sk = c.c_customer_sk\n            AND ws_sales_price / ws_list_price BETWEEN 0.11 AND 0.21\n      ) OR EXISTS (\n          SELECT 1\n          FROM catalog_sales\n          JOIN filtered_date ON cs_sold_date_sk = d_date_sk\n          JOIN filtered_item ON cs_item_sk = i_item_sk\n          WHERE cs_ship_customer_sk = c.c_customer_sk\n            AND cs_sales_price / cs_list_price BETWEEN 0.11 AND 0.21\n      ))\n)\nSELECT\n    cd_gender,\n    cd_marital_status,\n    cd_education_status,\n    COUNT(*) AS cnt1,\n    cd_purchase_estimate,\n    COUNT(*) AS cnt2,\n    cd_credit_rating,\n    COUNT(*) AS cnt3,\n    cd_dep_count,\n    COUNT(*) AS cnt4,\n    cd_dep_employed_count,\n    COUNT(*) AS cnt5,\n    cd_dep_college_count,\n    COUNT(*) AS cnt6\nFROM eligible_customers\nGROUP BY\n    cd_gender,\n    cd_marital_status,\n    cd_education_status,\n    cd_purchase_estimate,\n    cd_credit_rating,\n    cd_dep_count,\n    cd_dep_employed_count,\n    cd_dep_college_count\nORDER BY\n    cd_gender,\n    cd_marital_status,\n    cd_education_status,\n    cd_purchase_estimate,\n    cd_credit_rating,\n    cd_dep_count,\n    cd_dep_employed_count,\n    cd_dep_college_count\nLIMIT 100;",
    "speedup": 0.8841628209780626,
    "status": "REGRESSION",
    "transforms": [
      "materialize_cte"
    ],
    "hint": "Build a CTE that filters date/item once, then joins store_sales \u2192 customer \u2192 address \u2192 demographics with all base filters applied. Use LATERAL (SELECT EXISTS...) for web_sales and catalog_sales checks on the same customer. Return only customer keys where store_sales exists AND (web OR catalog exists). Then join back lightly for final grouping.",
    "error_message": null
  }
}