{
  "source": "session_iteration_00_fan_out_worker_02",
  "original_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/packages/qt-sql/qt_sql/benchmarks/postgres_dsb/queries/query010_multi.sql",
  "optimized_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/packages/qt-sql/qt_sql/benchmarks/postgres_dsb/swarm_sessions/query010_multi/iteration_00_fan_out/worker_02/optimized.sql",
  "validation": {
    "worker_id": 2,
    "strategy": "moderate_cte_dimension_isolation",
    "examples_used": [
      "pg_date_cte_explicit_join",
      "pg_dimension_prefetch_star",
      "pg_materialized_dimension_fact_prefilter"
    ],
    "optimized_sql": "WITH filtered_date AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 1998\n    AND d_moy BETWEEN 4 AND 7\n),\nfiltered_item AS (\n  SELECT i_item_sk\n  FROM item\n  WHERE i_category IN ('Children', 'Electronics', 'Men')\n    AND i_manager_id BETWEEN 51 AND 60\n),\nfiltered_address AS (\n  SELECT ca_address_sk\n  FROM customer_address\n  WHERE ca_county IN (\n    'Hickman County',\n    'Ohio County',\n    'Parke County',\n    'Pointe Coupee Parish',\n    'Siskiyou County'\n  )\n)\nSELECT\n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  COUNT(*) AS cnt1,\n  cd_purchase_estimate,\n  COUNT(*) AS cnt2,\n  cd_credit_rating,\n  COUNT(*) AS cnt3,\n  cd_dep_count,\n  COUNT(*) AS cnt4,\n  cd_dep_employed_count,\n  COUNT(*) AS cnt5,\n  cd_dep_college_count,\n  COUNT(*) AS cnt6\nFROM customer c\nJOIN filtered_address ca ON c.c_current_addr_sk = ca.ca_address_sk\nJOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk\nWHERE c.c_birth_month IN (3, 8)\n  AND cd.cd_marital_status IN ('S', 'U', 'M')\n  AND cd.cd_education_status IN ('Secondary', 'Advanced Degree', '4 yr Degree')\n  AND cd.cd_gender = 'M'\n  AND EXISTS (\n    SELECT 1\n    FROM store_sales\n    JOIN filtered_date ON ss_sold_date_sk = filtered_date.d_date_sk\n    JOIN filtered_item ON ss_item_sk = filtered_item.i_item_sk\n    WHERE c.c_customer_sk = ss_customer_sk\n      AND ss_sales_price / ss_list_price BETWEEN 11 * 0.01 AND 21 * 0.01\n  )\n  AND (\n    EXISTS (\n      SELECT 1\n      FROM web_sales\n      JOIN filtered_date ON ws_sold_date_sk = filtered_date.d_date_sk\n      JOIN filtered_item ON ws_item_sk = filtered_item.i_item_sk\n      WHERE c.c_customer_sk = ws_bill_customer_sk\n        AND ws_sales_price / ws_list_price BETWEEN 11 * 0.01 AND 21 * 0.01\n    )\n    OR EXISTS (\n      SELECT 1\n      FROM catalog_sales\n      JOIN filtered_date ON cs_sold_date_sk = filtered_date.d_date_sk\n      JOIN filtered_item ON cs_item_sk = filtered_item.i_item_sk\n      WHERE c.c_customer_sk = cs_ship_customer_sk\n        AND cs_sales_price / cs_list_price BETWEEN 11 * 0.01 AND 21 * 0.01\n    )\n  )\nGROUP BY\n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  cd_purchase_estimate,\n  cd_credit_rating,\n  cd_dep_count,\n  cd_dep_employed_count,\n  cd_dep_college_count\nORDER BY\n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  cd_purchase_estimate,\n  cd_credit_rating,\n  cd_dep_count,\n  cd_dep_employed_count,\n  cd_dep_college_count\nLIMIT 100",
    "speedup": 0.9337355846194988,
    "status": "REGRESSION",
    "transforms": [
      "materialize_cte"
    ],
    "hint": "Isolate selective dimension tables (date, item, customer_address) into explicit CTEs with their filters applied early, then restructure the main query with clear JOIN semantics while keeping EXISTS subqueries intact.",
    "error_message": null
  }
}