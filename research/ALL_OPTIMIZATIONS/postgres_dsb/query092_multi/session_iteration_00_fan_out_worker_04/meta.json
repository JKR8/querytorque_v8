{
  "source": "session_iteration_00_fan_out_worker_04",
  "original_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/packages/qt-sql/qt_sql/benchmarks/postgres_dsb/queries/query092_multi.sql",
  "optimized_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/packages/qt-sql/qt_sql/benchmarks/postgres_dsb/swarm_sessions/query092_multi/iteration_00_fan_out/worker_04/optimized.sql",
  "validation": {
    "worker_id": 4,
    "strategy": "novel_correlation_elimination",
    "examples_used": [
      "CORRELATED_SUBQUERY_TO_WINDOW",
      "CORRELATED_AGGREGATE_TO_LATERAL",
      "AGGREGATE_PUSH_BELOW_JOIN"
    ],
    "optimized_sql": "WITH filtered_date AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_date BETWEEN '1998-03-13' AND CAST('1998-03-13' AS DATE) + INTERVAL '90 DAY'\n),\nfiltered_item AS (\n    SELECT i_item_sk\n    FROM item\n    WHERE i_manufact_id BETWEEN 341 AND 540 \n       OR i_category IN ('Home', 'Men', 'Music')\n),\nweb_sales_filtered AS (\n    SELECT \n        ws.ws_item_sk,\n        ws.ws_ext_discount_amt,\n        ws.ws_wholesale_cost,\n        ws.ws_sales_price,\n        ws.ws_list_price\n    FROM web_sales ws\n    INNER JOIN filtered_date fd ON fd.d_date_sk = ws.ws_sold_date_sk\n    WHERE ws.ws_wholesale_cost BETWEEN 26 AND 46\n),\nitem_avg_discount AS (\n    SELECT \n        wsf.ws_item_sk,\n        1.3 * AVG(wsf.ws_ext_discount_amt) AS avg_discount\n    FROM web_sales_filtered wsf\n    WHERE wsf.ws_sales_price / wsf.ws_list_price BETWEEN 34 * 0.01 AND 49 * 0.01\n    GROUP BY wsf.ws_item_sk\n)\nSELECT\n    SUM(wsf.ws_ext_discount_amt) AS \"Excess Discount Amount\"\nFROM web_sales_filtered wsf\nINNER JOIN filtered_item fi ON fi.i_item_sk = wsf.ws_item_sk\nINNER JOIN item_avg_discount iad ON iad.ws_item_sk = wsf.ws_item_sk\nWHERE wsf.ws_ext_discount_amt > iad.avg_discount\nGROUP BY ()  -- Ensures single row aggregation\nORDER BY SUM(wsf.ws_ext_discount_amt)\nLIMIT 100;",
    "speedup": 4194.486188606743,
    "status": "WIN",
    "transforms": [
      "decorrelate",
      "date_cte_isolate",
      "dimension_cte_isolate"
    ],
    "hint": "Eliminate correlation via window functions or LATERAL joins, and push aggregations below joins to reduce data movement before the final filter.",
    "error_message": null,
    "error_messages": [],
    "error_category": null
  }
}