{
  "source": "session_iteration_00_fan_out_worker_03",
  "original_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/packages/qt-sql/qt_sql/benchmarks/postgres_dsb/queries/query092_multi.sql",
  "optimized_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/packages/qt-sql/qt_sql/benchmarks/postgres_dsb/swarm_sessions/query092_multi/iteration_00_fan_out/worker_03/optimized.sql",
  "validation": {
    "worker_id": 3,
    "strategy": "aggressive_prefetch_materialize",
    "examples_used": [
      "pg_materialized_dimension_fact_prefilter",
      "pg_self_join_decomposition",
      "inline_decorrelate_materialized"
    ],
    "optimized_sql": "WITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_date BETWEEN '1998-03-13' AND CAST('1998-03-13' AS DATE) + INTERVAL '90 DAY'\n),\nfiltered_items AS (\n    SELECT i_item_sk\n    FROM item\n    WHERE i_manufact_id BETWEEN 341 AND 540\n       OR i_category IN ('Home', 'Men', 'Music')\n),\nfiltered_web_sales AS (\n    SELECT ws_item_sk, ws_sold_date_sk, ws_ext_discount_amt,\n           ws_sales_price, ws_list_price\n    FROM web_sales\n    WHERE ws_wholesale_cost BETWEEN 26 AND 46\n),\nitem_thresholds AS (\n    SELECT fws.ws_item_sk,\n           1.3 * AVG(fws.ws_ext_discount_amt) AS threshold\n    FROM filtered_web_sales fws\n    JOIN filtered_dates fd ON fws.ws_sold_date_sk = fd.d_date_sk\n    WHERE fws.ws_sales_price / fws.ws_list_price BETWEEN 34 * 0.01 AND 49 * 0.01\n    GROUP BY fws.ws_item_sk\n)\nSELECT SUM(fws.ws_ext_discount_amt) AS \"Excess Discount Amount\"\nFROM filtered_web_sales fws\nJOIN filtered_dates fd ON fws.ws_sold_date_sk = fd.d_date_sk\nJOIN filtered_items fi ON fws.ws_item_sk = fi.i_item_sk\nJOIN item_thresholds it ON fws.ws_item_sk = it.ws_item_sk\nWHERE fws.ws_ext_discount_amt > it.threshold\nORDER BY SUM(fws.ws_ext_discount_amt)\nLIMIT 100;",
    "speedup": 18.52567640589825,
    "status": "WIN",
    "transforms": [
      "decorrelate",
      "date_cte_isolate",
      "dimension_cte_isolate"
    ],
    "hint": "Materialize all filtered dimension and fact tables into CTEs first, then join; decompose the self-join pattern by computing the subquery aggregation once and reusing it.",
    "error_message": null,
    "error_messages": [],
    "error_category": null
  }
}