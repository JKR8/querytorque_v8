{
  "source": "session_iteration_00_fan_out_worker_03",
  "original_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/packages/qt-sql/qt_sql/benchmarks/postgres_dsb/queries/query032_multi.sql",
  "optimized_path": "/mnt/c/Users/jakc9/Documents/QueryTorque_V8/packages/qt-sql/qt_sql/benchmarks/postgres_dsb/swarm_sessions/query032_multi/iteration_00_fan_out/worker_03/optimized.sql",
  "validation": {
    "worker_id": 3,
    "strategy": "multi_cte_materialize_decorrelate",
    "examples_used": [
      "pg_materialized_dimension_fact_prefilter",
      "pg_self_join_decomposition",
      "inline_decorrelate_materialized"
    ],
    "optimized_sql": "WITH filtered_items AS (\n    SELECT i_item_sk\n    FROM item\n    WHERE i_manufact_id IN (1, 78, 97, 516, 521)\n       OR i_manager_id BETWEEN 25 AND 54\n),\nfiltered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_date BETWEEN '1999-03-07' AND CAST('1999-03-07' AS DATE) + INTERVAL '90 DAY'\n),\ndate_filtered_sales AS (\n    SELECT cs_item_sk, cs_ext_discount_amt,\n           cs_list_price, cs_sales_price\n    FROM catalog_sales\n    WHERE cs_sold_date_sk IN (SELECT d_date_sk FROM filtered_dates)\n),\nitem_avg_discount AS (\n    SELECT dfs.cs_item_sk,\n           1.3 * AVG(dfs.cs_ext_discount_amt) AS threshold\n    FROM date_filtered_sales dfs\n    JOIN filtered_items fi ON fi.i_item_sk = dfs.cs_item_sk\n    WHERE dfs.cs_list_price BETWEEN 16 AND 45\n      AND dfs.cs_sales_price / dfs.cs_list_price BETWEEN 63 * 0.01 AND 83 * 0.01\n    GROUP BY dfs.cs_item_sk\n)\nSELECT SUM(dfs.cs_ext_discount_amt) AS \"excess discount amount\"\nFROM date_filtered_sales dfs\nJOIN filtered_items fi ON fi.i_item_sk = dfs.cs_item_sk\nJOIN item_avg_discount iad ON iad.cs_item_sk = dfs.cs_item_sk\nWHERE dfs.cs_ext_discount_amt > iad.threshold\nORDER BY SUM(dfs.cs_ext_discount_amt)\nLIMIT 100;",
    "speedup": 202.937713350396,
    "status": "WIN",
    "transforms": [
      "date_cte_isolate",
      "dimension_cte_isolate"
    ],
    "hint": "Materialize all filtered dimension and fact tables in CTEs, decompose self-join patterns to avoid duplicate scans, and decorrelate the subquery using materialization.",
    "error_message": null,
    "error_messages": [],
    "error_category": null
  }
}