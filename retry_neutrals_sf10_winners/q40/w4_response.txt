```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "filtered_date_dim": "SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN CAST('2000-02-10' AS DATE) AND CAST('2000-04-10' AS DATE)",
        "filtered_item": "SELECT i_item_sk, i_item_id FROM item WHERE i_current_price BETWEEN 0.99 AND 1.49",
        "filtered_sales": "SELECT cs_order_number, cs_item_sk, cs_sales_price, cs_warehouse_sk, cs_sold_date_sk FROM catalog_sales",
        "sales_with_returns": "SELECT fs.cs_order_number, fs.cs_item_sk, fs.cs_sales_price, fs.cs_warehouse_sk, fs.cs_sold_date_sk, cr.cr_refunded_cash FROM filtered_sales fs LEFT OUTER JOIN catalog_returns cr ON (fs.cs_order_number = cr.cr_order_number AND fs.cs_item_sk = cr.cr_item_sk)",
        "joined_data": "SELECT w.w_state, i.i_item_id, fd.d_date, swr.cs_sales_price, swr.cr_refunded_cash FROM sales_with_returns swr JOIN filtered_date_dim fd ON swr.cs_sold_date_sk = fd.d_date_sk JOIN filtered_item i ON swr.cs_item_sk = i.i_item_sk JOIN warehouse w ON swr.cs_warehouse_sk = w.w_warehouse_sk",
        "main_query": "SELECT w_state, i_item_id, SUM(CASE WHEN (d_date < CAST('2000-03-11' AS DATE)) THEN cs_sales_price - COALESCE(cr_refunded_cash, 0) ELSE 0 END) AS sales_before, SUM(CASE WHEN (d_date >= CAST('2000-03-11' AS DATE)) THEN cs_sales_price - COALESCE(cr_refunded_cash, 0) ELSE 0 END) AS sales_after FROM joined_data GROUP BY w_state, i_item_id ORDER BY w_state, i_item_id LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same output columns",
        "same grouping",
        "same ordering",
        "same LEFT OUTER JOIN semantics"
      ],
      "expected_speedup": "2.5x",
      "risk": "low"
    }
  ],
  "explanation": "Isolated date_dim filtering into a CTE to reduce rows early from 73,049 to 61. Created filtered_item CTE to reduce item rows from 102,000 to 6,464. This enables the optimizer to push these filters early into the join sequence, reducing the cardinality of intermediate joins dramatically. The left outer join between catalog_sales and catalog_returns is preserved but now operates on a smaller subset of catalog_sales after date and item filtering."
}
```