# General Learnings - Apply to ALL DSB Queries
# Updated after each benchmark round based on patterns observed
# Sections: what_works, anti_patterns, model_issues

# =============================================================================
# WHAT WORKS - Techniques that produce real speedups
# =============================================================================
what_works:
  postgresql_cte:
    - "Use WITH ... AS MATERIALIZED (...) to force early execution"
    - "MATERIALIZED CTEs with fact table filters: expect 1.5-3.0x"

  join_optimization:
    - "OFFSET 0 barrier to control join order for expensive joins"
    - "Window functions to replace non-equi joins: expect 2.0-4.0x"
    - "Pre-aggregate large fact tables before expensive joins"

  dsb_patterns:
    - "Star schema: pre-filter dimensions into MATERIALIZED CTEs"
    - "Non-equi temporal joins: rewrite with window functions"

# =============================================================================
# ANTI-PATTERNS - Techniques that DON'T work or cause regressions
# =============================================================================
anti_patterns:
  cte_mistakes:
    - "Plain CTEs without MATERIALIZED get inlined - no benefit"
    - "CTE extraction of dimension filters: PostgreSQL already pushes these down"
    - "Multiple CTEs that just rename tables: adds overhead, no benefit"

  wrong_bottleneck:
    - "Filtering d_year, i_category, cd_marital_status - these are NOT bottlenecks"
    - "PostgreSQL already pushes down selective dimension predicates"
    - "Real bottlenecks: non-equi joins, date correlations, fact comparisons"

  dsb_specific:
    - "Inventory quantity comparisons (inv_quantity < cs_quantity) are expensive"
    - "Date_dim self-joins correlate sales with inventory - can't optimize with simple filters"

# =============================================================================
# MODEL ISSUES - LLM behavior problems observed in responses
# =============================================================================
model_issues:
  overconfident_claims:
    - "Claims 3x speedup for simple CTE extraction - actual: 1.0-1.3x"
    - "Claims 'significant improvement' without MATERIALIZED hint"
    - "Underestimates complexity of non-equi join optimization"

  missed_patterns:
    - "Focuses on dimension filters instead of expensive joins"
    - "Ignores MATERIALIZED keyword for PostgreSQL CTEs"
    - "Doesn't recognize date correlation patterns (d1.d_week_seq = d2.d_week_seq)"

  output_format:
    - "Sometimes omits expected_speedup or gives unrealistic estimates"
    - "May not identify the actual transform being applied"

# =============================================================================
# CALIBRATION - Realistic speedup expectations
# =============================================================================
speedup_calibration:
  low_impact:  # 1.0-1.3x
    - "CTE extraction without MATERIALIZED"
    - "Simple predicate reordering"
    - "Column pruning"

  medium_impact:  # 1.3-2.0x
    - "MATERIALIZED CTEs for dimension pre-filtering"
    - "OFFSET 0 join order control"
    - "Early aggregation before joins"

  high_impact:  # 2.0-4.0x+
    - "Non-equi join to window function rewrite"
    - "Correlated subquery decorrelation"
    - "Multi-table MATERIALIZED pre-filtering with fact join"
