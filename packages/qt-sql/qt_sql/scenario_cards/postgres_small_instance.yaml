# Scenario Card: PostgreSQL Small Instance
# Limited memory instance. Disk spill degrades performance severely.

name: postgres_small_instance
description: |
  Limited memory instance. Disk spill degrades performance severely.
  Parallel workers limited. Must fit operations in work_mem budget.

resource_envelope:
  memory: "~2GB total, work_mem default 4MB per operation"
  compute: "2 vCPU, limited parallel workers"
  storage_io: "EBS gp3, 3000 IOPS baseline"

failure_definitions:
  - metric: query_duration
    threshold: ">60s"
    severity: fatal
  - metric: temp_blks_written
    threshold: ">500MB"
    severity: warning
  - metric: external_merge_sort
    threshold: "any"
    severity: warning

strategy_priorities:
  - "Eliminate hash join spill (fit build side in work_mem)"
  - "Eliminate sort spill (fit sort input in work_mem)"
  - "Reduce sequential scan volume (indexes, partition pruning)"
  - "Pre-aggregate before joins to reduce intermediate sizes"
  - "Minimize buffer cache pressure (fewer pages touched)"

strategy_avoid:
  - "Strategies that increase intermediate row count"
  - "Heavy parallel plans (limited workers available)"
  - "Plans requiring large temp file usage"
