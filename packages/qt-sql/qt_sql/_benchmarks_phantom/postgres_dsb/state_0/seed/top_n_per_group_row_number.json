{
  "id": "TOP_N_PER_GROUP_ROW_NUMBER",
  "name": "Top N Per Group Row Number",
  "description": "Use ROW_NUMBER() window function instead of correlated subquery\n      COUNT for top-N-per-group patterns.",
  "category": "window_functions",
  "priority": "medium",
  "verified_speedup": "unknown",
  "example": {
    "before_sql": "SELECT * FROM items i\n      WHERE (\n          SELECT COUNT(*) FROM items i2\n          WHERE i2.category = i.category \n            AND i2.created_at > i.created_at\n      ) < 3;",
    "after_sql": "SELECT * FROM (\n          SELECT *, ROW_NUMBER() OVER (\n              PARTITION BY category ORDER BY created_at DESC\n          ) AS rank\n          FROM items\n      ) ranked WHERE rank <= 3;",
    "alternative_sql": "",
    "key_insight": "Retrieving multiple rows per group based on ranking.",
    "transforms": [
      "top_n_per_group_row_number"
    ]
  },
  "metadata": {
    "pg_version": "8.4+",
    "auto_applied_by_pg": "false",
    "research_source": "",
    "notes": ""
  }
}