{
  "id": "CORRELATED_SUBQUERY_TO_WINDOW",
  "name": "Correlated Subquery To Window",
  "description": "Rewrite scalar subqueries computing group aggregates to window functions,\n      eliminating correlated execution and enabling single-pass processing.",
  "category": "window_functions",
  "priority": "medium",
  "verified_speedup": "High - single scan vs N scans",
  "example": {
    "before_sql": "SELECT employee_id, name, salary\n      FROM employees emp\n      WHERE salary > (\n          SELECT AVG(salary) FROM employees \n          WHERE department = emp.department\n      );",
    "after_sql": "SELECT employee_id, name, salary\n      FROM (\n          SELECT *, AVG(salary) OVER (PARTITION BY department) AS dept_avg\n          FROM employees\n      ) emp\n      WHERE salary > dept_avg;",
    "alternative_sql": "",
    "key_insight": "Correlated subquery calculates aggregate for current row's group\n      without changing row count.",
    "transforms": [
      "correlated_subquery_to_window"
    ]
  },
  "metadata": {
    "pg_version": "8.4+",
    "auto_applied_by_pg": "false",
    "research_source": "",
    "notes": ""
  }
}