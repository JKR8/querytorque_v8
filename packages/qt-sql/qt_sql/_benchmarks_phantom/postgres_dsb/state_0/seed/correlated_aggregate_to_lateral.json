{
  "id": "CORRELATED_AGGREGATE_TO_LATERAL",
  "name": "Correlated Aggregate To Lateral",
  "description": "Rewrite scalar subqueries with aggregations to LATERAL joins, enabling\n      the optimizer to select optimal join strategies (hash, merge) rather\n      than being restricted to nested loop execution.",
  "category": "subquery_transformations",
  "priority": "medium",
  "verified_speedup": "unknown",
  "example": {
    "before_sql": "SELECT c.id, c.name,\n             (SELECT SUM(o.amount) FROM orders o \n              WHERE o.customer_id = c.id) AS total_spent\n      FROM customers c;",
    "after_sql": "SELECT c.id, c.name, agg.total_spent\n      FROM customers c\n      LEFT JOIN LATERAL (\n          SELECT SUM(amount) AS total_spent\n          FROM orders\n          WHERE customer_id = c.id\n      ) agg ON TRUE;",
    "alternative_sql": "",
    "key_insight": "When scalar subqueries contain aggregates (COUNT, SUM, AVG, MAX, MIN)\n      that reference outer query columns.",
    "transforms": [
      "correlated_aggregate_to_lateral"
    ]
  },
  "metadata": {
    "pg_version": "9.3+",
    "auto_applied_by_pg": "false",
    "research_source": "",
    "notes": ""
  }
}