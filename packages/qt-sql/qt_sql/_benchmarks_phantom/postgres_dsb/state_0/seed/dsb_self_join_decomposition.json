{
  "id": "DSB_SELF_JOIN_DECOMPOSITION",
  "name": "Dsb Self Join Decomposition",
  "description": "Decompose many-to-many self-joins into multiple passes with\n      intermediate materialization for better cardinality estimation.",
  "category": "dsb_specific",
  "priority": "high",
  "verified_speedup": "unknown",
  "example": {
    "before_sql": "-- DSB Query 100: items sold together\n      SELECT i1.i_item_id, i2.i_item_id, COUNT(*)\n      FROM store_sales ss1\n      JOIN store_sales ss2 ON ss1.ss_ticket_number = ss2.ss_ticket_number \n                           AND ss1.ss_item_sk < ss2.ss_item_sk\n      JOIN item i1 ON ss1.ss_item_sk = i1.i_item_sk\n      JOIN item i2 ON ss2.ss_item_sk = i2.i_item_sk\n      GROUP BY i1.i_item_id, i2.i_item_id;",
    "after_sql": "WITH ticket_items AS MATERIALIZED (\n          SELECT ss_ticket_number, ss_item_sk\n          FROM store_sales\n          WHERE ss_ticket_number IS NOT NULL\n      )\n      SELECT i1.i_item_id, i2.i_item_id, COUNT(*)\n      FROM ticket_items t1\n      JOIN ticket_items t2 ON t1.ss_ticket_number = t2.ss_ticket_number \n                           AND t1.ss_item_sk < t2.ss_item_sk\n      JOIN item i1 ON t1.ss_item_sk = i1.i_item_sk\n      JOIN item i2 ON t2.ss_item_sk = i2.i_item_sk\n      GROUP BY i1.i_item_id, i2.i_item_id;",
    "alternative_sql": "",
    "key_insight": "DSB Query 100 pattern: items frequently sold together.",
    "transforms": [
      "dsb_self_join_decomposition"
    ]
  },
  "metadata": {
    "pg_version": "12+",
    "auto_applied_by_pg": "false",
    "research_source": "DSB Benchmark Paper (VLDB 2021)",
    "notes": ""
  }
}