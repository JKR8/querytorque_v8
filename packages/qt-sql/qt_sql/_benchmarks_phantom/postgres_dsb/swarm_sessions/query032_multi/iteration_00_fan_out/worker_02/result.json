{
  "worker_id": 2,
  "strategy": "cte_date_dimension_prefilter",
  "examples_used": [
    "pg_date_cte_explicit_join",
    "pg_dimension_prefetch_star",
    "pg_materialized_dimension_fact_prefilter"
  ],
  "optimized_sql": "WITH filtered_date AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_date BETWEEN '1999-03-07' \n                     AND CAST('1999-03-07' AS DATE) + INTERVAL '90 DAY'\n),\nfiltered_item AS (\n    SELECT i_item_sk\n    FROM item\n    WHERE i_manufact_id IN (1, 78, 97, 516, 521) \n       OR i_manager_id BETWEEN 25 AND 54\n),\nitem_avg_discount AS (\n    SELECT \n        cs_item_sk,\n        1.3 * AVG(cs_ext_discount_amt) AS threshold\n    FROM catalog_sales\n    JOIN filtered_date ON cs_sold_date_sk = filtered_date.d_date_sk\n    WHERE cs_list_price BETWEEN 16 AND 45\n      AND cs_sales_price / cs_list_price BETWEEN 63 * 0.01 AND 83 * 0.01\n    GROUP BY cs_item_sk\n)\nSELECT\n    SUM(cs.cs_ext_discount_amt) AS \"excess discount amount\"\nFROM catalog_sales cs\nJOIN filtered_item  i ON cs.cs_item_sk = i.i_item_sk\nJOIN filtered_date  d ON cs.cs_sold_date_sk = d.d_date_sk\nLEFT JOIN item_avg_discount avgd ON cs.cs_item_sk = avgd.cs_item_sk\nWHERE cs.cs_ext_discount_amt > COALESCE(avgd.threshold, 0)\nORDER BY SUM(cs.cs_ext_discount_amt)\nLIMIT 100;",
  "speedup": 300.40542129857783,
  "status": "WIN",
  "transforms": [
    "decorrelate",
    "date_cte_isolate",
    "dimension_cte_isolate"
  ],
  "hint": "Isolate date dimension into a CTE, pre-filter all dimensions and fact tables, and use explicit joins to improve join order control.",
  "error_message": null,
  "error_messages": [],
  "error_category": null
}