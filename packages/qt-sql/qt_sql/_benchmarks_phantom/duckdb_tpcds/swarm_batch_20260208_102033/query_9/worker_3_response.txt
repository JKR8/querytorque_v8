```sql
WITH filtered_sales AS (
  SELECT 
    ss_quantity,
    ss_ext_sales_price,
    ss_net_profit,
    CASE 
      WHEN ss_quantity BETWEEN 1 AND 20 THEN 1
      WHEN ss_quantity BETWEEN 21 AND 40 THEN 2
      WHEN ss_quantity BETWEEN 41 AND 60 THEN 3
      WHEN ss_quantity BETWEEN 61 AND 80 THEN 4
      WHEN ss_quantity BETWEEN 81 AND 100 THEN 5
    END AS bucket_id
  FROM store_sales
  WHERE ss_quantity BETWEEN 1 AND 100
)
SELECT
  CASE
    WHEN (SELECT COUNT(*) FROM filtered_sales WHERE bucket_id = 1) > 2972190
    THEN (SELECT AVG(ss_ext_sales_price) FROM filtered_sales WHERE bucket_id = 1)
    ELSE (SELECT AVG(ss_net_profit) FROM filtered_sales WHERE bucket_id = 1)
  END AS bucket1,
  CASE
    WHEN (SELECT COUNT(*) FROM filtered_sales WHERE bucket_id = 2) > 4505785
    THEN (SELECT AVG(ss_ext_sales_price) FROM filtered_sales WHERE bucket_id = 2)
    ELSE (SELECT AVG(ss_net_profit) FROM filtered_sales WHERE bucket_id = 2)
  END AS bucket2,
  CASE
    WHEN (SELECT COUNT(*) FROM filtered_sales WHERE bucket_id = 3) > 1575726
    THEN (SELECT AVG(ss_ext_sales_price) FROM filtered_sales WHERE bucket_id = 3)
    ELSE (SELECT AVG(ss_net_profit) FROM filtered_sales WHERE bucket_id = 3)
  END AS bucket3,
  CASE
    WHEN (SELECT COUNT(*) FROM filtered_sales WHERE bucket_id = 4) > 3188917
    THEN (SELECT AVG(ss_ext_sales_price) FROM filtered_sales WHERE bucket_id = 4)
    ELSE (SELECT AVG(ss_net_profit) FROM filtered_sales WHERE bucket_id = 4)
  END AS bucket4,
  CASE
    WHEN (SELECT COUNT(*) FROM filtered_sales WHERE bucket_id = 5) > 3525216
    THEN (SELECT AVG(ss_ext_sales_price) FROM filtered_sales WHERE bucket_id = 5)
    ELSE (SELECT AVG(ss_net_profit) FROM filtered_sales WHERE bucket_id = 5)
  END AS bucket5
FROM reason
WHERE r_reason_sk = 1
```

**Changes**: Created a pre-filtered fact CTE that scans `store_sales` once, filtering to the relevant quantity ranges (1-100) and adding a bucket_id for efficient subsequent grouping. This replaces 10 separate scans of the fact table with a single scan.

**Expected speedup**: 3-5x by reducing fact table scans from 10 to 1 while maintaining the same logical structure and result columns.