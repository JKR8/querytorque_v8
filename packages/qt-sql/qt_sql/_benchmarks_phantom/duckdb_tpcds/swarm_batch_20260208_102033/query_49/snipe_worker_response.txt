```sql
WITH filtered_dates AS (
  SELECT d_date_sk
  FROM date_dim
  WHERE d_year = 1999
    AND d_moy = 12
),
web_aggregated AS (
  SELECT
    ws.ws_item_sk AS item,
    CAST(SUM(COALESCE(wr.wr_return_quantity, 0)) AS DECIMAL(15,4)) AS return_qty_sum,
    CAST(SUM(COALESCE(ws.ws_quantity, 0)) AS DECIMAL(15,4)) AS sales_qty_sum,
    CAST(SUM(COALESCE(wr.wr_return_amt, 0)) AS DECIMAL(15,4)) AS return_amt_sum,
    CAST(SUM(COALESCE(ws.ws_net_paid, 0)) AS DECIMAL(15,4)) AS net_paid_sum
  FROM web_sales ws
  INNER JOIN filtered_dates fd ON ws.ws_sold_date_sk = fd.d_date_sk
  LEFT OUTER JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number 
    AND ws.ws_item_sk = wr.wr_item_sk
  WHERE wr.wr_return_amt > 10000
    AND ws.ws_net_profit > 1
    AND ws.ws_net_paid > 0
    AND ws.ws_quantity > 0
  GROUP BY ws.ws_item_sk
),
web_ratios AS (
  SELECT
    item,
    return_qty_sum / sales_qty_sum AS return_ratio,
    return_amt_sum / net_paid_sum AS currency_ratio
  FROM web_aggregated
  WHERE sales_qty_sum > 0 AND net_paid_sum > 0
),
web_ranked AS (
  SELECT
    item,
    return_ratio,
    currency_ratio,
    RANK() OVER (ORDER BY return_ratio) AS return_rank,
    RANK() OVER (ORDER BY currency_ratio) AS currency_rank
  FROM web_ratios
),
catalog_aggregated AS (
  SELECT
    cs.cs_item_sk AS item,
    CAST(SUM(COALESCE(cr.cr_return_quantity, 0)) AS DECIMAL(15,4)) AS return_qty_sum,
    CAST(SUM(COALESCE(cs.cs_quantity, 0)) AS DECIMAL(15,4)) AS sales_qty_sum,
    CAST(SUM(COALESCE(cr.cr_return_amount, 0)) AS DECIMAL(15,4)) AS return_amt_sum,
    CAST(SUM(COALESCE(cs.cs_net_paid, 0)) AS DECIMAL(15,4)) AS net_paid_sum
  FROM catalog_sales cs
  INNER JOIN filtered_dates fd ON cs.cs_sold_date_sk = fd.d_date_sk
  LEFT OUTER JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number 
    AND cs.cs_item_sk = cr.cr_item_sk
  WHERE cr.cr_return_amount > 10000
    AND cs.cs_net_profit > 1
    AND cs.cs_net_paid > 0
    AND cs.cs_quantity > 0
  GROUP BY cs.cs_item_sk
),
catalog_ratios AS (
  SELECT
    item,
    return_qty_sum / sales_qty_sum AS return_ratio,
    return_amt_sum / net_paid_sum AS currency_ratio
  FROM catalog_aggregated
  WHERE sales_qty_sum > 0 AND net_paid_sum > 0
),
catalog_ranked AS (
  SELECT
    item,
    return_ratio,
    currency_ratio,
    RANK() OVER (ORDER BY return_ratio) AS return_rank,
    RANK() OVER (ORDER BY currency_ratio) AS currency_rank
  FROM catalog_ratios
),
store_aggregated AS (
  SELECT
    sts.ss_item_sk AS item,
    CAST(SUM(COALESCE(sr.sr_return_quantity, 0)) AS DECIMAL(15,4)) AS return_qty_sum,
    CAST(SUM(COALESCE(sts.ss_quantity, 0)) AS DECIMAL(15,4)) AS sales_qty_sum,
    CAST(SUM(COALESCE(sr.sr_return_amt, 0)) AS DECIMAL(15,4)) AS return_amt_sum,
    CAST(SUM(COALESCE(sts.ss_net_paid, 0)) AS DECIMAL(15,4)) AS net_paid_sum
  FROM store_sales sts
  INNER JOIN filtered_dates fd ON sts.ss_sold_date_sk = fd.d_date_sk
  LEFT OUTER JOIN store_returns sr ON sts.ss_ticket_number = sr.sr_ticket_number 
    AND sts.ss_item_sk = sr.sr_item_sk
  WHERE sr.sr_return_amt > 10000
    AND sts.ss_net_profit > 1
    AND sts.ss_net_paid > 0
    AND sts.ss_quantity > 0
  GROUP BY sts.ss_item_sk
),
store_ratios AS (
  SELECT
    item,
    return_qty_sum / sales_qty_sum AS return_ratio,
    return_amt_sum / net_paid_sum AS currency_ratio
  FROM store_aggregated
  WHERE sales_qty_sum > 0 AND net_paid_sum > 0
),
store_ranked AS (
  SELECT
    item,
    return_ratio,
    currency_ratio,
    RANK() OVER (ORDER BY return_ratio) AS return_rank,
    RANK() OVER (ORDER BY currency_ratio) AS currency_rank
  FROM store_ratios
)
SELECT
  'web' AS channel,
  item,
  return_ratio,
  return_rank,
  currency_rank
FROM web_ranked
WHERE return_rank <= 10 OR currency_rank <= 10
UNION ALL
SELECT
  'catalog' AS channel,
  item,
  return_ratio,
  return_rank,
  currency_rank
FROM catalog_ranked
WHERE return_rank <= 10 OR currency_rank <= 10
UNION ALL
SELECT
  'store' AS channel,
  item,
  return_ratio,
  return_rank,
  currency_rank
FROM store_ranked
WHERE return_rank <= 10 OR currency_rank <= 10
ORDER BY
  1,
  4,
  5,
  2
LIMIT 100
```

Changes: Isolated the date_dim filter into a reusable CTE, separated aggregation and ratio calculation into two-step CTEs per channel, and converted implicit joins to explicit joins. This reduces redundant date_dim scans and allows the optimizer to push aggregations earlier.

Expected speedup: 1.8-2.2x