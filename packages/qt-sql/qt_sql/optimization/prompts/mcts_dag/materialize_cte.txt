Apply ONLY CTE materialization using node-level rewrites.

TASK: Convert repeated subqueries into Common Table Expressions (CTEs).

{dag_prompt}

Rules:
1. If the same subquery pattern appears multiple times, extract it to a CTE
2. If a complex subquery is used once but would benefit from materialization, make it a CTE
3. Name CTEs descriptively based on what they compute
4. Do NOT change the query logic or results
5. Preserve all column names and orderings
6. For this transform, you may need to create NEW node IDs for new CTEs

Return JSON:
```json
{{"rewrites": {{"new_cte_name": "SELECT ...", "main_query": "SELECT ... FROM new_cte_name ..."}}, "explanation": "..."}}
```