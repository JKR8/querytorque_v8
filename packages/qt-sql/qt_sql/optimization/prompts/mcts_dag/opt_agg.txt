Apply ONLY aggregation optimization using node-level rewrites.

TASK: Optimize GROUP BY operations and push down aggregates.

{dag_prompt}

Rules:
1. Push aggregations into subqueries/CTEs when they can pre-aggregate
2. Remove unnecessary columns from GROUP BY if they're functionally determined
3. Convert COUNT(DISTINCT x) to more efficient patterns when possible
4. Use FILTER clause instead of CASE WHEN inside aggregates
5. Pre-compute aggregates in CTEs that will be joined multiple times
6. Do NOT change what columns are in the final result
7. Preserve exact grouping semantics

Return JSON:
```json
{{"rewrites": {{"node_id": "SELECT ..."}}, "explanation": "..."}}
```