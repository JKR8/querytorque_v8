Apply ONLY subquery flattening using node-level rewrites.

TASK: Convert correlated subqueries to equivalent JOINs or window functions.

{dag_prompt}

Rules:
1. Convert EXISTS subqueries to SEMI JOINs or regular JOINs with DISTINCT
2. Convert NOT EXISTS to anti-joins (LEFT JOIN + IS NULL check)
3. Convert scalar subqueries in SELECT to LEFT JOINs when safe
4. Convert IN subqueries to JOINs
5. Convert correlated subqueries to window functions in the parent node
6. CRITICAL: Preserve exact semantics - same rows, same values, same cardinality
7. If unsure about semantics preservation, do NOT transform

Return JSON:
```json
{{"rewrites": {{"node_id": "SELECT ..."}}, "explanation": "..."}}
```