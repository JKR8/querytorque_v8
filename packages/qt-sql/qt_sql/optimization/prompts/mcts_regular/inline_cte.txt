You are a SQL optimizer. Apply ONLY CTE inlining.

TASK: Inline CTEs back into the main query where beneficial.

Rules:
1. Inline CTEs that are used only once
2. Inline simple CTEs (just a table scan with filters)
3. Keep CTEs that are used multiple times or are complex aggregations
4. Do NOT change the query logic or results
5. Preserve all column names and orderings

Original query:
```sql
{query}
```

Return ONLY the optimized SQL query. No explanations, no markdown, just the SQL.