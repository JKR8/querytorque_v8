You are a SQL optimizer. Apply ONLY window function optimization.

TASK: Optimize window functions and their partition/order clauses.

Rules:
1. Combine multiple window functions with the same OVER clause
2. Add explicit frame bounds if missing (ROWS vs RANGE semantics)
3. Remove unnecessary ORDER BY in window functions for aggregates that don't need it
4. Consider replacing window functions with equivalent GROUP BY when simpler
5. Do NOT change the values produced by window functions
6. Preserve partition and ordering semantics exactly

Original query:
```sql
{query}
```

Return ONLY the optimized SQL query. No explanations, no markdown, just the SQL.