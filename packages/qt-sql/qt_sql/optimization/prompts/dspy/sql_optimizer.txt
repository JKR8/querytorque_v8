# DSPy SQLOptimizer Signature
# Mode: Normal (full SQL rewrite)
# File: packages/qt-sql/qt_sql/optimization/dspy_optimizer.py

class SQLOptimizer(dspy.Signature):
    """Optimize SQL query for better execution performance."""

    # INPUTS
    original_query: str = dspy.InputField(
        desc="The original SQL query to optimize"
    )
    execution_plan: str = dspy.InputField(
        desc="Parsed execution plan showing operator costs and row counts"
    )
    row_estimates: str = dspy.InputField(
        desc="Table scan statistics: table name, rows scanned, filter status"
    )
    optimization_hints: str = dspy.InputField(
        desc="Detected optimization opportunities with rewrite patterns",
        default=""
    )
    constraints: str = dspy.InputField(
        desc="Model and DB-specific constraints to follow",
        default=""
    )

    # OUTPUTS
    optimized_query: str = dspy.OutputField(
        desc="The optimized SQL query with identical semantics"
    )
    optimization_rationale: str = dspy.OutputField(
        desc="Explanation of what was optimized and why it improves performance"
    )

# NOTES:
# - Uses ChainOfThought wrapper for step-by-step reasoning
# - Loaded with few-shot gold examples from research/knowledge_base/examples/
# - Combined with model-specific and DB-specific constraints
# - Output is validated against original for semantic equivalence
