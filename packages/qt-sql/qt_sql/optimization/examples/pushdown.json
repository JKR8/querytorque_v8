{
  "id": "pushdown",
  "name": "Filter Pushdown",
  "description": "Push filters from outer query into CTEs/subqueries to reduce intermediate result sizes",
  "benchmark_queries": ["Q39", "Q6", "Q27", "Q92"],
  "verified_speedup": "2.44x",
  "example": {
    "opportunity": "PUSHDOWN",
    "input_slice": "[inv]:\nSELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, stdev, mean, cov\nFROM (SELECT ... FROM inventory JOIN date_dim WHERE d_year = 1998 GROUP BY ...) foo\nWHERE stdev/mean > 1\n\n[main_query]:\nSELECT ... FROM inv inv1, inv inv2\nWHERE inv1.d_moy = 1 AND inv2.d_moy = 2 ...",
    "output": {
      "rewrite_sets": [{
        "id": "rs_01",
        "transform": "pushdown",
        "nodes": {
          "inv": "SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, stdev, mean, CASE mean WHEN 0 THEN NULL ELSE stdev/mean END AS cov FROM (SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, STDDEV_SAMP(inv_quantity_on_hand) AS stdev, AVG(inv_quantity_on_hand) AS mean FROM inventory JOIN item ON inv_item_sk = i_item_sk JOIN warehouse ON inv_warehouse_sk = w_warehouse_sk JOIN date_dim ON inv_date_sk = d_date_sk WHERE d_year = 1998 AND d_moy IN (1, 2) GROUP BY w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy) foo WHERE mean != 0 AND stdev/mean > 1"
        },
        "invariants_kept": ["inv output columns unchanged", "main_query unmodified"],
        "expected_speedup": "2.44x",
        "risk": "low"
      }]
    },
    "key_insight": "Push d_moy IN (1, 2) from outer query into the CTE's WHERE clause. This filters inventory rows BEFORE aggregation."
  }
}
