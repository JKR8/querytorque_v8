{
  "id": "multi_push_predicate",
  "name": "Multi-layer Predicate Pushdown",
  "description": "Push predicates through multiple CTE/subquery layers to base tables",
  "benchmark_queries": [],
  "verified_speedup": "1.3-2.0x",
  "example": {
    "opportunity": "MULTI_PUSH_PREDICATE",
    "input_slice": "[cte_inner]:\nSELECT ss_customer_sk, ss_item_sk, ss_sales_price FROM store_sales\n\n[cte_outer]:\nSELECT ss_customer_sk, SUM(ss_sales_price) as total FROM cte_inner GROUP BY ss_customer_sk\n\n[main_query]:\nSELECT * FROM cte_outer WHERE ss_customer_sk IN (SELECT c_customer_sk FROM customer WHERE c_birth_country = 'UNITED STATES')",
    "output": {
      "rewrite_sets": [{
        "id": "rs_01",
        "transform": "multi_push_predicate",
        "nodes": {
          "target_customers": "SELECT c_customer_sk FROM customer WHERE c_birth_country = 'UNITED STATES'",
          "cte_inner": "SELECT ss_customer_sk, ss_sales_price FROM store_sales JOIN target_customers ON ss_customer_sk = c_customer_sk",
          "main_query": "SELECT ss_customer_sk, SUM(ss_sales_price) as total FROM cte_inner GROUP BY ss_customer_sk"
        },
        "invariants_kept": ["same result rows", "same columns"],
        "expected_speedup": "1.6x",
        "risk": "low"
      }]
    },
    "key_insight": "The customer filter in main_query should be pushed through cte_outer into cte_inner to filter store_sales EARLY. Extract filter to CTE and join at base table."
  }
}
