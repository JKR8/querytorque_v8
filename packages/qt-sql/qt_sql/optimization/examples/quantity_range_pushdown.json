{
  "id": "quantity_range_pushdown",
  "name": "Quantity Range Pushdown",
  "description": "Push shared predicates into repeated quantity-range branches before aggregation",
  "benchmark_queries": ["Q9"],
  "verified_speedup": "2.11x",
  "example": {
    "opportunity": "PUSHDOWN",
    "input_slice": "[quantity_range_1]:\nSELECT ss_item_sk, SUM(ss_quantity) AS qty\nFROM store_sales\nWHERE ss_quantity BETWEEN 1 AND 10\nGROUP BY ss_item_sk\n\n[quantity_range_2]:\nSELECT ss_item_sk, SUM(ss_quantity) AS qty\nFROM store_sales\nWHERE ss_quantity BETWEEN 11 AND 20\nGROUP BY ss_item_sk\n\n[main_query]:\nSELECT i_item_id, q1.qty, q2.qty\nFROM quantity_range_1 q1\nJOIN quantity_range_2 q2 ON q1.ss_item_sk = q2.ss_item_sk\nJOIN item i ON i_item_sk = q1.ss_item_sk\nWHERE i_item_id BETWEEN 'A' AND 'Z'\n  AND ss_sold_date_sk BETWEEN 2450816 AND 2450846",
    "output": {
      "rewrite_sets": [{
        "id": "rs_01",
        "transform": "pushdown",
        "nodes": {
          "quantity_range_1": "SELECT ss_item_sk, SUM(ss_quantity) AS qty FROM store_sales JOIN item ON ss_item_sk = i_item_sk WHERE ss_quantity BETWEEN 1 AND 10 AND i_item_id BETWEEN 'A' AND 'Z' AND ss_sold_date_sk BETWEEN 2450816 AND 2450846 GROUP BY ss_item_sk",
          "quantity_range_2": "SELECT ss_item_sk, SUM(ss_quantity) AS qty FROM store_sales JOIN item ON ss_item_sk = i_item_sk WHERE ss_quantity BETWEEN 11 AND 20 AND i_item_id BETWEEN 'A' AND 'Z' AND ss_sold_date_sk BETWEEN 2450816 AND 2450846 GROUP BY ss_item_sk",
          "main_query": "SELECT i_item_id, q1.qty, q2.qty FROM quantity_range_1 q1 JOIN quantity_range_2 q2 ON q1.ss_item_sk = q2.ss_item_sk JOIN item i ON i_item_sk = q1.ss_item_sk"
        },
        "invariants_kept": ["same result rows", "same aggregation results", "same output columns"],
        "expected_speedup": "2.11x",
        "risk": "low"
      }]
    },
    "key_insight": "When multiple quantity-range branches repeat the same dimensional filters, push those filters into each branch to reduce scan and aggregation cost."
  }
}
