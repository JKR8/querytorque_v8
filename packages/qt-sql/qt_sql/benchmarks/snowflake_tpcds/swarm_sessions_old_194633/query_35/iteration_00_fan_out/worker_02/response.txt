### Part 1: Modified Logic Tree

```
QUERY: (with CTEs)
├── CTE: all_sales_cte [=]
├── CTE: customer_filter [~] (condition modified to preserve OR-EXISTS semantics)
└── MAIN: main_query [~] (uses CTEs instead of direct tables)
    ├── SCAN (customer_filter AS cf, customer_demographics AS cd)
    ├── JOIN (cd.cd_demo_sk = cf.c_current_cdemo_sk)
    ├── AGG (GROUP BY)
    ├── SORT (ca_state ASC, cd_gender ASC, cd_marital_status ASC, cd_dep_count ASC, cd_dep_employed_count ASC, cd_dep_college_count ASC)
    └── OUTPUT (same 18 columns)
```

### Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "snowflake",
  "rewrite_rules": [
    {
      "id": "R1",
      "type": "cte_materialization",
      "description": "Combined sales channels into single CTE with UNION ALL",
      "applied_to": ["all_sales_cte"]
    },
    {
      "id": "R2",
      "type": "predicate_pushdown",
      "description": "Moved address join and EXISTS conditions into CTE",
      "applied_to": ["customer_filter"]
    },
    {
      "id": "R3",
      "type": "semantic_equivalence",
      "description": "Preserved OR-EXISTS via multi-channel CTE scans",
      "applied_to": ["customer_filter"]
    }
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "all_sales_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT ss_customer_sk AS customer_sk, 'store' AS channel FROM store_sales JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk WHERE date_dim.d_year = 2001 AND date_dim.d_qoy < 4 UNION ALL SELECT ws_bill_customer_sk, 'web' FROM web_sales JOIN date_dim ON web_sales.ws_sold_date_sk = date_dim.d_date_sk WHERE date_dim.d_year = 2001 AND date_dim.d_qoy < 4 UNION ALL SELECT cs_ship_customer_sk, 'catalog' FROM catalog_sales JOIN date_dim ON catalog_sales.cs_sold_date_sk = date_dim.d_date_sk WHERE date_dim.d_year = 2001 AND date_dim.d_qoy < 4",
        "interfaces": {"outputs": ["customer_sk", "channel"], "consumes": []}
      },
      "customer_filter": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT c.*, ca.ca_state FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE EXISTS (SELECT 1 FROM all_sales_cte WHERE channel = 'store' AND customer_sk = c.c_customer_sk) AND (EXISTS (SELECT 1 FROM all_sales_cte WHERE channel = 'web' AND customer_sk = c.c_customer_sk) OR EXISTS (SELECT 1 FROM all_sales_cte WHERE channel = 'catalog' AND customer_sk = c.c_customer_sk))",
        "interfaces": {"outputs": ["c_customer_sk", "c_current_cdemo_sk", "ca_state", "...all other customer columns..."], "consumes": ["all_sales_cte"]}
      },
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT ca_state, cd_gender, cd_marital_status, cd_dep_count, COUNT(*) AS cnt1, MAX(cd_dep_count) AS \"MAX(cd_dep_count)\", SUM(cd_dep_count) AS \"SUM(cd_dep_count)\", MAX(cd_dep_count) AS \"MAX(cd_dep_count)\", cd_dep_employed_count, COUNT(*) AS cnt2, MAX(cd_dep_employed_count) AS \"MAX(cd_dep_employed_count)\", SUM(cd_dep_employed_count) AS \"SUM(cd_dep_employed_count)\", MAX(cd_dep_employed_count) AS \"MAX(cd_dep_employed_count)\", cd_dep_college_count, COUNT(*) AS cnt3, MAX(cd_dep_college_count) AS \"MAX(cd_dep_college_count)\", SUM(cd_dep_college_count) AS \"SUM(cd_dep_college_count)\", MAX(cd_dep_college_count) AS \"MAX(cd_dep_college_count)\" FROM customer_filter cf JOIN customer_demographics cd ON cd.cd_demo_sk = cf.c_current_cdemo_sk GROUP BY ca_state, cd_gender, cd_marital_status, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY ca_state, cd_gender, cd_marital_status, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100",
        "interfaces": {"outputs": ["ca_state", "cd_gender", "cd_marital_status", "cd_dep_count", "cnt1", "MAX(cd_dep_count)", "SUM(cd_dep_count)", "MAX(cd_dep_count)", "cd_dep_employed_count", "cnt2", "MAX(cd_dep_employed_count)", "SUM(cd_dep_employed_count)", "MAX(cd_dep_employed_count)", "cd_dep_college_count", "cnt3", "MAX(cd_dep_college_count)", "SUM(cd_dep_college_count)", "MAX(cd_dep_college_count)"], "consumes": ["customer_filter"]}
      }
    },
    "reconstruction_order": ["all_sales_cte", "customer_filter", "main_query"],
    "assembly_template": "WITH all_sales_cte AS ({all_sales_cte}), customer_filter AS ({customer_filter}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "validation_checks": []
}
```

### Explanation
**Changes:** Restructured original query into two CTEs followed by main aggregation. The `all_sales_cte` combines sales channels via UNION ALL with strict date filters. `customer_filter` preserves original OR-EXISTS semantics by scanning CTE three times (store + (web OR catalog)). Main query aggregates from CTE-joined data.  

**Expected mechanism:** Narrow projection in CTE (only customer_sk + channel) reduces I/O versus original full-row scans. Materialized CTE avoids recomputing date joins.  

**Expected speedup:** 2-3x from reduced I/O (sales tables scanned once) and predicate pushdown to date_dim.