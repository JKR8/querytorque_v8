WITH filtered_item AS (
    SELECT i_item_sk
    FROM item
    WHERE i_category IN ('Home', 'Men', 'Music')
      AND i_manager_id IN (1, 2, 4, 11, 12, 14, 21, 29, 32, 52)
),
filtered_customer_address AS (
    SELECT ca_address_sk
    FROM customer_address
    WHERE ca_state IN ('GA', 'MD', 'MO', 'NC', 'OR')
),
filtered_date_d1 AS (
    SELECT d_date_sk, d_date
    FROM date_dim
    WHERE d_year = 2002
),
date_range_pairs AS (
    SELECT
        d1.d_date_sk AS d1_date_sk,
        d2.d_date_sk AS d2_date_sk
    FROM filtered_date_d1 d1
    JOIN date_dim d2 ON d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY')
),
filtered_web_sales AS (
    SELECT ws_item_sk, ws_bill_customer_sk, ws_warehouse_sk, ws_sold_date_sk
    FROM web_sales
    WHERE ws_wholesale_cost BETWEEN 34 AND 54
)
SELECT
    cd_gender,
    cd_marital_status,
    cd_education_status,
    hd_vehicle_count,
    COUNT(*) AS cnt
FROM store_sales
JOIN filtered_item ON ss_item_sk = i_item_sk
JOIN filtered_date_d1 d1 ON ss_sold_date_sk = d1.d_date_sk
JOIN date_range_pairs drp ON d1.d_date_sk = drp.d1_date_sk
JOIN filtered_web_sales ws ON ws.ws_item_sk = ss_item_sk
                          AND ws.ws_sold_date_sk = drp.d2_date_sk
JOIN inventory ON inv_item_sk = ss_item_sk
               AND inv_date_sk = ss_sold_date_sk
               AND ws.ws_warehouse_sk = inv_warehouse_sk
JOIN customer ON ss_customer_sk = c_customer_sk
              AND ws.ws_bill_customer_sk = c_customer_sk
JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk
JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk
JOIN filtered_customer_address ON c_current_addr_sk = ca_address_sk
JOIN warehouse ON ws.ws_warehouse_sk = w_warehouse_sk
JOIN store ON s_state = w_state
WHERE inv_quantity_on_hand >= ss_quantity
GROUP BY
    cd_gender,
    cd_marital_status,
    cd_education_status,
    hd_vehicle_count
ORDER BY cnt

Changes: Materialized filtered subsets of item, customer_address, date_dim (d1) and web_sales into separate CTEs. Created a date_range_pairs CTE that precomputes valid (d1,d2) date pairs in a single pass. Used explicit JOINs and pushed filters early to reduce join volume significantly.
Expected speedup: 2-3x from reducing the self-join search space and pre-filtering dimensions before large fact table joins.