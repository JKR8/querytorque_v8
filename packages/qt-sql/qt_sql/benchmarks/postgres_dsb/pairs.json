[
  {
    "query": "query065_multi",
    "source": "ado_round_01",
    "original": "select \n\ts_store_name,\n\ti_item_desc,\n\tsc.revenue,\n\ti_current_price,\n\ti_wholesale_cost,\n\ti_brand\n from store, item,\n     (select ss_store_sk, avg(revenue) as ave\n \tfrom\n \t    (select  ss_store_sk, ss_item_sk,\n \t\t     sum(ss_sales_price) as revenue\n \t\tfrom store_sales, date_dim\n \t\twhere ss_sold_date_sk = d_date_sk and d_month_seq between 1213 and 1213+11\n    and ss_sales_price / ss_list_price BETWEEN 38 * 0.01 AND 48 * 0.01\n \t\tgroup by ss_store_sk, ss_item_sk) sa\n \tgroup by ss_store_sk) sb,\n     (select  ss_store_sk, ss_item_sk, sum(ss_sales_price) as revenue\n \tfrom store_sales, date_dim\n \twhere ss_sold_date_sk = d_date_sk and d_month_seq between 1213 and 1213+11\n  and ss_sales_price / ss_list_price BETWEEN 38 * 0.01 AND 48 * 0.01\n \tgroup by ss_store_sk, ss_item_sk) sc\n where sb.ss_store_sk = sc.ss_store_sk and\n       sc.revenue <= 0.1 * sb.ave and\n       s_store_sk = sc.ss_store_sk and\n       i_item_sk = sc.ss_item_sk\n       and i_manager_id BETWEEN 32 and 36\n       and s_state in ('TN','TX','VA')\n order by s_store_name, i_item_desc\nlimit 100;",
    "optimized": "WITH date_filter AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1213 AND 1213 + 11), store_sales_revenue AS (SELECT ss_store_sk, ss_item_sk, SUM(ss_sales_price) AS revenue FROM store_sales JOIN date_filter ON store_sales.ss_sold_date_sk = date_filter.d_date_sk WHERE ss_sales_price / ss_list_price BETWEEN 38 * 0.01 AND 48 * 0.01 GROUP BY ss_store_sk, ss_item_sk), store_avg_revenue AS (SELECT ss_store_sk, AVG(revenue) AS ave FROM store_sales_revenue GROUP BY ss_store_sk), filtered_store AS (SELECT s_store_sk, s_store_name, s_state FROM store WHERE s_state IN ('TN', 'TX', 'VA')), filtered_item AS (SELECT i_item_sk, i_item_desc, i_current_price, i_wholesale_cost, i_brand, i_manager_id FROM item WHERE i_manager_id BETWEEN 32 AND 36) SELECT s_store_name, i_item_desc, sc.revenue, i_current_price, i_wholesale_cost, i_brand FROM store_avg_revenue AS sb JOIN store_sales_revenue AS sc ON sb.ss_store_sk = sc.ss_store_sk JOIN filtered_store AS s ON sc.ss_store_sk = s.s_store_sk JOIN filtered_item AS i ON sc.ss_item_sk = i.i_item_sk WHERE sc.revenue <= 0.1 * sb.ave ORDER BY s_store_name, i_item_desc LIMIT 100",
    "transforms": [
      "materialize_cte"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.92,
    "sf5_original_ms": 2594.63,
    "sf5_optimized_ms": 1349.74
  },
  {
    "query": "query010_multi",
    "source": "ado_round_01",
    "original": "select \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  count(*) cnt1,\n  cd_purchase_estimate,\n  count(*) cnt2,\n  cd_credit_rating,\n  count(*) cnt3,\n  cd_dep_count,\n  count(*) cnt4,\n  cd_dep_employed_count,\n  count(*) cnt5,\n  cd_dep_college_count,\n  count(*) cnt6\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  ca_county in ('Hickman County','Ohio County','Parke County','Pointe Coupee Parish','Siskiyou County') and\n  c.c_birth_month in (3, 8) and\n  cd_demo_sk = c.c_current_cdemo_sk\n  and cd_marital_status in ('S', 'U', 'M')\n  and cd_education_status in ('Secondary', 'Advanced Degree', '4 yr Degree')\n  and cd_gender = 'M' and\n  exists (select *\n          from store_sales,date_dim, item\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 1998 and\n                d_moy between 4 and 4+3 and\n                ss_item_sk = i_item_sk and\n                i_category in ('Children', 'Electronics', 'Men')\n                and ss_sales_price / ss_list_price BETWEEN 11 * 0.01 AND 21 * 0.01\n                and i_manager_id BETWEEN 51 and 60\n                ) and\n   (exists (select *\n            from web_sales,date_dim, item\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 1998 and\n                  d_moy between 4 ANd 4+3 and\n                  ws_item_sk = i_item_sk and\n                  i_category in ('Children', 'Electronics', 'Men')\n                  and i_manager_id BETWEEN 51 and 60\n                  and ws_sales_price / ws_list_price BETWEEN 11 * 0.01 AND 21 * 0.01\n                  ) or\n    exists (select *\n            from catalog_sales,date_dim, item\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 1998 and\n                  d_moy between 4 and 4+3 and\n                  cs_item_sk = i_item_sk and\n                  i_category in ('Children', 'Electronics', 'Men')\n                  and i_manager_id BETWEEN 51 and 60\n                  and cs_sales_price / cs_list_price BETWEEN 11 * 0.01 AND 21 * 0.01\n                  ))\n group by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\n order by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\nlimit 100;",
    "optimized": "WITH date_filter AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998 AND d_moy BETWEEN 4 AND 4 + 3), item_filter AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Electronics', 'Men') AND i_manager_id BETWEEN 51 AND 60), store_customers AS (SELECT DISTINCT ss_customer_sk FROM store_sales INNER JOIN date_filter ON ss_sold_date_sk = d_date_sk INNER JOIN item_filter ON ss_item_sk = i_item_sk WHERE ss_sales_price / ss_list_price BETWEEN 11 * 0.01 AND 21 * 0.01), web_or_catalog_customers AS (SELECT ws_bill_customer_sk AS customer_sk FROM web_sales INNER JOIN date_filter ON ws_sold_date_sk = d_date_sk INNER JOIN item_filter ON ws_item_sk = i_item_sk WHERE ws_sales_price / ws_list_price BETWEEN 11 * 0.01 AND 21 * 0.01 UNION ALL SELECT cs_ship_customer_sk AS customer_sk FROM catalog_sales INNER JOIN date_filter ON cs_sold_date_sk = d_date_sk INNER JOIN item_filter ON cs_item_sk = i_item_sk WHERE cs_sales_price / cs_list_price BETWEEN 11 * 0.01 AND 21 * 0.01) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c INNER JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN customer_demographics ON cd_demo_sk = c.c_current_cdemo_sk WHERE ca_county IN ('Hickman County', 'Ohio County', 'Parke County', 'Pointe Coupee Parish', 'Siskiyou County') AND c.c_birth_month IN (3, 8) AND cd_marital_status IN ('S', 'U', 'M') AND cd_education_status IN ('Secondary', 'Advanced Degree', '4 yr Degree') AND cd_gender = 'M' AND EXISTS(SELECT 1 FROM store_customers WHERE ss_customer_sk = c.c_customer_sk) AND EXISTS(SELECT 1 FROM web_or_catalog_customers WHERE customer_sk = c.c_customer_sk) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100",
    "transforms": [
      "date_cte_isolate"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.47,
    "sf5_original_ms": 2331.32,
    "sf5_optimized_ms": 1589.9
  },
  {
    "query": "query072_agg_gold",
    "source": "pg_gold_example",
    "original": "select  i_item_desc\n      ,w_warehouse_name\n      ,d1.d_week_seq\n      ,sum(case when p_promo_sk is null then 1 else 0 end) no_promo\n      ,sum(case when p_promo_sk is not null then 1 else 0 end) promo\n      ,count(*) total_cnt\nfrom catalog_sales\njoin inventory on (cs_item_sk = inv_item_sk)\njoin warehouse on (w_warehouse_sk=inv_warehouse_sk)\njoin item on (i_item_sk = cs_item_sk)\njoin customer_demographics on (cs_bill_cdemo_sk = cd_demo_sk)\njoin household_demographics on (cs_bill_hdemo_sk = hd_demo_sk)\njoin date_dim d1 on (cs_sold_date_sk = d1.d_date_sk)\njoin date_dim d2 on (inv_date_sk = d2.d_date_sk)\njoin date_dim d3 on (cs_ship_date_sk = d3.d_date_sk)\nleft outer join promotion on (cs_promo_sk=p_promo_sk)\nleft outer join catalog_returns on (cr_item_sk = cs_item_sk and cr_order_number = cs_order_number)\nwhere d1.d_week_seq = d2.d_week_seq\n  and inv_quantity_on_hand < cs_quantity\n  and d3.d_date > d1.d_date + interval '3 day'\n  and hd_buy_potential = '501-1000'\n  and d1.d_year = 1998\n  and cd_marital_status = 'M'\n  and cd_dep_count between 9 and 11\n  and i_category IN ('Home', 'Men', 'Music')\n  and cs_wholesale_cost BETWEEN 34 AND 54\ngroup by i_item_desc,w_warehouse_name,d1.d_week_seq\norder by total_cnt desc, i_item_desc, w_warehouse_name, d_week_seq\nlimit 100;",
    "optimized": "WITH filtered_date AS MATERIALIZED (\n  SELECT d_date_sk, d_date, d_week_seq\n  FROM date_dim\n  WHERE d_year = 1998\n),\nfiltered_item AS MATERIALIZED (\n  SELECT i_item_sk, i_item_desc\n  FROM item\n  WHERE i_category IN ('Home', 'Men', 'Music')\n),\nfiltered_cd AS MATERIALIZED (\n  SELECT cd_demo_sk\n  FROM customer_demographics\n  WHERE cd_marital_status = 'M'\n    AND cd_dep_count BETWEEN 9 AND 11\n),\nfiltered_hd AS MATERIALIZED (\n  SELECT hd_demo_sk\n  FROM household_demographics\n  WHERE hd_buy_potential = '501-1000'\n),\ncs_filtered AS MATERIALIZED (\n  SELECT cs_item_sk, cs_bill_cdemo_sk, cs_bill_hdemo_sk, cs_sold_date_sk,\n         cs_ship_date_sk, cs_promo_sk, cs_quantity, cs_wholesale_cost,\n         cs_order_number\n  FROM catalog_sales\n  WHERE cs_wholesale_cost BETWEEN 34 AND 54\n)\nSELECT i.i_item_desc,\n       w.w_warehouse_name,\n       d1.d_week_seq,\n       SUM(CASE WHEN p.p_promo_sk IS NULL THEN 1 ELSE 0 END) AS no_promo,\n       SUM(CASE WHEN p.p_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS promo,\n       COUNT(*) AS total_cnt\nFROM cs_filtered cs\nJOIN inventory inv ON cs.cs_item_sk = inv.inv_item_sk\nJOIN warehouse w ON w.w_warehouse_sk = inv.inv_warehouse_sk\nJOIN filtered_item i ON i.i_item_sk = cs.cs_item_sk\nJOIN filtered_cd cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk\nJOIN filtered_hd hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk\nJOIN filtered_date d1 ON cs.cs_sold_date_sk = d1.d_date_sk\nJOIN date_dim d2 ON inv.inv_date_sk = d2.d_date_sk\nJOIN date_dim d3 ON cs.cs_ship_date_sk = d3.d_date_sk\nLEFT OUTER JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk\nLEFT OUTER JOIN catalog_returns cr ON cr.cr_item_sk = cs.cs_item_sk \n  AND cr.cr_order_number = cs.cs_order_number\nWHERE d1.d_week_seq = d2.d_week_seq\n  AND inv.inv_quantity_on_hand < cs.cs_quantity\n  AND d3.d_date > d1.d_date + INTERVAL '3 day'\nGROUP BY i.i_item_desc, w.w_warehouse_name, d1.d_week_seq\nORDER BY total_cnt DESC, i.i_item_desc, w.w_warehouse_name, d1.d_week_seq\nLIMIT 100;",
    "transforms": [
      "early_filter",
      "date_cte_isolate"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.3,
    "sf5_original_ms": 1812.14,
    "sf5_optimized_ms": 1395.85
  },
  {
    "query": "query054_multi",
    "source": "ado_round_01",
    "original": "with my_customers as (\n select distinct c_customer_sk\n        , c_current_addr_sk\n from\n        ( select cs_sold_date_sk sold_date_sk,\n                 cs_bill_customer_sk customer_sk,\n                 cs_item_sk item_sk,\n                 cs_wholesale_cost wholesale_cost\n          from   catalog_sales\n          union all\n          select ws_sold_date_sk sold_date_sk,\n                 ws_bill_customer_sk customer_sk,\n                 ws_item_sk item_sk,\n                 ws_wholesale_cost wholesale_cost\n          from   web_sales\n         ) cs_or_ws_sales,\n         item,\n         date_dim,\n         customer\n where   sold_date_sk = d_date_sk\n         and item_sk = i_item_sk\n         and i_category = 'Books'\n         and i_class = 'fiction'\n         and c_customer_sk = cs_or_ws_sales.customer_sk\n         and d_moy = 11\n         and d_year = 1998\n         and wholesale_cost BETWEEN 70 AND 100\n         and c_birth_year BETWEEN 1993 AND 2006\n )\n , my_revenue as (\n select c_customer_sk,\n        sum(ss_ext_sales_price) as revenue\n from   my_customers,\n        store_sales,\n        customer_address,\n        store,\n        date_dim\n where  c_current_addr_sk = ca_address_sk\n        and ca_county = s_county\n        and ca_state = s_state\n        and ss_sold_date_sk = d_date_sk\n        and c_customer_sk = ss_customer_sk\n        and ss_wholesale_cost BETWEEN 70 AND 100\n        and s_state in ('GA','IA','LA'\n                    ,'MO','OH','PA'\n                    ,'SD','TN','TX'\n                    ,'VA')\n        and d_month_seq between (select distinct d_month_seq+1\n                                 from   date_dim where d_year = 1998 and d_moy = 11)\n                           and  (select distinct d_month_seq+3\n                                 from   date_dim where d_year = 1998 and d_moy = 11)\n group by c_customer_sk\n )\n , segments as\n (select cast((revenue/50) as int) as segment\n  from   my_revenue\n )\n  select  segment, count(*) as num_customers, segment*50 as segment_base\n from segments\n group by segment\n order by segment, num_customers\n limit 100;",
    "optimized": "with my_customers as (\n select distinct c_customer_sk\n        , c_current_addr_sk\n from\n        ( select cs_sold_date_sk sold_date_sk,\n                 cs_bill_customer_sk customer_sk,\n                 cs_item_sk item_sk,\n                 cs_wholesale_cost wholesale_cost\n          from   catalog_sales\n          union all\n          select ws_sold_date_sk sold_date_sk,\n                 ws_bill_customer_sk customer_sk,\n                 ws_item_sk item_sk,\n                 ws_wholesale_cost wholesale_cost\n          from   web_sales\n         ) cs_or_ws_sales,\n         item,\n         date_dim,\n         customer\n where   sold_date_sk = d_date_sk\n         and item_sk = i_item_sk\n         and i_category = 'Books'\n         and i_class = 'fiction'\n         and c_customer_sk = cs_or_ws_sales.customer_sk\n         and d_moy = 11\n         and d_year = 1998\n         and wholesale_cost BETWEEN 70 AND 100\n         and c_birth_year BETWEEN 1993 AND 2006\n )\n , my_revenue as (\n select c_customer_sk,\n        sum(ss_ext_sales_price) as revenue\n from   my_customers,\n        store_sales,\n        customer_address,\n        store,\n        date_dim\n where  c_current_addr_sk = ca_address_sk\n        and ca_county = s_county\n        and ca_state = s_state\n        and ss_sold_date_sk = d_date_sk\n        and c_customer_sk = ss_customer_sk\n        and ss_wholesale_cost BETWEEN 70 AND 100\n        and s_state in ('GA','IA','LA'\n                    ,'MO','OH','PA'\n                    ,'SD','TN','TX'\n                    ,'VA')\n        and d_month_seq between (select distinct d_month_seq+1\n                                 from   date_dim where d_year = 1998 and d_moy = 11)\n                           and  (select distinct d_month_seq+3\n                                 from   date_dim where d_year = 1998 and d_moy = 11)\n group by c_customer_sk\n )\n , segments as\n (select cast((revenue/50) as int) as segment\n  from   my_revenue\n )\n  select  segment, count(*) as num_customers, segment*50 as segment_base\n from segments\n group by segment\n order by segment, num_customers\n limit 100;",
    "transforms": [
      "date_cte_isolate, early_filter"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.16,
    "sf5_original_ms": 19.04,
    "sf5_optimized_ms": 16.48
  },
  {
    "query": "query030_multi",
    "source": "ado_round_01",
    "original": "with customer_total_return as\n (select wr_returning_customer_sk as ctr_customer_sk\n ,ca_state as ctr_state\n,wr_reason_sk as ctr_reason_sk\n,sum(wr_return_amt) as ctr_total_return\n from web_returns\n     ,date_dim\n     ,customer_address\n     ,item\n where wr_returned_date_sk = d_date_sk\n   and d_year =1998\n   and wr_returning_addr_sk = ca_address_sk\n   and wr_item_sk = i_item_sk\n   and i_manager_id BETWEEN 17 and 26\n   and wr_return_amt / wr_return_quantity between 25 and 54\n group by wr_returning_customer_sk\n         ,ca_state, wr_reason_sk)\n  select  c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag\n       ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address\n       ,c_last_review_date_sk,ctr_total_return\n from customer_total_return ctr1\n     ,customer_address\n     ,customer\n where ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2\n \t\t\t  from customer_total_return ctr2\n                  \t  where ctr1.ctr_state = ctr2.ctr_state)\n       and ca_address_sk = c_current_addr_sk\n       and ca_state in ('IL', 'LA', 'MN', 'SC')\n       and ctr1.ctr_customer_sk = c_customer_sk\n       and ctr1.ctr_reason_sk in (50, 73)\n      and c_birth_year BETWEEN 1961 AND 1967\n order by c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag\n                  ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address\n                  ,c_last_review_date_sk,ctr_total_return\nlimit 100;",
    "optimized": "WITH date_cte AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998), filtered_web_returns AS (SELECT wr_returning_customer_sk, ca_state, wr_reason_sk, wr_return_amt FROM web_returns INNER JOIN date_cte ON wr_returned_date_sk = date_cte.d_date_sk INNER JOIN customer_address ON wr_returning_addr_sk = ca_address_sk INNER JOIN item ON wr_item_sk = i_item_sk WHERE i_manager_id BETWEEN 17 AND 26 AND wr_return_amt / wr_return_quantity BETWEEN 25 AND 54 AND ca_state IN ('IL', 'LA', 'MN', 'SC') AND wr_reason_sk IN (50, 73)), customer_total_return AS (SELECT wr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, wr_reason_sk AS ctr_reason_sk, SUM(wr_return_amt) AS ctr_total_return FROM filtered_web_returns GROUP BY wr_returning_customer_sk, ca_state, wr_reason_sk), state_avg AS (SELECT ctr_state, AVG(ctr_total_return) * 1.2 AS threshold FROM customer_total_return GROUP BY ctr_state) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date_sk, ctr_total_return FROM customer_total_return AS ctr1 INNER JOIN state_avg ON ctr1.ctr_state = state_avg.ctr_state INNER JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk INNER JOIN customer_address ON ca_address_sk = c_current_addr_sk WHERE ctr1.ctr_total_return > state_avg.threshold AND c_birth_year BETWEEN 1961 AND 1967 ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date_sk, ctr_total_return LIMIT 100",
    "transforms": [
      "semantic_rewrite"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.15,
    "sf5_original_ms": 591.18,
    "sf5_optimized_ms": 512.09
  },
  {
    "query": "query027_agg",
    "source": "ado_round_01",
    "original": "select  i_item_id,\n        s_state, grouping(s_state) g_state,\n        avg(ss_quantity) agg1,\n        avg(ss_list_price) agg2,\n        avg(ss_coupon_amt) agg3,\n        avg(ss_sales_price) agg4\nfrom store_sales, customer_demographics, date_dim, store, item\nwhere ss_sold_date_sk = d_date_sk and\n      ss_item_sk = i_item_sk and\n      ss_store_sk = s_store_sk and\n      ss_cdemo_sk = cd_demo_sk and\n      cd_gender = 'M' and\n      cd_marital_status = 'S' and\n      cd_education_status = 'Advanced Degree' and\n      d_year = 2002 and\n      s_state = 'VA' and\n     i_category  = 'Jewelry'\n group by rollup (i_item_id, s_state)\n order by i_item_id\n         ,s_state\n limit 100;",
    "optimized": "WITH filtered_date AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002), filtered_cd AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_gender = 'M' AND cd_marital_status = 'S' AND cd_education_status = 'Advanced Degree'), filtered_store AS (SELECT s_store_sk, s_state FROM store WHERE s_state = 'VA'), filtered_item AS (SELECT i_item_sk, i_item_id FROM item WHERE i_category = 'Jewelry') SELECT i.i_item_id, s.s_state, GROUPING(s.s_state) AS g_state, AVG(ss.ss_quantity) AS agg1, AVG(ss.ss_list_price) AS agg2, AVG(ss.ss_coupon_amt) AS agg3, AVG(ss.ss_sales_price) AS agg4 FROM store_sales AS ss JOIN filtered_date AS d ON ss.ss_sold_date_sk = d.d_date_sk JOIN filtered_cd AS cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN filtered_store AS s ON ss.ss_store_sk = s.s_store_sk JOIN filtered_item AS i ON ss.ss_item_sk = i.i_item_sk GROUP BY ROLLUP (i.i_item_id, s.s_state) ORDER BY i.i_item_id, s.s_state LIMIT 100",
    "transforms": [
      "early_filter"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.14,
    "sf5_original_ms": 17.67,
    "sf5_optimized_ms": 15.47
  },
  {
    "query": "query080_multi",
    "source": "ado_round_01",
    "original": "with ssr as\n (select  s_store_id as store_id,\n          sum(ss_ext_sales_price) as sales,\n          sum(coalesce(sr_return_amt, 0)) as returns,\n          sum(ss_net_profit - coalesce(sr_net_loss, 0)) as profit\n  from store_sales left outer join store_returns on\n         (ss_item_sk = sr_item_sk and ss_ticket_number = sr_ticket_number),\n     date_dim,\n     store,\n     item,\n     promotion\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('1998-08-23' as date)\n                  and cast('1998-08-23' as date) + interval '30 day'\n       and ss_store_sk = s_store_sk\n       and ss_item_sk = i_item_sk\n       and i_current_price > 50\n       and ss_promo_sk = p_promo_sk\n       and p_channel_email = 'Y'\n       and p_channel_tv = 'Y'\n       and p_channel_radio = 'N'\n       and p_channel_press = 'N'\n       and p_channel_event = 'Y'\n       and ss_wholesale_cost BETWEEN 63 AND 78\n       and i_category IN ('Jewelry', 'Music')\n group by s_store_id)\n ,\n csr as\n (select  cp_catalog_page_id as catalog_page_id,\n          sum(cs_ext_sales_price) as sales,\n          sum(coalesce(cr_return_amount, 0)) as returns,\n          sum(cs_net_profit - coalesce(cr_net_loss, 0)) as profit\n  from catalog_sales left outer join catalog_returns on\n         (cs_item_sk = cr_item_sk and cs_order_number = cr_order_number),\n     date_dim,\n     catalog_page,\n     item,\n     promotion\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('1998-08-23' as date)\n                  and cast('1998-08-23' as date) + interval '30 day'\n        and cs_catalog_page_sk = cp_catalog_page_sk\n       and cs_item_sk = i_item_sk\n       and i_current_price > 50\n       and cs_promo_sk = p_promo_sk\n       and p_channel_email = 'Y'\n       and p_channel_tv = 'Y'\n       and p_channel_radio = 'N'\n       and p_channel_press = 'N'\n       and p_channel_event = 'Y'\n       and cs_wholesale_cost BETWEEN 63 AND 78\n       and i_category IN ('Jewelry', 'Music')\ngroup by cp_catalog_page_id)\n ,\n wsr as\n (select  web_site_id,\n          sum(ws_ext_sales_price) as sales,\n          sum(coalesce(wr_return_amt, 0)) as returns,\n          sum(ws_net_profit - coalesce(wr_net_loss, 0)) as profit\n  from web_sales left outer join web_returns on\n         (ws_item_sk = wr_item_sk and ws_order_number = wr_order_number),\n     date_dim,\n     web_site,\n     item,\n     promotion\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('1998-08-23' as date)\n                  and cast('1998-08-23' as date) + interval '30 day'\n        and ws_web_site_sk = web_site_sk\n       and ws_item_sk = i_item_sk\n       and i_current_price > 50\n       and ws_promo_sk = p_promo_sk\n       and p_channel_email = 'Y'\n       and p_channel_tv = 'Y'\n       and p_channel_radio = 'N'\n       and p_channel_press = 'N'\n       and p_channel_event = 'Y'\n       and ws_wholesale_cost BETWEEN 63 AND 78\n       and i_category IN ('Jewelry', 'Music')\ngroup by web_site_id)\n  select  channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from\n (select 'store channel' as channel\n        , 'store' || store_id as id\n        , sales\n        , returns\n        , profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || catalog_page_id as id\n        , sales\n        , returns\n        , profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , profit\n from   wsr\n ) x\n group by rollup (channel, id)\n order by channel\n         ,id\n limit 100;",
    "optimized": "WITH ssr AS (WITH filtered_date AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1998-08-23' AS DATE) AND CAST('1998-08-23' AS DATE) + INTERVAL '30 DAY'), filtered_item AS (SELECT i_item_sk FROM item WHERE i_current_price > 50 AND i_category IN ('Jewelry', 'Music')), filtered_promotion AS (SELECT p_promo_sk FROM promotion WHERE p_channel_email = 'Y' AND p_channel_tv = 'Y' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'Y') SELECT s_store_id AS store_id, SUM(ss_ext_sales_price) AS sales, SUM(COALESCE(sr_return_amt, 0)) AS returns, SUM(ss_net_profit - COALESCE(sr_net_loss, 0)) AS profit FROM store_sales LEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number) INNER JOIN filtered_date ON ss_sold_date_sk = filtered_date.d_date_sk INNER JOIN store ON ss_store_sk = s_store_sk INNER JOIN filtered_item ON ss_item_sk = filtered_item.i_item_sk INNER JOIN filtered_promotion ON ss_promo_sk = filtered_promotion.p_promo_sk WHERE ss_wholesale_cost BETWEEN 63 AND 78 GROUP BY s_store_id), csr AS (SELECT cp_catalog_page_id AS catalog_page_id, SUM(cs_ext_sales_price) AS sales, SUM(COALESCE(cr_return_amount, 0)) AS returns, SUM(cs_net_profit - COALESCE(cr_net_loss, 0)) AS profit FROM catalog_sales LEFT OUTER JOIN catalog_returns ON (cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number), date_dim, catalog_page, item, promotion WHERE cs_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('1998-08-23' AS DATE) AND CAST('1998-08-23' AS DATE) + INTERVAL '30 DAY' AND cs_catalog_page_sk = cp_catalog_page_sk AND cs_item_sk = i_item_sk AND i_current_price > 50 AND cs_promo_sk = p_promo_sk AND p_channel_email = 'Y' AND p_channel_tv = 'Y' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'Y' AND cs_wholesale_cost BETWEEN 63 AND 78 AND i_category IN ('Jewelry', 'Music') GROUP BY cp_catalog_page_id), wsr AS (SELECT web_site_id, SUM(ws_ext_sales_price) AS sales, SUM(COALESCE(wr_return_amt, 0)) AS returns, SUM(ws_net_profit - COALESCE(wr_net_loss, 0)) AS profit FROM web_sales LEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number), date_dim, web_site, item, promotion WHERE ws_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('1998-08-23' AS DATE) AND CAST('1998-08-23' AS DATE) + INTERVAL '30 DAY' AND ws_web_site_sk = web_site_sk AND ws_item_sk = i_item_sk AND i_current_price > 50 AND ws_promo_sk = p_promo_sk AND p_channel_email = 'Y' AND p_channel_tv = 'Y' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'Y' AND ws_wholesale_cost BETWEEN 63 AND 78 AND i_category IN ('Jewelry', 'Music') GROUP BY web_site_id)\nSELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, returns, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, returns, profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, returns, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100",
    "transforms": [
      "date_cte_isolate"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.12,
    "sf5_original_ms": 51.35,
    "sf5_optimized_ms": 45.91
  },
  {
    "query": "query058_multi",
    "source": "ado_round_01",
    "original": "with ss_items as\n (select i_item_id item_id\n       ,c_birth_year birth_year\n        ,sum(ss_ext_sales_price) ss_item_rev\n from store_sales\n     ,item\n     ,date_dim\n     ,customer\n where ss_item_sk = i_item_sk\n   and d_date in (select d_date\n                  from date_dim\n                  where d_month_seq = (select d_month_seq\n                                      from date_dim\n                                      where d_date = '1999-05-02'))\n   and ss_sold_date_sk   = d_date_sk\n   and ss_list_price between 217 and 246\n   and i_manager_id BETWEEN 25 and 54\n   and ss_customer_sk = c_customer_sk\n   and c_birth_year BETWEEN 1961 AND 1967\ngroup by i_item_id, c_birth_year),\n cs_items as\n (select i_item_id item_id\n        ,c_birth_year birth_year\n        ,sum(cs_ext_sales_price) cs_item_rev\n  from catalog_sales\n      ,item\n      ,date_dim\n      ,customer\n where cs_item_sk = i_item_sk\n  and  d_date in (select d_date\n                  from date_dim\n                  where d_month_seq = (select d_month_seq\n                                      from date_dim\n                                      where d_date = '1999-05-02'))\n  and  cs_sold_date_sk = d_date_sk\n  and  cs_list_price between 217 and 246\n  and i_manager_id BETWEEN 25 and 54\n  and cs_bill_customer_sk = c_customer_sk\n  and c_birth_year BETWEEN 1961 AND 1967\ngroup by i_item_id, c_birth_year),\n ws_items as\n (select i_item_id item_id\n      ,c_birth_year birth_year\n        ,sum(ws_ext_sales_price) ws_item_rev\n  from web_sales\n      ,item\n      ,date_dim\n      ,customer\n where ws_item_sk = i_item_sk\n  and  d_date in (select d_date\n                  from date_dim\n                  where d_month_seq = (select d_month_seq\n                                     from date_dim\n                                     where d_date = '1999-05-02'))\n  and ws_sold_date_sk   = d_date_sk\n  and ws_list_price between 217 and 246\n  and i_manager_id BETWEEN 25 and 54\n  and ws_bill_customer_sk = c_customer_sk\n  and c_birth_year BETWEEN 1961 AND 1967\ngroup by i_item_id, c_birth_year)\n  select  ss_items.item_id, ss_items.birth_year\n       ,ss_item_rev\n       ,ss_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 ss_dev\n       ,cs_item_rev\n       ,cs_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 cs_dev\n       ,ws_item_rev\n       ,ws_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 ws_dev\n       ,(ss_item_rev+cs_item_rev+ws_item_rev)/3 average\n from ss_items,cs_items,ws_items\n where ss_items.item_id=cs_items.item_id\n   and ss_items.item_id=ws_items.item_id\n   and ss_items.birth_year = cs_items.birth_year\n   and ss_items.birth_year = ws_items.birth_year\n   and ss_item_rev between 0.9 * cs_item_rev and 1.1 * cs_item_rev\n   and ss_item_rev between 0.9 * ws_item_rev and 1.1 * ws_item_rev\n   and cs_item_rev between 0.9 * ss_item_rev and 1.1 * ss_item_rev\n   and cs_item_rev between 0.9 * ws_item_rev and 1.1 * ws_item_rev\n   and ws_item_rev between 0.9 * ss_item_rev and 1.1 * ss_item_rev\n   and ws_item_rev between 0.9 * cs_item_rev and 1.1 * cs_item_rev\n order by item_id, birth_year\n         ,ss_item_rev\n limit 100;",
    "optimized": "WITH date_filter AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '1999-05-02')), ss_items AS (SELECT i_item_id AS item_id, c_birth_year AS birth_year, SUM(ss_ext_sales_price) AS ss_item_rev FROM store_sales JOIN item ON ss_item_sk = i_item_sk JOIN date_filter ON ss_sold_date_sk = d_date_sk JOIN customer ON ss_customer_sk = c_customer_sk WHERE ss_list_price BETWEEN 217 AND 246 AND i_manager_id BETWEEN 25 AND 54 AND c_birth_year BETWEEN 1961 AND 1967 GROUP BY i_item_id, c_birth_year), cs_items AS (SELECT i_item_id AS item_id, c_birth_year AS birth_year, SUM(cs_ext_sales_price) AS cs_item_rev FROM catalog_sales JOIN item ON cs_item_sk = i_item_sk JOIN date_filter ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk WHERE cs_list_price BETWEEN 217 AND 246 AND i_manager_id BETWEEN 25 AND 54 AND c_birth_year BETWEEN 1961 AND 1967 GROUP BY i_item_id, c_birth_year), ws_items AS (SELECT i_item_id AS item_id, c_birth_year AS birth_year, SUM(ws_ext_sales_price) AS ws_item_rev FROM web_sales, item, date_dim, customer WHERE ws_item_sk = i_item_sk AND d_date IN (SELECT d_date FROM date_dim WHERE d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '1999-05-02')) AND ws_sold_date_sk = d_date_sk AND ws_list_price BETWEEN 217 AND 246 AND i_manager_id BETWEEN 25 AND 54 AND ws_bill_customer_sk = c_customer_sk AND c_birth_year BETWEEN 1961 AND 1967 GROUP BY i_item_id, c_birth_year)\nSELECT ss_items.item_id, ss_items.birth_year, ss_item_rev, ss_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ss_dev, cs_item_rev, cs_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS cs_dev, ws_item_rev, ws_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ws_dev, (ss_item_rev + cs_item_rev + ws_item_rev) / 3 AS average FROM ss_items, cs_items, ws_items WHERE ss_items.item_id = cs_items.item_id AND ss_items.item_id = ws_items.item_id AND ss_items.birth_year = cs_items.birth_year AND ss_items.birth_year = ws_items.birth_year AND ss_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev AND ss_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND cs_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND cs_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND ws_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND ws_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev ORDER BY item_id, birth_year, ss_item_rev LIMIT 100",
    "transforms": [
      "date_cte_isolate",
      "materialize_cte"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.11,
    "sf5_original_ms": 81.37,
    "sf5_optimized_ms": 73.35
  },
  {
    "query": "query072_spj_spj",
    "source": "ado_round_01",
    "original": "select min(i_item_sk)\n      ,min(w_warehouse_name)\n      ,min(d1.d_week_seq)\n      ,min(cs_item_sk)\n      ,min(cs_order_number)\n      ,min(inv_item_sk)\nfrom catalog_sales\njoin inventory on (cs_item_sk = inv_item_sk)\njoin warehouse on (w_warehouse_sk=inv_warehouse_sk)\njoin item on (i_item_sk = cs_item_sk)\njoin customer_demographics on (cs_bill_cdemo_sk = cd_demo_sk)\njoin household_demographics on (cs_bill_hdemo_sk = hd_demo_sk)\njoin date_dim d1 on (cs_sold_date_sk = d1.d_date_sk)\njoin date_dim d2 on (inv_date_sk = d2.d_date_sk)\njoin date_dim d3 on (cs_ship_date_sk = d3.d_date_sk)\nleft outer join promotion on (cs_promo_sk=p_promo_sk)\nleft outer join catalog_returns on (cr_item_sk = cs_item_sk and cr_order_number = cs_order_number)\nwhere d1.d_week_seq = d2.d_week_seq\n  and inv_quantity_on_hand < cs_quantity\n  and d3.d_date > d1.d_date + interval '3 day'\n  and hd_buy_potential = '501-1000'\n  and d1.d_year = 1998\n  and cd_marital_status = 'M'\n  and cd_dep_count between 9 and 11\n  and i_category IN ('Home', 'Men', 'Music')\n  and cs_wholesale_cost BETWEEN 34 AND 54\n ;",
    "optimized": "WITH filtered_date_dim AS (SELECT d_date_sk, d_week_seq, d_date FROM date_dim WHERE d_year = 1998), filtered_item AS (SELECT i_item_sk FROM item WHERE i_category IN ('Home', 'Men', 'Music')), filtered_customer_demographics AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_marital_status = 'M' AND cd_dep_count BETWEEN 9 AND 11), filtered_household_demographics AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential = '501-1000') SELECT MIN(i_item_sk), MIN(w_warehouse_name), MIN(d1.d_week_seq), MIN(cs_item_sk), MIN(cs_order_number), MIN(inv_item_sk) FROM catalog_sales JOIN filtered_item AS item ON (i_item_sk = cs_item_sk) JOIN filtered_customer_demographics AS cd ON (cs_bill_cdemo_sk = cd_demo_sk) JOIN filtered_household_demographics AS hd ON (cs_bill_hdemo_sk = hd_demo_sk) JOIN filtered_date_dim AS d1 ON (cs_sold_date_sk = d1.d_date_sk) JOIN inventory ON (cs_item_sk = inv_item_sk) JOIN warehouse ON (w_warehouse_sk = inv_warehouse_sk) JOIN date_dim AS d2 ON (inv_date_sk = d2.d_date_sk) JOIN date_dim AS d3 ON (cs_ship_date_sk = d3.d_date_sk) LEFT OUTER JOIN promotion ON (cs_promo_sk = p_promo_sk) LEFT OUTER JOIN catalog_returns ON (cr_item_sk = cs_item_sk AND cr_order_number = cs_order_number) WHERE d1.d_week_seq = d2.d_week_seq AND inv_quantity_on_hand < cs_quantity AND d3.d_date > d1.d_date + INTERVAL '3 DAY' AND cs_wholesale_cost BETWEEN 34 AND 54",
    "transforms": [
      "date_cte_isolate"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.1,
    "sf5_original_ms": 1874.47,
    "sf5_optimized_ms": 1704.59
  },
  {
    "query": "query102_spj_spj",
    "source": "ado_round_01",
    "original": "select min(ss_item_sk),\n    min(ss_ticket_number),\n    min(ws_order_number),\n    min(c_customer_sk),\n    min(cd_demo_sk),\n    min(hd_demo_sk)\nfrom\n    store_sales,\n    web_sales,\n    date_dim d1,\n    date_dim d2,\n    customer,\n    inventory,\n    store,\n    warehouse,\n    item,\n    customer_demographics,\n    household_demographics,\n    customer_address\nwhere\n    ss_item_sk = i_item_sk\n    and ws_item_sk = ss_item_sk\n    and ss_sold_date_sk = d1.d_date_sk\n    and ws_sold_date_sk = d2.d_date_sk\n    and d2.d_date between d1.d_date and (d1.d_date + interval '30 day')\n    and ss_customer_sk = c_customer_sk\n    and ws_bill_customer_sk = c_customer_sk\n    and ws_warehouse_sk = inv_warehouse_sk\n    and ws_warehouse_sk = w_warehouse_sk\n    and inv_item_sk = ss_item_sk\n    and inv_date_sk = ss_sold_date_sk\n    and inv_quantity_on_hand >= ss_quantity\n    and s_state = w_state\n    AND i_category IN ('Home', 'Men', 'Music')\n    and i_manager_id IN (1, 2, 4, 11, 12, 14, 21, 29, 32, 52)\n    and c_current_cdemo_sk = cd_demo_sk\n    and c_current_hdemo_sk = hd_demo_sk\n    and c_current_addr_sk = ca_address_sk\n    and ca_state in ('GA', 'MD', 'MO', 'NC', 'OR')\n    and d1.d_year = 2002\n    and ws_wholesale_cost BETWEEN 34 AND 54\n    ;",
    "optimized": "select min(ss_item_sk),\n    min(ss_ticket_number),\n    min(ws_order_number),\n    min(c_customer_sk),\n    min(cd_demo_sk),\n    min(hd_demo_sk)\nfrom\n    store_sales,\n    web_sales,\n    date_dim d1,\n    date_dim d2,\n    customer,\n    inventory,\n    store,\n    warehouse,\n    item,\n    customer_demographics,\n    household_demographics,\n    customer_address\nwhere\n    ss_item_sk = i_item_sk\n    and ws_item_sk = ss_item_sk\n    and ss_sold_date_sk = d1.d_date_sk\n    and ws_sold_date_sk = d2.d_date_sk\n    and d2.d_date between d1.d_date and (d1.d_date + interval '30 day')\n    and ss_customer_sk = c_customer_sk\n    and ws_bill_customer_sk = c_customer_sk\n    and ws_warehouse_sk = inv_warehouse_sk\n    and ws_warehouse_sk = w_warehouse_sk\n    and inv_item_sk = ss_item_sk\n    and inv_date_sk = ss_sold_date_sk\n    and inv_quantity_on_hand >= ss_quantity\n    and s_state = w_state\n    AND i_category IN ('Home', 'Men', 'Music')\n    and i_manager_id IN (1, 2, 4, 11, 12, 14, 21, 29, 32, 52)\n    and c_current_cdemo_sk = cd_demo_sk\n    and c_current_hdemo_sk = hd_demo_sk\n    and c_current_addr_sk = ca_address_sk\n    and ca_state in ('GA', 'MD', 'MO', 'NC', 'OR')\n    and d1.d_year = 2002\n    and ws_wholesale_cost BETWEEN 34 AND 54\n    ;",
    "transforms": [
      "date_cte_isolate, early_filter, reorder_join"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.1,
    "sf5_original_ms": 6008.73,
    "sf5_optimized_ms": 5470.91
  },
  {
    "query": "query025_spj_spj",
    "source": "ado_round_01",
    "original": "select\n min(i_item_id)\n ,min(i_item_desc)\n ,min(s_store_id)\n ,min(s_store_name)\n ,min(ss_net_profit)\n ,min(sr_net_loss)\n ,min(cs_net_profit)\n ,min(ss_item_sk)\n ,min(sr_ticket_number)\n ,min(cs_order_number)\n from\n store_sales\n ,store_returns\n ,catalog_sales\n ,date_dim d1\n ,date_dim d2\n ,date_dim d3\n ,store\n ,item\n where\n d1.d_moy = 6\n and d1.d_year = 2002\n and d1.d_date_sk = ss_sold_date_sk\n and i_item_sk = ss_item_sk\n and s_store_sk = ss_store_sk\n and ss_customer_sk = sr_customer_sk\n and ss_item_sk = sr_item_sk\n and ss_ticket_number = sr_ticket_number\n and sr_returned_date_sk = d2.d_date_sk\n and d2.d_moy               between 6 and  6 + 2\n and d2.d_year              = 2002\n and sr_customer_sk = cs_bill_customer_sk\n and sr_item_sk = cs_item_sk\n and cs_sold_date_sk = d3.d_date_sk\n and d3.d_moy               between 6 and  6 + 2\n and d3.d_year              = 2002\n ;",
    "optimized": "WITH d1_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_moy = 6 AND d_year = 2002), d2_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 6 AND 8 AND d_year = 2002), d3_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 6 AND 8 AND d_year = 2002) SELECT MIN(i_item_id), MIN(i_item_desc), MIN(s_store_id), MIN(s_store_name), MIN(ss_net_profit), MIN(sr_net_loss), MIN(cs_net_profit), MIN(ss_item_sk), MIN(sr_ticket_number), MIN(cs_order_number) FROM store_sales JOIN d1_filtered ON store_sales.ss_sold_date_sk = d1_filtered.d_date_sk JOIN store ON s_store_sk = ss_store_sk JOIN item ON i_item_sk = ss_item_sk JOIN store_returns ON ss_customer_sk = sr_customer_sk AND ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number JOIN d2_filtered ON store_returns.sr_returned_date_sk = d2_filtered.d_date_sk JOIN catalog_sales ON sr_customer_sk = cs_bill_customer_sk AND sr_item_sk = cs_item_sk JOIN d3_filtered ON catalog_sales.cs_sold_date_sk = d3_filtered.d_date_sk",
    "transforms": [
      "date_cte_isolate"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.09,
    "sf5_original_ms": 1411.77,
    "sf5_optimized_ms": 1289.8
  },
  {
    "query": "query084_agg",
    "source": "ado_round_01",
    "original": "select  c_customer_id as customer_id\n       , coalesce(c_last_name,'') || ', ' || coalesce(c_first_name,'') as customername\n from customer\n     ,customer_address\n     ,customer_demographics\n     ,household_demographics\n     ,income_band\n     ,store_returns\n where ca_city\t        =  'Lakeview'\n   and c_current_addr_sk = ca_address_sk\n   and ib_lower_bound   >=  69452\n   and ib_upper_bound   <=  69452 + 50000\n   and ib_income_band_sk = hd_income_band_sk\n   and cd_demo_sk = c_current_cdemo_sk\n   and hd_demo_sk = c_current_hdemo_sk\n   and sr_cdemo_sk = cd_demo_sk\n order by c_customer_id\n limit 100;",
    "optimized": "WITH filtered_address AS (SELECT ca_address_sk FROM customer_address WHERE ca_city = 'Lakeview'), filtered_income_band AS (SELECT ib_income_band_sk FROM income_band WHERE ib_lower_bound >= 69452 AND ib_upper_bound <= 69452 + 50000) SELECT c_customer_id AS customer_id, COALESCE(c_last_name, '') || ', ' || COALESCE(c_first_name, '') AS customername FROM customer JOIN filtered_address ON c_current_addr_sk = ca_address_sk JOIN customer_demographics ON cd_demo_sk = c_current_cdemo_sk JOIN household_demographics ON hd_demo_sk = c_current_hdemo_sk JOIN filtered_income_band ON ib_income_band_sk = hd_income_band_sk JOIN store_returns ON sr_cdemo_sk = cd_demo_sk ORDER BY c_customer_id LIMIT 100",
    "transforms": [
      "early_filter",
      "reorder_join"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.09,
    "sf5_original_ms": 318.72,
    "sf5_optimized_ms": 293.54
  },
  {
    "query": "query099_spj_spj",
    "source": "ado_round_01",
    "original": "select min(w_warehouse_name)\n  ,min(sm_type)\n  ,min(cc_name)\n  ,min(cs_order_number)\n  ,min(cs_item_sk)\nfrom\n   catalog_sales\n  ,warehouse\n  ,ship_mode\n  ,call_center\n  ,date_dim\nwhere\n    d_month_seq between 1193 and 1193 + 23\nand cs_ship_date_sk   = d_date_sk\nand cs_warehouse_sk   = w_warehouse_sk\nand cs_ship_mode_sk   = sm_ship_mode_sk\nand cs_call_center_sk = cc_call_center_sk\nand cs_list_price between 271 and 300\nand sm_type = 'REGULAR'\nand cc_class = 'small'\nand w_gmt_offset = -5\n;",
    "optimized": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1193 AND 1193 + 23), filtered_catalog AS (SELECT cs_ship_date_sk, cs_warehouse_sk, cs_ship_mode_sk, cs_call_center_sk, cs_order_number, cs_item_sk FROM catalog_sales WHERE cs_list_price BETWEEN 271 AND 300) SELECT MIN(w.w_warehouse_name), MIN(sm.sm_type), MIN(cc.cc_name), MIN(cs.cs_order_number), MIN(cs.cs_item_sk) FROM filtered_catalog AS cs JOIN filtered_dates AS d ON cs.cs_ship_date_sk = d.d_date_sk JOIN warehouse AS w ON cs.cs_warehouse_sk = w.w_warehouse_sk AND w.w_gmt_offset = -5 JOIN ship_mode AS sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk AND sm.sm_type = 'REGULAR' JOIN call_center AS cc ON cs.cs_call_center_sk = cc.cc_call_center_sk AND cc.cc_class = 'small'",
    "transforms": [
      "date_cte_isolate"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.08,
    "sf5_original_ms": 25.97,
    "sf5_optimized_ms": 24.07
  },
  {
    "query": "query084_spj_spj",
    "source": "ado_round_01",
    "original": "select min(c_customer_id),\n    min(sr_ticket_number),\n    min(sr_item_sk)\n from customer\n     ,customer_address\n     ,customer_demographics\n     ,household_demographics\n     ,income_band\n     ,store_returns\n where ca_city\t        =  'Lakeview'\n   and c_current_addr_sk = ca_address_sk\n   and ib_lower_bound   >=  7 * 10000\n   and ib_upper_bound   <=  7 * 10000 + 50000\n   and ib_income_band_sk = hd_income_band_sk\n   and cd_demo_sk = c_current_cdemo_sk\n   and hd_demo_sk = c_current_hdemo_sk\n   and sr_cdemo_sk = cd_demo_sk\n ;",
    "optimized": "WITH filtered_customer_address AS (SELECT ca_address_sk FROM customer_address WHERE ca_city = 'Lakeview'), filtered_income_band AS (SELECT ib_income_band_sk FROM income_band WHERE ib_lower_bound >= 7 * 10000 AND ib_upper_bound <= 7 * 10000 + 50000) SELECT MIN(c_customer_id), MIN(sr_ticket_number), MIN(sr_item_sk) FROM customer JOIN filtered_customer_address ON c_current_addr_sk = ca_address_sk JOIN customer_demographics ON cd_demo_sk = c_current_cdemo_sk JOIN household_demographics ON hd_demo_sk = c_current_hdemo_sk JOIN filtered_income_band ON ib_income_band_sk = hd_income_band_sk JOIN store_returns ON sr_cdemo_sk = cd_demo_sk",
    "transforms": [
      "early_filter"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.04,
    "sf5_original_ms": 273.85,
    "sf5_optimized_ms": 264.32
  },
  {
    "query": "query094_multi",
    "source": "ado_round_01",
    "original": "select \n   count(distinct ws_order_number) as \"order count\"\n  ,sum(ws_ext_ship_cost) as \"total shipping cost\"\n  ,sum(ws_net_profit) as \"total net profit\"\nfrom\n   web_sales ws1\n  ,date_dim\n  ,customer_address\n  ,web_site\nwhere\n    d_date between '2002-10-01' and\n           cast('2002-10-01' as date) + interval '60 day'\nand ws1.ws_ship_date_sk = d_date_sk\nand ws1.ws_ship_addr_sk = ca_address_sk\nand ca_state in ('IL','KS','LA'\n            ,'MN' ,'MT' ,'SC')\nand ws1.ws_web_site_sk = web_site_sk\nand web_gmt_offset >= -5\nand ws1.ws_list_price between 184 and 213\nand exists (select *\n            from web_sales ws2\n            where ws1.ws_order_number = ws2.ws_order_number\n              and ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk)\nand not exists(select *\n               from web_returns wr1\n               where ws1.ws_order_number = wr1.wr_order_number\n               and wr1.wr_reason_sk in (17, 48, 50, 56, 68)\n               )\norder by count(distinct ws_order_number)\nlimit 100;",
    "optimized": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2002-10-01' AND CAST('2002-10-01' AS DATE) + INTERVAL '60 DAY'), filtered_addresses AS (SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('IL', 'KS', 'LA', 'MN', 'MT', 'SC')), filtered_sites AS (SELECT web_site_sk FROM web_site WHERE web_gmt_offset >= -5)\nSELECT COUNT(DISTINCT ws_order_number) AS \"order count\", SUM(ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws_net_profit) AS \"total net profit\" FROM web_sales AS ws1, date_dim, customer_address, web_site WHERE d_date BETWEEN '2002-10-01' AND CAST('2002-10-01' AS DATE) + INTERVAL '60 DAY' AND ws1.ws_ship_date_sk = d_date_sk AND ws1.ws_ship_addr_sk = ca_address_sk AND ca_state IN ('IL', 'KS', 'LA', 'MN', 'MT', 'SC') AND ws1.ws_web_site_sk = web_site_sk AND web_gmt_offset >= -5 AND ws1.ws_list_price BETWEEN 184 AND 213 AND EXISTS(SELECT * FROM web_sales AS ws2 WHERE ws1.ws_order_number = ws2.ws_order_number AND ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk) AND NOT EXISTS(SELECT * FROM web_returns AS wr1 WHERE ws1.ws_order_number = wr1.wr_order_number AND wr1.wr_reason_sk IN (17, 48, 50, 56, 68)) ORDER BY COUNT(DISTINCT ws_order_number) LIMIT 100",
    "transforms": [
      "date_cte_isolate",
      "decorrelate"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.04,
    "sf5_original_ms": 570.05,
    "sf5_optimized_ms": 547.69
  },
  {
    "query": "query018_agg",
    "source": "ado_round_01",
    "original": "select  i_item_id,\n        ca_country,\n        ca_state,\n        ca_county,\n        avg( cast(cs_quantity as decimal(12,2))) agg1,\n        avg( cast(cs_list_price as decimal(12,2))) agg2,\n        avg( cast(cs_coupon_amt as decimal(12,2))) agg3,\n        avg( cast(cs_sales_price as decimal(12,2))) agg4,\n        avg( cast(cs_net_profit as decimal(12,2))) agg5,\n        avg( cast(c_birth_year as decimal(12,2))) agg6\nfrom catalog_sales, customer_demographics, customer, customer_address, date_dim, item\nwhere cs_sold_date_sk = d_date_sk and\n      cs_item_sk = i_item_sk and\n      cs_bill_cdemo_sk = cd_demo_sk and\n      cs_bill_customer_sk = c_customer_sk and\n      cd_gender = 'F' and\n      cd_education_status = 'College' and\n      c_current_addr_sk = ca_address_sk and\n      d_year = 1998 and\n      c_birth_month = 1 and\n      ca_state in ('GA', 'LA', 'SD')\n      and cs_wholesale_cost BETWEEN 52 AND 57\n      AND i_category = 'Jewelry'\n group by rollup (i_item_id, ca_country, ca_state, ca_county)\n order by ca_country,\n        ca_state,\n        ca_county,\n\ti_item_id\n limit 100;",
    "optimized": "WITH date_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998), cd_filtered AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_gender = 'F' AND cd_education_status = 'College'), c_filtered AS (SELECT c_customer_sk, c_current_addr_sk, c_birth_year FROM customer WHERE c_birth_month = 1), ca_filtered AS (SELECT ca_address_sk, ca_country, ca_state, ca_county FROM customer_address WHERE ca_state IN ('GA', 'LA', 'SD')), item_filtered AS (SELECT i_item_sk, i_item_id FROM item WHERE i_category = 'Jewelry') SELECT i_item_id, ca_country, ca_state, ca_county, AVG(CAST(cs_quantity AS DECIMAL(12, 2))) AS agg1, AVG(CAST(cs_list_price AS DECIMAL(12, 2))) AS agg2, AVG(CAST(cs_coupon_amt AS DECIMAL(12, 2))) AS agg3, AVG(CAST(cs_sales_price AS DECIMAL(12, 2))) AS agg4, AVG(CAST(cs_net_profit AS DECIMAL(12, 2))) AS agg5, AVG(CAST(c_birth_year AS DECIMAL(12, 2))) AS agg6 FROM catalog_sales AS cs JOIN date_filtered AS d ON cs.cs_sold_date_sk = d.d_date_sk JOIN cd_filtered AS cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN c_filtered AS c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN ca_filtered AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN item_filtered AS i ON cs.cs_item_sk = i.i_item_sk WHERE cs.cs_wholesale_cost BETWEEN 52 AND 57 GROUP BY ROLLUP (i_item_id, ca_country, ca_state, ca_county) ORDER BY ca_country, ca_state, ca_county, i_item_id LIMIT 100",
    "transforms": [
      "date_cte_isolate"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.02,
    "sf5_original_ms": 1793.98,
    "sf5_optimized_ms": 1765.33
  },
  {
    "query": "query019_spj_spj",
    "source": "ado_round_01",
    "original": "select min(i_brand_id), min(i_manufact_id),\n \tmin(ss_ext_sales_price)\n from date_dim, store_sales, item,customer,customer_address,store\n where d_date_sk = ss_sold_date_sk\n   and ss_item_sk = i_item_sk\n   and ss_customer_sk = c_customer_sk\n   and c_current_addr_sk = ca_address_sk\n   and ss_store_sk = s_store_sk\n   AND i_category  = 'Home'\n   and d_year=2002\n   and d_moy = 12\n   and substring(ca_zip,1,5) <> substring(s_zip,1,5)\n   and ca_state  = 'TX'\n   and c_birth_month = 1\n   and ss_wholesale_cost BETWEEN 34 AND 54\n ;",
    "optimized": "select min(i_brand_id), min(i_manufact_id),\n \tmin(ss_ext_sales_price)\n from date_dim, store_sales, item,customer,customer_address,store\n where d_date_sk = ss_sold_date_sk\n   and ss_item_sk = i_item_sk\n   and ss_customer_sk = c_customer_sk\n   and c_current_addr_sk = ca_address_sk\n   and ss_store_sk = s_store_sk\n   AND i_category  = 'Home'\n   and d_year=2002\n   and d_moy = 12\n   and substring(ca_zip,1,5) <> substring(s_zip,1,5)\n   and ca_state  = 'TX'\n   and c_birth_month = 1\n   and ss_wholesale_cost BETWEEN 34 AND 54\n ;",
    "transforms": [
      "date_cte_isolate, early_filter, reorder_join"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.02,
    "sf5_original_ms": 73.91,
    "sf5_optimized_ms": 72.7
  },
  {
    "query": "query059_multi",
    "source": "ado_round_01",
    "original": "with wss as\n (select d_week_seq,\n        ss_store_sk,\n        sum(case when (d_day_name='Sunday') then ss_sales_price else null end) sun_sales,\n        sum(case when (d_day_name='Monday') then ss_sales_price else null end) mon_sales,\n        sum(case when (d_day_name='Tuesday') then ss_sales_price else  null end) tue_sales,\n        sum(case when (d_day_name='Wednesday') then ss_sales_price else null end) wed_sales,\n        sum(case when (d_day_name='Thursday') then ss_sales_price else null end) thu_sales,\n        sum(case when (d_day_name='Friday') then ss_sales_price else null end) fri_sales,\n        sum(case when (d_day_name='Saturday') then ss_sales_price else null end) sat_sales\n from store_sales,date_dim\n where d_date_sk = ss_sold_date_sk\n and ss_sales_price / ss_list_price BETWEEN 11 * 0.01 AND 31 * 0.01\n group by d_week_seq,ss_store_sk\n )\n  select  s_store_name1,s_store_id1,d_week_seq1\n       ,sun_sales1/sun_sales2,mon_sales1/mon_sales2\n       ,tue_sales1/tue_sales2,wed_sales1/wed_sales2,thu_sales1/thu_sales2\n       ,fri_sales1/fri_sales2,sat_sales1/sat_sales2\n from\n (select s_store_name s_store_name1,wss.d_week_seq d_week_seq1\n        ,s_store_id s_store_id1,sun_sales sun_sales1\n        ,mon_sales mon_sales1,tue_sales tue_sales1\n        ,wed_sales wed_sales1,thu_sales thu_sales1\n        ,fri_sales fri_sales1,sat_sales sat_sales1\n  from wss,store,date_dim d\n  where d.d_week_seq = wss.d_week_seq and\n        ss_store_sk = s_store_sk and\n        d_month_seq between 1208 and 1208 + 11\n        and s_state in ('GA','IA','LA'\n                    ,'MO','SD','TN','TX','VA')\n        ) y,\n (select s_store_name s_store_name2,wss.d_week_seq d_week_seq2\n        ,s_store_id s_store_id2,sun_sales sun_sales2\n        ,mon_sales mon_sales2,tue_sales tue_sales2\n        ,wed_sales wed_sales2,thu_sales thu_sales2\n        ,fri_sales fri_sales2,sat_sales sat_sales2\n  from wss,store,date_dim d\n  where d.d_week_seq = wss.d_week_seq and\n        ss_store_sk = s_store_sk and\n        d_month_seq between 1208+ 12 and 1208 + 23\n        and s_state in ('GA','IA','LA'\n                    ,'MO','SD','TN','TX','VA')) x\n where s_store_id1=s_store_id2\n   and d_week_seq1=d_week_seq2-52\n order by s_store_name1,s_store_id1,d_week_seq1\nlimit 100;",
    "optimized": "with wss as\n (select d_week_seq,\n        ss_store_sk,\n        sum(case when (d_day_name='Sunday') then ss_sales_price else null end) sun_sales,\n        sum(case when (d_day_name='Monday') then ss_sales_price else null end) mon_sales,\n        sum(case when (d_day_name='Tuesday') then ss_sales_price else  null end) tue_sales,\n        sum(case when (d_day_name='Wednesday') then ss_sales_price else null end) wed_sales,\n        sum(case when (d_day_name='Thursday') then ss_sales_price else null end) thu_sales,\n        sum(case when (d_day_name='Friday') then ss_sales_price else null end) fri_sales,\n        sum(case when (d_day_name='Saturday') then ss_sales_price else null end) sat_sales\n from store_sales,date_dim\n where d_date_sk = ss_sold_date_sk\n and ss_sales_price / ss_list_price BETWEEN 11 * 0.01 AND 31 * 0.01\n group by d_week_seq,ss_store_sk\n )\n  select  s_store_name1,s_store_id1,d_week_seq1\n       ,sun_sales1/sun_sales2,mon_sales1/mon_sales2\n       ,tue_sales1/tue_sales2,wed_sales1/wed_sales2,thu_sales1/thu_sales2\n       ,fri_sales1/fri_sales2,sat_sales1/sat_sales2\n from\n (select s_store_name s_store_name1,wss.d_week_seq d_week_seq1\n        ,s_store_id s_store_id1,sun_sales sun_sales1\n        ,mon_sales mon_sales1,tue_sales tue_sales1\n        ,wed_sales wed_sales1,thu_sales thu_sales1\n        ,fri_sales fri_sales1,sat_sales sat_sales1\n  from wss,store,date_dim d\n  where d.d_week_seq = wss.d_week_seq and\n        ss_store_sk = s_store_sk and\n        d_month_seq between 1208 and 1208 + 11\n        and s_state in ('GA','IA','LA'\n                    ,'MO','SD','TN','TX','VA')\n        ) y,\n (select s_store_name s_store_name2,wss.d_week_seq d_week_seq2\n        ,s_store_id s_store_id2,sun_sales sun_sales2\n        ,mon_sales mon_sales2,tue_sales tue_sales2\n        ,wed_sales wed_sales2,thu_sales thu_sales2\n        ,fri_sales fri_sales2,sat_sales sat_sales2\n  from wss,store,date_dim d\n  where d.d_week_seq = wss.d_week_seq and\n        ss_store_sk = s_store_sk and\n        d_month_seq between 1208+ 12 and 1208 + 23\n        and s_state in ('GA','IA','LA'\n                    ,'MO','SD','TN','TX','VA')) x\n where s_store_id1=s_store_id2\n   and d_week_seq1=d_week_seq2-52\n order by s_store_name1,s_store_id1,d_week_seq1\nlimit 100;",
    "transforms": [
      "date_cte_isolate, pushdown",
      "pushdown, reorder_join"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.02,
    "sf5_original_ms": 12924.81,
    "sf5_optimized_ms": 12681.24
  },
  {
    "query": "query101_spj_spj",
    "source": "ado_round_01",
    "original": "select min(c_customer_sk), min(ss_item_sk), min(sr_ticket_number), min(ws_order_number)\nFROM\nstore_sales,\nstore_returns,\nweb_sales,\ndate_dim d1,\ndate_dim d2,\nitem,\ncustomer,\ncustomer_address,\nhousehold_demographics\nWHERE\nss_ticket_number = sr_ticket_number\nAND ss_customer_sk = ws_bill_customer_sk\nAND ss_customer_sk = c_customer_sk\nAND c_current_addr_sk = ca_address_sk\nAND c_current_hdemo_sk = hd_demo_sk\nAND ss_item_sk = sr_item_sk\nAND sr_item_sk = ws_item_sk\nAND i_item_sk = ss_item_sk\nAND i_category IN ('Children', 'Electronics', 'Women')\nAND sr_returned_date_sk = d1.d_date_sk\nAND ws_sold_date_sk = d2.d_date_sk\nAND d2.d_date between d1.d_date AND (d1.d_date + interval '90 day')\nAND ca_state in ('GA', 'IA', 'LA', 'MO', 'SD')\nAND d1.d_year = 2000\nAND hd_income_band_sk BETWEEN 12 AND 18\nAND hd_buy_potential = '0-500'\nAND ss_sales_price / ss_list_price BETWEEN 34 * 0.01 AND 54 * 0.01\n;",
    "optimized": "select min(c_customer_sk), min(ss_item_sk), min(sr_ticket_number), min(ws_order_number)\nFROM\nstore_sales,\nstore_returns,\nweb_sales,\ndate_dim d1,\ndate_dim d2,\nitem,\ncustomer,\ncustomer_address,\nhousehold_demographics\nWHERE\nss_ticket_number = sr_ticket_number\nAND ss_customer_sk = ws_bill_customer_sk\nAND ss_customer_sk = c_customer_sk\nAND c_current_addr_sk = ca_address_sk\nAND c_current_hdemo_sk = hd_demo_sk\nAND ss_item_sk = sr_item_sk\nAND sr_item_sk = ws_item_sk\nAND i_item_sk = ss_item_sk\nAND i_category IN ('Children', 'Electronics', 'Women')\nAND sr_returned_date_sk = d1.d_date_sk\nAND ws_sold_date_sk = d2.d_date_sk\nAND d2.d_date between d1.d_date AND (d1.d_date + interval '90 day')\nAND ca_state in ('GA', 'IA', 'LA', 'MO', 'SD')\nAND d1.d_year = 2000\nAND hd_income_band_sk BETWEEN 12 AND 18\nAND hd_buy_potential = '0-500'\nAND ss_sales_price / ss_list_price BETWEEN 34 * 0.01 AND 54 * 0.01\n;",
    "transforms": [
      "early_filter, date_cte_isolate, pushdown"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.02,
    "sf5_original_ms": 15337.38,
    "sf5_optimized_ms": 15098.82
  },
  {
    "query": "query013_agg",
    "source": "ado_round_01",
    "original": "select avg(ss_quantity)\n,avg(ss_ext_sales_price)\n,avg(ss_ext_wholesale_cost)\n,sum(ss_ext_wholesale_cost)\nfrom store_sales\n   ,store\n   ,customer_demographics\n   ,household_demographics\n   ,customer_address\n   ,date_dim\nwhere s_store_sk = ss_store_sk\nand  ss_sold_date_sk = d_date_sk and d_year = 2001\nand((ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'U'\nand cd_education_status = 'College'\nand ss_sales_price between 100.00 and 150.00\nand hd_dep_count = 3\n   )or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'W'\nand cd_education_status = 'Secondary'\nand ss_sales_price between 50.00 and 100.00\nand hd_dep_count = 1\n   ) or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'D'\nand cd_education_status = 'Secondary'\nand ss_sales_price between 150.00 and 200.00\nand hd_dep_count = 1\n   ))\nand((ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('IA', 'MO', 'TX')\nand ss_net_profit between 100 and 200\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('GA', 'LA', 'SD')\nand ss_net_profit between 150 and 300\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('TN', 'TX', 'VA')\nand ss_net_profit between 50 and 250\n   ))\n;",
    "optimized": "WITH date_cte AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001), filtered_ss AS (SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost, ss_sales_price, ss_net_profit, ss_store_sk, ss_sold_date_sk, ss_cdemo_sk, ss_hdemo_sk, ss_addr_sk FROM store_sales WHERE ((ss_sales_price BETWEEN 100.00 AND 150.00) OR (ss_sales_price BETWEEN 50.00 AND 100.00) OR (ss_sales_price BETWEEN 150.00 AND 200.00)) AND ((ss_net_profit BETWEEN 100 AND 200) OR (ss_net_profit BETWEEN 150 AND 300) OR (ss_net_profit BETWEEN 50 AND 250))) SELECT AVG(ss_quantity), AVG(ss_ext_sales_price), AVG(ss_ext_wholesale_cost), SUM(ss_ext_wholesale_cost) FROM filtered_ss JOIN store ON s_store_sk = ss_store_sk JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk JOIN household_demographics ON hd_demo_sk = ss_hdemo_sk JOIN customer_address ON ca_address_sk = ss_addr_sk JOIN date_cte ON ss_sold_date_sk = date_cte.d_date_sk WHERE ((cd_marital_status = 'U' AND cd_education_status = 'College' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3) OR (cd_marital_status = 'W' AND cd_education_status = 'Secondary' AND ss_sales_price BETWEEN 50.00 AND 100.00 AND hd_dep_count = 1) OR (cd_marital_status = 'D' AND cd_education_status = 'Secondary' AND ss_sales_price BETWEEN 150.00 AND 200.00 AND hd_dep_count = 1)) AND ((ca_country = 'United States' AND ca_state IN ('IA', 'MO', 'TX') AND ss_net_profit BETWEEN 100 AND 200) OR (ca_country = 'United States' AND ca_state IN ('GA', 'LA', 'SD') AND ss_net_profit BETWEEN 150 AND 300) OR (ca_country = 'United States' AND ca_state IN ('TN', 'TX', 'VA') AND ss_net_profit BETWEEN 50 AND 250))",
    "transforms": [
      "semantic_rewrite"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.01,
    "sf5_original_ms": 2268.27,
    "sf5_optimized_ms": 2253.47
  },
  {
    "query": "query064_multi",
    "source": "ado_round_01",
    "original": "with cs_ui as\n (select cs_item_sk\n        ,sum(cs_ext_list_price) as sale,sum(cr_refunded_cash+cr_reversed_charge+cr_store_credit) as refund\n  from catalog_sales\n      ,catalog_returns\n  where cs_item_sk = cr_item_sk\n    and cs_order_number = cr_order_number\n    and cs_wholesale_cost BETWEEN 34 AND 54\n   group by cs_item_sk\n  having sum(cs_ext_list_price)>2*sum(cr_refunded_cash+cr_reversed_charge+cr_store_credit)),\ncross_sales as\n (select i_product_name product_name\n     ,i_item_sk item_sk\n     ,s_store_name store_name\n     ,s_zip store_zip\n     ,ad1.ca_street_number b_street_number\n     ,ad1.ca_street_name b_street_name\n     ,ad1.ca_city b_city\n     ,ad1.ca_zip b_zip\n     ,ad2.ca_street_number c_street_number\n     ,ad2.ca_street_name c_street_name\n     ,ad2.ca_city c_city\n     ,ad2.ca_zip c_zip\n     ,d1.d_year as syear\n     ,d2.d_year as fsyear\n     ,d3.d_year s2year\n     ,count(*) cnt\n     ,sum(ss_wholesale_cost) s1\n     ,sum(ss_list_price) s2\n     ,sum(ss_coupon_amt) s3\n  FROM   store_sales\n        ,store_returns\n        ,cs_ui\n        ,date_dim d1\n        ,date_dim d2\n        ,date_dim d3\n        ,store\n        ,customer\n        ,customer_demographics cd1\n        ,customer_demographics cd2\n        ,promotion\n        ,household_demographics hd1\n        ,household_demographics hd2\n        ,customer_address ad1\n        ,customer_address ad2\n        ,income_band ib1\n        ,income_band ib2\n        ,item\n  WHERE  ss_store_sk = s_store_sk AND\n         ss_sold_date_sk = d1.d_date_sk AND\n         ss_customer_sk = c_customer_sk AND\n         ss_cdemo_sk= cd1.cd_demo_sk AND\n         ss_hdemo_sk = hd1.hd_demo_sk AND\n         ss_addr_sk = ad1.ca_address_sk and\n         ss_item_sk = i_item_sk and\n         ss_item_sk = sr_item_sk and\n         ss_ticket_number = sr_ticket_number and\n         ss_item_sk = cs_ui.cs_item_sk and\n         c_current_cdemo_sk = cd2.cd_demo_sk AND\n         c_current_hdemo_sk = hd2.hd_demo_sk AND\n         c_current_addr_sk = ad2.ca_address_sk and\n         c_first_sales_date_sk = d2.d_date_sk and\n         c_first_shipto_date_sk = d3.d_date_sk and\n         ss_promo_sk = p_promo_sk and\n         hd1.hd_income_band_sk = ib1.ib_income_band_sk and\n         hd2.hd_income_band_sk = ib2.ib_income_band_sk and\n         cd1.cd_marital_status <> cd2.cd_marital_status and\n         i_current_price between 20 and 20 + 10\n         and p_channel_email = 'Y'\n         and p_channel_tv = 'N'\n         and p_channel_radio = 'Y'\n         and ad2.ca_state in ('LA','TX','VA')\n         and ss_wholesale_cost BETWEEN 34 AND 54\n         and cd1.cd_marital_status in ('M', 'M', 'U')\n         and cd1.cd_education_status in ('Unknown', 'College', 'College')\n         and cd2.cd_marital_status in ('M', 'M', 'U')\n         and cd2.cd_education_status in ('Unknown', 'College', 'College')\ngroup by i_product_name\n       ,i_item_sk\n       ,s_store_name\n       ,s_zip\n       ,ad1.ca_street_number\n       ,ad1.ca_street_name\n       ,ad1.ca_city\n       ,ad1.ca_zip\n       ,ad2.ca_street_number\n       ,ad2.ca_street_name\n       ,ad2.ca_city\n       ,ad2.ca_zip\n       ,d1.d_year\n       ,d2.d_year\n       ,d3.d_year\n)\nselect cs1.product_name\n     ,cs1.store_name\n     ,cs1.store_zip\n     ,cs1.b_street_number\n     ,cs1.b_street_name\n     ,cs1.b_city\n     ,cs1.b_zip\n     ,cs1.c_street_number\n     ,cs1.c_street_name\n     ,cs1.c_city\n     ,cs1.c_zip\n     ,cs1.syear\n     ,cs1.cnt\n     ,cs1.s1 as s11\n     ,cs1.s2 as s21\n     ,cs1.s3 as s31\n     ,cs2.s1 as s12\n     ,cs2.s2 as s22\n     ,cs2.s3 as s32\n     ,cs2.syear\n     ,cs2.cnt\nfrom cross_sales cs1,cross_sales cs2\nwhere cs1.item_sk=cs2.item_sk and\n     cs1.syear = 1998 and\n     cs2.syear = 1998 + 1 and\n     cs2.cnt <= cs1.cnt and\n     cs1.store_name = cs2.store_name and\n     cs1.store_zip = cs2.store_zip\norder by cs1.product_name\n       ,cs1.store_name\n       ,cs2.cnt\n       ,cs1.s1\n       ,cs2.s1\n;",
    "optimized": "WITH cs_ui AS (SELECT cs_item_sk, SUM(cs_ext_list_price) AS sale, SUM(cr_refunded_cash + cr_reversed_charge + cr_store_credit) AS refund FROM catalog_sales, catalog_returns WHERE cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number AND cs_wholesale_cost BETWEEN 34 AND 54 GROUP BY cs_item_sk HAVING SUM(cs_ext_list_price) > 2 * SUM(cr_refunded_cash + cr_reversed_charge + cr_store_credit)), cross_sales AS (SELECT i_product_name AS product_name, i_item_sk AS item_sk, s_store_name AS store_name, s_zip AS store_zip, ad1.ca_street_number AS b_street_number, ad1.ca_street_name AS b_street_name, ad1.ca_city AS b_city, ad1.ca_zip AS b_zip, ad2.ca_street_number AS c_street_number, ad2.ca_street_name AS c_street_name, ad2.ca_city AS c_city, ad2.ca_zip AS c_zip, d1.d_year AS syear, d2.d_year AS fsyear, d3.d_year AS s2year, COUNT(*) AS cnt, SUM(ss_wholesale_cost) AS s1, SUM(ss_list_price) AS s2, SUM(ss_coupon_amt) AS s3 FROM store_sales, store_returns, cs_ui, date_dim AS d1, date_dim AS d2, date_dim AS d3, store, customer, customer_demographics AS cd1, customer_demographics AS cd2, promotion, household_demographics AS hd1, household_demographics AS hd2, customer_address AS ad1, customer_address AS ad2, income_band AS ib1, income_band AS ib2, item WHERE ss_store_sk = s_store_sk AND ss_sold_date_sk = d1.d_date_sk AND ss_customer_sk = c_customer_sk AND ss_cdemo_sk = cd1.cd_demo_sk AND ss_hdemo_sk = hd1.hd_demo_sk AND ss_addr_sk = ad1.ca_address_sk AND ss_item_sk = i_item_sk AND ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number AND ss_item_sk = cs_ui.cs_item_sk AND c_current_cdemo_sk = cd2.cd_demo_sk AND c_current_hdemo_sk = hd2.hd_demo_sk AND c_current_addr_sk = ad2.ca_address_sk AND c_first_sales_date_sk = d2.d_date_sk AND c_first_shipto_date_sk = d3.d_date_sk AND ss_promo_sk = p_promo_sk AND hd1.hd_income_band_sk = ib1.ib_income_band_sk AND hd2.hd_income_band_sk = ib2.ib_income_band_sk AND cd1.cd_marital_status <> cd2.cd_marital_status AND i_current_price BETWEEN 20 AND 20 + 10 AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'Y' AND ad2.ca_state IN ('LA', 'TX', 'VA') AND ss_wholesale_cost BETWEEN 34 AND 54 AND cd1.cd_marital_status IN ('M', 'M', 'U') AND cd1.cd_education_status IN ('Unknown', 'College', 'College') AND cd2.cd_marital_status IN ('M', 'M', 'U') AND cd2.cd_education_status IN ('Unknown', 'College', 'College') GROUP BY i_product_name, i_item_sk, s_store_name, s_zip, ad1.ca_street_number, ad1.ca_street_name, ad1.ca_city, ad1.ca_zip, ad2.ca_street_number, ad2.ca_street_name, ad2.ca_city, ad2.ca_zip, d1.d_year, d2.d_year, d3.d_year), cross_sales_1998 AS (SELECT i_product_name AS product_name, i_item_sk AS item_sk, s_store_name AS store_name, s_zip AS store_zip, ad1.ca_street_number AS b_street_number, ad1.ca_street_name AS b_street_name, ad1.ca_city AS b_city, ad1.ca_zip AS b_zip, ad2.ca_street_number AS c_street_number, ad2.ca_street_name AS c_street_name, ad2.ca_city AS c_city, ad2.ca_zip AS c_zip, d1.d_year AS syear, d2.d_year AS fsyear, d3.d_year AS s2year, COUNT(*) AS cnt, SUM(ss_wholesale_cost) AS s1, SUM(ss_list_price) AS s2, SUM(ss_coupon_amt) AS s3 FROM store_sales, store_returns, cs_ui, date_dim AS d1, date_dim AS d2, date_dim AS d3, store, customer, customer_demographics AS cd1, customer_demographics AS cd2, promotion, household_demographics AS hd1, household_demographics AS hd2, customer_address AS ad1, customer_address AS ad2, income_band AS ib1, income_band AS ib2, item WHERE ss_store_sk = s_store_sk AND ss_sold_date_sk = d1.d_date_sk AND ss_customer_sk = c_customer_sk AND ss_cdemo_sk = cd1.cd_demo_sk AND ss_hdemo_sk = hd1.hd_demo_sk AND ss_addr_sk = ad1.ca_address_sk AND ss_item_sk = i_item_sk AND ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number AND ss_item_sk = cs_ui.cs_item_sk AND c_current_cdemo_sk = cd2.cd_demo_sk AND c_current_hdemo_sk = hd2.hd_demo_sk AND c_current_addr_sk = ad2.ca_address_sk AND c_first_sales_date_sk = d2.d_date_sk AND c_first_shipto_date_sk = d3.d_date_sk AND ss_promo_sk = p_promo_sk AND hd1.hd_income_band_sk = ib1.ib_income_band_sk AND hd2.hd_income_band_sk = ib2.ib_income_band_sk AND cd1.cd_marital_status <> cd2.cd_marital_status AND i_current_price BETWEEN 20 AND 20 + 10 AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'Y' AND ad2.ca_state IN ('LA', 'TX', 'VA') AND ss_wholesale_cost BETWEEN 34 AND 54 AND cd1.cd_marital_status IN ('M', 'M', 'U') AND cd1.cd_education_status IN ('Unknown', 'College', 'College') AND cd2.cd_marital_status IN ('M', 'M', 'U') AND cd2.cd_education_status IN ('Unknown', 'College', 'College') AND d1.d_year = 1998 GROUP BY i_product_name, i_item_sk, s_store_name, s_zip, ad1.ca_street_number, ad1.ca_street_name, ad1.ca_city, ad1.ca_zip, ad2.ca_street_number, ad2.ca_street_name, ad2.ca_city, ad2.ca_zip, d1.d_year, d2.d_year, d3.d_year), cross_sales_1999 AS (SELECT i_product_name AS product_name, i_item_sk AS item_sk, s_store_name AS store_name, s_zip AS store_zip, ad1.ca_street_number AS b_street_number, ad1.ca_street_name AS b_street_name, ad1.ca_city AS b_city, ad1.ca_zip AS b_zip, ad2.ca_street_number AS c_street_number, ad2.ca_street_name AS c_street_name, ad2.ca_city AS c_city, ad2.ca_zip AS c_zip, d1.d_year AS syear, d2.d_year AS fsyear, d3.d_year AS s2year, COUNT(*) AS cnt, SUM(ss_wholesale_cost) AS s1, SUM(ss_list_price) AS s2, SUM(ss_coupon_amt) AS s3 FROM store_sales, store_returns, cs_ui, date_dim AS d1, date_dim AS d2, date_dim AS d3, store, customer, customer_demographics AS cd1, customer_demographics AS cd2, promotion, household_demographics AS hd1, household_demographics AS hd2, customer_address AS ad1, customer_address AS ad2, income_band AS ib1, income_band AS ib2, item WHERE ss_store_sk = s_store_sk AND ss_sold_date_sk = d1.d_date_sk AND ss_customer_sk = c_customer_sk AND ss_cdemo_sk = cd1.cd_demo_sk AND ss_hdemo_sk = hd1.hd_demo_sk AND ss_addr_sk = ad1.ca_address_sk AND ss_item_sk = i_item_sk AND ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number AND ss_item_sk = cs_ui.cs_item_sk AND c_current_cdemo_sk = cd2.cd_demo_sk AND c_current_hdemo_sk = hd2.hd_demo_sk AND c_current_addr_sk = ad2.ca_address_sk AND c_first_sales_date_sk = d2.d_date_sk AND c_first_shipto_date_sk = d3.d_date_sk AND ss_promo_sk = p_promo_sk AND hd1.hd_income_band_sk = ib1.ib_income_band_sk AND hd2.hd_income_band_sk = ib2.ib_income_band_sk AND cd1.cd_marital_status <> cd2.cd_marital_status AND i_current_price BETWEEN 20 AND 20 + 10 AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'Y' AND ad2.ca_state IN ('LA', 'TX', 'VA') AND ss_wholesale_cost BETWEEN 34 AND 54 AND cd1.cd_marital_status IN ('M', 'M', 'U') AND cd1.cd_education_status IN ('Unknown', 'College', 'College') AND cd2.cd_marital_status IN ('M', 'M', 'U') AND cd2.cd_education_status IN ('Unknown', 'College', 'College') AND d1.d_year = 1999 GROUP BY i_product_name, i_item_sk, s_store_name, s_zip, ad1.ca_street_number, ad1.ca_street_name, ad1.ca_city, ad1.ca_zip, ad2.ca_street_number, ad2.ca_street_name, ad2.ca_city, ad2.ca_zip, d1.d_year, d2.d_year, d3.d_year)\nSELECT cs1.product_name, cs1.store_name, cs1.store_zip, cs1.b_street_number, cs1.b_street_name, cs1.b_city, cs1.b_zip, cs1.c_street_number, cs1.c_street_name, cs1.c_city, cs1.c_zip, cs1.syear, cs1.cnt, cs1.s1 AS s11, cs1.s2 AS s21, cs1.s3 AS s31, cs2.s1 AS s12, cs2.s2 AS s22, cs2.s3 AS s32, cs2.syear, cs2.cnt FROM cross_sales_1998 AS cs1, cross_sales_1999 AS cs2 WHERE cs1.item_sk = cs2.item_sk AND cs2.cnt <= cs1.cnt AND cs1.store_name = cs2.store_name AND cs1.store_zip = cs2.store_zip ORDER BY cs1.product_name, cs1.store_name, cs2.cnt, cs1.s1, cs2.s1",
    "transforms": [
      "early_filter"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 1.0,
    "sf5_original_ms": 11996.3,
    "sf5_optimized_ms": 12012.9
  },
  {
    "query": "query025_agg",
    "source": "ado_round_01",
    "original": "select \n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n ,sum(ss_net_profit) as store_sales_profit\n ,sum(sr_net_loss) as store_returns_loss\n ,sum(cs_net_profit) as catalog_sales_profit\n from\n store_sales\n ,store_returns\n ,catalog_sales\n ,date_dim d1\n ,date_dim d2\n ,date_dim d3\n ,store\n ,item\n where\n d1.d_moy = 5\n and d1.d_year = 1999\n and d1.d_date_sk = ss_sold_date_sk\n and i_item_sk = ss_item_sk\n and s_store_sk = ss_store_sk\n and ss_customer_sk = sr_customer_sk\n and ss_item_sk = sr_item_sk\n and ss_ticket_number = sr_ticket_number\n and sr_returned_date_sk = d2.d_date_sk\n and d2.d_moy               between 5 and  5 + 2\n and d2.d_year              = 1999\n and sr_customer_sk = cs_bill_customer_sk\n and sr_item_sk = cs_item_sk\n and cs_sold_date_sk = d3.d_date_sk\n and d3.d_moy               between 5 and  5 + 2\n and d3.d_year              = 1999\n group by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n order by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n limit 100;",
    "optimized": "WITH d1_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_moy = 5 AND d_year = 1999), d2_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 5 AND 5 + 2 AND d_year = 1999), d3_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 5 AND 5 + 2 AND d_year = 1999) SELECT i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name, SUM(ss.ss_net_profit) AS store_sales_profit, SUM(sr.sr_net_loss) AS store_returns_loss, SUM(cs.cs_net_profit) AS catalog_sales_profit FROM store_sales AS ss JOIN d1_filtered AS d1 ON ss.ss_sold_date_sk = d1.d_date_sk JOIN item AS i ON ss.ss_item_sk = i.i_item_sk JOIN store AS s ON ss.ss_store_sk = s.s_store_sk JOIN store_returns AS sr ON ss.ss_customer_sk = sr.sr_customer_sk AND ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number JOIN d2_filtered AS d2 ON sr.sr_returned_date_sk = d2.d_date_sk JOIN catalog_sales AS cs ON sr.sr_customer_sk = cs.cs_bill_customer_sk AND sr.sr_item_sk = cs.cs_item_sk JOIN d3_filtered AS d3 ON cs.cs_sold_date_sk = d3.d_date_sk GROUP BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name ORDER BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name LIMIT 100",
    "transforms": [
      "date_cte_isolate"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.99,
    "sf5_original_ms": 650.63,
    "sf5_optimized_ms": 660.5
  },
  {
    "query": "query091_agg",
    "source": "ado_round_01",
    "original": "select  \n        cc_call_center_id Call_Center,\n        cc_name Call_Center_Name,\n        cc_manager Manager,\n        sum(cr_net_loss) Returns_Loss\nfrom\n        call_center,\n        catalog_returns,\n        date_dim,\n        customer,\n        customer_address,\n        customer_demographics,\n        household_demographics\nwhere\n        cr_call_center_sk       = cc_call_center_sk\nand     cr_returned_date_sk     = d_date_sk\nand     cr_returning_customer_sk= c_customer_sk\nand     cd_demo_sk              = c_current_cdemo_sk\nand     hd_demo_sk              = c_current_hdemo_sk\nand     ca_address_sk           = c_current_addr_sk\nand     d_year                  = 1999 \nand     d_moy                   = 1\nand     ( (cd_marital_status       = 'M' and cd_education_status     = 'Unknown')\n        or(cd_marital_status       = 'W' and cd_education_status     = 'Advanced Degree'))\nand     hd_buy_potential like '1001-5000%'\nand     ca_gmt_offset           = -7\ngroup by cc_call_center_id,cc_name,cc_manager,cd_marital_status,cd_education_status\norder by sum(cr_net_loss) desc;",
    "optimized": "WITH date_dim_cte AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy = 1)\nSELECT cc_call_center_id AS Call_Center, cc_name AS Call_Center_Name, cc_manager AS Manager, SUM(cr_net_loss) AS Returns_Loss FROM call_center, catalog_returns, (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy = 1) AS date_filtered, customer, customer_address, customer_demographics, household_demographics WHERE cr_call_center_sk = cc_call_center_sk AND cr_returned_date_sk = date_filtered.d_date_sk AND cr_returning_customer_sk = c_customer_sk AND cd_demo_sk = c_current_cdemo_sk AND hd_demo_sk = c_current_hdemo_sk AND ca_address_sk = c_current_addr_sk AND ((cd_marital_status = 'M' AND cd_education_status = 'Unknown') OR (cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree')) AND hd_buy_potential LIKE '1001-5000%' AND ca_gmt_offset = -7 GROUP BY cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status ORDER BY SUM(cr_net_loss) DESC",
    "transforms": [
      "date_cte_isolate",
      "or_to_union",
      "early_filter"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.99,
    "sf5_original_ms": 851.62,
    "sf5_optimized_ms": 863.07
  },
  {
    "query": "query013_spj_spj",
    "source": "ado_round_01",
    "original": "select min(ss_quantity)\n       ,min(ss_ext_sales_price)\n       ,min(ss_ext_wholesale_cost)\n       ,min(ss_ext_wholesale_cost)\n from store_sales\n     ,store\n     ,customer_demographics\n     ,household_demographics\n     ,customer_address\n     ,date_dim\n where s_store_sk = ss_store_sk\n and  ss_sold_date_sk = d_date_sk and d_year = 2001\n and((ss_hdemo_sk=hd_demo_sk\n  and cd_demo_sk = ss_cdemo_sk\n  and cd_marital_status = 'U'\n  and cd_education_status = 'College'\n  and ss_sales_price between 100.00 and 150.00\n  and hd_dep_count = 3\n     )or\n     (ss_hdemo_sk=hd_demo_sk\n  and cd_demo_sk = ss_cdemo_sk\n  and cd_marital_status = 'W'\n  and cd_education_status = 'Secondary'\n  and ss_sales_price between 50.00 and 100.00\n  and hd_dep_count = 1\n     ) or\n     (ss_hdemo_sk=hd_demo_sk\n  and cd_demo_sk = ss_cdemo_sk\n  and cd_marital_status = 'D'\n  and cd_education_status = 'Secondary'\n  and ss_sales_price between 150.00 and 200.00\n  and hd_dep_count = 1\n     ))\n and((ss_addr_sk = ca_address_sk\n  and ca_country = 'United States'\n  and ca_state in ('IA', 'MO', 'TX')\n  and ss_net_profit between 100 and 200\n     ) or\n     (ss_addr_sk = ca_address_sk\n  and ca_country = 'United States'\n  and ca_state in ('GA', 'LA', 'SD')\n  and ss_net_profit between 150 and 300\n     ) or\n     (ss_addr_sk = ca_address_sk\n  and ca_country = 'United States'\n  and ca_state in ('TN', 'TX', 'VA')\n  and ss_net_profit between 50 and 250\n     ))\n;",
    "optimized": "WITH date_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001)\nSELECT MIN(ss_quantity), MIN(ss_ext_sales_price), MIN(ss_ext_wholesale_cost), MIN(ss_ext_wholesale_cost) FROM store_sales, store, customer_demographics, household_demographics, customer_address, date_filtered WHERE s_store_sk = ss_store_sk AND ss_sold_date_sk = d_date_sk AND ((ss_hdemo_sk = hd_demo_sk AND cd_demo_sk = ss_cdemo_sk AND cd_marital_status = 'U' AND cd_education_status = 'College' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3) OR (ss_hdemo_sk = hd_demo_sk AND cd_demo_sk = ss_cdemo_sk AND cd_marital_status = 'W' AND cd_education_status = 'Secondary' AND ss_sales_price BETWEEN 50.00 AND 100.00 AND hd_dep_count = 1) OR (ss_hdemo_sk = hd_demo_sk AND cd_demo_sk = ss_cdemo_sk AND cd_marital_status = 'D' AND cd_education_status = 'Secondary' AND ss_sales_price BETWEEN 150.00 AND 200.00 AND hd_dep_count = 1)) AND ((ss_addr_sk = ca_address_sk AND ca_country = 'United States' AND ca_state IN ('IA', 'MO', 'TX') AND ss_net_profit BETWEEN 100 AND 200) OR (ss_addr_sk = ca_address_sk AND ca_country = 'United States' AND ca_state IN ('GA', 'LA', 'SD') AND ss_net_profit BETWEEN 150 AND 300) OR (ss_addr_sk = ca_address_sk AND ca_country = 'United States' AND ca_state IN ('TN', 'TX', 'VA') AND ss_net_profit BETWEEN 50 AND 250))",
    "transforms": [
      "date_cte_isolate",
      "or_to_union"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.98,
    "sf5_original_ms": 2199.32,
    "sf5_optimized_ms": 2240.06
  },
  {
    "query": "query050_agg",
    "source": "ado_round_01",
    "original": "select \n   s_store_name\n  ,s_company_id\n  ,s_street_number\n  ,s_street_name\n  ,s_street_type\n  ,s_suite_number\n  ,s_city\n  ,s_county\n  ,s_state\n  ,s_zip\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\"\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 30) and\n                 (sr_returned_date_sk - ss_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\"\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 60) and\n                 (sr_returned_date_sk - ss_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\"\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 90) and\n                 (sr_returned_date_sk - ss_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\"\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\"\nfrom\n   store_sales\n  ,store_returns\n  ,store\n  ,date_dim d1\n  ,date_dim d2\nwhere\n    d2.d_year = 2002\nand d2.d_moy  = 8\nand ss_ticket_number = sr_ticket_number\nand ss_item_sk = sr_item_sk\nand ss_sold_date_sk   = d1.d_date_sk\nand sr_returned_date_sk   = d2.d_date_sk\nand ss_customer_sk = sr_customer_sk\nand ss_store_sk = s_store_sk\nand d1.d_date between (d2.d_date - interval '120 day')\n               and d2.d_date\ngroup by\n   s_store_name\n  ,s_company_id\n  ,s_street_number\n  ,s_street_name\n  ,s_street_type\n  ,s_suite_number\n  ,s_city\n  ,s_county\n  ,s_state\n  ,s_zip\norder by s_store_name\n        ,s_company_id\n        ,s_street_number\n        ,s_street_name\n        ,s_street_type\n        ,s_suite_number\n        ,s_city\n        ,s_county\n        ,s_state\n        ,s_zip\nlimit 100;",
    "optimized": "WITH filtered_d2 AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2002 AND d_moy = 8) SELECT s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip, SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 30) AND (sr_returned_date_sk - ss_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 60) AND (sr_returned_date_sk - ss_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 90) AND (sr_returned_date_sk - ss_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM store_sales, store_returns, store, date_dim AS d1, filtered_d2 AS d2 WHERE ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk AND ss_sold_date_sk = d1.d_date_sk AND sr_returned_date_sk = d2.d_date_sk AND ss_customer_sk = sr_customer_sk AND ss_store_sk = s_store_sk AND d1.d_date BETWEEN (d2.d_date - INTERVAL '120 DAY') AND d2.d_date GROUP BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip ORDER BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip LIMIT 100",
    "transforms": [
      "date_cte_isolate"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.98,
    "sf5_original_ms": 1222.23,
    "sf5_optimized_ms": 1253.53
  },
  {
    "query": "query050_spj_spj",
    "source": "ado_round_01",
    "original": "select\n   min(s_store_name)\n  ,min(s_company_id)\n  ,min(s_street_number)\n  ,min(s_street_name)\n  ,min(s_suite_number)\n  ,min(s_city)\n  ,min(s_zip)\n  ,min(ss_ticket_number)\n  ,min(ss_sold_date_sk)\n  ,min(sr_returned_date_sk)\n  ,min(ss_item_sk)\n  ,min(d1.d_date_sk)\nfrom\n   store_sales\n  ,store_returns\n  ,store\n  ,date_dim d1\n  ,date_dim d2\nwhere\n    d2.d_moy = 12\nand ss_ticket_number = sr_ticket_number\nand ss_item_sk = sr_item_sk\nand ss_sold_date_sk   = d1.d_date_sk\nand sr_returned_date_sk   = d2.d_date_sk\nand ss_customer_sk = sr_customer_sk\nand ss_store_sk = s_store_sk\nand sr_store_sk = s_store_sk\nand d1.d_date between (d2.d_date - interval '120 day')\n               and d2.d_date\nand d1.d_dow = 1\nand s_state in ('LA','TX','VA')\n ;",
    "optimized": "WITH filtered_d2 AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_moy = 12), filtered_d1 AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_dow = 1), filtered_store AS (SELECT s_store_sk, s_store_name, s_company_id, s_street_number, s_street_name, s_suite_number, s_city, s_zip, s_state FROM store WHERE s_state IN ('LA', 'TX', 'VA'))\nSELECT MIN(s.s_store_name), MIN(s.s_company_id), MIN(s.s_street_number), MIN(s.s_street_name), MIN(s.s_suite_number), MIN(s.s_city), MIN(s.s_zip), MIN(ss.ss_ticket_number), MIN(ss.ss_sold_date_sk), MIN(sr.sr_returned_date_sk), MIN(ss.ss_item_sk), MIN(d1.d_date_sk) FROM store_sales AS ss JOIN store_returns AS sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk AND ss.ss_customer_sk = sr.sr_customer_sk JOIN filtered_store AS s ON ss.ss_store_sk = s.s_store_sk AND sr.sr_store_sk = s.s_store_sk JOIN filtered_d1 AS d1 ON ss.ss_sold_date_sk = d1.d_date_sk JOIN filtered_d2 AS d2 ON sr.sr_returned_date_sk = d2.d_date_sk WHERE d1.d_date BETWEEN (d2.d_date - INTERVAL '120 DAY') AND d2.d_date",
    "transforms": [
      "early_filter"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.98,
    "sf5_original_ms": 2410.81,
    "sf5_optimized_ms": 2458.19
  },
  {
    "query": "query023_multi",
    "source": "ado_round_01",
    "original": "with frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year = 1998\n    and i_manager_id BETWEEN 81 and 100\n     AND i_category IN ('Home', 'Jewelry', 'Music')\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim\n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year = 1998\n         and ss_wholesale_cost BETWEEN 26 AND 36\n        group by c_customer_sk) tmp1),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  and c_birth_year BETWEEN 1927 AND 1933\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\nfrom\n max_store_sales))\n  select  sum(sales)\n from (select cs_quantity*cs_list_price sales\n       from catalog_sales\n           ,date_dim\n       where d_year = 1998\n         and d_moy = 3\n         and cs_sold_date_sk = d_date_sk\n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_wholesale_cost BETWEEN 26 AND 36\n      union all\n      select ws_quantity*ws_list_price sales\n       from web_sales\n           ,date_dim\n       where d_year = 1998\n         and d_moy = 3\n         and ws_sold_date_sk = d_date_sk\n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_wholesale_cost BETWEEN 26 AND 36) tmp2\n limit 100;",
    "optimized": "WITH frequent_ss_items AS (SELECT SUBSTRING(i_item_desc FROM 1 FOR 30) AS itemdesc, i_item_sk AS item_sk, d_date AS solddate, COUNT(*) AS cnt FROM store_sales, date_dim, item WHERE ss_sold_date_sk = d_date_sk AND ss_item_sk = i_item_sk AND d_year = 1998 AND i_manager_id BETWEEN 81 AND 100 AND i_category IN ('Home', 'Jewelry', 'Music') GROUP BY SUBSTRING(i_item_desc FROM 1 FOR 30), i_item_sk, d_date HAVING COUNT(*) > 4), max_store_sales AS (SELECT MAX(csales) AS tpcds_cmax FROM (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS csales FROM store_sales, customer, date_dim WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1998 AND ss_wholesale_cost BETWEEN 26 AND 36 GROUP BY c_customer_sk) AS tmp1), best_ss_customer AS (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS ssales FROM store_sales, customer WHERE ss_customer_sk = c_customer_sk AND c_birth_year BETWEEN 1927 AND 1933 GROUP BY c_customer_sk HAVING SUM(ss_quantity * ss_sales_price) > (95 / 100.0) * (SELECT * FROM max_store_sales)), date_1998 AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998), date_1998_m03 AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998 AND d_moy = 3)\nSELECT SUM(sales) FROM (SELECT cs_quantity * cs_list_price AS sales FROM catalog_sales, date_dim WHERE d_year = 1998 AND d_moy = 3 AND cs_sold_date_sk = d_date_sk AND cs_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND cs_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) AND cs_wholesale_cost BETWEEN 26 AND 36 UNION ALL SELECT ws_quantity * ws_list_price AS sales FROM web_sales, date_dim WHERE d_year = 1998 AND d_moy = 3 AND ws_sold_date_sk = d_date_sk AND ws_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND ws_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) AND ws_wholesale_cost BETWEEN 26 AND 36) AS tmp2 LIMIT 100",
    "transforms": [
      "date_cte_isolate",
      "pushdown",
      "decorrelate",
      "materialize_cte"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.96,
    "sf5_original_ms": 4316.68,
    "sf5_optimized_ms": 4475.91
  },
  {
    "query": "query014_multi",
    "source": "ado_round_01",
    "original": "with  cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n     ,iss.i_class_id class_id\n     ,iss.i_category_id category_id\n from store_sales\n     ,item iss\n     ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n   and ss_sold_date_sk = d1.d_date_sk\n   and d1.d_year between 2000 AND 2000 + 2\n   and i_category IN ('Electronics', 'Home', 'Men')\n   and i_manager_id BETWEEN 25 and 34\n   and ss_wholesale_cost BETWEEN 34 AND 54\nintersect\n select ics.i_brand_id\n     ,ics.i_class_id\n     ,ics.i_category_id\n from catalog_sales\n     ,item ics\n     ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n   and cs_sold_date_sk = d2.d_date_sk\n   and d2.d_year between 2000 AND 2000 + 2\n   and i_category IN ('Electronics', 'Home', 'Men')\n   and i_manager_id BETWEEN 25 and 34\n   and cs_wholesale_cost BETWEEN 34 AND 54\nintersect\n select iws.i_brand_id\n     ,iws.i_class_id\n     ,iws.i_category_id\n from web_sales\n     ,item iws\n     ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n   and ws_sold_date_sk = d3.d_date_sk\n   and ws_wholesale_cost BETWEEN 34 AND 54\n   and d3.d_year between 2000 AND 2000 + 2) x\n where i_brand_id = brand_id\n      and i_class_id = class_id\n      and i_category_id = category_id\n      and i_category IN ('Electronics', 'Home', 'Men')\n      and i_manager_id BETWEEN 25 and 34\n),\n avg_sales as\n(select avg(quantity*list_price) average_sales\n  from (select ss_quantity quantity\n             ,ss_list_price list_price\n       from store_sales\n           ,date_dim\n       where ss_sold_date_sk = d_date_sk\n         and d_year between 2000 and 2000 + 2\n         and ss_wholesale_cost BETWEEN 34 AND 54\n       union all\n       select cs_quantity quantity\n             ,cs_list_price list_price\n       from catalog_sales\n           ,date_dim\n       where cs_sold_date_sk = d_date_sk\n         and d_year between 2000 and 2000 + 2\n         and cs_wholesale_cost BETWEEN 34 AND 54\n       union all\n       select ws_quantity quantity\n             ,ws_list_price list_price\n       from web_sales\n           ,date_dim\n       where ws_sold_date_sk = d_date_sk\n        and ws_wholesale_cost BETWEEN 34 AND 54\n         and d_year between 2000 and 2000 + 2) x)\n  select  this_year.channel ty_channel\n                           ,this_year.i_brand_id ty_brand\n                           ,this_year.i_class_id ty_class\n                           ,this_year.i_category_id ty_category\n                           ,this_year.sales ty_sales\n                           ,this_year.number_sales ty_number_sales\n                           ,last_year.channel ly_channel\n                           ,last_year.i_brand_id ly_brand\n                           ,last_year.i_class_id ly_class\n                           ,last_year.i_category_id ly_category\n                           ,last_year.sales ly_sales\n                           ,last_year.number_sales ly_number_sales\n from\n (select 'store' channel, i_brand_id,i_class_id,i_category_id\n        ,sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n     ,item\n     ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n   and ss_item_sk = i_item_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_week_seq = (select d_week_seq\n                     from date_dim\n                     where d_year = 2000 + 1\n                       and d_moy = 12\n                       and d_dom = 17)\n   and i_category IN ('Electronics', 'Home', 'Men')\n   and i_manager_id BETWEEN 25 and 34\n   and ss_wholesale_cost BETWEEN 34 AND 54\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) this_year,\n (select 'store' channel, i_brand_id,i_class_id\n        ,i_category_id, sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n     ,item\n     ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n   and ss_item_sk = i_item_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_week_seq = (select d_week_seq\n                     from date_dim\n                     where d_year = 2000\n                       and d_moy = 12\n                       and d_dom = 17)\n   and i_category IN ('Electronics', 'Home', 'Men')\n   and ss_wholesale_cost BETWEEN 34 AND 54\n   and i_manager_id BETWEEN 25 and 34\ngroup by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) last_year\n where this_year.i_brand_id= last_year.i_brand_id\n   and this_year.i_class_id = last_year.i_class_id\n   and this_year.i_category_id = last_year.i_category_id\n order by this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id\n limit 100;",
    "optimized": "WITH cross_items AS (SELECT i_item_sk AS ss_item_sk FROM item, (SELECT iss.i_brand_id AS brand_id, iss.i_class_id AS class_id, iss.i_category_id AS category_id FROM store_sales, item AS iss, date_dim AS d1 WHERE ss_item_sk = iss.i_item_sk AND ss_sold_date_sk = d1.d_date_sk AND d1.d_year BETWEEN 2000 AND 2000 + 2 AND i_category IN ('Electronics', 'Home', 'Men') AND i_manager_id BETWEEN 25 AND 34 AND ss_wholesale_cost BETWEEN 34 AND 54 INTERSECT SELECT ics.i_brand_id, ics.i_class_id, ics.i_category_id FROM catalog_sales, item AS ics, date_dim AS d2 WHERE cs_item_sk = ics.i_item_sk AND cs_sold_date_sk = d2.d_date_sk AND d2.d_year BETWEEN 2000 AND 2000 + 2 AND i_category IN ('Electronics', 'Home', 'Men') AND i_manager_id BETWEEN 25 AND 34 AND cs_wholesale_cost BETWEEN 34 AND 54 INTERSECT SELECT iws.i_brand_id, iws.i_class_id, iws.i_category_id FROM web_sales, item AS iws, date_dim AS d3 WHERE ws_item_sk = iws.i_item_sk AND ws_sold_date_sk = d3.d_date_sk AND ws_wholesale_cost BETWEEN 34 AND 54 AND d3.d_year BETWEEN 2000 AND 2000 + 2) AS x WHERE i_brand_id = brand_id AND i_class_id = class_id AND i_category_id = category_id AND i_category IN ('Electronics', 'Home', 'Men') AND i_manager_id BETWEEN 25 AND 34), avg_sales AS (SELECT AVG(quantity * list_price) AS average_sales FROM (SELECT ss_quantity AS quantity, ss_list_price AS list_price FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_year BETWEEN 2000 AND 2000 + 2 AND ss_wholesale_cost BETWEEN 34 AND 54 UNION ALL SELECT cs_quantity AS quantity, cs_list_price AS list_price FROM catalog_sales, date_dim WHERE cs_sold_date_sk = d_date_sk AND d_year BETWEEN 2000 AND 2000 + 2 AND cs_wholesale_cost BETWEEN 34 AND 54 UNION ALL SELECT ws_quantity AS quantity, ws_list_price AS list_price FROM web_sales, date_dim WHERE ws_sold_date_sk = d_date_sk AND ws_wholesale_cost BETWEEN 34 AND 54 AND d_year BETWEEN 2000 AND 2000 + 2) AS x), date_weeks AS (SELECT \n    d_week_seq AS week_seq_2001,\n    (SELECT d_week_seq FROM date_dim WHERE d_year = 2000 AND d_moy = 12 AND d_dom = 17) AS week_seq_2000\n  FROM date_dim \n  WHERE d_year = 2000 + 1 AND d_moy = 12 AND d_dom = 17\n)\nSELECT this_year.channel AS ty_channel, this_year.i_brand_id AS ty_brand, this_year.i_class_id AS ty_class, this_year.i_category_id AS ty_category, this_year.sales AS ty_sales, this_year.number_sales AS ty_number_sales, last_year.channel AS ly_channel, last_year.i_brand_id AS ly_brand, last_year.i_class_id AS ly_class, last_year.i_category_id AS ly_category, last_year.sales AS ly_sales, last_year.number_sales AS ly_number_sales FROM (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 2000 + 1 AND d_moy = 12 AND d_dom = 17) AND i_category IN ('Electronics', 'Home', 'Men') AND i_manager_id BETWEEN 25 AND 34 AND ss_wholesale_cost BETWEEN 34 AND 54 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)) AS this_year, (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 2000 AND d_moy = 12 AND d_dom = 17) AND i_category IN ('Electronics', 'Home', 'Men') AND ss_wholesale_cost BETWEEN 34 AND 54 AND i_manager_id BETWEEN 25 AND 34 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)) AS last_year WHERE this_year.i_brand_id = last_year.i_brand_id AND this_year.i_class_id = last_year.i_class_id AND this_year.i_category_id = last_year.i_category_id ORDER BY this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id LIMIT 100",
    "transforms": [
      "date_cte_isolate",
      "materialize_cte",
      "semantic_rewrite"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.95,
    "sf5_original_ms": 91507.38,
    "sf5_optimized_ms": 96690.79
  },
  {
    "query": "query099_agg",
    "source": "ado_round_01",
    "original": "select \n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\"\nfrom\n   catalog_sales\n  ,warehouse\n  ,ship_mode\n  ,call_center\n  ,date_dim\nwhere\nd_month_seq between 1193 and 1193 + 23\nand cs_ship_date_sk   = d_date_sk\nand cs_warehouse_sk   = w_warehouse_sk\nand cs_ship_mode_sk   = sm_ship_mode_sk\nand cs_call_center_sk = cc_call_center_sk\nand cs_list_price between 271 and 300\nand sm_type = 'REGULAR'\nand cc_class = 'small'\nand w_gmt_offset = -5\ngroup by\n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\norder by substring(w_warehouse_name,1,20)\n        ,sm_type\n        ,cc_name\nlimit 100;",
    "optimized": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1193 AND 1193 + 23)\nSELECT SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name, SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM catalog_sales JOIN filtered_dates ON cs_ship_date_sk = d_date_sk JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk JOIN call_center ON cs_call_center_sk = cc_call_center_sk WHERE cs_list_price BETWEEN 271 AND 300 AND sm_type = 'REGULAR' AND cc_class = 'small' AND w_gmt_offset = -5 GROUP BY SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name ORDER BY SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name LIMIT 100",
    "transforms": [
      "date_cte_isolate"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.95,
    "sf5_original_ms": 24.6,
    "sf5_optimized_ms": 25.76
  },
  {
    "query": "query018_spj_spj",
    "source": "ado_round_01",
    "original": "select min(i_item_id),\n        min(ca_country),\n        min(ca_state),\n        min(ca_county),\n        min(cs_quantity),\n        min(cs_list_price),\n        min(cs_coupon_amt),\n        min(cs_sales_price),\n        min(cs_net_profit),\n        min(c_birth_year),\n        min(cd_dep_count)\n from catalog_sales, customer_demographics, customer, customer_address, date_dim, item\n where cs_sold_date_sk = d_date_sk and\n       cs_item_sk = i_item_sk and\n       cs_bill_cdemo_sk = cd_demo_sk and\n       cs_bill_customer_sk = c_customer_sk and\n       cd_gender = 'F' and\n       cd_education_status = 'College' and\n       c_current_addr_sk = ca_address_sk and\n       d_year = 1998 and\n       c_birth_month = 1 and\n       ca_state in ('GA', 'LA', 'SD')\n       and cs_wholesale_cost BETWEEN 52 AND 57\n       AND i_category = 'Jewelry'\n;",
    "optimized": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998), filtered_item AS (SELECT i_item_sk, i_item_id FROM item WHERE i_category = 'Jewelry'), filtered_customer_demographics AS (SELECT cd_demo_sk, cd_dep_count FROM customer_demographics WHERE cd_gender = 'F' AND cd_education_status = 'College'), filtered_customer AS (SELECT c_customer_sk, c_birth_year, c_current_addr_sk FROM customer WHERE c_birth_month = 1), filtered_customer_address AS (SELECT ca_address_sk, ca_country, ca_state, ca_county FROM customer_address WHERE ca_state IN ('GA', 'LA', 'SD')) SELECT MIN(i_item_id), MIN(ca_country), MIN(ca_state), MIN(ca_county), MIN(cs_quantity), MIN(cs_list_price), MIN(cs_coupon_amt), MIN(cs_sales_price), MIN(cs_net_profit), MIN(c_birth_year), MIN(cd_dep_count) FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = filtered_dates.d_date_sk JOIN filtered_item ON cs_item_sk = filtered_item.i_item_sk JOIN filtered_customer_demographics ON cs_bill_cdemo_sk = filtered_customer_demographics.cd_demo_sk JOIN filtered_customer ON cs_bill_customer_sk = filtered_customer.c_customer_sk JOIN filtered_customer_address ON filtered_customer.c_current_addr_sk = filtered_customer_address.ca_address_sk WHERE cs_wholesale_cost BETWEEN 52 AND 57",
    "transforms": [
      "date_cte_isolate"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.89,
    "sf5_original_ms": 1792.23,
    "sf5_optimized_ms": 2007.17
  },
  {
    "query": "query040_agg",
    "source": "ado_round_01",
    "original": "select \n   w_state\n  ,i_item_id\n  ,sum(case when (cast(d_date as date) < cast ('1999-04-19' as date))\n \t\tthen cs_sales_price - coalesce(cr_refunded_cash,0) else 0 end) as sales_before\n  ,sum(case when (cast(d_date as date) >= cast ('1999-04-19' as date))\n \t\tthen cs_sales_price - coalesce(cr_refunded_cash,0) else 0 end) as sales_after\n from\n   catalog_sales left outer join catalog_returns on\n       (cs_order_number = cr_order_number\n        and cs_item_sk = cr_item_sk)\n  ,warehouse\n  ,item\n  ,date_dim\n where\n i_item_sk          = cs_item_sk\n and cs_warehouse_sk    = w_warehouse_sk\n and cs_sold_date_sk    = d_date_sk\n and d_date between  (cast ('1999-04-19' as date) - interval '30 day')\n                and (cast ('1999-04-19' as date) + interval '30 day') \n and i_category  = 'Home'\n and i_manager_id between 25 and 64\n and cs_wholesale_cost between 17 and 36\n and cr_reason_sk = 16\n group by\n    w_state,i_item_id\n order by w_state,i_item_id\nlimit 100;",
    "optimized": "WITH filtered_date_dim AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN (CAST('1999-04-19' AS DATE) - INTERVAL '30 DAY') AND (CAST('1999-04-19' AS DATE) + INTERVAL '30 DAY'))\nSELECT w_state, i_item_id, SUM(CASE WHEN (CAST(d_date AS DATE) < CAST('1999-04-19' AS DATE)) THEN cs_sales_price - COALESCE(cr_refunded_cash, 0) ELSE 0 END) AS sales_before, SUM(CASE WHEN (CAST(d_date AS DATE) >= CAST('1999-04-19' AS DATE)) THEN cs_sales_price - COALESCE(cr_refunded_cash, 0) ELSE 0 END) AS sales_after FROM catalog_sales LEFT OUTER JOIN catalog_returns ON (cs_order_number = cr_order_number AND cs_item_sk = cr_item_sk), warehouse, item, date_dim WHERE i_item_sk = cs_item_sk AND cs_warehouse_sk = w_warehouse_sk AND cs_sold_date_sk = d_date_sk AND d_date BETWEEN (CAST('1999-04-19' AS DATE) - INTERVAL '30 DAY') AND (CAST('1999-04-19' AS DATE) + INTERVAL '30 DAY') AND i_category = 'Home' AND i_manager_id BETWEEN 25 AND 64 AND cs_wholesale_cost BETWEEN 17 AND 36 AND cr_reason_sk = 16 GROUP BY w_state, i_item_id ORDER BY w_state, i_item_id LIMIT 100",
    "transforms": [
      "date_cte_isolate",
      "early_filter",
      "semantic_rewrite"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.87,
    "sf5_original_ms": 64.63,
    "sf5_optimized_ms": 74.46
  },
  {
    "query": "query027_spj_spj",
    "source": "ado_round_01",
    "original": "select min(i_item_id),\n        min(s_state),\n        min(ss_quantity),\n        min(ss_list_price),\n        min(ss_coupon_amt),\n        min(ss_sales_price),\n        min(ss_item_sk),\n        min(ss_ticket_number)\n from store_sales, customer_demographics, date_dim, store, item\n where ss_sold_date_sk = d_date_sk and\n       ss_item_sk = i_item_sk and\n       ss_store_sk = s_store_sk and\n       ss_cdemo_sk = cd_demo_sk and\n       cd_gender = 'M' and\n       cd_marital_status = 'S' and\n       cd_education_status = 'Advanced Degree' and\n       d_year = 2002 and\n       s_state = 'VA' and\n      i_category  = 'Jewelry'\n ;",
    "optimized": "WITH filtered_cd AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_gender = 'M' AND cd_marital_status = 'S' AND cd_education_status = 'Advanced Degree'), filtered_date AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002), filtered_store AS (SELECT s_store_sk, s_state FROM store WHERE s_state = 'VA'), filtered_item AS (SELECT i_item_sk, i_item_id FROM item WHERE i_category = 'Jewelry') SELECT MIN(i_item_id), MIN(s_state), MIN(ss_quantity), MIN(ss_list_price), MIN(ss_coupon_amt), MIN(ss_sales_price), MIN(ss_item_sk), MIN(ss_ticket_number) FROM store_sales JOIN filtered_cd ON store_sales.ss_cdemo_sk = filtered_cd.cd_demo_sk JOIN filtered_date ON store_sales.ss_sold_date_sk = filtered_date.d_date_sk JOIN filtered_store ON store_sales.ss_store_sk = filtered_store.s_store_sk JOIN filtered_item ON store_sales.ss_item_sk = filtered_item.i_item_sk",
    "transforms": [
      "early_filter"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.85,
    "sf5_original_ms": 14.56,
    "sf5_optimized_ms": 17.1
  },
  {
    "query": "query100_spj_spj",
    "source": "ado_round_01",
    "original": "select min(item1.i_item_sk),\n    min(item2.i_item_sk),\n    min(s1.ss_ticket_number),\n    min(s1.ss_item_sk)\nFROM item AS item1,\nitem AS item2,\nstore_sales AS s1,\nstore_sales AS s2,\ndate_dim,\ncustomer,\ncustomer_address,\ncustomer_demographics\nWHERE\nitem1.i_item_sk < item2.i_item_sk\nAND s1.ss_ticket_number = s2.ss_ticket_number\nAND s1.ss_item_sk = item1.i_item_sk and s2.ss_item_sk = item2.i_item_sk\nAND s1.ss_customer_sk = c_customer_sk\nand c_current_addr_sk = ca_address_sk\nand c_current_cdemo_sk = cd_demo_sk\nAND d_year between 2000 and 2000 + 1\nand d_date_sk = s1.ss_sold_date_sk\nand item1.i_category in ('Electronics', 'Men')\nand item2.i_manager_id between 81 and 100\nand cd_marital_status = 'S'\nand cd_education_status = 'Secondary'\nand s1.ss_list_price between 16 and 30\nand s2.ss_list_price between 16 and 30\n;",
    "optimized": "WITH date_dim_cte AS (SELECT d_date_sk FROM date_dim WHERE d_year BETWEEN 2000 AND 2000 + 1)\nSELECT MIN(item1.i_item_sk), MIN(item2.i_item_sk), MIN(s1.ss_ticket_number), MIN(s1.ss_item_sk) FROM item AS item1, item AS item2, store_sales AS s1, store_sales AS s2, date_dim, customer, customer_address, customer_demographics WHERE item1.i_item_sk < item2.i_item_sk AND s1.ss_ticket_number = s2.ss_ticket_number AND s1.ss_item_sk = item1.i_item_sk AND s2.ss_item_sk = item2.i_item_sk AND s1.ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND c_current_cdemo_sk = cd_demo_sk AND d_year BETWEEN 2000 AND 2000 + 1 AND d_date_sk = s1.ss_sold_date_sk AND item1.i_category IN ('Electronics', 'Men') AND item2.i_manager_id BETWEEN 81 AND 100 AND cd_marital_status = 'S' AND cd_education_status = 'Secondary' AND s1.ss_list_price BETWEEN 16 AND 30 AND s2.ss_list_price BETWEEN 16 AND 30",
    "transforms": [
      "date_cte_isolate",
      "pushdown",
      "semantic_rewrite"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.84,
    "sf5_original_ms": 12660.65,
    "sf5_optimized_ms": 15096.36
  },
  {
    "query": "query019_agg",
    "source": "ado_round_01",
    "original": "select  i_brand_id brand_id, i_brand brand, i_manufact_id, i_manufact,\n \tsum(ss_ext_sales_price) ext_price\n  from date_dim, store_sales, item,customer,customer_address,store\n  where  d_date_sk = ss_sold_date_sk\n    and ss_item_sk = i_item_sk\n    and ss_customer_sk = c_customer_sk\n    and c_current_addr_sk = ca_address_sk\n    and ss_store_sk = s_store_sk\n    AND i_category  = 'Home'\n    and d_year=2002\n    and d_moy = 12\n    and substring(ca_zip,1,5) <> substring(s_zip,1,5)\n    and ca_state  = 'TX'\n    and c_birth_month = 1\n    and ss_wholesale_cost BETWEEN 34 AND 54\n group by i_brand\n      ,i_brand_id\n      ,i_manufact_id\n      ,i_manufact\n order by ext_price desc\n         ,i_brand\n         ,i_brand_id\n         ,i_manufact_id\n         ,i_manufact\nlimit 100 ;",
    "optimized": "WITH filtered_date AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002 AND d_moy = 12), filtered_item AS (SELECT i_item_sk, i_brand_id, i_brand, i_manufact_id, i_manufact FROM item WHERE i_category = 'Home'), filtered_customer AS (SELECT c_customer_sk, c_current_addr_sk FROM customer WHERE c_birth_month = 1), filtered_address AS (SELECT ca_address_sk, ca_zip FROM customer_address WHERE ca_state = 'TX') SELECT i_brand_id AS brand_id, i_brand AS brand, i_manufact_id, i_manufact, SUM(ss_ext_sales_price) AS ext_price FROM store_sales JOIN filtered_date ON store_sales.ss_sold_date_sk = filtered_date.d_date_sk JOIN filtered_item ON store_sales.ss_item_sk = filtered_item.i_item_sk JOIN filtered_customer ON store_sales.ss_customer_sk = filtered_customer.c_customer_sk JOIN filtered_address ON filtered_customer.c_current_addr_sk = filtered_address.ca_address_sk JOIN store ON store_sales.ss_store_sk = s_store_sk WHERE ss_wholesale_cost BETWEEN 34 AND 54 AND SUBSTRING(filtered_address.ca_zip FROM 1 FOR 5) <> SUBSTRING(store.s_zip FROM 1 FOR 5) GROUP BY i_brand, i_brand_id, i_manufact_id, i_manufact ORDER BY ext_price DESC, i_brand, i_brand_id, i_manufact_id, i_manufact LIMIT 100",
    "transforms": [
      "early_filter"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.83,
    "sf5_original_ms": 75.26,
    "sf5_optimized_ms": 90.71
  },
  {
    "query": "query040_spj_spj",
    "source": "ado_round_01",
    "original": "select\n   min(w_state)\n  ,min(i_item_id)\n  ,min(cs_item_sk)\n  ,min(cs_order_number)\n  ,min(cr_item_sk)\n  ,min(cr_order_number)\n from\n   catalog_sales left outer join catalog_returns on\n       (cs_order_number = cr_order_number\n        and cs_item_sk = cr_item_sk)\n  ,warehouse\n  ,item\n  ,date_dim\n where\n i_item_sk          = cs_item_sk\n and cs_warehouse_sk    = w_warehouse_sk\n and cs_sold_date_sk    = d_date_sk\n and d_date between (cast ('1999-04-19' as date) - interval '30 day')\n                and (cast ('1999-04-19' as date) + interval '30 day') \n and i_category  = 'Home'\n and i_manager_id between 25 and 64\n and cs_wholesale_cost between 17 and 36\n and cr_reason_sk = 16\n;",
    "optimized": "WITH filtered_date AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN (CAST('1999-04-19' AS DATE) - INTERVAL '30 DAY') AND (CAST('1999-04-19' AS DATE) + INTERVAL '30 DAY')), filtered_item AS (SELECT i_item_sk, i_item_id FROM item WHERE i_category = 'Home' AND i_manager_id BETWEEN 25 AND 64), filtered_catalog_sales AS (SELECT cs_item_sk, cs_warehouse_sk, cs_sold_date_sk, cs_order_number, cs_wholesale_cost FROM catalog_sales WHERE cs_wholesale_cost BETWEEN 17 AND 36), filtered_catalog_returns AS (SELECT cr_order_number, cr_item_sk FROM catalog_returns WHERE cr_reason_sk = 16)\nSELECT MIN(w.w_state), MIN(i.i_item_id), MIN(cs.cs_item_sk), MIN(cs.cs_order_number), MIN(cr.cr_item_sk), MIN(cr.cr_order_number) FROM filtered_catalog_sales AS cs JOIN filtered_item AS i ON cs.cs_item_sk = i.i_item_sk JOIN warehouse AS w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN filtered_date AS d ON cs.cs_sold_date_sk = d.d_date_sk LEFT JOIN filtered_catalog_returns AS cr ON (cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk)",
    "transforms": [
      "early_filter",
      "semantic_rewrite"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.82,
    "sf5_original_ms": 67.48,
    "sf5_optimized_ms": 82.51
  },
  {
    "query": "query031_multi",
    "source": "ado_round_01",
    "original": "with ss as\n (select ca_county,d_qoy, d_year,sum(ss_ext_sales_price) as store_sales\n from store_sales,date_dim,customer_address, item\n where ss_sold_date_sk = d_date_sk\n  and ss_addr_sk=ca_address_sk\n  and ss_item_sk = i_item_sk\n  and i_color IN ('blanched', 'rosy')\n  and i_manager_id BETWEEN 16 and 35\n  and ss_list_price between 286 and 300\n  and ca_state in ('TX','VA')\n group by ca_county,d_qoy, d_year),\n ws as\n (select ca_county,d_qoy, d_year,sum(ws_ext_sales_price) as web_sales\n from web_sales,date_dim,customer_address, item\n where ws_sold_date_sk = d_date_sk\n  and ws_bill_addr_sk=ca_address_sk\n  and ws_item_sk = i_item_sk\n  and i_color IN ('blanched', 'rosy')\n  and i_manager_id BETWEEN 16 and 35\n  and ws_list_price between 286 and 300\n  and ca_state in ('TX','VA')\ngroup by ca_county,d_qoy, d_year)\n select\n        ss1.ca_county\n       ,ss1.d_year\n       ,ws2.web_sales/ws1.web_sales web_q1_q2_increase\n       ,ss2.store_sales/ss1.store_sales store_q1_q2_increase\n       ,ws3.web_sales/ws2.web_sales web_q2_q3_increase\n       ,ss3.store_sales/ss2.store_sales store_q2_q3_increase\n from\n        ss ss1\n       ,ss ss2\n       ,ss ss3\n       ,ws ws1\n       ,ws ws2\n       ,ws ws3\n where\n    ss1.d_qoy = 1\n    and ss1.d_year = 1998\n    and ss1.ca_county = ss2.ca_county\n    and ss2.d_qoy = 2\n    and ss2.d_year = 1998\n and ss2.ca_county = ss3.ca_county\n    and ss3.d_qoy = 3\n    and ss3.d_year = 1998\n    and ss1.ca_county = ws1.ca_county\n    and ws1.d_qoy = 1\n    and ws1.d_year = 1998\n    and ws1.ca_county = ws2.ca_county\n    and ws2.d_qoy = 2\n    and ws2.d_year = 1998\n    and ws1.ca_county = ws3.ca_county\n    and ws3.d_qoy = 3\n    and ws3.d_year =1998\n    and case when ws1.web_sales > 0 then ws2.web_sales/ws1.web_sales else null end\n       > case when ss1.store_sales > 0 then ss2.store_sales/ss1.store_sales else null end\n    and case when ws2.web_sales > 0 then ws3.web_sales/ws2.web_sales else null end\n       > case when ss2.store_sales > 0 then ss3.store_sales/ss2.store_sales else null end\n order by web_q1_q2_increase;",
    "optimized": "WITH date_dim_cte AS (SELECT d_date_sk, d_qoy, d_year FROM date_dim WHERE d_year = 1998 AND d_qoy IN (1, 2, 3)), ss AS (SELECT ca_county, d.d_qoy, d.d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales JOIN date_dim_cte AS d ON ss_sold_date_sk = d.d_date_sk JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN item ON ss_item_sk = i_item_sk WHERE i_color IN ('blanched', 'rosy') AND i_manager_id BETWEEN 16 AND 35 AND ss_list_price BETWEEN 286 AND 300 AND ca_state IN ('TX', 'VA') GROUP BY ca_county, d.d_qoy, d.d_year), ws AS (SELECT ca_county, d.d_qoy, d.d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales JOIN date_dim_cte AS d ON ws_sold_date_sk = d.d_date_sk JOIN customer_address ON ws_bill_addr_sk = ca_address_sk JOIN item ON ws_item_sk = i_item_sk WHERE i_color IN ('blanched', 'rosy') AND i_manager_id BETWEEN 16 AND 35 AND ws_list_price BETWEEN 286 AND 300 AND ca_state IN ('TX', 'VA') GROUP BY ca_county, d.d_qoy, d.d_year)\nSELECT ss1.ca_county, ss1.d_year, ws2.web_sales / ws1.web_sales AS web_q1_q2_increase, ss2.store_sales / ss1.store_sales AS store_q1_q2_increase, ws3.web_sales / ws2.web_sales AS web_q2_q3_increase, ss3.store_sales / ss2.store_sales AS store_q2_q3_increase FROM ss AS ss1, ss AS ss2, ss AS ss3, ws AS ws1, ws AS ws2, ws AS ws3 WHERE ss1.d_qoy = 1 AND ss1.d_year = 1998 AND ss1.ca_county = ss2.ca_county AND ss2.d_qoy = 2 AND ss2.d_year = 1998 AND ss2.ca_county = ss3.ca_county AND ss3.d_qoy = 3 AND ss3.d_year = 1998 AND ss1.ca_county = ws1.ca_county AND ws1.d_qoy = 1 AND ws1.d_year = 1998 AND ws1.ca_county = ws2.ca_county AND ws2.d_qoy = 2 AND ws2.d_year = 1998 AND ws1.ca_county = ws3.ca_county AND ws3.d_qoy = 3 AND ws3.d_year = 1998 AND CASE WHEN ws1.web_sales > 0 THEN ws2.web_sales / ws1.web_sales ELSE NULL END > CASE WHEN ss1.store_sales > 0 THEN ss2.store_sales / ss1.store_sales ELSE NULL END AND CASE WHEN ws2.web_sales > 0 THEN ws3.web_sales / ws2.web_sales ELSE NULL END > CASE WHEN ss2.store_sales > 0 THEN ss3.store_sales / ss2.store_sales ELSE NULL END ORDER BY web_q1_q2_increase",
    "transforms": [
      "date_cte_isolate"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.77,
    "sf5_original_ms": 1691.11,
    "sf5_optimized_ms": 2198.78
  },
  {
    "query": "query038_multi",
    "source": "ado_round_01",
    "original": "select  count(*) from (\n    select distinct c_last_name, c_first_name, d_date\n    from store_sales, date_dim, customer\n          where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n      and store_sales.ss_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1189 and 1189 + 11\n      and c_birth_month in (4, 9, 10, 12)\n      and ss_list_price between 25 and 84\n      and ss_wholesale_cost BETWEEN 34 AND 54\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from catalog_sales, date_dim, customer\n          where catalog_sales.cs_sold_date_sk = date_dim.d_date_sk\n      and catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1189 and 1189 + 11\n      and c_birth_month in (4, 9, 10, 12)\n      and cs_list_price between 25 and 84\n      and cs_wholesale_cost BETWEEN 34 AND 54\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from web_sales, date_dim, customer\n          where web_sales.ws_sold_date_sk = date_dim.d_date_sk\n      and web_sales.ws_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1189 and 1189 + 11\n      and c_birth_month in (4, 9, 10, 12)\n      and ws_list_price between 25 and 84\n      and ws_wholesale_cost BETWEEN 34 AND 54\n) hot_cust\nlimit 100;",
    "optimized": "WITH filtered_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq BETWEEN 1189 AND 1189 + 11) SELECT COUNT(*) FROM (SELECT DISTINCT c_last_name, c_first_name, d_date FROM store_sales JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk JOIN customer ON store_sales.ss_customer_sk = customer.c_customer_sk WHERE c_birth_month IN (4, 9, 10, 12) AND ss_list_price BETWEEN 25 AND 84 AND ss_wholesale_cost BETWEEN 34 AND 54 INTERSECT SELECT DISTINCT c_last_name, c_first_name, d_date FROM catalog_sales JOIN filtered_dates ON catalog_sales.cs_sold_date_sk = filtered_dates.d_date_sk JOIN customer ON catalog_sales.cs_bill_customer_sk = customer.c_customer_sk WHERE c_birth_month IN (4, 9, 10, 12) AND cs_list_price BETWEEN 25 AND 84 AND cs_wholesale_cost BETWEEN 34 AND 54 INTERSECT SELECT DISTINCT c_last_name, c_first_name, d_date FROM web_sales JOIN filtered_dates ON web_sales.ws_sold_date_sk = filtered_dates.d_date_sk JOIN customer ON web_sales.ws_bill_customer_sk = customer.c_customer_sk WHERE c_birth_month IN (4, 9, 10, 12) AND ws_list_price BETWEEN 25 AND 84 AND ws_wholesale_cost BETWEEN 34 AND 54) AS hot_cust LIMIT 100",
    "transforms": [
      "date_cte_isolate",
      "early_filter"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.61,
    "sf5_original_ms": 5548.19,
    "sf5_optimized_ms": 9042.64
  },
  {
    "query": "query087_multi",
    "source": "ado_round_01",
    "original": "select count(*)\nfrom ((select distinct c_last_name, c_first_name, d_date\n       from store_sales, date_dim, customer\n       where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n         and store_sales.ss_customer_sk = customer.c_customer_sk\n         and d_month_seq between 1194 and 1194+11\n         and ss_list_price between 217 and 246\n         and c_birth_year BETWEEN 1943 AND 1949\n         and ss_wholesale_cost BETWEEN 34 AND 44\n         )\n       except\n      (select distinct c_last_name, c_first_name, d_date\n       from catalog_sales, date_dim, customer\n       where catalog_sales.cs_sold_date_sk = date_dim.d_date_sk\n         and catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n         and d_month_seq between 1194 and 1194+11\n         and cs_list_price between 217 and 246\n         and c_birth_year BETWEEN 1943 AND 1949\n         and cs_wholesale_cost BETWEEN 34 AND 44\n         )\n       except\n      (select distinct c_last_name, c_first_name, d_date\n       from web_sales, date_dim, customer\n       where web_sales.ws_sold_date_sk = date_dim.d_date_sk\n         and web_sales.ws_bill_customer_sk = customer.c_customer_sk\n         and d_month_seq between 1194 and 1194+11\n         and ws_list_price between 217 and 246\n         and c_birth_year BETWEEN 1943 AND 1949\n         and ws_wholesale_cost BETWEEN 34 AND 44\n         )\n) cool_cust\n;",
    "optimized": "WITH filtered_date AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq BETWEEN 1194 AND 1194 + 11), filtered_customer AS (SELECT c_customer_sk, c_last_name, c_first_name FROM customer WHERE c_birth_year BETWEEN 1943 AND 1949), store_sales_data AS (SELECT DISTINCT c_last_name, c_first_name, d_date FROM store_sales JOIN filtered_date ON store_sales.ss_sold_date_sk = filtered_date.d_date_sk JOIN filtered_customer ON store_sales.ss_customer_sk = filtered_customer.c_customer_sk WHERE ss_list_price BETWEEN 217 AND 246 AND ss_wholesale_cost BETWEEN 34 AND 44), catalog_sales_data AS (SELECT DISTINCT c_last_name, c_first_name, d_date FROM catalog_sales JOIN filtered_date ON catalog_sales.cs_sold_date_sk = filtered_date.d_date_sk JOIN filtered_customer ON catalog_sales.cs_bill_customer_sk = filtered_customer.c_customer_sk WHERE cs_list_price BETWEEN 217 AND 246 AND cs_wholesale_cost BETWEEN 34 AND 44), web_sales_data AS (SELECT DISTINCT c_last_name, c_first_name, d_date FROM web_sales JOIN filtered_date ON web_sales.ws_sold_date_sk = filtered_date.d_date_sk JOIN filtered_customer ON web_sales.ws_bill_customer_sk = filtered_customer.c_customer_sk WHERE ws_list_price BETWEEN 217 AND 246 AND ws_wholesale_cost BETWEEN 34 AND 44) SELECT COUNT(*) FROM ((SELECT * FROM store_sales_data) EXCEPT (SELECT * FROM catalog_sales_data) EXCEPT (SELECT * FROM web_sales_data)) AS cool_cust",
    "transforms": [
      "date_cte_isolate",
      "reorder_join"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.57,
    "sf5_original_ms": 4194.49,
    "sf5_optimized_ms": 7310.17
  },
  {
    "query": "query091_spj_spj",
    "source": "ado_round_01",
    "original": "select  \n        min(cc_call_center_id),\n        min(cc_name),\n        min(cc_manager),\n        min(cr_net_loss),\n        min(cr_item_sk),\n        min(cr_order_number)\nfrom\n        call_center,\n        catalog_returns,\n        date_dim,\n        customer,\n        customer_address,\n        customer_demographics,\n        household_demographics\nwhere\n        cr_call_center_sk       = cc_call_center_sk\nand     cr_returned_date_sk     = d_date_sk\nand     cr_returning_customer_sk= c_customer_sk\nand     cd_demo_sk              = c_current_cdemo_sk\nand     hd_demo_sk              = c_current_hdemo_sk\nand     ca_address_sk           = c_current_addr_sk\nand     d_year                  = 1999 \nand     d_moy                   = 1\nand     ( (cd_marital_status       = 'M' and cd_education_status     = 'Unknown')\n        or(cd_marital_status       = 'W' and cd_education_status     = 'Advanced Degree'))\nand     hd_buy_potential like '1001-5000%'\nand     ca_gmt_offset           = -7\n;",
    "optimized": "WITH filtered_date AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy = 1), filtered_ca AS (SELECT ca_address_sk FROM customer_address WHERE ca_gmt_offset = -7), filtered_hd AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential LIKE '1001-5000%'), cd_branch1 AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_marital_status = 'M' AND cd_education_status = 'Unknown'), cd_branch2 AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree'), customer_branch1 AS (SELECT c_customer_sk FROM customer JOIN filtered_ca ON ca_address_sk = c_current_addr_sk JOIN cd_branch1 ON cd_demo_sk = c_current_cdemo_sk JOIN filtered_hd ON hd_demo_sk = c_current_hdemo_sk), customer_branch2 AS (SELECT c_customer_sk FROM customer JOIN filtered_ca ON ca_address_sk = c_current_addr_sk JOIN cd_branch2 ON cd_demo_sk = c_current_cdemo_sk JOIN filtered_hd ON hd_demo_sk = c_current_hdemo_sk), branch1_data AS (SELECT cc_call_center_id, cc_name, cc_manager, cr_net_loss, cr_item_sk, cr_order_number FROM call_center JOIN catalog_returns ON cr_call_center_sk = cc_call_center_sk JOIN filtered_date ON cr_returned_date_sk = d_date_sk JOIN customer_branch1 ON cr_returning_customer_sk = c_customer_sk), branch2_data AS (SELECT cc_call_center_id, cc_name, cc_manager, cr_net_loss, cr_item_sk, cr_order_number FROM call_center JOIN catalog_returns ON cr_call_center_sk = cc_call_center_sk JOIN filtered_date ON cr_returned_date_sk = d_date_sk JOIN customer_branch2 ON cr_returning_customer_sk = c_customer_sk), combined_data AS (SELECT * FROM branch1_data UNION ALL SELECT * FROM branch2_data) SELECT MIN(cc_call_center_id), MIN(cc_name), MIN(cc_manager), MIN(cr_net_loss), MIN(cr_item_sk), MIN(cr_order_number) FROM combined_data",
    "transforms": [
      "or_to_union"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.27,
    "sf5_original_ms": 843.93,
    "sf5_optimized_ms": 3153.06
  },
  {
    "query": "query101_agg",
    "source": "ado_round_01",
    "original": "select  c_customer_sk, c_first_name, c_last_name, count(*) as cnt\nFROM\nstore_sales,\nstore_returns,\nweb_sales,\ndate_dim d1,\ndate_dim d2,\nitem,\ncustomer,\ncustomer_address,\nhousehold_demographics\nWHERE\nss_ticket_number = sr_ticket_number\nAND ss_customer_sk = ws_bill_customer_sk\nAND ss_customer_sk = c_customer_sk\nAND c_current_addr_sk = ca_address_sk\nAND c_current_hdemo_sk = hd_demo_sk\nAND ss_item_sk = sr_item_sk\nAND sr_item_sk = ws_item_sk\nAND i_item_sk = ss_item_sk\nAND i_category IN ('Children', 'Electronics', 'Women')\nAND sr_returned_date_sk = d1.d_date_sk\nAND ws_sold_date_sk = d2.d_date_sk\nAND d2.d_date between d1.d_date AND (d1.d_date + interval '90 day')\nAND ca_state in ('GA', 'IA', 'LA', 'MO', 'SD')\nAND d1.d_year = 2000\nAND hd_income_band_sk BETWEEN 12 AND 18\nAND hd_buy_potential = '0-500'\nAND ss_sales_price / ss_list_price BETWEEN 34 * 0.01 AND 54 * 0.01\nGROUP BY c_customer_sk, c_first_name, c_last_name\nORDER BY cnt\n;",
    "optimized": "WITH filtered_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2000) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales JOIN store_returns ON ss_ticket_number = sr_ticket_number JOIN web_sales ON ss_customer_sk = ws_bill_customer_sk JOIN filtered_dates AS d1 ON sr_returned_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws_sold_date_sk = d2.d_date_sk JOIN item ON i_item_sk = ss_item_sk JOIN customer ON ss_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk WHERE i_category IN ('Children', 'Electronics', 'Women') AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ca_state IN ('GA', 'IA', 'LA', 'MO', 'SD') AND hd_income_band_sk BETWEEN 12 AND 18 AND hd_buy_potential = '0-500' AND ss_sales_price / ss_list_price BETWEEN 34 * 0.01 AND 54 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt",
    "transforms": [
      "date_cte_isolate"
    ],
    "sf5_status": "FAIL",
    "sf5_speedup": 0.25,
    "sf5_original_ms": 14804.12,
    "sf5_optimized_ms": 60113.45
  },
  {
    "query": "query069_multi",
    "source": "ado_round_01",
    "original": "select \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  count(*) cnt1,\n  cd_purchase_estimate,\n  count(*) cnt2,\n  cd_credit_rating,\n  count(*) cnt3\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  ca_state in ('IA','MO','TX') and\n  cd_demo_sk = c.c_current_cdemo_sk\n  and cd_marital_status in ('S', 'S', 'S')\n  and cd_education_status in ('Primary', 'Secondary') and\n  exists (select *\n          from store_sales,date_dim\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 2002 and\n                d_moy between 3 and 3+2\n                and ss_list_price between 100 and 189\n          ) and\n   (not exists (select *\n            from web_sales,date_dim\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 2002 and\n                  d_moy between 3 and 3+2\n                  and ws_list_price between 100 and 189\n            ) and\n    not exists (select *\n            from catalog_sales,date_dim\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 2002 and\n                  d_moy between 3 and 3+2\n                  and cs_list_price between 100 and 189)\n            )\n group by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n order by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n limit 100;",
    "optimized": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002 AND d_moy BETWEEN 3 AND 3 + 2), store_customers AS (SELECT DISTINCT ss_customer_sk FROM store_sales JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk WHERE ss_list_price BETWEEN 100 AND 189), web_customers AS (SELECT DISTINCT ws_bill_customer_sk FROM web_sales JOIN filtered_dates ON web_sales.ws_sold_date_sk = filtered_dates.d_date_sk WHERE ws_list_price BETWEEN 100 AND 189), catalog_customers AS (SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales JOIN filtered_dates ON catalog_sales.cs_sold_date_sk = filtered_dates.d_date_sk WHERE cs_list_price BETWEEN 100 AND 189) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics ON cd_demo_sk = c.c_current_cdemo_sk WHERE ca_state IN ('IA', 'MO', 'TX') AND cd_marital_status IN ('S', 'S', 'S') AND cd_education_status IN ('Primary', 'Secondary') AND c.c_customer_sk IN (SELECT ss_customer_sk FROM store_customers) AND NOT c.c_customer_sk IN (SELECT ws_bill_customer_sk FROM web_customers) AND NOT c.c_customer_sk IN (SELECT cs_ship_customer_sk FROM catalog_customers) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100",
    "transforms": [
      "date_cte_isolate"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.2,
    "sf5_original_ms": 435.62,
    "sf5_optimized_ms": 2136.67
  },
  {
    "query": "query085_agg",
    "source": "ado_round_01",
    "original": "select  substring(r_reason_desc,1,20)\n       ,avg(ws_quantity)\n       ,avg(wr_refunded_cash)\n       ,avg(wr_fee)\n from web_sales, web_returns, web_page, customer_demographics cd1,\n      customer_demographics cd2, customer_address, date_dim, reason\n where ws_web_page_sk = wp_web_page_sk\n   and ws_item_sk = wr_item_sk\n   and ws_order_number = wr_order_number\n   and ws_sold_date_sk = d_date_sk and d_year = 1998\n   and cd1.cd_demo_sk = wr_refunded_cdemo_sk\n   and cd2.cd_demo_sk = wr_returning_cdemo_sk\n   and ca_address_sk = wr_refunded_addr_sk\n   and r_reason_sk = wr_reason_sk\n   and\n   (\n    (\n     cd1.cd_marital_status = 'D'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Secondary'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 100.00 and 150.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'M'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = '4 yr Degree'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 50.00 and 100.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'U'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Unknown'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 150.00 and 200.00\n    )\n   )\n   and\n   (\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('IA', 'PA', 'TX')\n     and ws_net_profit between 100 and 200\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('GA', 'MO', 'SD')\n     and ws_net_profit between 150 and 300\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('LA', 'TX', 'VA')\n     and ws_net_profit between 50 and 250\n    )\n   )\ngroup by r_reason_desc\norder by substring(r_reason_desc,1,20)\n        ,avg(ws_quantity)\n        ,avg(wr_refunded_cash)\n        ,avg(wr_fee)\nlimit 100;",
    "optimized": "WITH date_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998), branch1 AS (SELECT ws_quantity, wr_refunded_cash, wr_fee, r_reason_desc FROM web_sales JOIN web_returns ON ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number JOIN web_page ON ws_web_page_sk = wp_web_page_sk JOIN customer_demographics AS cd1 ON cd1.cd_demo_sk = wr_refunded_cdemo_sk JOIN customer_demographics AS cd2 ON cd2.cd_demo_sk = wr_returning_cdemo_sk AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = cd2.cd_education_status JOIN customer_address ON ca_address_sk = wr_refunded_addr_sk JOIN date_filtered ON ws_sold_date_sk = date_filtered.d_date_sk JOIN reason ON r_reason_sk = wr_reason_sk WHERE cd1.cd_marital_status = 'D' AND cd1.cd_education_status = 'Secondary' AND ws_sales_price BETWEEN 100.00 AND 150.00 AND ((ca_country = 'United States' AND ca_state IN ('IA', 'PA', 'TX') AND ws_net_profit BETWEEN 100 AND 200) OR (ca_country = 'United States' AND ca_state IN ('GA', 'MO', 'SD') AND ws_net_profit BETWEEN 150 AND 300) OR (ca_country = 'United States' AND ca_state IN ('LA', 'TX', 'VA') AND ws_net_profit BETWEEN 50 AND 250))), branch2 AS (SELECT ws_quantity, wr_refunded_cash, wr_fee, r_reason_desc FROM web_sales JOIN web_returns ON ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number JOIN web_page ON ws_web_page_sk = wp_web_page_sk JOIN customer_demographics AS cd1 ON cd1.cd_demo_sk = wr_refunded_cdemo_sk JOIN customer_demographics AS cd2 ON cd2.cd_demo_sk = wr_returning_cdemo_sk AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = cd2.cd_education_status JOIN customer_address ON ca_address_sk = wr_refunded_addr_sk JOIN date_filtered ON ws_sold_date_sk = date_filtered.d_date_sk JOIN reason ON r_reason_sk = wr_reason_sk WHERE cd1.cd_marital_status = 'M' AND cd1.cd_education_status = '4 yr Degree' AND ws_sales_price BETWEEN 50.00 AND 100.00 AND ((ca_country = 'United States' AND ca_state IN ('IA', 'PA', 'TX') AND ws_net_profit BETWEEN 100 AND 200) OR (ca_country = 'United States' AND ca_state IN ('GA', 'MO', 'SD') AND ws_net_profit BETWEEN 150 AND 300) OR (ca_country = 'United States' AND ca_state IN ('LA', 'TX', 'VA') AND ws_net_profit BETWEEN 50 AND 250))), branch3 AS (SELECT ws_quantity, wr_refunded_cash, wr_fee, r_reason_desc FROM web_sales JOIN web_returns ON ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number JOIN web_page ON ws_web_page_sk = wp_web_page_sk JOIN customer_demographics AS cd1 ON cd1.cd_demo_sk = wr_refunded_cdemo_sk JOIN customer_demographics AS cd2 ON cd2.cd_demo_sk = wr_returning_cdemo_sk AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = cd2.cd_education_status JOIN customer_address ON ca_address_sk = wr_refunded_addr_sk JOIN date_filtered ON ws_sold_date_sk = date_filtered.d_date_sk JOIN reason ON r_reason_sk = wr_reason_sk WHERE cd1.cd_marital_status = 'U' AND cd1.cd_education_status = 'Unknown' AND ws_sales_price BETWEEN 150.00 AND 200.00 AND ((ca_country = 'United States' AND ca_state IN ('IA', 'PA', 'TX') AND ws_net_profit BETWEEN 100 AND 200) OR (ca_country = 'United States' AND ca_state IN ('GA', 'MO', 'SD') AND ws_net_profit BETWEEN 150 AND 300) OR (ca_country = 'United States' AND ca_state IN ('LA', 'TX', 'VA') AND ws_net_profit BETWEEN 50 AND 250))) SELECT SUBSTRING(r_reason_desc FROM 1 FOR 20), AVG(ws_quantity), AVG(wr_refunded_cash), AVG(wr_fee) FROM (SELECT * FROM branch1 UNION ALL SELECT * FROM branch2 UNION ALL SELECT * FROM branch3) AS union_result GROUP BY r_reason_desc ORDER BY SUBSTRING(r_reason_desc FROM 1 FOR 20), AVG(ws_quantity), AVG(wr_refunded_cash), AVG(wr_fee) LIMIT 100",
    "transforms": [
      "or_to_union"
    ],
    "sf5_status": "PASS",
    "sf5_speedup": 0.2,
    "sf5_original_ms": 1275.12,
    "sf5_optimized_ms": 6345.7
  },
  {
    "query": "query001_multi",
    "source": "ado_round_01",
    "original": "with customer_total_return as\n(select sr_customer_sk as ctr_customer_sk\n,sr_store_sk as ctr_store_sk\n,sr_reason_sk as ctr_reason_sk\n,sum(SR_REFUNDED_CASH) as ctr_total_return\nfrom store_returns\n,date_dim\nwhere sr_returned_date_sk = d_date_sk\nand d_year =2000\nand sr_return_amt / sr_return_quantity between 16 and 75\ngroup by sr_customer_sk\n,sr_store_sk, sr_reason_sk)\n select  c_customer_id\nfrom customer_total_return ctr1\n,store\n,customer\n,customer_demographics\nwhere ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2\nfrom customer_total_return ctr2\nwhere ctr1.ctr_store_sk = ctr2.ctr_store_sk\n)\nand ctr1.ctr_reason_sk BETWEEN 25 AND 28\nand s_store_sk = ctr1.ctr_store_sk\nand s_state IN ('MI', 'ND', 'TX')\nand ctr1.ctr_customer_sk = c_customer_sk\nand c_current_cdemo_sk = cd_demo_sk\nand cd_marital_status IN ('M', 'M')\nand cd_education_status IN ('College', 'College')\nand cd_gender = 'M'\nand c_birth_month = 9\nand c_birth_year BETWEEN 1979 AND 1985\norder by c_customer_id\nlimit 100;",
    "optimized": "WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_REFUNDED_CASH) AS ctr_total_return FROM store_returns JOIN date_dim ON sr_returned_date_sk = d_date_sk WHERE d_year = 2000 AND sr_return_amt / sr_return_quantity BETWEEN 16 AND 75 GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk), store_avg_returns AS (SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS avg_return_threshold FROM customer_total_return GROUP BY ctr_store_sk) SELECT c_customer_id FROM customer_total_return AS ctr1 JOIN store_avg_returns AS avg ON ctr1.ctr_store_sk = avg.ctr_store_sk JOIN store ON s_store_sk = ctr1.ctr_store_sk JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk WHERE ctr1.ctr_total_return > avg.avg_return_threshold AND ctr1.ctr_reason_sk BETWEEN 25 AND 28 AND s_state IN ('MI', 'ND', 'TX') AND cd_marital_status IN ('M', 'M') AND cd_education_status IN ('College', 'College') AND cd_gender = 'M' AND c_birth_month = 9 AND c_birth_year BETWEEN 1979 AND 1985 ORDER BY c_customer_id LIMIT 100",
    "transforms": [
      "decorrelate"
    ],
    "sf5_status": "ERROR",
    "sf5_speedup": 0.0,
    "sf5_original_ms": 0.0,
    "sf5_optimized_ms": 0.0
  },
  {
    "query": "query032_multi",
    "source": "ado_round_01",
    "original": "select  sum(cs_ext_discount_amt)  as \"excess discount amount\"\nfrom\n   catalog_sales\n   ,item\n   ,date_dim\nwhere\n(i_manufact_id in (1, 78, 97, 516, 521)\nor i_manager_id BETWEEN 25 and 54)\nand i_item_sk = cs_item_sk\nand d_date between '1999-03-07' and\n        cast('1999-03-07' as date) + interval '90 day'\nand d_date_sk = cs_sold_date_sk\nand cs_ext_discount_amt\n     > (\n         select\n            1.3 * avg(cs_ext_discount_amt)\n         from\n            catalog_sales\n           ,date_dim\n         where\n              cs_item_sk = i_item_sk\n          and d_date between '1999-03-07' and\n                             cast('1999-03-07' as date) + interval '90 day'\n          and d_date_sk = cs_sold_date_sk\n          and cs_list_price between 16 and 45\n          and cs_sales_price / cs_list_price BETWEEN 63 * 0.01 AND 83 * 0.01\n      )\norder by sum(cs_ext_discount_amt)\nlimit 100;",
    "optimized": "WITH date_filter AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1999-03-07' AND CAST('1999-03-07' AS DATE) + INTERVAL '90 DAY'), filtered_items AS (SELECT i_item_sk FROM item WHERE (i_manufact_id IN (1, 78, 97, 516, 521) OR i_manager_id BETWEEN 25 AND 54)), item_avg_discount AS (SELECT cs_item_sk, 1.3 * AVG(cs_ext_discount_amt) AS avg_disc FROM catalog_sales JOIN date_filter ON cs_sold_date_sk = d_date_sk WHERE cs_list_price BETWEEN 16 AND 45 AND cs_sales_price / cs_list_price BETWEEN 63 * 0.01 AND 83 * 0.01 GROUP BY cs_item_sk) SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales AS cs JOIN filtered_items AS i ON cs.cs_item_sk = i.i_item_sk JOIN date_filter AS d ON cs.cs_sold_date_sk = d.d_date_sk LEFT JOIN item_avg_discount AS avg ON cs.cs_item_sk = avg.cs_item_sk WHERE cs_ext_discount_amt > COALESCE(avg.avg_disc, 0) ORDER BY SUM(cs_ext_discount_amt) LIMIT 100",
    "transforms": [
      "decorrelate"
    ],
    "sf5_status": "ERROR",
    "sf5_speedup": 0.0,
    "sf5_original_ms": 0.0,
    "sf5_optimized_ms": 0.0
  },
  {
    "query": "query039_multi",
    "source": "ado_round_01",
    "original": "with inv as\n(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n       ,stdev,mean, case mean when 0 then null else stdev/mean end cov\n from(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n            ,stddev_samp(inv_quantity_on_hand) stdev,avg(inv_quantity_on_hand) mean\n      from inventory\n          ,item\n          ,warehouse\n          ,date_dim\n      where inv_item_sk = i_item_sk\n        and inv_warehouse_sk = w_warehouse_sk\n        and inv_date_sk = d_date_sk\n        and d_year =2002\n        and i_category IN ('Home', 'Men')\n        and i_manager_id BETWEEN 25 and 44\n        and inv_quantity_on_hand between 140 and 340\n      group by w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy) foo\n where case mean when 0 then 0 else stdev/mean end > 1)\nselect inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean, inv1.cov\n        ,inv2.w_warehouse_sk,inv2.i_item_sk,inv2.d_moy,inv2.mean, inv2.cov\nfrom inv inv1,inv inv2\nwhere inv1.i_item_sk = inv2.i_item_sk\n  and inv1.w_warehouse_sk =  inv2.w_warehouse_sk\n  and inv1.d_moy=10\n  and inv2.d_moy=10+1\norder by inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean,inv1.cov\n        ,inv2.d_moy,inv2.mean, inv2.cov\n;\nwith inv as\n(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n       ,stdev,mean, case mean when 0 then null else stdev/mean end cov\n from(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n            ,stddev_samp(inv_quantity_on_hand) stdev,avg(inv_quantity_on_hand) mean\n      from inventory\n          ,item\n          ,warehouse\n          ,date_dim\n      where inv_item_sk = i_item_sk\n        and inv_warehouse_sk = w_warehouse_sk\n        and inv_date_sk = d_date_sk\n        and d_year =2002\n        and i_category IN ('Home', 'Men')\n        and i_manager_id BETWEEN 25 and 44\n        and inv_quantity_on_hand between 140 and 340\n      group by w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy) foo\n where case mean when 0 then 0 else stdev/mean end > 1)\nselect inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean, inv1.cov\n        ,inv2.w_warehouse_sk,inv2.i_item_sk,inv2.d_moy,inv2.mean, inv2.cov\nfrom inv inv1,inv inv2\nwhere inv1.i_item_sk = inv2.i_item_sk\n  and inv1.w_warehouse_sk =  inv2.w_warehouse_sk\n  and inv1.d_moy=10\n  and inv2.d_moy=10+1\n  and inv1.cov > 1.5\norder by inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean,inv1.cov\n        ,inv2.d_moy,inv2.mean, inv2.cov\n;",
    "optimized": "WITH inv AS (WITH date_filtered AS (SELECT d_date_sk, d_moy FROM date_dim WHERE d_year = 2002 AND d_moy IN (10, 11)), item_filtered AS (SELECT i_item_sk FROM item WHERE i_category IN ('Home', 'Men') AND i_manager_id BETWEEN 25 AND 44) SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, stdev, mean, cov FROM (SELECT MAX(w.w_warehouse_name) AS w_warehouse_name, w.w_warehouse_sk, i.i_item_sk, df.d_moy, STDDEV_SAMP(inv.inv_quantity_on_hand) AS stdev, AVG(inv.inv_quantity_on_hand) AS mean FROM inventory AS inv JOIN date_filtered AS df ON inv.inv_date_sk = df.d_date_sk JOIN item_filtered AS i ON inv.inv_item_sk = i.i_item_sk JOIN warehouse AS w ON inv.inv_warehouse_sk = w.w_warehouse_sk WHERE inv.inv_quantity_on_hand BETWEEN 140 AND 340 GROUP BY w.w_warehouse_sk, i.i_item_sk, df.d_moy) AS foo WHERE CASE mean WHEN 0 THEN 0 ELSE stdev / mean END > 1)\nSELECT inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov, inv2.w_warehouse_sk, inv2.i_item_sk, inv2.d_moy, inv2.mean, inv2.cov FROM inv AS inv1, inv AS inv2 WHERE inv1.i_item_sk = inv2.i_item_sk AND inv1.w_warehouse_sk = inv2.w_warehouse_sk AND inv1.d_moy = 10 AND inv2.d_moy = 10 + 1 ORDER BY inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov, inv2.d_moy, inv2.mean, inv2.cov",
    "transforms": [
      "semantic_rewrite"
    ],
    "sf5_status": "ERROR",
    "sf5_speedup": 0.0,
    "sf5_original_ms": 0.0,
    "sf5_optimized_ms": 0.0
  },
  {
    "query": "query072_agg",
    "source": "ado_round_01",
    "original": "select  i_item_desc\n      ,w_warehouse_name\n      ,d1.d_week_seq\n      ,sum(case when p_promo_sk is null then 1 else 0 end) no_promo\n      ,sum(case when p_promo_sk is not null then 1 else 0 end) promo\n      ,count(*) total_cnt\nfrom catalog_sales\njoin inventory on (cs_item_sk = inv_item_sk)\njoin warehouse on (w_warehouse_sk=inv_warehouse_sk)\njoin item on (i_item_sk = cs_item_sk)\njoin customer_demographics on (cs_bill_cdemo_sk = cd_demo_sk)\njoin household_demographics on (cs_bill_hdemo_sk = hd_demo_sk)\njoin date_dim d1 on (cs_sold_date_sk = d1.d_date_sk)\njoin date_dim d2 on (inv_date_sk = d2.d_date_sk)\njoin date_dim d3 on (cs_ship_date_sk = d3.d_date_sk)\nleft outer join promotion on (cs_promo_sk=p_promo_sk)\nleft outer join catalog_returns on (cr_item_sk = cs_item_sk and cr_order_number = cs_order_number)\nwhere d1.d_week_seq = d2.d_week_seq\n  and inv_quantity_on_hand < cs_quantity\n  and d3.d_date > d1.d_date + interval '3 day'\n  and hd_buy_potential = '501-1000'\n  and d1.d_year = 1998\n  and cd_marital_status = 'M'\n  and cd_dep_count between 9 and 11\n  and i_category IN ('Home', 'Men', 'Music')\n  and cs_wholesale_cost BETWEEN 34 AND 54\ngroup by i_item_desc,w_warehouse_name,d1.d_week_seq\norder by total_cnt desc, i_item_desc, w_warehouse_name, d_week_seq\nlimit 100;",
    "optimized": "WITH filtered_dates AS (SELECT d_date_sk, d_week_seq, d_date\n  FROM date_dim\n  WHERE d_year = 1998\n)\nSELECT i_item_desc, w_warehouse_name, fd1.d_week_seq, SUM(CASE WHEN p_promo_sk IS NULL THEN 1 ELSE 0 END) AS no_promo, SUM(CASE WHEN NOT p_promo_sk IS NULL THEN 1 ELSE 0 END) AS promo, COUNT(*) AS total_cnt FROM catalog_sales JOIN inventory ON (cs_item_sk = inv_item_sk) JOIN warehouse ON (w_warehouse_sk = inv_warehouse_sk) JOIN item ON (i_item_sk = cs_item_sk) JOIN customer_demographics ON (cs_bill_cdemo_sk = cd_demo_sk) JOIN household_demographics ON (cs_bill_hdemo_sk = hd_demo_sk) JOIN filtered_dates AS fd1 ON (cs_sold_date_sk = fd1.d_date_sk) JOIN date_dim AS d2 ON (inv_date_sk = d2.d_date_sk) JOIN date_dim AS d3 ON (cs_ship_date_sk = d3.d_date_sk) LEFT OUTER JOIN promotion ON (cs_promo_sk = p_promo_sk) LEFT OUTER JOIN catalog_returns ON (cr_item_sk = cs_item_sk AND cr_order_number = cs_order_number) WHERE fd1.d_week_seq = d2.d_week_seq AND inv_quantity_on_hand < cs_quantity AND d3.d_date > fd1.d_date + INTERVAL '3 DAY' AND hd_buy_potential = '501-1000' AND cd_marital_status = 'M' AND cd_dep_count BETWEEN 9 AND 11 AND i_category IN ('Home', 'Men', 'Music') AND cs_wholesale_cost BETWEEN 34 AND 54 GROUP BY i_item_desc, w_warehouse_name, fd1.d_week_seq ORDER BY total_cnt DESC, i_item_desc, w_warehouse_name, fd1.d_week_seq LIMIT 100",
    "transforms": [
      "date_cte_isolate",
      "early_filter"
    ]
  },
  {
    "query": "query075_multi",
    "source": "ado_round_01",
    "original": "WITH all_sales AS (\n SELECT d_year\n       ,i_brand_id\n       ,i_class_id\n       ,i_category_id\n       ,i_manufact_id\n       ,SUM(sales_cnt) AS sales_cnt\n       ,SUM(sales_amt) AS sales_amt\n FROM (SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,cs_quantity - COALESCE(cr_return_quantity,0) AS sales_cnt\n             ,cs_ext_sales_price - COALESCE(cr_return_amount,0.0) AS sales_amt\n       FROM catalog_sales JOIN item ON i_item_sk=cs_item_sk\n                          JOIN date_dim ON d_date_sk=cs_sold_date_sk\n                          LEFT JOIN catalog_returns ON (cs_order_number=cr_order_number\n                                                    AND cs_item_sk=cr_item_sk)\n       WHERE i_category='Music'\n       and cs_sales_price / cs_list_price BETWEEN 33 * 0.01 AND 53 * 0.01\n       and cr_reason_sk in (17, 48, 50, 56, 68)\n       UNION\n       SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,ss_quantity - COALESCE(sr_return_quantity,0) AS sales_cnt\n             ,ss_ext_sales_price - COALESCE(sr_return_amt,0.0) AS sales_amt\n       FROM store_sales JOIN item ON i_item_sk=ss_item_sk\n                        JOIN date_dim ON d_date_sk=ss_sold_date_sk\n                        LEFT JOIN store_returns ON (ss_ticket_number=sr_ticket_number\n                                                AND ss_item_sk=sr_item_sk)\n       WHERE i_category='Music'\n       and ss_sales_price / ss_list_price BETWEEN 33 * 0.01 AND 53 * 0.01\n       and sr_reason_sk in (17, 48, 50, 56, 68)\n       UNION\n       SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,ws_quantity - COALESCE(wr_return_quantity,0) AS sales_cnt\n             ,ws_ext_sales_price - COALESCE(wr_return_amt,0.0) AS sales_amt\n       FROM web_sales JOIN item ON i_item_sk=ws_item_sk\n                      JOIN date_dim ON d_date_sk=ws_sold_date_sk\n                      LEFT JOIN web_returns ON (ws_order_number=wr_order_number\n                                            AND ws_item_sk=wr_item_sk)\n       WHERE i_category='Music'\n       and ws_sales_price / ws_list_price BETWEEN 33 * 0.01 AND 53 * 0.01\n       and wr_reason_sk in (17, 48, 50, 56, 68)) sales_detail\nGROUP BY d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id)\n SELECT  prev_yr.d_year AS prev_year\n                          ,curr_yr.d_year AS year\n                          ,curr_yr.i_brand_id\n                          ,curr_yr.i_class_id\n                          ,curr_yr.i_category_id\n                          ,curr_yr.i_manufact_id\n                          ,prev_yr.sales_cnt AS prev_yr_cnt\n                          ,curr_yr.sales_cnt AS curr_yr_cnt\n                          ,curr_yr.sales_cnt-prev_yr.sales_cnt AS sales_cnt_diff\n                          ,curr_yr.sales_amt-prev_yr.sales_amt AS sales_amt_diff\n FROM all_sales curr_yr, all_sales prev_yr\n WHERE curr_yr.i_brand_id=prev_yr.i_brand_id\n   AND curr_yr.i_class_id=prev_yr.i_class_id\n   AND curr_yr.i_category_id=prev_yr.i_category_id\n   AND curr_yr.i_manufact_id=prev_yr.i_manufact_id\n   AND curr_yr.d_year=2002\n   AND prev_yr.d_year=2002-1\n   AND prev_yr.sales_cnt > 0\n   AND CAST(curr_yr.sales_cnt AS DECIMAL(17,2))/CAST(prev_yr.sales_cnt AS DECIMAL(17,2))<0.9\n ORDER BY sales_cnt_diff,sales_amt_diff\n limit 100;",
    "optimized": "WITH all_sales AS (WITH date_filter AS (SELECT d_date_sk, d_year FROM date_dim WHERE d_year IN (2001, 2002)), filtered_catalog_sales AS (SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, cs_quantity - COALESCE(cr_return_quantity, 0) AS sales_cnt, cs_ext_sales_price - COALESCE(cr_return_amount, 0.0) AS sales_amt FROM catalog_sales JOIN item ON i_item_sk = cs_item_sk JOIN date_filter ON d_date_sk = cs_sold_date_sk LEFT JOIN catalog_returns ON (cs_order_number = cr_order_number AND cs_item_sk = cr_item_sk) WHERE i_category = 'Music' AND cs_sales_price / cs_list_price BETWEEN 33 * 0.01 AND 53 * 0.01 AND cr_reason_sk IN (17, 48, 50, 56, 68)), filtered_store_sales AS (SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, ss_quantity - COALESCE(sr_return_quantity, 0) AS sales_cnt, ss_ext_sales_price - COALESCE(sr_return_amt, 0.0) AS sales_amt FROM store_sales JOIN item ON i_item_sk = ss_item_sk JOIN date_filter ON d_date_sk = ss_sold_date_sk LEFT JOIN store_returns ON (ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk) WHERE i_category = 'Music' AND ss_sales_price / ss_list_price BETWEEN 33 * 0.01 AND 53 * 0.01 AND sr_reason_sk IN (17, 48, 50, 56, 68)), filtered_web_sales AS (SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, ws_quantity - COALESCE(wr_return_quantity, 0) AS sales_cnt, ws_ext_sales_price - COALESCE(wr_return_amt, 0.0) AS sales_amt FROM web_sales JOIN item ON i_item_sk = ws_item_sk JOIN date_filter ON d_date_sk = ws_sold_date_sk LEFT JOIN web_returns ON (ws_order_number = wr_order_number AND ws_item_sk = wr_item_sk) WHERE i_category = 'Music' AND ws_sales_price / ws_list_price BETWEEN 33 * 0.01 AND 53 * 0.01 AND wr_reason_sk IN (17, 48, 50, 56, 68)), all_sales AS (SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, SUM(sales_cnt) AS sales_cnt, SUM(sales_amt) AS sales_amt FROM (SELECT * FROM filtered_catalog_sales UNION ALL SELECT * FROM filtered_store_sales UNION ALL SELECT * FROM filtered_web_sales) AS sales_detail GROUP BY d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id) SELECT prev_yr.d_year AS prev_year, curr_yr.d_year AS year, curr_yr.i_brand_id, curr_yr.i_class_id, curr_yr.i_category_id, curr_yr.i_manufact_id, prev_yr.sales_cnt AS prev_yr_cnt, curr_yr.sales_cnt AS curr_yr_cnt, curr_yr.sales_cnt - prev_yr.sales_cnt AS sales_cnt_diff, curr_yr.sales_amt - prev_yr.sales_amt AS sales_amt_diff FROM all_sales AS curr_yr, all_sales AS prev_yr WHERE curr_yr.i_brand_id = prev_yr.i_brand_id AND curr_yr.i_class_id = prev_yr.i_class_id AND curr_yr.i_category_id = prev_yr.i_category_id AND curr_yr.i_manufact_id = prev_yr.i_manufact_id AND curr_yr.d_year = 2002 AND prev_yr.d_year = 2002 - 1 AND prev_yr.sales_cnt > 0 AND CAST(curr_yr.sales_cnt AS DECIMAL(17, 2)) / CAST(prev_yr.sales_cnt AS DECIMAL(17, 2)) < 0.9 ORDER BY sales_cnt_diff, sales_amt_diff LIMIT 100)\nSELECT prev_yr.d_year AS prev_year, curr_yr.d_year AS year, curr_yr.i_brand_id, curr_yr.i_class_id, curr_yr.i_category_id, curr_yr.i_manufact_id, prev_yr.sales_cnt AS prev_yr_cnt, curr_yr.sales_cnt AS curr_yr_cnt, curr_yr.sales_cnt - prev_yr.sales_cnt AS sales_cnt_diff, curr_yr.sales_amt - prev_yr.sales_amt AS sales_amt_diff FROM all_sales AS curr_yr, all_sales AS prev_yr WHERE curr_yr.i_brand_id = prev_yr.i_brand_id AND curr_yr.i_class_id = prev_yr.i_class_id AND curr_yr.i_category_id = prev_yr.i_category_id AND curr_yr.i_manufact_id = prev_yr.i_manufact_id AND curr_yr.d_year = 2002 AND prev_yr.d_year = 2002 - 1 AND prev_yr.sales_cnt > 0 AND CAST(curr_yr.sales_cnt AS DECIMAL(17, 2)) / CAST(prev_yr.sales_cnt AS DECIMAL(17, 2)) < 0.9 ORDER BY sales_cnt_diff, sales_amt_diff LIMIT 100",
    "transforms": [
      "date_cte_isolate"
    ],
    "sf5_status": "ERROR",
    "sf5_speedup": 0.0,
    "sf5_original_ms": 0.0,
    "sf5_optimized_ms": 0.0
  },
  {
    "query": "query081_multi",
    "source": "ado_round_01",
    "original": "with customer_total_return as\n (select cr_returning_customer_sk as ctr_customer_sk\n        ,ca_state as ctr_state, \n \tsum(cr_return_amt_inc_tax) as ctr_total_return\n from catalog_returns\n     ,date_dim\n     ,customer_address\n where cr_returned_date_sk = d_date_sk \n   and d_year =1998\n   and cr_returning_addr_sk = ca_address_sk \n group by cr_returning_customer_sk\n         ,ca_state )\n  select  c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name\n                   ,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset\n                  ,ca_location_type,ctr_total_return\n from customer_total_return ctr1\n     ,customer_address\n     ,customer\n where ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2\n \t\t\t  from customer_total_return ctr2 \n                  \t  where ctr1.ctr_state = ctr2.ctr_state)\n       and ca_address_sk = c_current_addr_sk\n       and ca_state = 'VA'\n       and ctr1.ctr_customer_sk = c_customer_sk\n order by c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name\n                   ,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset\n                  ,ca_location_type,ctr_total_return\n limit 100;",
    "optimized": "WITH customer_total_return AS (SELECT cr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, SUM(cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns, date_dim, customer_address WHERE cr_returned_date_sk = d_date_sk AND d_year = 1998 AND cr_returning_addr_sk = ca_address_sk GROUP BY cr_returning_customer_sk, ca_state), state_averages AS (SELECT ctr_state, AVG(ctr_total_return) * 1.2 AS avg_ctr_total_return FROM customer_total_return GROUP BY ctr_state)\nSELECT c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return FROM customer_total_return AS ctr1, customer_address, customer WHERE ctr1.ctr_total_return > (SELECT AVG(ctr_total_return) * 1.2 FROM customer_total_return AS ctr2 WHERE ctr1.ctr_state = ctr2.ctr_state) AND ca_address_sk = c_current_addr_sk AND ca_state = 'VA' AND ctr1.ctr_customer_sk = c_customer_sk ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return LIMIT 100",
    "transforms": [
      "decorrelate",
      "pushdown",
      "date_cte_isolate"
    ],
    "sf5_status": "ERROR",
    "sf5_speedup": 0.0,
    "sf5_original_ms": 0.0,
    "sf5_optimized_ms": 0.0
  },
  {
    "query": "query083_multi",
    "source": "ado_round_01",
    "original": "with sr_items as\n (select i_item_id item_id,\n        sum(sr_return_quantity) sr_item_qty\n from store_returns,\n      item,\n      date_dim\n where sr_item_sk = i_item_sk\n and   d_date    in\n\t(select d_date\n\tfrom date_dim\n\twhere d_month_seq in\n\t\t(select d_month_seq\n\t\tfrom date_dim\n\t  where d_date in ('2002-02-01','2002-04-11','2002-07-17','2002-10-09')))\n and   sr_returned_date_sk   = d_date_sk\n and i_category IN ('Jewelry', 'Music')\n and i_manager_id BETWEEN 16 and 25\n and sr_return_amt / sr_return_quantity between 184 and 213\n and sr_reason_sk in (26, 32, 40, 66, 73)\ngroup by i_item_id),\n cr_items as\n (select i_item_id item_id,\n        sum(cr_return_quantity) cr_item_qty\n from catalog_returns,\n      item,\n      date_dim\n where cr_item_sk = i_item_sk\n and   d_date    in\n\t(select d_date\n\tfrom date_dim\n  where d_month_seq in\n\t\t(select d_month_seq\n\t\tfrom date_dim\n\t  \t  where d_date in ('2002-02-01','2002-04-11','2002-07-17','2002-10-09')))\n and   cr_returned_date_sk   = d_date_sk\n and i_category IN ('Jewelry', 'Music')\n and i_manager_id BETWEEN 16 and 25\n and cr_return_amount / cr_return_quantity between 184 and 213\n and cr_reason_sk in (26, 32, 40, 66, 73)\n group by i_item_id),\n wr_items as\n (select i_item_id item_id,\n        sum(wr_return_quantity) wr_item_qty\n from web_returns,\n      item,\n      date_dim\n where wr_item_sk = i_item_sk\n and   d_date    in\n\t(select d_date\n\tfrom date_dim\n  where d_month_seq in\n\t\t(select d_month_seq\n\t\tfrom date_dim\n\t\t\t  where d_date in ('2002-02-01','2002-04-11','2002-07-17','2002-10-09')))\n and   wr_returned_date_sk   = d_date_sk\n and i_category IN ('Jewelry', 'Music')\n and i_manager_id BETWEEN 16 and 25\n and wr_return_amt / wr_return_quantity between 184 and 213\n and wr_reason_sk in (26, 32, 40, 66, 73)\n group by i_item_id)\n  select  sr_items.item_id\n       ,sr_item_qty\n       ,sr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 sr_dev\n       ,cr_item_qty\n       ,cr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 cr_dev\n       ,wr_item_qty\n       ,wr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 wr_dev\n       ,(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 average\n from sr_items\n     ,cr_items\n     ,wr_items\n where sr_items.item_id=cr_items.item_id\n   and sr_items.item_id=wr_items.item_id\n order by sr_items.item_id\n         ,sr_item_qty\n limit 100;",
    "optimized": "WITH date_filter AS (SELECT DISTINCT d_date_sk FROM date_dim WHERE d_month_seq IN (SELECT d_month_seq FROM date_dim WHERE d_date IN ('2002-02-01', '2002-04-11', '2002-07-17', '2002-10-09'))), sr_items AS (SELECT i_item_id AS item_id, SUM(sr_return_quantity) AS sr_item_qty FROM store_returns JOIN item ON sr_item_sk = i_item_sk JOIN date_filter ON sr_returned_date_sk = date_filter.d_date_sk WHERE i_category IN ('Jewelry', 'Music') AND i_manager_id BETWEEN 16 AND 25 AND sr_return_amt / sr_return_quantity BETWEEN 184 AND 213 AND sr_reason_sk IN (26, 32, 40, 66, 73) GROUP BY i_item_id), cr_items AS (SELECT i_item_id AS item_id, SUM(cr_return_quantity) AS cr_item_qty FROM catalog_returns JOIN item ON cr_item_sk = i_item_sk JOIN date_filter ON cr_returned_date_sk = date_filter.d_date_sk WHERE i_category IN ('Jewelry', 'Music') AND i_manager_id BETWEEN 16 AND 25 AND cr_return_amount / cr_return_quantity BETWEEN 184 AND 213 AND cr_reason_sk IN (26, 32, 40, 66, 73) GROUP BY i_item_id) SELECT sr_items.item_id, sr_item_qty, sr_item_qty / (sr_item_qty + cr_item_qty + wr_item_qty) / 3.0 * 100 AS sr_dev, cr_item_qty, cr_item_qty / (sr_item_qty + cr_item_qty + wr_item_qty) / 3.0 * 100 AS cr_dev, wr_item_qty, wr_item_qty / (sr_item_qty + cr_item_qty + wr_item_qty) / 3.0 * 100 AS wr_dev, (sr_item_qty + cr_item_qty + wr_item_qty) / 3.0 AS average FROM sr_items, cr_items, wr_items WHERE sr_items.item_id = cr_items.item_id AND sr_items.item_id = wr_items.item_id ORDER BY sr_items.item_id, sr_item_qty LIMIT 100",
    "transforms": [
      "date_cte_isolate"
    ],
    "sf5_status": "ERROR",
    "sf5_speedup": 0.0,
    "sf5_original_ms": 0.0,
    "sf5_optimized_ms": 0.0
  },
  {
    "query": "query085_spj_spj",
    "source": "ado_round_01",
    "original": "select min(ws_quantity)\n       ,min(wr_refunded_cash)\n       ,min(wr_fee)\n       ,min(ws_item_sk)\n       ,min(wr_order_number)\n       ,min(cd1.cd_demo_sk)\n\t   ,min(cd2.cd_demo_sk)\n from web_sales, web_returns, web_page, customer_demographics cd1,\n      customer_demographics cd2, customer_address, date_dim, reason\n where ws_web_page_sk = wp_web_page_sk\n   and ws_item_sk = wr_item_sk\n   and ws_order_number = wr_order_number\n   and ws_sold_date_sk = d_date_sk and d_year = 1998\n   and cd1.cd_demo_sk = wr_refunded_cdemo_sk\n   and cd2.cd_demo_sk = wr_returning_cdemo_sk\n   and ca_address_sk = wr_refunded_addr_sk\n   and r_reason_sk = wr_reason_sk\n   and\n   (\n    (\n     cd1.cd_marital_status = 'D'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Secondary'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 100.00 and 150.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'M'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = '4 yr Degree'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 50.00 and 100.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'U'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Unknown'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 150.00 and 200.00\n    )\n   )\n   and\n   (\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('IA', 'PA', 'TX')\n     and ws_net_profit between 100 and 200\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('GA', 'MO', 'SD')\n     and ws_net_profit between 150 and 300\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('LA', 'TX', 'VA')\n     and ws_net_profit between 50 and 250\n    )\n   )\n ;",
    "optimized": "WITH date_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998), correlated_customer_address AS (SELECT ca_address_sk FROM customer_address WHERE ca_country = 'United States' AND ca_state IN ('IA', 'PA', 'TX', 'GA', 'MO', 'SD', 'LA', 'TX', 'VA')), web_sales_filtered AS (SELECT ws_item_sk, ws_order_number, ws_quantity, ws_sales_price, ws_net_profit, ws_sold_date_sk, CASE WHEN ws_sales_price BETWEEN 100.00 AND 150.00 THEN 1 WHEN ws_sales_price BETWEEN 50.00 AND 100.00 THEN 2 WHEN ws_sales_price BETWEEN 150.00 AND 200.00 THEN 3 END AS price_group, CASE WHEN ws_net_profit BETWEEN 100 AND 200 THEN 1 WHEN ws_net_profit BETWEEN 150 AND 300 THEN 2 WHEN ws_net_profit BETWEEN 50 AND 250 THEN 3 END AS profit_group FROM web_sales WHERE ((ws_sales_price BETWEEN 100.00 AND 150.00) OR (ws_sales_price BETWEEN 50.00 AND 100.00) OR (ws_sales_price BETWEEN 150.00 AND 200.00)) AND ((ws_net_profit BETWEEN 100 AND 200) OR (ws_net_profit BETWEEN 150 AND 300) OR (ws_net_profit BETWEEN 50 AND 250))) SELECT MIN(ws_quantity), MIN(wr_refunded_cash), MIN(wr_fee), MIN(ws_item_sk), MIN(wr_order_number), MIN(cd1.cd_demo_sk), MIN(cd2.cd_demo_sk) FROM web_sales_filtered AS ws JOIN web_returns AS wr ON ws.ws_item_sk = wr.wr_item_sk AND ws.ws_order_number = wr.wr_order_number JOIN web_page AS wp ON ws.ws_web_page_sk = wp.wp_web_page_sk JOIN customer_demographics AS cd1 ON cd1.cd_demo_sk = wr.wr_refunded_cdemo_sk JOIN customer_demographics AS cd2 ON cd2.cd_demo_sk = wr.wr_returning_cdemo_sk JOIN correlated_customer_address AS ca ON ca.ca_address_sk = wr.wr_refunded_addr_sk JOIN date_filtered AS df ON ws.ws_sold_date_sk = df.d_date_sk JOIN reason AS r ON r.r_reason_sk = wr.wr_reason_sk WHERE ((cd1.cd_marital_status = 'D' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'Secondary' AND cd1.cd_education_status = cd2.cd_education_status AND ws.price_group = 1) OR (cd1.cd_marital_status = 'M' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = '4 yr Degree' AND cd1.cd_education_status = cd2.cd_education_status AND ws.price_group = 2) OR (cd1.cd_marital_status = 'U' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'Unknown' AND cd1.cd_education_status = cd2.cd_education_status AND ws.price_group = 3)) AND ((ca_state IN ('IA', 'PA', 'TX') AND ws.profit_group = 1) OR (ca_state IN ('GA', 'MO', 'SD') AND ws.profit_group = 2) OR (ca_state IN ('LA', 'TX', 'VA') AND ws.profit_group = 3))",
    "transforms": [
      "date_cte_isolate, early_filter",
      "semantic_rewrite"
    ],
    "sf5_status": "ERROR",
    "sf5_speedup": 0.0,
    "sf5_original_ms": 0.0,
    "sf5_optimized_ms": 0.0
  },
  {
    "query": "query092_multi",
    "source": "ado_round_01",
    "original": "select \n   sum(ws_ext_discount_amt)  as \"Excess Discount Amount\"\nfrom\n    web_sales\n   ,item\n   ,date_dim\nwhere\n(i_manufact_id BETWEEN 341 and 540\nor i_category IN ('Home', 'Men', 'Music'))\nand i_item_sk = ws_item_sk\nand d_date between '1998-03-13' and\n        cast('1998-03-13' as date) + interval '90 day'\nand d_date_sk = ws_sold_date_sk\nand ws_wholesale_cost BETWEEN 26 AND 46\nand ws_ext_discount_amt\n     > (\n         SELECT\n            1.3 * avg(ws_ext_discount_amt)\n         FROM\n            web_sales\n           ,date_dim\n         WHERE\n              ws_item_sk = i_item_sk\n          and d_date between '1998-03-13' and\n                             cast('1998-03-13' as date) + interval '90 day'\n          and d_date_sk = ws_sold_date_sk\n          and ws_wholesale_cost BETWEEN 26 AND 46\n          and ws_sales_price / ws_list_price BETWEEN 34 * 0.01 AND 49 * 0.01\n  )\norder by sum(ws_ext_discount_amt)\nlimit 100;",
    "optimized": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1998-03-13' AND CAST('1998-03-13' AS DATE) + INTERVAL '90 DAY')\nSELECT SUM(ws_ext_discount_amt) AS \"Excess Discount Amount\" FROM web_sales, item, date_dim WHERE (i_manufact_id BETWEEN 341 AND 540 OR i_category IN ('Home', 'Men', 'Music')) AND i_item_sk = ws_item_sk AND d_date BETWEEN '1998-03-13' AND CAST('1998-03-13' AS DATE) + INTERVAL '90 DAY' AND d_date_sk = ws_sold_date_sk AND ws_wholesale_cost BETWEEN 26 AND 46 AND ws_ext_discount_amt > (SELECT 1.3 * AVG(ws_ext_discount_amt) FROM web_sales, date_dim WHERE ws_item_sk = i_item_sk AND d_date BETWEEN '1998-03-13' AND CAST('1998-03-13' AS DATE) + INTERVAL '90 DAY' AND d_date_sk = ws_sold_date_sk AND ws_wholesale_cost BETWEEN 26 AND 46 AND ws_sales_price / ws_list_price BETWEEN 34 * 0.01 AND 49 * 0.01) ORDER BY SUM(ws_ext_discount_amt) LIMIT 100",
    "transforms": [
      "date_cte_isolate",
      "decorrelate",
      "or_to_union"
    ],
    "sf5_status": "ERROR",
    "sf5_speedup": 0.0,
    "sf5_original_ms": 0.0,
    "sf5_optimized_ms": 0.0
  },
  {
    "query": "query100_agg",
    "source": "ado_round_01",
    "original": "select  item1.i_item_sk, item2.i_item_sk, count(*) as cnt\nFROM item AS item1,\nitem AS item2,\nstore_sales AS s1,\nstore_sales AS s2,\ndate_dim,\ncustomer,\ncustomer_address,\ncustomer_demographics\nWHERE\nitem1.i_item_sk < item2.i_item_sk\nAND s1.ss_ticket_number = s2.ss_ticket_number\nAND s1.ss_item_sk = item1.i_item_sk and s2.ss_item_sk = item2.i_item_sk\nAND s1.ss_customer_sk = c_customer_sk\nand c_current_addr_sk = ca_address_sk\nand c_current_cdemo_sk = cd_demo_sk\nAND d_year between 2000 and 2000 + 1\nand d_date_sk = s1.ss_sold_date_sk\nand item1.i_category in ('Electronics', 'Men')\nand item2.i_manager_id between 81 and 100\nand cd_marital_status = 'S'\nand cd_education_status = 'Secondary'\nand s1.ss_list_price between 16 and 30\nand s2.ss_list_price between 16 and 30\nGROUP BY item1.i_item_sk, item2.i_item_sk\nORDER BY cnt\n;",
    "optimized": "WITH node_id AS (main_query), sql AS (SELECT item1.i_item_sk, item2.i_item_sk, COUNT(*) AS cnt FROM (SELECT ss_ticket_number, ss_item_sk FROM store_sales AS ss JOIN date_dim AS d ON ss.ss_sold_date_sk = d.d_date_sk WHERE d.d_year BETWEEN 2000 AND 2000 + 1 AND ss.ss_list_price BETWEEN 16 AND 30 AND EXISTS(SELECT 1 FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics AS cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE ss.ss_customer_sk = c.c_customer_sk AND cd.cd_marital_status = 'S' AND cd.cd_education_status = 'Secondary')) AS s1 JOIN (SELECT ss_ticket_number, ss_item_sk FROM store_sales AS ss WHERE ss.ss_list_price BETWEEN 16 AND 30) AS s2 ON s1.ss_ticket_number = s2.ss_ticket_number JOIN item AS item1 ON s1.ss_item_sk = item1.i_item_sk JOIN item AS item2 ON s2.ss_item_sk = item2.i_item_sk WHERE item1.i_item_sk < item2.i_item_sk AND item1.i_category IN ('Electronics', 'Men') AND item2.i_manager_id BETWEEN 81 AND 100 GROUP BY item1.i_item_sk, item2.i_item_sk ORDER BY cnt)\nSELECT item1.i_item_sk, item2.i_item_sk, COUNT(*) AS cnt FROM item AS item1, item AS item2, store_sales AS s1, store_sales AS s2, date_dim, customer, customer_address, customer_demographics WHERE item1.i_item_sk < item2.i_item_sk AND s1.ss_ticket_number = s2.ss_ticket_number AND s1.ss_item_sk = item1.i_item_sk AND s2.ss_item_sk = item2.i_item_sk AND s1.ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND c_current_cdemo_sk = cd_demo_sk AND d_year BETWEEN 2000 AND 2000 + 1 AND d_date_sk = s1.ss_sold_date_sk AND item1.i_category IN ('Electronics', 'Men') AND item2.i_manager_id BETWEEN 81 AND 100 AND cd_marital_status = 'S' AND cd_education_status = 'Secondary' AND s1.ss_list_price BETWEEN 16 AND 30 AND s2.ss_list_price BETWEEN 16 AND 30 GROUP BY item1.i_item_sk, item2.i_item_sk ORDER BY cnt",
    "transforms": [
      "dsb_self_join_decomposition",
      "early_filter"
    ],
    "sf5_status": "ERROR",
    "sf5_speedup": 0.0,
    "sf5_original_ms": 0.0,
    "sf5_optimized_ms": 0.0
  },
  {
    "query": "query102_agg",
    "source": "ado_round_01",
    "original": "select \n    cd_gender,\n    cd_marital_status,\n    cd_education_status,\n    hd_vehicle_count,\n    count(*) as cnt\nfrom\n    store_sales,\n    web_sales,\n    date_dim d1,\n    date_dim d2,\n    customer,\n    inventory,\n    store,\n    warehouse,\n    item,\n    customer_demographics,\n    household_demographics,\n    customer_address\n    where\n      ss_item_sk = i_item_sk\n      and ws_item_sk = ss_item_sk\n      and ss_sold_date_sk = d1.d_date_sk\n      and ws_sold_date_sk = d2.d_date_sk\n\t\t\tand d2.d_date between d1.d_date and (d1.d_date + interval '30 day')\n      and ss_customer_sk = c_customer_sk\n      and ws_bill_customer_sk = c_customer_sk\n      and ws_warehouse_sk = inv_warehouse_sk\n      and ws_warehouse_sk = w_warehouse_sk\n      and inv_item_sk = ss_item_sk\n      and inv_date_sk = ss_sold_date_sk\n      and inv_quantity_on_hand >= ss_quantity\n      and s_state = w_state\n      AND i_category IN ('Home', 'Men', 'Music')\n      and i_manager_id IN (1, 2, 4, 11, 12, 14, 21, 29, 32, 52)\n      and c_current_cdemo_sk = cd_demo_sk\n      and c_current_hdemo_sk = hd_demo_sk\n      and c_current_addr_sk = ca_address_sk\n      and ca_state in ('GA', 'MD', 'MO', 'NC', 'OR')\n      and d1.d_year = 2002\n      and ws_wholesale_cost BETWEEN 34 AND 54\n    group by cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count\n    order by cnt\n    ;",
    "optimized": "WITH filtered_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2002), filtered_customer_address AS (SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('GA', 'MD', 'MO', 'NC', 'OR')), filtered_item AS (SELECT i_item_sk FROM item WHERE i_category IN ('Home', 'Men', 'Music') AND i_manager_id IN (1, 2, 4, 11, 12, 14, 21, 29, 32, 52)), filtered_inventory AS (SELECT inv_warehouse_sk, inv_item_sk, inv_date_sk, inv_quantity_on_hand FROM inventory WHERE inv_quantity_on_hand >= 0), store_sales_base AS (SELECT ss_item_sk, ss_sold_date_sk, ss_customer_sk, ss_quantity FROM store_sales WHERE ss_item_sk IN (SELECT i_item_sk FROM filtered_item) AND ss_sold_date_sk IN (SELECT d_date_sk FROM filtered_dates)) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales_base AS ss JOIN web_sales AS ws ON ss.ss_item_sk = ws.ws_item_sk JOIN filtered_dates AS d1 ON ss.ss_sold_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk AND ws.ws_bill_customer_sk = c.c_customer_sk JOIN filtered_inventory AS inv ON inv.inv_item_sk = ss.ss_item_sk AND inv.inv_date_sk = ss.ss_sold_date_sk AND inv.inv_quantity_on_hand >= ss.ss_quantity JOIN store AS s ON inv.inv_warehouse_sk = s.s_warehouse_sk JOIN warehouse AS w ON ws.ws_warehouse_sk = w.w_warehouse_sk AND s.s_state = w.w_state JOIN customer_demographics AS cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN filtered_customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ws.ws_wholesale_cost BETWEEN 34 AND 54 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt",
    "transforms": [
      "date_cte_isolate"
    ],
    "sf5_status": "ERROR",
    "sf5_speedup": 0.0,
    "sf5_original_ms": 0.0,
    "sf5_optimized_ms": 0.0
  }
]