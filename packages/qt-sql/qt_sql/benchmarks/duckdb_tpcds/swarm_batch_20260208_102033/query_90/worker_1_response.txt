```sql
WITH filtered_hd AS (
    SELECT hd_demo_sk
    FROM household_demographics
    WHERE hd_dep_count = 2
),
filtered_wp AS (
    SELECT wp_web_page_sk
    FROM web_page
    WHERE wp_char_count BETWEEN 5000 AND 5200
),
am_counts AS (
    SELECT COUNT(*) AS amc
    FROM web_sales ws
    JOIN time_dim t ON ws.ws_sold_time_sk = t.t_time_sk
    JOIN filtered_hd hd ON ws.ws_ship_hdemo_sk = hd.hd_demo_sk
    JOIN filtered_wp wp ON ws.ws_web_page_sk = wp.wp_web_page_sk
    WHERE t.t_hour BETWEEN 10 AND 11
),
pm_counts AS (
    SELECT COUNT(*) AS pmc
    FROM web_sales ws
    JOIN time_dim t ON ws.ws_sold_time_sk = t.t_time_sk
    JOIN filtered_hd hd ON ws.ws_ship_hdemo_sk = hd.hd_demo_sk
    JOIN filtered_wp wp ON ws.ws_web_page_sk = wp.wp_web_page_sk
    WHERE t.t_hour BETWEEN 16 AND 17
)
SELECT
  CAST(amc AS DECIMAL(15, 4)) / CAST(pmc AS DECIMAL(15, 4)) AS am_pm_ratio
FROM am_counts, pm_counts
ORDER BY am_pm_ratio
LIMIT 100;
```

Changes: Created CTEs to pre-filter small dimension tables (household_demographics and web_page) before joining to the large fact table (web_sales). This reduces the fact table join to only matching rows instead of scanning all rows and filtering after joins.

Expected speedup: ~2-3x by reducing fact table join cardinality and avoiding repeated dimension table scans.