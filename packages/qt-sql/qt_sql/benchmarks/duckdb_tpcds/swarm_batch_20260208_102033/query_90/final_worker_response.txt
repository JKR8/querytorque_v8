```sql
WITH filtered_hd AS (
    SELECT hd_demo_sk
    FROM household_demographics
    WHERE hd_dep_count = 2
),
filtered_wp AS (
    SELECT wp_web_page_sk
    FROM web_page
    WHERE wp_char_count BETWEEN 5000 AND 5200
),
filtered_time AS (
    SELECT t_time_sk, t_hour
    FROM time_dim
    WHERE t_hour BETWEEN 10 AND 11
       OR t_hour BETWEEN 16 AND 17
),
joined_sales AS (
    SELECT t.t_hour
    FROM web_sales ws
    INNER JOIN filtered_hd hd ON ws.ws_ship_hdemo_sk = hd.hd_demo_sk
    INNER JOIN filtered_wp wp ON ws.ws_web_page_sk = wp.wp_web_page_sk
    INNER JOIN filtered_time t ON ws.ws_sold_time_sk = t.t_time_sk
)
SELECT
    CAST(
        COUNT(CASE WHEN t_hour BETWEEN 10 AND 11 THEN 1 END) AS DECIMAL(15,4)
    ) / CAST(
        COUNT(CASE WHEN t_hour BETWEEN 16 AND 17 THEN 1 END) AS DECIMAL(15,4)
    ) AS am_pm_ratio
FROM joined_sales
ORDER BY am_pm_ratio
LIMIT 100;
```

**Changes:** Consolidated two separate scans of web_sales into a single scan with conditional aggregation. Created filtered CTEs for dimension tables to push filters early and build small hash tables before joining with the large fact table. Used explicit INNER JOIN syntax for better optimizer control.

**Expected speedup:** ~2x from eliminating duplicate fact table scans and early dimension filtering.