{
  "iteration": 1,
  "n_api_calls": 6,
  "best_speedup": 2.97,
  "best_patch_id": "ast_w4",
  "best_sql": "WITH valid_store_sales_customers AS (SELECT DISTINCT ss_customer_sk FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2001 AND d_qoy < 4), valid_web_or_catalog_sales_customers AS (SELECT DISTINCT ws_bill_customer_sk AS customer_sk FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk WHERE d_year = 2001 AND d_qoy < 4 UNION SELECT DISTINCT cs_ship_customer_sk AS customer_sk FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk WHERE d_year = 2001 AND d_qoy < 4) /* start query 35 in stream 0 using template query35.tpl */ SELECT ca_state, cd_gender, cd_marital_status, cd_dep_count, COUNT(*) AS cnt1, MAX(cd_dep_count), SUM(cd_dep_count), MAX(cd_dep_count), cd_dep_employed_count, COUNT(*) AS cnt2, MAX(cd_dep_employed_count), SUM(cd_dep_employed_count), MAX(cd_dep_employed_count), cd_dep_college_count, COUNT(*) AS cnt3, MAX(cd_dep_college_count), SUM(cd_dep_college_count), MAX(cd_dep_college_count) FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics AS cd ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN valid_store_sales_customers AS vss ON c.c_customer_sk = vss.ss_customer_sk JOIN valid_web_or_catalog_sales_customers AS vwcs ON c.c_customer_sk = vwcs.customer_sk WHERE TRUE GROUP BY ca_state, cd_gender, cd_marital_status, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY ca_state, cd_gender, cd_marital_status, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;\n\n/* end query 35 in stream 0 using template query35.tpl */;",
  "patches": [
    {
      "patch_id": "ast_w4",
      "family": "B",
      "transform": "composite_decorrelate_union",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 2.97,
      "semantic_passed": true,
      "error": null,
      "original_ms": 120.3,
      "patch_ms": 40.5,
      "output_sql": "WITH valid_store_sales_customers AS (SELECT DISTINCT ss_customer_sk FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2001 AND d_qoy < 4), valid_web_or_catalog_sales_customers AS (SELECT DISTINCT ws_bill_customer_sk AS customer_sk FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk WHERE d_year = 2001 AND d_qoy < 4 UNION SELECT DISTINCT cs_ship_customer_sk AS customer_sk FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk WHERE d_year = 2001 AND d_qoy < 4) /* start query 35 in stream 0 using template query35.tpl */ SELECT ca_state, cd_gender, cd_marital_status, cd_dep_count, COUNT(*) AS cnt1, MAX(cd_dep_count), SUM(cd_dep_count), MAX(cd_dep_count), cd_dep_employed_count, COUNT(*) AS cnt2, MAX(cd_dep_employed_count), SUM(cd_dep_employed_count), MAX(cd_dep_employed_count), cd_dep_college_count, COUNT(*) AS cnt3, MAX(cd_dep_college_count), SUM(cd_dep_college_count), MAX(cd_dep_college_count) FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics AS cd ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN valid_store_sales_customers AS vss ON c.c_customer_sk = vss.ss_customer_sk JOIN valid_web_or_catalog_sales_customers AS vwcs ON c.c_customer_sk = vwcs.customer_sk WHERE TRUE GROUP BY ca_state, cd_gender, cd_marital_status, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY ca_state, cd_gender, cd_marital_status, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;\n\n/* end query 35 in stream 0 using template query35.tpl */;",
      "has_explain": true
    },
    {
      "patch_id": "t1",
      "family": "B+E+C",
      "transform": "decorrelate_unionall_with_date_prefetch+preaggregate_sales_customers+decorrelate_unionall_distinct",
      "relevance_score": 0.97,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Equivalence (after retry): checksum 29893592f410526a126ae862c93e6abf vs 2ad62e7eb6972f92b66a037924b01caa",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001 AND d_qoy < 4), relevant_customers AS (SELECT DISTINCT ss_customer_sk AS c_customer_sk FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk UNION ALL SELECT DISTINCT ws_bill_customer_sk AS c_customer_sk FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk UNION ALL SELECT DISTINCT cs_ship_customer_sk AS c_customer_sk FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk), distinct_relevant_customers AS (SELECT DISTINCT c_customer_sk FROM relevant_customers) /* start query 35 in stream 0 using template query35.tpl */ SELECT ca_state, cd_gender, cd_marital_status, cd_dep_count, COUNT(*) AS cnt1, MAX(cd_dep_count), SUM(cd_dep_count), MAX(cd_dep_count), cd_dep_employed_count, COUNT(*) AS cnt2, MAX(cd_dep_employed_count), SUM(cd_dep_employed_count), MAX(cd_dep_employed_count), cd_dep_college_count, COUNT(*) AS cnt3, MAX(cd_dep_college_count), SUM(cd_dep_college_count), MAX(cd_dep_college_count) FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics AS cd ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN distinct_relevant_customers AS rc ON c.c_customer_sk = rc.c_customer_sk GROUP BY ca_state, cd_gender, cd_marital_status, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY ca_state, cd_gender, cd_marital_status, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;\n\n/* end query 35 in stream 0 using template query35.tpl */;",
      "has_explain": false
    },
    {
      "patch_id": "t4",
      "family": "F",
      "transform": "explicit_join_reorder_date_first",
      "relevance_score": 0.85,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Equivalence (after retry): checksum 64fdaf007f21e6fbf89e3228826bebd1 vs 2ad62e7eb6972f92b66a037924b01caa",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001 AND d_qoy < 4), valid_customers AS (SELECT DISTINCT c.c_customer_sk FROM customer AS c INNER JOIN store_sales AS ss ON c.c_customer_sk = ss.ss_customer_sk INNER JOIN filtered_date AS fd ON ss.ss_sold_date_sk = fd.d_date_sk UNION SELECT DISTINCT c.c_customer_sk FROM customer AS c INNER JOIN web_sales AS ws ON c.c_customer_sk = ws.ws_bill_customer_sk INNER JOIN filtered_date AS fd ON ws.ws_sold_date_sk = fd.d_date_sk UNION SELECT DISTINCT c.c_customer_sk FROM customer AS c INNER JOIN catalog_sales AS cs ON c.c_customer_sk = cs.cs_ship_customer_sk INNER JOIN filtered_date AS fd ON cs.cs_sold_date_sk = fd.d_date_sk) SELECT ca_state, cd_gender, cd_marital_status, cd_dep_count, COUNT(*) AS cnt1, MAX(cd_dep_count), SUM(cd_dep_count), MAX(cd_dep_count), cd_dep_employed_count, COUNT(*) AS cnt2, MAX(cd_dep_employed_count), SUM(cd_dep_employed_count), MAX(cd_dep_employed_count), cd_dep_college_count, COUNT(*) AS cnt3, MAX(cd_dep_college_count), SUM(cd_dep_college_count), MAX(cd_dep_college_count) FROM customer AS c INNER JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN customer_demographics AS cd ON cd.cd_demo_sk = c.c_current_cdemo_sk INNER JOIN valid_customers AS vc ON c.c_customer_sk = vc.c_customer_sk GROUP BY ca_state, cd_gender, cd_marital_status, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY ca_state, cd_gender, cd_marital_status, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;\n\n/* end query 35 in stream 0 using template query35.tpl */;",
      "has_explain": false
    }
  ],
  "explains": {
    "ast_w4": "Total execution time: 6228ms\n\nTOP_N [100 rows, 3.2ms]\n  HASH_GROUP_BY [58K rows, 22.3ms]\n    HASH_JOIN INNER on ca_address_sk = c_current_addr_sk [77K rows, 12.3ms]\n      SEQ_SCAN  customer_address [250K of 750K rows, 9.2ms]  Filters: optional: Dynamic Filter (ca_state)\n      HASH_JOIN INNER on cd_demo_sk = c_current_cdemo_sk [77K rows, 21.4ms]\n        SEQ_SCAN  customer_demographics [1.9M of 30.7M rows, 68.1ms, 1%]  Filters: cd_demo_sk>=4 AND cd_demo_sk<=1920791\n        HASH_JOIN INNER on c_cus"
  }
}