[
  {
    "target_id": "t1",
    "family": "B",
    "transform": "decorrelate",
    "relevance_score": 0.95,
    "hypothesis": "Correlated subquery re-executes aggregate per store-customer row. Precomputing store-level thresholds eliminates nested loops.",
    "target_ir": "S0 [SELECT]\n  CTE: customer_total_return  (unchanged)\n    FROM: store_returns, date_dim\n    WHERE [eb0f6bc97f7168d4]: sr_returned_date_sk = d_date_sk AND d_year = 2000\n    GROUP BY: sr_customer_sk, sr_store_sk\n  CTE: store_avg_return  (new)\n    FROM: customer_total_return\n    GROUP BY: ctr_store_sk\n    SELECT: ctr_store_sk, AVG(ctr_total_return) * 1.2 AS threshold\n  MAIN QUERY (via Q_S0)\n    FROM: customer_total_return ctr1, store, customer, store_avg_return sar\n    WHERE [e5b7485395ff5a80]: \n        s_store_sk = ctr1.ctr_store_sk\n        AND s_state = 'SD'\n        AND ctr1.ctr_customer_sk = c_customer_sk\n        AND ctr1.ctr_total_return > sar.threshold\n        AND sar.ctr_store_sk = ctr1.ctr_store_sk\n    ORDER BY: c_customer_id\n    LIMIT 100",
    "recommended_examples": [
      "decorrelate"
    ]
  },
  {
    "target_id": "t2",
    "family": "A",
    "transform": "dimension_cte_isolate",
    "relevance_score": 0.85,
    "hypothesis": "Late store filter (s_state='SD') forces processing of irrelevant stores. Pre-filtering store_returns using SD stores reduces CTE cardinality.",
    "target_ir": "S0 [SELECT]\n  CTE: sd_stores  (new)\n    FROM: store\n    WHERE: s_state='SD'\n    SELECT: s_store_sk\n  CTE: customer_total_return  (modified)\n    FROM: store_returns, date_dim, sd_stores\n    WHERE: \n        sr_returned_date_sk = d_date_sk\n        AND d_year = 2000\n        AND sr_store_sk = s_store_sk\n    GROUP BY: sr_customer_sk, sr_store_sk\n  MAIN QUERY (via Q_S0)\n    FROM: customer_total_return ctr1, customer\n    WHERE [e5b7485395ff5a80]: \n        ctr1.ctr_total_return > (SELECT AVG(ctr_total_return)*1.2 FROM customer_total_return ctr2 WHERE ctr1.ctr_store_sk = ctr2.ctr_store_sk)\n        AND ctr1.ctr_customer_sk = c_customer_sk\n    ORDER BY: c_customer_id\n    LIMIT 100",
    "recommended_examples": [
      "prefetch_fact_join",
      "dimension_cte_isolate"
    ]
  }
]