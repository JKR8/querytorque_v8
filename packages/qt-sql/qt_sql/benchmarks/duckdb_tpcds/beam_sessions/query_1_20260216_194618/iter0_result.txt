{
  "iteration": 0,
  "n_api_calls": 7,
  "best_speedup": 1.4,
  "best_patch_id": "t1",
  "best_sql": "/* start query 1 in stream 0 using template query1.tpl */ WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, SUM(SR_FEE) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2000 GROUP BY sr_customer_sk, sr_store_sk), store_avg_return AS (SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS threshold FROM customer_total_return GROUP BY ctr_store_sk) SELECT c_customer_id FROM customer_total_return AS ctr1, store, customer, store_avg_return AS sar WHERE s_store_sk = ctr1.ctr_store_sk AND s_state = 'SD' AND ctr1.ctr_customer_sk = c_customer_sk AND ctr1.ctr_total_return > sar.threshold AND sar.ctr_store_sk = ctr1.ctr_store_sk ORDER BY c_customer_id LIMIT 100;\n\n/* end query 1 in stream 0 using template query1.tpl */;",
  "patches": [
    {
      "patch_id": "t1",
      "family": "B",
      "transform": "decorrelate",
      "relevance_score": 0.95,
      "status": "WIN",
      "speedup": 1.4,
      "semantic_passed": true,
      "error": null,
      "original_ms": 32.7,
      "patch_ms": 23.4,
      "output_sql": "/* start query 1 in stream 0 using template query1.tpl */ WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, SUM(SR_FEE) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2000 GROUP BY sr_customer_sk, sr_store_sk), store_avg_return AS (SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS threshold FROM customer_total_return GROUP BY ctr_store_sk) SELECT c_customer_id FROM customer_total_return AS ctr1, store, customer, store_avg_return AS sar WHERE s_store_sk = ctr1.ctr_store_sk AND s_state = 'SD' AND ctr1.ctr_customer_sk = c_customer_sk AND ctr1.ctr_total_return > sar.threshold AND sar.ctr_store_sk = ctr1.ctr_store_sk ORDER BY c_customer_id LIMIT 100;\n\n/* end query 1 in stream 0 using template query1.tpl */;",
      "has_explain": true
    },
    {
      "patch_id": "t2",
      "family": "A",
      "transform": "dimension_cte_isolate",
      "relevance_score": 0.85,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Step s2 failed: No target found for replace_body step s2",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false
    },
    {
      "patch_id": "syn_w2",
      "family": "B",
      "transform": "decorrelate",
      "relevance_score": 0.3,
      "status": "WIN",
      "speedup": 1.22,
      "semantic_passed": true,
      "error": null,
      "original_ms": 32.7,
      "patch_ms": 26.9,
      "output_sql": "/* start query 1 in stream 0 using template query1.tpl */ WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, SUM(SR_FEE) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2000 GROUP BY sr_customer_sk, sr_store_sk), store_avg_return AS (SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS threshold FROM customer_total_return GROUP BY ctr_store_sk) SELECT c_customer_id FROM customer_total_return AS ctr1, store, customer, store_avg_return AS sar WHERE ctr1.ctr_total_return > sar.threshold AND sar.ctr_store_sk = ctr1.ctr_store_sk AND s_store_sk = ctr1.ctr_store_sk AND s_state = 'SD' AND ctr1.ctr_customer_sk = c_customer_sk ORDER BY c_customer_id LIMIT 100;\n\n/* end query 1 in stream 0 using template query1.tpl */;",
      "has_explain": true
    },
    {
      "patch_id": "syn_w3",
      "family": "E",
      "transform": "materialize_cte",
      "relevance_score": 0.3,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": false,
      "error": "Duplicate of t1",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "/* start query 1 in stream 0 using template query1.tpl */ WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, SUM(SR_FEE) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2000 GROUP BY sr_customer_sk, sr_store_sk), store_avg_return AS (SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS threshold FROM customer_total_return GROUP BY ctr_store_sk) SELECT c_customer_id FROM customer_total_return AS ctr1, store, customer, store_avg_return AS sar WHERE s_store_sk = ctr1.ctr_store_sk AND s_state = 'SD' AND ctr1.ctr_customer_sk = c_customer_sk AND ctr1.ctr_total_return > sar.threshold AND sar.ctr_store_sk = ctr1.ctr_store_sk ORDER BY c_customer_id LIMIT 100;\n\n/* end query 1 in stream 0 using template query1.tpl */;",
      "has_explain": false
    }
  ],
  "explains": {
    "t1": "Total execution time: 1579ms\n\nCTE [0 rows, 2.8ms]\n  HASH_GROUP_BY [539K rows, 106.9ms, 7%]\n    HASH_JOIN INNER on sr_returned_date_sk = d_date_sk [558K rows, 5.0ms]\n      SEQ_SCAN  store_returns [558K of 69.1M rows, 1258.1ms, 80%]\n      FILTER [366 rows]\n        SEQ_SCAN  date_dim [366 of 73K rows, 1.7ms]  Filters: d_year=2000\n  TOP_N [100 rows, 1.7ms]\n    HASH_JOIN INNER on c_customer_sk = ctr_customer_sk [62K rows, 13.9ms]\n      SEQ_SCAN  customer [500K of 2.5M rows, 142.8ms, 9%]  Filters: opt",
    "syn_w2": "Total execution time: 1482ms\n\nCTE [0 rows, 3.5ms]\n  HASH_GROUP_BY [539K rows, 106.9ms, 7%]\n    HASH_JOIN INNER on sr_returned_date_sk = d_date_sk [558K rows, 4.3ms]\n      SEQ_SCAN  store_returns [558K of 69.1M rows, 1247.8ms, 84%]\n      FILTER [366 rows]\n        SEQ_SCAN  date_dim [366 of 73K rows, 2.3ms]  Filters: d_year=2000\n  TOP_N [100 rows, 2.2ms]\n    HASH_JOIN INNER on c_customer_sk = ctr_customer_sk [62K rows, 14.6ms]\n      SEQ_SCAN  customer [500K of 2.5M rows, 46.8ms, 3%]  Filters: opti"
  }
}