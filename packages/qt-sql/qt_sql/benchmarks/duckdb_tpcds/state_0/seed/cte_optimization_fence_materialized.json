{
  "id": "CTE_OPTIMIZATION_FENCE_MATERIALIZED",
  "name": "Cte Optimization Fence Materialized",
  "description": "Use MATERIALIZED to create optimization fence, preventing predicate\n      pushdown and forcing single evaluation of expensive CTE computation.",
  "category": "cte_materialization",
  "priority": "medium",
  "verified_speedup": "unknown",
  "example": {
    "before_sql": "-- May be inlined and computed multiple times in PG12+\n      WITH expensive_calc AS (\n          SELECT id, complex_function(data) AS result \n          FROM big_table\n      )\n      SELECT * FROM expensive_calc e1\n      JOIN expensive_calc e2 ON e1.result = e2.result;",
    "after_sql": "WITH expensive_calc AS MATERIALIZED (\n          SELECT id, complex_function(data) AS result \n          FROM big_table\n      )\n      SELECT * FROM expensive_calc e1\n      JOIN expensive_calc e2 ON e1.result = e2.result;\n      -- Computed once, stored in temp table",
    "alternative_sql": "",
    "key_insight": "- CTE contains expensive computation that should run once\n      - Need to isolate subquery planning to prevent bad plan choices\n      - Force specific join ordering",
    "transforms": [
      "cte_optimization_fence_materialized"
    ]
  },
  "metadata": {
    "pg_version": "12+",
    "auto_applied_by_pg": "false",
    "research_source": "",
    "notes": ""
  }
}