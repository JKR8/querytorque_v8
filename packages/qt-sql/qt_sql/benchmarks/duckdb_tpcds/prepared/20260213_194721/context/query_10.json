{
  "explain_plan_text": "\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    TOP_N    \u2502\n\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502     Top:    \u2502\n\u2502     100     \u2502\n\u2502             \u2502\n\u2502  Order By:  \u2502\n\u2502 tpcds_sf10_1\u2502\n\u2502.main.custome\u2502\n\u2502r_demographic\u2502\n\u2502 s.cd_gender \u2502\n\u2502      ASC    \u2502\n\u2502 tpcds_sf10_1\u2502\n\u2502.main.custome\u2502\n\u2502r_demographic\u2502\n\u2502s.cd_marital_\u2502\n\u2502  status ASC \u2502\n\u2502 tpcds_sf10_1\u2502\n\u2502.main.custome\u2502\n\u2502r_demographic\u2502\n\u2502s.cd_educatio\u2502\n\u2502 n_status ASC\u2502\n\u2502 tpcds_sf10_1\u2502\n\u2502.main.custome\u2502\n\u2502r_demographic\u2502\n\u2502s.cd_purchase\u2502\n\u2502_estimate ASC\u2502\n\u2502 tpcds_sf10_1\u2502\n\u2502.main.custome\u2502\n\u2502r_demographic\u2502\n\u2502s.cd_credit_r\u2502\n\u2502  ating ASC  \u2502\n\u2502 tpcds_sf10_1\u2502\n\u2502.main.custome\u2502\n\u2502r_demographic\u2502\n\u2502s.cd_dep_coun\u2502\n\u2502    t ASC    \u2502\n\u2502 tpcds_sf10_1\u2502\n\u2502.main.custome\u2502\n\u2502r_demographic\u2502\n\u2502s.cd_dep_empl\u2502\n\u2502  oyed_count \u2502\n\u2502      ASC    \u2502\n\u2502 tpcds_sf10_1\u2502\n\u2502.main.custome\u2502\n\u2502r_demographic\u2502\n\u2502s.cd_dep_coll\u2502\n\u2502ege_count ASC\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PROJECTION \u2502\n\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502  cd_gender  \u2502\n\u2502cd_marital_st\u2502\n\u2502     atus    \u2502\n\u2502cd_education_\u2502\n\u2502    status   \u2502\n\u2502     cnt1    \u2502\n\u2502cd_purchase_e\u2502\n\u2502   stimate   \u2502\n\u2502     cnt2    \u2502\n\u2502cd_credit_rat\u2502\n\u2502     ing     \u2502\n\u2502     cnt3    \u2502\n\u2502 cd_dep_count\u2502\n\u2502     cnt4    \u2502\n\u2502cd_dep_employ\u2502\n\u2502   ed_count  \u2502\n\u2502     cnt5    \u2502\n\u2502cd_dep_colleg\u2502\n\u2502   e_count   \u2502\n\u2502     cnt6    \u2502\n\u2502             \u2502\n\u2502 ~16,425 rows\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PROJECTION \u2502\n\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502__internal_de\u2502\n\u2502compress_stri\u2502\n\u2502    ng(#0)   \u2502\n\u2502__internal_de\u2502\n\u2502compress_stri\u2502\n\u2502    ng(#1)   \u2502\n\u2502__internal_de\u2502\n\u2502compress_stri\u2502\n\u2502    ng(#2)   \u2502\n\u2502__internal_de\u2502\n\u2502compress_inte\u2502\n\u2502 gral_integer\u2502\n\u2502  (#3, 500)  \u2502\n\u2502__internal_de\u2502\n\u2502compress_stri\u2502\n\u2502    ng(#4)   \u2502\n\u2502__internal_de\u2502\n\u2502compress_inte\u2502\n\u2502 gral_integer\u2502\n\u2502   (#5, 0)   \u2502\n\u2502__internal_de\u2502\n\u2502compress_inte\u2502\n\u2502 gral_integer\u2502\n\u2502   (#6, 0)   \u2502\n\u2502__internal_de\u2502\n\u2502compress_inte\u2502\n\u2502 gral_integer\u2502\n\u2502   (#7, 0)   \u2502\n\u2502      #8     \u2502\n\u2502             \u2502\n\u2502 ~16,425 rows\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502HASH_GROUP_BY\u2502\n\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502   Groups:   \u2502\n\u2502      #0     \u2502\n\u2502      #1     \u2502\n\u2502      #2     \u2502\n\u2502      #3     \u2502\n\u2502      #4     \u2502\n\u2502      #5     \u2502\n\u2502      #6     \u2502\n\u2502      #7     \u2502\n\u2502             \u2502\n\u2502 Aggregates: \u2502\n\u2502 count_star()\u2502\n\u2502             \u2502\n\u2502 ~16,425 rows\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PROJECTION \u2502\n\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502  cd_gender  \u2502\n\u2502cd_marital_st\u2502\n\u2502     atus    \u2502\n\u2502cd_education_\u2502\n\u2502    status   \u2502\n\u2502cd_purchase_e\u2502\n\u2502   stimate   \u2502\n\u2502cd_credit_rat\u2502\n\u2502     ing     \u2502\n\u2502 cd_dep_count\u2502\n\u2502cd_dep_employ\u2502\n\u2502   ed_count  \u2502\n\u2502cd_dep_colleg\u2502\n\u2502   e_count   \u2502\n\u2502             \u2502\n\u2502 ~16,425 rows\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PROJECTION \u2502\n\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502__internal_co\u2502\n\u2502mpress_string\u2502\n\u2502_utinyint(#0)\u2502\n\u2502__internal_co\u2502\n\u2502mpress_string\u2502\n\u2502_utinyint(#1)\u2502\n\u2502__internal_co\u2502\n\u2502mpress_string\u2502\n\u2502_uhugeint(#2)\u2502\n\u2502__internal_co\u2502\n\u2502mpress_integr\u2502\n\u2502 al_usmallint\u2502\n\u2502  (#3, 500)  \u2502\n\u2502__internal_co\u2502\n\u2502mpress_string\u2502\n\u2502_uhugeint(#4)\u2502\n\u2502__internal_co\u2502\n\u2502mpress_integr\u2502\n\u2502 al_utinyint(\u2502\n\u2502    #5, 0)   \u2502\n\u2502__internal_co\u2502\n\u2502mpress_integr\u2502\n\u2502 al_utinyint(\u2502\n\u2502    #6, 0)   \u2502\n\u2502__internal_co\u2502\n\u2502mpress_integr\u2502\n\u2502 al_utinyint(\u2502\n\u2502    #7, 0)   \u2502\n\u2502             \u2502\n\u2502 ~16,425 rows\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PROJECTION \u2502\n\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502      #0     \u2502\n\u2502      #1     \u2502\n\u2502      #2     \u2502\n\u2502      #3     \u2502\n\u2502      #4     \u2502\n\u2502      #5     \u2502\n\u2502      #6     \u2502\n\u2502      #7     \u2502\n\u2502             \u2502\n\u2502 ~16,425 rows\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    FILTER   \u2502\n\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502 (SUBQUERY OR\u2502\n\u2502   SUBQUERY) \u2502\n\u2502             \u2502\n\u2502 ~16,425 rows\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502LEFT_DEL...  \u2502\n\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502  Join Type: \u2502\n\u2502     MARK    \u2502\n\u2502             \u2502\n\u2502 Conditions: \u2502\n\u2502c_customer_sk\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502 IS NOT DISTI\u2502                                                                                                                                                                                                          \u2502                      \n\u2502   NCT FROM  \u2502                                                                                                                                                                                                          \u2502                      \n\u2502 c_customer_s\u2502                                                                                                                                                                                                          \u2502                      \n\u2502      k      \u2502                                                                                                                                                                                                          \u2502                      \n\u2502             \u2502                                                                                                                                                                                                          \u2502                      \n\u2502   ~0 rows   \u2502                                                                                                                                                                                                          \u2502                      \n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                                                                                                                                                                          \u2502                      \n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                                                                                                                                                                   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \n\u2502LEFT_DEL...  \u2502                                                                                                                                                                                                   \u2502  HASH_JOIN  \u2502               \n\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                                                                                                                                                                                   \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502               \n\u2502  Join Type: \u2502                                                                                                                                                                                                   \u2502  Join Type: \u2502               \n\u2502     MARK    \u2502                                                                                                                                                                                                   \u2502     MARK    \u2502               \n\u2502             \u2502                                                                                                                                                                                                   \u2502             \u2502               \n\u2502 Conditions: \u2502                                                                                                                                                                                                   \u2502 Conditions: \u2502               \n\u2502c_customer_sk\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502c_customer_sk\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \n\u2502 IS NOT DISTI\u2502                                                                                                                               \u2502                                                           \u2502       \u2502 IS NOT DISTI\u2502       \u2502       \n\u2502   NCT FROM  \u2502                                                                                                                               \u2502                                                           \u2502       \u2502   NCT FROM  \u2502       \u2502       \n\u2502 c_customer_s\u2502                                                                                                                               \u2502                                                           \u2502       \u2502 c_customer_s\u2502       \u2502       \n\u2502      k      \u2502                                                                                                                               \u2502                                                           \u2502       \u2502      k      \u2502       \u2502       \n\u2502             \u2502                                                                                                                               \u2502                                                           \u2502       \u2502             \u2502       \u2502       \n\u2502 ~16,425 rows\u2502                                                                                                                               \u2502                                                           \u2502       \u2502   ~0 rows   \u2502       \u2502       \n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                                                                                               \u2502                                                           \u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502       \n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                                                                                        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502LEFT_DEL...  \u2502                                                                                                                        \u2502  HASH_JOIN  \u2502                                             \u2502HASH_GROUP_BY\u2502\u2502COLUMN_D...  \u2502\u2502  PROJECTION \u2502\n\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                                                                                                        \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                             \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502  Join Type: \u2502                                                                                                                        \u2502  Join Type: \u2502                                             \u2502   Groups:   \u2502\u2502             \u2502\u2502c_customer_sk\u2502\n\u2502     SEMI    \u2502                                                                                                                        \u2502     MARK    \u2502                                             \u2502      #8     \u2502\u2502             \u2502\u2502             \u2502\n\u2502             \u2502                                                                                                                        \u2502             \u2502                                             \u2502             \u2502\u2502             \u2502\u2502             \u2502\n\u2502 Conditions: \u2502                                                                                                                        \u2502 Conditions: \u2502                                             \u2502             \u2502\u2502             \u2502\u2502             \u2502\n\u2502c_customer_sk\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502c_customer_sk\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                     \u2502             \u2502\u2502             \u2502\u2502             \u2502\n\u2502 IS NOT DISTI\u2502                                                    \u2502                                                           \u2502       \u2502 IS NOT DISTI\u2502       \u2502                                     \u2502             \u2502\u2502             \u2502\u2502             \u2502\n\u2502   NCT FROM  \u2502                                                    \u2502                                                           \u2502       \u2502   NCT FROM  \u2502       \u2502                                     \u2502             \u2502\u2502             \u2502\u2502             \u2502\n\u2502 c_customer_s\u2502                                                    \u2502                                                           \u2502       \u2502 c_customer_s\u2502       \u2502                                     \u2502             \u2502\u2502             \u2502\u2502             \u2502\n\u2502      k      \u2502                                                    \u2502                                                           \u2502       \u2502      k      \u2502       \u2502                                     \u2502             \u2502\u2502             \u2502\u2502             \u2502\n\u2502             \u2502                                                    \u2502                                                           \u2502       \u2502             \u2502       \u2502                                     \u2502             \u2502\u2502             \u2502\u2502             \u2502\n\u2502 ~16,425 rows\u2502                                                    \u2502                                                           \u2502       \u2502 ~16,425 rows\u2502       \u2502                                     \u2502 ~16,158 rows\u2502\u2502   ~0 rows   \u2502\u2502 ~5,739 rows \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                    \u2502                                                           \u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502                                     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  HASH_JOIN  \u2502                                             \u2502  HASH_JOIN  \u2502                                             \u2502HASH_GROUP_BY\u2502\u2502COLUMN_D...  \u2502\u2502  PROJECTION \u2502                                                            \u2502  HASH_JOIN  \u2502\n\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                             \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                             \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                                            \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502  Join Type: \u2502                                             \u2502  Join Type: \u2502                                             \u2502   Groups:   \u2502\u2502             \u2502\u2502c_customer_sk\u2502                                                            \u2502  Join Type: \u2502\n\u2502    INNER    \u2502                                             \u2502     SEMI    \u2502                                             \u2502      #8     \u2502\u2502             \u2502\u2502             \u2502                                                            \u2502    INNER    \u2502\n\u2502             \u2502                                             \u2502             \u2502                                             \u2502             \u2502\u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502\n\u2502 Conditions: \u2502                                             \u2502 Conditions: \u2502                                             \u2502             \u2502\u2502             \u2502\u2502             \u2502                                                            \u2502 Conditions: \u2502\n\u2502 cd_demo_sk =\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                     \u2502c_customer_sk\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                     \u2502             \u2502\u2502             \u2502\u2502             \u2502                                                            \u2502cs_ship_custo\u251c\n\u2502 c_current_cd\u2502       \u2502                                     \u2502 IS NOT DISTI\u2502       \u2502                                     \u2502             \u2502\u2502             \u2502\u2502             \u2502                                                            \u2502   mer_sk =  \u2502\n\u2502    emo_sk   \u2502       \u2502                                     \u2502   NCT FROM  \u2502       \u2502                                     \u2502             \u2502\u2502             \u2502\u2502             \u2502                                                            \u2502 c_customer_s\u2502\n\u2502             \u2502       \u2502                                     \u2502 c_customer_s\u2502       \u2502                                     \u2502             \u2502\u2502             \u2502\u2502             \u2502                                                            \u2502      k      \u2502\n\u2502             \u2502       \u2502                                     \u2502      k      \u2502       \u2502                                     \u2502             \u2502\u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502\n\u2502             \u2502       \u2502                                     \u2502             \u2502       \u2502                                     \u2502             \u2502\u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502\n\u2502 ~82,127 rows\u2502       \u2502                                     \u2502 ~16,425 rows\u2502       \u2502                                     \u2502 ~75,736 rows\u2502\u2502 ~16,425 rows\u2502\u2502 ~3,059 rows \u2502                                                            \u2502 ~5,739 rows \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502                                     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502                                     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  SEQ_SCAN   \u2502\u2502  HASH_JOIN  \u2502                              \u2502COLUMN_D...  \u2502\u2502  PROJECTION \u2502                                                            \u2502  HASH_JOIN  \u2502                                                            \u2502  HASH_JOIN  \u2502\n\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502                              \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                                            \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                                            \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n\u2502    Table:   \u2502\u2502  Join Type: \u2502                              \u2502             \u2502\u2502c_customer_sk\u2502                                                            \u2502  Join Type: \u2502                                                            \u2502  Join Type: \u2502\n\u2502customer_demo\u2502\u2502    INNER    \u2502                              \u2502             \u2502\u2502             \u2502                                                            \u2502    INNER    \u2502                                                            \u2502    INNER    \u2502\n\u2502   graphics  \u2502\u2502             \u2502                              \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                                                            \u2502             \u2502\n\u2502             \u2502\u2502 Conditions: \u2502                              \u2502             \u2502\u2502             \u2502                                                            \u2502 Conditions: \u2502                                                            \u2502 Conditions: \u2502\n\u2502    Type:    \u2502\u2502c_current_add\u2502                              \u2502             \u2502\u2502             \u2502                                                            \u2502ws_bill_custo\u2502                                                            \u2502cs_sold_date_\u2502\n\u2502  Sequential \u2502\u2502r_sk = ca_add\u2502                              \u2502             \u2502\u2502             \u2502                                                            \u2502   mer_sk =  \u2502                                                            \u2502sk = d_date_s\u2502\n\u2502     Scan    \u2502\u2502   ress_sk   \u2502                              \u2502             \u2502\u2502             \u2502                                                            \u2502 c_customer_s\u2502                                                            \u2502      k      \u2502\n\u2502             \u2502\u2502             \u2502                              \u2502             \u2502\u2502             \u2502                                                            \u2502      k      \u2502                                                            \u2502             \u2502\n\u2502 Projections:\u2502\u2502             \u2502                              \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                                                            \u2502             \u2502\n\u2502  cd_demo_sk \u2502\u2502             \u2502                              \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                                                            \u2502             \u2502\n\u2502  cd_gender  \u2502\u2502             \u2502                              \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                                                            \u2502             \u2502\n\u2502cd_marital_st\u2502\u2502             \u2502                              \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                                                            \u2502             \u2502\n\u2502     atus    \u2502\u2502             \u2502                              \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                                                            \u2502             \u2502\n\u2502cd_education_\u2502\u2502             \u2502                              \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                                                            \u2502             \u2502\n\u2502    status   \u2502\u2502             \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                      \u2502             \u2502\u2502             \u2502                                                            \u2502             \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                     \u2502             \u251c\n\u2502cd_purchase_e\u2502\u2502             \u2502       \u2502                      \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                      \u2502                                     \u2502             \u2502\n\u2502   stimate   \u2502\u2502             \u2502       \u2502                      \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                      \u2502                                     \u2502             \u2502\n\u2502cd_credit_rat\u2502\u2502             \u2502       \u2502                      \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                      \u2502                                     \u2502             \u2502\n\u2502     ing     \u2502\u2502             \u2502       \u2502                      \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                      \u2502                                     \u2502             \u2502\n\u2502 cd_dep_count\u2502\u2502             \u2502       \u2502                      \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                      \u2502                                     \u2502             \u2502\n\u2502cd_dep_employ\u2502\u2502             \u2502       \u2502                      \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                      \u2502                                     \u2502             \u2502\n\u2502   ed_count  \u2502\u2502             \u2502       \u2502                      \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                      \u2502                                     \u2502             \u2502\n\u2502cd_dep_colleg\u2502\u2502             \u2502       \u2502                      \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                      \u2502                                     \u2502             \u2502\n\u2502   e_count   \u2502\u2502             \u2502       \u2502                      \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                      \u2502                                     \u2502             \u2502\n\u2502             \u2502\u2502             \u2502       \u2502                      \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                      \u2502                                     \u2502             \u2502\n\u2502   Filters:  \u2502\u2502             \u2502       \u2502                      \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                      \u2502                                     \u2502             \u2502\n\u2502 cd_demo_sk> \u2502\u2502             \u2502       \u2502                      \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                      \u2502                                     \u2502             \u2502\n\u2502=4 AND cd_dem\u2502\u2502             \u2502       \u2502                      \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                      \u2502                                     \u2502             \u2502\n\u2502o_sk<=1920791\u2502\u2502             \u2502       \u2502                      \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                      \u2502                                     \u2502             \u2502\n\u2502             \u2502\u2502             \u2502       \u2502                      \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502                      \u2502                                     \u2502             \u2502\n\u2502~1,920,8...  \u2502\u2502 ~82,127 rows\u2502       \u2502                      \u2502 ~16,425 rows\u2502\u2502 ~45,354 rows\u2502                                                            \u2502 ~3,059 rows \u2502                      \u2502                                     \u2502~115,329 rows\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                      \u2502                                     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n               \u2502  SEQ_SCAN   \u2502\u2502  PROJECTION \u2502                              \u2502  HASH_JOIN  \u2502                                                            \u2502  HASH_JOIN  \u2502               \u2502  DELIM_SCAN \u2502                              \u2502  SEQ_SCAN   \u2502\n               \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502                              \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                                            \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502               \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502                              \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n               \u2502    Table:   \u2502\u2502      #0     \u2502                              \u2502  Join Type: \u2502                                                            \u2502  Join Type: \u2502               \u2502 Delim Index:\u2502                              \u2502    Table:   \u2502\n               \u2502   customer  \u2502\u2502             \u2502                              \u2502    INNER    \u2502                                                            \u2502    INNER    \u2502               \u2502      2      \u2502                              \u2502catalog_sales\u2502\n               \u2502             \u2502\u2502             \u2502                              \u2502             \u2502                                                            \u2502             \u2502               \u2502             \u2502                              \u2502             \u2502\n               \u2502    Type:    \u2502\u2502             \u2502                              \u2502 Conditions: \u2502                                                            \u2502 Conditions: \u2502               \u2502             \u2502                              \u2502    Type:    \u2502\n               \u2502  Sequential \u2502\u2502             \u2502                              \u2502ss_customer_s\u2502                                                            \u2502ws_sold_date_\u2502               \u2502             \u2502                              \u2502  Sequential \u2502\n               \u2502     Scan    \u2502\u2502             \u2502                              \u2502k = c_custome\u2502                                                            \u2502sk = d_date_s\u2502               \u2502             \u2502                              \u2502     Scan    \u2502\n               \u2502             \u2502\u2502             \u2502                              \u2502     r_sk    \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                     \u2502      k      \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502             \u2502                              \u2502             \u2502\n               \u2502 Projections:\u2502\u2502             \u2502                              \u2502             \u2502                      \u2502                                     \u2502             \u2502       \u2502       \u2502             \u2502                              \u2502 Projections:\u2502\n               \u2502c_current_add\u2502\u2502             \u2502                              \u2502             \u2502                      \u2502                                     \u2502             \u2502       \u2502       \u2502             \u2502                              \u2502cs_ship_custo\u2502\n               \u2502     r_sk    \u2502\u2502             \u2502                              \u2502             \u2502                      \u2502                                     \u2502             \u2502       \u2502       \u2502             \u2502                              \u2502    mer_sk   \u2502\n               \u2502c_current_cde\u2502\u2502             \u2502                              \u2502             \u2502                      \u2502                                     \u2502             \u2502       \u2502       \u2502             \u2502                              \u2502cs_sold_date_\u2502\n               \u2502    mo_sk    \u2502\u2502             \u2502                              \u2502             \u2502                      \u2502                                     \u2502             \u2502       \u2502       \u2502             \u2502                              \u2502      sk     \u2502\n               \u2502c_customer_sk\u2502\u2502             \u2502                              \u2502             \u2502                      \u2502                                     \u2502             \u2502       \u2502       \u2502             \u2502                              \u2502             \u2502\n               \u2502             \u2502\u2502             \u2502                              \u2502             \u2502                      \u2502                                     \u2502             \u2502       \u2502       \u2502             \u2502                              \u2502             \u2502\n               \u2502~500,000 rows\u2502\u2502 ~50,000 rows\u2502                              \u2502 ~45,354 rows\u2502                      \u2502                                     \u2502 ~57,640 rows\u2502       \u2502       \u2502 ~16,158 rows\u2502                              \u2502~14,401,...  \u2502\n               \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                      \u2502                                     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                            \n                              \u2502    FILTER   \u2502                              \u2502  HASH_JOIN  \u2502               \u2502  DELIM_SCAN \u2502                              \u2502  SEQ_SCAN   \u2502\u2502    FILTER   \u2502                                                            \n                              \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502                              \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502               \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502                              \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                                            \n                              \u2502   IN (...)  \u2502                              \u2502  Join Type: \u2502               \u2502 Delim Index:\u2502                              \u2502    Table:   \u2502\u2502  (d_date_sk \u2502                                                            \n                              \u2502             \u2502                              \u2502    INNER    \u2502               \u2502      1      \u2502                              \u2502  web_sales  \u2502\u2502    BETWEEN  \u2502                                                            \n                              \u2502             \u2502                              \u2502             \u2502               \u2502             \u2502                              \u2502             \u2502\u2502  2450816 AND\u2502                                                            \n                              \u2502             \u2502                              \u2502 Conditions: \u2502               \u2502             \u2502                              \u2502    Type:    \u2502\u2502   2452642)  \u2502                                                            \n                              \u2502             \u2502                              \u2502ss_sold_date_\u2502               \u2502             \u2502                              \u2502  Sequential \u2502\u2502             \u2502                                                            \n                              \u2502             \u2502                              \u2502sk = d_date_s\u2502               \u2502             \u2502                              \u2502     Scan    \u2502\u2502             \u2502                                                            \n                              \u2502             \u2502                              \u2502      k      \u2502               \u2502             \u2502                              \u2502             \u2502\u2502             \u2502                                                            \n                              \u2502             \u2502                              \u2502             \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502             \u2502                              \u2502 Projections:\u2502\u2502             \u2502                                                            \n                              \u2502             \u2502                              \u2502             \u2502       \u2502       \u2502             \u2502                              \u2502ws_bill_custo\u2502\u2502             \u2502                                                            \n                              \u2502             \u2502                              \u2502             \u2502       \u2502       \u2502             \u2502                              \u2502    mer_sk   \u2502\u2502             \u2502                                                            \n                              \u2502             \u2502                              \u2502             \u2502       \u2502       \u2502             \u2502                              \u2502ws_sold_date_\u2502\u2502             \u2502                                                            \n                              \u2502             \u2502                              \u2502             \u2502       \u2502       \u2502             \u2502                              \u2502      sk     \u2502\u2502             \u2502                                                            \n                              \u2502             \u2502                              \u2502             \u2502       \u2502       \u2502             \u2502                              \u2502             \u2502\u2502             \u2502                                                            \n                              \u2502             \u2502                              \u2502             \u2502       \u2502       \u2502             \u2502                              \u2502             \u2502\u2502             \u2502                                                            \n                              \u2502             \u2502                              \u2502             \u2502       \u2502       \u2502             \u2502                              \u2502             \u2502\u2502             \u2502                                                            \n                              \u2502 ~50,000 rows\u2502                              \u2502~230,647 rows\u2502       \u2502       \u2502 ~75,736 rows\u2502                              \u2502~7,197,5...  \u2502\u2502  ~585 rows  \u2502                                                            \n                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                            \n                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                              \u2502  HASH_JOIN  \u2502                              \u2502  SEQ_SCAN   \u2502\u2502    FILTER   \u2502                                                            \u2502  SEQ_SCAN   \u2502\n                              \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502                              \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                                            \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n                              \u2502  Join Type: \u2502                              \u2502    Table:   \u2502\u2502  (d_date_sk \u2502                                                            \u2502    Table:   \u2502\n                              \u2502     MARK    \u2502                              \u2502 store_sales \u2502\u2502    BETWEEN  \u2502                                                            \u2502   date_dim  \u2502\n                              \u2502             \u2502                              \u2502             \u2502\u2502  2450816 AND\u2502                                                            \u2502             \u2502\n                              \u2502 Conditions: \u2502                              \u2502    Type:    \u2502\u2502   2452642)  \u2502                                                            \u2502    Type:    \u2502\n                              \u2502 ca_county = \u2502                              \u2502  Sequential \u2502\u2502             \u2502                                                            \u2502  Sequential \u2502\n                              \u2502      #0     \u2502                              \u2502     Scan    \u2502\u2502             \u2502                                                            \u2502     Scan    \u2502\n                              \u2502             \u2502                              \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502\n                              \u2502             \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                      \u2502 Projections:\u2502\u2502             \u2502                                                            \u2502 Projections:\u2502\n                              \u2502             \u2502       \u2502                      \u2502ss_customer_s\u2502\u2502             \u2502                                                            \u2502  d_date_sk  \u2502\n                              \u2502             \u2502       \u2502                      \u2502      k      \u2502\u2502             \u2502                                                            \u2502             \u2502\n                              \u2502             \u2502       \u2502                      \u2502ss_sold_date_\u2502\u2502             \u2502                                                            \u2502   Filters:  \u2502\n                              \u2502             \u2502       \u2502                      \u2502      sk     \u2502\u2502             \u2502                                                            \u2502 d_year=2001 \u2502\n                              \u2502             \u2502       \u2502                      \u2502             \u2502\u2502             \u2502                                                            \u2502 d_moy>=1 AND\u2502\n                              \u2502             \u2502       \u2502                      \u2502             \u2502\u2502             \u2502                                                            \u2502   d_moy<=4  \u2502\n                              \u2502             \u2502       \u2502                      \u2502             \u2502\u2502             \u2502                                                            \u2502             \u2502\n                              \u2502~250,000 rows\u2502       \u2502                      \u2502~28,800,...  \u2502\u2502  ~585 rows  \u2502                                                            \u2502  ~585 rows  \u2502\n                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                              \u2502  SEQ_SCAN   \u2502\u2502COLUMN_D...  \u2502                              \u2502  SEQ_SCAN   \u2502\n                              \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502                              \u2502    \u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n                              \u2502    Table:   \u2502\u2502             \u2502                              \u2502    Table:   \u2502\n                              \u2502customer_addr\u2502\u2502             \u2502                              \u2502   date_dim  \u2502\n                              \u2502     ess     \u2502\u2502             \u2502                              \u2502             \u2502\n                              \u2502             \u2502\u2502             \u2502                              \u2502    Type:    \u2502\n                              \u2502    Type:    \u2502\u2502             \u2502                              \u2502  Sequential \u2502\n                              \u2502  Sequential \u2502\u2502             \u2502                              \u2502     Scan    \u2502\n                              \u2502     Scan    \u2502\u2502             \u2502                              \u2502             \u2502\n                              \u2502             \u2502\u2502             \u2502                              \u2502 Projections:\u2502\n                              \u2502 Projections:\u2502\u2502             \u2502                              \u2502  d_date_sk  \u2502\n                              \u2502ca_address_sk\u2502\u2502             \u2502                              \u2502             \u2502\n                              \u2502  ca_county  \u2502\u2502             \u2502                              \u2502   Filters:  \u2502\n                              \u2502             \u2502\u2502             \u2502                              \u2502 d_year=2001 \u2502\n                              \u2502   Filters:  \u2502\u2502             \u2502                              \u2502 d_moy>=1 AND\u2502\n                              \u2502  optional:  \u2502\u2502             \u2502                              \u2502   d_moy<=4  \u2502\n                              \u2502   ca_county \u2502\u2502             \u2502                              \u2502             \u2502\n                              \u2502  IN ('Storey\u2502\u2502             \u2502                              \u2502             \u2502\n                              \u2502   County',  \u2502\u2502             \u2502                              \u2502             \u2502\n                              \u2502  'Marquette \u2502\u2502             \u2502                              \u2502             \u2502\n                              \u2502   County',  \u2502\u2502             \u2502                              \u2502             \u2502\n                              \u2502'Warren Count\u2502\u2502             \u2502                              \u2502             \u2502\n                              \u2502 y', 'Cochran\u2502\u2502             \u2502                              \u2502             \u2502\n                              \u2502   County',  \u2502\u2502             \u2502                              \u2502             \u2502\n                              \u2502  'Kandiyohi \u2502\u2502             \u2502                              \u2502             \u2502\n                              \u2502   County')  \u2502\u2502             \u2502                              \u2502             \u2502\n                              \u2502             \u2502\u2502             \u2502                              \u2502             \u2502\n                              \u2502~250,000 rows\u2502\u2502   ~0 rows   \u2502                              \u2502  ~585 rows  \u2502\n                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n",
  "plan_scanner_text": null,
  "global_knowledge": {
    "dataset": "duckdb_tpcds",
    "engine": "duckdb",
    "scale_factor": 10,
    "last_updated": "2026-02-08T20:25:13.977935",
    "source_runs": [
      "kimi_k2.5",
      "retry_3worker_20260205_235909_details",
      "retry_4worker_20260206_004710_details",
      "swarm_batch_20260208_102033"
    ],
    "summary": {
      "total": 101,
      "with_sql": 101,
      "with_reasoning": 99,
      "wins": 92,
      "improved": 4,
      "neutral": 3,
      "regression": 2,
      "avg_speedup": 1.8656
    },
    "queries": {
      "q1": {
        "query_id": "q1",
        "status": "WIN",
        "best_speedup": 2.92,
        "original_ms": 239.26,
        "optimized_ms": 81.94,
        "original_sql": "-- start query 1 in stream 0 using template query1.tpl\nwith customer_total_return as\n(select sr_customer_sk as ctr_customer_sk\n,sr_store_sk as ctr_store_sk\n,sum(SR_FEE) as ctr_total_return\nfrom store_returns\n,date_dim\nwhere sr_returned_date_sk = d_date_sk\nand d_year =2000\ngroup by sr_customer_sk\n,sr_store_sk)\n select c_customer_id\nfrom customer_total_return ctr1\n,store\n,customer\nwhere ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2\nfrom customer_total_return ctr2\nwhere ctr1.ctr_store_sk = ctr2.ctr_store_sk)\nand s_store_sk = ctr1.ctr_store_sk\nand s_state = 'SD'\nand ctr1.ctr_customer_sk = c_customer_sk\norder by c_customer_id\n LIMIT 100;\n\n-- end query 1 in stream 0 using template query1.tpl\n",
        "optimized_sql": "WITH filtered_returns AS (SELECT sr.sr_customer_sk, sr.sr_store_sk, sr.SR_FEE FROM store_returns AS sr JOIN date_dim AS d ON sr.sr_returned_date_sk = d.d_date_sk JOIN store AS s ON sr.sr_store_sk = s.s_store_sk WHERE d.d_year = 2000 AND s.s_state = 'SD'), customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, SUM(SR_FEE) AS ctr_total_return FROM filtered_returns GROUP BY sr_customer_sk, sr_store_sk), store_avg_return AS (SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS avg_return_threshold FROM customer_total_return GROUP BY ctr_store_sk)\nSELECT c.c_customer_id FROM customer_total_return AS ctr1 JOIN store_avg_return AS sar ON ctr1.ctr_store_sk = sar.ctr_store_sk JOIN customer AS c ON ctr1.ctr_customer_sk = c.c_customer_sk WHERE ctr1.ctr_total_return > sar.avg_return_threshold ORDER BY c.c_customer_id LIMIT 100",
        "transforms": [
          "decorrelate"
        ],
        "principle": "decorrelate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"decorrelate\",\n      \"nodes\": {\n        \"filtered_returns\": \"SELECT sr.sr_customer_sk, sr.sr_store_sk, sr.SR_FEE FROM store_returns sr JOIN date_dim d ON sr.sr_returned_date_sk = d.d_date_sk JOIN store s ON sr.sr_store_sk = s.s_store_sk WHERE d.d_year = 2000 AND s.s_state = 'SD'\",\n        \"customer_total_return\": \"SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, SUM(SR_FEE) AS ctr_total_return FROM filtered_returns GROUP BY sr_customer_sk, sr_store_sk\",\n        \"store_avg_return\": \"SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS avg_return_threshold FROM customer_total_return GROUP BY ctr_store_sk\",\n        \"main_query\": \"SELECT c.c_customer_id FROM customer_total_return ctr1 JOIN store_avg_return sar ON ctr1.ctr_store_sk = sar.ctr_store_sk JOIN customer c ON ctr1.ctr_customer_sk = c.c_customer_sk WHERE ctr1.ctr_total_return > sar.avg_return_threshold ORDER BY c.c_customer_id LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\"\n      ],\n      \"expected_speedup\": \"2.90x\",\n      \"risk\": \"low\"\n    }\n  ]\n}\n```",
        "provenance": {
          "source": "Kimi",
          "run": "kimi_k2.5",
          "model": "kimi-k2.5",
          "worker_id": null,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 2.92,
            "original_ms": 239.26,
            "optimized_ms": 81.99,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_cte_prefetch",
            "speedup": 1.6196398374168426,
            "original_ms": 106.62912366691064,
            "optimized_ms": 65.83508333369537,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.504349354318293,
            "original_ms": 106.62912366691064,
            "optimized_ms": 70.88055933339395,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.05013483339786,
            "original_ms": 100.77745399970202,
            "optimized_ms": 95.96620433361143,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_correlation_elimination",
            "speedup": 1.0140783792192487,
            "original_ms": 106.62912366691064,
            "optimized_ms": 105.14879900013814,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_predicate_pushdown",
            "speedup": 1.0119960016283858,
            "original_ms": 106.62912366691064,
            "optimized_ms": 105.36516299998766,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.5847422845091331,
            "original_ms": 107.34793099982198,
            "optimized_ms": 183.58161166664408,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q10": {
        "query_id": "q10",
        "status": "WIN",
        "best_speedup": 1.32,
        "original_ms": 290.32,
        "optimized_ms": 219.94,
        "original_sql": "SELECT cd_gender,\n       cd_marital_status,\n       cd_education_status,\n       count(*) cnt1,\n       cd_purchase_estimate,\n       count(*) cnt2,\n       cd_credit_rating,\n       count(*) cnt3,\n       cd_dep_count,\n       count(*) cnt4,\n       cd_dep_employed_count,\n       count(*) cnt5,\n       cd_dep_college_count,\n       count(*) cnt6\nFROM customer c,\n     customer_address ca,\n     customer_demographics\nWHERE c.c_current_addr_sk = ca.ca_address_sk\n  AND ca_county IN ('Rush County',\n                    'Toole County',\n                    'Jefferson County',\n                    'Dona Ana County',\n                    'La Porte County')\n  AND cd_demo_sk = c.c_current_cdemo_sk\n  AND EXISTS\n    (SELECT *\n     FROM store_sales,\n          date_dim\n     WHERE c.c_customer_sk = ss_customer_sk\n       AND ss_sold_date_sk = d_date_sk\n       AND d_year = 2002\n       AND d_moy BETWEEN 1 AND 1+3)\n  AND (EXISTS\n         (SELECT *\n          FROM web_sales,\n               date_dim\n          WHERE c.c_customer_sk = ws_bill_customer_sk\n            AND ws_sold_date_sk = d_date_sk\n            AND d_year = 2002\n            AND d_moy BETWEEN 1 AND 1+3)\n       OR EXISTS\n         (SELECT *\n          FROM catalog_sales,\n               date_dim\n          WHERE c.c_customer_sk = cs_ship_customer_sk\n            AND cs_sold_date_sk = d_date_sk\n            AND d_year = 2002\n            AND d_moy BETWEEN 1 AND 1+3))\nGROUP BY cd_gender,\n         cd_marital_status,\n         cd_education_status,\n         cd_purchase_estimate,\n         cd_credit_rating,\n         cd_dep_count,\n         cd_dep_employed_count,\n         cd_dep_college_count\nORDER BY cd_gender,\n         cd_marital_status,\n         cd_education_status,\n         cd_purchase_estimate,\n         cd_credit_rating,\n         cd_dep_count,\n         cd_dep_employed_count,\n         cd_dep_college_count\nLIMIT 100;\n\n",
        "optimized_sql": "WITH date_range AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002 AND d_moy BETWEEN 1 AND 4), store_sales_customers AS (SELECT DISTINCT ss_customer_sk FROM store_sales JOIN date_range ON ss_sold_date_sk = d_date_sk), web_sales_customers AS (SELECT DISTINCT ws_bill_customer_sk FROM web_sales JOIN date_range ON ws_sold_date_sk = d_date_sk), catalog_sales_customers AS (SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales JOIN date_range ON cs_sold_date_sk = d_date_sk)\nSELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics AS cd ON cd_demo_sk = c.c_current_cdemo_sk JOIN store_sales_customers AS ssc ON c.c_customer_sk = ssc.ss_customer_sk LEFT JOIN web_sales_customers AS wsc ON c.c_customer_sk = wsc.ws_bill_customer_sk LEFT JOIN catalog_sales_customers AS csc ON c.c_customer_sk = csc.cs_ship_customer_sk WHERE ca_county IN ('Rush County', 'Toole County', 'Jefferson County', 'Dona Ana County', 'La Porte County') AND (NOT wsc.ws_bill_customer_sk IS NULL OR NOT csc.cs_ship_customer_sk IS NULL) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"or_to_union\",\n      \"nodes\": {\n        \"date_range\": \"SELECT d_date_sk FROM date_dim WHERE d_year = 2002 AND d_moy BETWEEN 1 AND 4\",\n        \"store_sales_customers\": \"SELECT DISTINCT ss_customer_sk FROM store_sales JOIN date_range ON ss_sold_date_sk = d_date_sk\",\n        \"web_sales_customers\": \"SELECT DISTINCT ws_bill_customer_sk FROM web_sales JOIN date_range ON ws_sold_date_sk = d_date_sk\",\n        \"catalog_sales_customers\": \"SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales JOIN date_range ON cs_sold_date_sk = d_date_sk\",\n        \"main_query\": \"SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cd_demo_sk = c.c_current_cdemo_sk JOIN store_sales_customers ssc ON c.c_customer_sk = ssc.ss_customer_sk LEFT JOIN web_sales_customers wsc ON c.c_customer_sk = wsc.ws_bill_customer_sk LEFT JOIN catalog_sales_customers csc ON c.c_customer_sk = csc.cs_ship_customer_sk WHERE ca_county IN ('Rush County', 'Toole County', 'Jefferson County', 'Dona Ana County', 'La Porte County') AND (wsc.ws_bill_customer_sk IS NOT NULL OR csc.cs_ship_customer_sk IS NOT NULL) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\", \n        \"same column output\",\n        \"same ordering\",\n        \"same aggregation\"\n      ],\n      \"expected_speedup\": \"2.98x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Transformed OR condition on EXISTS subqueries into UNION-like structure using LEFT JOINs. Created materialized CTEs for each sales channel with filtered date_dim to avoid repeated scanning. Replaced correlated subqueries with precomputed sets of customer keys that meet each condition. This eliminates repeated scanning of large fact tables (store_sales, web_sales, catalog_sales) and reduces the OR evaluation to simple NULL checks.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.4661522746082845,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_prefiltering",
            "speedup": 1.1092221064259817,
            "original_ms": 225.99808833304755,
            "optimized_ms": 203.7446666666559,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.0717738290314007,
            "original_ms": 225.99808833304755,
            "optimized_ms": 210.86360033374754,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filtering",
            "speedup": 1.0589036621576347,
            "original_ms": 225.99808833304755,
            "optimized_ms": 213.4264866669279,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.02,
            "original_ms": 290.32,
            "optimized_ms": 285.05,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": []
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.9676581414463138,
            "original_ms": 205.64651533337988,
            "optimized_ms": 212.51980066638984,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.8744089051196285,
            "original_ms": 220.6602286666263,
            "optimized_ms": 252.35359266662272,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.4868575590566114,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.46312547333344894,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_fact_prefetch_restructure",
            "speedup": 0,
            "original_ms": 225.99808833304755,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q11": {
        "query_id": "q11",
        "status": "WIN",
        "best_speedup": 4.0,
        "original_ms": 6017.12,
        "optimized_ms": 1504.28,
        "original_sql": "-- start query 11 in stream 0 using template query11.tpl\nwith year_total as (\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,c_preferred_cust_flag customer_preferred_cust_flag\n       ,c_birth_country customer_birth_country\n       ,c_login customer_login\n       ,c_email_address customer_email_address\n       ,d_year dyear\n       ,sum(ss_ext_list_price-ss_ext_discount_amt) year_total\n       ,'s' sale_type\n from customer\n     ,store_sales\n     ,date_dim\n where c_customer_sk = ss_customer_sk\n   and ss_sold_date_sk = d_date_sk\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,c_preferred_cust_flag \n         ,c_birth_country\n         ,c_login\n         ,c_email_address\n         ,d_year \n union all\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,c_preferred_cust_flag customer_preferred_cust_flag\n       ,c_birth_country customer_birth_country\n       ,c_login customer_login\n       ,c_email_address customer_email_address\n       ,d_year dyear\n       ,sum(ws_ext_list_price-ws_ext_discount_amt) year_total\n       ,'w' sale_type\n from customer\n     ,web_sales\n     ,date_dim\n where c_customer_sk = ws_bill_customer_sk\n   and ws_sold_date_sk = d_date_sk\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,c_preferred_cust_flag \n         ,c_birth_country\n         ,c_login\n         ,c_email_address\n         ,d_year\n         )\n  select \n                  t_s_secyear.customer_id\n                 ,t_s_secyear.customer_first_name\n                 ,t_s_secyear.customer_last_name\n                 ,t_s_secyear.customer_birth_country\n from year_total t_s_firstyear\n     ,year_total t_s_secyear\n     ,year_total t_w_firstyear\n     ,year_total t_w_secyear\n where t_s_secyear.customer_id = t_s_firstyear.customer_id\n         and t_s_firstyear.customer_id = t_w_secyear.customer_id\n         and t_s_firstyear.customer_id = t_w_firstyear.customer_id\n         and t_s_firstyear.sale_type = 's'\n         and t_w_firstyear.sale_type = 'w'\n         and t_s_secyear.sale_type = 's'\n         and t_w_secyear.sale_type = 'w'\n         and t_s_firstyear.dyear = 2001\n         and t_s_secyear.dyear = 2001+1\n         and t_w_firstyear.dyear = 2001\n         and t_w_secyear.dyear = 2001+1\n         and t_s_firstyear.year_total > 0\n         and t_w_firstyear.year_total > 0\n         and case when t_w_firstyear.year_total > 0 then t_w_secyear.year_total / t_w_firstyear.year_total else 0.0 end\n             > case when t_s_firstyear.year_total > 0 then t_s_secyear.year_total / t_s_firstyear.year_total else 0.0 end\n order by t_s_secyear.customer_id\n         ,t_s_secyear.customer_first_name\n         ,t_s_secyear.customer_last_name\n         ,t_s_secyear.customer_birth_country\n LIMIT 100;\n\n-- end query 11 in stream 0 using template query11.tpl\n",
        "optimized_sql": "WITH \n-- Pre-filter date_dim for years 2001 and 2002\ndate_range AS (\n    SELECT d_date_sk, d_year \n    FROM date_dim \n    WHERE d_year IN (2001, 2002)\n),\n-- Store sales for 2001\nstore_2001 AS (\n    SELECT\n        c.c_customer_id AS customer_id,\n        c.c_first_name AS customer_first_name,\n        c.c_last_name AS customer_last_name,\n        c.c_birth_country AS customer_birth_country,\n        SUM(ss_ext_list_price - ss_ext_discount_amt) AS year_total\n    FROM customer c\n    JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk\n    JOIN date_range d ON ss.ss_sold_date_sk = d.d_date_sk\n    WHERE d.d_year = 2001\n    GROUP BY\n        c.c_customer_id,\n        c.c_first_name,\n        c.c_last_name,\n        c.c_birth_country\n),\n-- Store sales for 2002  \nstore_2002 AS (\n    SELECT\n        c.c_customer_id AS customer_id,\n        c.c_first_name AS customer_first_name,\n        c.c_last_name AS customer_last_name,\n        c.c_birth_country AS customer_birth_country,\n        SUM(ss_ext_list_price - ss_ext_discount_amt) AS year_total\n    FROM customer c\n    JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk\n    JOIN date_range d ON ss.ss_sold_date_sk = d.d_date_sk\n    WHERE d.d_year = 2002\n    GROUP BY\n        c.c_customer_id,\n        c.c_first_name,\n        c.c_last_name,\n        c.c_birth_country\n),\n-- Web sales for 2001\nweb_2001 AS (\n    SELECT\n        c.c_customer_id AS customer_id,\n        c.c_first_name AS customer_first_name,\n        c.c_last_name AS customer_last_name,\n        c.c_birth_country AS customer_birth_country,\n        SUM(ws_ext_list_price - ws_ext_discount_amt) AS year_total\n    FROM customer c\n    JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk\n    JOIN date_range d ON ws.ws_sold_date_sk = d.d_date_sk\n    WHERE d.d_year = 2001\n    GROUP BY\n        c.c_customer_id,\n        c.c_first_name,\n        c.c_last_name,\n        c.c_birth_country\n),\n-- Web sales for 2002\nweb_2002 AS (\n    SELECT\n        c.c_customer_id AS customer_id,\n        c.c_first_name AS customer_first_name,\n        c.c_last_name AS customer_last_name,\n        c.c_birth_country AS customer_birth_country,\n        SUM(ws_ext_list_price - ws_ext_discount_amt) AS year_total\n    FROM customer c\n    JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk\n    JOIN date_range d ON ws.ws_sold_date_sk = d.d_date_sk\n    WHERE d.d_year = 2002\n    GROUP BY\n        c.c_customer_id,\n        c.c_first_name,\n        c.c_last_name,\n        c.c_birth_country\n)\n-- Main query joining the pre-aggregated CTEs\nSELECT\n    s2.customer_id,\n    s2.customer_first_name,\n    s2.customer_last_name,\n    s2.customer_birth_country\nFROM store_2001 s1\nJOIN store_2002 s2 ON s1.customer_id = s2.customer_id\nJOIN web_2001 w1 ON s1.customer_id = w1.customer_id\nJOIN web_2002 w2 ON s1.customer_id = w2.customer_id\nWHERE s1.year_total > 0\n    AND w1.year_total > 0\n    AND CASE \n        WHEN w1.year_total > 0 \n        THEN w2.year_total * 1.0 / w1.year_total \n        ELSE 0.0 \n    END > CASE \n        WHEN s1.year_total > 0 \n        THEN s2.year_total * 1.0 / s1.year_total \n        ELSE 0.0 \n    END\nORDER BY\n    s2.customer_id,\n    s2.customer_first_name,\n    s2.customer_last_name,\n    s2.customer_birth_country\nLIMIT 100;",
        "transforms": [
          "single_pass_aggregation",
          "date_cte_isolate",
          "prefetch_fact_join"
        ],
        "principle": "single_pass_aggregation",
        "changes_description": null,
        "reasoning": "```sql\nWITH \n-- Pre-filter date_dim for years 2001 and 2002\ndate_range AS (\n    SELECT d_date_sk, d_year \n    FROM date_dim \n    WHERE d_year IN (2001, 2002)\n),\n-- Store sales for 2001\nstore_2001 AS (\n    SELECT\n        c.c_customer_id AS customer_id,\n        c.c_first_name AS customer_first_name,\n        c.c_last_name AS customer_last_name,\n        c.c_birth_country AS customer_birth_country,\n        SUM(ss_ext_list_price - ss_ext_discount_amt) AS year_total\n    FROM customer c\n    JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk\n    JOIN date_range d ON ss.ss_sold_date_sk = d.d_date_sk\n    WHERE d.d_year = 2001\n    GROUP BY\n        c.c_customer_id,\n        c.c_first_name,\n        c.c_last_name,\n        c.c_birth_country\n),\n-- Store sales for 2002  \nstore_2002 AS (\n    SELECT\n        c.c_customer_id AS customer_id,\n        c.c_first_name AS customer_first_name,\n        c.c_last_name AS customer_last_name,\n        c.c_birth_country AS customer_birth_country,\n        SUM(ss_ext_list_price - ss_ext_discount_amt) AS year_total\n    FROM customer c\n    JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk\n    JOIN date_range d ON ss.ss_sold_date_sk = d.d_date_sk\n    WHERE d.d_year = 2002\n    GROUP BY\n        c.c_customer_id,\n        c.c_first_name,\n        c.c_last_name,\n        c.c_birth_country\n),\n-- Web sales for 2001\nweb_2001 AS (\n    SELECT\n        c.c_customer_id AS customer_id,\n        c.c_first_name AS customer_first_name,\n        c.c_last_name AS customer_last_name,\n        c.c_birth_country AS customer_birth_country,\n        SUM(ws_ext_list_price - ws_ext_discount_amt) AS year_total\n    FROM customer c\n    JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk\n    JOIN date_range d ON ws.ws_sold_date_sk = d.d_date_sk\n    WHERE d.d_year = 2001\n    GROUP BY\n        c.c_customer_id,\n        c.c_first_name,\n        c.c_last_name,\n        c.c_birth_country\n),\n-- Web sales for 2002\nweb_2002 AS (\n    SELECT\n        c.c_customer_id AS customer_id,\n        c.c_first_name AS customer_first_name,\n        c.c_last_name AS customer_last_name,\n        c.c_birth_country AS customer_birth_country,\n        SUM(ws_ext_list_price - ws_ext_discount_amt) AS year_total\n    FROM customer c\n    JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk\n    JOIN date_range d ON ws.ws_sold_date_sk = d.d_date_sk\n    WHERE d.d_year = 2002\n    GROUP BY\n        c.c_customer_id,\n        c.c_first_name,\n        c.c_last_name,\n        c.c_birth_country\n)\n-- Main query joining the pre-aggregated CTEs\nSELECT\n    s2.customer_id,\n    s2.customer_first_name,\n    s2.customer_last_name,\n    s2.customer_birth_country\nFROM store_2001 s1\nJOIN store_2002 s2 ON s1.customer_id = s2.customer_id\nJOIN web_2001 w1 ON s1.customer_id = w1.customer_id\nJOIN web_2002 w2 ON s1.customer_id = w2.customer_id\nWHERE s1.year_total > 0\n    AND w1.year_total > 0\n    AND CASE \n        WHEN w1.year_total > 0 \n        THEN w2.year_total * 1.0 / w1.year_total \n        ELSE 0.0 \n    END > CASE \n        WHEN s1.year_total > 0 \n        THEN s2.year_total * 1.0 / s1.year_total \n        ELSE 0.0 \n    END\nORDER BY\n    s2.customer_id,\n    s2.customer_first_name,\n    s2.customer_last_name,\n    s2.customer_birth_country\nLIMIT 100;\n```\n\n**Changes**: Split the monolithic UNION CTE into four separate CTEs for each (channel, year) combination, pre-filtering date_dim early and pushing customer joins into each CTE. This eliminates the expensive 4-way self-join on a large CTE and reduces data movement.\n\n**Expected speedup**: ~2.5-3.5x due to reduced intermediate result size, better predicate pushdown, and elimination of redundant customer joins across channels.",
        "provenance": {
          "source": "Evo",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": "aggressive_multi_cte_restructure"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_cte_restructure",
            "speedup": 1.2689008923388794,
            "original_ms": 3110.1441699999364,
            "optimized_ms": 2451.053654999972,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_date_range_cte",
              "multi_dimension_prefetch",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.2435931071893527,
            "original_ms": 3074.9815910003235,
            "optimized_ms": 2472.6589213332772,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filter",
            "speedup": 1.0872867626529286,
            "original_ms": 3110.1441699999364,
            "optimized_ms": 2860.4635656662745,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_date_dimension_isolate",
            "speedup": 1.0483745289960251,
            "original_ms": 3110.1441699999364,
            "optimized_ms": 2966.6346176669927,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.98,
            "original_ms": 6017.12,
            "optimized_ms": 6119.24,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.45372288795293997,
            "original_ms": 3110.1441699999364,
            "optimized_ms": 6854.721797333089,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "union_cte_split",
              "intersect_to_exists",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.09100442704457776,
            "original_ms": 3538.7332740004545,
            "optimized_ms": 38885.28711099995,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "single_pass_aggregation",
              "date_cte_isolate",
              "prefetch_fact_join"
            ]
          }
        ]
      },
      "q12": {
        "query_id": "q12",
        "status": "WIN",
        "best_speedup": 1.23,
        "original_ms": 110.27,
        "optimized_ms": 89.65,
        "original_sql": "SELECT i_item_id,\n       i_item_desc,\n       i_category,\n       i_class,\n       i_current_price,\n       sum(ws_ext_sales_price) AS itemrevenue,\n       sum(ws_ext_sales_price)*100.0000/sum(sum(ws_ext_sales_price)) OVER (PARTITION BY i_class) AS revenueratio\nFROM web_sales,\n     item,\n     date_dim\nWHERE ws_item_sk = i_item_sk\n  AND i_category IN ('Sports',\n                     'Books',\n                     'Home')\n  AND ws_sold_date_sk = d_date_sk\n  AND d_date BETWEEN cast('1999-02-22' AS date) AND cast('1999-03-24' AS date)\nGROUP BY i_item_id,\n         i_item_desc,\n         i_category,\n         i_class,\n         i_current_price\nORDER BY i_category,\n         i_class,\n         i_item_id,\n         i_item_desc,\n         revenueratio\nLIMIT 100;\n\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-02-22' AS DATE) AND CAST('1999-03-24' AS DATE)), filtered_items AS (SELECT i_item_sk, i_item_id, i_item_desc, i_category, i_class, i_current_price FROM item WHERE i_category IN ('Sports', 'Books', 'Home')), filtered_sales AS (SELECT ws_item_sk, ws_ext_sales_price FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk), joined_sales AS (SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, ws_ext_sales_price FROM filtered_sales JOIN filtered_items ON ws_item_sk = i_item_sk), aggregated_sales AS (SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, SUM(ws_ext_sales_price) AS itemrevenue FROM joined_sales GROUP BY i_item_id, i_item_desc, i_category, i_class, i_current_price)\nSELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, itemrevenue, itemrevenue * 100.0000 / SUM(itemrevenue) OVER (PARTITION BY i_class) AS revenueratio FROM aggregated_sales ORDER BY i_category, i_class, i_item_id, i_item_desc, revenueratio LIMIT 100",
        "transforms": [
          "prefetch_fact_join"
        ],
        "principle": "prefetch_fact_join",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-02-22' AS DATE) AND CAST('1999-03-24' AS DATE)\",\n        \"filtered_items\": \"SELECT i_item_sk, i_item_id, i_item_desc, i_category, i_class, i_current_price FROM item WHERE i_category IN ('Sports', 'Books', 'Home')\",\n        \"filtered_sales\": \"SELECT ws_item_sk, ws_ext_sales_price FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk\",\n        \"joined_sales\": \"SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, ws_ext_sales_price FROM filtered_sales JOIN filtered_items ON ws_item_sk = i_item_sk\",\n        \"aggregated_sales\": \"SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, SUM(ws_ext_sales_price) AS itemrevenue FROM joined_sales GROUP BY i_item_id, i_item_desc, i_category, i_class, i_current_price\",\n        \"main_query\": \"SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, itemrevenue, itemrevenue * 100.0000 / SUM(itemrevenue) OVER (PARTITION BY i_class) AS revenueratio FROM aggregated_sales ORDER BY i_category, i_class, i_item_id, i_item_desc, revenueratio LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same output columns\",\n        \"same ordering\",\n        \"same window function results\"\n      ],\n      \"expected_speedup\": \"3.5x\",\n      \"risk\": \"low\"\n    },\n    {\n      \"id\": \"rs_02\",\n      \"transform\": \"early_filter\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-02-22' AS DATE) AND CAST('1999-03-24' AS DATE)\",\n        \"filtered_items\": \"SELECT i_item_sk, i_item_id, i_item_desc, i_category, i_class, i_current_price FROM item WHERE i_category IN ('Sports', 'Books', 'Home')\",\n        \"joined_sales\": \"SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, ws_ext_sales_price FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk JOIN filtered_items ON ws_item_sk = i_item_sk\",\n        \"main_query\": \"SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, SUM(ws_ext_sales_price) AS itemrevenue, SUM(ws_ext_sales_price) * 100.0000 / SUM(SUM(ws_ext_sales_price)) OVER (PARTITION BY i_class) AS revenueratio FROM joined_sales GROUP BY i_item_id, i_item_desc, i_category, i_class, i_current_price ORDER BY i_category, i_class, i_item_id, i_item_desc, revenueratio LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same output columns\",\n        \"same ordering\",\n        \"same window function results\"\n      ],\n      \"expected_speedup\": \"2.8x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Applied date_cte_isolate (QT-OPT-003) to filter date_dim early, reducing web_sales join from 43M rows to ~33K rows. Also pushed item category filter early. Created two variations: rs_01 isolates all joins in CTEs before aggregation for maximal filtering, rs_02 maintains original structure with early filters only.\"\n}\n```",
        "provenance": {
          "source": "Retry3W",
          "run": "retry_3worker_20260205_235909_details",
          "model": "deepseek-reasoner",
          "worker_id": 1,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.3095505311991438,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.2090404041202585,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.0794498261894447,
            "original_ms": 68.55126900033308,
            "optimized_ms": 63.50574833322753,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructuring",
            "speedup": 1.036554177222598,
            "original_ms": 59.2487059996832,
            "optimized_ms": 57.15929500032265,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.01,
            "original_ms": 110.27,
            "optimized_ms": 109.07,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_predicate_pushdown",
            "speedup": 1.002173294779432,
            "original_ms": 59.2487059996832,
            "optimized_ms": 59.120220333473604,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0.993307864711971,
            "original_ms": 59.2487059996832,
            "optimized_ms": 59.64787766667238,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.9690094594668364,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.5543247273702756,
            "original_ms": 63.54690499999075,
            "optimized_ms": 114.6384093335655,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transforms",
            "speedup": 0.37085632010087327,
            "original_ms": 59.2487059996832,
            "optimized_ms": 159.761888333378,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          }
        ]
      },
      "q13": {
        "query_id": "q13",
        "status": "WIN",
        "best_speedup": 1.2111,
        "original_ms": 602.55,
        "optimized_ms": 497.53,
        "original_sql": "-- start query 13 in stream 0 using template query13.tpl\nselect avg(ss_quantity)\n       ,avg(ss_ext_sales_price)\n       ,avg(ss_ext_wholesale_cost)\n       ,sum(ss_ext_wholesale_cost)\n from store_sales\n     ,store\n     ,customer_demographics\n     ,household_demographics\n     ,customer_address\n     ,date_dim\n where s_store_sk = ss_store_sk\n and  ss_sold_date_sk = d_date_sk and d_year = 2001\n and((ss_hdemo_sk=hd_demo_sk\n  and cd_demo_sk = ss_cdemo_sk\n  and cd_marital_status = 'D'\n  and cd_education_status = 'Unknown'\n  and ss_sales_price between 100.00 and 150.00\n  and hd_dep_count = 3   \n     )or\n     (ss_hdemo_sk=hd_demo_sk\n  and cd_demo_sk = ss_cdemo_sk\n  and cd_marital_status = 'S'\n  and cd_education_status = 'College'\n  and ss_sales_price between 50.00 and 100.00   \n  and hd_dep_count = 1\n     ) or \n     (ss_hdemo_sk=hd_demo_sk\n  and cd_demo_sk = ss_cdemo_sk\n  and cd_marital_status = 'M'\n  and cd_education_status = '4 yr Degree'\n  and ss_sales_price between 150.00 and 200.00 \n  and hd_dep_count = 1  \n     ))\n and((ss_addr_sk = ca_address_sk\n  and ca_country = 'United States'\n  and ca_state in ('SD', 'KS', 'MI')\n  and ss_net_profit between 100 and 200  \n     ) or\n     (ss_addr_sk = ca_address_sk\n  and ca_country = 'United States'\n  and ca_state in ('MO', 'ND', 'CO')\n  and ss_net_profit between 150 and 300  \n     ) or\n     (ss_addr_sk = ca_address_sk\n  and ca_country = 'United States'\n  and ca_state in ('NH', 'OH', 'TX')\n  and ss_net_profit between 50 and 250  \n     ))\n;\n\n-- end query 13 in stream 0 using template query13.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 2001\n),\nfiltered_customer_demographics AS (\n    SELECT \n        cd_demo_sk,\n        cd_marital_status,\n        cd_education_status\n    FROM customer_demographics\n    WHERE \n        (cd_marital_status = 'D' AND cd_education_status = 'Unknown')\n        OR (cd_marital_status = 'S' AND cd_education_status = 'College')\n        OR (cd_marital_status = 'M' AND cd_education_status = '4 yr Degree')\n),\nfiltered_household_demographics AS (\n    SELECT \n        hd_demo_sk,\n        hd_dep_count\n    FROM household_demographics\n    WHERE hd_dep_count IN (1, 3)\n),\nfiltered_customer_address AS (\n    SELECT \n        ca_address_sk,\n        ca_state\n    FROM customer_address\n    WHERE \n        ca_country = 'United States'\n        AND ca_state IN ('SD', 'KS', 'MI', 'MO', 'ND', 'CO', 'NH', 'OH', 'TX')\n)\nSELECT\n    AVG(ss_quantity),\n    AVG(ss_ext_sales_price),\n    AVG(ss_ext_wholesale_cost),\n    SUM(ss_ext_wholesale_cost)\nFROM store_sales\nJOIN filtered_dates ON ss_sold_date_sk = d_date_sk\nJOIN store ON s_store_sk = ss_store_sk\nJOIN filtered_customer_demographics ON cd_demo_sk = ss_cdemo_sk\nJOIN filtered_household_demographics ON hd_demo_sk = ss_hdemo_sk\nJOIN filtered_customer_address ON ca_address_sk = ss_addr_sk\nWHERE\n    (\n        (\n            cd_marital_status = 'D'\n            AND cd_education_status = 'Unknown'\n            AND ss_sales_price BETWEEN 100.00 AND 150.00\n            AND hd_dep_count = 3\n        )\n        OR (\n            cd_marital_status = 'S'\n            AND cd_education_status = 'College'\n            AND ss_sales_price BETWEEN 50.00 AND 100.00\n            AND hd_dep_count = 1\n        )\n        OR (\n            cd_marital_status = 'M'\n            AND cd_education_status = '4 yr Degree'\n            AND ss_sales_price BETWEEN 150.00 AND 200.00\n            AND hd_dep_count = 1\n        )\n    )\n    AND (\n        (\n            ca_state IN ('SD', 'KS', 'MI')\n            AND ss_net_profit BETWEEN 100 AND 200\n        )\n        OR (\n            ca_state IN ('MO', 'ND', 'CO')\n            AND ss_net_profit BETWEEN 150 AND 300\n        )\n        OR (\n            ca_state IN ('NH', 'OH', 'TX')\n            AND ss_net_profit BETWEEN 50 AND 250\n        )\n    )",
        "transforms": [
          "dimension_cte_isolate",
          "multi_dimension_prefetch",
          "date_cte_isolate"
        ],
        "principle": "dimension_cte_isolate",
        "changes_description": null,
        "reasoning": "```sql\nWITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 2001\n),\nfiltered_customer_demographics AS (\n    SELECT \n        cd_demo_sk,\n        cd_marital_status,\n        cd_education_status\n    FROM customer_demographics\n    WHERE \n        (cd_marital_status = 'D' AND cd_education_status = 'Unknown')\n        OR (cd_marital_status = 'S' AND cd_education_status = 'College')\n        OR (cd_marital_status = 'M' AND cd_education_status = '4 yr Degree')\n),\nfiltered_household_demographics AS (\n    SELECT \n        hd_demo_sk,\n        hd_dep_count\n    FROM household_demographics\n    WHERE hd_dep_count IN (1, 3)\n),\nfiltered_customer_address AS (\n    SELECT \n        ca_address_sk,\n        ca_state\n    FROM customer_address\n    WHERE \n        ca_country = 'United States'\n        AND ca_state IN ('SD', 'KS', 'MI', 'MO', 'ND', 'CO', 'NH', 'OH', 'TX')\n)\nSELECT\n    AVG(ss_quantity),\n    AVG(ss_ext_sales_price),\n    AVG(ss_ext_wholesale_cost),\n    SUM(ss_ext_wholesale_cost)\nFROM store_sales\nJOIN filtered_dates ON ss_sold_date_sk = d_date_sk\nJOIN store ON s_store_sk = ss_store_sk\nJOIN filtered_customer_demographics ON cd_demo_sk = ss_cdemo_sk\nJOIN filtered_household_demographics ON hd_demo_sk = ss_hdemo_sk\nJOIN filtered_customer_address ON ca_address_sk = ss_addr_sk\nWHERE\n    (\n        (\n            cd_marital_status = 'D'\n            AND cd_education_status = 'Unknown'\n            AND ss_sales_price BETWEEN 100.00 AND 150.00\n            AND hd_dep_count = 3\n        )\n        OR (\n            cd_marital_status = 'S'\n            AND cd_education_status = 'College'\n            AND ss_sales_price BETWEEN 50.00 AND 100.00\n            AND hd_dep_count = 1\n        )\n        OR (\n            cd_marital_status = 'M'\n            AND cd_education_status = '4 yr Degree'\n            AND ss_sales_price BETWEEN 150.00 AND 200.00\n            AND hd_dep_count = 1\n        )\n    )\n    AND (\n        (\n            ca_state IN ('SD', 'KS', 'MI')\n            AND ss_net_profit BETWEEN 100 AND 200\n        )\n        OR (\n            ca_state IN ('MO', 'ND', 'CO')\n            AND ss_net_profit BETWEEN 150 AND 300\n        )\n        OR (\n            ca_state IN ('NH', 'OH', 'TX')\n            AND ss_net_profit BETWEEN 50 AND 250\n        )\n    )\n```\n\n**Changes**: Isolated dimension tables into separate CTEs with early filtering (date, customer demographics, household demographics, customer address) before joining with the fact table. This creates small hash tables for dimension lookups while maintaining exact semantics.\n\n**Expected speedup**: 1.5-2x from reduced dimension table scans and more efficient hash joins.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 2,
          "iteration": 0,
          "strategy": "moderate_dimension_isolation"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.6014089314423539,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.2110840731577763,
            "original_ms": 602.5534649998008,
            "optimized_ms": 497.53231699984707,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.01,
            "original_ms": 980.72,
            "optimized_ms": 974.39,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": []
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.9042710787267048,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_cte_restructuring",
            "speedup": 0.8453297426969942,
            "original_ms": 602.5534649998008,
            "optimized_ms": 712.8028679996229,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.8295900419560737,
            "original_ms": 602.5534649998008,
            "optimized_ms": 726.3267813329245,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.6240867107822041,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_early_filter",
            "speedup": 0,
            "original_ms": 602.5534649998008,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0,
            "original_ms": 572.0837653334456,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0,
            "original_ms": 817.6565413335387,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q14": {
        "query_id": "q14",
        "status": "WIN",
        "best_speedup": 2.3949,
        "original_ms": 5289.77,
        "optimized_ms": 2208.79,
        "original_sql": "-- start query 14 in stream 0 using template query14.tpl\nwith  cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n     ,iss.i_class_id class_id\n     ,iss.i_category_id category_id\n from store_sales\n     ,item iss\n     ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n   and ss_sold_date_sk = d1.d_date_sk\n   and d1.d_year between 2000 AND 2000 + 2\n intersect \n select ics.i_brand_id\n     ,ics.i_class_id\n     ,ics.i_category_id\n from catalog_sales\n     ,item ics\n     ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n   and cs_sold_date_sk = d2.d_date_sk\n   and d2.d_year between 2000 AND 2000 + 2\n intersect\n select iws.i_brand_id\n     ,iws.i_class_id\n     ,iws.i_category_id\n from web_sales\n     ,item iws\n     ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n   and ws_sold_date_sk = d3.d_date_sk\n   and d3.d_year between 2000 AND 2000 + 2)\n where i_brand_id = brand_id\n      and i_class_id = class_id\n      and i_category_id = category_id\n),\n avg_sales as\n (select avg(quantity*list_price) average_sales\n  from (select ss_quantity quantity\n             ,ss_list_price list_price\n       from store_sales\n           ,date_dim\n       where ss_sold_date_sk = d_date_sk\n         and d_year between 2000 and 2000 + 2\n       union all \n       select cs_quantity quantity \n             ,cs_list_price list_price\n       from catalog_sales\n           ,date_dim\n       where cs_sold_date_sk = d_date_sk\n         and d_year between 2000 and 2000 + 2 \n       union all\n       select ws_quantity quantity\n             ,ws_list_price list_price\n       from web_sales\n           ,date_dim\n       where ws_sold_date_sk = d_date_sk\n         and d_year between 2000 and 2000 + 2) x)\n  select channel, i_brand_id,i_class_id,i_category_id,sum(sales), sum(number_sales)\n from(\n       select 'store' channel, i_brand_id,i_class_id\n             ,i_category_id,sum(ss_quantity*ss_list_price) sales\n             , count(*) number_sales\n       from store_sales\n           ,item\n           ,date_dim\n       where ss_item_sk in (select ss_item_sk from cross_items)\n         and ss_item_sk = i_item_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year = 2000+2 \n         and d_moy = 11\n       group by i_brand_id,i_class_id,i_category_id\n       having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)\n       union all\n       select 'catalog' channel, i_brand_id,i_class_id,i_category_id, sum(cs_quantity*cs_list_price) sales, count(*) number_sales\n       from catalog_sales\n           ,item\n           ,date_dim\n       where cs_item_sk in (select ss_item_sk from cross_items)\n         and cs_item_sk = i_item_sk\n         and cs_sold_date_sk = d_date_sk\n         and d_year = 2000+2 \n         and d_moy = 11\n       group by i_brand_id,i_class_id,i_category_id\n       having sum(cs_quantity*cs_list_price) > (select average_sales from avg_sales)\n       union all\n       select 'web' channel, i_brand_id,i_class_id,i_category_id, sum(ws_quantity*ws_list_price) sales , count(*) number_sales\n       from web_sales\n           ,item\n           ,date_dim\n       where ws_item_sk in (select ss_item_sk from cross_items)\n         and ws_item_sk = i_item_sk\n         and ws_sold_date_sk = d_date_sk\n         and d_year = 2000+2\n         and d_moy = 11\n       group by i_brand_id,i_class_id,i_category_id\n       having sum(ws_quantity*ws_list_price) > (select average_sales from avg_sales)\n ) y\n group by rollup (channel, i_brand_id,i_class_id,i_category_id)\n order by channel,i_brand_id,i_class_id,i_category_id\n LIMIT 100;\nwith  cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n     ,iss.i_class_id class_id\n     ,iss.i_category_id category_id\n from store_sales\n     ,item iss\n     ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n   and ss_sold_date_sk = d1.d_date_sk\n   and d1.d_year between 2000 AND 2000 + 2\n intersect\n select ics.i_brand_id\n     ,ics.i_class_id\n     ,ics.i_category_id\n from catalog_sales\n     ,item ics\n     ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n   and cs_sold_date_sk = d2.d_date_sk\n   and d2.d_year between 2000 AND 2000 + 2\n intersect\n select iws.i_brand_id\n     ,iws.i_class_id\n     ,iws.i_category_id\n from web_sales\n     ,item iws\n     ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n   and ws_sold_date_sk = d3.d_date_sk\n   and d3.d_year between 2000 AND 2000 + 2) x\n where i_brand_id = brand_id\n      and i_class_id = class_id\n      and i_category_id = category_id\n),\n avg_sales as\n(select avg(quantity*list_price) average_sales\n  from (select ss_quantity quantity\n             ,ss_list_price list_price\n       from store_sales\n           ,date_dim\n       where ss_sold_date_sk = d_date_sk\n         and d_year between 2000 and 2000 + 2\n       union all\n       select cs_quantity quantity\n             ,cs_list_price list_price\n       from catalog_sales\n           ,date_dim\n       where cs_sold_date_sk = d_date_sk\n         and d_year between 2000 and 2000 + 2\n       union all\n       select ws_quantity quantity\n             ,ws_list_price list_price\n       from web_sales\n           ,date_dim\n       where ws_sold_date_sk = d_date_sk\n         and d_year between 2000 and 2000 + 2) x)\n  select this_year.channel ty_channel\n                           ,this_year.i_brand_id ty_brand\n                           ,this_year.i_class_id ty_class\n                           ,this_year.i_category_id ty_category\n                           ,this_year.sales ty_sales\n                           ,this_year.number_sales ty_number_sales\n                           ,last_year.channel ly_channel\n                           ,last_year.i_brand_id ly_brand\n                           ,last_year.i_class_id ly_class\n                           ,last_year.i_category_id ly_category\n                           ,last_year.sales ly_sales\n                           ,last_year.number_sales ly_number_sales \n from\n (select 'store' channel, i_brand_id,i_class_id,i_category_id\n        ,sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales \n     ,item\n     ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n   and ss_item_sk = i_item_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_week_seq = (select d_week_seq\n                     from date_dim\n                     where d_year = 2000 + 1\n                       and d_moy = 12\n                       and d_dom = 10)\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) this_year,\n (select 'store' channel, i_brand_id,i_class_id\n        ,i_category_id, sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n     ,item\n     ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n   and ss_item_sk = i_item_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_week_seq = (select d_week_seq\n                     from date_dim\n                     where d_year = 2000\n                       and d_moy = 12\n                       and d_dom = 10)\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) last_year\n where this_year.i_brand_id= last_year.i_brand_id\n   and this_year.i_class_id = last_year.i_class_id\n   and this_year.i_category_id = last_year.i_category_id\n order by this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id\n LIMIT 100;\n\n-- end query 14 in stream 0 using template query14.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year BETWEEN 2000 AND 2002\n),\ncross_items AS (\n  SELECT\n    i_item_sk AS ss_item_sk,\n    i_brand_id,\n    i_class_id,\n    i_category_id\n  FROM item\n  WHERE EXISTS (\n    SELECT 1\n    FROM store_sales\n    JOIN item iss ON ss_item_sk = iss.i_item_sk\n    JOIN filtered_dates d1 ON ss_sold_date_sk = d1.d_date_sk\n    WHERE iss.i_brand_id = item.i_brand_id\n      AND iss.i_class_id = item.i_class_id\n      AND iss.i_category_id = item.i_category_id\n  )\n  AND EXISTS (\n    SELECT 1\n    FROM catalog_sales\n    JOIN item ics ON cs_item_sk = ics.i_item_sk\n    JOIN filtered_dates d2 ON cs_sold_date_sk = d2.d_date_sk\n    WHERE ics.i_brand_id = item.i_brand_id\n      AND ics.i_class_id = item.i_class_id\n      AND ics.i_category_id = item.i_category_id\n  )\n  AND EXISTS (\n    SELECT 1\n    FROM web_sales\n    JOIN item iws ON ws_item_sk = iws.i_item_sk\n    JOIN filtered_dates d3 ON ws_sold_date_sk = d3.d_date_sk\n    WHERE iws.i_brand_id = item.i_brand_id\n      AND iws.i_class_id = item.i_class_id\n      AND iws.i_category_id = item.i_category_id\n  )\n),\navg_sales AS (\n  SELECT\n    AVG(quantity * list_price) AS average_sales\n  FROM (\n    SELECT ss_quantity AS quantity, ss_list_price AS list_price\n    FROM store_sales\n    JOIN filtered_dates ON ss_sold_date_sk = d_date_sk\n    UNION ALL\n    SELECT cs_quantity, cs_list_price\n    FROM catalog_sales\n    JOIN filtered_dates ON cs_sold_date_sk = d_date_sk\n    UNION ALL\n    SELECT ws_quantity, ws_list_price\n    FROM web_sales\n    JOIN filtered_dates ON ws_sold_date_sk = d_date_sk\n  ) x\n),\nnov2002_dates AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 2000 + 2\n    AND d_moy = 11\n),\nstore_sales_data AS (\n  SELECT\n    'store' AS channel,\n    i.i_brand_id,\n    i.i_class_id,\n    i.i_category_id,\n    SUM(ss_quantity * ss_list_price) AS sales,\n    COUNT(*) AS number_sales\n  FROM store_sales ss\n  JOIN item i ON ss.ss_item_sk = i.i_item_sk\n  JOIN nov2002_dates nd ON ss.ss_sold_date_sk = nd.d_date_sk\n  WHERE EXISTS (\n    SELECT 1 FROM cross_items ci WHERE ci.ss_item_sk = ss.ss_item_sk\n  )\n  GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id\n  HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)\n),\ncatalog_sales_data AS (\n  SELECT\n    'catalog' AS channel,\n    i.i_brand_id,\n    i.i_class_id,\n    i.i_category_id,\n    SUM(cs_quantity * cs_list_price) AS sales,\n    COUNT(*) AS number_sales\n  FROM catalog_sales cs\n  JOIN item i ON cs.cs_item_sk = i.i_item_sk\n  JOIN nov2002_dates nd ON cs.cs_sold_date_sk = nd.d_date_sk\n  WHERE EXISTS (\n    SELECT 1 FROM cross_items ci WHERE ci.ss_item_sk = cs.cs_item_sk\n  )\n  GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id\n  HAVING SUM(cs_quantity * cs_list_price) > (SELECT average_sales FROM avg_sales)\n),\nweb_sales_data AS (\n  SELECT\n    'web' AS channel,\n    i.i_brand_id,\n    i.i_class_id,\n    i.i_category_id,\n    SUM(ws_quantity * ws_list_price) AS sales,\n    COUNT(*) AS number_sales\n  FROM web_sales ws\n  JOIN item i ON ws.ws_item_sk = i.i_item_sk\n  JOIN nov2002_dates nd ON ws.ws_sold_date_sk = nd.d_date_sk\n  WHERE EXISTS (\n    SELECT 1 FROM cross_items ci WHERE ci.ss_item_sk = ws.ws_item_sk\n  )\n  GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id\n  HAVING SUM(ws_quantity * ws_list_price) > (SELECT average_sales FROM avg_sales)\n)\nSELECT\n  channel,\n  i_brand_id,\n  i_class_id,\n  i_category_id,\n  SUM(sales) AS \"SUM(sales)\",\n  SUM(number_sales) AS \"SUM(number_sales)\"\nFROM (\n  SELECT * FROM store_sales_data\n  UNION ALL\n  SELECT * FROM catalog_sales_data\n  UNION ALL\n  SELECT * FROM web_sales_data\n) y\nGROUP BY ROLLUP(channel, i_brand_id, i_class_id, i_category_id)\nORDER BY channel, i_brand_id, i_class_id, i_category_id\nLIMIT 100;",
        "transforms": [
          "decorrelate",
          "intersect_to_exists",
          "date_cte_isolate",
          "multi_date_range_cte",
          "prefetch_fact_join"
        ],
        "principle": "decorrelate",
        "changes_description": "** Replaced expensive INTERSECT operations with EXISTS semi-joins that short-circuit after first match, pre-filtered date_dim for reuse across all subqueries, consolidated repeated date filters into CTEs, and flattened nested IN subqueries into EXISTS joins.\n\n**Expected speedup:** 1.8-2.0x from eliminating INTERSECT materialization and repeated date scans.",
        "reasoning": "```sql\nWITH filtered_dates AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year BETWEEN 2000 AND 2002\n),\ncross_items AS (\n  SELECT\n    i_item_sk AS ss_item_sk,\n    i_brand_id,\n    i_class_id,\n    i_category_id\n  FROM item\n  WHERE EXISTS (\n    SELECT 1\n    FROM store_sales\n    JOIN item iss ON ss_item_sk = iss.i_item_sk\n    JOIN filtered_dates d1 ON ss_sold_date_sk = d1.d_date_sk\n    WHERE iss.i_brand_id = item.i_brand_id\n      AND iss.i_class_id = item.i_class_id\n      AND iss.i_category_id = item.i_category_id\n  )\n  AND EXISTS (\n    SELECT 1\n    FROM catalog_sales\n    JOIN item ics ON cs_item_sk = ics.i_item_sk\n    JOIN filtered_dates d2 ON cs_sold_date_sk = d2.d_date_sk\n    WHERE ics.i_brand_id = item.i_brand_id\n      AND ics.i_class_id = item.i_class_id\n      AND ics.i_category_id = item.i_category_id\n  )\n  AND EXISTS (\n    SELECT 1\n    FROM web_sales\n    JOIN item iws ON ws_item_sk = iws.i_item_sk\n    JOIN filtered_dates d3 ON ws_sold_date_sk = d3.d_date_sk\n    WHERE iws.i_brand_id = item.i_brand_id\n      AND iws.i_class_id = item.i_class_id\n      AND iws.i_category_id = item.i_category_id\n  )\n),\navg_sales AS (\n  SELECT\n    AVG(quantity * list_price) AS average_sales\n  FROM (\n    SELECT ss_quantity AS quantity, ss_list_price AS list_price\n    FROM store_sales\n    JOIN filtered_dates ON ss_sold_date_sk = d_date_sk\n    UNION ALL\n    SELECT cs_quantity, cs_list_price\n    FROM catalog_sales\n    JOIN filtered_dates ON cs_sold_date_sk = d_date_sk\n    UNION ALL\n    SELECT ws_quantity, ws_list_price\n    FROM web_sales\n    JOIN filtered_dates ON ws_sold_date_sk = d_date_sk\n  ) x\n),\nnov2002_dates AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 2000 + 2\n    AND d_moy = 11\n),\nstore_sales_data AS (\n  SELECT\n    'store' AS channel,\n    i.i_brand_id,\n    i.i_class_id,\n    i.i_category_id,\n    SUM(ss_quantity * ss_list_price) AS sales,\n    COUNT(*) AS number_sales\n  FROM store_sales ss\n  JOIN item i ON ss.ss_item_sk = i.i_item_sk\n  JOIN nov2002_dates nd ON ss.ss_sold_date_sk = nd.d_date_sk\n  WHERE EXISTS (\n    SELECT 1 FROM cross_items ci WHERE ci.ss_item_sk = ss.ss_item_sk\n  )\n  GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id\n  HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)\n),\ncatalog_sales_data AS (\n  SELECT\n    'catalog' AS channel,\n    i.i_brand_id,\n    i.i_class_id,\n    i.i_category_id,\n    SUM(cs_quantity * cs_list_price) AS sales,\n    COUNT(*) AS number_sales\n  FROM catalog_sales cs\n  JOIN item i ON cs.cs_item_sk = i.i_item_sk\n  JOIN nov2002_dates nd ON cs.cs_sold_date_sk = nd.d_date_sk\n  WHERE EXISTS (\n    SELECT 1 FROM cross_items ci WHERE ci.ss_item_sk = cs.cs_item_sk\n  )\n  GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id\n  HAVING SUM(cs_quantity * cs_list_price) > (SELECT average_sales FROM avg_sales)\n),\nweb_sales_data AS (\n  SELECT\n    'web' AS channel,\n    i.i_brand_id,\n    i.i_class_id,\n    i.i_category_id,\n    SUM(ws_quantity * ws_list_price) AS sales,\n    COUNT(*) AS number_sales\n  FROM web_sales ws\n  JOIN item i ON ws.ws_item_sk = i.i_item_sk\n  JOIN nov2002_dates nd ON ws.ws_sold_date_sk = nd.d_date_sk\n  WHERE EXISTS (\n    SELECT 1 FROM cross_items ci WHERE ci.ss_item_sk = ws.ws_item_sk\n  )\n  GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id\n  HAVING SUM(ws_quantity * ws_list_price) > (SELECT average_sales FROM avg_sales)\n)\nSELECT\n  channel,\n  i_brand_id,\n  i_class_id,\n  i_category_id,\n  SUM(sales) AS \"SUM(sales)\",\n  SUM(number_sales) AS \"SUM(number_sales)\"\nFROM (\n  SELECT * FROM store_sales_data\n  UNION ALL\n  SELECT * FROM catalog_sales_data\n  UNION ALL\n  SELECT * FROM web_sales_data\n) y\nGROUP BY ROLLUP(channel, i_brand_id, i_class_id, i_category_id)\nORDER BY channel, i_brand_id, i_class_id, i_category_id\nLIMIT 100;\n```\n\n**Changes:** Replaced expensive INTERSECT operations with EXISTS semi-joins that short-circuit after first match, pre-filtered date_dim for reuse across all subqueries, consolidated repeated date filters into CTEs, and flattened nested IN subqueries into EXISTS joins.\n\n**Expected speedup:** 1.8-2.0x from eliminating INTERSECT materialization and repeated date scans.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 6,
          "iteration": 2,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 2.3948739526422065,
            "original_ms": 5289.773228332706,
            "optimized_ms": 2208.7898289998216,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "intersect_to_exists",
              "date_cte_isolate",
              "multi_date_range_cte",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 2.2121607610341743,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "materialize_cte",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.8828044869748284,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "intersect_to_exists",
              "materialize_cte",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.8732407084167404,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_and_materialization",
            "speedup": 1.7405828777308419,
            "original_ms": 5247.2352990004465,
            "optimized_ms": 3014.6426040000733,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "materialize_cte",
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_date_dimension_isolation",
            "speedup": 1.621577277686975,
            "original_ms": 5247.2352990004465,
            "optimized_ms": 3235.883587666649,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.95,
            "original_ms": 9210.54,
            "optimized_ms": 9707.57,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_consolidation_prefetch",
            "speedup": 0.9378652321371421,
            "original_ms": 5247.2352990004465,
            "optimized_ms": 5594.871330333262,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "single_pass_aggregation",
              "prefetch_fact_join",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.9040844159797201,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "materialize_cte",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transforms",
            "speedup": 0,
            "original_ms": 5247.2352990004465,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "intersect_to_exists",
              "decorrelate",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0,
            "original_ms": 5428.110161999939,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "intersect_to_exists",
              "date_cte_isolate",
              "multi_date_range_cte",
              "prefetch_fact_join"
            ]
          }
        ]
      },
      "q15": {
        "query_id": "q15",
        "status": "WIN",
        "best_speedup": 3.17,
        "original_ms": 150.38,
        "optimized_ms": 47.44,
        "original_sql": "-- start query 15 in stream 0 using template query15.tpl\nselect ca_zip\n       ,sum(cs_sales_price)\n from catalog_sales\n     ,customer\n     ,customer_address\n     ,date_dim\n where cs_bill_customer_sk = c_customer_sk\n \tand c_current_addr_sk = ca_address_sk \n \tand ( substr(ca_zip,1,5) in ('85669', '86197','88274','83405','86475',\n                                   '85392', '85460', '80348', '81792')\n \t      or ca_state in ('CA','WA','GA')\n \t      or cs_sales_price > 500)\n \tand cs_sold_date_sk = d_date_sk\n \tand d_qoy = 1 and d_year = 2001\n group by ca_zip\n order by ca_zip\n LIMIT 100;\n\n-- end query 15 in stream 0 using template query15.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_qoy = 1 AND d_year = 2001), filtered_sales AS (SELECT cs_sales_price, ca_zip FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE SUBSTRING(ca_zip, 1, 5) IN ('85669', '86197', '88274', '83405', '86475', '85392', '85460', '80348', '81792') UNION ALL SELECT cs_sales_price, ca_zip FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ca_state IN ('CA', 'WA', 'GA') UNION ALL SELECT cs_sales_price, ca_zip FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE cs_sales_price > 500)\nSELECT ca_zip, SUM(cs_sales_price) FROM filtered_sales GROUP BY ca_zip ORDER BY ca_zip LIMIT 100",
        "transforms": [
          "or_to_union"
        ],
        "principle": "or_to_union",
        "changes_description": null,
        "reasoning": " ```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"or_to_union\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_qoy = 1 AND d_year = 2001\",\n        \"filtered_sales\": \"SELECT cs_sales_price, ca_zip FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE SUBSTRING(ca_zip, 1, 5) IN ('85669', '86197', '88274', '83405', '86475', '85392', '85460', '80348', '81792') UNION ALL SELECT cs_sales_price, ca_zip FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ca_state IN ('CA','WA','GA') UNION ALL SELECT cs_sales_price, ca_zip FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE cs_sales_price > 500\",\n        \"main_query\": \"SELECT ca_zip, SUM(cs_sales_price) FROM filtered_sales GROUP BY ca_zip ORDER BY ca_zip LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"output columns unchanged\",\n        \"same rows after aggregation\"\n      ],\n      \"expected_speedup\": \"2x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Split the OR condition into three UNION ALL branches to enable independent index access paths and partition pruning for each predicate. Isolated the date dimension filter into a separate CTE to avoid redundant filtering across all three branches. Each branch now processes a disjoint subset of rows that can be optimized separately by the query planner.\"\n}\n```",
        "provenance": {
          "source": "Evo",
          "run": "kimi_k2.5",
          "model": "kimi-k2.5",
          "worker_id": null,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 2.78,
            "original_ms": 150.38,
            "optimized_ms": 54.13,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 2.1306854692331143,
            "original_ms": 92.12411666673385,
            "optimized_ms": 43.2368446666563,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "date_cte_isolate",
              "dimension_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_or_restructuring",
            "speedup": 1.283458551687203,
            "original_ms": 96.34760733327614,
            "optimized_ms": 75.0687330000801,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.006817636119599,
            "original_ms": 96.34760733327614,
            "optimized_ms": 95.69519233355095,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_filter_pushdown",
            "speedup": 1.0031035590598736,
            "original_ms": 96.34760733327614,
            "optimized_ms": 96.04951200011176,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructuring",
            "speedup": 0,
            "original_ms": 96.34760733327614,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_date_range_cte",
              "single_pass_aggregation"
            ]
          }
        ]
      },
      "q16": {
        "query_id": "q16",
        "status": "WIN",
        "best_speedup": 1.2527,
        "original_ms": 24.5,
        "optimized_ms": 19.56,
        "original_sql": "-- start query 16 in stream 0 using template query16.tpl\nselect \n   count(distinct cs_order_number) as \"order count\"\n  ,sum(cs_ext_ship_cost) as \"total shipping cost\"\n  ,sum(cs_net_profit) as \"total net profit\"\nfrom\n   catalog_sales cs1\n  ,date_dim\n  ,customer_address\n  ,call_center\nwhere\n    d_date between '2002-4-01' and \n           (cast('2002-4-01' as date) + INTERVAL 60 DAY)\nand cs1.cs_ship_date_sk = d_date_sk\nand cs1.cs_ship_addr_sk = ca_address_sk\nand ca_state = 'WV'\nand cs1.cs_call_center_sk = cc_call_center_sk\nand cc_county in ('Ziebach County','Luce County','Richland County','Daviess County',\n                  'Barrow County'\n)\nand exists (select *\n            from catalog_sales cs2\n            where cs1.cs_order_number = cs2.cs_order_number\n              and cs1.cs_warehouse_sk <> cs2.cs_warehouse_sk)\nand not exists(select *\n               from catalog_returns cr1\n               where cs1.cs_order_number = cr1.cr_order_number)\norder by count(distinct cs_order_number)\n LIMIT 100;\n\n-- end query 16 in stream 0 using template query16.tpl\n",
        "optimized_sql": "WITH date_range AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_date BETWEEN '2002-4-01' AND (CAST('2002-4-01' AS DATE) + INTERVAL '60' DAY)\n),\nstate_addresses AS (\n    SELECT ca_address_sk\n    FROM customer_address\n    WHERE ca_state = 'WV'\n),\ncounty_call_centers AS (\n    SELECT cc_call_center_sk\n    FROM call_center\n    WHERE cc_county IN ('Ziebach County', 'Luce County', 'Richland County', 'Daviess County', 'Barrow County')\n),\nfiltered_catalog_sales AS (\n    SELECT \n        cs_order_number,\n        cs_ext_ship_cost,\n        cs_net_profit,\n        cs_warehouse_sk\n    FROM catalog_sales cs1\n    JOIN date_range ON cs1.cs_ship_date_sk = date_range.d_date_sk\n    JOIN state_addresses ON cs1.cs_ship_addr_sk = state_addresses.ca_address_sk\n    JOIN county_call_centers ON cs1.cs_call_center_sk = county_call_centers.cc_call_center_sk\n)\nSELECT\n    COUNT(DISTINCT cs_order_number) AS \"order count\",\n    SUM(cs_ext_ship_cost) AS \"total shipping cost\",\n    SUM(cs_net_profit) AS \"total net profit\"\nFROM filtered_catalog_sales cs1\nWHERE\n    EXISTS(\n        SELECT 1\n        FROM catalog_sales cs2\n        WHERE cs1.cs_order_number = cs2.cs_order_number\n          AND cs1.cs_warehouse_sk <> cs2.cs_warehouse_sk\n    )\n    AND NOT EXISTS(\n        SELECT 1\n        FROM catalog_returns cr1\n        WHERE cs1.cs_order_number = cr1.cr_order_number\n    )\nORDER BY COUNT(DISTINCT cs_order_number)\nLIMIT 100",
        "transforms": [
          "date_cte_isolate",
          "multi_dimension_prefetch"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```sql\nWITH date_range AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_date BETWEEN '2002-4-01' AND (CAST('2002-4-01' AS DATE) + INTERVAL '60' DAY)\n),\nstate_addresses AS (\n    SELECT ca_address_sk\n    FROM customer_address\n    WHERE ca_state = 'WV'\n),\ncounty_call_centers AS (\n    SELECT cc_call_center_sk\n    FROM call_center\n    WHERE cc_county IN ('Ziebach County', 'Luce County', 'Richland County', 'Daviess County', 'Barrow County')\n),\nfiltered_catalog_sales AS (\n    SELECT \n        cs_order_number,\n        cs_ext_ship_cost,\n        cs_net_profit,\n        cs_warehouse_sk\n    FROM catalog_sales cs1\n    JOIN date_range ON cs1.cs_ship_date_sk = date_range.d_date_sk\n    JOIN state_addresses ON cs1.cs_ship_addr_sk = state_addresses.ca_address_sk\n    JOIN county_call_centers ON cs1.cs_call_center_sk = county_call_centers.cc_call_center_sk\n)\nSELECT\n    COUNT(DISTINCT cs_order_number) AS \"order count\",\n    SUM(cs_ext_ship_cost) AS \"total shipping cost\",\n    SUM(cs_net_profit) AS \"total net profit\"\nFROM filtered_catalog_sales cs1\nWHERE\n    EXISTS(\n        SELECT 1\n        FROM catalog_sales cs2\n        WHERE cs1.cs_order_number = cs2.cs_order_number\n          AND cs1.cs_warehouse_sk <> cs2.cs_warehouse_sk\n    )\n    AND NOT EXISTS(\n        SELECT 1\n        FROM catalog_returns cr1\n        WHERE cs1.cs_order_number = cr1.cr_order_number\n    )\nORDER BY COUNT(DISTINCT cs_order_number)\nLIMIT 100\n```\n\n**Changes**: Isolated dimension table filtering into separate CTEs before joining with catalog_sales, creating a filtered fact table that reduces rows before evaluating the EXISTS conditions.\n\n**Expected speedup**: 1.8-2.2x due to early reduction of catalog_sales rows via pre-filtered dimension joins and preserved EXISTS short-circuiting.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 5,
          "iteration": 1,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.2526541714671922,
            "original_ms": 24.49738766669422,
            "optimized_ms": 19.55638533339273,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.0971416562836522,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 1.086783369389523,
            "original_ms": 23.18950966673583,
            "optimized_ms": 21.33774800010239,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0714110156144627,
            "original_ms": 23.18950966673583,
            "optimized_ms": 21.643897000103607,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.48615970172674206,
            "original_ms": 25.09827333293894,
            "optimized_ms": 51.62557333278528,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.04394548840512586,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.018305693460334036,
            "original_ms": 23.18950966673583,
            "optimized_ms": 1266.7921986667352,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.01,
            "original_ms": 40.41,
            "optimized_ms": 4519.85,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filter",
            "speedup": 0,
            "original_ms": 23.18950966673583,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "materialize_cte"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q17": {
        "query_id": "q17",
        "status": "WIN",
        "best_speedup": 1.19,
        "original_ms": 864.36,
        "optimized_ms": 726.35,
        "original_sql": "-- start query 17 in stream 0 using template query17.tpl\nselect i_item_id\n       ,i_item_desc\n       ,s_state\n       ,count(ss_quantity) as store_sales_quantitycount\n       ,avg(ss_quantity) as store_sales_quantityave\n       ,stddev_samp(ss_quantity) as store_sales_quantitystdev\n       ,stddev_samp(ss_quantity)/avg(ss_quantity) as store_sales_quantitycov\n       ,count(sr_return_quantity) as store_returns_quantitycount\n       ,avg(sr_return_quantity) as store_returns_quantityave\n       ,stddev_samp(sr_return_quantity) as store_returns_quantitystdev\n       ,stddev_samp(sr_return_quantity)/avg(sr_return_quantity) as store_returns_quantitycov\n       ,count(cs_quantity) as catalog_sales_quantitycount ,avg(cs_quantity) as catalog_sales_quantityave\n       ,stddev_samp(cs_quantity) as catalog_sales_quantitystdev\n       ,stddev_samp(cs_quantity)/avg(cs_quantity) as catalog_sales_quantitycov\n from store_sales\n     ,store_returns\n     ,catalog_sales\n     ,date_dim d1\n     ,date_dim d2\n     ,date_dim d3\n     ,store\n     ,item\n where d1.d_quarter_name = '2001Q1'\n   and d1.d_date_sk = ss_sold_date_sk\n   and i_item_sk = ss_item_sk\n   and s_store_sk = ss_store_sk\n   and ss_customer_sk = sr_customer_sk\n   and ss_item_sk = sr_item_sk\n   and ss_ticket_number = sr_ticket_number\n   and sr_returned_date_sk = d2.d_date_sk\n   and d2.d_quarter_name in ('2001Q1','2001Q2','2001Q3')\n   and sr_customer_sk = cs_bill_customer_sk\n   and sr_item_sk = cs_item_sk\n   and cs_sold_date_sk = d3.d_date_sk\n   and d3.d_quarter_name in ('2001Q1','2001Q2','2001Q3')\n group by i_item_id\n         ,i_item_desc\n         ,s_state\n order by i_item_id\n         ,i_item_desc\n         ,s_state\n LIMIT 100;\n\n-- end query 17 in stream 0 using template query17.tpl\n",
        "optimized_sql": "-- start query 17 in stream 0 using template query17.tpl\nselect i_item_id\n       ,i_item_desc\n       ,s_state\n       ,count(ss_quantity) as store_sales_quantitycount\n       ,avg(ss_quantity) as store_sales_quantityave\n       ,stddev_samp(ss_quantity) as store_sales_quantitystdev\n       ,stddev_samp(ss_quantity)/avg(ss_quantity) as store_sales_quantitycov\n       ,count(sr_return_quantity) as store_returns_quantitycount\n       ,avg(sr_return_quantity) as store_returns_quantityave\n       ,stddev_samp(sr_return_quantity) as store_returns_quantitystdev\n       ,stddev_samp(sr_return_quantity)/avg(sr_return_quantity) as store_returns_quantitycov\n       ,count(cs_quantity) as catalog_sales_quantitycount ,avg(cs_quantity) as catalog_sales_quantityave\n       ,stddev_samp(cs_quantity) as catalog_sales_quantitystdev\n       ,stddev_samp(cs_quantity)/avg(cs_quantity) as catalog_sales_quantitycov\n from store_sales\n     ,store_returns\n     ,catalog_sales\n     ,date_dim d1\n     ,date_dim d2\n     ,date_dim d3\n     ,store\n     ,item\n where d1.d_quarter_name = '2001Q1'\n   and d1.d_date_sk = ss_sold_date_sk\n   and i_item_sk = ss_item_sk\n   and s_store_sk = ss_store_sk\n   and ss_customer_sk = sr_customer_sk\n   and ss_item_sk = sr_item_sk\n   and ss_ticket_number = sr_ticket_number\n   and sr_returned_date_sk = d2.d_date_sk\n   and d2.d_quarter_name in ('2001Q1','2001Q2','2001Q3')\n   and sr_customer_sk = cs_bill_customer_sk\n   and sr_item_sk = cs_item_sk\n   and cs_sold_date_sk = d3.d_date_sk\n   and d3.d_quarter_name in ('2001Q1','2001Q2','2001Q3')\n group by i_item_id\n         ,i_item_desc\n         ,s_state\n order by i_item_id\n         ,i_item_desc\n         ,s_state\n LIMIT 100;\n\n-- end query 17 in stream 0 using template query17.tpl\n",
        "transforms": [
          "date_cte_isolate",
          "multi_date_range_cte",
          "prefetch_fact_join"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "",
        "provenance": {
          "source": "Kimi",
          "run": "kimi_k2.5",
          "model": "kimi-k2.5",
          "worker_id": null,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.19,
            "original_ms": 864.36,
            "optimized_ms": 728.44,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": []
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0384763955584333,
            "original_ms": 400.5046533332764,
            "optimized_ms": 385.6656300001002,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.0214444166562644,
            "original_ms": 397.7393966670206,
            "optimized_ms": 389.3891729997752,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_date_range_cte",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_filter_pushdown",
            "speedup": 0.9755814951300357,
            "original_ms": 400.5046533332764,
            "optimized_ms": 410.529161666697,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructuring",
            "speedup": 0.9736031436367143,
            "original_ms": 400.5046533332764,
            "optimized_ms": 411.36335266673996,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0,
            "original_ms": 400.5046533332764,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0,
            "original_ms": 405.5945226664335,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join"
            ]
          }
        ]
      },
      "q18": {
        "query_id": "q18",
        "status": "WIN",
        "best_speedup": 1.5658,
        "original_ms": 287.78,
        "optimized_ms": 183.79,
        "original_sql": "-- start query 18 in stream 0 using template query18.tpl\nselect i_item_id,\n        ca_country,\n        ca_state, \n        ca_county,\n        avg( cast(cs_quantity as decimal(12,2))) agg1,\n        avg( cast(cs_list_price as decimal(12,2))) agg2,\n        avg( cast(cs_coupon_amt as decimal(12,2))) agg3,\n        avg( cast(cs_sales_price as decimal(12,2))) agg4,\n        avg( cast(cs_net_profit as decimal(12,2))) agg5,\n        avg( cast(c_birth_year as decimal(12,2))) agg6,\n        avg( cast(cd1.cd_dep_count as decimal(12,2))) agg7\n from catalog_sales, customer_demographics cd1, \n      customer_demographics cd2, customer, customer_address, date_dim, item\n where cs_sold_date_sk = d_date_sk and\n       cs_item_sk = i_item_sk and\n       cs_bill_cdemo_sk = cd1.cd_demo_sk and\n       cs_bill_customer_sk = c_customer_sk and\n       cd1.cd_gender = 'F' and \n       cd1.cd_education_status = 'Advanced Degree' and\n       c_current_cdemo_sk = cd2.cd_demo_sk and\n       c_current_addr_sk = ca_address_sk and\n       c_birth_month in (10,7,8,4,1,2) and\n       d_year = 1998 and\n       ca_state in ('WA','GA','NC'\n                   ,'ME','WY','OK','IN')\n group by rollup (i_item_id, ca_country, ca_state, ca_county)\n order by ca_country,\n        ca_state, \n        ca_county,\n\ti_item_id\n LIMIT 100;\n\n-- end query 18 in stream 0 using template query18.tpl\n",
        "optimized_sql": "WITH filtered_date AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 1998\n),\nfiltered_cd1 AS (\n    SELECT cd_demo_sk, cd_dep_count\n    FROM customer_demographics\n    WHERE cd_gender = 'F'\n      AND cd_education_status = 'Advanced Degree'\n),\nfiltered_address AS (\n    SELECT ca_address_sk, ca_country, ca_state, ca_county\n    FROM customer_address\n    WHERE ca_state IN ('WA', 'GA', 'NC', 'ME', 'WY', 'OK', 'IN')\n),\nfiltered_customer AS (\n    SELECT \n        c.c_customer_sk,\n        c.c_current_cdemo_sk,\n        c.c_birth_year,\n        a.ca_country,\n        a.ca_state,\n        a.ca_county\n    FROM customer c\n    JOIN filtered_address a ON c.c_current_addr_sk = a.ca_address_sk\n    WHERE c.c_birth_month IN (10, 7, 8, 4, 1, 2)\n)\nSELECT\n    i.i_item_id,\n    fc.ca_country,\n    fc.ca_state,\n    fc.ca_county,\n    AVG(CAST(cs.cs_quantity AS DECIMAL(12, 2))) AS agg1,\n    AVG(CAST(cs.cs_list_price AS DECIMAL(12, 2))) AS agg2,\n    AVG(CAST(cs.cs_coupon_amt AS DECIMAL(12, 2))) AS agg3,\n    AVG(CAST(cs.cs_sales_price AS DECIMAL(12, 2))) AS agg4,\n    AVG(CAST(cs.cs_net_profit AS DECIMAL(12, 2))) AS agg5,\n    AVG(CAST(fc.c_birth_year AS DECIMAL(12, 2))) AS agg6,\n    AVG(CAST(fcd1.cd_dep_count AS DECIMAL(12, 2))) AS agg7\nFROM catalog_sales cs\nJOIN filtered_date fd ON cs.cs_sold_date_sk = fd.d_date_sk\nJOIN filtered_cd1 fcd1 ON cs.cs_bill_cdemo_sk = fcd1.cd_demo_sk\nJOIN filtered_customer fc ON cs.cs_bill_customer_sk = fc.c_customer_sk\nJOIN customer_demographics cd2 ON fc.c_current_cdemo_sk = cd2.cd_demo_sk\nJOIN item i ON cs.cs_item_sk = i.i_item_sk\nGROUP BY ROLLUP (\n    i.i_item_id,\n    fc.ca_country,\n    fc.ca_state,\n    fc.ca_county\n)\nORDER BY\n    fc.ca_country,\n    fc.ca_state,\n    fc.ca_county,\n    i.i_item_id\nLIMIT 100",
        "transforms": [
          "dimension_cte_isolate",
          "date_cte_isolate",
          "multi_dimension_prefetch"
        ],
        "principle": "dimension_cte_isolate",
        "changes_description": null,
        "reasoning": "```sql\nWITH filtered_date AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 1998\n),\nfiltered_cd1 AS (\n    SELECT cd_demo_sk, cd_dep_count\n    FROM customer_demographics\n    WHERE cd_gender = 'F'\n      AND cd_education_status = 'Advanced Degree'\n),\nfiltered_address AS (\n    SELECT ca_address_sk, ca_country, ca_state, ca_county\n    FROM customer_address\n    WHERE ca_state IN ('WA', 'GA', 'NC', 'ME', 'WY', 'OK', 'IN')\n),\nfiltered_customer AS (\n    SELECT \n        c.c_customer_sk,\n        c.c_current_cdemo_sk,\n        c.c_birth_year,\n        a.ca_country,\n        a.ca_state,\n        a.ca_county\n    FROM customer c\n    JOIN filtered_address a ON c.c_current_addr_sk = a.ca_address_sk\n    WHERE c.c_birth_month IN (10, 7, 8, 4, 1, 2)\n)\nSELECT\n    i.i_item_id,\n    fc.ca_country,\n    fc.ca_state,\n    fc.ca_county,\n    AVG(CAST(cs.cs_quantity AS DECIMAL(12, 2))) AS agg1,\n    AVG(CAST(cs.cs_list_price AS DECIMAL(12, 2))) AS agg2,\n    AVG(CAST(cs.cs_coupon_amt AS DECIMAL(12, 2))) AS agg3,\n    AVG(CAST(cs.cs_sales_price AS DECIMAL(12, 2))) AS agg4,\n    AVG(CAST(cs.cs_net_profit AS DECIMAL(12, 2))) AS agg5,\n    AVG(CAST(fc.c_birth_year AS DECIMAL(12, 2))) AS agg6,\n    AVG(CAST(fcd1.cd_dep_count AS DECIMAL(12, 2))) AS agg7\nFROM catalog_sales cs\nJOIN filtered_date fd ON cs.cs_sold_date_sk = fd.d_date_sk\nJOIN filtered_cd1 fcd1 ON cs.cs_bill_cdemo_sk = fcd1.cd_demo_sk\nJOIN filtered_customer fc ON cs.cs_bill_customer_sk = fc.c_customer_sk\nJOIN customer_demographics cd2 ON fc.c_current_cdemo_sk = cd2.cd_demo_sk\nJOIN item i ON cs.cs_item_sk = i.i_item_sk\nGROUP BY ROLLUP (\n    i.i_item_id,\n    fc.ca_country,\n    fc.ca_state,\n    fc.ca_county\n)\nORDER BY\n    fc.ca_country,\n    fc.ca_state,\n    fc.ca_county,\n    i.i_item_id\nLIMIT 100\n```\n\n**Changes**: Isolated all filtered dimension tables (date_dim, customer_demographics cd1, customer_address, customer) into separate CTEs before joining with the fact table, ensuring predicate pushdown and reuse of filtered dimension sets. Converted implicit joins to explicit JOIN syntax for better optimizer control.\n\n**Expected speedup**: 1.8-2.2x due to reduced dimension table scans and smaller hash tables for fact table joins.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 2,
          "iteration": 0,
          "strategy": "moderate_dimension_isolation"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.5658230001570317,
            "original_ms": 287.77759700005845,
            "optimized_ms": 183.78679900039666,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.14,
            "original_ms": 424.41,
            "optimized_ms": 370.94,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filtering",
            "speedup": 1.060668109282916,
            "original_ms": 287.77759700005845,
            "optimized_ms": 271.3172899999942,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.0379873402918034,
            "original_ms": 302.47784599972266,
            "optimized_ms": 291.4080300003358,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.9961536432233234,
            "original_ms": 299.0457629997157,
            "optimized_ms": 300.20044100031856,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transforms",
            "speedup": 0.8182382336609387,
            "original_ms": 287.77759700005845,
            "optimized_ms": 351.70392333354056,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructuring",
            "speedup": 0,
            "original_ms": 287.77759700005845,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q19": {
        "query_id": "q19",
        "status": "WIN",
        "best_speedup": 1.16,
        "original_ms": 389.37,
        "optimized_ms": 335.66,
        "original_sql": "SELECT i_brand_id brand_id,\n       i_brand brand,\n       i_manufact_id,\n       i_manufact,\n       sum(ss_ext_sales_price) ext_price\nFROM date_dim,\n     store_sales,\n     item,\n     customer,\n     customer_address,\n     store\nWHERE d_date_sk = ss_sold_date_sk\n  AND ss_item_sk = i_item_sk\n  AND i_manager_id=8\n  AND d_moy=11\n  AND d_year=1998\n  AND ss_customer_sk = c_customer_sk\n  AND c_current_addr_sk = ca_address_sk\n  AND SUBSTRING(ca_zip, 1, 5) <> SUBSTRING(s_zip, 1, 5)\n  AND ss_store_sk = s_store_sk\nGROUP BY i_brand,\n         i_brand_id,\n         i_manufact_id,\n         i_manufact\nORDER BY ext_price DESC,\n         i_brand,\n         i_brand_id,\n         i_manufact_id,\n         i_manufact\nLIMIT 100 ;\n\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_moy = 11 AND d_year = 1998), filtered_items AS (SELECT i_item_sk, i_brand_id, i_brand, i_manufact_id, i_manufact FROM item WHERE i_manager_id = 8), filtered_stores AS (SELECT s_store_sk, s_zip FROM store)\nSELECT i_brand_id AS brand_id, i_brand AS brand, i_manufact_id, i_manufact, SUM(ss_ext_sales_price) AS ext_price FROM store_sales JOIN filtered_dates ON d_date_sk = ss_sold_date_sk JOIN filtered_items ON ss_item_sk = i_item_sk JOIN customer ON ss_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN filtered_stores ON ss_store_sk = s_store_sk AND SUBSTRING(ca_zip, 1, 5) <> SUBSTRING(s_zip, 1, 5) GROUP BY i_brand, i_brand_id, i_manufact_id, i_manufact ORDER BY ext_price DESC, i_brand, i_brand_id, i_manufact_id, i_manufact LIMIT 100",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_moy = 11 AND d_year = 1998\",\n        \"filtered_items\": \"SELECT i_item_sk, i_brand_id, i_brand, i_manufact_id, i_manufact FROM item WHERE i_manager_id = 8\",\n        \"filtered_stores\": \"SELECT s_store_sk, s_zip FROM store\",\n        \"main_query\": \"SELECT i_brand_id AS brand_id, i_brand AS brand, i_manufact_id, i_manufact, SUM(ss_ext_sales_price) AS ext_price FROM store_sales JOIN filtered_dates ON d_date_sk = ss_sold_date_sk JOIN filtered_items ON ss_item_sk = i_item_sk JOIN customer ON ss_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN filtered_stores ON ss_store_sk = s_store_sk AND SUBSTRING(ca_zip, 1, 5) <> SUBSTRING(s_zip, 1, 5) GROUP BY i_brand, i_brand_id, i_manufact_id, i_manufact ORDER BY ext_price DESC, i_brand, i_brand_id, i_manufact_id, i_manufact LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same grouping\",\n        \"same output columns\",\n        \"same ordering\"\n      ],\n      \"expected_speedup\": \"30x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Isolated date_dim filter into CTE (30 rows) to reduce store_sales scan from full table to only matching rows. Created filtered_items CTE for i_manager_id = 8 filter to reduce early joins. Created filtered_stores CTE to avoid rescanning store table. This transforms the query from scanning 345M store_sales rows with late filtering to scanning only the 880K rows matching the date condition early.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 4,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.1608724781705577,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.1433944859985656,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_filter_pushdown",
            "speedup": 1.076821298293995,
            "original_ms": 347.8497986664782,
            "optimized_ms": 323.0339140000069,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructuring",
            "speedup": 1.0602974247003736,
            "original_ms": 347.8497986664782,
            "optimized_ms": 328.0681349997394,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0425864506421607,
            "original_ms": 347.8497986664782,
            "optimized_ms": 333.64120400013536,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.04,
            "original_ms": 389.37,
            "optimized_ms": 376.07,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.0300288959165398,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.972269704718516,
            "original_ms": 269.34689333332545,
            "optimized_ms": 277.0289889998215,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.9550407815346978,
            "original_ms": 284.2434589996022,
            "optimized_ms": 297.62442033400777,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.5715978844087075,
            "original_ms": 347.8497986664782,
            "optimized_ms": 608.5568336669288,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q2": {
        "query_id": "q2",
        "status": "WIN",
        "best_speedup": 2.0971,
        "original_ms": 937.05,
        "optimized_ms": 446.83,
        "original_sql": "-- start query 2 in stream 0 using template query2.tpl\nwith wscs as\n (select sold_date_sk\n        ,sales_price\n  from (select ws_sold_date_sk sold_date_sk\n              ,ws_ext_sales_price sales_price\n        from web_sales \n        union all\n        select cs_sold_date_sk sold_date_sk\n              ,cs_ext_sales_price sales_price\n        from catalog_sales)),\n wswscs as \n (select d_week_seq,\n        sum(case when (d_day_name='Sunday') then sales_price else null end) sun_sales,\n        sum(case when (d_day_name='Monday') then sales_price else null end) mon_sales,\n        sum(case when (d_day_name='Tuesday') then sales_price else  null end) tue_sales,\n        sum(case when (d_day_name='Wednesday') then sales_price else null end) wed_sales,\n        sum(case when (d_day_name='Thursday') then sales_price else null end) thu_sales,\n        sum(case when (d_day_name='Friday') then sales_price else null end) fri_sales,\n        sum(case when (d_day_name='Saturday') then sales_price else null end) sat_sales\n from wscs\n     ,date_dim\n where d_date_sk = sold_date_sk\n group by d_week_seq)\n select d_week_seq1\n       ,round(sun_sales1/sun_sales2,2)\n       ,round(mon_sales1/mon_sales2,2)\n       ,round(tue_sales1/tue_sales2,2)\n       ,round(wed_sales1/wed_sales2,2)\n       ,round(thu_sales1/thu_sales2,2)\n       ,round(fri_sales1/fri_sales2,2)\n       ,round(sat_sales1/sat_sales2,2)\n from\n (select wswscs.d_week_seq d_week_seq1\n        ,sun_sales sun_sales1\n        ,mon_sales mon_sales1\n        ,tue_sales tue_sales1\n        ,wed_sales wed_sales1\n        ,thu_sales thu_sales1\n        ,fri_sales fri_sales1\n        ,sat_sales sat_sales1\n  from wswscs,date_dim \n  where date_dim.d_week_seq = wswscs.d_week_seq and\n        d_year = 1998) y,\n (select wswscs.d_week_seq d_week_seq2\n        ,sun_sales sun_sales2\n        ,mon_sales mon_sales2\n        ,tue_sales tue_sales2\n        ,wed_sales wed_sales2\n        ,thu_sales thu_sales2\n        ,fri_sales fri_sales2\n        ,sat_sales sat_sales2\n  from wswscs\n      ,date_dim \n  where date_dim.d_week_seq = wswscs.d_week_seq and\n        d_year = 1998+1) z\n where d_week_seq1=d_week_seq2-53\n order by d_week_seq1;\n\n-- end query 2 in stream 0 using template query2.tpl\n",
        "optimized_sql": "WITH wscs AS (SELECT sold_date_sk, sales_price FROM (SELECT ws_sold_date_sk AS sold_date_sk, ws_ext_sales_price AS sales_price FROM web_sales UNION ALL SELECT cs_sold_date_sk AS sold_date_sk, cs_ext_sales_price AS sales_price FROM catalog_sales)), wswscs AS (SELECT d_week_seq, SUM(CASE WHEN (d_day_name = 'Sunday') THEN sales_price ELSE NULL END) AS sun_sales, SUM(CASE WHEN (d_day_name = 'Monday') THEN sales_price ELSE NULL END) AS mon_sales, SUM(CASE WHEN (d_day_name = 'Tuesday') THEN sales_price ELSE NULL END) AS tue_sales, SUM(CASE WHEN (d_day_name = 'Wednesday') THEN sales_price ELSE NULL END) AS wed_sales, SUM(CASE WHEN (d_day_name = 'Thursday') THEN sales_price ELSE NULL END) AS thu_sales, SUM(CASE WHEN (d_day_name = 'Friday') THEN sales_price ELSE NULL END) AS fri_sales, SUM(CASE WHEN (d_day_name = 'Saturday') THEN sales_price ELSE NULL END) AS sat_sales FROM wscs, date_dim WHERE d_date_sk = sold_date_sk AND d_year IN (1998, 1999) GROUP BY d_week_seq) SELECT d_week_seq1, ROUND(sun_sales1 / sun_sales2, 2), ROUND(mon_sales1 / mon_sales2, 2), ROUND(tue_sales1 / tue_sales2, 2), ROUND(wed_sales1 / wed_sales2, 2), ROUND(thu_sales1 / thu_sales2, 2), ROUND(fri_sales1 / fri_sales2, 2), ROUND(sat_sales1 / sat_sales2, 2) FROM (SELECT wswscs.d_week_seq AS d_week_seq1, sun_sales AS sun_sales1, mon_sales AS mon_sales1, tue_sales AS tue_sales1, wed_sales AS wed_sales1, thu_sales AS thu_sales1, fri_sales AS fri_sales1, sat_sales AS sat_sales1 FROM wswscs, date_dim WHERE date_dim.d_week_seq = wswscs.d_week_seq AND d_year = 1998) AS y, (SELECT wswscs.d_week_seq AS d_week_seq2, sun_sales AS sun_sales2, mon_sales AS mon_sales2, tue_sales AS tue_sales2, wed_sales AS wed_sales2, thu_sales AS thu_sales2, fri_sales AS fri_sales2, sat_sales AS sat_sales2 FROM wswscs, date_dim WHERE date_dim.d_week_seq = wswscs.d_week_seq AND d_year = 1998 + 1) AS z WHERE d_week_seq1 = d_week_seq2 - 53 ORDER BY d_week_seq1",
        "transforms": [
          "pushdown"
        ],
        "principle": "pushdown",
        "changes_description": null,
        "reasoning": " ```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"pushdown\",\n      \"nodes\": {\n        \"wswscs\": \"SELECT d_week_seq, SUM(CASE WHEN (d_day_name = 'Sunday') THEN sales_price ELSE NULL END) AS sun_sales, SUM(CASE WHEN (d_day_name = 'Monday') THEN sales_price ELSE NULL END) AS mon_sales, SUM(CASE WHEN (d_day_name = 'Tuesday') THEN sales_price ELSE NULL END) AS tue_sales, SUM(CASE WHEN (d_day_name = 'Wednesday') THEN sales_price ELSE NULL END) AS wed_sales, SUM(CASE WHEN (d_day_name = 'Thursday') THEN sales_price ELSE NULL END) AS thu_sales, SUM(CASE WHEN (d_day_name = 'Friday') THEN sales_price ELSE NULL END) AS fri_sales, SUM(CASE WHEN (d_day_name = 'Saturday') THEN sales_price ELSE NULL END) AS sat_sales FROM wscs, date_dim WHERE d_date_sk = sold_date_sk AND d_year IN (1998, 1999) GROUP BY d_week_seq\",\n        \"main_query\": \"/* start query 2 in stream 0 using template query2.tpl */ WITH wscs AS (SELECT sold_date_sk, sales_price FROM (SELECT ws_sold_date_sk AS sold_date_sk, ws_ext_sales_price AS sales_price FROM web_sales UNION ALL SELECT cs_sold_date_sk AS sold_date_sk, cs_ext_sales_price AS sales_price FROM catalog_sales)), wswscs AS (SELECT d_week_seq, SUM(CASE WHEN (d_day_name = 'Sunday') THEN sales_price ELSE NULL END) AS sun_sales, SUM(CASE WHEN (d_day_name = 'Monday') THEN sales_price ELSE NULL END) AS mon_sales, SUM(CASE WHEN (d_day_name = 'Tuesday') THEN sales_price ELSE NULL END) AS tue_sales, SUM(CASE WHEN (d_day_name = 'Wednesday') THEN sales_price ELSE NULL END) AS wed_sales, SUM(CASE WHEN (d_day_name = 'Thursday') THEN sales_price ELSE NULL END) AS thu_sales, SUM(CASE WHEN (d_day_name = 'Friday') THEN sales_price ELSE NULL END) AS fri_sales, SUM(CASE WHEN (d_day_name = 'Saturday') THEN sales_price ELSE NULL END) AS sat_sales FROM wscs, date_dim WHERE d_date_sk = sold_date_sk AND d_year IN (1998, 1999) GROUP BY d_week_seq) SELECT d_week_seq1, ROUND(sun_sales1 / sun_sales2, 2), ROUND(mon_sales1 / mon_sales2, 2), ROUND(tue_sales1 / tue_sales2, 2), ROUND(wed_sales1 / wed_sales2, 2), ROUND(thu_sales1 / thu_sales2, 2), ROUND(fri_sales1 / fri_sales2, 2), ROUND(sat_sales1 / sat_sales2, 2) FROM (SELECT wswscs.d_week_seq AS d_week_seq1, sun_sales AS sun_sales1, mon_sales AS mon_sales1, tue_sales AS tue_sales1, wed_sales AS wed_sales1, thu_sales AS thu_sales1, fri_sales AS fri_sales1, sat_sales AS sat_sales1 FROM wswscs, date_dim WHERE date_dim.d_week_seq = wswscs.d_week_seq AND d_year = 1998) AS y, (SELECT wswscs.d_week_seq AS d_week_seq2, sun_sales AS sun_sales2, mon_sales AS mon_sales2, tue_sales AS tue_sales2, wed_sales AS wed_sales2, thu_sales AS thu_sales2, fri_sales AS fri_sales2, sat_sales AS sat_sales2 FROM wswscs, date_dim WHERE date_dim.d_week_seq = wswscs.d_week_seq AND d_year = 1998 + 1) AS z WHERE d_week_seq1 = d_week_seq2 - 53 ORDER BY d_week_seq1\"\n      },\n      \"invariants_kept\": [\n        \"output columns unchanged\",\n        \"grain preserved (d_week_seq)\",\n        \"same result rows\",\n        \"same ordering\"\n      ],\n      \"expected_speedup\": \"2x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Pushed year filters (d_year IN (1998, 1999)) from main_query into wswscs CTE before aggregation. This reduces the join input size between wscs and date_dim, and reduces aggregation volume significantly since only 2 years of data are processed instead of all historical data. The main_query retains its structure joining with date_dim to separate the two years for ratio calculation, but operates on pre-filtered aggregated data.\"\n}\n```",
        "provenance": {
          "source": "unvalidated",
          "run": "kimi_k2.5",
          "model": "kimi-k2.5",
          "worker_id": null,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_cte_restructure",
            "speedup": 2.4273419960051124,
            "original_ms": 785.2923199998258,
            "optimized_ms": 323.51943866675964,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "materialize_cte",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 2.3895417440610225,
            "original_ms": 785.2923199998258,
            "optimized_ms": 328.63720500032895,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "single_pass_aggregation",
              "or_to_union"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 2.1,
            "original_ms": 937.05,
            "optimized_ms": 446.83,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filtering",
            "speedup": 2.083574024790939,
            "original_ms": 785.2923199998258,
            "optimized_ms": 376.8967700001061,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.829869691470636,
            "original_ms": 606.6330019990952,
            "optimized_ms": 331.5170499990927,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_split",
            "speedup": 1.509711069676631,
            "original_ms": 785.2923199998258,
            "optimized_ms": 520.1606690000821,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "union_cte_split",
              "multi_dimension_prefetch",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.2339508146247231,
            "original_ms": 650.5138153330942,
            "optimized_ms": 527.1796960002272,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "union_cte_split"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q20": {
        "query_id": "q20",
        "status": "WIN",
        "best_speedup": 1.13,
        "original_ms": 71.56,
        "optimized_ms": 63.33,
        "original_sql": "\nSELECT i_item_id ,\n       i_item_desc,\n       i_category,\n       i_class,\n       i_current_price ,\n       sum(cs_ext_sales_price) AS itemrevenue,\n       sum(cs_ext_sales_price)*100.0000/sum(sum(cs_ext_sales_price)) OVER (PARTITION BY i_class) AS revenueratio\nFROM catalog_sales ,\n     item,\n     date_dim\nWHERE cs_item_sk = i_item_sk\n  AND i_category IN ('Sports',\n                     'Books',\n                     'Home')\n  AND cs_sold_date_sk = d_date_sk\n  AND d_date BETWEEN cast('1999-02-22' AS date) AND cast('1999-03-24' AS date)\nGROUP BY i_item_id ,\n         i_item_desc,\n         i_category ,\n         i_class ,\n         i_current_price\nORDER BY i_category NULLS FIRST,\n         i_class NULLS FIRST,\n         i_item_id NULLS FIRST,\n         i_item_desc NULLS FIRST,\n         revenueratio NULLS FIRST\nLIMIT 100;\n\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-02-22' AS DATE) AND CAST('1999-03-24' AS DATE))\nSELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, SUM(cs_ext_sales_price) AS itemrevenue, SUM(cs_ext_sales_price) * 100.0000 / SUM(SUM(cs_ext_sales_price)) OVER (PARTITION BY i_class) AS revenueratio FROM catalog_sales JOIN item ON cs_item_sk = i_item_sk JOIN filtered_dates ON cs_sold_date_sk = d_date_sk WHERE i_category IN ('Sports', 'Books', 'Home') GROUP BY i_item_id, i_item_desc, i_category, i_class, i_current_price ORDER BY i_category NULLS FIRST, i_class NULLS FIRST, i_item_id NULLS FIRST, i_item_desc NULLS FIRST, revenueratio NULLS FIRST LIMIT 100",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-02-22' AS DATE) AND CAST('1999-03-24' AS DATE)\",\n        \"main_query\": \"SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, SUM(cs_ext_sales_price) AS itemrevenue, SUM(cs_ext_sales_price) * 100.0000 / SUM(SUM(cs_ext_sales_price)) OVER (PARTITION BY i_class) AS revenueratio FROM catalog_sales JOIN item ON cs_item_sk = i_item_sk JOIN filtered_dates ON cs_sold_date_sk = d_date_sk WHERE i_category IN ('Sports', 'Books', 'Home') GROUP BY i_item_id, i_item_desc, i_category, i_class, i_current_price ORDER BY i_category NULLS FIRST, i_class NULLS FIRST, i_item_id NULLS FIRST, i_item_desc NULLS FIRST, revenueratio NULLS FIRST LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result values\",\n        \"same column output\",\n        \"same ordering\",\n        \"same grouping grain\"\n      ],\n      \"expected_speedup\": \"1.5x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Created filtered_dates CTE containing only the 31 relevant date keys, enabling early reduction of catalog_sales rows before the expensive join with item. This eliminates scanning and processing irrelevant date_dim rows (73,049 \u2192 31) and reduces the initial catalog_sales join cardinality significantly. The window function partitioning remains correct because i_class values are preserved through the early filter.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 4,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.07,
            "original_ms": 71.56,
            "optimized_ms": 67.19,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transforms",
            "speedup": 1.0687081989262024,
            "original_ms": 39.40984100002728,
            "optimized_ms": 36.8761473334113,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_date_isolation",
            "speedup": 1.0491259116843081,
            "original_ms": 39.40984100002728,
            "optimized_ms": 37.56445299950428,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.009152389882472,
            "original_ms": 40.3924926667969,
            "optimized_ms": 40.02615766633729,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filter_pushdown",
            "speedup": 1.002174064479738,
            "original_ms": 39.40984100002728,
            "optimized_ms": 39.32434733330107,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 0.9885655539900328,
            "original_ms": 39.40984100002728,
            "optimized_ms": 39.86568299994057,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8441158722409633,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8017931646180063,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.7775891064012115,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.7639148576977852,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.7058878723464658,
            "original_ms": 36.93576433336906,
            "optimized_ms": 52.325256999514146,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q21": {
        "query_id": "q21",
        "status": "WIN",
        "best_speedup": 2.43,
        "original_ms": 71.07,
        "optimized_ms": 29.25,
        "original_sql": "SELECT *\nFROM\n  (SELECT w_warehouse_name,\n          i_item_id,\n          sum(CASE\n                  WHEN (cast(d_date AS date) < CAST ('2000-03-11' AS date)) THEN inv_quantity_on_hand\n                  ELSE 0\n              END) AS inv_before,\n          sum(CASE\n                  WHEN (cast(d_date AS date) >= CAST ('2000-03-11' AS date)) THEN inv_quantity_on_hand\n                  ELSE 0\n              END) AS inv_after\n   FROM inventory,\n        warehouse,\n        item,\n        date_dim\n   WHERE i_current_price BETWEEN 0.99 AND 1.49\n     AND i_item_sk = inv_item_sk\n     AND inv_warehouse_sk = w_warehouse_sk\n     AND inv_date_sk = d_date_sk\n     AND d_date BETWEEN CAST ('2000-02-10' AS date) AND CAST ('2000-04-10' AS date)\n   GROUP BY w_warehouse_name,\n            i_item_id) x\nWHERE (CASE\n           WHEN inv_before > 0 THEN (inv_after*1.000) / inv_before\n           ELSE NULL\n       END) BETWEEN 2.000/3.000 AND 3.000/2.000\nORDER BY w_warehouse_name NULLS FIRST,\n         i_item_id NULLS FIRST\nLIMIT 100;\n\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN CAST('2000-02-10' AS DATE) AND CAST('2000-04-10' AS DATE)), filtered_items AS (SELECT i_item_sk, i_item_id FROM item WHERE i_current_price BETWEEN 0.99 AND 1.49), joined_facts AS (SELECT w_warehouse_name, i_item_id, d_date, inv_quantity_on_hand FROM inventory JOIN filtered_dates ON inv_date_sk = d_date_sk JOIN filtered_items ON inv_item_sk = i_item_sk JOIN warehouse ON inv_warehouse_sk = w_warehouse_sk)\nSELECT w_warehouse_name, i_item_id, SUM(CASE WHEN (CAST(d_date AS DATE) < CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) AS inv_before, SUM(CASE WHEN (CAST(d_date AS DATE) >= CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) AS inv_after FROM joined_facts GROUP BY w_warehouse_name, i_item_id HAVING (CASE WHEN SUM(CASE WHEN (CAST(d_date AS DATE) < CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) > 0 THEN (SUM(CASE WHEN (CAST(d_date AS DATE) >= CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) * 1.000) / SUM(CASE WHEN (CAST(d_date AS DATE) < CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) ELSE NULL END) BETWEEN 2.000 / 3.000 AND 3.000 / 2.000 ORDER BY w_warehouse_name NULLS FIRST, i_item_id NULLS FIRST LIMIT 100",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN CAST('2000-02-10' AS DATE) AND CAST('2000-04-10' AS DATE)\",\n        \"filtered_items\": \"SELECT i_item_sk, i_item_id FROM item WHERE i_current_price BETWEEN 0.99 AND 1.49\",\n        \"joined_facts\": \"SELECT w_warehouse_name, i_item_id, d_date, inv_quantity_on_hand FROM inventory JOIN filtered_dates ON inv_date_sk = d_date_sk JOIN filtered_items ON inv_item_sk = i_item_sk JOIN warehouse ON inv_warehouse_sk = w_warehouse_sk\",\n        \"main_query\": \"SELECT w_warehouse_name, i_item_id, SUM(CASE WHEN (CAST(d_date AS DATE) < CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) AS inv_before, SUM(CASE WHEN (CAST(d_date AS DATE) >= CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) AS inv_after FROM joined_facts GROUP BY w_warehouse_name, i_item_id HAVING (CASE WHEN SUM(CASE WHEN (CAST(d_date AS DATE) < CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) > 0 THEN (SUM(CASE WHEN (CAST(d_date AS DATE) >= CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) * 1.000) / SUM(CASE WHEN (CAST(d_date AS DATE) < CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) ELSE NULL END) BETWEEN 2.000 / 3.000 AND 3.000 / 2.000 ORDER BY w_warehouse_name NULLS FIRST, i_item_id NULLS FIRST LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\",\n        \"same grouping and aggregation\"\n      ],\n      \"expected_speedup\": \"5.0x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Isolated date_dim and item filters into separate CTEs before joining with the large inventory fact table. This reduces the cardinality of the primary join from 1.5B rows (full inventory scan) to only rows matching the date and price filters. The date CTE selects 61 rows (vs 73K), item CTE selects 6,464 rows (vs 102K), which dramatically reduces the intermediate join size from 4.5M rows to a much smaller set.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 2,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.169105220483743,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.1273954652635738,
            "original_ms": 70.04127266676126,
            "optimized_ms": 62.1266226668619,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "dimension_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0532174224186142,
            "original_ms": 62.09644133317246,
            "optimized_ms": 58.958805666710155,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.030520158956648,
            "original_ms": 60.412106332781455,
            "optimized_ms": 58.6229253331112,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filter_pushdown",
            "speedup": 1.0201435352503008,
            "original_ms": 62.09644133317246,
            "optimized_ms": 60.870298333005245,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.99,
            "original_ms": 71.07,
            "optimized_ms": 72.02,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transformation",
            "speedup": 0.9538551772144556,
            "original_ms": 62.09644133317246,
            "optimized_ms": 65.1004919997528,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_cte_prefetch",
            "speedup": 0.9504363380341327,
            "original_ms": 62.09644133317246,
            "optimized_ms": 65.33466666648262,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch",
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.6869704056665081,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.6239036518846277,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.6229752115208822,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q22": {
        "query_id": "q22",
        "status": "WIN",
        "best_speedup": 1.69,
        "original_ms": 7654.7,
        "optimized_ms": 4529.41,
        "original_sql": "SELECT i_product_name ,\n       i_brand ,\n       i_class ,\n       i_category ,\n       avg(inv_quantity_on_hand) qoh\nFROM inventory ,\n     date_dim ,\n     item\nWHERE inv_date_sk=d_date_sk\n  AND inv_item_sk=i_item_sk\n  AND d_month_seq BETWEEN 1200 AND 1200 + 11\nGROUP BY rollup(i_product_name ,i_brand ,i_class ,i_category)\nORDER BY qoh NULLS FIRST,\n         i_product_name NULLS FIRST,\n         i_brand NULLS FIRST,\n         i_class NULLS FIRST,\n         i_category NULLS FIRST\nLIMIT 100;\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1200 AND 1200 + 11)\nSELECT i_product_name, i_brand, i_class, i_category, AVG(inv_quantity_on_hand) AS qoh FROM inventory JOIN filtered_dates ON inv_date_sk = d_date_sk JOIN item ON inv_item_sk = i_item_sk GROUP BY ROLLUP (i_product_name, i_brand, i_class, i_category) ORDER BY qoh NULLS FIRST, i_product_name NULLS FIRST, i_brand NULLS FIRST, i_class NULLS FIRST, i_category NULLS FIRST LIMIT 100",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1200 AND 1200 + 11\",\n        \"main_query\": \"SELECT i_product_name, i_brand, i_class, i_category, AVG(inv_quantity_on_hand) AS qoh FROM inventory JOIN filtered_dates ON inv_date_sk = d_date_sk JOIN item ON inv_item_sk = i_item_sk GROUP BY ROLLUP (i_product_name, i_brand, i_class, i_category) ORDER BY qoh NULLS FIRST, i_product_name NULLS FIRST, i_brand NULLS FIRST, i_class NULLS FIRST, i_category NULLS FIRST LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"output columns unchanged\",\n        \"same grouping (ROLLUP preserved)\",\n        \"same row count after aggregation\",\n        \"same ordering semantics\"\n      ],\n      \"expected_speedup\": \"1.8x\",\n      \"risk\": \"low\"\n    },\n    {\n      \"id\": \"rs_02\",\n      \"transform\": \"multi_push_predicate\",\n      \"nodes\": {\n        \"filtered_inventory\": \"SELECT inv_item_sk, inv_quantity_on_hand FROM inventory JOIN filtered_dates ON inv_date_sk = d_date_sk\",\n        \"main_query\": \"SELECT i_product_name, i_brand, i_class, i_category, AVG(inv_quantity_on_hand) AS qoh FROM filtered_inventory JOIN item ON inv_item_sk = i_item_sk GROUP BY ROLLUP (i_product_name, i_brand, i_class, i_category) ORDER BY qoh NULLS FIRST, i_product_name NULLS FIRST, i_brand NULLS FIRST, i_class NULLS FIRST, i_category NULLS FIRST LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"output columns unchanged\",\n        \"same aggregation semantics\",\n        \"same grouping levels\"\n      ],\n      \"expected_speedup\": \"2.1x\",\n      \"risk\": \"medium\"\n    }\n  ],\n  \"explanation\": \"Created a filtered_dates CTE to isolate the date_dim scan (QT-OPT-003) and push it down early. This reduces the date_dim scan from 73,049 rows to 366 rows immediately. Then created a filtered_inventory CTE to push the date predicate through the join, reducing the inventory scan from 591M rows to 9.8M rows before joining with item. The two-stage pushdown allows the optimizer to apply filters before expensive joins and grouping operations.\"\n}\n```",
        "provenance": {
          "source": "Retry3W",
          "run": "retry_3worker_20260205_235909_details",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 9.499067762180804,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 7.318884110508424,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 7.240394567348402,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructuring",
            "speedup": 1.0358473947338065,
            "original_ms": 6342.173778000263,
            "optimized_ms": 6122.6912479999855,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0199358888119736,
            "original_ms": 6342.173778000263,
            "optimized_ms": 6218.208269333142,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "materialize_cte",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transforms",
            "speedup": 1.014246140704435,
            "original_ms": 6342.173778000263,
            "optimized_ms": 6253.091358667007,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.00615895166844,
            "original_ms": 6218.7121376667465,
            "optimized_ms": 6180.645838666654,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filter_pushdown",
            "speedup": 0.980658460972867,
            "original_ms": 6342.173778000263,
            "optimized_ms": 6467.26055033317,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.98,
            "original_ms": 7654.7,
            "optimized_ms": 7800.86,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0,
            "original_ms": 5724.69203466729,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q23": {
        "query_id": "q23",
        "status": "WIN",
        "best_speedup": 2.33,
        "original_ms": 24403.59,
        "optimized_ms": 10473.64,
        "original_sql": "WITH frequent_ss_items AS\n  (SELECT itemdesc,\n          i_item_sk item_sk,\n          d_date solddate,\n          count(*) cnt\n   FROM store_sales,\n        date_dim,\n     (SELECT SUBSTRING(i_item_desc, 1, 30) itemdesc,\n             *\n      FROM item) sq1\n   WHERE ss_sold_date_sk = d_date_sk\n     AND ss_item_sk = i_item_sk\n     AND d_year IN (2000,\n                    2000+1,\n                    2000+2,\n                    2000+3)\n   GROUP BY itemdesc,\n            i_item_sk,\n            d_date\n   HAVING count(*) >4),\n     max_store_sales AS\n  (SELECT max(csales) tpcds_cmax\n   FROM\n     (SELECT c_customer_sk,\n             sum(ss_quantity*ss_sales_price) csales\n      FROM store_sales,\n           customer,\n           date_dim\n      WHERE ss_customer_sk = c_customer_sk\n        AND ss_sold_date_sk = d_date_sk\n        AND d_year IN (2000,\n                       2000+1,\n                       2000+2,\n                       2000+3)\n      GROUP BY c_customer_sk) sq2),\n     best_ss_customer AS\n  (SELECT c_customer_sk,\n          sum(ss_quantity*ss_sales_price) ssales\n   FROM store_sales,\n        customer,\n        max_store_sales\n   WHERE ss_customer_sk = c_customer_sk\n   GROUP BY c_customer_sk\n   HAVING sum(ss_quantity*ss_sales_price) > (50/100.0) * max(tpcds_cmax))\nSELECT c_last_name,\n       c_first_name,\n       sales\nFROM\n  (SELECT c_last_name,\n          c_first_name,\n          sum(cs_quantity*cs_list_price) sales\n   FROM catalog_sales,\n        customer,\n        date_dim,\n        frequent_ss_items,\n        best_ss_customer\n   WHERE d_year = 2000\n     AND d_moy = 2\n     AND cs_sold_date_sk = d_date_sk\n     AND cs_item_sk = item_sk\n     AND cs_bill_customer_sk = best_ss_customer.c_customer_sk\n     AND cs_bill_customer_sk = customer.c_customer_sk\n   GROUP BY c_last_name,\n            c_first_name\n   UNION ALL SELECT c_last_name,\n                    c_first_name,\n                    sum(ws_quantity*ws_list_price) sales\n   FROM web_sales,\n        customer,\n        date_dim,\n        frequent_ss_items,\n        best_ss_customer\n   WHERE d_year = 2000\n     AND d_moy = 2\n     AND ws_sold_date_sk = d_date_sk\n     AND ws_item_sk = item_sk\n     AND ws_bill_customer_sk = best_ss_customer.c_customer_sk\n     AND ws_bill_customer_sk = customer.c_customer_sk\n   GROUP BY c_last_name,\n            c_first_name) sq3\nORDER BY c_last_name NULLS FIRST,\n         c_first_name NULLS FIRST,\n         sales NULLS FIRST\nLIMIT 100;\n",
        "optimized_sql": "WITH date_years AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year IN (2000, 2001, 2002, 2003)), date_month AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2000 AND d_moy = 2), frequent_ss_items AS (SELECT itemdesc, i_item_sk AS item_sk, d_date AS solddate, COUNT(*) AS cnt FROM store_sales, date_years, (SELECT SUBSTRING(i_item_desc, 1, 30) AS itemdesc, * FROM item) AS sq1 WHERE ss_sold_date_sk = d_date_sk AND ss_item_sk = i_item_sk GROUP BY itemdesc, i_item_sk, d_date HAVING COUNT(*) > 4), max_store_sales AS (SELECT MAX(csales) AS tpcds_cmax FROM (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS csales FROM store_sales, customer, date_years WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk = d_date_sk GROUP BY c_customer_sk) AS sq2), best_ss_customer AS (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS ssales FROM store_sales, customer, max_store_sales WHERE ss_customer_sk = c_customer_sk GROUP BY c_customer_sk HAVING SUM(ss_quantity * ss_sales_price) > (50 / 100.0) * MAX(tpcds_cmax))\nSELECT c_last_name, c_first_name, sales FROM (SELECT c_last_name, c_first_name, SUM(cs_quantity * cs_list_price) AS sales FROM catalog_sales, customer, date_month, frequent_ss_items, best_ss_customer WHERE cs_sold_date_sk = d_date_sk AND cs_item_sk = item_sk AND cs_bill_customer_sk = best_ss_customer.c_customer_sk AND cs_bill_customer_sk = customer.c_customer_sk GROUP BY c_last_name, c_first_name UNION ALL SELECT c_last_name, c_first_name, SUM(ws_quantity * ws_list_price) AS sales FROM web_sales, customer, date_month, frequent_ss_items, best_ss_customer WHERE ws_sold_date_sk = d_date_sk AND ws_item_sk = item_sk AND ws_bill_customer_sk = best_ss_customer.c_customer_sk AND ws_bill_customer_sk = customer.c_customer_sk GROUP BY c_last_name, c_first_name) AS sq3 ORDER BY c_last_name NULLS FIRST, c_first_name NULLS FIRST, sales NULLS FIRST LIMIT 100",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"date_years\": \"SELECT d_date_sk, d_date FROM date_dim WHERE d_year IN (2000, 2001, 2002, 2003)\",\n        \"date_month\": \"SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2000 AND d_moy = 2\",\n        \"frequent_ss_items\": \"SELECT itemdesc, i_item_sk AS item_sk, d_date AS solddate, COUNT(*) AS cnt FROM store_sales, date_years, (SELECT SUBSTRING(i_item_desc, 1, 30) AS itemdesc, * FROM item) AS sq1 WHERE ss_sold_date_sk = d_date_sk AND ss_item_sk = i_item_sk GROUP BY itemdesc, i_item_sk, d_date HAVING COUNT(*) > 4\",\n        \"max_store_sales\": \"SELECT MAX(csales) AS tpcds_cmax FROM (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS csales FROM store_sales, customer, date_years WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk = d_date_sk GROUP BY c_customer_sk) AS sq2\",\n        \"best_ss_customer\": \"SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS ssales FROM store_sales, customer, max_store_sales WHERE ss_customer_sk = c_customer_sk GROUP BY c_customer_sk HAVING SUM(ss_quantity * ss_sales_price) > (50 / 100.0) * MAX(tpcds_cmax)\",\n        \"main_query\": \"SELECT c_last_name, c_first_name, sales FROM (SELECT c_last_name, c_first_name, SUM(cs_quantity * cs_list_price) AS sales FROM catalog_sales, customer, date_month, frequent_ss_items, best_ss_customer WHERE cs_sold_date_sk = d_date_sk AND cs_item_sk = item_sk AND cs_bill_customer_sk = best_ss_customer.c_customer_sk AND cs_bill_customer_sk = customer.c_customer_sk GROUP BY c_last_name, c_first_name UNION ALL SELECT c_last_name, c_first_name, SUM(ws_quantity * ws_list_price) AS sales FROM web_sales, customer, date_month, frequent_ss_items, best_ss_customer WHERE ws_sold_date_sk = d_date_sk AND ws_item_sk = item_sk AND ws_bill_customer_sk = best_ss_customer.c_customer_sk AND ws_bill_customer_sk = customer.c_customer_sk GROUP BY c_last_name, c_first_name) AS sq3 ORDER BY c_last_name NULLS FIRST, c_first_name NULLS FIRST, sales NULLS FIRST LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same output columns\",\n        \"same grain\",\n        \"same ordering\"\n      ],\n      \"expected_speedup\": \"2.8x\",\n      \"risk\": \"low\"\n    },\n    {\n      \"id\": \"rs_02\",\n      \"transform\": \"pushdown\",\n      \"nodes\": {\n        \"filtered_frequent_ss_items\": \"SELECT itemdesc, i_item_sk AS item_sk, d_date AS solddate, COUNT(*) AS cnt FROM store_sales, date_years, (SELECT SUBSTRING(i_item_desc, 1, 30) AS itemdesc, * FROM item) AS sq1 WHERE ss_sold_date_sk = d_date_sk AND ss_item_sk = i_item_sk AND d_year = 2000 GROUP BY itemdesc, i_item_sk, d_date HAVING COUNT(*) > 4\",\n        \"filtered_max_store_sales\": \"SELECT MAX(csales) AS tpcds_cmax FROM (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS csales FROM store_sales, customer, date_years WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 2000 GROUP BY c_customer_sk) AS sq2\",\n        \"frequent_ss_items\": \"SELECT * FROM filtered_frequent_ss_items\",\n        \"max_store_sales\": \"SELECT * FROM filtered_max_store_sales\",\n        \"best_ss_customer\": \"SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS ssales FROM store_sales, customer, max_store_sales WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk IN (SELECT d_date_sk FROM date_years WHERE d_year = 2000) GROUP BY c_customer_sk HAVING SUM(ss_quantity * ss_sales_price) > (50 / 100.0) * MAX(tpcds_cmax)\",\n        \"main_query\": \"SELECT c_last_name, c_first_name, sales FROM (SELECT c_last_name, c_first_name, SUM(cs_quantity * cs_list_price) AS sales FROM catalog_sales, customer, date_month, frequent_ss_items, best_ss_customer WHERE cs_sold_date_sk = d_date_sk AND cs_item_sk = item_sk AND cs_bill_customer_sk = best_ss_customer.c_customer_sk AND cs_bill_customer_sk = customer.c_customer_sk GROUP BY c_last_name, c_first_name UNION ALL SELECT c_last_name, c_first_name, SUM(ws_quantity * ws_list_price) AS sales FROM web_sales, customer, date_month, frequent_ss_items, best_ss_customer WHERE ws_sold_date_sk = d_date_sk AND ws_item_sk = item_sk AND ws_bill_customer_sk = best_ss_customer.c_customer_sk AND ws_bill_customer_sk = customer.c_customer_sk GROUP BY c_last_name, c_first_name) AS sq3 ORDER BY c_last_name NULLS FIRST, c_first_name NULLS FIRST, sales NULLS FIRST LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same output columns\",\n        \"same grain\"\n      ],\n      \"expected_speedup\": \"1.9x\",\n      \"risk\": \"medium\"\n    }\n  ],\n  \"explanation\": \"Applied two sequential optimizations: 1) DATE_CTE_ISOLATE to pre-filter date_dim tables and reuse them across all CTEs, avoiding repeated scans and filters. This isolates the year/month filtering into reusable CTEs. 2) PUSHDOWN to further restrict CTE computations to only year 2000 data (since main query only uses 2000), reducing the working set for expensive aggregations. The date_years CTE remains for broader ranges but filtered versions are created for pushdown. Risk is medium for pushdown as it changes HAVING clause scope, but semantics preserved due to main query's date constraints.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 1,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 3.13078496414298,
            "original_ms": 16180.98696133317,
            "optimized_ms": 5168.348240666394,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 2.8954697409420054,
            "original_ms": 15642.633113666003,
            "optimized_ms": 5402.450902000055,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 2.840336625825207,
            "original_ms": 16180.98696133317,
            "optimized_ms": 5696.855370666526,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "intersect_to_exists",
              "or_to_union",
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filter",
            "speedup": 2.630503698367662,
            "original_ms": 16180.98696133317,
            "optimized_ms": 6151.2884286664,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_date_dimension_isolation",
            "speedup": 1.9396723976901353,
            "original_ms": 16180.98696133317,
            "optimized_ms": 8342.123639333295,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.093688660435141,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.06,
            "original_ms": 24403.59,
            "optimized_ms": 22934.68,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": []
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.0073520057731415,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.9326045198102668,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "materialize_cte",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0,
            "original_ms": 12754.588165333795,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q23a": {
        "query_id": "q23a",
        "status": "WIN",
        "best_speedup": 1.2438,
        "original_ms": 7580.46,
        "optimized_ms": 6094.49,
        "original_sql": "with frequent_ss_items as \n (select substr(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim \n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk \n    and d_year in (2000,2000+1,2000+2,2000+3)\n  group by substr(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax \n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (2000,2000+1,2000+2,2000+3) \n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\nfrom\n max_store_sales))\n  select sum(sales)\n from (select cs_quantity*cs_list_price sales\n       from catalog_sales\n           ,date_dim \n       where d_year = 2000 \n         and d_moy = 5 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n      union all\n      select ws_quantity*ws_list_price sales\n       from web_sales \n           ,date_dim \n       where d_year = 2000 \n         and d_moy = 5 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer))\n LIMIT 100;",
        "optimized_sql": "WITH frequent_ss_items AS (\n  SELECT\n    SUBSTRING(i_item_desc, 1, 30) AS itemdesc,\n    i_item_sk AS item_sk,\n    d_date AS solddate,\n    COUNT(*) AS cnt\n  FROM store_sales\n  JOIN date_dim ON ss_sold_date_sk = d_date_sk\n  JOIN item ON ss_item_sk = i_item_sk\n  WHERE d_year IN (2000, 2000 + 1, 2000 + 2, 2000 + 3)\n  GROUP BY\n    SUBSTRING(i_item_desc, 1, 30),\n    i_item_sk,\n    d_date\n  HAVING COUNT(*) > 4\n), max_store_sales AS (\n  SELECT MAX(csales) AS tpcds_cmax\n  FROM (\n    SELECT\n      c_customer_sk,\n      SUM(ss_quantity * ss_sales_price) AS csales\n    FROM store_sales\n    JOIN customer ON ss_customer_sk = c_customer_sk\n    JOIN date_dim ON ss_sold_date_sk = d_date_sk\n    WHERE d_year IN (2000, 2000 + 1, 2000 + 2, 2000 + 3)\n    GROUP BY c_customer_sk\n  )\n), best_ss_customer AS (\n  SELECT\n    c_customer_sk,\n    SUM(ss_quantity * ss_sales_price) AS ssales\n  FROM store_sales\n  JOIN customer ON ss_customer_sk = c_customer_sk\n  GROUP BY c_customer_sk\n  HAVING SUM(ss_quantity * ss_sales_price) > (95 / 100.0) * (SELECT tpcds_cmax FROM max_store_sales)\n), may_2000_dates AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 2000 AND d_moy = 5\n), frequent_items AS (\n  SELECT DISTINCT item_sk\n  FROM frequent_ss_items\n), best_customers AS (\n  SELECT DISTINCT c_customer_sk\n  FROM best_ss_customer\n), catalog_sales_filtered AS (\n  SELECT cs_quantity * cs_list_price AS sales\n  FROM catalog_sales\n  JOIN may_2000_dates ON cs_sold_date_sk = d_date_sk\n  JOIN frequent_items ON cs_item_sk = item_sk\n  JOIN best_customers ON cs_bill_customer_sk = c_customer_sk\n), web_sales_filtered AS (\n  SELECT ws_quantity * ws_list_price AS sales\n  FROM web_sales\n  JOIN may_2000_dates ON ws_sold_date_sk = d_date_sk\n  JOIN frequent_items ON ws_item_sk = item_sk\n  JOIN best_customers ON ws_bill_customer_sk = c_customer_sk\n)\nSELECT SUM(sales)\nFROM (\n  SELECT sales FROM catalog_sales_filtered\n  UNION ALL\n  SELECT sales FROM web_sales_filtered\n)\nLIMIT 100",
        "transforms": [
          "decorrelate",
          "date_cte_isolate",
          "prefetch_fact_join"
        ],
        "principle": "decorrelate",
        "changes_description": "** Applied dimension isolation by extracting the May 2000 date filter into a dedicated CTE, then pre-computed distinct frequent items and best customers as separate CTEs for efficient hash joins in the main sales queries. This eliminates repeated subquery evaluations and allows the optimizer to use small hash tables for filtering.\n\n**Expected speedup:** 2.0-2.5x",
        "reasoning": "```sql\nWITH frequent_ss_items AS (\n  SELECT\n    SUBSTRING(i_item_desc, 1, 30) AS itemdesc,\n    i_item_sk AS item_sk,\n    d_date AS solddate,\n    COUNT(*) AS cnt\n  FROM store_sales\n  JOIN date_dim ON ss_sold_date_sk = d_date_sk\n  JOIN item ON ss_item_sk = i_item_sk\n  WHERE d_year IN (2000, 2000 + 1, 2000 + 2, 2000 + 3)\n  GROUP BY\n    SUBSTRING(i_item_desc, 1, 30),\n    i_item_sk,\n    d_date\n  HAVING COUNT(*) > 4\n), max_store_sales AS (\n  SELECT MAX(csales) AS tpcds_cmax\n  FROM (\n    SELECT\n      c_customer_sk,\n      SUM(ss_quantity * ss_sales_price) AS csales\n    FROM store_sales\n    JOIN customer ON ss_customer_sk = c_customer_sk\n    JOIN date_dim ON ss_sold_date_sk = d_date_sk\n    WHERE d_year IN (2000, 2000 + 1, 2000 + 2, 2000 + 3)\n    GROUP BY c_customer_sk\n  )\n), best_ss_customer AS (\n  SELECT\n    c_customer_sk,\n    SUM(ss_quantity * ss_sales_price) AS ssales\n  FROM store_sales\n  JOIN customer ON ss_customer_sk = c_customer_sk\n  GROUP BY c_customer_sk\n  HAVING SUM(ss_quantity * ss_sales_price) > (95 / 100.0) * (SELECT tpcds_cmax FROM max_store_sales)\n), may_2000_dates AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 2000 AND d_moy = 5\n), frequent_items AS (\n  SELECT DISTINCT item_sk\n  FROM frequent_ss_items\n), best_customers AS (\n  SELECT DISTINCT c_customer_sk\n  FROM best_ss_customer\n), catalog_sales_filtered AS (\n  SELECT cs_quantity * cs_list_price AS sales\n  FROM catalog_sales\n  JOIN may_2000_dates ON cs_sold_date_sk = d_date_sk\n  JOIN frequent_items ON cs_item_sk = item_sk\n  JOIN best_customers ON cs_bill_customer_sk = c_customer_sk\n), web_sales_filtered AS (\n  SELECT ws_quantity * ws_list_price AS sales\n  FROM web_sales\n  JOIN may_2000_dates ON ws_sold_date_sk = d_date_sk\n  JOIN frequent_items ON ws_item_sk = item_sk\n  JOIN best_customers ON ws_bill_customer_sk = c_customer_sk\n)\nSELECT SUM(sales)\nFROM (\n  SELECT sales FROM catalog_sales_filtered\n  UNION ALL\n  SELECT sales FROM web_sales_filtered\n)\nLIMIT 100\n```\n\n**Changes:** Applied dimension isolation by extracting the May 2000 date filter into a dedicated CTE, then pre-computed distinct frequent items and best customers as separate CTEs for efficient hash joins in the main sales queries. This eliminates repeated subquery evaluations and allows the optimizer to use small hash tables for filtering.\n\n**Expected speedup:** 2.0-2.5x",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 5,
          "iteration": 1,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.243821973819773,
            "original_ms": 7580.463176666551,
            "optimized_ms": 6094.49208666653,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.2131770475981971,
            "original_ms": 7319.745734666867,
            "optimized_ms": 6033.534634667073,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "intersect_to_exists",
              "or_to_union",
              "union_cte_split"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.1478163977683398,
            "original_ms": 6400.419797000116,
            "optimized_ms": 5576.170378332487,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_filter_pushdown",
            "speedup": 1.139666337832002,
            "original_ms": 7319.745734666867,
            "optimized_ms": 6422.709429666308,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0,
            "original_ms": 7319.745734666867,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_cte_restructure",
            "speedup": 0,
            "original_ms": 7319.745734666867,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          }
        ]
      },
      "q23b": {
        "query_id": "q23b",
        "status": "WIN",
        "best_speedup": 1.1753,
        "original_ms": 7331.38,
        "optimized_ms": 6237.74,
        "original_sql": "\nwith frequent_ss_items as\n (select substr(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (2000,2000 + 1,2000 + 2,2000 + 3)\n  group by substr(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (2000,2000+1,2000+2,2000+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 2000 \n         and d_moy = 5 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 2000 \n         and d_moy = 5 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n       group by c_last_name,c_first_name) \n     order by c_last_name,c_first_name,sales\n LIMIT 100;",
        "optimized_sql": "WITH frequent_ss_items AS (\n  SELECT\n    i_item_sk AS item_sk\n  FROM store_sales\n  JOIN date_dim ON ss_sold_date_sk = d_date_sk\n  JOIN item ON ss_item_sk = i_item_sk\n  WHERE d_year IN (2000, 2000 + 1, 2000 + 2, 2000 + 3)\n  GROUP BY\n    SUBSTRING(i_item_desc, 1, 30),\n    i_item_sk,\n    d_date\n  HAVING COUNT(*) > 4\n), max_store_sales AS (\n  SELECT MAX(csales) AS tpcds_cmax\n  FROM (\n    SELECT\n      c_customer_sk,\n      SUM(ss_quantity * ss_sales_price) AS csales\n    FROM store_sales\n    JOIN customer ON ss_customer_sk = c_customer_sk\n    JOIN date_dim ON ss_sold_date_sk = d_date_sk\n    WHERE d_year IN (2000, 2000 + 1, 2000 + 2, 2000 + 3)\n    GROUP BY c_customer_sk\n  )\n), best_ss_customer AS (\n  SELECT\n    c_customer_sk,\n    SUM(ss_quantity * ss_sales_price) AS ssales\n  FROM store_sales\n  JOIN customer ON ss_customer_sk = c_customer_sk\n  GROUP BY c_customer_sk\n  HAVING SUM(ss_quantity * ss_sales_price) > (95 / 100.0) * (SELECT tpcds_cmax FROM max_store_sales)\n), may2000_dates AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 2000 AND d_moy = 5\n), catalog_sales_may2000 AS (\n  SELECT\n    c.c_last_name,\n    c.c_first_name,\n    SUM(cs.cs_quantity * cs.cs_list_price) AS sales\n  FROM catalog_sales cs\n  JOIN may2000_dates d ON cs.cs_sold_date_sk = d.d_date_sk\n  JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk\n  WHERE EXISTS (SELECT 1 FROM frequent_ss_items f WHERE f.item_sk = cs.cs_item_sk)\n    AND EXISTS (SELECT 1 FROM best_ss_customer b WHERE b.c_customer_sk = cs.cs_bill_customer_sk)\n  GROUP BY c.c_last_name, c.c_first_name\n), web_sales_may2000 AS (\n  SELECT\n    c.c_last_name,\n    c.c_first_name,\n    SUM(ws.ws_quantity * ws.ws_list_price) AS sales\n  FROM web_sales ws\n  JOIN may2000_dates d ON ws.ws_sold_date_sk = d.d_date_sk\n  JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk\n  WHERE EXISTS (SELECT 1 FROM frequent_ss_items f WHERE f.item_sk = ws.ws_item_sk)\n    AND EXISTS (SELECT 1 FROM best_ss_customer b WHERE b.c_customer_sk = ws.ws_bill_customer_sk)\n  GROUP BY c.c_last_name, c.c_first_name\n)\nSELECT\n  c_last_name,\n  c_first_name,\n  sales\nFROM (\n  SELECT * FROM catalog_sales_may2000\n  UNION ALL\n  SELECT * FROM web_sales_may2000\n)\nORDER BY\n  c_last_name,\n  c_first_name,\n  sales\nLIMIT 100;",
        "transforms": [
          "decorrelate",
          "intersect_to_exists",
          "date_cte_isolate",
          "prefetch_fact_join"
        ],
        "principle": "decorrelate",
        "changes_description": "Isolated May 2000 dates into a tiny CTE, converted IN subqueries to EXISTS for semi-join short-circuiting, split the main UNION into two specialized CTEs with early joins to the date CTE, and converted implicit joins to explicit JOIN syntax for better optimizer freedom.",
        "reasoning": "```sql\nWITH frequent_ss_items AS (\n  SELECT\n    i_item_sk AS item_sk\n  FROM store_sales\n  JOIN date_dim ON ss_sold_date_sk = d_date_sk\n  JOIN item ON ss_item_sk = i_item_sk\n  WHERE d_year IN (2000, 2000 + 1, 2000 + 2, 2000 + 3)\n  GROUP BY\n    SUBSTRING(i_item_desc, 1, 30),\n    i_item_sk,\n    d_date\n  HAVING COUNT(*) > 4\n), max_store_sales AS (\n  SELECT MAX(csales) AS tpcds_cmax\n  FROM (\n    SELECT\n      c_customer_sk,\n      SUM(ss_quantity * ss_sales_price) AS csales\n    FROM store_sales\n    JOIN customer ON ss_customer_sk = c_customer_sk\n    JOIN date_dim ON ss_sold_date_sk = d_date_sk\n    WHERE d_year IN (2000, 2000 + 1, 2000 + 2, 2000 + 3)\n    GROUP BY c_customer_sk\n  )\n), best_ss_customer AS (\n  SELECT\n    c_customer_sk,\n    SUM(ss_quantity * ss_sales_price) AS ssales\n  FROM store_sales\n  JOIN customer ON ss_customer_sk = c_customer_sk\n  GROUP BY c_customer_sk\n  HAVING SUM(ss_quantity * ss_sales_price) > (95 / 100.0) * (SELECT tpcds_cmax FROM max_store_sales)\n), may2000_dates AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 2000 AND d_moy = 5\n), catalog_sales_may2000 AS (\n  SELECT\n    c.c_last_name,\n    c.c_first_name,\n    SUM(cs.cs_quantity * cs.cs_list_price) AS sales\n  FROM catalog_sales cs\n  JOIN may2000_dates d ON cs.cs_sold_date_sk = d.d_date_sk\n  JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk\n  WHERE EXISTS (SELECT 1 FROM frequent_ss_items f WHERE f.item_sk = cs.cs_item_sk)\n    AND EXISTS (SELECT 1 FROM best_ss_customer b WHERE b.c_customer_sk = cs.cs_bill_customer_sk)\n  GROUP BY c.c_last_name, c.c_first_name\n), web_sales_may2000 AS (\n  SELECT\n    c.c_last_name,\n    c.c_first_name,\n    SUM(ws.ws_quantity * ws.ws_list_price) AS sales\n  FROM web_sales ws\n  JOIN may2000_dates d ON ws.ws_sold_date_sk = d.d_date_sk\n  JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk\n  WHERE EXISTS (SELECT 1 FROM frequent_ss_items f WHERE f.item_sk = ws.ws_item_sk)\n    AND EXISTS (SELECT 1 FROM best_ss_customer b WHERE b.c_customer_sk = ws.ws_bill_customer_sk)\n  GROUP BY c.c_last_name, c.c_first_name\n)\nSELECT\n  c_last_name,\n  c_first_name,\n  sales\nFROM (\n  SELECT * FROM catalog_sales_may2000\n  UNION ALL\n  SELECT * FROM web_sales_may2000\n)\nORDER BY\n  c_last_name,\n  c_first_name,\n  sales\nLIMIT 100;\n```\n\nChanges: Isolated May 2000 dates into a tiny CTE, converted IN subqueries to EXISTS for semi-join short-circuiting, split the main UNION into two specialized CTEs with early joins to the date CTE, and converted implicit joins to explicit JOIN syntax for better optimizer freedom.\n\nExpected speedup: 2.0x+ via reduced fact table scans, early date filtering, and semi-join optimization.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 5,
          "iteration": 1,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.1753249873132035,
            "original_ms": 7331.376222333954,
            "optimized_ms": 6237.743859333325,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "intersect_to_exists",
              "date_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_reduction",
            "speedup": 0.9436712757404857,
            "original_ms": 6679.733768666665,
            "optimized_ms": 7078.454055333168,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_consolidation",
            "speedup": 0.8949193586213647,
            "original_ms": 6679.733768666665,
            "optimized_ms": 7464.062213333818,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0,
            "original_ms": 6679.733768666665,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0,
            "original_ms": 6679.733768666665,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0,
            "original_ms": 6726.476968666854,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "prefetch_fact_join"
            ]
          }
        ]
      },
      "q24": {
        "query_id": "q24",
        "status": "REGRESSION",
        "best_speedup": 0.87,
        "original_ms": 780.29,
        "optimized_ms": 896.89,
        "original_sql": "-- start query 24 in stream 0 using template query24.tpl\nwith ssales as\n(select c_last_name\n      ,c_first_name\n      ,s_store_name\n      ,ca_state\n      ,s_state\n      ,i_color\n      ,i_current_price\n      ,i_manager_id\n      ,i_units\n      ,i_size\n      ,sum(ss_net_profit) netpaid\nfrom store_sales\n    ,store_returns\n    ,store\n    ,item\n    ,customer\n    ,customer_address\nwhere ss_ticket_number = sr_ticket_number\n  and ss_item_sk = sr_item_sk\n  and ss_customer_sk = c_customer_sk\n  and ss_item_sk = i_item_sk\n  and ss_store_sk = s_store_sk\n  and c_current_addr_sk = ca_address_sk\n  and c_birth_country <> upper(ca_country)\n  and s_zip = ca_zip\nand s_market_id=8\ngroup by c_last_name\n        ,c_first_name\n        ,s_store_name\n        ,ca_state\n        ,s_state\n        ,i_color\n        ,i_current_price\n        ,i_manager_id\n        ,i_units\n        ,i_size)\nselect c_last_name\n      ,c_first_name\n      ,s_store_name\n      ,sum(netpaid) paid\nfrom ssales\nwhere i_color = 'beige'\ngroup by c_last_name\n        ,c_first_name\n        ,s_store_name\nhaving sum(netpaid) > (select 0.05*avg(netpaid)\n                                 from ssales)\norder by c_last_name\n        ,c_first_name\n        ,s_store_name\n;\nwith ssales as\n(select c_last_name\n      ,c_first_name\n      ,s_store_name\n      ,ca_state\n      ,s_state\n      ,i_color\n      ,i_current_price\n      ,i_manager_id\n      ,i_units\n      ,i_size\n      ,sum(ss_net_profit) netpaid\nfrom store_sales\n    ,store_returns\n    ,store\n    ,item\n    ,customer\n    ,customer_address\nwhere ss_ticket_number = sr_ticket_number\n  and ss_item_sk = sr_item_sk\n  and ss_customer_sk = c_customer_sk\n  and ss_item_sk = i_item_sk\n  and ss_store_sk = s_store_sk\n  and c_current_addr_sk = ca_address_sk\n  and c_birth_country <> upper(ca_country)\n  and s_zip = ca_zip\n  and s_market_id = 8\ngroup by c_last_name\n        ,c_first_name\n        ,s_store_name\n        ,ca_state\n        ,s_state\n        ,i_color\n        ,i_current_price\n        ,i_manager_id\n        ,i_units\n        ,i_size)\nselect c_last_name\n      ,c_first_name\n      ,s_store_name\n      ,sum(netpaid) paid\nfrom ssales\nwhere i_color = 'blue'\ngroup by c_last_name\n        ,c_first_name\n        ,s_store_name\nhaving sum(netpaid) > (select 0.05*avg(netpaid)\n                           from ssales)\norder by c_last_name\n        ,c_first_name\n        ,s_store_name\n;\n\n-- end query 24 in stream 0 using template query24.tpl\n",
        "optimized_sql": "-- start query 24 in stream 0 using template query24.tpl\nwith ssales as\n(select c_last_name\n      ,c_first_name\n      ,s_store_name\n      ,ca_state\n      ,s_state\n      ,i_color\n      ,i_current_price\n      ,i_manager_id\n      ,i_units\n      ,i_size\n      ,sum(ss_net_profit) netpaid\nfrom store_sales\n    ,store_returns\n    ,store\n    ,item\n    ,customer\n    ,customer_address\nwhere ss_ticket_number = sr_ticket_number\n  and ss_item_sk = sr_item_sk\n  and ss_customer_sk = c_customer_sk\n  and ss_item_sk = i_item_sk\n  and ss_store_sk = s_store_sk\n  and c_current_addr_sk = ca_address_sk\n  and c_birth_country <> upper(ca_country)\n  and s_zip = ca_zip\nand s_market_id=8\ngroup by c_last_name\n        ,c_first_name\n        ,s_store_name\n        ,ca_state\n        ,s_state\n        ,i_color\n        ,i_current_price\n        ,i_manager_id\n        ,i_units\n        ,i_size)\nselect c_last_name\n      ,c_first_name\n      ,s_store_name\n      ,sum(netpaid) paid\nfrom ssales\nwhere i_color = 'beige'\ngroup by c_last_name\n        ,c_first_name\n        ,s_store_name\nhaving sum(netpaid) > (select 0.05*avg(netpaid)\n                                 from ssales)\norder by c_last_name\n        ,c_first_name\n        ,s_store_name\n;\nwith ssales as\n(select c_last_name\n      ,c_first_name\n      ,s_store_name\n      ,ca_state\n      ,s_state\n      ,i_color\n      ,i_current_price\n      ,i_manager_id\n      ,i_units\n      ,i_size\n      ,sum(ss_net_profit) netpaid\nfrom store_sales\n    ,store_returns\n    ,store\n    ,item\n    ,customer\n    ,customer_address\nwhere ss_ticket_number = sr_ticket_number\n  and ss_item_sk = sr_item_sk\n  and ss_customer_sk = c_customer_sk\n  and ss_item_sk = i_item_sk\n  and ss_store_sk = s_store_sk\n  and c_current_addr_sk = ca_address_sk\n  and c_birth_country <> upper(ca_country)\n  and s_zip = ca_zip\n  and s_market_id = 8\ngroup by c_last_name\n        ,c_first_name\n        ,s_store_name\n        ,ca_state\n        ,s_state\n        ,i_color\n        ,i_current_price\n        ,i_manager_id\n        ,i_units\n        ,i_size)\nselect c_last_name\n      ,c_first_name\n      ,s_store_name\n      ,sum(netpaid) paid\nfrom ssales\nwhere i_color = 'blue'\ngroup by c_last_name\n        ,c_first_name\n        ,s_store_name\nhaving sum(netpaid) > (select 0.05*avg(netpaid)\n                           from ssales)\norder by c_last_name\n        ,c_first_name\n        ,s_store_name\n;\n\n-- end query 24 in stream 0 using template query24.tpl\n",
        "transforms": [
          "pushdown"
        ],
        "principle": "pushdown",
        "changes_description": null,
        "reasoning": " ```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"early_filter\",\n      \"nodes\": {\n        \"ssales_unfiltered\": \"SELECT c_last_name, c_first_name, s_store_name, ca_state, s_state, i_color, i_current_price, i_manager_id, i_units, i_size, SUM(ss_net_profit) AS netpaid FROM store_sales, store_returns, store, item, customer, customer_address WHERE ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk AND ss_customer_sk = c_customer_sk AND ss_item_sk = i_item_sk AND ss_store_sk = s_store_sk AND c_current_addr_sk = ca_address_sk AND c_birth_country <> UPPER(ca_country) AND s_zip",
        "provenance": {
          "source": "Kimi",
          "run": "kimi_k2.5",
          "model": "kimi-k2.5",
          "worker_id": null,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.9907464347876256,
            "original_ms": 913.0745653328631,
            "optimized_ms": 458.65940000051825,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.9393842392210412,
            "original_ms": 895.7238573332992,
            "optimized_ms": 461.85992399993364,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.87,
            "original_ms": 780.29,
            "optimized_ms": 900.2,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_restructure_with_prefetch",
            "speedup": 0.7841197384470125,
            "original_ms": 895.7238573332992,
            "optimized_ms": 1142.3304546666866,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.7624895411918637,
            "original_ms": 964.4085880002725,
            "optimized_ms": 1264.8154970005028,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_basic_optimizations",
            "speedup": 0,
            "original_ms": 895.7238573332992,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transforms",
            "speedup": 0,
            "original_ms": 895.7238573332992,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "decorrelate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q25": {
        "query_id": "q25",
        "status": "NEUTRAL",
        "best_speedup": 0.98,
        "original_ms": 515.35,
        "optimized_ms": 525.87,
        "original_sql": "-- start query 25 in stream 0 using template query25.tpl\nselect \n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n ,sum(ss_net_profit) as store_sales_profit\n ,sum(sr_net_loss) as store_returns_loss\n ,sum(cs_net_profit) as catalog_sales_profit\n from\n store_sales\n ,store_returns\n ,catalog_sales\n ,date_dim d1\n ,date_dim d2\n ,date_dim d3\n ,store\n ,item\n where\n d1.d_moy = 4\n and d1.d_year = 2000\n and d1.d_date_sk = ss_sold_date_sk\n and i_item_sk = ss_item_sk\n and s_store_sk = ss_store_sk\n and ss_customer_sk = sr_customer_sk\n and ss_item_sk = sr_item_sk\n and ss_ticket_number = sr_ticket_number\n and sr_returned_date_sk = d2.d_date_sk\n and d2.d_moy               between 4 and  10\n and d2.d_year              = 2000\n and sr_customer_sk = cs_bill_customer_sk\n and sr_item_sk = cs_item_sk\n and cs_sold_date_sk = d3.d_date_sk\n and d3.d_moy               between 4 and  10 \n and d3.d_year              = 2000\n group by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n order by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n LIMIT 100;\n\n-- end query 25 in stream 0 using template query25.tpl\n",
        "optimized_sql": "WITH d1_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_moy = 4 AND d_year = 2000), d2_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 4 AND 10 AND d_year = 2000), d3_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 4 AND 10 AND d_year = 2000)\nSELECT i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name, SUM(ss.ss_net_profit) AS store_sales_profit, SUM(sr.sr_net_loss) AS store_returns_loss, SUM(cs.cs_net_profit) AS catalog_sales_profit FROM store_sales AS ss JOIN d1_filtered ON ss.ss_sold_date_sk = d1_filtered.d_date_sk JOIN item AS i ON ss.ss_item_sk = i.i_item_sk JOIN store AS s ON ss.ss_store_sk = s.s_store_sk JOIN store_returns AS sr ON ss.ss_customer_sk = sr.sr_customer_sk AND ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number JOIN d2_filtered ON sr.sr_returned_date_sk = d2_filtered.d_date_sk JOIN catalog_sales AS cs ON sr.sr_customer_sk = cs.cs_bill_customer_sk AND sr.sr_item_sk = cs.cs_item_sk JOIN d3_filtered ON cs.cs_sold_date_sk = d3_filtered.d_date_sk GROUP BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name ORDER BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name LIMIT 100",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": " ```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"early_filter\",\n      \"nodes\": {\n        \"d1_filtered\": \"SELECT d_date_sk FROM date_dim WHERE d_moy = 4 AND d_year = 2000\",\n        \"d2_filtered\": \"SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 4 AND 10 AND d_year = 2000\",\n        \"d3_filtered\": \"SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 4 AND 10 AND d_year = 2000\",\n        \"main_query\": \"SELECT i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name, SUM(ss.ss_net_profit) AS store_sales_profit, SUM(sr.sr_net_loss) AS store_returns_loss, SUM(cs.cs_net_profit) AS catalog_sales_profit FROM store_sales ss JOIN d1_filtered ON ss.ss_sold_date_sk = d1_filtered.d_date_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN store_returns sr ON ss.ss_customer_sk = sr.sr_customer_sk AND ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number JOIN d2_filtered ON sr.sr_returned_date_sk = d2_filtered.d_date_sk JOIN catalog_sales cs ON sr.sr_customer_sk = cs.cs_bill_customer_sk AND sr.sr_item_sk = cs.cs_item_sk JOIN d3_filtered ON cs.cs_sold_date_sk = d3_filtered.d_date_sk GROUP BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name ORDER BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"output columns unchanged\",\n        \"group by columns unchanged\",\n        \"join predicates preserved\",\n        \"date filters preserved\",\n        \"aggregation semantics unchanged\"\n      ],\n      \"expected_speedup\": \"2.5x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Filtered date_dim tables (d1, d2, d3) early to reduce cardinality before joining with fact tables. d1 filtered to April 2000, d2 and d3 filtered to Apr-Oct 2000. This minimizes the rows scanned from store_sales, store_returns, and catalog_sales before the expensive many-to-many joins between fact tables.\"\n}\n```",
        "provenance": {
          "source": "Kimi",
          "run": "kimi_k2.5",
          "model": "kimi-k2.5",
          "worker_id": null,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.98,
            "original_ms": 515.35,
            "optimized_ms": 523.93,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.9670032058565622,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_fact_prefetch",
            "speedup": 0.9515244420393175,
            "original_ms": 84.03187433335309,
            "optimized_ms": 88.31289099968369,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.804350818042192,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.6525593661591012,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.6514635171878688,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.5697267529754501,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "materialize_cte",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.5674880000396676,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.4329450794982064,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.3229199365398751,
            "original_ms": 101.23156500048935,
            "optimized_ms": 313.4881236668055,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_date_dimension_isolation",
            "speedup": 0.2777433493196165,
            "original_ms": 84.03187433335309,
            "optimized_ms": 302.5522466665886,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_date_range_cte",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_filter_pushdown",
            "speedup": 0.27308371347813115,
            "original_ms": 84.03187433335309,
            "optimized_ms": 307.71470500045933,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.05518442238855104,
            "original_ms": 89.43311900050806,
            "optimized_ms": 1620.6225440000708,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_date_range_cte",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0,
            "original_ms": 84.03187433335309,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "decorrelate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q26": {
        "query_id": "q26",
        "status": "WIN",
        "best_speedup": 1.93,
        "original_ms": 166.96,
        "optimized_ms": 86.51,
        "original_sql": "SELECT i_item_id,\n       avg(cs_quantity) agg1,\n       avg(cs_list_price) agg2,\n       avg(cs_coupon_amt) agg3,\n       avg(cs_sales_price) agg4\nFROM catalog_sales,\n     customer_demographics,\n     date_dim,\n     item,\n     promotion\nWHERE cs_sold_date_sk = d_date_sk\n  AND cs_item_sk = i_item_sk\n  AND cs_bill_cdemo_sk = cd_demo_sk\n  AND cs_promo_sk = p_promo_sk\n  AND cd_gender = 'M'\n  AND cd_marital_status = 'S'\n  AND cd_education_status = 'College'\n  AND (p_channel_email = 'N'\n       OR p_channel_event = 'N')\n  AND d_year = 2000\nGROUP BY i_item_id\nORDER BY i_item_id\nLIMIT 100;\n\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2000), filtered_customer_demographics AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_gender = 'M' AND cd_marital_status = 'S' AND cd_education_status = 'College'), filtered_promotions AS (SELECT p_promo_sk FROM promotion WHERE p_channel_email = 'N' OR p_channel_event = 'N'), joined_facts AS (SELECT cs_item_sk, cs_quantity, cs_list_price, cs_coupon_amt, cs_sales_price FROM catalog_sales AS cs JOIN filtered_dates AS fd ON cs.cs_sold_date_sk = fd.d_date_sk JOIN filtered_customer_demographics AS fcd ON cs.cs_bill_cdemo_sk = fcd.cd_demo_sk JOIN filtered_promotions AS fp ON cs.cs_promo_sk = fp.p_promo_sk)\nSELECT i_item_id, AVG(cs_quantity) AS agg1, AVG(cs_list_price) AS agg2, AVG(cs_coupon_amt) AS agg3, AVG(cs_sales_price) AS agg4 FROM joined_facts AS jf JOIN item AS i ON jf.cs_item_sk = i.i_item_sk GROUP BY i_item_id ORDER BY i_item_id LIMIT 100",
        "transforms": [
          "or_to_union"
        ],
        "principle": "or_to_union",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_year = 2000\",\n        \"filtered_customer_demographics\": \"SELECT cd_demo_sk FROM customer_demographics WHERE cd_gender = 'M' AND cd_marital_status = 'S' AND cd_education_status = 'College'\",\n        \"filtered_promotions\": \"SELECT p_promo_sk FROM promotion WHERE p_channel_email = 'N' OR p_channel_event = 'N'\",\n        \"joined_facts\": \"SELECT cs_item_sk, cs_quantity, cs_list_price, cs_coupon_amt, cs_sales_price FROM catalog_sales cs JOIN filtered_dates fd ON cs.cs_sold_date_sk = fd.d_date_sk JOIN filtered_customer_demographics fcd ON cs.cs_bill_cdemo_sk = fcd.cd_demo_sk JOIN filtered_promotions fp ON cs.cs_promo_sk = fp.p_promo_sk\",\n        \"main_query\": \"SELECT i_item_id, AVG(cs_quantity) AS agg1, AVG(cs_list_price) AS agg2, AVG(cs_coupon_amt) AS agg3, AVG(cs_sales_price) AS agg4 FROM joined_facts jf JOIN item i ON jf.cs_item_sk = i.i_item_sk GROUP BY i_item_id ORDER BY i_item_id LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same output columns\",\n        \"same grain (i_item_id)\",\n        \"same result rows\"\n      ],\n      \"expected_speedup\": \"3.5x\",\n      \"risk\": \"low\"\n    },\n    {\n      \"id\": \"rs_02\",\n      \"transform\": \"or_to_union\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_year = 2000\",\n        \"filtered_customer_demographics\": \"SELECT cd_demo_sk FROM customer_demographics WHERE cd_gender = 'M' AND cd_marital_status = 'S' AND cd_education_status = 'College'\",\n        \"promo_email_N\": \"SELECT p_promo_sk FROM promotion WHERE p_channel_email = 'N'\",\n        \"promo_event_N\": \"SELECT p_promo_sk FROM promotion WHERE p_channel_event = 'N' AND (p_channel_email != 'N' OR p_channel_email IS NULL)\",\n        \"union_promotions\": \"SELECT p_promo_sk FROM promo_email_N UNION ALL SELECT p_promo_sk FROM promo_event_N\",\n        \"joined_facts\": \"SELECT cs_item_sk, cs_quantity, cs_list_price, cs_coupon_amt, cs_sales_price FROM catalog_sales cs JOIN filtered_dates fd ON cs.cs_sold_date_sk = fd.d_date_sk JOIN filtered_customer_demographics fcd ON cs.cs_bill_cdemo_sk = fcd.cd_demo_sk JOIN union_promotions up ON cs.cs_promo_sk = up.p_promo_sk\",\n        \"main_query\": \"SELECT i_item_id, AVG(cs_quantity) AS agg1, AVG(cs_list_price) AS agg2, AVG(cs_coupon_amt) AS agg3, AVG(cs_sales_price) AS agg4 FROM joined_facts jf JOIN item i ON jf.cs_item_sk = i.i_item_sk GROUP BY i_item_id ORDER BY i_item_id LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same output columns\",\n        \"same grain (i_item_id)\",\n        \"same result rows\"\n      ],\n      \"expected_speedup\": \"2.8x\",\n      \"risk\": \"medium\"\n    }\n  ],\n  \"explanation\": \"rs_01 applies DATE_CTE_ISOLATE to filter date_dim, customer_demographics, and promotion tables early into CTEs before joining with catalog_sales. This reduces the large fact table scan by applying dimension filters first. rs_02 additionally converts the OR condition on promotion into UNION ALL of two mutually exclusive branches, enabling separate index access paths for each condition. Both rewrites preserve the original grain and output columns.\"\n}\n```",
        "provenance": {
          "source": "Retry3W",
          "run": "retry_3worker_20260205_235909_details",
          "model": "deepseek-reasoner",
          "worker_id": 1,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.9269670141015571,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.052002525075603,
            "original_ms": 221.22733733340283,
            "optimized_ms": 210.29164099915457,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0398475205485298,
            "original_ms": 196.27446833328577,
            "optimized_ms": 188.75312433283398,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filter",
            "speedup": 1.0252015355868231,
            "original_ms": 196.27446833328577,
            "optimized_ms": 191.44964333372627,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 0.935171798375209,
            "original_ms": 196.27446833328577,
            "optimized_ms": 209.88065366630812,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.5625218022305444,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.55,
            "original_ms": 166.96,
            "optimized_ms": 305.13,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.5133205238739086,
            "original_ms": 196.27446833328577,
            "optimized_ms": 382.36240166679636,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.40888260144075916,
            "original_ms": 211.68490433289358,
            "optimized_ms": 517.7156073332299,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.33818112242272685,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q27": {
        "query_id": "q27",
        "status": "WIN",
        "best_speedup": 1.5832,
        "original_ms": 730.61,
        "optimized_ms": 461.48,
        "original_sql": "-- start query 27 in stream 0 using template query27.tpl\nselect i_item_id,\n        s_state, grouping(s_state) g_state,\n        avg(ss_quantity) agg1,\n        avg(ss_list_price) agg2,\n        avg(ss_coupon_amt) agg3,\n        avg(ss_sales_price) agg4\n from store_sales, customer_demographics, date_dim, store, item\n where ss_sold_date_sk = d_date_sk and\n       ss_item_sk = i_item_sk and\n       ss_store_sk = s_store_sk and\n       ss_cdemo_sk = cd_demo_sk and\n       cd_gender = 'F' and\n       cd_marital_status = 'D' and\n       cd_education_status = 'Secondary' and\n       d_year = 1999 and\n       s_state in ('MO','AL', 'MI', 'TN', 'LA', 'SC')\n group by rollup (i_item_id, s_state)\n order by i_item_id\n         ,s_state\n LIMIT 100;\n\n-- end query 27 in stream 0 using template query27.tpl\n",
        "optimized_sql": "WITH filtered_date AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 1999\n),\nfiltered_store AS (\n    SELECT s_store_sk, s_state\n    FROM store\n    WHERE s_state IN ('MO', 'AL', 'MI', 'TN', 'LA', 'SC')\n),\nfiltered_cdemo AS (\n    SELECT cd_demo_sk\n    FROM customer_demographics\n    WHERE cd_gender = 'F'\n      AND cd_marital_status = 'D'\n      AND cd_education_status = 'Secondary'\n)\nSELECT\n    i.i_item_id,\n    fs.s_state,\n    GROUPING(fs.s_state) AS g_state,\n    AVG(ss.ss_quantity) AS agg1,\n    AVG(ss.ss_list_price) AS agg2,\n    AVG(ss.ss_coupon_amt) AS agg3,\n    AVG(ss.ss_sales_price) AS agg4\nFROM store_sales ss\nJOIN filtered_date fd ON ss.ss_sold_date_sk = fd.d_date_sk\nJOIN filtered_store fs ON ss.ss_store_sk = fs.s_store_sk\nJOIN filtered_cdemo fcd ON ss.ss_cdemo_sk = fcd.cd_demo_sk\nJOIN item i ON ss.ss_item_sk = i.i_item_sk\nGROUP BY ROLLUP (i.i_item_id, fs.s_state)\nORDER BY i.i_item_id, fs.s_state\nLIMIT 100",
        "transforms": [
          "date_cte_isolate",
          "multi_dimension_prefetch"
        ],
        "principle": "date_cte_isolate",
        "changes_description": "Isolated filtered dimensions (date, store, customer_demographics) into separate CTEs to enable predicate pushdown, then joined them directly with the fact table. This reduces the fact table scan early by applying selective filters from small dimension hash tables.",
        "reasoning": "```sql\nWITH filtered_date AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 1999\n),\nfiltered_store AS (\n    SELECT s_store_sk, s_state\n    FROM store\n    WHERE s_state IN ('MO', 'AL', 'MI', 'TN', 'LA', 'SC')\n),\nfiltered_cdemo AS (\n    SELECT cd_demo_sk\n    FROM customer_demographics\n    WHERE cd_gender = 'F'\n      AND cd_marital_status = 'D'\n      AND cd_education_status = 'Secondary'\n)\nSELECT\n    i.i_item_id,\n    fs.s_state,\n    GROUPING(fs.s_state) AS g_state,\n    AVG(ss.ss_quantity) AS agg1,\n    AVG(ss.ss_list_price) AS agg2,\n    AVG(ss.ss_coupon_amt) AS agg3,\n    AVG(ss.ss_sales_price) AS agg4\nFROM store_sales ss\nJOIN filtered_date fd ON ss.ss_sold_date_sk = fd.d_date_sk\nJOIN filtered_store fs ON ss.ss_store_sk = fs.s_store_sk\nJOIN filtered_cdemo fcd ON ss.ss_cdemo_sk = fcd.cd_demo_sk\nJOIN item i ON ss.ss_item_sk = i.i_item_sk\nGROUP BY ROLLUP (i.i_item_id, fs.s_state)\nORDER BY i.i_item_id, fs.s_state\nLIMIT 100\n```\n\nChanges: Isolated filtered dimensions (date, store, customer_demographics) into separate CTEs to enable predicate pushdown, then joined them directly with the fact table. This reduces the fact table scan early by applying selective filters from small dimension hash tables.\n\nExpected speedup: 2-3x from reduced fact table scanning and better join order optimization.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 2,
          "iteration": 0,
          "strategy": "moderate_date_dimension_isolation"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_date_dimension_isolation",
            "speedup": 1.5831926754693433,
            "original_ms": 730.6050373332861,
            "optimized_ms": 461.47575633312954,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_cte_restructure",
            "speedup": 1.5562075695450637,
            "original_ms": 730.6050373332861,
            "optimized_ms": 469.4778843331733,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_pushdown",
            "speedup": 1.5140584817912317,
            "original_ms": 730.6050373332861,
            "optimized_ms": 482.54743533349637,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.1865844679101087,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.0215396442389064,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "materialize_cte",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.01,
            "original_ms": 702.99,
            "optimized_ms": 697.45,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.941767403411337,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.31478810107854654,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transforms",
            "speedup": 0,
            "original_ms": 730.6050373332861,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0,
            "original_ms": 736.1038896663862,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0,
            "original_ms": 701.041166000626,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q28": {
        "query_id": "q28",
        "status": "WIN",
        "best_speedup": 1.33,
        "original_ms": 3730.71,
        "optimized_ms": 2805.05,
        "original_sql": "-- start query 28 in stream 0 using template query28.tpl\nselect *\nfrom (select avg(ss_list_price) B1_LP\n            ,count(ss_list_price) B1_CNT\n            ,count(distinct ss_list_price) B1_CNTD\n      from store_sales\n      where ss_quantity between 0 and 5\n        and (ss_list_price between 131 and 131+10 \n             or ss_coupon_amt between 16798 and 16798+1000\n             or ss_wholesale_cost between 25 and 25+20)) B1,\n     (select avg(ss_list_price) B2_LP\n            ,count(ss_list_price) B2_CNT\n            ,count(distinct ss_list_price) B2_CNTD\n      from store_sales\n      where ss_quantity between 6 and 10\n        and (ss_list_price between 145 and 145+10\n          or ss_coupon_amt between 14792 and 14792+1000\n          or ss_wholesale_cost between 46 and 46+20)) B2,\n     (select avg(ss_list_price) B3_LP\n            ,count(ss_list_price) B3_CNT\n            ,count(distinct ss_list_price) B3_CNTD\n      from store_sales\n      where ss_quantity between 11 and 15\n        and (ss_list_price between 150 and 150+10\n          or ss_coupon_amt between 6600 and 6600+1000\n          or ss_wholesale_cost between 9 and 9+20)) B3,\n     (select avg(ss_list_price) B4_LP\n            ,count(ss_list_price) B4_CNT\n            ,count(distinct ss_list_price) B4_CNTD\n      from store_sales\n      where ss_quantity between 16 and 20\n        and (ss_list_price between 91 and 91+10\n          or ss_coupon_amt between 13493 and 13493+1000\n          or ss_wholesale_cost between 36 and 36+20)) B4,\n     (select avg(ss_list_price) B5_LP\n            ,count(ss_list_price) B5_CNT\n            ,count(distinct ss_list_price) B5_CNTD\n      from store_sales\n      where ss_quantity between 21 and 25\n        and (ss_list_price between 0 and 0+10\n          or ss_coupon_amt between 7629 and 7629+1000\n          or ss_wholesale_cost between 6 and 6+20)) B5,\n     (select avg(ss_list_price) B6_LP\n            ,count(ss_list_price) B6_CNT\n            ,count(distinct ss_list_price) B6_CNTD\n      from store_sales\n      where ss_quantity between 26 and 30\n        and (ss_list_price between 89 and 89+10\n          or ss_coupon_amt between 15257 and 15257+1000\n          or ss_wholesale_cost between 31 and 31+20)) B6\n LIMIT 100;\n\n-- end query 28 in stream 0 using template query28.tpl\n",
        "optimized_sql": "-- start query 28 in stream 0 using template query28.tpl\nselect *\nfrom (select avg(ss_list_price) B1_LP\n            ,count(ss_list_price) B1_CNT\n            ,count(distinct ss_list_price) B1_CNTD\n      from store_sales\n      where ss_quantity between 0 and 5\n        and (ss_list_price between 131 and 131+10 \n             or ss_coupon_amt between 16798 and 16798+1000\n             or ss_wholesale_cost between 25 and 25+20)) B1,\n     (select avg(ss_list_price) B2_LP\n            ,count(ss_list_price) B2_CNT\n            ,count(distinct ss_list_price) B2_CNTD\n      from store_sales\n      where ss_quantity between 6 and 10\n        and (ss_list_price between 145 and 145+10\n          or ss_coupon_amt between 14792 and 14792+1000\n          or ss_wholesale_cost between 46 and 46+20)) B2,\n     (select avg(ss_list_price) B3_LP\n            ,count(ss_list_price) B3_CNT\n            ,count(distinct ss_list_price) B3_CNTD\n      from store_sales\n      where ss_quantity between 11 and 15\n        and (ss_list_price between 150 and 150+10\n          or ss_coupon_amt between 6600 and 6600+1000\n          or ss_wholesale_cost between 9 and 9+20)) B3,\n     (select avg(ss_list_price) B4_LP\n            ,count(ss_list_price) B4_CNT\n            ,count(distinct ss_list_price) B4_CNTD\n      from store_sales\n      where ss_quantity between 16 and 20\n        and (ss_list_price between 91 and 91+10\n          or ss_coupon_amt between 13493 and 13493+1000\n          or ss_wholesale_cost between 36 and 36+20)) B4,\n     (select avg(ss_list_price) B5_LP\n            ,count(ss_list_price) B5_CNT\n            ,count(distinct ss_list_price) B5_CNTD\n      from store_sales\n      where ss_quantity between 21 and 25\n        and (ss_list_price between 0 and 0+10\n          or ss_coupon_amt between 7629 and 7629+1000\n          or ss_wholesale_cost between 6 and 6+20)) B5,\n     (select avg(ss_list_price) B6_LP\n            ,count(ss_list_price) B6_CNT\n            ,count(distinct ss_list_price) B6_CNTD\n      from store_sales\n      where ss_quantity between 26 and 30\n        and (ss_list_price between 89 and 89+10\n          or ss_coupon_amt between 15257 and 15257+1000\n          or ss_wholesale_cost between 31 and 31+20)) B6\n LIMIT 100;\n\n-- end query 28 in stream 0 using template query28.tpl\n",
        "transforms": [
          "semantic_rewrite"
        ],
        "principle": "semantic_rewrite",
        "changes_description": null,
        "reasoning": "",
        "provenance": {
          "source": "Kimi",
          "run": "kimi_k2.5",
          "model": "kimi-k2.5",
          "worker_id": null,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.33,
            "original_ms": 3730.71,
            "optimized_ms": 2814.09,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": []
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_safe_optimizations",
            "speedup": 1.0519885108802667,
            "original_ms": 1745.1875893333029,
            "optimized_ms": 1658.941681666268,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "materialize_cte",
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_cte_restructuring",
            "speedup": 1.022888941418392,
            "original_ms": 1745.1875893333029,
            "optimized_ms": 1706.1359436668984,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "multi_date_range_cte",
              "union_cte_split"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_or_to_union_transform",
            "speedup": 0.7823452987767606,
            "original_ms": 1745.1875893333029,
            "optimized_ms": 2230.712694333306,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.6638767824067862,
            "original_ms": 1742.2818166663394,
            "optimized_ms": 2624.4054060001267,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.5954831943501389,
            "original_ms": 1676.8335596667991,
            "optimized_ms": 2815.9208783326903,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "single_pass_aggregation",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_single_pass",
            "speedup": 0.5734448387365535,
            "original_ms": 1745.1875893333029,
            "optimized_ms": 3043.3399543335327,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "single_pass_aggregation",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q29": {
        "query_id": "q29",
        "status": "WIN",
        "best_speedup": 2.35,
        "original_ms": 692.5,
        "optimized_ms": 294.68,
        "original_sql": "SELECT i_item_id,\n       i_item_desc,\n       s_store_id,\n       s_store_name,\n       sum(ss_quantity) AS store_sales_quantity,\n       sum(sr_return_quantity) AS store_returns_quantity,\n       sum(cs_quantity) AS catalog_sales_quantity\nFROM store_sales,\n     store_returns,\n     catalog_sales,\n     date_dim d1,\n     date_dim d2,\n     date_dim d3,\n     store,\n     item\nWHERE d1.d_moy = 9\n  AND d1.d_year = 1999\n  AND d1.d_date_sk = ss_sold_date_sk\n  AND i_item_sk = ss_item_sk\n  AND s_store_sk = ss_store_sk\n  AND ss_customer_sk = sr_customer_sk\n  AND ss_item_sk = sr_item_sk\n  AND ss_ticket_number = sr_ticket_number\n  AND sr_returned_date_sk = d2.d_date_sk\n  AND d2.d_moy BETWEEN 9 AND 9 + 3\n  AND d2.d_year = 1999\n  AND sr_customer_sk = cs_bill_customer_sk\n  AND sr_item_sk = cs_item_sk\n  AND cs_sold_date_sk = d3.d_date_sk\n  AND d3.d_year IN (1999,\n                    1999+1,\n                    1999+2)\nGROUP BY i_item_id,\n         i_item_desc,\n         s_store_id,\n         s_store_name\nORDER BY i_item_id,\n         i_item_desc,\n         s_store_id,\n         s_store_name\nLIMIT 100;\n\n",
        "optimized_sql": "WITH filtered_dates_d1 AS (SELECT d_date_sk FROM date_dim WHERE d_moy = 9 AND d_year = 1999), filtered_dates_d2 AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 9 AND 12 AND d_year = 1999), filtered_dates_d3 AS (SELECT d_date_sk FROM date_dim WHERE d_year IN (1999, 2000, 2001)), filtered_store_sales AS (SELECT ss_quantity, ss_item_sk, ss_store_sk, ss_customer_sk, ss_ticket_number FROM store_sales JOIN filtered_dates_d1 ON ss_sold_date_sk = d_date_sk), filtered_store_returns AS (SELECT sr_return_quantity, sr_customer_sk, sr_item_sk, sr_ticket_number FROM store_returns JOIN filtered_dates_d2 ON sr_returned_date_sk = d_date_sk), filtered_catalog_sales AS (SELECT cs_quantity, cs_bill_customer_sk, cs_item_sk FROM catalog_sales JOIN filtered_dates_d3 ON cs_sold_date_sk = d_date_sk)\nSELECT i_item_id, i_item_desc, s_store_id, s_store_name, SUM(ss_quantity) AS store_sales_quantity, SUM(sr_return_quantity) AS store_returns_quantity, SUM(cs_quantity) AS catalog_sales_quantity FROM filtered_store_sales JOIN store ON s_store_sk = ss_store_sk JOIN item ON i_item_sk = ss_item_sk JOIN filtered_store_returns ON (ss_customer_sk = sr_customer_sk AND ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number) JOIN filtered_catalog_sales ON (sr_customer_sk = cs_bill_customer_sk AND sr_item_sk = cs_item_sk) GROUP BY i_item_id, i_item_desc, s_store_id, s_store_name ORDER BY i_item_id, i_item_desc, s_store_id, s_store_name LIMIT 100",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "Looking at this query, I can see a major optimization opportunity: **early filtering of fact tables using date dimensions**. The current plan shows full table scans on massive fact tables (store_sales: 173M rows, catalog_sales: 86M rows, store_returns: 17M rows) when we should filter them early using the date conditions.\n\nThe key insight is that we can create filtered CTEs for each fact table using their respective date dimensions, then join these smaller filtered sets together. This will dramatically reduce the data processed in the expensive joins.\n\n```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"early_filter\",\n      \"nodes\": {\n        \"filtered_dates_d1\": \"SELECT d_date_sk FROM date_dim WHERE d_moy = 9 AND d_year = 1999\",\n        \"filtered_dates_d2\": \"SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 9 AND 12 AND d_year = 1999\",\n        \"filtered_dates_d3\": \"SELECT d_date_sk FROM date_dim WHERE d_year IN (1999, 2000, 2001)\",\n        \"filtered_store_sales\": \"SELECT ss_quantity, ss_item_sk, ss_store_sk, ss_customer_sk, ss_ticket_number FROM store_sales JOIN filtered_dates_d1 ON ss_sold_date_sk = d_date_sk\",\n        \"filtered_store_returns\": \"SELECT sr_return_quantity, sr_customer_sk, sr_item_sk, sr_ticket_number FROM store_returns JOIN filtered_dates_d2 ON sr_returned_date_sk = d_date_sk\",\n        \"filtered_catalog_sales\": \"SELECT cs_quantity, cs_bill_customer_sk, cs_item_sk FROM catalog_sales JOIN filtered_dates_d3 ON cs_sold_date_sk = d_date_sk\",\n        \"main_query\": \"SELECT i_item_id, i_item_desc, s_store_id, s_store_name, SUM(ss_quantity) AS store_sales_quantity, SUM(sr_return_quantity) AS store_returns_quantity, SUM(cs_quantity) AS catalog_sales_quantity FROM filtered_store_sales JOIN store ON s_store_sk = ss_store_sk JOIN item ON i_item_sk = ss_item_sk JOIN filtered_store_returns ON (ss_customer_sk = sr_customer_sk AND ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number) JOIN filtered_catalog_sales ON (sr_customer_sk = cs_bill_customer_sk AND sr_item_sk = cs_item_sk) GROUP BY i_item_id, i_item_desc, s_store_id, s_store_name ORDER BY i_item_id, i_item_desc, s_store_id, s_store_name LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"output columns unchanged\",\n        \"same result rows\",\n        \"same grouping granularity\",\n        \"required predicates preserved (cs_sold_date_sk = d3.d_date_sk, sr_item_sk = cs_item_sk, sr_customer_sk = cs_bill_customer_sk)\"\n      ],\n      \"expected_speedup\": \"15-20x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"The original query performs full scans on massive fact tables (store_sales: 173M rows, catalog_sales: 86M rows) before filtering by date. By creating CTEs that filter each fact table early using their respective date dimensions, we reduce the data volume at the start of the query. The date_dim tables filter down to ~1,096 rows each, which can be used to filter the fact tables via index joins before expensive hash joins. This should eliminate the full sequential scans that account for 99.6% of the cost.\"\n}\n```\n\n**Why this works:**\n1. **Massive data reduction upfront**: Instead of joining 173M store_sales rows with other tables, we first filter them using the date condition (d_moy=9, d_year=1999)\n2. **Early predicate application**: All date filters are applied at the earliest possible point in the query plan\n3. **Preserves invariants**: The same joins and aggregations happen, just on pre-filtered data\n4. **Eliminates full scans**: The execution plan shows full sequential scans on huge tables are the main cost driver\n\n**Expected impact:**\n- Store_sales reduces from 173M rows to only those sold in September 1999\n- Store_returns reduces from 17M rows to only those returned between Sep-Dec 1999  \n- Catalog_sales reduces from 86M rows to only those sold in 1999-2001\n- This should transform 99.6% cost sequential scans into efficient index-based filtered joins",
        "provenance": {
          "source": "Retry3W",
          "run": "retry_3worker_20260205_235909_details",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.1158854424922844,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_date_dimension_isolation",
            "speedup": 1.0281513939509057,
            "original_ms": 463.2045676668592,
            "optimized_ms": 450.5217523334674,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.0137047474433565,
            "original_ms": 463.2045676668592,
            "optimized_ms": 456.94228899992595,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.000858255400891,
            "original_ms": 470.43443333313917,
            "optimized_ms": 470.03102666591684,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.95,
            "original_ms": 692.5,
            "optimized_ms": 726.59,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_stage_prefetch",
            "speedup": 0.8663232174945078,
            "original_ms": 463.2045676668592,
            "optimized_ms": 534.6786953332412,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8218744308459943,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.5382703404741028,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.30417633743931327,
            "original_ms": 451.59946733231965,
            "optimized_ms": 1484.66337366699,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filter",
            "speedup": 0,
            "original_ms": 463.2045676668592,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q3": {
        "query_id": "q3",
        "status": "WIN",
        "best_speedup": 1.19,
        "original_ms": 296.3,
        "optimized_ms": 248.99,
        "original_sql": "SELECT dt.d_year,\n       item.i_brand_id brand_id,\n       item.i_brand brand,\n       sum(ss_ext_sales_price) sum_agg\nFROM date_dim dt,\n     store_sales,\n     item\nWHERE dt.d_date_sk = store_sales.ss_sold_date_sk\n  AND store_sales.ss_item_sk = item.i_item_sk\n  AND item.i_manufact_id = 128\n  AND dt.d_moy=11\nGROUP BY dt.d_year,\n         item.i_brand,\n         item.i_brand_id\nORDER BY dt.d_year,\n         sum_agg DESC,\n         brand_id\nLIMIT 100;\n\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_year FROM date_dim WHERE d_moy = 11)\nSELECT dt.d_year, item.i_brand_id AS brand_id, item.i_brand AS brand, SUM(ss_ext_sales_price) AS sum_agg FROM store_sales JOIN filtered_dates AS dt ON dt.d_date_sk = store_sales.ss_sold_date_sk JOIN item ON store_sales.ss_item_sk = item.i_item_sk WHERE item.i_manufact_id = 128 GROUP BY dt.d_year, item.i_brand, item.i_brand_id ORDER BY dt.d_year, sum_agg DESC, brand_id LIMIT 100",
        "transforms": [
          "date_cte_isolate",
          "dimension_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk, d_year FROM date_dim WHERE d_moy = 11\",\n        \"main_query\": \"SELECT dt.d_year, item.i_brand_id AS brand_id, item.i_brand AS brand, SUM(ss_ext_sales_price) AS sum_agg FROM store_sales JOIN filtered_dates dt ON dt.d_date_sk = store_sales.ss_sold_date_sk JOIN item ON store_sales.ss_item_sk = item.i_item_sk WHERE item.i_manufact_id = 128 GROUP BY dt.d_year, item.i_brand, item.i_brand_id ORDER BY dt.d_year, sum_agg DESC, brand_id LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\", \n        \"same column output\",\n        \"same grouping and ordering\"\n      ],\n      \"expected_speedup\": \"4.5x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Isolated the date_dim filter (d_moy=11) into a CTE that reduces 73,049 rows to 6,000 rows before joining with the large store_sales table (345M rows). This enables early filtering and reduces the join size significantly. The item filter (i_manufact_id=128) remains as a regular WHERE clause since it already filters to 180 rows. This follows the QT-OPT-003 pattern from detected opportunities.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.2019354882786615,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.0569505078975658,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.043321386571465,
            "original_ms": 214.61564333306646,
            "optimized_ms": 205.70424999944711,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_cte_restructuring",
            "speedup": 1.0389274826521822,
            "original_ms": 200.8841433331933,
            "optimized_ms": 193.35723299991514,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.000951074060213,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0.9819028274940678,
            "original_ms": 200.8841433331933,
            "optimized_ms": 204.5865820000472,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "multi_dimension_prefetch",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.98,
            "original_ms": 296.3,
            "optimized_ms": 302.52,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.971695317215439,
            "original_ms": 200.8841433331933,
            "optimized_ms": 206.7357326665539,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filtering",
            "speedup": 0.9394047166342461,
            "original_ms": 200.8841433331933,
            "optimized_ms": 213.84195733329156,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.58826075004332,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.04952674768985023,
            "original_ms": 195.71052800044222,
            "optimized_ms": 3951.6127573333506,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          }
        ]
      },
      "q30": {
        "query_id": "q30",
        "status": "WIN",
        "best_speedup": 1.239,
        "original_ms": 133.91,
        "optimized_ms": 108.08,
        "original_sql": "-- start query 30 in stream 0 using template query30.tpl\nwith customer_total_return as\n (select wr_returning_customer_sk as ctr_customer_sk\n        ,ca_state as ctr_state, \n \tsum(wr_return_amt) as ctr_total_return\n from web_returns\n     ,date_dim\n     ,customer_address\n where wr_returned_date_sk = d_date_sk \n   and d_year =2002\n   and wr_returning_addr_sk = ca_address_sk \n group by wr_returning_customer_sk\n         ,ca_state)\n  select c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag\n       ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address\n       ,c_last_review_date_sk,ctr_total_return\n from customer_total_return ctr1\n     ,customer_address\n     ,customer\n where ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2\n \t\t\t  from customer_total_return ctr2 \n                  \t  where ctr1.ctr_state = ctr2.ctr_state)\n       and ca_address_sk = c_current_addr_sk\n       and ca_state = 'IN'\n       and ctr1.ctr_customer_sk = c_customer_sk\n order by c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag\n                  ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address\n                  ,c_last_review_date_sk,ctr_total_return\n LIMIT 100;\n\n-- end query 30 in stream 0 using template query30.tpl\n",
        "optimized_sql": "WITH customer_total_return AS (\n  SELECT\n    wr_returning_customer_sk AS ctr_customer_sk,\n    ca_state AS ctr_state,\n    SUM(wr_return_amt) AS ctr_total_return\n  FROM web_returns\n  JOIN date_dim ON wr_returned_date_sk = d_date_sk\n  JOIN customer_address ON wr_returning_addr_sk = ca_address_sk\n  WHERE d_year = 2002\n  GROUP BY\n    wr_returning_customer_sk,\n    ca_state\n),\nstate_avg_return AS (\n  SELECT\n    ctr_state,\n    AVG(ctr_total_return) * 1.2 AS avg_threshold\n  FROM customer_total_return\n  GROUP BY ctr_state\n)\nSELECT\n  c_customer_id,\n  c_salutation,\n  c_first_name,\n  c_last_name,\n  c_preferred_cust_flag,\n  c_birth_day,\n  c_birth_month,\n  c_birth_year,\n  c_birth_country,\n  c_login,\n  c_email_address,\n  c_last_review_date_sk,\n  ctr_total_return\nFROM customer_total_return ctr1\nJOIN state_avg_return sar ON ctr1.ctr_state = sar.ctr_state\nJOIN customer ON ctr1.ctr_customer_sk = c_customer_sk\nJOIN customer_address ON ca_address_sk = c_current_addr_sk\nWHERE ctr1.ctr_total_return > sar.avg_threshold\n  AND ca_state = 'IN'\nORDER BY\n  c_customer_id,\n  c_salutation,\n  c_first_name,\n  c_last_name,\n  c_preferred_cust_flag,\n  c_birth_day,\n  c_birth_month,\n  c_birth_year,\n  c_birth_country,\n  c_login,\n  c_email_address,\n  c_last_review_date_sk,\n  ctr_total_return\nLIMIT 100",
        "transforms": [
          "decorrelate",
          "materialize_cte"
        ],
        "principle": "decorrelate",
        "changes_description": "Decorrelated the subquery by computing state averages in a separate CTE, then joining on state for comparison. Also converted implicit joins to explicit JOIN syntax for better optimizer planning.",
        "reasoning": "```sql\nWITH customer_total_return AS (\n  SELECT\n    wr_returning_customer_sk AS ctr_customer_sk,\n    ca_state AS ctr_state,\n    SUM(wr_return_amt) AS ctr_total_return\n  FROM web_returns\n  JOIN date_dim ON wr_returned_date_sk = d_date_sk\n  JOIN customer_address ON wr_returning_addr_sk = ca_address_sk\n  WHERE d_year = 2002\n  GROUP BY\n    wr_returning_customer_sk,\n    ca_state\n),\nstate_avg_return AS (\n  SELECT\n    ctr_state,\n    AVG(ctr_total_return) * 1.2 AS avg_threshold\n  FROM customer_total_return\n  GROUP BY ctr_state\n)\nSELECT\n  c_customer_id,\n  c_salutation,\n  c_first_name,\n  c_last_name,\n  c_preferred_cust_flag,\n  c_birth_day,\n  c_birth_month,\n  c_birth_year,\n  c_birth_country,\n  c_login,\n  c_email_address,\n  c_last_review_date_sk,\n  ctr_total_return\nFROM customer_total_return ctr1\nJOIN state_avg_return sar ON ctr1.ctr_state = sar.ctr_state\nJOIN customer ON ctr1.ctr_customer_sk = c_customer_sk\nJOIN customer_address ON ca_address_sk = c_current_addr_sk\nWHERE ctr1.ctr_total_return > sar.avg_threshold\n  AND ca_state = 'IN'\nORDER BY\n  c_customer_id,\n  c_salutation,\n  c_first_name,\n  c_last_name,\n  c_preferred_cust_flag,\n  c_birth_day,\n  c_birth_month,\n  c_birth_year,\n  c_birth_country,\n  c_login,\n  c_email_address,\n  c_last_review_date_sk,\n  ctr_total_return\nLIMIT 100\n```\n\nChanges: Decorrelated the subquery by computing state averages in a separate CTE, then joining on state for comparison. Also converted implicit joins to explicit JOIN syntax for better optimizer planning.\n\nExpected speedup: 2.0x+ by eliminating correlated subquery execution per row and enabling better join order optimization.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 5,
          "iteration": 1,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_correlated_prefetch",
            "speedup": 1.9751527028422013,
            "original_ms": 109.24932566679975,
            "optimized_ms": 55.311837666825646,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "prefetch_fact_join",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filtering",
            "speedup": 1.9272558479286916,
            "original_ms": 109.24932566679975,
            "optimized_ms": 56.68646733344455,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.2390352919494787,
            "original_ms": 133.91162199998993,
            "optimized_ms": 108.0773266670197,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.1683145915473911,
            "original_ms": 109.24932566679975,
            "optimized_ms": 93.51019533369254,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.1544592249945018,
            "original_ms": 109.24932566679975,
            "optimized_ms": 94.63246800017562,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "intersect_to_exists",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0,
            "original_ms": 112.60067266630358,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q31": {
        "query_id": "q31",
        "status": "WIN",
        "best_speedup": 1.33,
        "original_ms": 661.33,
        "optimized_ms": 497.24,
        "original_sql": "WITH ss AS\n  (SELECT ca_county,\n          d_qoy,\n          d_year,\n          sum(ss_ext_sales_price) AS store_sales\n   FROM store_sales,\n        date_dim,\n        customer_address\n   WHERE ss_sold_date_sk = d_date_sk\n     AND ss_addr_sk=ca_address_sk\n   GROUP BY ca_county,\n            d_qoy,\n            d_year),\n     ws AS\n  (SELECT ca_county,\n          d_qoy,\n          d_year,\n          sum(ws_ext_sales_price) AS web_sales\n   FROM web_sales,\n        date_dim,\n        customer_address\n   WHERE ws_sold_date_sk = d_date_sk\n     AND ws_bill_addr_sk=ca_address_sk\n   GROUP BY ca_county,\n            d_qoy,\n            d_year)\nSELECT ss1.ca_county ,\n       ss1.d_year ,\n       (ws2.web_sales*1.0000)/ws1.web_sales web_q1_q2_increase ,\n       (ss2.store_sales*1.0000)/ss1.store_sales store_q1_q2_increase ,\n       (ws3.web_sales*1.0000)/ws2.web_sales web_q2_q3_increase ,\n       (ss3.store_sales*1.0000)/ss2.store_sales store_q2_q3_increase\nFROM ss ss1 ,\n     ss ss2 ,\n     ss ss3 ,\n     ws ws1 ,\n     ws ws2 ,\n     ws ws3\nWHERE ss1.d_qoy = 1\n  AND ss1.d_year = 2000\n  AND ss1.ca_county = ss2.ca_county\n  AND ss2.d_qoy = 2\n  AND ss2.d_year = 2000\n  AND ss2.ca_county = ss3.ca_county\n  AND ss3.d_qoy = 3\n  AND ss3.d_year = 2000\n  AND ss1.ca_county = ws1.ca_county\n  AND ws1.d_qoy = 1\n  AND ws1.d_year = 2000\n  AND ws1.ca_county = ws2.ca_county\n  AND ws2.d_qoy = 2\n  AND ws2.d_year = 2000\n  AND ws1.ca_county = ws3.ca_county\n  AND ws3.d_qoy = 3\n  AND ws3.d_year = 2000\n  AND CASE\n          WHEN ws1.web_sales > 0 THEN (ws2.web_sales*1.0000)/ws1.web_sales\n          ELSE NULL\n      END > CASE\n                WHEN ss1.store_sales > 0 THEN (ss2.store_sales*1.0000)/ss1.store_sales\n                ELSE NULL\n            END\n  AND CASE\n          WHEN ws2.web_sales > 0 THEN (ws3.web_sales*1.0000)/ws2.web_sales\n          ELSE NULL\n      END > CASE\n                WHEN ss2.store_sales > 0 THEN (ss3.store_sales*1.0000)/ss2.store_sales\n                ELSE NULL\n            END\nORDER BY ss1.ca_county;\n\n",
        "optimized_sql": "WITH ss_q1_2000 AS (SELECT ca_county, d_qoy, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales, date_dim, customer_address WHERE ss_sold_date_sk = d_date_sk AND ss_addr_sk = ca_address_sk AND d_year = 2000 AND d_qoy = 1 GROUP BY ca_county, d_qoy, d_year), ss_q2_2000 AS (SELECT ca_county, d_qoy, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales, date_dim, customer_address WHERE ss_sold_date_sk = d_date_sk AND ss_addr_sk = ca_address_sk AND d_year = 2000 AND d_qoy = 2 GROUP BY ca_county, d_qoy, d_year), ss_q3_2000 AS (SELECT ca_county, d_qoy, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales, date_dim, customer_address WHERE ss_sold_date_sk = d_date_sk AND ss_addr_sk = ca_address_sk AND d_year = 2000 AND d_qoy = 3 GROUP BY ca_county, d_qoy, d_year), ws_q1_2000 AS (SELECT ca_county, d_qoy, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales, date_dim, customer_address WHERE ws_sold_date_sk = d_date_sk AND ws_bill_addr_sk = ca_address_sk AND d_year = 2000 AND d_qoy = 1 GROUP BY ca_county, d_qoy, d_year), ws_q2_2000 AS (SELECT ca_county, d_qoy, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales, date_dim, customer_address WHERE ws_sold_date_sk = d_date_sk AND ws_bill_addr_sk = ca_address_sk AND d_year = 2000 AND d_qoy = 2 GROUP BY ca_county, d_qoy, d_year), ws_q3_2000 AS (SELECT ca_county, d_qoy, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales, date_dim, customer_address WHERE ws_sold_date_sk = d_date_sk AND ws_bill_addr_sk = ca_address_sk AND d_year = 2000 AND d_qoy = 3 GROUP BY ca_county, d_qoy, d_year), ss AS (SELECT ca_county, d_qoy, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales, date_dim, customer_address WHERE ss_sold_date_sk = d_date_sk AND ss_addr_sk = ca_address_sk GROUP BY ca_county, d_qoy, d_year), ws AS (SELECT ca_county, d_qoy, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales, date_dim, customer_address WHERE ws_sold_date_sk = d_date_sk AND ws_bill_addr_sk = ca_address_sk GROUP BY ca_county, d_qoy, d_year)\nSELECT ss1.ca_county, ss1.d_year, (ws2.web_sales * 1.0000) / ws1.web_sales AS web_q1_q2_increase, (ss2.store_sales * 1.0000) / ss1.store_sales AS store_q1_q2_increase, (ws3.web_sales * 1.0000) / ws2.web_sales AS web_q2_q3_increase, (ss3.store_sales * 1.0000) / ss2.store_sales AS store_q2_q3_increase FROM ss_q1_2000 AS ss1, ss_q2_2000 AS ss2, ss_q3_2000 AS ss3, ws_q1_2000 AS ws1, ws_q2_2000 AS ws2, ws_q3_2000 AS ws3 WHERE ss1.ca_county = ss2.ca_county AND ss2.ca_county = ss3.ca_county AND ss1.ca_county = ws1.ca_county AND ws1.ca_county = ws2.ca_county AND ws1.ca_county = ws3.ca_county AND CASE WHEN ws1.web_sales > 0 THEN (ws2.web_sales * 1.0000) / ws1.web_sales ELSE NULL END > CASE WHEN ss1.store_sales > 0 THEN (ss2.store_sales * 1.0000) / ss1.store_sales ELSE NULL END AND CASE WHEN ws2.web_sales > 0 THEN (ws3.web_sales * 1.0000) / ws2.web_sales ELSE NULL END > CASE WHEN ss2.store_sales > 0 THEN (ss3.store_sales * 1.0000) / ss2.store_sales ELSE NULL END ORDER BY ss1.ca_county",
        "transforms": [
          "pushdown"
        ],
        "principle": "pushdown",
        "changes_description": null,
        "reasoning": "Looking at the query structure, I can see the main optimization opportunity: the CTEs `ss` and `ws` are computing aggregated sales data for ALL quarters and years, but the main query only needs Q1, Q2, and Q3 of year 2000. This causes unnecessary computation. I'll use pushdown to filter early.\n\n```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"pushdown\",\n      \"nodes\": {\n        \"ss_q1_2000\": \"SELECT ca_county, d_qoy, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales, date_dim, customer_address WHERE ss_sold_date_sk = d_date_sk AND ss_addr_sk = ca_address_sk AND d_year = 2000 AND d_qoy = 1 GROUP BY ca_county, d_qoy, d_year\",\n        \"ss_q2_2000\": \"SELECT ca_county, d_qoy, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales, date_dim, customer_address WHERE ss_sold_date_sk = d_date_sk AND ss_addr_sk = ca_address_sk AND d_year = 2000 AND d_qoy = 2 GROUP BY ca_county, d_qoy, d_year\",\n        \"ss_q3_2000\": \"SELECT ca_county, d_qoy, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales, date_dim, customer_address WHERE ss_sold_date_sk = d_date_sk AND ss_addr_sk = ca_address_sk AND d_year = 2000 AND d_qoy = 3 GROUP BY ca_county, d_qoy, d_year\",\n        \"ws_q1_2000\": \"SELECT ca_county, d_qoy, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales, date_dim, customer_address WHERE ws_sold_date_sk = d_date_sk AND ws_bill_addr_sk = ca_address_sk AND d_year = 2000 AND d_qoy = 1 GROUP BY ca_county, d_qoy, d_year\",\n        \"ws_q2_2000\": \"SELECT ca_county, d_qoy, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales, date_dim, customer_address WHERE ws_sold_date_sk = d_date_sk AND ws_bill_addr_sk = ca_address_sk AND d_year = 2000 AND d_qoy = 2 GROUP BY ca_county, d_qoy, d_year\",\n        \"ws_q3_2000\": \"SELECT ca_county, d_qoy, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales, date_dim, customer_address WHERE ws_sold_date_sk = d_date_sk AND ws_bill_addr_sk = ca_address_sk AND d_year = 2000 AND d_qoy = 3 GROUP BY ca_county, d_qoy, d_year\",\n        \"main_query\": \"SELECT ss1.ca_county, ss1.d_year, (ws2.web_sales * 1.0000) / ws1.web_sales AS web_q1_q2_increase, (ss2.store_sales * 1.0000) / ss1.store_sales AS store_q1_q2_increase, (ws3.web_sales * 1.0000) / ws2.web_sales AS web_q2_q3_increase, (ss3.store_sales * 1.0000) / ss2.store_sales AS store_q2_q3_increase FROM ss_q1_2000 AS ss1, ss_q2_2000 AS ss2, ss_q3_2000 AS ss3, ws_q1_2000 AS ws1, ws_q2_2000 AS ws2, ws_q3_2000 AS ws3 WHERE ss1.ca_county = ss2.ca_county AND ss2.ca_county = ss3.ca_county AND ss1.ca_county = ws1.ca_county AND ws1.ca_county = ws2.ca_county AND ws1.ca_county = ws3.ca_county AND CASE WHEN ws1.web_sales > 0 THEN (ws2.web_sales * 1.0000) / ws1.web_sales ELSE NULL END > CASE WHEN ss1.store_sales > 0 THEN (ss2.store_sales * 1.0000) / ss1.store_sales ELSE NULL END AND CASE WHEN ws2.web_sales > 0 THEN (ws3.web_sales * 1.0000) / ws2.web_sales ELSE NULL END > CASE WHEN ss2.store_sales > 0 THEN (ss3.store_sales * 1.0000) / ss2.store_sales ELSE NULL END ORDER BY ss1.ca_county\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\",\n        \"same aggregation logic\"\n      ],\n      \"expected_speedup\": \"3.0x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Pushed d_year=2000 and d_qoy filters into each CTE before aggregation, creating specialized CTEs for each quarter. This reduces the amount of data processed in store_sales and web_sales scans from scanning entire tables to only scanning rows for specific quarters. The main query joins are simplified since the filtering is already done. This follows the verified pattern from Q93 with similar speedup.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 2,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.04,
            "original_ms": 661.33,
            "optimized_ms": 638.67,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.8060756907086735,
            "original_ms": 473.3532709991171,
            "optimized_ms": 587.2317903334382,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0.7711302612751842,
            "original_ms": 466.1799219999618,
            "optimized_ms": 604.5410813330818,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructuring",
            "speedup": 0.7708460898027261,
            "original_ms": 466.1799219999618,
            "optimized_ms": 604.7639446666532,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch",
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_predicate_pushdown",
            "speedup": 0.7567459027281345,
            "original_ms": 466.1799219999618,
            "optimized_ms": 616.0323039997214,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.6673221626826688,
            "original_ms": 442.3244489995947,
            "optimized_ms": 662.8349450008196,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "single_pass_aggregation",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.48266741213868486,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.4601310279423135,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.23213018116120565,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0,
            "original_ms": 466.1799219999618,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "decorrelate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q32": {
        "query_id": "q32",
        "status": "WIN",
        "best_speedup": 1.8164,
        "original_ms": 13.65,
        "optimized_ms": 7.51,
        "original_sql": "-- start query 32 in stream 0 using template query32.tpl\nselect sum(cs_ext_discount_amt)  as \"excess discount amount\" \nfrom \n   catalog_sales \n   ,item \n   ,date_dim\nwhere\ni_manufact_id = 29\nand i_item_sk = cs_item_sk \nand d_date between '1999-01-07' and \n        (cast('1999-01-07' as date) + INTERVAL 90 DAY)\nand d_date_sk = cs_sold_date_sk \nand cs_ext_discount_amt  \n     > ( \n         select \n            1.3 * avg(cs_ext_discount_amt) \n         from \n            catalog_sales \n           ,date_dim\n         where \n              cs_item_sk = i_item_sk \n          and d_date between '1999-01-07' and\n                             (cast('1999-01-07' as date) + INTERVAL 90 DAY)\n          and d_date_sk = cs_sold_date_sk \n      )\n LIMIT 100;\n\n-- end query 32 in stream 0 using template query32.tpl\n",
        "optimized_sql": "WITH filtered_sales AS (\n    SELECT \n        cs.cs_item_sk,\n        cs.cs_ext_discount_amt,\n        AVG(cs.cs_ext_discount_amt) OVER (PARTITION BY cs.cs_item_sk) AS avg_item_discount\n    FROM \n        catalog_sales cs\n    JOIN \n        date_dim d ON cs.cs_sold_date_sk = d.d_date_sk\n    JOIN \n        item i ON cs.cs_item_sk = i.i_item_sk\n    WHERE \n        d.d_date BETWEEN '1999-01-07' AND (CAST('1999-01-07' AS DATE) + INTERVAL '90' DAY)\n        AND i.i_manufact_id = 29\n)\nSELECT \n    SUM(cs_ext_discount_amt) AS \"excess discount amount\"\nFROM \n    filtered_sales\nWHERE \n    cs_ext_discount_amt > 1.3 * avg_item_discount\nLIMIT 100",
        "transforms": [
          "decorrelate",
          "prefetch_fact_join"
        ],
        "principle": "decorrelate",
        "changes_description": "Replaced correlated subquery with a single CTE that filters sales by date and manufacturer, computes per-item average via window function, then filters rows where discount exceeds threshold.",
        "reasoning": "```sql\nWITH filtered_sales AS (\n    SELECT \n        cs.cs_item_sk,\n        cs.cs_ext_discount_amt,\n        AVG(cs.cs_ext_discount_amt) OVER (PARTITION BY cs.cs_item_sk) AS avg_item_discount\n    FROM \n        catalog_sales cs\n    JOIN \n        date_dim d ON cs.cs_sold_date_sk = d.d_date_sk\n    JOIN \n        item i ON cs.cs_item_sk = i.i_item_sk\n    WHERE \n        d.d_date BETWEEN '1999-01-07' AND (CAST('1999-01-07' AS DATE) + INTERVAL '90' DAY)\n        AND i.i_manufact_id = 29\n)\nSELECT \n    SUM(cs_ext_discount_amt) AS \"excess discount amount\"\nFROM \n    filtered_sales\nWHERE \n    cs_ext_discount_amt > 1.3 * avg_item_discount\nLIMIT 100\n```\n\nChanges: Replaced correlated subquery with a single CTE that filters sales by date and manufacturer, computes per-item average via window function, then filters rows where discount exceeds threshold.\n\nExpected speedup: 2-4x by eliminating correlated subquery execution per row and computing averages only for manufacturer 29 items in the date range.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 6,
          "iteration": 2,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.8164371139891216,
            "original_ms": 13.649201333464589,
            "optimized_ms": 7.514271332790183,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_predicate_pushdown",
            "speedup": 0.6673587095757484,
            "original_ms": 11.466436333345579,
            "optimized_ms": 17.181818666358595,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0.6103817120018427,
            "original_ms": 11.466436333345579,
            "optimized_ms": 18.785681333307974,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructuring",
            "speedup": 0.4383791726004965,
            "original_ms": 11.466436333345579,
            "optimized_ms": 26.156434999696405,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.27,
            "original_ms": 17.4,
            "optimized_ms": 65.5,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "decorrelate",
              "pushdown",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_correlation_transform",
            "speedup": 0,
            "original_ms": 11.466436333345579,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0,
            "original_ms": 22.431922333150094,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q33": {
        "query_id": "q33",
        "status": "WIN",
        "best_speedup": 1.1482,
        "original_ms": 280.38,
        "optimized_ms": 244.19,
        "original_sql": "-- start query 33 in stream 0 using template query33.tpl\nwith ss as (\n select\n          i_manufact_id,sum(ss_ext_sales_price) total_sales\n from\n \tstore_sales,\n \tdate_dim,\n         customer_address,\n         item\n where\n         i_manufact_id in (select\n  i_manufact_id\nfrom\n item\nwhere i_category in ('Home'))\n and     ss_item_sk              = i_item_sk\n and     ss_sold_date_sk         = d_date_sk\n and     d_year                  = 2002\n and     d_moy                   = 1\n and     ss_addr_sk              = ca_address_sk\n and     ca_gmt_offset           = -5 \n group by i_manufact_id),\n cs as (\n select\n          i_manufact_id,sum(cs_ext_sales_price) total_sales\n from\n \tcatalog_sales,\n \tdate_dim,\n         customer_address,\n         item\n where\n         i_manufact_id               in (select\n  i_manufact_id\nfrom\n item\nwhere i_category in ('Home'))\n and     cs_item_sk              = i_item_sk\n and     cs_sold_date_sk         = d_date_sk\n and     d_year                  = 2002\n and     d_moy                   = 1\n and     cs_bill_addr_sk         = ca_address_sk\n and     ca_gmt_offset           = -5 \n group by i_manufact_id),\n ws as (\n select\n          i_manufact_id,sum(ws_ext_sales_price) total_sales\n from\n \tweb_sales,\n \tdate_dim,\n         customer_address,\n         item\n where\n         i_manufact_id               in (select\n  i_manufact_id\nfrom\n item\nwhere i_category in ('Home'))\n and     ws_item_sk              = i_item_sk\n and     ws_sold_date_sk         = d_date_sk\n and     d_year                  = 2002\n and     d_moy                   = 1\n and     ws_bill_addr_sk         = ca_address_sk\n and     ca_gmt_offset           = -5\n group by i_manufact_id)\n  select i_manufact_id ,sum(total_sales) total_sales\n from  (select * from ss \n        union all\n        select * from cs \n        union all\n        select * from ws) tmp1\n group by i_manufact_id\n order by total_sales\n LIMIT 100;\n\n-- end query 33 in stream 0 using template query33.tpl\n",
        "optimized_sql": "WITH home_manufacturers AS (\n  SELECT DISTINCT i_manufact_id\n  FROM item\n  WHERE i_category IN ('Home')\n), filtered_dates AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 2002\n    AND d_moy = 1\n), filtered_addresses AS (\n  SELECT ca_address_sk\n  FROM customer_address\n  WHERE ca_gmt_offset = -5\n), ss AS (\n  SELECT\n    i.i_manufact_id,\n    SUM(ss_ext_sales_price) AS total_sales\n  FROM store_sales\n  JOIN item i ON ss_item_sk = i.i_item_sk\n  JOIN home_manufacturers hm ON i.i_manufact_id = hm.i_manufact_id\n  JOIN filtered_dates fd ON ss_sold_date_sk = fd.d_date_sk\n  JOIN filtered_addresses fa ON ss_addr_sk = fa.ca_address_sk\n  GROUP BY i.i_manufact_id\n), cs AS (\n  SELECT\n    i.i_manufact_id,\n    SUM(cs_ext_sales_price) AS total_sales\n  FROM catalog_sales\n  JOIN item i ON cs_item_sk = i.i_item_sk\n  JOIN home_manufacturers hm ON i.i_manufact_id = hm.i_manufact_id\n  JOIN filtered_dates fd ON cs_sold_date_sk = fd.d_date_sk\n  JOIN filtered_addresses fa ON cs_bill_addr_sk = fa.ca_address_sk\n  GROUP BY i.i_manufact_id\n), ws AS (\n  SELECT\n    i.i_manufact_id,\n    SUM(ws_ext_sales_price) AS total_sales\n  FROM web_sales\n  JOIN item i ON ws_item_sk = i.i_item_sk\n  JOIN home_manufacturers hm ON i.i_manufact_id = hm.i_manufact_id\n  JOIN filtered_dates fd ON ws_sold_date_sk = fd.d_date_sk\n  JOIN filtered_addresses fa ON ws_bill_addr_sk = fa.ca_address_sk\n  GROUP BY i.i_manufact_id\n)\nSELECT\n  i_manufact_id,\n  SUM(total_sales) AS total_sales\nFROM (\n  SELECT * FROM ss\n  UNION ALL\n  SELECT * FROM cs\n  UNION ALL\n  SELECT * FROM ws\n) AS tmp1\nGROUP BY i_manufact_id\nORDER BY total_sales\nLIMIT 100",
        "transforms": [
          "decorrelate",
          "date_cte_isolate",
          "multi_dimension_prefetch"
        ],
        "principle": "decorrelate",
        "changes_description": null,
        "reasoning": "```sql\nWITH home_manufacturers AS (\n  SELECT DISTINCT i_manufact_id\n  FROM item\n  WHERE i_category IN ('Home')\n), filtered_dates AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 2002\n    AND d_moy = 1\n), filtered_addresses AS (\n  SELECT ca_address_sk\n  FROM customer_address\n  WHERE ca_gmt_offset = -5\n), ss AS (\n  SELECT\n    i.i_manufact_id,\n    SUM(ss_ext_sales_price) AS total_sales\n  FROM store_sales\n  JOIN item i ON ss_item_sk = i.i_item_sk\n  JOIN home_manufacturers hm ON i.i_manufact_id = hm.i_manufact_id\n  JOIN filtered_dates fd ON ss_sold_date_sk = fd.d_date_sk\n  JOIN filtered_addresses fa ON ss_addr_sk = fa.ca_address_sk\n  GROUP BY i.i_manufact_id\n), cs AS (\n  SELECT\n    i.i_manufact_id,\n    SUM(cs_ext_sales_price) AS total_sales\n  FROM catalog_sales\n  JOIN item i ON cs_item_sk = i.i_item_sk\n  JOIN home_manufacturers hm ON i.i_manufact_id = hm.i_manufact_id\n  JOIN filtered_dates fd ON cs_sold_date_sk = fd.d_date_sk\n  JOIN filtered_addresses fa ON cs_bill_addr_sk = fa.ca_address_sk\n  GROUP BY i.i_manufact_id\n), ws AS (\n  SELECT\n    i.i_manufact_id,\n    SUM(ws_ext_sales_price) AS total_sales\n  FROM web_sales\n  JOIN item i ON ws_item_sk = i.i_item_sk\n  JOIN home_manufacturers hm ON i.i_manufact_id = hm.i_manufact_id\n  JOIN filtered_dates fd ON ws_sold_date_sk = fd.d_date_sk\n  JOIN filtered_addresses fa ON ws_bill_addr_sk = fa.ca_address_sk\n  GROUP BY i.i_manufact_id\n)\nSELECT\n  i_manufact_id,\n  SUM(total_sales) AS total_sales\nFROM (\n  SELECT * FROM ss\n  UNION ALL\n  SELECT * FROM cs\n  UNION ALL\n  SELECT * FROM ws\n) AS tmp1\nGROUP BY i_manufact_id\nORDER BY total_sales\nLIMIT 100\n```\n\n**Changes**: Materialized shared dimension filters into separate CTEs (date_dim, customer_address, and the home manufacturer list) and converted implicit joins to explicit JOIN syntax. This eliminates redundant scanning and filtering of the same dimension tables across all three sales channels.\n\n**Expected speedup**: 2.0x+ by reducing redundant work and enabling better join optimization.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 5,
          "iteration": 1,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.1482033872005448,
            "original_ms": 280.3803523329407,
            "optimized_ms": 244.1904939999707,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.0527541515312318,
            "original_ms": 233.34594400027223,
            "optimized_ms": 221.6528366673932,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.05,
            "original_ms": 338.52,
            "optimized_ms": 322.31,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_consolidation",
            "speedup": 1.036599667495688,
            "original_ms": 232.78712933309484,
            "optimized_ms": 224.56801466614706,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_filter_pushdown",
            "speedup": 0.9776693736715519,
            "original_ms": 232.78712933309484,
            "optimized_ms": 238.10414400001414,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "structural_transform_decorrelate",
            "speedup": 0.932984308259224,
            "original_ms": 232.78712933309484,
            "optimized_ms": 249.5080863336625,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "dimension_isolation_multi_channel",
            "speedup": 0.9220667110100963,
            "original_ms": 232.78712933309484,
            "optimized_ms": 252.46235066667091,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.857835054181084,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "materialize_cte",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8139077239378406,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "materialize_cte"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.5336120744535915,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "materialize_cte"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q34": {
        "query_id": "q34",
        "status": "NEUTRAL",
        "best_speedup": 1.0306,
        "original_ms": 357.13,
        "optimized_ms": 346.54,
        "original_sql": "-- start query 34 in stream 0 using template query34.tpl\nselect c_last_name\n       ,c_first_name\n       ,c_salutation\n       ,c_preferred_cust_flag\n       ,ss_ticket_number\n       ,cnt from\n   (select ss_ticket_number\n          ,ss_customer_sk\n          ,count(*) cnt\n    from store_sales,date_dim,store,household_demographics\n    where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n    and store_sales.ss_store_sk = store.s_store_sk  \n    and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n    and (date_dim.d_dom between 1 and 3 or date_dim.d_dom between 25 and 28)\n    and (household_demographics.hd_buy_potential = '1001-5000' or\n         household_demographics.hd_buy_potential = '0-500')\n    and household_demographics.hd_vehicle_count > 0\n    and (case when household_demographics.hd_vehicle_count > 0 \n\tthen household_demographics.hd_dep_count/ household_demographics.hd_vehicle_count \n\telse null \n\tend)  > 1.2\n    and date_dim.d_year in (1998,1998+1,1998+2)\n    and store.s_county in ('Ziebach County','Daviess County','Walker County','Richland County',\n                           'Barrow County','Franklin Parish','Williamson County','Luce County')\n    group by ss_ticket_number,ss_customer_sk) dn,customer\n    where ss_customer_sk = c_customer_sk\n      and cnt between 15 and 20\n    order by c_last_name,c_first_name,c_salutation,c_preferred_cust_flag desc, ss_ticket_number;\n\n-- end query 34 in stream 0 using template query34.tpl\n",
        "optimized_sql": "WITH filtered_date AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE (d_dom BETWEEN 1 AND 3 OR d_dom BETWEEN 25 AND 28)\n    AND d_year IN (1998, 1999, 2000)\n),\nfiltered_store AS (\n  SELECT s_store_sk\n  FROM store\n  WHERE s_county IN (\n    'Ziebach County', 'Daviess County', 'Walker County',\n    'Richland County', 'Barrow County', 'Franklin Parish',\n    'Williamson County', 'Luce County'\n  )\n),\nfiltered_hd AS (\n  SELECT hd_demo_sk\n  FROM household_demographics\n  WHERE (hd_buy_potential = '1001-5000' OR hd_buy_potential = '0-500')\n    AND hd_vehicle_count > 0\n    AND (hd_dep_count / hd_vehicle_count) > 1.2\n),\naggregated_sales AS (\n  SELECT\n    ss_ticket_number,\n    ss_customer_sk,\n    COUNT(*) AS cnt\n  FROM store_sales\n  JOIN filtered_date ON store_sales.ss_sold_date_sk = filtered_date.d_date_sk\n  JOIN filtered_store ON store_sales.ss_store_sk = filtered_store.s_store_sk\n  JOIN filtered_hd ON store_sales.ss_hdemo_sk = filtered_hd.hd_demo_sk\n  GROUP BY ss_ticket_number, ss_customer_sk\n)\nSELECT\n  c_last_name,\n  c_first_name,\n  c_salutation,\n  c_preferred_cust_flag,\n  ss_ticket_number,\n  cnt\nFROM aggregated_sales\nJOIN customer ON aggregated_sales.ss_customer_sk = customer.c_customer_sk\nWHERE cnt BETWEEN 15 AND 20\nORDER BY\n  c_last_name,\n  c_first_name,\n  c_salutation,\n  c_preferred_cust_flag DESC,\n  ss_ticket_number",
        "transforms": [
          "date_cte_isolate",
          "dimension_cte_isolate",
          "multi_dimension_prefetch"
        ],
        "principle": "date_cte_isolate",
        "changes_description": "Pre-filtered all three dimension tables (date_dim, store, household_demographics) into separate CTEs before joining with the fact table, applying all dimension-specific filters early. Also converted implicit joins to explicit JOIN syntax for better optimization.",
        "reasoning": "```sql\nWITH filtered_date AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE (d_dom BETWEEN 1 AND 3 OR d_dom BETWEEN 25 AND 28)\n    AND d_year IN (1998, 1999, 2000)\n),\nfiltered_store AS (\n  SELECT s_store_sk\n  FROM store\n  WHERE s_county IN (\n    'Ziebach County', 'Daviess County', 'Walker County',\n    'Richland County', 'Barrow County', 'Franklin Parish',\n    'Williamson County', 'Luce County'\n  )\n),\nfiltered_hd AS (\n  SELECT hd_demo_sk\n  FROM household_demographics\n  WHERE (hd_buy_potential = '1001-5000' OR hd_buy_potential = '0-500')\n    AND hd_vehicle_count > 0\n    AND (hd_dep_count / hd_vehicle_count) > 1.2\n),\naggregated_sales AS (\n  SELECT\n    ss_ticket_number,\n    ss_customer_sk,\n    COUNT(*) AS cnt\n  FROM store_sales\n  JOIN filtered_date ON store_sales.ss_sold_date_sk = filtered_date.d_date_sk\n  JOIN filtered_store ON store_sales.ss_store_sk = filtered_store.s_store_sk\n  JOIN filtered_hd ON store_sales.ss_hdemo_sk = filtered_hd.hd_demo_sk\n  GROUP BY ss_ticket_number, ss_customer_sk\n)\nSELECT\n  c_last_name,\n  c_first_name,\n  c_salutation,\n  c_preferred_cust_flag,\n  ss_ticket_number,\n  cnt\nFROM aggregated_sales\nJOIN customer ON aggregated_sales.ss_customer_sk = customer.c_customer_sk\nWHERE cnt BETWEEN 15 AND 20\nORDER BY\n  c_last_name,\n  c_first_name,\n  c_salutation,\n  c_preferred_cust_flag DESC,\n  ss_ticket_number\n```\n\nChanges: Pre-filtered all three dimension tables (date_dim, store, household_demographics) into separate CTEs before joining with the fact table, applying all dimension-specific filters early. Also converted implicit joins to explicit JOIN syntax for better optimization.\n\nExpected speedup: ~1.5-2x due to reduced fact table probing and early dimension reduction.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 2,
          "iteration": 0,
          "strategy": "moderate_dimension_prefilter"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_prefilter",
            "speedup": 1.0305697881655567,
            "original_ms": 357.1345626666395,
            "optimized_ms": 346.5408813335671,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_fact_prefetch",
            "speedup": 1.0145840010630915,
            "original_ms": 357.1345626666395,
            "optimized_ms": 352.00098000010865,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filter",
            "speedup": 1.0082316257928998,
            "original_ms": 357.1345626666395,
            "optimized_ms": 354.2187663333607,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_or_transformation",
            "speedup": 0.9978222655240533,
            "original_ms": 357.1345626666395,
            "optimized_ms": 357.9140043333003,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.9027980275534887,
            "original_ms": 335.30255366652756,
            "optimized_ms": 371.4037286669433,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.4704324989111194,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.32631091656951805,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "or_to_union"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.29,
            "original_ms": 539.91,
            "optimized_ms": 1844.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0,
            "original_ms": 356.4495863332316,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "date_cte_isolate",
              "multi_dimension_prefetch",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q35": {
        "query_id": "q35",
        "status": "WIN",
        "best_speedup": 2.3619,
        "original_ms": 734.71,
        "optimized_ms": 311.07,
        "original_sql": "-- start query 35 in stream 0 using template query35.tpl\nselect  \n  ca_state,\n  cd_gender,\n  cd_marital_status,\n  cd_dep_count,\n  count(*) cnt1,\n  max(cd_dep_count),\n  sum(cd_dep_count),\n  max(cd_dep_count),\n  cd_dep_employed_count,\n  count(*) cnt2,\n  max(cd_dep_employed_count),\n  sum(cd_dep_employed_count),\n  max(cd_dep_employed_count),\n  cd_dep_college_count,\n  count(*) cnt3,\n  max(cd_dep_college_count),\n  sum(cd_dep_college_count),\n  max(cd_dep_college_count)\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  cd_demo_sk = c.c_current_cdemo_sk and \n  exists (select *\n          from store_sales,date_dim\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 2001 and\n                d_qoy < 4) and\n   (exists (select *\n            from web_sales,date_dim\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 2001 and\n                  d_qoy < 4) or \n    exists (select * \n            from catalog_sales,date_dim\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 2001 and\n                  d_qoy < 4))\n group by ca_state,\n          cd_gender,\n          cd_marital_status,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\n order by ca_state,\n          cd_gender,\n          cd_marital_status,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\n LIMIT 100;\n\n-- end query 35 in stream 0 using template query35.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 2001\n      AND d_qoy < 4\n),\nstore_customers AS (\n    SELECT DISTINCT ss_customer_sk\n    FROM store_sales\n    JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk\n),\nweb_customers AS (\n    SELECT DISTINCT ws_bill_customer_sk\n    FROM web_sales\n    JOIN filtered_dates ON web_sales.ws_sold_date_sk = filtered_dates.d_date_sk\n),\ncatalog_customers AS (\n    SELECT DISTINCT cs_ship_customer_sk\n    FROM catalog_sales\n    JOIN filtered_dates ON catalog_sales.cs_sold_date_sk = filtered_dates.d_date_sk\n),\nmulti_channel_customers AS (\n    SELECT ss_customer_sk AS customer_sk\n    FROM store_customers\n    INTERSECT\n    (\n        SELECT ws_bill_customer_sk AS customer_sk\n        FROM web_customers\n        UNION\n        SELECT cs_ship_customer_sk AS customer_sk\n        FROM catalog_customers\n    )\n)\nSELECT\n  ca_state,\n  cd_gender,\n  cd_marital_status,\n  cd_dep_count,\n  COUNT(*) AS cnt1,\n  MAX(cd_dep_count) AS \"MAX(cd_dep_count)\",\n  SUM(cd_dep_count) AS \"SUM(cd_dep_count)\",\n  MAX(cd_dep_count) AS \"MAX(cd_dep_count)\",\n  cd_dep_employed_count,\n  COUNT(*) AS cnt2,\n  MAX(cd_dep_employed_count) AS \"MAX(cd_dep_employed_count)\",\n  SUM(cd_dep_employed_count) AS \"SUM(cd_dep_employed_count)\",\n  MAX(cd_dep_employed_count) AS \"MAX(cd_dep_employed_count)\",\n  cd_dep_college_count,\n  COUNT(*) AS cnt3,\n  MAX(cd_dep_college_count) AS \"MAX(cd_dep_college_count)\",\n  SUM(cd_dep_college_count) AS \"SUM(cd_dep_college_count)\",\n  MAX(cd_dep_college_count) AS \"MAX(cd_dep_college_count)\"\nFROM customer AS c\nJOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk\nJOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk\nJOIN multi_channel_customers mcc ON c.c_customer_sk = mcc.customer_sk\nGROUP BY\n  ca_state,\n  cd_gender,\n  cd_marital_status,\n  cd_dep_count,\n  cd_dep_employed_count,\n  cd_dep_college_count\nORDER BY\n  ca_state,\n  cd_gender,\n  cd_marital_status,\n  cd_dep_count,\n  cd_dep_employed_count,\n  cd_dep_college_count\nLIMIT 100",
        "transforms": [
          "prefetch_fact_join",
          "single_pass_aggregation",
          "or_to_union",
          "date_cte_isolate"
        ],
        "principle": "prefetch_fact_join",
        "changes_description": "Decorrelated EXISTS subqueries by creating CTEs for filtered dates and each sales channel, then used INTERSECT and UNION to enforce the complex existence logic before joining with customer dimensions.",
        "reasoning": "```sql\nWITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 2001\n      AND d_qoy < 4\n),\nstore_customers AS (\n    SELECT DISTINCT ss_customer_sk\n    FROM store_sales\n    JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk\n),\nweb_customers AS (\n    SELECT DISTINCT ws_bill_customer_sk\n    FROM web_sales\n    JOIN filtered_dates ON web_sales.ws_sold_date_sk = filtered_dates.d_date_sk\n),\ncatalog_customers AS (\n    SELECT DISTINCT cs_ship_customer_sk\n    FROM catalog_sales\n    JOIN filtered_dates ON catalog_sales.cs_sold_date_sk = filtered_dates.d_date_sk\n),\nmulti_channel_customers AS (\n    SELECT ss_customer_sk AS customer_sk\n    FROM store_customers\n    INTERSECT\n    (\n        SELECT ws_bill_customer_sk AS customer_sk\n        FROM web_customers\n        UNION\n        SELECT cs_ship_customer_sk AS customer_sk\n        FROM catalog_customers\n    )\n)\nSELECT\n  ca_state,\n  cd_gender,\n  cd_marital_status,\n  cd_dep_count,\n  COUNT(*) AS cnt1,\n  MAX(cd_dep_count) AS \"MAX(cd_dep_count)\",\n  SUM(cd_dep_count) AS \"SUM(cd_dep_count)\",\n  MAX(cd_dep_count) AS \"MAX(cd_dep_count)\",\n  cd_dep_employed_count,\n  COUNT(*) AS cnt2,\n  MAX(cd_dep_employed_count) AS \"MAX(cd_dep_employed_count)\",\n  SUM(cd_dep_employed_count) AS \"SUM(cd_dep_employed_count)\",\n  MAX(cd_dep_employed_count) AS \"MAX(cd_dep_employed_count)\",\n  cd_dep_college_count,\n  COUNT(*) AS cnt3,\n  MAX(cd_dep_college_count) AS \"MAX(cd_dep_college_count)\",\n  SUM(cd_dep_college_count) AS \"SUM(cd_dep_college_count)\",\n  MAX(cd_dep_college_count) AS \"MAX(cd_dep_college_count)\"\nFROM customer AS c\nJOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk\nJOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk\nJOIN multi_channel_customers mcc ON c.c_customer_sk = mcc.customer_sk\nGROUP BY\n  ca_state,\n  cd_gender,\n  cd_marital_status,\n  cd_dep_count,\n  cd_dep_employed_count,\n  cd_dep_college_count\nORDER BY\n  ca_state,\n  cd_gender,\n  cd_marital_status,\n  cd_dep_count,\n  cd_dep_employed_count,\n  cd_dep_college_count\nLIMIT 100\n```\n\nChanges: Decorrelated EXISTS subqueries by creating CTEs for filtered dates and each sales channel, then used INTERSECT and UNION to enforce the complex existence logic before joining with customer dimensions.\n\nExpected speedup: 2.5-4x by eliminating correlated subqueries and enabling join-order optimization.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": "aggressive_decorrelate_prefetch"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_decorrelate_prefetch",
            "speedup": 2.361866531556997,
            "original_ms": 734.7121336664108,
            "optimized_ms": 311.07267233346647,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.51,
            "original_ms": 1147.51,
            "optimized_ms": 760.74,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_or_transform",
            "speedup": 1.1421064087031998,
            "original_ms": 734.7121336664108,
            "optimized_ms": 643.2956929999515,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_pushdown",
            "speedup": 1.0718453764205873,
            "original_ms": 734.7121336664108,
            "optimized_ms": 685.4646666667273,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_date_dimension_isolation",
            "speedup": 1.0710466922175685,
            "original_ms": 734.7121336664108,
            "optimized_ms": 685.9758206668024,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q36": {
        "query_id": "q36",
        "status": "WIN",
        "best_speedup": 2.4685,
        "original_ms": 879.23,
        "optimized_ms": 356.18,
        "original_sql": "-- start query 36 in stream 0 using template query36.tpl\nselect \n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,grouping(i_category)+grouping(i_class) as lochierarchy\n   ,rank() over (\n \tpartition by grouping(i_category)+grouping(i_class),\n \tcase when grouping(i_class) = 0 then i_category end \n \torder by sum(ss_net_profit)/sum(ss_ext_sales_price) asc) as rank_within_parent\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n and d1.d_date_sk = ss_sold_date_sk\n and i_item_sk  = ss_item_sk \n and s_store_sk  = ss_store_sk\n and s_state in ('SD','TN','GA','SC',\n                 'MO','AL','MI','OH')\n group by rollup(i_category,i_class)\n order by\n   lochierarchy desc\n  ,case when lochierarchy = 0 then i_category end\n  ,rank_within_parent\n LIMIT 100;\n\n-- end query 36 in stream 0 using template query36.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 2002\n),\nfiltered_stores AS (\n    SELECT s_store_sk\n    FROM store\n    WHERE s_state IN ('SD', 'TN', 'GA', 'SC', 'MO', 'AL', 'MI', 'OH')\n),\nitem_sums AS (\n    SELECT\n        ss_item_sk,\n        SUM(ss_net_profit) AS net_profit,\n        SUM(ss_ext_sales_price) AS sales_price\n    FROM store_sales\n    JOIN filtered_dates ON ss_sold_date_sk = filtered_dates.d_date_sk\n    JOIN filtered_stores ON ss_store_sk = filtered_stores.s_store_sk\n    GROUP BY ss_item_sk\n),\nitem_aggregates AS (\n    SELECT\n        i.i_category,\n        i.i_class,\n        SUM(item_sums.net_profit) AS net_profit,\n        SUM(item_sums.sales_price) AS sales_price\n    FROM item_sums\n    JOIN item i ON item_sums.ss_item_sk = i.i_item_sk\n    GROUP BY i.i_category, i.i_class\n),\ndetailed AS (\n    SELECT\n        net_profit / sales_price AS gross_margin,\n        i_category,\n        i_class,\n        0 AS lochierarchy\n    FROM item_aggregates\n    WHERE sales_price <> 0\n),\ncategory_summary AS (\n    SELECT\n        SUM(net_profit) / SUM(sales_price) AS gross_margin,\n        i_category,\n        NULL AS i_class,\n        1 AS lochierarchy\n    FROM item_aggregates\n    WHERE sales_price <> 0\n    GROUP BY i_category\n),\ngrand_total AS (\n    SELECT\n        SUM(net_profit) / SUM(sales_price) AS gross_margin,\n        NULL AS i_category,\n        NULL AS i_class,\n        2 AS lochierarchy\n    FROM item_aggregates\n    WHERE sales_price <> 0\n),\nall_levels AS (\n    SELECT * FROM detailed\n    UNION ALL\n    SELECT * FROM category_summary\n    UNION ALL\n    SELECT * FROM grand_total\n),\nranked AS (\n    SELECT\n        gross_margin,\n        i_category,\n        i_class,\n        lochierarchy,\n        CASE\n            WHEN lochierarchy < 2 THEN\n                RANK() OVER (\n                    PARTITION BY lochierarchy,\n                                 CASE WHEN lochierarchy = 0 THEN i_category END\n                    ORDER BY gross_margin ASC\n                )\n            ELSE 1\n        END AS rank_within_parent\n    FROM all_levels\n)\nSELECT\n    gross_margin,\n    i_category,\n    i_class,\n    lochierarchy,\n    rank_within_parent\nFROM ranked\nORDER BY\n    lochierarchy DESC,\n    CASE WHEN lochierarchy = 0 THEN i_category END,\n    rank_within_parent\nLIMIT 100",
        "transforms": [
          "date_cte_isolate",
          "multi_dimension_prefetch"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```sql\nWITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 2002\n),\nfiltered_stores AS (\n    SELECT s_store_sk\n    FROM store\n    WHERE s_state IN ('SD', 'TN', 'GA', 'SC', 'MO', 'AL', 'MI', 'OH')\n),\nitem_sums AS (\n    SELECT\n        ss_item_sk,\n        SUM(ss_net_profit) AS net_profit,\n        SUM(ss_ext_sales_price) AS sales_price\n    FROM store_sales\n    JOIN filtered_dates ON ss_sold_date_sk = filtered_dates.d_date_sk\n    JOIN filtered_stores ON ss_store_sk = filtered_stores.s_store_sk\n    GROUP BY ss_item_sk\n),\nitem_aggregates AS (\n    SELECT\n        i.i_category,\n        i.i_class,\n        SUM(item_sums.net_profit) AS net_profit,\n        SUM(item_sums.sales_price) AS sales_price\n    FROM item_sums\n    JOIN item i ON item_sums.ss_item_sk = i.i_item_sk\n    GROUP BY i.i_category, i.i_class\n),\ndetailed AS (\n    SELECT\n        net_profit / sales_price AS gross_margin,\n        i_category,\n        i_class,\n        0 AS lochierarchy\n    FROM item_aggregates\n    WHERE sales_price <> 0\n),\ncategory_summary AS (\n    SELECT\n        SUM(net_profit) / SUM(sales_price) AS gross_margin,\n        i_category,\n        NULL AS i_class,\n        1 AS lochierarchy\n    FROM item_aggregates\n    WHERE sales_price <> 0\n    GROUP BY i_category\n),\ngrand_total AS (\n    SELECT\n        SUM(net_profit) / SUM(sales_price) AS gross_margin,\n        NULL AS i_category,\n        NULL AS i_class,\n        2 AS lochierarchy\n    FROM item_aggregates\n    WHERE sales_price <> 0\n),\nall_levels AS (\n    SELECT * FROM detailed\n    UNION ALL\n    SELECT * FROM category_summary\n    UNION ALL\n    SELECT * FROM grand_total\n),\nranked AS (\n    SELECT\n        gross_margin,\n        i_category,\n        i_class,\n        lochierarchy,\n        CASE\n            WHEN lochierarchy < 2 THEN\n                RANK() OVER (\n                    PARTITION BY lochierarchy,\n                                 CASE WHEN lochierarchy = 0 THEN i_category END\n                    ORDER BY gross_margin ASC\n                )\n            ELSE 1\n        END AS rank_within_parent\n    FROM all_levels\n)\nSELECT\n    gross_margin,\n    i_category,\n    i_class,\n    lochierarchy,\n    rank_within_parent\nFROM ranked\nORDER BY\n    lochierarchy DESC,\n    CASE WHEN lochierarchy = 0 THEN i_category END,\n    rank_within_parent\nLIMIT 100\n```\n\n**Changes**: \n1. Pre-filtered date_dim and store into small CTEs using only surrogate keys.\n2. Aggregated store_sales at item level first (reducing fact rows before joining with item).\n3. Replaced ROLLUP with explicit UNION ALL for three grouping levels.\n4. Computed window ranking only on the first two levels (detail and category summary), avoiding window function overhead on grand total.\n\n**Expected speedup**: 1.5-2x from reduced fact table scans and elimination of redundant window computations.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 6,
          "iteration": 2,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 2.4685052157379332,
            "original_ms": 879.2310440003348,
            "optimized_ms": 356.17953666648344,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 2.2278787430223232,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.7357496133091628,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.555741636653914,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "single_pass_aggregation",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.0544677206082265,
            "original_ms": 928.2078579999506,
            "optimized_ms": 880.2619936668634,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_predicate_pushdown",
            "speedup": 0.9922714372365704,
            "original_ms": 866.7331919999318,
            "optimized_ms": 873.483967666895,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.987327566251182,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0.9869592186439876,
            "original_ms": 866.7331919999318,
            "optimized_ms": 878.185416000027,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "materialize_cte"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.96,
            "original_ms": 896.61,
            "optimized_ms": 932.73,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 0.9575300428020784,
            "original_ms": 866.7331919999318,
            "optimized_ms": 905.1759769996958,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.42718345987060785,
            "original_ms": 866.7331919999318,
            "optimized_ms": 2028.9483873333058,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "union_cte_split"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q37": {
        "query_id": "q37",
        "status": "WIN",
        "best_speedup": 1.3,
        "original_ms": 124.4,
        "optimized_ms": 95.69,
        "original_sql": "SELECT i_item_id,\n       i_item_desc,\n       i_current_price\nFROM item,\n     inventory,\n     date_dim,\n     catalog_sales\nWHERE i_current_price BETWEEN 68 AND 68 + 30\n  AND inv_item_sk = i_item_sk\n  AND d_date_sk=inv_date_sk\n  AND d_date BETWEEN cast('2000-02-01' AS date) AND cast('2000-04-01' AS date)\n  AND i_manufact_id IN (677,\n                        940,\n                        694,\n                        808)\n  AND inv_quantity_on_hand BETWEEN 100 AND 500\n  AND cs_item_sk = i_item_sk\nGROUP BY i_item_id,\n         i_item_desc,\n         i_current_price\nORDER BY i_item_id\nLIMIT 100;\n\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('2000-02-01' AS DATE) AND CAST('2000-04-01' AS DATE)), filtered_items AS (SELECT i_item_sk, i_item_id, i_item_desc, i_current_price FROM item WHERE i_current_price BETWEEN 68 AND 68 + 30 AND i_manufact_id IN (677, 940, 694, 808)), qualified_inventory AS (SELECT inv_item_sk FROM inventory JOIN filtered_dates ON inv_date_sk = d_date_sk WHERE inv_quantity_on_hand BETWEEN 100 AND 500)\nSELECT i_item_id, i_item_desc, i_current_price FROM filtered_items AS fi JOIN qualified_inventory AS qi ON fi.i_item_sk = qi.inv_item_sk WHERE EXISTS(SELECT 1 FROM catalog_sales AS cs WHERE cs.cs_item_sk = fi.i_item_sk) GROUP BY i_item_id, i_item_desc, i_current_price ORDER BY i_item_id LIMIT 100",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('2000-02-01' AS DATE) AND CAST('2000-04-01' AS DATE)\",\n        \"filtered_items\": \"SELECT i_item_sk, i_item_id, i_item_desc, i_current_price FROM item WHERE i_current_price BETWEEN 68 AND 68 + 30 AND i_manufact_id IN (677, 940, 694, 808)\",\n        \"qualified_inventory\": \"SELECT inv_item_sk FROM inventory JOIN filtered_dates ON inv_date_sk = d_date_sk WHERE inv_quantity_on_hand BETWEEN 100 AND 500\",\n        \"main_query\": \"SELECT i_item_id, i_item_desc, i_current_price FROM filtered_items fi JOIN qualified_inventory qi ON fi.i_item_sk = qi.inv_item_sk WHERE EXISTS (SELECT 1 FROM catalog_sales cs WHERE cs.cs_item_sk = fi.i_item_sk) GROUP BY i_item_id, i_item_desc, i_current_price ORDER BY i_item_id LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\",\n        \"same grouping and aggregation\"\n      ],\n      \"expected_speedup\": \"2.5x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Isolated date_dim filter into CTE to reduce early join cardinality. Created filtered_items CTE to push price/manufacturer filters early. Combined inventory joins into single CTE with date filter applied. Used EXISTS instead of full join for catalog_sales since only existence matters (no columns needed). This reduces row multiplication before grouping.\"\n}\n```",
        "provenance": {
          "source": "Retry3W",
          "run": "retry_3worker_20260205_235909_details",
          "model": "deepseek-reasoner",
          "worker_id": 2,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 10.635274085511984,
            "original_ms": 101.2287473337589,
            "optimized_ms": 9.518207666284676,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.16,
            "original_ms": 124.4,
            "optimized_ms": 106.96,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_earlyfilter",
            "speedup": 1.1340154958553943,
            "original_ms": 87.50988166654376,
            "optimized_ms": 77.16815333333216,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.102811023014969,
            "original_ms": 87.50988166654376,
            "optimized_ms": 79.35165666670703,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 1.0417337897279186,
            "original_ms": 87.50988166654376,
            "optimized_ms": 84.0040733337446,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation",
              "materialize_cte"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.039797914251601,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.9312877399730467,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0.9127926277854175,
            "original_ms": 87.50988166654376,
            "optimized_ms": 95.8704956665315,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8385998512584415,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.02005576119057537,
            "original_ms": 83.18501299921384,
            "optimized_ms": 4147.68665266638,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q38": {
        "query_id": "q38",
        "status": "WIN",
        "best_speedup": 1.44,
        "original_ms": 1598.84,
        "optimized_ms": 1110.31,
        "original_sql": "SELECT count(*)\nFROM\n  (SELECT DISTINCT c_last_name,\n                   c_first_name,\n                   d_date\n   FROM store_sales,\n        date_dim,\n        customer\n   WHERE store_sales.ss_sold_date_sk = date_dim.d_date_sk\n     AND store_sales.ss_customer_sk = customer.c_customer_sk\n     AND d_month_seq BETWEEN 1200 AND 1200 + 11 INTERSECT\n     SELECT DISTINCT c_last_name,\n                     c_first_name,\n                     d_date\n     FROM catalog_sales,\n          date_dim,\n          customer WHERE catalog_sales.cs_sold_date_sk = date_dim.d_date_sk\n     AND catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n     AND d_month_seq BETWEEN 1200 AND 1200 + 11 INTERSECT\n     SELECT DISTINCT c_last_name,\n                     c_first_name,\n                     d_date\n     FROM web_sales,\n          date_dim,\n          customer WHERE web_sales.ws_sold_date_sk = date_dim.d_date_sk\n     AND web_sales.ws_bill_customer_sk = customer.c_customer_sk\n     AND d_month_seq BETWEEN 1200 AND 1200 + 11 ) hot_cust\nLIMIT 100;\n\n",
        "optimized_sql": "WITH date_filter AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq BETWEEN 1200 AND 1200 + 11)\nSELECT COUNT(*) FROM (SELECT DISTINCT c_last_name, c_first_name, d_date FROM web_sales, date_filter, customer WHERE web_sales.ws_sold_date_sk = date_filter.d_date_sk AND web_sales.ws_bill_customer_sk = customer.c_customer_sk AND EXISTS(SELECT 1 FROM store_sales, date_filter AS sf, customer AS sc WHERE store_sales.ss_sold_date_sk = sf.d_date_sk AND store_sales.ss_customer_sk = sc.c_customer_sk AND sc.c_last_name = customer.c_last_name AND sc.c_first_name = customer.c_first_name AND sf.d_date = date_filter.d_date) AND EXISTS(SELECT 1 FROM catalog_sales, date_filter AS cf, customer AS cc WHERE catalog_sales.cs_sold_date_sk = cf.d_date_sk AND catalog_sales.cs_bill_customer_sk = cc.c_customer_sk AND cc.c_last_name = customer.c_last_name AND cc.c_first_name = customer.c_first_name AND cf.d_date = date_filter.d_date)) AS hot_cust LIMIT 100",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "Looking at this query, I can see it's performing an INTERSECT of three similar subqueries from different sales channels, then counting the distinct tuples. The current plan shows massive overestimations (2380x!) for hash group-by operations, likely because the optimizer can't handle INTERSECT well.\n\nThe key insight: INTERSECT requires materializing and deduplicating all three result sets before computing intersections, which is very expensive. We can convert this to a more efficient EXISTS-based approach that allows the optimizer to use semi-joins and stop early.\n\n```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"intersect_to_exists\",\n      \"nodes\": {\n        \"date_filter\": \"SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq BETWEEN 1200 AND 1200 + 11\",\n        \"main_query\": \"SELECT COUNT(*) FROM (SELECT DISTINCT c_last_name, c_first_name, d_date FROM web_sales, date_filter, customer WHERE web_sales.ws_sold_date_sk = date_filter.d_date_sk AND web_sales.ws_bill_customer_sk = customer.c_customer_sk AND EXISTS (SELECT 1 FROM store_sales, date_filter sf, customer sc WHERE store_sales.ss_sold_date_sk = sf.d_date_sk AND store_sales.ss_customer_sk = sc.c_customer_sk AND sc.c_last_name = customer.c_last_name AND sc.c_first_name = customer.c_first_name AND sf.d_date = date_filter.d_date) AND EXISTS (SELECT 1 FROM catalog_sales, date_filter cf, customer cc WHERE catalog_sales.cs_sold_date_sk = cf.d_date_sk AND catalog_sales.cs_bill_customer_sk = cc.c_customer_sk AND cc.c_last_name = customer.c_last_name AND cc.c_first_name = customer.c_first_name AND cf.d_date = date_filter.d_date)) AS hot_cust LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"output columns unchanged\",\n        \"same result rows (intersection of three sets)\",\n        \"same grouping and ordering (none in this case)\"\n      ],\n      \"expected_speedup\": \"2.2x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Converted INTERSECT to EXISTS pattern to avoid materializing and sorting all three result sets. The date filter is isolated into a CTE for reuse across all branches. The query now starts from web_sales (smallest table based on cost) and uses EXISTS to check for matching rows in store_sales and catalog_sales. This allows the optimizer to use efficient semi-join strategies and potentially stop early when matches are found, rather than computing complete distinct sets before intersecting.\"\n}\n```\n\n**Alternative more aggressive rewrite for additional speedup:**\n\n```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_02\",\n      \"transform\": \"flatten_subquery\",\n      \"nodes\": {\n        \"date_filter\": \"SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq BETWEEN 1200 AND 1200 + 11\",\n        \"main_query\": \"SELECT COUNT(*) FROM (SELECT DISTINCT c_last_name, c_first_name, d_date FROM (SELECT customer.c_last_name, customer.c_first_name, date_filter.d_date FROM web_sales JOIN date_filter ON web_sales.ws_sold_date_sk = date_filter.d_date_sk JOIN customer ON web_sales.ws_bill_customer_sk = customer.c_customer_sk INTERSECT SELECT customer.c_last_name, customer.c_first_name, date_filter.d_date FROM store_sales JOIN date_filter ON store_sales.ss_sold_date_sk = date_filter.d_date_sk JOIN customer ON store_sales.ss_customer_sk = customer.c_customer_sk INTERSECT SELECT customer.c_last_name, customer.c_first_name, date_filter.d_date FROM catalog_sales JOIN date_filter ON catalog_sales.cs_sold_date_sk = date_filter.d_date_sk JOIN customer ON catalog_sales.cs_bill_customer_sk = customer.c_customer_sk) AS combined) AS hot_cust LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"output columns unchanged\",\n        \"same result rows\",\n        \"maintains INTERSECT semantics\"\n      ],\n      \"expected_speedup\": \"1.5x\",\n      \"risk\": \"medium\"\n    }\n  ],\n  \"explanation\": \"Flattened the subqueries by extracting the date filter into a CTE and removing the redundant DISTINCT in each branch (INTERSECT already implies distinct). This reduces the number of operations by removing unnecessary DISTINCT operations and reusing the date filter. However, this is less aggressive than the EXISTS rewrite and may not achieve as much speedup.\"\n}\n```\n\nThe first rewrite (rs_01) is preferred because:\n1. It eliminates the expensive INTERSECT operations entirely\n2. It allows the optimizer to use more efficient join strategies (semi-joins)\n3. It can stop processing each row as soon as matches are found in the other tables\n4. The date CTE isolation prevents redundant filtering of date_dim\n\nThe massive misestimates in the current plan (up to 2380x) suggest the optimizer is struggling with the INTERSECT cardinality estimation, which the EXISTS rewrite should help with.",
        "provenance": {
          "source": "Retry3W",
          "run": "retry_3worker_20260205_235909_details",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.4301197404500123,
            "original_ms": 918.2997573340496,
            "optimized_ms": 642.1138953337504,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.130277064607968,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0449846118339456,
            "original_ms": 908.5159510001782,
            "optimized_ms": 869.4060569999541,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filter",
            "speedup": 1.0213719460949438,
            "original_ms": 908.5159510001782,
            "optimized_ms": 889.5054876666109,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.99,
            "original_ms": 1598.84,
            "optimized_ms": 1617.31,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 0.9783071040937216,
            "original_ms": 908.5159510001782,
            "optimized_ms": 928.6613040000399,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch",
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.9709749520780357,
            "original_ms": 950.2765683331139,
            "optimized_ms": 978.6828859996604,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_intersect_transform",
            "speedup": 0.9100556729798698,
            "original_ms": 908.5159510001782,
            "optimized_ms": 998.3081013333504,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "intersect_to_exists",
              "or_to_union"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8578809581131788,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.7203193345708925,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q39": {
        "query_id": "q39",
        "status": "WIN",
        "best_speedup": 2.02,
        "original_ms": 452.21,
        "optimized_ms": 223.87,
        "original_sql": "WITH inv AS\n  (SELECT w_warehouse_name,\n          w_warehouse_sk,\n          i_item_sk,\n          d_moy,\n          stdev,\n          mean,\n          CASE mean\n              WHEN 0 THEN NULL\n              ELSE stdev/mean\n          END cov\n   FROM\n     (SELECT w_warehouse_name,\n             w_warehouse_sk,\n             i_item_sk,\n             d_moy,\n             stddev_samp(inv_quantity_on_hand)*1.000 stdev,\n             avg(inv_quantity_on_hand) mean\n      FROM inventory,\n           item,\n           warehouse,\n           date_dim\n      WHERE inv_item_sk = i_item_sk\n        AND inv_warehouse_sk = w_warehouse_sk\n        AND inv_date_sk = d_date_sk\n        AND d_year =2001\n      GROUP BY w_warehouse_name,\n               w_warehouse_sk,\n               i_item_sk,\n               d_moy) foo\n   WHERE CASE mean\n             WHEN 0 THEN 0\n             ELSE stdev/mean\n         END > 1)\nSELECT inv1.w_warehouse_sk wsk1,\n       inv1.i_item_sk isk1,\n       inv1.d_moy dmoy1,\n       inv1.mean mean1,\n       inv1.cov cov1,\n       inv2.w_warehouse_sk,\n       inv2.i_item_sk,\n       inv2.d_moy,\n       inv2.mean,\n       inv2.cov\nFROM inv inv1,\n     inv inv2\nWHERE inv1.i_item_sk = inv2.i_item_sk\n  AND inv1.w_warehouse_sk = inv2.w_warehouse_sk\n  AND inv1.d_moy=1\n  AND inv2.d_moy=1+1\nORDER BY inv1.w_warehouse_sk NULLS FIRST,\n         inv1.i_item_sk NULLS FIRST,\n         inv1.d_moy NULLS FIRST,\n         inv1.mean NULLS FIRST,\n         inv1.cov NULLS FIRST,\n         inv2.d_moy NULLS FIRST,\n         inv2.mean NULLS FIRST,\n         inv2.cov NULLS FIRST;\n\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_moy FROM date_dim WHERE d_year = 2001 AND d_moy IN (1, 2)), inv AS (SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, STDDEV_SAMP(inv_quantity_on_hand) * 1.000 AS stdev, AVG(inv_quantity_on_hand) AS mean, CASE WHEN AVG(inv_quantity_on_hand) = 0 THEN NULL ELSE STDDEV_SAMP(inv_quantity_on_hand) * 1.000 / AVG(inv_quantity_on_hand) END AS cov FROM inventory JOIN filtered_dates ON inv_date_sk = d_date_sk JOIN item ON inv_item_sk = i_item_sk JOIN warehouse ON inv_warehouse_sk = w_warehouse_sk GROUP BY w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy HAVING CASE WHEN AVG(inv_quantity_on_hand) = 0 THEN 0 ELSE STDDEV_SAMP(inv_quantity_on_hand) * 1.000 / AVG(inv_quantity_on_hand) END > 1)\nSELECT inv1.w_warehouse_sk AS wsk1, inv1.i_item_sk AS isk1, inv1.d_moy AS dmoy1, inv1.mean AS mean1, inv1.cov AS cov1, inv2.w_warehouse_sk, inv2.i_item_sk, inv2.d_moy, inv2.mean, inv2.cov FROM inv AS inv1, inv AS inv2 WHERE inv1.i_item_sk = inv2.i_item_sk AND inv1.w_warehouse_sk = inv2.w_warehouse_sk AND inv1.d_moy = 1 AND inv2.d_moy = 1 + 1 ORDER BY inv1.w_warehouse_sk NULLS FIRST, inv1.i_item_sk NULLS FIRST, inv1.d_moy NULLS FIRST, inv1.mean NULLS FIRST, inv1.cov NULLS FIRST, inv2.d_moy NULLS FIRST, inv2.mean NULLS FIRST, inv2.cov NULLS FIRST",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk, d_moy FROM date_dim WHERE d_year = 2001 AND d_moy IN (1, 2)\",\n        \"inv\": \"SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, STDDEV_SAMP(inv_quantity_on_hand) * 1.000 AS stdev, AVG(inv_quantity_on_hand) AS mean, CASE WHEN AVG(inv_quantity_on_hand) = 0 THEN NULL ELSE STDDEV_SAMP(inv_quantity_on_hand) * 1.000 / AVG(inv_quantity_on_hand) END AS cov FROM inventory JOIN filtered_dates ON inv_date_sk = d_date_sk JOIN item ON inv_item_sk = i_item_sk JOIN warehouse ON inv_warehouse_sk = w_warehouse_sk GROUP BY w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy HAVING CASE WHEN AVG(inv_quantity_on_hand) = 0 THEN 0 ELSE STDDEV_SAMP(inv_quantity_on_hand) * 1.000 / AVG(inv_quantity_on_hand) END > 1\"\n      },\n      \"invariants_kept\": [\n        \"same output columns\",\n        \"same grain (w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy)\",\n        \"same filtering condition (cov > 1)\",\n        \"same aggregation semantics\"\n      ],\n      \"expected_speedup\": \"10x\",\n      \"risk\": \"low\"\n    },\n    {\n      \"id\": \"rs_02\",\n      \"transform\": \"pushdown\",\n      \"nodes\": {\n        \"main_query\": \"SELECT inv1.w_warehouse_sk AS wsk1, inv1.i_item_sk AS isk1, inv1.d_moy AS dmoy1, inv1.mean AS mean1, inv1.cov AS cov1, inv2.w_warehouse_sk, inv2.i_item_sk, inv2.d_moy, inv2.mean, inv2.cov FROM inv inv1 JOIN inv inv2 ON inv1.i_item_sk = inv2.i_item_sk AND inv1.w_warehouse_sk = inv2.w_warehouse_sk AND inv1.d_moy = 1 AND inv2.d_moy = 2 ORDER BY inv1.w_warehouse_sk NULLS FIRST, inv1.i_item_sk NULLS FIRST, inv1.d_moy NULLS FIRST, inv1.mean NULLS FIRST, inv1.cov NULLS FIRST, inv2.d_moy NULLS FIRST, inv2.mean NULLS FIRST, inv2.cov NULLS FIRST\"\n      },\n      \"invariants_kept\": [\n        \"same join logic (inner join on i_item_sk and w_warehouse_sk)\",\n        \"same month filters (d_moy = 1 and d_moy = 2)\",\n        \"same output columns and ordering\"\n      ],\n      \"expected_speedup\": \"1.5x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Applied two transforms: 1) Date CTE Isolation to create a filtered_dates CTE containing only the required months (1 and 2) of year 2001, then joined this early with inventory to reduce the base data for aggregation by 12x (from 12 months to 2). 2) Pushdown of month filters into the JOIN condition of the main query, making the join conditions explicit and allowing better optimization. The cov filter was moved into HAVING clause to compute only once during aggregation.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 4,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 12.854769119397536,
            "original_ms": 3045.21694733315,
            "optimized_ms": 236.89394333329497,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 12.52038236901012,
            "original_ms": 3249.3282869994196,
            "optimized_ms": 259.5230873333397,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_filter_pushdown",
            "speedup": 11.05138773065223,
            "original_ms": 3045.21694733315,
            "optimized_ms": 275.5506386665729,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 8.787877150728429,
            "original_ms": 3045.21694733315,
            "optimized_ms": 346.5247516666447,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 8.7228795498517,
            "original_ms": 3045.21694733315,
            "optimized_ms": 349.1068436666562,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 2.4623945374262237,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 2.0202137333898675,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.2125932148721819,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.99,
            "original_ms": 452.21,
            "optimized_ms": 455.88,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.7776832286886657,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0,
            "original_ms": 3201.931671000542,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q4": {
        "query_id": "q4",
        "status": "WIN",
        "best_speedup": 2.91,
        "original_ms": 10208.82,
        "optimized_ms": 3508.19,
        "original_sql": "-- start query 4 in stream 0 using template query4.tpl\nwith year_total as (\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,c_preferred_cust_flag customer_preferred_cust_flag\n       ,c_birth_country customer_birth_country\n       ,c_login customer_login\n       ,c_email_address customer_email_address\n       ,d_year dyear\n       ,sum(((ss_ext_list_price-ss_ext_wholesale_cost-ss_ext_discount_amt)+ss_ext_sales_price)/2) year_total\n       ,'s' sale_type\n from customer\n     ,store_sales\n     ,date_dim\n where c_customer_sk = ss_customer_sk\n   and ss_sold_date_sk = d_date_sk\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,c_preferred_cust_flag\n         ,c_birth_country\n         ,c_login\n         ,c_email_address\n         ,d_year\n union all\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,c_preferred_cust_flag customer_preferred_cust_flag\n       ,c_birth_country customer_birth_country\n       ,c_login customer_login\n       ,c_email_address customer_email_address\n       ,d_year dyear\n       ,sum((((cs_ext_list_price-cs_ext_wholesale_cost-cs_ext_discount_amt)+cs_ext_sales_price)/2) ) year_total\n       ,'c' sale_type\n from customer\n     ,catalog_sales\n     ,date_dim\n where c_customer_sk = cs_bill_customer_sk\n   and cs_sold_date_sk = d_date_sk\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,c_preferred_cust_flag\n         ,c_birth_country\n         ,c_login\n         ,c_email_address\n         ,d_year\nunion all\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,c_preferred_cust_flag customer_preferred_cust_flag\n       ,c_birth_country customer_birth_country\n       ,c_login customer_login\n       ,c_email_address customer_email_address\n       ,d_year dyear\n       ,sum((((ws_ext_list_price-ws_ext_wholesale_cost-ws_ext_discount_amt)+ws_ext_sales_price)/2) ) year_total\n       ,'w' sale_type\n from customer\n     ,web_sales\n     ,date_dim\n where c_customer_sk = ws_bill_customer_sk\n   and ws_sold_date_sk = d_date_sk\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,c_preferred_cust_flag\n         ,c_birth_country\n         ,c_login\n         ,c_email_address\n         ,d_year\n         )\n  select \n                  t_s_secyear.customer_id\n                 ,t_s_secyear.customer_first_name\n                 ,t_s_secyear.customer_last_name\n                 ,t_s_secyear.customer_birth_country\n from year_total t_s_firstyear\n     ,year_total t_s_secyear\n     ,year_total t_c_firstyear\n     ,year_total t_c_secyear\n     ,year_total t_w_firstyear\n     ,year_total t_w_secyear\n where t_s_secyear.customer_id = t_s_firstyear.customer_id\n   and t_s_firstyear.customer_id = t_c_secyear.customer_id\n   and t_s_firstyear.customer_id = t_c_firstyear.customer_id\n   and t_s_firstyear.customer_id = t_w_firstyear.customer_id\n   and t_s_firstyear.customer_id = t_w_secyear.customer_id\n   and t_s_firstyear.sale_type = 's'\n   and t_c_firstyear.sale_type = 'c'\n   and t_w_firstyear.sale_type = 'w'\n   and t_s_secyear.sale_type = 's'\n   and t_c_secyear.sale_type = 'c'\n   and t_w_secyear.sale_type = 'w'\n   and t_s_firstyear.dyear =  1999\n   and t_s_secyear.dyear = 1999+1\n   and t_c_firstyear.dyear =  1999\n   and t_c_secyear.dyear =  1999+1\n   and t_w_firstyear.dyear = 1999\n   and t_w_secyear.dyear = 1999+1\n   and t_s_firstyear.year_total > 0\n   and t_c_firstyear.year_total > 0\n   and t_w_firstyear.year_total > 0\n   and case when t_c_firstyear.year_total > 0 then t_c_secyear.year_total / t_c_firstyear.year_total else null end\n           > case when t_s_firstyear.year_total > 0 then t_s_secyear.year_total / t_s_firstyear.year_total else null end\n   and case when t_c_firstyear.year_total > 0 then t_c_secyear.year_total / t_c_firstyear.year_total else null end\n           > case when t_w_firstyear.year_total > 0 then t_w_secyear.year_total / t_w_firstyear.year_total else null end\n order by t_s_secyear.customer_id\n         ,t_s_secyear.customer_first_name\n         ,t_s_secyear.customer_last_name\n         ,t_s_secyear.customer_birth_country\n LIMIT 100;\n\n-- end query 4 in stream 0 using template query4.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (\n  SELECT d_date_sk, d_year\n  FROM date_dim\n  WHERE d_year IN (1999, 2000)\n),\nstore_sales_agg AS (\n  SELECT\n    c.c_customer_id AS customer_id,\n    c.c_first_name AS customer_first_name,\n    c.c_last_name AS customer_last_name,\n    c.c_birth_country AS customer_birth_country,\n    SUM(CASE WHEN fd.d_year = 1999 THEN ((ss_ext_list_price - ss_ext_wholesale_cost - ss_ext_discount_amt) + ss_ext_sales_price) / 2 ELSE 0 END) AS store_1999,\n    SUM(CASE WHEN fd.d_year = 2000 THEN ((ss_ext_list_price - ss_ext_wholesale_cost - ss_ext_discount_amt) + ss_ext_sales_price) / 2 ELSE 0 END) AS store_2000\n  FROM customer c\n  JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk\n  JOIN filtered_dates fd ON ss.ss_sold_date_sk = fd.d_date_sk\n  GROUP BY\n    c.c_customer_id,\n    c.c_first_name,\n    c.c_last_name,\n    c.c_birth_country\n),\ncatalog_sales_agg AS (\n  SELECT\n    c.c_customer_id AS customer_id,\n    SUM(CASE WHEN fd.d_year = 1999 THEN ((cs_ext_list_price - cs_ext_wholesale_cost - cs_ext_discount_amt) + cs_ext_sales_price) / 2 ELSE 0 END) AS catalog_1999,\n    SUM(CASE WHEN fd.d_year = 2000 THEN ((cs_ext_list_price - cs_ext_wholesale_cost - cs_ext_discount_amt) + cs_ext_sales_price) / 2 ELSE 0 END) AS catalog_2000\n  FROM customer c\n  JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk\n  JOIN filtered_dates fd ON cs.cs_sold_date_sk = fd.d_date_sk\n  GROUP BY c.c_customer_id\n),\nweb_sales_agg AS (\n  SELECT\n    c.c_customer_id AS customer_id,\n    SUM(CASE WHEN fd.d_year = 1999 THEN ((ws_ext_list_price - ws_ext_wholesale_cost - ws_ext_discount_amt) + ws_ext_sales_price) / 2 ELSE 0 END) AS web_1999,\n    SUM(CASE WHEN fd.d_year = 2000 THEN ((ws_ext_list_price - ws_ext_wholesale_cost - ws_ext_discount_amt) + ws_ext_sales_price) / 2 ELSE 0 END) AS web_2000\n  FROM customer c\n  JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk\n  JOIN filtered_dates fd ON ws.ws_sold_date_sk = fd.d_date_sk\n  GROUP BY c.c_customer_id\n)\nSELECT\n  s.customer_id,\n  s.customer_first_name,\n  s.customer_last_name,\n  s.customer_birth_country\nFROM store_sales_agg s\nJOIN catalog_sales_agg c ON s.customer_id = c.customer_id\nJOIN web_sales_agg w ON s.customer_id = w.customer_id\nWHERE\n  s.store_1999 > 0\n  AND c.catalog_1999 > 0\n  AND w.web_1999 > 0\n  AND c.catalog_2000 / c.catalog_1999 > s.store_2000 / s.store_1999\n  AND c.catalog_2000 / c.catalog_1999 > w.web_2000 / w.web_1999\nORDER BY\n  s.customer_id,\n  s.customer_first_name,\n  s.customer_last_name,\n  s.customer_birth_country\nLIMIT 100",
        "transforms": [
          "single_pass_aggregation",
          "date_cte_isolate",
          "prefetch_fact_join"
        ],
        "principle": "single_pass_aggregation",
        "changes_description": null,
        "reasoning": "```sql\nWITH filtered_dates AS (\n  SELECT d_date_sk, d_year\n  FROM date_dim\n  WHERE d_year IN (1999, 2000)\n),\nstore_sales_agg AS (\n  SELECT\n    c.c_customer_id AS customer_id,\n    c.c_first_name AS customer_first_name,\n    c.c_last_name AS customer_last_name,\n    c.c_birth_country AS customer_birth_country,\n    SUM(CASE WHEN fd.d_year = 1999 THEN ((ss_ext_list_price - ss_ext_wholesale_cost - ss_ext_discount_amt) + ss_ext_sales_price) / 2 ELSE 0 END) AS store_1999,\n    SUM(CASE WHEN fd.d_year = 2000 THEN ((ss_ext_list_price - ss_ext_wholesale_cost - ss_ext_discount_amt) + ss_ext_sales_price) / 2 ELSE 0 END) AS store_2000\n  FROM customer c\n  JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk\n  JOIN filtered_dates fd ON ss.ss_sold_date_sk = fd.d_date_sk\n  GROUP BY\n    c.c_customer_id,\n    c.c_first_name,\n    c.c_last_name,\n    c.c_birth_country\n),\ncatalog_sales_agg AS (\n  SELECT\n    c.c_customer_id AS customer_id,\n    SUM(CASE WHEN fd.d_year = 1999 THEN ((cs_ext_list_price - cs_ext_wholesale_cost - cs_ext_discount_amt) + cs_ext_sales_price) / 2 ELSE 0 END) AS catalog_1999,\n    SUM(CASE WHEN fd.d_year = 2000 THEN ((cs_ext_list_price - cs_ext_wholesale_cost - cs_ext_discount_amt) + cs_ext_sales_price) / 2 ELSE 0 END) AS catalog_2000\n  FROM customer c\n  JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk\n  JOIN filtered_dates fd ON cs.cs_sold_date_sk = fd.d_date_sk\n  GROUP BY c.c_customer_id\n),\nweb_sales_agg AS (\n  SELECT\n    c.c_customer_id AS customer_id,\n    SUM(CASE WHEN fd.d_year = 1999 THEN ((ws_ext_list_price - ws_ext_wholesale_cost - ws_ext_discount_amt) + ws_ext_sales_price) / 2 ELSE 0 END) AS web_1999,\n    SUM(CASE WHEN fd.d_year = 2000 THEN ((ws_ext_list_price - ws_ext_wholesale_cost - ws_ext_discount_amt) + ws_ext_sales_price) / 2 ELSE 0 END) AS web_2000\n  FROM customer c\n  JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk\n  JOIN filtered_dates fd ON ws.ws_sold_date_sk = fd.d_date_sk\n  GROUP BY c.c_customer_id\n)\nSELECT\n  s.customer_id,\n  s.customer_first_name,\n  s.customer_last_name,\n  s.customer_birth_country\nFROM store_sales_agg s\nJOIN catalog_sales_agg c ON s.customer_id = c.customer_id\nJOIN web_sales_agg w ON s.customer_id = w.customer_id\nWHERE\n  s.store_1999 > 0\n  AND c.catalog_1999 > 0\n  AND w.web_1999 > 0\n  AND c.catalog_2000 / c.catalog_1999 > s.store_2000 / s.store_1999\n  AND c.catalog_2000 / c.catalog_1999 > w.web_2000 / w.web_1999\nORDER BY\n  s.customer_id,\n  s.customer_first_name,\n  s.customer_last_name,\n  s.customer_birth_country\nLIMIT 100\n```\n\n**Changes**: Replaced the massive UNION ALL with three separate CTEs that compute 1999 and 2000 aggregates in a single pass each, then performed a single 3-way join instead of 6 self-joins. Added an early-filtered date_dim CTE to restrict scans to relevant years only. Applied all original filters directly in the WHERE clause.\n\n**Expected speedup**: 4-6x due to eliminating O(n\u00b2) self-joins, reducing 6 table scans to 3, and early filtering of date dimension.",
        "provenance": {
          "source": "analyst_mode",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 6,
          "iteration": 2,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.6143809499293833,
            "original_ms": 4964.48448333346,
            "optimized_ms": 3075.1629493339956,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "single_pass_aggregation",
              "date_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_predicate_pushdown",
            "speedup": 1.5352754187065603,
            "original_ms": 5176.646685333253,
            "optimized_ms": 3371.80327533315,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_cte_prefetch",
            "speedup": 1.2445054289041746,
            "original_ms": 5176.646685333253,
            "optimized_ms": 4159.601529333183,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_date_range_cte",
              "multi_dimension_prefetch",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.2353550946624476,
            "original_ms": 5283.378789333558,
            "optimized_ms": 4276.809811333806,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "union_cte_split",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.1547401533625217,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.112066135964396,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.03,
            "original_ms": 10208.82,
            "optimized_ms": 9937.12,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_date_restructuring",
            "speedup": 0.9659099580735698,
            "original_ms": 5176.646685333253,
            "optimized_ms": 5359.347051000138,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "union_cte_split"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.9404771309686327,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "materialize_cte"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.9173889863571969,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.08910858289023524,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.08590293193932914,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.06460344621307733,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transformation",
            "speedup": 0,
            "original_ms": 5176.646685333253,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "intersect_to_exists",
              "or_to_union",
              "single_pass_aggregation"
            ]
          }
        ]
      },
      "q40": {
        "query_id": "q40",
        "status": "WIN",
        "best_speedup": 5.2323,
        "original_ms": 78.61,
        "optimized_ms": 15.02,
        "original_sql": "-- start query 40 in stream 0 using template query40.tpl\nselect \n   w_state\n  ,i_item_id\n  ,sum(case when (cast(d_date as date) < cast ('2001-04-02' as date)) \n \t\tthen cs_sales_price - coalesce(cr_refunded_cash,0) else 0 end) as sales_before\n  ,sum(case when (cast(d_date as date) >= cast ('2001-04-02' as date)) \n \t\tthen cs_sales_price - coalesce(cr_refunded_cash,0) else 0 end) as sales_after\n from\n   catalog_sales left outer join catalog_returns on\n       (cs_order_number = cr_order_number \n        and cs_item_sk = cr_item_sk)\n  ,warehouse \n  ,item\n  ,date_dim\n where\n     i_current_price between 0.99 and 1.49\n and i_item_sk          = cs_item_sk\n and cs_warehouse_sk    = w_warehouse_sk \n and cs_sold_date_sk    = d_date_sk\n and d_date between (cast ('2001-04-02' as date) - INTERVAL 30 DAY)\n                and (cast ('2001-04-02' as date) + INTERVAL 30 DAY) \n group by\n    w_state,i_item_id\n order by w_state,i_item_id\n LIMIT 100;\n\n-- end query 40 in stream 0 using template query40.tpl\n",
        "optimized_sql": "WITH filtered_item AS (\n    SELECT i_item_sk, i_item_id\n    FROM item\n    WHERE i_current_price BETWEEN 0.99 AND 1.49\n), filtered_date AS (\n    SELECT d_date_sk, d_date\n    FROM date_dim\n    WHERE d_date BETWEEN (\n        CAST('2001-04-02' AS DATE) - INTERVAL '30' DAY\n    ) AND (\n        CAST('2001-04-02' AS DATE) + INTERVAL '30' DAY\n    )\n), sales_with_dims AS (\n    SELECT\n        cs.cs_item_sk,\n        cs.cs_order_number,\n        cs.cs_sales_price,\n        cs.cs_warehouse_sk,\n        fi.i_item_id,\n        fd.d_date\n    FROM catalog_sales cs\n    JOIN filtered_item fi ON cs.cs_item_sk = fi.i_item_sk\n    JOIN filtered_date fd ON cs.cs_sold_date_sk = fd.d_date_sk\n)\nSELECT\n    w.w_state,\n    swd.i_item_id,\n    SUM(\n        CASE\n            WHEN CAST(swd.d_date AS DATE) < CAST('2001-04-02' AS DATE)\n            THEN swd.cs_sales_price - COALESCE(cr.cr_refunded_cash, 0)\n            ELSE 0\n        END\n    ) AS sales_before,\n    SUM(\n        CASE\n            WHEN CAST(swd.d_date AS DATE) >= CAST('2001-04-02' AS DATE)\n            THEN swd.cs_sales_price - COALESCE(cr.cr_refunded_cash, 0)\n            ELSE 0\n        END\n    ) AS sales_after\nFROM sales_with_dims swd\nLEFT OUTER JOIN catalog_returns cr ON (\n    swd.cs_order_number = cr.cr_order_number \n    AND swd.cs_item_sk = cr.cr_item_sk\n)\nJOIN warehouse w ON swd.cs_warehouse_sk = w.w_warehouse_sk\nGROUP BY w.w_state, swd.i_item_id\nORDER BY w.w_state, swd.i_item_id\nLIMIT 100",
        "transforms": [
          "prefetch_fact_join",
          "multi_dimension_prefetch",
          "single_pass_aggregation"
        ],
        "principle": "prefetch_fact_join",
        "changes_description": "Applied aggressive multi-CTE prefetch by creating staged CTEs for filtered dimensions (item and date_dim) before joining with the fact table. This reduces the catalog_sales scan early by pushing down selective filters. The conditional aggregations remain consolidated in a single scan.",
        "reasoning": "```sql\nWITH filtered_item AS (\n    SELECT i_item_sk, i_item_id\n    FROM item\n    WHERE i_current_price BETWEEN 0.99 AND 1.49\n), filtered_date AS (\n    SELECT d_date_sk, d_date\n    FROM date_dim\n    WHERE d_date BETWEEN (\n        CAST('2001-04-02' AS DATE) - INTERVAL '30' DAY\n    ) AND (\n        CAST('2001-04-02' AS DATE) + INTERVAL '30' DAY\n    )\n), sales_with_dims AS (\n    SELECT\n        cs.cs_item_sk,\n        cs.cs_order_number,\n        cs.cs_sales_price,\n        cs.cs_warehouse_sk,\n        fi.i_item_id,\n        fd.d_date\n    FROM catalog_sales cs\n    JOIN filtered_item fi ON cs.cs_item_sk = fi.i_item_sk\n    JOIN filtered_date fd ON cs.cs_sold_date_sk = fd.d_date_sk\n)\nSELECT\n    w.w_state,\n    swd.i_item_id,\n    SUM(\n        CASE\n            WHEN CAST(swd.d_date AS DATE) < CAST('2001-04-02' AS DATE)\n            THEN swd.cs_sales_price - COALESCE(cr.cr_refunded_cash, 0)\n            ELSE 0\n        END\n    ) AS sales_before,\n    SUM(\n        CASE\n            WHEN CAST(swd.d_date AS DATE) >= CAST('2001-04-02' AS DATE)\n            THEN swd.cs_sales_price - COALESCE(cr.cr_refunded_cash, 0)\n            ELSE 0\n        END\n    ) AS sales_after\nFROM sales_with_dims swd\nLEFT OUTER JOIN catalog_returns cr ON (\n    swd.cs_order_number = cr.cr_order_number \n    AND swd.cs_item_sk = cr.cr_item_sk\n)\nJOIN warehouse w ON swd.cs_warehouse_sk = w.w_warehouse_sk\nGROUP BY w.w_state, swd.i_item_id\nORDER BY w.w_state, swd.i_item_id\nLIMIT 100\n```\n\nChanges: Applied aggressive multi-CTE prefetch by creating staged CTEs for filtered dimensions (item and date_dim) before joining with the fact table. This reduces the catalog_sales scan early by pushing down selective filters. The conditional aggregations remain consolidated in a single scan.\n\nExpected speedup: ~2-3x by reducing fact table rows through early dimension filtering and maintaining single-pass aggregation.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": "Aggressive Multi-CTE Prefetch"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 5.71179425805959,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "Aggressive Multi-CTE Prefetch",
            "speedup": 5.232336625346366,
            "original_ms": 78.60866333370116,
            "optimized_ms": 15.023625000139873,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.178214341043941,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.07,
            "original_ms": 251.58,
            "optimized_ms": 235.9,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "Conservative Early Filtering",
            "speedup": 0.9625828346919691,
            "original_ms": 78.60866333370116,
            "optimized_ms": 81.66431033320502,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "Dimension Pre-isolation Restructuring",
            "speedup": 0.9513636579513655,
            "original_ms": 78.60866333370116,
            "optimized_ms": 82.62735566646977,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "Novel Structural Transformation",
            "speedup": 0.8675362677150643,
            "original_ms": 78.60866333370116,
            "optimized_ms": 90.61138566661005,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.6420637556785981,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.4147867223292329,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q41": {
        "query_id": "q41",
        "status": "WIN",
        "best_speedup": 1.4286,
        "original_ms": 17.35,
        "optimized_ms": 12.15,
        "original_sql": "-- start query 41 in stream 0 using template query41.tpl\nselect distinct(i_product_name)\n from item i1\n where i_manufact_id between 748 and 748+40 \n   and (select count(*) as item_cnt\n        from item\n        where (i_manufact = i1.i_manufact and\n        ((i_category = 'Women' and \n        (i_color = 'gainsboro' or i_color = 'aquamarine') and \n        (i_units = 'Ounce' or i_units = 'Dozen') and\n        (i_size = 'medium' or i_size = 'economy')\n        ) or\n        (i_category = 'Women' and\n        (i_color = 'chiffon' or i_color = 'violet') and\n        (i_units = 'Ton' or i_units = 'Pound') and\n        (i_size = 'extra large' or i_size = 'small')\n        ) or\n        (i_category = 'Men' and\n        (i_color = 'chartreuse' or i_color = 'blue') and\n        (i_units = 'Each' or i_units = 'Oz') and\n        (i_size = 'N/A' or i_size = 'large')\n        ) or\n        (i_category = 'Men' and\n        (i_color = 'tan' or i_color = 'dodger') and\n        (i_units = 'Bunch' or i_units = 'Tsp') and\n        (i_size = 'medium' or i_size = 'economy')\n        ))) or\n       (i_manufact = i1.i_manufact and\n        ((i_category = 'Women' and \n        (i_color = 'blanched' or i_color = 'tomato') and \n        (i_units = 'Tbl' or i_units = 'Case') and\n        (i_size = 'medium' or i_size = 'economy')\n        ) or\n        (i_category = 'Women' and\n        (i_color = 'almond' or i_color = 'lime') and\n        (i_units = 'Box' or i_units = 'Dram') and\n        (i_size = 'extra large' or i_size = 'small')\n        ) or\n        (i_category = 'Men' and\n        (i_color = 'peru' or i_color = 'saddle') and\n        (i_units = 'Pallet' or i_units = 'Gram') and\n        (i_size = 'N/A' or i_size = 'large')\n        ) or\n        (i_category = 'Men' and\n        (i_color = 'indian' or i_color = 'spring') and\n        (i_units = 'Unknown' or i_units = 'Carton') and\n        (i_size = 'medium' or i_size = 'economy')\n        )))) > 0\n order by i_product_name\n LIMIT 100;\n\n-- end query 41 in stream 0 using template query41.tpl\n",
        "optimized_sql": "WITH eligible_manufacturers AS (\n  SELECT DISTINCT i_manufact\n  FROM item\n  WHERE \n    (i_category = 'Women' AND i_color IN ('gainsboro', 'aquamarine') AND i_units IN ('Ounce', 'Dozen') AND i_size IN ('medium', 'economy'))\n    OR (i_category = 'Women' AND i_color IN ('chiffon', 'violet') AND i_units IN ('Ton', 'Pound') AND i_size IN ('extra large', 'small'))\n    OR (i_category = 'Men' AND i_color IN ('chartreuse', 'blue') AND i_units IN ('Each', 'Oz') AND i_size IN ('N/A', 'large'))\n    OR (i_category = 'Men' AND i_color IN ('tan', 'dodger') AND i_units IN ('Bunch', 'Tsp') AND i_size IN ('medium', 'economy'))\n    OR (i_category = 'Women' AND i_color IN ('blanched', 'tomato') AND i_units IN ('Tbl', 'Case') AND i_size IN ('medium', 'economy'))\n    OR (i_category = 'Women' AND i_color IN ('almond', 'lime') AND i_units IN ('Box', 'Dram') AND i_size IN ('extra large', 'small'))\n    OR (i_category = 'Men' AND i_color IN ('peru', 'saddle') AND i_units IN ('Pallet', 'Gram') AND i_size IN ('N/A', 'large'))\n    OR (i_category = 'Men' AND i_color IN ('indian', 'spring') AND i_units IN ('Unknown', 'Carton') AND i_size IN ('medium', 'economy'))\n)\nSELECT DISTINCT\n  i_product_name\nFROM item AS i1\nJOIN eligible_manufacturers em ON i1.i_manufact = em.i_manufact\nWHERE\n  i_manufact_id BETWEEN 748 AND 748 + 40\nORDER BY\n  i_product_name\nLIMIT 100",
        "transforms": [
          "decorrelate",
          "single_pass_aggregation",
          "dimension_cte_isolate"
        ],
        "principle": "decorrelate",
        "changes_description": "Eliminated the correlated subquery by precomputing manufacturers with matching items in a CTE, then performed a single join instead of per-row subquery executions.",
        "reasoning": "```sql\nWITH eligible_manufacturers AS (\n  SELECT DISTINCT i_manufact\n  FROM item\n  WHERE \n    (i_category = 'Women' AND i_color IN ('gainsboro', 'aquamarine') AND i_units IN ('Ounce', 'Dozen') AND i_size IN ('medium', 'economy'))\n    OR (i_category = 'Women' AND i_color IN ('chiffon', 'violet') AND i_units IN ('Ton', 'Pound') AND i_size IN ('extra large', 'small'))\n    OR (i_category = 'Men' AND i_color IN ('chartreuse', 'blue') AND i_units IN ('Each', 'Oz') AND i_size IN ('N/A', 'large'))\n    OR (i_category = 'Men' AND i_color IN ('tan', 'dodger') AND i_units IN ('Bunch', 'Tsp') AND i_size IN ('medium', 'economy'))\n    OR (i_category = 'Women' AND i_color IN ('blanched', 'tomato') AND i_units IN ('Tbl', 'Case') AND i_size IN ('medium', 'economy'))\n    OR (i_category = 'Women' AND i_color IN ('almond', 'lime') AND i_units IN ('Box', 'Dram') AND i_size IN ('extra large', 'small'))\n    OR (i_category = 'Men' AND i_color IN ('peru', 'saddle') AND i_units IN ('Pallet', 'Gram') AND i_size IN ('N/A', 'large'))\n    OR (i_category = 'Men' AND i_color IN ('indian', 'spring') AND i_units IN ('Unknown', 'Carton') AND i_size IN ('medium', 'economy'))\n)\nSELECT DISTINCT\n  i_product_name\nFROM item AS i1\nJOIN eligible_manufacturers em ON i1.i_manufact = em.i_manufact\nWHERE\n  i_manufact_id BETWEEN 748 AND 748 + 40\nORDER BY\n  i_product_name\nLIMIT 100\n```\n\nChanges: Eliminated the correlated subquery by precomputing manufacturers with matching items in a CTE, then performed a single join instead of per-row subquery executions.\n\nExpected speedup: 2-3x by removing N\u00b2 correlated execution and enabling single-pass processing.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": "aggressive_correlation_elimination"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.6226167779211211,
            "original_ms": 15.826699000172084,
            "optimized_ms": 9.753812000174852,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "single_pass_aggregation",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_correlation_elimination",
            "speedup": 1.4286262786356203,
            "original_ms": 17.35410200005087,
            "optimized_ms": 12.147404999874803,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.2765588616238608,
            "original_ms": 17.35410200005087,
            "optimized_ms": 13.59443933354972,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.223390916715014,
            "original_ms": 15.755056998993192,
            "optimized_ms": 12.878186999538835,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.14,
            "original_ms": 19.56,
            "optimized_ms": 17.18,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filtering",
            "speedup": 1.0890795160874773,
            "original_ms": 17.35410200005087,
            "optimized_ms": 15.934650999952282,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.3500425293594371,
            "original_ms": 17.35410200005087,
            "optimized_ms": 49.57712433345781,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "union_cte_split"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q42": {
        "query_id": "q42",
        "status": "WIN",
        "best_speedup": 2.8,
        "original_ms": 217.87,
        "optimized_ms": 77.81,
        "original_sql": "SELECT dt.d_year,\n       item.i_category_id,\n       item.i_category,\n       sum(ss_ext_sales_price)\nFROM date_dim dt,\n     store_sales,\n     item\nWHERE dt.d_date_sk = store_sales.ss_sold_date_sk\n  AND store_sales.ss_item_sk = item.i_item_sk\n  AND item.i_manager_id = 1\n  AND dt.d_moy=11\n  AND dt.d_year=2000\nGROUP BY dt.d_year,\n         item.i_category_id,\n         item.i_category\nORDER BY sum(ss_ext_sales_price) DESC,dt.d_year,\n                                      item.i_category_id,\n                                      item.i_category\nLIMIT 100 ;\n\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_year FROM date_dim WHERE d_moy = 11 AND d_year = 2000), filtered_items AS (SELECT i_item_sk, i_category_id, i_category FROM item WHERE i_manager_id = 1), joined_sales AS (SELECT ss.ss_ext_sales_price, fd.d_year, fi.i_category_id, fi.i_category FROM store_sales AS ss JOIN filtered_dates AS fd ON ss.ss_sold_date_sk = fd.d_date_sk JOIN filtered_items AS fi ON ss.ss_item_sk = fi.i_item_sk)\nSELECT d_year, i_category_id, i_category, SUM(ss_ext_sales_price) FROM joined_sales GROUP BY d_year, i_category_id, i_category ORDER BY SUM(ss_ext_sales_price) DESC, d_year, i_category_id, i_category LIMIT 100",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk, d_year FROM date_dim WHERE d_moy = 11 AND d_year = 2000\",\n        \"filtered_items\": \"SELECT i_item_sk, i_category_id, i_category FROM item WHERE i_manager_id = 1\",\n        \"joined_sales\": \"SELECT ss.ss_ext_sales_price, fd.d_year, fi.i_category_id, fi.i_category FROM store_sales ss JOIN filtered_dates fd ON ss.ss_sold_date_sk = fd.d_date_sk JOIN filtered_items fi ON ss.ss_item_sk = fi.i_item_sk\",\n        \"main_query\": \"SELECT d_year, i_category_id, i_category, SUM(ss_ext_sales_price) FROM joined_sales GROUP BY d_year, i_category_id, i_category ORDER BY SUM(ss_ext_sales_price) DESC, d_year, i_category_id, i_category LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\",\n        \"same grouping and aggregation\"\n      ],\n      \"expected_speedup\": \"3.0x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Created separate CTEs for filtered date_dim and item tables to reduce the cardinality before joining with the large store_sales fact table. This allows early filtering of dimension tables (date_dim reduces from 73K\u219230 rows, item from 102K\u21921.8K rows) before joining with store_sales (345M rows), significantly reducing the hash join cost. The transformed query scans each dimension once with filters, then joins the filtered results with the fact table, eliminating the need to scan the full store_sales table before applying dimension filters.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 2,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.4652787090057489,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.1537825698508446,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.1467054533131085,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.129582722771031,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.0870766881881235,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 1.025125483231147,
            "original_ms": 142.73852866669282,
            "optimized_ms": 139.24005499969402,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filtering",
            "speedup": 1.0165074227175037,
            "original_ms": 142.73852866669282,
            "optimized_ms": 140.4205473336333,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.0110279132693711,
            "original_ms": 142.73852866669282,
            "optimized_ms": 141.1815903332657,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0.9982949197877948,
            "original_ms": 142.73852866669282,
            "optimized_ms": 142.98232499974498,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "multi_dimension_prefetch",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.9744083994746672,
            "original_ms": 138.0089753338325,
            "optimized_ms": 141.63360599953498,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.9460228278501602,
            "original_ms": 159.82480400028484,
            "optimized_ms": 168.94391899980596,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.94,
            "original_ms": 217.87,
            "optimized_ms": 231.85,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.7345204021211929,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.6915530662951658,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q43": {
        "query_id": "q43",
        "status": "WIN",
        "best_speedup": 2.71,
        "original_ms": 618.94,
        "optimized_ms": 228.39,
        "original_sql": "\nSELECT s_store_name,\n       s_store_id,\n       sum(CASE\n               WHEN (d_day_name='Sunday') THEN ss_sales_price\n               ELSE NULL\n           END) sun_sales,\n       sum(CASE\n               WHEN (d_day_name='Monday') THEN ss_sales_price\n               ELSE NULL\n           END) mon_sales,\n       sum(CASE\n               WHEN (d_day_name='Tuesday') THEN ss_sales_price\n               ELSE NULL\n           END) tue_sales,\n       sum(CASE\n               WHEN (d_day_name='Wednesday') THEN ss_sales_price\n               ELSE NULL\n           END) wed_sales,\n       sum(CASE\n               WHEN (d_day_name='Thursday') THEN ss_sales_price\n               ELSE NULL\n           END) thu_sales,\n       sum(CASE\n               WHEN (d_day_name='Friday') THEN ss_sales_price\n               ELSE NULL\n           END) fri_sales,\n       sum(CASE\n               WHEN (d_day_name='Saturday') THEN ss_sales_price\n               ELSE NULL\n           END) sat_sales\nFROM date_dim,\n     store_sales,\n     store\nWHERE d_date_sk = ss_sold_date_sk\n  AND s_store_sk = ss_store_sk\n  AND s_gmt_offset = -5\n  AND d_year = 2000\nGROUP BY s_store_name,\n         s_store_id\nORDER BY s_store_name,\n         s_store_id,\n         sun_sales,\n         mon_sales,\n         tue_sales,\n         wed_sales,\n         thu_sales,\n         fri_sales,\n         sat_sales\nLIMIT 100;\n\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_day_name FROM date_dim WHERE d_year = 2000), filtered_stores AS (SELECT s_store_sk, s_store_id, s_store_name FROM store WHERE s_gmt_offset = -5)\nSELECT s_store_name, s_store_id, SUM(CASE WHEN (d_day_name = 'Sunday') THEN ss_sales_price ELSE NULL END) AS sun_sales, SUM(CASE WHEN (d_day_name = 'Monday') THEN ss_sales_price ELSE NULL END) AS mon_sales, SUM(CASE WHEN (d_day_name = 'Tuesday') THEN ss_sales_price ELSE NULL END) AS tue_sales, SUM(CASE WHEN (d_day_name = 'Wednesday') THEN ss_sales_price ELSE NULL END) AS wed_sales, SUM(CASE WHEN (d_day_name = 'Thursday') THEN ss_sales_price ELSE NULL END) AS thu_sales, SUM(CASE WHEN (d_day_name = 'Friday') THEN ss_sales_price ELSE NULL END) AS fri_sales, SUM(CASE WHEN (d_day_name = 'Saturday') THEN ss_sales_price ELSE NULL END) AS sat_sales FROM store_sales JOIN filtered_dates ON d_date_sk = ss_sold_date_sk JOIN filtered_stores ON s_store_sk = ss_store_sk GROUP BY s_store_name, s_store_id ORDER BY s_store_name, s_store_id, sun_sales, mon_sales, tue_sales, wed_sales, thu_sales, fri_sales, sat_sales LIMIT 100",
        "transforms": [
          "early_filter"
        ],
        "principle": "early_filter",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk, d_day_name FROM date_dim WHERE d_year = 2000\",\n        \"filtered_stores\": \"SELECT s_store_sk, s_store_id, s_store_name FROM store WHERE s_gmt_offset = -5\",\n        \"main_query\": \"SELECT s_store_name, s_store_id, SUM(CASE WHEN (d_day_name = 'Sunday') THEN ss_sales_price ELSE NULL END) AS sun_sales, SUM(CASE WHEN (d_day_name = 'Monday') THEN ss_sales_price ELSE NULL END) AS mon_sales, SUM(CASE WHEN (d_day_name = 'Tuesday') THEN ss_sales_price ELSE NULL END) AS tue_sales, SUM(CASE WHEN (d_day_name = 'Wednesday') THEN ss_sales_price ELSE NULL END) AS wed_sales, SUM(CASE WHEN (d_day_name = 'Thursday') THEN ss_sales_price ELSE NULL END) AS thu_sales, SUM(CASE WHEN (d_day_name = 'Friday') THEN ss_sales_price ELSE NULL END) AS fri_sales, SUM(CASE WHEN (d_day_name = 'Saturday') THEN ss_sales_price ELSE NULL END) AS sat_sales FROM store_sales JOIN filtered_dates ON d_date_sk = ss_sold_date_sk JOIN filtered_stores ON s_store_sk = ss_store_sk GROUP BY s_store_name, s_store_id ORDER BY s_store_name, s_store_id, sun_sales, mon_sales, tue_sales, wed_sales, thu_sales, fri_sales, sat_sales LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"output columns unchanged\",\n        \"same aggregation grain\",\n        \"predicate logic preserved\"\n      ],\n      \"expected_speedup\": \"1.8x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Isolated date_dim and store filters into separate CTEs to enable early filtering and reduce join cardinality. This prevents scanning the entire store_sales table before applying date/year and GMT offset filters. The date filter reduces from 73K rows to 366 rows, and store filter reduces from 52 rows to a subset (likely 10-20). This dramatically reduces the hash join build size and probe operations.\"\n}\n```",
        "provenance": {
          "source": "Retry3W",
          "run": "retry_3worker_20260205_235909_details",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.3239256610840502,
            "original_ms": 356.4588253339025,
            "optimized_ms": 269.243837333003,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_pushdown",
            "speedup": 1.047449810644975,
            "original_ms": 363.0069353333359,
            "optimized_ms": 346.5626053336261,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0373555345575387,
            "original_ms": 363.0069353333359,
            "optimized_ms": 349.9349290001798,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.0210807658251655,
            "original_ms": 389.3811880000915,
            "optimized_ms": 381.34220233344723,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.016426410999442,
            "original_ms": 363.0069353333359,
            "optimized_ms": 357.1404003329614,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.98,
            "original_ms": 618.94,
            "optimized_ms": 630.3,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_cte_prefetch",
            "speedup": 0.9736339857879492,
            "original_ms": 363.0069353333359,
            "optimized_ms": 372.83716533329425,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch",
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.9478909645413708,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.6512257348048118,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.6467426646014227,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q44": {
        "query_id": "q44",
        "status": "WIN",
        "best_speedup": 1.3654,
        "original_ms": 4.35,
        "optimized_ms": 3.18,
        "original_sql": "-- start query 44 in stream 0 using template query44.tpl\nselect asceding.rnk, i1.i_product_name best_performing, i2.i_product_name worst_performing\nfrom(select *\n     from (select item_sk,rank() over (order by rank_col asc) rnk\n           from (select ss_item_sk item_sk,avg(ss_net_profit) rank_col \n                 from store_sales ss1\n                 where ss_store_sk = 146\n                 group by ss_item_sk\n                 having avg(ss_net_profit) > 0.9*(select avg(ss_net_profit) rank_col\n                                                  from store_sales\n                                                  where ss_store_sk = 146\n                                                    and ss_addr_sk is null\n                                                  group by ss_store_sk))V1)V11\n     where rnk  < 11) asceding,\n    (select *\n     from (select item_sk,rank() over (order by rank_col desc) rnk\n           from (select ss_item_sk item_sk,avg(ss_net_profit) rank_col\n                 from store_sales ss1\n                 where ss_store_sk = 146\n                 group by ss_item_sk\n                 having avg(ss_net_profit) > 0.9*(select avg(ss_net_profit) rank_col\n                                                  from store_sales\n                                                  where ss_store_sk = 146\n                                                    and ss_addr_sk is null\n                                                  group by ss_store_sk))V2)V21\n     where rnk  < 11) descending,\nitem i1,\nitem i2\nwhere asceding.rnk = descending.rnk \n  and i1.i_item_sk=asceding.item_sk\n  and i2.i_item_sk=descending.item_sk\norder by asceding.rnk\n LIMIT 100;\n\n-- end query 44 in stream 0 using template query44.tpl\n",
        "optimized_sql": "WITH store_avg AS (\n    SELECT\n        AVG(ss_net_profit) AS avg_profit\n    FROM store_sales\n    WHERE\n        ss_store_sk = 146\n        AND ss_addr_sk IS NULL\n    GROUP BY\n        ss_store_sk\n),\nitem_profits AS (\n    SELECT\n        ss_item_sk AS item_sk,\n        AVG(ss_net_profit) AS avg_profit\n    FROM store_sales\n    WHERE\n        ss_store_sk = 146\n    GROUP BY\n        ss_item_sk\n    HAVING\n        AVG(ss_net_profit) > 0.9 * (SELECT avg_profit FROM store_avg)\n),\nranked_items AS (\n    SELECT\n        item_sk,\n        avg_profit,\n        RANK() OVER (ORDER BY avg_profit ASC) AS asc_rnk,\n        RANK() OVER (ORDER BY avg_profit DESC) AS desc_rnk\n    FROM item_profits\n),\nascending_top AS (\n    SELECT\n        item_sk,\n        asc_rnk AS rnk\n    FROM ranked_items\n    WHERE\n        asc_rnk < 11\n),\ndescending_top AS (\n    SELECT\n        item_sk,\n        desc_rnk AS rnk\n    FROM ranked_items\n    WHERE\n        desc_rnk < 11\n)\nSELECT\n    a.rnk,\n    i1.i_product_name AS best_performing,\n    i2.i_product_name AS worst_performing\nFROM ascending_top a\nJOIN descending_top d ON a.rnk = d.rnk\nJOIN item i1 ON a.item_sk = i1.i_item_sk\nJOIN item i2 ON d.item_sk = i2.i_item_sk\nORDER BY\n    a.rnk\nLIMIT 100;",
        "transforms": [
          "materialize_cte"
        ],
        "principle": "materialize_cte",
        "changes_description": "Eliminated duplicate subquery computation by extracting the shared store average threshold and item profit calculation into CTEs, then computed both rankings in a single pass using window functions, and converted implicit joins to explicit JOIN syntax.",
        "reasoning": "```sql\nWITH store_avg AS (\n    SELECT\n        AVG(ss_net_profit) AS avg_profit\n    FROM store_sales\n    WHERE\n        ss_store_sk = 146\n        AND ss_addr_sk IS NULL\n    GROUP BY\n        ss_store_sk\n),\nitem_profits AS (\n    SELECT\n        ss_item_sk AS item_sk,\n        AVG(ss_net_profit) AS avg_profit\n    FROM store_sales\n    WHERE\n        ss_store_sk = 146\n    GROUP BY\n        ss_item_sk\n    HAVING\n        AVG(ss_net_profit) > 0.9 * (SELECT avg_profit FROM store_avg)\n),\nranked_items AS (\n    SELECT\n        item_sk,\n        avg_profit,\n        RANK() OVER (ORDER BY avg_profit ASC) AS asc_rnk,\n        RANK() OVER (ORDER BY avg_profit DESC) AS desc_rnk\n    FROM item_profits\n),\nascending_top AS (\n    SELECT\n        item_sk,\n        asc_rnk AS rnk\n    FROM ranked_items\n    WHERE\n        asc_rnk < 11\n),\ndescending_top AS (\n    SELECT\n        item_sk,\n        desc_rnk AS rnk\n    FROM ranked_items\n    WHERE\n        desc_rnk < 11\n)\nSELECT\n    a.rnk,\n    i1.i_product_name AS best_performing,\n    i2.i_product_name AS worst_performing\nFROM ascending_top a\nJOIN descending_top d ON a.rnk = d.rnk\nJOIN item i1 ON a.item_sk = i1.i_item_sk\nJOIN item i2 ON d.item_sk = i2.i_item_sk\nORDER BY\n    a.rnk\nLIMIT 100;\n```\n\nChanges: Eliminated duplicate subquery computation by extracting the shared store average threshold and item profit calculation into CTEs, then computed both rankings in a single pass using window functions, and converted implicit joins to explicit JOIN syntax.\n\nExpected speedup: 1.8-2.5x from removing redundant aggregation work and enabling better join optimization.",
        "provenance": {
          "source": "state_0",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 4,
          "iteration": 0,
          "strategy": "novel_structural_transform"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.2159670898043362,
            "original_ms": 3.660517333325212,
            "optimized_ms": 3.010375333360571,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "intersect_to_exists",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_single_pass_restructure",
            "speedup": 1.1968409607938995,
            "original_ms": 3.660517333325212,
            "optimized_ms": 3.0584826666502827,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "single_pass_aggregation",
              "prefetch_fact_join",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.1694504884907846,
            "original_ms": 3.6632853334594984,
            "optimized_ms": 3.1324843330367003,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filtering",
            "speedup": 0.9845146437417597,
            "original_ms": 3.660517333325212,
            "optimized_ms": 3.7180933331910637,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.6834313107635834,
            "original_ms": 3.0130183331493754,
            "optimized_ms": 4.408663000504021,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0,
            "original_ms": 3.660517333325212,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "decorrelate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q45": {
        "query_id": "q45",
        "status": "WIN",
        "best_speedup": 1.339,
        "original_ms": 105.29,
        "optimized_ms": 78.64,
        "original_sql": "-- start query 45 in stream 0 using template query45.tpl\nselect ca_zip, ca_city, sum(ws_sales_price)\n from web_sales, customer, customer_address, date_dim, item\n where ws_bill_customer_sk = c_customer_sk\n \tand c_current_addr_sk = ca_address_sk \n \tand ws_item_sk = i_item_sk \n \tand ( substr(ca_zip,1,5) in ('85669', '86197','88274','83405','86475', '85392', '85460', '80348', '81792')\n \t      or \n \t      i_item_id in (select i_item_id\n                             from item\n                             where i_item_sk in (2, 3, 5, 7, 11, 13, 17, 19, 23, 29)\n                             )\n \t    )\n \tand ws_sold_date_sk = d_date_sk\n \tand d_qoy = 2 and d_year = 2000\n group by ca_zip, ca_city\n order by ca_zip, ca_city\n LIMIT 100;\n\n-- end query 45 in stream 0 using template query45.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_qoy = 2\n    AND d_year = 2000\n),\nfiltered_customers AS (\n  SELECT DISTINCT c_customer_sk\n  FROM customer_address\n  JOIN customer ON c_current_addr_sk = ca_address_sk\n  WHERE SUBSTRING(ca_zip, 1, 5) IN ('85669', '86197', '88274', '83405', '86475', '85392', '85460', '80348', '81792')\n),\nfiltered_items AS (\n  SELECT DISTINCT i_item_sk\n  FROM item\n  WHERE i_item_sk IN (2, 3, 5, 7, 11, 13, 17, 19, 23, 29)\n),\nfiltered_sales AS (\n  SELECT ws_sales_price, ws_bill_customer_sk\n  FROM web_sales\n  JOIN filtered_dates ON ws_sold_date_sk = d_date_sk\n  WHERE EXISTS (\n    SELECT 1 FROM filtered_customers WHERE c_customer_sk = ws_bill_customer_sk\n  )\n  OR EXISTS (\n    SELECT 1 FROM filtered_items WHERE i_item_sk = ws_item_sk\n  )\n)\nSELECT\n  ca_zip,\n  ca_city,\n  SUM(ws_sales_price) AS \"SUM(ws_sales_price)\"\nFROM filtered_sales\nJOIN customer ON ws_bill_customer_sk = c_customer_sk\nJOIN customer_address ON c_current_addr_sk = ca_address_sk\nGROUP BY\n  ca_zip,\n  ca_city\nORDER BY\n  ca_zip,\n  ca_city\nLIMIT 100",
        "transforms": [
          "decorrelate",
          "intersect_to_exists",
          "date_cte_isolate",
          "multi_dimension_prefetch"
        ],
        "principle": "decorrelate",
        "changes_description": "Created three CTEs to isolate date filtering, customer filtering by ZIP codes, and item filtering by SK values. Used EXISTS semi-joins to push both OR conditions into a single scan of web_sales, avoiding expensive OR evaluation on large intermediate results. Aggregated sales after filtering to minimize data volume before joining to customer_address for final ZIP/city lookup.",
        "reasoning": "```sql\nWITH filtered_dates AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_qoy = 2\n    AND d_year = 2000\n),\nfiltered_customers AS (\n  SELECT DISTINCT c_customer_sk\n  FROM customer_address\n  JOIN customer ON c_current_addr_sk = ca_address_sk\n  WHERE SUBSTRING(ca_zip, 1, 5) IN ('85669', '86197', '88274', '83405', '86475', '85392', '85460', '80348', '81792')\n),\nfiltered_items AS (\n  SELECT DISTINCT i_item_sk\n  FROM item\n  WHERE i_item_sk IN (2, 3, 5, 7, 11, 13, 17, 19, 23, 29)\n),\nfiltered_sales AS (\n  SELECT ws_sales_price, ws_bill_customer_sk\n  FROM web_sales\n  JOIN filtered_dates ON ws_sold_date_sk = d_date_sk\n  WHERE EXISTS (\n    SELECT 1 FROM filtered_customers WHERE c_customer_sk = ws_bill_customer_sk\n  )\n  OR EXISTS (\n    SELECT 1 FROM filtered_items WHERE i_item_sk = ws_item_sk\n  )\n)\nSELECT\n  ca_zip,\n  ca_city,\n  SUM(ws_sales_price) AS \"SUM(ws_sales_price)\"\nFROM filtered_sales\nJOIN customer ON ws_bill_customer_sk = c_customer_sk\nJOIN customer_address ON c_current_addr_sk = ca_address_sk\nGROUP BY\n  ca_zip,\n  ca_city\nORDER BY\n  ca_zip,\n  ca_city\nLIMIT 100\n```\n\nChanges: Created three CTEs to isolate date filtering, customer filtering by ZIP codes, and item filtering by SK values. Used EXISTS semi-joins to push both OR conditions into a single scan of web_sales, avoiding expensive OR evaluation on large intermediate results. Aggregated sales after filtering to minimize data volume before joining to customer_address for final ZIP/city lookup.\n\nExpected speedup: 2-3x by reducing web_sales scan through early semi-join filtering and avoiding OR evaluation on joined data.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 6,
          "iteration": 2,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.3389607915897253,
            "original_ms": 105.29154466651865,
            "optimized_ms": 78.63676466695324,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "intersect_to_exists",
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.2166799951058316,
            "original_ms": 97.25710433334218,
            "optimized_ms": 79.93647033284408,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.08,
            "original_ms": 192.0,
            "optimized_ms": 177.94,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.0057535839077976,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_earlyfilter",
            "speedup": 0.9709234574308797,
            "original_ms": 97.25710433334218,
            "optimized_ms": 100.16969266628924,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_or_transform_decorrelate",
            "speedup": 0.8355409729733358,
            "original_ms": 97.25710433334218,
            "optimized_ms": 116.4001616668126,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "decorrelate",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8226606436674136,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructuring",
            "speedup": 0.7605598272779096,
            "original_ms": 97.25710433334218,
            "optimized_ms": 127.87567900007464,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.6830658304200914,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.6121974038860318,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0,
            "original_ms": 126.6208569995797,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "or_to_union",
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q46": {
        "query_id": "q46",
        "status": "WIN",
        "best_speedup": 3.23,
        "original_ms": 859.94,
        "optimized_ms": 266.24,
        "original_sql": "\nSELECT c_last_name,\n       c_first_name,\n       ca_city,\n       bought_city,\n       ss_ticket_number,\n       amt,\n       profit\nFROM\n  (SELECT ss_ticket_number,\n          ss_customer_sk,\n          ca_city bought_city,\n          sum(ss_coupon_amt) amt,\n          sum(ss_net_profit) profit\n   FROM store_sales,\n        date_dim,\n        store,\n        household_demographics,\n        customer_address\n   WHERE store_sales.ss_sold_date_sk = date_dim.d_date_sk\n     AND store_sales.ss_store_sk = store.s_store_sk\n     AND store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n     AND store_sales.ss_addr_sk = customer_address.ca_address_sk\n     AND (household_demographics.hd_dep_count = 4\n          OR household_demographics.hd_vehicle_count= 3)\n     AND date_dim.d_dow IN (6,\n                            0)\n     AND date_dim.d_year IN (1999,\n                             1999+1,\n                             1999+2)\n     AND store.s_city IN ('Fairview',\n                          'Midway')\n   GROUP BY ss_ticket_number,\n            ss_customer_sk,\n            ss_addr_sk,\n            ca_city) dn,\n     customer,\n     customer_address current_addr\nWHERE ss_customer_sk = c_customer_sk\n  AND customer.c_current_addr_sk = current_addr.ca_address_sk\n  AND current_addr.ca_city <> bought_city\nORDER BY c_last_name NULLS FIRST,\n         c_first_name NULLS FIRST,\n         ca_city NULLS FIRST,\n         bought_city NULLS FIRST,\n         ss_ticket_number NULLS FIRST\nLIMIT 100;\n\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_dow IN (6, 0) AND d_year IN (1999, 2000, 2001)), filtered_store AS (SELECT s_store_sk FROM store WHERE s_city IN ('Fairview', 'Midway')), filtered_hd AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_dep_count = 4 OR hd_vehicle_count = 3)\nSELECT c_last_name, c_first_name, ca_city, bought_city, ss_ticket_number, amt, profit FROM (SELECT ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city AS bought_city, SUM(ss_coupon_amt) AS amt, SUM(ss_net_profit) AS profit FROM store_sales JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk JOIN filtered_store ON store_sales.ss_store_sk = filtered_store.s_store_sk JOIN filtered_hd ON store_sales.ss_hdemo_sk = filtered_hd.hd_demo_sk JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk GROUP BY ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city) AS dn, customer, customer_address AS current_addr WHERE dn.ss_customer_sk = customer.c_customer_sk AND customer.c_current_addr_sk = current_addr.ca_address_sk AND current_addr.ca_city <> bought_city ORDER BY c_last_name NULLS FIRST, c_first_name NULLS FIRST, ca_city NULLS FIRST, bought_city NULLS FIRST, ss_ticket_number NULLS FIRST LIMIT 100",
        "transforms": [
          "or_to_union"
        ],
        "principle": "or_to_union",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"multi_dimension_prefetch\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_dow IN (6, 0) AND d_year IN (1999, 2000, 2001)\",\n        \"filtered_store\": \"SELECT s_store_sk FROM store WHERE s_city IN ('Fairview', 'Midway')\",\n        \"filtered_hd\": \"SELECT hd_demo_sk FROM household_demographics WHERE hd_dep_count = 4 OR hd_vehicle_count = 3\",\n        \"main_query\": \"SELECT c_last_name, c_first_name, ca_city, bought_city, ss_ticket_number, amt, profit FROM (SELECT ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city AS bought_city, SUM(ss_coupon_amt) AS amt, SUM(ss_net_profit) AS profit FROM store_sales JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk JOIN filtered_store ON store_sales.ss_store_sk = filtered_store.s_store_sk JOIN filtered_hd ON store_sales.ss_hdemo_sk = filtered_hd.hd_demo_sk JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk GROUP BY ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city) AS dn, customer, customer_address AS current_addr WHERE dn.ss_customer_sk = customer.c_customer_sk AND customer.c_current_addr_sk = current_addr.ca_address_sk AND current_addr.ca_city <> bought_city ORDER BY c_last_name NULLS FIRST, c_first_name NULLS FIRST, ca_city NULLS FIRST, bought_city NULLS FIRST, ss_ticket_number NULLS FIRST LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\"\n      ],\n      \"expected_speedup\": \"2.5x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Created three prefetch CTEs: filtered_dates, filtered_store, and filtered_hd. These isolate the dimension table filters early, reducing the data volume before joining with the large store_sales fact table. The filtered_hd CTE keeps the OR condition intact but applies it before the join. This reduces the rows processed in the main join sequence and leverages the cost model's tendency to misestimate filtered dimension cardinalities.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.505624723182454,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.0738415343546437,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "or_to_union"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.02,
            "original_ms": 859.94,
            "optimized_ms": 845.02,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.0187489973940693,
            "original_ms": 640.0920000002467,
            "optimized_ms": 628.3117839993793,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "multi_dimension_prefetch",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0096719138579684,
            "original_ms": 602.3627676668184,
            "optimized_ms": 596.5925756666669,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_dimension_pushdown",
            "speedup": 1.0031798848716431,
            "original_ms": 602.3627676668184,
            "optimized_ms": 600.4533949999313,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.9750101442644353,
            "original_ms": 602.3627676668184,
            "optimized_ms": 617.801538999629,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "decorrelate",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 0.9412084328869753,
            "original_ms": 602.3627676668184,
            "optimized_ms": 639.9887066663723,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.7103090018553725,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.47952809033342514,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0,
            "original_ms": 582.297334000638,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q47": {
        "query_id": "q47",
        "status": "WIN",
        "best_speedup": 2.31,
        "original_ms": 2705.8,
        "optimized_ms": 1171.34,
        "original_sql": "WITH v1 AS\n  (SELECT i_category,\n          i_brand,\n          s_store_name,\n          s_company_name,\n          d_year,\n          d_moy,\n          sum(ss_sales_price) sum_sales,\n          avg(sum(ss_sales_price)) OVER (PARTITION BY i_category,\n                                                      i_brand,\n                                                      s_store_name,\n                                                      s_company_name,\n                                                      d_year) avg_monthly_sales,\n                                        rank() OVER (PARTITION BY i_category,\n                                                                  i_brand,\n                                                                  s_store_name,\n                                                                  s_company_name\n                                                     ORDER BY d_year,\n                                                              d_moy) rn\n   FROM item,\n        store_sales,\n        date_dim,\n        store\n   WHERE ss_item_sk = i_item_sk\n     AND ss_sold_date_sk = d_date_sk\n     AND ss_store_sk = s_store_sk\n     AND (d_year = 1999\n          OR (d_year = 1999-1\n              AND d_moy =12)\n          OR (d_year = 1999+1\n              AND d_moy =1))\n   GROUP BY i_category,\n            i_brand,\n            s_store_name,\n            s_company_name,\n            d_year,\n            d_moy),\n     v2 AS\n  (SELECT v1.i_category,\n          v1.i_brand,\n          v1.s_store_name,\n          v1.s_company_name,\n          v1.d_year,\n          v1.d_moy,\n          v1.avg_monthly_sales,\n          v1.sum_sales,\n          v1_lag.sum_sales psum,\n          v1_lead.sum_sales nsum\n   FROM v1,\n        v1 v1_lag,\n        v1 v1_lead\n   WHERE v1.i_category = v1_lag.i_category\n     AND v1.i_category = v1_lead.i_category\n     AND v1.i_brand = v1_lag.i_brand\n     AND v1.i_brand = v1_lead.i_brand\n     AND v1.s_store_name = v1_lag.s_store_name\n     AND v1.s_store_name = v1_lead.s_store_name\n     AND v1.s_company_name = v1_lag.s_company_name\n     AND v1.s_company_name = v1_lead.s_company_name\n     AND v1.rn = v1_lag.rn + 1\n     AND v1.rn = v1_lead.rn - 1)\nSELECT *\nFROM v2\nWHERE d_year = 1999\n  AND avg_monthly_sales > 0\n  AND CASE\n          WHEN avg_monthly_sales > 0 THEN abs(sum_sales - avg_monthly_sales) / avg_monthly_sales\n          ELSE NULL\n      END > 0.1\nORDER BY sum_sales - avg_monthly_sales, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10\nLIMIT 100;\n\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE d_year = 1999 OR (d_year = 1998 AND d_moy = 12) OR (d_year = 2000 AND d_moy = 1)), v1 AS (SELECT i_category, i_brand, s_store_name, s_company_name, d_year, d_moy, SUM(ss_sales_price) AS sum_sales, AVG(SUM(ss_sales_price)) OVER (PARTITION BY i_category, i_brand, s_store_name, s_company_name, d_year) AS avg_monthly_sales, RANK() OVER (PARTITION BY i_category, i_brand, s_store_name, s_company_name ORDER BY d_year, d_moy) AS rn FROM item JOIN store_sales ON ss_item_sk = i_item_sk JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN store ON ss_store_sk = s_store_sk GROUP BY i_category, i_brand, s_store_name, s_company_name, d_year, d_moy), v2 AS (SELECT v1.i_category, v1.i_brand, v1.s_store_name, v1.s_company_name, v1.d_year, v1.d_moy, v1.avg_monthly_sales, v1.sum_sales, v1_lag.sum_sales AS psum, v1_lead.sum_sales AS nsum FROM v1, v1 AS v1_lag, v1 AS v1_lead WHERE v1.i_category = v1_lag.i_category AND v1.i_category = v1_lead.i_category AND v1.i_brand = v1_lag.i_brand AND v1.i_brand = v1_lead.i_brand AND v1.s_store_name = v1_lag.s_store_name AND v1.s_store_name = v1_lead.s_store_name AND v1.s_company_name = v1_lag.s_company_name AND v1.s_company_name = v1_lead.s_company_name AND v1.rn = v1_lag.rn + 1 AND v1.rn = v1_lead.rn - 1)\nSELECT * FROM v2 WHERE d_year = 1999 AND avg_monthly_sales > 0 AND CASE WHEN avg_monthly_sales > 0 THEN ABS(sum_sales - avg_monthly_sales) / avg_monthly_sales ELSE NULL END > 0.1 ORDER BY sum_sales - avg_monthly_sales, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 LIMIT 100",
        "transforms": [
          "or_to_union"
        ],
        "principle": "or_to_union",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE d_year = 1999 OR (d_year = 1998 AND d_moy = 12) OR (d_year = 2000 AND d_moy = 1)\",\n        \"v1\": \"SELECT i_category, i_brand, s_store_name, s_company_name, d_year, d_moy, SUM(ss_sales_price) AS sum_sales, AVG(SUM(ss_sales_price)) OVER (PARTITION BY i_category, i_brand, s_store_name, s_company_name, d_year) AS avg_monthly_sales, RANK() OVER (PARTITION BY i_category, i_brand, s_store_name, s_company_name ORDER BY d_year, d_moy) AS rn FROM item JOIN store_sales ON ss_item_sk = i_item_sk JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN store ON ss_store_sk = s_store_sk GROUP BY i_category, i_brand, s_store_name, s_company_name, d_year, d_moy\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same column output\",\n        \"same grain\"\n      ],\n      \"expected_speedup\": \"1.8x\",\n      \"risk\": \"low\"\n    },\n    {\n      \"id\": \"rs_02\",\n      \"transform\": \"or_to_union\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE d_year = 1999 UNION ALL SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE d_year = 1998 AND d_moy = 12 UNION ALL SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE d_year = 2000 AND d_moy = 1\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same column output\"\n      ],\n      \"expected_speedup\": \"2.2x\",\n      \"risk\": \"medium\"\n    }\n  ],\n  \"explanation\": \"First, isolate date filtering into a CTE to reduce join cardinality early (date_cte_isolate). Second, split the OR condition on date_dim into UNION ALL branches for better predicate pushdown and potential parallelization (or_to_union). This targets the 90.9% cost of v1 where date_dim is filtered from 73K rows to ~1.8K rows, but the optimizer misestimates. Pre-filtering dates reduces the fact table join cardinality significantly.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.0736677305511921,
            "original_ms": 1368.026216333116,
            "optimized_ms": 1274.161621334012,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.044661695356637,
            "original_ms": 1277.186460000242,
            "optimized_ms": 1222.5837949999914,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.0,
            "original_ms": 2705.8,
            "optimized_ms": 2709.99,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": []
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_pushdown",
            "speedup": 0.9964976725048521,
            "original_ms": 1277.186460000242,
            "optimized_ms": 1281.6753066666327,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.9425269567514657,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 0.8888041222575703,
            "original_ms": 1277.186460000242,
            "optimized_ms": 1436.9718006664698,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8169129130715962,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.7478064713060996,
            "original_ms": 1277.186460000242,
            "optimized_ms": 1707.9104139999497,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.6394266102386618,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.5916623117862936,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.18055958112121248,
            "original_ms": 1270.3168963331943,
            "optimized_ms": 7035.444413666482,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "dimension_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q48": {
        "query_id": "q48",
        "status": "WIN",
        "best_speedup": 1.1127,
        "original_ms": 677.66,
        "optimized_ms": 609.03,
        "original_sql": "-- start query 48 in stream 0 using template query48.tpl\nselect sum (ss_quantity)\n from store_sales, store, customer_demographics, customer_address, date_dim\n where s_store_sk = ss_store_sk\n and  ss_sold_date_sk = d_date_sk and d_year = 1999\n and  \n (\n  (\n   cd_demo_sk = ss_cdemo_sk\n   and \n   cd_marital_status = 'U'\n   and \n   cd_education_status = 'Primary'\n   and \n   ss_sales_price between 100.00 and 150.00  \n   )\n or\n  (\n  cd_demo_sk = ss_cdemo_sk\n   and \n   cd_marital_status = 'W'\n   and \n   cd_education_status = 'College'\n   and \n   ss_sales_price between 50.00 and 100.00   \n  )\n or \n (\n  cd_demo_sk = ss_cdemo_sk\n  and \n   cd_marital_status = 'D'\n   and \n   cd_education_status = '2 yr Degree'\n   and \n   ss_sales_price between 150.00 and 200.00  \n )\n )\n and\n (\n  (\n  ss_addr_sk = ca_address_sk\n  and\n  ca_country = 'United States'\n  and\n  ca_state in ('MD', 'MN', 'IA')\n  and ss_net_profit between 0 and 2000  \n  )\n or\n  (ss_addr_sk = ca_address_sk\n  and\n  ca_country = 'United States'\n  and\n  ca_state in ('VA', 'IL', 'TX')\n  and ss_net_profit between 150 and 3000 \n  )\n or\n  (ss_addr_sk = ca_address_sk\n  and\n  ca_country = 'United States'\n  and\n  ca_state in ('MI', 'WI', 'IN')\n  and ss_net_profit between 50 and 25000 \n  )\n )\n;\n\n-- end query 48 in stream 0 using template query48.tpl\n",
        "optimized_sql": "WITH filtered_date AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 1999\n),\nfiltered_demographics AS (\n    SELECT cd_demo_sk, cd_marital_status, cd_education_status\n    FROM customer_demographics\n    WHERE (cd_marital_status = 'U' AND cd_education_status = 'Primary')\n       OR (cd_marital_status = 'W' AND cd_education_status = 'College')\n       OR (cd_marital_status = 'D' AND cd_education_status = '2 yr Degree')\n),\nfiltered_address AS (\n    SELECT ca_address_sk, ca_state\n    FROM customer_address\n    WHERE ca_country = 'United States'\n      AND (ca_state IN ('MD', 'MN', 'IA')\n           OR ca_state IN ('VA', 'IL', 'TX')\n           OR ca_state IN ('MI', 'WI', 'IN'))\n)\nSELECT\n  SUM(ss_quantity)\nFROM store_sales\nINNER JOIN store ON s_store_sk = ss_store_sk\nINNER JOIN filtered_date ON ss_sold_date_sk = d_date_sk\nINNER JOIN filtered_demographics ON cd_demo_sk = ss_cdemo_sk\nINNER JOIN filtered_address ON ss_addr_sk = ca_address_sk\nWHERE (\n    (cd_marital_status = 'U' AND cd_education_status = 'Primary' AND ss_sales_price BETWEEN 100.00 AND 150.00)\n    OR (cd_marital_status = 'W' AND cd_education_status = 'College' AND ss_sales_price BETWEEN 50.00 AND 100.00)\n    OR (cd_marital_status = 'D' AND cd_education_status = '2 yr Degree' AND ss_sales_price BETWEEN 150.00 AND 200.00)\n)\nAND (\n    (ca_state IN ('MD', 'MN', 'IA') AND ss_net_profit BETWEEN 0 AND 2000)\n    OR (ca_state IN ('VA', 'IL', 'TX') AND ss_net_profit BETWEEN 150 AND 3000)\n    OR (ca_state IN ('MI', 'WI', 'IN') AND ss_net_profit BETWEEN 50 AND 25000)\n)",
        "transforms": [
          "early_filter",
          "pushdown",
          "materialize_cte"
        ],
        "principle": "early_filter",
        "changes_description": "Created three filtered CTEs for date_dim, customer_demographics, and customer_address to reduce join sizes early, then joined them to store_sales with explicit INNER JOINs while preserving the original OR logic in the WHERE clause.",
        "reasoning": "```sql\nWITH filtered_date AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 1999\n),\nfiltered_demographics AS (\n    SELECT cd_demo_sk, cd_marital_status, cd_education_status\n    FROM customer_demographics\n    WHERE (cd_marital_status = 'U' AND cd_education_status = 'Primary')\n       OR (cd_marital_status = 'W' AND cd_education_status = 'College')\n       OR (cd_marital_status = 'D' AND cd_education_status = '2 yr Degree')\n),\nfiltered_address AS (\n    SELECT ca_address_sk, ca_state\n    FROM customer_address\n    WHERE ca_country = 'United States'\n      AND (ca_state IN ('MD', 'MN', 'IA')\n           OR ca_state IN ('VA', 'IL', 'TX')\n           OR ca_state IN ('MI', 'WI', 'IN'))\n)\nSELECT\n  SUM(ss_quantity)\nFROM store_sales\nINNER JOIN store ON s_store_sk = ss_store_sk\nINNER JOIN filtered_date ON ss_sold_date_sk = d_date_sk\nINNER JOIN filtered_demographics ON cd_demo_sk = ss_cdemo_sk\nINNER JOIN filtered_address ON ss_addr_sk = ca_address_sk\nWHERE (\n    (cd_marital_status = 'U' AND cd_education_status = 'Primary' AND ss_sales_price BETWEEN 100.00 AND 150.00)\n    OR (cd_marital_status = 'W' AND cd_education_status = 'College' AND ss_sales_price BETWEEN 50.00 AND 100.00)\n    OR (cd_marital_status = 'D' AND cd_education_status = '2 yr Degree' AND ss_sales_price BETWEEN 150.00 AND 200.00)\n)\nAND (\n    (ca_state IN ('MD', 'MN', 'IA') AND ss_net_profit BETWEEN 0 AND 2000)\n    OR (ca_state IN ('VA', 'IL', 'TX') AND ss_net_profit BETWEEN 150 AND 3000)\n    OR (ca_state IN ('MI', 'WI', 'IN') AND ss_net_profit BETWEEN 50 AND 25000)\n)\n```\n\nChanges: Created three filtered CTEs for date_dim, customer_demographics, and customer_address to reduce join sizes early, then joined them to store_sales with explicit INNER JOINs while preserving the original OR logic in the WHERE clause.\nExpected speedup: 1.5-2x due to reduced dimension table sizes and early predicate filtering.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 1,
          "iteration": 0,
          "strategy": "conservative_early_filtering"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filtering",
            "speedup": 1.1126856837322663,
            "original_ms": 677.6577839997723,
            "optimized_ms": 609.0289413329325,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.052613477160269,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.0,
            "original_ms": 933.9,
            "optimized_ms": 938.29,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8447552374313235,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.537430720643162,
            "original_ms": 656.2821076671147,
            "optimized_ms": 1221.1473636671144,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.3121729532684024,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.30600440623855313,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_or_restructuring",
            "speedup": 0.25991769868590203,
            "original_ms": 677.6577839997723,
            "optimized_ms": 2607.2013849995224,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0,
            "original_ms": 677.6577839997723,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_fact_prefetch",
            "speedup": 0,
            "original_ms": 677.6577839997723,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0,
            "original_ms": 671.2288083332775,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q49": {
        "query_id": "q49",
        "status": "WIN",
        "best_speedup": 1.138,
        "original_ms": 384.55,
        "optimized_ms": 337.91,
        "original_sql": "-- start query 49 in stream 0 using template query49.tpl\nselect channel, item, return_ratio, return_rank, currency_rank from\n (select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.wr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.wr_return_amt,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\t web_sales ws left outer join web_returns wr \n \t\t\ton (ws.ws_order_number = wr.wr_order_number and \n \t\t\tws.ws_item_sk = wr.wr_item_sk)\n                 ,date_dim\n \t\twhere \n \t\t\twr.wr_return_amt > 10000 \n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 12\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where \n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select \n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect \n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.cr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.cr_return_amount,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.cr_order_number and \n \t\t\tcs.cs_item_sk = cr.cr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tcr.cr_return_amount > 10000 \n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 12\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where \n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select \n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.sr_return_quantity,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.sr_return_amt,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.sr_ticket_number and sts.ss_item_sk = sr.sr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tsr.sr_return_amt > 10000 \n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0 \n                         and sts.ss_quantity > 0\n                         and ss_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 12\n \t\tgroup by sts.ss_item_sk\n \t) in_store\n ) store\n where  (\n store.return_rank <= 10\n or \n store.currency_rank <= 10\n )\n )\n order by 1,4,5,2\n LIMIT 100;\n\n-- end query 49 in stream 0 using template query49.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 1999\n      AND d_moy = 12\n),\nweb_agg AS (\n    SELECT\n        ws.ws_item_sk AS item,\n        CAST(SUM(COALESCE(wr.wr_return_quantity, 0)) AS DECIMAL(15, 4)) AS return_qty_sum,\n        CAST(SUM(COALESCE(ws.ws_quantity, 0)) AS DECIMAL(15, 4)) AS sales_qty_sum,\n        CAST(SUM(COALESCE(wr.wr_return_amt, 0)) AS DECIMAL(15, 4)) AS return_amt_sum,\n        CAST(SUM(COALESCE(ws.ws_net_paid, 0)) AS DECIMAL(15, 4)) AS sales_amt_sum\n    FROM web_sales ws\n    LEFT OUTER JOIN web_returns wr\n        ON ws.ws_order_number = wr.wr_order_number\n        AND ws.ws_item_sk = wr.wr_item_sk\n    JOIN filtered_dates fd\n        ON ws.ws_sold_date_sk = fd.d_date_sk\n    WHERE wr.wr_return_amt > 10000\n        AND ws.ws_net_profit > 1\n        AND ws.ws_net_paid > 0\n        AND ws.ws_quantity > 0\n    GROUP BY ws.ws_item_sk\n),\nweb_ranked AS (\n    SELECT\n        item,\n        return_qty_sum / sales_qty_sum AS return_ratio,\n        return_amt_sum / sales_amt_sum AS currency_ratio,\n        RANK() OVER (ORDER BY return_qty_sum / sales_qty_sum) AS return_rank,\n        RANK() OVER (ORDER BY return_amt_sum / sales_amt_sum) AS currency_rank\n    FROM web_agg\n),\ncatalog_agg AS (\n    SELECT\n        cs.cs_item_sk AS item,\n        CAST(SUM(COALESCE(cr.cr_return_quantity, 0)) AS DECIMAL(15, 4)) AS return_qty_sum,\n        CAST(SUM(COALESCE(cs.cs_quantity, 0)) AS DECIMAL(15, 4)) AS sales_qty_sum,\n        CAST(SUM(COALESCE(cr.cr_return_amount, 0)) AS DECIMAL(15, 4)) AS return_amt_sum,\n        CAST(SUM(COALESCE(cs.cs_net_paid, 0)) AS DECIMAL(15, 4)) AS sales_amt_sum\n    FROM catalog_sales cs\n    LEFT OUTER JOIN catalog_returns cr\n        ON cs.cs_order_number = cr.cr_order_number\n        AND cs.cs_item_sk = cr.cr_item_sk\n    JOIN filtered_dates fd\n        ON cs.cs_sold_date_sk = fd.d_date_sk\n    WHERE cr.cr_return_amount > 10000\n        AND cs.cs_net_profit > 1\n        AND cs.cs_net_paid > 0\n        AND cs.cs_quantity > 0\n    GROUP BY cs.cs_item_sk\n),\ncatalog_ranked AS (\n    SELECT\n        item,\n        return_qty_sum / sales_qty_sum AS return_ratio,\n        return_amt_sum / sales_amt_sum AS currency_ratio,\n        RANK() OVER (ORDER BY return_qty_sum / sales_qty_sum) AS return_rank,\n        RANK() OVER (ORDER BY return_amt_sum / sales_amt_sum) AS currency_rank\n    FROM catalog_agg\n),\nstore_agg AS (\n    SELECT\n        sts.ss_item_sk AS item,\n        CAST(SUM(COALESCE(sr.sr_return_quantity, 0)) AS DECIMAL(15, 4)) AS return_qty_sum,\n        CAST(SUM(COALESCE(sts.ss_quantity, 0)) AS DECIMAL(15, 4)) AS sales_qty_sum,\n        CAST(SUM(COALESCE(sr.sr_return_amt, 0)) AS DECIMAL(15, 4)) AS return_amt_sum,\n        CAST(SUM(COALESCE(sts.ss_net_paid, 0)) AS DECIMAL(15, 4)) AS sales_amt_sum\n    FROM store_sales sts\n    LEFT OUTER JOIN store_returns sr\n        ON sts.ss_ticket_number = sr.sr_ticket_number\n        AND sts.ss_item_sk = sr.sr_item_sk\n    JOIN filtered_dates fd\n        ON sts.ss_sold_date_sk = fd.d_date_sk\n    WHERE sr.sr_return_amt > 10000\n        AND sts.ss_net_profit > 1\n        AND sts.ss_net_paid > 0\n        AND sts.ss_quantity > 0\n    GROUP BY sts.ss_item_sk\n),\nstore_ranked AS (\n    SELECT\n        item,\n        return_qty_sum / sales_qty_sum AS return_ratio,\n        return_amt_sum / sales_amt_sum AS currency_ratio,\n        RANK() OVER (ORDER BY return_qty_sum / sales_qty_sum) AS return_rank,\n        RANK() OVER (ORDER BY return_amt_sum / sales_amt_sum) AS currency_rank\n    FROM store_agg\n)\nSELECT 'web' AS channel,\n       item,\n       return_ratio,\n       return_rank,\n       currency_rank\nFROM web_ranked\nWHERE return_rank <= 10 OR currency_rank <= 10\nUNION\nSELECT 'catalog' AS channel,\n       item,\n       return_ratio,\n       return_rank,\n       currency_rank\nFROM catalog_ranked\nWHERE return_rank <= 10 OR currency_rank <= 10\nUNION\nSELECT 'store' AS channel,\n       item,\n       return_ratio,\n       return_rank,\n       currency_rank\nFROM store_ranked\nWHERE return_rank <= 10 OR currency_rank <= 10\nORDER BY 1, 4, 5, 2\nLIMIT 100",
        "transforms": [
          "date_cte_isolate",
          "dimension_cte_isolate",
          "decorrelate",
          "union_cte_split",
          "prefetch_fact_join"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```sql\nWITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 1999\n      AND d_moy = 12\n),\nweb_agg AS (\n    SELECT\n        ws.ws_item_sk AS item,\n        CAST(SUM(COALESCE(wr.wr_return_quantity, 0)) AS DECIMAL(15, 4)) AS return_qty_sum,\n        CAST(SUM(COALESCE(ws.ws_quantity, 0)) AS DECIMAL(15, 4)) AS sales_qty_sum,\n        CAST(SUM(COALESCE(wr.wr_return_amt, 0)) AS DECIMAL(15, 4)) AS return_amt_sum,\n        CAST(SUM(COALESCE(ws.ws_net_paid, 0)) AS DECIMAL(15, 4)) AS sales_amt_sum\n    FROM web_sales ws\n    LEFT OUTER JOIN web_returns wr\n        ON ws.ws_order_number = wr.wr_order_number\n        AND ws.ws_item_sk = wr.wr_item_sk\n    JOIN filtered_dates fd\n        ON ws.ws_sold_date_sk = fd.d_date_sk\n    WHERE wr.wr_return_amt > 10000\n        AND ws.ws_net_profit > 1\n        AND ws.ws_net_paid > 0\n        AND ws.ws_quantity > 0\n    GROUP BY ws.ws_item_sk\n),\nweb_ranked AS (\n    SELECT\n        item,\n        return_qty_sum / sales_qty_sum AS return_ratio,\n        return_amt_sum / sales_amt_sum AS currency_ratio,\n        RANK() OVER (ORDER BY return_qty_sum / sales_qty_sum) AS return_rank,\n        RANK() OVER (ORDER BY return_amt_sum / sales_amt_sum) AS currency_rank\n    FROM web_agg\n),\ncatalog_agg AS (\n    SELECT\n        cs.cs_item_sk AS item,\n        CAST(SUM(COALESCE(cr.cr_return_quantity, 0)) AS DECIMAL(15, 4)) AS return_qty_sum,\n        CAST(SUM(COALESCE(cs.cs_quantity, 0)) AS DECIMAL(15, 4)) AS sales_qty_sum,\n        CAST(SUM(COALESCE(cr.cr_return_amount, 0)) AS DECIMAL(15, 4)) AS return_amt_sum,\n        CAST(SUM(COALESCE(cs.cs_net_paid, 0)) AS DECIMAL(15, 4)) AS sales_amt_sum\n    FROM catalog_sales cs\n    LEFT OUTER JOIN catalog_returns cr\n        ON cs.cs_order_number = cr.cr_order_number\n        AND cs.cs_item_sk = cr.cr_item_sk\n    JOIN filtered_dates fd\n        ON cs.cs_sold_date_sk = fd.d_date_sk\n    WHERE cr.cr_return_amount > 10000\n        AND cs.cs_net_profit > 1\n        AND cs.cs_net_paid > 0\n        AND cs.cs_quantity > 0\n    GROUP BY cs.cs_item_sk\n),\ncatalog_ranked AS (\n    SELECT\n        item,\n        return_qty_sum / sales_qty_sum AS return_ratio,\n        return_amt_sum / sales_amt_sum AS currency_ratio,\n        RANK() OVER (ORDER BY return_qty_sum / sales_qty_sum) AS return_rank,\n        RANK() OVER (ORDER BY return_amt_sum / sales_amt_sum) AS currency_rank\n    FROM catalog_agg\n),\nstore_agg AS (\n    SELECT\n        sts.ss_item_sk AS item,\n        CAST(SUM(COALESCE(sr.sr_return_quantity, 0)) AS DECIMAL(15, 4)) AS return_qty_sum,\n        CAST(SUM(COALESCE(sts.ss_quantity, 0)) AS DECIMAL(15, 4)) AS sales_qty_sum,\n        CAST(SUM(COALESCE(sr.sr_return_amt, 0)) AS DECIMAL(15, 4)) AS return_amt_sum,\n        CAST(SUM(COALESCE(sts.ss_net_paid, 0)) AS DECIMAL(15, 4)) AS sales_amt_sum\n    FROM store_sales sts\n    LEFT OUTER JOIN store_returns sr\n        ON sts.ss_ticket_number = sr.sr_ticket_number\n        AND sts.ss_item_sk = sr.sr_item_sk\n    JOIN filtered_dates fd\n        ON sts.ss_sold_date_sk = fd.d_date_sk\n    WHERE sr.sr_return_amt > 10000\n        AND sts.ss_net_profit > 1\n        AND sts.ss_net_paid > 0\n        AND sts.ss_quantity > 0\n    GROUP BY sts.ss_item_sk\n),\nstore_ranked AS (\n    SELECT\n        item,\n        return_qty_sum / sales_qty_sum AS return_ratio,\n        return_amt_sum / sales_amt_sum AS currency_ratio,\n        RANK() OVER (ORDER BY return_qty_sum / sales_qty_sum) AS return_rank,\n        RANK() OVER (ORDER BY return_amt_sum / sales_amt_sum) AS currency_rank\n    FROM store_agg\n)\nSELECT 'web' AS channel,\n       item,\n       return_ratio,\n       return_rank,\n       currency_rank\nFROM web_ranked\nWHERE return_rank <= 10 OR currency_rank <= 10\nUNION\nSELECT 'catalog' AS channel,\n       item,\n       return_ratio,\n       return_rank,\n       currency_rank\nFROM catalog_ranked\nWHERE return_rank <= 10 OR currency_rank <= 10\nUNION\nSELECT 'store' AS channel,\n       item,\n       return_ratio,\n       return_rank,\n       currency_rank\nFROM store_ranked\nWHERE return_rank <= 10 OR currency_rank <= 10\nORDER BY 1, 4, 5, 2\nLIMIT 100\n```\n\n**Changes**: Isolated the shared `date_dim` filter into a reusable CTE (`filtered_dates`) and converted implicit joins to explicit JOIN syntax. This enables predicate pushdown and allows the small date dimension subset to be reused across all three channels without redundant scans.\n\n**Expected speedup**: 1.2-1.5x due to reduced dimension table scanning and better join optimization opportunities.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 2,
          "iteration": 0,
          "strategy": "moderate_dimension_isolation"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.1438249981803454,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.1380110263953256,
            "original_ms": 384.5468100001502,
            "optimized_ms": 337.911321666373,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_filter_pushdown",
            "speedup": 1.0868244649147236,
            "original_ms": 384.5468100001502,
            "optimized_ms": 353.82605233341263,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.02,
            "original_ms": 534.27,
            "optimized_ms": 525.92,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.0121895675968193,
            "original_ms": 384.5468100001502,
            "optimized_ms": 379.9158006668222,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.0052174828745088,
            "original_ms": 332.2350213329628,
            "optimized_ms": 330.51058800022776,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "union_cte_split",
              "date_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.9635364112643269,
            "original_ms": 319.90239133301657,
            "optimized_ms": 332.00861700000434,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "union_cte_split",
              "date_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 0.8885113161343754,
            "original_ms": 384.5468100001502,
            "optimized_ms": 432.79900099999696,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8784112355860457,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q5": {
        "query_id": "q5",
        "status": "WIN",
        "best_speedup": 1.89,
        "original_ms": 1169.49,
        "optimized_ms": 618.78,
        "original_sql": "WITH ssr AS\n  (SELECT s_store_id,\n          sum(sales_price) AS sales,\n          sum(profit) AS profit,\n          sum(return_amt) AS returns_,\n          sum(net_loss) AS profit_loss\n   FROM\n     (SELECT ss_store_sk AS store_sk,\n             ss_sold_date_sk AS date_sk,\n             ss_ext_sales_price AS sales_price,\n             ss_net_profit AS profit,\n             cast(0 AS decimal(7,2)) AS return_amt,\n             cast(0 AS decimal(7,2)) AS net_loss\n      FROM store_sales\n      UNION ALL SELECT sr_store_sk AS store_sk,\n                       sr_returned_date_sk AS date_sk,\n                       cast(0 AS decimal(7,2)) AS sales_price,\n                       cast(0 AS decimal(7,2)) AS profit,\n                       sr_return_amt AS return_amt,\n                       sr_net_loss AS net_loss\n      FROM store_returns ) salesreturns,\n        date_dim,\n        store\n   WHERE date_sk = d_date_sk\n     AND d_date BETWEEN cast('2000-08-23' AS date) AND cast('2000-09-06' AS date)\n     AND store_sk = s_store_sk\n   GROUP BY s_store_id) ,\n     csr AS\n  (SELECT cp_catalog_page_id,\n          sum(sales_price) AS sales,\n          sum(profit) AS profit,\n          sum(return_amt) AS returns_,\n          sum(net_loss) AS profit_loss\n   FROM\n     (SELECT cs_catalog_page_sk AS page_sk,\n             cs_sold_date_sk AS date_sk,\n             cs_ext_sales_price AS sales_price,\n             cs_net_profit AS profit,\n             cast(0 AS decimal(7,2)) AS return_amt,\n             cast(0 AS decimal(7,2)) AS net_loss\n      FROM catalog_sales\n      UNION ALL SELECT cr_catalog_page_sk AS page_sk,\n                       cr_returned_date_sk AS date_sk,\n                       cast(0 AS decimal(7,2)) AS sales_price,\n                       cast(0 AS decimal(7,2)) AS profit,\n                       cr_return_amount AS return_amt,\n                       cr_net_loss AS net_loss\n      FROM catalog_returns ) salesreturns,\n        date_dim,\n        catalog_page\n   WHERE date_sk = d_date_sk\n     AND d_date BETWEEN cast('2000-08-23' AS date) AND cast('2000-09-06' AS date)\n     AND page_sk = cp_catalog_page_sk\n   GROUP BY cp_catalog_page_id) ,\n     wsr AS\n  (SELECT web_site_id,\n          sum(sales_price) AS sales,\n          sum(profit) AS profit,\n          sum(return_amt) AS returns_,\n          sum(net_loss) AS profit_loss\n   FROM\n     (SELECT ws_web_site_sk AS wsr_web_site_sk,\n             ws_sold_date_sk AS date_sk,\n             ws_ext_sales_price AS sales_price,\n             ws_net_profit AS profit,\n             cast(0 AS decimal(7,2)) AS return_amt,\n             cast(0 AS decimal(7,2)) AS net_loss\n      FROM web_sales\n      UNION ALL SELECT ws_web_site_sk AS wsr_web_site_sk,\n                       wr_returned_date_sk AS date_sk,\n                       cast(0 AS decimal(7,2)) AS sales_price,\n                       cast(0 AS decimal(7,2)) AS profit,\n                       wr_return_amt AS return_amt,\n                       wr_net_loss AS net_loss\n      FROM web_returns\n      LEFT OUTER JOIN web_sales ON (wr_item_sk = ws_item_sk\n                                    AND wr_order_number = ws_order_number) ) salesreturns,\n        date_dim,\n        web_site\n   WHERE date_sk = d_date_sk\n     AND d_date BETWEEN cast('2000-08-23' AS date) AND cast('2000-09-06' AS date)\n     AND wsr_web_site_sk = web_site_sk\n   GROUP BY web_site_id)\nSELECT channel ,\n       id ,\n       sum(sales) AS sales ,\n       sum(returns_) AS returns_ ,\n       sum(profit) AS profit\nFROM\n  (SELECT 'store channel' AS channel ,\n          concat('store', s_store_id) AS id ,\n          sales ,\n          returns_ ,\n          (profit - profit_loss) AS profit\n   FROM ssr\n   UNION ALL SELECT 'catalog channel' AS channel ,\n                    concat('catalog_page', cp_catalog_page_id) AS id ,\n                    sales ,\n                    returns_ ,\n                    (profit - profit_loss) AS profit\n   FROM csr\n   UNION ALL SELECT 'web channel' AS channel ,\n                    concat('web_site', web_site_id) AS id ,\n                    sales ,\n                    returns_ ,\n                    (profit - profit_loss) AS profit\n   FROM wsr ) x\nGROUP BY ROLLUP (channel,\n                 id)\nORDER BY channel NULLS FIRST,\n         id NULLS FIRST\nLIMIT 100;\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('2000-08-23' AS DATE) AND CAST('2000-09-06' AS DATE)), ssr AS (SELECT s_store_id, SUM(sales_price) AS sales, SUM(profit) AS profit, SUM(return_amt) AS returns_, SUM(net_loss) AS profit_loss FROM (SELECT ss_store_sk AS store_sk, ss_sold_date_sk AS date_sk, ss_ext_sales_price AS sales_price, ss_net_profit AS profit, CAST(0 AS DECIMAL(7, 2)) AS return_amt, CAST(0 AS DECIMAL(7, 2)) AS net_loss FROM store_sales UNION ALL SELECT sr_store_sk AS store_sk, sr_returned_date_sk AS date_sk, CAST(0 AS DECIMAL(7, 2)) AS sales_price, CAST(0 AS DECIMAL(7, 2)) AS profit, sr_return_amt AS return_amt, sr_net_loss AS net_loss FROM store_returns) AS salesreturns JOIN filtered_dates ON salesreturns.date_sk = filtered_dates.d_date_sk JOIN store ON salesreturns.store_sk = store.s_store_sk GROUP BY s_store_id), wsr AS (SELECT web_site_id, SUM(sales_price) AS sales, SUM(profit) AS profit, SUM(return_amt) AS returns_, SUM(net_loss) AS profit_loss FROM (SELECT ws_web_site_sk AS wsr_web_site_sk, ws_sold_date_sk AS date_sk, ws_ext_sales_price AS sales_price, ws_net_profit AS profit, CAST(0 AS DECIMAL(7, 2)) AS return_amt, CAST(0 AS DECIMAL(7, 2)) AS net_loss FROM web_sales UNION ALL SELECT ws_web_site_sk AS wsr_web_site_sk, wr_returned_date_sk AS date_sk, CAST(0 AS DECIMAL(7, 2)) AS sales_price, CAST(0 AS DECIMAL(7, 2)) AS profit, wr_return_amt AS return_amt, wr_net_loss AS net_loss FROM web_returns LEFT OUTER JOIN web_sales ON (wr_item_sk = ws_item_sk AND wr_order_number = ws_order_number)) AS salesreturns JOIN filtered_dates ON salesreturns.date_sk = filtered_dates.d_date_sk JOIN web_site ON salesreturns.wsr_web_site_sk = web_site.web_site_sk GROUP BY web_site_id), csr AS (SELECT cp_catalog_page_id, SUM(sales_price) AS sales, SUM(profit) AS profit, SUM(return_amt) AS returns_, SUM(net_loss) AS profit_loss FROM (SELECT cs_catalog_page_sk AS page_sk, cs_sold_date_sk AS date_sk, cs_ext_sales_price AS sales_price, cs_net_profit AS profit, CAST(0 AS DECIMAL(7, 2)) AS return_amt, CAST(0 AS DECIMAL(7, 2)) AS net_loss FROM catalog_sales UNION ALL SELECT cr_catalog_page_sk AS page_sk, cr_returned_date_sk AS date_sk, CAST(0 AS DECIMAL(7, 2)) AS sales_price, CAST(0 AS DECIMAL(7, 2)) AS profit, cr_return_amount AS return_amt, cr_net_loss AS net_loss FROM catalog_returns) AS salesreturns JOIN filtered_dates ON salesreturns.date_sk = filtered_dates.d_date_sk JOIN catalog_page ON salesreturns.page_sk = catalog_page.cp_catalog_page_sk GROUP BY cp_catalog_page_id)\nSELECT channel, id, SUM(sales) AS sales, SUM(returns_) AS returns_, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, CONCAT('store', s_store_id) AS id, sales, returns_, (profit - profit_loss) AS profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, CONCAT('catalog_page', cp_catalog_page_id) AS id, sales, returns_, (profit - profit_loss) AS profit FROM csr UNION ALL SELECT 'web channel' AS channel, CONCAT('web_site', web_site_id) AS id, sales, returns_, (profit - profit_loss) AS profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel NULLS FIRST, id NULLS FIRST LIMIT 100",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('2000-08-23' AS DATE) AND CAST('2000-09-06' AS DATE)\",\n        \"ssr\": \"SELECT s_store_id, SUM(sales_price) AS sales, SUM(profit) AS profit, SUM(return_amt) AS returns_, SUM(net_loss) AS profit_loss FROM (SELECT ss_store_sk AS store_sk, ss_sold_date_sk AS date_sk, ss_ext_sales_price AS sales_price, ss_net_profit AS profit, CAST(0 AS DECIMAL(7, 2)) AS return_amt, CAST(0 AS DECIMAL(7, 2)) AS net_loss FROM store_sales UNION ALL SELECT sr_store_sk AS store_sk, sr_returned_date_sk AS date_sk, CAST(0 AS DECIMAL(7, 2)) AS sales_price, CAST(0 AS DECIMAL(7, 2)) AS profit, sr_return_amt AS return_amt, sr_net_loss AS net_loss FROM store_returns) AS salesreturns JOIN filtered_dates ON salesreturns.date_sk = filtered_dates.d_date_sk JOIN store ON salesreturns.store_sk = store.s_store_sk GROUP BY s_store_id\",\n        \"wsr\": \"SELECT web_site_id, SUM(sales_price) AS sales, SUM(profit) AS profit, SUM(return_amt) AS returns_, SUM(net_loss) AS profit_loss FROM (SELECT ws_web_site_sk AS wsr_web_site_sk, ws_sold_date_sk AS date_sk, ws_ext_sales_price AS sales_price, ws_net_profit AS profit, CAST(0 AS DECIMAL(7, 2)) AS return_amt, CAST(0 AS DECIMAL(7, 2)) AS net_loss FROM web_sales UNION ALL SELECT ws_web_site_sk AS wsr_web_site_sk, wr_returned_date_sk AS date_sk, CAST(0 AS DECIMAL(7, 2)) AS sales_price, CAST(0 AS DECIMAL(7, 2)) AS profit, wr_return_amt AS return_amt, wr_net_loss AS net_loss FROM web_returns LEFT OUTER JOIN web_sales ON (wr_item_sk = ws_item_sk AND wr_order_number = ws_order_number)) AS salesreturns JOIN filtered_dates ON salesreturns.date_sk = filtered_dates.d_date_sk JOIN web_site ON salesreturns.wsr_web_site_sk = web_site.web_site_sk GROUP BY web_site_id\",\n        \"csr\": \"SELECT cp_catalog_page_id, SUM(sales_price) AS sales, SUM(profit) AS profit, SUM(return_amt) AS returns_, SUM(net_loss) AS profit_loss FROM (SELECT cs_catalog_page_sk AS page_sk, cs_sold_date_sk AS date_sk, cs_ext_sales_price AS sales_price, cs_net_profit AS profit, CAST(0 AS DECIMAL(7, 2)) AS return_amt, CAST(0 AS DECIMAL(7, 2)) AS net_loss FROM catalog_sales UNION ALL SELECT cr_catalog_page_sk AS page_sk, cr_returned_date_sk AS date_sk, CAST(0 AS DECIMAL(7, 2)) AS sales_price, CAST(0 AS DECIMAL(7, 2)) AS profit, cr_return_amount AS return_amt, cr_net_loss AS net_loss FROM catalog_returns) AS salesreturns JOIN filtered_dates ON salesreturns.date_sk = filtered_dates.d_date_sk JOIN catalog_page ON salesreturns.page_sk = catalog_page.cp_catalog_page_sk GROUP BY cp_catalog_page_id\",\n        \"main_query\": \"SELECT channel, id, SUM(sales) AS sales, SUM(returns_) AS returns_, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, CONCAT('store', s_store_id) AS id, sales, returns_, (profit - profit_loss) AS profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, CONCAT('catalog_page', cp_catalog_page_id) AS id, sales, returns_, (profit - profit_loss) AS profit FROM csr UNION ALL SELECT 'web channel' AS channel, CONCAT('web_site', web_site_id) AS id, sales, returns_, (profit - profit_loss) AS profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel NULLS FIRST, id NULLS FIRST LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same output columns\",\n        \"same ordering\"\n      ],\n      \"expected_speedup\": \"2x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Isolated the date_dim filter into a single CTE (filtered_dates) that is reused across all three channel CTEs. This eliminates 3 separate scans of date_dim (each returning 15 rows) and allows the date filter to be applied early before joining with large fact tables.\"\n}\n```",
        "provenance": {
          "source": "Retry3W",
          "run": "retry_3worker_20260205_235909_details",
          "model": "deepseek-reasoner",
          "worker_id": 1,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.991421337511105,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.5508874952278973,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_date_dimension_isolation",
            "speedup": 1.3618019143409292,
            "original_ms": 569.8684803337528,
            "optimized_ms": 418.46649966676824,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.1458077765946144,
            "original_ms": 562.1897846661644,
            "optimized_ms": 490.6493009996969,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.09,
            "original_ms": 1169.49,
            "optimized_ms": 1074.1,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 1.0708821947491447,
            "original_ms": 569.8684803337528,
            "optimized_ms": 532.1486183335461,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_union_transform",
            "speedup": 1.0161772308739443,
            "original_ms": 569.8684803337528,
            "optimized_ms": 560.796348333497,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "union_cte_split",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.9046572187225531,
            "original_ms": 486.5363789995172,
            "optimized_ms": 537.8129626672793,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filter_pushdown",
            "speedup": 0,
            "original_ms": 569.8684803337528,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          }
        ]
      },
      "q50": {
        "query_id": "q50",
        "status": "IMPROVED",
        "best_speedup": 1.0956,
        "original_ms": 747.0,
        "optimized_ms": 681.79,
        "original_sql": "-- start query 50 in stream 0 using template query50.tpl\nselect \n   s_store_name\n  ,s_company_id\n  ,s_street_number\n  ,s_street_name\n  ,s_street_type\n  ,s_suite_number\n  ,s_city\n  ,s_county\n  ,s_state\n  ,s_zip\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\" \n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 30) and \n                 (sr_returned_date_sk - ss_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\" \n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 60) and \n                 (sr_returned_date_sk - ss_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\" \n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 90) and\n                 (sr_returned_date_sk - ss_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\" \n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\" \nfrom\n   store_sales\n  ,store_returns\n  ,store\n  ,date_dim d1\n  ,date_dim d2\nwhere\n    d2.d_year = 2001\nand d2.d_moy  = 8\nand ss_ticket_number = sr_ticket_number\nand ss_item_sk = sr_item_sk\nand ss_sold_date_sk   = d1.d_date_sk\nand sr_returned_date_sk   = d2.d_date_sk\nand ss_customer_sk = sr_customer_sk\nand ss_store_sk = s_store_sk\ngroup by\n   s_store_name\n  ,s_company_id\n  ,s_street_number\n  ,s_street_name\n  ,s_street_type\n  ,s_suite_number\n  ,s_city\n  ,s_county\n  ,s_state\n  ,s_zip\norder by s_store_name\n        ,s_company_id\n        ,s_street_number\n        ,s_street_name\n        ,s_street_type\n        ,s_suite_number\n        ,s_city\n        ,s_county\n        ,s_state\n        ,s_zip\n LIMIT 100;\n\n-- end query 50 in stream 0 using template query50.tpl\n",
        "optimized_sql": "WITH filtered_d2 AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 2001\n      AND d_moy = 8\n),\nfiltered_store_returns AS (\n    SELECT sr_returned_date_sk,\n           sr_ticket_number,\n           sr_item_sk,\n           sr_customer_sk\n    FROM store_returns\n    INNER JOIN filtered_d2 ON sr_returned_date_sk = filtered_d2.d_date_sk\n),\nsales_joined AS (\n    SELECT ss_sold_date_sk,\n           ss_ticket_number,\n           ss_item_sk,\n           ss_customer_sk,\n           ss_store_sk,\n           sr_returned_date_sk\n    FROM store_sales\n    INNER JOIN filtered_store_returns\n        ON ss_ticket_number = sr_ticket_number\n       AND ss_item_sk = sr_item_sk\n       AND ss_customer_sk = sr_customer_sk\n)\nSELECT s_store_name,\n       s_company_id,\n       s_street_number,\n       s_street_name,\n       s_street_type,\n       s_suite_number,\n       s_city,\n       s_county,\n       s_state,\n       s_zip,\n       SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\",\n       SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 30 AND sr_returned_date_sk - ss_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\",\n       SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 60 AND sr_returned_date_sk - ss_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\",\n       SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 90 AND sr_returned_date_sk - ss_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\",\n       SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\"\nFROM sales_joined\nINNER JOIN store ON ss_store_sk = s_store_sk\nGROUP BY s_store_name,\n         s_company_id,\n         s_street_number,\n         s_street_name,\n         s_street_type,\n         s_suite_number,\n         s_city,\n         s_county,\n         s_state,\n         s_zip\nORDER BY s_store_name,\n         s_company_id,\n         s_street_number,\n         s_street_name,\n         s_street_type,\n         s_suite_number,\n         s_city,\n         s_county,\n         s_state,\n         s_zip\nLIMIT 100;",
        "transforms": [
          "date_cte_isolate",
          "dimension_cte_isolate",
          "multi_date_range_cte"
        ],
        "principle": "date_cte_isolate",
        "changes_description": "Isolated date_dim filter for d2 into a CTE (`filtered_d2`), then used it to pre-filter `store_returns`. Created a `sales_joined` CTE that joins the filtered returns with `store_sales` early, reducing data before the final join with `store`. This enables predicate pushdown and reduces the working set for the main aggregation.",
        "reasoning": "```sql\nWITH filtered_d2 AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 2001\n      AND d_moy = 8\n),\nfiltered_store_returns AS (\n    SELECT sr_returned_date_sk,\n           sr_ticket_number,\n           sr_item_sk,\n           sr_customer_sk\n    FROM store_returns\n    INNER JOIN filtered_d2 ON sr_returned_date_sk = filtered_d2.d_date_sk\n),\nsales_joined AS (\n    SELECT ss_sold_date_sk,\n           ss_ticket_number,\n           ss_item_sk,\n           ss_customer_sk,\n           ss_store_sk,\n           sr_returned_date_sk\n    FROM store_sales\n    INNER JOIN filtered_store_returns\n        ON ss_ticket_number = sr_ticket_number\n       AND ss_item_sk = sr_item_sk\n       AND ss_customer_sk = sr_customer_sk\n)\nSELECT s_store_name,\n       s_company_id,\n       s_street_number,\n       s_street_name,\n       s_street_type,\n       s_suite_number,\n       s_city,\n       s_county,\n       s_state,\n       s_zip,\n       SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\",\n       SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 30 AND sr_returned_date_sk - ss_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\",\n       SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 60 AND sr_returned_date_sk - ss_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\",\n       SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 90 AND sr_returned_date_sk - ss_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\",\n       SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\"\nFROM sales_joined\nINNER JOIN store ON ss_store_sk = s_store_sk\nGROUP BY s_store_name,\n         s_company_id,\n         s_street_number,\n         s_street_name,\n         s_street_type,\n         s_suite_number,\n         s_city,\n         s_county,\n         s_state,\n         s_zip\nORDER BY s_store_name,\n         s_company_id,\n         s_street_number,\n         s_street_name,\n         s_street_type,\n         s_suite_number,\n         s_city,\n         s_county,\n         s_state,\n         s_zip\nLIMIT 100;\n```\n\nChanges: Isolated date_dim filter for d2 into a CTE (`filtered_d2`), then used it to pre-filter `store_returns`. Created a `sales_joined` CTE that joins the filtered returns with `store_sales` early, reducing data before the final join with `store`. This enables predicate pushdown and reduces the working set for the main aggregation.\n\nExpected speedup: 1.5-2x due to early filtering of the large `store_returns` table using the small date dimension CTE, and reduction of join cardinality before the final store join.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 2,
          "iteration": 0,
          "strategy": "moderate_date_dimension_isolation"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_date_dimension_isolation",
            "speedup": 1.0956482025127572,
            "original_ms": 746.9970930002697,
            "optimized_ms": 681.7855323333788,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_cte_restructure",
            "speedup": 1.0791120688110658,
            "original_ms": 746.9970930002697,
            "optimized_ms": 692.2331003333966,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch",
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.0349933280290091,
            "original_ms": 746.9970930002697,
            "optimized_ms": 721.7409743334429,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.0229041583885914,
            "original_ms": 737.8573559999495,
            "optimized_ms": 721.335767333585,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filter",
            "speedup": 0.9650061386022094,
            "original_ms": 746.9970930002697,
            "optimized_ms": 774.0853276667016,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.91,
            "original_ms": 1007.8,
            "optimized_ms": 1105.64,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0,
            "original_ms": 687.1788453336194,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q51": {
        "query_id": "q51",
        "status": "WIN",
        "best_speedup": 1.82,
        "original_ms": 7935.14,
        "optimized_ms": 4359.97,
        "original_sql": "-- start query 51 in stream 0 using template query51.tpl\nWITH web_v1 as (\nselect\n  ws_item_sk item_sk, d_date,\n  sum(sum(ws_sales_price))\n      over (partition by ws_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom web_sales\n    ,date_dim\nwhere ws_sold_date_sk=d_date_sk\n  and d_month_seq between 1216 and 1216+11\n  and ws_item_sk is not NULL\ngroup by ws_item_sk, d_date),\nstore_v1 as (\nselect\n  ss_item_sk item_sk, d_date,\n  sum(sum(ss_sales_price))\n      over (partition by ss_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom store_sales\n    ,date_dim\nwhere ss_sold_date_sk=d_date_sk\n  and d_month_seq between 1216 and 1216+11\n  and ss_item_sk is not NULL\ngroup by ss_item_sk, d_date)\n select *\nfrom (select item_sk\n     ,d_date\n     ,web_sales\n     ,store_sales\n     ,max(web_sales)\n         over (partition by item_sk order by d_date rows between unbounded preceding and current row) web_cumulative\n     ,max(store_sales)\n         over (partition by item_sk order by d_date rows between unbounded preceding and current row) store_cumulative\n     from (select case when web.item_sk is not null then web.item_sk else store.item_sk end item_sk\n                 ,case when web.d_date is not null then web.d_date else store.d_date end d_date\n                 ,web.cume_sales web_sales\n                 ,store.cume_sales store_sales\n           from web_v1 web full outer join store_v1 store on (web.item_sk = store.item_sk\n                                                          and web.d_date = store.d_date)\n          )x )y\nwhere web_cumulative > store_cumulative\norder by item_sk\n        ,d_date\n LIMIT 100;\n\n-- end query 51 in stream 0 using template query51.tpl\n",
        "optimized_sql": "WITH web_v1 AS (SELECT ws_item_sk AS item_sk, d_date, SUM(SUM(ws_sales_price)) OVER (PARTITION BY ws_item_sk ORDER BY d_date rows BETWEEN UNBOUNDED preceding AND CURRENT ROW) AS cume_sales FROM web_sales, date_dim WHERE ws_sold_date_sk = d_date_sk AND d_month_seq BETWEEN 1216 AND 1216 + 11 AND NOT ws_item_sk IS NULL GROUP BY ws_item_sk, d_date), store_v1 AS (SELECT ss_item_sk AS item_sk, d_date, SUM(SUM(ss_sales_price)) OVER (PARTITION BY ss_item_sk ORDER BY d_date rows BETWEEN UNBOUNDED preceding AND CURRENT ROW) AS cume_sales FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_month_seq BETWEEN 1216 AND 1216 + 11 AND NOT ss_item_sk IS NULL GROUP BY ss_item_sk, d_date)\nSELECT item_sk, d_date, web_sales, store_sales, web_sales AS web_cumulative, store_sales AS store_cumulative FROM (SELECT CASE WHEN NOT web.item_sk IS NULL THEN web.item_sk ELSE store.item_sk END AS item_sk, CASE WHEN NOT web.d_date IS NULL THEN web.d_date ELSE store.d_date END AS d_date, web.cume_sales AS web_sales, store.cume_sales AS store_sales FROM web_v1 AS web FULL OUTER JOIN store_v1 AS store ON (web.item_sk = store.item_sk AND web.d_date = store.d_date)) AS x WHERE web_sales > store_sales ORDER BY item_sk, d_date LIMIT 100",
        "transforms": [
          "prefetch_fact_join"
        ],
        "principle": "prefetch_fact_join",
        "changes_description": null,
        "reasoning": " ```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"early_filter\",\n      \"nodes\": {\n        \"main_query\": \"SELECT item_sk, d_date, web_sales, store_sales, web_sales AS web_cumulative, store_sales AS store_cumulative FROM (SELECT CASE WHEN NOT web.item_sk IS NULL THEN web.item_sk ELSE store.item_sk END AS item_sk, CASE WHEN NOT web.d_date IS NULL THEN web.d_date ELSE store.d_date END AS d_date, web.cume_sales AS web_sales, store.cume_sales AS store_sales FROM web_v1 AS web FULL OUTER JOIN store_v1 AS store ON (web.item_sk = store.item_sk AND web.d_date = store.d_date)) AS x WHERE web_sales > store_sales ORDER BY item_sk, d_date LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\",\n        \"null handling preserved\"\n      ],\n      \"expected_speedup\": \"2.0x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Eliminated redundant MAX window functions in main_query. Since web_v1 and store_v1 already compute cumulative sales (running totals ordered by d_date), the MAX of these values over the same window frame equals the value itself (assuming non-decreasing cumulative sums). This allows removing two expensive window operations and pushing the comparison filter into the subquery to reduce data materialization earlier in the plan.\"\n}\n```",
        "provenance": {
          "source": "analyst_mode",
          "run": "kimi_k2.5",
          "model": "kimi-k2.5",
          "worker_id": null,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.51,
            "original_ms": 7935.14,
            "optimized_ms": 5247.13,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.275470311582983,
            "original_ms": 5541.298153333021,
            "optimized_ms": 4344.513630000317,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_date_dimension_restructure",
            "speedup": 1.250473647747917,
            "original_ms": 5126.915513667275,
            "optimized_ms": 4099.978854333131,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_channel_prefetch",
            "speedup": 0.9994087963878521,
            "original_ms": 5126.915513667275,
            "optimized_ms": 5129.94835766646,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filters",
            "speedup": 0.9938929868769738,
            "original_ms": 5126.915513667275,
            "optimized_ms": 5158.418040333648,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transforms",
            "speedup": 0.9825282257064738,
            "original_ms": 5126.915513667275,
            "optimized_ms": 5218.084711999836,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.7721820913956727,
            "original_ms": 4867.929201000152,
            "optimized_ms": 6304.120822333061,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q52": {
        "query_id": "q52",
        "status": "WIN",
        "best_speedup": 2.5,
        "original_ms": 238.82,
        "optimized_ms": 95.53,
        "original_sql": "SELECT dt.d_year,\n       item.i_brand_id brand_id,\n       item.i_brand brand,\n       sum(ss_ext_sales_price) ext_price\nFROM date_dim dt,\n     store_sales,\n     item\nWHERE dt.d_date_sk = store_sales.ss_sold_date_sk\n  AND store_sales.ss_item_sk = item.i_item_sk\n  AND item.i_manager_id = 1\n  AND dt.d_moy=11\n  AND dt.d_year=2000\nGROUP BY dt.d_year,\n         item.i_brand,\n         item.i_brand_id\nORDER BY dt.d_year,\n         ext_price DESC,\n         brand_id\nLIMIT 100 ;\n\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_year FROM date_dim WHERE d_moy = 11 AND d_year = 2000), filtered_items AS (SELECT i_item_sk, i_brand_id, i_brand FROM item WHERE i_manager_id = 1), joined_facts AS (SELECT ss_ext_sales_price, fd.d_year, fi.i_brand_id, fi.i_brand FROM store_sales AS ss JOIN filtered_dates AS fd ON ss.ss_sold_date_sk = fd.d_date_sk JOIN filtered_items AS fi ON ss.ss_item_sk = fi.i_item_sk)\nSELECT d_year, i_brand_id AS brand_id, i_brand AS brand, SUM(ss_ext_sales_price) AS ext_price FROM joined_facts GROUP BY d_year, i_brand, i_brand_id ORDER BY d_year, ext_price DESC, brand_id LIMIT 100",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk, d_year FROM date_dim WHERE d_moy = 11 AND d_year = 2000\",\n        \"filtered_items\": \"SELECT i_item_sk, i_brand_id, i_brand FROM item WHERE i_manager_id = 1\",\n        \"joined_facts\": \"SELECT ss_ext_sales_price, fd.d_year, fi.i_brand_id, fi.i_brand FROM store_sales ss JOIN filtered_dates fd ON ss.ss_sold_date_sk = fd.d_date_sk JOIN filtered_items fi ON ss.ss_item_sk = fi.i_item_sk\",\n        \"main_query\": \"SELECT d_year, i_brand_id AS brand_id, i_brand AS brand, SUM(ss_ext_sales_price) AS ext_price FROM joined_facts GROUP BY d_year, i_brand, i_brand_id ORDER BY d_year, ext_price DESC, brand_id LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\", \n        \"same ordering\",\n        \"same column output\",\n        \"same grouping and aggregation\"\n      ],\n      \"expected_speedup\": \"3.0x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Pre-filtered date_dim and item tables into separate CTEs using their selective predicates (d_moy=11, d_year=2000 and i_manager_id=1). Then joined store_sales with both filtered CTEs early to dramatically reduce the fact table rows before aggregation. This avoids scanning the entire store_sales table and applies filters at the earliest possible stage.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 2,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.76116092442498,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.08,
            "original_ms": 238.82,
            "optimized_ms": 221.71,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.0720385109381938,
            "original_ms": 170.18809366648688,
            "optimized_ms": 158.75184699992437,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0271162987928673,
            "original_ms": 172.82556433322802,
            "optimized_ms": 168.26289733338248,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructuring",
            "speedup": 1.0084204539668427,
            "original_ms": 172.82556433322802,
            "optimized_ms": 171.3824463331548,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filtering",
            "speedup": 1.0031477870841732,
            "original_ms": 172.82556433322802,
            "optimized_ms": 172.28325333356528,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.9729732181796189,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.9429797077015454,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.939112719194515,
            "original_ms": 153.4819633331305,
            "optimized_ms": 163.43295133386468,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.9218121054119779,
            "original_ms": 172.82556433322802,
            "optimized_ms": 187.48458966698914,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.7662287035113667,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q53": {
        "query_id": "q53",
        "status": "WIN",
        "best_speedup": 1.2056,
        "original_ms": 236.25,
        "optimized_ms": 195.95,
        "original_sql": "-- start query 53 in stream 0 using template query53.tpl\nselect * from \n(select i_manufact_id,\nsum(ss_sales_price) sum_sales,\navg(sum(ss_sales_price)) over (partition by i_manufact_id) avg_quarterly_sales\nfrom item, store_sales, date_dim, store\nwhere ss_item_sk = i_item_sk and\nss_sold_date_sk = d_date_sk and\nss_store_sk = s_store_sk and\nd_month_seq in (1200,1200+1,1200+2,1200+3,1200+4,1200+5,1200+6,1200+7,1200+8,1200+9,1200+10,1200+11) and\n((i_category in ('Books','Children','Electronics') and\ni_class in ('personal','portable','reference','self-help') and\ni_brand in ('scholaramalgamalg #14','scholaramalgamalg #7',\n\t\t'exportiunivamalg #9','scholaramalgamalg #9'))\nor(i_category in ('Women','Music','Men') and\ni_class in ('accessories','classical','fragrances','pants') and\ni_brand in ('amalgimporto #1','edu packscholar #1','exportiimporto #1',\n\t\t'importoamalg #1')))\ngroup by i_manufact_id, d_qoy ) tmp1\nwhere case when avg_quarterly_sales > 0 \n\tthen abs (sum_sales - avg_quarterly_sales)/ avg_quarterly_sales \n\telse null end > 0.1\norder by avg_quarterly_sales,\n\t sum_sales,\n\t i_manufact_id\n LIMIT 100;\n\n-- end query 53 in stream 0 using template query53.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (\n  SELECT d_date_sk, d_qoy\n  FROM date_dim\n  WHERE d_month_seq BETWEEN 1200 AND 1211\n),\nfiltered_items AS (\n  SELECT i_item_sk, i_manufact_id\n  FROM item\n  WHERE i_category IN ('Books', 'Children', 'Electronics')\n    AND i_class IN ('personal', 'portable', 'reference', 'self-help')\n    AND i_brand IN ('scholaramalgamalg #14', 'scholaramalgamalg #7', 'exportiunivamalg #9', 'scholaramalgamalg #9')\n  UNION ALL\n  SELECT i_item_sk, i_manufact_id\n  FROM item\n  WHERE i_category IN ('Women', 'Music', 'Men')\n    AND i_class IN ('accessories', 'classical', 'fragrances', 'pants')\n    AND i_brand IN ('amalgimporto #1', 'edu packscholar #1', 'exportiimporto #1', 'importoamalg #1')\n),\naggregated_sales AS (\n  SELECT\n    i.i_manufact_id,\n    d.d_qoy,\n    SUM(ss.ss_sales_price) AS sum_sales\n  FROM store_sales ss\n  JOIN filtered_items i ON ss.ss_item_sk = i.i_item_sk\n  JOIN filtered_dates d ON ss.ss_sold_date_sk = d.d_date_sk\n  GROUP BY i.i_manufact_id, d.d_qoy\n),\nwith_avg AS (\n  SELECT\n    i_manufact_id,\n    sum_sales,\n    AVG(sum_sales) OVER (PARTITION BY i_manufact_id) AS avg_quarterly_sales\n  FROM aggregated_sales\n)\nSELECT *\nFROM with_avg\nWHERE\n  CASE\n    WHEN avg_quarterly_sales > 0\n    THEN ABS(sum_sales - avg_quarterly_sales) / avg_quarterly_sales\n    ELSE NULL\n  END > 0.1\nORDER BY\n  avg_quarterly_sales,\n  sum_sales,\n  i_manufact_id\nLIMIT 100",
        "transforms": [
          "decorrelate",
          "or_to_union",
          "date_cte_isolate",
          "dimension_cte_isolate"
        ],
        "principle": "decorrelate",
        "changes_description": "Removed unnecessary store join, pre-filtered dimension tables using CTEs, decomposed OR condition into UNION ALL for better predicate optimization, and pre-aggregated sales before applying the window function.",
        "reasoning": "```sql\nWITH filtered_dates AS (\n  SELECT d_date_sk, d_qoy\n  FROM date_dim\n  WHERE d_month_seq BETWEEN 1200 AND 1211\n),\nfiltered_items AS (\n  SELECT i_item_sk, i_manufact_id\n  FROM item\n  WHERE i_category IN ('Books', 'Children', 'Electronics')\n    AND i_class IN ('personal', 'portable', 'reference', 'self-help')\n    AND i_brand IN ('scholaramalgamalg #14', 'scholaramalgamalg #7', 'exportiunivamalg #9', 'scholaramalgamalg #9')\n  UNION ALL\n  SELECT i_item_sk, i_manufact_id\n  FROM item\n  WHERE i_category IN ('Women', 'Music', 'Men')\n    AND i_class IN ('accessories', 'classical', 'fragrances', 'pants')\n    AND i_brand IN ('amalgimporto #1', 'edu packscholar #1', 'exportiimporto #1', 'importoamalg #1')\n),\naggregated_sales AS (\n  SELECT\n    i.i_manufact_id,\n    d.d_qoy,\n    SUM(ss.ss_sales_price) AS sum_sales\n  FROM store_sales ss\n  JOIN filtered_items i ON ss.ss_item_sk = i.i_item_sk\n  JOIN filtered_dates d ON ss.ss_sold_date_sk = d.d_date_sk\n  GROUP BY i.i_manufact_id, d.d_qoy\n),\nwith_avg AS (\n  SELECT\n    i_manufact_id,\n    sum_sales,\n    AVG(sum_sales) OVER (PARTITION BY i_manufact_id) AS avg_quarterly_sales\n  FROM aggregated_sales\n)\nSELECT *\nFROM with_avg\nWHERE\n  CASE\n    WHEN avg_quarterly_sales > 0\n    THEN ABS(sum_sales - avg_quarterly_sales) / avg_quarterly_sales\n    ELSE NULL\n  END > 0.1\nORDER BY\n  avg_quarterly_sales,\n  sum_sales,\n  i_manufact_id\nLIMIT 100\n```\n\nChanges: Removed unnecessary store join, pre-filtered dimension tables using CTEs, decomposed OR condition into UNION ALL for better predicate optimization, and pre-aggregated sales before applying the window function.\n\nExpected speedup: 2-3x from reduced join volume, early filtering, and better predicate evaluation.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 6,
          "iteration": 2,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.2056217519258987,
            "original_ms": 236.24628099969414,
            "optimized_ms": 195.95389733331103,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "or_to_union",
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_fact_prefetch",
            "speedup": 1.1806021162452764,
            "original_ms": 334.4477976667501,
            "optimized_ms": 283.2857853333432,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0565872693912004,
            "original_ms": 334.4477976667501,
            "optimized_ms": 316.53589566667506,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.0374518959805037,
            "original_ms": 373.71260333444906,
            "optimized_ms": 360.22162066728924,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_predicate_pushdown",
            "speedup": 0.9117479850880859,
            "original_ms": 334.4477976667501,
            "optimized_ms": 366.82044066643965,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.7816108556423373,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.6770930306538144,
            "original_ms": 334.4477976667501,
            "optimized_ms": 493.94659599996277,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.51,
            "original_ms": 355.59,
            "optimized_ms": 690.72,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q54": {
        "query_id": "q54",
        "status": "WIN",
        "best_speedup": 1.81,
        "original_ms": 389.15,
        "optimized_ms": 215.0,
        "original_sql": "WITH my_customers AS\n  (SELECT DISTINCT c_customer_sk,\n                   c_current_addr_sk\n   FROM\n     (SELECT cs_sold_date_sk sold_date_sk,\n             cs_bill_customer_sk customer_sk,\n             cs_item_sk item_sk\n      FROM catalog_sales\n      UNION ALL SELECT ws_sold_date_sk sold_date_sk,\n                       ws_bill_customer_sk customer_sk,\n                       ws_item_sk item_sk\n      FROM web_sales) cs_or_ws_sales,\n        item,\n        date_dim,\n        customer\n   WHERE sold_date_sk = d_date_sk\n     AND item_sk = i_item_sk\n     AND i_category = 'Women'\n     AND i_class = 'maternity'\n     AND c_customer_sk = cs_or_ws_sales.customer_sk\n     AND d_moy = 12\n     AND d_year = 1998 ),\n     my_revenue AS\n  (SELECT c_customer_sk,\n          sum(ss_ext_sales_price) AS revenue\n   FROM my_customers,\n        store_sales,\n        customer_address,\n        store,\n        date_dim\n   WHERE c_current_addr_sk = ca_address_sk\n     AND ca_county = s_county\n     AND ca_state = s_state\n     AND ss_sold_date_sk = d_date_sk\n     AND c_customer_sk = ss_customer_sk\n     AND d_month_seq BETWEEN\n       (SELECT DISTINCT d_month_seq+1\n        FROM date_dim\n        WHERE d_year = 1998\n          AND d_moy = 12) AND\n       (SELECT DISTINCT d_month_seq+3\n        FROM date_dim\n        WHERE d_year = 1998\n          AND d_moy = 12)\n   GROUP BY c_customer_sk),\n     segments AS\n  (SELECT cast(round(revenue/50) AS int) AS SEGMENT\n   FROM my_revenue)\nSELECT SEGMENT,\n       count(*) AS num_customers,\n       SEGMENT*50 AS segment_base\nFROM segments\nGROUP BY SEGMENT\nORDER BY SEGMENT NULLS FIRST,\n         num_customers NULLS FIRST,\n         segment_base\nLIMIT 100;\n\n",
        "optimized_sql": "WITH base_month_seq AS (SELECT DISTINCT d_month_seq FROM date_dim WHERE d_year = 1998 AND d_moy = 12), dec_1998_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998 AND d_moy = 12), next_three_months_dates AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN (SELECT d_month_seq FROM base_month_seq) + 1 AND (SELECT d_month_seq FROM base_month_seq) + 3), my_customers AS (SELECT DISTINCT c_customer_sk, c_current_addr_sk FROM (SELECT cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk FROM catalog_sales UNION ALL SELECT ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk FROM web_sales) AS cs_or_ws_sales JOIN dec_1998_dates AS d ON cs_or_ws_sales.sold_date_sk = d.d_date_sk JOIN item AS i ON cs_or_ws_sales.item_sk = i.i_item_sk JOIN customer AS c ON cs_or_ws_sales.customer_sk = c.c_customer_sk WHERE i.i_category = 'Women' AND i.i_class = 'maternity'), my_revenue AS (SELECT c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers AS mc JOIN store_sales AS ss ON mc.c_customer_sk = ss.ss_customer_sk JOIN customer_address AS ca ON mc.c_current_addr_sk = ca.ca_address_sk JOIN store AS s ON ca.ca_county = s.s_county AND ca.ca_state = s.s_state JOIN next_three_months_dates AS nd ON ss.ss_sold_date_sk = nd.d_date_sk GROUP BY c_customer_sk), segments AS (SELECT CAST(ROUND(revenue / 50) AS INT) AS SEGMENT FROM my_revenue)\nSELECT SEGMENT, COUNT(*) AS num_customers, SEGMENT * 50 AS segment_base FROM segments GROUP BY SEGMENT ORDER BY SEGMENT NULLS FIRST, num_customers NULLS FIRST, segment_base LIMIT 100",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"base_month_seq\": \"SELECT DISTINCT d_month_seq FROM date_dim WHERE d_year = 1998 AND d_moy = 12\",\n        \"dec_1998_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_year = 1998 AND d_moy = 12\",\n        \"next_three_months_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN (SELECT d_month_seq FROM base_month_seq) + 1 AND (SELECT d_month_seq FROM base_month_seq) + 3\",\n        \"my_customers\": \"SELECT DISTINCT c_customer_sk, c_current_addr_sk FROM (SELECT cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk FROM catalog_sales UNION ALL SELECT ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk FROM web_sales) AS cs_or_ws_sales JOIN dec_1998_dates d ON cs_or_ws_sales.sold_date_sk = d.d_date_sk JOIN item i ON cs_or_ws_sales.item_sk = i.i_item_sk JOIN customer c ON cs_or_ws_sales.customer_sk = c.c_customer_sk WHERE i.i_category = 'Women' AND i.i_class = 'maternity'\",\n        \"my_revenue\": \"SELECT c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers mc JOIN store_sales ss ON mc.c_customer_sk = ss.ss_customer_sk JOIN customer_address ca ON mc.c_current_addr_sk = ca.ca_address_sk JOIN store s ON ca.ca_county = s.s_county AND ca.ca_state = s.s_state JOIN next_three_months_dates nd ON ss.ss_sold_date_sk = nd.d_date_sk GROUP BY c_customer_sk\"\n      },\n      \"invariants_kept\": [\n        \"same output columns\",\n        \"same result rows\",\n        \"same grouping grain\"\n      ],\n      \"expected_speedup\": \"2.8x\",\n      \"risk\": \"low\"\n    },\n    {\n      \"id\": \"rs_02\",\n      \"transform\": \"early_filter\",\n      \"nodes\": {\n        \"filtered_item\": \"SELECT i_item_sk FROM item WHERE i_category = 'Women' AND i_class = 'maternity'\",\n        \"my_customers\": \"SELECT DISTINCT c_customer_sk, c_current_addr_sk FROM (SELECT cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk FROM catalog_sales JOIN dec_1998_dates d ON catalog_sales.cs_sold_date_sk = d.d_date_sk WHERE cs_item_sk IN (SELECT i_item_sk FROM filtered_item) UNION ALL SELECT ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk FROM web_sales JOIN dec_1998_dates d ON web_sales.ws_sold_date_sk = d.d_date_sk WHERE ws_item_sk IN (SELECT i_item_sk FROM filtered_item)) AS cs_or_ws_sales JOIN customer c ON cs_or_ws_sales.customer_sk = c.c_customer_sk\"\n      },\n      \"invariants_kept\": [\n        \"same output columns\",\n        \"same result rows\"\n      ],\n      \"expected_speedup\": \"1.4x\",\n      \"risk\": \"medium\"\n    }\n  ],\n  \"explanation\": \"Isolated date_dim filters into reusable CTEs (dec_1998_dates, next_three_months_dates) to avoid repeated scans and decorrelate the date range subquery. Also pushed item filter early to reduce catalog_sales/web_sales joins. This reduces 4 date_dim scans to 1, eliminates correlated subqueries, and filters item early.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 1,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.688929925186359,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "decorrelate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.197602421984918,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0496298719415735,
            "original_ms": 254.49864999973215,
            "optimized_ms": 242.46513633321834,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.03,
            "original_ms": 389.15,
            "optimized_ms": 377.1,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.0112751766611232,
            "original_ms": 252.78613200013447,
            "optimized_ms": 249.96770200050378,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.9797270995777922,
            "original_ms": 254.49864999973215,
            "optimized_ms": 259.76483666666655,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "intersect_to_exists",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.9306594845682643,
            "original_ms": 328.3822926672049,
            "optimized_ms": 352.8490259996033,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.33419529701422845,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "decorrelate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_reduction",
            "speedup": 0,
            "original_ms": 254.49864999973215,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 0,
            "original_ms": 254.49864999973215,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "union_cte_split"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q55": {
        "query_id": "q55",
        "status": "IMPROVED",
        "best_speedup": 1.0786,
        "original_ms": 197.22,
        "optimized_ms": 182.84,
        "original_sql": "-- start query 55 in stream 0 using template query55.tpl\nselect i_brand_id brand_id, i_brand brand,\n \tsum(ss_ext_sales_price) ext_price\n from date_dim, store_sales, item\n where d_date_sk = ss_sold_date_sk\n \tand ss_item_sk = i_item_sk\n \tand i_manager_id=100\n \tand d_moy=12\n \tand d_year=2000\n group by i_brand, i_brand_id\n order by ext_price desc, i_brand_id\n LIMIT 100;\n\n-- end query 55 in stream 0 using template query55.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_moy = 12\n      AND d_year = 2000\n),\nfiltered_items AS (\n    SELECT i_item_sk, i_brand_id, i_brand\n    FROM item\n    WHERE i_manager_id = 100\n)\nSELECT\n    fi.i_brand_id AS brand_id,\n    fi.i_brand AS brand,\n    SUM(ss.ss_ext_sales_price) AS ext_price\nFROM store_sales ss\nJOIN filtered_dates fd ON ss.ss_sold_date_sk = fd.d_date_sk\nJOIN filtered_items fi ON ss.ss_item_sk = fi.i_item_sk\nGROUP BY\n    fi.i_brand_id,\n    fi.i_brand\nORDER BY\n    ext_price DESC,\n    brand_id\nLIMIT 100",
        "transforms": [
          "date_cte_isolate",
          "dimension_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": "Applied \"multi_dimension_prefetch\" strategy by isolating both selective dimension filters (date_dim with month/year and item with manager) into separate CTEs before joining with the large store_sales fact table. This reduces hash table build sizes and enables early filtering.",
        "reasoning": "```sql\nWITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_moy = 12\n      AND d_year = 2000\n),\nfiltered_items AS (\n    SELECT i_item_sk, i_brand_id, i_brand\n    FROM item\n    WHERE i_manager_id = 100\n)\nSELECT\n    fi.i_brand_id AS brand_id,\n    fi.i_brand AS brand,\n    SUM(ss.ss_ext_sales_price) AS ext_price\nFROM store_sales ss\nJOIN filtered_dates fd ON ss.ss_sold_date_sk = fd.d_date_sk\nJOIN filtered_items fi ON ss.ss_item_sk = fi.i_item_sk\nGROUP BY\n    fi.i_brand_id,\n    fi.i_brand\nORDER BY\n    ext_price DESC,\n    brand_id\nLIMIT 100\n```\n\nChanges: Applied \"multi_dimension_prefetch\" strategy by isolating both selective dimension filters (date_dim with month/year and item with manager) into separate CTEs before joining with the large store_sales fact table. This reduces hash table build sizes and enables early filtering.\n\nExpected speedup: 2.3-2.8x",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 5,
          "iteration": 1,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.0786036949666646,
            "original_ms": 197.21652499962752,
            "optimized_ms": 182.844288333096,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filter_pushdown",
            "speedup": 0.9933495255604163,
            "original_ms": 156.5932436666723,
            "optimized_ms": 157.64163533306905,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transformation",
            "speedup": 0.9626842781810501,
            "original_ms": 156.5932436666723,
            "optimized_ms": 162.66313599984036,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_cte_restructuring",
            "speedup": 0.9511239325052798,
            "original_ms": 156.5932436666723,
            "optimized_ms": 164.64020966668613,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_date_range_cte",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.94,
            "original_ms": 227.83,
            "optimized_ms": 243.37,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "dimension_isolation_prefetch",
            "speedup": 0.9312183437405103,
            "original_ms": 156.5932436666723,
            "optimized_ms": 168.159534999783,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "multi_dimension_prefetch",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.9294859456578749,
            "original_ms": 146.36781533287527,
            "optimized_ms": 157.47178966679107,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q56": {
        "query_id": "q56",
        "status": "WIN",
        "best_speedup": 1.3527,
        "original_ms": 329.78,
        "optimized_ms": 243.79,
        "original_sql": "-- start query 56 in stream 0 using template query56.tpl\nwith ss as (\n select i_item_id,sum(ss_ext_sales_price) total_sales\n from\n \tstore_sales,\n \tdate_dim,\n         customer_address,\n         item\n where i_item_id in (select\n     i_item_id\nfrom item\nwhere i_color in ('powder','green','cyan'))\n and     ss_item_sk              = i_item_sk\n and     ss_sold_date_sk         = d_date_sk\n and     d_year                  = 2000\n and     d_moy                   = 2\n and     ss_addr_sk              = ca_address_sk\n and     ca_gmt_offset           = -6 \n group by i_item_id),\n cs as (\n select i_item_id,sum(cs_ext_sales_price) total_sales\n from\n \tcatalog_sales,\n \tdate_dim,\n         customer_address,\n         item\n where\n         i_item_id               in (select\n  i_item_id\nfrom item\nwhere i_color in ('powder','green','cyan'))\n and     cs_item_sk              = i_item_sk\n and     cs_sold_date_sk         = d_date_sk\n and     d_year                  = 2000\n and     d_moy                   = 2\n and     cs_bill_addr_sk         = ca_address_sk\n and     ca_gmt_offset           = -6 \n group by i_item_id),\n ws as (\n select i_item_id,sum(ws_ext_sales_price) total_sales\n from\n \tweb_sales,\n \tdate_dim,\n         customer_address,\n         item\n where\n         i_item_id               in (select\n  i_item_id\nfrom item\nwhere i_color in ('powder','green','cyan'))\n and     ws_item_sk              = i_item_sk\n and     ws_sold_date_sk         = d_date_sk\n and     d_year                  = 2000\n and     d_moy                   = 2\n and     ws_bill_addr_sk         = ca_address_sk\n and     ca_gmt_offset           = -6\n group by i_item_id)\n  select i_item_id ,sum(total_sales) total_sales\n from  (select * from ss \n        union all\n        select * from cs \n        union all\n        select * from ws) tmp1\n group by i_item_id\n order by total_sales,\n          i_item_id\n LIMIT 100;\n\n-- end query 56 in stream 0 using template query56.tpl\n",
        "optimized_sql": "WITH filtered_items AS (\n  SELECT i_item_id, i_item_sk\n  FROM item\n  WHERE i_color IN ('powder', 'green', 'cyan')\n),\nfiltered_dates AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 2000\n    AND d_moy = 2\n),\nfiltered_addresses AS (\n  SELECT ca_address_sk\n  FROM customer_address\n  WHERE ca_gmt_offset = -6\n),\nss AS (\n  SELECT\n    fi.i_item_id,\n    SUM(ss_ext_sales_price) AS total_sales\n  FROM store_sales\n  JOIN filtered_items fi ON ss_item_sk = fi.i_item_sk\n  JOIN filtered_dates fd ON ss_sold_date_sk = fd.d_date_sk\n  JOIN filtered_addresses fa ON ss_addr_sk = fa.ca_address_sk\n  GROUP BY fi.i_item_id\n),\ncs AS (\n  SELECT\n    fi.i_item_id,\n    SUM(cs_ext_sales_price) AS total_sales\n  FROM catalog_sales\n  JOIN filtered_items fi ON cs_item_sk = fi.i_item_sk\n  JOIN filtered_dates fd ON cs_sold_date_sk = fd.d_date_sk\n  JOIN filtered_addresses fa ON cs_bill_addr_sk = fa.ca_address_sk\n  GROUP BY fi.i_item_id\n),\nws AS (\n  SELECT\n    fi.i_item_id,\n    SUM(ws_ext_sales_price) AS total_sales\n  FROM web_sales\n  JOIN filtered_items fi ON ws_item_sk = fi.i_item_sk\n  JOIN filtered_dates fd ON ws_sold_date_sk = fd.d_date_sk\n  JOIN filtered_addresses fa ON ws_bill_addr_sk = fa.ca_address_sk\n  GROUP BY fi.i_item_id\n)\nSELECT\n  i_item_id,\n  SUM(total_sales) AS total_sales\nFROM (\n  SELECT * FROM ss\n  UNION ALL\n  SELECT * FROM cs\n  UNION ALL\n  SELECT * FROM ws\n) AS tmp1\nGROUP BY i_item_id\nORDER BY total_sales, i_item_id\nLIMIT 100",
        "transforms": [
          "decorrelate",
          "date_cte_isolate",
          "multi_dimension_prefetch"
        ],
        "principle": "decorrelate",
        "changes_description": null,
        "reasoning": "```sql\nWITH filtered_items AS (\n  SELECT i_item_id, i_item_sk\n  FROM item\n  WHERE i_color IN ('powder', 'green', 'cyan')\n),\nfiltered_dates AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 2000\n    AND d_moy = 2\n),\nfiltered_addresses AS (\n  SELECT ca_address_sk\n  FROM customer_address\n  WHERE ca_gmt_offset = -6\n),\nss AS (\n  SELECT\n    fi.i_item_id,\n    SUM(ss_ext_sales_price) AS total_sales\n  FROM store_sales\n  JOIN filtered_items fi ON ss_item_sk = fi.i_item_sk\n  JOIN filtered_dates fd ON ss_sold_date_sk = fd.d_date_sk\n  JOIN filtered_addresses fa ON ss_addr_sk = fa.ca_address_sk\n  GROUP BY fi.i_item_id\n),\ncs AS (\n  SELECT\n    fi.i_item_id,\n    SUM(cs_ext_sales_price) AS total_sales\n  FROM catalog_sales\n  JOIN filtered_items fi ON cs_item_sk = fi.i_item_sk\n  JOIN filtered_dates fd ON cs_sold_date_sk = fd.d_date_sk\n  JOIN filtered_addresses fa ON cs_bill_addr_sk = fa.ca_address_sk\n  GROUP BY fi.i_item_id\n),\nws AS (\n  SELECT\n    fi.i_item_id,\n    SUM(ws_ext_sales_price) AS total_sales\n  FROM web_sales\n  JOIN filtered_items fi ON ws_item_sk = fi.i_item_sk\n  JOIN filtered_dates fd ON ws_sold_date_sk = fd.d_date_sk\n  JOIN filtered_addresses fa ON ws_bill_addr_sk = fa.ca_address_sk\n  GROUP BY fi.i_item_id\n)\nSELECT\n  i_item_id,\n  SUM(total_sales) AS total_sales\nFROM (\n  SELECT * FROM ss\n  UNION ALL\n  SELECT * FROM cs\n  UNION ALL\n  SELECT * FROM ws\n) AS tmp1\nGROUP BY i_item_id\nORDER BY total_sales, i_item_id\nLIMIT 100\n```\n\n**Changes**: Extracted shared dimension filters (items by color, dates for Feb 2000, addresses with GMT offset -6) into dedicated CTEs, eliminating redundant IN subqueries and allowing each channel CTE to reference pre-filtered dimension tables via efficient joins.\n\n**Expected speedup**: 1.8-2.2x. The rewrite avoids repeating the same subquery 3 times per channel CTE and allows the optimizer to push dimension filters directly into joins. Shared dimension CTEs are computed once and reused across all channels, reducing redundant scans.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 5,
          "iteration": 1,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.3526863954165276,
            "original_ms": 329.7763320000134,
            "optimized_ms": 243.79363399930298,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown",
            "speedup": 1.1915897057130815,
            "original_ms": 293.061559000004,
            "optimized_ms": 245.94166733307551,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 1.1819139994000887,
            "original_ms": 293.061559000004,
            "optimized_ms": 247.95506200007367,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "dimension_isolation",
            "speedup": 1.1092558471117924,
            "original_ms": 293.061559000004,
            "optimized_ms": 264.1965419998087,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "structural_transform",
            "speedup": 1.108791460815752,
            "original_ms": 293.061559000004,
            "optimized_ms": 264.3071933331764,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "decorrelate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.92,
            "original_ms": 349.29,
            "optimized_ms": 377.84,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0,
            "original_ms": 252.08547699973374,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q57": {
        "query_id": "q57",
        "status": "WIN",
        "best_speedup": 1.4869,
        "original_ms": 670.24,
        "optimized_ms": 450.75,
        "original_sql": "-- start query 57 in stream 0 using template query57.tpl\nwith v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 1999 or\n         ( d_year = 1999-1 and d_moy =12) or\n         ( d_year = 1999+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.i_brand\n        ,v1.d_year\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select *\n from v2\n where  d_year = 1999 and\n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n order by sum_sales - avg_monthly_sales, nsum\n LIMIT 100;\n\n-- end query 57 in stream 0 using template query57.tpl\n",
        "optimized_sql": "WITH monthly_sales AS (\n  SELECT\n    i.i_category,\n    i.i_brand,\n    cc.cc_name,\n    d.d_year,\n    d.d_moy,\n    SUM(cs.cs_sales_price) AS sum_sales\n  FROM catalog_sales cs\n  JOIN item i ON cs.cs_item_sk = i.i_item_sk\n  JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk\n  JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk\n  WHERE (d.d_year = 1999)\n     OR (d.d_year = 1998 AND d.d_moy = 12)\n     OR (d.d_year = 2000 AND d.d_moy = 1)\n  GROUP BY i.i_category, i.i_brand, cc.cc_name, d.d_year, d.d_moy\n),\nyearly_avg AS (\n  SELECT\n    i_category,\n    i_brand,\n    cc_name,\n    d_year,\n    AVG(sum_sales) AS avg_monthly_sales\n  FROM monthly_sales\n  WHERE d_year = 1999\n  GROUP BY i_category, i_brand, cc_name, d_year\n),\nwith_adjacent AS (\n  SELECT\n    m.i_brand,\n    m.d_year,\n    a.avg_monthly_sales,\n    m.sum_sales,\n    LAG(m.sum_sales) OVER (PARTITION BY m.i_category, m.i_brand, m.cc_name ORDER BY m.d_year, m.d_moy) AS psum,\n    LEAD(m.sum_sales) OVER (PARTITION BY m.i_category, m.i_brand, m.cc_name ORDER BY m.d_year, m.d_moy) AS nsum\n  FROM monthly_sales m\n  LEFT JOIN yearly_avg a ON m.i_category = a.i_category\n    AND m.i_brand = a.i_brand\n    AND m.cc_name = a.cc_name\n    AND m.d_year = a.d_year\n  WHERE m.d_year = 1999\n)\nSELECT\n  i_brand,\n  d_year,\n  avg_monthly_sales,\n  sum_sales,\n  psum,\n  nsum\nFROM with_adjacent\nWHERE avg_monthly_sales > 0\n  AND ABS(sum_sales - avg_monthly_sales) / avg_monthly_sales > 0.1\nORDER BY sum_sales - avg_monthly_sales, nsum\nLIMIT 100",
        "transforms": [
          "prefetch_fact_join"
        ],
        "principle": "prefetch_fact_join",
        "changes_description": "** Eliminated expensive triple self-join in v2 by using LAG/LEAD window functions. Pre-computed yearly averages in a separate CTE, reducing window function computation. Applied explicit JOIN syntax and early filtering to reduce intermediate data volume.\n\n**Expected speedup:** 2.5-3.0x (avoids O(n\u00b2) self-join, reduces window function computation, and pushes filters earlier)",
        "reasoning": "```sql\nWITH monthly_sales AS (\n  SELECT\n    i.i_category,\n    i.i_brand,\n    cc.cc_name,\n    d.d_year,\n    d.d_moy,\n    SUM(cs.cs_sales_price) AS sum_sales\n  FROM catalog_sales cs\n  JOIN item i ON cs.cs_item_sk = i.i_item_sk\n  JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk\n  JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk\n  WHERE (d.d_year = 1999)\n     OR (d.d_year = 1998 AND d.d_moy = 12)\n     OR (d.d_year = 2000 AND d.d_moy = 1)\n  GROUP BY i.i_category, i.i_brand, cc.cc_name, d.d_year, d.d_moy\n),\nyearly_avg AS (\n  SELECT\n    i_category,\n    i_brand,\n    cc_name,\n    d_year,\n    AVG(sum_sales) AS avg_monthly_sales\n  FROM monthly_sales\n  WHERE d_year = 1999\n  GROUP BY i_category, i_brand, cc_name, d_year\n),\nwith_adjacent AS (\n  SELECT\n    m.i_brand,\n    m.d_year,\n    a.avg_monthly_sales,\n    m.sum_sales,\n    LAG(m.sum_sales) OVER (PARTITION BY m.i_category, m.i_brand, m.cc_name ORDER BY m.d_year, m.d_moy) AS psum,\n    LEAD(m.sum_sales) OVER (PARTITION BY m.i_category, m.i_brand, m.cc_name ORDER BY m.d_year, m.d_moy) AS nsum\n  FROM monthly_sales m\n  LEFT JOIN yearly_avg a ON m.i_category = a.i_category\n    AND m.i_brand = a.i_brand\n    AND m.cc_name = a.cc_name\n    AND m.d_year = a.d_year\n  WHERE m.d_year = 1999\n)\nSELECT\n  i_brand,\n  d_year,\n  avg_monthly_sales,\n  sum_sales,\n  psum,\n  nsum\nFROM with_adjacent\nWHERE avg_monthly_sales > 0\n  AND ABS(sum_sales - avg_monthly_sales) / avg_monthly_sales > 0.1\nORDER BY sum_sales - avg_monthly_sales, nsum\nLIMIT 100\n```\n\n**Changes:** Eliminated expensive triple self-join in v2 by using LAG/LEAD window functions. Pre-computed yearly averages in a separate CTE, reducing window function computation. Applied explicit JOIN syntax and early filtering to reduce intermediate data volume.\n\n**Expected speedup:** 2.5-3.0x (avoids O(n\u00b2) self-join, reduces window function computation, and pushes filters earlier)",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 5,
          "iteration": 1,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 2.107652952467987,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.4869344075425184,
            "original_ms": 670.2413593326734,
            "optimized_ms": 450.7538166665957,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.2577225864588806,
            "original_ms": 663.2483393338285,
            "optimized_ms": 527.3407239995626,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_filter_pushdown",
            "speedup": 1.1614768623993075,
            "original_ms": 732.0110136667305,
            "optimized_ms": 630.2415806670373,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.1044555215937641,
            "original_ms": 732.0110136667305,
            "optimized_ms": 662.7799846664857,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructuring",
            "speedup": 1.0395670974668447,
            "original_ms": 732.0110136667305,
            "optimized_ms": 704.1498479996638,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.02,
            "original_ms": 1316.85,
            "optimized_ms": 1290.07,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.858234796746331,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "or_to_union"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.844017760050283,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.7159104228373429,
            "original_ms": 732.0110136667305,
            "optimized_ms": 1022.4896723329948,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q58": {
        "query_id": "q58",
        "status": "WIN",
        "best_speedup": 1.64,
        "original_ms": 269.02,
        "optimized_ms": 164.04,
        "original_sql": "WITH ss_items AS\n  (SELECT i_item_id item_id,\n          sum(ss_ext_sales_price) ss_item_rev\n   FROM store_sales,\n        item,\n        date_dim\n   WHERE ss_item_sk = i_item_sk\n     AND d_date IN\n       (SELECT d_date\n        FROM date_dim\n        WHERE d_week_seq =\n            (SELECT d_week_seq\n             FROM date_dim\n             WHERE d_date = '2000-01-03'))\n     AND ss_sold_date_sk = d_date_sk\n   GROUP BY i_item_id),\n     cs_items AS\n  (SELECT i_item_id item_id,\n          sum(cs_ext_sales_price) cs_item_rev\n   FROM catalog_sales,\n        item,\n        date_dim\n   WHERE cs_item_sk = i_item_sk\n     AND d_date IN\n       (SELECT d_date\n        FROM date_dim\n        WHERE d_week_seq =\n            (SELECT d_week_seq\n             FROM date_dim\n             WHERE d_date = '2000-01-03'))\n     AND cs_sold_date_sk = d_date_sk\n   GROUP BY i_item_id),\n     ws_items AS\n  (SELECT i_item_id item_id,\n          sum(ws_ext_sales_price) ws_item_rev\n   FROM web_sales,\n        item,\n        date_dim\n   WHERE ws_item_sk = i_item_sk\n     AND d_date IN\n       (SELECT d_date\n        FROM date_dim\n        WHERE d_week_seq =\n            (SELECT d_week_seq\n             FROM date_dim\n             WHERE d_date = '2000-01-03'))\n     AND ws_sold_date_sk = d_date_sk\n   GROUP BY i_item_id)\nSELECT ss_items.item_id,\n       ss_item_rev,\n       ss_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 ss_dev,\n       cs_item_rev,\n       cs_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 cs_dev,\n       ws_item_rev,\n       ws_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 ws_dev,\n       (ss_item_rev+cs_item_rev+ws_item_rev)/3 average\nFROM ss_items,\n     cs_items,\n     ws_items\nWHERE ss_items.item_id=cs_items.item_id\n  AND ss_items.item_id=ws_items.item_id\n  AND ss_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev\n  AND ss_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev\n  AND cs_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev\n  AND cs_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev\n  AND ws_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev\n  AND ws_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev\nORDER BY ss_items.item_id NULLS FIRST,\n         ss_item_rev NULLS FIRST\nLIMIT 100;\n\n",
        "optimized_sql": "WITH week_dates AS (SELECT d_date_sk FROM date_dim WHERE d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_date = '2000-01-03')), ss_items AS (SELECT i_item_id AS item_id, SUM(ss_ext_sales_price) AS ss_item_rev FROM store_sales JOIN item ON ss_item_sk = i_item_sk JOIN week_dates ON store_sales.ss_sold_date_sk = week_dates.d_date_sk GROUP BY i_item_id), ws_items AS (SELECT i_item_id AS item_id, SUM(ws_ext_sales_price) AS ws_item_rev FROM web_sales JOIN item ON ws_item_sk = i_item_sk JOIN week_dates ON web_sales.ws_sold_date_sk = week_dates.d_date_sk GROUP BY i_item_id), cs_items AS (SELECT i_item_id AS item_id, SUM(cs_ext_sales_price) AS cs_item_rev FROM catalog_sales JOIN item ON cs_item_sk = i_item_sk JOIN week_dates ON catalog_sales.cs_sold_date_sk = week_dates.d_date_sk GROUP BY i_item_id)\nSELECT ss_items.item_id, ss_item_rev, ss_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ss_dev, cs_item_rev, cs_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS cs_dev, ws_item_rev, ws_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ws_dev, (ss_item_rev + cs_item_rev + ws_item_rev) / 3 AS average FROM ss_items, cs_items, ws_items WHERE ss_items.item_id = cs_items.item_id AND ss_items.item_id = ws_items.item_id AND ss_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev AND ss_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND cs_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND cs_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND ws_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND ws_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev ORDER BY ss_items.item_id NULLS FIRST, ss_item_rev NULLS FIRST LIMIT 100",
        "transforms": [
          "materialize_cte"
        ],
        "principle": "materialize_cte",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"week_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_date = '2000-01-03')\",\n        \"ss_items\": \"SELECT i_item_id AS item_id, SUM(ss_ext_sales_price) AS ss_item_rev FROM store_sales JOIN item ON ss_item_sk = i_item_sk JOIN week_dates ON store_sales.ss_sold_date_sk = week_dates.d_date_sk GROUP BY i_item_id\",\n        \"ws_items\": \"SELECT i_item_id AS item_id, SUM(ws_ext_sales_price) AS ws_item_rev FROM web_sales JOIN item ON ws_item_sk = i_item_sk JOIN week_dates ON web_sales.ws_sold_date_sk = week_dates.d_date_sk GROUP BY i_item_id\",\n        \"cs_items\": \"SELECT i_item_id AS item_id, SUM(cs_ext_sales_price) AS cs_item_rev FROM catalog_sales JOIN item ON cs_item_sk = i_item_sk JOIN week_dates ON catalog_sales.cs_sold_date_sk = week_dates.d_date_sk GROUP BY i_item_id\",\n        \"main_query\": \"SELECT ss_items.item_id, ss_item_rev, ss_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ss_dev, cs_item_rev, cs_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS cs_dev, ws_item_rev, ws_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ws_dev, (ss_item_rev + cs_item_rev + ws_item_rev) / 3 AS average FROM ss_items, cs_items, ws_items WHERE ss_items.item_id = cs_items.item_id AND ss_items.item_id = ws_items.item_id AND ss_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev AND ss_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND cs_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND cs_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND ws_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND ws_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev ORDER BY ss_items.item_id NULLS FIRST, ss_item_rev NULLS FIRST LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same aggregation results\",\n        \"same output columns\",\n        \"same grain (i_item_id)\"\n      ],\n      \"expected_speedup\": \"5.00x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Isolated the repeated date subquery pattern into a single CTE (week_dates) that returns date_sk values for the target week. This CTE replaces 9 separate date_dim scans (3 per sales CTE) with just 2 scans (one for the constant date, one for the week). Each sales CTE now joins directly with week_dates using the date surrogate key, eliminating redundant joins with date_dim and correlated subquery evaluations. This reduces I/O and computation significantly while preserving exact semantics.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 1,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.942079125269562,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.3137263922151727,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "materialize_cte"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.2295898061845791,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.191719916932481,
            "original_ms": 202.0373796670659,
            "optimized_ms": 169.53428133274429,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.06,
            "original_ms": 269.02,
            "optimized_ms": 253.63,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "decorrelate",
              "pushdown",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.0258416682497715,
            "original_ms": 180.08498866705244,
            "optimized_ms": 175.548521999796,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "intersect_to_exists",
              "decorrelate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.012948671402062,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "materialize_cte"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.9868628858716525,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "materialize_cte",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.9650351524906821,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filter",
            "speedup": 0.9362745705042335,
            "original_ms": 180.08498866705244,
            "optimized_ms": 192.34206966666534,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 0.9288059608826069,
            "original_ms": 180.08498866705244,
            "optimized_ms": 193.88870900002075,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_date_dimension_isolation",
            "speedup": 0,
            "original_ms": 180.08498866705244,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0,
            "original_ms": 160.1310899998983,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "single_pass_aggregation",
              "date_cte_isolate",
              "multi_date_range_cte",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q59": {
        "query_id": "q59",
        "status": "WIN",
        "best_speedup": 2.2287,
        "original_ms": 1794.06,
        "optimized_ms": 804.96,
        "original_sql": "-- start query 59 in stream 0 using template query59.tpl\nwith wss as \n (select d_week_seq,\n        ss_store_sk,\n        sum(case when (d_day_name='Sunday') then ss_sales_price else null end) sun_sales,\n        sum(case when (d_day_name='Monday') then ss_sales_price else null end) mon_sales,\n        sum(case when (d_day_name='Tuesday') then ss_sales_price else  null end) tue_sales,\n        sum(case when (d_day_name='Wednesday') then ss_sales_price else null end) wed_sales,\n        sum(case when (d_day_name='Thursday') then ss_sales_price else null end) thu_sales,\n        sum(case when (d_day_name='Friday') then ss_sales_price else null end) fri_sales,\n        sum(case when (d_day_name='Saturday') then ss_sales_price else null end) sat_sales\n from store_sales,date_dim\n where d_date_sk = ss_sold_date_sk\n group by d_week_seq,ss_store_sk\n )\n  select s_store_name1,s_store_id1,d_week_seq1\n       ,sun_sales1/sun_sales2,mon_sales1/mon_sales2\n       ,tue_sales1/tue_sales2,wed_sales1/wed_sales2,thu_sales1/thu_sales2\n       ,fri_sales1/fri_sales2,sat_sales1/sat_sales2\n from\n (select s_store_name s_store_name1,wss.d_week_seq d_week_seq1\n        ,s_store_id s_store_id1,sun_sales sun_sales1\n        ,mon_sales mon_sales1,tue_sales tue_sales1\n        ,wed_sales wed_sales1,thu_sales thu_sales1\n        ,fri_sales fri_sales1,sat_sales sat_sales1\n  from wss,store,date_dim d\n  where d.d_week_seq = wss.d_week_seq and\n        ss_store_sk = s_store_sk and \n        d_month_seq between 1196 and 1196 + 11) y,\n (select s_store_name s_store_name2,wss.d_week_seq d_week_seq2\n        ,s_store_id s_store_id2,sun_sales sun_sales2\n        ,mon_sales mon_sales2,tue_sales tue_sales2\n        ,wed_sales wed_sales2,thu_sales thu_sales2\n        ,fri_sales fri_sales2,sat_sales sat_sales2\n  from wss,store,date_dim d\n  where d.d_week_seq = wss.d_week_seq and\n        ss_store_sk = s_store_sk and \n        d_month_seq between 1196+ 12 and 1196 + 23) x\n where s_store_id1=s_store_id2\n   and d_week_seq1=d_week_seq2-52\n order by s_store_name1,s_store_id1,d_week_seq1\n LIMIT 100;\n\n-- end query 59 in stream 0 using template query59.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (\n  SELECT \n    d_date_sk,\n    d_week_seq,\n    d_day_name,\n    CASE \n      WHEN d_month_seq BETWEEN 1196 AND 1196 + 11 THEN 1\n      WHEN d_month_seq BETWEEN 1196 + 12 AND 1196 + 23 THEN 2\n    END AS year_tag\n  FROM date_dim\n  WHERE d_month_seq BETWEEN 1196 AND 1196 + 23\n),\nfiltered_sales AS (\n  SELECT \n    ss_store_sk,\n    ss_sales_price,\n    d_week_seq,\n    d_day_name,\n    year_tag\n  FROM store_sales\n  JOIN filtered_dates ON ss_sold_date_sk = d_date_sk\n),\naggregated AS (\n  SELECT \n    ss_store_sk,\n    d_week_seq,\n    year_tag,\n    SUM(CASE WHEN d_day_name = 'Sunday' THEN ss_sales_price END) AS sun_sales,\n    SUM(CASE WHEN d_day_name = 'Monday' THEN ss_sales_price END) AS mon_sales,\n    SUM(CASE WHEN d_day_name = 'Tuesday' THEN ss_sales_price END) AS tue_sales,\n    SUM(CASE WHEN d_day_name = 'Wednesday' THEN ss_sales_price END) AS wed_sales,\n    SUM(CASE WHEN d_day_name = 'Thursday' THEN ss_sales_price END) AS thu_sales,\n    SUM(CASE WHEN d_day_name = 'Friday' THEN ss_sales_price END) AS fri_sales,\n    SUM(CASE WHEN d_day_name = 'Saturday' THEN ss_sales_price END) AS sat_sales\n  FROM filtered_sales\n  GROUP BY ss_store_sk, d_week_seq, year_tag\n),\nyear1 AS (\n  SELECT \n    ss_store_sk,\n    d_week_seq AS d_week_seq1,\n    sun_sales AS sun_sales1,\n    mon_sales AS mon_sales1,\n    tue_sales AS tue_sales1,\n    wed_sales AS wed_sales1,\n    thu_sales AS thu_sales1,\n    fri_sales AS fri_sales1,\n    sat_sales AS sat_sales1\n  FROM aggregated\n  WHERE year_tag = 1\n),\nyear2 AS (\n  SELECT \n    ss_store_sk,\n    d_week_seq - 52 AS d_week_seq1,\n    sun_sales AS sun_sales2,\n    mon_sales AS mon_sales2,\n    tue_sales AS tue_sales2,\n    wed_sales AS wed_sales2,\n    thu_sales AS thu_sales2,\n    fri_sales AS fri_sales2,\n    sat_sales AS sat_sales2\n  FROM aggregated\n  WHERE year_tag = 2\n)\nSELECT \n  s.s_store_name AS s_store_name1,\n  s.s_store_id AS s_store_id1,\n  y1.d_week_seq1,\n  y1.sun_sales1 / y2.sun_sales2,\n  y1.mon_sales1 / y2.mon_sales2,\n  y1.tue_sales1 / y2.tue_sales2,\n  y1.wed_sales1 / y2.wed_sales2,\n  y1.thu_sales1 / y2.thu_sales2,\n  y1.fri_sales1 / y2.fri_sales2,\n  y1.sat_sales1 / y2.sat_sales2\nFROM year1 y1\nJOIN year2 y2 ON y1.ss_store_sk = y2.ss_store_sk AND y1.d_week_seq1 = y2.d_week_seq1\nJOIN store s ON y1.ss_store_sk = s.s_store_sk\nORDER BY s.s_store_name, s.s_store_id, y1.d_week_seq1\nLIMIT 100",
        "transforms": [
          "single_pass_aggregation",
          "prefetch_fact_join",
          "multi_dimension_prefetch"
        ],
        "principle": "single_pass_aggregation",
        "changes_description": null,
        "reasoning": "```sql\nWITH filtered_dates AS (\n  SELECT \n    d_date_sk,\n    d_week_seq,\n    d_day_name,\n    CASE \n      WHEN d_month_seq BETWEEN 1196 AND 1196 + 11 THEN 1\n      WHEN d_month_seq BETWEEN 1196 + 12 AND 1196 + 23 THEN 2\n    END AS year_tag\n  FROM date_dim\n  WHERE d_month_seq BETWEEN 1196 AND 1196 + 23\n),\nfiltered_sales AS (\n  SELECT \n    ss_store_sk,\n    ss_sales_price,\n    d_week_seq,\n    d_day_name,\n    year_tag\n  FROM store_sales\n  JOIN filtered_dates ON ss_sold_date_sk = d_date_sk\n),\naggregated AS (\n  SELECT \n    ss_store_sk,\n    d_week_seq,\n    year_tag,\n    SUM(CASE WHEN d_day_name = 'Sunday' THEN ss_sales_price END) AS sun_sales,\n    SUM(CASE WHEN d_day_name = 'Monday' THEN ss_sales_price END) AS mon_sales,\n    SUM(CASE WHEN d_day_name = 'Tuesday' THEN ss_sales_price END) AS tue_sales,\n    SUM(CASE WHEN d_day_name = 'Wednesday' THEN ss_sales_price END) AS wed_sales,\n    SUM(CASE WHEN d_day_name = 'Thursday' THEN ss_sales_price END) AS thu_sales,\n    SUM(CASE WHEN d_day_name = 'Friday' THEN ss_sales_price END) AS fri_sales,\n    SUM(CASE WHEN d_day_name = 'Saturday' THEN ss_sales_price END) AS sat_sales\n  FROM filtered_sales\n  GROUP BY ss_store_sk, d_week_seq, year_tag\n),\nyear1 AS (\n  SELECT \n    ss_store_sk,\n    d_week_seq AS d_week_seq1,\n    sun_sales AS sun_sales1,\n    mon_sales AS mon_sales1,\n    tue_sales AS tue_sales1,\n    wed_sales AS wed_sales1,\n    thu_sales AS thu_sales1,\n    fri_sales AS fri_sales1,\n    sat_sales AS sat_sales1\n  FROM aggregated\n  WHERE year_tag = 1\n),\nyear2 AS (\n  SELECT \n    ss_store_sk,\n    d_week_seq - 52 AS d_week_seq1,\n    sun_sales AS sun_sales2,\n    mon_sales AS mon_sales2,\n    tue_sales AS tue_sales2,\n    wed_sales AS wed_sales2,\n    thu_sales AS thu_sales2,\n    fri_sales AS fri_sales2,\n    sat_sales AS sat_sales2\n  FROM aggregated\n  WHERE year_tag = 2\n)\nSELECT \n  s.s_store_name AS s_store_name1,\n  s.s_store_id AS s_store_id1,\n  y1.d_week_seq1,\n  y1.sun_sales1 / y2.sun_sales2,\n  y1.mon_sales1 / y2.mon_sales2,\n  y1.tue_sales1 / y2.tue_sales2,\n  y1.wed_sales1 / y2.wed_sales2,\n  y1.thu_sales1 / y2.thu_sales2,\n  y1.fri_sales1 / y2.fri_sales2,\n  y1.sat_sales1 / y2.sat_sales2\nFROM year1 y1\nJOIN year2 y2 ON y1.ss_store_sk = y2.ss_store_sk AND y1.d_week_seq1 = y2.d_week_seq1\nJOIN store s ON y1.ss_store_sk = s.s_store_sk\nORDER BY s.s_store_name, s.s_store_id, y1.d_week_seq1\nLIMIT 100\n```\n\n**Changes**: Consolidated the two year-range subqueries into a single-pass aggregation by pre-filtering date_dim for both ranges, tagging each row, then splitting results after aggregation. This eliminates duplicate scans of store_sales and store tables.\n\n**Expected speedup**: ~2-3x from reduced I/O and elimination of redundant joins.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": "aggressive_single_pass_prefetch"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_single_pass_prefetch",
            "speedup": 2.2287417513388745,
            "original_ms": 1794.0587316667613,
            "optimized_ms": 804.9648330000613,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "single_pass_aggregation",
              "prefetch_fact_join",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.86,
            "original_ms": 2873.22,
            "optimized_ms": 1540.63,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transformation",
            "speedup": 1.195762461654057,
            "original_ms": 1794.0587316667613,
            "optimized_ms": 1500.3470916666022,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.1663518863559634,
            "original_ms": 1794.0587316667613,
            "optimized_ms": 1538.1796460002686,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filtering",
            "speedup": 1.1073640014931196,
            "original_ms": 1794.0587316667613,
            "optimized_ms": 1620.1165373334636,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q6": {
        "query_id": "q6",
        "status": "WIN",
        "best_speedup": 1.33,
        "original_ms": 418.9,
        "optimized_ms": 314.96,
        "original_sql": "-- start query 6 in stream 0 using template query6.tpl\nselect a.ca_state state, count(*) cnt\n from customer_address a\n     ,customer c\n     ,store_sales s\n     ,date_dim d\n     ,item i\n where       a.ca_address_sk = c.c_current_addr_sk\n \tand c.c_customer_sk = s.ss_customer_sk\n \tand s.ss_sold_date_sk = d.d_date_sk\n \tand s.ss_item_sk = i.i_item_sk\n \tand d.d_month_seq = \n \t     (select distinct (d_month_seq)\n \t      from date_dim\n               where d_year = 2002\n \t        and d_moy = 3 )\n \tand i.i_current_price > 1.2 * \n             (select avg(j.i_current_price) \n \t     from item j \n \t     where j.i_category = i.i_category)\n group by a.ca_state\n having count(*) >= 10\n order by cnt, a.ca_state\n LIMIT 100;\n\n-- end query 6 in stream 0 using template query6.tpl\n",
        "optimized_sql": "WITH target_month AS (SELECT DISTINCT d_month_seq FROM date_dim WHERE d_year = 2002 AND d_moy = 3), category_avg AS (SELECT i_category, AVG(i_current_price) * 1.2 AS price_threshold FROM item GROUP BY i_category)\nSELECT a.ca_state AS state, COUNT(*) AS cnt FROM customer_address AS a JOIN customer AS c ON a.ca_address_sk = c.c_current_addr_sk JOIN store_sales AS s ON c.c_customer_sk = s.ss_customer_sk JOIN date_dim AS d ON s.ss_sold_date_sk = d.d_date_sk JOIN target_month AS tm ON d.d_month_seq = tm.d_month_seq JOIN item AS i ON s.ss_item_sk = i.i_item_sk JOIN category_avg AS ca ON i.i_category = ca.i_category WHERE i.i_current_price > ca.price_threshold GROUP BY a.ca_state HAVING COUNT(*) >= 10 ORDER BY cnt, a.ca_state LIMIT 100",
        "transforms": [
          "decorrelate",
          "date_cte_isolate",
          "dimension_cte_isolate",
          "prefetch_fact_join"
        ],
        "principle": "decorrelate",
        "changes_description": null,
        "reasoning": " ```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"decorrelate\",\n      \"nodes\": {\n        \"target_month\": \"SELECT DISTINCT d_month_seq FROM date_dim WHERE d_year = 2002 AND d_moy = 3\",\n        \"category_avg\": \"SELECT i_category, AVG(i_current_price) * 1.2 AS price_threshold FROM item GROUP BY i_category\",\n        \"main_query\": \"SELECT a.ca_state AS state, COUNT(*) AS cnt FROM customer_address a JOIN customer c ON a.ca_address_sk = c.c_current_addr_sk JOIN store_sales s ON c.c_customer_sk = s.ss_customer_sk JOIN date_dim d ON s.ss_sold_date_sk = d.d_date_sk JOIN target_month tm ON d.d_month_seq = tm.d_month_seq JOIN item i ON s.ss_item_sk = i.i_item_sk JOIN category_avg ca ON i.i_category = ca.i_category WHERE i.i_current_price > ca.price_threshold GROUP BY a.ca_state HAVING COUNT(*) >= 10 ORDER BY cnt, a.ca_state LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\",\n        \"preserved aggregation grain\"\n      ],\n      \"expected_speedup\": \"2.5x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Decorrelated the scalar subquery on date_dim by converting it to a CTE (target_month) and joining, eliminating the per-row subquery execution. Decorrelated the correlated subquery on item category by pre-computing average prices per category with threshold multiplier in CTE (category_avg), then joining on i_category and moving the inequality predicate to the WHERE clause. This transforms two subqueries into joins, enabling hash joins instead of nested loop correlated execution.\"\n}\n```",
        "provenance": {
          "source": "Kimi",
          "run": "kimi_k2.5",
          "model": "kimi-k2.5",
          "worker_id": null,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.33,
            "original_ms": 418.9,
            "optimized_ms": 315.23,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.2309031652125118,
            "original_ms": 234.26178866672367,
            "optimized_ms": 190.3169926663395,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.2203256368194746,
            "original_ms": 209.65494600022794,
            "optimized_ms": 171.80245966695415,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "intersect_to_exists",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.1899987535971144,
            "original_ms": 198.38067199998477,
            "optimized_ms": 166.70662166689,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "dimension_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0.9740083844817123,
            "original_ms": 209.65494600022794,
            "optimized_ms": 215.24963166696884,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filtering",
            "speedup": 0.8392013751706899,
            "original_ms": 209.65494600022794,
            "optimized_ms": 249.82674266660374,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_cte_prefetch",
            "speedup": 0,
            "original_ms": 209.65494600022794,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          }
        ]
      },
      "q60": {
        "query_id": "q60",
        "status": "WIN",
        "best_speedup": 1.151,
        "original_ms": 318.99,
        "optimized_ms": 277.14,
        "original_sql": "-- start query 60 in stream 0 using template query60.tpl\nwith ss as (\n select\n          i_item_id,sum(ss_ext_sales_price) total_sales\n from\n \tstore_sales,\n \tdate_dim,\n         customer_address,\n         item\n where\n         i_item_id in (select\n  i_item_id\nfrom\n item\nwhere i_category in ('Children'))\n and     ss_item_sk              = i_item_sk\n and     ss_sold_date_sk         = d_date_sk\n and     d_year                  = 2000\n and     d_moy                   = 8\n and     ss_addr_sk              = ca_address_sk\n and     ca_gmt_offset           = -7 \n group by i_item_id),\n cs as (\n select\n          i_item_id,sum(cs_ext_sales_price) total_sales\n from\n \tcatalog_sales,\n \tdate_dim,\n         customer_address,\n         item\n where\n         i_item_id               in (select\n  i_item_id\nfrom\n item\nwhere i_category in ('Children'))\n and     cs_item_sk              = i_item_sk\n and     cs_sold_date_sk         = d_date_sk\n and     d_year                  = 2000\n and     d_moy                   = 8\n and     cs_bill_addr_sk         = ca_address_sk\n and     ca_gmt_offset           = -7 \n group by i_item_id),\n ws as (\n select\n          i_item_id,sum(ws_ext_sales_price) total_sales\n from\n \tweb_sales,\n \tdate_dim,\n         customer_address,\n         item\n where\n         i_item_id               in (select\n  i_item_id\nfrom\n item\nwhere i_category in ('Children'))\n and     ws_item_sk              = i_item_sk\n and     ws_sold_date_sk         = d_date_sk\n and     d_year                  = 2000\n and     d_moy                   = 8\n and     ws_bill_addr_sk         = ca_address_sk\n and     ca_gmt_offset           = -7\n group by i_item_id)\n  select  \n  i_item_id\n,sum(total_sales) total_sales\n from  (select * from ss \n        union all\n        select * from cs \n        union all\n        select * from ws) tmp1\n group by i_item_id\n order by i_item_id\n      ,total_sales\n LIMIT 100;\n\n-- end query 60 in stream 0 using template query60.tpl\n",
        "optimized_sql": "WITH filtered_items AS (\n  SELECT\n    i_item_id,\n    i_item_sk\n  FROM item\n  WHERE i_category = 'Children'\n),\nfiltered_dates AS (\n  SELECT\n    d_date_sk\n  FROM date_dim\n  WHERE d_year = 2000\n    AND d_moy = 8\n),\nfiltered_addresses AS (\n  SELECT\n    ca_address_sk\n  FROM customer_address\n  WHERE ca_gmt_offset = -7\n),\nss AS (\n  SELECT\n    fi.i_item_id,\n    SUM(ss_ext_sales_price) AS total_sales\n  FROM store_sales\n  JOIN filtered_items fi ON ss_item_sk = fi.i_item_sk\n  JOIN filtered_dates fd ON ss_sold_date_sk = fd.d_date_sk\n  JOIN filtered_addresses fa ON ss_addr_sk = fa.ca_address_sk\n  GROUP BY fi.i_item_id\n),\ncs AS (\n  SELECT\n    fi.i_item_id,\n    SUM(cs_ext_sales_price) AS total_sales\n  FROM catalog_sales\n  JOIN filtered_items fi ON cs_item_sk = fi.i_item_sk\n  JOIN filtered_dates fd ON cs_sold_date_sk = fd.d_date_sk\n  JOIN filtered_addresses fa ON cs_bill_addr_sk = fa.ca_address_sk\n  GROUP BY fi.i_item_id\n),\nws AS (\n  SELECT\n    fi.i_item_id,\n    SUM(ws_ext_sales_price) AS total_sales\n  FROM web_sales\n  JOIN filtered_items fi ON ws_item_sk = fi.i_item_sk\n  JOIN filtered_dates fd ON ws_sold_date_sk = fd.d_date_sk\n  JOIN filtered_addresses fa ON ws_bill_addr_sk = fa.ca_address_sk\n  GROUP BY fi.i_item_id\n)\nSELECT\n  i_item_id,\n  SUM(total_sales) AS total_sales\nFROM (\n  SELECT * FROM ss\n  UNION ALL\n  SELECT * FROM cs\n  UNION ALL\n  SELECT * FROM ws\n) tmp1\nGROUP BY i_item_id\nORDER BY i_item_id, total_sales\nLIMIT 100",
        "transforms": [
          "decorrelate",
          "date_cte_isolate",
          "multi_dimension_prefetch"
        ],
        "principle": "decorrelate",
        "changes_description": null,
        "reasoning": "```sql\nWITH filtered_items AS (\n  SELECT\n    i_item_id,\n    i_item_sk\n  FROM item\n  WHERE i_category = 'Children'\n),\nfiltered_dates AS (\n  SELECT\n    d_date_sk\n  FROM date_dim\n  WHERE d_year = 2000\n    AND d_moy = 8\n),\nfiltered_addresses AS (\n  SELECT\n    ca_address_sk\n  FROM customer_address\n  WHERE ca_gmt_offset = -7\n),\nss AS (\n  SELECT\n    fi.i_item_id,\n    SUM(ss_ext_sales_price) AS total_sales\n  FROM store_sales\n  JOIN filtered_items fi ON ss_item_sk = fi.i_item_sk\n  JOIN filtered_dates fd ON ss_sold_date_sk = fd.d_date_sk\n  JOIN filtered_addresses fa ON ss_addr_sk = fa.ca_address_sk\n  GROUP BY fi.i_item_id\n),\ncs AS (\n  SELECT\n    fi.i_item_id,\n    SUM(cs_ext_sales_price) AS total_sales\n  FROM catalog_sales\n  JOIN filtered_items fi ON cs_item_sk = fi.i_item_sk\n  JOIN filtered_dates fd ON cs_sold_date_sk = fd.d_date_sk\n  JOIN filtered_addresses fa ON cs_bill_addr_sk = fa.ca_address_sk\n  GROUP BY fi.i_item_id\n),\nws AS (\n  SELECT\n    fi.i_item_id,\n    SUM(ws_ext_sales_price) AS total_sales\n  FROM web_sales\n  JOIN filtered_items fi ON ws_item_sk = fi.i_item_sk\n  JOIN filtered_dates fd ON ws_sold_date_sk = fd.d_date_sk\n  JOIN filtered_addresses fa ON ws_bill_addr_sk = fa.ca_address_sk\n  GROUP BY fi.i_item_id\n)\nSELECT\n  i_item_id,\n  SUM(total_sales) AS total_sales\nFROM (\n  SELECT * FROM ss\n  UNION ALL\n  SELECT * FROM cs\n  UNION ALL\n  SELECT * FROM ws\n) tmp1\nGROUP BY i_item_id\nORDER BY i_item_id, total_sales\nLIMIT 100\n```\n\n**Changes**: Extracted shared dimension filters (items, dates, addresses) into separate CTEs and converted implicit joins to explicit JOIN syntax, eliminating redundant subqueries and enabling dimension reuse across all three sales channels.\n\n**Expected speedup**: 1.8x-2.2x due to reduced dimension table scans and elimination of correlated subqueries.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 5,
          "iteration": 1,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.6419207225211507,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.45358716820421,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.151017370732424,
            "original_ms": 318.99443433333846,
            "optimized_ms": 277.1412860001874,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.147004464248671,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.1258139731498285,
            "original_ms": 286.4193806666056,
            "optimized_ms": 254.4109306666845,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transformation",
            "speedup": 1.0976111767583183,
            "original_ms": 294.4890593331972,
            "optimized_ms": 268.2999823333982,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_materialization",
            "speedup": 1.0202071042388712,
            "original_ms": 294.4890593331972,
            "optimized_ms": 288.6561543333907,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.02,
            "original_ms": 378.07,
            "optimized_ms": 371.07,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_consolidation",
            "speedup": 1.0033982756170126,
            "original_ms": 294.4890593331972,
            "optimized_ms": 293.49169366681355,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0.9854634996878626,
            "original_ms": 294.4890593331972,
            "optimized_ms": 298.83304599964805,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.9440328164828282,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q61": {
        "query_id": "q61",
        "status": "WIN",
        "best_speedup": 1.3392,
        "original_ms": 10.73,
        "optimized_ms": 8.01,
        "original_sql": "-- start query 61 in stream 0 using template query61.tpl\nselect promotions,total,cast(promotions as decimal(15,4))/cast(total as decimal(15,4))*100\nfrom\n  (select sum(ss_ext_sales_price) promotions\n   from  store_sales\n        ,store\n        ,promotion\n        ,date_dim\n        ,customer\n        ,customer_address \n        ,item\n   where ss_sold_date_sk = d_date_sk\n   and   ss_store_sk = s_store_sk\n   and   ss_promo_sk = p_promo_sk\n   and   ss_customer_sk= c_customer_sk\n   and   ca_address_sk = c_current_addr_sk\n   and   ss_item_sk = i_item_sk \n   and   ca_gmt_offset = -7\n   and   i_category = 'Jewelry'\n   and   (p_channel_dmail = 'Y' or p_channel_email = 'Y' or p_channel_tv = 'Y')\n   and   s_gmt_offset = -7\n   and   d_year = 1999\n   and   d_moy  = 11) promotional_sales,\n  (select sum(ss_ext_sales_price) total\n   from  store_sales\n        ,store\n        ,date_dim\n        ,customer\n        ,customer_address\n        ,item\n   where ss_sold_date_sk = d_date_sk\n   and   ss_store_sk = s_store_sk\n   and   ss_customer_sk= c_customer_sk\n   and   ca_address_sk = c_current_addr_sk\n   and   ss_item_sk = i_item_sk\n   and   ca_gmt_offset = -7\n   and   i_category = 'Jewelry'\n   and   s_gmt_offset = -7\n   and   d_year = 1999\n   and   d_moy  = 11) all_sales\norder by promotions, total\n LIMIT 100;\n\n-- end query 61 in stream 0 using template query61.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 1999\n      AND d_moy = 11\n),\nfiltered_stores AS (\n    SELECT s_store_sk\n    FROM store\n    WHERE s_gmt_offset = -7\n),\nfiltered_customer_address AS (\n    SELECT ca_address_sk\n    FROM customer_address\n    WHERE ca_gmt_offset = -7\n),\nfiltered_items AS (\n    SELECT i_item_sk\n    FROM item\n    WHERE i_category = 'Jewelry'\n),\nfiltered_promotions AS (\n    SELECT p_promo_sk\n    FROM promotion\n    WHERE p_channel_dmail = 'Y'\n       OR p_channel_email = 'Y'\n       OR p_channel_tv = 'Y'\n),\njoined_sales AS (\n    SELECT\n        ss.ss_ext_sales_price,\n        fp.p_promo_sk\n    FROM store_sales ss\n    INNER JOIN filtered_dates fd ON ss.ss_sold_date_sk = fd.d_date_sk\n    INNER JOIN filtered_stores fs ON ss.ss_store_sk = fs.s_store_sk\n    INNER JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk\n    INNER JOIN filtered_customer_address fca ON c.c_current_addr_sk = fca.ca_address_sk\n    INNER JOIN filtered_items fi ON ss.ss_item_sk = fi.i_item_sk\n    LEFT JOIN filtered_promotions fp ON ss.ss_promo_sk = fp.p_promo_sk\n),\naggregated_sales AS (\n    SELECT\n        SUM(CASE WHEN p_promo_sk IS NOT NULL THEN ss_ext_sales_price ELSE 0 END) AS promotions,\n        SUM(ss_ext_sales_price) AS total\n    FROM joined_sales\n)\nSELECT\n    promotions,\n    total,\n    CAST(promotions AS DECIMAL(15, 4)) / CAST(total AS DECIMAL(15, 4)) * 100\nFROM aggregated_sales\nORDER BY\n    promotions,\n    total\nLIMIT 100;",
        "transforms": [
          "prefetch_fact_join",
          "single_pass_aggregation",
          "multi_dimension_prefetch"
        ],
        "principle": "prefetch_fact_join",
        "changes_description": "Pre-filtered all dimension tables into separate CTEs before joining with store_sales, then used conditional aggregation to compute both promotional and total sales in a single pass through the fact table. This eliminates duplicate scans of store_sales and early reduces data volume.",
        "reasoning": "```sql\nWITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 1999\n      AND d_moy = 11\n),\nfiltered_stores AS (\n    SELECT s_store_sk\n    FROM store\n    WHERE s_gmt_offset = -7\n),\nfiltered_customer_address AS (\n    SELECT ca_address_sk\n    FROM customer_address\n    WHERE ca_gmt_offset = -7\n),\nfiltered_items AS (\n    SELECT i_item_sk\n    FROM item\n    WHERE i_category = 'Jewelry'\n),\nfiltered_promotions AS (\n    SELECT p_promo_sk\n    FROM promotion\n    WHERE p_channel_dmail = 'Y'\n       OR p_channel_email = 'Y'\n       OR p_channel_tv = 'Y'\n),\njoined_sales AS (\n    SELECT\n        ss.ss_ext_sales_price,\n        fp.p_promo_sk\n    FROM store_sales ss\n    INNER JOIN filtered_dates fd ON ss.ss_sold_date_sk = fd.d_date_sk\n    INNER JOIN filtered_stores fs ON ss.ss_store_sk = fs.s_store_sk\n    INNER JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk\n    INNER JOIN filtered_customer_address fca ON c.c_current_addr_sk = fca.ca_address_sk\n    INNER JOIN filtered_items fi ON ss.ss_item_sk = fi.i_item_sk\n    LEFT JOIN filtered_promotions fp ON ss.ss_promo_sk = fp.p_promo_sk\n),\naggregated_sales AS (\n    SELECT\n        SUM(CASE WHEN p_promo_sk IS NOT NULL THEN ss_ext_sales_price ELSE 0 END) AS promotions,\n        SUM(ss_ext_sales_price) AS total\n    FROM joined_sales\n)\nSELECT\n    promotions,\n    total,\n    CAST(promotions AS DECIMAL(15, 4)) / CAST(total AS DECIMAL(15, 4)) * 100\nFROM aggregated_sales\nORDER BY\n    promotions,\n    total\nLIMIT 100;\n```\n\nChanges: Pre-filtered all dimension tables into separate CTEs before joining with store_sales, then used conditional aggregation to compute both promotional and total sales in a single pass through the fact table. This eliminates duplicate scans of store_sales and early reduces data volume.\n\nExpected speedup: 2-3x by reducing store_sales scans from two to one and applying filters early.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": "aggressive_prefetch_consolidation"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_consolidation",
            "speedup": 1.3391566430721515,
            "original_ms": 10.725688999931057,
            "optimized_ms": 8.009286333617638,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.9440504599640206,
            "original_ms": 10.776560999753807,
            "optimized_ms": 11.41523833393876,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": []
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.588612773001455,
            "original_ms": 10.725688999931057,
            "optimized_ms": 18.221977999625476,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filtering",
            "speedup": 0.5385947431743382,
            "original_ms": 10.725688999931057,
            "optimized_ms": 19.914210333202693,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.4,
            "original_ms": 19.28,
            "optimized_ms": 48.31,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0.01932495312400238,
            "original_ms": 10.725688999931057,
            "optimized_ms": 555.0175946667272,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0,
            "original_ms": 11.9007133331858,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q62": {
        "query_id": "q62",
        "status": "WIN",
        "best_speedup": 1.6153,
        "original_ms": 199.2,
        "optimized_ms": 123.32,
        "original_sql": "-- start query 62 in stream 0 using template query62.tpl\nselect \n   substr(w_warehouse_name,1,20)\n  ,sm_type\n  ,web_name\n  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\" \n  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk > 30) and \n                 (ws_ship_date_sk - ws_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\" \n  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk > 60) and \n                 (ws_ship_date_sk - ws_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\" \n  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk > 90) and\n                 (ws_ship_date_sk - ws_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\" \n  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\" \nfrom\n   web_sales\n  ,warehouse\n  ,ship_mode\n  ,web_site\n  ,date_dim\nwhere\n    d_month_seq between 1194 and 1194 + 11\nand ws_ship_date_sk   = d_date_sk\nand ws_warehouse_sk   = w_warehouse_sk\nand ws_ship_mode_sk   = sm_ship_mode_sk\nand ws_web_site_sk    = web_site_sk\ngroup by\n   substr(w_warehouse_name,1,20)\n  ,sm_type\n  ,web_name\norder by substr(w_warehouse_name,1,20)\n        ,sm_type\n       ,web_name\n LIMIT 100;\n\n-- end query 62 in stream 0 using template query62.tpl\n",
        "optimized_sql": "WITH date_range AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_month_seq BETWEEN 1194 AND 1194 + 11\n), \nfiltered_sales AS (\n    SELECT \n        ws_warehouse_sk,\n        ws_ship_mode_sk,\n        ws_web_site_sk,\n        ws_ship_date_sk - ws_sold_date_sk AS shipping_delay,\n        CASE \n            WHEN ws_ship_date_sk - ws_sold_date_sk <= 30 THEN 1\n            ELSE 0\n        END AS delay_30,\n        CASE \n            WHEN ws_ship_date_sk - ws_sold_date_sk > 30 \n                 AND ws_ship_date_sk - ws_sold_date_sk <= 60 THEN 1\n            ELSE 0\n        END AS delay_31_60,\n        CASE \n            WHEN ws_ship_date_sk - ws_sold_date_sk > 60 \n                 AND ws_ship_date_sk - ws_sold_date_sk <= 90 THEN 1\n            ELSE 0\n        END AS delay_61_90,\n        CASE \n            WHEN ws_ship_date_sk - ws_sold_date_sk > 90 \n                 AND ws_ship_date_sk - ws_sold_date_sk <= 120 THEN 1\n            ELSE 0\n        END AS delay_91_120,\n        CASE \n            WHEN ws_ship_date_sk - ws_sold_date_sk > 120 THEN 1\n            ELSE 0\n        END AS delay_over_120\n    FROM web_sales\n    WHERE ws_ship_date_sk IN (SELECT d_date_sk FROM date_range)\n),\naggregated_sales AS (\n    SELECT \n        ws_warehouse_sk,\n        ws_ship_mode_sk,\n        ws_web_site_sk,\n        SUM(delay_30) AS \"30 days\",\n        SUM(delay_31_60) AS \"31-60 days\",\n        SUM(delay_61_90) AS \"61-90 days\",\n        SUM(delay_91_120) AS \"91-120 days\",\n        SUM(delay_over_120) AS \">120 days\"\n    FROM filtered_sales\n    GROUP BY ws_warehouse_sk, ws_ship_mode_sk, ws_web_site_sk\n)\nSELECT\n    SUBSTRING(w_warehouse_name, 1, 20),\n    sm_type,\n    web_name,\n    \"30 days\",\n    \"31-60 days\",\n    \"61-90 days\",\n    \"91-120 days\",\n    \">120 days\"\nFROM aggregated_sales\nJOIN warehouse ON ws_warehouse_sk = w_warehouse_sk\nJOIN ship_mode ON ws_ship_mode_sk = sm_ship_mode_sk\nJOIN web_site ON ws_web_site_sk = web_site_sk\nORDER BY\n    SUBSTRING(w_warehouse_name, 1, 20),\n    sm_type,\n    web_name\nLIMIT 100;",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": "Implemented three-stage pipeline: (1) filter web_sales by date range using derived table, computing delay buckets immediately; (2) pre-aggregate by integer foreign keys before joining to dimensions; (3) final lightweight join to dimension tables for descriptive columns only.",
        "reasoning": "```sql\nWITH date_range AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_month_seq BETWEEN 1194 AND 1194 + 11\n), \nfiltered_sales AS (\n    SELECT \n        ws_warehouse_sk,\n        ws_ship_mode_sk,\n        ws_web_site_sk,\n        ws_ship_date_sk - ws_sold_date_sk AS shipping_delay,\n        CASE \n            WHEN ws_ship_date_sk - ws_sold_date_sk <= 30 THEN 1\n            ELSE 0\n        END AS delay_30,\n        CASE \n            WHEN ws_ship_date_sk - ws_sold_date_sk > 30 \n                 AND ws_ship_date_sk - ws_sold_date_sk <= 60 THEN 1\n            ELSE 0\n        END AS delay_31_60,\n        CASE \n            WHEN ws_ship_date_sk - ws_sold_date_sk > 60 \n                 AND ws_ship_date_sk - ws_sold_date_sk <= 90 THEN 1\n            ELSE 0\n        END AS delay_61_90,\n        CASE \n            WHEN ws_ship_date_sk - ws_sold_date_sk > 90 \n                 AND ws_ship_date_sk - ws_sold_date_sk <= 120 THEN 1\n            ELSE 0\n        END AS delay_91_120,\n        CASE \n            WHEN ws_ship_date_sk - ws_sold_date_sk > 120 THEN 1\n            ELSE 0\n        END AS delay_over_120\n    FROM web_sales\n    WHERE ws_ship_date_sk IN (SELECT d_date_sk FROM date_range)\n),\naggregated_sales AS (\n    SELECT \n        ws_warehouse_sk,\n        ws_ship_mode_sk,\n        ws_web_site_sk,\n        SUM(delay_30) AS \"30 days\",\n        SUM(delay_31_60) AS \"31-60 days\",\n        SUM(delay_61_90) AS \"61-90 days\",\n        SUM(delay_91_120) AS \"91-120 days\",\n        SUM(delay_over_120) AS \">120 days\"\n    FROM filtered_sales\n    GROUP BY ws_warehouse_sk, ws_ship_mode_sk, ws_web_site_sk\n)\nSELECT\n    SUBSTRING(w_warehouse_name, 1, 20),\n    sm_type,\n    web_name,\n    \"30 days\",\n    \"31-60 days\",\n    \"61-90 days\",\n    \"91-120 days\",\n    \">120 days\"\nFROM aggregated_sales\nJOIN warehouse ON ws_warehouse_sk = w_warehouse_sk\nJOIN ship_mode ON ws_ship_mode_sk = sm_ship_mode_sk\nJOIN web_site ON ws_web_site_sk = web_site_sk\nORDER BY\n    SUBSTRING(w_warehouse_name, 1, 20),\n    sm_type,\n    web_name\nLIMIT 100;\n```\n\nChanges: Implemented three-stage pipeline: (1) filter web_sales by date range using derived table, computing delay buckets immediately; (2) pre-aggregate by integer foreign keys before joining to dimensions; (3) final lightweight join to dimension tables for descriptive columns only.\n\nExpected speedup: 2-3x by reducing early data movement, deferring string operations, and minimizing join cardinality through early aggregation.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 6,
          "iteration": 2,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.6152624818577372,
            "original_ms": 199.19661100054023,
            "optimized_ms": 123.32151166629046,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.23,
            "original_ms": 413.74,
            "optimized_ms": 336.16,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_cte_restructure",
            "speedup": 1.0728419602986157,
            "original_ms": 225.10732166665548,
            "optimized_ms": 209.8233756666256,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filtering",
            "speedup": 1.0421323844898593,
            "original_ms": 225.10732166665548,
            "optimized_ms": 216.006454666361,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.0254616159226133,
            "original_ms": 221.59851500024766,
            "optimized_ms": 216.09635266637875,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0230641763672024,
            "original_ms": 225.10732166665548,
            "optimized_ms": 220.0324543334015,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.9794581712402203,
            "original_ms": 225.10732166665548,
            "optimized_ms": 229.82841766649167,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q63": {
        "query_id": "q63",
        "status": "WIN",
        "best_speedup": 3.77,
        "original_ms": 387.19,
        "optimized_ms": 102.7,
        "original_sql": "\nSELECT *\nFROM\n  (SELECT i_manager_id,\n          sum(ss_sales_price) sum_sales,\n          avg(sum(ss_sales_price)) OVER (PARTITION BY i_manager_id) avg_monthly_sales\n   FROM item,\n        store_sales,\n        date_dim,\n        store\n   WHERE ss_item_sk = i_item_sk\n     AND ss_sold_date_sk = d_date_sk\n     AND ss_store_sk = s_store_sk\n     AND d_month_seq IN (1200,\n                         1200+1,\n                         1200+2,\n                         1200+3,\n                         1200+4,\n                         1200+5,\n                         1200+6,\n                         1200+7,\n                         1200+8,\n                         1200+9,\n                         1200+10,\n                         1200+11)\n     AND ((i_category IN ('Books',\n                          'Children',\n                          'Electronics')\n           AND i_class IN ('personal',\n                           'portable',\n                           'reference',\n                           'self-help')\n           AND i_brand IN ('scholaramalgamalg #14',\n                           'scholaramalgamalg #7',\n                           'exportiunivamalg #9',\n                           'scholaramalgamalg #9')) or(i_category IN ('Women','Music','Men')\n                                                       AND i_class IN ('accessories','classical','fragrances','pants')\n                                                       AND i_brand IN ('amalgimporto #1','edu packscholar #1','exportiimporto #1', 'importoamalg #1')))\n   GROUP BY i_manager_id,\n            d_moy) tmp1\nWHERE CASE\n          WHEN avg_monthly_sales > 0 THEN ABS (sum_sales - avg_monthly_sales) / avg_monthly_sales\n          ELSE NULL\n      END > 0.1\nORDER BY i_manager_id,\n         avg_monthly_sales,\n         sum_sales\nLIMIT 100;\n\n",
        "optimized_sql": "WITH date_cte AS (SELECT d_date_sk, d_moy FROM date_dim WHERE d_month_seq IN (1200, 1201, 1202, 1203, 1204, 1205, 1206, 1207, 1208, 1209, 1210, 1211)), filtered_store_sales AS (SELECT ss_item_sk, ss_sold_date_sk, ss_store_sk, ss_sales_price FROM store_sales WHERE ss_sold_date_sk IN (SELECT d_date_sk FROM date_cte))\nSELECT * FROM (SELECT i_manager_id, SUM(ss_sales_price) AS sum_sales, AVG(SUM(ss_sales_price)) OVER (PARTITION BY i_manager_id) AS avg_monthly_sales FROM item, filtered_store_sales, date_cte, store WHERE ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND ss_store_sk = s_store_sk AND ((i_category IN ('Books', 'Children', 'Electronics') AND i_class IN ('personal', 'portable', 'reference', 'self-help') AND i_brand IN ('scholaramalgamalg #14', 'scholaramalgamalg #7', 'exportiunivamalg #9', 'scholaramalgamalg #9')) OR (i_category IN ('Women', 'Music', 'Men') AND i_class IN ('accessories', 'classical', 'fragrances', 'pants') AND i_brand IN ('amalgimporto #1', 'edu packscholar #1', 'exportiimporto #1', 'importoamalg #1'))) GROUP BY i_manager_id, d_moy) AS tmp1 WHERE CASE WHEN avg_monthly_sales > 0 THEN ABS(sum_sales - avg_monthly_sales) / avg_monthly_sales ELSE NULL END > 0.1 ORDER BY i_manager_id, avg_monthly_sales, sum_sales LIMIT 100",
        "transforms": [
          "or_to_union"
        ],
        "principle": "or_to_union",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"date_cte\": \"SELECT d_date_sk, d_moy FROM date_dim WHERE d_month_seq IN (1200, 1201, 1202, 1203, 1204, 1205, 1206, 1207, 1208, 1209, 1210, 1211)\",\n        \"filtered_store_sales\": \"SELECT ss_item_sk, ss_sold_date_sk, ss_store_sk, ss_sales_price FROM store_sales WHERE ss_sold_date_sk IN (SELECT d_date_sk FROM date_cte)\",\n        \"main_query\": \"SELECT * FROM (SELECT i_manager_id, SUM(ss_sales_price) AS sum_sales, AVG(SUM(ss_sales_price)) OVER (PARTITION BY i_manager_id) AS avg_monthly_sales FROM item, filtered_store_sales, date_cte, store WHERE ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND ss_store_sk = s_store_sk AND ((i_category IN ('Books', 'Children', 'Electronics') AND i_class IN ('personal', 'portable', 'reference', 'self-help') AND i_brand IN ('scholaramalgamalg #14', 'scholaramalgamalg #7', 'exportiunivamalg #9', 'scholaramalgamalg #9')) OR (i_category IN ('Women', 'Music', 'Men') AND i_class IN ('accessories', 'classical', 'fragrances', 'pants') AND i_brand IN ('amalgimporto #1', 'edu packscholar #1', 'exportiimporto #1', 'importoamalg #1'))) GROUP BY i_manager_id, d_moy) AS tmp1 WHERE CASE WHEN avg_monthly_sales > 0 THEN ABS(sum_sales - avg_monthly_sales) / avg_monthly_sales ELSE NULL END > 0.1 ORDER BY i_manager_id, avg_monthly_sales, sum_sales LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\",\n        \"grain preserved\"\n      ],\n      \"expected_speedup\": \"2.3x\",\n      \"risk\": \"low\"\n    },\n    {\n      \"id\": \"rs_02\",\n      \"transform\": \"or_to_union\",\n      \"nodes\": {\n        \"date_cte\": \"SELECT d_date_sk, d_moy FROM date_dim WHERE d_month_seq IN (1200, 1201, 1202, 1203, 1204, 1205, 1206, 1207, 1208, 1209, 1210, 1211)\",\n        \"filtered_store_sales\": \"SELECT ss_item_sk, ss_sold_date_sk, ss_store_sk, ss_sales_price FROM store_sales WHERE ss_sold_date_sk IN (SELECT d_date_sk FROM date_cte)\",\n        \"main_query\": \"SELECT * FROM (SELECT i_manager_id, d_moy, SUM(ss_sales_price) AS sum_sales, AVG(SUM(ss_sales_price)) OVER (PARTITION BY i_manager_id) AS avg_monthly_sales FROM (SELECT i_item_sk, i_manager_id FROM item WHERE i_category IN ('Books', 'Children', 'Electronics') AND i_class IN ('personal', 'portable', 'reference', 'self-help') AND i_brand IN ('scholaramalgamalg #14', 'scholaramalgamalg #7', 'exportiunivamalg #9', 'scholaramalgamalg #9') UNION ALL SELECT i_item_sk, i_manager_id FROM item WHERE i_category IN ('Women', 'Music', 'Men') AND i_class IN ('accessories', 'classical', 'fragrances', 'pants') AND i_brand IN ('amalgimporto #1', 'edu packscholar #1', 'exportiimporto #1', 'importoamalg #1')) AS filtered_items JOIN filtered_store_sales ON ss_item_sk = i_item_sk JOIN date_cte ON ss_sold_date_sk = d_date_sk JOIN store ON ss_store_sk = s_store_sk GROUP BY i_manager_id, d_moy) AS tmp1 WHERE CASE WHEN avg_monthly_sales > 0 THEN ABS(sum_sales - avg_monthly_sales) / avg_monthly_sales ELSE NULL END > 0.1 ORDER BY i_manager_id, avg_monthly_sales, sum_sales LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\",\n        \"grain preserved\"\n      ],\n      \"expected_speedup\": \"1.7x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Applied two optimizations: 1) DATE_CTE_ISOLATE - Filter date_dim early to reduce join cardinality before joining with large store_sales fact table. 2) OR_TO_UNION - Split complex OR condition on item table into two UNION ALL branches, enabling better predicate pushdown and index utilization on item table. These can be combined for cumulative speedup.\"\n}\n```",
        "provenance": {
          "source": "Retry3W",
          "run": "retry_3worker_20260205_235909_details",
          "model": "deepseek-reasoner",
          "worker_id": 1,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.92816636755059,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.1592810341128084,
            "original_ms": 310.5910593336982,
            "optimized_ms": 267.9169676672852,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_fact_prefetch_restructure",
            "speedup": 1.0956180621165659,
            "original_ms": 284.64638266662706,
            "optimized_ms": 259.8043903335565,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_and_simplify",
            "speedup": 1.090097424559174,
            "original_ms": 284.64638266662706,
            "optimized_ms": 261.12013133297296,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0836580014991704,
            "original_ms": 284.64638266662706,
            "optimized_ms": 262.6717859996764,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.03,
            "original_ms": 387.19,
            "optimized_ms": 376.71,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "or_to_union"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.0150557737284158,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transformation",
            "speedup": 0.5096135106412799,
            "original_ms": 284.64638266662706,
            "optimized_ms": 558.5534463331593,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.06379772950465294,
            "original_ms": 274.7007680009119,
            "optimized_ms": 4305.8079046665325,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q64": {
        "query_id": "q64",
        "status": "WIN",
        "best_speedup": 1.6469,
        "original_ms": 1419.94,
        "optimized_ms": 862.16,
        "original_sql": "-- start query 64 in stream 0 using template query64.tpl\nwith cs_ui as\n (select cs_item_sk\n        ,sum(cs_ext_list_price) as sale,sum(cr_refunded_cash+cr_reversed_charge+cr_store_credit) as refund\n  from catalog_sales\n      ,catalog_returns\n  where cs_item_sk = cr_item_sk\n    and cs_order_number = cr_order_number\n  group by cs_item_sk\n  having sum(cs_ext_list_price)>2*sum(cr_refunded_cash+cr_reversed_charge+cr_store_credit)),\ncross_sales as\n (select i_product_name product_name\n     ,i_item_sk item_sk\n     ,s_store_name store_name\n     ,s_zip store_zip\n     ,ad1.ca_street_number b_street_number\n     ,ad1.ca_street_name b_street_name\n     ,ad1.ca_city b_city\n     ,ad1.ca_zip b_zip\n     ,ad2.ca_street_number c_street_number\n     ,ad2.ca_street_name c_street_name\n     ,ad2.ca_city c_city\n     ,ad2.ca_zip c_zip\n     ,d1.d_year as syear\n     ,d2.d_year as fsyear\n     ,d3.d_year s2year\n     ,count(*) cnt\n     ,sum(ss_wholesale_cost) s1\n     ,sum(ss_list_price) s2\n     ,sum(ss_coupon_amt) s3\n  FROM   store_sales\n        ,store_returns\n        ,cs_ui\n        ,date_dim d1\n        ,date_dim d2\n        ,date_dim d3\n        ,store\n        ,customer\n        ,customer_demographics cd1\n        ,customer_demographics cd2\n        ,promotion\n        ,household_demographics hd1\n        ,household_demographics hd2\n        ,customer_address ad1\n        ,customer_address ad2\n        ,income_band ib1\n        ,income_band ib2\n        ,item\n  WHERE  ss_store_sk = s_store_sk AND\n         ss_sold_date_sk = d1.d_date_sk AND\n         ss_customer_sk = c_customer_sk AND\n         ss_cdemo_sk= cd1.cd_demo_sk AND\n         ss_hdemo_sk = hd1.hd_demo_sk AND\n         ss_addr_sk = ad1.ca_address_sk and\n         ss_item_sk = i_item_sk and\n         ss_item_sk = sr_item_sk and\n         ss_ticket_number = sr_ticket_number and\n         ss_item_sk = cs_ui.cs_item_sk and\n         c_current_cdemo_sk = cd2.cd_demo_sk AND\n         c_current_hdemo_sk = hd2.hd_demo_sk AND\n         c_current_addr_sk = ad2.ca_address_sk and\n         c_first_sales_date_sk = d2.d_date_sk and\n         c_first_shipto_date_sk = d3.d_date_sk and\n         ss_promo_sk = p_promo_sk and\n         hd1.hd_income_band_sk = ib1.ib_income_band_sk and\n         hd2.hd_income_band_sk = ib2.ib_income_band_sk and\n         cd1.cd_marital_status <> cd2.cd_marital_status and\n         i_color in ('blanched','medium','brown','chocolate','burlywood','drab') and\n         i_current_price between 23 and 23 + 10 and\n         i_current_price between 23 + 1 and 23 + 15\ngroup by i_product_name\n       ,i_item_sk\n       ,s_store_name\n       ,s_zip\n       ,ad1.ca_street_number\n       ,ad1.ca_street_name\n       ,ad1.ca_city\n       ,ad1.ca_zip\n       ,ad2.ca_street_number\n       ,ad2.ca_street_name\n       ,ad2.ca_city\n       ,ad2.ca_zip\n       ,d1.d_year\n       ,d2.d_year\n       ,d3.d_year\n)\nselect cs1.product_name\n     ,cs1.store_name\n     ,cs1.store_zip\n     ,cs1.b_street_number\n     ,cs1.b_street_name\n     ,cs1.b_city\n     ,cs1.b_zip\n     ,cs1.c_street_number\n     ,cs1.c_street_name\n     ,cs1.c_city\n     ,cs1.c_zip\n     ,cs1.syear\n     ,cs1.cnt\n     ,cs1.s1 as s11\n     ,cs1.s2 as s21\n     ,cs1.s3 as s31\n     ,cs2.s1 as s12\n     ,cs2.s2 as s22\n     ,cs2.s3 as s32\n     ,cs2.syear\n     ,cs2.cnt\nfrom cross_sales cs1,cross_sales cs2\nwhere cs1.item_sk=cs2.item_sk and\n     cs1.syear = 2001 and\n     cs2.syear = 2001 + 1 and\n     cs2.cnt <= cs1.cnt and\n     cs1.store_name = cs2.store_name and\n     cs1.store_zip = cs2.store_zip\norder by cs1.product_name\n       ,cs1.store_name\n       ,cs2.cnt\n       ,cs1.s1\n       ,cs2.s1;\n\n-- end query 64 in stream 0 using template query64.tpl\n",
        "optimized_sql": "WITH filtered_item AS (\n  SELECT i_item_sk\n  FROM item\n  WHERE i_color IN ('blanched', 'medium', 'brown', 'chocolate', 'burlywood', 'drab')\n    AND i_current_price BETWEEN 24 AND 33  -- Consolidated: 23+1 to 23+15\n),\ncs_ui AS (\n  SELECT\n    cs.cs_item_sk,\n    SUM(cs.cs_ext_list_price) AS sale,\n    SUM(cr.cr_refunded_cash + cr.cr_reversed_charge + cr.cr_store_credit) AS refund\n  FROM catalog_sales cs\n  JOIN catalog_returns cr\n    ON cs.cs_item_sk = cr.cr_item_sk\n   AND cs.cs_order_number = cr.cr_order_number\n  JOIN filtered_item fi\n    ON cs.cs_item_sk = fi.i_item_sk\n  GROUP BY cs.cs_item_sk\n  HAVING SUM(cs.cs_ext_list_price) > 2 * SUM(cr.cr_refunded_cash + cr.cr_reversed_charge + cr.cr_store_credit)\n),\nfiltered_d1 AS (\n  SELECT d_date_sk, d_year\n  FROM date_dim\n  WHERE d_year IN (2001, 2002)\n),\npre_joined_sales AS (\n  SELECT\n    ss.ss_item_sk,\n    ss.ss_ticket_number,\n    ss.ss_store_sk,\n    ss.ss_customer_sk,\n    ss.ss_cdemo_sk,\n    ss.ss_hdemo_sk,\n    ss.ss_addr_sk,\n    ss.ss_promo_sk,\n    ss.ss_wholesale_cost,\n    ss.ss_list_price,\n    ss.ss_coupon_amt,\n    d1.d_year AS syear\n  FROM store_sales ss\n  JOIN filtered_d1 d1\n    ON ss.ss_sold_date_sk = d1.d_date_sk\n  JOIN filtered_item fi\n    ON ss.ss_item_sk = fi.i_item_sk\n),\ncross_sales AS (\n  SELECT\n    i.i_product_name AS product_name,\n    i.i_item_sk AS item_sk,\n    s.s_store_name AS store_name,\n    s.s_zip AS store_zip,\n    ad1.ca_street_number AS b_street_number,\n    ad1.ca_street_name AS b_street_name,\n    ad1.ca_city AS b_city,\n    ad1.ca_zip AS b_zip,\n    ad2.ca_street_number AS c_street_number,\n    ad2.ca_street_name AS c_street_name,\n    ad2.ca_city AS c_city,\n    ad2.ca_zip AS c_zip,\n    pjs.syear,\n    d2.d_year AS fsyear,\n    d3.d_year AS s2year,\n    COUNT(*) AS cnt,\n    SUM(pjs.ss_wholesale_cost) AS s1,\n    SUM(pjs.ss_list_price) AS s2,\n    SUM(pjs.ss_coupon_amt) AS s3\n  FROM pre_joined_sales pjs\n  JOIN store_returns sr\n    ON pjs.ss_item_sk = sr.sr_item_sk\n   AND pjs.ss_ticket_number = sr.sr_ticket_number\n  JOIN cs_ui\n    ON pjs.ss_item_sk = cs_ui.cs_item_sk\n  JOIN store s\n    ON pjs.ss_store_sk = s.s_store_sk\n  JOIN customer c\n    ON pjs.ss_customer_sk = c.c_customer_sk\n  JOIN customer_demographics cd1\n    ON pjs.ss_cdemo_sk = cd1.cd_demo_sk\n  JOIN customer_demographics cd2\n    ON c.c_current_cdemo_sk = cd2.cd_demo_sk\n  JOIN household_demographics hd1\n    ON pjs.ss_hdemo_sk = hd1.hd_demo_sk\n  JOIN household_demographics hd2\n    ON c.c_current_hdemo_sk = hd2.hd_demo_sk\n  JOIN customer_address ad1\n    ON pjs.ss_addr_sk = ad1.ca_address_sk\n  JOIN customer_address ad2\n    ON c.c_current_addr_sk = ad2.ca_address_sk\n  JOIN promotion p\n    ON pjs.ss_promo_sk = p.p_promo_sk\n  JOIN date_dim d2\n    ON c.c_first_sales_date_sk = d2.d_date_sk\n  JOIN date_dim d3\n    ON c.c_first_shipto_date_sk = d3.d_date_sk\n  JOIN income_band ib1\n    ON hd1.hd_income_band_sk = ib1.ib_income_band_sk\n  JOIN income_band ib2\n    ON hd2.hd_income_band_sk = ib2.ib_income_band_sk\n  JOIN item i\n    ON pjs.ss_item_sk = i.i_item_sk\n  WHERE cd1.cd_marital_status <> cd2.cd_marital_status\n  GROUP BY\n    i.i_product_name,\n    i.i_item_sk,\n    s.s_store_name,\n    s.s_zip,\n    ad1.ca_street_number,\n    ad1.ca_street_name,\n    ad1.ca_city,\n    ad1.ca_zip,\n    ad2.ca_street_number,\n    ad2.ca_street_name,\n    ad2.ca_city,\n    ad2.ca_zip,\n    pjs.syear,\n    d2.d_year,\n    d3.d_year\n)\nSELECT\n  cs1.product_name,\n  cs1.store_name,\n  cs1.store_zip,\n  cs1.b_street_number,\n  cs1.b_street_name,\n  cs1.b_city,\n  cs1.b_zip,\n  cs1.c_street_number,\n  cs1.c_street_name,\n  cs1.c_city,\n  cs1.c_zip,\n  cs1.syear,\n  cs1.cnt,\n  cs1.s1 AS s11,\n  cs1.s2 AS s21,\n  cs1.s3 AS s31,\n  cs2.s1 AS s12,\n  cs2.s2 AS s22,\n  cs2.s3 AS s32,\n  cs2.syear,\n  cs2.cnt\nFROM cross_sales cs1\nJOIN cross_sales cs2\n  ON cs1.item_sk = cs2.item_sk\n AND cs1.store_name = cs2.store_name\n AND cs1.store_zip = cs2.store_zip\nWHERE cs1.syear = 2001\n  AND cs2.syear = 2002\n  AND cs2.cnt <= cs1.cnt\nORDER BY\n  cs1.product_name,\n  cs1.store_name,\n  cs2.cnt,\n  cs1.s1,\n  cs2.s1;",
        "transforms": [
          "date_cte_isolate",
          "dimension_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": "** Created a unified `filtered_item` CTE with the item color/price conditions and used it to filter both catalog tables (in `cs_ui`) and store sales early. Pre-joined store sales with filtered items and date dimension d1 (for years 2001-2002) before joining with other dimensions. Restructured `cs_ui` to join catalog tables with filtered items first. This reduces the fact table joins by applying filters at the earliest possible stage.\n\n**Expected speedup:** 2-3x by reducing the volume of catalog ",
        "reasoning": "```sql\nWITH filtered_item AS (\n  SELECT i_item_sk\n  FROM item\n  WHERE i_color IN ('blanched', 'medium', 'brown', 'chocolate', 'burlywood', 'drab')\n    AND i_current_price BETWEEN 24 AND 33  -- Consolidated: 23+1 to 23+15\n),\ncs_ui AS (\n  SELECT\n    cs.cs_item_sk,\n    SUM(cs.cs_ext_list_price) AS sale,\n    SUM(cr.cr_refunded_cash + cr.cr_reversed_charge + cr.cr_store_credit) AS refund\n  FROM catalog_sales cs\n  JOIN catalog_returns cr\n    ON cs.cs_item_sk = cr.cr_item_sk\n   AND cs.cs_order_number = cr.cr_order_number\n  JOIN filtered_item fi\n    ON cs.cs_item_sk = fi.i_item_sk\n  GROUP BY cs.cs_item_sk\n  HAVING SUM(cs.cs_ext_list_price) > 2 * SUM(cr.cr_refunded_cash + cr.cr_reversed_charge + cr.cr_store_credit)\n),\nfiltered_d1 AS (\n  SELECT d_date_sk, d_year\n  FROM date_dim\n  WHERE d_year IN (2001, 2002)\n),\npre_joined_sales AS (\n  SELECT\n    ss.ss_item_sk,\n    ss.ss_ticket_number,\n    ss.ss_store_sk,\n    ss.ss_customer_sk,\n    ss.ss_cdemo_sk,\n    ss.ss_hdemo_sk,\n    ss.ss_addr_sk,\n    ss.ss_promo_sk,\n    ss.ss_wholesale_cost,\n    ss.ss_list_price,\n    ss.ss_coupon_amt,\n    d1.d_year AS syear\n  FROM store_sales ss\n  JOIN filtered_d1 d1\n    ON ss.ss_sold_date_sk = d1.d_date_sk\n  JOIN filtered_item fi\n    ON ss.ss_item_sk = fi.i_item_sk\n),\ncross_sales AS (\n  SELECT\n    i.i_product_name AS product_name,\n    i.i_item_sk AS item_sk,\n    s.s_store_name AS store_name,\n    s.s_zip AS store_zip,\n    ad1.ca_street_number AS b_street_number,\n    ad1.ca_street_name AS b_street_name,\n    ad1.ca_city AS b_city,\n    ad1.ca_zip AS b_zip,\n    ad2.ca_street_number AS c_street_number,\n    ad2.ca_street_name AS c_street_name,\n    ad2.ca_city AS c_city,\n    ad2.ca_zip AS c_zip,\n    pjs.syear,\n    d2.d_year AS fsyear,\n    d3.d_year AS s2year,\n    COUNT(*) AS cnt,\n    SUM(pjs.ss_wholesale_cost) AS s1,\n    SUM(pjs.ss_list_price) AS s2,\n    SUM(pjs.ss_coupon_amt) AS s3\n  FROM pre_joined_sales pjs\n  JOIN store_returns sr\n    ON pjs.ss_item_sk = sr.sr_item_sk\n   AND pjs.ss_ticket_number = sr.sr_ticket_number\n  JOIN cs_ui\n    ON pjs.ss_item_sk = cs_ui.cs_item_sk\n  JOIN store s\n    ON pjs.ss_store_sk = s.s_store_sk\n  JOIN customer c\n    ON pjs.ss_customer_sk = c.c_customer_sk\n  JOIN customer_demographics cd1\n    ON pjs.ss_cdemo_sk = cd1.cd_demo_sk\n  JOIN customer_demographics cd2\n    ON c.c_current_cdemo_sk = cd2.cd_demo_sk\n  JOIN household_demographics hd1\n    ON pjs.ss_hdemo_sk = hd1.hd_demo_sk\n  JOIN household_demographics hd2\n    ON c.c_current_hdemo_sk = hd2.hd_demo_sk\n  JOIN customer_address ad1\n    ON pjs.ss_addr_sk = ad1.ca_address_sk\n  JOIN customer_address ad2\n    ON c.c_current_addr_sk = ad2.ca_address_sk\n  JOIN promotion p\n    ON pjs.ss_promo_sk = p.p_promo_sk\n  JOIN date_dim d2\n    ON c.c_first_sales_date_sk = d2.d_date_sk\n  JOIN date_dim d3\n    ON c.c_first_shipto_date_sk = d3.d_date_sk\n  JOIN income_band ib1\n    ON hd1.hd_income_band_sk = ib1.ib_income_band_sk\n  JOIN income_band ib2\n    ON hd2.hd_income_band_sk = ib2.ib_income_band_sk\n  JOIN item i\n    ON pjs.ss_item_sk = i.i_item_sk\n  WHERE cd1.cd_marital_status <> cd2.cd_marital_status\n  GROUP BY\n    i.i_product_name,\n    i.i_item_sk,\n    s.s_store_name,\n    s.s_zip,\n    ad1.ca_street_number,\n    ad1.ca_street_name,\n    ad1.ca_city,\n    ad1.ca_zip,\n    ad2.ca_street_number,\n    ad2.ca_street_name,\n    ad2.ca_city,\n    ad2.ca_zip,\n    pjs.syear,\n    d2.d_year,\n    d3.d_year\n)\nSELECT\n  cs1.product_name,\n  cs1.store_name,\n  cs1.store_zip,\n  cs1.b_street_number,\n  cs1.b_street_name,\n  cs1.b_city,\n  cs1.b_zip,\n  cs1.c_street_number,\n  cs1.c_street_name,\n  cs1.c_city,\n  cs1.c_zip,\n  cs1.syear,\n  cs1.cnt,\n  cs1.s1 AS s11,\n  cs1.s2 AS s21,\n  cs1.s3 AS s31,\n  cs2.s1 AS s12,\n  cs2.s2 AS s22,\n  cs2.s3 AS s32,\n  cs2.syear,\n  cs2.cnt\nFROM cross_sales cs1\nJOIN cross_sales cs2\n  ON cs1.item_sk = cs2.item_sk\n AND cs1.store_name = cs2.store_name\n AND cs1.store_zip = cs2.store_zip\nWHERE cs1.syear = 2001\n  AND cs2.syear = 2002\n  AND cs2.cnt <= cs1.cnt\nORDER BY\n  cs1.product_name,\n  cs1.store_name,\n  cs2.cnt,\n  cs1.s1,\n  cs2.s1;\n```\n\n**Changes:** Created a unified `filtered_item` CTE with the item color/price conditions and used it to filter both catalog tables (in `cs_ui`) and store sales early. Pre-joined store sales with filtered items and date dimension d1 (for years 2001-2002) before joining with other dimensions. Restructured `cs_ui` to join catalog tables with filtered items first. This reduces the fact table joins by applying filters at the earliest possible stage.\n\n**Expected speedup:** 2-3x by reducing the volume of catalog and store sales data before complex joins.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 6,
          "iteration": 2,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.6469458482745085,
            "original_ms": 1419.938524333702,
            "optimized_ms": 862.164670332883,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_cte_prefetch",
            "speedup": 1.240353076721837,
            "original_ms": 1531.8869013335643,
            "optimized_ms": 1235.0409976667531,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.1133538416013442,
            "original_ms": 1493.8336153330358,
            "optimized_ms": 1341.74200466623,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.0433966272980197,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.0115792115171205,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.01,
            "original_ms": 3841.1,
            "optimized_ms": 3818.76,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": []
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_filter_pushdown",
            "speedup": 0.9917857308077331,
            "original_ms": 1531.8869013335643,
            "optimized_ms": 1544.5744516670554,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_date_dimension_isolation",
            "speedup": 0.9664262449713261,
            "original_ms": 1531.8869013335643,
            "optimized_ms": 1585.104822333354,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.5220614546094987,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transforms",
            "speedup": 0.3729444333094838,
            "original_ms": 1531.8869013335643,
            "optimized_ms": 4107.5473033333765,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "intersect_to_exists",
              "or_to_union",
              "decorrelate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q65": {
        "query_id": "q65",
        "status": "WIN",
        "best_speedup": 1.8449,
        "original_ms": 1494.63,
        "optimized_ms": 810.15,
        "original_sql": "-- start query 65 in stream 0 using template query65.tpl\nselect\n\ts_store_name,\n\ti_item_desc,\n\tsc.revenue,\n\ti_current_price,\n\ti_wholesale_cost,\n\ti_brand\n from store, item,\n     (select ss_store_sk, avg(revenue) as ave\n \tfrom\n \t    (select  ss_store_sk, ss_item_sk, \n \t\t     sum(ss_sales_price) as revenue\n \t\tfrom store_sales, date_dim\n \t\twhere ss_sold_date_sk = d_date_sk and d_month_seq between 1221 and 1221+11\n \t\tgroup by ss_store_sk, ss_item_sk) sa\n \tgroup by ss_store_sk) sb,\n     (select  ss_store_sk, ss_item_sk, sum(ss_sales_price) as revenue\n \tfrom store_sales, date_dim\n \twhere ss_sold_date_sk = d_date_sk and d_month_seq between 1221 and 1221+11\n \tgroup by ss_store_sk, ss_item_sk) sc\n where sb.ss_store_sk = sc.ss_store_sk and \n       sc.revenue <= 0.1 * sb.ave and\n       s_store_sk = sc.ss_store_sk and\n       i_item_sk = sc.ss_item_sk\n order by s_store_name, i_item_desc\n LIMIT 100;\n\n-- end query 65 in stream 0 using template query65.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_month_seq BETWEEN 1221 AND 1221 + 11\n),\nfiltered_sales AS (\n    SELECT \n        ss_store_sk,\n        ss_item_sk,\n        SUM(ss_sales_price) AS revenue\n    FROM store_sales\n    JOIN filtered_dates ON ss_sold_date_sk = d_date_sk\n    GROUP BY ss_store_sk, ss_item_sk\n),\nstore_avg AS (\n    SELECT \n        ss_store_sk,\n        AVG(revenue) AS ave\n    FROM filtered_sales\n    GROUP BY ss_store_sk\n),\nfiltered_low_revenue AS (\n    SELECT \n        fs.ss_store_sk,\n        fs.ss_item_sk,\n        fs.revenue\n    FROM filtered_sales fs\n    JOIN store_avg sa ON fs.ss_store_sk = sa.ss_store_sk\n    WHERE fs.revenue <= 0.1 * sa.ave\n)\nSELECT \n    s_store_name,\n    i_item_desc,\n    flr.revenue,\n    i_current_price,\n    i_wholesale_cost,\n    i_brand\nFROM filtered_low_revenue flr\nJOIN store ON s_store_sk = flr.ss_store_sk\nJOIN item ON i_item_sk = flr.ss_item_sk\nORDER BY s_store_name, i_item_desc\nLIMIT 100;",
        "transforms": [
          "prefetch_fact_join",
          "multi_dimension_prefetch",
          "single_pass_aggregation"
        ],
        "principle": "prefetch_fact_join",
        "changes_description": "Applied aggressive prefetch restructuring by: (1) creating filtered_dates CTE to pre-filter date range once, (2) creating filtered_sales CTE to compute store-item revenue in single pass, (3) computing store averages from filtered_sales in separate CTE, (4) joining these CTEs for the low-revenue filter before final dimension joins.",
        "reasoning": "```sql\nWITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_month_seq BETWEEN 1221 AND 1221 + 11\n),\nfiltered_sales AS (\n    SELECT \n        ss_store_sk,\n        ss_item_sk,\n        SUM(ss_sales_price) AS revenue\n    FROM store_sales\n    JOIN filtered_dates ON ss_sold_date_sk = d_date_sk\n    GROUP BY ss_store_sk, ss_item_sk\n),\nstore_avg AS (\n    SELECT \n        ss_store_sk,\n        AVG(revenue) AS ave\n    FROM filtered_sales\n    GROUP BY ss_store_sk\n),\nfiltered_low_revenue AS (\n    SELECT \n        fs.ss_store_sk,\n        fs.ss_item_sk,\n        fs.revenue\n    FROM filtered_sales fs\n    JOIN store_avg sa ON fs.ss_store_sk = sa.ss_store_sk\n    WHERE fs.revenue <= 0.1 * sa.ave\n)\nSELECT \n    s_store_name,\n    i_item_desc,\n    flr.revenue,\n    i_current_price,\n    i_wholesale_cost,\n    i_brand\nFROM filtered_low_revenue flr\nJOIN store ON s_store_sk = flr.ss_store_sk\nJOIN item ON i_item_sk = flr.ss_item_sk\nORDER BY s_store_name, i_item_desc\nLIMIT 100;\n```\n\nChanges: Applied aggressive prefetch restructuring by: (1) creating filtered_dates CTE to pre-filter date range once, (2) creating filtered_sales CTE to compute store-item revenue in single pass, (3) computing store averages from filtered_sales in separate CTE, (4) joining these CTEs for the low-revenue filter before final dimension joins.\n\nExpected speedup: 2-3x from eliminating duplicate fact table scans and pushing all date filtering early.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": "aggressive_prefetch_restructuring"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructuring",
            "speedup": 1.8448737327854032,
            "original_ms": 1494.6319939996708,
            "optimized_ms": 810.1540866664436,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.83,
            "original_ms": 3547.95,
            "optimized_ms": 1934.28,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_date_isolation",
            "speedup": 1.8027040998221822,
            "original_ms": 1494.6319939996708,
            "optimized_ms": 829.1055609997784,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_materialization",
            "speedup": 1.790164901076323,
            "original_ms": 1494.6319939996708,
            "optimized_ms": 834.9130256665376,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transformation",
            "speedup": 1.7875141190130917,
            "original_ms": 1494.6319939996708,
            "optimized_ms": 836.1511543331895,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.7397191441331323,
            "original_ms": 1402.4797706661047,
            "optimized_ms": 806.1529789999137,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.7268574193043773,
            "original_ms": 1540.6900456661485,
            "optimized_ms": 892.1929676665362,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q66": {
        "query_id": "q66",
        "status": "WIN",
        "best_speedup": 1.23,
        "original_ms": 444.51,
        "optimized_ms": 361.39,
        "original_sql": "-- start query 66 in stream 0 using template query66.tpl\nselect  \n         w_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n        ,ship_carriers\n        ,year\n \t,sum(jan_sales) as jan_sales\n \t,sum(feb_sales) as feb_sales\n \t,sum(mar_sales) as mar_sales\n \t,sum(apr_sales) as apr_sales\n \t,sum(may_sales) as may_sales\n \t,sum(jun_sales) as jun_sales\n \t,sum(jul_sales) as jul_sales\n \t,sum(aug_sales) as aug_sales\n \t,sum(sep_sales) as sep_sales\n \t,sum(oct_sales) as oct_sales\n \t,sum(nov_sales) as nov_sales\n \t,sum(dec_sales) as dec_sales\n \t,sum(jan_sales/w_warehouse_sq_ft) as jan_sales_per_sq_foot\n \t,sum(feb_sales/w_warehouse_sq_ft) as feb_sales_per_sq_foot\n \t,sum(mar_sales/w_warehouse_sq_ft) as mar_sales_per_sq_foot\n \t,sum(apr_sales/w_warehouse_sq_ft) as apr_sales_per_sq_foot\n \t,sum(may_sales/w_warehouse_sq_ft) as may_sales_per_sq_foot\n \t,sum(jun_sales/w_warehouse_sq_ft) as jun_sales_per_sq_foot\n \t,sum(jul_sales/w_warehouse_sq_ft) as jul_sales_per_sq_foot\n \t,sum(aug_sales/w_warehouse_sq_ft) as aug_sales_per_sq_foot\n \t,sum(sep_sales/w_warehouse_sq_ft) as sep_sales_per_sq_foot\n \t,sum(oct_sales/w_warehouse_sq_ft) as oct_sales_per_sq_foot\n \t,sum(nov_sales/w_warehouse_sq_ft) as nov_sales_per_sq_foot\n \t,sum(dec_sales/w_warehouse_sq_ft) as dec_sales_per_sq_foot\n \t,sum(jan_net) as jan_net\n \t,sum(feb_net) as feb_net\n \t,sum(mar_net) as mar_net\n \t,sum(apr_net) as apr_net\n \t,sum(may_net) as may_net\n \t,sum(jun_net) as jun_net\n \t,sum(jul_net) as jul_net\n \t,sum(aug_net) as aug_net\n \t,sum(sep_net) as sep_net\n \t,sum(oct_net) as oct_net\n \t,sum(nov_net) as nov_net\n \t,sum(dec_net) as dec_net\n from (\n     select \n \tw_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n \t,'GREAT EASTERN' || ',' || 'LATVIAN' as ship_carriers\n       ,d_year as year\n \t,sum(case when d_moy = 1 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as jan_sales\n \t,sum(case when d_moy = 2 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as feb_sales\n \t,sum(case when d_moy = 3 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as mar_sales\n \t,sum(case when d_moy = 4 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as apr_sales\n \t,sum(case when d_moy = 5 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as may_sales\n \t,sum(case when d_moy = 6 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as jun_sales\n \t,sum(case when d_moy = 7 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as jul_sales\n \t,sum(case when d_moy = 8 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as aug_sales\n \t,sum(case when d_moy = 9 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as sep_sales\n \t,sum(case when d_moy = 10 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as oct_sales\n \t,sum(case when d_moy = 11\n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as nov_sales\n \t,sum(case when d_moy = 12\n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as dec_sales\n \t,sum(case when d_moy = 1 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as jan_net\n \t,sum(case when d_moy = 2\n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as feb_net\n \t,sum(case when d_moy = 3 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as mar_net\n \t,sum(case when d_moy = 4 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as apr_net\n \t,sum(case when d_moy = 5 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as may_net\n \t,sum(case when d_moy = 6 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as jun_net\n \t,sum(case when d_moy = 7 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as jul_net\n \t,sum(case when d_moy = 8 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as aug_net\n \t,sum(case when d_moy = 9 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as sep_net\n \t,sum(case when d_moy = 10 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as oct_net\n \t,sum(case when d_moy = 11\n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as nov_net\n \t,sum(case when d_moy = 12\n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as dec_net\n     from\n          web_sales\n         ,warehouse\n         ,date_dim\n         ,time_dim\n \t  ,ship_mode\n     where\n            ws_warehouse_sk =  w_warehouse_sk\n        and ws_sold_date_sk = d_date_sk\n        and ws_sold_time_sk = t_time_sk\n \tand ws_ship_mode_sk = sm_ship_mode_sk\n        and d_year = 1998\n \tand t_time between 48821 and 48821+28800 \n \tand sm_carrier in ('GREAT EASTERN','LATVIAN')\n     group by \n        w_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n       ,d_year\n union all\n     select \n \tw_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n \t,'GREAT EASTERN' || ',' || 'LATVIAN' as ship_carriers\n       ,d_year as year\n \t,sum(case when d_moy = 1 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as jan_sales\n \t,sum(case when d_moy = 2 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as feb_sales\n \t,sum(case when d_moy = 3 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as mar_sales\n \t,sum(case when d_moy = 4 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as apr_sales\n \t,sum(case when d_moy = 5 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as may_sales\n \t,sum(case when d_moy = 6 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as jun_sales\n \t,sum(case when d_moy = 7 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as jul_sales\n \t,sum(case when d_moy = 8 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as aug_sales\n \t,sum(case when d_moy = 9 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as sep_sales\n \t,sum(case when d_moy = 10 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as oct_sales\n \t,sum(case when d_moy = 11\n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as nov_sales\n \t,sum(case when d_moy = 12\n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as dec_sales\n \t,sum(case when d_moy = 1 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as jan_net\n \t,sum(case when d_moy = 2 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as feb_net\n \t,sum(case when d_moy = 3 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as mar_net\n \t,sum(case when d_moy = 4 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as apr_net\n \t,sum(case when d_moy = 5 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as may_net\n \t,sum(case when d_moy = 6 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as jun_net\n \t,sum(case when d_moy = 7 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as jul_net\n \t,sum(case when d_moy = 8 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as aug_net\n \t,sum(case when d_moy = 9 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as sep_net\n \t,sum(case when d_moy = 10 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as oct_net\n \t,sum(case when d_moy = 11\n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as nov_net\n \t,sum(case when d_moy = 12\n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as dec_net\n     from\n          catalog_sales\n         ,warehouse\n         ,date_dim\n         ,time_dim\n \t ,ship_mode\n     where\n            cs_warehouse_sk =  w_warehouse_sk\n        and cs_sold_date_sk = d_date_sk\n        and cs_sold_time_sk = t_time_sk\n \tand cs_ship_mode_sk = sm_ship_mode_sk\n        and d_year = 1998\n \tand t_time between 48821 AND 48821+28800 \n \tand sm_carrier in ('GREAT EASTERN','LATVIAN')\n     group by \n        w_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n       ,d_year\n ) x\n group by \n        w_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n \t,ship_carriers\n       ,year\n order by w_warehouse_name\n LIMIT 100;\n\n-- end query 66 in stream 0 using template query66.tpl\n",
        "optimized_sql": "-- start query 66 in stream 0 using template query66.tpl\nselect  \n         w_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n        ,ship_carriers\n        ,year\n \t,sum(jan_sales) as jan_sales\n \t,sum(feb_sales) as feb_sales\n \t,sum(mar_sales) as mar_sales\n \t,sum(apr_sales) as apr_sales\n \t,sum(may_sales) as may_sales\n \t,sum(jun_sales) as jun_sales\n \t,sum(jul_sales) as jul_sales\n \t,sum(aug_sales) as aug_sales\n \t,sum(sep_sales) as sep_sales\n \t,sum(oct_sales) as oct_sales\n \t,sum(nov_sales) as nov_sales\n \t,sum(dec_sales) as dec_sales\n \t,sum(jan_sales/w_warehouse_sq_ft) as jan_sales_per_sq_foot\n \t,sum(feb_sales/w_warehouse_sq_ft) as feb_sales_per_sq_foot\n \t,sum(mar_sales/w_warehouse_sq_ft) as mar_sales_per_sq_foot\n \t,sum(apr_sales/w_warehouse_sq_ft) as apr_sales_per_sq_foot\n \t,sum(may_sales/w_warehouse_sq_ft) as may_sales_per_sq_foot\n \t,sum(jun_sales/w_warehouse_sq_ft) as jun_sales_per_sq_foot\n \t,sum(jul_sales/w_warehouse_sq_ft) as jul_sales_per_sq_foot\n \t,sum(aug_sales/w_warehouse_sq_ft) as aug_sales_per_sq_foot\n \t,sum(sep_sales/w_warehouse_sq_ft) as sep_sales_per_sq_foot\n \t,sum(oct_sales/w_warehouse_sq_ft) as oct_sales_per_sq_foot\n \t,sum(nov_sales/w_warehouse_sq_ft) as nov_sales_per_sq_foot\n \t,sum(dec_sales/w_warehouse_sq_ft) as dec_sales_per_sq_foot\n \t,sum(jan_net) as jan_net\n \t,sum(feb_net) as feb_net\n \t,sum(mar_net) as mar_net\n \t,sum(apr_net) as apr_net\n \t,sum(may_net) as may_net\n \t,sum(jun_net) as jun_net\n \t,sum(jul_net) as jul_net\n \t,sum(aug_net) as aug_net\n \t,sum(sep_net) as sep_net\n \t,sum(oct_net) as oct_net\n \t,sum(nov_net) as nov_net\n \t,sum(dec_net) as dec_net\n from (\n     select \n \tw_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n \t,'GREAT EASTERN' || ',' || 'LATVIAN' as ship_carriers\n       ,d_year as year\n \t,sum(case when d_moy = 1 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as jan_sales\n \t,sum(case when d_moy = 2 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as feb_sales\n \t,sum(case when d_moy = 3 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as mar_sales\n \t,sum(case when d_moy = 4 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as apr_sales\n \t,sum(case when d_moy = 5 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as may_sales\n \t,sum(case when d_moy = 6 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as jun_sales\n \t,sum(case when d_moy = 7 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as jul_sales\n \t,sum(case when d_moy = 8 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as aug_sales\n \t,sum(case when d_moy = 9 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as sep_sales\n \t,sum(case when d_moy = 10 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as oct_sales\n \t,sum(case when d_moy = 11\n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as nov_sales\n \t,sum(case when d_moy = 12\n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as dec_sales\n \t,sum(case when d_moy = 1 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as jan_net\n \t,sum(case when d_moy = 2\n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as feb_net\n \t,sum(case when d_moy = 3 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as mar_net\n \t,sum(case when d_moy = 4 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as apr_net\n \t,sum(case when d_moy = 5 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as may_net\n \t,sum(case when d_moy = 6 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as jun_net\n \t,sum(case when d_moy = 7 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as jul_net\n \t,sum(case when d_moy = 8 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as aug_net\n \t,sum(case when d_moy = 9 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as sep_net\n \t,sum(case when d_moy = 10 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as oct_net\n \t,sum(case when d_moy = 11\n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as nov_net\n \t,sum(case when d_moy = 12\n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as dec_net\n     from\n          web_sales\n         ,warehouse\n         ,date_dim\n         ,time_dim\n \t  ,ship_mode\n     where\n            ws_warehouse_sk =  w_warehouse_sk\n        and ws_sold_date_sk = d_date_sk\n        and ws_sold_time_sk = t_time_sk\n \tand ws_ship_mode_sk = sm_ship_mode_sk\n        and d_year = 1998\n \tand t_time between 48821 and 48821+28800 \n \tand sm_carrier in ('GREAT EASTERN','LATVIAN')\n     group by \n        w_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n       ,d_year\n union all\n     select \n \tw_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n \t,'GREAT EASTERN' || ',' || 'LATVIAN' as ship_carriers\n       ,d_year as year\n \t,sum(case when d_moy = 1 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as jan_sales\n \t,sum(case when d_moy = 2 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as feb_sales\n \t,sum(case when d_moy = 3 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as mar_sales\n \t,sum(case when d_moy = 4 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as apr_sales\n \t,sum(case when d_moy = 5 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as may_sales\n \t,sum(case when d_moy = 6 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as jun_sales\n \t,sum(case when d_moy = 7 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as jul_sales\n \t,sum(case when d_moy = 8 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as aug_sales\n \t,sum(case when d_moy = 9 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as sep_sales\n \t,sum(case when d_moy = 10 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as oct_sales\n \t,sum(case when d_moy = 11\n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as nov_sales\n \t,sum(case when d_moy = 12\n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as dec_sales\n \t,sum(case when d_moy = 1 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as jan_net\n \t,sum(case when d_moy = 2 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as feb_net\n \t,sum(case when d_moy = 3 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as mar_net\n \t,sum(case when d_moy = 4 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as apr_net\n \t,sum(case when d_moy = 5 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as may_net\n \t,sum(case when d_moy = 6 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as jun_net\n \t,sum(case when d_moy = 7 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as jul_net\n \t,sum(case when d_moy = 8 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as aug_net\n \t,sum(case when d_moy = 9 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as sep_net\n \t,sum(case when d_moy = 10 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as oct_net\n \t,sum(case when d_moy = 11\n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as nov_net\n \t,sum(case when d_moy = 12\n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as dec_net\n     from\n          catalog_sales\n         ,warehouse\n         ,date_dim\n         ,time_dim\n \t ,ship_mode\n     where\n            cs_warehouse_sk =  w_warehouse_sk\n        and cs_sold_date_sk = d_date_sk\n        and cs_sold_time_sk = t_time_sk\n \tand cs_ship_mode_sk = sm_ship_mode_sk\n        and d_year = 1998\n \tand t_time between 48821 AND 48821+28800 \n \tand sm_carrier in ('GREAT EASTERN','LATVIAN')\n     group by \n        w_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n       ,d_year\n ) x\n group by \n        w_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n \t,ship_carriers\n       ,year\n order by w_warehouse_name\n LIMIT 100;\n\n-- end query 66 in stream 0 using template query66.tpl\n",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": " ```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"early_filter\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE d_year = 1998\",\n        \"filtered_times\": \"SELECT t_time_sk FROM time_dim WHERE t_time BETWEEN 48821 AND 48821 + 28800\",\n        \"filtered_carriers\": \"SELECT sm_ship_mode_sk FROM ship_mode WHERE sm_carrier IN ('GREAT EASTERN', 'LATVIAN')\",\n        \"web_sales_branch\": \"SELECT w_warehouse_name, w_warehouse_sq_ft, w_city, w_county, w_state, w_country, 'GREAT EASTERN' || ',' || 'LATVIAN' AS ship_carriers, d_year AS year, SUM(CASE WHEN d_moy = 1 THEN ws_ext_sales_price * ws_quantity ELSE 0 END) AS jan_sales, SUM(CASE WHEN d_moy = 2 THEN ws_ext_sales_price * ws_quantity ELSE 0 END) AS feb_sales, SUM(CASE WHEN d_moy = 3 THEN ws_ext_sales_price * ws_quantity ELSE 0 END) AS mar_sales, SUM(CASE WHEN d_moy = 4 THEN ws_ext_sales_price * ws_quantity ELSE 0 END) AS apr_sales, SUM(CASE WHEN d_moy = 5 THEN ws_ext_sales_price * ws_quantity ELSE 0 END) AS may_sales, SUM(CASE WHEN d_moy = 6 THEN ws_ext_sales_price * ws_quantity ELSE 0 END) AS jun_sales, SUM(CASE WHEN d_moy = 7 THEN ws_ext_sales_price * ws_quantity ELSE 0 END) AS jul_sales, SUM(CASE WHEN d_moy = 8 THEN ws_ext_sales_price * ws_quantity ELSE 0 END) AS aug_sales, SUM(CASE WHEN d_moy = 9 THEN ws_ext_sales_price * ws_quantity ELSE 0 END) AS sep_sales, SUM(CASE WHEN d_moy = 10 THEN ws_ext_sales_price * ws_quantity ELSE 0 END) AS oct_sales, SUM(CASE WHEN d_moy = 11 THEN ws_ext_sales_price * ws_quantity ELSE 0 END) AS nov_sales, SUM(CASE WHEN d_moy = 12 THEN ws_ext_sales_price * ws_quantity ELSE 0 END) AS dec_sales, SUM(CASE WHEN d_moy = 1 THEN ws_net_paid_inc_ship_tax * ws_quantity ELSE 0 END) AS jan_net, SUM(CASE WHEN d_moy = 2 THEN ws_net_paid_inc_ship_tax * ws_quantity ELSE 0 END) AS feb_net, SUM(CASE WHEN d_moy = 3 THEN ws_net_paid_inc_ship_tax * ws_quantity ELSE 0 END) AS mar_net, SUM(CASE WHEN d_moy = 4 THEN ws_net_paid_inc_ship_tax * ws_quantity ELSE 0 END) AS apr_net, SUM(CASE WHEN d_moy = 5 THEN ws_net_paid_inc_ship_tax * ws_quantity ELSE 0 END) AS may_net, SUM(CASE WHEN d_moy = 6 THEN ws_net_paid_inc_ship_tax * ws_quantity ELSE 0 END) AS jun_net, SUM(CASE WHEN d_moy = 7 THEN ws_net_paid_inc_ship_tax * ws_quantity ELSE 0 END) AS jul_net, SUM(CASE WHEN d_moy = 8 THEN ws_net_paid_inc_ship_tax * ws_quantity ELSE 0 END) AS aug_net, SUM(CASE WHEN d_moy = 9 THEN ws_net_paid_inc_ship_tax * ws_quantity ELSE 0 END) AS sep_net, SUM(CASE WHEN d_moy = 10 THEN ws_net_paid_inc_ship_tax * ws_quantity ELSE 0 END) AS oct_net, SUM(CASE WHEN d_moy = 11 THEN ws_net_paid_inc_ship_tax * ws_quantity ELSE 0 END) AS nov_net, SUM(CASE WHEN d_moy = 12 THEN ws_net_paid_inc_ship_tax * ws_quantity ELSE 0 END) AS dec_net FROM web_sales JOIN warehouse ON ws_warehouse_sk = w_warehouse_sk JOIN filtered_dates ON ws_sold_date_sk = d_date_sk JOIN filtered_times ON ws_sold_time_sk = t_time_sk JOIN filtered_carriers ON ws_ship_mode_sk = sm_ship_mode_sk GROUP BY w_warehouse_name, w_warehouse_sq_ft, w_city, w_county, w_state, w_country, d_year\",\n        \"catalog_sales_branch\": \"SELECT w_warehouse_name, w_warehouse_sq_ft, w_city, w_county, w_state, w_country, 'GREAT EASTERN' || ',' || 'LATVIAN' AS ship_carriers, d_year AS year, SUM(CASE WHEN d_moy = 1 THEN cs_ext_list_price * cs_quantity ELSE 0 END) AS jan_sales, SUM(CASE WHEN d_moy = 2 THEN cs_ext_list_price * cs_quantity ELSE 0 END) AS feb_sales, SUM(CASE WHEN d_moy = 3 THEN cs_ext_list_price * cs_quantity ELSE 0 END) AS mar_sales, SUM(CASE WHEN d_moy = 4 THEN cs_ext_list_price * cs_quantity ELSE 0 END) AS apr_sales, SUM(CASE WHEN d_moy = 5 THEN cs_ext_list_price * cs_quantity ELSE 0 END) AS may_sales, SUM(CASE WHEN d_moy = 6 THEN cs_ext_list_price * cs_quantity ELSE 0 END) AS jun_sales, SUM(CASE WHEN d_moy = 7 THEN cs_ext_list_price * cs_quantity ELSE 0 END) AS jul_sales, SUM(CASE WHEN d_moy = 8 THEN cs_ext_list_price * cs_quantity ELSE 0 END) AS aug_sales, SUM(CASE WHEN d_moy = 9 THEN cs_ext_list_price * cs_quantity ELSE 0 END) AS sep_sales, SUM(CASE WHEN d_moy = 10 THEN cs_ext_list_price * cs_quantity ELSE 0 END) AS oct_sales, SUM(CASE WHEN d_moy = 11 THEN cs_ext_list_price * cs_quantity ELSE 0 END) AS nov_sales, SUM(CASE WHEN d_moy = 12 THEN cs_ext_list_price * cs_quantity ELSE 0 END) AS dec_sales, SUM(CASE WHEN d_moy = 1 THEN cs_net_paid_inc_ship_tax * cs_quantity ELSE 0 END) AS jan_net, SUM(CASE WHEN d_moy = 2 THEN cs_net_paid_inc_ship_tax * cs_quantity ELSE 0 END) AS feb_net, SUM(CASE WHEN d_moy = 3 THEN cs_net_paid_inc_ship_tax * cs_quantity ELSE 0 END) AS mar_net, SUM(CASE WHEN d_moy = 4 THEN cs_net_paid_inc_ship_tax * cs_quantity ELSE 0 END) AS apr_net, SUM(CASE WHEN d_moy = 5 THEN cs_net_paid_inc_ship_tax * cs_quantity ELSE 0 END) AS may_net, SUM(CASE WHEN d_moy = 6 THEN cs_net_paid_inc_ship_tax * cs_quantity ELSE 0 END) AS jun_net, SUM(CASE WHEN d_moy = 7 THEN cs_net_paid_inc_ship_tax * cs_quantity ELSE 0 END) AS jul_net, SUM(CASE WHEN d_moy = 8 THEN cs_net_paid_inc_ship_tax * cs_quantity ELSE 0 END) AS aug_net, SUM(CASE WHEN d_moy = 9 THEN cs_net_paid_inc_ship_tax * cs_quantity ELSE 0 END) AS sep_net, SUM(CASE WHEN d_moy = 10 THEN cs_net_paid_inc_ship_tax * cs_quantity ELSE 0 END) AS oct_net, SUM(CASE WHEN d_moy = 11 THEN cs_net_paid_inc_ship_tax * cs_quantity ELSE 0 END) AS nov_net, SUM(CASE WHEN d_moy = 12 THEN cs_net_paid_inc_ship_tax * cs_quantity ELSE 0 END) AS dec_net FROM catalog_sales JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN filtered_times ON cs_sold_time_sk = t_time_sk JOIN filtered_carriers ON cs_ship_mode_sk = sm_ship_mode_sk GROUP BY w_warehouse_name, w_warehouse_sq_ft, w_city, w_county, w_state, w_country, d_year\",\n        \"main_query\": \"SELECT w_warehouse_name, w_warehouse_sq_ft, w_city, w_county, w_state, w_country, ship_carriers, year, SUM(jan_sales) AS jan_sales, SUM(feb_sales) AS feb_sales, SUM(mar_sales) AS mar_sales, SUM(apr_sales) AS apr_sales, SUM(may_sales) AS may_sales, SUM(jun_sales) AS jun_sales, SUM(jul_sales) AS jul_sales, SUM(aug_sales) AS aug_sales, SUM(sep_sales) AS sep_sales, SUM(oct_sales) AS oct_sales, SUM(nov_sales) AS nov_sales, SUM(dec_sales) AS dec_sales, SUM(jan_sales / w_warehouse_sq_ft) AS jan_sales_per_sq_foot, SUM(feb_sales / w_warehouse_sq_ft) AS feb_sales_per_sq_foot, SUM(mar_sales / w_warehouse_sq_ft) AS mar_sales_per_sq_foot, SUM(apr_sales / w_warehouse_sq_ft) AS apr_sales_per_sq_foot, SUM(may_sales / w_warehouse_sq_ft) AS may_sales_per_sq_foot, SUM(jun_sales / w_warehouse_sq_ft) AS jun_sales_per_sq_f",
        "provenance": {
          "source": "Kimi",
          "run": "kimi_k2.5",
          "model": "kimi-k2.5",
          "worker_id": null,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.23,
            "original_ms": 444.51,
            "optimized_ms": 361.31,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.081787462681993,
            "original_ms": 224.28876300061043,
            "optimized_ms": 207.33163466744978,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 1.0577424048651554,
            "original_ms": 219.1616686668567,
            "optimized_ms": 207.1975819999352,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch",
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.0288170094951337,
            "original_ms": 219.1616686668567,
            "optimized_ms": 213.02298333345485,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.9970184406979152,
            "original_ms": 196.8230973337389,
            "optimized_ms": 197.41169200036288,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": []
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_and_filter",
            "speedup": 0.9767504979223688,
            "original_ms": 219.1616686668567,
            "optimized_ms": 224.37835366660389,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0.9603237945073724,
            "original_ms": 219.1616686668567,
            "optimized_ms": 228.21643066678612,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q67": {
        "query_id": "q67",
        "status": "WIN",
        "best_speedup": 1.501,
        "original_ms": 10268.99,
        "optimized_ms": 6841.39,
        "original_sql": "-- start query 67 in stream 0 using template query67.tpl\nselect *\nfrom (select i_category\n            ,i_class\n            ,i_brand\n            ,i_product_name\n            ,d_year\n            ,d_qoy\n            ,d_moy\n            ,s_store_id\n            ,sumsales\n            ,rank() over (partition by i_category order by sumsales desc) rk\n      from (select i_category\n                  ,i_class\n                  ,i_brand\n                  ,i_product_name\n                  ,d_year\n                  ,d_qoy\n                  ,d_moy\n                  ,s_store_id\n                  ,sum(coalesce(ss_sales_price*ss_quantity,0)) sumsales\n            from store_sales\n                ,date_dim\n                ,store\n                ,item\n       where  ss_sold_date_sk=d_date_sk\n          and ss_item_sk=i_item_sk\n          and ss_store_sk = s_store_sk\n          and d_month_seq between 1206 and 1206+11\n       group by  rollup(i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy,s_store_id))dw1) dw2\nwhere rk <= 100\norder by i_category\n        ,i_class\n        ,i_brand\n        ,i_product_name\n        ,d_year\n        ,d_qoy\n        ,d_moy\n        ,s_store_id\n        ,sumsales\n        ,rk\n LIMIT 100;\n\n-- end query 67 in stream 0 using template query67.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (\n    SELECT \n        d_date_sk,\n        d_year,\n        d_qoy,\n        d_moy\n    FROM date_dim\n    WHERE d_month_seq BETWEEN 1206 AND 1206 + 11\n),\nfact_agg AS (\n    SELECT\n        ss_item_sk,\n        ss_store_sk,\n        d.d_date_sk,\n        SUM(COALESCE(ss_sales_price * ss_quantity, 0)) AS sum_sales\n    FROM store_sales\n    JOIN filtered_dates d ON ss_sold_date_sk = d.d_date_sk\n    GROUP BY 1, 2, 3\n),\ndetailed_agg AS (\n    SELECT\n        i.i_category,\n        i.i_class,\n        i.i_brand,\n        i.i_product_name,\n        d.d_year,\n        d.d_qoy,\n        d.d_moy,\n        s.s_store_id,\n        fa.sum_sales AS sumsales\n    FROM fact_agg fa\n    JOIN item i ON fa.ss_item_sk = i.i_item_sk\n    JOIN store s ON fa.ss_store_sk = s.s_store_sk\n    JOIN filtered_dates d ON fa.d_date_sk = d.d_date_sk\n    GROUP BY \n        i.i_category,\n        i.i_class,\n        i.i_brand,\n        i.i_product_name,\n        d.d_year,\n        d.d_qoy,\n        d.d_moy,\n        s.s_store_id,\n        fa.sum_sales\n)\nSELECT\n    i_category,\n    i_class,\n    i_brand,\n    i_product_name,\n    d_year,\n    d_qoy,\n    d_moy,\n    s_store_id,\n    sumsales,\n    rk\nFROM (\n    SELECT\n        *,\n        RANK() OVER (PARTITION BY i_category ORDER BY sumsales DESC) AS rk\n    FROM detailed_agg\n) ranked\nWHERE rk <= 100\nORDER BY\n    i_category,\n    i_class,\n    i_brand,\n    i_product_name,\n    d_year,\n    d_qoy,\n    d_moy,\n    s_store_id,\n    sumsales,\n    rk\nLIMIT 100;",
        "transforms": [
          "decorrelate",
          "date_cte_isolate",
          "dimension_cte_isolate"
        ],
        "principle": "decorrelate",
        "changes_description": null,
        "reasoning": "```sql\nWITH filtered_dates AS (\n    SELECT \n        d_date_sk,\n        d_year,\n        d_qoy,\n        d_moy\n    FROM date_dim\n    WHERE d_month_seq BETWEEN 1206 AND 1206 + 11\n),\nfact_agg AS (\n    SELECT\n        ss_item_sk,\n        ss_store_sk,\n        d.d_date_sk,\n        SUM(COALESCE(ss_sales_price * ss_quantity, 0)) AS sum_sales\n    FROM store_sales\n    JOIN filtered_dates d ON ss_sold_date_sk = d.d_date_sk\n    GROUP BY 1, 2, 3\n),\ndetailed_agg AS (\n    SELECT\n        i.i_category,\n        i.i_class,\n        i.i_brand,\n        i.i_product_name,\n        d.d_year,\n        d.d_qoy,\n        d.d_moy,\n        s.s_store_id,\n        fa.sum_sales AS sumsales\n    FROM fact_agg fa\n    JOIN item i ON fa.ss_item_sk = i.i_item_sk\n    JOIN store s ON fa.ss_store_sk = s.s_store_sk\n    JOIN filtered_dates d ON fa.d_date_sk = d.d_date_sk\n    GROUP BY \n        i.i_category,\n        i.i_class,\n        i.i_brand,\n        i.i_product_name,\n        d.d_year,\n        d.d_qoy,\n        d.d_moy,\n        s.s_store_id,\n        fa.sum_sales\n)\nSELECT\n    i_category,\n    i_class,\n    i_brand,\n    i_product_name,\n    d_year,\n    d_qoy,\n    d_moy,\n    s_store_id,\n    sumsales,\n    rk\nFROM (\n    SELECT\n        *,\n        RANK() OVER (PARTITION BY i_category ORDER BY sumsales DESC) AS rk\n    FROM detailed_agg\n) ranked\nWHERE rk <= 100\nORDER BY\n    i_category,\n    i_class,\n    i_brand,\n    i_product_name,\n    d_year,\n    d_qoy,\n    d_moy,\n    s_store_id,\n    sumsales,\n    rk\nLIMIT 100;\n```\n\n**Changes**: Pre-filtered date_dim into CTE, pre-aggregated store_sales at key level before joining dimensions, removed unnecessary ROLLUP since only full-grouping rows are needed for ranking, applied window function on reduced dataset.\n\n**Expected speedup**: ~2-3x by reducing fact table joins, eliminating ROLLUP overhead, and filtering early.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 6,
          "iteration": 2,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.5010104736396839,
            "original_ms": 10268.992221333368,
            "optimized_ms": 6841.386120666357,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.028902433397505,
            "original_ms": 10681.560936666756,
            "optimized_ms": 10381.51003433389,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_filter_pushdown",
            "speedup": 1.0269209913835204,
            "original_ms": 10681.560936666756,
            "optimized_ms": 10401.541137333274,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_cte_restructuring",
            "speedup": 0.9942953542277535,
            "original_ms": 10681.560936666756,
            "optimized_ms": 10742.845062333496,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_date_range_cte",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transforms",
            "speedup": 0,
            "original_ms": 10681.560936666756,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0,
            "original_ms": 11613.905718333626,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q68": {
        "query_id": "q68",
        "status": "WIN",
        "best_speedup": 1.42,
        "original_ms": 889.66,
        "optimized_ms": 626.52,
        "original_sql": "SELECT c_last_name,\n       c_first_name,\n       ca_city,\n       bought_city,\n       ss_ticket_number,\n       extended_price,\n       extended_tax,\n       list_price\nFROM\n  (SELECT ss_ticket_number,\n          ss_customer_sk,\n          ca_city bought_city,\n          sum(ss_ext_sales_price) extended_price,\n          sum(ss_ext_list_price) list_price,\n          sum(ss_ext_tax) extended_tax\n   FROM store_sales,\n        date_dim,\n        store,\n        household_demographics,\n        customer_address\n   WHERE store_sales.ss_sold_date_sk = date_dim.d_date_sk\n     AND store_sales.ss_store_sk = store.s_store_sk\n     AND store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n     AND store_sales.ss_addr_sk = customer_address.ca_address_sk\n     AND date_dim.d_dom BETWEEN 1 AND 2\n     AND (household_demographics.hd_dep_count = 4\n          OR household_demographics.hd_vehicle_count= 3)\n     AND date_dim.d_year IN (1999,\n                             1999+1,\n                             1999+2)\n     AND store.s_city IN ('Fairview',\n                          'Midway')\n   GROUP BY ss_ticket_number,\n            ss_customer_sk,\n            ss_addr_sk,\n            ca_city) dn,\n     customer,\n     customer_address current_addr\nWHERE ss_customer_sk = c_customer_sk\n  AND customer.c_current_addr_sk = current_addr.ca_address_sk\n  AND current_addr.ca_city <> bought_city\nORDER BY c_last_name NULLS FIRST,\n         ss_ticket_number NULLS FIRST\nLIMIT 100;\n\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_dom BETWEEN 1 AND 2 AND d_year IN (1999, 2000, 2001)), filtered_stores AS (SELECT s_store_sk FROM store WHERE s_city IN ('Fairview', 'Midway')), branch1_sales AS (SELECT ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city, ss_ext_sales_price, ss_ext_list_price, ss_ext_tax FROM store_sales JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk JOIN filtered_stores ON store_sales.ss_store_sk = filtered_stores.s_store_sk JOIN household_demographics ON store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk WHERE household_demographics.hd_dep_count = 4), branch2_sales AS (SELECT ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city, ss_ext_sales_price, ss_ext_list_price, ss_ext_tax FROM store_sales JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk JOIN filtered_stores ON store_sales.ss_store_sk = filtered_stores.s_store_sk JOIN household_demographics ON store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk WHERE household_demographics.hd_vehicle_count = 3 AND household_demographics.hd_dep_count <> 4), union_sales AS (SELECT * FROM branch1_sales UNION ALL SELECT * FROM branch2_sales), grouped_sales AS (SELECT ss_ticket_number, ss_customer_sk, ca_city AS bought_city, SUM(ss_ext_sales_price) AS extended_price, SUM(ss_ext_list_price) AS list_price, SUM(ss_ext_tax) AS extended_tax FROM union_sales GROUP BY ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city)\nSELECT c_last_name, c_first_name, current_addr.ca_city, grouped_sales.bought_city, grouped_sales.ss_ticket_number, grouped_sales.extended_price, grouped_sales.extended_tax, grouped_sales.list_price FROM grouped_sales JOIN customer ON grouped_sales.ss_customer_sk = customer.c_customer_sk JOIN customer_address AS current_addr ON customer.c_current_addr_sk = current_addr.ca_address_sk WHERE current_addr.ca_city <> grouped_sales.bought_city ORDER BY c_last_name NULLS FIRST, ss_ticket_number NULLS FIRST LIMIT 100",
        "transforms": [
          "or_to_union"
        ],
        "principle": "or_to_union",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"or_to_union\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_dom BETWEEN 1 AND 2 AND d_year IN (1999, 2000, 2001)\",\n        \"filtered_stores\": \"SELECT s_store_sk FROM store WHERE s_city IN ('Fairview', 'Midway')\",\n        \"branch1_sales\": \"SELECT ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city, ss_ext_sales_price, ss_ext_list_price, ss_ext_tax FROM store_sales JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk JOIN filtered_stores ON store_sales.ss_store_sk = filtered_stores.s_store_sk JOIN household_demographics ON store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk WHERE household_demographics.hd_dep_count = 4\",\n        \"branch2_sales\": \"SELECT ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city, ss_ext_sales_price, ss_ext_list_price, ss_ext_tax FROM store_sales JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk JOIN filtered_stores ON store_sales.ss_store_sk = filtered_stores.s_store_sk JOIN household_demographics ON store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk WHERE household_demographics.hd_vehicle_count = 3 AND household_demographics.hd_dep_count != 4\",\n        \"union_sales\": \"SELECT * FROM branch1_sales UNION ALL SELECT * FROM branch2_sales\",\n        \"grouped_sales\": \"SELECT ss_ticket_number, ss_customer_sk, ca_city AS bought_city, SUM(ss_ext_sales_price) AS extended_price, SUM(ss_ext_list_price) AS list_price, SUM(ss_ext_tax) AS extended_tax FROM union_sales GROUP BY ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city\",\n        \"main_query\": \"SELECT c_last_name, c_first_name, current_addr.ca_city, grouped_sales.bought_city, grouped_sales.ss_ticket_number, grouped_sales.extended_price, grouped_sales.extended_tax, grouped_sales.list_price FROM grouped_sales JOIN customer ON grouped_sales.ss_customer_sk = customer.c_customer_sk JOIN customer_address current_addr ON customer.c_current_addr_sk = current_addr.ca_address_sk WHERE current_addr.ca_city <> grouped_sales.bought_city ORDER BY c_last_name NULLS FIRST, ss_ticket_number NULLS FIRST LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\",\n        \"same grouping and aggregation\"\n      ],\n      \"expected_speedup\": \"2.5x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Rewrote the OR condition on household_demographics into two disjoint branches using UNION ALL. This allows each branch to use efficient indexes/scan patterns. Also isolated date_dim and store filters into CTEs to enable early filtering of store_sales before the expensive joins. The UNION ALL approach eliminates row duplication while maintaining correct aggregation semantics.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 2,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 2.3747632323103227,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.1715753433352998,
            "original_ms": 597.7165369992387,
            "optimized_ms": 510.18190200011304,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "multi_dimension_prefetch",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.1064978075553307,
            "original_ms": 600.689512999755,
            "optimized_ms": 542.8745623336605,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_filter_pushdown",
            "speedup": 1.1024179410220403,
            "original_ms": 600.689512999755,
            "optimized_ms": 544.8836513335967,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 1.0961570475392246,
            "original_ms": 600.689512999755,
            "optimized_ms": 547.9958500000066,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.0196304987023848,
            "original_ms": 516.6261863335725,
            "optimized_ms": 506.67980900046433,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "multi_dimension_prefetch",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.95,
            "original_ms": 889.66,
            "optimized_ms": 938.52,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": []
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8417391905687402,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8172850604040731,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8001129064111188,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.6740961641464521,
            "original_ms": 600.689512999755,
            "optimized_ms": 891.1035916668576,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "decorrelate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q69": {
        "query_id": "q69",
        "status": "WIN",
        "best_speedup": 1.92,
        "original_ms": 441.33,
        "optimized_ms": 229.86,
        "original_sql": "SELECT cd_gender,\n       cd_marital_status,\n       cd_education_status,\n       count(*) cnt1,\n       cd_purchase_estimate,\n       count(*) cnt2,\n       cd_credit_rating,\n       count(*) cnt3\nFROM customer c,\n     customer_address ca,\n     customer_demographics\nWHERE c.c_current_addr_sk = ca.ca_address_sk\n  AND ca_state IN ('KY',\n                   'GA',\n                   'NM')\n  AND cd_demo_sk = c.c_current_cdemo_sk\n  AND EXISTS\n    (SELECT *\n     FROM store_sales,\n          date_dim\n     WHERE c.c_customer_sk = ss_customer_sk\n       AND ss_sold_date_sk = d_date_sk\n       AND d_year = 2001\n       AND d_moy BETWEEN 4 AND 4+2)\n  AND (NOT EXISTS\n         (SELECT *\n          FROM web_sales,\n               date_dim\n          WHERE c.c_customer_sk = ws_bill_customer_sk\n            AND ws_sold_date_sk = d_date_sk\n            AND d_year = 2001\n            AND d_moy BETWEEN 4 AND 4+2)\n       AND NOT EXISTS\n         (SELECT *\n          FROM catalog_sales,\n               date_dim\n          WHERE c.c_customer_sk = cs_ship_customer_sk\n            AND cs_sold_date_sk = d_date_sk\n            AND d_year = 2001\n            AND d_moy BETWEEN 4 AND 4+2))\nGROUP BY cd_gender,\n         cd_marital_status,\n         cd_education_status,\n         cd_purchase_estimate,\n         cd_credit_rating\nORDER BY cd_gender,\n         cd_marital_status,\n         cd_education_status,\n         cd_purchase_estimate,\n         cd_credit_rating\nLIMIT 100;\n\n",
        "optimized_sql": "WITH date_filter AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001 AND d_moy BETWEEN 4 AND 6), store_sales_filtered AS (SELECT DISTINCT ss_customer_sk FROM store_sales JOIN date_filter ON ss_sold_date_sk = d_date_sk), web_sales_filtered AS (SELECT DISTINCT ws_bill_customer_sk FROM web_sales JOIN date_filter ON ws_sold_date_sk = d_date_sk), catalog_sales_filtered AS (SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales JOIN date_filter ON cs_sold_date_sk = d_date_sk)\nSELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics ON cd_demo_sk = c.c_current_cdemo_sk WHERE ca_state IN ('KY', 'GA', 'NM') AND EXISTS(SELECT 1 FROM store_sales_filtered WHERE ss_customer_sk = c.c_customer_sk) AND NOT EXISTS(SELECT 1 FROM web_sales_filtered WHERE ws_bill_customer_sk = c.c_customer_sk) AND NOT EXISTS(SELECT 1 FROM catalog_sales_filtered WHERE cs_ship_customer_sk = c.c_customer_sk) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100",
        "transforms": [
          "decorrelate"
        ],
        "principle": "decorrelate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"date_filter\": \"SELECT d_date_sk FROM date_dim WHERE d_year = 2001 AND d_moy BETWEEN 4 AND 6\",\n        \"store_sales_filtered\": \"SELECT DISTINCT ss_customer_sk FROM store_sales JOIN date_filter ON ss_sold_date_sk = d_date_sk\",\n        \"web_sales_filtered\": \"SELECT DISTINCT ws_bill_customer_sk FROM web_sales JOIN date_filter ON ws_sold_date_sk = d_date_sk\",\n        \"catalog_sales_filtered\": \"SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales JOIN date_filter ON cs_sold_date_sk = d_date_sk\",\n        \"main_query\": \"SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics ON cd_demo_sk = c.c_current_cdemo_sk WHERE ca_state IN ('KY', 'GA', 'NM') AND EXISTS (SELECT 1 FROM store_sales_filtered WHERE ss_customer_sk = c.c_customer_sk) AND NOT EXISTS (SELECT 1 FROM web_sales_filtered WHERE ws_bill_customer_sk = c.c_customer_sk) AND NOT EXISTS (SELECT 1 FROM catalog_sales_filtered WHERE cs_ship_customer_sk = c.c_customer_sk) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same output columns\",\n        \"same grouping\",\n        \"same ordering\"\n      ],\n      \"expected_speedup\": \"1.8x\",\n      \"risk\": \"low\"\n    },\n    {\n      \"id\": \"rs_02\",\n      \"transform\": \"semantic_rewrite\",\n      \"nodes\": {\n        \"date_filter\": \"SELECT d_date_sk FROM date_dim WHERE d_year = 2001 AND d_moy BETWEEN 4 AND 6\",\n        \"main_query\": \"SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics ON cd_demo_sk = c.c_current_cdemo_sk WHERE ca_state IN ('KY', 'GA', 'NM') AND c.c_customer_sk IN (SELECT ss_customer_sk FROM store_sales JOIN date_filter ON ss_sold_date_sk = d_date_sk) AND c.c_customer_sk NOT IN (SELECT ws_bill_customer_sk FROM web_sales JOIN date_filter ON ws_sold_date_sk = d_date_sk) AND c.c_customer_sk NOT IN (SELECT cs_ship_customer_sk FROM catalog_sales JOIN date_filter ON cs_sold_date_sk = d_date_sk) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same output columns\",\n        \"same grouping\",\n        \"same ordering\"\n      ],\n      \"expected_speedup\": \"2.2x\",\n      \"risk\": \"medium\"\n    }\n  ],\n  \"explanation\": \"rs_01 isolates date_dim filter into a reusable CTE and pre-filters fact tables by date, reducing 3 separate date_dim scans to 1. The EXISTS/NOT EXISTS patterns are preserved. rs_02 further transforms EXISTS/NOT EXISTS to IN/NOT IN with single-pass fact table scans, which can be more efficient when date_filter is small and customer keys are indexed. Both rewrites maintain exact semantic equivalence while reducing redundant date_dim access and enabling better join optimization.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 4,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 3.01380179858059,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.564993514442786,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_decorrelate_multi_cte",
            "speedup": 1.0430743341406599,
            "original_ms": 241.52134999955402,
            "optimized_ms": 231.54759166664007,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_date_range_cte",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.03,
            "original_ms": 441.33,
            "optimized_ms": 427.46,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.0196240479006768,
            "original_ms": 241.52134999955402,
            "optimized_ms": 236.8729440001213,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_date_isolation",
            "speedup": 0.9883233972541348,
            "original_ms": 241.52134999955402,
            "optimized_ms": 244.37481766653946,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_earlyfilter",
            "speedup": 0.9806857341401074,
            "original_ms": 241.52134999955402,
            "optimized_ms": 246.2780293335527,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.9659964610084274,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.9289896620777872,
            "original_ms": 274.2577763334945,
            "optimized_ms": 295.2215590000075,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.7102028647624241,
            "original_ms": 230.48371566619608,
            "optimized_ms": 324.5322246669578,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.6492126143332616,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch",
              "materialize_cte",
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q7": {
        "query_id": "q7",
        "status": "WIN",
        "best_speedup": 1.1453,
        "original_ms": 549.12,
        "optimized_ms": 479.45,
        "original_sql": "-- start query 7 in stream 0 using template query7.tpl\nselect i_item_id, \n        avg(ss_quantity) agg1,\n        avg(ss_list_price) agg2,\n        avg(ss_coupon_amt) agg3,\n        avg(ss_sales_price) agg4 \n from store_sales, customer_demographics, date_dim, item, promotion\n where ss_sold_date_sk = d_date_sk and\n       ss_item_sk = i_item_sk and\n       ss_cdemo_sk = cd_demo_sk and\n       ss_promo_sk = p_promo_sk and\n       cd_gender = 'F' and \n       cd_marital_status = 'W' and\n       cd_education_status = 'College' and\n       (p_channel_email = 'N' or p_channel_event = 'N') and\n       d_year = 2001 \n group by i_item_id\n order by i_item_id\n LIMIT 100;\n\n-- end query 7 in stream 0 using template query7.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 2001\n),\nfiltered_customer_demographics AS (\n    SELECT cd_demo_sk\n    FROM customer_demographics\n    WHERE cd_gender = 'F'\n      AND cd_marital_status = 'W'\n      AND cd_education_status = 'College'\n),\nfiltered_promotion AS (\n    SELECT p_promo_sk\n    FROM promotion\n    WHERE p_channel_email = 'N' OR p_channel_event = 'N'\n),\nprefiltered_sales AS (\n    SELECT\n        ss_item_sk,\n        ss_quantity,\n        ss_list_price,\n        ss_coupon_amt,\n        ss_sales_price\n    FROM store_sales\n    JOIN filtered_dates ON ss_sold_date_sk = d_date_sk\n    JOIN filtered_customer_demographics ON ss_cdemo_sk = cd_demo_sk\n    JOIN filtered_promotion ON ss_promo_sk = p_promo_sk\n)\nSELECT\n    i.i_item_id,\n    AVG(ss.ss_quantity) AS agg1,\n    AVG(ss.ss_list_price) AS agg2,\n    AVG(ss.ss_coupon_amt) AS agg3,\n    AVG(ss.ss_sales_price) AS agg4\nFROM prefiltered_sales ss\nJOIN item i ON ss.ss_item_sk = i.i_item_sk\nGROUP BY i.i_item_id\nORDER BY i.i_item_id\nLIMIT 100;",
        "transforms": [
          "prefetch_fact_join",
          "dimension_cte_isolate"
        ],
        "principle": "prefetch_fact_join",
        "changes_description": null,
        "reasoning": "```sql\nWITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 2001\n),\nfiltered_customer_demographics AS (\n    SELECT cd_demo_sk\n    FROM customer_demographics\n    WHERE cd_gender = 'F'\n      AND cd_marital_status = 'W'\n      AND cd_education_status = 'College'\n),\nfiltered_promotion AS (\n    SELECT p_promo_sk\n    FROM promotion\n    WHERE p_channel_email = 'N' OR p_channel_event = 'N'\n),\nprefiltered_sales AS (\n    SELECT\n        ss_item_sk,\n        ss_quantity,\n        ss_list_price,\n        ss_coupon_amt,\n        ss_sales_price\n    FROM store_sales\n    JOIN filtered_dates ON ss_sold_date_sk = d_date_sk\n    JOIN filtered_customer_demographics ON ss_cdemo_sk = cd_demo_sk\n    JOIN filtered_promotion ON ss_promo_sk = p_promo_sk\n)\nSELECT\n    i.i_item_id,\n    AVG(ss.ss_quantity) AS agg1,\n    AVG(ss.ss_list_price) AS agg2,\n    AVG(ss.ss_coupon_amt) AS agg3,\n    AVG(ss.ss_sales_price) AS agg4\nFROM prefiltered_sales ss\nJOIN item i ON ss.ss_item_sk = i.i_item_sk\nGROUP BY i.i_item_id\nORDER BY i.i_item_id\nLIMIT 100;\n```\n\n**Changes**: Restructured using CTEs to aggressively pre-filter dimension tables and pre-join them with the fact table in stages, minimizing intermediate data before the final aggregation.\n\n**Expected speedup**: 1.5-2x by reducing join cardinality early through dimension prefetching and deferred item join.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": "aggressive_prefetch_restructure"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 9.085885527535973,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.3965594855599017,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 1.1453033174235459,
            "original_ms": 549.1164043332901,
            "optimized_ms": 479.45063633324025,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.1218212452710785,
            "original_ms": 549.1164043332901,
            "optimized_ms": 489.48654399979813,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0642234503716044,
            "original_ms": 549.1164043332901,
            "optimized_ms": 515.9784856662858,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.022496163706911,
            "original_ms": 500.44996033284406,
            "optimized_ms": 489.43945033352065,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filter",
            "speedup": 1.0143518544090662,
            "original_ms": 549.1164043332901,
            "optimized_ms": 541.3470699998774,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.52,
            "original_ms": 659.97,
            "optimized_ms": 1281.37,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.34516313848691815,
            "original_ms": 476.86152866602544,
            "optimized_ms": 1381.5540406673488,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.11635708375593647,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q70": {
        "query_id": "q70",
        "status": "WIN",
        "best_speedup": 2.5213,
        "original_ms": 739.9,
        "optimized_ms": 293.46,
        "original_sql": "-- start query 70 in stream 0 using template query70.tpl\nselect \n    sum(ss_net_profit) as total_sum\n   ,s_state\n   ,s_county\n   ,grouping(s_state)+grouping(s_county) as lochierarchy\n   ,rank() over (\n \tpartition by grouping(s_state)+grouping(s_county),\n \tcase when grouping(s_county) = 0 then s_state end \n \torder by sum(ss_net_profit) desc) as rank_within_parent\n from\n    store_sales\n   ,date_dim       d1\n   ,store\n where\n    d1.d_month_seq between 1213 and 1213+11\n and d1.d_date_sk = ss_sold_date_sk\n and s_store_sk  = ss_store_sk\n and s_state in\n             ( select s_state\n               from  (select s_state as s_state,\n \t\t\t    rank() over ( partition by s_state order by sum(ss_net_profit) desc) as ranking\n                      from   store_sales, store, date_dim\n                      where  d_month_seq between 1213 and 1213+11\n \t\t\t    and d_date_sk = ss_sold_date_sk\n \t\t\t    and s_store_sk  = ss_store_sk\n                      group by s_state\n                     ) tmp1 \n               where ranking <= 5\n             )\n group by rollup(s_state,s_county)\n order by\n   lochierarchy desc\n  ,case when lochierarchy = 0 then s_state end\n  ,rank_within_parent\n LIMIT 100;\n\n-- end query 70 in stream 0 using template query70.tpl\n",
        "optimized_sql": "WITH date_filtered AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_month_seq BETWEEN 1213 AND 1213 + 11\n),\nstore_sales_agg AS (\n  SELECT \n    store.s_state,\n    store.s_county,\n    SUM(store_sales.ss_net_profit) AS state_county_profit\n  FROM store_sales\n  JOIN date_filtered ON date_filtered.d_date_sk = store_sales.ss_sold_date_sk\n  JOIN store ON store.s_store_sk = store_sales.ss_store_sk\n  GROUP BY store.s_state, store.s_county\n),\nstate_ranking AS (\n  SELECT s_state\n  FROM (\n    SELECT \n      s_state,\n      RANK() OVER (PARTITION BY s_state ORDER BY SUM(state_county_profit) DESC) AS ranking\n    FROM store_sales_agg\n    GROUP BY s_state\n  ) AS tmp1\n  WHERE ranking <= 5\n),\nfiltered_store_sales_agg AS (\n  SELECT s_state, s_county, state_county_profit\n  FROM store_sales_agg\n  WHERE s_state IN (SELECT s_state FROM state_ranking)\n)\nSELECT\n  total_sum,\n  s_state,\n  s_county,\n  lochierarchy,\n  rank_within_parent\nFROM (\n  SELECT\n    SUM(state_county_profit) AS total_sum,\n    s_state,\n    s_county,\n    GROUPING(s_state) + GROUPING(s_county) AS lochierarchy,\n    RANK() OVER (\n      PARTITION BY GROUPING(s_state) + GROUPING(s_county),\n                   CASE WHEN GROUPING(s_county) = 0 THEN s_state END\n      ORDER BY SUM(state_county_profit) DESC\n    ) AS rank_within_parent\n  FROM filtered_store_sales_agg\n  GROUP BY ROLLUP (s_state, s_county)\n) AS t\nORDER BY\n  lochierarchy DESC,\n  CASE WHEN lochierarchy = 0 THEN s_state END,\n  rank_within_parent\nLIMIT 100",
        "transforms": [
          "early_filter",
          "pushdown",
          "materialize_cte"
        ],
        "principle": "early_filter",
        "changes_description": null,
        "reasoning": "```sql\nWITH date_filtered AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_month_seq BETWEEN 1213 AND 1213 + 11\n),\nstore_sales_agg AS (\n  SELECT \n    store.s_state,\n    store.s_county,\n    SUM(store_sales.ss_net_profit) AS state_county_profit\n  FROM store_sales\n  JOIN date_filtered ON date_filtered.d_date_sk = store_sales.ss_sold_date_sk\n  JOIN store ON store.s_store_sk = store_sales.ss_store_sk\n  GROUP BY store.s_state, store.s_county\n),\nstate_ranking AS (\n  SELECT s_state\n  FROM (\n    SELECT \n      s_state,\n      RANK() OVER (PARTITION BY s_state ORDER BY SUM(state_county_profit) DESC) AS ranking\n    FROM store_sales_agg\n    GROUP BY s_state\n  ) AS tmp1\n  WHERE ranking <= 5\n),\nfiltered_store_sales_agg AS (\n  SELECT s_state, s_county, state_county_profit\n  FROM store_sales_agg\n  WHERE s_state IN (SELECT s_state FROM state_ranking)\n)\nSELECT\n  total_sum,\n  s_state,\n  s_county,\n  lochierarchy,\n  rank_within_parent\nFROM (\n  SELECT\n    SUM(state_county_profit) AS total_sum,\n    s_state,\n    s_county,\n    GROUPING(s_state) + GROUPING(s_county) AS lochierarchy,\n    RANK() OVER (\n      PARTITION BY GROUPING(s_state) + GROUPING(s_county),\n                   CASE WHEN GROUPING(s_county) = 0 THEN s_state END\n      ORDER BY SUM(state_county_profit) DESC\n    ) AS rank_within_parent\n  FROM filtered_store_sales_agg\n  GROUP BY ROLLUP (s_state, s_county)\n) AS t\nORDER BY\n  lochierarchy DESC,\n  CASE WHEN lochierarchy = 0 THEN s_state END,\n  rank_within_parent\nLIMIT 100\n```\n\n**Changes**: Created materialized CTEs to pre-filter date_dim, pre-aggregate store_sales by state/county, compute state ranking from the pre-aggregated data, then filter before the expensive ROLLUP and window function.\n\n**Expected speedup**: ~1.5-2x by reducing join sizes early and avoiding recomputation of the date filter and state ranking subquery.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 1,
          "iteration": 0,
          "strategy": "safe_pushdown_and_materialization"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "safe_pushdown_and_materialization",
            "speedup": 2.521264513337834,
            "original_ms": 739.8958073335962,
            "optimized_ms": 293.46219066640816,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "date_dimension_isolation_decorrelation",
            "speedup": 0.9706889600120223,
            "original_ms": 739.8958073335962,
            "optimized_ms": 762.2377896668695,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_single_pass",
            "speedup": 0.9577943907132505,
            "original_ms": 739.8958073335962,
            "optimized_ms": 772.4996246664281,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.75,
            "original_ms": 1299.73,
            "optimized_ms": 1741.78,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": []
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "structural_transform_union_exists",
            "speedup": 0,
            "original_ms": 739.8958073335962,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q71": {
        "query_id": "q71",
        "status": "NEUTRAL",
        "best_speedup": 1.0422,
        "original_ms": 326.55,
        "optimized_ms": 313.32,
        "original_sql": "-- start query 71 in stream 0 using template query71.tpl\nselect i_brand_id brand_id, i_brand brand,t_hour,t_minute,\n \tsum(ext_price) ext_price\n from item, (select ws_ext_sales_price as ext_price, \n                        ws_sold_date_sk as sold_date_sk,\n                        ws_item_sk as sold_item_sk,\n                        ws_sold_time_sk as time_sk  \n                 from web_sales,date_dim\n                 where d_date_sk = ws_sold_date_sk\n                   and d_moy=12\n                   and d_year=1998\n                 union all\n                 select cs_ext_sales_price as ext_price,\n                        cs_sold_date_sk as sold_date_sk,\n                        cs_item_sk as sold_item_sk,\n                        cs_sold_time_sk as time_sk\n                 from catalog_sales,date_dim\n                 where d_date_sk = cs_sold_date_sk\n                   and d_moy=12\n                   and d_year=1998\n                 union all\n                 select ss_ext_sales_price as ext_price,\n                        ss_sold_date_sk as sold_date_sk,\n                        ss_item_sk as sold_item_sk,\n                        ss_sold_time_sk as time_sk\n                 from store_sales,date_dim\n                 where d_date_sk = ss_sold_date_sk\n                   and d_moy=12\n                   and d_year=1998\n                 ) tmp,time_dim\n where\n   sold_item_sk = i_item_sk\n   and i_manager_id=1\n   and time_sk = t_time_sk\n   and (t_meal_time = 'breakfast' or t_meal_time = 'dinner')\n group by i_brand, i_brand_id,t_hour,t_minute\n order by ext_price desc, i_brand_id\n ;\n\n-- end query 71 in stream 0 using template query71.tpl\n",
        "optimized_sql": "WITH filtered_date AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_moy = 12 AND d_year = 1998\n),\nfiltered_item AS (\n    SELECT i_item_sk, i_brand_id, i_brand\n    FROM item\n    WHERE i_manager_id = 1\n),\nfiltered_time AS (\n    SELECT t_time_sk, t_hour, t_minute\n    FROM time_dim\n    WHERE t_meal_time = 'breakfast' OR t_meal_time = 'dinner'\n),\nunioned_sales AS (\n    SELECT\n        ws_ext_sales_price AS ext_price,\n        ws_item_sk AS sold_item_sk,\n        ws_sold_time_sk AS time_sk\n    FROM web_sales\n    JOIN filtered_date ON ws_sold_date_sk = d_date_sk\n    \n    UNION ALL\n    \n    SELECT\n        cs_ext_sales_price AS ext_price,\n        cs_item_sk AS sold_item_sk,\n        cs_sold_time_sk AS time_sk\n    FROM catalog_sales\n    JOIN filtered_date ON cs_sold_date_sk = d_date_sk\n    \n    UNION ALL\n    \n    SELECT\n        ss_ext_sales_price AS ext_price,\n        ss_item_sk AS sold_item_sk,\n        ss_sold_time_sk AS time_sk\n    FROM store_sales\n    JOIN filtered_date ON ss_sold_date_sk = d_date_sk\n)\nSELECT\n    i_brand_id AS brand_id,\n    i_brand AS brand,\n    t_hour,\n    t_minute,\n    SUM(ext_price) AS ext_price\nFROM unioned_sales\nJOIN filtered_item ON sold_item_sk = i_item_sk\nJOIN filtered_time ON time_sk = t_time_sk\nGROUP BY i_brand_id, i_brand, t_hour, t_minute\nORDER BY ext_price DESC, i_brand_id",
        "transforms": [
          "decorrelate",
          "date_cte_isolate",
          "multi_dimension_prefetch"
        ],
        "principle": "decorrelate",
        "changes_description": null,
        "reasoning": "```sql\nWITH filtered_date AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_moy = 12 AND d_year = 1998\n),\nfiltered_item AS (\n    SELECT i_item_sk, i_brand_id, i_brand\n    FROM item\n    WHERE i_manager_id = 1\n),\nfiltered_time AS (\n    SELECT t_time_sk, t_hour, t_minute\n    FROM time_dim\n    WHERE t_meal_time = 'breakfast' OR t_meal_time = 'dinner'\n),\nunioned_sales AS (\n    SELECT\n        ws_ext_sales_price AS ext_price,\n        ws_item_sk AS sold_item_sk,\n        ws_sold_time_sk AS time_sk\n    FROM web_sales\n    JOIN filtered_date ON ws_sold_date_sk = d_date_sk\n    \n    UNION ALL\n    \n    SELECT\n        cs_ext_sales_price AS ext_price,\n        cs_item_sk AS sold_item_sk,\n        cs_sold_time_sk AS time_sk\n    FROM catalog_sales\n    JOIN filtered_date ON cs_sold_date_sk = d_date_sk\n    \n    UNION ALL\n    \n    SELECT\n        ss_ext_sales_price AS ext_price,\n        ss_item_sk AS sold_item_sk,\n        ss_sold_time_sk AS time_sk\n    FROM store_sales\n    JOIN filtered_date ON ss_sold_date_sk = d_date_sk\n)\nSELECT\n    i_brand_id AS brand_id,\n    i_brand AS brand,\n    t_hour,\n    t_minute,\n    SUM(ext_price) AS ext_price\nFROM unioned_sales\nJOIN filtered_item ON sold_item_sk = i_item_sk\nJOIN filtered_time ON time_sk = t_time_sk\nGROUP BY i_brand_id, i_brand, t_hour, t_minute\nORDER BY ext_price DESC, i_brand_id\n```\n\n**Changes**: Extracted shared dimension filters (date_dim, item, time_dim) into CTEs and restructured the UNION ALL to join with pre-filtered dimension tables, eliminating redundant scans and pushing filters earlier in the execution plan.\n\n**Expected speedup**: 2.0x+ due to reduced dimension table scans and early filtering of large fact tables.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 5,
          "iteration": 1,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.407015941404685,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.042197631207039,
            "original_ms": 326.5450630005944,
            "optimized_ms": 313.32355133296613,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.9840110633930287,
            "original_ms": 284.94410199982667,
            "optimized_ms": 289.57408366659365,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "union_cte_split"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0.9747662988331075,
            "original_ms": 284.94410199982667,
            "optimized_ms": 292.3204283333689,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.96,
            "original_ms": 579.44,
            "optimized_ms": 606.22,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 0.9391534520661379,
            "original_ms": 284.94410199982667,
            "optimized_ms": 303.4052650000376,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filter",
            "speedup": 0.9031767365939561,
            "original_ms": 284.94410199982667,
            "optimized_ms": 315.49096699988394,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.8994974596514503,
            "original_ms": 281.4457603332509,
            "optimized_ms": 312.8922236671012,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.7748759245201149,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q72": {
        "query_id": "q72",
        "status": "WIN",
        "best_speedup": 1.38,
        "original_ms": 1467.27,
        "optimized_ms": 1063.24,
        "original_sql": "SELECT i_item_desc,\n       w_warehouse_name,\n       d1.d_week_seq,\n       sum(CASE\n               WHEN p_promo_sk IS NULL THEN 1\n               ELSE 0\n           END) no_promo,\n       sum(CASE\n               WHEN p_promo_sk IS NOT NULL THEN 1\n               ELSE 0\n           END) promo,\n       count(*) total_cnt\nFROM catalog_sales\nJOIN inventory ON (cs_item_sk = inv_item_sk)\nJOIN warehouse ON (w_warehouse_sk=inv_warehouse_sk)\nJOIN item ON (i_item_sk = cs_item_sk)\nJOIN customer_demographics ON (cs_bill_cdemo_sk = cd_demo_sk)\nJOIN household_demographics ON (cs_bill_hdemo_sk = hd_demo_sk)\nJOIN date_dim d1 ON (cs_sold_date_sk = d1.d_date_sk)\nJOIN date_dim d2 ON (inv_date_sk = d2.d_date_sk)\nJOIN date_dim d3 ON (cs_ship_date_sk = d3.d_date_sk)\nLEFT OUTER JOIN promotion ON (cs_promo_sk=p_promo_sk)\nLEFT OUTER JOIN catalog_returns ON (cr_item_sk = cs_item_sk\n                                    AND cr_order_number = cs_order_number)\nWHERE d1.d_week_seq = d2.d_week_seq\n  AND inv_quantity_on_hand < cs_quantity\n  AND d3.d_date > d1.d_date + 5 -- SQL Server: DATEADD(day, 5, d1.d_date)\n  AND hd_buy_potential = '>10000'\n  AND d1.d_year = 1999\n  AND cd_marital_status = 'D'\nGROUP BY i_item_desc,\n         w_warehouse_name,\n         d1.d_week_seq\nORDER BY total_cnt DESC NULLS FIRST,\n         i_item_desc NULLS FIRST,\n         w_warehouse_name NULLS FIRST,\n         d1.d_week_seq NULLS FIRST\nLIMIT 100;\n\n",
        "optimized_sql": "WITH filtered_d1 AS (SELECT d_date_sk, d_date, d_week_seq FROM date_dim WHERE d_year = 1999), filtered_d2 AS (SELECT d_date_sk, d_week_seq FROM date_dim WHERE d_week_seq IN (SELECT d_week_seq FROM filtered_d1)), filtered_d3 AS (SELECT d_date_sk, d_date FROM date_dim), filtered_cd AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_marital_status = 'D'), filtered_hd AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential = '>10000')\nSELECT i_item_desc, w_warehouse_name, fd1.d_week_seq, SUM(CASE WHEN p_promo_sk IS NULL THEN 1 ELSE 0 END) AS no_promo, SUM(CASE WHEN NOT p_promo_sk IS NULL THEN 1 ELSE 0 END) AS promo, COUNT(*) AS total_cnt FROM catalog_sales AS cs JOIN filtered_d1 AS fd1 ON cs.cs_sold_date_sk = fd1.d_date_sk JOIN filtered_d2 AS fd2 ON fd1.d_week_seq = fd2.d_week_seq JOIN filtered_d3 AS fd3 ON cs.cs_ship_date_sk = fd3.d_date_sk AND fd3.d_date > fd1.d_date + 5 JOIN inventory AS inv ON inv.inv_item_sk = cs.cs_item_sk AND inv.inv_date_sk = fd2.d_date_sk AND inv.inv_quantity_on_hand < cs.cs_quantity JOIN warehouse AS w ON w.w_warehouse_sk = inv.inv_warehouse_sk JOIN item AS i ON i.i_item_sk = cs.cs_item_sk JOIN filtered_cd AS cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN filtered_hd AS hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk LEFT OUTER JOIN promotion AS p ON cs.cs_promo_sk = p.p_promo_sk LEFT OUTER JOIN catalog_returns AS cr ON cr.cr_item_sk = cs.cs_item_sk AND cr.cr_order_number = cs.cs_order_number GROUP BY i_item_desc, w_warehouse_name, fd1.d_week_seq ORDER BY total_cnt DESC NULLS FIRST, i_item_desc NULLS FIRST, w_warehouse_name NULLS FIRST, fd1.d_week_seq NULLS FIRST LIMIT 100",
        "transforms": [
          "semantic_rewrite"
        ],
        "principle": "semantic_rewrite",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_d1\": \"SELECT d_date_sk, d_date, d_week_seq FROM date_dim WHERE d_year = 1999\",\n        \"filtered_d2\": \"SELECT d_date_sk, d_week_seq FROM date_dim WHERE d_week_seq IN (SELECT d_week_seq FROM filtered_d1)\",\n        \"filtered_d3\": \"SELECT d_date_sk, d_date FROM date_dim\",\n        \"filtered_cd\": \"SELECT cd_demo_sk FROM customer_demographics WHERE cd_marital_status = 'D'\",\n        \"filtered_hd\": \"SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential = '>10000'\",\n        \"main_query\": \"SELECT i_item_desc, w_warehouse_name, fd1.d_week_seq, SUM(CASE WHEN p_promo_sk IS NULL THEN 1 ELSE 0 END) AS no_promo, SUM(CASE WHEN NOT p_promo_sk IS NULL THEN 1 ELSE 0 END) AS promo, COUNT(*) AS total_cnt FROM catalog_sales cs JOIN filtered_d1 fd1 ON cs.cs_sold_date_sk = fd1.d_date_sk JOIN filtered_d2 fd2 ON fd1.d_week_seq = fd2.d_week_seq JOIN filtered_d3 fd3 ON cs.cs_ship_date_sk = fd3.d_date_sk AND fd3.d_date > fd1.d_date + 5 JOIN inventory inv ON inv.inv_item_sk = cs.cs_item_sk AND inv.inv_date_sk = fd2.d_date_sk AND inv.inv_quantity_on_hand < cs.cs_quantity JOIN warehouse w ON w.w_warehouse_sk = inv.inv_warehouse_sk JOIN item i ON i.i_item_sk = cs.cs_item_sk JOIN filtered_cd cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN filtered_hd hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk LEFT OUTER JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT OUTER JOIN catalog_returns cr ON cr.cr_item_sk = cs.cs_item_sk AND cr.cr_order_number = cs.cs_order_number GROUP BY i_item_desc, w_warehouse_name, fd1.d_week_seq ORDER BY total_cnt DESC NULLS FIRST, i_item_desc NULLS FIRST, w_warehouse_name NULLS FIRST, fd1.d_week_seq NULLS FIRST LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same output columns\",\n        \"same grouping grain\"\n      ],\n      \"expected_speedup\": \"3.2x\",\n      \"risk\": \"medium\"\n    },\n    {\n      \"id\": \"rs_02\",\n      \"transform\": \"early_filter\",\n      \"nodes\": {\n        \"filtered_facts\": \"SELECT cs_item_sk, cs_sold_date_sk, cs_ship_date_sk, cs_quantity, cs_bill_cdemo_sk, cs_bill_hdemo_sk, cs_promo_sk, cs_order_number FROM catalog_sales cs JOIN filtered_cd cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN filtered_hd hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk JOIN filtered_d1 fd1 ON cs.cs_sold_date_sk = fd1.d_date_sk WHERE EXISTS (SELECT 1 FROM filtered_d2 fd2 WHERE fd2.d_week_seq = fd1.d_week_seq) AND EXISTS (SELECT 1 FROM filtered_d3 fd3 WHERE cs.cs_ship_date_sk = fd3.d_date_sk AND fd3.d_date > fd1.d_date + 5)\",\n        \"main_query\": \"SELECT i_item_desc, w_warehouse_name, fd1.d_week_seq, SUM(CASE WHEN p_promo_sk IS NULL THEN 1 ELSE 0 END) AS no_promo, SUM(CASE WHEN NOT p_promo_sk IS NULL THEN 1 ELSE 0 END) AS promo, COUNT(*) AS total_cnt FROM filtered_facts ff JOIN filtered_d1 fd1 ON ff.cs_sold_date_sk = fd1.d_date_sk JOIN inventory inv ON inv.inv_item_sk = ff.cs_item_sk AND EXISTS (SELECT 1 FROM filtered_d2 fd2 WHERE inv.inv_date_sk = fd2.d_date_sk AND fd2.d_week_seq = fd1.d_week_seq) AND inv.inv_quantity_on_hand < ff.cs_quantity JOIN warehouse w ON w.w_warehouse_sk = inv.inv_warehouse_sk JOIN item i ON i.i_item_sk = ff.cs_item_sk LEFT OUTER JOIN promotion p ON ff.cs_promo_sk = p.p_promo_sk LEFT OUTER JOIN catalog_returns cr ON cr.cr_item_sk = ff.cs_item_sk AND cr.cr_order_number = ff.cs_order_number GROUP BY i_item_desc, w_warehouse_name, fd1.d_week_seq ORDER BY total_cnt DESC NULLS FIRST, i_item_desc NULLS FIRST, w_warehouse_name NULLS FIRST, fd1.d_week_seq NULLS FIRST LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same output columns\",\n        \"same grouping grain\"\n      ],\n      \"expected_speedup\": \"1.8x\",\n      \"risk\": \"high\"\n    }\n  ],\n  \"explanation\": \"rs_01: Isolate date_dim filters into CTEs early. Filter d2 by week_seq from d1 (since they must match). Apply d3 filter as join condition. This reduces the date_dim scans from 3 sequential scans to 1 filtered scan and 2 filtered CTEs. rs_02: Push dimension filters (customer_demographics, household_demographics, d1, d2, d3) early into catalog_sales via a CTE, reducing the fact table rows before expensive joins. This is higher risk due to complexity but could yield additional speedup when combined with rs_01.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 1,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.1719409581846711,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filter",
            "speedup": 1.1309813140521074,
            "original_ms": 618.9486316667777,
            "optimized_ms": 547.2668946661846,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transforms",
            "speedup": 1.0947091548143462,
            "original_ms": 618.9486316667777,
            "optimized_ms": 565.4000689998308,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.97,
            "original_ms": 1467.27,
            "optimized_ms": 1506.06,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.657673161711531,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructuring",
            "speedup": 0.4148215522518359,
            "original_ms": 618.9486316667777,
            "optimized_ms": 1492.0840739996493,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_date_dimension_isolation",
            "speedup": 0,
            "original_ms": 618.9486316667777,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_date_range_cte",
              "dimension_cte_isolate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0,
            "original_ms": 613.5918756663159,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_date_range_cte",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q73": {
        "query_id": "q73",
        "status": "WIN",
        "best_speedup": 1.57,
        "original_ms": 450.09,
        "optimized_ms": 286.68,
        "original_sql": "\nSELECT c_last_name,\n       c_first_name,\n       c_salutation,\n       c_preferred_cust_flag,\n       ss_ticket_number,\n       cnt\nFROM\n  (SELECT ss_ticket_number,\n          ss_customer_sk,\n          count(*) cnt\n   FROM store_sales,\n        date_dim,\n        store,\n        household_demographics\n   WHERE store_sales.ss_sold_date_sk = date_dim.d_date_sk\n     AND store_sales.ss_store_sk = store.s_store_sk\n     AND store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n     AND date_dim.d_dom BETWEEN 1 AND 2\n     AND (household_demographics.hd_buy_potential = 'Unknown'\n          OR household_demographics.hd_buy_potential = '>10000')\n     AND household_demographics.hd_vehicle_count > 0\n     AND CASE\n             WHEN household_demographics.hd_vehicle_count > 0 THEN (household_demographics.hd_dep_count*1.000)/ household_demographics.hd_vehicle_count\n             ELSE NULL\n         END > 1\n     AND date_dim.d_year IN (1999,\n                             1999+1,\n                             1999+2)\n     AND store.s_county IN ('Orange County',\n                            'Bronx County',\n                            'Franklin Parish',\n                            'Williamson County')\n   GROUP BY ss_ticket_number,\n            ss_customer_sk) dj,\n     customer\nWHERE ss_customer_sk = c_customer_sk\n  AND cnt BETWEEN 1 AND 5\nORDER BY cnt DESC,\n         c_last_name ASC;\n\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_dom BETWEEN 1 AND 2 AND d_year IN (1999, 2000, 2001)), filtered_stores AS (SELECT s_store_sk FROM store WHERE s_county IN ('Orange County', 'Bronx County', 'Franklin Parish', 'Williamson County')), filtered_hd_unknown AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential = 'Unknown' AND hd_vehicle_count > 0 AND (hd_dep_count * 1.000) / hd_vehicle_count > 1), filtered_hd_high AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential = '>10000' AND hd_vehicle_count > 0 AND (hd_dep_count * 1.000) / hd_vehicle_count > 1), union_aggregate AS (SELECT ss_ticket_number, ss_customer_sk, COUNT(*) AS cnt FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN filtered_stores ON ss_store_sk = s_store_sk JOIN filtered_hd_unknown ON ss_hdemo_sk = hd_demo_sk GROUP BY ss_ticket_number, ss_customer_sk UNION ALL SELECT ss_ticket_number, ss_customer_sk, COUNT(*) AS cnt FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN filtered_stores ON ss_store_sk = s_store_sk JOIN filtered_hd_high ON ss_hdemo_sk = hd_demo_sk GROUP BY ss_ticket_number, ss_customer_sk)\nSELECT c_last_name, c_first_name, c_salutation, c_preferred_cust_flag, ss_ticket_number, cnt FROM (SELECT ss_ticket_number, ss_customer_sk, SUM(cnt) AS cnt FROM union_aggregate GROUP BY ss_ticket_number, ss_customer_sk HAVING SUM(cnt) BETWEEN 1 AND 5) AS dj, customer WHERE ss_customer_sk = c_customer_sk ORDER BY cnt DESC, c_last_name ASC LIMIT 100",
        "transforms": [
          "or_to_union"
        ],
        "principle": "or_to_union",
        "changes_description": null,
        "reasoning": "Looking at this query, I can see several optimization opportunities:\n\n1. **OR_TO_UNION**: The OR condition on `hd_buy_potential` can be split into UNION ALL branches\n2. **DATE_CTE_ISOLATE**: The date_dim filters can be isolated to reduce join size early\n3. **EARLY_FILTER**: Multiple CTEs can filter dimensions before joining with fact table\n4. **PUSHDOWN**: Complex CASE expression can be pushed into household_demographics filtering\n\nThe biggest cost is the full table scan of store_sales (83% of cost). By creating filtered CTEs and splitting the OR condition, we can reduce the fact table joins significantly.\n\n```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"or_to_union\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_dom BETWEEN 1 AND 2 AND d_year IN (1999, 2000, 2001)\",\n        \"filtered_stores\": \"SELECT s_store_sk FROM store WHERE s_county IN ('Orange County', 'Bronx County', 'Franklin Parish', 'Williamson County')\",\n        \"filtered_hd_unknown\": \"SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential = 'Unknown' AND hd_vehicle_count > 0 AND (hd_dep_count * 1.000) / hd_vehicle_count > 1\",\n        \"filtered_hd_high\": \"SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential = '>10000' AND hd_vehicle_count > 0 AND (hd_dep_count * 1.000) / hd_vehicle_count > 1\",\n        \"union_aggregate\": \"SELECT ss_ticket_number, ss_customer_sk, COUNT(*) AS cnt FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN filtered_stores ON ss_store_sk = s_store_sk JOIN filtered_hd_unknown ON ss_hdemo_sk = hd_demo_sk GROUP BY ss_ticket_number, ss_customer_sk UNION ALL SELECT ss_ticket_number, ss_customer_sk, COUNT(*) AS cnt FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN filtered_stores ON ss_store_sk = s_store_sk JOIN filtered_hd_high ON ss_hdemo_sk = hd_demo_sk GROUP BY ss_ticket_number, ss_customer_sk\",\n        \"main_query\": \"SELECT c_last_name, c_first_name, c_salutation, c_preferred_cust_flag, ss_ticket_number, cnt FROM (SELECT ss_ticket_number, ss_customer_sk, SUM(cnt) AS cnt FROM union_aggregate GROUP BY ss_ticket_number, ss_customer_sk HAVING SUM(cnt) BETWEEN 1 AND 5) AS dj, customer WHERE ss_customer_sk = c_customer_sk ORDER BY cnt DESC, c_last_name ASC LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"output columns unchanged\", \n        \"same grouping grain (ss_ticket_number, ss_customer_sk)\",\n        \"same filter conditions applied\",\n        \"same result rows after aggregation\"\n      ],\n      \"expected_speedup\": \"3.5x\",\n      \"risk\": \"medium\"\n    }\n  ],\n  \"explanation\": \"Transformed OR condition on hd_buy_potential into UNION ALL branches, each with focused predicates. Isolated date and store filters into CTEs to reduce fact table joins early. Moved complex CASE expression into household_demographics CTEs. Each branch now processes only relevant rows, allowing better index usage and reduced intermediate result sizes.\"\n}\n```\n\n**Key insight**: The OR condition on `hd_buy_potential` is the main filter that could benefit from UNION ALL decomposition. By creating separate CTEs for each value and pushing down all other filters, each branch only processes the relevant subset of store_sales. The date_dim filter reduces 73,049 rows to just 72, which is a key early filter. The store filter reduces to 52 rows. Combined, these filtered CTEs drastically reduce the fact table join size from 172M rows.",
        "provenance": {
          "source": "Retry3W",
          "run": "retry_3worker_20260205_235909_details",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.1198315895962039,
            "original_ms": 348.19814366649854,
            "optimized_ms": 310.9379543329851,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.0680600720976903,
            "original_ms": 314.14637466635514,
            "optimized_ms": 294.1280016669528,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 1.0593657594983805,
            "original_ms": 314.14637466635514,
            "optimized_ms": 296.54193733343465,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.057871479717214,
            "original_ms": 314.14637466635514,
            "optimized_ms": 296.96081300001725,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.03,
            "original_ms": 450.09,
            "optimized_ms": 437.07,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "decorrelate",
              "pushdown",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_predicate_pushdown",
            "speedup": 1.015991003256363,
            "original_ms": 314.14637466635514,
            "optimized_ms": 309.20192566615395,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.9251978374944853,
            "original_ms": 317.948852666935,
            "optimized_ms": 343.65498899993935,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": []
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.6042172220248457,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.16775479448656824,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "materialize_cte"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.041680245520203996,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q74": {
        "query_id": "q74",
        "status": "WIN",
        "best_speedup": 1.36,
        "original_ms": 4129.73,
        "optimized_ms": 3036.57,
        "original_sql": "-- start query 74 in stream 0 using template query74.tpl\nwith year_total as (\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,d_year as year\n       ,stddev_samp(ss_net_paid) year_total\n       ,'s' sale_type\n from customer\n     ,store_sales\n     ,date_dim\n where c_customer_sk = ss_customer_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_year in (1999,1999+1)\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,d_year\n union all\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,d_year as year\n       ,stddev_samp(ws_net_paid) year_total\n       ,'w' sale_type\n from customer\n     ,web_sales\n     ,date_dim\n where c_customer_sk = ws_bill_customer_sk\n   and ws_sold_date_sk = d_date_sk\n   and d_year in (1999,1999+1)\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,d_year\n         )\n  select\n        t_s_secyear.customer_id, t_s_secyear.customer_first_name, t_s_secyear.customer_last_name\n from year_total t_s_firstyear\n     ,year_total t_s_secyear\n     ,year_total t_w_firstyear\n     ,year_total t_w_secyear\n where t_s_secyear.customer_id = t_s_firstyear.customer_id\n         and t_s_firstyear.customer_id = t_w_secyear.customer_id\n         and t_s_firstyear.customer_id = t_w_firstyear.customer_id\n         and t_s_firstyear.sale_type = 's'\n         and t_w_firstyear.sale_type = 'w'\n         and t_s_secyear.sale_type = 's'\n         and t_w_secyear.sale_type = 'w'\n         and t_s_firstyear.year = 1999\n         and t_s_secyear.year = 1999+1\n         and t_w_firstyear.year = 1999\n         and t_w_secyear.year = 1999+1\n         and t_s_firstyear.year_total > 0\n         and t_w_firstyear.year_total > 0\n         and case when t_w_firstyear.year_total > 0 then t_w_secyear.year_total / t_w_firstyear.year_total else null end\n           > case when t_s_firstyear.year_total > 0 then t_s_secyear.year_total / t_s_firstyear.year_total else null end\n order by 2,1,3\n LIMIT 100;\n\n-- end query 74 in stream 0 using template query74.tpl\n",
        "optimized_sql": "WITH year_total AS (SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, d_year AS year, STDDEV_SAMP(ss_net_paid) AS year_total, 's' AS sale_type FROM customer, store_sales, date_dim WHERE c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year IN (1999, 1999 + 1) GROUP BY c_customer_id, c_first_name, c_last_name, d_year UNION ALL SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, d_year AS year, STDDEV_SAMP(ws_net_paid) AS year_total, 'w' AS sale_type FROM customer, web_sales, date_dim WHERE c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year IN (1999, 1999 + 1) GROUP BY c_customer_id, c_first_name, c_last_name, d_year), year_total_store AS (SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, d_year AS year, STDDEV_SAMP(ss_net_paid) AS year_total FROM customer, store_sales, date_dim WHERE c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year IN (1999, 1999 + 1) GROUP BY c_customer_id, c_first_name, c_last_name, d_year), year_total_web AS (SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, d_year AS year, STDDEV_SAMP(ws_net_paid) AS year_total FROM customer, web_sales, date_dim WHERE c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year IN (1999, 1999 + 1) GROUP BY c_customer_id, c_first_name, c_last_name, d_year)\nSELECT t_s_secyear.customer_id, t_s_secyear.customer_first_name, t_s_secyear.customer_last_name FROM year_total_store AS t_s_firstyear, year_total_store AS t_s_secyear, year_total_web AS t_w_firstyear, year_total_web AS t_w_secyear WHERE t_s_secyear.customer_id = t_s_firstyear.customer_id AND t_s_firstyear.customer_id = t_w_secyear.customer_id AND t_s_firstyear.customer_id = t_w_firstyear.customer_id AND t_s_firstyear.year = 1999 AND t_s_secyear.year = 1999 + 1 AND t_w_firstyear.year = 1999 AND t_w_secyear.year = 1999 + 1 AND t_s_firstyear.year_total > 0 AND t_w_firstyear.year_total > 0 AND CASE WHEN t_w_firstyear.year_total > 0 THEN t_w_secyear.year_total / t_w_firstyear.year_total ELSE NULL END > CASE WHEN t_s_firstyear.year_total > 0 THEN t_s_secyear.year_total / t_s_firstyear.year_total ELSE NULL END ORDER BY 2, 1, 3 LIMIT 100",
        "transforms": [
          "pushdown"
        ],
        "principle": "pushdown",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"pushdown\",\n      \"nodes\": {\n        \"year_total_store\": \"SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, d_year AS year, STDDEV_SAMP(ss_net_paid) AS year_total FROM customer, store_sales, date_dim WHERE c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year IN (1999, 1999 + 1) GROUP BY c_customer_id, c_first_name, c_last_name, d_year\",\n        \"year_total_web\": \"SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, d_year AS year, STDDEV_SAMP(ws_net_paid) AS year_total FROM customer, web_sales, date_dim WHERE c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year IN (1999, 1999 + 1) GROUP BY c_customer_id, c_first_name, c_last_name, d_year\",\n        \"main_query\": \"SELECT t_s_secyear.customer_id, t_s_secyear.customer_first_name, t_s_secyear.customer_last_name FROM year_total_store AS t_s_firstyear, year_total_store AS t_s_secyear, year_total_web AS t_w_firstyear, year_total_web AS t_w_secyear WHERE t_s_secyear.customer_id = t_s_firstyear.customer_id AND t_s_firstyear.customer_id = t_w_secyear.customer_id AND t_s_firstyear.customer_id = t_w_firstyear.customer_id AND t_s_firstyear.year = 1999 AND t_s_secyear.year = 1999 + 1 AND t_w_firstyear.year = 1999 AND t_w_secyear.year = 1999 + 1 AND t_s_firstyear.year_total > 0 AND t_w_firstyear.year_total > 0 AND CASE WHEN t_w_firstyear.year_total > 0 THEN t_w_secyear.year_total / t_w_firstyear.year_total ELSE NULL END > CASE WHEN t_s_firstyear.year_total > 0 THEN t_s_secyear.year_total / t_s_firstyear.year_total ELSE NULL END ORDER BY 2, 1, 3 LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\"\n      ],\n      \"expected_speedup\": \"2x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Split the year_total CTE into separate store_sales and web_sales CTEs (year_total_store and year_total_web) to push the sale_type filter before aggregation. This eliminates the UNION ALL overhead and the redundant sale_type column, reducing data volume by half for each CTE branch while preserving the exact join logic and output of the main query.\"\n}\n```",
        "provenance": {
          "source": "Kimi",
          "run": "kimi_k2.5",
          "model": "kimi-k2.5",
          "worker_id": null,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.36,
            "original_ms": 4129.73,
            "optimized_ms": 3028.01,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.2280077773449636,
            "original_ms": 2447.314263666461,
            "optimized_ms": 1992.9143030003615,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.215936679110929,
            "original_ms": 2257.2044356666083,
            "optimized_ms": 1856.3503136668562,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_date_isolation",
            "speedup": 1.2076039099615592,
            "original_ms": 2257.2044356666083,
            "optimized_ms": 1869.159595333258,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "union_cte_split"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.7846985263859467,
            "original_ms": 2270.8029476658944,
            "optimized_ms": 2893.8539723330905,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_materialization",
            "speedup": 0,
            "original_ms": 2257.2044356666083,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_channel_prefetch",
            "speedup": 0,
            "original_ms": 2257.2044356666083,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_date_range_cte",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q75": {
        "query_id": "q75",
        "status": "WIN",
        "best_speedup": 1.5797,
        "original_ms": 1597.81,
        "optimized_ms": 1011.44,
        "original_sql": "-- start query 75 in stream 0 using template query75.tpl\nWITH all_sales AS (\n SELECT d_year\n       ,i_brand_id\n       ,i_class_id\n       ,i_category_id\n       ,i_manufact_id\n       ,SUM(sales_cnt) AS sales_cnt\n       ,SUM(sales_amt) AS sales_amt\n FROM (SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,cs_quantity - COALESCE(cr_return_quantity,0) AS sales_cnt\n             ,cs_ext_sales_price - COALESCE(cr_return_amount,0.0) AS sales_amt\n       FROM catalog_sales JOIN item ON i_item_sk=cs_item_sk\n                          JOIN date_dim ON d_date_sk=cs_sold_date_sk\n                          LEFT JOIN catalog_returns ON (cs_order_number=cr_order_number \n                                                    AND cs_item_sk=cr_item_sk)\n       WHERE i_category='Home'\n       UNION\n       SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,ss_quantity - COALESCE(sr_return_quantity,0) AS sales_cnt\n             ,ss_ext_sales_price - COALESCE(sr_return_amt,0.0) AS sales_amt\n       FROM store_sales JOIN item ON i_item_sk=ss_item_sk\n                        JOIN date_dim ON d_date_sk=ss_sold_date_sk\n                        LEFT JOIN store_returns ON (ss_ticket_number=sr_ticket_number \n                                                AND ss_item_sk=sr_item_sk)\n       WHERE i_category='Home'\n       UNION\n       SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,ws_quantity - COALESCE(wr_return_quantity,0) AS sales_cnt\n             ,ws_ext_sales_price - COALESCE(wr_return_amt,0.0) AS sales_amt\n       FROM web_sales JOIN item ON i_item_sk=ws_item_sk\n                      JOIN date_dim ON d_date_sk=ws_sold_date_sk\n                      LEFT JOIN web_returns ON (ws_order_number=wr_order_number \n                                            AND ws_item_sk=wr_item_sk)\n       WHERE i_category='Home') sales_detail\n GROUP BY d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id)\n select prev_yr.d_year AS prev_year\n                          ,curr_yr.d_year AS year\n                          ,curr_yr.i_brand_id\n                          ,curr_yr.i_class_id\n                          ,curr_yr.i_category_id\n                          ,curr_yr.i_manufact_id\n                          ,prev_yr.sales_cnt AS prev_yr_cnt\n                          ,curr_yr.sales_cnt AS curr_yr_cnt\n                          ,curr_yr.sales_cnt-prev_yr.sales_cnt AS sales_cnt_diff\n                          ,curr_yr.sales_amt-prev_yr.sales_amt AS sales_amt_diff\n FROM all_sales curr_yr, all_sales prev_yr\n WHERE curr_yr.i_brand_id=prev_yr.i_brand_id\n   AND curr_yr.i_class_id=prev_yr.i_class_id\n   AND curr_yr.i_category_id=prev_yr.i_category_id\n   AND curr_yr.i_manufact_id=prev_yr.i_manufact_id\n   AND curr_yr.d_year=1999\n   AND prev_yr.d_year=1999-1\n   AND CAST(curr_yr.sales_cnt AS DECIMAL(17,2))/CAST(prev_yr.sales_cnt AS DECIMAL(17,2))<0.9\n ORDER BY sales_cnt_diff,sales_amt_diff\n LIMIT 100;\n\n-- end query 75 in stream 0 using template query75.tpl\n",
        "optimized_sql": "WITH filtered_item AS (\n  SELECT \n    i_item_sk,\n    i_brand_id,\n    i_class_id,\n    i_category_id,\n    i_manufact_id\n  FROM item\n  WHERE i_category = 'Home'\n),\nfiltered_dates AS (\n  SELECT \n    d_date_sk,\n    d_year\n  FROM date_dim\n  WHERE d_year IN (1998, 1999)\n),\ncatalog_sales_prep AS (\n  SELECT\n    d.d_year,\n    i.i_brand_id,\n    i.i_class_id,\n    i.i_category_id,\n    i.i_manufact_id,\n    cs.cs_quantity - COALESCE(cr.cr_return_quantity, 0) AS sales_cnt,\n    cs.cs_ext_sales_price - COALESCE(cr.cr_return_amount, 0.0) AS sales_amt\n  FROM catalog_sales cs\n  JOIN filtered_item i ON i.i_item_sk = cs.cs_item_sk\n  JOIN filtered_dates d ON d.d_date_sk = cs.cs_sold_date_sk\n  LEFT JOIN catalog_returns cr ON (\n    cs.cs_order_number = cr.cr_order_number \n    AND cs.cs_item_sk = cr.cr_item_sk\n  )\n),\nstore_sales_prep AS (\n  SELECT\n    d.d_year,\n    i.i_brand_id,\n    i.i_class_id,\n    i.i_category_id,\n    i.i_manufact_id,\n    ss.ss_quantity - COALESCE(sr.sr_return_quantity, 0) AS sales_cnt,\n    ss.ss_ext_sales_price - COALESCE(sr.sr_return_amt, 0.0) AS sales_amt\n  FROM store_sales ss\n  JOIN filtered_item i ON i.i_item_sk = ss.ss_item_sk\n  JOIN filtered_dates d ON d.d_date_sk = ss.ss_sold_date_sk\n  LEFT JOIN store_returns sr ON (\n    ss.ss_ticket_number = sr.sr_ticket_number \n    AND ss.ss_item_sk = sr.sr_item_sk\n  )\n),\nweb_sales_prep AS (\n  SELECT\n    d.d_year,\n    i.i_brand_id,\n    i.i_class_id,\n    i.i_category_id,\n    i.i_manufact_id,\n    ws.ws_quantity - COALESCE(wr.wr_return_quantity, 0) AS sales_cnt,\n    ws.ws_ext_sales_price - COALESCE(wr.wr_return_amt, 0.0) AS sales_amt\n  FROM web_sales ws\n  JOIN filtered_item i ON i.i_item_sk = ws.ws_item_sk\n  JOIN filtered_dates d ON d.d_date_sk = ws.ws_sold_date_sk\n  LEFT JOIN web_returns wr ON (\n    ws.ws_order_number = wr.wr_order_number \n    AND ws.ws_item_sk = wr.wr_item_sk\n  )\n),\ncombined_sales AS (\n  SELECT * FROM catalog_sales_prep\n  UNION ALL\n  SELECT * FROM store_sales_prep\n  UNION ALL\n  SELECT * FROM web_sales_prep\n),\nall_sales AS (\n  SELECT\n    d_year,\n    i_brand_id,\n    i_class_id,\n    i_category_id,\n    i_manufact_id,\n    SUM(sales_cnt) AS sales_cnt,\n    SUM(sales_amt) AS sales_amt\n  FROM combined_sales\n  GROUP BY\n    d_year,\n    i_brand_id,\n    i_class_id,\n    i_category_id,\n    i_manufact_id\n),\ncurr_year_sales AS (\n  SELECT *\n  FROM all_sales\n  WHERE d_year = 1999\n),\nprev_year_sales AS (\n  SELECT *\n  FROM all_sales\n  WHERE d_year = 1998\n)\nSELECT\n  1998 AS prev_year,\n  1999 AS year,\n  curr.i_brand_id,\n  curr.i_class_id,\n  curr.i_category_id,\n  curr.i_manufact_id,\n  prev.sales_cnt AS prev_yr_cnt,\n  curr.sales_cnt AS curr_yr_cnt,\n  curr.sales_cnt - prev.sales_cnt AS sales_cnt_diff,\n  curr.sales_amt - prev.sales_amt AS sales_amt_diff\nFROM curr_year_sales curr\nJOIN prev_year_sales prev ON (\n  curr.i_brand_id = prev.i_brand_id\n  AND curr.i_class_id = prev.i_class_id\n  AND curr.i_category_id = prev.i_category_id\n  AND curr.i_manufact_id = prev.i_manufact_id\n)\nWHERE CAST(curr.sales_cnt AS DECIMAL(17, 2)) / CAST(prev.sales_cnt AS DECIMAL(17, 2)) < 0.9\nORDER BY\n  sales_cnt_diff,\n  sales_amt_diff\nLIMIT 100",
        "transforms": [
          "decorrelate",
          "union_cte_split",
          "date_cte_isolate",
          "dimension_cte_isolate",
          "prefetch_fact_join"
        ],
        "principle": "decorrelate",
        "changes_description": "Applied shared dimension extraction by pre-filtering item and date_dim tables into CTEs, then joined with each sales channel. Also split the aggregated all_sales into year-specific CTEs (curr_year_sales, prev_year_sales) to avoid scanning the full aggregated data twice.",
        "reasoning": "```sql\nWITH filtered_item AS (\n  SELECT \n    i_item_sk,\n    i_brand_id,\n    i_class_id,\n    i_category_id,\n    i_manufact_id\n  FROM item\n  WHERE i_category = 'Home'\n),\nfiltered_dates AS (\n  SELECT \n    d_date_sk,\n    d_year\n  FROM date_dim\n  WHERE d_year IN (1998, 1999)\n),\ncatalog_sales_prep AS (\n  SELECT\n    d.d_year,\n    i.i_brand_id,\n    i.i_class_id,\n    i.i_category_id,\n    i.i_manufact_id,\n    cs.cs_quantity - COALESCE(cr.cr_return_quantity, 0) AS sales_cnt,\n    cs.cs_ext_sales_price - COALESCE(cr.cr_return_amount, 0.0) AS sales_amt\n  FROM catalog_sales cs\n  JOIN filtered_item i ON i.i_item_sk = cs.cs_item_sk\n  JOIN filtered_dates d ON d.d_date_sk = cs.cs_sold_date_sk\n  LEFT JOIN catalog_returns cr ON (\n    cs.cs_order_number = cr.cr_order_number \n    AND cs.cs_item_sk = cr.cr_item_sk\n  )\n),\nstore_sales_prep AS (\n  SELECT\n    d.d_year,\n    i.i_brand_id,\n    i.i_class_id,\n    i.i_category_id,\n    i.i_manufact_id,\n    ss.ss_quantity - COALESCE(sr.sr_return_quantity, 0) AS sales_cnt,\n    ss.ss_ext_sales_price - COALESCE(sr.sr_return_amt, 0.0) AS sales_amt\n  FROM store_sales ss\n  JOIN filtered_item i ON i.i_item_sk = ss.ss_item_sk\n  JOIN filtered_dates d ON d.d_date_sk = ss.ss_sold_date_sk\n  LEFT JOIN store_returns sr ON (\n    ss.ss_ticket_number = sr.sr_ticket_number \n    AND ss.ss_item_sk = sr.sr_item_sk\n  )\n),\nweb_sales_prep AS (\n  SELECT\n    d.d_year,\n    i.i_brand_id,\n    i.i_class_id,\n    i.i_category_id,\n    i.i_manufact_id,\n    ws.ws_quantity - COALESCE(wr.wr_return_quantity, 0) AS sales_cnt,\n    ws.ws_ext_sales_price - COALESCE(wr.wr_return_amt, 0.0) AS sales_amt\n  FROM web_sales ws\n  JOIN filtered_item i ON i.i_item_sk = ws.ws_item_sk\n  JOIN filtered_dates d ON d.d_date_sk = ws.ws_sold_date_sk\n  LEFT JOIN web_returns wr ON (\n    ws.ws_order_number = wr.wr_order_number \n    AND ws.ws_item_sk = wr.wr_item_sk\n  )\n),\ncombined_sales AS (\n  SELECT * FROM catalog_sales_prep\n  UNION ALL\n  SELECT * FROM store_sales_prep\n  UNION ALL\n  SELECT * FROM web_sales_prep\n),\nall_sales AS (\n  SELECT\n    d_year,\n    i_brand_id,\n    i_class_id,\n    i_category_id,\n    i_manufact_id,\n    SUM(sales_cnt) AS sales_cnt,\n    SUM(sales_amt) AS sales_amt\n  FROM combined_sales\n  GROUP BY\n    d_year,\n    i_brand_id,\n    i_class_id,\n    i_category_id,\n    i_manufact_id\n),\ncurr_year_sales AS (\n  SELECT *\n  FROM all_sales\n  WHERE d_year = 1999\n),\nprev_year_sales AS (\n  SELECT *\n  FROM all_sales\n  WHERE d_year = 1998\n)\nSELECT\n  1998 AS prev_year,\n  1999 AS year,\n  curr.i_brand_id,\n  curr.i_class_id,\n  curr.i_category_id,\n  curr.i_manufact_id,\n  prev.sales_cnt AS prev_yr_cnt,\n  curr.sales_cnt AS curr_yr_cnt,\n  curr.sales_cnt - prev.sales_cnt AS sales_cnt_diff,\n  curr.sales_amt - prev.sales_amt AS sales_amt_diff\nFROM curr_year_sales curr\nJOIN prev_year_sales prev ON (\n  curr.i_brand_id = prev.i_brand_id\n  AND curr.i_class_id = prev.i_class_id\n  AND curr.i_category_id = prev.i_category_id\n  AND curr.i_manufact_id = prev.i_manufact_id\n)\nWHERE CAST(curr.sales_cnt AS DECIMAL(17, 2)) / CAST(prev.sales_cnt AS DECIMAL(17, 2)) < 0.9\nORDER BY\n  sales_cnt_diff,\n  sales_amt_diff\nLIMIT 100\n```\n\nChanges: Applied shared dimension extraction by pre-filtering item and date_dim tables into CTEs, then joined with each sales channel. Also split the aggregated all_sales into year-specific CTEs (curr_year_sales, prev_year_sales) to avoid scanning the full aggregated data twice.\n\nExpected speedup: 2.0x+ by eliminating redundant dimension table scans and pushing year filters earlier in the pipeline.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 5,
          "iteration": 1,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.707322716733612,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.5797328430054858,
            "original_ms": 1597.8121313340428,
            "optimized_ms": 1011.444522666352,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "union_cte_split",
              "date_cte_isolate",
              "dimension_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_date_dimension_isolation",
            "speedup": 1.4948841007596256,
            "original_ms": 1341.6281686668299,
            "optimized_ms": 897.4797229999846,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.4042826037161327,
            "original_ms": 1341.6281686668299,
            "optimized_ms": 955.3833146665056,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "intersect_to_exists",
              "decorrelate",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_union_restructure",
            "speedup": 1.403346973764742,
            "original_ms": 1341.6281686668299,
            "optimized_ms": 956.0202813333186,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "union_cte_split",
              "single_pass_aggregation",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_early_filter",
            "speedup": 1.1202902969718573,
            "original_ms": 1341.6281686668299,
            "optimized_ms": 1197.5718903334684,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.94,
            "original_ms": 2844.6,
            "optimized_ms": 3021.42,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.9308993211395007,
            "original_ms": 1263.245136333353,
            "optimized_ms": 1357.0158530001208,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "union_cte_split",
              "date_cte_isolate",
              "dimension_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.5657553687776862,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q76": {
        "query_id": "q76",
        "status": "WIN",
        "best_speedup": 1.1089,
        "original_ms": 340.38,
        "optimized_ms": 306.95,
        "original_sql": "-- start query 76 in stream 0 using template query76.tpl\nselect channel, col_name, d_year, d_qoy, i_category, COUNT(*) sales_cnt, SUM(ext_sales_price) sales_amt FROM (\n        SELECT 'store' as channel, 'ss_hdemo_sk' col_name, d_year, d_qoy, i_category, ss_ext_sales_price ext_sales_price\n         FROM store_sales, item, date_dim\n         WHERE ss_hdemo_sk IS NULL\n           AND ss_sold_date_sk=d_date_sk\n           AND ss_item_sk=i_item_sk\n        UNION ALL\n        SELECT 'web' as channel, 'ws_bill_addr_sk' col_name, d_year, d_qoy, i_category, ws_ext_sales_price ext_sales_price\n         FROM web_sales, item, date_dim\n         WHERE ws_bill_addr_sk IS NULL\n           AND ws_sold_date_sk=d_date_sk\n           AND ws_item_sk=i_item_sk\n        UNION ALL\n        SELECT 'catalog' as channel, 'cs_warehouse_sk' col_name, d_year, d_qoy, i_category, cs_ext_sales_price ext_sales_price\n         FROM catalog_sales, item, date_dim\n         WHERE cs_warehouse_sk IS NULL\n           AND cs_sold_date_sk=d_date_sk\n           AND cs_item_sk=i_item_sk) foo\nGROUP BY channel, col_name, d_year, d_qoy, i_category\nORDER BY channel, col_name, d_year, d_qoy, i_category\n LIMIT 100;\n\n-- end query 76 in stream 0 using template query76.tpl\n",
        "optimized_sql": "WITH store_agg AS (\n    SELECT\n        'store' AS channel,\n        'ss_hdemo_sk' AS col_name,\n        d.d_year,\n        d.d_qoy,\n        i.i_category,\n        COUNT(*) AS sales_cnt,\n        SUM(ss_ext_sales_price) AS sales_amt\n    FROM store_sales ss\n    JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk\n    JOIN item i ON ss.ss_item_sk = i.i_item_sk\n    WHERE ss.ss_hdemo_sk IS NULL\n    GROUP BY d.d_year, d.d_qoy, i.i_category\n),\nweb_agg AS (\n    SELECT\n        'web' AS channel,\n        'ws_bill_addr_sk' AS col_name,\n        d.d_year,\n        d.d_qoy,\n        i.i_category,\n        COUNT(*) AS sales_cnt,\n        SUM(ws_ext_sales_price) AS sales_amt\n    FROM web_sales ws\n    JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk\n    JOIN item i ON ws.ws_item_sk = i.i_item_sk\n    WHERE ws.ws_bill_addr_sk IS NULL\n    GROUP BY d.d_year, d.d_qoy, i.i_category\n),\ncatalog_agg AS (\n    SELECT\n        'catalog' AS channel,\n        'cs_warehouse_sk' AS col_name,\n        d.d_year,\n        d.d_qoy,\n        i.i_category,\n        COUNT(*) AS sales_cnt,\n        SUM(cs_ext_sales_price) AS sales_amt\n    FROM catalog_sales cs\n    JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk\n    JOIN item i ON cs.cs_item_sk = i.i_item_sk\n    WHERE cs.cs_warehouse_sk IS NULL\n    GROUP BY d.d_year, d.d_qoy, i.i_category\n)\nSELECT\n    channel,\n    col_name,\n    d_year,\n    d_qoy,\n    i_category,\n    sales_cnt,\n    sales_amt\nFROM (\n    SELECT * FROM store_agg\n    UNION ALL\n    SELECT * FROM web_agg\n    UNION ALL\n    SELECT * FROM catalog_agg\n) AS combined\nORDER BY\n    channel,\n    col_name,\n    d_year,\n    d_qoy,\n    i_category\nLIMIT 100;",
        "transforms": [
          "or_to_union",
          "intersect_to_exists",
          "decorrelate",
          "date_cte_isolate",
          "dimension_cte_isolate"
        ],
        "principle": "or_to_union",
        "changes_description": "** Applied UNION-to-EXISTS decorrelation principle by pushing aggregations down into each channel branch before unioning. Converted implicit joins to explicit JOIN syntax for better optimizer control. This reduces data volume before the UNION operation while preserving exact semantics.\n\n**Expected speedup:** ~2-3x by eliminating the need to process large numbers of unaggregated rows through the UNION. Each branch now aggregates locally before combining results, which is especially effective when",
        "reasoning": "```sql\nWITH store_agg AS (\n    SELECT\n        'store' AS channel,\n        'ss_hdemo_sk' AS col_name,\n        d.d_year,\n        d.d_qoy,\n        i.i_category,\n        COUNT(*) AS sales_cnt,\n        SUM(ss_ext_sales_price) AS sales_amt\n    FROM store_sales ss\n    JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk\n    JOIN item i ON ss.ss_item_sk = i.i_item_sk\n    WHERE ss.ss_hdemo_sk IS NULL\n    GROUP BY d.d_year, d.d_qoy, i.i_category\n),\nweb_agg AS (\n    SELECT\n        'web' AS channel,\n        'ws_bill_addr_sk' AS col_name,\n        d.d_year,\n        d.d_qoy,\n        i.i_category,\n        COUNT(*) AS sales_cnt,\n        SUM(ws_ext_sales_price) AS sales_amt\n    FROM web_sales ws\n    JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk\n    JOIN item i ON ws.ws_item_sk = i.i_item_sk\n    WHERE ws.ws_bill_addr_sk IS NULL\n    GROUP BY d.d_year, d.d_qoy, i.i_category\n),\ncatalog_agg AS (\n    SELECT\n        'catalog' AS channel,\n        'cs_warehouse_sk' AS col_name,\n        d.d_year,\n        d.d_qoy,\n        i.i_category,\n        COUNT(*) AS sales_cnt,\n        SUM(cs_ext_sales_price) AS sales_amt\n    FROM catalog_sales cs\n    JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk\n    JOIN item i ON cs.cs_item_sk = i.i_item_sk\n    WHERE cs.cs_warehouse_sk IS NULL\n    GROUP BY d.d_year, d.d_qoy, i.i_category\n)\nSELECT\n    channel,\n    col_name,\n    d_year,\n    d_qoy,\n    i_category,\n    sales_cnt,\n    sales_amt\nFROM (\n    SELECT * FROM store_agg\n    UNION ALL\n    SELECT * FROM web_agg\n    UNION ALL\n    SELECT * FROM catalog_agg\n) AS combined\nORDER BY\n    channel,\n    col_name,\n    d_year,\n    d_qoy,\n    i_category\nLIMIT 100;\n```\n\n**Changes:** Applied UNION-to-EXISTS decorrelation principle by pushing aggregations down into each channel branch before unioning. Converted implicit joins to explicit JOIN syntax for better optimizer control. This reduces data volume before the UNION operation while preserving exact semantics.\n\n**Expected speedup:** ~2-3x by eliminating the need to process large numbers of unaggregated rows through the UNION. Each branch now aggregates locally before combining results, which is especially effective when grouping by common dimensions across all branches.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 4,
          "iteration": 0,
          "strategy": "novel_structural_transforms"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transforms",
            "speedup": 1.1088930774161783,
            "original_ms": 340.37543499986594,
            "optimized_ms": 306.9506356672112,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_cte_restructuring",
            "speedup": 1.1048099190949936,
            "original_ms": 340.37543499986594,
            "optimized_ms": 308.08506433277216,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.1,
            "original_ms": 513.1,
            "optimized_ms": 465.25,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0732503920743846,
            "original_ms": 340.37543499986594,
            "optimized_ms": 317.1444776665642,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.065648002514573,
            "original_ms": 354.24614500031265,
            "optimized_ms": 332.42322433337296,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": []
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_join_pushdown",
            "speedup": 1.0507042917033704,
            "original_ms": 340.37543499986594,
            "optimized_ms": 323.94979033354804,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.7265263857529253,
            "original_ms": 316.6488436666744,
            "optimized_ms": 435.83942699964,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q77": {
        "query_id": "q77",
        "status": "WIN",
        "best_speedup": 2.56,
        "original_ms": 420.65,
        "optimized_ms": 164.32,
        "original_sql": "WITH ss AS\n  (SELECT s_store_sk,\n          sum(ss_ext_sales_price) AS sales,\n          sum(ss_net_profit) AS profit\n   FROM store_sales,\n        date_dim,\n        store\n   WHERE ss_sold_date_sk = d_date_sk\n     AND d_date BETWEEN cast('2000-08-23' AS date) AND cast('2000-09-22' AS date)\n     AND ss_store_sk = s_store_sk\n   GROUP BY s_store_sk) ,\n     sr AS\n  (SELECT s_store_sk,\n          sum(sr_return_amt) AS returns_,\n          sum(sr_net_loss) AS profit_loss\n   FROM store_returns,\n        date_dim,\n        store\n   WHERE sr_returned_date_sk = d_date_sk\n     AND d_date BETWEEN cast('2000-08-23' AS date) AND cast('2000-09-22' AS date)\n     AND sr_store_sk = s_store_sk\n   GROUP BY s_store_sk),\n     cs AS\n  (SELECT cs_call_center_sk,\n          sum(cs_ext_sales_price) AS sales,\n          sum(cs_net_profit) AS profit\n   FROM catalog_sales,\n        date_dim\n   WHERE cs_sold_date_sk = d_date_sk\n     AND d_date BETWEEN cast('2000-08-23' AS date) AND cast('2000-09-22' AS date)\n   GROUP BY cs_call_center_sk),\n     cr AS\n  (SELECT cr_call_center_sk,\n          sum(cr_return_amount) AS returns_,\n          sum(cr_net_loss) AS profit_loss\n   FROM catalog_returns,\n        date_dim\n   WHERE cr_returned_date_sk = d_date_sk\n     AND d_date BETWEEN cast('2000-08-23' AS date) AND cast('2000-09-22' AS date)\n   GROUP BY cr_call_center_sk ),\n     ws AS\n  (SELECT wp_web_page_sk,\n          sum(ws_ext_sales_price) AS sales,\n          sum(ws_net_profit) AS profit\n   FROM web_sales,\n        date_dim,\n        web_page\n   WHERE ws_sold_date_sk = d_date_sk\n     AND d_date BETWEEN cast('2000-08-23' AS date) AND cast('2000-09-22' AS date)\n     AND ws_web_page_sk = wp_web_page_sk\n   GROUP BY wp_web_page_sk),\n     wr AS\n  (SELECT wp_web_page_sk,\n          sum(wr_return_amt) AS returns_,\n          sum(wr_net_loss) AS profit_loss\n   FROM web_returns,\n        date_dim,\n        web_page\n   WHERE wr_returned_date_sk = d_date_sk\n     AND d_date BETWEEN cast('2000-08-23' AS date) AND cast('2000-09-22' AS date)\n     AND wr_web_page_sk = wp_web_page_sk\n   GROUP BY wp_web_page_sk)\nSELECT channel ,\n       id ,\n       sum(sales) AS sales ,\n       sum(returns_) AS returns_ ,\n       sum(profit) AS profit\nFROM\n  (SELECT 'store channel' AS channel ,\n          ss.s_store_sk AS id ,\n          sales ,\n          coalesce(returns_, 0) AS returns_ ,\n          (profit - coalesce(profit_loss,0)) AS profit\n   FROM ss\n   LEFT JOIN sr ON ss.s_store_sk = sr.s_store_sk\n   UNION ALL SELECT 'catalog channel' AS channel ,\n                    cs_call_center_sk AS id ,\n                    sales ,\n                    returns_ ,\n                    (profit - profit_loss) AS profit\n   FROM cs ,\n        cr\n   UNION ALL SELECT 'web channel' AS channel ,\n                    ws.wp_web_page_sk AS id ,\n                    sales ,\n                    coalesce(returns_, 0) returns_ ,\n                    (profit - coalesce(profit_loss,0)) AS profit\n   FROM ws\n   LEFT JOIN wr ON ws.wp_web_page_sk = wr.wp_web_page_sk ) x\nGROUP BY ROLLUP (channel,\n                 id)\nORDER BY channel NULLS FIRST,\n         id NULLS FIRST,\n         returns_ DESC\nLIMIT 100;\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('2000-08-23' AS DATE) AND CAST('2000-09-22' AS DATE)), ss AS (SELECT s_store_sk, SUM(ss_ext_sales_price) AS sales, SUM(ss_net_profit) AS profit FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN store ON ss_store_sk = s_store_sk GROUP BY s_store_sk), sr AS (SELECT s_store_sk, SUM(sr_return_amt) AS returns_, SUM(sr_net_loss) AS profit_loss FROM store_returns JOIN filtered_dates ON sr_returned_date_sk = d_date_sk JOIN store ON sr_store_sk = s_store_sk GROUP BY s_store_sk), cs AS (SELECT cs_call_center_sk, SUM(cs_ext_sales_price) AS sales, SUM(cs_net_profit) AS profit FROM catalog_sales, date_dim WHERE cs_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('2000-08-23' AS DATE) AND CAST('2000-09-22' AS DATE) GROUP BY cs_call_center_sk), cr AS (SELECT cr_call_center_sk, SUM(cr_return_amount) AS returns_, SUM(cr_net_loss) AS profit_loss FROM catalog_returns, date_dim WHERE cr_returned_date_sk = d_date_sk AND d_date BETWEEN CAST('2000-08-23' AS DATE) AND CAST('2000-09-22' AS DATE) GROUP BY cr_call_center_sk), ws AS (SELECT wp_web_page_sk, SUM(ws_ext_sales_price) AS sales, SUM(ws_net_profit) AS profit FROM web_sales, date_dim, web_page WHERE ws_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('2000-08-23' AS DATE) AND CAST('2000-09-22' AS DATE) AND ws_web_page_sk = wp_web_page_sk GROUP BY wp_web_page_sk), wr AS (SELECT wp_web_page_sk, SUM(wr_return_amt) AS returns_, SUM(wr_net_loss) AS profit_loss FROM web_returns, date_dim, web_page WHERE wr_returned_date_sk = d_date_sk AND d_date BETWEEN CAST('2000-08-23' AS DATE) AND CAST('2000-09-22' AS DATE) AND wr_web_page_sk = wp_web_page_sk GROUP BY wp_web_page_sk)\nSELECT channel, id, SUM(sales) AS sales, SUM(returns_) AS returns_, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, ss.s_store_sk AS id, sales, COALESCE(returns_, 0) AS returns_, (profit - COALESCE(profit_loss, 0)) AS profit FROM ss LEFT JOIN sr ON ss.s_store_sk = sr.s_store_sk UNION ALL SELECT 'catalog channel' AS channel, cs_call_center_sk AS id, sales, returns_, (profit - profit_loss) AS profit FROM cs, cr UNION ALL SELECT 'web channel' AS channel, ws.wp_web_page_sk AS id, sales, COALESCE(returns_, 0) AS returns_, (profit - COALESCE(profit_loss, 0)) AS profit FROM ws LEFT JOIN wr ON ws.wp_web_page_sk = wr.wp_web_page_sk) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel NULLS FIRST, id NULLS FIRST, returns_ DESC LIMIT 100",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('2000-08-23' AS DATE) AND CAST('2000-09-22' AS DATE)\",\n        \"ss\": \"SELECT s_store_sk, SUM(ss_ext_sales_price) AS sales, SUM(ss_net_profit) AS profit FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN store ON ss_store_sk = s_store_sk GROUP BY s_store_sk\",\n        \"sr\": \"SELECT s_store_sk, SUM(sr_return_amt) AS returns_, SUM(sr_net_loss) AS profit_loss FROM store_returns JOIN filtered_dates ON sr_returned_date_sk = d_date_sk JOIN store ON sr_store_sk = s_store_sk GROUP BY s_store_sk\",\n        \"main_query\": \"SELECT channel, id, SUM(sales) AS sales, SUM(returns_) AS returns_, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, ss.s_store_sk AS id, sales, COALESCE(returns_, 0) AS returns_, (profit - COALESCE(profit_loss, 0)) AS profit FROM ss LEFT JOIN sr ON ss.s_store_sk = sr.s_store_sk UNION ALL SELECT 'catalog channel' AS channel, cs_call_center_sk AS id, sales, returns_, (profit - profit_loss) AS profit FROM cs, cr UNION ALL SELECT 'web channel' AS channel, ws.wp_web_page_sk AS id, sales, COALESCE(returns_, 0) AS returns_, (profit - COALESCE(profit_loss, 0)) AS profit FROM ws LEFT JOIN wr ON ws.wp_web_page_sk = wr.wp_web_page_sk) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel NULLS FIRST, id NULLS FIRST, returns_ DESC LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same output columns\",\n        \"same aggregation semantics\",\n        \"same grouping\"\n      ],\n      \"expected_speedup\": \"1.2x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Created a filtered_dates CTE that isolates the date filter from the main aggregations. This allows the optimizer to compute the date_dim filter once (31 rows) and join it early with the fact tables, rather than performing separate date_dim scans for each CTE. The ss and sr CTEs now join with this filtered set, reducing redundant date_dim scans from 2 to 1 and enabling better join ordering.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 4,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 3.7909010191246577,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 2.5608966658831736,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.3415443622462533,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.0664575249788388,
            "original_ms": 296.7448233336351,
            "optimized_ms": 278.2528289999391,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.0634574065966762,
            "original_ms": 329.2892019999272,
            "optimized_ms": 309.6402356665446,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_consolidation",
            "speedup": 1.0223732672958055,
            "original_ms": 296.7448233336351,
            "optimized_ms": 290.2509610003108,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.01,
            "original_ms": 420.65,
            "optimized_ms": 414.96,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": []
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_date_dimension_isolate",
            "speedup": 1.0069826782636975,
            "original_ms": 296.7448233336351,
            "optimized_ms": 294.68711800018355,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_earlyfilter",
            "speedup": 0.9170169665641419,
            "original_ms": 296.7448233336351,
            "optimized_ms": 323.5979640000248,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0,
            "original_ms": 284.0351476667517,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "single_pass_aggregation",
              "date_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q78": {
        "query_id": "q78",
        "status": "WIN",
        "best_speedup": 1.81,
        "original_ms": 9002.15,
        "optimized_ms": 4973.56,
        "original_sql": "WITH ws AS\n  (SELECT d_year AS ws_sold_year,\n          ws_item_sk,\n          ws_bill_customer_sk ws_customer_sk,\n          sum(ws_quantity) ws_qty,\n          sum(ws_wholesale_cost) ws_wc,\n          sum(ws_sales_price) ws_sp\n   FROM web_sales\n   LEFT JOIN web_returns ON wr_order_number=ws_order_number\n   AND ws_item_sk=wr_item_sk\n   JOIN date_dim ON ws_sold_date_sk = d_date_sk\n   WHERE wr_order_number IS NULL\n   GROUP BY d_year,\n            ws_item_sk,\n            ws_bill_customer_sk ),\n     cs AS\n  (SELECT d_year AS cs_sold_year,\n          cs_item_sk,\n          cs_bill_customer_sk cs_customer_sk,\n          sum(cs_quantity) cs_qty,\n          sum(cs_wholesale_cost) cs_wc,\n          sum(cs_sales_price) cs_sp\n   FROM catalog_sales\n   LEFT JOIN catalog_returns ON cr_order_number=cs_order_number\n   AND cs_item_sk=cr_item_sk\n   JOIN date_dim ON cs_sold_date_sk = d_date_sk\n   WHERE cr_order_number IS NULL\n   GROUP BY d_year,\n            cs_item_sk,\n            cs_bill_customer_sk ),\n     ss AS\n  (SELECT d_year AS ss_sold_year,\n          ss_item_sk,\n          ss_customer_sk,\n          sum(ss_quantity) ss_qty,\n          sum(ss_wholesale_cost) ss_wc,\n          sum(ss_sales_price) ss_sp\n   FROM store_sales\n   LEFT JOIN store_returns ON sr_ticket_number=ss_ticket_number\n   AND ss_item_sk=sr_item_sk\n   JOIN date_dim ON ss_sold_date_sk = d_date_sk\n   WHERE sr_ticket_number IS NULL\n   GROUP BY d_year,\n            ss_item_sk,\n            ss_customer_sk )\nSELECT ss_sold_year,\n       ss_item_sk,\n       ss_customer_sk,\n       round((ss_qty*1.00)/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\n       ss_qty store_qty,\n       ss_wc store_wholesale_cost,\n       ss_sp store_sales_price,\n       coalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\n       coalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\n       coalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nFROM ss\nLEFT JOIN ws ON (ws_sold_year=ss_sold_year\n                 AND ws_item_sk=ss_item_sk\n                 AND ws_customer_sk=ss_customer_sk)\nLEFT JOIN cs ON (cs_sold_year=ss_sold_year\n                 AND cs_item_sk=ss_item_sk\n                 AND cs_customer_sk=ss_customer_sk)\nWHERE (coalesce(ws_qty,0)>0\n       OR coalesce(cs_qty, 0)>0)\n  AND ss_sold_year=2000\nORDER BY ss_sold_year,\n         ss_item_sk,\n         ss_customer_sk,\n         ss_qty DESC,\n         ss_wc DESC,\n         ss_sp DESC,\n         other_chan_qty,\n         other_chan_wholesale_cost,\n         other_chan_sales_price,\n         ratio\nLIMIT 100;\n\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_year FROM date_dim WHERE d_year = 2000), filtered_ss AS (SELECT d_year AS ss_sold_year, ss_item_sk, ss_customer_sk, SUM(ss_quantity) AS ss_qty, SUM(ss_wholesale_cost) AS ss_wc, SUM(ss_sales_price) AS ss_sp FROM store_sales LEFT JOIN store_returns ON sr_ticket_number = ss_ticket_number AND ss_item_sk = sr_item_sk JOIN filtered_dates ON ss_sold_date_sk = filtered_dates.d_date_sk WHERE sr_ticket_number IS NULL GROUP BY d_year, ss_item_sk, ss_customer_sk), filtered_ws AS (SELECT d_year AS ws_sold_year, ws_item_sk, ws_bill_customer_sk AS ws_customer_sk, SUM(ws_quantity) AS ws_qty, SUM(ws_wholesale_cost) AS ws_wc, SUM(ws_sales_price) AS ws_sp FROM web_sales LEFT JOIN web_returns ON wr_order_number = ws_order_number AND ws_item_sk = wr_item_sk JOIN filtered_dates ON ws_sold_date_sk = filtered_dates.d_date_sk WHERE wr_order_number IS NULL GROUP BY d_year, ws_item_sk, ws_bill_customer_sk), filtered_cs AS (SELECT d_year AS cs_sold_year, cs_item_sk, cs_bill_customer_sk AS cs_customer_sk, SUM(cs_quantity) AS cs_qty, SUM(cs_wholesale_cost) AS cs_wc, SUM(cs_sales_price) AS cs_sp FROM catalog_sales LEFT JOIN catalog_returns ON cr_order_number = cs_order_number AND cs_item_sk = cr_item_sk JOIN filtered_dates ON cs_sold_date_sk = filtered_dates.d_date_sk WHERE cr_order_number IS NULL GROUP BY d_year, cs_item_sk, cs_bill_customer_sk), ws AS (SELECT d_year AS ws_sold_year, ws_item_sk, ws_bill_customer_sk AS ws_customer_sk, SUM(ws_quantity) AS ws_qty, SUM(ws_wholesale_cost) AS ws_wc, SUM(ws_sales_price) AS ws_sp FROM web_sales LEFT JOIN web_returns ON wr_order_number = ws_order_number AND ws_item_sk = wr_item_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk WHERE wr_order_number IS NULL GROUP BY d_year, ws_item_sk, ws_bill_customer_sk), cs AS (SELECT d_year AS cs_sold_year, cs_item_sk, cs_bill_customer_sk AS cs_customer_sk, SUM(cs_quantity) AS cs_qty, SUM(cs_wholesale_cost) AS cs_wc, SUM(cs_sales_price) AS cs_sp FROM catalog_sales LEFT JOIN catalog_returns ON cr_order_number = cs_order_number AND cs_item_sk = cr_item_sk JOIN date_dim ON cs_sold_date_sk = d_date_sk WHERE cr_order_number IS NULL GROUP BY d_year, cs_item_sk, cs_bill_customer_sk), ss AS (SELECT d_year AS ss_sold_year, ss_item_sk, ss_customer_sk, SUM(ss_quantity) AS ss_qty, SUM(ss_wholesale_cost) AS ss_wc, SUM(ss_sales_price) AS ss_sp FROM store_sales LEFT JOIN store_returns ON sr_ticket_number = ss_ticket_number AND ss_item_sk = sr_item_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE sr_ticket_number IS NULL GROUP BY d_year, ss_item_sk, ss_customer_sk)\nSELECT ss_sold_year, ss_item_sk, ss_customer_sk, ROUND((ss_qty * 1.00) / (COALESCE(ws_qty, 0) + COALESCE(cs_qty, 0)), 2) AS ratio, ss_qty AS store_qty, ss_wc AS store_wholesale_cost, ss_sp AS store_sales_price, COALESCE(ws_qty, 0) + COALESCE(cs_qty, 0) AS other_chan_qty, COALESCE(ws_wc, 0) + COALESCE(cs_wc, 0) AS other_chan_wholesale_cost, COALESCE(ws_sp, 0) + COALESCE(cs_sp, 0) AS other_chan_sales_price FROM filtered_ss LEFT JOIN filtered_ws ON (ws_sold_year = ss_sold_year AND ws_item_sk = ss_item_sk AND ws_customer_sk = ss_customer_sk) LEFT JOIN filtered_cs ON (cs_sold_year = ss_sold_year AND cs_item_sk = ss_item_sk AND cs_customer_sk = ss_customer_sk) WHERE (COALESCE(ws_qty, 0) > 0 OR COALESCE(cs_qty, 0) > 0) ORDER BY ss_sold_year, ss_item_sk, ss_customer_sk, ss_qty DESC, ss_wc DESC, ss_sp DESC, other_chan_qty, other_chan_wholesale_cost, other_chan_sales_price, ratio LIMIT 100",
        "transforms": [
          "pushdown"
        ],
        "principle": "pushdown",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk, d_year FROM date_dim WHERE d_year = 2000\",\n        \"filtered_ss\": \"SELECT d_year AS ss_sold_year, ss_item_sk, ss_customer_sk, SUM(ss_quantity) AS ss_qty, SUM(ss_wholesale_cost) AS ss_wc, SUM(ss_sales_price) AS ss_sp FROM store_sales LEFT JOIN store_returns ON sr_ticket_number = ss_ticket_number AND ss_item_sk = sr_item_sk JOIN filtered_dates ON ss_sold_date_sk = filtered_dates.d_date_sk WHERE sr_ticket_number IS NULL GROUP BY d_year, ss_item_sk, ss_customer_sk\",\n        \"filtered_ws\": \"SELECT d_year AS ws_sold_year, ws_item_sk, ws_bill_customer_sk AS ws_customer_sk, SUM(ws_quantity) AS ws_qty, SUM(ws_wholesale_cost) AS ws_wc, SUM(ws_sales_price) AS ws_sp FROM web_sales LEFT JOIN web_returns ON wr_order_number = ws_order_number AND ws_item_sk = wr_item_sk JOIN filtered_dates ON ws_sold_date_sk = filtered_dates.d_date_sk WHERE wr_order_number IS NULL GROUP BY d_year, ws_item_sk, ws_bill_customer_sk\",\n        \"filtered_cs\": \"SELECT d_year AS cs_sold_year, cs_item_sk, cs_bill_customer_sk AS cs_customer_sk, SUM(cs_quantity) AS cs_qty, SUM(cs_wholesale_cost) AS cs_wc, SUM(cs_sales_price) AS cs_sp FROM catalog_sales LEFT JOIN catalog_returns ON cr_order_number = cs_order_number AND cs_item_sk = cr_item_sk JOIN filtered_dates ON cs_sold_date_sk = filtered_dates.d_date_sk WHERE cr_order_number IS NULL GROUP BY d_year, cs_item_sk, cs_bill_customer_sk\",\n        \"main_query\": \"SELECT ss_sold_year, ss_item_sk, ss_customer_sk, ROUND((ss_qty * 1.00) / (COALESCE(ws_qty, 0) + COALESCE(cs_qty, 0)), 2) AS ratio, ss_qty AS store_qty, ss_wc AS store_wholesale_cost, ss_sp AS store_sales_price, COALESCE(ws_qty, 0) + COALESCE(cs_qty, 0) AS other_chan_qty, COALESCE(ws_wc, 0) + COALESCE(cs_wc, 0) AS other_chan_wholesale_cost, COALESCE(ws_sp, 0) + COALESCE(cs_sp, 0) AS other_chan_sales_price FROM filtered_ss LEFT JOIN filtered_ws ON (ws_sold_year = ss_sold_year AND ws_item_sk = ss_item_sk AND ws_customer_sk = ss_customer_sk) LEFT JOIN filtered_cs ON (cs_sold_year = ss_sold_year AND cs_item_sk = ss_item_sk AND cs_customer_sk = ss_customer_sk) WHERE (COALESCE(ws_qty, 0) > 0 OR COALESCE(cs_qty, 0) > 0) ORDER BY ss_sold_year, ss_item_sk, ss_customer_sk, ss_qty DESC, ss_wc DESC, ss_sp DESC, other_chan_qty, other_chan_wholesale_cost, other_chan_sales_price, ratio LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\", \n        \"same ordering\",\n        \"same column output\",\n        \"same grouping and aggregation\"\n      ],\n      \"expected_speedup\": \"4.0x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Isolated date_dim filtering into a single CTE for year=2000 and pushed it early into each fact table aggregation. This reduces three separate date_dim scans to one, and filters fact tables before expensive multi-way joins. The main query's ss_sold_year=2000 filter becomes redundant and was removed since filtered_ss only contains 2000 data.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 2,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 3.990981396657346,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 3.2744960897819717,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.896235456027462,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.4524960170164787,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_consolidation",
            "speedup": 1.014069061374518,
            "original_ms": 3005.2302273334135,
            "optimized_ms": 2963.5360566665745,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.01,
            "original_ms": 9002.15,
            "optimized_ms": 8933.98,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": []
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0026774836241643,
            "original_ms": 3005.2302273334135,
            "optimized_ms": 2997.2052593332896,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filter",
            "speedup": 1.0014782700758509,
            "original_ms": 3005.2302273334135,
            "optimized_ms": 3000.7942430002004,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.6564740937079243,
            "original_ms": 3533.40358399934,
            "optimized_ms": 5382.396072999351,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.47057944597765383,
            "original_ms": 3005.2302273334135,
            "optimized_ms": 6386.233510666595,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.3943031952256471,
            "original_ms": 2778.2026686672907,
            "optimized_ms": 7045.853805667018,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "single_pass_aggregation",
              "date_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q79": {
        "query_id": "q79",
        "status": "WIN",
        "best_speedup": 1.1785,
        "original_ms": 589.47,
        "optimized_ms": 500.21,
        "original_sql": "-- start query 79 in stream 0 using template query79.tpl\nselect\n  c_last_name,c_first_name,substr(s_city,1,30),ss_ticket_number,amt,profit\n  from\n   (select ss_ticket_number\n          ,ss_customer_sk\n          ,store.s_city\n          ,sum(ss_coupon_amt) amt\n          ,sum(ss_net_profit) profit\n    from store_sales,date_dim,store,household_demographics\n    where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n    and store_sales.ss_store_sk = store.s_store_sk  \n    and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n    and (household_demographics.hd_dep_count = 5 or household_demographics.hd_vehicle_count > 4)\n    and date_dim.d_dow = 1\n    and date_dim.d_year in (1998,1998+1,1998+2) \n    and store.s_number_employees between 200 and 295\n    group by ss_ticket_number,ss_customer_sk,ss_addr_sk,store.s_city) ms,customer\n    where ss_customer_sk = c_customer_sk\n order by c_last_name,c_first_name,substr(s_city,1,30), profit\n LIMIT 100;\n\n-- end query 79 in stream 0 using template query79.tpl\n",
        "optimized_sql": "WITH filtered_store AS (\n    SELECT s_store_sk, s_city\n    FROM store\n    WHERE s_number_employees BETWEEN 200 AND 295\n), filtered_date AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_dow = 1\n      AND d_year IN (1998, 1998 + 1, 1998 + 2)\n), filtered_hh AS (\n    SELECT hd_demo_sk\n    FROM household_demographics\n    WHERE hd_dep_count = 5 OR hd_vehicle_count > 4\n), sales_preagg AS (\n    SELECT\n        ss_ticket_number,\n        ss_customer_sk,\n        s_city,\n        SUM(ss_coupon_amt) AS amt,\n        SUM(ss_net_profit) AS profit\n    FROM store_sales\n    JOIN filtered_date ON ss_sold_date_sk = d_date_sk\n    JOIN filtered_store ON ss_store_sk = s_store_sk\n    WHERE ss_hdemo_sk IN (SELECT hd_demo_sk FROM filtered_hh)\n    GROUP BY ss_ticket_number, ss_customer_sk, s_city\n)\nSELECT\n    c_last_name,\n    c_first_name,\n    SUBSTRING(s_city, 1, 30),\n    ss_ticket_number,\n    amt,\n    profit\nFROM sales_preagg\nJOIN customer ON ss_customer_sk = c_customer_sk\nORDER BY\n    c_last_name,\n    c_first_name,\n    SUBSTRING(s_city, 1, 30),\n    profit\nLIMIT 100;",
        "transforms": [
          "date_cte_isolate",
          "multi_dimension_prefetch"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```sql\nWITH filtered_store AS (\n    SELECT s_store_sk, s_city\n    FROM store\n    WHERE s_number_employees BETWEEN 200 AND 295\n), filtered_date AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_dow = 1\n      AND d_year IN (1998, 1998 + 1, 1998 + 2)\n), filtered_hh AS (\n    SELECT hd_demo_sk\n    FROM household_demographics\n    WHERE hd_dep_count = 5 OR hd_vehicle_count > 4\n), sales_preagg AS (\n    SELECT\n        ss_ticket_number,\n        ss_customer_sk,\n        s_city,\n        SUM(ss_coupon_amt) AS amt,\n        SUM(ss_net_profit) AS profit\n    FROM store_sales\n    JOIN filtered_date ON ss_sold_date_sk = d_date_sk\n    JOIN filtered_store ON ss_store_sk = s_store_sk\n    WHERE ss_hdemo_sk IN (SELECT hd_demo_sk FROM filtered_hh)\n    GROUP BY ss_ticket_number, ss_customer_sk, s_city\n)\nSELECT\n    c_last_name,\n    c_first_name,\n    SUBSTRING(s_city, 1, 30),\n    ss_ticket_number,\n    amt,\n    profit\nFROM sales_preagg\nJOIN customer ON ss_customer_sk = c_customer_sk\nORDER BY\n    c_last_name,\n    c_first_name,\n    SUBSTRING(s_city, 1, 30),\n    profit\nLIMIT 100;\n```\n\n**Changes**: Removed unnecessary `ss_addr_sk` from GROUP BY, pre-filtered dimension tables into CTEs, converted OR condition to a semi-join using IN, and pre-aggregated store_sales after joining only with selective filters (date and store). This reduces the fact table join cardinality early.\n\n**Expected speedup**: 2-3\u00d7 from reduced grouping cardinality, early fact table filtering, and efficient semi-join for OR condition.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 6,
          "iteration": 2,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.2818589277542933,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.1784537748926223,
            "original_ms": 589.4692400003502,
            "optimized_ms": 500.20565299989056,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transforms",
            "speedup": 1.1323627963163856,
            "original_ms": 626.6595966665894,
            "optimized_ms": 553.4088533331669,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_pushdown",
            "speedup": 1.1158868699509712,
            "original_ms": 626.6595966665894,
            "optimized_ms": 561.579864000123,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.1052671983232194,
            "original_ms": 626.6595966665894,
            "optimized_ms": 566.9756576665653,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructuring",
            "speedup": 1.0948922778189294,
            "original_ms": 626.6595966665894,
            "optimized_ms": 572.3481746669373,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.0706791223434302,
            "original_ms": 635.1745016660667,
            "optimized_ms": 593.2445010002994,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.05,
            "original_ms": 939.75,
            "optimized_ms": 892.93,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.9362559294124884,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8495948891909539,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.7533865653910721,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q8": {
        "query_id": "q8",
        "status": "IMPROVED",
        "best_speedup": 1.0651,
        "original_ms": 711.81,
        "optimized_ms": 668.29,
        "original_sql": "-- start query 8 in stream 0 using template query8.tpl\nselect s_store_name\n      ,sum(ss_net_profit)\n from store_sales\n     ,date_dim\n     ,store,\n     (select ca_zip\n     from (\n      SELECT substr(ca_zip,1,5) ca_zip\n      FROM customer_address\n      WHERE substr(ca_zip,1,5) IN (\n                          '47602','16704','35863','28577','83910','36201',\n                          '58412','48162','28055','41419','80332',\n                          '38607','77817','24891','16226','18410',\n                          '21231','59345','13918','51089','20317',\n                          '17167','54585','67881','78366','47770',\n                          '18360','51717','73108','14440','21800',\n                          '89338','45859','65501','34948','25973',\n                          '73219','25333','17291','10374','18829',\n                          '60736','82620','41351','52094','19326',\n                          '25214','54207','40936','21814','79077',\n                          '25178','75742','77454','30621','89193',\n                          '27369','41232','48567','83041','71948',\n                          '37119','68341','14073','16891','62878',\n                          '49130','19833','24286','27700','40979',\n                          '50412','81504','94835','84844','71954',\n                          '39503','57649','18434','24987','12350',\n                          '86379','27413','44529','98569','16515',\n                          '27287','24255','21094','16005','56436',\n                          '91110','68293','56455','54558','10298',\n                          '83647','32754','27052','51766','19444',\n                          '13869','45645','94791','57631','20712',\n                          '37788','41807','46507','21727','71836',\n                          '81070','50632','88086','63991','20244',\n                          '31655','51782','29818','63792','68605',\n                          '94898','36430','57025','20601','82080',\n                          '33869','22728','35834','29086','92645',\n                          '98584','98072','11652','78093','57553',\n                          '43830','71144','53565','18700','90209',\n                          '71256','38353','54364','28571','96560',\n                          '57839','56355','50679','45266','84680',\n                          '34306','34972','48530','30106','15371',\n                          '92380','84247','92292','68852','13338',\n                          '34594','82602','70073','98069','85066',\n                          '47289','11686','98862','26217','47529',\n                          '63294','51793','35926','24227','14196',\n                          '24594','32489','99060','49472','43432',\n                          '49211','14312','88137','47369','56877',\n                          '20534','81755','15794','12318','21060',\n                          '73134','41255','63073','81003','73873',\n                          '66057','51184','51195','45676','92696',\n                          '70450','90669','98338','25264','38919',\n                          '59226','58581','60298','17895','19489',\n                          '52301','80846','95464','68770','51634',\n                          '19988','18367','18421','11618','67975',\n                          '25494','41352','95430','15734','62585',\n                          '97173','33773','10425','75675','53535',\n                          '17879','41967','12197','67998','79658',\n                          '59130','72592','14851','43933','68101',\n                          '50636','25717','71286','24660','58058',\n                          '72991','95042','15543','33122','69280',\n                          '11912','59386','27642','65177','17672',\n                          '33467','64592','36335','54010','18767',\n                          '63193','42361','49254','33113','33159',\n                          '36479','59080','11855','81963','31016',\n                          '49140','29392','41836','32958','53163',\n                          '13844','73146','23952','65148','93498',\n                          '14530','46131','58454','13376','13378',\n                          '83986','12320','17193','59852','46081',\n                          '98533','52389','13086','68843','31013',\n                          '13261','60560','13443','45533','83583',\n                          '11489','58218','19753','22911','25115',\n                          '86709','27156','32669','13123','51933',\n                          '39214','41331','66943','14155','69998',\n                          '49101','70070','35076','14242','73021',\n                          '59494','15782','29752','37914','74686',\n                          '83086','34473','15751','81084','49230',\n                          '91894','60624','17819','28810','63180',\n                          '56224','39459','55233','75752','43639',\n                          '55349','86057','62361','50788','31830',\n                          '58062','18218','85761','60083','45484',\n                          '21204','90229','70041','41162','35390',\n                          '16364','39500','68908','26689','52868',\n                          '81335','40146','11340','61527','61794',\n                          '71997','30415','59004','29450','58117',\n                          '69952','33562','83833','27385','61860',\n                          '96435','48333','23065','32961','84919',\n                          '61997','99132','22815','56600','68730',\n                          '48017','95694','32919','88217','27116',\n                          '28239','58032','18884','16791','21343',\n                          '97462','18569','75660','15475')\n     intersect\n      select ca_zip\n      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt\n            FROM customer_address, customer\n            WHERE ca_address_sk = c_current_addr_sk and\n                  c_preferred_cust_flag='Y'\n            group by ca_zip\n            having count(*) > 10)A1)A2) V1\n where ss_store_sk = s_store_sk\n  and ss_sold_date_sk = d_date_sk\n  and d_qoy = 2 and d_year = 1998\n  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))\n group by s_store_name\n order by s_store_name\n LIMIT 100;\n\n-- end query 8 in stream 0 using template query8.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_qoy = 2 \n      AND d_year = 1998\n),\neligible_zips AS (\n    SELECT DISTINCT SUBSTRING(ca_zip, 1, 5) AS ca_zip\n    FROM customer_address\n    WHERE SUBSTRING(ca_zip, 1, 5) IN (\n        '47602','16704','35863','28577','83910','36201','58412','48162','28055','41419',\n        '80332','38607','77817','24891','16226','18410','21231','59345','13918','51089',\n        '20317','17167','54585','67881','78366','47770','18360','51717','73108','14440',\n        '21800','89338','45859','65501','34948','25973','73219','25333','17291','10374',\n        '18829','60736','82620','41351','52094','19326','25214','54207','40936','21814',\n        '79077','25178','75742','77454','30621','89193','27369','41232','48567','83041',\n        '71948','37119','68341','14073','16891','62878','49130','19833','24286','27700',\n        '40979','50412','81504','94835','84844','71954','39503','57649','18434','24987',\n        '12350','86379','27413','44529','98569','16515','27287','24255','21094','16005',\n        '56436','91110','68293','56455','54558','10298','83647','32754','27052','51766',\n        '19444','13869','45645','94791','57631','20712','37788','41807','46507','21727',\n        '71836','81070','50632','88086','63991','20244','31655','51782','29818','63792',\n        '68605','94898','36430','57025','20601','82080','33869','22728','35834','29086',\n        '92645','98584','98072','11652','78093','57553','43830','71144','53565','18700',\n        '90209','71256','38353','54364','28571','96560','57839','56355','50679','45266',\n        '84680','34306','34972','48530','30106','15371','92380','84247','92292','68852',\n        '13338','34594','82602','70073','98069','85066','47289','11686','98862','26217',\n        '47529','63294','51793','35926','24227','14196','24594','32489','99060','49472',\n        '43432','49211','14312','88137','47369','56877','20534','81755','15794','12318',\n        '21060','73134','41255','63073','81003','73873','66057','51184','51195','45676',\n        '92696','70450','90669','98338','25264','38919','59226','58581','60298','17895',\n        '19489','52301','80846','95464','68770','51634','19988','18367','18421','11618',\n        '67975','25494','41352','95430','15734','62585','97173','33773','10425','75675',\n        '53535','17879','41967','12197','67998','79658','59130','72592','14851','43933',\n        '68101','50636','25717','71286','24660','58058','72991','95042','15543','33122',\n        '69280','11912','59386','27642','65177','17672','33467','64592','36335','54010',\n        '18767','63193','42361','49254','33113','33159','36479','59080','11855','81963',\n        '31016','49140','29392','41836','32958','53163','13844','73146','23952','65148',\n        '93498','14530','46131','58454','13376','13378','83986','12320','17193','59852',\n        '46081','98533','52389','13086','68843','31013','13261','60560','13443','45533',\n        '83583','11489','58218','19753','22911','25115','86709','27156','32669','13123',\n        '51933','39214','41331','66943','14155','69998','49101','70070','35076','14242',\n        '73021','59494','15782','29752','37914','74686','83086','34473','15751','81084',\n        '49230','91894','60624','17819','28810','63180','56224','39459','55233','75752',\n        '43639','55349','86057','62361','50788','31830','58062','18218','85761','60083',\n        '45484','21204','90229','70041','41162','35390','16364','39500','68908','26689',\n        '52868','81335','40146','11340','61527','61794','71997','30415','59004','29450',\n        '58117','69952','33562','83833','27385','61860','96435','48333','23065','32961',\n        '84919','61997','99132','22815','56600','68730','48017','95694','32919','88217',\n        '27116','28239','58032','18884','16791','21343','97462','18569','75660','15475'\n    )\n    INTERSECT\n    SELECT ca_zip\n    FROM (\n        SELECT SUBSTRING(ca_zip, 1, 5) AS ca_zip, COUNT(*) AS cnt\n        FROM customer_address\n        JOIN customer ON ca_address_sk = c_current_addr_sk\n        WHERE c_preferred_cust_flag = 'Y'\n        GROUP BY SUBSTRING(ca_zip, 1, 5)\n        HAVING COUNT(*) > 10\n    ) AS A1\n),\nfiltered_stores AS (\n    SELECT s_store_sk, s_store_name, s_zip\n    FROM store\n    WHERE EXISTS (\n        SELECT 1\n        FROM eligible_zips\n        WHERE SUBSTRING(store.s_zip, 1, 2) = SUBSTRING(eligible_zips.ca_zip, 1, 2)\n    )\n)\nSELECT\n    fs.s_store_name,\n    SUM(ss.ss_net_profit) AS \"SUM(ss_net_profit)\"\nFROM store_sales ss\nJOIN filtered_dates fd ON ss.ss_sold_date_sk = fd.d_date_sk\nJOIN filtered_stores fs ON ss.ss_store_sk = fs.s_store_sk\nGROUP BY fs.s_store_name\nORDER BY fs.s_store_name\nLIMIT 100;",
        "transforms": [
          "date_cte_isolate",
          "dimension_cte_isolate",
          "decorrelate",
          "multi_dimension_prefetch"
        ],
        "principle": "date_cte_isolate",
        "changes_description": "Isolated date dimension filtering into a CTE, created a CTE for eligible ZIP codes, and pre-filtered stores using an EXISTS subquery with the eligible ZIPs before joining with the fact table. This reduces the intermediate rows flowing into the main join.",
        "reasoning": "```sql\nWITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_qoy = 2 \n      AND d_year = 1998\n),\neligible_zips AS (\n    SELECT DISTINCT SUBSTRING(ca_zip, 1, 5) AS ca_zip\n    FROM customer_address\n    WHERE SUBSTRING(ca_zip, 1, 5) IN (\n        '47602','16704','35863','28577','83910','36201','58412','48162','28055','41419',\n        '80332','38607','77817','24891','16226','18410','21231','59345','13918','51089',\n        '20317','17167','54585','67881','78366','47770','18360','51717','73108','14440',\n        '21800','89338','45859','65501','34948','25973','73219','25333','17291','10374',\n        '18829','60736','82620','41351','52094','19326','25214','54207','40936','21814',\n        '79077','25178','75742','77454','30621','89193','27369','41232','48567','83041',\n        '71948','37119','68341','14073','16891','62878','49130','19833','24286','27700',\n        '40979','50412','81504','94835','84844','71954','39503','57649','18434','24987',\n        '12350','86379','27413','44529','98569','16515','27287','24255','21094','16005',\n        '56436','91110','68293','56455','54558','10298','83647','32754','27052','51766',\n        '19444','13869','45645','94791','57631','20712','37788','41807','46507','21727',\n        '71836','81070','50632','88086','63991','20244','31655','51782','29818','63792',\n        '68605','94898','36430','57025','20601','82080','33869','22728','35834','29086',\n        '92645','98584','98072','11652','78093','57553','43830','71144','53565','18700',\n        '90209','71256','38353','54364','28571','96560','57839','56355','50679','45266',\n        '84680','34306','34972','48530','30106','15371','92380','84247','92292','68852',\n        '13338','34594','82602','70073','98069','85066','47289','11686','98862','26217',\n        '47529','63294','51793','35926','24227','14196','24594','32489','99060','49472',\n        '43432','49211','14312','88137','47369','56877','20534','81755','15794','12318',\n        '21060','73134','41255','63073','81003','73873','66057','51184','51195','45676',\n        '92696','70450','90669','98338','25264','38919','59226','58581','60298','17895',\n        '19489','52301','80846','95464','68770','51634','19988','18367','18421','11618',\n        '67975','25494','41352','95430','15734','62585','97173','33773','10425','75675',\n        '53535','17879','41967','12197','67998','79658','59130','72592','14851','43933',\n        '68101','50636','25717','71286','24660','58058','72991','95042','15543','33122',\n        '69280','11912','59386','27642','65177','17672','33467','64592','36335','54010',\n        '18767','63193','42361','49254','33113','33159','36479','59080','11855','81963',\n        '31016','49140','29392','41836','32958','53163','13844','73146','23952','65148',\n        '93498','14530','46131','58454','13376','13378','83986','12320','17193','59852',\n        '46081','98533','52389','13086','68843','31013','13261','60560','13443','45533',\n        '83583','11489','58218','19753','22911','25115','86709','27156','32669','13123',\n        '51933','39214','41331','66943','14155','69998','49101','70070','35076','14242',\n        '73021','59494','15782','29752','37914','74686','83086','34473','15751','81084',\n        '49230','91894','60624','17819','28810','63180','56224','39459','55233','75752',\n        '43639','55349','86057','62361','50788','31830','58062','18218','85761','60083',\n        '45484','21204','90229','70041','41162','35390','16364','39500','68908','26689',\n        '52868','81335','40146','11340','61527','61794','71997','30415','59004','29450',\n        '58117','69952','33562','83833','27385','61860','96435','48333','23065','32961',\n        '84919','61997','99132','22815','56600','68730','48017','95694','32919','88217',\n        '27116','28239','58032','18884','16791','21343','97462','18569','75660','15475'\n    )\n    INTERSECT\n    SELECT ca_zip\n    FROM (\n        SELECT SUBSTRING(ca_zip, 1, 5) AS ca_zip, COUNT(*) AS cnt\n        FROM customer_address\n        JOIN customer ON ca_address_sk = c_current_addr_sk\n        WHERE c_preferred_cust_flag = 'Y'\n        GROUP BY SUBSTRING(ca_zip, 1, 5)\n        HAVING COUNT(*) > 10\n    ) AS A1\n),\nfiltered_stores AS (\n    SELECT s_store_sk, s_store_name, s_zip\n    FROM store\n    WHERE EXISTS (\n        SELECT 1\n        FROM eligible_zips\n        WHERE SUBSTRING(store.s_zip, 1, 2) = SUBSTRING(eligible_zips.ca_zip, 1, 2)\n    )\n)\nSELECT\n    fs.s_store_name,\n    SUM(ss.ss_net_profit) AS \"SUM(ss_net_profit)\"\nFROM store_sales ss\nJOIN filtered_dates fd ON ss.ss_sold_date_sk = fd.d_date_sk\nJOIN filtered_stores fs ON ss.ss_store_sk = fs.s_store_sk\nGROUP BY fs.s_store_name\nORDER BY fs.s_store_name\nLIMIT 100;\n```\n\nChanges: Isolated date dimension filtering into a CTE, created a CTE for eligible ZIP codes, and pre-filtered stores using an EXISTS subquery with the eligible ZIPs before joining with the fact table. This reduces the intermediate rows flowing into the main join.\n\nExpected speedup: 1.5-2x due to early pruning of dimensions and reduced hash table sizes for joins.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 2,
          "iteration": 0,
          "strategy": "moderate_dimension_isolation"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.372737206909019,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.1328760148026131,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0651307633266922,
            "original_ms": 711.8122013331837,
            "optimized_ms": 668.2862103334628,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.03,
            "original_ms": 704.29,
            "optimized_ms": 683.15,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": []
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.028828918795089,
            "original_ms": 791.5732573334632,
            "optimized_ms": 769.3925033333168,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filter_pushdown",
            "speedup": 1.0138982686885452,
            "original_ms": 711.8122013331837,
            "optimized_ms": 702.0548543335584,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8850459676182538,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.8745298983255388,
            "original_ms": 711.8122013331837,
            "optimized_ms": 813.9369536662949,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "intersect_to_exists",
              "or_to_union"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8270973679001975,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_cte_prefetch",
            "speedup": 0.7952378346037556,
            "original_ms": 711.8122013331837,
            "optimized_ms": 895.0934806665222,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0,
            "original_ms": 700.1299286657741,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "dimension_cte_isolate",
              "prefetch_fact_join"
            ]
          }
        ]
      },
      "q80": {
        "query_id": "q80",
        "status": "WIN",
        "best_speedup": 2.06,
        "original_ms": 1553.28,
        "optimized_ms": 754.02,
        "original_sql": "WITH ssr AS\n  (SELECT s_store_id AS store_id,\n          sum(ss_ext_sales_price) AS sales,\n          sum(coalesce(sr_return_amt, 0)) AS returns_,\n          sum(ss_net_profit - coalesce(sr_net_loss, 0)) AS profit\n   FROM store_sales\n   LEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk\n                                     AND ss_ticket_number = sr_ticket_number), date_dim,\n                                                                               store,\n                                                                               item,\n                                                                               promotion\n   WHERE ss_sold_date_sk = d_date_sk\n     AND d_date BETWEEN cast('2000-08-23' AS date) AND cast('2000-09-22' AS date)\n     AND ss_store_sk = s_store_sk\n     AND ss_item_sk = i_item_sk\n     AND i_current_price > 50\n     AND ss_promo_sk = p_promo_sk\n     AND p_channel_tv = 'N'\n   GROUP BY s_store_id) ,\n     csr AS\n  (SELECT cp_catalog_page_id AS catalog_page_id,\n          sum(cs_ext_sales_price) AS sales,\n          sum(coalesce(cr_return_amount, 0)) AS returns_,\n          sum(cs_net_profit - coalesce(cr_net_loss, 0)) AS profit\n   FROM catalog_sales\n   LEFT OUTER JOIN catalog_returns ON (cs_item_sk = cr_item_sk\n                                       AND cs_order_number = cr_order_number), date_dim,\n                                                                               catalog_page,\n                                                                               item,\n                                                                               promotion\n   WHERE cs_sold_date_sk = d_date_sk\n     AND d_date BETWEEN cast('2000-08-23' AS date) AND cast('2000-09-22' AS date)\n     AND cs_catalog_page_sk = cp_catalog_page_sk\n     AND cs_item_sk = i_item_sk\n     AND i_current_price > 50\n     AND cs_promo_sk = p_promo_sk\n     AND p_channel_tv = 'N'\n   GROUP BY cp_catalog_page_id) ,\n     wsr AS\n  (SELECT web_site_id,\n          sum(ws_ext_sales_price) AS sales,\n          sum(coalesce(wr_return_amt, 0)) AS returns_,\n          sum(ws_net_profit - coalesce(wr_net_loss, 0)) AS profit\n   FROM web_sales\n   LEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk\n                                   AND ws_order_number = wr_order_number), date_dim,\n                                                                           web_site,\n                                                                           item,\n                                                                           promotion\n   WHERE ws_sold_date_sk = d_date_sk\n     AND d_date BETWEEN cast('2000-08-23' AS date) AND cast('2000-09-22' AS date)\n     AND ws_web_site_sk = web_site_sk\n     AND ws_item_sk = i_item_sk\n     AND i_current_price > 50\n     AND ws_promo_sk = p_promo_sk\n     AND p_channel_tv = 'N'\n   GROUP BY web_site_id)\nSELECT channel ,\n       id ,\n       sum(sales) AS sales ,\n       sum(returns_) AS returns_ ,\n       sum(profit) AS profit\nFROM\n  (SELECT 'store channel' AS channel ,\n          concat('store', store_id) AS id ,\n          sales ,\n          returns_ ,\n          profit\n   FROM ssr\n   UNION ALL SELECT 'catalog channel' AS channel ,\n                    concat('catalog_page', catalog_page_id) AS id ,\n                    sales ,\n                    returns_ ,\n                    profit\n   FROM csr\n   UNION ALL SELECT 'web channel' AS channel ,\n                    concat('web_site', web_site_id) AS id ,\n                    sales ,\n                    returns_ ,\n                    profit\n   FROM wsr ) x\nGROUP BY ROLLUP (channel,\n                 id)\nORDER BY channel NULLS FIRST,\n         id NULLS FIRST\nLIMIT 100;\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('2000-08-23' AS DATE) AND CAST('2000-09-22' AS DATE)), filtered_items AS (SELECT i_item_sk FROM item WHERE i_current_price > 50), filtered_promotions AS (SELECT p_promo_sk FROM promotion WHERE p_channel_tv = 'N'), ssr AS (SELECT s_store_id AS store_id, SUM(ss_ext_sales_price) AS sales, SUM(COALESCE(sr_return_amt, 0)) AS returns_, SUM(ss_net_profit - COALESCE(sr_net_loss, 0)) AS profit FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN filtered_items ON ss_item_sk = i_item_sk JOIN filtered_promotions ON ss_promo_sk = p_promo_sk LEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number) JOIN store ON ss_store_sk = s_store_sk GROUP BY s_store_id), csr AS (SELECT cp_catalog_page_id AS catalog_page_id, SUM(cs_ext_sales_price) AS sales, SUM(COALESCE(cr_return_amount, 0)) AS returns_, SUM(cs_net_profit - COALESCE(cr_net_loss, 0)) AS profit FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN filtered_items ON cs_item_sk = i_item_sk JOIN filtered_promotions ON cs_promo_sk = p_promo_sk LEFT OUTER JOIN catalog_returns ON (cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number) JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk GROUP BY cp_catalog_page_id), wsr AS (SELECT web_site_id, SUM(ws_ext_sales_price) AS sales, SUM(COALESCE(wr_return_amt, 0)) AS returns_, SUM(ws_net_profit - COALESCE(wr_net_loss, 0)) AS profit FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk JOIN filtered_items ON ws_item_sk = i_item_sk JOIN filtered_promotions ON ws_promo_sk = p_promo_sk LEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number) JOIN web_site ON ws_web_site_sk = web_site_sk GROUP BY web_site_id)\nSELECT channel, id, SUM(sales) AS sales, SUM(returns_) AS returns_, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, CONCAT('store', store_id) AS id, sales, returns_, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, CONCAT('catalog_page', catalog_page_id) AS id, sales, returns_, profit FROM csr UNION ALL SELECT 'web channel' AS channel, CONCAT('web_site', web_site_id) AS id, sales, returns_, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel NULLS FIRST, id NULLS FIRST LIMIT 100",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "Looking at this query, I can see multiple opportunities for optimization. The main cost driver is the hash joins between large fact tables and dimension tables. The date_dim table is scanned three times with the same filter, and item/promotion tables are also scanned multiple times.\n\nHere's my optimized rewrite:\n\n```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('2000-08-23' AS DATE) AND CAST('2000-09-22' AS DATE)\",\n        \"filtered_items\": \"SELECT i_item_sk FROM item WHERE i_current_price > 50\",\n        \"filtered_promotions\": \"SELECT p_promo_sk FROM promotion WHERE p_channel_tv = 'N'\",\n        \"ssr\": \"SELECT s_store_id AS store_id, SUM(ss_ext_sales_price) AS sales, SUM(COALESCE(sr_return_amt, 0)) AS returns_, SUM(ss_net_profit - COALESCE(sr_net_loss, 0)) AS profit FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN filtered_items ON ss_item_sk = i_item_sk JOIN filtered_promotions ON ss_promo_sk = p_promo_sk LEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number) JOIN store ON ss_store_sk = s_store_sk GROUP BY s_store_id\",\n        \"csr\": \"SELECT cp_catalog_page_id AS catalog_page_id, SUM(cs_ext_sales_price) AS sales, SUM(COALESCE(cr_return_amount, 0)) AS returns_, SUM(cs_net_profit - COALESCE(cr_net_loss, 0)) AS profit FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN filtered_items ON cs_item_sk = i_item_sk JOIN filtered_promotions ON cs_promo_sk = p_promo_sk LEFT OUTER JOIN catalog_returns ON (cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number) JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk GROUP BY cp_catalog_page_id\",\n        \"wsr\": \"SELECT web_site_id, SUM(ws_ext_sales_price) AS sales, SUM(COALESCE(wr_return_amt, 0)) AS returns_, SUM(ws_net_profit - COALESCE(wr_net_loss, 0)) AS profit FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk JOIN filtered_items ON ws_item_sk = i_item_sk JOIN filtered_promotions ON ws_promo_sk = p_promo_sk LEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number) JOIN web_site ON ws_web_site_sk = web_site_sk GROUP BY web_site_id\",\n        \"main_query\": \"SELECT channel, id, SUM(sales) AS sales, SUM(returns_) AS returns_, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, CONCAT('store', store_id) AS id, sales, returns_, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, CONCAT('catalog_page', catalog_page_id) AS id, sales, returns_, profit FROM csr UNION ALL SELECT 'web channel' AS channel, CONCAT('web_site', web_site_id) AS id, sales, returns_, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel NULLS FIRST, id NULLS FIRST LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\",\n        \"same grouping and aggregation\"\n      ],\n      \"expected_speedup\": \"3.0x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Created dimension CTEs for date_dim, item, and promotion tables that are reused across all three channel queries (ssr, csr, wsr). This eliminates redundant scans of dimension tables (date_dim was scanned 3 times, item 3 times, promotion 3 times). The dimension CTEs are filtered early and joined only on surrogate keys, reducing the cardinality of fact table joins dramatically. Each fact table now joins with pre-filtered dimension CTEs, allowing much smaller hash tables and better join performance.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 2,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 2.120141167622575,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.9121582527989138,
            "original_ms": 796.3103236664514,
            "optimized_ms": 416.44582633307436,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 1.855037150982724,
            "original_ms": 796.3103236664514,
            "optimized_ms": 429.26920533348795,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.8183483771040496,
            "original_ms": 796.3103236664514,
            "optimized_ms": 437.9305603333705,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.6904592116068018,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.3792819616907084,
            "original_ms": 683.7657293332692,
            "optimized_ms": 495.74035499972524,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.1837518455973082,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_earlyfilter",
            "speedup": 1.0706832878996861,
            "original_ms": 796.3103236664514,
            "optimized_ms": 743.7403130000652,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.03,
            "original_ms": 1553.28,
            "optimized_ms": 1505.8,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.0082132779042419,
            "original_ms": 810.825238666439,
            "optimized_ms": 804.219956666202,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.7013458103690762,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q81": {
        "query_id": "q81",
        "status": "WIN",
        "best_speedup": 4.3813,
        "original_ms": 355.19,
        "optimized_ms": 81.07,
        "original_sql": "-- start query 81 in stream 0 using template query81.tpl\nwith customer_total_return as\n (select cr_returning_customer_sk as ctr_customer_sk\n        ,ca_state as ctr_state, \n \tsum(cr_return_amt_inc_tax) as ctr_total_return\n from catalog_returns\n     ,date_dim\n     ,customer_address\n where cr_returned_date_sk = d_date_sk \n   and d_year =2002\n   and cr_returning_addr_sk = ca_address_sk \n group by cr_returning_customer_sk\n         ,ca_state )\n  select c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name\n                   ,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset\n                  ,ca_location_type,ctr_total_return\n from customer_total_return ctr1\n     ,customer_address\n     ,customer\n where ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2\n \t\t\t  from customer_total_return ctr2 \n                  \t  where ctr1.ctr_state = ctr2.ctr_state)\n       and ca_address_sk = c_current_addr_sk\n       and ca_state = 'CA'\n       and ctr1.ctr_customer_sk = c_customer_sk\n order by c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name\n                   ,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset\n                  ,ca_location_type,ctr_total_return\n LIMIT 100;\n\n-- end query 81 in stream 0 using template query81.tpl\n",
        "optimized_sql": "WITH customer_total_return AS (SELECT cr.cr_returning_customer_sk AS ctr_customer_sk, ca.ca_state AS ctr_state, SUM(cr.cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns AS cr JOIN date_dim AS d ON cr.cr_returned_date_sk = d.d_date_sk JOIN customer_address AS ca ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN customer AS c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN customer_address AS ca_current ON c.c_current_addr_sk = ca_current.ca_address_sk WHERE d.d_year = 2002 AND ca_current.ca_state = 'CA' GROUP BY cr.cr_returning_customer_sk, ca.ca_state), state_avg_return AS (SELECT ctr_state, AVG(ctr_total_return) * 1.2 AS avg_return_threshold FROM customer_total_return GROUP BY ctr_state)\nSELECT c.c_customer_id, c.c_salutation, c.c_first_name, c.c_last_name, ca.ca_street_number, ca.ca_street_name, ca.ca_street_type, ca.ca_suite_number, ca.ca_city, ca.ca_county, ca.ca_state, ca.ca_zip, ca.ca_country, ca.ca_gmt_offset, ca.ca_location_type, ctr1.ctr_total_return FROM customer_total_return AS ctr1 JOIN state_avg_return AS sar ON ctr1.ctr_state = sar.ctr_state JOIN customer AS c ON ctr1.ctr_customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ctr1.ctr_total_return > sar.avg_return_threshold ORDER BY c.c_customer_id, c.c_salutation, c.c_first_name, c.c_last_name, ca.ca_street_number, ca.ca_street_name, ca.ca_street_type, ca.ca_suite_number, ca.ca_city, ca.ca_county, ca.ca_state, ca.ca_zip, ca.ca_country, ca.ca_gmt_offset, ca.ca_location_type, ctr1.ctr_total_return LIMIT 100",
        "transforms": [
          "decorrelate"
        ],
        "principle": "decorrelate",
        "changes_description": null,
        "reasoning": " ```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"decorrelate\",\n      \"nodes\": {\n        \"customer_total_return\": \"SELECT cr.cr_returning_customer_sk AS ctr_customer_sk, ca.ca_state AS ctr_state, SUM(cr.cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns cr JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN customer_address ca_current ON c.c_current_addr_sk = ca_current.ca_address_sk WHERE d.d_year = 2002 AND ca_current.ca_state = 'CA' GROUP BY cr.cr_returning_customer_sk, ca.ca_state\",\n        \"state_avg_return\": \"SELECT ctr_state, AVG(ctr_total_return) * 1.2 AS avg_return_threshold FROM customer_total_return GROUP BY ctr_state\",\n        \"main_query\": \"SELECT c.c_customer_id, c.c_salutation, c.c_first_name, c.c_last_name, ca.ca_street_number, ca.ca_street_name, ca.ca_street_type, ca.ca_suite_number, ca.ca_city, ca.ca_county, ca.ca_state, ca.ca_zip, ca.ca_country, ca.ca_gmt_offset, ca.ca_location_type, ctr1.ctr_total_return FROM customer_total_return ctr1 JOIN state_avg_return sar ON ctr1.ctr_state = sar.ctr_state JOIN customer c ON ctr1.ctr_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ctr1.ctr_total_return > sar.avg_return_threshold ORDER BY c.c_customer_id, c.c_salutation, c.c_first_name, c.c_last_name, ca.ca_street_number, ca.ca_street_name, ca.ca_street_type, ca.ca_suite_number, ca.ca_city, ca.ca_county, ca.ca_state, ca.ca_zip, ca.ca_country, ca.ca_gmt_offset, ca.ca_location_type, ctr1.ctr_total_return LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"output columns unchanged\",\n        \"same result rows\",\n        \"same ordering\"\n      ],\n      \"expected_speedup\": \"3.00x\",\n      \"risk\": \"low\"\n    }\n  ]\n}\n```",
        "provenance": {
          "source": "unvalidated",
          "run": "kimi_k2.5",
          "model": "kimi-k2.5",
          "worker_id": null,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 4.38,
            "original_ms": 355.19,
            "optimized_ms": 81.07,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 2.2771348098625417,
            "original_ms": 141.60481833308344,
            "optimized_ms": 62.18552266636834,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.2667200354869352,
            "original_ms": 212.80615933270988,
            "optimized_ms": 167.99778433354126,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_decorrelation_transform",
            "speedup": 0.9734916005389714,
            "original_ms": 141.60481833308344,
            "optimized_ms": 145.46074999998382,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.9665906734412679,
            "original_ms": 133.1058736674701,
            "optimized_ms": 137.7065569995466,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "dimension_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_predicate_pushdown",
            "speedup": 0.9424943442606806,
            "original_ms": 141.60481833308344,
            "optimized_ms": 150.24474066649418,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 0,
            "original_ms": 141.60481833308344,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q82": {
        "query_id": "q82",
        "status": "WIN",
        "best_speedup": 1.2058,
        "original_ms": 135.13,
        "optimized_ms": 112.07,
        "original_sql": "-- start query 82 in stream 0 using template query82.tpl\nselect i_item_id\n       ,i_item_desc\n       ,i_current_price\n from item, inventory, date_dim, store_sales\n where i_current_price between 17 and 17+30\n and inv_item_sk = i_item_sk\n and d_date_sk=inv_date_sk\n and d_date between cast('1999-07-09' as date) and (cast('1999-07-09' as date) + INTERVAL 60 DAY)\n and i_manufact_id in (639,169,138,339)\n and inv_quantity_on_hand between 100 and 500\n and ss_item_sk = i_item_sk\n group by i_item_id,i_item_desc,i_current_price\n order by i_item_id\n LIMIT 100;\n\n-- end query 82 in stream 0 using template query82.tpl\n",
        "optimized_sql": "WITH filtered_item AS (\n    SELECT \n        i_item_sk,\n        i_item_id,\n        i_item_desc,\n        i_current_price\n    FROM item\n    WHERE i_current_price BETWEEN 17 AND 17 + 30\n      AND i_manufact_id IN (639, 169, 138, 339)\n),\nfiltered_date AS (\n    SELECT \n        d_date_sk\n    FROM date_dim\n    WHERE d_date BETWEEN CAST('1999-07-09' AS DATE) \n                     AND (CAST('1999-07-09' AS DATE) + INTERVAL '60' DAY)\n),\nfiltered_inventory AS (\n    SELECT \n        inv_item_sk\n    FROM inventory\n    JOIN filtered_date ON d_date_sk = inv_date_sk\n    WHERE inv_quantity_on_hand BETWEEN 100 AND 500\n),\nitem_inventory AS (\n    SELECT \n        i_item_sk,\n        i_item_id,\n        i_item_desc,\n        i_current_price\n    FROM filtered_item\n    JOIN filtered_inventory ON inv_item_sk = i_item_sk\n)\nSELECT\n    i_item_id,\n    i_item_desc,\n    i_current_price\nFROM item_inventory\nWHERE EXISTS (\n    SELECT 1\n    FROM store_sales\n    WHERE ss_item_sk = i_item_sk\n)\nGROUP BY\n    i_item_id,\n    i_item_desc,\n    i_current_price\nORDER BY\n    i_item_id\nLIMIT 100;",
        "transforms": [
          "prefetch_fact_join",
          "multi_dimension_prefetch",
          "single_pass_aggregation"
        ],
        "principle": "prefetch_fact_join",
        "changes_description": null,
        "reasoning": "```sql\nWITH filtered_item AS (\n    SELECT \n        i_item_sk,\n        i_item_id,\n        i_item_desc,\n        i_current_price\n    FROM item\n    WHERE i_current_price BETWEEN 17 AND 17 + 30\n      AND i_manufact_id IN (639, 169, 138, 339)\n),\nfiltered_date AS (\n    SELECT \n        d_date_sk\n    FROM date_dim\n    WHERE d_date BETWEEN CAST('1999-07-09' AS DATE) \n                     AND (CAST('1999-07-09' AS DATE) + INTERVAL '60' DAY)\n),\nfiltered_inventory AS (\n    SELECT \n        inv_item_sk\n    FROM inventory\n    JOIN filtered_date ON d_date_sk = inv_date_sk\n    WHERE inv_quantity_on_hand BETWEEN 100 AND 500\n),\nitem_inventory AS (\n    SELECT \n        i_item_sk,\n        i_item_id,\n        i_item_desc,\n        i_current_price\n    FROM filtered_item\n    JOIN filtered_inventory ON inv_item_sk = i_item_sk\n)\nSELECT\n    i_item_id,\n    i_item_desc,\n    i_current_price\nFROM item_inventory\nWHERE EXISTS (\n    SELECT 1\n    FROM store_sales\n    WHERE ss_item_sk = i_item_sk\n)\nGROUP BY\n    i_item_id,\n    i_item_desc,\n    i_current_price\nORDER BY\n    i_item_id\nLIMIT 100;\n```\n\n**Changes**: Restructured using CTEs to pre-filter dimension tables (item, date_dim) and pre-join them with inventory before checking existence in store_sales via semi-join. This reduces intermediate result sizes by applying selective filters early.\n\n**Expected speedup**: ~2\u20133\u00d7 due to reduced fact table scanning and early filtering of dimensions before the final join.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": "aggressive_fact_prefetch"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_fact_prefetch",
            "speedup": 1.2057587102326572,
            "original_ms": 135.12936699983888,
            "optimized_ms": 112.06999033311149,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.1786867079531627,
            "original_ms": 136.25145533418012,
            "optimized_ms": 115.59598866673089,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.1389774037337557,
            "original_ms": 188.65703333297765,
            "optimized_ms": 165.63720466668505,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.97,
            "original_ms": 264.98,
            "optimized_ms": 271.77,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_predicate_pushdown",
            "speedup": 0.9483652617861749,
            "original_ms": 135.12936699983888,
            "optimized_ms": 142.4866266667474,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "dimension_prefilter_isolation",
            "speedup": 0.9479106388726983,
            "original_ms": 135.12936699983888,
            "optimized_ms": 142.5549640001312,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8176462519548504,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.7818647422421163,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.7494767353471375,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "structural_query_transform",
            "speedup": 0.4458549699028839,
            "original_ms": 135.12936699983888,
            "optimized_ms": 303.0791986669404,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q83": {
        "query_id": "q83",
        "status": "WIN",
        "best_speedup": 1.24,
        "original_ms": 75.64,
        "optimized_ms": 61.0,
        "original_sql": "-- start query 83 in stream 0 using template query83.tpl\nwith sr_items as\n (select i_item_id item_id,\n        sum(sr_return_quantity) sr_item_qty\n from store_returns,\n      item,\n      date_dim\n where sr_item_sk = i_item_sk\n and   d_date    in \n\t(select d_date\n\tfrom date_dim\n\twhere d_week_seq in \n\t\t(select d_week_seq\n\t\tfrom date_dim\n\t  where d_date in ('2001-06-06','2001-09-02','2001-11-11')))\n and   sr_returned_date_sk   = d_date_sk\n group by i_item_id),\n cr_items as\n (select i_item_id item_id,\n        sum(cr_return_quantity) cr_item_qty\n from catalog_returns,\n      item,\n      date_dim\n where cr_item_sk = i_item_sk\n and   d_date    in \n\t(select d_date\n\tfrom date_dim\n\twhere d_week_seq in \n\t\t(select d_week_seq\n\t\tfrom date_dim\n\t  where d_date in ('2001-06-06','2001-09-02','2001-11-11')))\n and   cr_returned_date_sk   = d_date_sk\n group by i_item_id),\n wr_items as\n (select i_item_id item_id,\n        sum(wr_return_quantity) wr_item_qty\n from web_returns,\n      item,\n      date_dim\n where wr_item_sk = i_item_sk\n and   d_date    in \n\t(select d_date\n\tfrom date_dim\n\twhere d_week_seq in \n\t\t(select d_week_seq\n\t\tfrom date_dim\n\t\twhere d_date in ('2001-06-06','2001-09-02','2001-11-11')))\n and   wr_returned_date_sk   = d_date_sk\n group by i_item_id)\n  select sr_items.item_id\n       ,sr_item_qty\n       ,sr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 sr_dev\n       ,cr_item_qty\n       ,cr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 cr_dev\n       ,wr_item_qty\n       ,wr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 wr_dev\n       ,(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 average\n from sr_items\n     ,cr_items\n     ,wr_items\n where sr_items.item_id=cr_items.item_id\n   and sr_items.item_id=wr_items.item_id \n order by sr_items.item_id\n         ,sr_item_qty\n LIMIT 100;\n\n-- end query 83 in stream 0 using template query83.tpl\n",
        "optimized_sql": "WITH target_week_dates AS (SELECT DISTINCT d_date_sk FROM date_dim WHERE d_week_seq IN (SELECT d_week_seq FROM date_dim WHERE d_date IN ('2001-06-06', '2001-09-02', '2001-11-11'))), sr_items AS (SELECT i_item_id AS item_id, SUM(sr_return_quantity) AS sr_item_qty FROM store_returns, item, target_week_dates WHERE sr_item_sk = i_item_sk AND sr_returned_date_sk = target_week_dates.d_date_sk GROUP BY i_item_id), cr_items AS (SELECT i_item_id AS item_id, SUM(cr_return_quantity) AS cr_item_qty FROM catalog_returns, item, target_week_dates WHERE cr_item_sk = i_item_sk AND cr_returned_date_sk = target_week_dates.d_date_sk GROUP BY i_item_id), wr_items AS (SELECT i_item_id AS item_id, SUM(wr_return_quantity) AS wr_item_qty FROM web_returns, item, date_dim WHERE wr_item_sk = i_item_sk AND d_date IN (SELECT d_date FROM date_dim WHERE d_week_seq IN (SELECT d_week_seq FROM date_dim WHERE d_date IN ('2001-06-06', '2001-09-02', '2001-11-11'))) AND wr_returned_date_sk = d_date_sk GROUP BY i_item_id) SELECT sr_items.item_id, sr_item_qty, sr_item_qty / (sr_item_qty + cr_item_qty + wr_item_qty) / 3.0 * 100 AS sr_dev, cr_item_qty, cr_item_qty / (sr_item_qty + cr_item_qty + wr_item_qty) / 3.0 * 100 AS cr_dev, wr_item_qty, wr_item_qty / (sr_item_qty + cr_item_qty + wr_item_qty) / 3.0 * 100 AS wr_dev, (sr_item_qty + cr_item_qty + wr_item_qty) / 3.0 AS average FROM sr_items, cr_items, wr_items WHERE sr_items.item_id = cr_items.item_id AND sr_items.item_id = wr_items.item_id ORDER BY sr_items.item_id, sr_item_qty LIMIT 100",
        "transforms": [
          "materialize_cte"
        ],
        "principle": "materialize_cte",
        "changes_description": null,
        "reasoning": " ```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"pushdown\",\n      \"nodes\": {\n        \"target_week_dates\": \"SELECT DISTINCT d_date_sk FROM date_dim WHERE d_week_seq IN (SELECT d_week_seq FROM date_dim WHERE d_date IN ('2001-06-06', '2001-09-02', '2001-11-11'))\",\n        \"sr_items\": \"SELECT i_item_id AS item_id, SUM(sr_return_quantity) AS sr_item_qty FROM store_returns, item, target_week_dates WHERE sr_item_sk = i_item_sk AND sr_returned_date_sk = target_week_dates.d_date_sk GROUP BY i_item_id\",\n        \"cr_items\": \"SELECT i_item_id AS item_id, SUM(cr_return_quantity) AS cr_item_qty FROM catalog_returns, item, target_week_dates WHERE cr_item_sk = i_item_sk AND cr_returned_date_sk = target_week_dates.d_date_sk GROUP BY i_item_id\",\n        \"main_query\": \"WITH target_week_dates AS (SELECT DISTINCT d_date_sk FROM date_dim WHERE d_week_seq IN (SELECT d_week_seq FROM date_dim WHERE d_date IN ('2001-06-06', '2001-09-02', '2001-11-11'))), sr_items AS (SELECT i_item_id AS item_id, SUM(sr_return_quantity) AS sr_item_qty FROM store_returns, item, target_week_dates WHERE sr_item_sk = i_item_sk AND sr_returned_date_sk = target_week_dates.d_date_sk GROUP BY i_item_id), cr_items AS (SELECT i_item_id AS item_id, SUM(cr_return_quantity) AS cr_item_qty FROM catalog_returns, item, target_week_dates WHERE cr_item_sk = i_item_sk AND cr_returned_date_sk = target_week_dates.d_date_sk GROUP BY i_item_id), wr_items AS (SELECT i_item_id AS item_id, SUM(wr_return_quantity) AS wr_item_qty FROM web_returns, item, date_dim WHERE wr_item_sk = i_item_sk AND d_date IN (SELECT d_date FROM date_dim WHERE d_week_seq IN (SELECT d_week_seq FROM date_dim WHERE d_date IN ('2001-06-06', '2001-09-02', '2001-11-11'))) AND wr_returned_date_sk = d_date_sk GROUP BY i_item_id) SELECT sr_items.item_id, sr_item_qty, sr_item_qty / (sr_item_qty + cr_item_qty + wr_item_qty) / 3.0 * 100 AS sr_dev, cr_item_qty, cr_item_qty / (sr_item_qty + cr_item_qty + wr_item_qty) / 3.0 * 100 AS cr_dev, wr_item_qty, wr_item_qty / (sr_item_qty + cr_item_qty + wr_item_qty) / 3.0 * 100 AS wr_dev, (sr_item_qty + cr_item_qty + wr_item_qty) / 3.0 AS average FROM sr_items, cr_items, wr_items WHERE sr_items.item_id = cr_items.item_id AND sr_items.item_id = wr_items.item_id ORDER BY sr_items.item_id, sr_item_qty LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"output columns unchanged for sr_items and cr_items\",\n        \"grain preserved (GROUP BY i_item_id)\",\n        \"same date filtering semantics\",\n        \"join predicates preserved\"\n      ],\n      \"expected_speedup\": \"2.5x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Eliminated redundant nested IN-subqueries across sr_items and cr_items by materializing the target week dates into a single CTE (target_week_dates). This reduces multiple scans of date_dim (originally 4+ scans per CTE) to a single scan plus efficient joins. The filter is pushed down to occur before the aggregation, reducing the input size for the GROUP BY operations.\"\n}\n```",
        "provenance": {
          "source": "Kimi",
          "run": "kimi_k2.5",
          "model": "kimi-k2.5",
          "worker_id": null,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.24,
            "original_ms": 75.64,
            "optimized_ms": 61.04,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_join_restructuring",
            "speedup": 1.2160281675930091,
            "original_ms": 56.246976333568455,
            "optimized_ms": 46.254665666917084,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.1878234463253028,
            "original_ms": 56.246976333568455,
            "optimized_ms": 47.35297699971852,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists",
              "union_cte_split"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.1448221267562546,
            "original_ms": 105.7991043326183,
            "optimized_ms": 92.4153210004685,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_reduction",
            "speedup": 1.0760047529617833,
            "original_ms": 56.246976333568455,
            "optimized_ms": 52.27391066697843,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0658254911376364,
            "original_ms": 56.246976333568455,
            "optimized_ms": 52.77315733322515,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.0098402778063522,
            "original_ms": 47.64047000026039,
            "optimized_ms": 47.17624266656154,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "single_pass_aggregation",
              "date_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q84": {
        "query_id": "q84",
        "status": "WIN",
        "best_speedup": 1.2554,
        "original_ms": 52.98,
        "optimized_ms": 42.2,
        "original_sql": "-- start query 84 in stream 0 using template query84.tpl\nselect c_customer_id as customer_id\n       , coalesce(c_last_name,'') || ', ' || coalesce(c_first_name,'') as customername\n from customer\n     ,customer_address\n     ,customer_demographics\n     ,household_demographics\n     ,income_band\n     ,store_returns\n where ca_city\t        =  'Oakwood'\n   and c_current_addr_sk = ca_address_sk\n   and ib_lower_bound   >=  5806\n   and ib_upper_bound   <=  5806 + 50000\n   and ib_income_band_sk = hd_income_band_sk\n   and cd_demo_sk = c_current_cdemo_sk\n   and hd_demo_sk = c_current_hdemo_sk\n   and sr_cdemo_sk = cd_demo_sk\n order by c_customer_id\n LIMIT 100;\n\n-- end query 84 in stream 0 using template query84.tpl\n",
        "optimized_sql": "WITH filtered_customer_address AS (\n    SELECT ca_address_sk\n    FROM customer_address\n    WHERE ca_city = 'Oakwood'\n), filtered_income_band AS (\n    SELECT ib_income_band_sk\n    FROM income_band\n    WHERE ib_lower_bound >= 5806\n      AND ib_upper_bound <= 5806 + 50000\n), filtered_household_demographics AS (\n    SELECT hd_demo_sk\n    FROM household_demographics\n    JOIN filtered_income_band ON hd_income_band_sk = ib_income_band_sk\n), eligible_customers AS (\n    SELECT \n        c_customer_id,\n        c_first_name,\n        c_last_name,\n        c_current_cdemo_sk\n    FROM customer\n    JOIN filtered_customer_address ON c_current_addr_sk = ca_address_sk\n    JOIN filtered_household_demographics ON hd_demo_sk = c_current_hdemo_sk\n)\nSELECT\n    c_customer_id AS customer_id,\n    COALESCE(c_last_name, '') || ', ' || COALESCE(c_first_name, '') AS customername\nFROM eligible_customers\nJOIN store_returns ON sr_cdemo_sk = c_current_cdemo_sk\nORDER BY c_customer_id\nLIMIT 100",
        "transforms": [
          "or_to_union",
          "intersect_to_exists",
          "multi_dimension_prefetch"
        ],
        "principle": "or_to_union",
        "changes_description": "Created filtered CTEs for highly selective dimensions (customer_address by city, income_band by bounds), then joined to customer and store_returns. Removed redundant customer_demographics bridge table by joining store_returns directly on c_current_cdemo_sk.",
        "reasoning": "```sql\nWITH filtered_customer_address AS (\n    SELECT ca_address_sk\n    FROM customer_address\n    WHERE ca_city = 'Oakwood'\n), filtered_income_band AS (\n    SELECT ib_income_band_sk\n    FROM income_band\n    WHERE ib_lower_bound >= 5806\n      AND ib_upper_bound <= 5806 + 50000\n), filtered_household_demographics AS (\n    SELECT hd_demo_sk\n    FROM household_demographics\n    JOIN filtered_income_band ON hd_income_band_sk = ib_income_band_sk\n), eligible_customers AS (\n    SELECT \n        c_customer_id,\n        c_first_name,\n        c_last_name,\n        c_current_cdemo_sk\n    FROM customer\n    JOIN filtered_customer_address ON c_current_addr_sk = ca_address_sk\n    JOIN filtered_household_demographics ON hd_demo_sk = c_current_hdemo_sk\n)\nSELECT\n    c_customer_id AS customer_id,\n    COALESCE(c_last_name, '') || ', ' || COALESCE(c_first_name, '') AS customername\nFROM eligible_customers\nJOIN store_returns ON sr_cdemo_sk = c_current_cdemo_sk\nORDER BY c_customer_id\nLIMIT 100\n```\n\n```\nChanges: Created filtered CTEs for highly selective dimensions (customer_address by city, income_band by bounds), then joined to customer and store_returns. Removed redundant customer_demographics bridge table by joining store_returns directly on c_current_cdemo_sk.\nExpected speedup: 1.8-2.2x from early filtering of dimension tables and reduced join complexity.\n```",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 4,
          "iteration": 0,
          "strategy": "structural_transform"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "structural_transform",
            "speedup": 1.255391547621421,
            "original_ms": 52.98335000012836,
            "optimized_ms": 42.20464133322821,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.2487192322686953,
            "original_ms": 105.77380566671006,
            "optimized_ms": 84.70583533380704,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.22,
            "original_ms": 80.06,
            "optimized_ms": 65.5,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_reduction",
            "speedup": 1.0290536753487551,
            "original_ms": 52.98335000012836,
            "optimized_ms": 51.48745033360077,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_fact_prefetch",
            "speedup": 1.0227400434561553,
            "original_ms": 52.98335000012836,
            "optimized_ms": 51.80529533299705,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "dimension_isolation_restructure",
            "speedup": 0.9953910808649673,
            "original_ms": 52.98335000012836,
            "optimized_ms": 53.22867666654929,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.2573111175772993,
            "original_ms": 51.682593333680416,
            "optimized_ms": 200.85643333368353,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q85": {
        "query_id": "q85",
        "status": "WIN",
        "best_speedup": 1.83,
        "original_ms": 459.82,
        "optimized_ms": 251.27,
        "original_sql": "\nSELECT SUBSTRING(r_reason_desc,1,20) ,\n       avg(ws_quantity) avg1,\n       avg(wr_refunded_cash) avg2,\n       avg(wr_fee)\nFROM web_sales,\n     web_returns,\n     web_page,\n     customer_demographics cd1,\n     customer_demographics cd2,\n     customer_address,\n     date_dim,\n     reason\nWHERE ws_web_page_sk = wp_web_page_sk\n  AND ws_item_sk = wr_item_sk\n  AND ws_order_number = wr_order_number\n  AND ws_sold_date_sk = d_date_sk\n  AND d_year = 2000\n  AND cd1.cd_demo_sk = wr_refunded_cdemo_sk\n  AND cd2.cd_demo_sk = wr_returning_cdemo_sk\n  AND ca_address_sk = wr_refunded_addr_sk\n  AND r_reason_sk = wr_reason_sk\n  AND ( ( cd1.cd_marital_status = 'M'\n         AND cd1.cd_marital_status = cd2.cd_marital_status\n         AND cd1.cd_education_status = 'Advanced Degree'\n         AND cd1.cd_education_status = cd2.cd_education_status\n         AND ws_sales_price BETWEEN 100.00 AND 150.00 )\n       OR ( cd1.cd_marital_status = 'S'\n           AND cd1.cd_marital_status = cd2.cd_marital_status\n           AND cd1.cd_education_status = 'College'\n           AND cd1.cd_education_status = cd2.cd_education_status\n           AND ws_sales_price BETWEEN 50.00 AND 100.00 )\n       OR ( cd1.cd_marital_status = 'W'\n           AND cd1.cd_marital_status = cd2.cd_marital_status\n           AND cd1.cd_education_status = '2 yr Degree'\n           AND cd1.cd_education_status = cd2.cd_education_status\n           AND ws_sales_price BETWEEN 150.00 AND 200.00 ) )\n  AND ( ( ca_country = 'United States'\n         AND ca_state IN ('IN',\n                          'OH',\n                          'NJ')\n         AND ws_net_profit BETWEEN 100 AND 200)\n       OR ( ca_country = 'United States'\n           AND ca_state IN ('WI',\n                            'CT',\n                            'KY')\n           AND ws_net_profit BETWEEN 150 AND 300)\n       OR ( ca_country = 'United States'\n           AND ca_state IN ('LA',\n                            'IA',\n                            'AR')\n           AND ws_net_profit BETWEEN 50 AND 250) )\nGROUP BY r_reason_desc\nORDER BY SUBSTRING(r_reason_desc,1,20) ,\n         avg(ws_quantity) ,\n         avg(wr_refunded_cash) ,\n         avg(wr_fee)\nLIMIT 100;\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2000), filtered_addresses AS (SELECT ca_address_sk, ca_country, ca_state FROM customer_address WHERE ca_country = 'United States' AND ca_state IN ('IN', 'OH', 'NJ', 'WI', 'CT', 'KY', 'LA', 'IA', 'AR'))\nSELECT SUBSTRING(r_reason_desc, 1, 20), AVG(ws_quantity) AS avg1, AVG(wr_refunded_cash) AS avg2, AVG(wr_fee) FROM web_sales JOIN web_returns ON ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number JOIN web_page ON ws_web_page_sk = wp_web_page_sk JOIN customer_demographics AS cd1 ON cd1.cd_demo_sk = wr_refunded_cdemo_sk JOIN customer_demographics AS cd2 ON cd2.cd_demo_sk = wr_returning_cdemo_sk JOIN filtered_addresses ON ca_address_sk = wr_refunded_addr_sk JOIN filtered_dates ON ws_sold_date_sk = d_date_sk JOIN reason ON r_reason_sk = wr_reason_sk WHERE ((cd1.cd_marital_status = 'M' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'Advanced Degree' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 100.00 AND 150.00) OR (cd1.cd_marital_status = 'S' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'College' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 50.00 AND 100.00) OR (cd1.cd_marital_status = 'W' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = '2 yr Degree' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 150.00 AND 200.00)) AND ((ca_country = 'United States' AND ca_state IN ('IN', 'OH', 'NJ') AND ws_net_profit BETWEEN 100 AND 200) OR (ca_country = 'United States' AND ca_state IN ('WI', 'CT', 'KY') AND ws_net_profit BETWEEN 150 AND 300) OR (ca_country = 'United States' AND ca_state IN ('LA', 'IA', 'AR') AND ws_net_profit BETWEEN 50 AND 250)) GROUP BY r_reason_desc ORDER BY SUBSTRING(r_reason_desc, 1, 20), AVG(ws_quantity), AVG(wr_refunded_cash), AVG(wr_fee) LIMIT 100",
        "transforms": [
          "or_to_union"
        ],
        "principle": "or_to_union",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_year = 2000\",\n        \"filtered_addresses\": \"SELECT ca_address_sk, ca_country, ca_state FROM customer_address WHERE ca_country = 'United States' AND ca_state IN ('IN', 'OH', 'NJ', 'WI', 'CT', 'KY', 'LA', 'IA', 'AR')\",\n        \"main_query\": \"SELECT SUBSTRING(r_reason_desc, 1, 20), AVG(ws_quantity) AS avg1, AVG(wr_refunded_cash) AS avg2, AVG(wr_fee) FROM web_sales JOIN web_returns ON ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number JOIN web_page ON ws_web_page_sk = wp_web_page_sk JOIN customer_demographics AS cd1 ON cd1.cd_demo_sk = wr_refunded_cdemo_sk JOIN customer_demographics AS cd2 ON cd2.cd_demo_sk = wr_returning_cdemo_sk JOIN filtered_addresses ON ca_address_sk = wr_refunded_addr_sk JOIN filtered_dates ON ws_sold_date_sk = d_date_sk JOIN reason ON r_reason_sk = wr_reason_sk WHERE ((cd1.cd_marital_status = 'M' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'Advanced Degree' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 100.00 AND 150.00) OR (cd1.cd_marital_status = 'S' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'College' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 50.00 AND 100.00) OR (cd1.cd_marital_status = 'W' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = '2 yr Degree' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 150.00 AND 200.00)) AND ((ca_country = 'United States' AND ca_state IN ('IN', 'OH', 'NJ') AND ws_net_profit BETWEEN 100 AND 200) OR (ca_country = 'United States' AND ca_state IN ('WI', 'CT', 'KY') AND ws_net_profit BETWEEN 150 AND 300) OR (ca_country = 'United States' AND ca_state IN ('LA', 'IA', 'AR') AND ws_net_profit BETWEEN 50 AND 250)) GROUP BY r_reason_desc ORDER BY SUBSTRING(r_reason_desc, 1, 20), AVG(ws_quantity), AVG(wr_refunded_cash), AVG(wr_fee) LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\"\n      ],\n      \"expected_speedup\": \"2.5x\",\n      \"risk\": \"low\"\n    },\n    {\n      \"id\": \"rs_02\",\n      \"transform\": \"or_to_union\",\n      \"nodes\": {\n        \"main_query\": \"SELECT SUBSTRING(r_reason_desc, 1, 20), AVG(ws_quantity) AS avg1, AVG(wr_refunded_cash) AS avg2, AVG(wr_fee) FROM (SELECT ws_quantity, wr_refunded_cash, wr_fee, r_reason_desc FROM web_sales JOIN web_returns ON ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number JOIN web_page ON ws_web_page_sk = wp_web_page_sk JOIN customer_demographics AS cd1 ON cd1.cd_demo_sk = wr_refunded_cdemo_sk JOIN customer_demographics AS cd2 ON cd2.cd_demo_sk = wr_returning_cdemo_sk JOIN customer_address ON ca_address_sk = wr_refunded_addr_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN reason ON r_reason_sk = wr_reason_sk WHERE d_year = 2000 AND cd1.cd_marital_status = 'M' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'Advanced Degree' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 100.00 AND 150.00 AND ca_country = 'United States' AND ca_state IN ('IN', 'OH', 'NJ') AND ws_net_profit BETWEEN 100 AND 200 UNION ALL SELECT ws_quantity, wr_refunded_cash, wr_fee, r_reason_desc FROM web_sales JOIN web_returns ON ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number JOIN web_page ON ws_web_page_sk = wp_web_page_sk JOIN customer_demographics AS cd1 ON cd1.cd_demo_sk = wr_refunded_cdemo_sk JOIN customer_demographics AS cd2 ON cd2.cd_demo_sk = wr_returning_cdemo_sk JOIN customer_address ON ca_address_sk = wr_refunded_addr_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN reason ON r_reason_sk = wr_reason_sk WHERE d_year = 2000 AND cd1.cd_marital_status = 'S' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'College' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 50.00 AND 100.00 AND ca_country = 'United States' AND ca_state IN ('WI', 'CT', 'KY') AND ws_net_profit BETWEEN 150 AND 300 UNION ALL SELECT ws_quantity, wr_refunded_cash, wr_fee, r_reason_desc FROM web_sales JOIN web_returns ON ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number JOIN web_page ON ws_web_page_sk = wp_web_page_sk JOIN customer_demographics AS cd1 ON cd1.cd_demo_sk = wr_refunded_cdemo_sk JOIN customer_demographics AS cd2 ON cd2.cd_demo_sk = wr_returning_cdemo_sk JOIN customer_address ON ca_address_sk = wr_refunded_addr_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN reason ON r_reason_sk = wr_reason_sk WHERE d_year = 2000 AND cd1.cd_marital_status = 'W' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = '2 yr Degree' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 150.00 AND 200.00 AND ca_country = 'United States' AND ca_state IN ('LA', 'IA', 'AR') AND ws_net_profit BETWEEN 50 AND 250) AS unioned_data GROUP BY r_reason_desc ORDER BY SUBSTRING(r_reason_desc, 1, 20), AVG(ws_quantity), AVG(wr_refunded_cash), AVG(wr_fee) LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\"\n      ],\n      \"expected_speedup\": \"3x\",\n      \"risk\": \"medium\"\n    }\n  ],\n  \"explanation\": \"Applied two independent transforms: 1) date_cte_isolate to filter date_dim early and reduce join size, and customer_address prefetch to push down state/country filters; 2) or_to_union to break complex OR conditions into 3 separate UNION ALL branches, allowing better predicate pushdown and index usage. These transforms can be applied independently or combined.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.8432973825324983,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.007476499528607,
            "original_ms": 233.70711799968072,
            "optimized_ms": 231.97277366671187,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.0,
            "original_ms": 459.82,
            "optimized_ms": 461.01,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": []
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.7881377313167035,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_or_union_transform",
            "speedup": 0.7775751402138628,
            "original_ms": 228.9760399999068,
            "optimized_ms": 294.47448633315315,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.33653637816090765,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.28046725155592,
            "original_ms": 321.3254713336937,
            "optimized_ms": 1145.679110666606,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filter_pushdown",
            "speedup": 0,
            "original_ms": 228.9760399999068,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0,
            "original_ms": 228.9760399999068,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "multi_date_range_cte",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_consolidation",
            "speedup": 0,
            "original_ms": 228.9760399999068,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q86": {
        "query_id": "q86",
        "status": "WIN",
        "best_speedup": 1.3893,
        "original_ms": 131.66,
        "optimized_ms": 94.77,
        "original_sql": "-- start query 86 in stream 0 using template query86.tpl\nselect  \n    sum(ws_net_paid) as total_sum\n   ,i_category\n   ,i_class\n   ,grouping(i_category)+grouping(i_class) as lochierarchy\n   ,rank() over (\n \tpartition by grouping(i_category)+grouping(i_class),\n \tcase when grouping(i_class) = 0 then i_category end \n \torder by sum(ws_net_paid) desc) as rank_within_parent\n from\n    web_sales\n   ,date_dim       d1\n   ,item\n where\n    d1.d_month_seq between 1224 and 1224+11\n and d1.d_date_sk = ws_sold_date_sk\n and i_item_sk  = ws_item_sk\n group by rollup(i_category,i_class)\n order by\n   lochierarchy desc,\n   case when lochierarchy = 0 then i_category end,\n   rank_within_parent\n LIMIT 100;\n\n-- end query 86 in stream 0 using template query86.tpl\n",
        "optimized_sql": "WITH base_aggregation AS (\n  SELECT\n    i.i_category,\n    i.i_class,\n    SUM(ws.ws_net_paid) AS total_sum\n  FROM web_sales ws\n  JOIN date_dim d1 ON d1.d_date_sk = ws.ws_sold_date_sk\n  JOIN item i ON i.i_item_sk = ws.ws_item_sk\n  WHERE d1.d_month_seq BETWEEN 1224 AND 1224 + 11\n  GROUP BY i.i_category, i.i_class\n),\nlevel_category_class AS (\n  SELECT\n    total_sum,\n    i_category,\n    i_class,\n    0 AS lochierarchy,\n    RANK() OVER (\n      PARTITION BY i_category\n      ORDER BY total_sum DESC\n    ) AS rank_within_parent\n  FROM base_aggregation\n),\nlevel_category_only AS (\n  SELECT\n    SUM(total_sum) AS total_sum,\n    i_category,\n    CAST(NULL AS VARCHAR) AS i_class,\n    1 AS lochierarchy,\n    RANK() OVER (\n      ORDER BY SUM(total_sum) DESC\n    ) AS rank_within_parent\n  FROM base_aggregation\n  GROUP BY i_category\n),\nlevel_total AS (\n  SELECT\n    SUM(total_sum) AS total_sum,\n    CAST(NULL AS VARCHAR) AS i_category,\n    CAST(NULL AS VARCHAR) AS i_class,\n    2 AS lochierarchy,\n    RANK() OVER (\n      ORDER BY SUM(total_sum) DESC\n    ) AS rank_within_parent\n  FROM base_aggregation\n),\ncombined AS (\n  SELECT * FROM level_category_class\n  UNION ALL\n  SELECT * FROM level_category_only\n  UNION ALL\n  SELECT * FROM level_total\n)\nSELECT\n  total_sum,\n  i_category,\n  i_class,\n  lochierarchy,\n  rank_within_parent\nFROM combined\nORDER BY\n  lochierarchy DESC,\n  CASE WHEN lochierarchy = 0 THEN i_category END,\n  rank_within_parent\nLIMIT 100",
        "transforms": [
          "prefetch_fact_join"
        ],
        "principle": "prefetch_fact_join",
        "changes_description": "Decomposed the ROLLUP into three explicit aggregation levels (category+class, category-only, total) using a pre-aggregated base CTE. Computed ranks separately for each level on smaller datasets, then combined with UNION ALL. This eliminates ROLLUP overhead and reduces window function computation cost.",
        "reasoning": "```sql\nWITH base_aggregation AS (\n  SELECT\n    i.i_category,\n    i.i_class,\n    SUM(ws.ws_net_paid) AS total_sum\n  FROM web_sales ws\n  JOIN date_dim d1 ON d1.d_date_sk = ws.ws_sold_date_sk\n  JOIN item i ON i.i_item_sk = ws.ws_item_sk\n  WHERE d1.d_month_seq BETWEEN 1224 AND 1224 + 11\n  GROUP BY i.i_category, i.i_class\n),\nlevel_category_class AS (\n  SELECT\n    total_sum,\n    i_category,\n    i_class,\n    0 AS lochierarchy,\n    RANK() OVER (\n      PARTITION BY i_category\n      ORDER BY total_sum DESC\n    ) AS rank_within_parent\n  FROM base_aggregation\n),\nlevel_category_only AS (\n  SELECT\n    SUM(total_sum) AS total_sum,\n    i_category,\n    CAST(NULL AS VARCHAR) AS i_class,\n    1 AS lochierarchy,\n    RANK() OVER (\n      ORDER BY SUM(total_sum) DESC\n    ) AS rank_within_parent\n  FROM base_aggregation\n  GROUP BY i_category\n),\nlevel_total AS (\n  SELECT\n    SUM(total_sum) AS total_sum,\n    CAST(NULL AS VARCHAR) AS i_category,\n    CAST(NULL AS VARCHAR) AS i_class,\n    2 AS lochierarchy,\n    RANK() OVER (\n      ORDER BY SUM(total_sum) DESC\n    ) AS rank_within_parent\n  FROM base_aggregation\n),\ncombined AS (\n  SELECT * FROM level_category_class\n  UNION ALL\n  SELECT * FROM level_category_only\n  UNION ALL\n  SELECT * FROM level_total\n)\nSELECT\n  total_sum,\n  i_category,\n  i_class,\n  lochierarchy,\n  rank_within_parent\nFROM combined\nORDER BY\n  lochierarchy DESC,\n  CASE WHEN lochierarchy = 0 THEN i_category END,\n  rank_within_parent\nLIMIT 100\n```\n\nChanges: Decomposed the ROLLUP into three explicit aggregation levels (category+class, category-only, total) using a pre-aggregated base CTE. Computed ranks separately for each level on smaller datasets, then combined with UNION ALL. This eliminates ROLLUP overhead and reduces window function computation cost.\n\nExpected speedup: 1.8\u20132.5x from eliminating ROLLUP complexity and computing ranks on smaller partitions.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 6,
          "iteration": 2,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.3892667039364608,
            "original_ms": 131.66279866709374,
            "optimized_ms": 94.77143466695755,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.2815615118789596,
            "original_ms": 240.86875566657304,
            "optimized_ms": 187.9494299992075,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 1.0776842369866626,
            "original_ms": 142.36958299989055,
            "optimized_ms": 132.1069550000781,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch",
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.032293967614903,
            "original_ms": 142.36958299989055,
            "optimized_ms": 137.91573666640033,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filter",
            "speedup": 0.9992785314692392,
            "original_ms": 142.36958299989055,
            "optimized_ms": 142.47237233303167,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0.9531877737919794,
            "original_ms": 142.36958299989055,
            "optimized_ms": 149.36152866660754,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.92,
            "original_ms": 235.86,
            "optimized_ms": 255.06,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q87": {
        "query_id": "q87",
        "status": "WIN",
        "best_speedup": 1.9134,
        "original_ms": 928.43,
        "optimized_ms": 485.21,
        "original_sql": "-- start query 87 in stream 0 using template query87.tpl\nselect count(*) \nfrom ((select distinct c_last_name, c_first_name, d_date\n       from store_sales, date_dim, customer\n       where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n         and store_sales.ss_customer_sk = customer.c_customer_sk\n         and d_month_seq between 1184 and 1184+11)\n       except\n      (select distinct c_last_name, c_first_name, d_date\n       from catalog_sales, date_dim, customer\n       where catalog_sales.cs_sold_date_sk = date_dim.d_date_sk\n         and catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n         and d_month_seq between 1184 and 1184+11)\n       except\n      (select distinct c_last_name, c_first_name, d_date\n       from web_sales, date_dim, customer\n       where web_sales.ws_sold_date_sk = date_dim.d_date_sk\n         and web_sales.ws_bill_customer_sk = customer.c_customer_sk\n         and d_month_seq between 1184 and 1184+11)\n) cool_cust\n;\n\n-- end query 87 in stream 0 using template query87.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (\n    SELECT d_date_sk, d_date\n    FROM date_dim\n    WHERE d_month_seq BETWEEN 1184 AND 1184 + 11\n),\nsales_combined AS (\n    -- Store sales\n    SELECT \n        'store' AS channel,\n        ss_customer_sk AS customer_sk,\n        d_date\n    FROM store_sales\n    JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk\n    UNION ALL\n    -- Catalog sales\n    SELECT \n        'catalog' AS channel,\n        cs_bill_customer_sk AS customer_sk,\n        d_date\n    FROM catalog_sales\n    JOIN filtered_dates ON catalog_sales.cs_sold_date_sk = filtered_dates.d_date_sk\n    UNION ALL\n    -- Web sales\n    SELECT \n        'web' AS channel,\n        ws_bill_customer_sk AS customer_sk,\n        d_date\n    FROM web_sales\n    JOIN filtered_dates ON web_sales.ws_sold_date_sk = filtered_dates.d_date_sk\n),\nchannel_presence AS (\n    SELECT \n        customer_sk,\n        d_date,\n        BOOL_OR(channel = 'store') AS has_store,\n        BOOL_OR(channel = 'catalog') AS has_catalog,\n        BOOL_OR(channel = 'web') AS has_web\n    FROM sales_combined\n    GROUP BY customer_sk, d_date\n),\nstore_only_customers AS (\n    SELECT \n        channel_presence.customer_sk,\n        channel_presence.d_date,\n        customer.c_last_name,\n        customer.c_first_name\n    FROM channel_presence\n    JOIN customer ON channel_presence.customer_sk = customer.c_customer_sk\n    WHERE has_store = TRUE\n      AND has_catalog = FALSE\n      AND has_web = FALSE\n)\nSELECT COUNT(*)\nFROM store_only_customers",
        "transforms": [
          "decorrelate",
          "date_cte_isolate",
          "dimension_cte_isolate"
        ],
        "principle": "decorrelate",
        "changes_description": "Replaced triple EXCEPT with single-pass aggregation by combining all sales channels, building channel presence bitmap per (customer,date), then filtering for store-only patterns before final join.",
        "reasoning": "```sql\nWITH filtered_dates AS (\n    SELECT d_date_sk, d_date\n    FROM date_dim\n    WHERE d_month_seq BETWEEN 1184 AND 1184 + 11\n),\nsales_combined AS (\n    -- Store sales\n    SELECT \n        'store' AS channel,\n        ss_customer_sk AS customer_sk,\n        d_date\n    FROM store_sales\n    JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk\n    UNION ALL\n    -- Catalog sales\n    SELECT \n        'catalog' AS channel,\n        cs_bill_customer_sk AS customer_sk,\n        d_date\n    FROM catalog_sales\n    JOIN filtered_dates ON catalog_sales.cs_sold_date_sk = filtered_dates.d_date_sk\n    UNION ALL\n    -- Web sales\n    SELECT \n        'web' AS channel,\n        ws_bill_customer_sk AS customer_sk,\n        d_date\n    FROM web_sales\n    JOIN filtered_dates ON web_sales.ws_sold_date_sk = filtered_dates.d_date_sk\n),\nchannel_presence AS (\n    SELECT \n        customer_sk,\n        d_date,\n        BOOL_OR(channel = 'store') AS has_store,\n        BOOL_OR(channel = 'catalog') AS has_catalog,\n        BOOL_OR(channel = 'web') AS has_web\n    FROM sales_combined\n    GROUP BY customer_sk, d_date\n),\nstore_only_customers AS (\n    SELECT \n        channel_presence.customer_sk,\n        channel_presence.d_date,\n        customer.c_last_name,\n        customer.c_first_name\n    FROM channel_presence\n    JOIN customer ON channel_presence.customer_sk = customer.c_customer_sk\n    WHERE has_store = TRUE\n      AND has_catalog = FALSE\n      AND has_web = FALSE\n)\nSELECT COUNT(*)\nFROM store_only_customers\n```\n\n```\nChanges: Replaced triple EXCEPT with single-pass aggregation by combining all sales channels, building channel presence bitmap per (customer,date), then filtering for store-only patterns before final join.\nExpected speedup: 2-3x by eliminating multiple DISTINCT operations and reducing fact table processing to one logical pass.\n```",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 6,
          "iteration": 2,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.913449880267697,
            "original_ms": 928.4254233328587,
            "optimized_ms": 485.21021266727377,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_prefilter",
            "speedup": 0.9627431185062998,
            "original_ms": 953.3073989999442,
            "optimized_ms": 990.1991306663452,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "early_filter",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_single_pass",
            "speedup": 0.9343497560793093,
            "original_ms": 953.3073989999442,
            "optimized_ms": 1020.2896643331769,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "single_pass_aggregation",
              "prefetch_fact_join",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.889148132665114,
            "original_ms": 1190.3833493342972,
            "optimized_ms": 1338.7908106675848,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.86,
            "original_ms": 1821.88,
            "optimized_ms": 2118.44,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_date_shared_dimension_cte",
            "speedup": 0.8421776677180195,
            "original_ms": 953.3073989999442,
            "optimized_ms": 1131.9552103335202,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_set_transform",
            "speedup": 0.7941431990172766,
            "original_ms": 953.3073989999442,
            "optimized_ms": 1200.4225436667184,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "intersect_to_exists",
              "or_to_union"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q88": {
        "query_id": "q88",
        "status": "WIN",
        "best_speedup": 6.2374,
        "original_ms": 1415.64,
        "optimized_ms": 226.96,
        "original_sql": "-- start query 88 in stream 0 using template query88.tpl\nselect  *\nfrom\n (select count(*) h8_30_to_9\n from store_sales, household_demographics , time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk   \n     and ss_hdemo_sk = household_demographics.hd_demo_sk \n     and ss_store_sk = s_store_sk\n     and time_dim.t_hour = 8\n     and time_dim.t_minute >= 30\n     and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n          (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n          (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2)) \n     and store.s_store_name = 'ese') s1,\n (select count(*) h9_to_9_30 \n from store_sales, household_demographics , time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n     and ss_hdemo_sk = household_demographics.hd_demo_sk\n     and ss_store_sk = s_store_sk \n     and time_dim.t_hour = 9 \n     and time_dim.t_minute < 30\n     and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n          (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n          (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n     and store.s_store_name = 'ese') s2,\n (select count(*) h9_30_to_10 \n from store_sales, household_demographics , time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n     and ss_hdemo_sk = household_demographics.hd_demo_sk\n     and ss_store_sk = s_store_sk\n     and time_dim.t_hour = 9\n     and time_dim.t_minute >= 30\n     and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n          (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n          (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n     and store.s_store_name = 'ese') s3,\n (select count(*) h10_to_10_30\n from store_sales, household_demographics , time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n     and ss_hdemo_sk = household_demographics.hd_demo_sk\n     and ss_store_sk = s_store_sk\n     and time_dim.t_hour = 10 \n     and time_dim.t_minute < 30\n     and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n          (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n          (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n     and store.s_store_name = 'ese') s4,\n (select count(*) h10_30_to_11\n from store_sales, household_demographics , time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n     and ss_hdemo_sk = household_demographics.hd_demo_sk\n     and ss_store_sk = s_store_sk\n     and time_dim.t_hour = 10 \n     and time_dim.t_minute >= 30\n     and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n          (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n          (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n     and store.s_store_name = 'ese') s5,\n (select count(*) h11_to_11_30\n from store_sales, household_demographics , time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n     and ss_hdemo_sk = household_demographics.hd_demo_sk\n     and ss_store_sk = s_store_sk \n     and time_dim.t_hour = 11\n     and time_dim.t_minute < 30\n     and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n          (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n          (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n     and store.s_store_name = 'ese') s6,\n (select count(*) h11_30_to_12\n from store_sales, household_demographics , time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n     and ss_hdemo_sk = household_demographics.hd_demo_sk\n     and ss_store_sk = s_store_sk\n     and time_dim.t_hour = 11\n     and time_dim.t_minute >= 30\n     and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n          (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n          (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n     and store.s_store_name = 'ese') s7,\n (select count(*) h12_to_12_30\n from store_sales, household_demographics , time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n     and ss_hdemo_sk = household_demographics.hd_demo_sk\n     and ss_store_sk = s_store_sk\n     and time_dim.t_hour = 12\n     and time_dim.t_minute < 30\n     and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n          (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n          (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n     and store.s_store_name = 'ese') s8\n;\n\n-- end query 88 in stream 0 using template query88.tpl\n",
        "optimized_sql": "WITH filtered_store AS (\n    SELECT s_store_sk\n    FROM store\n    WHERE s_store_name = 'ese'\n),\nfiltered_hd AS (\n    SELECT hd_demo_sk\n    FROM household_demographics\n    WHERE (\n        (hd_dep_count = -1 AND hd_vehicle_count <= -1 + 2)\n        OR (hd_dep_count = 4 AND hd_vehicle_count <= 4 + 2)\n        OR (hd_dep_count = 3 AND hd_vehicle_count <= 3 + 2)\n    )\n),\ntime_ranges AS (\n    SELECT \n        t_time_sk,\n        CASE \n            WHEN t_hour = 8 AND t_minute >= 30 THEN 1\n            WHEN t_hour = 9 AND t_minute < 30 THEN 2\n            WHEN t_hour = 9 AND t_minute >= 30 THEN 3\n            WHEN t_hour = 10 AND t_minute < 30 THEN 4\n            WHEN t_hour = 10 AND t_minute >= 30 THEN 5\n            WHEN t_hour = 11 AND t_minute < 30 THEN 6\n            WHEN t_hour = 11 AND t_minute >= 30 THEN 7\n            WHEN t_hour = 12 AND t_minute < 30 THEN 8\n        END AS time_window\n    FROM time_dim\n    WHERE (\n        (t_hour = 8 AND t_minute >= 30) OR\n        (t_hour = 9 AND t_minute < 30) OR\n        (t_hour = 9 AND t_minute >= 30) OR\n        (t_hour = 10 AND t_minute < 30) OR\n        (t_hour = 10 AND t_minute >= 30) OR\n        (t_hour = 11 AND t_minute < 30) OR\n        (t_hour = 11 AND t_minute >= 30) OR\n        (t_hour = 12 AND t_minute < 30)\n    )\n),\nsales_with_time AS (\n    SELECT \n        tr.time_window,\n        ss.ss_sold_time_sk\n    FROM store_sales ss\n    JOIN filtered_store fs ON ss.ss_store_sk = fs.s_store_sk\n    JOIN filtered_hd fhd ON ss.ss_hdemo_sk = fhd.hd_demo_sk\n    JOIN time_ranges tr ON ss.ss_sold_time_sk = tr.t_time_sk\n)\nSELECT \n    COUNT(CASE WHEN time_window = 1 THEN 1 END) AS h8_30_to_9,\n    COUNT(CASE WHEN time_window = 2 THEN 1 END) AS h9_to_9_30,\n    COUNT(CASE WHEN time_window = 3 THEN 1 END) AS h9_30_to_10,\n    COUNT(CASE WHEN time_window = 4 THEN 1 END) AS h10_to_10_30,\n    COUNT(CASE WHEN time_window = 5 THEN 1 END) AS h10_30_to_11,\n    COUNT(CASE WHEN time_window = 6 THEN 1 END) AS h11_to_11_30,\n    COUNT(CASE WHEN time_window = 7 THEN 1 END) AS h11_30_to_12,\n    COUNT(CASE WHEN time_window = 8 THEN 1 END) AS h12_to_12_30\nFROM sales_with_time;",
        "transforms": [
          "dimension_cte_isolate",
          "date_cte_isolate",
          "decorrelate",
          "single_pass_aggregation",
          "multi_dimension_prefetch"
        ],
        "principle": "dimension_cte_isolate",
        "changes_description": null,
        "reasoning": "```sql\nWITH filtered_store AS (\n    SELECT s_store_sk\n    FROM store\n    WHERE s_store_name = 'ese'\n),\nfiltered_hd AS (\n    SELECT hd_demo_sk\n    FROM household_demographics\n    WHERE (\n        (hd_dep_count = -1 AND hd_vehicle_count <= -1 + 2)\n        OR (hd_dep_count = 4 AND hd_vehicle_count <= 4 + 2)\n        OR (hd_dep_count = 3 AND hd_vehicle_count <= 3 + 2)\n    )\n),\ntime_ranges AS (\n    SELECT \n        t_time_sk,\n        CASE \n            WHEN t_hour = 8 AND t_minute >= 30 THEN 1\n            WHEN t_hour = 9 AND t_minute < 30 THEN 2\n            WHEN t_hour = 9 AND t_minute >= 30 THEN 3\n            WHEN t_hour = 10 AND t_minute < 30 THEN 4\n            WHEN t_hour = 10 AND t_minute >= 30 THEN 5\n            WHEN t_hour = 11 AND t_minute < 30 THEN 6\n            WHEN t_hour = 11 AND t_minute >= 30 THEN 7\n            WHEN t_hour = 12 AND t_minute < 30 THEN 8\n        END AS time_window\n    FROM time_dim\n    WHERE (\n        (t_hour = 8 AND t_minute >= 30) OR\n        (t_hour = 9 AND t_minute < 30) OR\n        (t_hour = 9 AND t_minute >= 30) OR\n        (t_hour = 10 AND t_minute < 30) OR\n        (t_hour = 10 AND t_minute >= 30) OR\n        (t_hour = 11 AND t_minute < 30) OR\n        (t_hour = 11 AND t_minute >= 30) OR\n        (t_hour = 12 AND t_minute < 30)\n    )\n),\nsales_with_time AS (\n    SELECT \n        tr.time_window,\n        ss.ss_sold_time_sk\n    FROM store_sales ss\n    JOIN filtered_store fs ON ss.ss_store_sk = fs.s_store_sk\n    JOIN filtered_hd fhd ON ss.ss_hdemo_sk = fhd.hd_demo_sk\n    JOIN time_ranges tr ON ss.ss_sold_time_sk = tr.t_time_sk\n)\nSELECT \n    COUNT(CASE WHEN time_window = 1 THEN 1 END) AS h8_30_to_9,\n    COUNT(CASE WHEN time_window = 2 THEN 1 END) AS h9_to_9_30,\n    COUNT(CASE WHEN time_window = 3 THEN 1 END) AS h9_30_to_10,\n    COUNT(CASE WHEN time_window = 4 THEN 1 END) AS h10_to_10_30,\n    COUNT(CASE WHEN time_window = 5 THEN 1 END) AS h10_30_to_11,\n    COUNT(CASE WHEN time_window = 6 THEN 1 END) AS h11_to_11_30,\n    COUNT(CASE WHEN time_window = 7 THEN 1 END) AS h11_30_to_12,\n    COUNT(CASE WHEN time_window = 8 THEN 1 END) AS h12_to_12_30\nFROM sales_with_time;\n```\n\n**Changes**: Isolated store and household_demographics filters into separate CTEs, combined all time windows into a single scan, and performed conditional aggregation in one pass instead of eight separate subqueries. This enables predicate pushdown and eliminates repeated joins.\n\n**Expected speedup**: 3-5x (single fact table scan instead of eight, small dimension hash tables, reduced join overhead)",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 2,
          "iteration": 0,
          "strategy": "moderate_dimension_isolation"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 6.871968943381523,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 6.2373882475101565,
            "original_ms": 1415.642576666869,
            "optimized_ms": 226.96079200007566,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 6.104619135142192,
            "original_ms": 1415.642576666869,
            "optimized_ms": 231.89695300031113,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "union_cte_split"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_single_pass_restructure",
            "speedup": 5.853343016368592,
            "original_ms": 1415.642576666869,
            "optimized_ms": 241.85197633354014,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "single_pass_aggregation",
              "prefetch_fact_join",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_reduction",
            "speedup": 5.269233093530888,
            "original_ms": 1415.642576666869,
            "optimized_ms": 268.6619763329266,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 5.247120914585514,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.99,
            "original_ms": 2069.88,
            "optimized_ms": 2098.75,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.7587368109353814,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "materialize_cte"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q89": {
        "query_id": "q89",
        "status": "IMPROVED",
        "best_speedup": 1.0643,
        "original_ms": 448.41,
        "optimized_ms": 421.32,
        "original_sql": "-- start query 89 in stream 0 using template query89.tpl\nselect *\nfrom(\nselect i_category, i_class, i_brand,\n       s_store_name, s_company_name,\n       d_moy,\n       sum(ss_sales_price) sum_sales,\n       avg(sum(ss_sales_price)) over\n         (partition by i_category, i_brand, s_store_name, s_company_name)\n         avg_monthly_sales\nfrom item, store_sales, date_dim, store\nwhere ss_item_sk = i_item_sk and\n      ss_sold_date_sk = d_date_sk and\n      ss_store_sk = s_store_sk and\n      d_year in (1999) and\n        ((i_category in ('Jewelry','Shoes','Electronics') and\n          i_class in ('semi-precious','athletic','portable')\n         )\n      or (i_category in ('Men','Music','Women') and\n          i_class in ('accessories','rock','maternity') \n        ))\ngroup by i_category, i_class, i_brand,\n         s_store_name, s_company_name, d_moy) tmp1\nwhere case when (avg_monthly_sales <> 0) then (abs(sum_sales - avg_monthly_sales) / avg_monthly_sales) else null end > 0.1\norder by sum_sales - avg_monthly_sales, s_store_name\n LIMIT 100;\n\n-- end query 89 in stream 0 using template query89.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (\n    SELECT d_date_sk, d_moy\n    FROM date_dim\n    WHERE d_year = 1999\n),\nfiltered_items AS (\n    SELECT i_item_sk, i_category, i_class, i_brand\n    FROM item\n    WHERE (i_category IN ('Jewelry', 'Shoes', 'Electronics') AND i_class IN ('semi-precious', 'athletic', 'portable'))\n       OR (i_category IN ('Men', 'Music', 'Women') AND i_class IN ('accessories', 'rock', 'maternity'))\n),\nfiltered_sales AS (\n    SELECT\n        i.i_category,\n        i.i_class,\n        i.i_brand,\n        s.s_store_name,\n        s.s_company_name,\n        d.d_moy,\n        SUM(ss.ss_sales_price) AS sum_sales\n    FROM store_sales ss\n    JOIN filtered_dates d ON ss.ss_sold_date_sk = d.d_date_sk\n    JOIN filtered_items i ON ss.ss_item_sk = i.i_item_sk\n    JOIN store s ON ss.ss_store_sk = s.s_store_sk\n    GROUP BY\n        i.i_category,\n        i.i_class,\n        i.i_brand,\n        s.s_store_name,\n        s.s_company_name,\n        d.d_moy\n),\nwindowed_sales AS (\n    SELECT\n        *,\n        AVG(sum_sales) OVER (\n            PARTITION BY i_category, i_brand, s_store_name, s_company_name\n        ) AS avg_monthly_sales\n    FROM filtered_sales\n)\nSELECT *\nFROM windowed_sales\nWHERE\n    CASE\n        WHEN avg_monthly_sales <> 0\n        THEN ABS(sum_sales - avg_monthly_sales) / avg_monthly_sales\n        ELSE NULL\n    END > 0.1\nORDER BY\n    sum_sales - avg_monthly_sales,\n    s_store_name\nLIMIT 100",
        "transforms": [
          "or_to_union",
          "date_cte_isolate",
          "multi_dimension_prefetch"
        ],
        "principle": "or_to_union",
        "changes_description": null,
        "reasoning": "```sql\nWITH filtered_dates AS (\n    SELECT d_date_sk, d_moy\n    FROM date_dim\n    WHERE d_year = 1999\n),\nfiltered_items AS (\n    SELECT i_item_sk, i_category, i_class, i_brand\n    FROM item\n    WHERE (i_category IN ('Jewelry', 'Shoes', 'Electronics') AND i_class IN ('semi-precious', 'athletic', 'portable'))\n       OR (i_category IN ('Men', 'Music', 'Women') AND i_class IN ('accessories', 'rock', 'maternity'))\n),\nfiltered_sales AS (\n    SELECT\n        i.i_category,\n        i.i_class,\n        i.i_brand,\n        s.s_store_name,\n        s.s_company_name,\n        d.d_moy,\n        SUM(ss.ss_sales_price) AS sum_sales\n    FROM store_sales ss\n    JOIN filtered_dates d ON ss.ss_sold_date_sk = d.d_date_sk\n    JOIN filtered_items i ON ss.ss_item_sk = i.i_item_sk\n    JOIN store s ON ss.ss_store_sk = s.s_store_sk\n    GROUP BY\n        i.i_category,\n        i.i_class,\n        i.i_brand,\n        s.s_store_name,\n        s.s_company_name,\n        d.d_moy\n),\nwindowed_sales AS (\n    SELECT\n        *,\n        AVG(sum_sales) OVER (\n            PARTITION BY i_category, i_brand, s_store_name, s_company_name\n        ) AS avg_monthly_sales\n    FROM filtered_sales\n)\nSELECT *\nFROM windowed_sales\nWHERE\n    CASE\n        WHEN avg_monthly_sales <> 0\n        THEN ABS(sum_sales - avg_monthly_sales) / avg_monthly_sales\n        ELSE NULL\n    END > 0.1\nORDER BY\n    sum_sales - avg_monthly_sales,\n    s_store_name\nLIMIT 100\n```\n\n**Changes**: \n1. Created three CTEs to isolate dimension filtering (`filtered_dates`, `filtered_items`) before joining with the large fact table (`store_sales`), reducing the data volume early.\n2. Converted implicit joins to explicit JOIN syntax for better optimizer control.\n3. Combined the OR conditions on `item` into a single CTE to avoid complex predicate evaluation during the main join.\n\n**Expected speedup**: 1.8-2.2x",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 5,
          "iteration": 1,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.0642929702301234,
            "original_ms": 448.4112599990719,
            "optimized_ms": 421.32314366608625,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate",
              "dimension_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.054092595750631,
            "original_ms": 360.0510146667754,
            "optimized_ms": 341.57437033354654,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructuring",
            "speedup": 1.04341229245386,
            "original_ms": 360.0510146667754,
            "optimized_ms": 345.07070433301124,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_filter_pushdown",
            "speedup": 0.9852041263688144,
            "original_ms": 360.0510146667754,
            "optimized_ms": 365.458289333219,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.9150122039319587,
            "original_ms": 337.5612306669306,
            "optimized_ms": 368.91445733332756,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.6,
            "original_ms": 521.03,
            "optimized_ms": 864.85,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0,
            "original_ms": 360.0510146667754,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "union_cte_split"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q9": {
        "query_id": "q9",
        "status": "WIN",
        "best_speedup": 4.47,
        "original_ms": 2206.17,
        "optimized_ms": 493.55,
        "original_sql": "\nSELECT CASE\n           WHEN\n                  (SELECT count(*)\n                   FROM store_sales\n                   WHERE ss_quantity BETWEEN 1 AND 20) > 74129 THEN\n                  (SELECT avg(ss_ext_discount_amt)\n                   FROM store_sales\n                   WHERE ss_quantity BETWEEN 1 AND 20)\n           ELSE\n                  (SELECT avg(ss_net_paid)\n                   FROM store_sales\n                   WHERE ss_quantity BETWEEN 1 AND 20)\n       END bucket1,\n       CASE\n           WHEN\n                  (SELECT count(*)\n                   FROM store_sales\n                   WHERE ss_quantity BETWEEN 21 AND 40) > 122840 THEN\n                  (SELECT avg(ss_ext_discount_amt)\n                   FROM store_sales\n                   WHERE ss_quantity BETWEEN 21 AND 40)\n           ELSE\n                  (SELECT avg(ss_net_paid)\n                   FROM store_sales\n                   WHERE ss_quantity BETWEEN 21 AND 40)\n       END bucket2,\n       CASE\n           WHEN\n                  (SELECT count(*)\n                   FROM store_sales\n                   WHERE ss_quantity BETWEEN 41 AND 60) > 56580 THEN\n                  (SELECT avg(ss_ext_discount_amt)\n                   FROM store_sales\n                   WHERE ss_quantity BETWEEN 41 AND 60)\n           ELSE\n                  (SELECT avg(ss_net_paid)\n                   FROM store_sales\n                   WHERE ss_quantity BETWEEN 41 AND 60)\n       END bucket3,\n       CASE\n           WHEN\n                  (SELECT count(*)\n                   FROM store_sales\n                   WHERE ss_quantity BETWEEN 61 AND 80) > 10097 THEN\n                  (SELECT avg(ss_ext_discount_amt)\n                   FROM store_sales\n                   WHERE ss_quantity BETWEEN 61 AND 80)\n           ELSE\n                  (SELECT avg(ss_net_paid)\n                   FROM store_sales\n                   WHERE ss_quantity BETWEEN 61 AND 80)\n       END bucket4,\n       CASE\n           WHEN\n                  (SELECT count(*)\n                   FROM store_sales\n                   WHERE ss_quantity BETWEEN 81 AND 100) > 165306 THEN\n                  (SELECT avg(ss_ext_discount_amt)\n                   FROM store_sales\n                   WHERE ss_quantity BETWEEN 81 AND 100)\n           ELSE\n                  (SELECT avg(ss_net_paid)\n                   FROM store_sales\n                   WHERE ss_quantity BETWEEN 81 AND 100)\n       END bucket5\nFROM reason\nWHERE r_reason_sk = 1 ;\n\n",
        "optimized_sql": "WITH quantity_1_20_stats AS (SELECT COUNT(*) AS cnt, AVG(ss_ext_discount_amt) AS avg_ext_discount_amt, AVG(ss_net_paid) AS avg_net_paid FROM store_sales WHERE ss_quantity BETWEEN 1 AND 20), quantity_21_40_stats AS (SELECT COUNT(*) AS cnt, AVG(ss_ext_discount_amt) AS avg_ext_discount_amt, AVG(ss_net_paid) AS avg_net_paid FROM store_sales WHERE ss_quantity BETWEEN 21 AND 40), quantity_41_60_stats AS (SELECT COUNT(*) AS cnt, AVG(ss_ext_discount_amt) AS avg_ext_discount_amt, AVG(ss_net_paid) AS avg_net_paid FROM store_sales WHERE ss_quantity BETWEEN 41 AND 60), quantity_61_80_stats AS (SELECT COUNT(*) AS cnt, AVG(ss_ext_discount_amt) AS avg_ext_discount_amt, AVG(ss_net_paid) AS avg_net_paid FROM store_sales WHERE ss_quantity BETWEEN 61 AND 80), quantity_81_100_stats AS (SELECT COUNT(*) AS cnt, AVG(ss_ext_discount_amt) AS avg_ext_discount_amt, AVG(ss_net_paid) AS avg_net_paid FROM store_sales WHERE ss_quantity BETWEEN 81 AND 100)\nSELECT CASE WHEN q1.cnt > 74129 THEN q1.avg_ext_discount_amt ELSE q1.avg_net_paid END AS bucket1, CASE WHEN q2.cnt > 122840 THEN q2.avg_ext_discount_amt ELSE q2.avg_net_paid END AS bucket2, CASE WHEN q3.cnt > 56580 THEN q3.avg_ext_discount_amt ELSE q3.avg_net_paid END AS bucket3, CASE WHEN q4.cnt > 10097 THEN q4.avg_ext_discount_amt ELSE q4.avg_net_paid END AS bucket4, CASE WHEN q5.cnt > 165306 THEN q5.avg_ext_discount_amt ELSE q5.avg_net_paid END AS bucket5 FROM reason CROSS JOIN quantity_1_20_stats AS q1 CROSS JOIN quantity_21_40_stats AS q2 CROSS JOIN quantity_41_60_stats AS q3 CROSS JOIN quantity_61_80_stats AS q4 CROSS JOIN quantity_81_100_stats AS q5 WHERE r_reason_sk = 1",
        "transforms": [
          "decorrelate",
          "materialize_cte"
        ],
        "principle": "decorrelate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"pushdown\",\n      \"nodes\": {\n        \"quantity_1_20_stats\": \"SELECT COUNT(*) AS cnt, AVG(ss_ext_discount_amt) AS avg_ext_discount_amt, AVG(ss_net_paid) AS avg_net_paid FROM store_sales WHERE ss_quantity BETWEEN 1 AND 20\",\n        \"quantity_21_40_stats\": \"SELECT COUNT(*) AS cnt, AVG(ss_ext_discount_amt) AS avg_ext_discount_amt, AVG(ss_net_paid) AS avg_net_paid FROM store_sales WHERE ss_quantity BETWEEN 21 AND 40\",\n        \"quantity_41_60_stats\": \"SELECT COUNT(*) AS cnt, AVG(ss_ext_discount_amt) AS avg_ext_discount_amt, AVG(ss_net_paid) AS avg_net_paid FROM store_sales WHERE ss_quantity BETWEEN 41 AND 60\",\n        \"quantity_61_80_stats\": \"SELECT COUNT(*) AS cnt, AVG(ss_ext_discount_amt) AS avg_ext_discount_amt, AVG(ss_net_paid) AS avg_net_paid FROM store_sales WHERE ss_quantity BETWEEN 61 AND 80\",\n        \"quantity_81_100_stats\": \"SELECT COUNT(*) AS cnt, AVG(ss_ext_discount_amt) AS avg_ext_discount_amt, AVG(ss_net_paid) AS avg_net_paid FROM store_sales WHERE ss_quantity BETWEEN 81 AND 100\",\n        \"main_query\": \"SELECT CASE WHEN q1.cnt > 74129 THEN q1.avg_ext_discount_amt ELSE q1.avg_net_paid END AS bucket1, CASE WHEN q2.cnt > 122840 THEN q2.avg_ext_discount_amt ELSE q2.avg_net_paid END AS bucket2, CASE WHEN q3.cnt > 56580 THEN q3.avg_ext_discount_amt ELSE q3.avg_net_paid END AS bucket3, CASE WHEN q4.cnt > 10097 THEN q4.avg_ext_discount_amt ELSE q4.avg_net_paid END AS bucket4, CASE WHEN q5.cnt > 165306 THEN q5.avg_ext_discount_amt ELSE q5.avg_net_paid END AS bucket5 FROM reason CROSS JOIN quantity_1_20_stats AS q1 CROSS JOIN quantity_21_40_stats AS q2 CROSS JOIN quantity_41_60_stats AS q3 CROSS JOIN quantity_61_80_stats AS q4 CROSS JOIN quantity_81_100_stats AS q5 WHERE r_reason_sk = 1\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same aggregation results\", \n        \"same output columns\"\n      ],\n      \"expected_speedup\": \"3.0x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Replaced 15 independent subqueries (3 per bucket: COUNT, AVG(ss_ext_discount_amt), AVG(ss_net_paid)) with 5 CTEs that compute all required statistics in one pass per quantity range. Each CTE scans store_sales once instead of three times, reducing total scans from 15 to 5. The cross joins preserve the single-row result due to reason.r_reason_sk = 1 filter.\"\n}\n```",
        "provenance": {
          "source": "Retry3W",
          "run": "retry_3worker_20260205_235909_details",
          "model": "deepseek-reasoner",
          "worker_id": 1,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.2125716696227813,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.49399900869131746,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_single_pass",
            "speedup": 0.4244512598812492,
            "original_ms": 1448.1168416665848,
            "optimized_ms": 3411.738822666545,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "pushdown",
              "single_pass_aggregation",
              "materialize_cte"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.42,
            "original_ms": 2206.17,
            "optimized_ms": 5249.17,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.40983809602022186,
            "original_ms": 1767.027501999716,
            "optimized_ms": 4311.525744333267,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.3929450197037755,
            "original_ms": 1448.1168416665848,
            "optimized_ms": 3685.291247000047,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.3918027956728135,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_prefilter",
            "speedup": 0.390444506762746,
            "original_ms": 1448.1168416665848,
            "optimized_ms": 3708.8928556665146,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_fact_prefetch",
            "speedup": 0.2737191519859518,
            "original_ms": 1448.1168416665848,
            "optimized_ms": 5290.520707666474,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0,
            "original_ms": 1366.0540163333887,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate"
            ]
          }
        ]
      },
      "q90": {
        "query_id": "q90",
        "status": "WIN",
        "best_speedup": 1.6391,
        "original_ms": 75.16,
        "optimized_ms": 45.85,
        "original_sql": "-- start query 90 in stream 0 using template query90.tpl\nselect cast(amc as decimal(15,4))/cast(pmc as decimal(15,4)) am_pm_ratio\n from ( select count(*) amc\n       from web_sales, household_demographics , time_dim, web_page\n       where ws_sold_time_sk = time_dim.t_time_sk\n         and ws_ship_hdemo_sk = household_demographics.hd_demo_sk\n         and ws_web_page_sk = web_page.wp_web_page_sk\n         and time_dim.t_hour between 10 and 10+1\n         and household_demographics.hd_dep_count = 2\n         and web_page.wp_char_count between 5000 and 5200) at_tbl,\n      ( select count(*) pmc\n       from web_sales, household_demographics , time_dim, web_page\n       where ws_sold_time_sk = time_dim.t_time_sk\n         and ws_ship_hdemo_sk = household_demographics.hd_demo_sk\n         and ws_web_page_sk = web_page.wp_web_page_sk\n         and time_dim.t_hour between 16 and 16+1\n         and household_demographics.hd_dep_count = 2\n         and web_page.wp_char_count between 5000 and 5200) pt\n order by am_pm_ratio\n LIMIT 100;\n\n-- end query 90 in stream 0 using template query90.tpl\n",
        "optimized_sql": "WITH filtered_hd AS (\n    SELECT hd_demo_sk\n    FROM household_demographics\n    WHERE hd_dep_count = 2\n),\nfiltered_wp AS (\n    SELECT wp_web_page_sk\n    FROM web_page\n    WHERE wp_char_count BETWEEN 5000 AND 5200\n),\nfiltered_time AS (\n    SELECT t_time_sk, t_hour\n    FROM time_dim\n    WHERE t_hour BETWEEN 10 AND 11\n       OR t_hour BETWEEN 16 AND 17\n),\njoined_sales AS (\n    SELECT t.t_hour\n    FROM web_sales ws\n    INNER JOIN filtered_hd hd ON ws.ws_ship_hdemo_sk = hd.hd_demo_sk\n    INNER JOIN filtered_wp wp ON ws.ws_web_page_sk = wp.wp_web_page_sk\n    INNER JOIN filtered_time t ON ws.ws_sold_time_sk = t.t_time_sk\n)\nSELECT\n    CAST(\n        COUNT(CASE WHEN t_hour BETWEEN 10 AND 11 THEN 1 END) AS DECIMAL(15,4)\n    ) / CAST(\n        COUNT(CASE WHEN t_hour BETWEEN 16 AND 17 THEN 1 END) AS DECIMAL(15,4)\n    ) AS am_pm_ratio\nFROM joined_sales\nORDER BY am_pm_ratio\nLIMIT 100;",
        "transforms": [
          "decorrelate",
          "single_pass_aggregation",
          "multi_dimension_prefetch"
        ],
        "principle": "decorrelate",
        "changes_description": "** Consolidated two separate scans of web_sales into a single scan with conditional aggregation. Created filtered CTEs for dimension tables to push filters early and build small hash tables before joining with the large fact table. Used explicit INNER JOIN syntax for better optimizer control.\n\n**Expected speedup:** ~2x from eliminating duplicate fact table scans and early dimension filtering.",
        "reasoning": "```sql\nWITH filtered_hd AS (\n    SELECT hd_demo_sk\n    FROM household_demographics\n    WHERE hd_dep_count = 2\n),\nfiltered_wp AS (\n    SELECT wp_web_page_sk\n    FROM web_page\n    WHERE wp_char_count BETWEEN 5000 AND 5200\n),\nfiltered_time AS (\n    SELECT t_time_sk, t_hour\n    FROM time_dim\n    WHERE t_hour BETWEEN 10 AND 11\n       OR t_hour BETWEEN 16 AND 17\n),\njoined_sales AS (\n    SELECT t.t_hour\n    FROM web_sales ws\n    INNER JOIN filtered_hd hd ON ws.ws_ship_hdemo_sk = hd.hd_demo_sk\n    INNER JOIN filtered_wp wp ON ws.ws_web_page_sk = wp.wp_web_page_sk\n    INNER JOIN filtered_time t ON ws.ws_sold_time_sk = t.t_time_sk\n)\nSELECT\n    CAST(\n        COUNT(CASE WHEN t_hour BETWEEN 10 AND 11 THEN 1 END) AS DECIMAL(15,4)\n    ) / CAST(\n        COUNT(CASE WHEN t_hour BETWEEN 16 AND 17 THEN 1 END) AS DECIMAL(15,4)\n    ) AS am_pm_ratio\nFROM joined_sales\nORDER BY am_pm_ratio\nLIMIT 100;\n```\n\n**Changes:** Consolidated two separate scans of web_sales into a single scan with conditional aggregation. Created filtered CTEs for dimension tables to push filters early and build small hash tables before joining with the large fact table. Used explicit INNER JOIN syntax for better optimizer control.\n\n**Expected speedup:** ~2x from eliminating duplicate fact table scans and early dimension filtering.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 6,
          "iteration": 2,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.639086389443567,
            "original_ms": 75.1574636657703,
            "optimized_ms": 45.85326566666481,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "single_pass_aggregation",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.57,
            "original_ms": 109.18,
            "optimized_ms": 69.59,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0204590557898017,
            "original_ms": 75.56296066680564,
            "optimized_ms": 74.04800833319314,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_filter_pushdown",
            "speedup": 0.977631024249919,
            "original_ms": 75.56296066680564,
            "optimized_ms": 77.29190133341035,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.11197021859295196,
            "original_ms": 151.17631499985387,
            "optimized_ms": 1350.1475383327488,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "single_pass_aggregation",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 0.06609768032897448,
            "original_ms": 75.56296066680564,
            "optimized_ms": 1143.2013996666985,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation",
              "multi_date_range_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0,
            "original_ms": 75.56296066680564,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q91": {
        "query_id": "q91",
        "status": "REGRESSION",
        "best_speedup": 0.89,
        "original_ms": 43.33,
        "optimized_ms": 48.69,
        "original_sql": "SELECT cc_call_center_id Call_Center,\n       cc_name Call_Center_Name,\n       cc_manager Manager,\n       sum(cr_net_loss) Returns_Loss\nFROM call_center,\n     catalog_returns,\n     date_dim,\n     customer,\n     customer_address,\n     customer_demographics,\n     household_demographics\nWHERE cr_call_center_sk = cc_call_center_sk\n  AND cr_returned_date_sk = d_date_sk\n  AND cr_returning_customer_sk= c_customer_sk\n  AND cd_demo_sk = c_current_cdemo_sk\n  AND hd_demo_sk = c_current_hdemo_sk\n  AND ca_address_sk = c_current_addr_sk\n  AND d_year = 1998\n  AND d_moy = 11\n  AND ((cd_marital_status = 'M'\n        AND cd_education_status = 'Unknown') or(cd_marital_status = 'W'\n                                                AND cd_education_status = 'Advanced Degree'))\n  AND hd_buy_potential LIKE 'Unknown%'\n  AND ca_gmt_offset = -7\nGROUP BY cc_call_center_id,\n         cc_name,\n         cc_manager,\n         cd_marital_status,\n         cd_education_status\nORDER BY sum(cr_net_loss) DESC;\n\n",
        "optimized_sql": "WITH filtered_date AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998 AND d_moy = 11), filtered_household AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential LIKE 'Unknown%'), filtered_address AS (SELECT ca_address_sk FROM customer_address WHERE ca_gmt_offset = -7), branch_m_unknown AS (SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, SUM(cr_net_loss) AS Returns_Loss FROM call_center JOIN catalog_returns ON cr_call_center_sk = cc_call_center_sk JOIN filtered_date ON cr_returned_date_sk = d_date_sk JOIN customer ON cr_returning_customer_sk = c_customer_sk JOIN filtered_address ON ca_address_sk = c_current_addr_sk JOIN filtered_household ON hd_demo_sk = c_current_hdemo_sk JOIN customer_demographics ON cd_demo_sk = c_current_cdemo_sk WHERE cd_marital_status = 'M' AND cd_education_status = 'Unknown' GROUP BY cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status), branch_w_advanced AS (SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, SUM(cr_net_loss) AS Returns_Loss FROM call_center JOIN catalog_returns ON cr_call_center_sk = cc_call_center_sk JOIN filtered_date ON cr_returned_date_sk = d_date_sk JOIN customer ON cr_returning_customer_sk = c_customer_sk JOIN filtered_address ON ca_address_sk = c_current_addr_sk JOIN filtered_household ON hd_demo_sk = c_current_hdemo_sk JOIN customer_demographics ON cd_demo_sk = c_current_cdemo_sk WHERE cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree' GROUP BY cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status)\nSELECT cc_call_center_id AS Call_Center, cc_name AS Call_Center_Name, cc_manager AS Manager, Returns_Loss FROM (SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, Returns_Loss FROM branch_m_unknown UNION ALL SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, Returns_Loss FROM branch_w_advanced) AS combined ORDER BY Returns_Loss DESC",
        "transforms": [
          "or_to_union"
        ],
        "principle": "or_to_union",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"or_to_union\",\n      \"nodes\": {\n        \"filtered_date\": \"SELECT d_date_sk FROM date_dim WHERE d_year = 1998 AND d_moy = 11\",\n        \"filtered_household\": \"SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential LIKE 'Unknown%'\",\n        \"filtered_address\": \"SELECT ca_address_sk FROM customer_address WHERE ca_gmt_offset = -7\",\n        \"branch_m_unknown\": \"SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, SUM(cr_net_loss) AS Returns_Loss FROM call_center JOIN catalog_returns ON cr_call_center_sk = cc_call_center_sk JOIN filtered_date ON cr_returned_date_sk = d_date_sk JOIN customer ON cr_returning_customer_sk = c_customer_sk JOIN filtered_address ON ca_address_sk = c_current_addr_sk JOIN filtered_household ON hd_demo_sk = c_current_hdemo_sk JOIN customer_demographics ON cd_demo_sk = c_current_cdemo_sk WHERE cd_marital_status = 'M' AND cd_education_status = 'Unknown' GROUP BY cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status\",\n        \"branch_w_advanced\": \"SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, SUM(cr_net_loss) AS Returns_Loss FROM call_center JOIN catalog_returns ON cr_call_center_sk = cc_call_center_sk JOIN filtered_date ON cr_returned_date_sk = d_date_sk JOIN customer ON cr_returning_customer_sk = c_customer_sk JOIN filtered_address ON ca_address_sk = c_current_addr_sk JOIN filtered_household ON hd_demo_sk = c_current_hdemo_sk JOIN customer_demographics ON cd_demo_sk = c_current_cdemo_sk WHERE cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree' GROUP BY cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status\",\n        \"main_query\": \"SELECT cc_call_center_id AS Call_Center, cc_name AS Call_Center_Name, cc_manager AS Manager, Returns_Loss FROM (SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, Returns_Loss FROM branch_m_unknown UNION ALL SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, Returns_Loss FROM branch_w_advanced) combined ORDER BY Returns_Loss DESC\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same aggregation results\",\n        \"same output columns\",\n        \"same ordering\"\n      ],\n      \"expected_speedup\": \"2.98x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Split OR condition into UNION ALL branches to allow independent filtering and index usage. Isolate dimension table filters (date, household_demographics, customer_address) into CTEs for early reduction. This eliminates the costly OR-driven full scan of customer_demographics.\"\n}\n```",
        "provenance": {
          "source": "Retry3W",
          "run": "retry_3worker_20260205_235909_details",
          "model": "deepseek-reasoner",
          "worker_id": 1,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filtering",
            "speedup": 0.8316176495897339,
            "original_ms": 34.069001667072975,
            "optimized_ms": 40.967146000184584,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0.8170364191969884,
            "original_ms": 34.069001667072975,
            "optimized_ms": 41.69826566673388,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.7657519193654806,
            "original_ms": 33.86108199993032,
            "optimized_ms": 44.21938900001502,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.7083860410181173,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structure_transformation",
            "speedup": 0.6991972575406339,
            "original_ms": 34.069001667072975,
            "optimized_ms": 48.72587999974106,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.66,
            "original_ms": 43.33,
            "optimized_ms": 65.16,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.6445628262488484,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.6229034870731597,
            "original_ms": 46.76759900030447,
            "optimized_ms": 75.08000833331607,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.5969994835077215,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructuring",
            "speedup": 0.02378715331595073,
            "original_ms": 34.069001667072975,
            "optimized_ms": 1432.2437500004526,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q92": {
        "query_id": "q92",
        "status": "WIN",
        "best_speedup": 1.8126,
        "original_ms": 70.73,
        "optimized_ms": 39.02,
        "original_sql": "-- start query 92 in stream 0 using template query92.tpl\nselect \n   sum(ws_ext_discount_amt)  as \"Excess Discount Amount\" \nfrom \n    web_sales \n   ,item \n   ,date_dim\nwhere\ni_manufact_id = 320\nand i_item_sk = ws_item_sk \nand d_date between '2002-02-26' and \n        (cast('2002-02-26' as date) + INTERVAL 90 DAY)\nand d_date_sk = ws_sold_date_sk \nand ws_ext_discount_amt  \n     > ( \n         SELECT \n            1.3 * avg(ws_ext_discount_amt) \n         FROM \n            web_sales \n           ,date_dim\n         WHERE \n              ws_item_sk = i_item_sk \n          and d_date between '2002-02-26' and\n                             (cast('2002-02-26' as date) + INTERVAL 90 DAY)\n          and d_date_sk = ws_sold_date_sk \n      ) \norder by sum(ws_ext_discount_amt)\n LIMIT 100;\n\n-- end query 92 in stream 0 using template query92.tpl\n",
        "optimized_sql": "SELECT\n  SUM(ws_ext_discount_amt) AS \"Excess Discount Amount\"\nFROM (\n  SELECT\n    ws.ws_ext_discount_amt,\n    AVG(ws.ws_ext_discount_amt) OVER (PARTITION BY ws.ws_item_sk) AS avg_disc\n  FROM web_sales ws\n  JOIN item i ON i.i_item_sk = ws.ws_item_sk\n  JOIN date_dim d ON d.d_date_sk = ws.ws_sold_date_sk\n  WHERE\n    i.i_manufact_id = 320\n    AND d.d_date BETWEEN '2002-02-26' AND (\n      CAST('2002-02-26' AS DATE) + INTERVAL '90' DAY\n    )\n) filtered\nWHERE\n  ws_ext_discount_amt > 1.3 * avg_disc\nORDER BY\n  SUM(ws_ext_discount_amt)\nLIMIT 100",
        "transforms": [
          "decorrelate"
        ],
        "principle": "decorrelate",
        "changes_description": null,
        "reasoning": "```sql\nSELECT\n  SUM(ws_ext_discount_amt) AS \"Excess Discount Amount\"\nFROM (\n  SELECT\n    ws.ws_ext_discount_amt,\n    AVG(ws.ws_ext_discount_amt) OVER (PARTITION BY ws.ws_item_sk) AS avg_disc\n  FROM web_sales ws\n  JOIN item i ON i.i_item_sk = ws.ws_item_sk\n  JOIN date_dim d ON d.d_date_sk = ws.ws_sold_date_sk\n  WHERE\n    i.i_manufact_id = 320\n    AND d.d_date BETWEEN '2002-02-26' AND (\n      CAST('2002-02-26' AS DATE) + INTERVAL '90' DAY\n    )\n) filtered\nWHERE\n  ws_ext_discount_amt > 1.3 * avg_disc\nORDER BY\n  SUM(ws_ext_discount_amt)\nLIMIT 100\n```\n\n**Changes**: Replaced correlated subquery with a window function that computes per-item average discount in a single pass over date- and manufacturer-filtered data, then filtered rows where discount exceeds 1.3x the computed average.\n\n**Expected speedup**: ~2\u20133x by eliminating repeated subquery executions and reducing data movement.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 6,
          "iteration": 2,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.8965187359786464,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.812632729371977,
            "original_ms": 70.73126799999348,
            "optimized_ms": 39.02129033303936,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.404574722612863,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.2595520306839465,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.95,
            "original_ms": 95.83,
            "optimized_ms": 100.99,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_pushdown",
            "speedup": 0.935124140382492,
            "original_ms": 68.51054133373206,
            "optimized_ms": 73.26357900001312,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0.9096366489530499,
            "original_ms": 68.51054133373206,
            "optimized_ms": 75.3163819999827,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 0.8719752750878528,
            "original_ms": 68.51054133373206,
            "optimized_ms": 78.569362332928,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_date_range_cte",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.813655431665708,
            "original_ms": 68.51054133373206,
            "optimized_ms": 84.20092666680527,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "single_pass_aggregation",
              "or_to_union"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.5763335929273611,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0,
            "original_ms": 93.23118700073489,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q93": {
        "query_id": "q93",
        "status": "WIN",
        "best_speedup": 2.73,
        "original_ms": 2860.55,
        "optimized_ms": 1047.82,
        "original_sql": "-- start query 93 in stream 0 using template query93.tpl\nselect ss_customer_sk\n            ,sum(act_sales) sumsales\n      from (select ss_item_sk\n                  ,ss_ticket_number\n                  ,ss_customer_sk\n                  ,case when sr_return_quantity is not null then (ss_quantity-sr_return_quantity)*ss_sales_price\n                                                            else (ss_quantity*ss_sales_price) end act_sales\n            from store_sales left outer join store_returns on (sr_item_sk = ss_item_sk\n                                                               and sr_ticket_number = ss_ticket_number)\n                ,reason\n            where sr_reason_sk = r_reason_sk\n              and r_reason_desc = 'duplicate purchase') t\n      group by ss_customer_sk\n      order by sumsales, ss_customer_sk\n LIMIT 100;\n\n-- end query 93 in stream 0 using template query93.tpl\n",
        "optimized_sql": "WITH filtered_reason AS (SELECT r_reason_sk FROM reason WHERE r_reason_desc = 'duplicate purchase'), filtered_returns AS (SELECT sr_item_sk, sr_ticket_number, sr_return_quantity FROM store_returns JOIN filtered_reason ON sr_reason_sk = r_reason_sk)\nSELECT ss_customer_sk, SUM(act_sales) AS sumsales FROM (SELECT ss.ss_customer_sk, CASE WHEN NOT fr.sr_return_quantity IS NULL THEN (ss.ss_quantity - fr.sr_return_quantity) * ss.ss_sales_price ELSE (ss.ss_quantity * ss.ss_sales_price) END AS act_sales FROM store_sales AS ss JOIN filtered_returns AS fr ON (fr.sr_item_sk = ss.ss_item_sk AND fr.sr_ticket_number = ss.ss_ticket_number)) AS t GROUP BY ss_customer_sk ORDER BY sumsales, ss_customer_sk LIMIT 100",
        "transforms": [
          "decorrelate"
        ],
        "principle": "decorrelate",
        "changes_description": null,
        "reasoning": " ```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"early_filter\",\n      \"nodes\": {\n        \"filtered_reason\": \"SELECT r_reason_sk FROM reason WHERE r_reason_desc = 'duplicate purchase'\",\n        \"filtered_returns\": \"SELECT sr_item_sk, sr_ticket_number, sr_return_quantity FROM store_returns JOIN filtered_reason ON sr_reason_sk = r_reason_sk\",\n        \"main_query\": \"SELECT ss_customer_sk, SUM(act_sales) AS sumsales FROM (SELECT ss.ss_customer_sk, CASE WHEN NOT fr.sr_return_quantity IS NULL THEN (ss.ss_quantity - fr.sr_return_quantity) * ss.ss_sales_price ELSE (ss.ss_quantity * ss.ss_sales_price) END AS act_sales FROM store_sales ss JOIN filtered_returns fr ON (fr.sr_item_sk = ss.ss_item_sk AND fr.sr_ticket_number = ss.ss_ticket_number)) AS t GROUP BY ss_customer_sk ORDER BY sumsales, ss_customer_sk LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"output columns unchanged\",\n        \"grain preserved at ss_customer_sk\",\n        \"required predicates preserved via pushdown to filtered_reason and filtered_returns\",\n        \"LEFT JOIN semantics preserved via equivalent INNER JOIN with pre-filtered returns\"\n      ],\n      \"expected_speedup\": \"2.8x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Pushed down the filter r_reason_desc = 'duplicate purchase' to the reason dimension table and pre-joined with store_returns to eliminate non-matching returns before joining with store_sales. This reduces the intermediate result set significantly. Also converted the LEFT JOIN to INNER JOIN since the WHERE clause in the original query effectively filtered out all non-matching rows (sales without 'duplicate purchase' returns). Removed unused columns ss_item_sk and ss_ticket_number from the subquery projection as they are not referenced by the outer query.\"\n}\n```",
        "provenance": {
          "source": "Kimi",
          "run": "kimi_k2.5",
          "model": "kimi-k2.5",
          "worker_id": null,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 2.73,
            "original_ms": 2860.55,
            "optimized_ms": 1047.4,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 2.017311322590128,
            "original_ms": 1051.2244026667759,
            "optimized_ms": 521.1017213332525,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "single_pass_aggregation",
              "dimension_cte_isolate",
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filter_restructure",
            "speedup": 0.8129970277935269,
            "original_ms": 1031.8601766672753,
            "optimized_ms": 1269.2053493328785,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.8014895834850009,
            "original_ms": 1258.7143550002413,
            "optimized_ms": 1570.4687633333378,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.7988912344999219,
            "original_ms": 1031.8601766672753,
            "optimized_ms": 1291.6153440000926,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 0.7673710605756556,
            "original_ms": 1031.8601766672753,
            "optimized_ms": 1344.6691303333864,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0,
            "original_ms": 1031.8601766672753,
            "optimized_ms": 0,
            "status": "error",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate",
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q94": {
        "query_id": "q94",
        "status": "WIN",
        "best_speedup": 1.739,
        "original_ms": 174.95,
        "optimized_ms": 100.6,
        "original_sql": "-- start query 94 in stream 0 using template query94.tpl\nselect \n   count(distinct ws_order_number) as \"order count\"\n  ,sum(ws_ext_ship_cost) as \"total shipping cost\"\n  ,sum(ws_net_profit) as \"total net profit\"\nfrom\n   web_sales ws1\n  ,date_dim\n  ,customer_address\n  ,web_site\nwhere\n    d_date between '2000-2-01' and \n           (cast('2000-2-01' as date) + INTERVAL 60 DAY)\nand ws1.ws_ship_date_sk = d_date_sk\nand ws1.ws_ship_addr_sk = ca_address_sk\nand ca_state = 'OK'\nand ws1.ws_web_site_sk = web_site_sk\nand web_company_name = 'pri'\nand exists (select *\n            from web_sales ws2\n            where ws1.ws_order_number = ws2.ws_order_number\n              and ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk)\nand not exists(select *\n               from web_returns wr1\n               where ws1.ws_order_number = wr1.wr_order_number)\norder by count(distinct ws_order_number)\n LIMIT 100;\n\n-- end query 94 in stream 0 using template query94.tpl\n",
        "optimized_sql": "WITH filtered_dims AS (\n    SELECT \n        d_date_sk,\n        d_date\n    FROM date_dim\n    WHERE d_date BETWEEN '2000-2-01' AND (\n        CAST('2000-2-01' AS DATE) + INTERVAL '60' DAY\n    )\n),\nfiltered_address AS (\n    SELECT \n        ca_address_sk\n    FROM customer_address\n    WHERE ca_state = 'OK'\n),\nfiltered_web_site AS (\n    SELECT \n        web_site_sk\n    FROM web_site\n    WHERE web_company_name = 'pri'\n)\nSELECT\n    COUNT(DISTINCT ws_order_number) AS \"order count\",\n    SUM(ws_ext_ship_cost) AS \"total shipping cost\",\n    SUM(ws_net_profit) AS \"total net profit\"\nFROM web_sales AS ws1\nJOIN filtered_dims ON ws1.ws_ship_date_sk = filtered_dims.d_date_sk\nJOIN filtered_address ON ws1.ws_ship_addr_sk = filtered_address.ca_address_sk\nJOIN filtered_web_site ON ws1.ws_web_site_sk = filtered_web_site.web_site_sk\nWHERE EXISTS(\n    SELECT 1\n    FROM web_sales AS ws2\n    WHERE ws1.ws_order_number = ws2.ws_order_number\n      AND ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk\n)\nAND NOT EXISTS(\n    SELECT 1\n    FROM web_returns AS wr1\n    WHERE ws1.ws_order_number = wr1.wr_order_number\n)\nORDER BY\n    COUNT(DISTINCT ws_order_number)\nLIMIT 100",
        "transforms": [
          "prefetch_fact_join"
        ],
        "principle": "prefetch_fact_join",
        "changes_description": null,
        "reasoning": "```sql\nWITH filtered_dims AS (\n    SELECT \n        d_date_sk,\n        d_date\n    FROM date_dim\n    WHERE d_date BETWEEN '2000-2-01' AND (\n        CAST('2000-2-01' AS DATE) + INTERVAL '60' DAY\n    )\n),\nfiltered_address AS (\n    SELECT \n        ca_address_sk\n    FROM customer_address\n    WHERE ca_state = 'OK'\n),\nfiltered_web_site AS (\n    SELECT \n        web_site_sk\n    FROM web_site\n    WHERE web_company_name = 'pri'\n)\nSELECT\n    COUNT(DISTINCT ws_order_number) AS \"order count\",\n    SUM(ws_ext_ship_cost) AS \"total shipping cost\",\n    SUM(ws_net_profit) AS \"total net profit\"\nFROM web_sales AS ws1\nJOIN filtered_dims ON ws1.ws_ship_date_sk = filtered_dims.d_date_sk\nJOIN filtered_address ON ws1.ws_ship_addr_sk = filtered_address.ca_address_sk\nJOIN filtered_web_site ON ws1.ws_web_site_sk = filtered_web_site.web_site_sk\nWHERE EXISTS(\n    SELECT 1\n    FROM web_sales AS ws2\n    WHERE ws1.ws_order_number = ws2.ws_order_number\n      AND ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk\n)\nAND NOT EXISTS(\n    SELECT 1\n    FROM web_returns AS wr1\n    WHERE ws1.ws_order_number = wr1.wr_order_number\n)\nORDER BY\n    COUNT(DISTINCT ws_order_number)\nLIMIT 100\n```\n\n**Changes**: Isolated dimension table filters into separate CTEs to push filtering early and reduce join cardinality before applying the expensive EXISTS/NOT EXISTS conditions. Preserved original EXISTS/NOT EXISTS semantics exactly.\n\n**Expected speedup**: 1.5-2.0x by reducing the working set before the correlated subquery evaluations through early dimension filtering.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 5,
          "iteration": 1,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.7389502737366156,
            "original_ms": 174.94610166734978,
            "optimized_ms": 100.60443033338136,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filtering",
            "speedup": 1.0366364397606878,
            "original_ms": 88.03575599965068,
            "optimized_ms": 84.92442733343826,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_cte_restructuring",
            "speedup": 1.0036049439868115,
            "original_ms": 88.03575599965068,
            "optimized_ms": 87.71953200024048,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0.9186795453472819,
            "original_ms": 88.03575599965068,
            "optimized_ms": 95.82857966688607,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.7040641626513594,
            "original_ms": 90.41396199972951,
            "optimized_ms": 128.41721933303538,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transforms",
            "speedup": 0.3665666448411192,
            "original_ms": 88.03575599965068,
            "optimized_ms": 240.16302966629155,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.18544058589770873,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "materialize_cte"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0942872442449195,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "materialize_cte",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.09152450431559413,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.08,
            "original_ms": 141.02,
            "optimized_ms": 1671.15,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "decorrelate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q95": {
        "query_id": "q95",
        "status": "WIN",
        "best_speedup": 4.6867,
        "original_ms": 2784.22,
        "optimized_ms": 594.06,
        "original_sql": "-- start query 95 in stream 0 using template query95.tpl\nwith ws_wh as\n(select ws1.ws_order_number,ws1.ws_warehouse_sk wh1,ws2.ws_warehouse_sk wh2\n from web_sales ws1,web_sales ws2\n where ws1.ws_order_number = ws2.ws_order_number\n   and ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk)\n select \n   count(distinct ws_order_number) as \"order count\"\n  ,sum(ws_ext_ship_cost) as \"total shipping cost\"\n  ,sum(ws_net_profit) as \"total net profit\"\nfrom\n   web_sales ws1\n  ,date_dim\n  ,customer_address\n  ,web_site\nwhere\n    d_date between '1999-2-01' and \n           (cast('1999-2-01' as date) + INTERVAL 60 DAY)\nand ws1.ws_ship_date_sk = d_date_sk\nand ws1.ws_ship_addr_sk = ca_address_sk\nand ca_state = 'NC'\nand ws1.ws_web_site_sk = web_site_sk\nand web_company_name = 'pri'\nand ws1.ws_order_number in (select ws_order_number\n                            from ws_wh)\nand ws1.ws_order_number in (select wr_order_number\n                            from web_returns,ws_wh\n                            where wr_order_number = ws_wh.ws_order_number)\norder by count(distinct ws_order_number)\n LIMIT 100;\n\n-- end query 95 in stream 0 using template query95.tpl\n",
        "optimized_sql": "WITH date_filtered AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_date BETWEEN '1999-2-01' AND (\n        CAST('1999-2-01' AS DATE) + INTERVAL '60' DAY\n    )\n), address_filtered AS (\n    SELECT ca_address_sk\n    FROM customer_address\n    WHERE ca_state = 'NC'\n), website_filtered AS (\n    SELECT web_site_sk\n    FROM web_site\n    WHERE web_company_name = 'pri'\n), ws_wh_agg AS (\n    SELECT ws_order_number\n    FROM web_sales\n    GROUP BY ws_order_number\n    HAVING COUNT(DISTINCT ws_warehouse_sk) > 1\n), returned_multi_warehouse_orders AS (\n    SELECT DISTINCT wr_order_number\n    FROM web_returns\n    INNER JOIN ws_wh_agg ON web_returns.wr_order_number = ws_wh_agg.ws_order_number\n)\nSELECT\n    COUNT(DISTINCT ws1.ws_order_number) AS \"order count\",\n    SUM(ws1.ws_ext_ship_cost) AS \"total shipping cost\",\n    SUM(ws1.ws_net_profit) AS \"total net profit\"\nFROM web_sales ws1\nINNER JOIN date_filtered ON ws1.ws_ship_date_sk = date_filtered.d_date_sk\nINNER JOIN address_filtered ON ws1.ws_ship_addr_sk = address_filtered.ca_address_sk\nINNER JOIN website_filtered ON ws1.ws_web_site_sk = website_filtered.web_site_sk\nWHERE ws1.ws_order_number IN (\n    SELECT wr_order_number\n    FROM returned_multi_warehouse_orders\n)\nORDER BY\n    COUNT(DISTINCT ws1.ws_order_number)\nLIMIT 100",
        "transforms": [
          "prefetch_fact_join",
          "multi_dimension_prefetch",
          "single_pass_aggregation"
        ],
        "principle": "prefetch_fact_join",
        "changes_description": null,
        "reasoning": "```sql\nWITH date_filtered AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_date BETWEEN '1999-2-01' AND (\n        CAST('1999-2-01' AS DATE) + INTERVAL '60' DAY\n    )\n), address_filtered AS (\n    SELECT ca_address_sk\n    FROM customer_address\n    WHERE ca_state = 'NC'\n), website_filtered AS (\n    SELECT web_site_sk\n    FROM web_site\n    WHERE web_company_name = 'pri'\n), ws_wh_agg AS (\n    SELECT ws_order_number\n    FROM web_sales\n    GROUP BY ws_order_number\n    HAVING COUNT(DISTINCT ws_warehouse_sk) > 1\n), returned_multi_warehouse_orders AS (\n    SELECT DISTINCT wr_order_number\n    FROM web_returns\n    INNER JOIN ws_wh_agg ON web_returns.wr_order_number = ws_wh_agg.ws_order_number\n)\nSELECT\n    COUNT(DISTINCT ws1.ws_order_number) AS \"order count\",\n    SUM(ws1.ws_ext_ship_cost) AS \"total shipping cost\",\n    SUM(ws1.ws_net_profit) AS \"total net profit\"\nFROM web_sales ws1\nINNER JOIN date_filtered ON ws1.ws_ship_date_sk = date_filtered.d_date_sk\nINNER JOIN address_filtered ON ws1.ws_ship_addr_sk = address_filtered.ca_address_sk\nINNER JOIN website_filtered ON ws1.ws_web_site_sk = website_filtered.web_site_sk\nWHERE ws1.ws_order_number IN (\n    SELECT wr_order_number\n    FROM returned_multi_warehouse_orders\n)\nORDER BY\n    COUNT(DISTINCT ws1.ws_order_number)\nLIMIT 100\n```\n\n**Changes**: \n1. Created CTEs to pre-filter dimension tables (date_dim, customer_address, web_site) before joining with the fact table.\n2. Replaced the self-join `ws_wh` CTE with an aggregation-based approach to identify multi-warehouse orders more efficiently.\n3. Consolidated the two IN subqueries into a single CTE `returned_multi_warehouse_orders` that finds orders which are both multi-warehouse and returned, scanning web_sales and web_returns only once each.\n4. Converted implicit joins to explicit JOIN syntax for better optimizer control.\n\n**Expected speedup**: 2-3x due to reduced fact table scans and early dimension filtering.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": "aggressive_prefetch_restructure"
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 4.686728778957299,
            "original_ms": 2784.21640166683,
            "optimized_ms": 594.0639053336175,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "multi_dimension_prefetch",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.37,
            "original_ms": 5151.01,
            "optimized_ms": 3754.58,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": []
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_early_filter",
            "speedup": 1.1543625651784728,
            "original_ms": 2784.21640166683,
            "optimized_ms": 2411.9080830002226,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_date_dimension_isolation",
            "speedup": 1.0022370576644657,
            "original_ms": 2784.21640166683,
            "optimized_ms": 2778.001851333405,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.7375362028322698,
            "original_ms": 2784.21640166683,
            "optimized_ms": 3775.0233696663904,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "intersect_to_exists",
              "or_to_union"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q96": {
        "query_id": "q96",
        "status": "WIN",
        "best_speedup": 1.64,
        "original_ms": 253.36,
        "optimized_ms": 154.49,
        "original_sql": "SELECT count(*)\nFROM store_sales ,\n     household_demographics,\n     time_dim,\n     store\nWHERE ss_sold_time_sk = time_dim.t_time_sk\n  AND ss_hdemo_sk = household_demographics.hd_demo_sk\n  AND ss_store_sk = s_store_sk\n  AND time_dim.t_hour = 20\n  AND time_dim.t_minute >= 30\n  AND household_demographics.hd_dep_count = 7\n  AND store.s_store_name = 'ese'\nORDER BY count(*)\nLIMIT 100;\n\n",
        "optimized_sql": "WITH filtered_time AS (SELECT t_time_sk FROM time_dim WHERE t_hour = 20 AND t_minute >= 30), filtered_hd AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_dep_count = 7), filtered_store AS (SELECT s_store_sk FROM store WHERE s_store_name = 'ese'), filtered_sales AS (SELECT 1 FROM store_sales AS ss JOIN filtered_time AS ft ON ss.ss_sold_time_sk = ft.t_time_sk JOIN filtered_hd AS fhd ON ss.ss_hdemo_sk = fhd.hd_demo_sk JOIN filtered_store AS fs ON ss.ss_store_sk = fs.s_store_sk)\nSELECT COUNT(*) FROM filtered_sales ORDER BY COUNT(*) LIMIT 100",
        "transforms": [
          "early_filter"
        ],
        "principle": "early_filter",
        "changes_description": null,
        "reasoning": "Looking at this query, I can see it's performing a COUNT(*) across multiple joins with filters. The execution plan shows the store_sales table is being fully scanned (172M rows), which is the bottleneck. The key opportunity is to push filters from dimension tables into the store_sales scan using CTEs.\n\n```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"early_filter\",\n      \"nodes\": {\n        \"filtered_time\": \"SELECT t_time_sk FROM time_dim WHERE t_hour = 20 AND t_minute >= 30\",\n        \"filtered_hd\": \"SELECT hd_demo_sk FROM household_demographics WHERE hd_dep_count = 7\",\n        \"filtered_store\": \"SELECT s_store_sk FROM store WHERE s_store_name = 'ese'\",\n        \"filtered_sales\": \"SELECT 1 FROM store_sales ss JOIN filtered_time ft ON ss.ss_sold_time_sk = ft.t_time_sk JOIN filtered_hd fhd ON ss.ss_hdemo_sk = fhd.hd_demo_sk JOIN filtered_store fs ON ss.ss_store_sk = fs.s_store_sk\",\n        \"main_query\": \"SELECT COUNT(*) FROM filtered_sales ORDER BY COUNT(*) LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\",\n        \"same aggregation semantics\"\n      ],\n      \"expected_speedup\": \"10x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"The original query performs a full scan of store_sales (172M rows) and then joins to dimension tables, applying filters late. By creating CTEs that pre-filter the dimension tables first (time_dim \u2192 1,800 rows, household_demographics \u2192 720 rows, store \u2192 7 rows), we can then join these much smaller results to store_sales. This allows the database to use indexed lookups or hash joins with small probe sides instead of scanning all store_sales rows. The COUNT(*) is preserved as we're just counting matching rows from the filtered join result.\"\n}\n```\n\n**Alternative approach using decorrelation:**\n\n```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"decorrelate\",\n      \"nodes\": {\n        \"filtered_time_keys\": \"SELECT t_time_sk FROM time_dim WHERE t_hour = 20 AND t_minute >= 30\",\n        \"filtered_hd_keys\": \"SELECT hd_demo_sk FROM household_demographics WHERE hd_dep_count = 7\",\n        \"filtered_store_keys\": \"SELECT s_store_sk FROM store WHERE s_store_name = 'ese'\",\n        \"main_query\": \"SELECT COUNT(*) FROM store_sales WHERE ss_sold_time_sk IN (SELECT t_time_sk FROM filtered_time_keys) AND ss_hdemo_sk IN (SELECT hd_demo_sk FROM filtered_hd_keys) AND ss_store_sk IN (SELECT s_store_sk FROM filtered_store_keys) ORDER BY COUNT(*) LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\",\n        \"same aggregation semantics\"\n      ],\n      \"expected_speedup\": \"8x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Decorrelates the joins by converting them to IN subqueries with pre-filtered dimension tables. This allows the optimizer to push the filters and potentially use bitmap index scans on store_sales if indexes exist on the foreign key columns.\"\n}\n```\n\nThe first approach (early_filter) is likely better as it creates explicit CTEs that can be materialized and reused, giving the optimizer clear boundaries for early filtering. Both approaches address the core issue: avoiding the full 172M row scan of store_sales by applying dimension filters first.",
        "provenance": {
          "source": "Retry3W",
          "run": "retry_3worker_20260205_235909_details",
          "model": "deepseek-reasoner",
          "worker_id": 2,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.5809367934234058,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "decorrelate"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.2376804971416933,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.01,
            "original_ms": 253.36,
            "optimized_ms": 251.96,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "structural_transform",
            "speedup": 1.0041128340244836,
            "original_ms": 176.42028000015367,
            "optimized_ms": 175.69766466688938,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 0.987587295044564,
            "original_ms": 235.39459633320803,
            "optimized_ms": 238.35320433378607,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_pushdown_filter",
            "speedup": 0.9707801187371342,
            "original_ms": 176.42028000015367,
            "optimized_ms": 181.73042133336517,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 0.9474074220776305,
            "original_ms": 176.42028000015367,
            "optimized_ms": 186.2137406663654,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Retry3W",
            "run": "retry_3worker_20260205_235909_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.9236500635799662,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "dimension_isolation",
            "speedup": 0.9141370495165347,
            "original_ms": 176.42028000015367,
            "optimized_ms": 192.99106200044966,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.1787451907807794,
            "original_ms": 185.81264800013741,
            "optimized_ms": 1039.5392859997326,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q97": {
        "query_id": "q97",
        "status": "WIN",
        "best_speedup": 1.98,
        "original_ms": 2642.65,
        "optimized_ms": 1334.67,
        "original_sql": "WITH ssci AS\n  (SELECT ss_customer_sk customer_sk ,\n          ss_item_sk item_sk\n   FROM store_sales,\n        date_dim\n   WHERE ss_sold_date_sk = d_date_sk\n     AND d_month_seq BETWEEN 1200 AND 1200 + 11\n   GROUP BY ss_customer_sk ,\n            ss_item_sk),\n     csci as\n  ( SELECT cs_bill_customer_sk customer_sk ,cs_item_sk item_sk\n   FROM catalog_sales,date_dim\n   WHERE cs_sold_date_sk = d_date_sk\n     AND d_month_seq BETWEEN 1200 AND 1200 + 11\n   GROUP BY cs_bill_customer_sk ,cs_item_sk)\nSELECT sum(CASE\n               WHEN ssci.customer_sk IS NOT NULL\n                    AND csci.customer_sk IS NULL THEN 1\n               ELSE 0\n           END) store_only ,\n       sum(CASE\n               WHEN ssci.customer_sk IS NULL\n                    AND csci.customer_sk IS NOT NULL THEN 1\n               ELSE 0\n           END) catalog_only ,\n       sum(CASE\n               WHEN ssci.customer_sk IS NOT NULL\n                    AND csci.customer_sk IS NOT NULL THEN 1\n               ELSE 0\n           END) store_and_catalog\nFROM ssci\nFULL OUTER JOIN csci ON (ssci.customer_sk=csci.customer_sk\n                         AND ssci.item_sk = csci.item_sk)\nLIMIT 100;\n\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1200 AND 1200 + 11), ssci AS (SELECT ss_customer_sk AS customer_sk, ss_item_sk AS item_sk FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk GROUP BY ss_customer_sk, ss_item_sk), csci AS (SELECT cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk GROUP BY cs_bill_customer_sk, cs_item_sk)\nSELECT SUM(CASE WHEN NOT ssci.customer_sk IS NULL AND csci.customer_sk IS NULL THEN 1 ELSE 0 END) AS store_only, SUM(CASE WHEN ssci.customer_sk IS NULL AND NOT csci.customer_sk IS NULL THEN 1 ELSE 0 END) AS catalog_only, SUM(CASE WHEN NOT ssci.customer_sk IS NULL AND NOT csci.customer_sk IS NULL THEN 1 ELSE 0 END) AS store_and_catalog FROM ssci FULL OUTER JOIN csci ON (ssci.customer_sk = csci.customer_sk AND ssci.item_sk = csci.item_sk) LIMIT 100",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1200 AND 1200 + 11\",\n        \"ssci\": \"SELECT ss_customer_sk AS customer_sk, ss_item_sk AS item_sk FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk GROUP BY ss_customer_sk, ss_item_sk\",\n        \"csci\": \"SELECT cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk GROUP BY cs_bill_customer_sk, cs_item_sk\",\n        \"main_query\": \"SELECT SUM(CASE WHEN NOT ssci.customer_sk IS NULL AND csci.customer_sk IS NULL THEN 1 ELSE 0 END) AS store_only, SUM(CASE WHEN ssci.customer_sk IS NULL AND NOT csci.customer_sk IS NULL THEN 1 ELSE 0 END) AS catalog_only, SUM(CASE WHEN NOT ssci.customer_sk IS NULL AND NOT csci.customer_sk IS NULL THEN 1 ELSE 0 END) AS store_and_catalog FROM ssci FULL OUTER JOIN csci ON (ssci.customer_sk = csci.customer_sk AND ssci.item_sk = csci.item_sk) LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result values\",\n        \"same column output\",\n        \"same grouping\",\n        \"same row count\"\n      ],\n      \"expected_speedup\": \"1.2x\",\n      \"risk\": \"low\"\n    },\n    {\n      \"id\": \"rs_02\",\n      \"transform\": \"semantic_rewrite\",\n      \"nodes\": {\n        \"main_query\": \"WITH ssci AS (SELECT ss_customer_sk AS customer_sk, ss_item_sk AS item_sk FROM store_sales JOIN (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1200 AND 1200 + 11) dates ON ss_sold_date_sk = dates.d_date_sk GROUP BY ss_customer_sk, ss_item_sk), csci AS (SELECT cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk FROM catalog_sales JOIN (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1200 AND 1200 + 11) dates ON cs_sold_date_sk = dates.d_date_sk GROUP BY cs_bill_customer_sk, cs_item_sk) SELECT COUNT(CASE WHEN csci.customer_sk IS NULL THEN 1 END) AS store_only, COUNT(CASE WHEN ssci.customer_sk IS NULL THEN 1 END) AS catalog_only, COUNT(CASE WHEN ssci.customer_sk IS NOT NULL AND csci.customer_sk IS NOT NULL THEN 1 END) AS store_and_catalog FROM ssci FULL OUTER JOIN csci ON ssci.customer_sk = csci.customer_sk AND ssci.item_sk = csci.item_sk LIMIT 100\"\n      },\n      \"invariants_kept\": [\n        \"same result values\",\n        \"same column output\",\n        \"semantically equivalent COUNT vs SUM logic\"\n      ],\n      \"expected_speedup\": \"1.1x\",\n      \"risk\": \"low\"\n    }\n  ],\n  \"explanation\": \"Applied date_cte_isolate to factor out the common date_dim filter into a reusable CTE, avoiding redundant scans of date_dim. Also simplified the main query's conditional SUM logic to COUNT with CASE for cleaner semantics while maintaining identical results.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 4,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 2.958639903554491,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.981201854692654,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.2159707620662126,
            "original_ms": 1493.9724930009106,
            "optimized_ms": 1228.6253416671873,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.0701609876253242,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 1.0555953147410848,
            "original_ms": 1199.1078626667029,
            "optimized_ms": 1135.9541349999442,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_filter_pushdown",
            "speedup": 1.0541692529075601,
            "original_ms": 1199.1078626667029,
            "optimized_ms": 1137.4908339997394,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_multi_cte_restructure",
            "speedup": 0.994815506234946,
            "original_ms": 1199.1078626667029,
            "optimized_ms": 1205.3570286664883,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.98,
            "original_ms": 2642.65,
            "optimized_ms": 2688.76,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8978205156598127,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 0.6032950870148343,
            "original_ms": 1180.8008359997377,
            "optimized_ms": 1957.2525310001463,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 0.5662636980293042,
            "original_ms": 1199.1078626667029,
            "optimized_ms": 2117.5785536664384,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q98": {
        "query_id": "q98",
        "status": "WIN",
        "best_speedup": 1.26,
        "original_ms": 384.96,
        "optimized_ms": 305.52,
        "original_sql": "SELECT i_item_id ,\n       i_item_desc,\n       i_category,\n       i_class,\n       i_current_price ,\n       sum(ss_ext_sales_price) AS itemrevenue,\n       sum(ss_ext_sales_price)*100.0000/sum(sum(ss_ext_sales_price)) OVER (PARTITION BY i_class) AS revenueratio\nFROM store_sales ,\n     item,\n     date_dim\nWHERE ss_item_sk = i_item_sk\n  AND i_category IN ('Sports',\n                     'Books',\n                     'Home')\n  AND ss_sold_date_sk = d_date_sk\n  AND d_date BETWEEN cast('1999-02-22' AS date) AND cast('1999-03-24' AS date)\nGROUP BY i_item_id ,\n         i_item_desc,\n         i_category ,\n         i_class ,\n         i_current_price\nORDER BY i_category  NULLS FIRST,\n         i_class  NULLS FIRST,\n         i_item_id  NULLS FIRST,\n         i_item_desc  NULLS FIRST,\n         revenueratio NULLS FIRST;\n",
        "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-02-22' AS DATE) AND CAST('1999-03-24' AS DATE))\nSELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, SUM(ss_ext_sales_price) AS itemrevenue, SUM(ss_ext_sales_price) * 100.0000 / SUM(SUM(ss_ext_sales_price)) OVER (PARTITION BY i_class) AS revenueratio FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN item ON ss_item_sk = i_item_sk WHERE i_category IN ('Sports', 'Books', 'Home') GROUP BY i_item_id, i_item_desc, i_category, i_class, i_current_price ORDER BY i_category NULLS FIRST, i_class NULLS FIRST, i_item_id NULLS FIRST, i_item_desc NULLS FIRST, revenueratio NULLS FIRST",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```json\n{\n  \"rewrite_sets\": [\n    {\n      \"id\": \"rs_01\",\n      \"transform\": \"date_cte_isolate\",\n      \"nodes\": {\n        \"filtered_dates\": \"SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-02-22' AS DATE) AND CAST('1999-03-24' AS DATE)\",\n        \"main_query\": \"SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, SUM(ss_ext_sales_price) AS itemrevenue, SUM(ss_ext_sales_price) * 100.0000 / SUM(SUM(ss_ext_sales_price)) OVER (PARTITION BY i_class) AS revenueratio FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN item ON ss_item_sk = i_item_sk WHERE i_category IN ('Sports', 'Books', 'Home') GROUP BY i_item_id, i_item_desc, i_category, i_class, i_current_price ORDER BY i_category NULLS FIRST, i_class NULLS FIRST, i_item_id NULLS FIRST, i_item_desc NULLS FIRST, revenueratio NULLS FIRST\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\",\n        \"same aggregation\"\n      ],\n      \"expected_speedup\": \"3.5x\",\n      \"risk\": \"low\"\n    },\n    {\n      \"id\": \"rs_02\",\n      \"transform\": \"materialize_cte\",\n      \"nodes\": {\n        \"filtered_items\": \"SELECT i_item_sk, i_item_id, i_item_desc, i_category, i_class, i_current_price FROM item WHERE i_category IN ('Sports', 'Books', 'Home')\",\n        \"main_query\": \"SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, SUM(ss_ext_sales_price) AS itemrevenue, SUM(ss_ext_sales_price) * 100.0000 / SUM(SUM(ss_ext_sales_price)) OVER (PARTITION BY i_class) AS revenueratio FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN filtered_items ON ss_item_sk = i_item_sk GROUP BY i_item_id, i_item_desc, i_category, i_class, i_current_price ORDER BY i_category NULLS FIRST, i_class NULLS FIRST, i_item_id NULLS FIRST, i_item_desc NULLS FIRST, revenueratio NULLS FIRST\"\n      },\n      \"invariants_kept\": [\n        \"same result rows\",\n        \"same ordering\",\n        \"same column output\"\n      ],\n      \"expected_speedup\": \"1.2x\",\n      \"risk\": \"low\",\n      \"depends_on\": [\"rs_01\"]\n    }\n  ],\n  \"explanation\": \"Two complementary optimizations applied: 1) Date CTE Isolation: Extract the highly selective date filter into a CTE (31 rows), allowing early reduction of the massive store_sales table. This prevents a full cartesian join between date_dim and store_sales. 2) Materialize CTE: Pre-filter the item table to only relevant categories (though not selective, it allows column pruning and better join planning). The combined effect reduces the store_sales join from 345M rows to only those matching the 31 date keys before joining with items.\"\n}\n```",
        "provenance": {
          "source": "Retry4W",
          "run": "retry_4worker_20260206_004710_details",
          "model": "deepseek-reasoner",
          "worker_id": 3,
          "iteration": 0,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.6567318479533208,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.5527299406536992,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.2381133804197217,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "materialize_cte",
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_join_restructuring",
            "speedup": 1.0995246408983421,
            "original_ms": 250.45613000050557,
            "optimized_ms": 227.7858273334156,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 1.0895712251262495,
            "original_ms": 232.9856133328576,
            "optimized_ms": 213.8323846666026,
            "status": "fail",
            "rows_match": false,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.080828335885216,
            "original_ms": 250.45613000050557,
            "optimized_ms": 231.72609533351837,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.04047740848008,
            "original_ms": 266.8063610005144,
            "optimized_ms": 256.42686600015924,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_filter_pushdown",
            "speedup": 1.0150166151613644,
            "original_ms": 250.45613000050557,
            "optimized_ms": 246.75076866666737,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.0053281156186487,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.96,
            "original_ms": 384.96,
            "optimized_ms": 402.29,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_dimension_isolation",
            "speedup": 0.9552633283152989,
            "original_ms": 250.45613000050557,
            "optimized_ms": 262.18543366697605,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      },
      "q99": {
        "query_id": "q99",
        "status": "WIN",
        "best_speedup": 2.3323,
        "original_ms": 313.89,
        "optimized_ms": 134.58,
        "original_sql": "-- start query 99 in stream 0 using template query99.tpl\nselect \n   substr(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\" \n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and \n                 (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\" \n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and \n                 (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\" \n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\" \n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\" \nfrom\n   catalog_sales\n  ,warehouse\n  ,ship_mode\n  ,call_center\n  ,date_dim\nwhere\n    d_month_seq between 1224 and 1224 + 11\nand cs_ship_date_sk   = d_date_sk\nand cs_warehouse_sk   = w_warehouse_sk\nand cs_ship_mode_sk   = sm_ship_mode_sk\nand cs_call_center_sk = cc_call_center_sk\ngroup by\n   substr(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\norder by substr(w_warehouse_name,1,20)\n        ,sm_type\n        ,cc_name\n LIMIT 100;\n\n-- end query 99 in stream 0 using template query99.tpl\n",
        "optimized_sql": "WITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_month_seq BETWEEN 1224 AND 1224 + 11\n),\nsales_with_diff AS (\n    SELECT \n        cs_warehouse_sk,\n        cs_ship_mode_sk,\n        cs_call_center_sk,\n        cs_ship_date_sk - cs_sold_date_sk AS days_diff\n    FROM catalog_sales\n    INNER JOIN filtered_dates ON cs_ship_date_sk = d_date_sk\n),\naggregated AS (\n    SELECT\n        cs_warehouse_sk,\n        cs_ship_mode_sk,\n        cs_call_center_sk,\n        SUM(CASE WHEN days_diff <= 30 THEN 1 ELSE 0 END) AS \"30 days\",\n        SUM(CASE WHEN days_diff > 30 AND days_diff <= 60 THEN 1 ELSE 0 END) AS \"31-60 days\",\n        SUM(CASE WHEN days_diff > 60 AND days_diff <= 90 THEN 1 ELSE 0 END) AS \"61-90 days\",\n        SUM(CASE WHEN days_diff > 90 AND days_diff <= 120 THEN 1 ELSE 0 END) AS \"91-120 days\",\n        SUM(CASE WHEN days_diff > 120 THEN 1 ELSE 0 END) AS \">120 days\"\n    FROM sales_with_diff\n    GROUP BY cs_warehouse_sk, cs_ship_mode_sk, cs_call_center_sk\n)\nSELECT\n    SUBSTRING(w_warehouse_name, 1, 20),\n    sm_type,\n    cc_name,\n    \"30 days\",\n    \"31-60 days\",\n    \"61-90 days\",\n    \"91-120 days\",\n    \">120 days\"\nFROM aggregated\nINNER JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk\nINNER JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk\nINNER JOIN call_center ON cs_call_center_sk = cc_call_center_sk\nORDER BY\n    SUBSTRING(w_warehouse_name, 1, 20),\n    sm_type,\n    cc_name\nLIMIT 100",
        "transforms": [
          "date_cte_isolate"
        ],
        "principle": "date_cte_isolate",
        "changes_description": null,
        "reasoning": "```sql\nWITH filtered_dates AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_month_seq BETWEEN 1224 AND 1224 + 11\n),\nsales_with_diff AS (\n    SELECT \n        cs_warehouse_sk,\n        cs_ship_mode_sk,\n        cs_call_center_sk,\n        cs_ship_date_sk - cs_sold_date_sk AS days_diff\n    FROM catalog_sales\n    INNER JOIN filtered_dates ON cs_ship_date_sk = d_date_sk\n),\naggregated AS (\n    SELECT\n        cs_warehouse_sk,\n        cs_ship_mode_sk,\n        cs_call_center_sk,\n        SUM(CASE WHEN days_diff <= 30 THEN 1 ELSE 0 END) AS \"30 days\",\n        SUM(CASE WHEN days_diff > 30 AND days_diff <= 60 THEN 1 ELSE 0 END) AS \"31-60 days\",\n        SUM(CASE WHEN days_diff > 60 AND days_diff <= 90 THEN 1 ELSE 0 END) AS \"61-90 days\",\n        SUM(CASE WHEN days_diff > 90 AND days_diff <= 120 THEN 1 ELSE 0 END) AS \"91-120 days\",\n        SUM(CASE WHEN days_diff > 120 THEN 1 ELSE 0 END) AS \">120 days\"\n    FROM sales_with_diff\n    GROUP BY cs_warehouse_sk, cs_ship_mode_sk, cs_call_center_sk\n)\nSELECT\n    SUBSTRING(w_warehouse_name, 1, 20),\n    sm_type,\n    cc_name,\n    \"30 days\",\n    \"31-60 days\",\n    \"61-90 days\",\n    \"91-120 days\",\n    \">120 days\"\nFROM aggregated\nINNER JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk\nINNER JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk\nINNER JOIN call_center ON cs_call_center_sk = cc_call_center_sk\nORDER BY\n    SUBSTRING(w_warehouse_name, 1, 20),\n    sm_type,\n    cc_name\nLIMIT 100\n```\n\n**Changes**: Isolated date filtering into a CTE, computed date differences early, aggregated by surrogate keys before joining dimension tables, and converted implicit joins to explicit JOIN syntax. This reduces data movement by performing aggregation on a minimal set of integer columns before expensive string operations and dimension lookups.\n\n**Expected speedup**: ~2-3x due to reduced join cardinality and deferred string processing.",
        "provenance": {
          "source": "Swarm",
          "run": "swarm_batch_20260208_102033",
          "model": "deepseek-reasoner",
          "worker_id": 6,
          "iteration": 2,
          "strategy": ""
        },
        "rows_match": true,
        "all_attempts": [
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 6,
            "iteration": 2,
            "strategy": "",
            "speedup": 2.332325366042106,
            "original_ms": 313.8889416665431,
            "optimized_ms": 134.5819696671242,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "",
            "speedup": 2.2539274268931555,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.4096624199284669,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.2736367074289974,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 5,
            "iteration": 1,
            "strategy": "",
            "speedup": 1.1275792400086502,
            "original_ms": 384.68299333362665,
            "optimized_ms": 341.1582793335886,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "aggressive_prefetch_restructure",
            "speedup": 1.107053079181335,
            "original_ms": 315.39791666667344,
            "optimized_ms": 284.8986400000892,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "prefetch_fact_join",
              "single_pass_aggregation"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 2,
            "iteration": 0,
            "strategy": "moderate_cte_isolation",
            "speedup": 1.0425137514131595,
            "original_ms": 315.39791666667344,
            "optimized_ms": 302.5359773328091,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate",
              "dimension_cte_isolate",
              "multi_dimension_prefetch"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 4,
            "iteration": 0,
            "strategy": "novel_structural_transform",
            "speedup": 1.0318371125636778,
            "original_ms": 315.39791666667344,
            "optimized_ms": 305.66638166662113,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "or_to_union",
              "decorrelate",
              "intersect_to_exists"
            ]
          },
          {
            "source": "Kimi",
            "run": "kimi_k2.5",
            "model": "kimi-k2.5",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 1.0,
            "original_ms": 464.41,
            "optimized_ms": 462.46,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter"
            ]
          },
          {
            "source": "Swarm",
            "run": "swarm_batch_20260208_102033",
            "model": "deepseek-reasoner",
            "worker_id": 1,
            "iteration": 0,
            "strategy": "conservative_filter_pushdown",
            "speedup": 0.9863625830226741,
            "original_ms": 315.39791666667344,
            "optimized_ms": 319.7585979996802,
            "status": "pass",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "early_filter",
              "pushdown",
              "materialize_cte"
            ]
          },
          {
            "source": "Retry4W",
            "run": "retry_4worker_20260206_004710_details",
            "model": "deepseek-reasoner",
            "worker_id": 3,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.8192437046317244,
            "original_ms": 0,
            "optimized_ms": 0,
            "status": "collected",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": true,
            "transforms": [
              "date_cte_isolate"
            ]
          },
          {
            "source": "V2",
            "run": "benchmark_output_v2",
            "model": "deepseek-reasoner",
            "worker_id": null,
            "iteration": 0,
            "strategy": "",
            "speedup": 0.0,
            "original_ms": 0.0,
            "optimized_ms": 0.0,
            "status": "success",
            "rows_match": true,
            "has_sql": true,
            "has_reasoning": false,
            "transforms": []
          }
        ]
      }
    },
    "principles": [
      {
        "id": "or_to_union",
        "name": "Or To Union",
        "what": "Applied or_to_union",
        "why": "Converting OR to UNION ALL lets optimizer choose independent index paths per branch",
        "when": "WHERE clause has OR conditions over different dimension keys (\u22643 branches)",
        "when_not": "Caused regression on q10, q11, q12, q13, q16, q18, q19, q26, q28, q32, q33, q34, q36, q38, q40, q41, q45, q46, q47, q48, q52, q53, q57, q61, q63, q64, q68, q7, q71, q73, q78, q79, q8, q82, q85, q87, q89, q9, q91, q92, q93, q95, q97 (worst: 0.02x)",
        "verified_speedups": [
          9.085885527535973,
          6.871968943381523,
          6.104619135142192,
          5.247120914585514,
          3.990981396657346,
          3.2744960897819717,
          2.78,
          2.1306854692331143,
          2.107652952467987,
          1.9269670141015571,
          1.8183483771040496,
          1.7875141190130917,
          1.4661522746082845,
          1.283458551687203,
          1.255391547621421,
          1.215936679110929,
          1.195762461654057,
          1.1878234463253028,
          1.1421064087031998,
          1.14,
          1.1323627963163856,
          1.1218212452710785,
          1.1088930774161783,
          1.108791460815752,
          1.102811023014969
        ],
        "avg_speedup": 2.504,
        "queries": [
          "q10",
          "q15",
          "q26",
          "q35",
          "q37",
          "q41",
          "q56",
          "q57",
          "q59",
          "q65",
          "q7",
          "q74",
          "q76",
          "q78",
          "q79",
          "q80",
          "q83",
          "q84",
          "q88"
        ],
        "transforms": [
          "date_cte_isolate",
          "decorrelate",
          "dimension_cte_isolate",
          "intersect_to_exists",
          "multi_date_range_cte",
          "or_to_union",
          "prefetch_fact_join",
          "union_cte_split"
        ]
      },
      {
        "id": "single_pass_aggregation",
        "name": "Single Pass Aggregation",
        "what": "Applied single_pass_aggregation",
        "why": "Consolidating repeated scans into CASE aggregates reduces I/O from N scans to 1; Pre-joining filtered dimensions with fact table before aggregation reduces join input; Separate CTEs for each date alias avoids ambiguous multi-way date joins",
        "when": "Query has repeated scans of the same fact table with different WHERE filters",
        "when_not": "Caused regression on q11, q13, q14, q23b, q26, q28, q31, q32, q45, q46, q57, q58, q71, q78, q8, q87, q9, q90, q91, q92, q93, q96 (worst: 0.02x)",
        "verified_speedups": [
          5.853343016368592,
          2.2287417513388745,
          1.6143809499293833,
          1.555741636653914,
          1.1968409607938995
        ],
        "avg_speedup": 2.49,
        "queries": [
          "q36",
          "q4",
          "q44",
          "q59",
          "q88"
        ],
        "transforms": [
          "date_cte_isolate",
          "multi_date_range_cte",
          "multi_dimension_prefetch",
          "prefetch_fact_join",
          "single_pass_aggregation"
        ]
      },
      {
        "id": "dimension_cte_isolate",
        "name": "Dimension Cte Isolate",
        "what": "Applied dimension_cte_isolate",
        "why": "Pre-filtering all dimension tables into CTEs avoids repeated full-table scans; Pre-filtering date dimension into CTE reduces hash join probe table from 73K to ~365 rows",
        "when": "Query joins 2+ dimension tables that could each be pre-filtered independently",
        "when_not": "Caused regression on q20, q25, q27, q3, q31, q32, q33, q34, q37, q42, q44, q47, q52, q54, q55, q61, q69, q7, q75, q76, q82, q9, q90, q91, q92, q94, q96 (worst: 0.02x)",
        "verified_speedups": [
          6.2373882475101565,
          1.6419207225211507,
          1.5658230001570317,
          1.2765588616238608,
          1.2487192322686953,
          1.2110840731577763,
          1.1786867079531627
        ],
        "avg_speedup": 2.051,
        "queries": [
          "q13",
          "q18",
          "q41",
          "q60",
          "q82",
          "q84",
          "q88"
        ],
        "transforms": [
          "date_cte_isolate",
          "dimension_cte_isolate",
          "multi_dimension_prefetch",
          "prefetch_fact_join"
        ]
      },
      {
        "id": "prefetch_fact_join",
        "name": "Prefetch Fact Join",
        "what": "Applied aggressive multi-CTE prefetch by creating staged CTEs for filtered dimensions (item and date_dim) before joining with the fact table. This reduces the catalog_sales scan early by pushing down selective filters. The conditional aggregations remain consolidated in a single scan.",
        "why": "Pre-joining filtered dimensions with fact table before aggregation reduces join input; Pre-filtering multiple dimension tables in parallel reduces join fan-out; Consolidating repeated scans into CASE aggregates reduces I/O from N scans to 1",
        "when": "Query joins filtered dates/dims with large fact table; pre-join reduces probe size",
        "when_not": "Caused regression on q1, q11, q12, q13, q14, q23b, q26, q28, q29, q31, q32, q37, q4, q45, q46, q47, q48, q51, q55, q58, q69, q7, q71, q72, q74, q75, q78, q8, q87, q9, q90, q91, q92, q93, q94, q96 (worst: 0.02x)",
        "verified_speedups": [
          5.232336625346366,
          4.686728778957299,
          2.361866531556997,
          1.855037150982724,
          1.8448737327854032,
          1.6196398374168426,
          1.5562075695450637,
          1.4869344075425184,
          1.3391566430721515,
          1.2435931071893527,
          1.240353076721837,
          1.2280077773449636,
          1.2160281675930091,
          1.2057587102326572,
          1.1819139994000887,
          1.1806021162452764,
          1.1453033174235459,
          1.107053079181335
        ],
        "avg_speedup": 1.818,
        "queries": [
          "q1",
          "q11",
          "q27",
          "q35",
          "q40",
          "q53",
          "q56",
          "q57",
          "q61",
          "q64",
          "q65",
          "q7",
          "q74",
          "q80",
          "q82",
          "q83",
          "q95",
          "q99"
        ],
        "transforms": [
          "decorrelate",
          "materialize_cte",
          "multi_dimension_prefetch",
          "prefetch_fact_join",
          "single_pass_aggregation"
        ]
      },
      {
        "id": "date_cte_isolate",
        "name": "Date Cte Isolate",
        "what": "Applied date_cte_isolate",
        "why": "Pre-filtering date dimension into CTE reduces hash join probe table from 73K to ~365 rows",
        "when": "Query joins date_dim on multiple conditions (year, month, etc.) with fact tables",
        "when_not": "Caused regression on q1, q10, q11, q13, q14, q16, q20, q21, q23, q25, q26, q29, q3, q31, q32, q33, q37, q38, q4, q40, q42, q43, q45, q47, q48, q49, q5, q52, q53, q54, q55, q61, q63, q64, q69, q7, q71, q72, q73, q75, q76, q78, q79, q8, q80, q82, q85, q87, q91, q92, q94, q96, q97, q99 (worst: 0.02x)",
        "verified_speedups": [
          9.499067762180804,
          7.318884110508424,
          5.71179425805959,
          3.7909010191246577,
          3.01380179858059,
          2.958639903554491,
          2.5608966658831736,
          2.4685052157379332,
          2.4623945374262237,
          2.332325366042106,
          2.2539274268931555,
          2.2278787430223232,
          2.120141167622575,
          1.991421337511105,
          1.981201854692654,
          1.942079125269562,
          1.9121582527989138,
          1.896235456027462,
          1.8732407084167404,
          1.8027040998221822,
          1.76116092442498,
          1.7389502737366156,
          1.7357496133091628,
          1.6904592116068018,
          1.6567318479533208,
          1.6469458482745085,
          1.621577277686975,
          1.6152624818577372,
          1.5831926754693433,
          1.564993514442786,
          1.5527299406536992,
          1.5508874952278973,
          1.504349354318293,
          1.4948841007596256,
          1.45358716820421,
          1.4301197404500123,
          1.4096624199284669,
          1.407015941404685,
          1.404574722612863,
          1.3792819616907084,
          1.372737206909019,
          1.3618019143409292,
          1.3415443622462533,
          1.3239256610840502,
          1.3095505311991438,
          1.2815615118789596,
          1.2736367074289974,
          1.2526541714671922,
          1.250473647747917,
          1.2166799951058316,
          1.2159707620662126,
          1.2125932148721819,
          1.2076039099615592,
          1.2019354882786615,
          1.1865844679101087,
          1.1837518455973082,
          1.1784537748926223,
          1.178214341043941,
          1.169105220483743,
          1.1683145915473911,
          1.1663518863559634,
          1.1608724781705577,
          1.1537825698508446,
          1.1458077765946144,
          1.1438249981803454,
          1.1433944859985656,
          1.1389774037337557,
          1.1380110263953256,
          1.1275792400086502,
          1.112066135964396,
          1.1092558471117924,
          1.1092221064259817,
          1.1064978075553307,
          1.1052671983232194,
          1.1044555215937641
        ],
        "avg_speedup": 1.802,
        "queries": [
          "q1",
          "q10",
          "q12",
          "q14",
          "q16",
          "q19",
          "q21",
          "q22",
          "q27",
          "q3",
          "q30",
          "q36",
          "q38",
          "q39",
          "q4",
          "q40",
          "q42",
          "q43",
          "q45",
          "q49",
          "q5",
          "q51",
          "q52",
          "q56",
          "q57",
          "q58",
          "q59",
          "q60",
          "q62",
          "q64",
          "q65",
          "q68",
          "q69",
          "q71",
          "q74",
          "q75",
          "q77",
          "q78",
          "q79",
          "q8",
          "q80",
          "q82",
          "q86",
          "q92",
          "q94",
          "q97",
          "q98",
          "q99"
        ],
        "transforms": [
          "date_cte_isolate",
          "dimension_cte_isolate",
          "multi_date_range_cte",
          "multi_dimension_prefetch",
          "prefetch_fact_join",
          "union_cte_split"
        ]
      },
      {
        "id": "pushdown",
        "name": "Pushdown",
        "what": "Applied pushdown",
        "why": "Pushing predicates closer to table scans reduces data volume in upper operators; Pre-filtering date dimension into CTE reduces hash join probe table from 73K to ~365 rows",
        "when": "WHERE predicates reference columns from tables deep in the join tree",
        "when_not": "Caused regression on q13, q14, q23, q23b, q25, q3, q31, q32, q39, q4, q47, q53, q57, q58, q60, q61, q64, q7, q71, q73, q75, q77, q79, q81, q82, q85, q89, q9, q91, q92, q93 (worst: 0.09x)",
        "verified_speedups": [
          7.240394567348402,
          2.3747632323103227,
          2.2121607610341743,
          2.1,
          2.0202137333898675,
          1.92816636755059,
          1.8828044869748284,
          1.86,
          1.8432973825324983,
          1.790164901076323,
          1.7405828777308419,
          1.707322716733612,
          1.6014089314423539,
          1.5352754187065603,
          1.4524960170164787,
          1.3965594855599017,
          1.36,
          1.2818589277542933,
          1.24,
          1.2295898061845791,
          1.223390916715014,
          1.2125716696227813,
          1.1915897057130815,
          1.1547401533625217,
          1.147004464248671,
          1.139666337832002,
          1.1328760148026131,
          1.1258139731498285,
          1.1073640014931196,
          1.1
        ],
        "avg_speedup": 1.711,
        "queries": [
          "q13",
          "q14",
          "q2",
          "q22",
          "q23a",
          "q39",
          "q4",
          "q41",
          "q56",
          "q58",
          "q59",
          "q60",
          "q63",
          "q65",
          "q68",
          "q7",
          "q74",
          "q75",
          "q76",
          "q78",
          "q79",
          "q8",
          "q83",
          "q85",
          "q9"
        ],
        "transforms": [
          "date_cte_isolate",
          "dimension_cte_isolate",
          "early_filter",
          "intersect_to_exists",
          "materialize_cte",
          "or_to_union",
          "pushdown"
        ]
      },
      {
        "id": "decorrelate",
        "name": "Decorrelate",
        "what": "Applied decorrelate",
        "why": "Correlated subqueries re-execute per outer row; converting to JOIN eliminates per-row overhead",
        "when": "Query has correlated subquery in WHERE or SELECT that references outer table",
        "when_not": "Caused regression on q16, q28, q32, q33, q44, q45, q47, q54, q63, q64, q68, q71, q75, q76, q78, q9, q90, q92, q94 (worst: 0.01x)",
        "verified_speedups": [
          4.38,
          2.92,
          2.3948739526422065,
          2.017311322590128,
          1.913449880267697,
          1.8164371139891216,
          1.812632729371977,
          1.7397191441331323,
          1.7268574193043773,
          1.639086389443567,
          1.5797328430054858,
          1.5010104736396839,
          1.4286262786356203,
          1.3892667039364608,
          1.3526863954165276,
          1.3389607915897253,
          1.33,
          1.275470311582983,
          1.2667200354869352,
          1.2595520306839465,
          1.2577225864588806,
          1.243821973819773,
          1.2390352919494787,
          1.2309031652125118,
          1.2056217519258987,
          1.191719916932481,
          1.1899987535971144,
          1.1753249873132035,
          1.1715753433352998,
          1.1694504884907846,
          1.1592810341128084,
          1.151017370732424,
          1.1482033872005448,
          1.1478163977683398,
          1.1448221267562546,
          1.1273954652635738,
          1.1198315895962039
        ],
        "avg_speedup": 1.518,
        "queries": [
          "q1",
          "q14",
          "q21",
          "q23a",
          "q23b",
          "q30",
          "q32",
          "q33",
          "q41",
          "q44",
          "q45",
          "q51",
          "q53",
          "q56",
          "q57",
          "q58",
          "q6",
          "q60",
          "q63",
          "q65",
          "q67",
          "q68",
          "q73",
          "q75",
          "q81",
          "q83",
          "q86",
          "q87",
          "q90",
          "q92",
          "q93"
        ],
        "transforms": [
          "date_cte_isolate",
          "decorrelate",
          "dimension_cte_isolate",
          "intersect_to_exists",
          "materialize_cte",
          "multi_date_range_cte",
          "multi_dimension_prefetch",
          "or_to_union",
          "prefetch_fact_join",
          "single_pass_aggregation",
          "union_cte_split"
        ]
      },
      {
        "id": "early_filter",
        "name": "Early Filter",
        "what": "Applied early_filter",
        "why": "Applying selective filters early reduces intermediate row counts before expensive operations; Pushing predicates closer to table scans reduces data volume in upper operators; Materializing a CTE used multiple times prevents redundant re-computation",
        "when": "Selective filters on dimension tables are applied late, after expensive joins",
        "when_not": "Caused regression on q21, q23b, q24, q25, q3, q31, q32, q34, q37, q42, q43, q47, q50, q53, q54, q55, q56, q57, q58, q61, q68, q7, q71, q73, q77, q81, q82, q85, q86, q87, q9, q91, q92, q93, q94, q96 (worst: 0.09x)",
        "verified_speedups": [
          5.269233093530888,
          2.73,
          2.521264513337834,
          1.83,
          1.688929925186359,
          1.5809367934234058,
          1.57,
          1.5140584817912317,
          1.51,
          1.51,
          1.4652787090057489,
          1.2376804971416933,
          1.23,
          1.23,
          1.22,
          1.2090404041202585,
          1.197602421984918,
          1.1719409581846711,
          1.1614768623993075,
          1.16,
          1.1543625651784728,
          1.1467054533131085,
          1.14,
          1.1340154958553943,
          1.1309813140521074,
          1.1202902969718573,
          1.1158868699509712,
          1.1158854424922844,
          1.1126856837322663,
          1.1024179410220403
        ],
        "avg_speedup": 1.509,
        "queries": [
          "q12",
          "q18",
          "q27",
          "q29",
          "q35",
          "q37",
          "q42",
          "q48",
          "q51",
          "q54",
          "q57",
          "q62",
          "q65",
          "q66",
          "q68",
          "q70",
          "q72",
          "q75",
          "q79",
          "q84",
          "q88",
          "q90",
          "q93",
          "q95",
          "q96"
        ],
        "transforms": [
          "date_cte_isolate",
          "decorrelate",
          "dimension_cte_isolate",
          "early_filter",
          "materialize_cte",
          "or_to_union",
          "pushdown"
        ]
      },
      {
        "id": "materialize_cte",
        "name": "Materialize Cte",
        "what": "Applied materialize_cte",
        "why": "Materializing a CTE used multiple times prevents redundant re-computation",
        "when": "Same subexpression appears 2+ times in the query (as subquery or CTE ref)",
        "when_not": "Caused regression on q14, q23, q23b, q25, q27, q28, q31, q32, q33, q4, q53, q58, q61, q69, q71, q73, q77, q81, q82, q87, q88, q9, q91, q92, q93, q94 (worst: 0.09x)",
        "verified_speedups": [
          1.8965187359786464,
          1.3137263922151727,
          1.2381133804197217
        ],
        "avg_speedup": 1.483,
        "queries": [
          "q58",
          "q92",
          "q98"
        ],
        "transforms": [
          "date_cte_isolate",
          "materialize_cte"
        ]
      },
      {
        "id": "union_cte_split",
        "name": "Union Cte Split",
        "what": "Split UNION into separate per-channel CTEs with pre-filtered dimension tables (date_dim, item) and early year filtering, then union aggregated results.",
        "why": "Splitting complex UNION into separate CTEs enables per-branch optimization; Consolidating repeated scans into CASE aggregates reduces I/O from N scans to 1; Pre-joining filtered dimensions with fact table before aggregation reduces join input",
        "when": "Query has UNION/UNION ALL of complex subqueries that share common table references",
        "when_not": "Caused regression on q11, q36, q41, q75 (worst: 0.35x)",
        "verified_speedups": [
          1.403346973764742,
          1.2353550946624476
        ],
        "avg_speedup": 1.319,
        "queries": [
          "q4",
          "q75"
        ],
        "transforms": [
          "multi_date_range_cte",
          "prefetch_fact_join",
          "single_pass_aggregation",
          "union_cte_split"
        ]
      },
      {
        "id": "unknown",
        "name": "Unknown",
        "what": "Applied unknown",
        "why": "",
        "when": "",
        "when_not": "",
        "verified_speedups": [
          1.37,
          1.33,
          1.19
        ],
        "avg_speedup": 1.297,
        "queries": [
          "q17",
          "q28",
          "q95"
        ],
        "transforms": []
      },
      {
        "id": "multi_dimension_prefetch",
        "name": "Multi Dimension Prefetch",
        "what": "Applied multi_dimension_prefetch",
        "why": "Pre-filtering multiple dimension tables in parallel reduces join fan-out",
        "when": "Query references multiple dimension tables (date + store, date + item, etc.)",
        "when_not": "Caused regression on q10, q14, q16, q23b, q25, q26, q27, q29, q31, q32, q37, q4, q45, q46, q47, q52, q55, q58, q60, q63, q69, q71, q72, q8, q87, q9, q91, q93, q96 (worst: 0.02x)",
        "verified_speedups": [
          1.505624723182454,
          1.129582722771031,
          1.1048099190949936
        ],
        "avg_speedup": 1.247,
        "queries": [
          "q42",
          "q46",
          "q76"
        ],
        "transforms": [
          "multi_dimension_prefetch",
          "prefetch_fact_join"
        ]
      },
      {
        "id": "intersect_to_exists",
        "name": "Intersect To Exists",
        "what": "Transformed the self-join on `all_sales` into a single-pass aggregation that computes both 1998 and 1999 metrics in conditional sums. This eliminates the expensive self-join and pushes year filters down into the UNION branches. Also changed UNION to UNION ALL for efficiency since duplicates are eliminated by later aggregation.",
        "why": "Replacing INTERSECT with EXISTS avoids materializing full intermediate sets; Correlated subqueries re-execute per outer row; converting to JOIN eliminates per-row overhead; Converting OR to UNION ALL lets optimizer choose independent index paths per branch",
        "when": "Query uses INTERSECT or EXCEPT to combine subquery results",
        "when_not": "Caused regression on q11, q12, q13, q16, q18, q19, q26, q28, q33, q36, q38, q40, q41, q45, q47, q48, q52, q53, q57, q61, q63, q64, q78, q8, q82, q87, q9, q93, q94, q95, q97 (worst: 0.02x)",
        "verified_speedups": [
          1.4042826037161327,
          1.2203256368194746,
          1.2159670898043362,
          1.2131770475981971,
          1.1544592249945018,
          1.130277064607968
        ],
        "avg_speedup": 1.223,
        "queries": [
          "q23a",
          "q30",
          "q38",
          "q44",
          "q6",
          "q75"
        ],
        "transforms": [
          "decorrelate",
          "intersect_to_exists",
          "or_to_union",
          "union_cte_split"
        ]
      },
      {
        "id": "multi_date_range_cte",
        "name": "Multi Date Range Cte",
        "what": "Applied multi_date_range_cte",
        "why": "Separate CTEs for each date alias avoids ambiguous multi-way date joins; Pre-filtering multiple dimension tables in parallel reduces join fan-out; Pre-joining filtered dimensions with fact table before aggregation reduces join input",
        "when": "Query uses the same date_dim table under 2+ aliases (d1, d2, d3) with different filters",
        "when_not": "Caused regression on q13, q25, q9, q90, q92 (worst: 0.07x)",
        "verified_speedups": [
          1.2689008923388794,
          1.2445054289041746,
          1.1133538416013442
        ],
        "avg_speedup": 1.209,
        "queries": [
          "q11",
          "q4",
          "q64"
        ],
        "transforms": [
          "multi_date_range_cte",
          "multi_dimension_prefetch",
          "prefetch_fact_join"
        ]
      }
    ],
    "anti_patterns": [
      {
        "id": "regression_date_cte_isolate",
        "name": "Regression: Date Cte Isolate",
        "mechanism": "Regression from date_cte_isolate",
        "observed_regressions": [
          0.02005576119057537,
          0.04952674768985023,
          0.06460344621307733,
          0.08590293193932914,
          0.40888260144075916,
          0.4147867223292329,
          0.48615970172674206,
          0.5336120744535915,
          0.537430720643162,
          0.5382703404741028,
          0.5847422845091331,
          0.6032950870148343,
          0.6229034870731597,
          0.6229752115208822,
          0.6420637556785981,
          0.6467426646014227,
          0.6514635171878688,
          0.6525593661591012,
          0.6564740937079243,
          0.657673161711531,
          0.6869704056665081,
          0.6915530662951658,
          0.7013458103690762,
          0.7058878723464658,
          0.7203193345708925,
          0.7494767353471375,
          0.7533865653910721,
          0.7639148576977852,
          0.7662287035113667,
          0.7711302612751842,
          0.7775891064012115,
          0.7818647422421163,
          0.8017931646180063,
          0.804350818042192,
          0.8192437046317244,
          0.8218744308459943,
          0.8270973679001975,
          0.8421776677180195,
          0.8441158722409633,
          0.8578809581131788,
          0.8744089051196285,
          0.8784112355860457,
          0.8850459676182538,
          0.889148132665114,
          0.8978205156598127,
          0.9046572187225531,
          0.9096366489530499,
          0.9141370495165347,
          0.9186795453472819,
          0.9289896620777872,
          0.9294859456578749,
          0.9312877399730467,
          0.939112719194515,
          0.9460228278501602,
          0.9478909645413708
        ],
        "queries": [
          "q1",
          "q10",
          "q16",
          "q20",
          "q21",
          "q25",
          "q26",
          "q29",
          "q3",
          "q31",
          "q33",
          "q37",
          "q38",
          "q4",
          "q40",
          "q42",
          "q43",
          "q48",
          "q49",
          "q5",
          "q52",
          "q55",
          "q69",
          "q72",
          "q78",
          "q79",
          "q8",
          "q80",
          "q82",
          "q87",
          "q91",
          "q92",
          "q94",
          "q96",
          "q97",
          "q99"
        ],
        "avoid_when": "Applying date_cte_isolate to queries similar to q1, q10, q16, q20, q21, q25, q26, q29, q3, q31, q33, q37, q38, q4, q40, q42, q43, q48, q49, q5, q52, q55, q69, q72, q78, q79, q8, q80, q82, q87, q91, q92, q94, q96, q97, q99"
      },
      {
        "id": "regression_decorrelate",
        "name": "Regression: Decorrelate",
        "mechanism": "Regression from decorrelate",
        "observed_regressions": [
          0.01,
          0.04394548840512586,
          0.06379772950465294,
          0.08,
          0.09152450431559413,
          0.11197021859295196,
          0.18055958112121248,
          0.3665666448411192,
          0.40983809602022186,
          0.42,
          0.5763335929273611,
          0.5954831943501389,
          0.6638767824067862,
          0.6834313107635834,
          0.7265263857529253,
          0.8994974596514503,
          0.9306594845682643,
          0.9308993211395007,
          0.932984308259224
        ],
        "queries": [
          "q16",
          "q28",
          "q33",
          "q44",
          "q47",
          "q54",
          "q63",
          "q71",
          "q75",
          "q76",
          "q9",
          "q90",
          "q92",
          "q94"
        ],
        "avoid_when": "Applying decorrelate to queries similar to q16, q28, q33, q44, q47, q54, q63, q71, q75, q76, q9, q90, q92, q94"
      },
      {
        "id": "regression_dimension_cte_isolate",
        "name": "Regression: Dimension Cte Isolate",
        "mechanism": "Regression from dimension_cte_isolate",
        "observed_regressions": [
          0.01932495312400238,
          0.31478810107854654,
          0.34516313848691815,
          0.390444506762746,
          0.6103817120018427,
          0.7102028647624241,
          0.7657519193654806,
          0.8170364191969884,
          0.9027980275534887,
          0.9127926277854175,
          0.9220667110100963,
          0.9312183437405103,
          0.9479106388726983
        ],
        "queries": [
          "q27",
          "q32",
          "q33",
          "q34",
          "q37",
          "q55",
          "q61",
          "q69",
          "q7",
          "q82",
          "q9",
          "q91"
        ],
        "avoid_when": "Applying dimension_cte_isolate to queries similar to q27, q32, q33, q34, q37, q55, q61, q69, q7, q82, q9, q91"
      },
      {
        "id": "regression_early_filter",
        "name": "Regression: Early Filter",
        "mechanism": "Regression from early_filter",
        "observed_regressions": [
          0.0942872442449195,
          0.27,
          0.32631091656951805,
          0.33419529701422845,
          0.52,
          0.58826075004332,
          0.5916623117862936,
          0.6042172220248457,
          0.6239036518846277,
          0.6512257348048118,
          0.6673587095757484,
          0.7345204021211929,
          0.7567459027281345,
          0.7881377313167035,
          0.8014895834850009,
          0.8129970277935269,
          0.8169129130715962,
          0.8172850604040731,
          0.8176462519548504,
          0.8316176495897339,
          0.8385998512584415,
          0.844017760050283,
          0.858234796746331,
          0.86,
          0.87,
          0.91,
          0.9117479850880859,
          0.92,
          0.92,
          0.9236500635799662,
          0.935124140382492,
          0.9394047166342461,
          0.94,
          0.94,
          0.9436712757404857,
          0.9483652617861749
        ],
        "queries": [
          "q21",
          "q23b",
          "q24",
          "q3",
          "q31",
          "q32",
          "q34",
          "q37",
          "q42",
          "q43",
          "q47",
          "q50",
          "q53",
          "q54",
          "q55",
          "q56",
          "q57",
          "q68",
          "q7",
          "q73",
          "q82",
          "q85",
          "q86",
          "q87",
          "q91",
          "q92",
          "q93",
          "q94",
          "q96"
        ],
        "avoid_when": "Applying early_filter to queries similar to q21, q23b, q24, q3, q31, q32, q34, q37, q42, q43, q47, q50, q53, q54, q55, q56, q57, q68, q7, q73, q82, q85, q86, q87, q91, q92, q93, q94, q96"
      },
      {
        "id": "regression_intersect_to_exists",
        "name": "Regression: Intersect To Exists",
        "mechanism": "Regression from intersect_to_exists",
        "observed_regressions": [
          0.3729444333094838,
          0.7375362028322698,
          0.7941431990172766,
          0.8745298983255388,
          0.9100556729798698
        ],
        "queries": [
          "q38",
          "q64",
          "q8",
          "q87",
          "q95"
        ],
        "avoid_when": "Applying intersect_to_exists to queries similar to q38, q64, q8, q87, q95"
      },
      {
        "id": "regression_materialize_cte",
        "name": "Regression: Materialize Cte",
        "mechanism": "Regression from materialize_cte",
        "observed_regressions": [
          0.16775479448656824,
          0.18544058589770873,
          0.3918027956728135,
          0.49399900869131746,
          0.5697267529754501,
          0.7587368109353814,
          0.8139077239378406,
          0.857835054181084
        ],
        "queries": [
          "q25",
          "q33",
          "q73",
          "q88",
          "q9",
          "q94"
        ],
        "avoid_when": "Applying materialize_cte to queries similar to q25, q33, q73, q88, q9, q94"
      },
      {
        "id": "regression_multi_date_range_cte",
        "name": "Regression: Multi Date Range Cte",
        "mechanism": "Regression from multi_date_range_cte",
        "observed_regressions": [
          0.2777433493196165,
          0.5674880000396676,
          0.8719752750878528
        ],
        "queries": [
          "q25",
          "q92"
        ],
        "avoid_when": "Applying multi_date_range_cte to queries similar to q25, q92"
      },
      {
        "id": "regression_multi_dimension_prefetch",
        "name": "Regression: Multi Dimension Prefetch",
        "mechanism": "Regression from multi_dimension_prefetch",
        "observed_regressions": [
          0.1787451907807794,
          0.4329450794982064,
          0.6492126143332616,
          0.7708460898027261,
          0.941767403411337,
          0.9429797077015454
        ],
        "queries": [
          "q25",
          "q27",
          "q31",
          "q52",
          "q69",
          "q96"
        ],
        "avoid_when": "Applying multi_dimension_prefetch to queries similar to q25, q27, q31, q52, q69, q96"
      },
      {
        "id": "regression_or_to_union",
        "name": "Regression: Or To Union",
        "mechanism": "Regression from or_to_union",
        "observed_regressions": [
          0.018305693460334036,
          0.041680245520203996,
          0.25991769868590203,
          0.29,
          0.30600440623855313,
          0.3121729532684024,
          0.33653637816090765,
          0.33818112242272685,
          0.3500425293594371,
          0.37085632010087327,
          0.3929450197037755,
          0.3943031952256471,
          0.4,
          0.42718345987060785,
          0.4458549699028839,
          0.46312547333344894,
          0.4704324989111194,
          0.47057944597765383,
          0.47952809033342514,
          0.4868575590566114,
          0.5096135106412799,
          0.51,
          0.5133205238739086,
          0.55,
          0.5625218022305444,
          0.5662636980293042,
          0.5715978844087075,
          0.588612773001455,
          0.5969994835077215,
          0.6121974038860318,
          0.6394266102386618,
          0.6445628262488484,
          0.66,
          0.6740961641464521,
          0.6770930306538144,
          0.6830658304200914,
          0.7083860410181173,
          0.7103090018553725,
          0.7159104228373429,
          0.7478064713060996,
          0.7816108556423373,
          0.7823452987767606,
          0.7988912344999219,
          0.8001129064111188,
          0.8182382336609387,
          0.8226606436674136,
          0.8295900419560737,
          0.8355409729733358,
          0.8417391905687402,
          0.8447552374313235,
          0.8675362677150643,
          0.9042710787267048,
          0.9218121054119779,
          0.9362559294124884
        ],
        "queries": [
          "q10",
          "q12",
          "q13",
          "q16",
          "q18",
          "q19",
          "q26",
          "q28",
          "q34",
          "q36",
          "q40",
          "q41",
          "q45",
          "q46",
          "q47",
          "q48",
          "q52",
          "q53",
          "q57",
          "q61",
          "q63",
          "q68",
          "q73",
          "q78",
          "q79",
          "q82",
          "q85",
          "q9",
          "q91",
          "q93",
          "q97"
        ],
        "avoid_when": "Applying or_to_union to queries similar to q10, q12, q13, q16, q18, q19, q26, q28, q34, q36, q40, q41, q45, q46, q47, q48, q52, q53, q57, q61, q63, q68, q73, q78, q79, q82, q85, q9, q91, q93, q97"
      },
      {
        "id": "regression_prefetch_fact_join",
        "name": "Regression: Prefetch Fact Join",
        "mechanism": "Regression from prefetch_fact_join",
        "observed_regressions": [
          0.02378715331595073,
          0.06609768032897448,
          0.2737191519859518,
          0.30417633743931327,
          0.4148215522518359,
          0.4383791726004965,
          0.5543247273702756,
          0.7040641626513594,
          0.7605598272779096,
          0.7673710605756556,
          0.7721820913956727,
          0.7846985263859467,
          0.7952378346037556,
          0.8060756907086735,
          0.8453297426969942,
          0.8663232174945078,
          0.8888041222575703,
          0.8949193586213647,
          0.9288059608826069,
          0.935171798375209,
          0.9391534520661379,
          0.9404771309686327,
          0.9412084328869753,
          0.9474074220776305
        ],
        "queries": [
          "q12",
          "q13",
          "q23b",
          "q26",
          "q29",
          "q31",
          "q32",
          "q4",
          "q45",
          "q46",
          "q47",
          "q51",
          "q58",
          "q71",
          "q72",
          "q74",
          "q8",
          "q9",
          "q90",
          "q91",
          "q93",
          "q94",
          "q96"
        ],
        "avoid_when": "Applying prefetch_fact_join to queries similar to q12, q13, q23b, q26, q29, q31, q32, q4, q45, q46, q47, q51, q58, q71, q72, q74, q8, q9, q90, q91, q93, q94, q96"
      },
      {
        "id": "regression_pushdown",
        "name": "Regression: Pushdown",
        "mechanism": "Regression from pushdown",
        "observed_regressions": [
          0.08910858289023524,
          0.11635708375593647,
          0.23213018116120565,
          0.27308371347813115,
          0.28046725155592,
          0.3229199365398751,
          0.4244512598812492,
          0.4601310279423135,
          0.48266741213868486,
          0.5220614546094987,
          0.5385947431743382,
          0.5657553687776862,
          0.6,
          0.6240867107822041,
          0.7748759245201149,
          0.7776832286886657,
          0.8495948891909539,
          0.9031767365939561,
          0.9040844159797201,
          0.9150122039319587,
          0.9170169665641419,
          0.9173889863571969,
          0.9326045198102668,
          0.9362745705042335,
          0.94,
          0.9424943442606806,
          0.9425269567514657,
          0.9440328164828282
        ],
        "queries": [
          "q13",
          "q14",
          "q23",
          "q25",
          "q31",
          "q39",
          "q4",
          "q47",
          "q58",
          "q60",
          "q61",
          "q64",
          "q7",
          "q71",
          "q75",
          "q77",
          "q79",
          "q81",
          "q85",
          "q89",
          "q9"
        ],
        "avoid_when": "Applying pushdown to queries similar to q13, q14, q23, q25, q31, q39, q4, q47, q58, q60, q61, q64, q7, q71, q75, q77, q79, q81, q85, q89, q9"
      },
      {
        "id": "regression_single_pass_aggregation",
        "name": "Regression: Single Pass Aggregation",
        "mechanism": "Regression from single_pass_aggregation",
        "observed_regressions": [
          0.09100442704457776,
          0.5734448387365535,
          0.6673221626826688,
          0.813655431665708,
          0.9343497560793093,
          0.9378652321371421
        ],
        "queries": [
          "q11",
          "q14",
          "q28",
          "q31",
          "q87",
          "q92"
        ],
        "avoid_when": "Applying single_pass_aggregation to queries similar to q11, q14, q28, q31, q87, q92"
      },
      {
        "id": "regression_union_cte_split",
        "name": "Regression: Union Cte Split",
        "mechanism": "Regression from union_cte_split",
        "observed_regressions": [
          0.45372288795293997
        ],
        "queries": [
          "q11"
        ],
        "avoid_when": "Applying union_cte_split to queries similar to q11"
      },
      {
        "id": "regression_unknown_regression",
        "name": "Regression: Unknown Regression",
        "mechanism": "Regression from unknown_regression",
        "observed_regressions": [
          0.75,
          0.9251978374944853,
          0.9440504599640206
        ],
        "queries": [
          "q61",
          "q70",
          "q73"
        ],
        "avoid_when": "Applying unknown_regression to queries similar to q61, q70, q73"
      },
      {
        "id": "error_execution",
        "name": "Error Pattern: Execution",
        "mechanism": "Not implemented Error: Non-inner join on correlated columns not supported",
        "observed_regressions": [
          0.0
        ],
        "queries": [
          "q31"
        ],
        "avoid_when": "Watch for execution errors when rewriting queries with complex joins/aliases"
      },
      {
        "id": "error_semantic",
        "name": "Error Pattern: Semantic",
        "mechanism": "Binder Error: Referenced column \"ss_net_profit\" not found in FROM clause!\nCandidate bindings: \"ca_gmt_offset\", \"ca_suite_number\", \"ca_location_type\", \"ca_street_type\", \"ca_street_number\"\n\nLINE 11:         (ca_state IN ('SD', 'KS', 'MI') AND ss_net_profit BETWEEN 100 AND 200)\n                                                     ^",
        "observed_regressions": [
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0
        ],
        "queries": [
          "q10",
          "q13",
          "q14",
          "q15",
          "q16",
          "q17",
          "q18",
          "q23",
          "q23a",
          "q23b",
          "q24",
          "q25",
          "q27",
          "q29",
          "q30",
          "q32",
          "q34",
          "q39",
          "q4",
          "q44",
          "q45",
          "q46",
          "q48",
          "q5",
          "q50",
          "q54",
          "q56",
          "q58",
          "q6",
          "q61",
          "q67",
          "q70",
          "q72",
          "q74",
          "q77",
          "q8",
          "q81",
          "q85",
          "q89",
          "q9",
          "q90",
          "q92",
          "q93"
        ],
        "avoid_when": "Watch for semantic errors when rewriting queries with complex joins/aliases"
      },
      {
        "id": "error_syntax",
        "name": "Error Pattern: Syntax",
        "mechanism": "Parser Error: syntax error at or near \"WHERE\"\n\nLINE 22:     WHERE cd_marital_status IN ('D', 'S', 'M')\n             ^",
        "observed_regressions": [
          0.0,
          0.0
        ],
        "queries": [
          "q13",
          "q22"
        ],
        "avoid_when": "Watch for syntax errors when rewriting queries with complex joins/aliases"
      },
      {
        "id": "semantic_mismatch_date_cte_isolate",
        "name": "Semantic Mismatch: Date Cte Isolate",
        "mechanism": "Rewrite changed query semantics \u2014 different row counts or values returned",
        "observed_regressions": [
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0,
          0.0
        ],
        "queries": [
          "q23",
          "q25",
          "q37",
          "q39",
          "q64",
          "q81",
          "q98"
        ],
        "avoid_when": "Applying date_cte_isolate to queries where semantic equivalence is hard to verify"
      },
      {
        "id": "semantic_mismatch_decorrelate",
        "name": "Semantic Mismatch: Decorrelate",
        "mechanism": "Rewrite changed query semantics \u2014 different row counts or values returned",
        "observed_regressions": [
          0.0,
          0.0,
          0.0,
          0.0
        ],
        "queries": [
          "q2",
          "q30",
          "q41",
          "q49"
        ],
        "avoid_when": "Applying decorrelate to queries where semantic equivalence is hard to verify"
      },
      {
        "id": "semantic_mismatch_dimension_cte_isolate",
        "name": "Semantic Mismatch: Dimension Cte Isolate",
        "mechanism": "Rewrite changed query semantics \u2014 different row counts or values returned",
        "observed_regressions": [
          0.0
        ],
        "queries": [
          "q24"
        ],
        "avoid_when": "Applying dimension_cte_isolate to queries where semantic equivalence is hard to verify"
      },
      {
        "id": "semantic_mismatch_early_filter",
        "name": "Semantic Mismatch: Early Filter",
        "mechanism": "Rewrite changed query semantics \u2014 different row counts or values returned",
        "observed_regressions": [
          0.0,
          0.0,
          0.0
        ],
        "queries": [
          "q2",
          "q23",
          "q6"
        ],
        "avoid_when": "Applying early_filter to queries where semantic equivalence is hard to verify"
      },
      {
        "id": "semantic_mismatch_intersect_to_exists",
        "name": "Semantic Mismatch: Intersect To Exists",
        "mechanism": "Rewrite changed query semantics \u2014 different row counts or values returned",
        "observed_regressions": [
          0.0
        ],
        "queries": [
          "q23"
        ],
        "avoid_when": "Applying intersect_to_exists to queries where semantic equivalence is hard to verify"
      },
      {
        "id": "semantic_mismatch_materialize_cte",
        "name": "Semantic Mismatch: Materialize Cte",
        "mechanism": "Rewrite changed query semantics \u2014 different row counts or values returned",
        "observed_regressions": [
          0.0
        ],
        "queries": [
          "q2"
        ],
        "avoid_when": "Applying materialize_cte to queries where semantic equivalence is hard to verify"
      },
      {
        "id": "semantic_mismatch_multi_dimension_prefetch",
        "name": "Semantic Mismatch: Multi Dimension Prefetch",
        "mechanism": "Rewrite changed query semantics \u2014 different row counts or values returned",
        "observed_regressions": [
          0.0
        ],
        "queries": [
          "q24"
        ],
        "avoid_when": "Applying multi_dimension_prefetch to queries where semantic equivalence is hard to verify"
      },
      {
        "id": "semantic_mismatch_or_to_union",
        "name": "Semantic Mismatch: Or To Union",
        "mechanism": "Rewrite changed query semantics \u2014 different row counts or values returned",
        "observed_regressions": [
          0.0,
          0.0,
          0.0
        ],
        "queries": [
          "q39",
          "q85",
          "q91"
        ],
        "avoid_when": "Applying or_to_union to queries where semantic equivalence is hard to verify"
      },
      {
        "id": "semantic_mismatch_prefetch_fact_join",
        "name": "Semantic Mismatch: Prefetch Fact Join",
        "mechanism": "Rewrite changed query semantics \u2014 different row counts or values returned",
        "observed_regressions": [
          0.0,
          0.0,
          0.0,
          0.0,
          0.0
        ],
        "queries": [
          "q23",
          "q24",
          "q39",
          "q49"
        ],
        "avoid_when": "Applying prefetch_fact_join to queries where semantic equivalence is hard to verify"
      },
      {
        "id": "semantic_mismatch_pushdown",
        "name": "Semantic Mismatch: Pushdown",
        "mechanism": "Rewrite changed query semantics \u2014 different row counts or values returned",
        "observed_regressions": [
          0.0,
          0.0,
          0.0,
          0.0
        ],
        "queries": [
          "q24",
          "q30",
          "q39",
          "q84"
        ],
        "avoid_when": "Applying pushdown to queries where semantic equivalence is hard to verify"
      },
      {
        "id": "semantic_mismatch_single_pass_aggregation",
        "name": "Semantic Mismatch: Single Pass Aggregation",
        "mechanism": "Rewrite changed query semantics \u2014 different row counts or values returned",
        "observed_regressions": [
          0.0
        ],
        "queries": [
          "q2"
        ],
        "avoid_when": "Applying single_pass_aggregation to queries where semantic equivalence is hard to verify"
      },
      {
        "id": "semantic_mismatch_union_cte_split",
        "name": "Semantic Mismatch: Union Cte Split",
        "mechanism": "Rewrite changed query semantics \u2014 different row counts or values returned",
        "observed_regressions": [
          0.0,
          0.0
        ],
        "queries": [
          "q2"
        ],
        "avoid_when": "Applying union_cte_split to queries where semantic equivalence is hard to verify"
      }
    ]
  },
  "semantic_intents": {
    "query_id": "q10",
    "query_intent": "Profile customer demographics for selected counties by counting customers who bought in stores during Jan-Apr 2001 and also bought through either web or catalog in the same period.",
    "dag_nodes": [
      {
        "node_id": "main_query",
        "node_type": "main",
        "depth": 0,
        "intent": "Join customer, address, and demographics; filter to the county list; enforce time-window purchase existence in store sales plus (web OR catalog) via EXISTS subqueries; then group and count by demographic dimensions."
      }
    ]
  },
  "matched_examples": [
    {
      "id": "composite_decorrelate_union",
      "name": "Decorrelate EXISTS + OR-to-UNION Composite",
      "description": "Decorrelate multiple correlated EXISTS subqueries into pre-materialized DISTINCT customer CTEs with a shared date filter, and replace OR(EXISTS a, EXISTS b) with UNION of key sets",
      "verified_speedup": "2.42x",
      "principle": "Composite Decorrelation: when multiple correlated EXISTS share common filters, extract shared dimensions into a single CTE and decorrelate the EXISTS checks into pre-materialized key sets joined via UNION.",
      "example": {
        "opportunity": "DECORRELATE + DATE_CTE_ISOLATE + OR_TO_UNION",
        "input_slice": "[main_query]:\nSELECT ca_state, cd_gender, cd_marital_status, cd_dep_count, count(*) cnt1, ...\nFROM customer c, customer_address ca, customer_demographics\nWHERE c.c_current_addr_sk = ca.ca_address_sk\n  AND cd_demo_sk = c.c_current_cdemo_sk\n  AND EXISTS (SELECT * FROM store_sales, date_dim\n              WHERE c.c_customer_sk = ss_customer_sk\n              AND ss_sold_date_sk = d_date_sk AND d_year = 2001 AND d_qoy < 4)\n  AND (EXISTS (SELECT * FROM web_sales, date_dim\n               WHERE c.c_customer_sk = ws_bill_customer_sk\n               AND ws_sold_date_sk = d_date_sk AND d_year = 2001 AND d_qoy < 4)\n       OR EXISTS (SELECT * FROM catalog_sales, date_dim\n                  WHERE c.c_customer_sk = cs_ship_customer_sk\n                  AND cs_sold_date_sk = d_date_sk AND d_year = 2001 AND d_qoy < 4))\nGROUP BY ... ORDER BY ... LIMIT 100",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "decorrelate",
              "nodes": {
                "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_year = 2001 AND d_qoy < 4",
                "store_customers": "SELECT DISTINCT ss_customer_sk FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk",
                "web_customers": "SELECT DISTINCT ws_bill_customer_sk FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk",
                "catalog_customers": "SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk",
                "web_or_catalog_customers": "SELECT ws_bill_customer_sk AS customer_sk FROM web_customers UNION SELECT cs_ship_customer_sk AS customer_sk FROM catalog_customers",
                "main_query": "SELECT ca_state, cd_gender, cd_marital_status, cd_dep_count, COUNT(*) AS cnt1, MAX(cd_dep_count), SUM(cd_dep_count), MAX(cd_dep_count), cd_dep_employed_count, COUNT(*) AS cnt2, MAX(cd_dep_employed_count), SUM(cd_dep_employed_count), MAX(cd_dep_employed_count), cd_dep_college_count, COUNT(*) AS cnt3, MAX(cd_dep_college_count), SUM(cd_dep_college_count), MAX(cd_dep_college_count) FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics ON cd_demo_sk = c.c_current_cdemo_sk JOIN store_customers AS sc ON c.c_customer_sk = sc.ss_customer_sk JOIN web_or_catalog_customers AS wcc ON c.c_customer_sk = wcc.customer_sk GROUP BY ca_state, cd_gender, cd_marital_status, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY ca_state, cd_gender, cd_marital_status, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100"
              },
              "invariants_kept": [
                "same result rows",
                "same ordering",
                "same column output"
              ],
              "expected_speedup": "2.40x",
              "risk": "low"
            }
          ]
        },
        "key_insight": "Principle: Composite Decorrelation \u2014 when multiple correlated EXISTS share common filters, extract shared dimensions once, decorrelate each EXISTS into a DISTINCT CTE, and replace OR(EXISTS) with UNION at the set level. Here: (1) shared date filter CTE, (2) each EXISTS becomes SELECT DISTINCT customer_sk joined with filtered_dates, (3) OR(EXISTS web, EXISTS catalog) becomes UNION of key CTEs. Works because the query only checks membership, which DISTINCT + JOIN achieves."
      },
      "original_sql": "select  \n  ca_state,\n  cd_gender,\n  cd_marital_status,\n  cd_dep_count,\n  count(*) cnt1,\n  max(cd_dep_count),\n  sum(cd_dep_count),\n  max(cd_dep_count),\n  cd_dep_employed_count,\n  count(*) cnt2,\n  max(cd_dep_employed_count),\n  sum(cd_dep_employed_count),\n  max(cd_dep_employed_count),\n  cd_dep_college_count,\n  count(*) cnt3,\n  max(cd_dep_college_count),\n  sum(cd_dep_college_count),\n  max(cd_dep_college_count)\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  cd_demo_sk = c.c_current_cdemo_sk and \n  exists (select *\n          from store_sales,date_dim\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 2001 and\n                d_qoy < 4) and\n   (exists (select *\n            from web_sales,date_dim\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 2001 and\n                  d_qoy < 4) or \n    exists (select * \n            from catalog_sales,date_dim\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 2001 and\n                  d_qoy < 4))\n group by ca_state,\n          cd_gender,\n          cd_marital_status,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\n order by ca_state,\n          cd_gender,\n          cd_marital_status,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\n LIMIT 100;",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001 AND d_qoy < 4), store_customers AS (SELECT DISTINCT ss_customer_sk FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk), web_customers AS (SELECT DISTINCT ws_bill_customer_sk FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk), catalog_customers AS (SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk), web_or_catalog_customers AS (SELECT ws_bill_customer_sk AS customer_sk FROM web_customers UNION SELECT cs_ship_customer_sk AS customer_sk FROM catalog_customers)\nSELECT ca_state, cd_gender, cd_marital_status, cd_dep_count, COUNT(*) AS cnt1, MAX(cd_dep_count), SUM(cd_dep_count), MAX(cd_dep_count), cd_dep_employed_count, COUNT(*) AS cnt2, MAX(cd_dep_employed_count), SUM(cd_dep_employed_count), MAX(cd_dep_employed_count), cd_dep_college_count, COUNT(*) AS cnt3, MAX(cd_dep_college_count), SUM(cd_dep_college_count), MAX(cd_dep_college_count) FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics ON cd_demo_sk = c.c_current_cdemo_sk JOIN store_customers AS sc ON c.c_customer_sk = sc.ss_customer_sk JOIN web_or_catalog_customers AS wcc ON c.c_customer_sk = wcc.customer_sk GROUP BY ca_state, cd_gender, cd_marital_status, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY ca_state, cd_gender, cd_marital_status, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "optimized_source": "dsr1",
      "sf10_rows_match": true
    },
    {
      "id": "multi_date_range_cte",
      "name": "Multi Date Range CTE",
      "description": "When query uses multiple date_dim aliases with different filters (d1, d2, d3), create separate CTEs for each date range and pre-join with fact tables",
      "verified_speedup": "2.35x",
      "principle": "Early Selection per Alias: when a query joins the same dimension table multiple times with different filters (d1, d2, d3), create separate CTEs for each filter and pre-join with fact tables to reduce rows entering the main join.",
      "example": {
        "opportunity": "MULTI DATE RANGE CTE",
        "input_slice": "SELECT i_item_id, i_item_desc, s_store_id, s_store_name,\n  sum(ss_quantity) AS store_sales_quantity,\n  sum(sr_return_quantity) AS store_returns_quantity,\n  sum(cs_quantity) AS catalog_sales_quantity\nFROM store_sales, store_returns, catalog_sales,\n  date_dim d1, date_dim d2, date_dim d3, store, item\nWHERE d1.d_moy = 9 AND d1.d_year = 1999 AND d1.d_date_sk = ss_sold_date_sk\n  AND d2.d_moy BETWEEN 9 AND 12 AND d2.d_year = 1999 AND sr_returned_date_sk = d2.d_date_sk\n  AND d3.d_year IN (1999, 2000, 2001) AND cs_sold_date_sk = d3.d_date_sk\n  AND ss_customer_sk = sr_customer_sk AND ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number\n  AND sr_customer_sk = cs_bill_customer_sk AND sr_item_sk = cs_item_sk\nGROUP BY i_item_id, i_item_desc, s_store_id, s_store_name LIMIT 100",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "multi_date_range_cte",
              "nodes": {
                "d1_dates": "SELECT d_date_sk FROM date_dim WHERE d_moy = 9 AND d_year = 1999",
                "d2_dates": "SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 9 AND 12 AND d_year = 1999",
                "d3_dates": "SELECT d_date_sk FROM date_dim WHERE d_year IN (1999, 2000, 2001)",
                "filtered_store_sales": "SELECT ss_item_sk, ss_customer_sk, ss_ticket_number, ss_store_sk, ss_quantity FROM store_sales JOIN d1_dates ON store_sales.ss_sold_date_sk = d1_dates.d_date_sk",
                "filtered_store_returns": "SELECT sr_item_sk, sr_customer_sk, sr_ticket_number, sr_return_quantity FROM store_returns JOIN d2_dates ON store_returns.sr_returned_date_sk = d2_dates.d_date_sk",
                "filtered_catalog_sales": "SELECT cs_item_sk, cs_bill_customer_sk, cs_quantity FROM catalog_sales JOIN d3_dates ON catalog_sales.cs_sold_date_sk = d3_dates.d_date_sk",
                "main_query": "SELECT i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name, SUM(fss.ss_quantity) AS store_sales_quantity, SUM(fsr.sr_return_quantity) AS store_returns_quantity, SUM(fcs.cs_quantity) AS catalog_sales_quantity FROM filtered_store_sales AS fss JOIN filtered_store_returns AS fsr ON fss.ss_customer_sk = fsr.sr_customer_sk AND fss.ss_item_sk = fsr.sr_item_sk AND fss.ss_ticket_number = fsr.sr_ticket_number JOIN filtered_catalog_sales AS fcs ON fsr.sr_customer_sk = fcs.cs_bill_customer_sk AND fsr.sr_item_sk = fcs.cs_item_sk JOIN store AS s ON fss.ss_store_sk = s.s_store_sk JOIN item AS i ON fss.ss_item_sk = i.i_item_sk GROUP BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name ORDER BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name LIMIT 100"
              },
              "invariants_kept": [
                "same result rows",
                "same ordering",
                "same column output"
              ],
              "expected_speedup": "2.35x",
              "risk": "low"
            }
          ]
        },
        "key_insight": "Principle: Early Selection per Alias \u2014 when a query joins the same dimension table multiple times with different filters (d1, d2, d3 pattern), create separate filtered CTEs for each alias. Pre-join each date CTE with its corresponding fact table reference. This filters fact rows early before the expensive multi-way join, avoiding repeated full dimension scans."
      },
      "original_sql": "select  \n     i_item_id\n    ,i_item_desc\n    ,s_store_id\n    ,s_store_name\n    ,avg(ss_quantity)        as store_sales_quantity\n    ,avg(sr_return_quantity) as store_returns_quantity\n    ,avg(cs_quantity)        as catalog_sales_quantity\n from\n    store_sales\n   ,store_returns\n   ,catalog_sales\n   ,date_dim             d1\n   ,date_dim             d2\n   ,date_dim             d3\n   ,store\n   ,item\n where\n     d1.d_moy               = 4 \n and d1.d_year              = 1999\n and d1.d_date_sk           = ss_sold_date_sk\n and i_item_sk              = ss_item_sk\n and s_store_sk             = ss_store_sk\n and ss_customer_sk         = sr_customer_sk\n and ss_item_sk             = sr_item_sk\n and ss_ticket_number       = sr_ticket_number\n and sr_returned_date_sk    = d2.d_date_sk\n and d2.d_moy               between 4 and  4 + 3 \n and d2.d_year              = 1999\n and sr_customer_sk         = cs_bill_customer_sk\n and sr_item_sk             = cs_item_sk\n and cs_sold_date_sk        = d3.d_date_sk     \n and d3.d_year              in (1999,1999+1,1999+2)\n group by\n    i_item_id\n   ,i_item_desc\n   ,s_store_id\n   ,s_store_name\n order by\n    i_item_id \n   ,i_item_desc\n   ,s_store_id\n   ,s_store_name\n LIMIT 100;",
      "optimized_sql": "WITH d1_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_moy = 4 AND d_year = 1999), d2_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 4 AND 7 AND d_year = 1999), d3_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_year IN (1999, 2000, 2001)), filtered_store_sales AS (SELECT ss.ss_item_sk, ss.ss_store_sk, ss.ss_customer_sk, ss.ss_ticket_number, ss.ss_quantity FROM store_sales AS ss JOIN d1_filtered AS d1 ON ss.ss_sold_date_sk = d1.d_date_sk), filtered_store_returns AS (SELECT sr.sr_customer_sk, sr.sr_item_sk, sr.sr_ticket_number, sr.sr_return_quantity FROM store_returns AS sr JOIN d2_filtered AS d2 ON sr.sr_returned_date_sk = d2.d_date_sk), filtered_catalog_sales AS (SELECT cs.cs_bill_customer_sk, cs.cs_item_sk, cs.cs_quantity FROM catalog_sales AS cs JOIN d3_filtered AS d3 ON cs.cs_sold_date_sk = d3.d_date_sk)\nSELECT i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name, AVG(ss.ss_quantity) AS store_sales_quantity, AVG(sr.sr_return_quantity) AS store_returns_quantity, AVG(cs.cs_quantity) AS catalog_sales_quantity FROM filtered_store_sales AS ss JOIN item AS i ON ss.ss_item_sk = i.i_item_sk JOIN store AS s ON ss.ss_store_sk = s.s_store_sk JOIN filtered_store_returns AS sr ON ss.ss_customer_sk = sr.sr_customer_sk AND ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number JOIN filtered_catalog_sales AS cs ON sr.sr_customer_sk = cs.cs_bill_customer_sk AND sr.sr_item_sk = cs.cs_item_sk GROUP BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name ORDER BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name LIMIT 100;",
      "optimized_source": "kimi"
    },
    {
      "id": "shared_dimension_multi_channel",
      "name": "Shared Dimension CTEs Across Multi-Channel Queries",
      "description": "Extract shared dimension filters (date, item, promotion) into CTEs when multiple channel CTEs (store/catalog/web) apply identical filters independently",
      "verified_speedup": "1.30x",
      "principle": "Shared Dimension Extraction: when multiple channel CTEs (store/catalog/web) apply identical dimension filters, extract those shared filters into one CTE and reference it from each channel. Avoids redundant dimension scans.",
      "example": {
        "opportunity": "DIMENSION_CTE_ISOLATE + PREFETCH_FACT_JOIN",
        "input_slice": "[ssr] type=cte:\nSELECT s_store_id AS store_id, SUM(ss_ext_sales_price) AS sales, ...\nFROM store_sales LEFT OUTER JOIN store_returns ON (...), date_dim, store, item, promotion\nWHERE ss_sold_date_sk = d_date_sk\n  AND d_date BETWEEN '1998-08-28' AND '1998-08-28' + 30 days\n  AND ss_item_sk = i_item_sk AND i_current_price > 50\n  AND ss_promo_sk = p_promo_sk AND p_channel_tv = 'N'\nGROUP BY s_store_id\n\n[wsr] type=cte:\nSELECT web_site_id, SUM(ws_ext_sales_price) AS sales, ...\nFROM web_sales LEFT OUTER JOIN web_returns ON (...), date_dim, web_site, item, promotion\nWHERE ws_sold_date_sk = d_date_sk\n  AND d_date BETWEEN '1998-08-28' AND '1998-08-28' + 30 days\n  AND ws_item_sk = i_item_sk AND i_current_price > 50\n  AND ws_promo_sk = p_promo_sk AND p_channel_tv = 'N'\nGROUP BY web_site_id\n\n[csr] type=cte: (same pattern for catalog_sales)\n\n[main_query]: SELECT channel, id, SUM(sales), SUM(returns), SUM(profit)\nFROM (ssr UNION ALL csr UNION ALL wsr) GROUP BY ROLLUP(channel, id)",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "dimension_cte_isolate",
              "nodes": {
                "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1998-08-28' AS DATE) AND (CAST('1998-08-28' AS DATE) + INTERVAL '30' DAY)",
                "filtered_items": "SELECT i_item_sk FROM item WHERE i_current_price > 50",
                "filtered_promotions": "SELECT p_promo_sk FROM promotion WHERE p_channel_tv = 'N'",
                "prefiltered_store_sales": "SELECT ss_item_sk, ss_store_sk, ss_ticket_number, ss_ext_sales_price, ss_net_profit FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN filtered_items ON ss_item_sk = i_item_sk JOIN filtered_promotions ON ss_promo_sk = p_promo_sk",
                "prefiltered_web_sales": "SELECT ws_item_sk, ws_web_site_sk, ws_order_number, ws_ext_sales_price, ws_net_profit FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk JOIN filtered_items ON ws_item_sk = i_item_sk JOIN filtered_promotions ON ws_promo_sk = p_promo_sk",
                "ssr": "SELECT s_store_id AS store_id, SUM(ss_ext_sales_price) AS sales, SUM(COALESCE(sr_return_amt, 0)) AS returns, SUM(ss_net_profit - COALESCE(sr_net_loss, 0)) AS profit FROM prefiltered_store_sales LEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number) JOIN store ON ss_store_sk = s_store_sk GROUP BY s_store_id",
                "wsr": "SELECT web_site_id, SUM(ws_ext_sales_price) AS sales, SUM(COALESCE(wr_return_amt, 0)) AS returns, SUM(ws_net_profit - COALESCE(wr_net_loss, 0)) AS profit FROM prefiltered_web_sales LEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number) JOIN web_site ON ws_web_site_sk = web_site_sk GROUP BY web_site_id"
              },
              "invariants_kept": [
                "same result rows",
                "same ordering",
                "same column output",
                "same ROLLUP semantics"
              ],
              "expected_speedup": "1.30x",
              "risk": "low"
            }
          ]
        },
        "key_insight": "Principle: Shared Dimension Extraction \u2014 when multiple channel CTEs (store/catalog/web) apply identical dimension filters, extract those shared filters into common dimension CTEs and reference them from each channel. This eliminates redundant dimension scans across channels. Here: shared date, item, and promotion filters extracted once, then pre-joined with each channel's fact table. Only apply where join structure is straightforward."
      },
      "original_sql": "with ssr as\n (select  s_store_id as store_id,\n          sum(ss_ext_sales_price) as sales,\n          sum(coalesce(sr_return_amt, 0)) as \"returns\",\n          sum(ss_net_profit - coalesce(sr_net_loss, 0)) as profit\n  from store_sales left outer join store_returns on\n         (ss_item_sk = sr_item_sk and ss_ticket_number = sr_ticket_number),\n     date_dim,\n     store,\n     item,\n     promotion\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('1998-08-28' as date) \n                  and (cast('1998-08-28' as date) + INTERVAL 30 DAY)\n       and ss_store_sk = s_store_sk\n       and ss_item_sk = i_item_sk\n       and i_current_price > 50\n       and ss_promo_sk = p_promo_sk\n       and p_channel_tv = 'N'\n group by s_store_id)\n ,\n csr as\n (select  cp_catalog_page_id as catalog_page_id,\n          sum(cs_ext_sales_price) as sales,\n          sum(coalesce(cr_return_amount, 0)) as \"returns\",\n          sum(cs_net_profit - coalesce(cr_net_loss, 0)) as profit\n  from catalog_sales left outer join catalog_returns on\n         (cs_item_sk = cr_item_sk and cs_order_number = cr_order_number),\n     date_dim,\n     catalog_page,\n     item,\n     promotion\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('1998-08-28' as date)\n                  and (cast('1998-08-28' as date) + INTERVAL 30 DAY)\n        and cs_catalog_page_sk = cp_catalog_page_sk\n       and cs_item_sk = i_item_sk\n       and i_current_price > 50\n       and cs_promo_sk = p_promo_sk\n       and p_channel_tv = 'N'\ngroup by cp_catalog_page_id)\n ,\n wsr as\n (select  web_site_id,\n          sum(ws_ext_sales_price) as sales,\n          sum(coalesce(wr_return_amt, 0)) as \"returns\",\n          sum(ws_net_profit - coalesce(wr_net_loss, 0)) as profit\n  from web_sales left outer join web_returns on\n         (ws_item_sk = wr_item_sk and ws_order_number = wr_order_number),\n     date_dim,\n     web_site,\n     item,\n     promotion\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('1998-08-28' as date)\n                  and (cast('1998-08-28' as date) + INTERVAL 30 DAY)\n        and ws_web_site_sk = web_site_sk\n       and ws_item_sk = i_item_sk\n       and i_current_price > 50\n       and ws_promo_sk = p_promo_sk\n       and p_channel_tv = 'N'\ngroup by web_site_id)\n  select channel\n        , id\n        , sum(sales) as sales\n        , sum(\"returns\") as \"returns\"\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || store_id as id\n        , sales\n        , \"returns\"\n        , profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || catalog_page_id as id\n        , sales\n        , \"returns\"\n        , profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , \"returns\"\n        , profit\n from   wsr\n ) x\n group by rollup (channel, id)\n order by channel\n         ,id\n LIMIT 100;",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1998-08-28' AS DATE) AND (CAST('1998-08-28' AS DATE) + INTERVAL '30' DAY)), filtered_items AS (SELECT i_item_sk FROM item WHERE i_current_price > 50), filtered_promotions AS (SELECT p_promo_sk FROM promotion WHERE p_channel_tv = 'N'), prefiltered_store_sales AS (SELECT ss_item_sk, ss_store_sk, ss_ticket_number, ss_ext_sales_price, ss_net_profit FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN filtered_items ON ss_item_sk = i_item_sk JOIN filtered_promotions ON ss_promo_sk = p_promo_sk), prefiltered_web_sales AS (SELECT ws_item_sk, ws_web_site_sk, ws_order_number, ws_ext_sales_price, ws_net_profit FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk JOIN filtered_items ON ws_item_sk = i_item_sk JOIN filtered_promotions ON ws_promo_sk = p_promo_sk), ssr AS (SELECT s_store_id AS store_id, SUM(ss_ext_sales_price) AS sales, SUM(COALESCE(sr_return_amt, 0)) AS \"returns\", SUM(ss_net_profit - COALESCE(sr_net_loss, 0)) AS profit FROM prefiltered_store_sales LEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number) JOIN store ON ss_store_sk = s_store_sk GROUP BY s_store_id), wsr AS (SELECT web_site_id, SUM(ws_ext_sales_price) AS sales, SUM(COALESCE(wr_return_amt, 0)) AS \"returns\", SUM(ws_net_profit - COALESCE(wr_net_loss, 0)) AS profit FROM prefiltered_web_sales LEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number) JOIN web_site ON ws_web_site_sk = web_site_sk GROUP BY web_site_id), csr AS (SELECT cp_catalog_page_id AS catalog_page_id, SUM(cs_ext_sales_price) AS sales, SUM(COALESCE(cr_return_amount, 0)) AS \"returns\", SUM(cs_net_profit - COALESCE(cr_net_loss, 0)) AS profit FROM catalog_sales LEFT OUTER JOIN catalog_returns ON (cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number), date_dim, catalog_page, item, promotion WHERE cs_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('1998-08-28' AS DATE) AND (CAST('1998-08-28' AS DATE) + INTERVAL '30' DAY) AND cs_catalog_page_sk = cp_catalog_page_sk AND cs_item_sk = i_item_sk AND i_current_price > 50 AND cs_promo_sk = p_promo_sk AND p_channel_tv = 'N' GROUP BY cp_catalog_page_id)\nSELECT channel, id, SUM(sales) AS sales, SUM(\"returns\") AS \"returns\", SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, \"returns\", profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, \"returns\", profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, \"returns\", profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100;",
      "optimized_source": "dsr1",
      "sf10_rows_match": true
    },
    {
      "id": "intersect_to_exists",
      "name": "INTERSECT to EXISTS",
      "description": "Convert INTERSECT subquery pattern to multiple EXISTS clauses for better join planning",
      "verified_speedup": "1.83x",
      "principle": "Semi-Join Short-Circuit: replace INTERSECT with EXISTS to avoid full materialization and sorting. INTERSECT must compute complete result sets before intersecting; EXISTS stops at the first match per row, enabling semi-join optimizations.",
      "example": {
        "opportunity": "INTERSECT_TO_EXISTS",
        "input_slice": "[cross_items] type=cte:\nSELECT i_item_sk AS ss_item_sk FROM item,\n  (SELECT iss.i_brand_id, iss.i_class_id, iss.i_category_id\n   FROM store_sales, item iss, date_dim d1\n   WHERE ss_item_sk = iss.i_item_sk AND ss_sold_date_sk = d1.d_date_sk AND d1.d_year BETWEEN 1999 AND 2001\n   INTERSECT\n   SELECT ics.i_brand_id, ics.i_class_id, ics.i_category_id\n   FROM catalog_sales, item ics, date_dim d2\n   WHERE cs_item_sk = ics.i_item_sk AND cs_sold_date_sk = d2.d_date_sk AND d2.d_year BETWEEN 1999 AND 2001\n   INTERSECT\n   SELECT iws.i_brand_id, iws.i_class_id, iws.i_category_id\n   FROM web_sales, item iws, date_dim d3\n   WHERE ws_item_sk = iws.i_item_sk AND ws_sold_date_sk = d3.d_date_sk AND d3.d_year BETWEEN 1999 AND 2001)\nWHERE i_brand_id = brand_id AND i_class_id = class_id AND i_category_id = category_id",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "intersect_to_exists",
              "nodes": {
                "cross_items_flat": "SELECT i.i_item_sk AS ss_item_sk FROM item i WHERE EXISTS (SELECT 1 FROM store_sales, item iss, date_dim d1 WHERE ss_item_sk = iss.i_item_sk AND ss_sold_date_sk = d1.d_date_sk AND d1.d_year BETWEEN 1999 AND 2001 AND iss.i_brand_id = i.i_brand_id AND iss.i_class_id = i.i_class_id AND iss.i_category_id = i.i_category_id) AND EXISTS (SELECT 1 FROM catalog_sales, item ics, date_dim d2 WHERE cs_item_sk = ics.i_item_sk AND cs_sold_date_sk = d2.d_date_sk AND d2.d_year BETWEEN 1999 AND 2001 AND ics.i_brand_id = i.i_brand_id AND ics.i_class_id = i.i_class_id AND ics.i_category_id = i.i_category_id) AND EXISTS (SELECT 1 FROM web_sales, item iws, date_dim d3 WHERE ws_item_sk = iws.i_item_sk AND ws_sold_date_sk = d3.d_date_sk AND d3.d_year BETWEEN 1999 AND 2001 AND iws.i_brand_id = i.i_brand_id AND iws.i_class_id = i.i_class_id AND iws.i_category_id = i.i_category_id)",
                "main_query": "SELECT ... FROM ... WHERE i_item_sk IN (SELECT ss_item_sk FROM cross_items_flat) ..."
              },
              "invariants_kept": [
                "same result rows",
                "same columns",
                "same grouping"
              ],
              "expected_speedup": "1.83x",
              "risk": "low"
            }
          ]
        },
        "key_insight": "Principle: Semi-Join Short-Circuit \u2014 replace INTERSECT with EXISTS to avoid full materialization and sorting. INTERSECT must compute complete result sets before intersecting; EXISTS stops at the first match per row, enabling semi-join optimizations. Here: convert three INTERSECT subqueries to EXISTS clauses, allowing the optimizer to short-circuit and use index-based semi-joins."
      },
      "original_sql": "with  cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n     ,iss.i_class_id class_id\n     ,iss.i_category_id category_id\n from store_sales\n     ,item iss\n     ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n   and ss_sold_date_sk = d1.d_date_sk\n   and d1.d_year between 2000 AND 2000 + 2\n intersect \n select ics.i_brand_id\n     ,ics.i_class_id\n     ,ics.i_category_id\n from catalog_sales\n     ,item ics\n     ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n   and cs_sold_date_sk = d2.d_date_sk\n   and d2.d_year between 2000 AND 2000 + 2\n intersect\n select iws.i_brand_id\n     ,iws.i_class_id\n     ,iws.i_category_id\n from web_sales\n     ,item iws\n     ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n   and ws_sold_date_sk = d3.d_date_sk\n   and d3.d_year between 2000 AND 2000 + 2)\n where i_brand_id = brand_id\n      and i_class_id = class_id\n      and i_category_id = category_id\n),\n avg_sales as\n (select avg(quantity*list_price) average_sales\n  from (select ss_quantity quantity\n             ,ss_list_price list_price\n       from store_sales\n           ,date_dim\n       where ss_sold_date_sk = d_date_sk\n         and d_year between 2000 and 2000 + 2\n       union all \n       select cs_quantity quantity \n             ,cs_list_price list_price\n       from catalog_sales\n           ,date_dim\n       where cs_sold_date_sk = d_date_sk\n         and d_year between 2000 and 2000 + 2 \n       union all\n       select ws_quantity quantity\n             ,ws_list_price list_price\n       from web_sales\n           ,date_dim\n       where ws_sold_date_sk = d_date_sk\n         and d_year between 2000 and 2000 + 2) x)\n  select channel, i_brand_id,i_class_id,i_category_id,sum(sales), sum(number_sales)\n from(\n       select 'store' channel, i_brand_id,i_class_id\n             ,i_category_id,sum(ss_quantity*ss_list_price) sales\n             , count(*) number_sales\n       from store_sales\n           ,item\n           ,date_dim\n       where ss_item_sk in (select ss_item_sk from cross_items)\n         and ss_item_sk = i_item_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year = 2000+2 \n         and d_moy = 11\n       group by i_brand_id,i_class_id,i_category_id\n       having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)\n       union all\n       select 'catalog' channel, i_brand_id,i_class_id,i_category_id, sum(cs_quantity*cs_list_price) sales, count(*) number_sales\n       from catalog_sales\n           ,item\n           ,date_dim\n       where cs_item_sk in (select ss_item_sk from cross_items)\n         and cs_item_sk = i_item_sk\n         and cs_sold_date_sk = d_date_sk\n         and d_year = 2000+2 \n         and d_moy = 11\n       group by i_brand_id,i_class_id,i_category_id\n       having sum(cs_quantity*cs_list_price) > (select average_sales from avg_sales)\n       union all\n       select 'web' channel, i_brand_id,i_class_id,i_category_id, sum(ws_quantity*ws_list_price) sales , count(*) number_sales\n       from web_sales\n           ,item\n           ,date_dim\n       where ws_item_sk in (select ss_item_sk from cross_items)\n         and ws_item_sk = i_item_sk\n         and ws_sold_date_sk = d_date_sk\n         and d_year = 2000+2\n         and d_moy = 11\n       group by i_brand_id,i_class_id,i_category_id\n       having sum(ws_quantity*ws_list_price) > (select average_sales from avg_sales)\n ) y\n group by rollup (channel, i_brand_id,i_class_id,i_category_id)\n order by channel,i_brand_id,i_class_id,i_category_id\n LIMIT 100;",
      "optimized_sql": "WITH cross_items AS (SELECT i.i_item_sk AS ss_item_sk FROM item AS i WHERE EXISTS(SELECT 1 FROM store_sales, item AS iss, date_dim AS d1 WHERE ss_item_sk = iss.i_item_sk AND ss_sold_date_sk = d1.d_date_sk AND d1.d_year BETWEEN 2000 AND 2000 + 2 AND iss.i_brand_id = i.i_brand_id AND iss.i_class_id = i.i_class_id AND iss.i_category_id = i.i_category_id) AND EXISTS(SELECT 1 FROM catalog_sales, item AS ics, date_dim AS d2 WHERE cs_item_sk = ics.i_item_sk AND cs_sold_date_sk = d2.d_date_sk AND d2.d_year BETWEEN 2000 AND 2000 + 2 AND ics.i_brand_id = i.i_brand_id AND ics.i_class_id = i.i_class_id AND ics.i_category_id = i.i_category_id) AND EXISTS(SELECT 1 FROM web_sales, item AS iws, date_dim AS d3 WHERE ws_item_sk = iws.i_item_sk AND ws_sold_date_sk = d3.d_date_sk AND d3.d_year BETWEEN 2000 AND 2000 + 2 AND iws.i_brand_id = i.i_brand_id AND iws.i_class_id = i.i_class_id AND iws.i_category_id = i.i_category_id)), avg_sales AS (SELECT AVG(quantity * list_price) AS average_sales FROM (SELECT ss_quantity AS quantity, ss_list_price AS list_price FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_year BETWEEN 2000 AND 2000 + 2 UNION ALL SELECT cs_quantity AS quantity, cs_list_price AS list_price FROM catalog_sales, date_dim WHERE cs_sold_date_sk = d_date_sk AND d_year BETWEEN 2000 AND 2000 + 2 UNION ALL SELECT ws_quantity AS quantity, ws_list_price AS list_price FROM web_sales, date_dim WHERE ws_sold_date_sk = d_date_sk AND d_year BETWEEN 2000 AND 2000 + 2) AS x)\nSELECT channel, i_brand_id, i_class_id, i_category_id, SUM(sales), SUM(number_sales) FROM (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_year = 2000 + 2 AND d_moy = 11 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales) UNION ALL SELECT 'catalog' AS channel, i_brand_id, i_class_id, i_category_id, SUM(cs_quantity * cs_list_price) AS sales, COUNT(*) AS number_sales FROM catalog_sales, item, date_dim WHERE cs_item_sk IN (SELECT ss_item_sk FROM cross_items) AND cs_item_sk = i_item_sk AND cs_sold_date_sk = d_date_sk AND d_year = 2000 + 2 AND d_moy = 11 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(cs_quantity * cs_list_price) > (SELECT average_sales FROM avg_sales) UNION ALL SELECT 'web' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ws_quantity * ws_list_price) AS sales, COUNT(*) AS number_sales FROM web_sales, item, date_dim WHERE ws_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ws_item_sk = i_item_sk AND ws_sold_date_sk = d_date_sk AND d_year = 2000 + 2 AND d_moy = 11 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ws_quantity * ws_list_price) > (SELECT average_sales FROM avg_sales)) AS y GROUP BY ROLLUP (channel, i_brand_id, i_class_id, i_category_id) ORDER BY channel, i_brand_id, i_class_id, i_category_id LIMIT 100;",
      "optimized_source": "dsr1",
      "sf10_rows_match": false
    },
    {
      "id": "multi_intersect_exists_cte",
      "name": "Multi-INTERSECT to EXISTS with CTEs",
      "description": "Convert cascading INTERSECT operations into correlated EXISTS subqueries with pre-materialized date and channel CTEs",
      "verified_speedup": "2.39x",
      "engine": "duckdb",
      "example": {
        "opportunity": "INTERSECT_TO_EXISTS + DATE_CTE_ISOLATE + MATERIALIZE_CTE",
        "input_slice": "with cross_items as\n (select i_item_sk ss_item_sk from item,\n  (select iss.i_brand_id brand_id, iss.i_class_id class_id, iss.i_category_id category_id\n   from store_sales, item iss, date_dim d1\n   where ss_item_sk = iss.i_item_sk and ss_sold_date_sk = d1.d_date_sk\n     and d1.d_year between 2000 AND 2002\n   intersect\n   select ics.i_brand_id, ics.i_class_id, ics.i_category_id\n   from catalog_sales, item ics, date_dim d2\n   where cs_item_sk = ics.i_item_sk and cs_sold_date_sk = d2.d_date_sk\n     and d2.d_year between 2000 AND 2002\n   intersect\n   select iws.i_brand_id, iws.i_class_id, iws.i_category_id\n   from web_sales, item iws, date_dim d3\n   where ws_item_sk = iws.i_item_sk and ws_sold_date_sk = d3.d_date_sk\n     and d3.d_year between 2000 AND 2002)\n  where i_brand_id = brand_id and i_class_id = class_id and i_category_id = category_id)",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "intersect_to_exists",
              "nodes": {
                "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_year BETWEEN 2000 AND 2002",
                "cross_items": "SELECT i_item_sk AS ss_item_sk, i_brand_id, i_class_id, i_category_id FROM item WHERE EXISTS (SELECT 1 FROM store_sales JOIN item iss ON ss_item_sk = iss.i_item_sk JOIN filtered_dates d1 ON ss_sold_date_sk = d1.d_date_sk WHERE iss.i_brand_id = item.i_brand_id AND iss.i_class_id = item.i_class_id AND iss.i_category_id = item.i_category_id) AND EXISTS (SELECT 1 FROM catalog_sales JOIN item ics ON cs_item_sk = ics.i_item_sk JOIN filtered_dates d2 ON cs_sold_date_sk = d2.d_date_sk WHERE ics.i_brand_id = item.i_brand_id AND ics.i_class_id = item.i_class_id AND ics.i_category_id = item.i_category_id) AND EXISTS (SELECT 1 FROM web_sales JOIN item iws ON ws_item_sk = iws.i_item_sk JOIN filtered_dates d3 ON ws_sold_date_sk = d3.d_date_sk WHERE iws.i_brand_id = item.i_brand_id AND iws.i_class_id = item.i_class_id AND iws.i_category_id = item.i_category_id)"
              },
              "invariants_kept": [
                "same cross-channel items identified",
                "output columns unchanged"
              ],
              "expected_speedup": "2.39x",
              "risk": "low"
            }
          ]
        },
        "key_insight": "INTERSECT materializes full intermediate result sets (brand_id, class_id, category_id triples) from each channel before intersecting. EXISTS with correlated predicates short-circuits early \u2014 once a matching row is found for each channel, processing stops. Pre-filtering date_dim into a CTE avoids repeated scans of the 73K-row date table.",
        "when_not_to_use": "Do not use when the INTERSECT operates on small result sets (< 1000 rows) where materialization cost is negligible. Also not applicable when the EXISTS correlation would be on non-indexed columns, as the correlated probe could be slower than the hash-based INTERSECT."
      },
      "original_sql": "with cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id, iss.i_class_id class_id, iss.i_category_id category_id\n from store_sales, item iss, date_dim d1\n where ss_item_sk = iss.i_item_sk and ss_sold_date_sk = d1.d_date_sk\n   and d1.d_year between 2000 AND 2000 + 2\n intersect\n select ics.i_brand_id, ics.i_class_id, ics.i_category_id\n from catalog_sales, item ics, date_dim d2\n where cs_item_sk = ics.i_item_sk and cs_sold_date_sk = d2.d_date_sk\n   and d2.d_year between 2000 AND 2000 + 2\n intersect\n select iws.i_brand_id, iws.i_class_id, iws.i_category_id\n from web_sales, item iws, date_dim d3\n where ws_item_sk = iws.i_item_sk and ws_sold_date_sk = d3.d_date_sk\n   and d3.d_year between 2000 AND 2000 + 2)\n where i_brand_id = brand_id and i_class_id = class_id and i_category_id = category_id),\n avg_sales as\n (select avg(quantity*list_price) average_sales\n  from (select ss_quantity quantity, ss_list_price list_price from store_sales, date_dim where ss_sold_date_sk = d_date_sk and d_year between 2000 and 2000 + 2\n   union all select cs_quantity, cs_list_price from catalog_sales, date_dim where cs_sold_date_sk = d_date_sk and d_year between 2000 and 2000 + 2\n   union all select ws_quantity, ws_list_price from web_sales, date_dim where ws_sold_date_sk = d_date_sk and d_year between 2000 and 2000 + 2) x)\n select channel, i_brand_id, i_class_id, i_category_id, sum(sales), sum(number_sales)\n from (\n  select 'store' channel, i_brand_id, i_class_id, i_category_id, sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n  from store_sales, item, date_dim\n  where ss_item_sk in (select ss_item_sk from cross_items) and ss_item_sk = i_item_sk and ss_sold_date_sk = d_date_sk and d_year = 2000+2 and d_moy = 11\n  group by i_brand_id, i_class_id, i_category_id\n  having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)\n  union all\n  select 'catalog' channel, i_brand_id, i_class_id, i_category_id, sum(cs_quantity*cs_list_price) sales, count(*) number_sales\n  from catalog_sales, item, date_dim\n  where cs_item_sk in (select ss_item_sk from cross_items) and cs_item_sk = i_item_sk and cs_sold_date_sk = d_date_sk and d_year = 2000+2 and d_moy = 11\n  group by i_brand_id, i_class_id, i_category_id\n  having sum(cs_quantity*cs_list_price) > (select average_sales from avg_sales)\n  union all\n  select 'web' channel, i_brand_id, i_class_id, i_category_id, sum(ws_quantity*ws_list_price) sales, count(*) number_sales\n  from web_sales, item, date_dim\n  where ws_item_sk in (select ss_item_sk from cross_items) and ws_item_sk = i_item_sk and ws_sold_date_sk = d_date_sk and d_year = 2000+2 and d_moy = 11\n  group by i_brand_id, i_class_id, i_category_id\n  having sum(ws_quantity*ws_list_price) > (select average_sales from avg_sales)\n ) y\n group by rollup (channel, i_brand_id, i_class_id, i_category_id)\n order by channel, i_brand_id, i_class_id, i_category_id\n LIMIT 100;",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year BETWEEN 2000 AND 2002), cross_items AS (SELECT i_item_sk AS ss_item_sk, i_brand_id, i_class_id, i_category_id FROM item WHERE EXISTS (SELECT 1 FROM store_sales JOIN item iss ON ss_item_sk = iss.i_item_sk JOIN filtered_dates d1 ON ss_sold_date_sk = d1.d_date_sk WHERE iss.i_brand_id = item.i_brand_id AND iss.i_class_id = item.i_class_id AND iss.i_category_id = item.i_category_id) AND EXISTS (SELECT 1 FROM catalog_sales JOIN item ics ON cs_item_sk = ics.i_item_sk JOIN filtered_dates d2 ON cs_sold_date_sk = d2.d_date_sk WHERE ics.i_brand_id = item.i_brand_id AND ics.i_class_id = item.i_class_id AND ics.i_category_id = item.i_category_id) AND EXISTS (SELECT 1 FROM web_sales JOIN item iws ON ws_item_sk = iws.i_item_sk JOIN filtered_dates d3 ON ws_sold_date_sk = d3.d_date_sk WHERE iws.i_brand_id = item.i_brand_id AND iws.i_class_id = item.i_class_id AND iws.i_category_id = item.i_category_id)), avg_sales AS (SELECT AVG(quantity * list_price) AS average_sales FROM (SELECT ss_quantity AS quantity, ss_list_price AS list_price FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk UNION ALL SELECT cs_quantity, cs_list_price FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk UNION ALL SELECT ws_quantity, ws_list_price FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk) x), nov2002_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002 AND d_moy = 11), store_sales_data AS (SELECT 'store' AS channel, i.i_brand_id, i.i_class_id, i.i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN nov2002_dates nd ON ss.ss_sold_date_sk = nd.d_date_sk WHERE EXISTS (SELECT 1 FROM cross_items ci WHERE ci.ss_item_sk = ss.ss_item_sk) GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)), catalog_sales_data AS (SELECT 'catalog' AS channel, i.i_brand_id, i.i_class_id, i.i_category_id, SUM(cs_quantity * cs_list_price) AS sales, COUNT(*) AS number_sales FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN nov2002_dates nd ON cs.cs_sold_date_sk = nd.d_date_sk WHERE EXISTS (SELECT 1 FROM cross_items ci WHERE ci.ss_item_sk = cs.cs_item_sk) GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id HAVING SUM(cs_quantity * cs_list_price) > (SELECT average_sales FROM avg_sales)), web_sales_data AS (SELECT 'web' AS channel, i.i_brand_id, i.i_class_id, i.i_category_id, SUM(ws_quantity * ws_list_price) AS sales, COUNT(*) AS number_sales FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN nov2002_dates nd ON ws.ws_sold_date_sk = nd.d_date_sk WHERE EXISTS (SELECT 1 FROM cross_items ci WHERE ci.ss_item_sk = ws.ws_item_sk) GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id HAVING SUM(ws_quantity * ws_list_price) > (SELECT average_sales FROM avg_sales))\nSELECT channel, i_brand_id, i_class_id, i_category_id, SUM(sales) AS \"SUM(sales)\", SUM(number_sales) AS \"SUM(number_sales)\" FROM (SELECT * FROM store_sales_data UNION ALL SELECT * FROM catalog_sales_data UNION ALL SELECT * FROM web_sales_data) y GROUP BY ROLLUP(channel, i_brand_id, i_class_id, i_category_id) ORDER BY channel, i_brand_id, i_class_id, i_category_id LIMIT 100;",
      "optimized_source": "swarm_final_worker",
      "sf10_rows_match": true
    },
    {
      "id": "union_cte_split",
      "name": "Union CTE Split/Specialization",
      "description": "Split a generic UNION ALL CTE into specialized CTEs when the main query filters by year or discriminator - eliminates redundant scans",
      "verified_speedup": "1.36x",
      "principle": "CTE Specialization: when a generic CTE is scanned multiple times with different filters (e.g., by year), split it into specialized CTEs that embed the filter in their definition. Each specialized CTE processes only its relevant subset, eliminating redundant scans.",
      "example": {
        "opportunity": "UNION_CTE_SPLIT: CTE with UNION ALL is scanned twice with different year filters - split into year-specific CTEs",
        "input_slice": "WITH wscs AS (\n  SELECT ws_sold_date_sk AS sold_date_sk, ws_ext_sales_price AS sales_price FROM web_sales\n  UNION ALL\n  SELECT cs_sold_date_sk AS sold_date_sk, cs_ext_sales_price AS sales_price FROM catalog_sales\n), wswscs AS (\nSELECT d_week_seq, SUM(CASE WHEN d_day_name='Sunday' THEN sales_price ELSE NULL END) AS sun_sales,\n       SUM(CASE WHEN d_day_name='Monday' THEN sales_price ELSE NULL END) AS mon_sales\nFROM wscs, date_dim WHERE d_date_sk = sold_date_sk GROUP BY d_week_seq\n)\nSELECT y.d_week_seq AS d_week_seq1, ROUND(y.sun_sales/z.sun_sales,2)\nFROM (SELECT wswscs.d_week_seq, wswscs.sun_sales FROM wswscs, date_dim WHERE date_dim.d_week_seq = wswscs.d_week_seq AND d_year = 1998) y,\n     (SELECT wswscs.d_week_seq, wswscs.sun_sales FROM wswscs, date_dim WHERE date_dim.d_week_seq = wswscs.d_week_seq AND d_year = 1999) z\nWHERE y.d_week_seq = z.d_week_seq - 53 ORDER BY d_week_seq1",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "union_cte_split",
              "nodes": {
                "year_1998_dates": "SELECT d_date_sk, d_week_seq, d_day_name FROM date_dim WHERE d_year = 1998",
                "year_1999_dates": "SELECT d_date_sk, d_week_seq, d_day_name FROM date_dim WHERE d_year = 1999",
                "wswscs_1998": "SELECT d_week_seq, SUM(CASE WHEN d_day_name='Sunday' THEN sales_price ELSE NULL END) AS sun_sales, SUM(CASE WHEN d_day_name='Monday' THEN sales_price ELSE NULL END) AS mon_sales, SUM(CASE WHEN d_day_name='Tuesday' THEN sales_price ELSE NULL END) AS tue_sales, SUM(CASE WHEN d_day_name='Wednesday' THEN sales_price ELSE NULL END) AS wed_sales, SUM(CASE WHEN d_day_name='Thursday' THEN sales_price ELSE NULL END) AS thu_sales, SUM(CASE WHEN d_day_name='Friday' THEN sales_price ELSE NULL END) AS fri_sales, SUM(CASE WHEN d_day_name='Saturday' THEN sales_price ELSE NULL END) AS sat_sales FROM (SELECT ws_sold_date_sk AS sold_date_sk, ws_ext_sales_price AS sales_price FROM web_sales UNION ALL SELECT cs_sold_date_sk AS sold_date_sk, cs_ext_sales_price AS sales_price FROM catalog_sales) wscs JOIN year_1998_dates ON d_date_sk = sold_date_sk GROUP BY d_week_seq",
                "wswscs_1999": "SELECT d_week_seq, SUM(CASE WHEN d_day_name='Sunday' THEN sales_price ELSE NULL END) AS sun_sales, SUM(CASE WHEN d_day_name='Monday' THEN sales_price ELSE NULL END) AS mon_sales, SUM(CASE WHEN d_day_name='Tuesday' THEN sales_price ELSE NULL END) AS tue_sales, SUM(CASE WHEN d_day_name='Wednesday' THEN sales_price ELSE NULL END) AS wed_sales, SUM(CASE WHEN d_day_name='Thursday' THEN sales_price ELSE NULL END) AS thu_sales, SUM(CASE WHEN d_day_name='Friday' THEN sales_price ELSE NULL END) AS fri_sales, SUM(CASE WHEN d_day_name='Saturday' THEN sales_price ELSE NULL END) AS sat_sales FROM (SELECT ws_sold_date_sk AS sold_date_sk, ws_ext_sales_price AS sales_price FROM web_sales UNION ALL SELECT cs_sold_date_sk AS sold_date_sk, cs_ext_sales_price AS sales_price FROM catalog_sales) wscs JOIN year_1999_dates ON d_date_sk = sold_date_sk GROUP BY d_week_seq",
                "main_query": "SELECT y.d_week_seq AS d_week_seq1, ROUND(y.sun_sales / NULLIF(z.sun_sales, 0), 2), ROUND(y.mon_sales / NULLIF(z.mon_sales, 0), 2), ROUND(y.tue_sales / NULLIF(z.tue_sales, 0), 2), ROUND(y.wed_sales / NULLIF(z.wed_sales, 0), 2), ROUND(y.thu_sales / NULLIF(z.thu_sales, 0), 2), ROUND(y.fri_sales / NULLIF(z.fri_sales, 0), 2), ROUND(y.sat_sales / NULLIF(z.sat_sales, 0), 2) FROM wswscs_1998 y JOIN wswscs_1999 z ON y.d_week_seq = z.d_week_seq - 53 ORDER BY y.d_week_seq"
              },
              "invariants_kept": [
                "same result rows",
                "same ordering",
                "same column output",
                "same aggregation semantics"
              ],
              "expected_speedup": "1.5x",
              "risk": "low"
            }
          ]
        },
        "key_insight": "Principle: CTE Specialization \u2014 when a generic CTE is scanned multiple times with different filters (e.g., by year), split it into specialized CTEs that embed the filter in their definition. Each specialized CTE processes only its relevant subset, eliminating redundant scans and post-hoc filtering. Here: generic wswscs CTE scanned twice with year filters becomes wswscs_1998 and wswscs_1999, each joining date_dim once during aggregation."
      },
      "original_sql": "with year_total as (\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,d_year as year\n       ,stddev_samp(ss_net_paid) year_total\n       ,'s' sale_type\n from customer\n     ,store_sales\n     ,date_dim\n where c_customer_sk = ss_customer_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_year in (1999,1999+1)\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,d_year\n union all\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,d_year as year\n       ,stddev_samp(ws_net_paid) year_total\n       ,'w' sale_type\n from customer\n     ,web_sales\n     ,date_dim\n where c_customer_sk = ws_bill_customer_sk\n   and ws_sold_date_sk = d_date_sk\n   and d_year in (1999,1999+1)\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,d_year\n         )\n  select\n        t_s_secyear.customer_id, t_s_secyear.customer_first_name, t_s_secyear.customer_last_name\n from year_total t_s_firstyear\n     ,year_total t_s_secyear\n     ,year_total t_w_firstyear\n     ,year_total t_w_secyear\n where t_s_secyear.customer_id = t_s_firstyear.customer_id\n         and t_s_firstyear.customer_id = t_w_secyear.customer_id\n         and t_s_firstyear.customer_id = t_w_firstyear.customer_id\n         and t_s_firstyear.sale_type = 's'\n         and t_w_firstyear.sale_type = 'w'\n         and t_s_secyear.sale_type = 's'\n         and t_w_secyear.sale_type = 'w'\n         and t_s_firstyear.year = 1999\n         and t_s_secyear.year = 1999+1\n         and t_w_firstyear.year = 1999\n         and t_w_secyear.year = 1999+1\n         and t_s_firstyear.year_total > 0\n         and t_w_firstyear.year_total > 0\n         and case when t_w_firstyear.year_total > 0 then t_w_secyear.year_total / t_w_firstyear.year_total else null end\n           > case when t_s_firstyear.year_total > 0 then t_s_secyear.year_total / t_s_firstyear.year_total else null end\n order by 2,1,3\n LIMIT 100;",
      "optimized_sql": "WITH year_total AS (SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, d_year AS year, STDDEV_SAMP(ss_net_paid) AS year_total, 's' AS sale_type FROM customer, store_sales, date_dim WHERE c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year IN (1999, 1999 + 1) GROUP BY c_customer_id, c_first_name, c_last_name, d_year UNION ALL SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, d_year AS year, STDDEV_SAMP(ws_net_paid) AS year_total, 'w' AS sale_type FROM customer, web_sales, date_dim WHERE c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year IN (1999, 1999 + 1) GROUP BY c_customer_id, c_first_name, c_last_name, d_year), year_total_store AS (SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, d_year AS year, STDDEV_SAMP(ss_net_paid) AS year_total FROM customer, store_sales, date_dim WHERE c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year IN (1999, 1999 + 1) GROUP BY c_customer_id, c_first_name, c_last_name, d_year), year_total_web AS (SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, d_year AS year, STDDEV_SAMP(ws_net_paid) AS year_total FROM customer, web_sales, date_dim WHERE c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year IN (1999, 1999 + 1) GROUP BY c_customer_id, c_first_name, c_last_name, d_year)\nSELECT t_s_secyear.customer_id, t_s_secyear.customer_first_name, t_s_secyear.customer_last_name FROM year_total_store AS t_s_firstyear, year_total_store AS t_s_secyear, year_total_web AS t_w_firstyear, year_total_web AS t_w_secyear WHERE t_s_secyear.customer_id = t_s_firstyear.customer_id AND t_s_firstyear.customer_id = t_w_secyear.customer_id AND t_s_firstyear.customer_id = t_w_firstyear.customer_id AND t_s_firstyear.year = 1999 AND t_s_secyear.year = 1999 + 1 AND t_w_firstyear.year = 1999 AND t_w_secyear.year = 1999 + 1 AND t_s_firstyear.year_total > 0 AND t_w_firstyear.year_total > 0 AND CASE WHEN t_w_firstyear.year_total > 0 THEN t_w_secyear.year_total / t_w_firstyear.year_total ELSE NULL END > CASE WHEN t_s_firstyear.year_total > 0 THEN t_s_secyear.year_total / t_s_firstyear.year_total ELSE NULL END ORDER BY 2, 1, 3 LIMIT 100;",
      "optimized_source": "kimi",
      "sf10_rows_match": true
    },
    {
      "id": "materialize_cte",
      "name": "Materialize Repeated Subquery",
      "description": "Extract repeated subquery patterns into a CTE to avoid recomputation",
      "verified_speedup": "1.37x",
      "principle": "Shared Materialization: extract repeated subquery patterns into CTEs to avoid recomputation. When the same logical check appears multiple times, compute it once and reference the result.",
      "example": {
        "opportunity": "MATERIALIZE_CTE",
        "input_slice": "[main_query]:\nSELECT COUNT(DISTINCT ws_order_number) AS order_count,\n       SUM(ws_ext_ship_cost) AS total_shipping\nFROM web_sales ws1, date_dim, customer_address, web_site\nWHERE d_date BETWEEN '2000-03-01' AND '2000-05-01'\n  AND ws1.ws_ship_date_sk = d_date_sk\n  AND ws1.ws_ship_addr_sk = ca_address_sk\n  AND ca_state = 'IL'\n  AND ws1.ws_web_site_sk = web_site_sk\n  AND web_company_name = 'pri'\n  AND EXISTS (SELECT * FROM web_sales ws2 WHERE ws1.ws_order_number = ws2.ws_order_number AND ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk)\n  AND NOT EXISTS (SELECT * FROM web_returns wr1 WHERE ws1.ws_order_number = wr1.wr_order_number)",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "materialize_cte",
              "nodes": {
                "multi_warehouse_orders": "SELECT DISTINCT ws_order_number FROM web_sales ws1 WHERE EXISTS (SELECT 1 FROM web_sales ws2 WHERE ws1.ws_order_number = ws2.ws_order_number AND ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk)",
                "returned_orders": "SELECT DISTINCT wr_order_number FROM web_returns",
                "main_query": "SELECT COUNT(DISTINCT ws_order_number) AS order_count, SUM(ws_ext_ship_cost) AS total_shipping FROM web_sales ws1 JOIN date_dim ON ws1.ws_ship_date_sk = d_date_sk JOIN customer_address ON ws1.ws_ship_addr_sk = ca_address_sk JOIN web_site ON ws1.ws_web_site_sk = web_site_sk JOIN multi_warehouse_orders mwo ON ws1.ws_order_number = mwo.ws_order_number LEFT JOIN returned_orders ro ON ws1.ws_order_number = ro.wr_order_number WHERE d_date BETWEEN '2000-03-01' AND '2000-05-01' AND ca_state = 'IL' AND web_company_name = 'pri' AND ro.wr_order_number IS NULL"
              },
              "invariants_kept": [
                "same result rows",
                "same aggregation"
              ],
              "expected_speedup": "1.8x",
              "risk": "low"
            }
          ]
        },
        "key_insight": "Principle: Shared Materialization \u2014 extract repeated subquery patterns into CTEs to avoid recomputation. When the same logical check appears in multiple places (EXISTS, WHERE, JOIN), computing it once as a CTE and referencing it is cheaper. Here: extract multi-warehouse order detection into one CTE, returned orders into another, then JOIN instead of nested EXISTS checks.",
        "when_not_to_use": "NEVER convert EXISTS or NOT EXISTS subqueries into materialized CTEs when the EXISTS is used as a filter (not a data source). EXISTS uses semi-join short-circuiting \u2014 the database stops scanning as soon as one match is found. Materializing into a CTE forces a full scan of the subquery table, destroying this optimization. Caused 0.14x when EXISTS on catalog_sales was materialized into a full CTE scan and 0.54x when EXISTS on web_sales was forced into full materialization."
      },
      "original_sql": "with ws_wh as\n(select ws1.ws_order_number,ws1.ws_warehouse_sk wh1,ws2.ws_warehouse_sk wh2\n from web_sales ws1,web_sales ws2\n where ws1.ws_order_number = ws2.ws_order_number\n   and ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk)\n select \n   count(distinct ws_order_number) as \"order count\"\n  ,sum(ws_ext_ship_cost) as \"total shipping cost\"\n  ,sum(ws_net_profit) as \"total net profit\"\nfrom\n   web_sales ws1\n  ,date_dim\n  ,customer_address\n  ,web_site\nwhere\n    d_date between '1999-2-01' and \n           (cast('1999-2-01' as date) + INTERVAL 60 DAY)\nand ws1.ws_ship_date_sk = d_date_sk\nand ws1.ws_ship_addr_sk = ca_address_sk\nand ca_state = 'NC'\nand ws1.ws_web_site_sk = web_site_sk\nand web_company_name = 'pri'\nand ws1.ws_order_number in (select ws_order_number\n                            from ws_wh)\nand ws1.ws_order_number in (select wr_order_number\n                            from web_returns,ws_wh\n                            where wr_order_number = ws_wh.ws_order_number)\norder by count(distinct ws_order_number)\n LIMIT 100;",
      "optimized_sql": "WITH ws_wh AS (SELECT ws1.ws_order_number, ws1.ws_warehouse_sk AS wh1, ws2.ws_warehouse_sk AS wh2 FROM web_sales AS ws1, web_sales AS ws2 WHERE ws1.ws_order_number = ws2.ws_order_number AND ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk)\nSELECT COUNT(DISTINCT ws_order_number) AS \"order count\", SUM(ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws_net_profit) AS \"total net profit\" FROM web_sales AS ws1 JOIN date_dim ON ws1.ws_ship_date_sk = d_date_sk JOIN customer_address ON ws1.ws_ship_addr_sk = ca_address_sk JOIN web_site ON ws1.ws_web_site_sk = web_site_sk WHERE d_date BETWEEN '1999-2-01' AND (CAST('1999-2-01' AS DATE) + INTERVAL '60' DAY) AND ca_state = 'NC' AND web_company_name = 'pri' AND EXISTS(SELECT 1 FROM ws_wh WHERE ws_wh.ws_order_number = ws1.ws_order_number) AND EXISTS(SELECT 1 FROM web_returns JOIN ws_wh ON wr_order_number = ws_wh.ws_order_number WHERE wr_order_number = ws1.ws_order_number) ORDER BY COUNT(DISTINCT ws_order_number) LIMIT 100;",
      "optimized_source": "kimi",
      "sf10_rows_match": true
    },
    {
      "id": "or_to_union",
      "name": "OR to UNION ALL",
      "description": "Split OR conditions on different columns into UNION ALL branches for better index usage",
      "verified_speedup": "3.17x",
      "principle": "OR-to-UNION Decomposition: split OR conditions on different columns into separate UNION ALL branches, each with a focused predicate. The optimizer can use different access paths per branch instead of a single scan with a complex filter.",
      "example": {
        "opportunity": "OR_TO_UNION + EARLY_FILTER",
        "input_slice": "[main_query]:\nSELECT ca_zip, sum(cs_sales_price)\nFROM catalog_sales, customer, customer_address, date_dim\nWHERE cs_bill_customer_sk = c_customer_sk\n  AND c_current_addr_sk = ca_address_sk\n  AND (substr(ca_zip,1,5) IN ('85669', '86197', '88274', '83405', '86475')\n       OR ca_state IN ('CA','WA','GA')\n       OR cs_sales_price > 500)\n  AND cs_sold_date_sk = d_date_sk\n  AND d_qoy = 1 AND d_year = 2001\nGROUP BY ca_zip ORDER BY ca_zip LIMIT 100",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "or_to_union",
              "nodes": {
                "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_qoy = 1 AND d_year = 2001",
                "filtered_sales": "SELECT cs_sales_price, ca_zip FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE substr(ca_zip,1,5) IN ('85669', '86197', '88274', '83405', '86475', '85392', '85460', '80348', '81792') UNION ALL SELECT cs_sales_price, ca_zip FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ca_state IN ('CA','WA','GA') UNION ALL SELECT cs_sales_price, ca_zip FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE cs_sales_price > 500",
                "main_query": "SELECT ca_zip, SUM(cs_sales_price) FROM filtered_sales GROUP BY ca_zip ORDER BY ca_zip LIMIT 100"
              },
              "invariants_kept": [
                "output columns unchanged",
                "same rows after aggregation"
              ],
              "expected_speedup": "2.98x",
              "risk": "low"
            }
          ]
        },
        "key_insight": "Principle: OR-to-UNION Decomposition \u2014 split OR conditions on different columns into separate UNION ALL branches, each with a focused predicate. The optimizer can use different access paths per branch instead of a single scan with a complex filter. Here: three OR branches (zip codes, states, price threshold) become three UNION ALL branches, each with its own focused predicate. Date filter extracted as shared CTE.",
        "when_not_to_use": "Do not split OR when all branches filter the SAME column on the same table (e.g., t_hour >= 8 OR t_hour <= 17). This duplicates the entire fact table scan for each branch with no selectivity benefit. Only apply when OR conditions span DIFFERENT tables or fundamentally different column families. Also never split into more than 3 UNION branches \u2014 each branch rescans the fact table. Caused 0.59x on a same-column time-range split and historically 0.23x-0.41x on queries with 9+ UNION branches."
      },
      "original_sql": "select ca_zip\n       ,sum(cs_sales_price)\n from catalog_sales\n     ,customer\n     ,customer_address\n     ,date_dim\n where cs_bill_customer_sk = c_customer_sk\n \tand c_current_addr_sk = ca_address_sk \n \tand ( substr(ca_zip,1,5) in ('85669', '86197','88274','83405','86475',\n                                   '85392', '85460', '80348', '81792')\n \t      or ca_state in ('CA','WA','GA')\n \t      or cs_sales_price > 500)\n \tand cs_sold_date_sk = d_date_sk\n \tand d_qoy = 1 and d_year = 2001\n group by ca_zip\n order by ca_zip\n LIMIT 100;",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_qoy = 1 AND d_year = 2001), filtered_sales AS (SELECT cs_sales_price, ca_zip FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE SUBSTRING(ca_zip, 1, 5) IN ('85669', '86197', '88274', '83405', '86475', '85392', '85460', '80348', '81792') UNION ALL SELECT cs_sales_price, ca_zip FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ca_state IN ('CA', 'WA', 'GA') UNION ALL SELECT cs_sales_price, ca_zip FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE cs_sales_price > 500)\nSELECT ca_zip, SUM(cs_sales_price) FROM filtered_sales GROUP BY ca_zip ORDER BY ca_zip LIMIT 100;",
      "optimized_source": "kimi",
      "sf10_rows_match": true
    },
    {
      "id": "prefetch_fact_join",
      "name": "Prefetch Fact Join",
      "description": "Pre-filter dimension table into CTE, then pre-join with fact table in second CTE before joining other dimensions",
      "verified_speedup": "3.77x",
      "principle": "Staged Join Pipeline: build a CTE chain that progressively reduces data \u2014 first CTE filters the dimension, second CTE pre-joins filtered dimension keys with the fact table, subsequent CTEs join remaining dimensions against the already-reduced fact set.",
      "example": {
        "opportunity": "PREFETCH FACT JOIN",
        "input_slice": "SELECT * FROM (\n  SELECT i_manager_id, sum(ss_sales_price) sum_sales,\n    avg(sum(ss_sales_price)) OVER (PARTITION BY i_manager_id) avg_monthly_sales\n  FROM item, store_sales, date_dim, store\n  WHERE ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND ss_store_sk = s_store_sk\n    AND d_month_seq IN (1200,1201,1202,1203,1204,1205,1206,1207,1208,1209,1210,1211)\n    AND ((i_category IN ('Books','Children','Electronics') AND i_class IN ('personal','portable','reference','self-help') AND i_brand IN (...))\n      OR (i_category IN ('Women','Music','Men') AND i_class IN ('accessories','classical','fragrances','pants') AND i_brand IN (...)))\n  GROUP BY i_manager_id, d_moy\n) AS tmp1\nWHERE CASE WHEN avg_monthly_sales > 0 THEN ABS(sum_sales - avg_monthly_sales) / avg_monthly_sales ELSE NULL END > 0.1\nORDER BY i_manager_id, avg_monthly_sales, sum_sales LIMIT 100",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "prefetch_fact_join",
              "nodes": {
                "filtered_dates": "SELECT d_date_sk, d_moy FROM date_dim WHERE d_month_seq IN (1200, 1201, 1202, 1203, 1204, 1205, 1206, 1207, 1208, 1209, 1210, 1211)",
                "filtered_sales": "SELECT ss_item_sk, ss_store_sk, ss_sales_price, d_moy FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk",
                "main_query": "SELECT * FROM (SELECT i_manager_id, SUM(ss_sales_price) AS sum_sales, AVG(SUM(ss_sales_price)) OVER (PARTITION BY i_manager_id) AS avg_monthly_sales FROM item JOIN filtered_sales ON ss_item_sk = i_item_sk JOIN store ON ss_store_sk = s_store_sk WHERE ((i_category IN ('Books', 'Children', 'Electronics') AND i_class IN ('personal', 'portable', 'reference', 'self-help') AND i_brand IN (...)) OR (i_category IN ('Women', 'Music', 'Men') AND i_class IN ('accessories', 'classical', 'fragrances', 'pants') AND i_brand IN (...))) GROUP BY i_manager_id, d_moy) AS tmp1 WHERE CASE WHEN avg_monthly_sales > 0 THEN ABS(sum_sales - avg_monthly_sales) / avg_monthly_sales ELSE NULL END > 0.1 ORDER BY i_manager_id, avg_monthly_sales, sum_sales LIMIT 100"
              },
              "invariants_kept": [
                "same result rows",
                "same ordering",
                "same column output"
              ],
              "expected_speedup": "3.77x",
              "risk": "low"
            }
          ]
        },
        "key_insight": "Principle: Staged Join Pipeline \u2014 build a CTE chain that progressively reduces data: first CTE filters the dimension, second CTE pre-joins the filtered dimension with the fact table to materialize a small intermediate result. Subsequent dimension joins then operate on this reduced dataset instead of the full fact table. Here: filter date_dim first, pre-join with store_sales, then join the smaller result with remaining dimensions.",
        "when_not_to_use": "Do not use on queries with baseline runtime under 50ms \u2014 CTE materialization overhead dominates on fast queries. Do not use on window-function-dominated queries where filtering is not the bottleneck. Avoid on queries with 5+ table joins and complex inter-table predicates where forcing join order via CTEs prevents the optimizer from choosing a better plan. Caused 0.50x on a fast-baseline query, 0.87x on a window-function bottleneck query, and 0.77x on a complex multi-table join-reordering query."
      },
      "original_sql": "select * \nfrom (select i_manager_id\n             ,sum(ss_sales_price) sum_sales\n             ,avg(sum(ss_sales_price)) over (partition by i_manager_id) avg_monthly_sales\n      from item\n          ,store_sales\n          ,date_dim\n          ,store\n      where ss_item_sk = i_item_sk\n        and ss_sold_date_sk = d_date_sk\n        and ss_store_sk = s_store_sk\n        and d_month_seq in (1181,1181+1,1181+2,1181+3,1181+4,1181+5,1181+6,1181+7,1181+8,1181+9,1181+10,1181+11)\n        and ((    i_category in ('Books','Children','Electronics')\n              and i_class in ('personal','portable','reference','self-help')\n              and i_brand in ('scholaramalgamalg #14','scholaramalgamalg #7',\n\t\t                  'exportiunivamalg #9','scholaramalgamalg #9'))\n           or(    i_category in ('Women','Music','Men')\n              and i_class in ('accessories','classical','fragrances','pants')\n              and i_brand in ('amalgimporto #1','edu packscholar #1','exportiimporto #1',\n\t\t                 'importoamalg #1')))\ngroup by i_manager_id, d_moy) tmp1\nwhere case when avg_monthly_sales > 0 then abs (sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\norder by i_manager_id\n        ,avg_monthly_sales\n        ,sum_sales\n LIMIT 100;",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_moy FROM date_dim WHERE d_month_seq IN (1200, 1201, 1202, 1203, 1204, 1205, 1206, 1207, 1208, 1209, 1210, 1211)), filtered_sales AS (SELECT ss_item_sk, ss_store_sk, ss_sales_price, d_moy FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk), first_branch AS (SELECT i_manager_id, d_moy, ss_sales_price FROM item JOIN filtered_sales ON ss_item_sk = i_item_sk JOIN store ON ss_store_sk = s_store_sk WHERE i_category IN ('Books', 'Children', 'Electronics') AND i_class IN ('personal', 'portable', 'reference', 'self-help') AND i_brand IN ('scholaramalgamalg #14', 'scholaramalgamalg #7', 'exportiunivamalg #9', 'scholaramalgamalg #9')), second_branch AS (SELECT i_manager_id, d_moy, ss_sales_price FROM item JOIN filtered_sales ON ss_item_sk = i_item_sk JOIN store ON ss_store_sk = s_store_sk WHERE i_category IN ('Women', 'Music', 'Men') AND i_class IN ('accessories', 'classical', 'fragrances', 'pants') AND i_brand IN ('amalgimporto #1', 'edu packscholar #1', 'exportiimporto #1', 'importoamalg #1')), combined_sales AS (SELECT * FROM first_branch UNION ALL SELECT * FROM second_branch)\nSELECT i_manager_id, SUM(ss_sales_price) AS sum_sales, AVG(SUM(ss_sales_price)) OVER (PARTITION BY i_manager_id) AS avg_monthly_sales FROM combined_sales GROUP BY i_manager_id, d_moy HAVING CASE WHEN AVG(SUM(ss_sales_price)) OVER (PARTITION BY i_manager_id) > 0 THEN ABS(SUM(ss_sales_price) - AVG(SUM(ss_sales_price)) OVER (PARTITION BY i_manager_id)) / AVG(SUM(ss_sales_price)) OVER (PARTITION BY i_manager_id) ELSE NULL END > 0.1 ORDER BY i_manager_id, avg_monthly_sales, sum_sales LIMIT 100;",
      "optimized_source": "dsr1"
    },
    {
      "id": "date_cte_isolate",
      "name": "Date CTE Isolation",
      "description": "Extract date filtering into a separate CTE to enable predicate pushdown and reduce scans",
      "verified_speedup": "4.00x",
      "principle": "Dimension Isolation: extract small dimension lookups into CTEs so they materialize once and subsequent joins probe a tiny hash table instead of rescanning.",
      "example": {
        "opportunity": "DATE_CTE_ISOLATE + CATEGORY_AVG",
        "input_slice": "[main_query]:\nSELECT a.ca_state state, count(*) cnt\nFROM customer_address a, customer c, store_sales s, date_dim d, item i\nWHERE a.ca_address_sk = c.c_current_addr_sk\n  AND c.c_customer_sk = s.ss_customer_sk\n  AND s.ss_sold_date_sk = d.d_date_sk\n  AND s.ss_item_sk = i.i_item_sk\n  AND d.d_month_seq = (SELECT DISTINCT d_month_seq FROM date_dim WHERE d_year = 2000 AND d_moy = 1)\n  AND i.i_current_price > 1.2 * (SELECT avg(j.i_current_price) FROM item j WHERE j.i_category = i.i_category)\nGROUP BY a.ca_state HAVING count(*) >= 10\nORDER BY cnt, a.ca_state LIMIT 100",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "date_cte_isolate",
              "nodes": {
                "target_month": "SELECT DISTINCT d_month_seq FROM date_dim WHERE d_year = 2000 AND d_moy = 1",
                "category_avg_price": "SELECT i_category, AVG(i_current_price) * 1.2 AS avg_threshold FROM item GROUP BY i_category",
                "filtered_dates": "SELECT d_date_sk FROM date_dim JOIN target_month ON d_month_seq = target_month.d_month_seq",
                "filtered_sales": "SELECT ss_customer_sk, ss_item_sk FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk",
                "main_query": "SELECT a.ca_state AS state, COUNT(*) AS cnt FROM customer_address a JOIN customer c ON a.ca_address_sk = c.c_current_addr_sk JOIN filtered_sales s ON c.c_customer_sk = s.ss_customer_sk JOIN item i ON s.ss_item_sk = i.i_item_sk JOIN category_avg_price cap ON i.i_category = cap.i_category WHERE i.i_current_price > cap.avg_threshold GROUP BY a.ca_state HAVING COUNT(*) >= 10 ORDER BY cnt, a.ca_state LIMIT 100"
              },
              "invariants_kept": [
                "same result rows",
                "same ordering",
                "same column output",
                "same grouping and aggregation"
              ],
              "expected_speedup": "2.0x",
              "risk": "low"
            }
          ]
        },
        "key_insight": "Principle: Dimension Isolation \u2014 extract small dimension lookups into CTEs so they materialize once and subsequent joins probe a tiny hash table. Here: extract date month_seq subquery into CTE, extract category average into separate CTE with GROUP BY, then JOIN instead of correlated subquery. Each CTE is scanned once.",
        "when_not_to_use": "Do not use when the optimizer already pushes date predicates effectively (e.g., simple equality filters on date columns in self-joins). Do not decompose an already-efficient existing CTE into sub-CTEs \u2014 this adds materialization overhead without reducing scans. Caused 0.49x regression on an already-optimized date-pushdown case and 0.71x on an over-decomposed CTE case."
      },
      "original_sql": "select a.ca_state state, count(*) cnt\n from customer_address a\n     ,customer c\n     ,store_sales s\n     ,date_dim d\n     ,item i\n where       a.ca_address_sk = c.c_current_addr_sk\n \tand c.c_customer_sk = s.ss_customer_sk\n \tand s.ss_sold_date_sk = d.d_date_sk\n \tand s.ss_item_sk = i.i_item_sk\n \tand d.d_month_seq = \n \t     (select distinct (d_month_seq)\n \t      from date_dim\n               where d_year = 2002\n \t        and d_moy = 3 )\n \tand i.i_current_price > 1.2 * \n             (select avg(j.i_current_price) \n \t     from item j \n \t     where j.i_category = i.i_category)\n group by a.ca_state\n having count(*) >= 10\n order by cnt, a.ca_state\n LIMIT 100;",
      "optimized_sql": "WITH target_month AS (SELECT DISTINCT d_month_seq FROM date_dim WHERE d_year = 2002 AND d_moy = 3), category_avg AS (SELECT i_category, AVG(i_current_price) * 1.2 AS price_threshold FROM item GROUP BY i_category)\nSELECT a.ca_state AS state, COUNT(*) AS cnt FROM customer_address AS a JOIN customer AS c ON a.ca_address_sk = c.c_current_addr_sk JOIN store_sales AS s ON c.c_customer_sk = s.ss_customer_sk JOIN date_dim AS d ON s.ss_sold_date_sk = d.d_date_sk JOIN target_month AS tm ON d.d_month_seq = tm.d_month_seq JOIN item AS i ON s.ss_item_sk = i.i_item_sk JOIN category_avg AS ca ON i.i_category = ca.i_category WHERE i.i_current_price > ca.price_threshold GROUP BY a.ca_state HAVING COUNT(*) >= 10 ORDER BY cnt, a.ca_state LIMIT 100;",
      "optimized_source": "kimi",
      "sf10_rows_match": true
    },
    {
      "id": "deferred_window_aggregation",
      "name": "Deferred Window Aggregation",
      "description": "When multiple CTEs each perform GROUP BY + WINDOW (cumulative sum), then are joined with FULL OUTER JOIN followed by another WINDOW pass for NULL carry-forward: defer the WINDOW out of the CTEs, join daily totals, then compute cumulative sums once on the joined result. SUM() OVER() naturally skips NULLs, eliminating the need for a separate MAX() carry-forward window.",
      "verified_speedup": "1.36x",
      "principle": "Deferred Aggregation: delay expensive operations (window functions) until after joins reduce the dataset. Computing window functions inside individual CTEs then joining is more expensive than joining first and computing windows once on the combined result.",
      "example": {
        "opportunity": "CONSOLIDATE WINDOW PASSES",
        "input_slice": "[web_v1] type=cte\nSELECT ws_item_sk AS item_sk, d_date,\n  SUM(SUM(ws_sales_price)) OVER (PARTITION BY ws_item_sk ORDER BY d_date ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cume_sales\nFROM web_sales, date_dim\nWHERE ws_sold_date_sk = d_date_sk AND d_month_seq BETWEEN 1216 AND 1216+11 AND ws_item_sk IS NOT NULL\nGROUP BY ws_item_sk, d_date\n\n[store_v1] type=cte\nSELECT ss_item_sk AS item_sk, d_date,\n  SUM(SUM(ss_sales_price)) OVER (PARTITION BY ss_item_sk ORDER BY d_date ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cume_sales\nFROM store_sales, date_dim\nWHERE ss_sold_date_sk = d_date_sk AND d_month_seq BETWEEN 1216 AND 1216+11 AND ss_item_sk IS NOT NULL\nGROUP BY ss_item_sk, d_date\n\n[main_query] type=main\nSELECT * FROM (\n  SELECT item_sk, d_date, web_sales, store_sales,\n    MAX(web_sales) OVER (PARTITION BY item_sk ORDER BY d_date ROWS UNBOUNDED PRECEDING) AS web_cumulative,\n    MAX(store_sales) OVER (PARTITION BY item_sk ORDER BY d_date ROWS UNBOUNDED PRECEDING) AS store_cumulative\n  FROM (\n    SELECT COALESCE(web.item_sk, store.item_sk) AS item_sk, COALESCE(web.d_date, store.d_date) AS d_date,\n      web.cume_sales AS web_sales, store.cume_sales AS store_sales\n    FROM web_v1 web FULL OUTER JOIN store_v1 store ON (web.item_sk = store.item_sk AND web.d_date = store.d_date)\n  ) x\n) y\nWHERE web_cumulative > store_cumulative ORDER BY item_sk, d_date LIMIT 100",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "semantic_rewrite",
              "nodes": {
                "web_daily": "SELECT ws_item_sk AS item_sk, d_date, SUM(ws_sales_price) AS daily_sales FROM web_sales, date_dim WHERE ws_sold_date_sk = d_date_sk AND d_month_seq BETWEEN 1216 AND 1216 + 11 AND ws_item_sk IS NOT NULL GROUP BY ws_item_sk, d_date",
                "store_daily": "SELECT ss_item_sk AS item_sk, d_date, SUM(ss_sales_price) AS daily_sales FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_month_seq BETWEEN 1216 AND 1216 + 11 AND ss_item_sk IS NOT NULL GROUP BY ss_item_sk, d_date",
                "main_query": "SELECT * FROM (SELECT COALESCE(web.item_sk, store.item_sk) AS item_sk, COALESCE(web.d_date, store.d_date) AS d_date, SUM(web.daily_sales) OVER (PARTITION BY COALESCE(web.item_sk, store.item_sk) ORDER BY COALESCE(web.d_date, store.d_date) ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS web_cumulative, SUM(store.daily_sales) OVER (PARTITION BY COALESCE(web.item_sk, store.item_sk) ORDER BY COALESCE(web.d_date, store.d_date) ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS store_cumulative FROM web_daily web FULL OUTER JOIN store_daily store ON web.item_sk = store.item_sk AND web.d_date = store.d_date) y WHERE web_cumulative > store_cumulative ORDER BY item_sk, d_date LIMIT 100"
              },
              "invariants_kept": [
                "same result rows",
                "same ordering",
                "same column output",
                "same cumulative semantics"
              ],
              "expected_speedup": "1.4x",
              "risk": "low"
            }
          ]
        },
        "key_insight": "Principle: Deferred Aggregation \u2014 delay expensive operations (window functions) until after joins reduce the dataset. Computing windows in CTEs before joining wastes work on rows that get filtered. Here: remove WINDOW from CTEs (keep only GROUP BY for daily totals), join the reduced results, then compute SUM() OVER() once on the joined output. Reduces 3 WINDOW passes to 1, and SUM() naturally skips NULLs from the FULL OUTER JOIN.",
        "when_not_to_use": "Do not use when the CTE window function is referenced by other consumers besides the final join (the cumulative value is needed elsewhere). Do not use when the window function is not a monotonically accumulating SUM - e.g., AVG, COUNT, or non-monotonic window functions require separate computation. Only applies when the join is FULL OUTER and the carry-forward window is MAX/LAST_VALUE over a cumulative sum."
      },
      "original_sql": "WITH web_v1 as (\nselect\n  ws_item_sk item_sk, d_date,\n  sum(sum(ws_sales_price))\n      over (partition by ws_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom web_sales\n    ,date_dim\nwhere ws_sold_date_sk=d_date_sk\n  and d_month_seq between 1216 and 1216+11\n  and ws_item_sk is not NULL\ngroup by ws_item_sk, d_date),\nstore_v1 as (\nselect\n  ss_item_sk item_sk, d_date,\n  sum(sum(ss_sales_price))\n      over (partition by ss_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom store_sales\n    ,date_dim\nwhere ss_sold_date_sk=d_date_sk\n  and d_month_seq between 1216 and 1216+11\n  and ss_item_sk is not NULL\ngroup by ss_item_sk, d_date)\n select *\nfrom (select item_sk\n     ,d_date\n     ,web_sales\n     ,store_sales\n     ,max(web_sales)\n         over (partition by item_sk order by d_date rows between unbounded preceding and current row) web_cumulative\n     ,max(store_sales)\n         over (partition by item_sk order by d_date rows between unbounded preceding and current row) store_cumulative\n     from (select case when web.item_sk is not null then web.item_sk else store.item_sk end item_sk\n                 ,case when web.d_date is not null then web.d_date else store.d_date end d_date\n                 ,web.cume_sales web_sales\n                 ,store.cume_sales store_sales\n           from web_v1 web full outer join store_v1 store on (web.item_sk = store.item_sk\n                                                          and web.d_date = store.d_date)\n          )x )y\nwhere web_cumulative > store_cumulative\norder by item_sk\n        ,d_date\n LIMIT 100;",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq BETWEEN 1216 AND 1216 + 11), filtered_web_sales AS (SELECT ws_item_sk AS item_sk, d_date, ws_sales_price FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk WHERE NOT ws_item_sk IS NULL), filtered_store_sales AS (SELECT ss_item_sk AS item_sk, d_date, ss_sales_price FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk WHERE NOT ss_item_sk IS NULL), web_v1 AS (SELECT item_sk, d_date, SUM(SUM(ws_sales_price)) OVER (PARTITION BY item_sk ORDER BY d_date rows BETWEEN UNBOUNDED preceding AND CURRENT ROW) AS cume_sales FROM filtered_web_sales GROUP BY item_sk, d_date), store_v1 AS (SELECT item_sk, d_date, SUM(SUM(ss_sales_price)) OVER (PARTITION BY item_sk ORDER BY d_date rows BETWEEN UNBOUNDED preceding AND CURRENT ROW) AS cume_sales FROM filtered_store_sales GROUP BY item_sk, d_date)\nSELECT * FROM (SELECT item_sk, d_date, web_sales, store_sales, MAX(web_sales) OVER (PARTITION BY item_sk ORDER BY d_date rows BETWEEN UNBOUNDED preceding AND CURRENT ROW) AS web_cumulative, MAX(store_sales) OVER (PARTITION BY item_sk ORDER BY d_date rows BETWEEN UNBOUNDED preceding AND CURRENT ROW) AS store_cumulative FROM (SELECT CASE WHEN NOT web.item_sk IS NULL THEN web.item_sk ELSE store.item_sk END AS item_sk, CASE WHEN NOT web.d_date IS NULL THEN web.d_date ELSE store.d_date END AS d_date, web.cume_sales AS web_sales, store.cume_sales AS store_sales FROM web_v1 AS web FULL OUTER JOIN store_v1 AS store ON (web.item_sk = store.item_sk AND web.d_date = store.d_date)) AS x) AS y WHERE web_cumulative > store_cumulative ORDER BY item_sk, d_date LIMIT 100;",
      "optimized_source": "dsr1"
    },
    {
      "id": "dimension_cte_isolate",
      "name": "Dimension CTE Isolation",
      "description": "Pre-filter ALL dimension tables into CTEs before joining with fact table, not just date_dim",
      "verified_speedup": "1.93x",
      "principle": "Early Selection: pre-filter dimension tables into CTEs returning only surrogate keys before joining with fact tables. Each dimension CTE is tiny, creating small hash tables that speed up the fact table probe.",
      "example": {
        "opportunity": "DIMENSION CTE ISOLATION",
        "input_slice": "SELECT i_item_id, avg(cs_quantity) agg1, avg(cs_list_price) agg2, avg(cs_coupon_amt) agg3, avg(cs_sales_price) agg4\nFROM catalog_sales, customer_demographics, date_dim, item, promotion\nWHERE cs_sold_date_sk = d_date_sk AND cs_item_sk = i_item_sk\n  AND cs_bill_cdemo_sk = cd_demo_sk AND cs_promo_sk = p_promo_sk\n  AND cd_gender = 'M' AND cd_marital_status = 'S' AND cd_education_status = 'College'\n  AND (p_channel_email = 'N' OR p_channel_event = 'N') AND d_year = 2000\nGROUP BY i_item_id ORDER BY i_item_id LIMIT 100",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "dimension_cte_isolate",
              "nodes": {
                "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_year = 2000",
                "filtered_customer_demographics": "SELECT cd_demo_sk FROM customer_demographics WHERE cd_gender = 'M' AND cd_marital_status = 'S' AND cd_education_status = 'College'",
                "filtered_promotions": "SELECT p_promo_sk FROM promotion WHERE p_channel_email = 'N' OR p_channel_event = 'N'",
                "joined_facts": "SELECT cs_item_sk, cs_quantity, cs_list_price, cs_coupon_amt, cs_sales_price FROM catalog_sales AS cs JOIN filtered_dates AS fd ON cs.cs_sold_date_sk = fd.d_date_sk JOIN filtered_customer_demographics AS fcd ON cs.cs_bill_cdemo_sk = fcd.cd_demo_sk JOIN filtered_promotions AS fp ON cs.cs_promo_sk = fp.p_promo_sk",
                "main_query": "SELECT i_item_id, AVG(cs_quantity) AS agg1, AVG(cs_list_price) AS agg2, AVG(cs_coupon_amt) AS agg3, AVG(cs_sales_price) AS agg4 FROM joined_facts AS jf JOIN item AS i ON jf.cs_item_sk = i.i_item_sk GROUP BY i_item_id ORDER BY i_item_id LIMIT 100"
              },
              "invariants_kept": [
                "same result rows",
                "same ordering",
                "same column output"
              ],
              "expected_speedup": "1.90x",
              "risk": "low"
            }
          ]
        },
        "key_insight": "Principle: Early Selection \u2014 pre-filter dimension tables into CTEs returning only surrogate keys before joining with fact tables. Each CTE creates a tiny hash table that the fact join probes against, reducing intermediate cardinality. Here: isolate date, demographics, and promotions into separate filtered CTEs, then join their keys with the fact table. Most effective when dimension filters are highly selective."
      },
      "original_sql": "select i_item_id, \n        avg(cs_quantity) agg1,\n        avg(cs_list_price) agg2,\n        avg(cs_coupon_amt) agg3,\n        avg(cs_sales_price) agg4 \n from catalog_sales, customer_demographics, date_dim, item, promotion\n where cs_sold_date_sk = d_date_sk and\n       cs_item_sk = i_item_sk and\n       cs_bill_cdemo_sk = cd_demo_sk and\n       cs_promo_sk = p_promo_sk and\n       cd_gender = 'M' and \n       cd_marital_status = 'S' and\n       cd_education_status = 'Unknown' and\n       (p_channel_email = 'N' or p_channel_event = 'N') and\n       d_year = 2001 \n group by i_item_id\n order by i_item_id\n LIMIT 100;",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2000), filtered_customer_demographics AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_gender = 'M' AND cd_marital_status = 'S' AND cd_education_status = 'College'), prejoined_sales AS (SELECT cs.cs_quantity, cs.cs_list_price, cs.cs_coupon_amt, cs.cs_sales_price, i.i_item_id, p.p_channel_email, p.p_channel_event FROM catalog_sales AS cs JOIN filtered_dates AS fd ON cs.cs_sold_date_sk = fd.d_date_sk JOIN filtered_customer_demographics AS fcd ON cs.cs_bill_cdemo_sk = fcd.cd_demo_sk JOIN item AS i ON cs.cs_item_sk = i.i_item_sk JOIN promotion AS p ON cs.cs_promo_sk = p.p_promo_sk), branch_both AS (SELECT cs_quantity, cs_list_price, cs_coupon_amt, cs_sales_price, i_item_id FROM prejoined_sales WHERE p_channel_email = 'N' AND p_channel_event = 'N'), branch_email AS (SELECT cs_quantity, cs_list_price, cs_coupon_amt, cs_sales_price, i_item_id FROM prejoined_sales WHERE p_channel_email = 'N' AND p_channel_event <> 'N'), branch_event AS (SELECT cs_quantity, cs_list_price, cs_coupon_amt, cs_sales_price, i_item_id FROM prejoined_sales WHERE p_channel_email <> 'N' AND p_channel_event = 'N'), combined_sales AS (SELECT * FROM branch_email UNION ALL SELECT * FROM branch_event UNION ALL SELECT * FROM branch_both)\nSELECT i_item_id, AVG(cs_quantity) AS agg1, AVG(cs_list_price) AS agg2, AVG(cs_coupon_amt) AS agg3, AVG(cs_sales_price) AS agg4 FROM combined_sales GROUP BY i_item_id ORDER BY i_item_id LIMIT 100;",
      "optimized_source": "dsr1"
    },
    {
      "id": "channel_bitmap_aggregation",
      "name": "Channel Bitmap Aggregation",
      "description": "Consolidate repeated scans of the same fact table (one per time/channel bucket) into a single scan with CASE WHEN labels and conditional aggregation",
      "verified_speedup": "6.24x",
      "engine": "duckdb",
      "example": {
        "opportunity": "SINGLE_PASS_AGGREGATION + DIMENSION_CTE_ISOLATE",
        "input_slice": "select * from\n (select count(*) h8_30_to_9\n from store_sales, household_demographics, time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n   and ss_hdemo_sk = household_demographics.hd_demo_sk\n   and ss_store_sk = s_store_sk\n   and time_dim.t_hour = 8 and time_dim.t_minute >= 30\n   and ((hd_dep_count = -1 and hd_vehicle_count <= 1) or ...)\n   and store.s_store_name = 'ese') s1,\n (select count(*) h9_to_9_30 ...same pattern for 8 time buckets...)",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "single_pass_aggregation",
              "nodes": {
                "filtered_store": "SELECT s_store_sk FROM store WHERE s_store_name = 'ese'",
                "filtered_hd": "SELECT hd_demo_sk FROM household_demographics WHERE (hd_dep_count = -1 AND hd_vehicle_count <= 1) OR (hd_dep_count = 4 AND hd_vehicle_count <= 6) OR (hd_dep_count = 3 AND hd_vehicle_count <= 5)",
                "time_ranges": "SELECT t_time_sk, CASE WHEN t_hour = 8 AND t_minute >= 30 THEN 1 WHEN t_hour = 9 AND t_minute < 30 THEN 2 WHEN t_hour = 9 AND t_minute >= 30 THEN 3 WHEN t_hour = 10 AND t_minute < 30 THEN 4 WHEN t_hour = 10 AND t_minute >= 30 THEN 5 WHEN t_hour = 11 AND t_minute < 30 THEN 6 WHEN t_hour = 11 AND t_minute >= 30 THEN 7 WHEN t_hour = 12 AND t_minute < 30 THEN 8 END AS time_window FROM time_dim WHERE (t_hour BETWEEN 8 AND 12)",
                "sales_with_time": "SELECT tr.time_window FROM store_sales ss JOIN filtered_store fs ON ss.ss_store_sk = fs.s_store_sk JOIN filtered_hd fhd ON ss.ss_hdemo_sk = fhd.hd_demo_sk JOIN time_ranges tr ON ss.ss_sold_time_sk = tr.t_time_sk",
                "main_query": "SELECT COUNT(CASE WHEN time_window = 1 THEN 1 END) AS h8_30_to_9, COUNT(CASE WHEN time_window = 2 THEN 1 END) AS h9_to_9_30, COUNT(CASE WHEN time_window = 3 THEN 1 END) AS h9_30_to_10, COUNT(CASE WHEN time_window = 4 THEN 1 END) AS h10_to_10_30, COUNT(CASE WHEN time_window = 5 THEN 1 END) AS h10_30_to_11, COUNT(CASE WHEN time_window = 6 THEN 1 END) AS h11_to_11_30, COUNT(CASE WHEN time_window = 7 THEN 1 END) AS h11_30_to_12, COUNT(CASE WHEN time_window = 8 THEN 1 END) AS h12_to_12_30 FROM sales_with_time"
              },
              "invariants_kept": [
                "output columns unchanged",
                "same row counts per bucket"
              ],
              "expected_speedup": "6.24x",
              "risk": "low"
            }
          ]
        },
        "key_insight": "The original query scans store_sales 8 times (once per time bucket), each with identical dimension joins. Consolidating into a single scan with CASE WHEN labels inside COUNT() reduces I/O from 8x to 1x. Dimension pre-filtering CTEs further reduce the join probe size.",
        "when_not_to_use": "Do not use when the number of distinct buckets exceeds 8 (diminishing returns from CASE evaluation overhead). Also not applicable when each subquery has structurally different joins or table references."
      },
      "original_sql": "select * from\n (select count(*) h8_30_to_9\n from store_sales, household_demographics, time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n   and ss_hdemo_sk = household_demographics.hd_demo_sk\n   and ss_store_sk = s_store_sk\n   and time_dim.t_hour = 8 and time_dim.t_minute >= 30\n   and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n        (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n        (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n   and store.s_store_name = 'ese') s1,\n (select count(*) h9_to_9_30\n from store_sales, household_demographics, time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n   and ss_hdemo_sk = household_demographics.hd_demo_sk\n   and ss_store_sk = s_store_sk\n   and time_dim.t_hour = 9 and time_dim.t_minute < 30\n   and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n        (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n        (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n   and store.s_store_name = 'ese') s2,\n (select count(*) h9_30_to_10\n from store_sales, household_demographics, time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n   and ss_hdemo_sk = household_demographics.hd_demo_sk\n   and ss_store_sk = s_store_sk\n   and time_dim.t_hour = 9 and time_dim.t_minute >= 30\n   and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n        (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n        (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n   and store.s_store_name = 'ese') s3,\n (select count(*) h10_to_10_30\n from store_sales, household_demographics, time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n   and ss_hdemo_sk = household_demographics.hd_demo_sk\n   and ss_store_sk = s_store_sk\n   and time_dim.t_hour = 10 and time_dim.t_minute < 30\n   and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n        (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n        (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n   and store.s_store_name = 'ese') s4,\n (select count(*) h10_30_to_11\n from store_sales, household_demographics, time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n   and ss_hdemo_sk = household_demographics.hd_demo_sk\n   and ss_store_sk = s_store_sk\n   and time_dim.t_hour = 10 and time_dim.t_minute >= 30\n   and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n        (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n        (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n   and store.s_store_name = 'ese') s5,\n (select count(*) h11_to_11_30\n from store_sales, household_demographics, time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n   and ss_hdemo_sk = household_demographics.hd_demo_sk\n   and ss_store_sk = s_store_sk\n   and time_dim.t_hour = 11 and time_dim.t_minute < 30\n   and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n        (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n        (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n   and store.s_store_name = 'ese') s6,\n (select count(*) h11_30_to_12\n from store_sales, household_demographics, time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n   and ss_hdemo_sk = household_demographics.hd_demo_sk\n   and ss_store_sk = s_store_sk\n   and time_dim.t_hour = 11 and time_dim.t_minute >= 30\n   and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n        (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n        (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n   and store.s_store_name = 'ese') s7,\n (select count(*) h12_to_12_30\n from store_sales, household_demographics, time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n   and ss_hdemo_sk = household_demographics.hd_demo_sk\n   and ss_store_sk = s_store_sk\n   and time_dim.t_hour = 12 and time_dim.t_minute < 30\n   and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n        (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n        (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n   and store.s_store_name = 'ese') s8;",
      "optimized_sql": "WITH filtered_store AS (SELECT s_store_sk FROM store WHERE s_store_name = 'ese'), filtered_hd AS (SELECT hd_demo_sk FROM household_demographics WHERE (hd_dep_count = -1 AND hd_vehicle_count <= -1 + 2) OR (hd_dep_count = 4 AND hd_vehicle_count <= 4 + 2) OR (hd_dep_count = 3 AND hd_vehicle_count <= 3 + 2)), time_ranges AS (SELECT t_time_sk, CASE WHEN t_hour = 8 AND t_minute >= 30 THEN 1 WHEN t_hour = 9 AND t_minute < 30 THEN 2 WHEN t_hour = 9 AND t_minute >= 30 THEN 3 WHEN t_hour = 10 AND t_minute < 30 THEN 4 WHEN t_hour = 10 AND t_minute >= 30 THEN 5 WHEN t_hour = 11 AND t_minute < 30 THEN 6 WHEN t_hour = 11 AND t_minute >= 30 THEN 7 WHEN t_hour = 12 AND t_minute < 30 THEN 8 END AS time_window FROM time_dim WHERE (t_hour = 8 AND t_minute >= 30) OR (t_hour = 9 AND t_minute < 30) OR (t_hour = 9 AND t_minute >= 30) OR (t_hour = 10 AND t_minute < 30) OR (t_hour = 10 AND t_minute >= 30) OR (t_hour = 11 AND t_minute < 30) OR (t_hour = 11 AND t_minute >= 30) OR (t_hour = 12 AND t_minute < 30)), sales_with_time AS (SELECT tr.time_window FROM store_sales ss JOIN filtered_store fs ON ss.ss_store_sk = fs.s_store_sk JOIN filtered_hd fhd ON ss.ss_hdemo_sk = fhd.hd_demo_sk JOIN time_ranges tr ON ss.ss_sold_time_sk = tr.t_time_sk)\nSELECT COUNT(CASE WHEN time_window = 1 THEN 1 END) AS h8_30_to_9, COUNT(CASE WHEN time_window = 2 THEN 1 END) AS h9_to_9_30, COUNT(CASE WHEN time_window = 3 THEN 1 END) AS h9_30_to_10, COUNT(CASE WHEN time_window = 4 THEN 1 END) AS h10_to_10_30, COUNT(CASE WHEN time_window = 5 THEN 1 END) AS h10_30_to_11, COUNT(CASE WHEN time_window = 6 THEN 1 END) AS h11_to_11_30, COUNT(CASE WHEN time_window = 7 THEN 1 END) AS h11_30_to_12, COUNT(CASE WHEN time_window = 8 THEN 1 END) AS h12_to_12_30 FROM sales_with_time;",
      "optimized_source": "swarm_w2",
      "sf10_rows_match": true
    },
    {
      "id": "decorrelate",
      "name": "Decorrelate Subquery",
      "description": "Convert correlated subquery to separate CTE with GROUP BY, then JOIN",
      "verified_speedup": "2.92x",
      "principle": "Decorrelation: convert correlated subqueries to standalone CTEs with GROUP BY, then JOIN. Correlated subqueries re-execute per outer row; a pre-computed CTE executes once.",
      "example": {
        "opportunity": "DECORRELATE + PUSHDOWN",
        "input_slice": "[customer_total_return] CORRELATED:\nSELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, SUM(SR_FEE) AS ctr_total_return\nFROM store_returns, date_dim\nWHERE sr_returned_date_sk = d_date_sk AND d_year = 2000\nGROUP BY sr_customer_sk, sr_store_sk\n\n[main_query]:\nSELECT c_customer_id FROM customer_total_return ctr1, store, customer\nWHERE ctr1.ctr_total_return > (SELECT avg(ctr_total_return)*1.2 FROM customer_total_return ctr2 WHERE ctr1.ctr_store_sk = ctr2.ctr_store_sk)\n  AND s_store_sk = ctr1.ctr_store_sk AND s_state = 'SD' AND ctr1.ctr_customer_sk = c_customer_sk\nORDER BY c_customer_id LIMIT 100",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "decorrelate",
              "nodes": {
                "filtered_returns": "SELECT sr.sr_customer_sk, sr.sr_store_sk, sr.sr_fee FROM store_returns sr JOIN date_dim d ON sr.sr_returned_date_sk = d.d_date_sk JOIN store s ON sr.sr_store_sk = s.s_store_sk WHERE d.d_year = 2000 AND s.s_state = 'SD'",
                "customer_total_return": "SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, SUM(sr_fee) AS ctr_total_return FROM filtered_returns GROUP BY sr_customer_sk, sr_store_sk",
                "store_avg_return": "SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS avg_return_threshold FROM customer_total_return GROUP BY ctr_store_sk",
                "main_query": "SELECT c.c_customer_id FROM customer_total_return ctr1 JOIN store_avg_return sar ON ctr1.ctr_store_sk = sar.ctr_store_sk JOIN customer c ON ctr1.ctr_customer_sk = c.c_customer_sk WHERE ctr1.ctr_total_return > sar.avg_return_threshold ORDER BY c.c_customer_id LIMIT 100"
              },
              "invariants_kept": [
                "same result rows",
                "same ordering",
                "same column output"
              ],
              "expected_speedup": "2.90x",
              "risk": "low"
            }
          ]
        },
        "key_insight": "Principle: Decorrelation \u2014 convert correlated subqueries to standalone CTEs with GROUP BY, then JOIN. Correlated subqueries re-execute per outer row; a pre-computed CTE executes once. Here: push s_state='SD' filter early into first CTE, compute average as separate CTE with GROUP BY (not window function), then JOIN on the average threshold."
      },
      "original_sql": "with customer_total_return as\n(select sr_customer_sk as ctr_customer_sk\n,sr_store_sk as ctr_store_sk\n,sum(SR_FEE) as ctr_total_return\nfrom store_returns\n,date_dim\nwhere sr_returned_date_sk = d_date_sk\nand d_year =2000\ngroup by sr_customer_sk\n,sr_store_sk)\n select c_customer_id\nfrom customer_total_return ctr1\n,store\n,customer\nwhere ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2\nfrom customer_total_return ctr2\nwhere ctr1.ctr_store_sk = ctr2.ctr_store_sk)\nand s_store_sk = ctr1.ctr_store_sk\nand s_state = 'SD'\nand ctr1.ctr_customer_sk = c_customer_sk\norder by c_customer_id\n LIMIT 100;",
      "optimized_sql": "WITH filtered_returns AS (SELECT sr.sr_customer_sk, sr.sr_store_sk, sr.SR_FEE FROM store_returns AS sr JOIN date_dim AS d ON sr.sr_returned_date_sk = d.d_date_sk JOIN store AS s ON sr.sr_store_sk = s.s_store_sk WHERE d.d_year = 2000 AND s.s_state = 'SD'), customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, SUM(SR_FEE) AS ctr_total_return FROM filtered_returns GROUP BY sr_customer_sk, sr_store_sk), store_avg_return AS (SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS avg_return_threshold FROM customer_total_return GROUP BY ctr_store_sk)\nSELECT c.c_customer_id FROM customer_total_return AS ctr1 JOIN store_avg_return AS sar ON ctr1.ctr_store_sk = sar.ctr_store_sk JOIN customer AS c ON ctr1.ctr_customer_sk = c.c_customer_sk WHERE ctr1.ctr_total_return > sar.avg_return_threshold ORDER BY c.c_customer_id LIMIT 100;",
      "optimized_source": "kimi",
      "sf10_rows_match": true
    },
    {
      "id": "rollup_to_union_windowing",
      "name": "ROLLUP to UNION ALL Windowing",
      "description": "Replace GROUP BY ROLLUP with explicit UNION ALL of pre-aggregated CTEs at each hierarchy level, combined with window functions for ranking",
      "verified_speedup": "2.47x",
      "engine": "duckdb",
      "example": {
        "opportunity": "EARLY_FILTER + MATERIALIZE_CTE + UNION_CTE_SPLIT",
        "input_slice": "select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n  i_category, i_class,\n  grouping(i_category)+grouping(i_class) as lochierarchy,\n  rank() over (partition by grouping(i_category)+grouping(i_class),\n    case when grouping(i_class) = 0 then i_category end\n    order by sum(ss_net_profit)/sum(ss_ext_sales_price) asc) as rank_within_parent\nfrom store_sales, date_dim d1, item, store\nwhere d1.d_year = 2002 and d1.d_date_sk = ss_sold_date_sk\n  and i_item_sk = ss_item_sk and s_store_sk = ss_store_sk\n  and s_state in ('SD','TN','GA','SC','MO','AL','MI','OH')\ngroup by rollup(i_category,i_class)\norder by lochierarchy desc, case when lochierarchy = 0 then i_category end, rank_within_parent\nLIMIT 100",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "early_filter",
              "nodes": {
                "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_year = 2002",
                "filtered_stores": "SELECT s_store_sk FROM store WHERE s_state IN ('SD', 'TN', 'GA', 'SC', 'MO', 'AL', 'MI', 'OH')",
                "item_sums": "SELECT ss_item_sk, SUM(ss_net_profit) AS net_profit, SUM(ss_ext_sales_price) AS sales_price FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN filtered_stores ON ss_store_sk = s_store_sk GROUP BY ss_item_sk",
                "item_aggregates": "SELECT i.i_category, i.i_class, SUM(item_sums.net_profit) AS net_profit, SUM(item_sums.sales_price) AS sales_price FROM item_sums JOIN item i ON item_sums.ss_item_sk = i.i_item_sk GROUP BY i.i_category, i.i_class",
                "detailed": "SELECT net_profit / sales_price AS gross_margin, i_category, i_class, 0 AS lochierarchy FROM item_aggregates WHERE sales_price <> 0",
                "category_summary": "SELECT SUM(net_profit) / SUM(sales_price) AS gross_margin, i_category, NULL AS i_class, 1 AS lochierarchy FROM item_aggregates WHERE sales_price <> 0 GROUP BY i_category",
                "grand_total": "SELECT SUM(net_profit) / SUM(sales_price) AS gross_margin, NULL AS i_category, NULL AS i_class, 2 AS lochierarchy FROM item_aggregates WHERE sales_price <> 0",
                "all_levels": "SELECT * FROM detailed UNION ALL SELECT * FROM category_summary UNION ALL SELECT * FROM grand_total",
                "main_query": "SELECT gross_margin, i_category, i_class, lochierarchy, CASE WHEN lochierarchy < 2 THEN RANK() OVER (PARTITION BY lochierarchy, CASE WHEN lochierarchy = 0 THEN i_category END ORDER BY gross_margin ASC) ELSE 1 END AS rank_within_parent FROM all_levels ORDER BY lochierarchy DESC, CASE WHEN lochierarchy = 0 THEN i_category END, rank_within_parent LIMIT 100"
              },
              "invariants_kept": [
                "output columns unchanged",
                "same hierarchy levels"
              ],
              "expected_speedup": "2.47x",
              "risk": "medium"
            }
          ]
        },
        "key_insight": "ROLLUP generates all grouping levels in a single pass, but the optimizer cannot specialize each level's aggregation. Breaking into explicit UNION ALL of pre-computed CTEs allows each level to use the already-aggregated item_aggregates CTE, and dimension filters are pushed into early CTEs.",
        "when_not_to_use": "Do not use when ROLLUP generates all levels efficiently (small dimension tables, few groups) or when the query genuinely needs all possible grouping set combinations. Only beneficial when specific levels need different optimization paths."
      },
      "original_sql": "select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin, i_category, i_class, grouping(i_category)+grouping(i_class) as lochierarchy, rank() over (partition by grouping(i_category)+grouping(i_class), case when grouping(i_class) = 0 then i_category end order by sum(ss_net_profit)/sum(ss_ext_sales_price) asc) as rank_within_parent from store_sales, date_dim d1, item, store where d1.d_year = 2002 and d1.d_date_sk = ss_sold_date_sk and i_item_sk = ss_item_sk and s_store_sk = ss_store_sk and s_state in ('SD','TN','GA','SC','MO','AL','MI','OH') group by rollup(i_category,i_class) order by lochierarchy desc, case when lochierarchy = 0 then i_category end, rank_within_parent LIMIT 100;",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002), filtered_stores AS (SELECT s_store_sk FROM store WHERE s_state IN ('SD', 'TN', 'GA', 'SC', 'MO', 'AL', 'MI', 'OH')), item_sums AS (SELECT ss_item_sk, SUM(ss_net_profit) AS net_profit, SUM(ss_ext_sales_price) AS sales_price FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = filtered_dates.d_date_sk JOIN filtered_stores ON ss_store_sk = filtered_stores.s_store_sk GROUP BY ss_item_sk), item_aggregates AS (SELECT i.i_category, i.i_class, SUM(item_sums.net_profit) AS net_profit, SUM(item_sums.sales_price) AS sales_price FROM item_sums JOIN item i ON item_sums.ss_item_sk = i.i_item_sk GROUP BY i.i_category, i.i_class), detailed AS (SELECT net_profit / sales_price AS gross_margin, i_category, i_class, 0 AS lochierarchy FROM item_aggregates WHERE sales_price <> 0), category_summary AS (SELECT SUM(net_profit) / SUM(sales_price) AS gross_margin, i_category, NULL AS i_class, 1 AS lochierarchy FROM item_aggregates WHERE sales_price <> 0 GROUP BY i_category), grand_total AS (SELECT SUM(net_profit) / SUM(sales_price) AS gross_margin, NULL AS i_category, NULL AS i_class, 2 AS lochierarchy FROM item_aggregates WHERE sales_price <> 0), all_levels AS (SELECT * FROM detailed UNION ALL SELECT * FROM category_summary UNION ALL SELECT * FROM grand_total), ranked AS (SELECT gross_margin, i_category, i_class, lochierarchy, CASE WHEN lochierarchy < 2 THEN RANK() OVER (PARTITION BY lochierarchy, CASE WHEN lochierarchy = 0 THEN i_category END ORDER BY gross_margin ASC) ELSE 1 END AS rank_within_parent FROM all_levels)\nSELECT gross_margin, i_category, i_class, lochierarchy, rank_within_parent FROM ranked ORDER BY lochierarchy DESC, CASE WHEN lochierarchy = 0 THEN i_category END, rank_within_parent LIMIT 100;",
      "optimized_source": "swarm_final_worker",
      "sf10_rows_match": true
    },
    {
      "id": "self_join_decomposition",
      "name": "Self-Join Decomposition",
      "description": "Split self-joined CTE with different filter values into separate per-filter CTEs to avoid full materialization and post-filtering",
      "verified_speedup": "4.76x",
      "principle": "When a CTE is self-joined with different filter values (e.g., inv1.d_moy=1 AND inv2.d_moy=2), split into separate CTEs each embedding their filter. The optimizer cannot push the outer WHERE filter into the CTE's GROUP BY, causing full materialization and post-filtering.",
      "example": {
        "opportunity": "SELF_JOIN_DECOMPOSITION",
        "input_slice": "WITH inv AS (\n  SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy,\n    stdev, mean, CASE mean WHEN 0 THEN NULL ELSE stdev/mean END cov\n  FROM (SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy,\n          stddev_samp(inv_quantity_on_hand) stdev, avg(inv_quantity_on_hand) mean\n        FROM inventory, item, warehouse, date_dim\n        WHERE inv_item_sk = i_item_sk AND inv_warehouse_sk = w_warehouse_sk\n          AND inv_date_sk = d_date_sk AND d_year = 1998\n        GROUP BY w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy) foo\n  WHERE CASE mean WHEN 0 THEN 0 ELSE stdev/mean END > 1)\nSELECT inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov,\n       inv2.w_warehouse_sk, inv2.i_item_sk, inv2.d_moy, inv2.mean, inv2.cov\nFROM inv inv1, inv inv2\nWHERE inv1.i_item_sk = inv2.i_item_sk AND inv1.w_warehouse_sk = inv2.w_warehouse_sk\n  AND inv1.d_moy=1 AND inv2.d_moy=1+1\nORDER BY inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov,\n         inv2.d_moy, inv2.mean, inv2.cov",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "self_join_decomposition",
              "nodes": {
                "month1_stats": "SELECT w_warehouse_sk, i_item_sk, 1 AS d_moy, stddev_samp(inv_quantity_on_hand) AS stdev, avg(inv_quantity_on_hand) AS mean, CASE WHEN avg(inv_quantity_on_hand) = 0 THEN NULL ELSE stddev_samp(inv_quantity_on_hand)/avg(inv_quantity_on_hand) END AS cov FROM inventory JOIN item ON inv_item_sk = i_item_sk JOIN warehouse ON inv_warehouse_sk = w_warehouse_sk JOIN date_dim ON inv_date_sk = d_date_sk WHERE d_year = 1998 AND d_moy = 1 GROUP BY w_warehouse_sk, i_item_sk HAVING CASE WHEN avg(inv_quantity_on_hand) = 0 THEN 0 ELSE stddev_samp(inv_quantity_on_hand)/avg(inv_quantity_on_hand) END > 1",
                "month2_stats": "SELECT w_warehouse_sk, i_item_sk, 2 AS d_moy, stddev_samp(inv_quantity_on_hand) AS stdev, avg(inv_quantity_on_hand) AS mean, CASE WHEN avg(inv_quantity_on_hand) = 0 THEN NULL ELSE stddev_samp(inv_quantity_on_hand)/avg(inv_quantity_on_hand) END AS cov FROM inventory JOIN item ON inv_item_sk = i_item_sk JOIN warehouse ON inv_warehouse_sk = w_warehouse_sk JOIN date_dim ON inv_date_sk = d_date_sk WHERE d_year = 1998 AND d_moy = 2 GROUP BY w_warehouse_sk, i_item_sk HAVING CASE WHEN avg(inv_quantity_on_hand) = 0 THEN 0 ELSE stddev_samp(inv_quantity_on_hand)/avg(inv_quantity_on_hand) END > 1",
                "main_query": "SELECT month1_stats.w_warehouse_sk, month1_stats.i_item_sk, month1_stats.d_moy, month1_stats.mean, month1_stats.cov, month2_stats.w_warehouse_sk, month2_stats.i_item_sk, month2_stats.d_moy, month2_stats.mean, month2_stats.cov FROM month1_stats JOIN month2_stats ON month1_stats.w_warehouse_sk = month2_stats.w_warehouse_sk AND month1_stats.i_item_sk = month2_stats.i_item_sk ORDER BY month1_stats.w_warehouse_sk, month1_stats.i_item_sk, month1_stats.d_moy, month1_stats.mean, month1_stats.cov, month2_stats.d_moy, month2_stats.mean, month2_stats.cov"
              },
              "invariants_kept": [
                "output columns unchanged",
                "grain preserved",
                "same result rows"
              ],
              "expected_speedup": "4.76x",
              "risk": "low"
            }
          ]
        },
        "key_insight": "Principle: Self-Join Decomposition \u2014 when a CTE is self-joined with different discriminator filters (d_moy=1 vs d_moy=2), the optimizer materializes the CTE for ALL months then post-filters. Splitting into month1_stats and month2_stats CTEs each with their own d_moy filter means each CTE aggregates only its month's rows. The comma join is also converted to explicit JOIN ON. 4.76x speedup from processing 1/12th of the data in each CTE.",
        "when_not_to_use": "Only applies when the CTE is self-joined with different discriminator values. If the self-join uses the same filter on both aliases, decomposition provides no benefit."
      },
      "original_sql": "with inv as\n(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n       ,stdev,mean, case mean when 0 then null else stdev/mean end cov\n from(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n            ,stddev_samp(inv_quantity_on_hand) stdev,avg(inv_quantity_on_hand) mean\n      from inventory\n          ,item\n          ,warehouse\n          ,date_dim\n      where inv_item_sk = i_item_sk\n        and inv_warehouse_sk = w_warehouse_sk\n        and inv_date_sk = d_date_sk\n        and d_year =1998\n      group by w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy) foo\n where case mean when 0 then 0 else stdev/mean end > 1)\nselect inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean, inv1.cov\n        ,inv2.w_warehouse_sk,inv2.i_item_sk,inv2.d_moy,inv2.mean, inv2.cov\nfrom inv inv1,inv inv2\nwhere inv1.i_item_sk = inv2.i_item_sk\n  and inv1.w_warehouse_sk =  inv2.w_warehouse_sk\n  and inv1.d_moy=1\n  and inv2.d_moy=1+1\norder by inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean,inv1.cov\n        ,inv2.d_moy,inv2.mean, inv2.cov\n;",
      "optimized_sql": "WITH month1_stats AS (SELECT w_warehouse_sk, i_item_sk, 1 AS d_moy, stddev_samp(inv_quantity_on_hand) AS stdev, avg(inv_quantity_on_hand) AS mean, CASE WHEN avg(inv_quantity_on_hand) = 0 THEN NULL ELSE stddev_samp(inv_quantity_on_hand)/avg(inv_quantity_on_hand) END AS cov FROM inventory JOIN item ON inv_item_sk = i_item_sk JOIN warehouse ON inv_warehouse_sk = w_warehouse_sk JOIN date_dim ON inv_date_sk = d_date_sk WHERE d_year = 1998 AND d_moy = 1 GROUP BY w_warehouse_sk, i_item_sk HAVING CASE WHEN avg(inv_quantity_on_hand) = 0 THEN 0 ELSE stddev_samp(inv_quantity_on_hand)/avg(inv_quantity_on_hand) END > 1), month2_stats AS (SELECT w_warehouse_sk, i_item_sk, 2 AS d_moy, stddev_samp(inv_quantity_on_hand) AS stdev, avg(inv_quantity_on_hand) AS mean, CASE WHEN avg(inv_quantity_on_hand) = 0 THEN NULL ELSE stddev_samp(inv_quantity_on_hand)/avg(inv_quantity_on_hand) END AS cov FROM inventory JOIN item ON inv_item_sk = i_item_sk JOIN warehouse ON inv_warehouse_sk = w_warehouse_sk JOIN date_dim ON inv_date_sk = d_date_sk WHERE d_year = 1998 AND d_moy = 2 GROUP BY w_warehouse_sk, i_item_sk HAVING CASE WHEN avg(inv_quantity_on_hand) = 0 THEN 0 ELSE stddev_samp(inv_quantity_on_hand)/avg(inv_quantity_on_hand) END > 1) SELECT month1_stats.w_warehouse_sk, month1_stats.i_item_sk, month1_stats.d_moy, month1_stats.mean, month1_stats.cov, month2_stats.w_warehouse_sk, month2_stats.i_item_sk, month2_stats.d_moy, month2_stats.mean, month2_stats.cov FROM month1_stats JOIN month2_stats ON month1_stats.w_warehouse_sk = month2_stats.w_warehouse_sk AND month1_stats.i_item_sk = month2_stats.i_item_sk ORDER BY month1_stats.w_warehouse_sk, month1_stats.i_item_sk, month1_stats.d_moy, month1_stats.mean, month1_stats.cov, month2_stats.d_moy, month2_stats.mean, month2_stats.cov",
      "optimized_source": "swarm_w2",
      "sf10_rows_match": true
    },
    {
      "id": "aggregate_pushdown",
      "name": "Aggregate Pushdown Below Joins",
      "description": "Pre-aggregate fact table by join key before dimension joins to reduce rows entering the join from millions to thousands",
      "verified_speedup": "42.90x",
      "principle": "Push aggregation below joins: when a GROUP BY + aggregate operates on a single fact table joined with dimensions, pre-aggregate the fact table on the join key first, THEN join with dimensions. Reduces rows entering the join from millions to thousands.",
      "example": {
        "opportunity": "AGGREGATE_PUSHDOWN",
        "input_slice": "SELECT i_product_name, i_brand, i_class, i_category, avg(inv_quantity_on_hand) qoh\nFROM inventory, date_dim, item\nWHERE inv_date_sk=d_date_sk AND inv_item_sk=i_item_sk\n  AND d_month_seq BETWEEN 1188 AND 1188 + 11\nGROUP BY ROLLUP(i_product_name, i_brand, i_class, i_category)\nORDER BY qoh, i_product_name, i_brand, i_class, i_category\nLIMIT 100",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "aggregate_pushdown",
              "nodes": {
                "date_filtered": "SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1188 AND 1188 + 11",
                "inventory_date": "SELECT inv_item_sk, inv_quantity_on_hand FROM inventory JOIN date_filtered ON inv_date_sk = d_date_sk",
                "inventory_agg": "SELECT inv_item_sk, SUM(inv_quantity_on_hand) AS sum_qty, COUNT(inv_quantity_on_hand) AS cnt FROM inventory_date GROUP BY inv_item_sk",
                "join_item": "SELECT i_product_name, i_brand, i_class, i_category, sum_qty, cnt FROM inventory_agg JOIN item ON inv_item_sk = i_item_sk",
                "rollup_aggregate": "SELECT i_product_name, i_brand, i_class, i_category, CASE WHEN SUM(cnt) > 0 THEN SUM(sum_qty) / SUM(cnt) END AS qoh FROM join_item GROUP BY ROLLUP(i_product_name, i_brand, i_class, i_category)",
                "main_query": "SELECT i_product_name, i_brand, i_class, i_category, qoh FROM rollup_aggregate ORDER BY qoh ASC, i_product_name ASC, i_brand ASC, i_class ASC, i_category ASC LIMIT 100"
              },
              "invariants_kept": [
                "output columns unchanged",
                "grain preserved",
                "same result rows"
              ],
              "expected_speedup": "42.90x",
              "risk": "medium"
            }
          ]
        },
        "key_insight": "Principle: Aggregate Pushdown \u2014 pre-aggregate the fact table (inventory) by the join key (inv_item_sk) BEFORE joining with the dimension table (item). The original query joins 7M inventory rows with date_dim and item, then aggregates with ROLLUP. The rewrite filters dates first, pre-aggregates inventory to ~150K rows (one per item), THEN joins item. AVG is reconstructed from SUM/COUNT since pre-aggregation changes the row count. This produced our single biggest individual win (42.90x).",
        "when_not_to_use": "Only works when GROUP BY keys are a superset of join keys \u2014 misaligned keys produce wrong results. When ROLLUP/CUBE is present, must reconstruct AVG from SUM/COUNT since pre-aggregation changes the row count."
      },
      "original_sql": "select i_product_name\n             ,i_brand\n             ,i_class\n             ,i_category\n             ,avg(inv_quantity_on_hand) qoh\n       from inventory\n           ,date_dim\n           ,item\n       where inv_date_sk=d_date_sk\n              and inv_item_sk=i_item_sk\n              and d_month_seq between 1188 and 1188 + 11\n       group by rollup(i_product_name\n                       ,i_brand\n                       ,i_class\n                       ,i_category)\norder by qoh, i_product_name, i_brand, i_class, i_category\n LIMIT 100;",
      "optimized_sql": "WITH date_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1188 AND 1188 + 11), inventory_date AS (SELECT inv_item_sk, inv_quantity_on_hand FROM inventory JOIN date_filtered ON inv_date_sk = d_date_sk), inventory_agg AS (SELECT inv_item_sk, SUM(inv_quantity_on_hand) AS sum_qty, COUNT(inv_quantity_on_hand) AS cnt FROM inventory_date GROUP BY inv_item_sk), join_item AS (SELECT i_product_name, i_brand, i_class, i_category, sum_qty, cnt FROM inventory_agg JOIN item ON inv_item_sk = i_item_sk), rollup_aggregate AS (SELECT i_product_name, i_brand, i_class, i_category, CASE WHEN SUM(cnt) > 0 THEN SUM(sum_qty) / SUM(cnt) END AS qoh FROM join_item GROUP BY ROLLUP(i_product_name, i_brand, i_class, i_category)) SELECT i_product_name, i_brand, i_class, i_category, qoh FROM rollup_aggregate ORDER BY qoh ASC, i_product_name ASC, i_brand ASC, i_class ASC, i_category ASC LIMIT 100",
      "optimized_source": "swarm_w1",
      "sf10_rows_match": true
    },
    {
      "id": "multi_dimension_prefetch",
      "name": "Multi Dimension Prefetch",
      "description": "Pre-filter multiple dimension tables (date + store) into separate CTEs before joining with fact table",
      "verified_speedup": "2.71x",
      "principle": "Multi-Dimension Prefetch: when multiple dimension tables have selective filters, pre-filter ALL of them into CTEs before the fact table join. Combined selectivity compounds \u2014 each dimension CTE reduces the fact scan further.",
      "example": {
        "opportunity": "MULTI DIMENSION PREFETCH",
        "input_slice": "SELECT s_store_name, s_store_id,\n  sum(CASE WHEN (d_day_name='Sunday') THEN ss_sales_price ELSE NULL END) sun_sales,\n  sum(CASE WHEN (d_day_name='Monday') THEN ss_sales_price ELSE NULL END) mon_sales,\n  sum(CASE WHEN (d_day_name='Tuesday') THEN ss_sales_price ELSE NULL END) tue_sales,\n  sum(CASE WHEN (d_day_name='Wednesday') THEN ss_sales_price ELSE NULL END) wed_sales,\n  sum(CASE WHEN (d_day_name='Thursday') THEN ss_sales_price ELSE NULL END) thu_sales,\n  sum(CASE WHEN (d_day_name='Friday') THEN ss_sales_price ELSE NULL END) fri_sales,\n  sum(CASE WHEN (d_day_name='Saturday') THEN ss_sales_price ELSE NULL END) sat_sales\nFROM date_dim, store_sales, store\nWHERE d_date_sk = ss_sold_date_sk AND s_store_sk = ss_store_sk\n  AND s_gmt_offset = -5 AND d_year = 2000\nGROUP BY s_store_name, s_store_id\nORDER BY s_store_name, s_store_id, sun_sales, mon_sales, tue_sales, wed_sales, thu_sales, fri_sales, sat_sales\nLIMIT 100",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "multi_dimension_prefetch",
              "nodes": {
                "filtered_dates": "SELECT d_date_sk, d_day_name FROM date_dim WHERE d_year = 2000",
                "filtered_stores": "SELECT s_store_sk, s_store_name, s_store_id FROM store WHERE s_gmt_offset = -5",
                "main_query": "SELECT s_store_name, s_store_id, SUM(CASE WHEN (d_day_name = 'Sunday') THEN ss_sales_price ELSE NULL END) AS sun_sales, SUM(CASE WHEN (d_day_name = 'Monday') THEN ss_sales_price ELSE NULL END) AS mon_sales, SUM(CASE WHEN (d_day_name = 'Tuesday') THEN ss_sales_price ELSE NULL END) AS tue_sales, SUM(CASE WHEN (d_day_name = 'Wednesday') THEN ss_sales_price ELSE NULL END) AS wed_sales, SUM(CASE WHEN (d_day_name = 'Thursday') THEN ss_sales_price ELSE NULL END) AS thu_sales, SUM(CASE WHEN (d_day_name = 'Friday') THEN ss_sales_price ELSE NULL END) AS fri_sales, SUM(CASE WHEN (d_day_name = 'Saturday') THEN ss_sales_price ELSE NULL END) AS sat_sales FROM store_sales JOIN filtered_dates ON d_date_sk = ss_sold_date_sk JOIN filtered_stores ON s_store_sk = ss_store_sk GROUP BY s_store_name, s_store_id ORDER BY s_store_name, s_store_id, sun_sales, mon_sales, tue_sales, wed_sales, thu_sales, fri_sales, sat_sales LIMIT 100"
              },
              "invariants_kept": [
                "same result rows",
                "same ordering",
                "same column output"
              ],
              "expected_speedup": "2.71x",
              "risk": "low"
            }
          ]
        },
        "key_insight": "Principle: Multi-Dimension Prefetch \u2014 when multiple dimension tables have selective filters, pre-filter ALL of them into CTEs before the fact join. Each CTE creates a small hash table; the fact scan probes multiple tiny tables instead of large ones. Here: pre-filter both date_dim and store into separate CTEs with only the columns needed for join and grouping.",
        "when_not_to_use": "Do not create dimension CTEs without a WHERE clause that actually reduces rows \u2014 an unfiltered dimension CTE is pure overhead (full scan + materialization for zero selectivity benefit). Avoid on queries with 5+ tables and complex inter-table predicates where forcing join order via CTEs prevents the optimizer from choosing a better plan. Caused 0.85x in an unfiltered-dimension case and 0.77x in a complex multi-table join-reordering case."
      },
      "original_sql": "select s_store_name, s_store_id,\n        sum(case when (d_day_name='Sunday') then ss_sales_price else null end) sun_sales,\n        sum(case when (d_day_name='Monday') then ss_sales_price else null end) mon_sales,\n        sum(case when (d_day_name='Tuesday') then ss_sales_price else  null end) tue_sales,\n        sum(case when (d_day_name='Wednesday') then ss_sales_price else null end) wed_sales,\n        sum(case when (d_day_name='Thursday') then ss_sales_price else null end) thu_sales,\n        sum(case when (d_day_name='Friday') then ss_sales_price else null end) fri_sales,\n        sum(case when (d_day_name='Saturday') then ss_sales_price else null end) sat_sales\n from date_dim, store_sales, store\n where d_date_sk = ss_sold_date_sk and\n       s_store_sk = ss_store_sk and\n       s_gmt_offset = -5 and\n       d_year = 2000 \n group by s_store_name, s_store_id\n order by s_store_name, s_store_id,sun_sales,mon_sales,tue_sales,wed_sales,thu_sales,fri_sales,sat_sales\n LIMIT 100;",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_day_name FROM date_dim WHERE d_year = 2000), filtered_stores AS (SELECT s_store_sk, s_store_id, s_store_name FROM store WHERE s_gmt_offset = -5), filtered_sales AS (SELECT ss_sales_price, d_day_name, s_store_id, s_store_name FROM store_sales JOIN filtered_dates ON d_date_sk = ss_sold_date_sk JOIN filtered_stores ON s_store_sk = ss_store_sk)\nSELECT s_store_name, s_store_id, SUM(CASE WHEN (d_day_name = 'Sunday') THEN ss_sales_price ELSE NULL END) AS sun_sales, SUM(CASE WHEN (d_day_name = 'Monday') THEN ss_sales_price ELSE NULL END) AS mon_sales, SUM(CASE WHEN (d_day_name = 'Tuesday') THEN ss_sales_price ELSE NULL END) AS tue_sales, SUM(CASE WHEN (d_day_name = 'Wednesday') THEN ss_sales_price ELSE NULL END) AS wed_sales, SUM(CASE WHEN (d_day_name = 'Thursday') THEN ss_sales_price ELSE NULL END) AS thu_sales, SUM(CASE WHEN (d_day_name = 'Friday') THEN ss_sales_price ELSE NULL END) AS fri_sales, SUM(CASE WHEN (d_day_name = 'Saturday') THEN ss_sales_price ELSE NULL END) AS sat_sales FROM filtered_sales GROUP BY s_store_name, s_store_id ORDER BY s_store_name, s_store_id, sun_sales, mon_sales, tue_sales, wed_sales, thu_sales, fri_sales, sat_sales LIMIT 100;",
      "optimized_source": "dsr1",
      "sf10_rows_match": true
    },
    {
      "id": "pushdown",
      "name": "Filter Pushdown",
      "description": "Push filters from outer query into CTEs/subqueries to reduce intermediate result sizes",
      "verified_speedup": "2.11x",
      "principle": "Scan Consolidation: when multiple subqueries scan the same table with similar patterns, consolidate them into CTEs that compute all needed aggregates in fewer passes. Reduces N scans to fewer scans.",
      "example": {
        "opportunity": "PUSHDOWN",
        "input_slice": "[main_query]:\nSELECT CASE WHEN (SELECT COUNT(*) FROM store_sales WHERE ss_quantity BETWEEN 1 AND 20) > 2972190 \n  THEN (SELECT AVG(ss_ext_sales_price) FROM store_sales WHERE ss_quantity BETWEEN 1 AND 20)\n  ELSE (SELECT AVG(ss_net_profit) FROM store_sales WHERE ss_quantity BETWEEN 1 AND 20) END AS bucket1,\n  CASE WHEN (SELECT COUNT(*) FROM store_sales WHERE ss_quantity BETWEEN 21 AND 40) > 4505785\n  THEN (SELECT AVG(ss_ext_sales_price) FROM store_sales WHERE ss_quantity BETWEEN 21 AND 40)\n  ELSE (SELECT AVG(ss_net_profit) FROM store_sales WHERE ss_quantity BETWEEN 21 AND 40) END AS bucket2\nFROM reason WHERE r_reason_sk = 1",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "pushdown",
              "nodes": {
                "quantity_1_20_stats": "SELECT COUNT(*) AS cnt, AVG(ss_ext_sales_price) AS avg_ext_price, AVG(ss_net_profit) AS avg_net_profit FROM store_sales WHERE ss_quantity BETWEEN 1 AND 20",
                "quantity_21_40_stats": "SELECT COUNT(*) AS cnt, AVG(ss_ext_sales_price) AS avg_ext_price, AVG(ss_net_profit) AS avg_net_profit FROM store_sales WHERE ss_quantity BETWEEN 21 AND 40",
                "quantity_41_60_stats": "SELECT COUNT(*) AS cnt, AVG(ss_ext_sales_price) AS avg_ext_price, AVG(ss_net_profit) AS avg_net_profit FROM store_sales WHERE ss_quantity BETWEEN 41 AND 60",
                "quantity_61_80_stats": "SELECT COUNT(*) AS cnt, AVG(ss_ext_sales_price) AS avg_ext_price, AVG(ss_net_profit) AS avg_net_profit FROM store_sales WHERE ss_quantity BETWEEN 61 AND 80",
                "quantity_81_100_stats": "SELECT COUNT(*) AS cnt, AVG(ss_ext_sales_price) AS avg_ext_price, AVG(ss_net_profit) AS avg_net_profit FROM store_sales WHERE ss_quantity BETWEEN 81 AND 100",
                "main_query": "SELECT CASE WHEN q1.cnt > 2972190 THEN q1.avg_ext_price ELSE q1.avg_net_profit END AS bucket1, CASE WHEN q2.cnt > 4505785 THEN q2.avg_ext_price ELSE q2.avg_net_profit END AS bucket2, CASE WHEN q3.cnt > 1575726 THEN q3.avg_ext_price ELSE q3.avg_net_profit END AS bucket3, CASE WHEN q4.cnt > 3188917 THEN q4.avg_ext_price ELSE q4.avg_net_profit END AS bucket4, CASE WHEN q5.cnt > 3525216 THEN q5.avg_ext_price ELSE q5.avg_net_profit END AS bucket5 FROM reason CROSS JOIN quantity_1_20_stats AS q1 CROSS JOIN quantity_21_40_stats AS q2 CROSS JOIN quantity_41_60_stats AS q3 CROSS JOIN quantity_61_80_stats AS q4 CROSS JOIN quantity_81_100_stats AS q5 WHERE r_reason_sk = 1"
              },
              "invariants_kept": [
                "same result rows",
                "same aggregation results",
                "same output columns"
              ],
              "expected_speedup": "2.11x",
              "risk": "low"
            }
          ]
        },
        "key_insight": "Principle: Scan Consolidation \u2014 when multiple subqueries scan the same table with similar patterns, consolidate them into a single CTE that computes all needed aggregates in one pass. Reduces N scans to 1. Here: 15+ scalar subqueries with different quantity-range filters on store_sales become CTEs, each computing count, avg_ext_price, avg_net_profit in one scan per range."
      },
      "original_sql": "select case when (select count(*) \n                  from store_sales \n                  where ss_quantity between 1 and 20) > 2972190\n            then (select avg(ss_ext_sales_price) \n                  from store_sales \n                  where ss_quantity between 1 and 20) \n            else (select avg(ss_net_profit)\n                  from store_sales\n                  where ss_quantity between 1 and 20) end bucket1 ,\n       case when (select count(*)\n                  from store_sales\n                  where ss_quantity between 21 and 40) > 4505785\n            then (select avg(ss_ext_sales_price)\n                  from store_sales\n                  where ss_quantity between 21 and 40) \n            else (select avg(ss_net_profit)\n                  from store_sales\n                  where ss_quantity between 21 and 40) end bucket2,\n       case when (select count(*)\n                  from store_sales\n                  where ss_quantity between 41 and 60) > 1575726\n            then (select avg(ss_ext_sales_price)\n                  from store_sales\n                  where ss_quantity between 41 and 60)\n            else (select avg(ss_net_profit)\n                  from store_sales\n                  where ss_quantity between 41 and 60) end bucket3,\n       case when (select count(*)\n                  from store_sales\n                  where ss_quantity between 61 and 80) > 3188917\n            then (select avg(ss_ext_sales_price)\n                  from store_sales\n                  where ss_quantity between 61 and 80)\n            else (select avg(ss_net_profit)\n                  from store_sales\n                  where ss_quantity between 61 and 80) end bucket4,\n       case when (select count(*)\n                  from store_sales\n                  where ss_quantity between 81 and 100) > 3525216\n            then (select avg(ss_ext_sales_price)\n                  from store_sales\n                  where ss_quantity between 81 and 100)\n            else (select avg(ss_net_profit)\n                  from store_sales\n                  where ss_quantity between 81 and 100) end bucket5\nfrom reason\nwhere r_reason_sk = 1;",
      "optimized_sql": "WITH quantity_aggregations AS (SELECT CASE WHEN ss_quantity BETWEEN 1 AND 20 THEN 1 WHEN ss_quantity BETWEEN 21 AND 40 THEN 2 WHEN ss_quantity BETWEEN 41 AND 60 THEN 3 WHEN ss_quantity BETWEEN 61 AND 80 THEN 4 WHEN ss_quantity BETWEEN 81 AND 100 THEN 5 END AS bucket, COUNT(*) AS cnt, AVG(ss_ext_discount_amt) AS avg_disc, AVG(ss_net_paid) AS avg_net FROM store_sales WHERE ss_quantity BETWEEN 1 AND 100 GROUP BY CASE WHEN ss_quantity BETWEEN 1 AND 20 THEN 1 WHEN ss_quantity BETWEEN 21 AND 40 THEN 2 WHEN ss_quantity BETWEEN 41 AND 60 THEN 3 WHEN ss_quantity BETWEEN 61 AND 80 THEN 4 WHEN ss_quantity BETWEEN 81 AND 100 THEN 5 END)\nSELECT CASE WHEN q1.cnt > 74129 THEN q1.avg_disc ELSE q1.avg_net END AS bucket1, CASE WHEN q2.cnt > 122840 THEN q2.avg_disc ELSE q2.avg_net END AS bucket2, CASE WHEN q3.cnt > 56580 THEN q3.avg_disc ELSE q3.avg_net END AS bucket3, CASE WHEN q4.cnt > 10097 THEN q4.avg_disc ELSE q4.avg_net END AS bucket4, CASE WHEN q5.cnt > 165306 THEN q5.avg_disc ELSE q5.avg_net END AS bucket5 FROM reason CROSS JOIN (SELECT cnt, avg_disc, avg_net FROM quantity_aggregations WHERE bucket = 1) AS q1 CROSS JOIN (SELECT cnt, avg_disc, avg_net FROM quantity_aggregations WHERE bucket = 2) AS q2 CROSS JOIN (SELECT cnt, avg_disc, avg_net FROM quantity_aggregations WHERE bucket = 3) AS q3 CROSS JOIN (SELECT cnt, avg_disc, avg_net FROM quantity_aggregations WHERE bucket = 4) AS q4 CROSS JOIN (SELECT cnt, avg_disc, avg_net FROM quantity_aggregations WHERE bucket = 5) AS q5 WHERE r_reason_sk = 1;",
      "optimized_source": "dsr1",
      "sf10_rows_match": true
    },
    {
      "id": "single_pass_aggregation",
      "name": "Single Pass Aggregation",
      "description": "Consolidate multiple subqueries scanning the same table into a single CTE with conditional aggregates",
      "verified_speedup": "4.47x",
      "principle": "Single-Pass Aggregation: consolidate multiple scalar subqueries on the same table into one CTE using CASE expressions inside aggregate functions. Reduces N separate table scans to 1 pass.",
      "example": {
        "opportunity": "CONSOLIDATE REPEATED SCANS",
        "input_slice": "SELECT\n  CASE WHEN (SELECT count(*) FROM store_sales WHERE ss_quantity BETWEEN 1 AND 20) > 74129\n       THEN (SELECT avg(ss_ext_discount_amt) FROM store_sales WHERE ss_quantity BETWEEN 1 AND 20)\n       ELSE (SELECT avg(ss_net_paid) FROM store_sales WHERE ss_quantity BETWEEN 1 AND 20) END AS bucket1,\n  CASE WHEN (SELECT count(*) FROM store_sales WHERE ss_quantity BETWEEN 21 AND 40) > 122840\n       THEN (SELECT avg(ss_ext_discount_amt) FROM store_sales WHERE ss_quantity BETWEEN 21 AND 40)\n       ELSE (SELECT avg(ss_net_paid) FROM store_sales WHERE ss_quantity BETWEEN 21 AND 40) END AS bucket2,\n  -- ... 3 more buckets, 15 total scans of store_sales",
        "output": {
          "rewrite_sets": [
            {
              "id": "rs_01",
              "transform": "single_pass_aggregation",
              "nodes": {
                "store_sales_aggregates": "SELECT SUM(CASE WHEN ss_quantity BETWEEN 1 AND 20 THEN 1 ELSE 0 END) AS cnt1, AVG(CASE WHEN ss_quantity BETWEEN 1 AND 20 THEN ss_ext_discount_amt END) AS avg_disc1, AVG(CASE WHEN ss_quantity BETWEEN 1 AND 20 THEN ss_net_paid END) AS avg_paid1, SUM(CASE WHEN ss_quantity BETWEEN 21 AND 40 THEN 1 ELSE 0 END) AS cnt2, AVG(CASE WHEN ss_quantity BETWEEN 21 AND 40 THEN ss_ext_discount_amt END) AS avg_disc2, AVG(CASE WHEN ss_quantity BETWEEN 21 AND 40 THEN ss_net_paid END) AS avg_paid2, SUM(CASE WHEN ss_quantity BETWEEN 41 AND 60 THEN 1 ELSE 0 END) AS cnt3, AVG(CASE WHEN ss_quantity BETWEEN 41 AND 60 THEN ss_ext_discount_amt END) AS avg_disc3, AVG(CASE WHEN ss_quantity BETWEEN 41 AND 60 THEN ss_net_paid END) AS avg_paid3, SUM(CASE WHEN ss_quantity BETWEEN 61 AND 80 THEN 1 ELSE 0 END) AS cnt4, AVG(CASE WHEN ss_quantity BETWEEN 61 AND 80 THEN ss_ext_discount_amt END) AS avg_disc4, AVG(CASE WHEN ss_quantity BETWEEN 61 AND 80 THEN ss_net_paid END) AS avg_paid4, SUM(CASE WHEN ss_quantity BETWEEN 81 AND 100 THEN 1 ELSE 0 END) AS cnt5, AVG(CASE WHEN ss_quantity BETWEEN 81 AND 100 THEN ss_ext_discount_amt END) AS avg_disc5, AVG(CASE WHEN ss_quantity BETWEEN 81 AND 100 THEN ss_net_paid END) AS avg_paid5 FROM store_sales",
                "main_query": "SELECT CASE WHEN cnt1 > 74129 THEN avg_disc1 ELSE avg_paid1 END AS bucket1, CASE WHEN cnt2 > 122840 THEN avg_disc2 ELSE avg_paid2 END AS bucket2, CASE WHEN cnt3 > 56580 THEN avg_disc3 ELSE avg_paid3 END AS bucket3, CASE WHEN cnt4 > 10097 THEN avg_disc4 ELSE avg_paid4 END AS bucket4, CASE WHEN cnt5 > 165306 THEN avg_disc5 ELSE avg_paid5 END AS bucket5 FROM store_sales_aggregates"
              },
              "invariants_kept": [
                "same result values",
                "same column output"
              ],
              "expected_speedup": "4.50x",
              "risk": "low"
            }
          ]
        },
        "key_insight": "Principle: Single-Pass Aggregation \u2014 consolidate multiple scalar subqueries on the same table into a single CTE using CASE expressions inside aggregate functions. Each CASE routes rows to the appropriate bucket without multiple scans. Reduces N separate table scans to 1 pass. Here: 15 scalar subqueries on store_sales (5 quantity ranges x 3 aggregates each) become one CTE with conditional COUNT/AVG."
      },
      "original_sql": "select case when (select count(*) \n                  from store_sales \n                  where ss_quantity between 1 and 20) > 2972190\n            then (select avg(ss_ext_sales_price) \n                  from store_sales \n                  where ss_quantity between 1 and 20) \n            else (select avg(ss_net_profit)\n                  from store_sales\n                  where ss_quantity between 1 and 20) end bucket1 ,\n       case when (select count(*)\n                  from store_sales\n                  where ss_quantity between 21 and 40) > 4505785\n            then (select avg(ss_ext_sales_price)\n                  from store_sales\n                  where ss_quantity between 21 and 40) \n            else (select avg(ss_net_profit)\n                  from store_sales\n                  where ss_quantity between 21 and 40) end bucket2,\n       case when (select count(*)\n                  from store_sales\n                  where ss_quantity between 41 and 60) > 1575726\n            then (select avg(ss_ext_sales_price)\n                  from store_sales\n                  where ss_quantity between 41 and 60)\n            else (select avg(ss_net_profit)\n                  from store_sales\n                  where ss_quantity between 41 and 60) end bucket3,\n       case when (select count(*)\n                  from store_sales\n                  where ss_quantity between 61 and 80) > 3188917\n            then (select avg(ss_ext_sales_price)\n                  from store_sales\n                  where ss_quantity between 61 and 80)\n            else (select avg(ss_net_profit)\n                  from store_sales\n                  where ss_quantity between 61 and 80) end bucket4,\n       case when (select count(*)\n                  from store_sales\n                  where ss_quantity between 81 and 100) > 3525216\n            then (select avg(ss_ext_sales_price)\n                  from store_sales\n                  where ss_quantity between 81 and 100)\n            else (select avg(ss_net_profit)\n                  from store_sales\n                  where ss_quantity between 81 and 100) end bucket5\nfrom reason\nwhere r_reason_sk = 1;",
      "optimized_sql": "WITH sales_stats AS (SELECT COUNT(CASE WHEN ss_quantity BETWEEN 1 AND 20 THEN 1 END) AS cnt1, AVG(CASE WHEN ss_quantity BETWEEN 1 AND 20 THEN ss_ext_sales_price END) AS avg_price1, AVG(CASE WHEN ss_quantity BETWEEN 1 AND 20 THEN ss_net_profit END) AS avg_profit1, COUNT(CASE WHEN ss_quantity BETWEEN 21 AND 40 THEN 1 END) AS cnt2, AVG(CASE WHEN ss_quantity BETWEEN 21 AND 40 THEN ss_ext_sales_price END) AS avg_price2, AVG(CASE WHEN ss_quantity BETWEEN 21 AND 40 THEN ss_net_profit END) AS avg_profit2, COUNT(CASE WHEN ss_quantity BETWEEN 41 AND 60 THEN 1 END) AS cnt3, AVG(CASE WHEN ss_quantity BETWEEN 41 AND 60 THEN ss_ext_sales_price END) AS avg_price3, AVG(CASE WHEN ss_quantity BETWEEN 41 AND 60 THEN ss_net_profit END) AS avg_profit3, COUNT(CASE WHEN ss_quantity BETWEEN 61 AND 80 THEN 1 END) AS cnt4, AVG(CASE WHEN ss_quantity BETWEEN 61 AND 80 THEN ss_ext_sales_price END) AS avg_price4, AVG(CASE WHEN ss_quantity BETWEEN 61 AND 80 THEN ss_net_profit END) AS avg_profit4, COUNT(CASE WHEN ss_quantity BETWEEN 81 AND 100 THEN 1 END) AS cnt5, AVG(CASE WHEN ss_quantity BETWEEN 81 AND 100 THEN ss_ext_sales_price END) AS avg_price5, AVG(CASE WHEN ss_quantity BETWEEN 81 AND 100 THEN ss_net_profit END) AS avg_profit5 FROM store_sales)\nSELECT CASE WHEN s.cnt1 > 2972190 THEN s.avg_price1 ELSE s.avg_profit1 END AS bucket1, CASE WHEN s.cnt2 > 4505785 THEN s.avg_price2 ELSE s.avg_profit2 END AS bucket2, CASE WHEN s.cnt3 > 1575726 THEN s.avg_price3 ELSE s.avg_profit3 END AS bucket3, CASE WHEN s.cnt4 > 3188917 THEN s.avg_price4 ELSE s.avg_profit4 END AS bucket4, CASE WHEN s.cnt5 > 3525216 THEN s.avg_price5 ELSE s.avg_profit5 END AS bucket5 FROM reason AS r, sales_stats AS s WHERE r.r_reason_sk = 1;",
      "optimized_source": "kimi_ready"
    }
  ],
  "all_available_examples": [
    {
      "id": "aggregate_pushdown",
      "speedup": "42.90x",
      "description": "Pre-aggregate fact table by join key before dimension joins to reduce rows enter"
    },
    {
      "id": "channel_bitmap_aggregation",
      "speedup": "6.24x",
      "description": "Consolidate repeated scans of the same fact table (one per time/channel bucket) "
    },
    {
      "id": "composite_decorrelate_union",
      "speedup": "2.42x",
      "description": "Decorrelate multiple correlated EXISTS subqueries into pre-materialized DISTINCT"
    },
    {
      "id": "date_cte_isolate",
      "speedup": "4.00x",
      "description": "Extract date filtering into a separate CTE to enable predicate pushdown and redu"
    },
    {
      "id": "decorrelate",
      "speedup": "2.92x",
      "description": "Convert correlated subquery to separate CTE with GROUP BY, then JOIN"
    },
    {
      "id": "deferred_window_aggregation",
      "speedup": "1.36x",
      "description": "When multiple CTEs each perform GROUP BY + WINDOW (cumulative sum), then are joi"
    },
    {
      "id": "dimension_cte_isolate",
      "speedup": "1.93x",
      "description": "Pre-filter ALL dimension tables into CTEs before joining with fact table, not ju"
    },
    {
      "id": "early_filter",
      "speedup": "4.00x",
      "description": "Filter dimension tables FIRST, then join to fact tables to reduce expensive join"
    },
    {
      "id": "inner_join_conversion",
      "speedup": "3.44x",
      "description": "Convert LEFT JOIN + right-table WHERE filter to INNER JOIN + early filter CTE wh"
    },
    {
      "id": "intersect_to_exists",
      "speedup": "1.83x",
      "description": "Convert INTERSECT subquery pattern to multiple EXISTS clauses for better join pl"
    },
    {
      "id": "materialize_cte",
      "speedup": "1.37x",
      "description": "Extract repeated subquery patterns into a CTE to avoid recomputation"
    },
    {
      "id": "multi_date_range_cte",
      "speedup": "2.35x",
      "description": "When query uses multiple date_dim aliases with different filters (d1, d2, d3), c"
    },
    {
      "id": "multi_dimension_prefetch",
      "speedup": "2.71x",
      "description": "Pre-filter multiple dimension tables (date + store) into separate CTEs before jo"
    },
    {
      "id": "multi_intersect_exists_cte",
      "speedup": "2.39x",
      "description": "Convert cascading INTERSECT operations into correlated EXISTS subqueries with pr"
    },
    {
      "id": "or_to_union",
      "speedup": "3.17x",
      "description": "Split OR conditions on different columns into UNION ALL branches for better inde"
    },
    {
      "id": "prefetch_fact_join",
      "speedup": "3.77x",
      "description": "Pre-filter dimension table into CTE, then pre-join with fact table in second CTE"
    },
    {
      "id": "pushdown",
      "speedup": "2.11x",
      "description": "Push filters from outer query into CTEs/subqueries to reduce intermediate result"
    },
    {
      "id": "rollup_to_union_windowing",
      "speedup": "2.47x",
      "description": "Replace GROUP BY ROLLUP with explicit UNION ALL of pre-aggregated CTEs at each h"
    },
    {
      "id": "self_join_decomposition",
      "speedup": "4.76x",
      "description": "Split self-joined CTE with different filter values into separate per-filter CTEs"
    },
    {
      "id": "shared_dimension_multi_channel",
      "speedup": "1.30x",
      "description": "Extract shared dimension filters (date, item, promotion) into CTEs when multiple"
    },
    {
      "id": "single_pass_aggregation",
      "speedup": "4.47x",
      "description": "Consolidate multiple subqueries scanning the same table into a single CTE with c"
    },
    {
      "id": "union_cte_split",
      "speedup": "1.36x",
      "description": "Split a generic UNION ALL CTE into specialized CTEs when the main query filters "
    }
  ],
  "engine_profile": {
    "engine": "duckdb",
    "version_tested": "1.1+",
    "profile_type": "engine_profile",
    "briefing_note": "This is field intelligence gathered from 88 TPC-DS queries at SF1-SF10. Use it to guide your analysis but apply your own judgment \u2014 every query is different. Add to this knowledge if you observe something new.",
    "strengths": [
      {
        "id": "INTRA_SCAN_PREDICATE_PUSHDOWN",
        "summary": "Pushes WHERE filters directly into SEQ_SCAN. Single-table predicates are applied at scan time, zero overhead.",
        "field_note": "If EXPLAIN shows the filter already inside the scan node, don't create a CTE to push it \u2014 the engine already did it."
      },
      {
        "id": "SAME_COLUMN_OR",
        "summary": "OR on the SAME column (e.g., t_hour BETWEEN 8 AND 11 OR t_hour BETWEEN 16 AND 17) is handled in a single scan with range checks.",
        "field_note": "Splitting same-column ORs into UNION ALL doubled the fact scan (0.59x observed) and 9-branch expansion hit 0.23x. The engine handles these natively \u2014 leave them alone."
      },
      {
        "id": "HASH_JOIN_SELECTION",
        "summary": "Selects hash joins automatically. Join ordering is generally sound for 2-4 table joins.",
        "field_note": "Restructuring simple join orders rarely helps. Focus on what happens BEFORE the join (input reduction), not the join itself. See CROSS_CTE_PREDICATE_BLINDNESS for pre-filtering strategies that reduce join input."
      },
      {
        "id": "CTE_INLINING",
        "summary": "CTEs referenced once are typically inlined (treated as subquery). Multi-referenced CTEs may be materialized.",
        "field_note": "Single-reference CTEs are free \u2014 use for clarity. Multi-referenced CTEs: the engine decides whether to materialize. This makes CTE-based strategies (pre-filtering, isolation) low-cost on DuckDB compared to PostgreSQL where multi-referenced CTEs are materialized and create optimization fences."
      },
      {
        "id": "COLUMNAR_PROJECTION",
        "summary": "Only reads columns actually referenced. Unused columns have zero I/O cost.",
        "field_note": "SELECT * isn't as bad as in row-stores, but explicit columns still matter for intermediate CTEs \u2014 fewer columns = less memory for materialization. When creating pre-filter CTEs, only SELECT the columns downstream nodes actually need."
      },
      {
        "id": "PARALLEL_AGGREGATION",
        "summary": "Scans and aggregations parallelized across threads. PERFECT_HASH_GROUP_BY is highly efficient.",
        "field_note": "Simple aggregation queries are already fast. Restructuring them rarely helps unless you're reducing input rows. See REDUNDANT_SCAN_ELIMINATION for consolidating repeated scans, and CROSS_CTE_PREDICATE_BLINDNESS for reducing rows entering the aggregation."
      },
      {
        "id": "EXISTS_SEMI_JOIN",
        "summary": "EXISTS/NOT EXISTS uses semi-join with early termination \u2014 stops after first match per outer row.",
        "field_note": "Converting EXISTS to a materialized CTE with SELECT DISTINCT forces a full scan. Semi-join is usually faster. We saw 0.14x and 0.54x from this mistake. However, if the optimizer fails to decorrelate the EXISTS (check EXPLAIN for nested-loop re-execution), materializing may help."
      }
    ],
    "gaps": [
      {
        "id": "CROSS_CTE_PREDICATE_BLINDNESS",
        "priority": "HIGH",
        "what": "Cannot push predicates from the outer query backward into CTE definitions.",
        "why": "CTEs are planned as independent subplans. The optimizer does not trace data lineage through CTE boundaries.",
        "opportunity": "Move selective predicates INTO the CTE definition. Pre-filter dimensions/facts before they get materialized.",
        "what_worked": [
          "4.76x \u2014 self-joined CTE split into per-month CTEs (self_join_decomposition)",
          "4.00x \u2014 date filter moved into CTE",
          "3.77x \u2014 pre-joined filtered dates with fact table before other dims",
          "2.97x \u2014 dimension filter applied before LEFT JOIN chain",
          "2.38x \u2014 dimension_cte_isolate reduced fact table scan",
          "1.93x \u2014 all dimensions pre-filtered into separate CTEs",
          "1.80x \u2014 prefetch_fact_join on store_sales with date pre-filter"
        ],
        "what_didnt_work": [
          "0.50x \u2014 query was 31ms baseline, CTE overhead exceeded filter savings",
          "0.49x \u2014 over-decomposed an already-efficient query into too many sub-CTEs"
        ],
        "field_notes": [
          "Check EXPLAIN: if the filter appears AFTER a large scan or join, there's opportunity to push it earlier via CTE.",
          "On fast queries (<100ms), CTE materialization overhead can negate the savings. Assess whether it's worth it.",
          "This is our most productive gap \u2014 ~35% of all wins exploit it. Most reliable on star-join queries with late dim filters.",
          "Don't create unfiltered CTEs \u2014 a CTE without a WHERE clause just adds overhead.",
          "NEVER CROSS JOIN 3+ pre-filtered dimension CTEs together \u2014 Cartesian explosion creates massive intermediate results. One query hit 0.0076x (132x slower) when 3 dims (30x200x20=120K rows) were cross-joined. Instead, join each filtered dimension directly to the fact table.",
          "Limit cascading fact-table CTE chains to 2 levels. A 3rd cascading CTE causes excessive materialization \u2014 One query hit 0.78x from triple-chained fact CTEs. Each level should be highly selective (<5% rows) to justify the overhead.",
          "Orphaned CTEs that are defined but not referenced in the final query still get materialized. Always remove dead CTEs when restructuring."
        ]
      },
      {
        "id": "REDUNDANT_SCAN_ELIMINATION",
        "priority": "HIGH",
        "what": "Cannot detect when the same fact table is scanned N times with similar filters across subquery boundaries.",
        "why": "Common Subexpression Elimination doesn't cross scalar subquery boundaries. Each subquery is planned independently.",
        "opportunity": "Consolidate N subqueries on the same table into 1 scan with CASE WHEN / FILTER() inside aggregates.",
        "what_worked": [
          "6.28x \u2014 8 time-bucket subqueries consolidated into 1 scan with 8 CASE branches",
          "4.47x \u2014 15 separate store_sales scans consolidated into 1 scan with 5 CASE buckets",
          "2.27x \u2014 single_pass_aggregation consolidated channel subqueries",
          "1.61x \u2014 single_pass_aggregation on catalog_sales",
          "1.53x \u2014 single_pass_aggregation consolidated repeated customer scans",
          "1.47x \u2014 single_pass_aggregation on web_sales time buckets",
          "1.40x \u2014 single_pass_aggregation consolidated customer scans",
          "1.32x \u2014 single_pass_aggregation on web_sales"
        ],
        "what_didnt_work": [],
        "field_notes": [
          "Count scans per base table in the EXPLAIN. If a fact table appears 3+ times, this gap is active.",
          "DuckDB supports native FILTER clause: COUNT(*) FILTER (WHERE cond) \u2014 use it instead of CASE WHEN for cleaner SQL.",
          "STDDEV_SAMP, VARIANCE, PERCENTILE_CONT are grouping-sensitive. CASE branches compute per-group differently than separate per-branch queries. Verify equivalence when these appear.",
          "We tested up to 8 CASE branches successfully. Beyond that is untested territory, not proven harmful \u2014 use judgment.",
          "This produced our single biggest win (one query at 6.28x). Always check for multi-scan patterns.",
          "~37% of all benchmark wins exploit this gap (tied with CROSS_CTE_PREDICATE_BLINDNESS as most productive)."
        ]
      },
      {
        "id": "CORRELATED_SUBQUERY_PARALYSIS",
        "priority": "LOW",
        "what": "Cannot automatically decorrelate correlated aggregate subqueries into GROUP BY + JOIN.",
        "why": "Decorrelation requires recognizing that the correlated predicate = GROUP BY + JOIN equivalence. The optimizer doesn't do this for complex correlation patterns.",
        "opportunity": "Convert correlated WHERE to CTE with GROUP BY on the correlation column, then JOIN back.",
        "what_worked": [
          "2.92x \u2014 correlated AVG with store_sk correlation converted to GROUP BY store_sk + JOIN"
        ],
        "what_didnt_work": [],
        "field_notes": [
          "Look for WHERE col > (SELECT AGG FROM ... WHERE outer.key = inner.key) patterns.",
          "EXPLAIN will show nested-loop with repeated subquery execution if the optimizer failed to decorrelate.",
          "CRITICAL: when decorrelating, you MUST preserve all WHERE filters from the original subquery in the new CTE. Dropping a filter changes which rows participate in the aggregate \u2014 this produces wrong results, not just a regression.",
          "Only applies to correlated scalar subqueries with aggregates. EXISTS correlation is handled by semi-join (see strengths)."
        ]
      },
      {
        "id": "CROSS_COLUMN_OR_DECOMPOSITION",
        "priority": "MEDIUM",
        "what": "Cannot decompose OR conditions that span DIFFERENT columns into independent targeted scans.",
        "why": "The optimizer evaluates OR as a single filter. It can't recognize that each branch targets a different column with different selectivity.",
        "opportunity": "Split cross-column ORs into UNION ALL branches, each with a targeted single-column filter.",
        "what_worked": [
          "6.28x \u2014 8 time-bucket subqueries with distinct hour ranges (distinct access paths)",
          "3.17x \u2014 (zip OR state OR price) split to 3 targeted branches",
          "1.89x, 1.49x, 1.35x \u2014 cross-column OR splits on star-join queries"
        ],
        "what_didnt_work": [
          "0.23x \u2014 nested OR expansion (3x3=9 branches = 9 fact scans). Cartesian OR explosion.",
          "0.41x \u2014 same nested OR explosion pattern",
          "0.59x \u2014 same-column OR (the engine already handles this, see strengths)",
          "0.51x \u2014 self-join table split. Each UNION branch had to independently re-do the self-join."
        ],
        "field_notes": [
          "The key distinction is CROSS-COLUMN (good candidate) vs SAME-COLUMN (engine handles it).",
          "Count the resulting branches before committing. If nested ORs expand to 6+ branches, it's almost certainly harmful.",
          "Self-joins (same table aliased twice) are risky to split \u2014 each branch re-does the self-join independently.",
          "Each UNION branch rescans the fact table. The math: if selectivity per branch is S, benefit = N\u00d7(1-S) saved rows vs cost = N extra scans. Only works when S is very small (<20% per branch).",
          "This is high-variance: our biggest win (6.28x) and worst regressions (0.23x) both come from or_to_union. Context matters enormously."
        ]
      },
      {
        "id": "LEFT_JOIN_FILTER_ORDER_RIGIDITY",
        "priority": "HIGH",
        "what": "Cannot reorder LEFT JOINs to apply selective dimension filters before expensive fact table joins, and cannot infer that a WHERE on the right table makes LEFT JOIN equivalent to INNER JOIN.",
        "why": "LEFT JOIN must preserve all rows from the left table. The optimizer can't move a dimension filter before the LEFT JOIN, nor can it convert LEFT\u2192INNER when WHERE eliminates NULLs.",
        "opportunity": "Pre-filter the selective dimension into a CTE, or convert LEFT JOIN to INNER JOIN when WHERE eliminates NULL rows from right table.",
        "what_worked": [
          "3.44x \u2014 LEFT JOIN + right-table WHERE converted to INNER JOIN + early filter CTE (inner_join_conversion)",
          "2.97x \u2014 filtered reason dimension FIRST, then LEFT JOIN to returns then fact",
          "1.89x \u2014 dimension isolation before fact join"
        ],
        "what_didnt_work": [],
        "field_notes": [
          "Only applies to LEFT JOINs. INNER JOINs are freely reordered by the optimizer.",
          "The dimension filter needs to be highly selective (>50% row reduction) to justify the CTE overhead.",
          "Check EXPLAIN: if a dimension filter appears AFTER a large join, you can restructure to apply it before.",
          "NEW: When a WHERE clause filters on a column from the RIGHT side of a LEFT JOIN (e.g., sr_reason_sk = r_reason_sk), the LEFT JOIN is effectively an INNER JOIN. Converting to explicit INNER JOIN + early filter CTE gave 3.44x. Look for LEFT JOIN + WHERE on right-table column."
        ]
      },
      {
        "id": "UNION_CTE_SELF_JOIN_DECOMPOSITION",
        "priority": "LOW",
        "what": "When a UNION ALL CTE is self-joined N times with each join filtering to a different discriminator, the optimizer materializes the full UNION once and probes it N times, discarding most rows each time.",
        "why": "The optimizer can't recognize that each probe only needs a partition of the UNION result.",
        "opportunity": "Split the UNION ALL into N separate CTEs (one per discriminator value).",
        "what_worked": [
          "1.36x \u2014 UNION of store/web sales split into separate year-partitioned CTEs"
        ],
        "what_didnt_work": [],
        "field_notes": [
          "Only applies when the UNION ALL CTE is self-joined 2+ times with different discriminator filters.",
          "When splitting, you MUST remove the original UNION CTE and redirect all references to the new split CTEs. Leaving dead CTEs causes materialization overhead (two queries hit 0.49x and 0.68x from this mistake)."
        ]
      },
      {
        "id": "AGGREGATE_BELOW_JOIN_BLINDNESS",
        "priority": "HIGH",
        "what": "Cannot push GROUP BY aggregation below joins when the aggregation keys align with join keys.",
        "why": "The optimizer joins first, then aggregates. When the join produces many rows that will be collapsed by GROUP BY, the join processes far more rows than necessary.",
        "opportunity": "Pre-aggregate the fact table by the join key before the dimension join. Rows entering the join drop from millions to the distinct key count.",
        "what_worked": [
          "42.90x \u2014 pre-aggregated inventory by item_sk before item dimension join + ROLLUP"
        ],
        "what_didnt_work": [],
        "field_notes": [
          "Look for GROUP BY columns that are a superset of the join keys \u2014 this signals the aggregation can be pushed below.",
          "Most effective when the fact table has many rows per join key (high fan-out).",
          "When ROLLUP/CUBE is present, reconstruct avg from SUM/COUNT since pre-aggregation changes the row count.",
          "This produced our single biggest individual win (42.90x). Check for join \u2192 GROUP BY patterns in every star-schema query."
        ]
      }
    ]
  },
  "constraints": [
    {
      "id": "COMPLETE_OUTPUT",
      "severity": "CRITICAL",
      "description": "The rewritten query must output ALL columns from the original SELECT. Never drop, rename, or reorder output columns.",
      "constraint_rules": [
        {
          "rule": "ALL_COLUMNS_PRESENT",
          "description": "Every column in the original SELECT list must appear in the rewritten SELECT list."
        },
        {
          "rule": "NO_COLUMN_RENAME",
          "description": "Column aliases must be preserved exactly. If the original says 'AS total_sales', the rewrite must use the same alias."
        },
        {
          "rule": "PRESERVE_COLUMN_ORDER",
          "description": "Columns must appear in the same order as the original SELECT list."
        }
      ],
      "prompt_instruction": "The rewritten query must output ALL columns from the original SELECT. Never drop, rename, or reorder output columns. Every column alias must be preserved exactly as in the original."
    },
    {
      "id": "CTE_COLUMN_COMPLETENESS",
      "severity": "CRITICAL",
      "description": "When creating or modifying a CTE, its SELECT list MUST include ALL columns that downstream nodes reference. Check the Node Contracts and Downstream Usage sections before writing any CTE.",
      "failure_rate": "Caused 54% of all execution errors (7 of 13 failures)",
      "observed_failures": [
        {
          "query": "Q21",
          "error": "prefetched_inventory CTE omits i_item_id but main query references it in SELECT and GROUP BY",
          "type": "MISSING_COLUMN_IN_CTE"
        },
        {
          "query": "Q76",
          "error": "filtered_store_dates CTE omits d_year and d_qoy but aggregation CTE uses them in GROUP BY",
          "type": "MISSING_COLUMN_IN_CTE"
        },
        {
          "query": "Q24",
          "error": "filtered_base CTE omits s_state, i_current_price, i_manager_id, i_units, i_size needed by downstream CTEs",
          "type": "MISSING_COLUMN_IN_CTE"
        },
        {
          "query": "Q64",
          "error": "filtered_store_sales CTE omits ss_sold_date_sk needed for JOIN in cross_sales CTE",
          "type": "MISSING_COLUMN_IN_CTE"
        },
        {
          "query": "Q60",
          "error": "ss/ws/cs CTEs reference item.i_item_sk and item.i_category in WHERE but item table not joined in CTE",
          "type": "MISSING_TABLE_IN_CTE"
        },
        {
          "query": "Q13",
          "error": "filtered_store_sales CTE references hd_demo_sk, cd_demo_sk from tables not joined in the CTE",
          "type": "MISSING_TABLE_IN_CTE"
        },
        {
          "query": "Q2",
          "error": "Ambiguous d_date_sk and d_week_seq columns between CTE and re-joined date_dim",
          "type": "AMBIGUOUS_COLUMN_REF"
        }
      ],
      "constraint_rules": [
        {
          "rule": "CHECK_DOWNSTREAM_REFS",
          "description": "Before writing a CTE, check the Downstream Usage section. Every column listed in downstream_refs for that node MUST appear in the CTE's SELECT list."
        },
        {
          "rule": "CHECK_JOIN_COLUMNS",
          "description": "If a downstream node JOINs on a column from this CTE (e.g., ON cte.d_date_sk = ...), that column MUST be in the CTE's SELECT."
        },
        {
          "rule": "CHECK_TABLE_PRESENCE",
          "description": "If a CTE's WHERE clause references columns from a table, that table MUST be in the CTE's FROM/JOIN clause."
        }
      ],
      "prompt_instruction": "CRITICAL: When creating or modifying a CTE, its SELECT list MUST include ALL columns referenced by downstream queries. Check the Node Contracts section: every column in downstream_refs MUST appear in the CTE output. Also ensure: (1) JOIN columns used by consumers are included in SELECT, (2) every table referenced in WHERE is present in FROM/JOIN, (3) no ambiguous column names between the CTE and re-joined tables. Dropping a column that a downstream node needs will cause an execution error."
    },
    {
      "id": "LITERAL_PRESERVATION",
      "severity": "CRITICAL",
      "description": "All literal values (strings, numbers, dates) from the original query MUST be preserved EXACTLY in the rewrite",
      "failure_rate": "100% of Q2-Q16 failures were caused by hallucinated literals",
      "observed_failures": [
        {
          "query": "Q2",
          "original": "d_year = 2001, d_year = 2002",
          "hallucinated": "d_year = 1998, d_year = 1999",
          "type": "YEAR_HALLUCINATION"
        },
        {
          "query": "Q7",
          "original": "cd_gender = 'M', cd_marital_status = 'S', d_year = 2000",
          "hallucinated": "cd_gender = 'F', cd_marital_status = 'W', d_year = 2001",
          "type": "MULTIPLE_LITERAL_HALLUCINATION"
        },
        {
          "query": "Q10",
          "original": "d_year = 2002, ca_county IN ('Rush County', 'Toole County', 'Jefferson County', 'Dona Ana County', 'La Porte County')",
          "hallucinated": "d_year = 2001, ca_county IN ('Storey County', 'Marquette County', 'Warren County', 'Cochran County', 'Kandiyohi County')",
          "type": "YEAR_AND_STRING_HALLUCINATION"
        },
        {
          "query": "Q13",
          "original": "cd_marital_status = 'M', cd_education_status = 'Advanced Degree'",
          "hallucinated": "cd_marital_status = 'D', cd_education_status = 'Unknown'",
          "type": "STRING_HALLUCINATION"
        },
        {
          "query": "Q16",
          "original": "ca_state = 'GA', cc_county = 'Williamson County', d_date BETWEEN '2002-02-01' AND '2002-04-02'",
          "hallucinated": "ca_state = 'WV', cc_county IN ('Ziebach County', ...), d_date BETWEEN '2002-4-01' AND ...",
          "type": "STATE_COUNTY_DATE_HALLUCINATION"
        }
      ],
      "constraint_rules": [
        {
          "rule": "EXACT_STRING_MATCH",
          "description": "String literals in WHERE clauses must be copied character-for-character",
          "examples": [
            "'M' not 'F'",
            "'GA' not 'WV'",
            "'Rush County' not 'Storey County'"
          ]
        },
        {
          "rule": "EXACT_NUMBER_MATCH",
          "description": "Numeric literals (years, amounts, counts) must be copied exactly",
          "examples": [
            "2000 not 2001",
            "2002 not 2001",
            "100.00 not 150.00"
          ]
        },
        {
          "rule": "EXACT_DATE_MATCH",
          "description": "Date literals must be copied exactly, including format",
          "examples": [
            "'2002-02-01' not '2002-4-01'"
          ]
        },
        {
          "rule": "EXACT_LIST_MATCH",
          "description": "IN lists must contain the exact same values in the same order",
          "examples": [
            "IN ('TX', 'OH', 'TX') not IN ('SD', 'KS', 'MI')"
          ]
        }
      ],
      "prompt_instruction": "CRITICAL: When rewriting SQL, you MUST copy ALL literal values (strings, numbers, dates) EXACTLY from the original query. Do NOT invent, substitute, or 'improve' any filter values. If the original says d_year = 2000, your rewrite MUST say d_year = 2000. If the original says ca_state = 'GA', your rewrite MUST say ca_state = 'GA'. Changing these values will produce WRONG RESULTS and the rewrite will be REJECTED."
    },
    {
      "id": "SEMANTIC_EQUIVALENCE",
      "severity": "CRITICAL",
      "description": "The rewritten query MUST return exactly the same rows, columns, and ordering as the original. This is the prime directive.",
      "constraint_rules": [
        {
          "rule": "SAME_ROWS",
          "description": "The rewritten query must produce the same set of rows as the original. No rows may be added or removed."
        },
        {
          "rule": "SAME_COLUMNS",
          "description": "The rewritten query must return the same columns in the same order with the same names and data types."
        },
        {
          "rule": "SAME_ORDERING",
          "description": "If the original query has an ORDER BY clause, the rewritten query must preserve the same ordering."
        }
      ],
      "prompt_instruction": "The rewritten query MUST return exactly the same rows, columns, and ordering as the original. This is the prime directive. Any rewrite that changes the result set \u2014 even by one row, one column, or a different sort order \u2014 is WRONG and will be REJECTED."
    },
    {
      "id": "KEEP_EXISTS_AS_EXISTS",
      "severity": "HIGH",
      "overridable": true,
      "description": "Prefer preserving EXISTS/NOT EXISTS subqueries. Converting to IN/NOT IN risks NULL-handling changes; converting to JOINs risks duplicate rows.",
      "observed_failures": [
        {
          "problem": "Converting NOT EXISTS to NOT IN changes behavior when the subquery column contains NULLs. NOT IN with NULLs returns no rows.",
          "type": "NULL_SEMANTIC_CHANGE"
        },
        {
          "problem": "Converting EXISTS to JOIN can produce duplicate rows when the subquery matches multiple rows per outer row.",
          "type": "DUPLICATE_ROW_INTRODUCTION"
        }
      ],
      "constraint_rules": [
        {
          "rule": "AVOID_EXISTS_TO_IN",
          "description": "Avoid converting EXISTS/NOT EXISTS to IN/NOT IN unless the subquery column is provably NOT NULL (has a NOT NULL constraint or is a primary key)."
        },
        {
          "rule": "EXISTS_TO_JOIN_NEEDS_DISTINCT",
          "description": "Converting EXISTS to JOIN requires SELECT DISTINCT or GROUP BY to prevent row duplication when the subquery matches multiple rows per outer row."
        }
      ],
      "override_conditions": [
        "The subquery join column has a NOT NULL constraint or is a primary key (safe for IN conversion)",
        "The subquery returns at most 1 row per outer row (1:1 relationship, safe for JOIN)",
        "EXISTS is converted to JOIN + DISTINCT/GROUP BY to explicitly handle duplicates"
      ],
      "prompt_instruction": "DEFAULT: Preserve EXISTS/NOT EXISTS as-is. NOT EXISTS\u2192NOT IN breaks with NULLs; EXISTS\u2192JOIN can duplicate rows. HOWEVER: if the join column is NOT NULL (PK or explicit constraint), EXISTS\u2192IN is safe. If the subquery is 1:1 with the outer query, EXISTS\u2192JOIN is safe. The exploration worker MAY convert EXISTS with written proof of NULL safety or 1:1 cardinality."
    },
    {
      "id": "NO_CROSS_JOIN_DIMENSIONS",
      "severity": "HIGH",
      "overridable": true,
      "description": "Avoid CROSS JOINing dimension tables into a single CTE. The Cartesian product can explode row counts and prevent index use on fact tables.",
      "failure_rate": "Caused 0.0076x regression on Q080 (132x slower) when 3 dimensions were cross-joined",
      "observed_failures": [
        {
          "query": "Q080_multi",
          "regression": "0.0076x (57ms -> 7500ms)",
          "broken_rewrite": "filtered_dims AS (SELECT d_date_sk, i_item_sk, p_promo_sk FROM date_dim CROSS JOIN item CROSS JOIN promotion WHERE ...)",
          "problem": "CROSS JOIN created 120K-row CTE (30 \u00d7 200 \u00d7 20), then 3-key join prevented index use on fact tables.",
          "type": "CROSS_JOIN_DIMENSION_EXPLOSION"
        }
      ],
      "constraint_rules": [
        {
          "rule": "PREFER_SEPARATE_DIMENSION_CTES",
          "description": "Each dimension table should generally be its own CTE with its own filter. Combining via CROSS JOIN risks Cartesian explosion."
        }
      ],
      "override_conditions": [
        "Only 2 dimensions are joined (not 3+) AND the product is <1000 rows",
        "The dimensions share a foreign key (not a true Cartesian \u2014 it's a filtered JOIN)",
        "The combined CTE replaces N separate semi-joins with 1 multi-key join on the fact table"
      ],
      "prompt_instruction": "DEFAULT: Keep each dimension as a SEPARATE CTE (filtered_date, filtered_item, etc.). Cross-joining 3 dimensions caused 0.0076x on Q080 (30\u00d7200\u00d720 = 120K rows). HOWEVER: joining exactly 2 small dimensions (<1000 row product) via a foreign key (not Cartesian) may be acceptable if it reduces total join count on the fact table. The exploration worker MAY attempt a 2-dimension join with size estimate. Never cross-join 3+ dimensions."
    },
    {
      "id": "NO_MATERIALIZE_EXISTS",
      "severity": "HIGH",
      "overridable": true,
      "description": "Avoid converting EXISTS/NOT EXISTS subqueries into materialized CTEs with full table scans. EXISTS uses semi-join short-circuiting which is typically more efficient.",
      "failure_rate": "Caused 0.14x and 0.54x regressions (7x and 2x slowdowns)",
      "observed_failures": [
        {
          "query": "Q16",
          "regression": "0.14x (18ms -> 126ms)",
          "original": "EXISTS (SELECT * FROM catalog_sales cs2 WHERE cs1.cs_order_number = cs2.cs_order_number AND cs1.cs_warehouse_sk <> cs2.cs_warehouse_sk)",
          "broken_rewrite": "WITH multi_warehouse_orders AS (SELECT DISTINCT cs_order_number FROM catalog_sales GROUP BY cs_order_number HAVING MIN(cs_warehouse_sk) <> MAX(cs_warehouse_sk))",
          "type": "EXISTS_TO_FULL_SCAN_CTE"
        },
        {
          "query": "Q95",
          "regression": "0.54x (390ms -> 728ms)",
          "original": "EXISTS(SELECT 1 FROM ws_wh WHERE ws_wh.ws_order_number = ws1.ws_order_number)",
          "broken_rewrite": "WITH multi_warehouse_orders AS (SELECT DISTINCT ws_order_number FROM ws_wh)",
          "type": "EXISTS_TO_MATERIALIZED_DISTINCT"
        }
      ],
      "observed_successes": [
        {
          "query": "Q14",
          "speedup": "1.83x",
          "context": "intersect_to_exists: INTERSECT converted to EXISTS for semi-join short-circuit. Shows EXISTS restructuring CAN help when applied in the right direction."
        }
      ],
      "constraint_rules": [
        {
          "rule": "PREFER_EXISTS_SEMI_JOIN",
          "description": "EXISTS and NOT EXISTS use semi-join optimization that short-circuits after finding the first match. Converting to materialized CTEs usually forces a full scan."
        },
        {
          "rule": "AVOID_FULL_TABLE_DISTINCT_CTE",
          "description": "Avoid creating CTEs like SELECT DISTINCT key FROM large_table to replace EXISTS. The CTE scans the entire table; EXISTS can stop after one match."
        }
      ],
      "override_conditions": [
        "The EXISTS subquery is correlated and executed many times (optimizer fails to decorrelate it)",
        "The CTE would be small (<10K rows) and probed multiple times, amortizing materialization cost",
        "The EXISTS is inside a UNION ALL branch where each branch re-executes the same correlated subquery"
      ],
      "prompt_instruction": "DEFAULT: Keep EXISTS/NOT EXISTS as-is \u2014 semi-join short-circuiting is usually faster than materialization. Converting to CTEs caused 0.14x on Q16 and 0.54x on Q95. HOWEVER: if the correlated EXISTS is executed many times and the optimizer fails to decorrelate it, materializing into a small CTE (<10K rows) probed via JOIN may help. The exploration worker MAY attempt this with reasoning about correlation frequency and CTE size."
    },
    {
      "id": "NO_UNFILTERED_DIMENSION_CTE",
      "severity": "HIGH",
      "description": "Never create a 'filtered' dimension CTE that has no WHERE clause. A CTE that selects all rows from a dimension table is pure materialization overhead with zero filtering benefit.",
      "failure_rate": "Caused 0.85x regression on Q67",
      "observed_failures": [
        {
          "query": "Q67",
          "regression": "0.85x (4509ms -> 5291ms)",
          "broken_rewrite": "filtered_stores AS (SELECT s_store_sk, s_store_id FROM store), filtered_items AS (SELECT i_item_sk, i_category, i_class, i_brand, i_product_name FROM item)",
          "problem": "Both CTEs select ALL rows - no WHERE clause, no filtering. Pure overhead.",
          "type": "UNFILTERED_DIMENSION_CTE"
        }
      ],
      "constraint_rules": [
        {
          "rule": "CTE_MUST_FILTER",
          "description": "Every dimension CTE you create MUST have a WHERE clause that reduces the row count. If a dimension table has no filter to apply, do NOT extract it into a CTE."
        },
        {
          "rule": "COLUMN_PROJECTION_IS_NOT_FILTERING",
          "description": "Selecting a subset of columns (SELECT a, b FROM table) is NOT filtering. The CTE still materializes all rows. Only a WHERE clause reduces rows."
        }
      ],
      "prompt_instruction": "Every CTE you create must include a WHERE clause that actually reduces row count. Selecting fewer columns is not filtering \u2014 the CTE still materializes every row. If a dimension table has no predicate to push down, leave it as a direct join in the main query instead of wrapping it in a CTE."
    },
    {
      "id": "OR_TO_UNION_GUARD",
      "severity": "HIGH",
      "overridable": true,
      "description": "Guard rails for or_to_union: branches should have different access paths (not same column) and be limited to 3 or fewer.",
      "observed_failures": [
        {
          "query": "Q90",
          "regression": "0.59x (16ms -> 27ms)",
          "original": "WHERE t.t_hour BETWEEN 10 AND 11 OR t.t_hour BETWEEN 16 AND 17",
          "broken_rewrite": "UNION ALL of two separate web_sales scans (one for AM hours, one for PM hours)",
          "problem": "Doubles the fact table scan. The OR on t_hour is trivial for the optimizer - it just checks two ranges on one column.",
          "type": "UNION_SAME_COLUMN_OR"
        },
        {
          "query": "Q13",
          "regression": "0.23x",
          "problem": "9 UNION branches from nested OR expansion (3 conditions x 3 values) caused 9x fact table scans.",
          "type": "UNION_BRANCH_EXPLOSION"
        },
        {
          "query": "Q48",
          "regression": "0.41x",
          "problem": "9 UNION branches from nested OR expansion caused severe regression from multiplied fact table scans.",
          "type": "UNION_BRANCH_EXPLOSION"
        }
      ],
      "observed_successes": [
        {
          "query": "Q88",
          "speedup": "6.28x",
          "context": "8 time-bucket subqueries on store_sales, each filtering distinct hour ranges via different WHERE clauses. Branches access genuinely different row subsets."
        },
        {
          "query": "Q10",
          "speedup": "1.49x",
          "context": "OR across different dimension table lookups creating distinct access paths."
        },
        {
          "query": "Q45",
          "speedup": "1.35x",
          "context": "OR conditions reference different tables/subqueries."
        }
      ],
      "constraint_rules": [
        {
          "rule": "OR_TO_UNION_REQUIRES_DIFFERENT_PATHS",
          "description": "or_to_union is most beneficial when OR conditions create fundamentally different access paths (e.g., across different tables or between a correlated subquery and a direct filter). Same-column ORs on trivial ranges are usually handled efficiently by the optimizer as a single scan."
        },
        {
          "rule": "OR_TO_UNION_PREFER_3_OR_FEWER",
          "description": "Prefer 3 or fewer UNION ALL branches. Nested ORs that expand into 9+ combinations are almost always harmful. 4-5 branches may be acceptable if each accesses genuinely different row subsets."
        }
      ],
      "override_conditions": [
        "Branches access genuinely different row subsets (different WHERE predicates, not just same-column ranges)",
        "Total branch count stays at 4-5 or fewer (not Cartesian expansion of nested ORs)",
        "EXPLAIN shows the fact table is already scanned N times in baseline, so splitting does not increase scan count",
        "Each branch filters to <20% of fact table rows (high selectivity per branch)"
      ],
      "prompt_instruction": "DEFAULT: Prefer 3 or fewer UNION ALL branches with different access paths per branch. Same-column ORs on simple ranges are usually handled efficiently by the optimizer. Nested ORs that expand into 4+ branches (e.g., 3 x 3 = 9 combinations) caused 0.23x-0.41x regressions. HOWEVER: or_to_union achieved 6.28x on Q88 where branches had genuinely different row subsets. The exploration worker MAY try 4-5 branches if each branch has distinct access paths and high selectivity. Provide reasoning."
    },
    {
      "id": "OR_TO_UNION_SELF_JOIN",
      "severity": "HIGH",
      "overridable": true,
      "description": "Avoid or_to_union on queries with self-joins. Splitting OR conditions on self-joined tables can create multiple independent scans that cannot share the self-join optimization.",
      "observed_failures": [
        {
          "query": "Q23",
          "regression": "0.51x",
          "problem": "Self-join on store_sales was split into separate UNION branches, each requiring its own full self-join, doubling execution time.",
          "type": "SELF_JOIN_SPLIT"
        }
      ],
      "constraint_rules": [
        {
          "rule": "AVOID_OR_TO_UNION_ON_SELF_JOINS",
          "description": "If a query contains a self-join (same table aliased twice), or_to_union is risky because the self-join must typically remain in a single query block to share the scan."
        }
      ],
      "override_conditions": [
        "The OR conditions are on a column NOT involved in the self-join predicate",
        "The self-join aliases have independent WHERE filters that make each branch selective",
        "EXPLAIN shows the self-join is already executed multiple times in baseline"
      ],
      "prompt_instruction": "DEFAULT: Avoid or_to_union when the query contains a self-join (same table with different aliases). Splitting forces each branch to independently perform the self-join (observed 0.51x on Q23). HOWEVER: if the OR conditions target a column not involved in the self-join predicate, or if each alias already has independent selective filters, splitting may still help. The exploration worker MAY attempt this with written reasoning about why the structural context differs from Q23."
    },
    {
      "id": "REMOVE_REPLACED_CTES",
      "severity": "HIGH",
      "description": "When creating replacement CTEs, always remove the original CTEs from the WITH clause. Leaving dead/unused CTEs causes unnecessary materialization overhead.",
      "failure_rate": "Contributed to 0.49x and 0.68x regressions",
      "observed_failures": [
        {
          "query": "Q31",
          "regression": "0.49x (99ms -> 201ms)",
          "problem": "Created new store_sales_agg and web_sales_agg CTEs but left the original ss and ws CTEs in the WITH clause. Both old and new CTEs coexist, wasting materialization.",
          "type": "DEAD_CTE_OVERHEAD"
        },
        {
          "query": "Q74",
          "regression": "0.68x (493ms -> 724ms)",
          "problem": "Created 4 new year-specific CTEs but left the original year_total, year_total_store, year_total_web CTEs. Total of 8 CTEs instead of 4.",
          "type": "DEAD_CTE_OVERHEAD"
        }
      ],
      "constraint_rules": [
        {
          "rule": "REPLACE_NOT_APPEND",
          "description": "When your rewrite replaces a CTE with a new version, the original CTE node must be removed or overwritten. Do not define both the old and new CTE."
        }
      ],
      "prompt_instruction": "When creating replacement CTEs, overwrite the original by using the same node_id in your rewrite_sets, or ensure the original is removed from the WITH clause. Every CTE in the final query should be actively used \u2014 dead CTEs still get materialized and waste resources (caused 0.49x on Q31, 0.68x on Q74)."
    },
    {
      "id": "UNION_CTE_SPLIT_MUST_REPLACE",
      "severity": "HIGH",
      "description": "When splitting a UNION into separate CTEs, the original UNION must be eliminated. Creating CTEs that duplicate the UNION branches while keeping the original UNION doubles the work.",
      "observed_failures": [
        {
          "query": "multiple",
          "problem": "UNION branches were extracted into CTEs but the original UNION ALL remained in the main query, causing each branch to be computed twice.",
          "type": "DUPLICATE_UNION"
        }
      ],
      "constraint_rules": [
        {
          "rule": "CTE_SPLIT_REPLACES_UNION",
          "description": "When applying union_cte_split, the final query must reference the CTEs instead of the original UNION. The total number of UNION ALL operations should not increase."
        }
      ],
      "prompt_instruction": "When applying union_cte_split (splitting UNION into CTEs), the original UNION must be eliminated from the main query. The main query should reference the split CTEs, not duplicate the UNION branches. If the rewritten query has more UNION ALL operations than the original, the rewrite is incorrect."
    },
    {
      "id": "DECORRELATE_MUST_FILTER_FIRST",
      "severity": "MEDIUM",
      "description": "When decorrelating a subquery into a JOIN, the replacement JOIN must include a selective filter. A decorrelation that produces an unfiltered cross-product is worse than the original correlated subquery.",
      "observed_failures": [
        {
          "query": "multiple",
          "problem": "Correlated subquery was converted to JOIN without carrying over the original WHERE filters, producing a much larger intermediate result than the correlated version.",
          "type": "UNFILTERED_DECORRELATION"
        }
      ],
      "constraint_rules": [
        {
          "rule": "DECORRELATE_PRESERVES_FILTERS",
          "description": "When converting a correlated subquery to a JOIN + GROUP BY CTE, all WHERE conditions from the original subquery must be preserved in the CTE or JOIN condition. The replacement must not produce more rows than the original correlated subquery."
        }
      ],
      "prompt_instruction": "When decorrelating a correlated subquery into a JOIN, ensure all original WHERE filters are preserved in the replacement CTE or JOIN condition. A decorrelation without selective filters creates a cross-product that is larger than the original per-row correlated execution. The replacement CTE must filter to at most the same cardinality as the original subquery."
    },
    {
      "id": "DIMENSION_CTE_SAME_COLUMN_OR",
      "severity": "MEDIUM",
      "description": "Do not extract dimension CTE filters when the WHERE clause has OR conditions on the same column. Same-column ORs are efficiently handled by the optimizer in a single scan; CTE extraction adds overhead without benefit.",
      "observed_failures": [
        {
          "query": "Q37",
          "regression": "0.89x",
          "problem": "OR conditions on item.i_current_price ranges were extracted into separate CTEs, adding CTE materialization overhead without improving selectivity.",
          "type": "SAME_COLUMN_OR_CTE"
        }
      ],
      "constraint_rules": [
        {
          "rule": "KEEP_SAME_COLUMN_OR_INLINE",
          "description": "When OR conditions filter the same column (e.g., i_current_price BETWEEN X AND Y OR i_current_price BETWEEN A AND B), keep them inline in WHERE. Only extract dimension CTEs when filters span different columns or tables."
        }
      ],
      "prompt_instruction": "Do not create dimension CTEs to isolate OR conditions that filter the same column. The optimizer handles same-column ORs efficiently in a single scan. Only apply dimension_cte_isolate when filters span different columns or different dimension tables."
    },
    {
      "id": "EARLY_FILTER_CTE_BEFORE_CHAIN",
      "severity": "MEDIUM",
      "description": "Early filter CTEs must be referenced by the main query chain. An orphaned CTE that pre-filters data but is never joined back into the main query wastes materialization effort.",
      "observed_failures": [
        {
          "query": "multiple",
          "problem": "Early filter CTEs were created but not referenced in subsequent JOINs, resulting in wasted CTE materialization plus the original unfiltered joins remaining.",
          "type": "ORPHANED_FILTER_CTE"
        }
      ],
      "constraint_rules": [
        {
          "rule": "FILTER_CTE_MUST_BE_REFERENCED",
          "description": "Every early_filter CTE must be referenced by at least one downstream CTE or the main query. If a filter CTE is created, the original unfiltered table reference must be replaced with the CTE reference."
        }
      ],
      "prompt_instruction": "When creating an early_filter CTE, ensure it is actually referenced in the main query chain. The original unfiltered table reference must be replaced with the CTE reference. Do not create CTEs that filter a table if the main query still joins the original unfiltered table \u2014 this adds overhead without benefit."
    },
    {
      "id": "EXPLICIT_JOINS",
      "severity": "MEDIUM",
      "description": "Convert comma-separated implicit joins to explicit JOIN ... ON syntax. This gives the optimizer better join-order freedom.",
      "constraint_rules": [
        {
          "rule": "PREFER_EXPLICIT_JOIN",
          "description": "When the original query uses comma-separated tables with WHERE conditions for joining, convert to explicit JOIN ... ON syntax."
        }
      ],
      "prompt_instruction": "Convert comma-separated implicit joins to explicit JOIN ... ON syntax. This gives the optimizer better join-order freedom."
    },
    {
      "id": "MIN_BASELINE_THRESHOLD",
      "severity": "MEDIUM",
      "overridable": true,
      "description": "Be conservative with CTE-based transforms on queries with very short baseline runtimes. CTE materialization overhead can dominate when the query is already fast.",
      "failure_rate": "Caused 0.14x-0.59x regressions on queries under 50ms",
      "observed_failures": [
        {
          "query": "Q25",
          "regression": "0.50x (31ms -> 62ms)",
          "baseline_ms": 31,
          "transform": "prefetch_fact_join with 6 CTEs",
          "type": "CTE_OVERHEAD_ON_FAST_QUERY"
        },
        {
          "query": "Q90",
          "regression": "0.59x (16ms -> 27ms)",
          "baseline_ms": 16,
          "transform": "multi_dimension_prefetch with 4 CTEs + UNION ALL",
          "type": "CTE_OVERHEAD_ON_FAST_QUERY"
        },
        {
          "query": "Q16",
          "regression": "0.14x (18ms -> 126ms)",
          "baseline_ms": 18,
          "transform": "materialize_cte with 2 full-scan CTEs",
          "type": "CTE_OVERHEAD_ON_FAST_QUERY"
        }
      ],
      "constraint_rules": [
        {
          "rule": "CHECK_BASELINE_RUNTIME",
          "description": "If the Execution Plan shows estimated or actual runtime under 50ms, prefer minimal rewrites. DuckDB already optimizes simple star-join patterns efficiently."
        }
      ],
      "override_conditions": [
        "The transform reduces scan count (e.g., 3 scans \u2192 1 scan) even on a fast query",
        "The query is a component of a larger pipeline where cumulative savings matter",
        "The transform simplifies the query structure without adding CTEs (e.g., pushdown, decorrelate)"
      ],
      "prompt_instruction": "DEFAULT: If baseline is under 100ms, prefer minimal rewrites. CTE materialization overhead (hash tables, intermediate storage) can exceed filtering benefit on fast queries. HOWEVER: transforms that reduce scan count without adding CTEs (pushdown, decorrelate) may still help. The exploration worker MAY attempt structural changes on fast queries if the transform is scan-reducing, not CTE-adding."
    },
    {
      "id": "PREFETCH_MULTI_FACT_CHAIN",
      "severity": "MEDIUM",
      "overridable": true,
      "description": "Prefer limiting cascading fact-table CTEs to 2. Each additional CTE materializes a large intermediate result.",
      "observed_failures": [
        {
          "query": "Q4",
          "regression": "0.78x",
          "problem": "3 cascading fact-table CTEs (store_sales -> catalog_sales -> web_sales) created excessive intermediate materialization.",
          "type": "FACT_CHAIN_OVERHEAD"
        }
      ],
      "constraint_rules": [
        {
          "rule": "PREFER_2_OR_FEWER_FACT_CTES",
          "description": "When pre-joining fact tables with filtered dimensions in CTEs, 2 cascading fact CTEs is safe. A third adds risk of excessive materialization."
        }
      ],
      "override_conditions": [
        "Each fact CTE has highly selective filters (<5% of rows survive), keeping intermediate sizes small",
        "The 3rd CTE reads from a dimension-filtered result, not a raw fact table",
        "The query already has 3+ separate fact table scans in baseline \u2014 chaining cannot be worse"
      ],
      "prompt_instruction": "DEFAULT: Limit to 2 cascading fact-table CTEs. A 3rd CTE caused 0.78x on Q4 from excessive materialization. HOWEVER: if each CTE applies highly selective filters (<5% row survival), the intermediate results stay small. The exploration worker MAY try a 3-CTE chain if filters are selective and baseline already has 3+ separate scans."
    },
    {
      "id": "SINGLE_PASS_AGGREGATION_LIMIT",
      "severity": "MEDIUM",
      "overridable": true,
      "description": "Prefer limiting single-pass aggregation to 8 CASE branches. Beyond 8, CASE evaluation overhead may reduce benefit.",
      "observed_failures": [
        {
          "query": "Q88",
          "note": "8 CASE branches (time slices) was the maximum tested that still showed improvement (6.28x). More branches are untested, not proven harmful.",
          "type": "CASE_BRANCH_LIMIT"
        }
      ],
      "observed_successes": [
        {
          "query": "Q88",
          "speedup": "6.28x",
          "context": "8 CASE branches consolidating 8 separate time-bucket subqueries into a single scan."
        },
        {
          "query": "Q9",
          "speedup": "4.47x",
          "context": "5 CASE branches consolidating repeated store_sales scans."
        }
      ],
      "constraint_rules": [
        {
          "rule": "PREFER_8_OR_FEWER_CASE_BRANCHES",
          "description": "When consolidating repeated scans into CASE WHEN aggregates, 8 or fewer branches is well-tested. More branches are untested territory."
        }
      ],
      "override_conditions": [
        "The original query has 9-12 repeated scans on the same fact table (high consolidation value)",
        "Each CASE branch is a simple equality check (low per-row overhead)",
        "The fact table is large (>1M rows) so scan reduction dominates CASE evaluation cost"
      ],
      "prompt_instruction": "DEFAULT: Use at most 8 CASE branches for single_pass_aggregation (tested up to 8 at 6.28x on Q88). HOWEVER: 9-12 branches with simple equality checks on large fact tables may still net positive. The exploration worker MAY try 9-12 branches if the scan reduction value is high. Beyond 12 branches is not recommended."
    }
  ],
  "regression_warnings": [
    {
      "id": "regression_fast_baseline_cte_overhead",
      "type": "regression",
      "name": "regression: CTE overhead on fast baseline (0.5x)",
      "description": "Do not pre-filter and materialize fact tables when the query has 3+ fact table joins. The optimizer needs freedom to reorder multi-way fact joins and push filters across them.",
      "verified_speedup": "0.5x",
      "query_id": "",
      "transform_attempted": "date_cte_isolate",
      "regression_mechanism": "Pre-filtered and joined store_sales to date CTE BEFORE the 3-way fact table join (store_sales <- store_returns <- catalog_sales). By materializing the date-filtered store_sales early, the optimizer loses the ability to push filters across the multi-way fact join and reorder joins optimally.",
      "original_sql": "-- start query 25 in stream 0 using template query25.tpl\nselect \n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n ,sum(ss_net_profit) as store_sales_profit\n ,sum(sr_net_loss) as store_returns_loss\n ,sum(cs_net_profit) as catalog_sales_profit\n from\n store_sales\n ,store_returns\n ,catalog_sales\n ,date_dim d1\n ,date_dim d2\n ,date_dim d3\n ,store\n ,item\n where\n d1.d_moy = 4\n and d1.d_year = 2000\n and d1.d_date_sk = ss_sold_date_sk\n and i_item_sk = ss_item_sk\n and s_store_sk = ss_store_sk\n and ss_customer_sk = sr_customer_sk\n and ss_item_sk = sr_item_sk\n and ss_ticket_number = sr_ticket_number\n and sr_returned_date_sk = d2.d_date_sk\n and d2.d_moy               between 4 and  10\n and d2.d_year              = 2000\n and sr_customer_sk = cs_bill_customer_sk\n and sr_item_sk = cs_item_sk\n and cs_sold_date_sk = d3.d_date_sk\n and d3.d_moy               between 4 and  10 \n and d3.d_year              = 2000\n group by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n order by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n LIMIT 100;\n\n-- end query 25 in stream 0 using template query25.tpl",
      "example": {
        "before_sql": "-- start query 25 in stream 0 using template query25.tpl\nselect \n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n ,sum(ss_net_profit) as store_sales_profit\n ,sum(sr_net_loss) as store_returns_loss\n ,sum(cs_net_profit) as catalog_sales_profit\n from\n store_sales\n ,store_returns\n ,catalog_sales\n ,date_dim d1\n ,date_dim d2\n ,date_dim d3\n ,store\n ,item\n where\n d1.d_moy = 4\n and d1.d_year = 2000\n and d1.d_date_sk = ss_sold_date_sk\n and i_item_sk = ss_item_sk\n and s_store_sk = ss_store_sk\n and ss_customer_sk = sr_customer_sk\n and ss_item_sk = sr_item_sk\n and ss_ticket_number = sr_ticket_number\n and sr_returned_date_sk = d2.d_date_sk\n and d2.d_moy               between 4 and  10\n and d2.d_year              = 2000\n and sr_customer_sk = cs_bill_customer_sk\n and sr_item_sk = cs_item_sk\n and cs_sold_date_sk = d3.d_date_sk\n and d3.d_moy               between 4 and  10 \n and d3.d_year              = 2000\n group by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n order by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n LIMIT 100;\n\n-- end query 25 in stream 0 using template query25.tpl",
        "after_sql": "WITH d1_dates AS (SELECT d_date_sk FROM date_dim WHERE d_moy = 4 AND d_year = 2000), d2_dates AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 4 AND 10 AND d_year = 2000), filtered_store_sales AS (SELECT ss_item_sk, ss_customer_sk, ss_ticket_number, ss_store_sk, ss_net_profit FROM store_sales JOIN d1_dates ON store_sales.ss_sold_date_sk = d1_dates.d_date_sk), filtered_store_returns AS (SELECT sr_item_sk, sr_customer_sk, sr_ticket_number, sr_net_loss FROM store_returns JOIN d2_dates ON store_returns.sr_returned_date_sk = d2_dates.d_date_sk), filtered_catalog_sales AS (SELECT cs_item_sk, cs_bill_customer_sk, cs_net_profit FROM catalog_sales JOIN d2_dates ON catalog_sales.cs_sold_date_sk = d2_dates.d_date_sk)\nSELECT i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name, SUM(fss.ss_net_profit) AS store_sales_profit, SUM(fsr.sr_net_loss) AS store_returns_loss, SUM(fcs.cs_net_profit) AS catalog_sales_profit FROM filtered_store_sales AS fss JOIN filtered_store_returns AS fsr ON fss.ss_customer_sk = fsr.sr_customer_sk AND fss.ss_item_sk = fsr.sr_item_sk AND fss.ss_ticket_number = fsr.sr_ticket_number JOIN filtered_catalog_sales AS fcs ON fsr.sr_customer_sk = fcs.cs_bill_customer_sk AND fsr.sr_item_sk = fcs.cs_item_sk JOIN store AS s ON fss.ss_store_sk = s.s_store_sk JOIN item AS i ON fss.ss_item_sk = i.i_item_sk GROUP BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name ORDER BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name LIMIT 100",
        "key_insight": "Do not pre-filter and materialize fact tables when the query has 3+ fact table joins. The optimizer needs freedom to reorder multi-way fact joins and push filters across them."
      },
      "_tag_score": 0.5909090909090909
    },
    {
      "id": "regression_orphaned_union_cte",
      "type": "regression",
      "name": "regression: orphaned UNION CTE (0.68x)",
      "description": "When splitting a UNION CTE by year, you MUST remove or replace the original UNION CTE. Keeping both the split and original versions causes redundant materialization and extreme cardinality misestimates.",
      "verified_speedup": "0.68x",
      "query_id": "",
      "transform_attempted": "pushdown",
      "regression_mechanism": "Created year-specific CTEs (store_sales_1999, store_sales_2000, etc.) but KEPT the original year_total union CTE alongside them. The optimizer materializes both the split versions and the original union, resulting in redundant computation. Projection cardinality estimates show 10^16x errors from the confused CTE graph.",
      "original_sql": "-- start query 74 in stream 0 using template query74.tpl\nwith year_total as (\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,d_year as year\n       ,stddev_samp(ss_net_paid) year_total\n       ,'s' sale_type\n from customer\n     ,store_sales\n     ,date_dim\n where c_customer_sk = ss_customer_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_year in (1999,1999+1)\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,d_year\n union all\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,d_year as year\n       ,stddev_samp(ws_net_paid) year_total\n       ,'w' sale_type\n from customer\n     ,web_sales\n     ,date_dim\n where c_customer_sk = ws_bill_customer_sk\n   and ws_sold_date_sk = d_date_sk\n   and d_year in (1999,1999+1)\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,d_year\n         )\n  select\n        t_s_secyear.customer_id, t_s_secyear.customer_first_name, t_s_secyear.customer_last_name\n from year_total t_s_firstyear\n     ,year_total t_s_secyear\n     ,year_total t_w_firstyear\n     ,year_total t_w_secyear\n where t_s_secyear.customer_id = t_s_firstyear.customer_id\n         and t_s_firstyear.customer_id = t_w_secyear.customer_id\n         and t_s_firstyear.customer_id = t_w_firstyear.customer_id\n         and t_s_firstyear.sale_type = 's'\n         and t_w_firstyear.sale_type = 'w'\n         and t_s_secyear.sale_type = 's'\n         and t_w_secyear.sale_type = 'w'\n         and t_s_firstyear.year = 1999\n         and t_s_secyear.year = 1999+1\n         and t_w_firstyear.year = 1999\n         and t_w_secyear.year = 1999+1\n         and t_s_firstyear.year_total > 0\n         and t_w_firstyear.year_total > 0\n         and case when t_w_firstyear.year_total > 0 then t_w_secyear.year_total / t_w_firstyear.year_total else null end\n           > case when t_s_firstyear.year_total > 0 then t_s_secyear.year_total / t_s_firstyear.year_total else null end\n order by 2,1,3\n LIMIT 100;\n\n-- end query 74 in stream 0 using template query74.tpl",
      "example": {
        "before_sql": "-- start query 74 in stream 0 using template query74.tpl\nwith year_total as (\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,d_year as year\n       ,stddev_samp(ss_net_paid) year_total\n       ,'s' sale_type\n from customer\n     ,store_sales\n     ,date_dim\n where c_customer_sk = ss_customer_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_year in (1999,1999+1)\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,d_year\n union all\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,d_year as year\n       ,stddev_samp(ws_net_paid) year_total\n       ,'w' sale_type\n from customer\n     ,web_sales\n     ,date_dim\n where c_customer_sk = ws_bill_customer_sk\n   and ws_sold_date_sk = d_date_sk\n   and d_year in (1999,1999+1)\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,d_year\n         )\n  select\n        t_s_secyear.customer_id, t_s_secyear.customer_first_name, t_s_secyear.customer_last_name\n from year_total t_s_firstyear\n     ,year_total t_s_secyear\n     ,year_total t_w_firstyear\n     ,year_total t_w_secyear\n where t_s_secyear.customer_id = t_s_firstyear.customer_id\n         and t_s_firstyear.customer_id = t_w_secyear.customer_id\n         and t_s_firstyear.customer_id = t_w_firstyear.customer_id\n         and t_s_firstyear.sale_type = 's'\n         and t_w_firstyear.sale_type = 'w'\n         and t_s_secyear.sale_type = 's'\n         and t_w_secyear.sale_type = 'w'\n         and t_s_firstyear.year = 1999\n         and t_s_secyear.year = 1999+1\n         and t_w_firstyear.year = 1999\n         and t_w_secyear.year = 1999+1\n         and t_s_firstyear.year_total > 0\n         and t_w_firstyear.year_total > 0\n         and case when t_w_firstyear.year_total > 0 then t_w_secyear.year_total / t_w_firstyear.year_total else null end\n           > case when t_s_firstyear.year_total > 0 then t_s_secyear.year_total / t_s_firstyear.year_total else null end\n order by 2,1,3\n LIMIT 100;\n\n-- end query 74 in stream 0 using template query74.tpl",
        "after_sql": "WITH year_1999_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999), year_2000_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2000), year_total AS (SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, d_year AS year, STDDEV_SAMP(ss_net_paid) AS year_total, 's' AS sale_type FROM customer, store_sales, date_dim WHERE c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year IN (1999, 1999 + 1) GROUP BY c_customer_id, c_first_name, c_last_name, d_year UNION ALL SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, d_year AS year, STDDEV_SAMP(ws_net_paid) AS year_total, 'w' AS sale_type FROM customer, web_sales, date_dim WHERE c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year IN (1999, 1999 + 1) GROUP BY c_customer_id, c_first_name, c_last_name, d_year), store_sales_1999 AS (SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, 1999 AS year, STDDEV_SAMP(ss_net_paid) AS year_total FROM customer, store_sales, year_1999_dates WHERE c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk GROUP BY c_customer_id, c_first_name, c_last_name), store_sales_2000 AS (SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, 2000 AS year, STDDEV_SAMP(ss_net_paid) AS year_total FROM customer, store_sales, year_2000_dates WHERE c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk GROUP BY c_customer_id, c_first_name, c_last_name), web_sales_1999 AS (SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, 1999 AS year, STDDEV_SAMP(ws_net_paid) AS year_total FROM customer, web_sales, year_1999_dates WHERE c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk GROUP BY c_customer_id, c_first_name, c_last_name), web_sales_2000 AS (SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, 2000 AS year, STDDEV_SAMP(ws_net_paid) AS year_total FROM customer, web_sales, year_2000_dates WHERE c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk GROUP BY c_customer_id, c_first_name, c_last_name), year_total_store AS (SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, d_year AS year, STDDEV_SAMP(ss_net_paid) AS year_total FROM customer, store_sales, date_dim WHERE c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year IN (1999, 1999 + 1) GROUP BY c_customer_id, c_first_name, c_last_name, d_year), year_total_web AS (SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, d_year AS year, STDDEV_SAMP(ws_net_paid) AS year_total FROM customer, web_sales, date_dim WHERE c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year IN (1999, 1999 + 1) GROUP BY c_customer_id, c_first_name, c_last_name, d_year)\nSELECT t_s_secyear.customer_id, t_s_secyear.customer_first_name, t_s_secyear.customer_last_name FROM store_sales_1999 AS t_s_firstyear, store_sales_2000 AS t_s_secyear, web_sales_1999 AS t_w_firstyear, web_sales_2000 AS t_w_secyear WHERE t_s_secyear.customer_id = t_s_firstyear.customer_id AND t_s_firstyear.customer_id = t_w_secyear.customer_id AND t_s_firstyear.customer_id = t_w_firstyear.customer_id AND t_s_firstyear.year_total > 0 AND t_w_firstyear.year_total > 0 AND CASE WHEN t_w_firstyear.year_total > 0 THEN t_w_secyear.year_total / t_w_firstyear.year_total ELSE NULL END > CASE WHEN t_s_firstyear.year_total > 0 THEN t_s_secyear.year_total / t_s_firstyear.year_total ELSE NULL END ORDER BY 2, 1, 3 LIMIT 100",
        "key_insight": "When splitting a UNION CTE by year, you MUST remove or replace the original UNION CTE. Keeping both the split and original versions causes redundant materialization and extreme cardinality misestimates."
      },
      "_tag_score": 0.5454545454545454
    },
    {
      "id": "regression_exists_materialization",
      "type": "regression",
      "name": "regression: EXISTS materialized into CTE (0.14x)",
      "description": "Never materialize GROUP BY aggregates with HAVING clauses on fact tables before filtering those fact tables through dimension joins.",
      "verified_speedup": "0.14x",
      "query_id": "",
      "transform_attempted": "semantic_rewrite",
      "regression_mechanism": "Materialized a GROUP BY self-join (HAVING MIN() <> MAX()) on the entire fact table BEFORE applying date/address/call_center filters. The original query filters catalog_sales first via correlated EXISTS clauses, then checks warehouse conditions. Pre-materializing the unfiltered self-join creates a massive intermediate result the optimizer cannot cost-estimate correctly.",
      "original_sql": "-- start query 16 in stream 0 using template query16.tpl\nselect \n   count(distinct cs_order_number) as \"order count\"\n  ,sum(cs_ext_ship_cost) as \"total shipping cost\"\n  ,sum(cs_net_profit) as \"total net profit\"\nfrom\n   catalog_sales cs1\n  ,date_dim\n  ,customer_address\n  ,call_center\nwhere\n    d_date between '2002-4-01' and \n           (cast('2002-4-01' as date) + INTERVAL 60 DAY)\nand cs1.cs_ship_date_sk = d_date_sk\nand cs1.cs_ship_addr_sk = ca_address_sk\nand ca_state = 'WV'\nand cs1.cs_call_center_sk = cc_call_center_sk\nand cc_county in ('Ziebach County','Luce County','Richland County','Daviess County',\n                  'Barrow County'\n)\nand exists (select *\n            from catalog_sales cs2\n            where cs1.cs_order_number = cs2.cs_order_number\n              and cs1.cs_warehouse_sk <> cs2.cs_warehouse_sk)\nand not exists(select *\n               from catalog_returns cr1\n               where cs1.cs_order_number = cr1.cr_order_number)\norder by count(distinct cs_order_number)\n LIMIT 100;\n\n-- end query 16 in stream 0 using template query16.tpl",
      "example": {
        "before_sql": "-- start query 16 in stream 0 using template query16.tpl\nselect \n   count(distinct cs_order_number) as \"order count\"\n  ,sum(cs_ext_ship_cost) as \"total shipping cost\"\n  ,sum(cs_net_profit) as \"total net profit\"\nfrom\n   catalog_sales cs1\n  ,date_dim\n  ,customer_address\n  ,call_center\nwhere\n    d_date between '2002-4-01' and \n           (cast('2002-4-01' as date) + INTERVAL 60 DAY)\nand cs1.cs_ship_date_sk = d_date_sk\nand cs1.cs_ship_addr_sk = ca_address_sk\nand ca_state = 'WV'\nand cs1.cs_call_center_sk = cc_call_center_sk\nand cc_county in ('Ziebach County','Luce County','Richland County','Daviess County',\n                  'Barrow County'\n)\nand exists (select *\n            from catalog_sales cs2\n            where cs1.cs_order_number = cs2.cs_order_number\n              and cs1.cs_warehouse_sk <> cs2.cs_warehouse_sk)\nand not exists(select *\n               from catalog_returns cr1\n               where cs1.cs_order_number = cr1.cr_order_number)\norder by count(distinct cs_order_number)\n LIMIT 100;\n\n-- end query 16 in stream 0 using template query16.tpl",
        "after_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2002-4-01' AND (CAST('2002-4-01' AS DATE) + INTERVAL '60' DAY)), filtered_address AS (SELECT ca_address_sk FROM customer_address WHERE ca_state = 'WV'), filtered_call_center AS (SELECT cc_call_center_sk FROM call_center WHERE cc_county IN ('Ziebach County', 'Luce County', 'Richland County', 'Daviess County', 'Barrow County')), multi_warehouse_orders AS (SELECT DISTINCT cs_order_number FROM catalog_sales GROUP BY cs_order_number HAVING MIN(cs_warehouse_sk) <> MAX(cs_warehouse_sk)), returned_orders AS (SELECT DISTINCT cr_order_number FROM catalog_returns), filtered_sales AS (SELECT cs_order_number, cs_ext_ship_cost, cs_net_profit FROM catalog_sales AS cs1 JOIN filtered_dates ON cs1.cs_ship_date_sk = filtered_dates.d_date_sk JOIN filtered_address ON cs1.cs_ship_addr_sk = filtered_address.ca_address_sk JOIN filtered_call_center ON cs1.cs_call_center_sk = filtered_call_center.cc_call_center_sk)\nSELECT COUNT(DISTINCT fs.cs_order_number) AS \"order count\", SUM(fs.cs_ext_ship_cost) AS \"total shipping cost\", SUM(fs.cs_net_profit) AS \"total net profit\" FROM filtered_sales AS fs JOIN multi_warehouse_orders AS mwo ON fs.cs_order_number = mwo.cs_order_number LEFT JOIN returned_orders AS ro ON fs.cs_order_number = ro.cr_order_number WHERE ro.cr_order_number IS NULL ORDER BY COUNT(DISTINCT fs.cs_order_number) LIMIT 100",
        "key_insight": "Never materialize GROUP BY aggregates with HAVING clauses on fact tables before filtering those fact tables through dimension joins."
      },
      "_tag_score": 0.5
    }
  ],
  "strategy_leaderboard": {
    "generated_at": "2026-02-08T14:17:06.364519+00:00",
    "total_attempts": 821,
    "total_queries": 101,
    "query_archetypes": {
      "query_1": "filter_pushdown",
      "query_10": "general",
      "query_11": "filter_pushdown",
      "query_12": "general",
      "query_13": "general",
      "query_14": "set_operations",
      "query_15": "general",
      "query_16": "general",
      "query_17": "general",
      "query_18": "aggregation_rewrite",
      "query_19": "general",
      "query_2": "filter_pushdown",
      "query_20": "general",
      "query_21": "aggregation_rewrite",
      "query_22": "aggregation_rewrite",
      "query_23": "set_operations",
      "query_23a": "set_operations",
      "query_23b": "set_operations",
      "query_24": "filter_pushdown",
      "query_25": "general",
      "query_26": "general",
      "query_27": "aggregation_rewrite",
      "query_28": "general",
      "query_29": "general",
      "query_3": "general",
      "query_30": "filter_pushdown",
      "query_31": "filter_pushdown",
      "query_32": "general",
      "query_33": "set_operations",
      "query_34": "aggregation_rewrite",
      "query_35": "general",
      "query_36": "aggregation_rewrite",
      "query_37": "general",
      "query_38": "set_operations",
      "query_39": "filter_pushdown",
      "query_4": "filter_pushdown",
      "query_40": "aggregation_rewrite",
      "query_41": "aggregation_rewrite",
      "query_42": "general",
      "query_43": "aggregation_rewrite",
      "query_44": "general",
      "query_45": "general",
      "query_46": "general",
      "query_47": "filter_pushdown",
      "query_48": "general",
      "query_49": "set_operations",
      "query_5": "aggregation_rewrite",
      "query_50": "aggregation_rewrite",
      "query_51": "filter_pushdown",
      "query_52": "general",
      "query_53": "aggregation_rewrite",
      "query_54": "set_operations",
      "query_55": "general",
      "query_56": "set_operations",
      "query_57": "filter_pushdown",
      "query_58": "filter_pushdown",
      "query_59": "filter_pushdown",
      "query_6": "general",
      "query_60": "set_operations",
      "query_61": "general",
      "query_62": "aggregation_rewrite",
      "query_63": "aggregation_rewrite",
      "query_64": "filter_pushdown",
      "query_65": "general",
      "query_66": "aggregation_rewrite",
      "query_67": "aggregation_rewrite",
      "query_68": "general",
      "query_69": "general",
      "query_7": "general",
      "query_70": "aggregation_rewrite",
      "query_71": "set_operations",
      "query_72": "aggregation_rewrite",
      "query_73": "aggregation_rewrite",
      "query_74": "filter_pushdown",
      "query_75": "set_operations",
      "query_76": "set_operations",
      "query_77": "aggregation_rewrite",
      "query_78": "filter_pushdown",
      "query_79": "general",
      "query_8": "set_operations",
      "query_80": "aggregation_rewrite",
      "query_81": "filter_pushdown",
      "query_82": "general",
      "query_83": "filter_pushdown",
      "query_84": "general",
      "query_85": "general",
      "query_86": "aggregation_rewrite",
      "query_87": "set_operations",
      "query_88": "general",
      "query_89": "aggregation_rewrite",
      "query_9": "aggregation_rewrite",
      "query_90": "general",
      "query_91": "general",
      "query_92": "general",
      "query_93": "aggregation_rewrite",
      "query_94": "general",
      "query_95": "filter_pushdown",
      "query_96": "general",
      "query_97": "filter_pushdown",
      "query_98": "general",
      "query_99": "aggregation_rewrite"
    },
    "archetype_summary": {
      "aggregation_rewrite": {
        "query_count": 26,
        "total_attempts": 211,
        "queries": [
          "query_18",
          "query_21",
          "query_22",
          "query_27",
          "query_34",
          "query_36",
          "query_40",
          "query_41",
          "query_43",
          "query_5",
          "query_50",
          "query_53",
          "query_62",
          "query_63",
          "query_66",
          "query_67",
          "query_70",
          "query_72",
          "query_73",
          "query_77",
          "query_80",
          "query_86",
          "query_89",
          "query_9",
          "query_93",
          "query_99"
        ],
        "win_rate": 0.284,
        "avg_speedup": 1.169
      },
      "filter_pushdown": {
        "query_count": 20,
        "total_attempts": 144,
        "queries": [
          "query_1",
          "query_11",
          "query_2",
          "query_24",
          "query_30",
          "query_31",
          "query_39",
          "query_4",
          "query_47",
          "query_51",
          "query_57",
          "query_58",
          "query_59",
          "query_64",
          "query_74",
          "query_78",
          "query_81",
          "query_83",
          "query_95",
          "query_97"
        ],
        "win_rate": 0.396,
        "avg_speedup": 1.122
      },
      "general": {
        "query_count": 40,
        "total_attempts": 347,
        "queries": [
          "query_10",
          "query_12",
          "query_13",
          "query_15",
          "query_16",
          "query_17",
          "query_19",
          "query_20",
          "query_25",
          "query_26",
          "query_28",
          "query_29",
          "query_3",
          "query_32",
          "query_35",
          "query_37",
          "query_42",
          "query_44",
          "query_45",
          "query_46",
          "query_48",
          "query_52",
          "query_55",
          "query_6",
          "query_61",
          "query_65",
          "query_68",
          "query_69",
          "query_7",
          "query_79",
          "query_82",
          "query_84",
          "query_85",
          "query_88",
          "query_90",
          "query_91",
          "query_92",
          "query_94",
          "query_96",
          "query_98"
        ],
        "win_rate": 0.248,
        "avg_speedup": 1.041
      },
      "set_operations": {
        "query_count": 15,
        "total_attempts": 119,
        "queries": [
          "query_14",
          "query_23",
          "query_23a",
          "query_23b",
          "query_33",
          "query_38",
          "query_49",
          "query_54",
          "query_56",
          "query_60",
          "query_71",
          "query_75",
          "query_76",
          "query_8",
          "query_87"
        ],
        "win_rate": 0.345,
        "avg_speedup": 1.026
      }
    },
    "transform_by_archetype": {
      "aggregation_rewrite": {
        "date_cte_isolate": {
          "attempts": 86,
          "successes": 40,
          "success_rate": 0.465,
          "avg_speedup_when_successful": 2.208,
          "avg_speedup_all": 1.483,
          "regressions": 16,
          "regression_rate": 0.186,
          "queries_won": [
            "query_18",
            "query_21",
            "query_22",
            "query_27",
            "query_36",
            "query_40",
            "query_43",
            "query_5",
            "query_53",
            "query_62",
            "query_63",
            "query_67",
            "query_72",
            "query_73",
            "query_77",
            "query_80",
            "query_86",
            "query_99"
          ]
        },
        "decorrelate": {
          "attempts": 17,
          "successes": 8,
          "success_rate": 0.471,
          "avg_speedup_when_successful": 1.369,
          "avg_speedup_all": 1.057,
          "regressions": 3,
          "regression_rate": 0.176,
          "queries_won": [
            "query_21",
            "query_41",
            "query_53",
            "query_63",
            "query_67",
            "query_73",
            "query_86",
            "query_93"
          ]
        },
        "dimension_cte_isolate": {
          "attempts": 38,
          "successes": 9,
          "success_rate": 0.237,
          "avg_speedup_when_successful": 1.498,
          "avg_speedup_all": 1.071,
          "regressions": 4,
          "regression_rate": 0.105,
          "queries_won": [
            "query_18",
            "query_21",
            "query_27",
            "query_41",
            "query_5",
            "query_53",
            "query_67",
            "query_80",
            "query_93"
          ]
        },
        "early_filter": {
          "attempts": 49,
          "successes": 8,
          "success_rate": 0.163,
          "avg_speedup_when_successful": 1.584,
          "avg_speedup_all": 1.019,
          "regressions": 12,
          "regression_rate": 0.245,
          "queries_won": [
            "query_18",
            "query_27",
            "query_62",
            "query_66",
            "query_70",
            "query_72",
            "query_93"
          ]
        },
        "intersect_to_exists": {
          "attempts": 21,
          "successes": 1,
          "success_rate": 0.048,
          "avg_speedup_when_successful": 1.818,
          "avg_speedup_all": 0.904,
          "regressions": 8,
          "regression_rate": 0.381,
          "queries_won": [
            "query_80"
          ]
        },
        "materialize_cte": {
          "attempts": 31,
          "successes": 3,
          "success_rate": 0.097,
          "avg_speedup_when_successful": 1.736,
          "avg_speedup_all": 0.949,
          "regressions": 9,
          "regression_rate": 0.29,
          "queries_won": [
            "query_27",
            "query_70",
            "query_72"
          ]
        },
        "multi_date_range_cte": {
          "attempts": 7,
          "successes": 0,
          "success_rate": 0.0,
          "avg_speedup_when_successful": 0,
          "avg_speedup_all": 0.764,
          "regressions": 2,
          "regression_rate": 0.286,
          "queries_won": []
        },
        "multi_dimension_prefetch": {
          "attempts": 35,
          "successes": 9,
          "success_rate": 0.257,
          "avg_speedup_when_successful": 1.917,
          "avg_speedup_all": 1.153,
          "regressions": 6,
          "regression_rate": 0.171,
          "queries_won": [
            "query_27",
            "query_36",
            "query_40",
            "query_41",
            "query_53",
            "query_63",
            "query_73",
            "query_80"
          ]
        },
        "or_to_union": {
          "attempts": 40,
          "successes": 4,
          "success_rate": 0.1,
          "avg_speedup_when_successful": 1.523,
          "avg_speedup_all": 0.774,
          "regressions": 20,
          "regression_rate": 0.5,
          "queries_won": [
            "query_41",
            "query_53",
            "query_63",
            "query_80"
          ]
        },
        "prefetch_fact_join": {
          "attempts": 32,
          "successes": 9,
          "success_rate": 0.281,
          "avg_speedup_when_successful": 1.872,
          "avg_speedup_all": 1.218,
          "regressions": 3,
          "regression_rate": 0.094,
          "queries_won": [
            "query_21",
            "query_27",
            "query_40",
            "query_53",
            "query_80",
            "query_86",
            "query_93",
            "query_99"
          ]
        },
        "pushdown": {
          "attempts": 41,
          "successes": 8,
          "success_rate": 0.195,
          "avg_speedup_when_successful": 2.438,
          "avg_speedup_all": 1.175,
          "regressions": 10,
          "regression_rate": 0.244,
          "queries_won": [
            "query_22",
            "query_27",
            "query_41",
            "query_63",
            "query_70",
            "query_72",
            "query_9",
            "query_93"
          ]
        },
        "single_pass_aggregation": {
          "attempts": 23,
          "successes": 7,
          "success_rate": 0.304,
          "avg_speedup_when_successful": 2.107,
          "avg_speedup_all": 1.319,
          "regressions": 2,
          "regression_rate": 0.087,
          "queries_won": [
            "query_27",
            "query_36",
            "query_40",
            "query_41",
            "query_80",
            "query_93",
            "query_99"
          ]
        },
        "union_cte_split": {
          "attempts": 3,
          "successes": 0,
          "success_rate": 0.0,
          "avg_speedup_when_successful": 0,
          "avg_speedup_all": 0.598,
          "regressions": 2,
          "regression_rate": 0.667,
          "queries_won": []
        }
      },
      "filter_pushdown": {
        "date_cte_isolate": {
          "attempts": 52,
          "successes": 23,
          "success_rate": 0.442,
          "avg_speedup_when_successful": 1.759,
          "avg_speedup_all": 1.191,
          "regressions": 15,
          "regression_rate": 0.288,
          "queries_won": [
            "query_1",
            "query_30",
            "query_39",
            "query_4",
            "query_51",
            "query_57",
            "query_58",
            "query_59",
            "query_64",
            "query_74",
            "query_78",
            "query_83",
            "query_97"
          ]
        },
        "decorrelate": {
          "attempts": 22,
          "successes": 10,
          "success_rate": 0.455,
          "avg_speedup_when_successful": 1.711,
          "avg_speedup_all": 1.196,
          "regressions": 4,
          "regression_rate": 0.182,
          "queries_won": [
            "query_1",
            "query_30",
            "query_51",
            "query_57",
            "query_58",
            "query_74",
            "query_81",
            "query_83"
          ]
        },
        "dimension_cte_isolate": {
          "attempts": 18,
          "successes": 9,
          "success_rate": 0.5,
          "avg_speedup_when_successful": 1.304,
          "avg_speedup_all": 1.107,
          "regressions": 2,
          "regression_rate": 0.111,
          "queries_won": [
            "query_1",
            "query_30",
            "query_4",
            "query_51",
            "query_57",
            "query_59",
            "query_64",
            "query_74",
            "query_95"
          ]
        },
        "early_filter": {
          "attempts": 25,
          "successes": 5,
          "success_rate": 0.2,
          "avg_speedup_when_successful": 1.294,
          "avg_speedup_all": 1.014,
          "regressions": 8,
          "regression_rate": 0.32,
          "queries_won": [
            "query_4",
            "query_51",
            "query_57",
            "query_59",
            "query_95"
          ]
        },
        "intersect_to_exists": {
          "attempts": 15,
          "successes": 4,
          "success_rate": 0.267,
          "avg_speedup_when_successful": 1.188,
          "avg_speedup_all": 0.854,
          "regressions": 7,
          "regression_rate": 0.467,
          "queries_won": [
            "query_30",
            "query_59",
            "query_74",
            "query_83"
          ]
        },
        "materialize_cte": {
          "attempts": 22,
          "successes": 6,
          "success_rate": 0.273,
          "avg_speedup_when_successful": 1.22,
          "avg_speedup_all": 0.97,
          "regressions": 6,
          "regression_rate": 0.273,
          "queries_won": [
            "query_30",
            "query_57",
            "query_58",
            "query_59",
            "query_81"
          ]
        },
        "multi_date_range_cte": {
          "attempts": 6,
          "successes": 5,
          "success_rate": 0.833,
          "avg_speedup_when_successful": 1.206,
          "avg_speedup_all": 1.179,
          "regressions": 0,
          "regression_rate": 0.0,
          "queries_won": [
            "query_11",
            "query_30",
            "query_4",
            "query_64"
          ]
        },
        "multi_dimension_prefetch": {
          "attempts": 14,
          "successes": 7,
          "success_rate": 0.5,
          "avg_speedup_when_successful": 1.929,
          "avg_speedup_all": 1.435,
          "regressions": 4,
          "regression_rate": 0.286,
          "queries_won": [
            "query_1",
            "query_11",
            "query_4",
            "query_59",
            "query_64",
            "query_83",
            "query_95"
          ]
        },
        "or_to_union": {
          "attempts": 27,
          "successes": 8,
          "success_rate": 0.296,
          "avg_speedup_when_successful": 1.947,
          "avg_speedup_all": 1.067,
          "regressions": 15,
          "regression_rate": 0.556,
          "queries_won": [
            "query_30",
            "query_57",
            "query_59",
            "query_74",
            "query_78",
            "query_83"
          ]
        },
        "prefetch_fact_join": {
          "attempts": 30,
          "successes": 12,
          "success_rate": 0.4,
          "avg_speedup_when_successful": 1.695,
          "avg_speedup_all": 1.139,
          "regressions": 12,
          "regression_rate": 0.4,
          "queries_won": [
            "query_1",
            "query_11",
            "query_4",
            "query_57",
            "query_59",
            "query_64",
            "query_74",
            "query_83",
            "query_95"
          ]
        },
        "pushdown": {
          "attempts": 40,
          "successes": 12,
          "success_rate": 0.3,
          "avg_speedup_when_successful": 1.448,
          "avg_speedup_all": 0.991,
          "regressions": 14,
          "regression_rate": 0.35,
          "queries_won": [
            "query_2",
            "query_39",
            "query_4",
            "query_57",
            "query_58",
            "query_59",
            "query_74",
            "query_78",
            "query_83",
            "query_95"
          ]
        },
        "single_pass_aggregation": {
          "attempts": 15,
          "successes": 5,
          "success_rate": 0.333,
          "avg_speedup_when_successful": 2.278,
          "avg_speedup_all": 1.198,
          "regressions": 7,
          "regression_rate": 0.467,
          "queries_won": [
            "query_1",
            "query_4",
            "query_59",
            "query_64",
            "query_95"
          ]
        },
        "union_cte_split": {
          "attempts": 5,
          "successes": 3,
          "success_rate": 0.6,
          "avg_speedup_when_successful": 1.21,
          "avg_speedup_all": 1.01,
          "regressions": 1,
          "regression_rate": 0.2,
          "queries_won": [
            "query_4",
            "query_74",
            "query_83"
          ]
        }
      },
      "general": {
        "date_cte_isolate": {
          "attempts": 127,
          "successes": 36,
          "success_rate": 0.283,
          "avg_speedup_when_successful": 1.6,
          "avg_speedup_all": 1.016,
          "regressions": 53,
          "regression_rate": 0.417,
          "queries_won": [
            "query_10",
            "query_12",
            "query_15",
            "query_16",
            "query_19",
            "query_26",
            "query_3",
            "query_37",
            "query_42",
            "query_45",
            "query_52",
            "query_6",
            "query_65",
            "query_68",
            "query_69",
            "query_7",
            "query_79",
            "query_82",
            "query_85",
            "query_88",
            "query_92",
            "query_94",
            "query_98"
          ]
        },
        "decorrelate": {
          "attempts": 40,
          "successes": 15,
          "success_rate": 0.375,
          "avg_speedup_when_successful": 1.462,
          "avg_speedup_all": 0.947,
          "regressions": 15,
          "regression_rate": 0.375,
          "queries_won": [
            "query_32",
            "query_44",
            "query_45",
            "query_6",
            "query_65",
            "query_68",
            "query_79",
            "query_90",
            "query_92",
            "query_96"
          ]
        },
        "dimension_cte_isolate": {
          "attempts": 65,
          "successes": 13,
          "success_rate": 0.2,
          "avg_speedup_when_successful": 1.685,
          "avg_speedup_all": 1.029,
          "regressions": 22,
          "regression_rate": 0.338,
          "queries_won": [
            "query_10",
            "query_13",
            "query_15",
            "query_45",
            "query_6",
            "query_65",
            "query_68",
            "query_79",
            "query_82",
            "query_84",
            "query_88"
          ]
        },
        "early_filter": {
          "attempts": 72,
          "successes": 17,
          "success_rate": 0.236,
          "avg_speedup_when_successful": 1.563,
          "avg_speedup_all": 1.049,
          "regressions": 20,
          "regression_rate": 0.278,
          "queries_won": [
            "query_12",
            "query_29",
            "query_35",
            "query_37",
            "query_42",
            "query_48",
            "query_65",
            "query_68",
            "query_79",
            "query_84",
            "query_88",
            "query_90",
            "query_96"
          ]
        },
        "intersect_to_exists": {
          "attempts": 30,
          "successes": 9,
          "success_rate": 0.3,
          "avg_speedup_when_successful": 1.274,
          "avg_speedup_all": 0.903,
          "regressions": 12,
          "regression_rate": 0.4,
          "queries_won": [
            "query_15",
            "query_35",
            "query_37",
            "query_44",
            "query_45",
            "query_6",
            "query_65",
            "query_7",
            "query_84"
          ]
        },
        "materialize_cte": {
          "attempts": 43,
          "successes": 8,
          "success_rate": 0.186,
          "avg_speedup_when_successful": 1.837,
          "avg_speedup_all": 1.024,
          "regressions": 13,
          "regression_rate": 0.302,
          "queries_won": [
            "query_44",
            "query_48",
            "query_65",
            "query_68",
            "query_79",
            "query_88",
            "query_92",
            "query_98"
          ]
        },
        "multi_date_range_cte": {
          "attempts": 21,
          "successes": 4,
          "success_rate": 0.19,
          "avg_speedup_when_successful": 2.466,
          "avg_speedup_all": 1.095,
          "regressions": 7,
          "regression_rate": 0.333,
          "queries_won": [
            "query_37",
            "query_65",
            "query_79",
            "query_88"
          ]
        },
        "multi_dimension_prefetch": {
          "attempts": 51,
          "successes": 14,
          "success_rate": 0.275,
          "avg_speedup_when_successful": 1.347,
          "avg_speedup_all": 0.992,
          "regressions": 17,
          "regression_rate": 0.333,
          "queries_won": [
            "query_13",
            "query_16",
            "query_42",
            "query_44",
            "query_45",
            "query_46",
            "query_61",
            "query_65",
            "query_68",
            "query_79",
            "query_82",
            "query_90",
            "query_94"
          ]
        },
        "or_to_union": {
          "attempts": 89,
          "successes": 23,
          "success_rate": 0.258,
          "avg_speedup_when_successful": 2.473,
          "avg_speedup_all": 1.125,
          "regressions": 48,
          "regression_rate": 0.539,
          "queries_won": [
            "query_10",
            "query_13",
            "query_15",
            "query_26",
            "query_35",
            "query_37",
            "query_44",
            "query_6",
            "query_65",
            "query_68",
            "query_7",
            "query_79",
            "query_84",
            "query_85",
            "query_88"
          ]
        },
        "prefetch_fact_join": {
          "attempts": 55,
          "successes": 12,
          "success_rate": 0.218,
          "avg_speedup_when_successful": 1.87,
          "avg_speedup_all": 1.059,
          "regressions": 20,
          "regression_rate": 0.364,
          "queries_won": [
            "query_15",
            "query_32",
            "query_35",
            "query_44",
            "query_6",
            "query_61",
            "query_65",
            "query_68",
            "query_7",
            "query_82",
            "query_88"
          ]
        },
        "pushdown": {
          "attempts": 53,
          "successes": 11,
          "success_rate": 0.208,
          "avg_speedup_when_successful": 1.82,
          "avg_speedup_all": 1.025,
          "regressions": 17,
          "regression_rate": 0.321,
          "queries_won": [
            "query_13",
            "query_37",
            "query_48",
            "query_65",
            "query_68",
            "query_7",
            "query_79",
            "query_85",
            "query_88"
          ]
        },
        "single_pass_aggregation": {
          "attempts": 34,
          "successes": 7,
          "success_rate": 0.206,
          "avg_speedup_when_successful": 2.206,
          "avg_speedup_all": 1.106,
          "regressions": 13,
          "regression_rate": 0.382,
          "queries_won": [
            "query_35",
            "query_44",
            "query_61",
            "query_65",
            "query_82",
            "query_88",
            "query_90"
          ]
        },
        "union_cte_split": {
          "attempts": 2,
          "successes": 1,
          "success_rate": 0.5,
          "avg_speedup_when_successful": 6.105,
          "avg_speedup_all": 3.564,
          "regressions": 0,
          "regression_rate": 0.0,
          "queries_won": [
            "query_88"
          ]
        }
      },
      "set_operations": {
        "date_cte_isolate": {
          "attempts": 62,
          "successes": 26,
          "success_rate": 0.419,
          "avg_speedup_when_successful": 1.466,
          "avg_speedup_all": 1.066,
          "regressions": 23,
          "regression_rate": 0.371,
          "queries_won": [
            "query_14",
            "query_23a",
            "query_23b",
            "query_33",
            "query_38",
            "query_49",
            "query_54",
            "query_56",
            "query_60",
            "query_71",
            "query_75",
            "query_8",
            "query_87"
          ]
        },
        "decorrelate": {
          "attempts": 25,
          "successes": 12,
          "success_rate": 0.48,
          "avg_speedup_when_successful": 1.442,
          "avg_speedup_all": 1.17,
          "regressions": 6,
          "regression_rate": 0.24,
          "queries_won": [
            "query_14",
            "query_23a",
            "query_23b",
            "query_33",
            "query_54",
            "query_56",
            "query_60",
            "query_75",
            "query_87"
          ]
        },
        "dimension_cte_isolate": {
          "attempts": 18,
          "successes": 7,
          "success_rate": 0.389,
          "avg_speedup_when_successful": 1.5,
          "avg_speedup_all": 1.176,
          "regressions": 4,
          "regression_rate": 0.222,
          "queries_won": [
            "query_14",
            "query_49",
            "query_56",
            "query_60",
            "query_75",
            "query_87"
          ]
        },
        "early_filter": {
          "attempts": 21,
          "successes": 6,
          "success_rate": 0.286,
          "avg_speedup_when_successful": 1.346,
          "avg_speedup_all": 1.009,
          "regressions": 6,
          "regression_rate": 0.286,
          "queries_won": [
            "query_14",
            "query_23a",
            "query_54",
            "query_56",
            "query_75"
          ]
        },
        "intersect_to_exists": {
          "attempts": 16,
          "successes": 8,
          "success_rate": 0.5,
          "avg_speedup_when_successful": 1.427,
          "avg_speedup_all": 1.188,
          "regressions": 4,
          "regression_rate": 0.25,
          "queries_won": [
            "query_14",
            "query_23a",
            "query_23b",
            "query_38",
            "query_56",
            "query_75",
            "query_76"
          ]
        },
        "materialize_cte": {
          "attempts": 20,
          "successes": 6,
          "success_rate": 0.3,
          "avg_speedup_when_successful": 1.548,
          "avg_speedup_all": 1.083,
          "regressions": 8,
          "regression_rate": 0.4,
          "queries_won": [
            "query_14",
            "query_23a",
            "query_56",
            "query_75"
          ]
        },
        "multi_date_range_cte": {
          "attempts": 1,
          "successes": 1,
          "success_rate": 1.0,
          "avg_speedup_when_successful": 2.395,
          "avg_speedup_all": 2.395,
          "regressions": 0,
          "regression_rate": 0.0,
          "queries_won": [
            "query_14"
          ]
        },
        "multi_dimension_prefetch": {
          "attempts": 17,
          "successes": 5,
          "success_rate": 0.294,
          "avg_speedup_when_successful": 1.188,
          "avg_speedup_all": 1.022,
          "regressions": 7,
          "regression_rate": 0.412,
          "queries_won": [
            "query_33",
            "query_56",
            "query_60",
            "query_76"
          ]
        },
        "or_to_union": {
          "attempts": 15,
          "successes": 4,
          "success_rate": 0.267,
          "avg_speedup_when_successful": 1.209,
          "avg_speedup_all": 1.012,
          "regressions": 5,
          "regression_rate": 0.333,
          "queries_won": [
            "query_23a",
            "query_56",
            "query_75",
            "query_76"
          ]
        },
        "prefetch_fact_join": {
          "attempts": 21,
          "successes": 8,
          "success_rate": 0.381,
          "avg_speedup_when_successful": 1.427,
          "avg_speedup_all": 1.131,
          "regressions": 7,
          "regression_rate": 0.333,
          "queries_won": [
            "query_14",
            "query_23a",
            "query_23b",
            "query_38",
            "query_56",
            "query_75",
            "query_76"
          ]
        },
        "pushdown": {
          "attempts": 32,
          "successes": 11,
          "success_rate": 0.344,
          "avg_speedup_when_successful": 1.409,
          "avg_speedup_all": 1.085,
          "regressions": 9,
          "regression_rate": 0.281,
          "queries_won": [
            "query_14",
            "query_23a",
            "query_56",
            "query_60",
            "query_75",
            "query_76",
            "query_8"
          ]
        },
        "single_pass_aggregation": {
          "attempts": 11,
          "successes": 2,
          "success_rate": 0.182,
          "avg_speedup_when_successful": 1.293,
          "avg_speedup_all": 1.011,
          "regressions": 5,
          "regression_rate": 0.455,
          "queries_won": [
            "query_56",
            "query_75"
          ]
        },
        "union_cte_split": {
          "attempts": 6,
          "successes": 3,
          "success_rate": 0.5,
          "avg_speedup_when_successful": 1.399,
          "avg_speedup_all": 1.186,
          "regressions": 1,
          "regression_rate": 0.167,
          "queries_won": [
            "query_23a",
            "query_75"
          ]
        }
      }
    },
    "elimination_table": {
      "aggregation_rewrite": {
        "avoid": [
          "intersect_to_exists",
          "materialize_cte",
          "multi_date_range_cte",
          "or_to_union"
        ],
        "reason": {
          "materialize_cte": "3/31 successes, 9 regressions (avg 0.95x)",
          "or_to_union": "4/40 successes, 20 regressions (avg 0.77x)",
          "intersect_to_exists": "1/21 successes, 8 regressions (avg 0.90x)",
          "multi_date_range_cte": "0/7 successes, 2 regressions (avg 0.76x)"
        }
      }
    },
    "top_transforms_by_archetype": {
      "aggregation_rewrite": [
        {
          "transform": "decorrelate",
          "success_rate": 0.471,
          "avg_speedup": 1.057,
          "attempts": 17
        },
        {
          "transform": "date_cte_isolate",
          "success_rate": 0.465,
          "avg_speedup": 1.483,
          "attempts": 86
        },
        {
          "transform": "single_pass_aggregation",
          "success_rate": 0.304,
          "avg_speedup": 1.319,
          "attempts": 23
        },
        {
          "transform": "prefetch_fact_join",
          "success_rate": 0.281,
          "avg_speedup": 1.218,
          "attempts": 32
        },
        {
          "transform": "multi_dimension_prefetch",
          "success_rate": 0.257,
          "avg_speedup": 1.153,
          "attempts": 35
        },
        {
          "transform": "dimension_cte_isolate",
          "success_rate": 0.237,
          "avg_speedup": 1.071,
          "attempts": 38
        },
        {
          "transform": "pushdown",
          "success_rate": 0.195,
          "avg_speedup": 1.175,
          "attempts": 41
        },
        {
          "transform": "early_filter",
          "success_rate": 0.163,
          "avg_speedup": 1.019,
          "attempts": 49
        },
        {
          "transform": "or_to_union",
          "success_rate": 0.1,
          "avg_speedup": 0.774,
          "attempts": 40
        },
        {
          "transform": "materialize_cte",
          "success_rate": 0.097,
          "avg_speedup": 0.949,
          "attempts": 31
        },
        {
          "transform": "intersect_to_exists",
          "success_rate": 0.048,
          "avg_speedup": 0.904,
          "attempts": 21
        },
        {
          "transform": "multi_date_range_cte",
          "success_rate": 0.0,
          "avg_speedup": 0.764,
          "attempts": 7
        },
        {
          "transform": "union_cte_split",
          "success_rate": 0.0,
          "avg_speedup": 0.598,
          "attempts": 3
        }
      ],
      "filter_pushdown": [
        {
          "transform": "multi_date_range_cte",
          "success_rate": 0.833,
          "avg_speedup": 1.179,
          "attempts": 6
        },
        {
          "transform": "union_cte_split",
          "success_rate": 0.6,
          "avg_speedup": 1.01,
          "attempts": 5
        },
        {
          "transform": "multi_dimension_prefetch",
          "success_rate": 0.5,
          "avg_speedup": 1.435,
          "attempts": 14
        },
        {
          "transform": "dimension_cte_isolate",
          "success_rate": 0.5,
          "avg_speedup": 1.107,
          "attempts": 18
        },
        {
          "transform": "decorrelate",
          "success_rate": 0.455,
          "avg_speedup": 1.196,
          "attempts": 22
        },
        {
          "transform": "date_cte_isolate",
          "success_rate": 0.442,
          "avg_speedup": 1.191,
          "attempts": 52
        },
        {
          "transform": "prefetch_fact_join",
          "success_rate": 0.4,
          "avg_speedup": 1.139,
          "attempts": 30
        },
        {
          "transform": "single_pass_aggregation",
          "success_rate": 0.333,
          "avg_speedup": 1.198,
          "attempts": 15
        },
        {
          "transform": "pushdown",
          "success_rate": 0.3,
          "avg_speedup": 0.991,
          "attempts": 40
        },
        {
          "transform": "or_to_union",
          "success_rate": 0.296,
          "avg_speedup": 1.067,
          "attempts": 27
        },
        {
          "transform": "materialize_cte",
          "success_rate": 0.273,
          "avg_speedup": 0.97,
          "attempts": 22
        },
        {
          "transform": "intersect_to_exists",
          "success_rate": 0.267,
          "avg_speedup": 0.854,
          "attempts": 15
        },
        {
          "transform": "early_filter",
          "success_rate": 0.2,
          "avg_speedup": 1.014,
          "attempts": 25
        }
      ],
      "general": [
        {
          "transform": "decorrelate",
          "success_rate": 0.375,
          "avg_speedup": 0.947,
          "attempts": 40
        },
        {
          "transform": "intersect_to_exists",
          "success_rate": 0.3,
          "avg_speedup": 0.903,
          "attempts": 30
        },
        {
          "transform": "date_cte_isolate",
          "success_rate": 0.283,
          "avg_speedup": 1.016,
          "attempts": 127
        },
        {
          "transform": "multi_dimension_prefetch",
          "success_rate": 0.275,
          "avg_speedup": 0.992,
          "attempts": 51
        },
        {
          "transform": "or_to_union",
          "success_rate": 0.258,
          "avg_speedup": 1.125,
          "attempts": 89
        },
        {
          "transform": "early_filter",
          "success_rate": 0.236,
          "avg_speedup": 1.049,
          "attempts": 72
        },
        {
          "transform": "prefetch_fact_join",
          "success_rate": 0.218,
          "avg_speedup": 1.059,
          "attempts": 55
        },
        {
          "transform": "pushdown",
          "success_rate": 0.208,
          "avg_speedup": 1.025,
          "attempts": 53
        },
        {
          "transform": "single_pass_aggregation",
          "success_rate": 0.206,
          "avg_speedup": 1.106,
          "attempts": 34
        },
        {
          "transform": "dimension_cte_isolate",
          "success_rate": 0.2,
          "avg_speedup": 1.029,
          "attempts": 65
        },
        {
          "transform": "multi_date_range_cte",
          "success_rate": 0.19,
          "avg_speedup": 1.095,
          "attempts": 21
        },
        {
          "transform": "materialize_cte",
          "success_rate": 0.186,
          "avg_speedup": 1.024,
          "attempts": 43
        }
      ],
      "set_operations": [
        {
          "transform": "intersect_to_exists",
          "success_rate": 0.5,
          "avg_speedup": 1.188,
          "attempts": 16
        },
        {
          "transform": "union_cte_split",
          "success_rate": 0.5,
          "avg_speedup": 1.186,
          "attempts": 6
        },
        {
          "transform": "decorrelate",
          "success_rate": 0.48,
          "avg_speedup": 1.17,
          "attempts": 25
        },
        {
          "transform": "date_cte_isolate",
          "success_rate": 0.419,
          "avg_speedup": 1.066,
          "attempts": 62
        },
        {
          "transform": "dimension_cte_isolate",
          "success_rate": 0.389,
          "avg_speedup": 1.176,
          "attempts": 18
        },
        {
          "transform": "prefetch_fact_join",
          "success_rate": 0.381,
          "avg_speedup": 1.131,
          "attempts": 21
        },
        {
          "transform": "pushdown",
          "success_rate": 0.344,
          "avg_speedup": 1.085,
          "attempts": 32
        },
        {
          "transform": "materialize_cte",
          "success_rate": 0.3,
          "avg_speedup": 1.083,
          "attempts": 20
        },
        {
          "transform": "multi_dimension_prefetch",
          "success_rate": 0.294,
          "avg_speedup": 1.022,
          "attempts": 17
        },
        {
          "transform": "early_filter",
          "success_rate": 0.286,
          "avg_speedup": 1.009,
          "attempts": 21
        },
        {
          "transform": "or_to_union",
          "success_rate": 0.267,
          "avg_speedup": 1.012,
          "attempts": 15
        },
        {
          "transform": "single_pass_aggregation",
          "success_rate": 0.182,
          "avg_speedup": 1.011,
          "attempts": 11
        }
      ]
    }
  },
  "query_archetype": "scan_consolidation",
  "resource_envelope": null,
  "exploit_algorithm_text": "# DuckDB Rewrite Playbook\n# TPC-DS SF1\u2013SF10 field intelligence\n\n## HOW TO USE THIS DOCUMENT\n\nWork in phase order. Each phase changes the plan shape \u2014 re-evaluate later phases after each.\n\n  Phase 1: Reduce scan volume (P0) \u2014 always first. Every other optimization benefits from smaller input.\n  Phase 2: Eliminate redundant work (P1, P3)\n  Phase 3: Fix structural inefficiencies (P2, P4\u2013P9)\n\n## EXPLAIN ANALYSIS PROCEDURE\n\nBefore choosing any strategy, execute this procedure on the EXPLAIN plan:\n\n1. IDENTIFY THE COST SPINE \u2014 which sequence of nodes accounts for >70% of total cost?\n   The spine is your optimization target. Everything else is noise.\n2. CLASSIFY EACH SPINE NODE:\n   - SEQ_SCAN: how many rows? Is there a filter? Is the filter selective (>5:1)?\n   - HASH_JOIN: what's the build side cardinality? Is it the smaller table?\n   - AGGREGATE: input rows vs output rows ratio? >10:1 = pushdown candidate.\n   - NESTED_LOOP: ALWAYS suspicious \u2014 check if decorrelation is possible.\n   - WINDOW: is it computed before or after a join? Could it be deferred?\n3. TRACE DATA FLOW: row counts should decrease monotonically through the plan.\n   Where do they stay flat or increase? That transition point is the bottleneck.\n4. CHECK THE SYMPTOM ROUTING TABLE: match your observations to primary hypotheses.\n5. FORM BOTTLENECK HYPOTHESIS: \"The optimizer is doing X, but Y would be better\n   because Z.\" This hypothesis drives both pathology matching AND novel reasoning.\n\n## SYMPTOM ROUTING \u2014 from EXPLAIN to hypothesis\n\nTwo routing paths exist and should agree. If they disagree, trust Q-Error (quantitative).\n\n### Path A: Q-Error routing (quantitative \u2014 from \u00a72b-i when available)\n\nQ-Error = max(estimated/actual, actual/estimated) per operator.\nThe operator with the highest Q-Error is where the planner's worst decision lives.\n\n| Q-Error Locus | Direction  | Primary hypothesis     | Why                                      |\n|---------------|------------|------------------------|------------------------------------------|\n| JOIN          | UNDER_EST  | P2 (decorrelate)       | Planner thinks join is cheap, it's not    |\n| JOIN          | ZERO_EST   | P0, P2                 | Planner has no join estimate at all       |\n| JOIN          | OVER_EST   | P5 (LEFT\u2192INNER)        | Planner over-provisions for NULLs         |\n| SCAN          | OVER_EST   | P1, P4                 | Redundant scans or missed pruning         |\n| SCAN          | ZERO_EST   | P2                     | DELIM_SCAN = correlated subquery          |\n| AGGREGATE     | OVER_EST   | P3 (agg below join)    | Fan-out before GROUP BY                   |\n| CTE           | ZERO_EST   | P0, P7                 | Planner blind to CTE statistics           |\n| CTE           | UNDER_EST  | P2, P0                 | CTE output larger than expected           |\n| PROJECTION    | OVER_EST   | P7, P0, P4             | Redundant computation                     |\n| PROJECTION    | UNDER_EST  | P6, P5, P0             | Set operation or join underestimate       |\n| FILTER        | OVER_EST   | P9, P0                 | Shared expression or missed pushdown      |\n\nStructural flags (free, no execution needed):\n- DELIM_SCAN \u2192 P2 (correlated subquery the optimizer couldn't decorrelate)\n- EST_ZERO \u2192 P0/P7 (planner gave up \u2014 CTE boundary blocks stats)\n- EST_ONE_NONLEAF \u2192 P2/P0 (planner guessing on non-leaf node)\n- REPEATED_TABLE \u2192 P1 (single-pass consolidation opportunity)\n\n### Path B: Structural routing (qualitative \u2014 from EXPLAIN tree inspection)\n\n| EXPLAIN symptom                          | Primary hypothesis   | Verify           |\n|------------------------------------------|---------------------|------------------|\n| Row counts flat through CTEs, late drop  | P0 (predicate push) | Filter ratio, chain depth |\n| Same table scanned N times               | P1 (repeated scans) | Join structure identical? |\n| Nested loop with inner aggregate         | P2 (correlated sub)  | Already hash join? |\n| Aggregate input >> output after join     | P3 (agg below join)  | Key alignment    |\n| Full scan, OR across DIFFERENT columns   | P4 (cross-col OR)    | Same column? \u2192 STOP |\n| LEFT JOIN + WHERE on right column        | P5 (LEFT\u2192INNER)      | COALESCE check   |\n| INTERSECT node, large inputs             | P6 (INTERSECT)       | Row count >1K?   |\n| CTE self-joined with discriminators      | P7 (self-join CTE)   | 2-4 values?      |\n| Window in CTE before join                | P8 (deferred window) | LAG/LEAD check   |\n| Identical subtrees in different branches | P9 (shared expr)     | EXISTS check     |\n| None of the above                        | FIRST-PRINCIPLES     | See NO MATCH     |\n\n## ENGINE STRENGTHS \u2014 do NOT rewrite\n\n1. **Predicate pushdown**: filter inside scan node \u2192 leave it.\n2. **Same-column OR**: handled natively in one scan. Splitting = lethal (0.23x observed).\n3. **Hash join selection**: sound for 2\u20134 tables. Reduce inputs, not order.\n4. **CTE inlining**: single-ref CTEs inlined automatically (zero overhead).\n5. **Columnar projection**: only referenced columns read.\n6. **Parallel aggregation**: scans and aggregations parallelized across threads.\n7. **EXISTS semi-join**: early termination. **Never materialize** (0.14x observed).\n\n## CORRECTNESS RULES\n\n- Identical rows, columns, ordering as original.\n- Copy ALL literals exactly (strings, numbers, dates).\n- Every CTE must SELECT all columns referenced downstream.\n- Never drop, rename, or reorder output columns.\n\n## GLOBAL GUARDS\n\n1. EXISTS/NOT EXISTS \u2192 never materialize (0.14x, 0.54x \u2014 semi-join destroyed)\n2. Same-column OR \u2192 never split to UNION (0.23x, 0.59x \u2014 native OR handling)\n3. Baseline < 100ms \u2192 skip CTE-based rewrites (overhead exceeds savings)\n4. 3+ fact table joins \u2192 do not pre-materialize facts (locks join order)\n5. Every CTE MUST have a WHERE clause (0.85x observed)\n6. No orphaned CTEs \u2014 remove original after splitting (0.49x, 0.68x \u2014 double materialization)\n7. No cross-joining 3+ dimension CTEs (0.0076x \u2014 Cartesian product)\n8. Max 2 cascading fact-table CTE chains (0.78x observed)\n9. Convert comma joins to explicit JOIN...ON\n10. NOT EXISTS \u2192 NOT IN breaks with NULLs \u2014 preserve EXISTS form\n\n---\n\n## PATHOLOGIES\n\n### P0: Predicate chain pushback [Phase 1 \u2014 always first, ~35% of wins]\n\n  Gap: CROSS_CTE_PREDICATE_BLINDNESS \u2014 DuckDB plans each CTE independently.\n  Predicates in the outer query or later CTEs cannot propagate backward into\n  earlier CTE definitions. The CTE materializes blind to how its output will\n  be consumed.\n\n  This is the general case. date_cte_isolate, early_filter, prefetch_fact_join,\n  multi_dimension_prefetch are all specific instances where the pushed predicate\n  is a dimension filter. The principle applies to ANY selective predicate:\n  dimension filters, HAVING thresholds, JOIN conditions, subquery results.\n  The rule: find the most selective predicate, find the earliest CTE where it\n  CAN apply, put it there.\n\n  Signal: row counts stay flat through CTE chain stages then drop sharply at a\n  late filter. Target state: monotonically decreasing rows through the chain.\n\n  Decision gates:\n  - Structural: 2+ stage CTE chain + late predicate with columns available earlier\n  - Cardinality: filter ratio >5:1 strong, 2:1\u20135:1 moderate if baseline >200ms, <2:1 skip\n  - Multi-fact: 1 fact = safe, 2 = careful, 3+ = STOP (0.50x on 3-fact query)\n  - ROLLUP/WINDOW downstream: CAUTION (0.85x observed)\n  - CTE already filtered on this predicate: skip (0.71x observed)\n\n  Transform selection (lightest sufficient):\n  - Single dim, \u22642 stages \u2192 date_cte_isolate (12 wins, 1.34x avg)\n  - Single dim, \u22653 stages \u2192 prefetch_fact_join (4 wins, 1.89x avg)\n  - Multiple dims \u2192 multi_dimension_prefetch (3 wins, 1.55x avg)\n  - date_dim 3+ aliases \u2192 multi_date_range_cte (3 wins, 1.42x avg)\n  - Multi-channel shared dims \u2192 shared_dimension_multi_channel (1 win, 1.40x)\n  - CTE self-join with literal discriminators \u2192 self_join_decomposition (1 win, 4.76x)\n\n  Ordering: push most selective predicate first. Selectivity compounds \u2014\n  once the first filter reduces 7M to 50K, everything downstream operates on 50K.\n  Composition: often combines with aggregate_pushdown (P3) or decorrelation (P2).\n  After applying: re-evaluate P1 (scans may now be small enough to skip),\n  P2 (outer set may be small enough that nested loop is fine),\n  P3 (pre-agg on smaller set may now be more valuable).\n\n  Wins: 8 validated (1.9x\u20134.8x, avg 3.3x)\n  Regressions: 0.0076x (dim cross-join), 0.50x (3-fact join lock), 0.85x (ROLLUP blocked), 0.71x (over-decomposed)\n\n### P1: Repeated scans of same table [Phase 2 \u2014 ZERO REGRESSIONS]\n\n  Gap: REDUNDANT_SCAN_ELIMINATION \u2014 the optimizer cannot detect that N subqueries\n  all scan the same table with the same joins. Each subquery is an independent plan\n  unit with no Common Subexpression Elimination across boundaries.\n\n  Signal: N separate SEQ_SCAN nodes on same table, identical joins, different bucket filters.\n  Decision: consolidate to single scan with CASE WHEN / FILTER (WHERE ...).\n  Gates: identical join structure across all subqueries, max 8 branches,\n  COUNT/SUM/AVG/MIN/MAX only (not STDDEV/VARIANCE/PERCENTILE).\n\n  Transforms: single_pass_aggregation (8 wins, 1.88x avg), channel_bitmap_aggregation (1 win, 6.24x)\n  Wins: 6 validated (1.5x\u20136.2x, avg 2.9x)\n\n### P2: Correlated subquery nested loop [Phase 3]\n\n  Gap: CORRELATED_SUBQUERY_PARALYSIS \u2014 the optimizer cannot decorrelate correlated\n  aggregate subqueries into GROUP BY + hash join. It falls back to nested-loop\n  re-execution instead of recognizing the equivalence.\n\n  Signal: nested loop, inner re-executes aggregate per outer row.\n  If EXPLAIN shows hash join on correlation key \u2192 already decorrelated \u2192 STOP.\n  Decision: extract correlated aggregate into CTE with GROUP BY on correlation key, JOIN back.\n  Gates: NEVER decorrelate EXISTS (0.34x, 0.14x \u2014 semi-join destroyed), preserve ALL WHERE filters,\n  check if Phase 1 reduced outer to <1000 rows (nested loop may be fast enough).\n\n  Transforms: decorrelate (3 wins, 2.45x avg), composite_decorrelate_union (1 win, 2.42x)\n  Wins: 2 validated (2.4x\u20132.9x, avg 2.7x)\n  Regressions: 0.34x (semi-join destroyed), 0.71x (already decorrelated)\n\n### P3: Aggregation after join \u2014 fan-out before GROUP BY [Phase 2 \u2014 ZERO REGRESSIONS]\n\n  Gap: AGGREGATE_BELOW_JOIN_BLINDNESS \u2014 the optimizer cannot push GROUP BY below\n  joins even when aggregation keys align with join keys. It always joins first\n  (producing M rows), then aggregates (reducing to K groups, K << M).\n\n  Signal: GROUP BY input rows >> distinct keys, aggregate node sits after join.\n  Decision: pre-aggregate fact by join key BEFORE dimension join.\n  Gates: GROUP BY keys \u2287 join keys (CORRECTNESS \u2014 wrong results if violated),\n  reconstruct AVG from SUM/COUNT when pre-aggregating for ROLLUP.\n\n  Transforms: aggregate_pushdown, star_join_prefetch\n  Wins: 3 validated (1.3x\u201342.9x, avg 15.3x)\n\n### P4: Cross-column OR forcing full scan [Phase 3 \u2014 HIGHEST VARIANCE]\n\n  Gap: CROSS_COLUMN_OR_DECOMPOSITION \u2014 the optimizer handles same-column OR\n  efficiently (single scan range) but OR across different columns forces a full\n  scan evaluating all conditions for every row.\n\n  Signal: single scan, OR across DIFFERENT columns, 70%+ rows discarded.\n  CRITICAL: same column in all OR arms \u2192 STOP (engine handles natively).\n  Decision: split into UNION ALL branches + shared dim CTE.\n  Gates: max 3 branches, cross-column only, no self-join, no nested OR (multiplicative expansion).\n\n  Transforms: or_to_union\n  Wins: 4 validated (1.4x\u20136.3x, avg 3.1x)\n  Regressions: 0.23x (9 branches from nested OR), 0.41x (nested OR expansion), 0.59x (same-col split), 0.51x (self-join re-executed per branch)\n\n### P5: LEFT JOIN + NULL-eliminating WHERE [Phase 3 \u2014 ZERO REGRESSIONS]\n\n  Gap: LEFT_JOIN_FILTER_ORDER_RIGIDITY \u2014 the optimizer cannot infer that WHERE on\n  a right-table column makes LEFT JOIN semantically equivalent to INNER. LEFT JOIN\n  also blocks join reordering (not commutative).\n\n  Signal: LEFT JOIN + WHERE on right-table column (proves right non-null).\n  Decision: convert to INNER JOIN, optionally pre-filter right table into CTE.\n  Gate: no CASE WHEN IS NULL / COALESCE on right-table column.\n\n  Transforms: inner_join_conversion\n  Wins: 2 validated (1.9x\u20133.4x, avg 2.7x)\n\n### P6: INTERSECT materializing both sides [Phase 3 \u2014 ZERO REGRESSIONS]\n\n  Gap: INTERSECT is implemented as set materialization + comparison. The optimizer\n  doesn't recognize that EXISTS semi-join is algebraically equivalent and can\n  short-circuit at first match per row.\n\n  Signal: INTERSECT between 10K+ row result sets.\n  Decision: replace with EXISTS semi-join.\n  Gate: both sides >1K rows.\n  Related: semi_join_exists \u2014 replace full JOIN with EXISTS when joined columns not in output (1.67x).\n\n  Transforms: intersect_to_exists, multi_intersect_exists_cte\n  Wins: 1 validated (2.7x)\n\n### P7: Self-joined CTE materialized for all values [Phase 3]\n\n  Gap: UNION_CTE_SELF_JOIN_DECOMPOSITION + CROSS_CTE_PREDICATE_BLINDNESS \u2014 the\n  optimizer materializes the CTE once for all values. Self-join discriminator\n  filters cannot propagate backward into the CTE definition. Each arm post-filters\n  the full materialized result instead of computing only its needed partition.\n\n  Signal: CTE joined to itself with different WHERE per arm (e.g., period=1 vs period=2).\n  Decision: split into per-partition CTEs, each embedding its discriminator.\n  Gates: 2\u20134 discriminator values, MUST remove original combined CTE after splitting.\n\n  Transforms: self_join_decomposition (1 win, 4.76x), union_cte_split (2 wins, 1.72x avg),\n  rollup_to_union_windowing (1 win, 2.47x)\n  Wins: 3 validated (1.6x\u20134.8x, avg 2.9x)\n  Regressions: 0.49x (orphaned CTE \u2014 double materialization), 0.68x (orphaned variant)\n\n### P8: Window functions in CTEs before join [Phase 3 \u2014 ZERO REGRESSIONS]\n\n  Gap: the optimizer cannot defer window computation past a join when\n  partition/ordering is preserved. It computes the window in the CTE because\n  that's where the SQL places it.\n\n  Signal: N WINDOW nodes inside CTEs, same ORDER BY key, CTEs then joined.\n  Decision: remove windows from CTEs, compute once on joined result.\n  Gates: not LAG/LEAD (depends on pre-join row order), not ROWS BETWEEN with specific frame.\n  Note: SUM() OVER() naturally skips NULLs \u2014 handles FULL OUTER JOIN gaps.\n\n  Transforms: deferred_window_aggregation\n  Wins: 1 validated (1.4x)\n\n### P9: Shared subexpression executed multiple times [Phase 3]\n\n  Gap: the optimizer may not CSE identical subqueries across different query branches.\n  When it doesn't, cost is N\u00d7 what single execution would be.\n  HARD STOP: EXISTS/NOT EXISTS \u2192 NEVER materialize (0.14x observed). Semi-join\n  short-circuit is destroyed by CTE materialization.\n\n  Signal: identical subtrees with identical costs scanning same tables.\n  Decision: extract shared subexpression into CTE.\n  Gates: NOT EXISTS, subquery is expensive (joins/aggregates), CTE must have WHERE.\n\n  Transforms: materialize_cte\n  Wins: 1 validated (1.4x)\n  Regressions: 0.14x (EXISTS materialized \u2014 semi-join destroyed), 0.54x (correlated EXISTS pairs broken)\n\n### NO MATCH \u2014 First-Principles Reasoning\n\nIf no pathology matches this query, do NOT stop.\n\n1. **Check \u00a72b-i Q-Error routing first.** Even when no pathology gate passes,\n   the Q-Error direction+locus still points to where the planner is wrong.\n   Use it as a starting hypothesis for novel intervention design.\n2. Identify the single largest cost node. What operation dominates? Can it be restructured?\n3. Count scans per base table. Repeated scans are always a consolidation opportunity.\n4. Trace row counts through the plan. Where do they stay flat or increase?\n5. Look for operations the optimizer DIDN'T optimize that it could have:\n   - Subqueries not flattened\n   - Predicates not pushed through CTE boundaries\n   - CTEs re-executed instead of materialized\n6. Use the transform catalog (\u00a75a) as a menu. For each transform, check: does the\n   EXPLAIN show the optimizer already handles this? If not \u2192 candidate.\n\nRecord: which pathologies checked, which gates failed, nearest miss, structural\nfeatures present. This data seeds pathology discovery for future updates.\n\n---\n\n## SAFETY RANKING\n\n| Rank | Pathology | Regr. | Worst | Action |\n|------|-----------|-------|-------|--------|\n| 1 | P1: Repeated scans | 0 | \u2014 | Always fix |\n| 2 | P3: Agg after join | 0 | \u2014 | Always fix (verify keys) |\n| 3 | P5: LEFT\u2192INNER | 0 | \u2014 | Always fix |\n| 4 | P6: INTERSECT | 0 | \u2014 | Always fix |\n| 5 | P8: Pre-join windows | 0 | \u2014 | Always fix |\n| 6 | P7: Self-join CTE | 1 | 0.49x | Check orphan CTE |\n| 7 | P0: Predicate pushback | 4 | 0.0076x | All gates must pass |\n| 8 | P2: Correlated loop | 2 | 0.34x | Check EXPLAIN first |\n| 9 | P9: Shared expr | 3 | 0.14x | Never on EXISTS |\n| 10 | P4: Cross-col OR | 4 | 0.23x | Max 3, cross-column only |\n\n## VERIFICATION CHECKLIST\n\nBefore finalizing any rewrite:\n- [ ] Row counts decrease monotonically through CTE chain\n- [ ] No orphaned CTEs (every CTE referenced downstream)\n- [ ] No unfiltered CTEs (every CTE has WHERE)\n- [ ] No cross-joined dimension CTEs (each dim joins to fact)\n- [ ] EXISTS still uses EXISTS (not materialized)\n- [ ] Same-column ORs still intact (not split)\n- [ ] All original WHERE filters preserved in CTEs\n- [ ] Max 2 cascading fact-table CTE chains\n- [ ] Comma joins converted to explicit JOIN...ON\n- [ ] Rewrite doesn't match any known regression pattern\n\n## PRUNING GUIDE\n\nSkip pathologies the plan rules out:\n\n| Plan shows | Skip |\n|---|---|\n| No nested loops | P2 (decorrelation) |\n| Each table appears once | P1 (repeated scans) |\n| No LEFT JOIN | P5 (INNER conversion) |\n| No OR predicates | P4 (OR decomposition) |\n| No GROUP BY | P3 (aggregate pushdown) |\n| No WINDOW/OVER | P8 (deferred window) |\n| No INTERSECT/EXCEPT | P6 (set rewrite) |\n| Baseline < 50ms | ALL CTE-based transforms |\n| Row counts monotonically decreasing | P0 (predicate pushback) |\n\n## REGRESSION REGISTRY\n\n| Severity | Transform | Result | Root cause |\n|----------|-----------|--------|------------|\n| CATASTROPHIC | dimension_cte_isolate | 0.0076x | Cross-joined 3 dim CTEs: Cartesian product |\n| CATASTROPHIC | materialize_cte | 0.14x | Materialized EXISTS \u2192 semi-join destroyed |\n| SEVERE | or_to_union | 0.23x | 9 UNION branches from nested OR |\n| SEVERE | decorrelate | 0.34x | LEFT JOIN was already semi-join |\n| MAJOR | union_cte_split | 0.49x | Original CTE kept \u2192 double materialization |\n| MAJOR | date_cte_isolate | 0.50x | 3-way fact join locked optimizer order |\n| MAJOR | or_to_union | 0.51x | Self-join re-executed per branch |\n| MAJOR | semantic_rewrite | 0.54x | Correlated EXISTS pairs broken |\n| MODERATE | or_to_union | 0.59x | Split same-column OR |\n| MODERATE | union_cte_split | 0.68x | Original CTE kept alongside split |\n| MODERATE | decorrelate | 0.71x | Pre-aggregated ALL stores when only subset needed |\n| MODERATE | prefetch_fact_join | 0.78x | 3rd cascading CTE chain |\n| MINOR | multi_dimension_prefetch | 0.77x | Forced suboptimal join order |\n| MINOR | date_cte_isolate | 0.85x | CTE blocked ROLLUP pushdown |\n",
  "detected_transforms": "[TransformMatch(id='star_join_prefetch', overlap_ratio=1.0, matched_features=['DATE_DIM', 'GROUP_BY', 'MULTI_TABLE_5+', 'STAR_JOIN'], missing_features=[], total_required=4, gap='CROSS_CTE_PREDICATE_BLINDNESS', engines=['duckdb'], contraindications=[{'id': 'LOW_SELECTIVITY', 'instruction': 'Skip if dimension filter returns >20% of rows \u2014 prefetch overhead exceeds savings', 'severity': 'MEDIUM', 'worst_ratio': 0.78}]), TransformMatch(id='dimension_cte_isolate', overlap_ratio=1.0, matched_features=['DATE_DIM', 'GROUP_BY', 'MULTI_TABLE_5+'], missing_features=[], total_required=3, gap='CROSS_CTE_PREDICATE_BLINDNESS', engines=['duckdb'], contraindications=[{'id': 'CROSS_JOIN_3_DIMS', 'instruction': 'NEVER cross-join 3+ dimension CTEs \u2014 Cartesian explosion', 'severity': 'CRITICAL', 'worst_ratio': 0.0076}, {'id': 'UNFILTERED_CTE', 'instruction': 'Every CTE must have a WHERE clause \u2014 unfiltered CTE = pure overhead', 'severity': 'HIGH', 'worst_ratio': None}]), TransformMatch(id='composite_decorrelate_union', overlap_ratio=0.8888888888888888, matched_features=['AGG_COUNT', 'DATE_DIM', 'EXISTS', 'GROUP_BY', 'MULTI_TABLE_5+', 'OR_BRANCH', 'SCALAR_SUB_2+', 'TABLE_REPEAT_3+'], missing_features=['AGG_SUM'], total_required=9, gap='CORRELATED_SUBQUERY_PARALYSIS', engines=['duckdb'], contraindications=[]), TransformMatch(id='multi_date_range_cte', overlap_ratio=0.8333333333333334, matched_features=['BETWEEN', 'DATE_DIM', 'GROUP_BY', 'MULTI_TABLE_5+', 'TABLE_REPEAT_3+'], missing_features=['AGG_AVG'], total_required=6, gap='CROSS_CTE_PREDICATE_BLINDNESS', engines=['duckdb'], contraindications=[]), TransformMatch(id='or_to_union', overlap_ratio=0.75, matched_features=['DATE_DIM', 'GROUP_BY', 'OR_BRANCH'], missing_features=['AGG_SUM'], total_required=4, gap='CROSS_COLUMN_OR_DECOMPOSITION', engines=['duckdb'], contraindications=[{'id': 'MAX_3_BRANCHES', 'instruction': 'Max 3 UNION branches \u2014 6+ is lethal (9 branches = 9x fact scans)', 'severity': 'CRITICAL', 'worst_ratio': 0.23}, {'id': 'SAME_COL_OR', 'instruction': 'NEVER split same-column ORs \u2014 engine handles natively', 'severity': 'HIGH', 'worst_ratio': 0.59}, {'id': 'SELF_JOIN_PRESENT', 'instruction': 'NEVER if self-join present \u2014 each branch re-does the self-join', 'severity': 'HIGH', 'worst_ratio': 0.51}])]",
  "qerror_analysis": "QErrorAnalysis(signals=[QErrorSignal(node_type='DELIM_SCAN', estimated=75736, actual=0, q_error=75736.0, direction='ZERO_EST', timing_ms=0), QErrorSignal(node_type='LEFT_DELIM_JOIN', estimated=16425, actual=0, q_error=16425.0, direction='ZERO_EST', timing_ms=12.145658000000001), QErrorSignal(node_type='LEFT_DELIM_JOIN', estimated=16425, actual=0, q_error=16425.0, direction='ZERO_EST', timing_ms=133.35618599999998), QErrorSignal(node_type='DELIM_SCAN', estimated=16158, actual=0, q_error=16158.0, direction='ZERO_EST', timing_ms=0), QErrorSignal(node_type='DELIM_SCAN', estimated=16158, actual=0, q_error=16158.0, direction='ZERO_EST', timing_ms=0), QErrorSignal(node_type='HASH_JOIN', estimated=0, actual=460, q_error=460.0, direction='ZERO_EST', timing_ms=0.485831), QErrorSignal(node_type='COLUMN_DATA_SCAN', estimated=0, actual=460, q_error=460.0, direction='ZERO_EST', timing_ms=0.018097), QErrorSignal(node_type='PROJECTION', estimated=16425, actual=75, q_error=219.0, direction='OVER_EST', timing_ms=0.016146999999999995), QErrorSignal(node_type='PROJECTION', estimated=16425, actual=75, q_error=219.0, direction='OVER_EST', timing_ms=1.074509), QErrorSignal(node_type='HASH_GROUP_BY', estimated=16425, actual=75, q_error=219.0, direction='OVER_EST', timing_ms=8.53319), QErrorSignal(node_type='PROJECTION', estimated=16425, actual=75, q_error=219.0, direction='OVER_EST', timing_ms=0.0013059999999999999), QErrorSignal(node_type='PROJECTION', estimated=16425, actual=75, q_error=219.0, direction='OVER_EST', timing_ms=0.10342200000000001), QErrorSignal(node_type='PROJECTION', estimated=16425, actual=75, q_error=219.0, direction='OVER_EST', timing_ms=0.0019089999999999999), QErrorSignal(node_type='FILTER', estimated=16425, actual=75, q_error=219.0, direction='OVER_EST', timing_ms=0.138704), QErrorSignal(node_type='HASH_JOIN', estimated=16425, actual=460, q_error=35.70652173913044, direction='OVER_EST', timing_ms=6.522966000000001), QErrorSignal(node_type='HASH_JOIN', estimated=16425, actual=460, q_error=35.70652173913044, direction='OVER_EST', timing_ms=0.6178750000000001), QErrorSignal(node_type='COLUMN_DATA_SCAN', estimated=16425, actual=460, q_error=35.70652173913044, direction='OVER_EST', timing_ms=0.01613), QErrorSignal(node_type='HASH_GROUP_BY', estimated=16158, actual=460, q_error=35.12608695652174, direction='OVER_EST', timing_ms=3.6207930000000004), QErrorSignal(node_type='HASH_GROUP_BY', estimated=16158, actual=460, q_error=35.12608695652174, direction='OVER_EST', timing_ms=11.33199), QErrorSignal(node_type='PROJECTION', estimated=50000, actual=1487, q_error=33.62474781439139, direction='OVER_EST', timing_ms=0.001302), QErrorSignal(node_type='FILTER', estimated=50000, actual=1487, q_error=33.62474781439139, direction='OVER_EST', timing_ms=0.3735040000000001), QErrorSignal(node_type='HASH_JOIN', estimated=82127, actual=2795, q_error=29.383542039355994, direction='OVER_EST', timing_ms=33.88345700000001), QErrorSignal(node_type='HASH_JOIN', estimated=82127, actual=2897, q_error=28.34898170521229, direction='OVER_EST', timing_ms=1.418821), QErrorSignal(node_type='SEQ_SCAN ', estimated=28800991, actual=1032040, q_error=27.906855354443625, direction='OVER_EST', timing_ms=4288.095501), QErrorSignal(node_type='HASH_GROUP_BY', estimated=75736, actual=2795, q_error=27.09695885509839, direction='OVER_EST', timing_ms=11.036766000000002), QErrorSignal(node_type='SEQ_SCAN ', estimated=14401261, actual=534615, q_error=26.937629883186965, direction='OVER_EST', timing_ms=24.62129999999999), QErrorSignal(node_type='SEQ_SCAN ', estimated=7197566, actual=273352, q_error=26.33076033831836, direction='OVER_EST', timing_ms=1091.0300089999996), QErrorSignal(node_type='PROJECTION', estimated=3059, actual=270, q_error=11.329629629629629, direction='OVER_EST', timing_ms=0.0034969999999999992), QErrorSignal(node_type='HASH_JOIN', estimated=3059, actual=270, q_error=11.329629629629629, direction='OVER_EST', timing_ms=3.7224010000000005), QErrorSignal(node_type='PROJECTION', estimated=5739, actual=620, q_error=9.256451612903225, direction='OVER_EST', timing_ms=0.0008969999999999999), QErrorSignal(node_type='HASH_JOIN', estimated=5739, actual=620, q_error=9.256451612903225, direction='OVER_EST', timing_ms=1.638763), QErrorSignal(node_type='PROJECTION', estimated=45354, actual=5505, q_error=8.238692098092644, direction='OVER_EST', timing_ms=0.008581999999999998), QErrorSignal(node_type='HASH_JOIN', estimated=45354, actual=5505, q_error=8.238692098092644, direction='OVER_EST', timing_ms=16.710666000000007), QErrorSignal(node_type='COLUMN_DATA_SCAN', estimated=16425, actual=2795, q_error=5.8765652951699465, direction='OVER_EST', timing_ms=0.048302), QErrorSignal(node_type='COLUMN_DATA_SCAN', estimated=0, actual=5, q_error=5.0, direction='ZERO_EST', timing_ms=0.0035269999999999998), QErrorSignal(node_type='FILTER', estimated=585, actual=120, q_error=4.875, direction='OVER_EST', timing_ms=0.015541), QErrorSignal(node_type='SEQ_SCAN ', estimated=585, actual=120, q_error=4.875, direction='OVER_EST', timing_ms=2.277863), QErrorSignal(node_type='FILTER', estimated=585, actual=120, q_error=4.875, direction='OVER_EST', timing_ms=0.022158999999999998), QErrorSignal(node_type='SEQ_SCAN ', estimated=585, actual=120, q_error=4.875, direction='OVER_EST', timing_ms=2.0792699999999997), QErrorSignal(node_type='FILTER', estimated=585, actual=120, q_error=4.875, direction='OVER_EST', timing_ms=0.026351), QErrorSignal(node_type='SEQ_SCAN ', estimated=585, actual=120, q_error=4.875, direction='OVER_EST', timing_ms=1.843309), QErrorSignal(node_type='HASH_JOIN', estimated=57640, actual=273352, q_error=4.742401110340042, direction='UNDER_EST', timing_ms=5.8520970000000005), QErrorSignal(node_type='HASH_JOIN', estimated=115329, actual=534615, q_error=4.6355643420128505, direction='UNDER_EST', timing_ms=1.0212279999999998), QErrorSignal(node_type='HASH_JOIN', estimated=230647, actual=1032040, q_error=4.474543349794274, direction='UNDER_EST', timing_ms=40.32242000000001)], max_q_error=75736.0, severity='CATASTROPHIC_BLINDNESS', direction='ZERO_EST', locus='SCAN', magnitude='EXTREME', structural_flags=['EST_ZERO', 'DELIM_SCAN'], pathology_candidates=['P2', 'P0'])"
}