WITH date_filter AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1214 AND 1214 + 11), store_sales_join AS (SELECT ss_customer_sk AS customer_sk, ss_item_sk AS item_sk FROM store_sales JOIN date_filter ON ss_sold_date_sk = d_date_sk), store_group_by AS (SELECT customer_sk, item_sk FROM store_sales_join GROUP BY customer_sk, item_sk), catalog_sales_join AS (SELECT cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk FROM catalog_sales JOIN date_filter ON cs_sold_date_sk = d_date_sk), catalog_group_by AS (SELECT customer_sk, item_sk FROM catalog_sales_join GROUP BY customer_sk, item_sk) SELECT SUM(CASE WHEN store_group_by.customer_sk IS NOT NULL AND catalog_group_by.customer_sk IS NULL THEN 1 ELSE 0 END) AS store_only, SUM(CASE WHEN store_group_by.customer_sk IS NULL AND catalog_group_by.customer_sk IS NOT NULL THEN 1 ELSE 0 END) AS catalog_only, SUM(CASE WHEN store_group_by.customer_sk IS NOT NULL AND catalog_group_by.customer_sk IS NOT NULL THEN 1 ELSE 0 END) AS store_and_catalog FROM store_group_by FULL OUTER JOIN catalog_group_by ON (store_group_by.customer_sk = catalog_group_by.customer_sk AND store_group_by.item_sk = catalog_group_by.item_sk) LIMIT 100