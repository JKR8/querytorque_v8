## Part 1: Modified Logic Tree

```
QUERY: (single statement)
└── [MAIN] main_query  [~]  Cost: 100%  Rows: 1 — Consolidated six independent bucket subqueries into single-pass conditional aggregation
    ├── [CTE] store_sales_scan  [+] — Filter to quantity range 0-30, project only needed columns
    │   ├── SCAN (store_sales)
    │   ├── FILTER (ss_quantity BETWEEN 0 AND 30)
    │   └── OUTPUT (ss_quantity, ss_list_price, ss_coupon_amt, ss_wholesale_cost)
    └── [CTE] conditional_aggregation  [+] — Single aggregation with CASE expressions for all six buckets
        ├── FROM: store_sales_scan
        └── OUTPUT (B1_LP, B1_CNT, B1_CNTD, B2_LP, B2_CNT, B2_CNTD, B3_LP, B3_CNT, B3_CNTD, B4_LP, B4_CNT, B4_CNTD, B5_LP, B5_CNT, B5_CNTD, B6_LP, B6_CNT, B6_CNTD)
```

## Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "duckdb",
  "rewrite_rules": [
    {
      "id": "R1",
      "type": "single_pass_aggregation",
      "description": "Consolidated six independent store_sales scans into single CTE with CASE expressions in aggregates",
      "applied_to": ["store_sales_scan", "conditional_aggregation", "main_query"]
    }
  ],
  "statements": [
    {
      "target_table": null,
      "change": "modified",
      "components": {
        "store_sales_scan": {
          "type": "cte",
          "change": "new",
          "sql": "SELECT ss_quantity, ss_list_price, ss_coupon_amt, ss_wholesale_cost FROM store_sales WHERE ss_quantity BETWEEN 0 AND 30",
          "interfaces": {
            "outputs": ["ss_quantity", "ss_list_price", "ss_coupon_amt", "ss_wholesale_cost"],
            "consumes": []
          }
        },
        "conditional_aggregation": {
          "type": "cte",
          "change": "new",
          "sql": "SELECT AVG(CASE WHEN ss_quantity BETWEEN 0 AND 5 AND (ss_list_price BETWEEN 131 AND 141 OR ss_coupon_amt BETWEEN 16798 AND 17798 OR ss_wholesale_cost BETWEEN 25 AND 45) THEN ss_list_price END) AS B1_LP, COUNT(CASE WHEN ss_quantity BETWEEN 0 AND 5 AND (ss_list_price BETWEEN 131 AND 141 OR ss_coupon_amt BETWEEN 16798 AND 17798 OR ss_wholesale_cost BETWEEN 25 AND 45) THEN ss_list_price END) AS B1_CNT, COUNT(DISTINCT CASE WHEN ss_quantity BETWEEN 0 AND 5 AND (ss_list_price BETWEEN 131 AND 141 OR ss_coupon_amt BETWEEN 16798 AND 17798 OR ss_wholesale_cost BETWEEN 25 AND 45) THEN ss_list_price END) AS B1_CNTD, AVG(CASE WHEN ss_quantity BETWEEN 6 AND 10 AND (ss_list_price BETWEEN 145 AND 155 OR ss_coupon_amt BETWEEN 14792 AND 15792 OR ss_wholesale_cost BETWEEN 46 AND 66) THEN ss_list_price END) AS B2_LP, COUNT(CASE WHEN ss_quantity BETWEEN 6 AND 10 AND (ss_list_price BETWEEN 145 AND 155 OR ss_coupon_amt BETWEEN 14792 AND 15792 OR ss_wholesale_cost BETWEEN 46 AND 66) THEN ss_list_price END) AS B2_CNT, COUNT(DISTINCT CASE WHEN ss_quantity BETWEEN 6 AND 10 AND (ss_list_price BETWEEN 145 AND 155 OR ss_coupon_amt BETWEEN 14792 AND 15792 OR ss_wholesale_cost BETWEEN 46 AND 66) THEN ss_list_price END) AS B2_CNTD, AVG(CASE WHEN ss_quantity BETWEEN 11 AND 15 AND (ss_list_price BETWEEN 150 AND 160 OR ss_coupon_amt BETWEEN 6600 AND 7600 OR ss_wholesale_cost BETWEEN 9 AND 29) THEN ss_list_price END) AS B3_LP, COUNT(CASE WHEN ss_quantity BETWEEN 11 AND 15 AND (ss_list_price BETWEEN 150 AND 160 OR ss_coupon_amt BETWEEN 6600 AND 7600 OR ss_wholesale_cost BETWEEN 9 AND 29) THEN ss_list_price END) AS B3_CNT, COUNT(DISTINCT CASE WHEN ss_quantity BETWEEN 11 AND 15 AND (ss_list_price BETWEEN 150 AND 160 OR ss_coupon_amt BETWEEN 6600 AND 7600 OR ss_wholesale_cost BETWEEN 9 AND 29) THEN ss_list_price END) AS B3_CNTD, AVG(CASE WHEN ss_quantity BETWEEN 16 AND 20 AND (ss_list_price BETWEEN 91 AND 101 OR ss_coupon_amt BETWEEN 13493 AND 14493 OR ss_wholesale_cost BETWEEN 36 AND 56) THEN ss_list_price END) AS B4_LP, COUNT(CASE WHEN ss_quantity BETWEEN 16 AND 20 AND (ss_list_price BETWEEN 91 AND 101 OR ss_coupon_amt BETWEEN 13493 AND 14493 OR ss_wholesale_cost BETWEEN 36 AND 56) THEN ss_list_price END) AS B4_CNT, COUNT(DISTINCT CASE WHEN ss_quantity BETWEEN 16 AND 20 AND (ss_list_price BETWEEN 91 AND 101 OR ss_coupon_amt BETWEEN 13493 AND 14493 OR ss_wholesale_cost BETWEEN 36 AND 56) THEN ss_list_price END) AS B4_CNTD, AVG(CASE WHEN ss_quantity BETWEEN 21 AND 25 AND (ss_list_price BETWEEN 0 AND 10 OR ss_coupon_amt BETWEEN 7629 AND 8629 OR ss_wholesale_cost BETWEEN 6 AND 26) THEN ss_list_price END) AS B5_LP, COUNT(CASE WHEN ss_quantity BETWEEN 21 AND 25 AND (ss_list_price BETWEEN 0 AND 10 OR ss_coupon_amt BETWEEN 7629 AND 8629 OR ss_wholesale_cost BETWEEN 6 AND 26) THEN ss_list_price END) AS B5_CNT, COUNT(DISTINCT CASE WHEN ss_quantity BETWEEN 21 AND 25 AND (ss_list_price BETWEEN 0 AND 10 OR ss_coupon_amt BETWEEN 7629 AND 8629 OR ss_wholesale_cost BETWEEN 6 AND 26) THEN ss_list_price END) AS B5_CNTD, AVG(CASE WHEN ss_quantity BETWEEN 26 AND 30 AND (ss_list_price BETWEEN 89 AND 99 OR ss_coupon_amt BETWEEN 15257 AND 16257 OR ss_wholesale_cost BETWEEN 31 AND 51) THEN ss_list_price END) AS B6_LP, COUNT(CASE WHEN ss_quantity BETWEEN 26 AND 30 AND (ss_list_price BETWEEN 89 AND 99 OR ss_coupon_amt BETWEEN 15257 AND 16257 OR ss_wholesale_cost BETWEEN 31 AND 51) THEN ss_list_price END) AS B6_CNT, COUNT(DISTINCT CASE WHEN ss_quantity BETWEEN 26 AND 30 AND (ss_list_price BETWEEN 89 AND 99 OR ss_coupon_amt BETWEEN 15257 AND 16257 OR ss_wholesale_cost BETWEEN 31 AND 51) THEN ss_list_price END) AS B6_CNTD FROM store_sales_scan",
          "interfaces": {
            "outputs": ["B1_LP", "B1_CNT", "B1_CNTD", "B2_LP", "B2_CNT", "B2_CNTD", "B3_LP", "B3_CNT", "B3_CNTD", "B4_LP", "B4_CNT", "B4_CNTD", "B5_LP", "B5_CNT", "B5_CNTD", "B6_LP", "B6_CNT", "B6_CNTD"],
            "consumes": ["store_sales_scan"]
          }
        },
        "main_query": {
          "type": "main_query",
          "change": "modified",
          "sql": "SELECT * FROM conditional_aggregation LIMIT 100",
          "interfaces": {
            "outputs": ["B1_LP", "B1_CNT", "B1_CNTD", "B2_LP", "B2_CNT", "B2_CNTD", "B3_LP", "B3_CNT", "B3_CNTD", "B4_LP", "B4_CNT", "B4_CNTD", "B5_LP", "B5_CNT", "B5_CNTD", "B6_LP", "B6_CNT", "B6_CNTD"],
            "consumes": ["conditional_aggregation"]
          }
        }
      },
      "reconstruction_order": ["store_sales_scan", "conditional_aggregation", "main_query"],
      "assembly_template": "WITH store_sales_scan AS ({store_sales_scan}), conditional_aggregation AS ({conditional_aggregation}) {main_query}"
    }
  ],
  "macros": {},
  "frozen_blocks": [],
  "validation_checks": []
}
```

**Changes**: Replaced six independent store_sales scans with a single CTE filtered to ss_quantity 0-30, then computed all six bucket aggregates in one pass using CASE expressions that preserve the original OR conditions on three columns.

**Expected speedup**: 4-6x (reduces 6 full table scans to 1 scan with lightweight CASE evaluation).