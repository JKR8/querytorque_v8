### Part 1: Modified Logic Tree

```
QUERY: (single statement)
└── [MAIN] main_query  [!]  — Single-pass consolidation with bucket labeling and pivot
    ├── [~] WITH store_sales_scan AS (SELECT ss_quantity, ss_list_price, ss_coupon_amt, ss_wholesale_cost FROM store_sales WHERE ss_quantity BETWEEN 0 AND 30)
    ├── [+] bucket_assignment AS (SELECT CASE ... bucket_id, ss_list_price FROM store_sales_scan WHERE <combined 6-bucket OR>)
    ├── [+] bucket_aggregation AS (SELECT bucket_id, AVG(ss_list_price) avg_price, COUNT(ss_list_price) cnt, COUNT(DISTINCT ss_list_price) cntd FROM bucket_assignment GROUP BY bucket_id)
    └── [+] pivot AS (SELECT MAX(CASE WHEN bucket_id=1 THEN avg_price END) B1_LP, ... FROM bucket_aggregation)
```

### Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "duckdb",
  "rewrite_rules": [
    {"id": "R1", "type": "single_pass_consolidation", "description": "Replace six independent store_sales scans with one scan + bucket labeling + pivot", "applied_to": ["main_query"]}
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "store_sales_scan": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT ss_quantity, ss_list_price, ss_coupon_amt, ss_wholesale_cost FROM store_sales WHERE ss_quantity BETWEEN 0 AND 30",
        "interfaces": {"outputs": ["ss_quantity", "ss_list_price", "ss_coupon_amt", "ss_wholesale_cost"], "consumes": []}
      },
      "bucket_assignment": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT CASE WHEN ss_quantity BETWEEN 0 AND 5 THEN 1 WHEN ss_quantity BETWEEN 6 AND 10 THEN 2 WHEN ss_quantity BETWEEN 11 AND 15 THEN 3 WHEN ss_quantity BETWEEN 16 AND 20 THEN 4 WHEN ss_quantity BETWEEN 21 AND 25 THEN 5 WHEN ss_quantity BETWEEN 26 AND 30 THEN 6 END AS bucket_id, ss_list_price FROM store_sales_scan WHERE (ss_quantity BETWEEN 0 AND 5 AND (ss_list_price BETWEEN 131 AND 141 OR ss_coupon_amt BETWEEN 16798 AND 17798 OR ss_wholesale_cost BETWEEN 25 AND 45)) OR (ss_quantity BETWEEN 6 AND 10 AND (ss_list_price BETWEEN 145 AND 155 OR ss_coupon_amt BETWEEN 14792 AND 15792 OR ss_wholesale_cost BETWEEN 46 AND 66)) OR (ss_quantity BETWEEN 11 AND 15 AND (ss_list_price BETWEEN 150 AND 160 OR ss_coupon_amt BETWEEN 6600 AND 7600 OR ss_wholesale_cost BETWEEN 9 AND 29)) OR (ss_quantity BETWEEN 16 AND 20 AND (ss_list_price BETWEEN 91 AND 101 OR ss_coupon_amt BETWEEN 13493 AND 14493 OR ss_wholesale_cost BETWEEN 36 AND 56)) OR (ss_quantity BETWEEN 21 AND 25 AND (ss_list_price BETWEEN 0 AND 10 OR ss_coupon_amt BETWEEN 7629 AND 8629 OR ss_wholesale_cost BETWEEN 6 AND 26)) OR (ss_quantity BETWEEN 26 AND 30 AND (ss_list_price BETWEEN 89 AND 99 OR ss_coupon_amt BETWEEN 15257 AND 16257 OR ss_wholesale_cost BETWEEN 31 AND 51))",
        "interfaces": {"outputs": ["bucket_id", "ss_list_price"], "consumes": ["store_sales_scan"]}
      },
      "bucket_aggregation": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT bucket_id, AVG(ss_list_price) AS avg_price, COUNT(ss_list_price) AS cnt, COUNT(DISTINCT ss_list_price) AS cntd FROM bucket_assignment GROUP BY bucket_id",
        "interfaces": {"outputs": ["bucket_id", "avg_price", "cnt", "cntd"], "consumes": ["bucket_assignment"]}
      },
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT MAX(CASE WHEN bucket_id = 1 THEN avg_price END) AS B1_LP, MAX(CASE WHEN bucket_id = 1 THEN cnt END) AS B1_CNT, MAX(CASE WHEN bucket_id = 1 THEN cntd END) AS B1_CNTD, MAX(CASE WHEN bucket_id = 2 THEN avg_price END) AS B2_LP, MAX(CASE WHEN bucket_id = 2 THEN cnt END) AS B2_CNT, MAX(CASE WHEN bucket_id = 2 THEN cntd END) AS B2_CNTD, MAX(CASE WHEN bucket_id = 3 THEN avg_price END) AS B3_LP, MAX(CASE WHEN bucket_id = 3 THEN cnt END) AS B3_CNT, MAX(CASE WHEN bucket_id = 3 THEN cntd END) AS B3_CNTD, MAX(CASE WHEN bucket_id = 4 THEN avg_price END) AS B4_LP, MAX(CASE WHEN bucket_id = 4 THEN cnt END) AS B4_CNT, MAX(CASE WHEN bucket_id = 4 THEN cntd END) AS B4_CNTD, MAX(CASE WHEN bucket_id = 5 THEN avg_price END) AS B5_LP, MAX(CASE WHEN bucket_id = 5 THEN cnt END) AS B5_CNT, MAX(CASE WHEN bucket_id = 5 THEN cntd END) AS B5_CNTD, MAX(CASE WHEN bucket_id = 6 THEN avg_price END) AS B6_LP, MAX(CASE WHEN bucket_id = 6 THEN cnt END) AS B6_CNT, MAX(CASE WHEN bucket_id = 6 THEN cntd END) AS B6_CNTD FROM bucket_aggregation LIMIT 100",
        "interfaces": {"outputs": ["B1_LP", "B1_CNT", "B1_CNTD", "B2_LP", "B2_CNT", "B2_CNTD", "B3_LP", "B3_CNT", "B3_CNTD", "B4_LP", "B4_CNT", "B4_CNTD", "B5_LP", "B5_CNT", "B5_CNTD", "B6_LP", "B6_CNT", "B6_CNTD"], "consumes": ["bucket_aggregation"]}
      }
    },
    "reconstruction_order": ["store_sales_scan", "bucket_assignment", "bucket_aggregation", "main_query"],
    "assembly_template": "WITH store_sales_scan AS ({store_sales_scan}), bucket_assignment AS ({bucket_assignment}), bucket_aggregation AS ({bucket_aggregation}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "validation_checks": []
}
```

**Changes**: Structural change from six independent scans to a single scan with bucket labeling, group aggregation, and pivot. This eliminates 5 redundant table scans.

**Expected speedup**: 4-6x (single scan vs. six scans, with early filtering on ss_quantity 0-30 and combined bucket conditions).