WITH store_1999 AS (SELECT c.c_customer_id, c.c_first_name, c.c_last_name, c.c_birth_country, SUM(((ss_ext_list_price - ss_ext_wholesale_cost - ss_ext_discount_amt) + ss_ext_sales_price) / 2) AS year_total FROM customer c JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE d.d_year = 1999 GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, c.c_birth_country), store_2000 AS (SELECT c.c_customer_id, c.c_first_name, c.c_last_name, c.c_birth_country, SUM(((ss_ext_list_price - ss_ext_wholesale_cost - ss_ext_discount_amt) + ss_ext_sales_price) / 2) AS year_total FROM customer c JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE d.d_year = 2000 GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, c.c_birth_country), catalog_1999 AS (SELECT c.c_customer_id, c.c_first_name, c.c_last_name, c.c_birth_country, SUM(((cs_ext_list_price - cs_ext_wholesale_cost - cs_ext_discount_amt) + cs_ext_sales_price) / 2) AS year_total FROM customer c JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk WHERE d.d_year = 1999 GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, c.c_birth_country), catalog_2000 AS (SELECT c.c_customer_id, c.c_first_name, c.c_last_name, c.c_birth_country, SUM(((cs_ext_list_price - cs_ext_wholesale_cost - cs_ext_discount_amt) + cs_ext_sales_price) / 2) AS year_total FROM customer c JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk WHERE d.d_year = 2000 GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, c.c_birth_country), web_1999 AS (SELECT c.c_customer_id, c.c_first_name, c.c_last_name, c.c_birth_country, SUM(((ws_ext_list_price - ws_ext_wholesale_cost - ws_ext_discount_amt) + ws_ext_sales_price) / 2) AS year_total FROM customer c JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk WHERE d.d_year = 1999 GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, c.c_birth_country), web_2000 AS (SELECT c.c_customer_id, c.c_first_name, c.c_last_name, c.c_birth_country, SUM(((ws_ext_list_price - ws_ext_wholesale_cost - ws_ext_discount_amt) + ws_ext_sales_price) / 2) AS year_total FROM customer c JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk WHERE d.d_year = 2000 GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, c.c_birth_country) SELECT s1.c_customer_id AS customer_id, s1.c_first_name AS customer_first_name, s1.c_last_name AS customer_last_name, s1.c_birth_country AS customer_birth_country FROM store_1999 s1 INNER JOIN store_2000 s2 ON s1.c_customer_id = s2.c_customer_id INNER JOIN catalog_1999 c1 ON s1.c_customer_id = c1.c_customer_id INNER JOIN catalog_2000 c2 ON s1.c_customer_id = c2.c_customer_id INNER JOIN web_1999 w1 ON s1.c_customer_id = w1.c_customer_id INNER JOIN web_2000 w2 ON s1.c_customer_id = w2.c_customer_id WHERE s1.year_total > 0 AND c1.year_total > 0 AND w1.year_total > 0 AND (c2.year_total / c1.year_total) > (s2.year_total / s1.year_total) AND (c2.year_total / c1.year_total) > (w2.year_total / w1.year_total) ORDER BY s1.c_customer_id, s1.c_first_name, s1.c_last_name, s1.c_birth_country LIMIT 100