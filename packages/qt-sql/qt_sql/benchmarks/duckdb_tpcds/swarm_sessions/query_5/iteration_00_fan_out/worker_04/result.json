{
  "worker_id": 4,
  "strategy": "compound_strategy_date_isolate_wsr_restructure",
  "examples_used": [
    "single_pass_aggregation",
    "channel_bitmap_aggregation",
    "date_cte_isolate"
  ],
  "optimized_sql": "WITH date_range AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('2000-08-19' AS DATE) AND (CAST('2000-08-19' AS DATE) + INTERVAL 14 DAY)), store_facts AS (SELECT ss_store_sk AS store_sk, ss_sold_date_sk AS date_sk, ss_ext_sales_price AS sales_price, ss_net_profit AS profit, CAST(0 AS DECIMAL(7,2)) AS return_amt, CAST(0 AS DECIMAL(7,2)) AS net_loss FROM store_sales JOIN date_range ON ss_sold_date_sk = d_date_sk UNION ALL SELECT sr_store_sk AS store_sk, sr_returned_date_sk AS date_sk, CAST(0 AS DECIMAL(7,2)) AS sales_price, CAST(0 AS DECIMAL(7,2)) AS profit, sr_return_amt AS return_amt, sr_net_loss AS net_loss FROM store_returns JOIN date_range ON sr_returned_date_sk = d_date_sk), ssr AS (SELECT s_store_id, SUM(sales_price) AS sales, SUM(profit) AS profit, SUM(return_amt) AS \"returns\", SUM(net_loss) AS profit_loss FROM store_facts, store WHERE date_sk IS NOT NULL AND store_sk = s_store_sk GROUP BY s_store_id), catalog_facts AS (SELECT cs_catalog_page_sk AS page_sk, cs_sold_date_sk AS date_sk, cs_ext_sales_price AS sales_price, cs_net_profit AS profit, CAST(0 AS DECIMAL(7,2)) AS return_amt, CAST(0 AS DECIMAL(7,2)) AS net_loss FROM catalog_sales JOIN date_range ON cs_sold_date_sk = d_date_sk UNION ALL SELECT cr_catalog_page_sk AS page_sk, cr_returned_date_sk AS date_sk, CAST(0 AS DECIMAL(7,2)) AS sales_price, CAST(0 AS DECIMAL(7,2)) AS profit, cr_return_amount AS return_amt, cr_net_loss AS net_loss FROM catalog_returns JOIN date_range ON cr_returned_date_sk = d_date_sk), csr AS (SELECT cp_catalog_page_id, SUM(sales_price) AS sales, SUM(profit) AS profit, SUM(return_amt) AS \"returns\", SUM(net_loss) AS profit_loss FROM catalog_facts, catalog_page WHERE date_sk IS NOT NULL AND page_sk = cp_catalog_page_sk GROUP BY cp_catalog_page_id), web_consolidated AS (SELECT ws.ws_web_site_sk, ws.ws_sold_date_sk, ws.ws_ext_sales_price, ws.ws_net_profit, wr.wr_return_amt, wr.wr_net_loss FROM web_sales ws JOIN date_range dr ON ws.ws_sold_date_sk = dr.d_date_sk LEFT OUTER JOIN web_returns wr ON wr.wr_item_sk = ws.ws_item_sk AND wr.wr_order_number = ws.ws_order_number AND wr.wr_returned_date_sk = dr.d_date_sk), wsr AS (SELECT web_site_id, SUM(sales_price) AS sales, SUM(profit) AS profit, SUM(return_amt) AS \"returns\", SUM(net_loss) AS profit_loss FROM (SELECT ws_web_site_sk AS wsr_web_site_sk, ws_sold_date_sk, ws_ext_sales_price AS sales_price, ws_net_profit AS profit, CAST(0 AS DECIMAL(7,2)) AS return_amt, CAST(0 AS DECIMAL(7,2)) AS net_loss FROM web_consolidated UNION ALL SELECT ws_web_site_sk AS wsr_web_site_sk, ws_sold_date_sk, CAST(0 AS DECIMAL(7,2)) AS sales_price, CAST(0 AS DECIMAL(7,2)) AS profit, wr_return_amt AS return_amt, wr_net_loss AS net_loss FROM web_consolidated WHERE wr_return_amt IS NOT NULL) salesreturns, web_site WHERE wsr_web_site_sk = web_site_sk GROUP BY web_site_id) SELECT channel, id, SUM(sales) AS sales, SUM(\"returns\") AS \"returns\", SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || s_store_id AS id, sales, \"returns\", (profit - profit_loss) AS profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || cp_catalog_page_id AS id, sales, \"returns\", (profit - profit_loss) AS profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, \"returns\", (profit - profit_loss) AS profit FROM wsr) x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100",
  "speedup": 1.0,
  "status": "NEUTRAL",
  "transforms": [
    "date_cte_isolate"
  ],
  "hint": "- single_pass_aggregation: Consolidate web_sales and web_returns scans into one ",
  "error_message": null,
  "error_messages": [],
  "error_category": null,
  "exploratory": true
}