{
  "worker_id": 3,
  "strategy": "multi_date_range_cte",
  "examples_used": [
    "multi_date_range_cte",
    "date_cte_isolate",
    "shared_dimension_multi_channel"
  ],
  "optimized_sql": "WITH date_triplet AS (SELECT d1.d_date_sk AS sold_date_sk, d1.d_week_seq, d3.d_date_sk AS ship_date_sk, d2.d_date_sk AS inv_date_sk FROM date_dim d1 CROSS JOIN date_dim d3 LEFT JOIN date_dim d2 ON d2.d_week_seq = d1.d_week_seq WHERE d1.d_year = 2002 AND d3.d_date > d1.d_date + 5), filtered_cs AS (SELECT cs.cs_item_sk, cs.cs_order_number, cs.cs_quantity, cs.cs_promo_sk, dt.inv_date_sk, dt.d_week_seq FROM catalog_sales cs JOIN date_triplet dt ON cs.cs_sold_date_sk = dt.sold_date_sk AND cs.cs_ship_date_sk = dt.ship_date_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk WHERE cd.cd_marital_status = 'W' AND hd.hd_buy_potential = '501-1000'), join_with_inventory AS (SELECT cs.cs_item_sk, cs.cs_order_number, cs.cs_promo_sk, inv.inv_warehouse_sk, cs.d_week_seq FROM filtered_cs cs JOIN inventory inv ON cs.cs_item_sk = inv.inv_item_sk AND inv.inv_date_sk = cs.inv_date_sk AND inv.inv_quantity_on_hand < cs.cs_quantity), dim_joins AS (SELECT i.i_item_desc, w.w_warehouse_name, jwi.d_week_seq, SUM(CASE WHEN p.p_promo_sk IS NULL THEN 1 ELSE 0 END) AS no_promo, SUM(CASE WHEN p.p_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS promo, COUNT(*) AS total_cnt FROM join_with_inventory jwi JOIN item i ON i.i_item_sk = jwi.cs_item_sk JOIN warehouse w ON w.w_warehouse_sk = jwi.inv_warehouse_sk LEFT JOIN promotion p ON p.p_promo_sk = jwi.cs_promo_sk LEFT JOIN catalog_returns cr ON cr.cr_item_sk = jwi.cs_item_sk AND cr.cr_order_number = jwi.cs_order_number GROUP BY i.i_item_desc, w.w_warehouse_name, jwi.d_week_seq) SELECT i_item_desc, w_warehouse_name, d_week_seq, no_promo, promo, total_cnt FROM dim_joins ORDER BY total_cnt DESC, i_item_desc, w_warehouse_name, d_week_seq LIMIT 100",
  "speedup": 1.0,
  "status": "NEUTRAL",
  "transforms": [
    "multi_date_range_cte"
  ],
  "hint": "- multi_date_range_cte: Apply separate CTEs for each date alias but combine into",
  "error_message": null,
  "error_messages": [],
  "error_category": null
}