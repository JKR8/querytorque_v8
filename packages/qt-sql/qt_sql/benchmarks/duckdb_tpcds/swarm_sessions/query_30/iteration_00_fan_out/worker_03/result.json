{
  "worker_id": 3,
  "strategy": "window_function",
  "examples_used": [
    "CORRELATED_SUBQUERY_TO_WINDOW",
    "single_pass_aggregation",
    "pushdown"
  ],
  "optimized_sql": "WITH ctr_with_avg AS (SELECT wr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, SUM(wr_return_amt) AS ctr_total_return, AVG(SUM(wr_return_amt)) OVER (PARTITION BY ca_state) * 1.2 AS threshold FROM web_returns JOIN date_dim ON wr_returned_date_sk = d_date_sk JOIN customer_address ON wr_returning_addr_sk = ca_address_sk WHERE d_year = 2002 GROUP BY wr_returning_customer_sk, ca_state), main_filter AS (SELECT c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date_sk, ctr_total_return FROM ctr_with_avg JOIN customer ON ctr_customer_sk = c_customer_sk JOIN customer_address ON ca_address_sk = c_current_addr_sk WHERE ca_state = 'IN' AND ctr_total_return > threshold) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date_sk, ctr_total_return FROM main_filter ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date_sk, ctr_total_return LIMIT 100",
  "speedup": 1.0,
  "status": "NEUTRAL",
  "transforms": [
    "decorrelate"
  ],
  "hint": "- CORRELATED_SUBQUERY_TO_WINDOW: Replace correlated subquery with window functio",
  "error_message": null,
  "error_messages": [],
  "error_category": null
}