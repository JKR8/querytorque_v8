WITH promotion_email_cte AS (SELECT p_promo_sk FROM promotion WHERE p_channel_email = 'N'), promotion_event_cte AS (SELECT p_promo_sk FROM promotion WHERE p_channel_event = 'N' AND p_channel_email != 'N'), branch1_joined AS (SELECT i.i_item_id, cs.cs_quantity, cs.cs_list_price, cs.cs_coupon_amt, cs.cs_sales_price FROM catalog_sales cs INNER JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk INNER JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk INNER JOIN item i ON cs.cs_item_sk = i.i_item_sk INNER JOIN promotion_email_cte p ON cs.cs_promo_sk = p.p_promo_sk WHERE cd.cd_gender = 'M' AND cd.cd_marital_status = 'S' AND cd.cd_education_status = 'Unknown' AND d.d_year = 2001), branch2_joined AS (SELECT i.i_item_id, cs.cs_quantity, cs.cs_list_price, cs.cs_coupon_amt, cs.cs_sales_price FROM catalog_sales cs INNER JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk INNER JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk INNER JOIN item i ON cs.cs_item_sk = i.i_item_sk INNER JOIN promotion_event_cte p ON cs.cs_promo_sk = p.p_promo_sk WHERE cd.cd_gender = 'M' AND cd.cd_marital_status = 'S' AND cd.cd_education_status = 'Unknown' AND d.d_year = 2001) SELECT i_item_id, AVG(cs_quantity) AS agg1, AVG(cs_list_price) AS agg2, AVG(cs_coupon_amt) AS agg3, AVG(cs_sales_price) AS agg4 FROM (SELECT * FROM branch1_joined UNION ALL SELECT * FROM branch2_joined) t GROUP BY i_item_id ORDER BY i_item_id LIMIT 100