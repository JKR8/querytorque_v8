{
  "worker_id": 1,
  "strategy": "self_join_elimination",
  "examples_used": [
    "SELF_JOIN_TO_WINDOW"
  ],
  "optimized_sql": "WITH v1_lag_lead AS (SELECT i_category, i_brand, cc_name, d_year, d_moy, SUM(cs_sales_price) AS sum_sales, AVG(SUM(cs_sales_price)) OVER (PARTITION BY i_category, i_brand, cc_name, d_year) AS avg_monthly_sales, LAG(SUM(cs_sales_price), 1) OVER (PARTITION BY i_category, i_brand, cc_name ORDER BY d_year, d_moy) AS prev_sum_sales, LEAD(SUM(cs_sales_price), 1) OVER (PARTITION BY i_category, i_brand, cc_name ORDER BY d_year, d_moy) AS next_sum_sales FROM item, catalog_sales, date_dim, call_center WHERE cs_item_sk = i_item_sk AND cs_sold_date_sk = d_date_sk AND cc_call_center_sk = cs_call_center_sk AND (d_year = 1999 OR (d_year = 1998 AND d_moy = 12) OR (d_year = 2000 AND d_moy = 1)) GROUP BY i_category, i_brand, cc_name, d_year, d_moy), v2_simple AS (SELECT i_brand, d_year, avg_monthly_sales, sum_sales, prev_sum_sales AS psum, next_sum_sales AS nsum FROM v1_lag_lead) SELECT * FROM v2_simple WHERE d_year = 1999 AND avg_monthly_sales > 0 AND CASE WHEN avg_monthly_sales > 0 THEN abs(sum_sales - avg_monthly_sales) / avg_monthly_sales ELSE null END > 0.1 ORDER BY sum_sales - avg_monthly_sales ASC, nsum ASC LIMIT 100",
  "speedup": 1.1708568426009855,
  "status": "WIN",
  "transforms": [
    "decorrelate"
  ],
  "hint": "Apply the self-join elimination pattern: replace the three-way self-join with LA",
  "error_message": "INTERFACE: [main_query] declares outputs ['avg_monthly_sales', 'd_year', 'i_brand', 'nsum', 'psum', 'sum_sales'] but SELECT only produces ['*'] | INTERFACE: [main_query] SELECT produces ['*'] not declared in outputs",
  "error_messages": [
    "INTERFACE: [main_query] declares outputs ['avg_monthly_sales', 'd_year', 'i_brand', 'nsum', 'psum', 'sum_sales'] but SELECT only produces ['*']",
    "INTERFACE: [main_query] SELECT produces ['*'] not declared in outputs"
  ],
  "error_category": null
}