{
  "worker_id": 4,
  "strategy": "compound_prefilter_avg_groupby_selfjoin_elim",
  "examples_used": [
    "dimension_cte_isolate",
    "deferred_window_aggregation",
    "self_join_to_window"
  ],
  "optimized_sql": "WITH date_cte AS (SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE (d_year = 1999 OR (d_year = 1998 AND d_moy = 12) OR (d_year = 2000 AND d_moy = 1))), call_center_cte AS (SELECT cc_call_center_sk, cc_name FROM call_center), item_cte AS (SELECT i_item_sk, i_category, i_brand FROM item), filtered_fact AS (SELECT i.i_category, i.i_brand, cc.cc_name, d.d_year, d.d_moy, cs.cs_sales_price FROM catalog_sales cs JOIN date_cte d ON cs.cs_sold_date_sk = d.d_date_sk JOIN call_center_cte cc ON cs.cs_call_center_sk = cc.cc_call_center_sk JOIN item_cte i ON cs.cs_item_sk = i.i_item_sk), monthly_sales AS (SELECT i_category, i_brand, cc_name, d_year, d_moy, SUM(cs_sales_price) AS sum_sales FROM filtered_fact GROUP BY i_category, i_brand, cc_name, d_year, d_moy), yearly_avg AS (SELECT i_category, i_brand, cc_name, d_year, AVG(sum_sales) AS avg_monthly_sales FROM monthly_sales GROUP BY i_category, i_brand, cc_name, d_year), v1_lag_lead AS (SELECT m.i_category, m.i_brand, m.cc_name, m.d_year, m.d_moy, m.sum_sales, y.avg_monthly_sales, LAG(m.sum_sales, 1) OVER (PARTITION BY m.i_category, m.i_brand, m.cc_name ORDER BY m.d_year, m.d_moy) AS prev_sum_sales, LEAD(m.sum_sales, 1) OVER (PARTITION BY m.i_category, m.i_brand, m.cc_name ORDER BY m.d_year, m.d_moy) AS next_sum_sales FROM monthly_sales m JOIN yearly_avg y ON m.i_category = y.i_category AND m.i_brand = y.i_brand AND m.cc_name = y.cc_name AND m.d_year = y.d_year), v2_simple AS (SELECT i_brand, d_year, avg_monthly_sales, sum_sales, prev_sum_sales AS psum, next_sum_sales AS nsum FROM v1_lag_lead) SELECT * FROM v2 WHERE d_year = 1999 AND avg_monthly_sales > 0 AND CASE WHEN avg_monthly_sales > 0 THEN ABS(sum_sales - avg_monthly_sales) / avg_monthly_sales ELSE NULL END > 0.1 ORDER BY sum_sales - avg_monthly_sales, nsum LIMIT 100",
  "speedup": 1.0,
  "status": "NEUTRAL",
  "transforms": [
    "dimension_cte_isolate"
  ],
  "hint": "Combine patterns: pre-filter dimensions, compute yearly average via group-by (in",
  "error_message": null,
  "error_messages": [],
  "error_category": null,
  "exploratory": true
}