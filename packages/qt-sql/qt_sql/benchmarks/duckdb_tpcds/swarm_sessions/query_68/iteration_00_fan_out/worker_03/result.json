{
  "worker_id": 3,
  "strategy": "prefetch_fact_join",
  "examples_used": [
    "prefetch_fact_join",
    "early_filter",
    "dimension_cte_isolate"
  ],
  "optimized_sql": "WITH filtered_dims AS (SELECT date_dim.d_date_sk, store.s_store_sk, household_demographics.hd_demo_sk FROM date_dim, store, household_demographics WHERE date_dim.d_dom BETWEEN 1 AND 2 AND date_dim.d_year IN (1998, 1999, 2000) AND store.s_city IN ('Pleasant Hill', 'Five Points') AND (household_demographics.hd_dep_count = 8 OR household_demographics.hd_vehicle_count = -1)), fact_prejoin AS (SELECT ss_ticket_number, ss_customer_sk, ca_city AS bought_city, ss_ext_sales_price, ss_ext_list_price, ss_ext_tax FROM store_sales JOIN filtered_dims ON store_sales.ss_sold_date_sk = filtered_dims.d_date_sk AND store_sales.ss_store_sk = filtered_dims.s_store_sk AND store_sales.ss_hdemo_sk = filtered_dims.hd_demo_sk JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk), agg AS (SELECT ss_ticket_number, ss_customer_sk, bought_city, SUM(ss_ext_sales_price) AS extended_price, SUM(ss_ext_list_price) AS list_price, SUM(ss_ext_tax) AS extended_tax FROM fact_prejoin GROUP BY ss_ticket_number, ss_customer_sk, bought_city), join_customer AS (SELECT c_last_name, c_first_name, agg.bought_city, agg.ss_ticket_number, agg.extended_price, agg.extended_tax, agg.list_price, c_current_addr_sk FROM agg JOIN customer ON agg.ss_customer_sk = customer.c_customer_sk), join_current_addr AS (SELECT join_customer.c_last_name, join_customer.c_first_name, current_addr.ca_city, join_customer.bought_city, join_customer.ss_ticket_number, join_customer.extended_price, join_customer.extended_tax, join_customer.list_price FROM join_customer JOIN customer_address AS current_addr ON join_customer.c_current_addr_sk = current_addr.ca_address_sk AND current_addr.ca_city <> join_customer.bought_city) SELECT c_last_name, c_first_name, ca_city, bought_city, ss_ticket_number, extended_price, extended_tax, list_price FROM join_current_addr ORDER BY c_last_name ASC, ss_ticket_number ASC LIMIT 100",
  "speedup": 1.0,
  "status": "NEUTRAL",
  "transforms": [
    "prefetch_fact_join"
  ],
  "hint": "- prefetch_fact_join: Apply the CTE chain: filtered_dims CTE then fact_prejoin C",
  "error_message": null,
  "error_messages": [],
  "error_category": null
}