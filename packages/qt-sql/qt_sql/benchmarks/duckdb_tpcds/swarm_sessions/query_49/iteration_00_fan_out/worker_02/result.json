{
  "worker_id": 2,
  "strategy": "shared_dimension_multi_channel",
  "examples_used": [
    "shared_dimension_multi_channel",
    "prefetch_fact_join",
    "multi_dimension_prefetch"
  ],
  "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy = 12), web_sales_filtered AS (SELECT ws.ws_item_sk, ws.ws_order_number, ws.ws_quantity, ws.ws_net_paid FROM web_sales ws INNER JOIN filtered_dates fd ON ws.ws_sold_date_sk = fd.d_date_sk WHERE ws.ws_net_profit > 1 AND ws.ws_net_paid > 0 AND ws.ws_quantity > 0), web_joined_returns AS (SELECT ws.ws_item_sk, COALESCE(wr.wr_return_quantity, 0) AS return_qty, ws.ws_quantity, COALESCE(wr.wr_return_amt, 0) AS return_amt, ws.ws_net_paid FROM web_sales_filtered ws LEFT OUTER JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk AND wr.wr_return_amt > 10000), web_aggregate AS (SELECT ws_item_sk AS item_sk, SUM(return_qty) AS sum_return_qty, SUM(ws_quantity) AS sum_ws_qty, SUM(return_amt) AS sum_return_amt, SUM(ws_net_paid) AS sum_net_paid FROM web_joined_returns GROUP BY ws_item_sk), web_ranked AS (SELECT 'web' AS channel, item_sk AS item, CAST(sum_return_qty AS DECIMAL(15,4)) / CAST(sum_ws_qty AS DECIMAL(15,4)) AS return_ratio, CAST(sum_return_amt AS DECIMAL(15,4)) / CAST(sum_net_paid AS DECIMAL(15,4)) AS currency_ratio, RANK() OVER (ORDER BY CAST(sum_return_qty AS DECIMAL(15,4)) / CAST(sum_ws_qty AS DECIMAL(15,4))) AS return_rank, RANK() OVER (ORDER BY CAST(sum_return_amt AS DECIMAL(15,4)) / CAST(sum_net_paid AS DECIMAL(15,4))) AS currency_rank FROM web_aggregate WHERE sum_ws_qty > 0 AND sum_net_paid > 0), catalog_sales_filtered AS (SELECT cs.cs_item_sk, cs.cs_order_number, cs.cs_quantity, cs.cs_net_paid FROM catalog_sales cs INNER JOIN filtered_dates fd ON cs.cs_sold_date_sk = fd.d_date_sk WHERE cs.cs_net_profit > 1 AND cs.cs_net_paid > 0 AND cs.cs_quantity > 0), catalog_joined_returns AS (SELECT cs.cs_item_sk, COALESCE(cr.cr_return_quantity, 0) AS return_qty, cs.cs_quantity, COALESCE(cr.cr_return_amount, 0) AS return_amt, cs.cs_net_paid FROM catalog_sales_filtered cs LEFT OUTER JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk AND cr.cr_return_amount > 10000), catalog_aggregate AS (SELECT cs_item_sk AS item_sk, SUM(return_qty) AS sum_return_qty, SUM(cs_quantity) AS sum_cs_qty, SUM(return_amt) AS sum_return_amt, SUM(cs_net_paid) AS sum_net_paid FROM catalog_joined_returns GROUP BY cs_item_sk), catalog_ranked AS (SELECT 'catalog' AS channel, item_sk AS item, CAST(sum_return_qty AS DECIMAL(15,4)) / CAST(sum_cs_qty AS DECIMAL(15,4)) AS return_ratio, CAST(sum_return_amt AS DECIMAL(15,4)) / CAST(sum_net_paid AS DECIMAL(15,4)) AS currency_ratio, RANK() OVER (ORDER BY CAST(sum_return_qty AS DECIMAL(15,4)) / CAST(sum_cs_qty AS DECIMAL(15,4))) AS return_rank, RANK() OVER (ORDER BY CAST(sum_return_amt AS DECIMAL(15,4)) / CAST(sum_net_paid AS DECIMAL(15,4))) AS currency_rank FROM catalog_aggregate WHERE sum_cs_qty > 0 AND sum_net_paid > 0), store_sales_filtered AS (SELECT ss.ss_item_sk, ss.ss_ticket_number, ss.ss_quantity, ss.ss_net_paid FROM store_sales ss INNER JOIN filtered_dates fd ON ss.ss_sold_date_sk = fd.d_date_sk WHERE ss.ss_net_profit > 1 AND ss.ss_net_paid > 0 AND ss.ss_quantity > 0), store_joined_returns AS (SELECT ss.ss_item_sk, COALESCE(sr.sr_return_quantity, 0) AS return_qty, ss.ss_quantity, COALESCE(sr.sr_return_amt, 0) AS return_amt, ss.ss_net_paid FROM store_sales_filtered ss LEFT OUTER JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk AND sr.sr_return_amt > 10000), store_aggregate AS (SELECT ss_item_sk AS item_sk, SUM(return_qty) AS sum_return_qty, SUM(ss_quantity) AS sum_ss_qty, SUM(return_amt) AS sum_return_amt, SUM(ss_net_paid) AS sum_net_paid FROM store_joined_returns GROUP BY ss_item_sk), store_ranked AS (SELECT 'store' AS channel, item_sk AS item, CAST(sum_return_qty AS DECIMAL(15,4)) / CAST(sum_ss_qty AS DECIMAL(15,4)) AS return_ratio, CAST(sum_return_amt AS DECIMAL(15,4)) / CAST(sum_net_paid AS DECIMAL(15,4)) AS currency_ratio, RANK() OVER (ORDER BY CAST(sum_return_qty AS DECIMAL(15,4)) / CAST(sum_ss_qty AS DECIMAL(15,4))) AS return_rank, RANK() OVER (ORDER BY CAST(sum_return_amt AS DECIMAL(15,4)) / CAST(sum_net_paid AS DECIMAL(15,4))) AS currency_rank FROM store_aggregate WHERE sum_ss_qty > 0 AND sum_net_paid > 0), union_all AS (SELECT channel, item, return_ratio, return_rank, currency_rank FROM web_ranked WHERE return_rank <= 10 OR currency_rank <= 10 UNION ALL SELECT channel, item, return_ratio, return_rank, currency_rank FROM catalog_ranked WHERE return_rank <= 10 OR currency_rank <= 10 UNION ALL SELECT channel, item, return_ratio, return_rank, currency_rank FROM store_ranked WHERE return_rank <= 10 OR currency_rank <= 10) SELECT channel, item, return_ratio, return_rank, currency_rank FROM union_all ORDER BY 1, 4, 5, 2 LIMIT 100",
  "speedup": 0.0,
  "status": "FAIL",
  "transforms": [
    "prefetch_fact_join"
  ],
  "hint": "- shared_dimension_multi_channel: Apply exactly - extract shared date filter int",
  "error_message": "Row count mismatch: original=41, optimized=100 | Value mismatch: rows differ between original and optimized",
  "error_messages": [
    "Row count mismatch: original=41, optimized=100",
    "Value mismatch: rows differ between original and optimized"
  ],
  "error_category": "semantic"
}