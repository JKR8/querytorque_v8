{
  "worker_id": 3,
  "strategy": "inner_join_conversion",
  "examples_used": [
    "early_filter",
    "prefetch_fact_join",
    "dimension_cte_isolate"
  ],
  "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy = 12), web_inner_join AS (SELECT ws.ws_item_sk, wr.wr_return_quantity, ws.ws_quantity, wr.wr_return_amt, ws.ws_net_paid FROM web_sales ws INNER JOIN filtered_dates fd ON ws.ws_sold_date_sk = fd.d_date_sk INNER JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk WHERE ws.ws_net_profit > 1 AND ws.ws_net_paid > 0 AND ws.ws_quantity > 0 AND wr.wr_return_amt > 10000), web_aggregate AS (SELECT ws_item_sk AS item_sk, SUM(wr_return_quantity) AS sum_return_qty, SUM(ws_quantity) AS sum_ws_qty, SUM(wr_return_amt) AS sum_return_amt, SUM(ws_net_paid) AS sum_net_paid FROM web_inner_join GROUP BY ws_item_sk), web_ranked AS (SELECT item_sk AS item, CAST(sum_return_qty AS DECIMAL(15,4)) / CAST(sum_ws_qty AS DECIMAL(15,4)) AS return_ratio, CAST(sum_return_amt AS DECIMAL(15,4)) / CAST(sum_net_paid AS DECIMAL(15,4)) AS currency_ratio, RANK() OVER (ORDER BY CAST(sum_return_qty AS DECIMAL(15,4)) / CAST(sum_ws_qty AS DECIMAL(15,4))) AS return_rank, RANK() OVER (ORDER BY CAST(sum_return_amt AS DECIMAL(15,4)) / CAST(sum_net_paid AS DECIMAL(15,4))) AS currency_rank FROM web_aggregate), catalog_inner_join AS (SELECT cs.cs_item_sk, cr.cr_return_quantity, cs.cs_quantity, cr.cr_return_amount, cs.cs_net_paid FROM catalog_sales cs INNER JOIN filtered_dates fd ON cs.cs_sold_date_sk = fd.d_date_sk INNER JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk WHERE cs.cs_net_profit > 1 AND cs.cs_net_paid > 0 AND cs.cs_quantity > 0 AND cr.cr_return_amount > 10000), catalog_aggregate AS (SELECT cs_item_sk AS item_sk, SUM(cr_return_quantity) AS sum_return_qty, SUM(cs_quantity) AS sum_cs_qty, SUM(cr_return_amount) AS sum_return_amt, SUM(cs_net_paid) AS sum_net_paid FROM catalog_inner_join GROUP BY cs_item_sk), catalog_ranked AS (SELECT item_sk AS item, CAST(sum_return_qty AS DECIMAL(15,4)) / CAST(sum_cs_qty AS DECIMAL(15,4)) AS return_ratio, CAST(sum_return_amt AS DECIMAL(15,4)) / CAST(sum_net_paid AS DECIMAL(15,4)) AS currency_ratio, RANK() OVER (ORDER BY CAST(sum_return_qty AS DECIMAL(15,4)) / CAST(sum_cs_qty AS DECIMAL(15,4))) AS return_rank, RANK() OVER (ORDER BY CAST(sum_return_amt AS DECIMAL(15,4)) / CAST(sum_net_paid AS DECIMAL(15,4))) AS currency_rank FROM catalog_aggregate), store_inner_join AS (SELECT sts.ss_item_sk, sr.sr_return_quantity, sts.ss_quantity, sr.sr_return_amt, sts.ss_net_paid FROM store_sales sts INNER JOIN filtered_dates fd ON sts.ss_sold_date_sk = fd.d_date_sk INNER JOIN store_returns sr ON sts.ss_ticket_number = sr.sr_ticket_number AND sts.ss_item_sk = sr.sr_item_sk WHERE sts.ss_net_profit > 1 AND sts.ss_net_paid > 0 AND sts.ss_quantity > 0 AND sr.sr_return_amt > 10000), store_aggregate AS (SELECT ss_item_sk AS item_sk, SUM(sr_return_quantity) AS sum_return_qty, SUM(ss_quantity) AS sum_ss_qty, SUM(sr_return_amt) AS sum_return_amt, SUM(ss_net_paid) AS sum_net_paid FROM store_inner_join GROUP BY ss_item_sk), store_ranked AS (SELECT item_sk AS item, CAST(sum_return_qty AS DECIMAL(15,4)) / CAST(sum_ss_qty AS DECIMAL(15,4)) AS return_ratio, CAST(sum_return_amt AS DECIMAL(15,4)) / CAST(sum_net_paid AS DECIMAL(15,4)) AS currency_ratio, RANK() OVER (ORDER BY CAST(sum_return_qty AS DECIMAL(15,4)) / CAST(sum_ss_qty AS DECIMAL(15,4))) AS return_rank, RANK() OVER (ORDER BY CAST(sum_return_amt AS DECIMAL(15,4)) / CAST(sum_net_paid AS DECIMAL(15,4))) AS currency_rank FROM store_aggregate) SELECT channel, item, return_ratio, return_rank, currency_rank FROM (SELECT 'web' AS channel, item, return_ratio, return_rank, currency_rank FROM web_ranked UNION ALL SELECT 'catalog' AS channel, item, return_ratio, return_rank, currency_rank FROM catalog_ranked UNION ALL SELECT 'store' AS channel, item, return_ratio, return_rank, currency_rank FROM store_ranked) AS union_all WHERE return_rank <= 10 OR currency_rank <= 10 ORDER BY 1, 4, 5, 2 LIMIT 100",
  "speedup": 1.0,
  "status": "NEUTRAL",
  "transforms": [
    "dimension_cte_isolate"
  ],
  "hint": "- early_filter: Apply filter dimension first, then join fact tables. Ignore the ",
  "error_message": null,
  "error_messages": [],
  "error_category": null
}