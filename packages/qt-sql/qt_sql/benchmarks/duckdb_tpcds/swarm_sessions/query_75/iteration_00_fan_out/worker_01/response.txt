### Part 1: Modified Logic Tree

```
QUERY: (single statement)
├── [CTE] filtered_item [=]
├── [CTE] sales_detail_1998 [+]
│   ├── SCAN (catalog_sales, filtered_item, date_dim, catalog_returns)
│   ├── JOIN (cs_item_sk=i_item_sk, cs_sold_date_sk=d_date_sk)
│   ├── LEFT JOIN ((cs_order_number, cs_item_sk) = (cr_order_number, cr_item_sk))
│   ├── FILTER (d_year=1998, i_category='Home')
│   └── OUTPUT (d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, sales_cnt, sales_amt)
├── [CTE] sales_detail_1999 [+]
│   ├── SCAN (catalog_sales, filtered_item, date_dim, catalog_returns)
│   ├── JOIN (cs_item_sk=i_item_sk, cs_sold_date_sk=d_date_sk)
│   ├── LEFT JOIN ((cs_order_number, cs_item_sk) = (cr_order_number, cr_item_sk))
│   ├── FILTER (d_year=1999, i_category='Home')
│   └── OUTPUT (d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, sales_cnt, sales_amt)
├── [CTE] all_sales_1998 [+]
│   ├── SCAN (sales_detail_1998 UNION store_sales branch UNION web_sales branch)
│   ├── AGG (GROUP BY d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id)
│   └── OUTPUT (d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, sales_cnt, sales_amt)
├── [CTE] all_sales_1999 [+]
│   ├── SCAN (sales_detail_1999 UNION store_sales branch UNION web_sales branch)
│   ├── AGG (GROUP BY d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id)
│   └── OUTPUT (d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, sales_cnt, sales_amt)
└── [MAIN] main_query [~]
    ├── SCAN (all_sales_1999 AS curr_yr, all_sales_1998 AS prev_yr)
    ├── JOIN (curr_yr.i_brand_id = prev_yr.i_brand_id AND curr_yr.i_class_id = prev_yr.i_class_id AND curr_yr.i_category_id = prev_yr.i_category_id AND curr_yr.i_manufact_id = prev_yr.i_manufact_id)
    ├── FILTER (CAST(curr_yr.sales_cnt AS DECIMAL(17,2))/CAST(prev_yr.sales_cnt AS DECIMAL(17,2))<0.9)
    ├── SORT (sales_cnt_diff ASC, sales_amt_diff ASC)
    └── OUTPUT (prev_year, year, i_brand_id, i_class_id, i_category_id, i_manufact_id, prev_yr_cnt, curr_yr_cnt, sales_cnt_diff, sales_amt_diff)
```

**Change markers:**
- `[+] sales_detail_1998`: New CTE replacing the catalog_sales portion for 1998
- `[+] sales_detail_1999`: New CTE replacing the catalog_sales portion for 1999  
- `[+] all_sales_1998`: New CTE aggregating 1998 sales across all channels
- `[+] all_sales_1999`: New CTE aggregating 1999 sales across all channels
- `[~] main_query`: Modified to use specialized year CTEs instead of generic all_sales
- `[-] all_sales`: Original CTE eliminated (per union_cte_split rule)

### Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "duckdb",
  "rewrite_rules": [
    {"id": "R1", "type": "union_cte_split", "description": "Split generic all_sales CTE into year-specialized CTEs with filters pushed down to channel subqueries", "applied_to": ["all_sales_1998", "all_sales_1999"]}
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "filtered_item": {
        "type": "cte",
        "change": "unchanged",
        "sql": "",
        "interfaces": {"outputs": ["i_item_sk", "i_brand_id", "i_class_id", "i_category_id", "i_manufact_id"], "consumes": []}
      },
      "sales_detail_1998": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, cs_quantity - COALESCE(cr_return_quantity,0) AS sales_cnt, cs_ext_sales_price - COALESCE(cr_return_amount,0.0) AS sales_amt FROM catalog_sales JOIN filtered_item ON cs_item_sk = i_item_sk JOIN date_dim ON cs_sold_date_sk = d_date_sk LEFT JOIN catalog_returns ON (cs_order_number = cr_order_number AND cs_item_sk = cr_item_sk) WHERE d_year = 1998",
        "interfaces": {"outputs": ["d_year", "i_brand_id", "i_class_id", "i_category_id", "i_manufact_id", "sales_cnt", "sales_amt"], "consumes": ["filtered_item"]}
      },
      "sales_detail_1999": {
        "type": "cte", 
        "change": "added",
        "sql": "SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, cs_quantity - COALESCE(cr_return_quantity,0) AS sales_cnt, cs_ext_sales_price - COALESCE(cr_return_amount,0.0) AS sales_amt FROM catalog_sales JOIN filtered_item ON cs_item_sk = i_item_sk JOIN date_dim ON cs_sold_date_sk = d_date_sk LEFT JOIN catalog_returns ON (cs_order_number = cr_order_number AND cs_item_sk = cr_item_sk) WHERE d_year = 1999",
        "interfaces": {"outputs": ["d_year", "i_brand_id", "i_class_id", "i_category_id", "i_manufact_id", "sales_cnt", "sales_amt"], "consumes": ["filtered_item"]}
      },
      "all_sales_1998": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, SUM(sales_cnt) AS sales_cnt, SUM(sales_amt) AS sales_amt FROM (SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, cs_quantity - COALESCE(cr_return_quantity,0) AS sales_cnt, cs_ext_sales_price - COALESCE(cr_return_amount,0.0) AS sales_amt FROM catalog_sales JOIN filtered_item ON cs_item_sk = i_item_sk JOIN date_dim ON cs_sold_date_sk = d_date_sk LEFT JOIN catalog_returns ON (cs_order_number = cr_order_number AND cs_item_sk = cr_item_sk) WHERE i_category = 'Home' AND d_year = 1998 UNION ALL SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, ss_quantity - COALESCE(sr_return_quantity,0) AS sales_cnt, ss_ext_sales_price - COALESCE(sr_return_amt,0.0) AS sales_amt FROM store_sales JOIN filtered_item ON ss_item_sk = i_item_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk LEFT JOIN store_returns ON (ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk) WHERE i_category = 'Home' AND d_year = 1998 UNION ALL SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, ws_quantity - COALESCE(wr_return_quantity,0) AS sales_cnt, ws_ext_sales_price - COALESCE(wr_return_amt,0.0) AS sales_amt FROM web_sales JOIN filtered_item ON ws_item_sk = i_item_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk LEFT JOIN web_returns ON (ws_order_number = wr_order_number AND ws_item_sk = wr_item_sk) WHERE i_category = 'Home' AND d_year = 1998) sales_detail GROUP BY d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id",
        "interfaces": {"outputs": ["d_year", "i_brand_id", "i_class_id", "i_category_id", "i_manufact_id", "sales_cnt", "sales_amt"], "consumes": ["filtered_item"]}
      },
      "all_sales_1999": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, SUM(sales_cnt) AS sales_cnt, SUM(sales_amt) AS sales_amt FROM (SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, cs_quantity - COALESCE(cr_return_quantity,0) AS sales_cnt, cs_ext_sales_price - COALESCE(cr_return_amount,0.0) AS sales_amt FROM catalog_sales JOIN filtered_item ON cs_item_sk = i_item_sk JOIN date_dim ON cs_sold_date_sk = d_date_sk LEFT JOIN catalog_returns ON (cs_order_number = cr_order_number AND cs_item_sk = cr_item_sk) WHERE i_category = 'Home' AND d_year = 1999 UNION ALL SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, ss_quantity - COALESCE(sr_return_quantity,0) AS sales_cnt, ss_ext_sales_price - COALESCE(sr_return_amt,0.0) AS sales_amt FROM store_sales JOIN filtered_item ON ss_item_sk = i_item_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk LEFT JOIN store_returns ON (ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk) WHERE i_category = 'Home' AND d_year = 1999 UNION ALL SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, ws_quantity - COALESCE(wr_return_quantity,0) AS sales_cnt, ws_ext_sales_price - COALESCE(wr_return_amt,0.0) AS sales_amt FROM web_sales JOIN filtered_item ON ws_item_sk = i_item_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk LEFT JOIN web_returns ON (ws_order_number = wr_order_number AND ws_item_sk = wr_item_sk) WHERE i_category = 'Home' AND d_year = 1999) sales_detail GROUP BY d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id",
        "interfaces": {"outputs": ["d_year", "i_brand_id", "i_class_id", "i_category_id", "i_manufact_id", "sales_cnt", "sales_amt"], "consumes": ["filtered_item"]}
      },
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT prev_yr.d_year AS prev_year, curr_yr.d_year AS year, curr_yr.i_brand_id, curr_yr.i_class_id, curr_yr.i_category_id, curr_yr.i_manufact_id, prev_yr.sales_cnt AS prev_yr_cnt, curr_yr.sales_cnt AS curr_yr_cnt, curr_yr.sales_cnt - prev_yr.sales_cnt AS sales_cnt_diff, curr_yr.sales_amt - prev_yr.sales_amt AS sales_amt_diff FROM all_sales_1999 curr_yr JOIN all_sales_1998 prev_yr ON curr_yr.i_brand_id = prev_yr.i_brand_id AND curr_yr.i_class_id = prev_yr.i_class_id AND curr_yr.i_category_id = prev_yr.i_category_id AND curr_yr.i_manufact_id = prev_yr.i_manufact_id WHERE CAST(curr_yr.sales_cnt AS DECIMAL(17,2)) / CAST(prev_yr.sales_cnt AS DECIMAL(17,2)) < 0.9 ORDER BY sales_cnt_diff, sales_amt_diff LIMIT 100",
        "interfaces": {"outputs": ["prev_year", "year", "i_brand_id", "i_class_id", "i_category_id", "i_manufact_id", "prev_yr_cnt", "curr_yr_cnt", "sales_cnt_diff", "sales_amt_diff"], "consumes": ["all_sales_1998", "all_sales_1999"]}
      }
    },
    "reconstruction_order": ["filtered_item", "sales_detail_1998", "sales_detail_1999", "all_sales_1998", "all_sales_1999", "main_query"],
    "assembly_template": "WITH filtered_item AS (SELECT i_item_sk, i_brand_id, i_class_id, i_category_id, i_manufact_id FROM item WHERE i_category = 'Home'), sales_detail_1998 AS ({sales_detail_1998}), sales_detail_1999 AS ({sales_detail_1999}), all_sales_1998 AS ({all_sales_1998}), all_sales_1999 AS ({all_sales_1999}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "validation_checks": []
}
```

**Changes:** Split the generic `all_sales` CTE into year-specialized CTEs (`all_sales_1998`, `all_sales_1999`) with year filters pushed down to each channel subquery, eliminating redundant scans and materialization of mixed-year data. The main query now joins these pre-filtered aggregates directly.

**Expected speedup:** 1.2-1.5x (eliminates scanning and materializing the full cross-year union, reduces predicate evaluation overhead, enables better partition pruning per CTE).