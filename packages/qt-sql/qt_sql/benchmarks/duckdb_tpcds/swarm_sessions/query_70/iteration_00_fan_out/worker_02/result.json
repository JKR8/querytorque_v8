{
  "worker_id": 2,
  "strategy": "rollup_to_union_windowing",
  "examples_used": [
    "rollup_to_union_windowing",
    "union_cte_split"
  ],
  "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1213 AND 1224), filtered_stores AS (SELECT s_store_sk, s_state, s_county FROM store WHERE s_store_sk <= 100), joined_fact AS (SELECT ss_net_profit, s_state, s_county FROM store_sales INNER JOIN filtered_dates ON ss_sold_date_sk = d_date_sk INNER JOIN filtered_stores ON ss_store_sk = s_store_sk), state_county_agg AS (SELECT s_state, s_county, SUM(ss_net_profit) AS state_county_sum FROM joined_fact GROUP BY s_state, s_county), top_states AS (SELECT s_state, SUM(state_county_sum) AS state_sum, RANK() OVER (ORDER BY SUM(state_county_sum) DESC) AS ranking FROM state_county_agg GROUP BY s_state), level0 AS (SELECT SUM(state_county_sum) AS total_sum, state_county_agg.s_state, s_county, 0 AS lochierarchy FROM state_county_agg INNER JOIN top_states ON state_county_agg.s_state = top_states.s_state WHERE top_states.ranking <= 5 GROUP BY state_county_agg.s_state, s_county), level1 AS (SELECT SUM(state_county_sum) AS total_sum, state_county_agg.s_state, NULL AS s_county, 1 AS lochierarchy FROM state_county_agg INNER JOIN top_states ON state_county_agg.s_state = top_states.s_state WHERE top_states.ranking <= 5 GROUP BY state_county_agg.s_state), level2 AS (SELECT SUM(state_county_sum) AS total_sum, NULL AS s_state, NULL AS s_county, 2 AS lochierarchy FROM state_county_agg INNER JOIN top_states ON state_county_agg.s_state = top_states.s_state WHERE top_states.ranking <= 5), union_all AS (SELECT total_sum, s_state, s_county, lochierarchy FROM level0 UNION ALL SELECT total_sum, s_state, s_county, lochierarchy FROM level1 UNION ALL SELECT total_sum, s_state, s_county, lochierarchy FROM level2), windowed AS (SELECT total_sum, s_state, s_county, lochierarchy, RANK() OVER (PARTITION BY lochierarchy, CASE WHEN lochierarchy = 0 THEN s_state END ORDER BY total_sum DESC) AS rank_within_parent FROM union_all) SELECT total_sum, s_state, s_county, lochierarchy, rank_within_parent FROM windowed ORDER BY lochierarchy DESC, CASE WHEN lochierarchy = 0 THEN s_state END, rank_within_parent LIMIT 100",
  "speedup": 2.282330275285873,
  "status": "WIN",
  "transforms": [
    "pushdown"
  ],
  "hint": "rollup_to_union_windowing: Apply explicit UNION ALL of three aggregation levels;",
  "error_message": null,
  "error_messages": [],
  "error_category": null
}