WITH consolidated_scan AS (SELECT ss_item_sk AS item_sk, AVG(ss_net_profit) AS item_avg, AVG(CASE WHEN ss_addr_sk IS NULL THEN ss_net_profit END) AS store_avg_nulls FROM store_sales WHERE ss_store_sk = 146 GROUP BY ss_item_sk), filtered_items AS (SELECT item_sk, item_avg FROM consolidated_scan WHERE item_avg > 0.9 * (SELECT AVG(store_avg_nulls) FROM consolidated_scan WHERE store_avg_nulls IS NOT NULL)), asc_ranks AS (SELECT item_sk, RANK() OVER (ORDER BY item_avg ASC) AS rnk FROM filtered_items), desc_ranks AS (SELECT item_sk, RANK() OVER (ORDER BY item_avg DESC) AS rnk FROM filtered_items) SELECT asc_ranks.rnk, i1.i_product_name AS best_performing, i2.i_product_name AS worst_performing FROM asc_ranks JOIN desc_ranks ON asc_ranks.rnk = desc_ranks.rnk JOIN item i1 ON asc_ranks.item_sk = i1.i_item_sk JOIN item i2 ON desc_ranks.item_sk = i2.i_item_sk WHERE asc_ranks.rnk < 11 AND desc_ranks.rnk < 11 ORDER BY asc_ranks.rnk LIMIT 100