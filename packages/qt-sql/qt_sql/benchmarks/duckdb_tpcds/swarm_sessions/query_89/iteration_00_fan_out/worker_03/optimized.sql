WITH filtered_join AS (SELECT i_category, i_class, i_brand, s_store_name, s_company_name, d_moy, ss_sales_price FROM item INNER JOIN store_sales ON ss_item_sk = i_item_sk INNER JOIN date_dim ON ss_sold_date_sk = d_date_sk INNER JOIN store ON ss_store_sk = s_store_sk WHERE d_year = 1999 AND s_store_sk <= 100 AND ((i_category IN ('Jewelry','Shoes','Electronics') AND i_class IN ('semi-precious','athletic','portable')) OR (i_category IN ('Men','Music','Women') AND i_class IN ('accessories','rock','maternity')))), aggregated_with_avg AS (SELECT i_category, i_class, i_brand, s_store_name, s_company_name, d_moy, SUM(ss_sales_price) AS sum_sales FROM filtered_join GROUP BY i_category, i_class, i_brand, s_store_name, s_company_name, d_moy), partition_avg AS (SELECT i_category, i_brand, s_store_name, s_company_name, AVG(sum_sales) AS avg_monthly_sales FROM aggregated_with_avg GROUP BY i_category, i_brand, s_store_name, s_company_name), joined_avg AS (SELECT a.i_category, a.i_class, a.i_brand, a.s_store_name, a.s_company_name, a.d_moy, a.sum_sales, p.avg_monthly_sales FROM aggregated_with_avg a INNER JOIN partition_avg p ON a.i_category = p.i_category AND a.i_brand = p.i_brand AND a.s_store_name = p.s_store_name AND a.s_company_name = p.s_company_name), filtered AS (SELECT * FROM joined_avg WHERE CASE WHEN avg_monthly_sales <> 0 THEN ABS(sum_sales - avg_monthly_sales) / avg_monthly_sales ELSE NULL END > 0.1) SELECT * FROM filtered ORDER BY (sum_sales - avg_monthly_sales) ASC, s_store_name ASC LIMIT 100