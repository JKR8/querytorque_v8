### Part 1: Modified Logic Tree

```
QUERY: (single statement)
└── [MAIN] main_query  [~]  Cost: 100%  Rows: 100 — Restructured into CTEs for multi-dimension prefetch and OR-to-UNION decomposition
    ├── CTE date_cte  [+]
    ├── CTE store_cte  [+]
    ├── CTE item_filtered1  [+]
    ├── CTE item_filtered2  [+]
    ├── CTE branch1_cte  [+]
    ├── CTE branch2_cte  [+]
    ├── CTE union_cte  [+]
    ├── CTE agg_cte  [+]
    ├── CTE window_cte  [+]
    ├── CTE filter_cte  [+]
    └── CTE top_n  [+]
```

### Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "duckdb",
  "rewrite_rules": [
    {"id": "R1", "type": "multi_dimension_prefetch", "description": "Pre-filter dimension tables (date_dim, store) into CTEs before fact table joins", "applied_to": ["date_cte", "store_cte"]},
    {"id": "R2", "type": "or_to_union", "description": "Split OR condition on item attributes into two UNION ALL branches with separate item filters", "applied_to": ["item_filtered1", "item_filtered2", "branch1_cte", "branch2_cte"]},
    {"id": "R3", "type": "early_filter", "description": "Apply dimension filters first to reduce join probe size", "applied_to": ["date_cte", "store_cte", "item_filtered1", "item_filtered2"]}
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "date_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT d_date_sk, d_qoy FROM date_dim WHERE d_month_seq BETWEEN 1200 AND 1211",
        "interfaces": {"outputs": ["d_date_sk", "d_qoy"], "consumes": []}
      },
      "store_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT s_store_sk FROM store WHERE s_store_sk <= 100",
        "interfaces": {"outputs": ["s_store_sk"], "consumes": []}
      },
      "item_filtered1": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT i_item_sk, i_manufact_id FROM item WHERE i_category IN ('Books','Children','Electronics') AND i_class IN ('personal','portable','reference','self-help') AND i_brand IN ('scholaramalgamalg #14','scholaramalgamalg #7','exportiunivamalg #9','scholaramalgamalg #9')",
        "interfaces": {"outputs": ["i_item_sk", "i_manufact_id"], "consumes": []}
      },
      "item_filtered2": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT i_item_sk, i_manufact_id FROM item WHERE i_category IN ('Women','Music','Men') AND i_class IN ('accessories','classical','fragrances','pants') AND i_brand IN ('amalgimporto #1','edu packscholar #1','exportiimporto #1','importoamalg #1')",
        "interfaces": {"outputs": ["i_item_sk", "i_manufact_id"], "consumes": []}
      },
      "branch1_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT i.i_manufact_id, d.d_qoy, ss.ss_sales_price FROM store_sales ss INNER JOIN date_cte d ON ss.ss_sold_date_sk = d.d_date_sk INNER JOIN store_cte s ON ss.ss_store_sk = s.s_store_sk INNER JOIN item_filtered1 i ON ss.ss_item_sk = i.i_item_sk",
        "interfaces": {"outputs": ["i_manufact_id", "d_qoy", "ss_sales_price"], "consumes": ["date_cte", "store_cte", "item_filtered1"]}
      },
      "branch2_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT i.i_manufact_id, d.d_qoy, ss.ss_sales_price FROM store_sales ss INNER JOIN date_cte d ON ss.ss_sold_date_sk = d.d_date_sk INNER JOIN store_cte s ON ss.ss_store_sk = s.s_store_sk INNER JOIN item_filtered2 i ON ss.ss_item_sk = i.i_item_sk",
        "interfaces": {"outputs": ["i_manufact_id", "d_qoy", "ss_sales_price"], "consumes": ["date_cte", "store_cte", "item_filtered2"]}
      },
      "union_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT * FROM branch1_cte UNION ALL SELECT * FROM branch2_cte",
        "interfaces": {"outputs": ["i_manufact_id", "d_qoy", "ss_sales_price"], "consumes": ["branch1_cte", "branch2_cte"]}
      },
      "agg_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT i_manufact_id, d_qoy, SUM(ss_sales_price) AS sum_sales FROM union_cte GROUP BY i_manufact_id, d_qoy",
        "interfaces": {"outputs": ["i_manufact_id", "d_qoy", "sum_sales"], "consumes": ["union_cte"]}
      },
      "window_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT i_manufact_id, d_qoy, sum_sales, AVG(sum_sales) OVER (PARTITION BY i_manufact_id) AS avg_quarterly_sales FROM agg_cte",
        "interfaces": {"outputs": ["i_manufact_id", "d_qoy", "sum_sales", "avg_quarterly_sales"], "consumes": ["agg_cte"]}
      },
      "filter_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT i_manufact_id, sum_sales, avg_quarterly_sales FROM window_cte WHERE CASE WHEN avg_quarterly_sales > 0 THEN ABS(sum_sales - avg_quarterly_sales) / avg_quarterly_sales ELSE NULL END > 0.1",
        "interfaces": {"outputs": ["i_manufact_id", "sum_sales", "avg_quarterly_sales"], "consumes": ["window_cte"]}
      },
      "top_n": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT i_manufact_id, sum_sales, avg_quarterly_sales FROM filter_cte ORDER BY avg_quarterly_sales ASC, sum_sales ASC, i_manufact_id ASC LIMIT 100",
        "interfaces": {"outputs": ["i_manufact_id", "sum_sales", "avg_quarterly_sales"], "consumes": ["filter_cte"]}
      },
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT * FROM top_n",
        "interfaces": {"outputs": ["i_manufact_id", "sum_sales", "avg_quarterly_sales"], "consumes": ["top_n"]}
      }
    },
    "reconstruction_order": ["date_cte", "store_cte", "item_filtered1", "item_filtered2", "branch1_cte", "branch2_cte", "union_cte", "agg_cte", "window_cte", "filter_cte", "top_n", "main_query"],
    "assembly_template": "WITH date_cte AS ({date_cte}), store_cte AS ({store_cte}), item_filtered1 AS ({item_filtered1}), item_filtered2 AS ({item_filtered2}), branch1_cte AS ({branch1_cte}), branch2_cte AS ({branch2_cte}), union_cte AS ({union_cte}), agg_cte AS ({agg_cte}), window_cte AS ({window_cte}), filter_cte AS ({filter_cte}), top_n AS ({top_n}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "validation_checks": []
}
```

**Changes**: Restructured original query into CTEs: pre-filtered dimension tables (date_dim, store) and split OR condition on item attributes into two UNION ALL branches via separate item filters (item_filtered1, item_filtered2). This enables multi-dimension prefetch (reducing join probe size) and OR-to-UNION decomposition (allowing separate fact table scans with focused predicates).

**Expected speedup**: Moderate (1.5-2.5x) due to reduced dimension table sizes and focused item filters, though double fact table scan may offset gains. The plan trades scan cost for better join selectivity.