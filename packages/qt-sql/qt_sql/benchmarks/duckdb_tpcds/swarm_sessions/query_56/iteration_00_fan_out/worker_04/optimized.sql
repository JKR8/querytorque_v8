WITH filtered_date AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2000 AND d_moy = 2), filtered_customer AS (SELECT ca_address_sk FROM customer_address WHERE ca_gmt_offset = -6), filtered_item AS (SELECT i_item_sk, i_item_id FROM item WHERE i_color IN ('powder', 'green', 'cyan')), ss_agg_by_keys AS (SELECT ss_item_sk, ss_sold_date_sk, ss_addr_sk, SUM(ss_ext_sales_price) AS sales_price FROM store_sales GROUP BY ss_item_sk, ss_sold_date_sk, ss_addr_sk), ss_joined_dims AS (SELECT i_item_id, s.sales_price FROM ss_agg_by_keys s INNER JOIN filtered_date d ON s.ss_sold_date_sk = d.d_date_sk INNER JOIN filtered_customer c ON s.ss_addr_sk = c.ca_address_sk INNER JOIN filtered_item i ON s.ss_item_sk = i.i_item_sk), ss AS (SELECT i_item_id, SUM(sales_price) AS total_sales FROM ss_joined_dims GROUP BY i_item_id), cs_agg_by_keys AS (SELECT cs_item_sk, cs_sold_date_sk, cs_bill_addr_sk, SUM(cs_ext_sales_price) AS sales_price FROM catalog_sales GROUP BY cs_item_sk, cs_sold_date_sk, cs_bill_addr_sk), cs_joined_dims AS (SELECT i_item_id, c.sales_price FROM cs_agg_by_keys c INNER JOIN filtered_date d ON c.cs_sold_date_sk = d.d_date_sk INNER JOIN filtered_customer ca ON c.cs_bill_addr_sk = ca.ca_address_sk INNER JOIN filtered_item i ON c.cs_item_sk = i.i_item_sk), cs AS (SELECT i_item_id, SUM(sales_price) AS total_sales FROM cs_joined_dims GROUP BY i_item_id), ws_agg_by_keys AS (SELECT ws_item_sk, ws_sold_date_sk, ws_bill_addr_sk, SUM(ws_ext_sales_price) AS sales_price FROM web_sales GROUP BY ws_item_sk, ws_sold_date_sk, ws_bill_addr_sk), ws_joined_dims AS (SELECT i_item_id, w.sales_price FROM ws_agg_by_keys w INNER JOIN filtered_date d ON w.ws_sold_date_sk = d.d_date_sk INNER JOIN filtered_customer ca ON w.ws_bill_addr_sk = ca.ca_address_sk INNER JOIN filtered_item i ON w.ws_item_sk = i.i_item_sk), ws AS (SELECT i_item_id, SUM(sales_price) AS total_sales FROM ws_joined_dims GROUP BY i_item_id) SELECT i_item_id, SUM(total_sales) AS total_sales FROM (SELECT * FROM ss UNION ALL SELECT * FROM cs UNION ALL SELECT * FROM ws) AS tmp1 GROUP BY i_item_id ORDER BY total_sales, i_item_id LIMIT 100