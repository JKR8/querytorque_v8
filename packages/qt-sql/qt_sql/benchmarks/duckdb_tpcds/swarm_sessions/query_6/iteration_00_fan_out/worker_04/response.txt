### Part 1: Modified Logic Tree

```
QUERY: (single statement)
├── [~] item_category_avg_cte [ADDED] — Precomputes category averages once
│   └── SCAN (item AS j) → GROUP BY (j.i_category) → AGG (AVG(j.i_current_price))
├── [~] consolidated_core [ADDED] — Consolidated single-pass join with all tables
│   ├── JOIN (store_sales, date_dim, item, item_category_avg_cte, customer, customer_address)
│   ├── FILTER (d.d_month_seq = (SELECT ...)) — Preserve original subquery
│   └── FILTER (i.i_current_price > 1.2 * ia.avg_price)
├── [~] final_agg [ADDED] — Aggregation on consolidated data
│   ├── GROUP BY (ca_state)
│   ├── AGG (COUNT(*) AS cnt)
│   ├── FILTER (cnt >= 10)
│   ├── SORT (cnt, ca_state)
│   └── LIMIT (100)
└── OUTPUT (state, cnt)
```

### Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "duckdb",
  "rewrite_rules": [
    {
      "id": "R1",
      "type": "decorrelation_via_cte",
      "description": "Move correlated category average to standalone CTE for single computation",
      "applied_to": ["item_category_avg_cte"]
    },
    {
      "id": "R2",
      "type": "single_pass_join",
      "description": "Consolidate all tables into one FROM clause while preserving original filter structure",
      "applied_to": ["consolidated_core"]
    }
  ],
  "statements": [
    {
      "target_table": null,
      "change": "modified",
      "components": {
        "item_category_avg_cte": {
          "type": "cte",
          "change": "modified",
          "sql": "SELECT j.i_category, AVG(j.i_current_price) AS avg_price FROM item j GROUP BY j.i_category",
          "interfaces": {
            "outputs": ["i_category", "avg_price"],
            "consumes": []
          }
        },
        "consolidated_core": {
          "type": "cte",
          "change": "modified",
          "sql": "SELECT a.ca_state, i.i_item_sk, s.ss_customer_sk, c.c_current_addr_sk FROM store_sales s INNER JOIN date_dim d ON s.ss_sold_date_sk = d.d_date_sk INNER JOIN item i ON s.ss_item_sk = i.i_item_sk INNER JOIN item_category_avg_cte ia ON i.i_category = ia.i_category INNER JOIN customer c ON s.ss_customer_sk = c.c_customer_sk INNER JOIN customer_address a ON c.c_current_addr_sk = a.ca_address_sk WHERE d.d_month_seq = (SELECT DISTINCT d_month_seq FROM date_dim WHERE d_year = 2002 AND d_moy = 3) AND i.i_current_price > 1.2 * ia.avg_price",
          "interfaces": {
            "outputs": ["ca_state", "i_item_sk", "ss_customer_sk", "c_current_addr_sk"],
            "consumes": ["item_category_avg_cte"]
          }
        },
        "main_query": {
          "type": "main_query",
          "change": "modified",
          "sql": "SELECT ca_state AS state, COUNT(*) AS cnt FROM consolidated_core GROUP BY ca_state HAVING cnt >= 10 ORDER BY cnt, ca_state LIMIT 100",
          "interfaces": {
            "outputs": ["state", "cnt"],
            "consumes": ["consolidated_core"]
          }
        }
      },
      "reconstruction_order": ["item_category_avg_cte", "consolidated_core", "main_query"],
      "assembly_template": "WITH item_category_avg_cte AS ({item_category_avg_cte}), consolidated_core AS ({consolidated_core}) {main_query}"
    }
  ],
  "macros": {},
  "frozen_blocks": [],
  "validation_checks": []
}
```

**Changes**: Decorrelated category average via standalone CTE and consolidated all joins into single FROM clause while preserving the original date subquery structure and price filter.

**Expected speedup**: ~2-4x from eliminating repeated correlated subquery execution and enabling better join order optimization through single-pass consolidation.