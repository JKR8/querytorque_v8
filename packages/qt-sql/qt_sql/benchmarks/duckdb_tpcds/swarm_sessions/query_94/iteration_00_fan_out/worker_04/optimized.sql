WITH filtered_dimensions AS (SELECT d_date_sk, ca_address_sk, web_site_sk FROM date_dim, customer_address, web_site WHERE d_date BETWEEN '2000-2-01' AND (CAST('2000-2-01' AS DATE) + INTERVAL 60 DAY) AND ca_state = 'OK' AND web_company_name = 'pri'), filtered_fact_with_multiwarehouse AS (SELECT ws1.ws_order_number, ws1.ws_ext_ship_cost, ws1.ws_net_profit FROM web_sales ws1 JOIN filtered_dimensions fd ON ws1.ws_ship_date_sk = fd.d_date_sk AND ws1.ws_ship_addr_sk = fd.ca_address_sk AND ws1.ws_web_site_sk = fd.web_site_sk WHERE EXISTS (SELECT 1 FROM web_sales ws2 WHERE ws2.ws_order_number = ws1.ws_order_number AND ws2.ws_warehouse_sk <> ws1.ws_warehouse_sk)), no_returns AS (SELECT ws_order_number, ws_ext_ship_cost, ws_net_profit FROM filtered_fact_with_multiwarehouse f WHERE NOT EXISTS (SELECT 1 FROM web_returns wr WHERE wr.wr_order_number = f.ws_order_number)), aggregate AS (SELECT COUNT(DISTINCT ws_order_number) AS "order count", SUM(ws_ext_ship_cost) AS "total shipping cost", SUM(ws_net_profit) AS "total net profit" FROM no_returns) SELECT "order count", "total shipping cost", "total net profit" FROM aggregate ORDER BY "order count" LIMIT 100