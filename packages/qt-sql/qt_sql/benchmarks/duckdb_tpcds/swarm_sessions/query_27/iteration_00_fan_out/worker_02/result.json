{
  "worker_id": 2,
  "strategy": "rollup_to_union_windowing",
  "examples_used": [
    "rollup_to_union_windowing",
    "union_cte_split"
  ],
  "optimized_sql": "WITH base_joined AS (SELECT i.i_item_id, s.s_state, ss.ss_quantity, ss.ss_list_price, ss.ss_coupon_amt, ss.ss_sales_price FROM store_sales ss INNER JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk INNER JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk INNER JOIN store s ON ss.ss_store_sk = s.s_store_sk INNER JOIN item i ON ss.ss_item_sk = i.i_item_sk WHERE cd.cd_gender = 'F' AND cd.cd_marital_status = 'D' AND cd.cd_education_status = 'Secondary' AND d.d_year = 1999 AND s.s_state IN ('MO','AL','MI','TN','LA','SC')), level2_agg AS (SELECT i_item_id, s_state, 0 AS grouping_level, AVG(ss_quantity) AS agg1, AVG(ss_list_price) AS agg2, AVG(ss_coupon_amt) AS agg3, AVG(ss_sales_price) AS agg4 FROM base_joined GROUP BY i_item_id, s_state), level1_agg AS (SELECT i_item_id, NULL AS s_state, 1 AS grouping_level, AVG(ss_quantity) AS agg1, AVG(ss_list_price) AS agg2, AVG(ss_coupon_amt) AS agg3, AVG(ss_sales_price) AS agg4 FROM base_joined GROUP BY i_item_id), level0_agg AS (SELECT NULL AS i_item_id, NULL AS s_state, 2 AS grouping_level, AVG(ss_quantity) AS agg1, AVG(ss_list_price) AS agg2, AVG(ss_coupon_amt) AS agg3, AVG(ss_sales_price) AS agg4 FROM base_joined), union_all AS (SELECT * FROM level2_agg UNION ALL SELECT * FROM level1_agg UNION ALL SELECT * FROM level0_agg) SELECT i_item_id, s_state, CASE WHEN grouping_level IN (1, 2) THEN 1 ELSE 0 END AS g_state, agg1, agg2, agg3, agg4 FROM union_all ORDER BY i_item_id, s_state LIMIT 100",
  "speedup": 0.8011852438248721,
  "status": "REGRESSION",
  "transforms": [
    "prefetch_fact_join"
  ],
  "hint": "- rollup_to_union_windowing (Q36): Replace GROUP BY ROLLUP with explicit UNION A",
  "error_message": "INTERFACE: [union_all] declares outputs ['agg1', 'agg2', 'agg3', 'agg4', 'grouping_level', 'i_item_id', 's_state'] but SELECT only produces ['*'] | INTERFACE: [union_all] SELECT produces ['*'] not declared in outputs",
  "error_messages": [
    "INTERFACE: [union_all] declares outputs ['agg1', 'agg2', 'agg3', 'agg4', 'grouping_level', 'i_item_id', 's_state'] but SELECT only produces ['*']",
    "INTERFACE: [union_all] SELECT produces ['*'] not declared in outputs"
  ],
  "error_category": null
}