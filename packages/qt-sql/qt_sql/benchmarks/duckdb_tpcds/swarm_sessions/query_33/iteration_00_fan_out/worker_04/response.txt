### Part 1: Modified Logic Tree

```
QUERY: (single statement)
├── [CTE] filtered_dims  [+]  — Pre-filtered dimensions (date, address, item)
│   ├── SCAN (date_dim, customer_address, item)
│   ├── FILTER (date_dim.d_year=2002, date_dim.d_moy=1)
│   ├── FILTER (customer_address.ca_gmt_offset=-5)
│   └── FILTER (item.i_category='Home')
├── [CTE] store_sales_join  [+]  — Join store_sales with filtered_dims
│   ├── SCAN (store_sales)
│   └── JOIN (store_sales with filtered_dims on three keys)
├── [CTE] catalog_sales_join  [+]  — Join catalog_sales with filtered_dims
│   ├── SCAN (catalog_sales)
│   └── JOIN (catalog_sales with filtered_dims on three keys)
├── [CTE] web_sales_join  [+]  — Join web_sales with filtered_dims
│   ├── SCAN (web_sales)
│   └── JOIN (web_sales with filtered_dims on three keys)
├── [CTE] union_all  [+]  — Union of the three joins
│   └── UNION_ALL (store_sales_join, catalog_sales_join, web_sales_join)
└── [MAIN] main_query  [~]  — Aggregate over union_all and order by total_sales
    ├── AGG (GROUP BY i_manufact_id, SUM(sales_price))
    ├── SORT (total_sales ASC)
    └── OUTPUT (i_manufact_id, total_sales)
```

### Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "duckdb",
  "rewrite_rules": [
    {"id": "R1", "type": "dimension_cte_isolate", "description": "Pre-filter date, address, and item into a single CTE to reduce fact table scans", "applied_to": ["filtered_dims"]},
    {"id": "R2", "type": "multi_dimension_prefetch", "description": "Combine all filtered dimension tables into one CTE before fact joins", "applied_to": ["filtered_dims"]},
    {"id": "R3", "type": "defer_aggregation", "description": "Remove per-channel aggregations and perform single aggregation after union", "applied_to": ["store_sales_join", "catalog_sales_join", "web_sales_join", "union_all", "main_query"]}
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "filtered_dims": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT d_date_sk, ca_address_sk, i_item_sk, i_manufact_id FROM date_dim, customer_address, item WHERE date_dim.d_year = 2002 AND date_dim.d_moy = 1 AND customer_address.ca_gmt_offset = -5 AND item.i_category = 'Home'",
        "interfaces": {"outputs": ["d_date_sk", "ca_address_sk", "i_item_sk", "i_manufact_id"], "consumes": []}
      },
      "store_sales_join": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT i_manufact_id, ss_ext_sales_price AS sales_price FROM store_sales INNER JOIN filtered_dims ON store_sales.ss_sold_date_sk = filtered_dims.d_date_sk AND store_sales.ss_addr_sk = filtered_dims.ca_address_sk AND store_sales.ss_item_sk = filtered_dims.i_item_sk",
        "interfaces": {"outputs": ["i_manufact_id", "sales_price"], "consumes": ["filtered_dims"]}
      },
      "catalog_sales_join": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT i_manufact_id, cs_ext_sales_price AS sales_price FROM catalog_sales INNER JOIN filtered_dims ON catalog_sales.cs_sold_date_sk = filtered_dims.d_date_sk AND catalog_sales.cs_bill_addr_sk = filtered_dims.ca_address_sk AND catalog_sales.cs_item_sk = filtered_dims.i_item_sk",
        "interfaces": {"outputs": ["i_manufact_id", "sales_price"], "consumes": ["filtered_dims"]}
      },
      "web_sales_join": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT i_manufact_id, ws_ext_sales_price AS sales_price FROM web_sales INNER JOIN filtered_dims ON web_sales.ws_sold_date_sk = filtered_dims.d_date_sk AND web_sales.ws_bill_addr_sk = filtered_dims.ca_address_sk AND web_sales.ws_item_sk = filtered_dims.i_item_sk",
        "interfaces": {"outputs": ["i_manufact_id", "sales_price"], "consumes": ["filtered_dims"]}
      },
      "union_all": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT * FROM store_sales_join UNION ALL SELECT * FROM catalog_sales_join UNION ALL SELECT * FROM web_sales_join",
        "interfaces": {"outputs": ["i_manufact_id", "sales_price"], "consumes": ["store_sales_join", "catalog_sales_join", "web_sales_join"]}
      },
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT i_manufact_id, SUM(sales_price) AS total_sales FROM union_all GROUP BY i_manufact_id ORDER BY total_sales ASC LIMIT 100",
        "interfaces": {"outputs": ["i_manufact_id", "total_sales"], "consumes": ["union_all"]}
      }
    },
    "reconstruction_order": ["filtered_dims", "store_sales_join", "catalog_sales_join", "web_sales_join", "union_all", "main_query"],
    "assembly_template": "WITH filtered_dims AS ({filtered_dims}), store_sales_join AS ({store_sales_join}), catalog_sales_join AS ({catalog_sales_join}), web_sales_join AS ({web_sales_join}), union_all AS ({union_all}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "validation_checks": []
}
```

**Changes:** Replaced three independent channel CTEs (each with dimension joins) with a single pre-filtered dimension CTE (`filtered_dims`) cross-joining date, address, and item, then joining it with each fact table individually before union and final aggregation. This eliminates redundant dimension scans and pushes filters earlier.

**Expected speedup:** 2–3x (due to eliminating 3x redundant dimension table scans and enabling better predicate pushdown, though cross-join risk exists).