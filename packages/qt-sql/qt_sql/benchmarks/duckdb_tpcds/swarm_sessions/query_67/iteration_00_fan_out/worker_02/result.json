{
  "worker_id": 2,
  "strategy": "rollup_to_union_windowing",
  "examples_used": [
    "rollup_to_union_windowing",
    "single_pass_aggregation"
  ],
  "optimized_sql": "WITH base_agg AS (SELECT i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy, s_store_id, SUM(COALESCE(ss_sales_price * ss_quantity, 0)) AS sumsales FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN store ON ss_store_sk = s_store_sk JOIN item ON ss_item_sk = i_item_sk WHERE d_month_seq BETWEEN 1206 AND 1206+11 AND s_store_sk <= 100 GROUP BY i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy, s_store_id), rollup_union AS (SELECT i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy, s_store_id, sumsales FROM base_agg UNION ALL SELECT i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy, NULL AS s_store_id, SUM(sumsales) FROM base_agg GROUP BY i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy UNION ALL SELECT i_category, i_class, i_brand, i_product_name, d_year, d_qoy, NULL AS d_moy, NULL AS s_store_id, SUM(sumsales) FROM base_agg GROUP BY i_category, i_class, i_brand, i_product_name, d_year, d_qoy UNION ALL SELECT i_category, i_class, i_brand, i_product_name, d_year, NULL AS d_qoy, NULL AS d_moy, NULL AS s_store_id, SUM(sumsales) FROM base_agg GROUP BY i_category, i_class, i_brand, i_product_name, d_year UNION ALL SELECT i_category, i_class, i_brand, i_product_name, NULL AS d_year, NULL AS d_qoy, NULL AS d_moy, NULL AS s_store_id, SUM(sumsales) FROM base_agg GROUP BY i_category, i_class, i_brand, i_product_name UNION ALL SELECT i_category, i_class, i_brand, NULL AS i_product_name, NULL AS d_year, NULL AS d_qoy, NULL AS d_moy, NULL AS s_store_id, SUM(sumsales) FROM base_agg GROUP BY i_category, i_class, i_brand UNION ALL SELECT i_category, i_class, NULL AS i_brand, NULL AS i_product_name, NULL AS d_year, NULL AS d_qoy, NULL AS d_moy, NULL AS s_store_id, SUM(sumsales) FROM base_agg GROUP BY i_category, i_class UNION ALL SELECT i_category, NULL AS i_class, NULL AS i_brand, NULL AS i_product_name, NULL AS d_year, NULL AS d_qoy, NULL AS d_moy, NULL AS s_store_id, SUM(sumsales) FROM base_agg GROUP BY i_category UNION ALL SELECT NULL AS i_category, NULL AS i_class, NULL AS i_brand, NULL AS i_product_name, NULL AS d_year, NULL AS d_qoy, NULL AS d_moy, NULL AS s_store_id, SUM(sumsales) FROM base_agg), window_rank AS (SELECT i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy, s_store_id, sumsales, RANK() OVER (PARTITION BY i_category ORDER BY sumsales DESC) AS rk FROM rollup_union), filter_rank AS (SELECT i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy, s_store_id, sumsales, rk FROM window_rank WHERE rk <= 100) SELECT * FROM filter_rank ORDER BY i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy, s_store_id, sumsales, rk LIMIT 100",
  "speedup": 0.9144157067963515,
  "status": "REGRESSION",
  "transforms": [
    "single_pass_aggregation"
  ],
  "hint": "rollup_to_union_windowing: Replace ROLLUP with explicit UNION ALL of grouping se",
  "error_message": "INTERFACE: [rollup_union] declares outputs ['sumsales'] but SELECT only produces ['d_moy', 'd_qoy', 'd_year', 'i_brand', 'i_category', 'i_class', 'i_product_name', 's_store_id'] | INTERFACE: [main_query] declares outputs ['d_moy', 'd_qoy', 'd_year', 'i_brand', 'i_category', 'i_class', 'i_product_name', 'rk', 's_store_id', 'sumsales'] but SELECT only produces ['*'] | INTERFACE: [main_query] SELECT produces ['*'] not declared in outputs",
  "error_messages": [
    "INTERFACE: [rollup_union] declares outputs ['sumsales'] but SELECT only produces ['d_moy', 'd_qoy', 'd_year', 'i_brand', 'i_category', 'i_class', 'i_product_name', 's_store_id']",
    "INTERFACE: [main_query] declares outputs ['d_moy', 'd_qoy', 'd_year', 'i_brand', 'i_category', 'i_class', 'i_product_name', 'rk', 's_store_id', 'sumsales'] but SELECT only produces ['*']",
    "INTERFACE: [main_query] SELECT produces ['*'] not declared in outputs"
  ],
  "error_category": null
}