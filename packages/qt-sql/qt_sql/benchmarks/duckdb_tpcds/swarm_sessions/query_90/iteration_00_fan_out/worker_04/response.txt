## Modified Logic Tree

```
QUERY: (single statement)
└── [MAIN] main_query  [~]  Cost: 100%  Rows: ~1K  — Single-pass aggregation with conditional counting.
    ├── SCAN (web_sales, household_demographics, time_dim, web_page)  [~]  (Combined scan with OR condition)
    ├── JOIN (ws_sold_time_sk = time_dim.t_time_sk)  [=]
    ├── JOIN (ws_ship_hdemo_sk = household_demographics.hd_demo_sk)  [=]
    ├── JOIN (ws_web_page_sk = web_page.wp_web_page_sk)  [=]
    ├── FILTER (household_demographics.hd_dep_count = 2)  [=]
    ├── FILTER (web_page.wp_char_count BETWEEN 5000 AND 5200)  [=]
    ├── FILTER (time_dim.t_hour BETWEEN 10 AND 11 OR time_dim.t_hour BETWEEN 16 AND 17)  [~]  (Preserved OR)
    ├── AGGREGATE (COUNT(*) FILTER (WHERE time_dim.t_hour BETWEEN 10 AND 11) AS amc,
                    COUNT(*) FILTER (WHERE time_dim.t_hour BETWEEN 16 AND 17) AS pmc)  [+]
    ├── PROJECT (CAST(amc AS DECIMAL(15,4))/CAST(pmc AS DECIMAL(15,4)) AS am_pm_ratio)  [~]
    ├── SORT (am_pm_ratio ASC)  [=]
    └── OUTPUT (am_pm_ratio)  [=]
```

## Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "duckdb",
  "rewrite_rules": [
    {"id": "R1", "type": "single_pass_aggregation", "description": "Consolidated two separate web_sales scans with OR condition into single scan with FILTERed aggregates", "applied_to": ["main_query"]},
    {"id": "R2", "type": "early_filter", "description": "Applied all dimension filters (hd_dep_count, wp_char_count, t_hour ranges) in same FROM clause", "applied_to": ["main_query"]}
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT CAST(amc AS DECIMAL(15,4)) / CAST(pmc AS DECIMAL(15,4)) AS am_pm_ratio FROM (SELECT COUNT(*) FILTER (WHERE time_dim.t_hour BETWEEN 10 AND 11) AS amc, COUNT(*) FILTER (WHERE time_dim.t_hour BETWEEN 16 AND 17) AS pmc FROM web_sales INNER JOIN time_dim ON ws_sold_time_sk = t_time_sk INNER JOIN household_demographics ON ws_ship_hdemo_sk = hd_demo_sk INNER JOIN web_page ON ws_web_page_sk = wp_web_page_sk WHERE household_demographics.hd_dep_count = 2 AND web_page.wp_char_count BETWEEN 5000 AND 5200 AND (time_dim.t_hour BETWEEN 10 AND 11 OR time_dim.t_hour BETWEEN 16 AND 17)) ORDER BY am_pm_ratio LIMIT 100",
        "interfaces": {"outputs": ["am_pm_ratio"], "consumes": []}
      }
    },
    "reconstruction_order": ["main_query"],
    "assembly_template": "{main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "validation_checks": []
}
```

**Changes**: Combined the two separate subqueries into a single scan with conditional aggregation using FILTER clauses, preserving the OR condition on t_hour.  
**Expected speedup**: 1.8-2.0x (eliminates redundant fact table scan while maintaining same join/filter semantics).