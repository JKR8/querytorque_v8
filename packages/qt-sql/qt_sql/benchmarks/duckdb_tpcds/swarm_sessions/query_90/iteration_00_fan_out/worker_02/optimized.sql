WITH dim_time AS (SELECT t_time_sk, t_hour FROM time_dim WHERE t_hour BETWEEN 10 AND 11 OR t_hour BETWEEN 16 AND 17), dim_hd AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_dep_count = 2), dim_wp AS (SELECT wp_web_page_sk FROM web_page WHERE wp_char_count BETWEEN 5000 AND 5200), single_fact_join AS (SELECT ws_sold_time_sk, ws_ship_hdemo_sk, ws_web_page_sk, t_hour FROM web_sales INNER JOIN dim_time ON ws_sold_time_sk = t_time_sk INNER JOIN dim_hd ON ws_ship_hdemo_sk = hd_demo_sk INNER JOIN dim_wp ON ws_web_page_sk = wp_web_page_sk), post_join_aggregate AS (SELECT SUM(CASE WHEN t_hour BETWEEN 10 AND 11 THEN 1 ELSE 0 END) AS amc, SUM(CASE WHEN t_hour BETWEEN 16 AND 17 THEN 1 ELSE 0 END) AS pmc FROM single_fact_join) SELECT CAST(amc AS DECIMAL(15,4)) / CAST(pmc AS DECIMAL(15,4)) AS am_pm_ratio FROM post_join_aggregate ORDER BY am_pm_ratio LIMIT 100