WITH date_filter AS (SELECT d_date_sk, d_qoy, d_year FROM date_dim WHERE d_year = 2000 AND d_qoy IN (1, 2, 3)), store_q1 AS (SELECT ca_county, SUM(ss_ext_sales_price) AS store_sales FROM store_sales JOIN date_filter ON ss_sold_date_sk = date_filter.d_date_sk JOIN customer_address ON ss_addr_sk = ca_address_sk WHERE date_filter.d_qoy = 1 GROUP BY ca_county), store_q2 AS (SELECT ca_county, SUM(ss_ext_sales_price) AS store_sales FROM store_sales JOIN date_filter ON ss_sold_date_sk = date_filter.d_date_sk JOIN customer_address ON ss_addr_sk = ca_address_sk WHERE date_filter.d_qoy = 2 GROUP BY ca_county), store_q3 AS (SELECT ca_county, SUM(ss_ext_sales_price) AS store_sales FROM store_sales JOIN date_filter ON ss_sold_date_sk = date_filter.d_date_sk JOIN customer_address ON ss_addr_sk = ca_address_sk WHERE date_filter.d_qoy = 3 GROUP BY ca_county), web_q1 AS (SELECT ca_county, SUM(ws_ext_sales_price) AS web_sales FROM web_sales JOIN date_filter ON ws_sold_date_sk = date_filter.d_date_sk JOIN customer_address ON ws_bill_addr_sk = ca_address_sk WHERE date_filter.d_qoy = 1 GROUP BY ca_county), web_q2 AS (SELECT ca_county, SUM(ws_ext_sales_price) AS web_sales FROM web_sales JOIN date_filter ON ws_sold_date_sk = date_filter.d_date_sk JOIN customer_address ON ws_bill_addr_sk = ca_address_sk WHERE date_filter.d_qoy = 2 GROUP BY ca_county), web_q3 AS (SELECT ca_county, SUM(ws_ext_sales_price) AS web_sales FROM web_sales JOIN date_filter ON ws_sold_date_sk = date_filter.d_date_sk JOIN customer_address ON ws_bill_addr_sk = ca_address_sk WHERE date_filter.d_qoy = 3 GROUP BY ca_county) SELECT store_q1.ca_county, 2000 AS d_year, web_q2.web_sales / web_q1.web_sales AS web_q1_q2_increase, store_q2.store_sales / store_q1.store_sales AS store_q1_q2_increase, web_q3.web_sales / web_q2.web_sales AS web_q2_q3_increase, store_q3.store_sales / store_q2.store_sales AS store_q2_q3_increase FROM store_q1 JOIN store_q2 ON store_q1.ca_county = store_q2.ca_county JOIN store_q3 ON store_q2.ca_county = store_q3.ca_county JOIN web_q1 ON store_q1.ca_county = web_q1.ca_county JOIN web_q2 ON web_q1.ca_county = web_q2.ca_county JOIN web_q3 ON web_q2.ca_county = web_q3.ca_county WHERE (web_q2.web_sales / NULLIF(web_q1.web_sales, 0)) > (store_q2.store_sales / NULLIF(store_q1.store_sales, 0)) AND (web_q3.web_sales / NULLIF(web_q2.web_sales, 0)) > (store_q3.store_sales / NULLIF(store_q2.store_sales, 0)) ORDER BY web_q1_q2_increase