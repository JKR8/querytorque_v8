WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('2002-01-26' AS DATE) AND (CAST('2002-01-26' AS DATE) + INTERVAL 30 DAY)), filtered_catalog AS (SELECT cs_item_sk, cs_ext_sales_price FROM catalog_sales INNER JOIN filtered_dates ON cs_sold_date_sk = d_date_sk), item_agg AS (SELECT cs_item_sk, SUM(cs_ext_sales_price) AS itemrevenue FROM filtered_catalog GROUP BY cs_item_sk), joined_item AS (SELECT i.i_item_id, i.i_item_desc, i.i_category, i.i_class, i.i_current_price, ia.itemrevenue FROM item_agg ia INNER JOIN item i ON ia.cs_item_sk = i.i_item_sk WHERE i.i_category IN ('Shoes', 'Books', 'Women')), class_agg AS (SELECT i.i_class, SUM(ia.itemrevenue) AS classrevenue FROM item_agg ia INNER JOIN item i ON ia.cs_item_sk = i.i_item_sk WHERE i.i_category IN ('Shoes', 'Books', 'Women') GROUP BY i.i_class) SELECT ji.i_item_id, ji.i_item_desc, ji.i_category, ji.i_class, ji.i_current_price, ji.itemrevenue, ji.itemrevenue * 100 / ca.classrevenue AS revenueratio FROM joined_item ji INNER JOIN class_agg ca ON ji.i_class = ca.i_class ORDER BY ji.i_category, ji.i_class, ji.i_item_id, ji.i_item_desc, revenueratio LIMIT 100