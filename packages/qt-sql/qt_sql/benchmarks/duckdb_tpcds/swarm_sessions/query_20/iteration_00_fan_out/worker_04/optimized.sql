WITH date_cte AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('2002-01-26' AS DATE) AND (CAST('2002-01-26' AS DATE) + INTERVAL 30 DAY)), item_cte AS (SELECT i_item_sk, i_item_id, i_item_desc, i_category, i_class, i_current_price FROM item WHERE i_category IN ('Shoes', 'Books', 'Women')), sales_join AS (SELECT i.i_item_id, i.i_item_desc, i.i_category, i.i_class, i.i_current_price, cs.cs_ext_sales_price FROM catalog_sales cs INNER JOIN date_cte d ON cs.cs_sold_date_sk = d.d_date_sk INNER JOIN item_cte i ON cs.cs_item_sk = i.i_item_sk), aggregated_with_class AS (SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, SUM(cs_ext_sales_price) AS itemrevenue, SUM(SUM(cs_ext_sales_price)) OVER (PARTITION BY i_class) AS classrevenue FROM sales_join GROUP BY i_item_id, i_item_desc, i_category, i_class, i_current_price) SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, itemrevenue, itemrevenue * 100 / classrevenue AS revenueratio FROM aggregated_with_class ORDER BY i_category, i_class, i_item_id, i_item_desc, revenueratio LIMIT 100