WITH cd_branch1 AS (SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE cd_marital_status = 'M' AND cd_education_status = 'Unknown'), cd_branch2 AS (SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree'), branch1_chain AS (SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_manager, cd1.cd_marital_status, cd1.cd_education_status, cr.cr_net_loss FROM cd_branch1 cd1 INNER JOIN customer c ON cd1.cd_demo_sk = c.c_current_cdemo_sk INNER JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk INNER JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_returning_customer_sk INNER JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk INNER JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk WHERE ca.ca_gmt_offset = -6 AND hd.hd_buy_potential LIKE '1001-5000%' AND d.d_year = 2001 AND d.d_moy = 11), branch2_chain AS (SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_manager, cd2.cd_marital_status, cd2.cd_education_status, cr.cr_net_loss FROM cd_branch2 cd2 INNER JOIN customer c ON cd2.cd_demo_sk = c.c_current_cdemo_sk INNER JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk INNER JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_returning_customer_sk INNER JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk INNER JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk WHERE ca.ca_gmt_offset = -6 AND hd.hd_buy_potential LIKE '1001-5000%' AND d.d_year = 2001 AND d.d_moy = 11), union_all AS (SELECT * FROM branch1_chain UNION ALL SELECT * FROM branch2_chain), aggregate AS (SELECT cc_call_center_id AS Call_Center, cc_name AS Call_Center_Name, cc_manager AS Manager, SUM(cr_net_loss) AS Returns_Loss, cd_marital_status, cd_education_status FROM union_all GROUP BY cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status) SELECT Call_Center, Call_Center_Name, Manager, Returns_Loss FROM aggregate ORDER BY Returns_Loss DESC