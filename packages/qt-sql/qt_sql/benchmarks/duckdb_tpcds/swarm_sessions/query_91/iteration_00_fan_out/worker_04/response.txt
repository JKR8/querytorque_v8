### Part 1: Modified Logic Tree

```
QUERY:
└── [MAIN] main_query  [~]  — Now uses CTE chain with UNION ALL decomposition for OR condition and early dimension filtering
    ├── [CTE] date_cte  [+]
    ├── [CTE] addr_cte  [+]
    ├── [CTE] hd_cte  [+]
    ├── [CTE] cd_branch1  [+]
    ├── [CTE] cd_branch2  [+]
    ├── [CTE] branch1_chain  [+]
    ├── [CTE] branch2_chain  [+]
    ├── [CTE] union_all  [+]
    ├── [CTE] aggregate  [+]
    └── OUTPUT (Call_Center, Call_Center_Name, Manager, Returns_Loss)
```

### Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "duckdb",
  "rewrite_rules": [
    {"id": "R1", "type": "or_to_union", "description": "Split OR condition on cd_marital_status/cd_education_status into two branches with UNION ALL", "applied_to": ["cd_branch1", "cd_branch2", "branch1_chain", "branch2_chain", "union_all"]},
    {"id": "R2", "type": "dimension_cte_isolate", "description": "Pre-filter dimension tables into CTEs before joining to fact table", "applied_to": ["date_cte", "addr_cte", "hd_cte"]},
    {"id": "R3", "type": "prefetch_fact_join", "description": "Stage joins: filtered dimensions -> customer -> catalog_returns", "applied_to": ["branch1_chain", "branch2_chain"]}
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "date_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT d_date_sk FROM date_dim WHERE d_year = 2001 AND d_moy = 11",
        "interfaces": {"outputs": ["d_date_sk"], "consumes": []}
      },
      "addr_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT ca_address_sk FROM customer_address WHERE ca_gmt_offset = -6",
        "interfaces": {"outputs": ["ca_address_sk"], "consumes": []}
      },
      "hd_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential LIKE '1001-5000%'",
        "interfaces": {"outputs": ["hd_demo_sk"], "consumes": []}
      },
      "cd_branch1": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE cd_marital_status = 'M' AND cd_education_status = 'Unknown'",
        "interfaces": {"outputs": ["cd_demo_sk", "cd_marital_status", "cd_education_status"], "consumes": []}
      },
      "cd_branch2": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree'",
        "interfaces": {"outputs": ["cd_demo_sk", "cd_marital_status", "cd_education_status"], "consumes": []}
      },
      "branch1_chain": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT cr.cr_call_center_sk, cr.cr_net_loss, b1.cd_marital_status, b1.cd_education_status FROM cd_branch1 b1 JOIN customer c ON b1.cd_demo_sk = c.c_current_cdemo_sk JOIN addr_cte a ON c.c_current_addr_sk = a.ca_address_sk JOIN hd_cte h ON c.c_current_hdemo_sk = h.hd_demo_sk JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_returning_customer_sk JOIN date_cte d ON cr.cr_returned_date_sk = d.d_date_sk",
        "interfaces": {"outputs": ["cr_call_center_sk", "cr_net_loss", "cd_marital_status", "cd_education_status"], "consumes": ["cd_branch1", "addr_cte", "hd_cte", "date_cte"]}
      },
      "branch2_chain": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT cr.cr_call_center_sk, cr.cr_net_loss, b2.cd_marital_status, b2.cd_education_status FROM cd_branch2 b2 JOIN customer c ON b2.cd_demo_sk = c.c_current_cdemo_sk JOIN addr_cte a ON c.c_current_addr_sk = a.ca_address_sk JOIN hd_cte h ON c.c_current_hdemo_sk = h.hd_demo_sk JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_returning_customer_sk JOIN date_cte d ON cr.cr_returned_date_sk = d.d_date_sk",
        "interfaces": {"outputs": ["cr_call_center_sk", "cr_net_loss", "cd_marital_status", "cd_education_status"], "consumes": ["cd_branch2", "addr_cte", "hd_cte", "date_cte"]}
      },
      "union_all": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT cr_call_center_sk, cr_net_loss, cd_marital_status, cd_education_status FROM branch1_chain UNION ALL SELECT cr_call_center_sk, cr_net_loss, cd_marital_status, cd_education_status FROM branch2_chain",
        "interfaces": {"outputs": ["cr_call_center_sk", "cr_net_loss", "cd_marital_status", "cd_education_status"], "consumes": ["branch1_chain", "branch2_chain"]}
      },
      "aggregate": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT cc.cc_call_center_id AS Call_Center, cc.cc_name AS Call_Center_Name, cc.cc_manager AS Manager, SUM(u.cr_net_loss) AS Returns_Loss FROM union_all u JOIN call_center cc ON u.cr_call_center_sk = cc.cc_call_center_sk GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_manager, u.cd_marital_status, u.cd_education_status",
        "interfaces": {"outputs": ["Call_Center", "Call_Center_Name", "Manager", "Returns_Loss"], "consumes": ["union_all"]}
      },
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT * FROM aggregate ORDER BY Returns_Loss DESC",
        "interfaces": {"outputs": ["Call_Center", "Call_Center_Name", "Manager", "Returns_Loss"], "consumes": ["aggregate"]}
      }
    },
    "reconstruction_order": ["date_cte", "addr_cte", "hd_cte", "cd_branch1", "cd_branch2", "branch1_chain", "branch2_chain", "union_all", "aggregate", "main_query"],
    "assembly_template": "WITH date_cte AS ({date_cte}), addr_cte AS ({addr_cte}), hd_cte AS ({hd_cte}), cd_branch1 AS ({cd_branch1}), cd_branch2 AS ({cd_branch2}), branch1_chain AS ({branch1_chain}), branch2_chain AS ({branch2_chain}), union_all AS ({union_all}), aggregate AS ({aggregate}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "validation_checks": []
}
```

**Changes:** The rewrite splits the OR condition on `customer_demographics` into two separate CTE branches (`cd_branch1`, `cd_branch2`) with UNION ALL, pre-filters shared dimension tables into CTEs (`date_cte`, `addr_cte`, `hd_cte`), and stages joins through the customer bridge table to the fact table in each branch.

**Expected speedup:** 2.5-3.5x due to OR decomposition allowing separate filtered scans on `customer_demographics`, early reduction of dimension tables, and staged join pipeline minimizing intermediate result sizes.