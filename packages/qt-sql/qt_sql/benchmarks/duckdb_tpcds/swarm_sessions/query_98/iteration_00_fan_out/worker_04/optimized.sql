WITH filtered_date AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('2002-05-20' AS DATE) AND (CAST('2002-05-20' AS DATE) + INTERVAL 30 DAY)), filtered_sales AS (SELECT ss_item_sk, ss_ext_sales_price FROM store_sales INNER JOIN filtered_date ON store_sales.ss_sold_date_sk = filtered_date.d_date_sk), aggregated_sales AS (SELECT ss_item_sk, SUM(ss_ext_sales_price) AS itemrevenue FROM filtered_sales GROUP BY ss_item_sk), join_item_attrs AS (SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, aggregated_sales.itemrevenue FROM aggregated_sales INNER JOIN item ON aggregated_sales.ss_item_sk = item.i_item_sk WHERE i_category IN ('Sports', 'Music', 'Shoes')), window AS (SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, itemrevenue, itemrevenue * 100.0 / SUM(itemrevenue) OVER (PARTITION BY i_class) AS revenueratio FROM join_item_attrs) SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, itemrevenue, revenueratio FROM window ORDER BY i_category, i_class, i_item_id, i_item_desc, revenueratio