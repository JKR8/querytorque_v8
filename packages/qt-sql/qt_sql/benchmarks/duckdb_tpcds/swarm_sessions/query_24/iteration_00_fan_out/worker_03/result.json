{
  "worker_id": 3,
  "strategy": "star_join_prefetch",
  "examples_used": [
    "prefetch_fact_join",
    "dimension_cte_isolate",
    "multi_dimension_prefetch"
  ],
  "optimized_sql": "WITH filtered_store AS (SELECT s_store_sk, s_store_name, s_state, s_zip FROM store WHERE s_market_id = 8), filtered_customer_addr AS (SELECT c_customer_sk, c_last_name, c_first_name, ca_zip FROM customer JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE c_birth_country <> UPPER(ca_country)), fact_join AS (SELECT ss.ss_net_profit, fca.c_last_name, fca.c_first_name, fs.s_store_name, i.i_color, i.i_current_price, i.i_manager_id, i.i_units, i.i_size, fca.ca_zip, fs.s_state FROM store_sales ss JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN filtered_store fs ON ss.ss_store_sk = fs.s_store_sk JOIN filtered_customer_addr fca ON ss.ss_customer_sk = fca.c_customer_sk AND fs.s_zip = fca.ca_zip JOIN item i ON ss.ss_item_sk = i.i_item_sk), agg_all AS (SELECT c_last_name, c_first_name, s_store_name, ca_state, s_state, i_color, i_current_price, i_manager_id, i_units, i_size, SUM(ss_net_profit) AS netpaid FROM fact_join GROUP BY c_last_name, c_first_name, s_store_name, ca_state, s_state, i_color, i_current_price, i_manager_id, i_units, i_size), threshold_cte AS (SELECT 0.05 * AVG(netpaid) AS threshold FROM agg_all), color_split AS (SELECT c_last_name, c_first_name, s_store_name, i_color, netpaid FROM agg_all WHERE i_color IN ('beige', 'blue')) SELECT c_last_name, c_first_name, s_store_name, SUM(netpaid) AS paid FROM color_split CROSS JOIN threshold_cte WHERE i_color = 'beige' GROUP BY c_last_name, c_first_name, s_store_name, threshold HAVING SUM(netpaid) > threshold ORDER BY c_last_name, c_first_name, s_store_name",
  "speedup": 1.0,
  "status": "NEUTRAL",
  "transforms": [
    "dimension_cte_isolate"
  ],
  "hint": "- prefetch_fact_join: Filter dimensions first, then join with fact\n- dimension_c",
  "error_message": "INTERFACE: [fact_join] declares outputs ['ca_state'] but SELECT only produces ['c_first_name', 'c_last_name', 'ca_zip', 'i_color', 'i_current_price', 'i_manager_id', 'i_size', 'i_units', 's_state', 's_store_name', 'ss_net_profit'] | INTERFACE: [fact_join] SELECT produces ['ca_zip'] not declared in outputs",
  "error_messages": [
    "INTERFACE: [fact_join] declares outputs ['ca_state'] but SELECT only produces ['c_first_name', 'c_last_name', 'ca_zip', 'i_color', 'i_current_price', 'i_manager_id', 'i_size', 'i_units', 's_state', 's_store_name', 'ss_net_profit']",
    "INTERFACE: [fact_join] SELECT produces ['ca_zip'] not declared in outputs"
  ],
  "error_category": null
}