{
  "worker_id": 4,
  "strategy": "scan_consolidation_pivot",
  "examples_used": [
    "single_pass_aggregation",
    "channel_bitmap_aggregation",
    "deferred_window_aggregation"
  ],
  "optimized_sql": "WITH base_scan AS (SELECT ss_net_profit, c_last_name, c_first_name, s_store_name, i_color FROM store_sales JOIN store_returns ON ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk JOIN store ON ss_store_sk = s_store_sk JOIN item ON ss_item_sk = i_item_sk JOIN customer ON ss_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE s_market_id = 8 AND c_birth_country <> UPPER(ca_country) AND s_zip = ca_zip AND i_color IN ('beige', 'blue', 'other')), aggregated_pivot AS (SELECT c_last_name, c_first_name, s_store_name, i_color, SUM(ss_net_profit) AS color_netpaid, 0.05 * FIRST_VALUE(AVG(SUM(ss_net_profit)) OVER ()) OVER () AS threshold FROM base_scan GROUP BY c_last_name, c_first_name, s_store_name, i_color) SELECT c_last_name, c_first_name, s_store_name, SUM(color_netpaid) AS paid FROM aggregated_pivot WHERE i_color = 'beige' GROUP BY c_last_name, c_first_name, s_store_name, threshold HAVING SUM(color_netpaid) > threshold ORDER BY c_last_name, c_first_name, s_store_name",
  "speedup": 1.0,
  "status": "NEUTRAL",
  "transforms": [
    "single_pass_aggregation"
  ],
  "hint": "- single_pass_aggregation: Single scan computing multiple aggregates\n- channel_b",
  "error_message": null,
  "error_messages": [],
  "error_category": null,
  "exploratory": true
}