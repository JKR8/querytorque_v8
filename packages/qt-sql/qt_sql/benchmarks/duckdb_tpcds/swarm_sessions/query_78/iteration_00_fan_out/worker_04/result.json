{
  "worker_id": 4,
  "strategy": "compound_star_join_with_early_aggregate",
  "examples_used": [
    "prefetch_fact_join",
    "multi_dimension_prefetch",
    "deferred_window_aggregation"
  ],
  "optimized_sql": "WITH date_2000 AS (SELECT d_date_sk, d_year FROM date_dim WHERE d_year = 2000), sales_prejoined AS (SELECT d_year, ss_item_sk AS item_sk, ss_customer_sk AS customer_sk, ss_quantity, ss_wholesale_cost, ss_sales_price, ws_quantity, ws_wholesale_cost, ws_sales_price, cs_quantity, cs_wholesale_cost, cs_sales_price FROM store_sales LEFT JOIN store_returns ON sr_ticket_number = ss_ticket_number AND ss_item_sk = sr_item_sk LEFT JOIN web_sales ON ws_sold_date_sk = d_date_sk AND ws_item_sk = ss_item_sk AND ws_bill_customer_sk = ss_customer_sk LEFT JOIN web_returns ON wr_order_number = ws_order_number AND ws_item_sk = wr_item_sk LEFT JOIN catalog_sales ON cs_sold_date_sk = d_date_sk AND cs_item_sk = ss_item_sk AND cs_bill_customer_sk = ss_customer_sk LEFT JOIN catalog_returns ON cr_order_number = cs_order_number AND cs_item_sk = cr_item_sk JOIN date_2000 ON ss_sold_date_sk = d_date_sk WHERE sr_ticket_number IS NULL AND wr_order_number IS NULL AND cr_order_number IS NULL), channel_aggregates AS (SELECT d_year AS sold_year, item_sk, customer_sk, SUM(ss_quantity) AS ss_qty, SUM(ss_wholesale_cost) AS ss_wc, SUM(ss_sales_price) AS ss_sp, SUM(ws_quantity) AS ws_qty, SUM(ws_wholesale_cost) AS ws_wc, SUM(ws_sales_price) AS ws_sp, SUM(cs_quantity) AS cs_qty, SUM(cs_wholesale_cost) AS cs_wc, SUM(cs_sales_price) AS cs_sp FROM sales_prejoined GROUP BY d_year, item_sk, customer_sk) SELECT item_sk AS ss_item_sk, ROUND(ss_qty / (COALESCE(ws_qty, 0) + COALESCE(cs_qty, 0)), 2) AS ratio, ss_qty AS store_qty, ss_wc AS store_wholesale_cost, ss_sp AS store_sales_price, COALESCE(ws_qty, 0) + COALESCE(cs_qty, 0) AS other_chan_qty, COALESCE(ws_wc, 0) + COALESCE(cs_wc, 0) AS other_chan_wholesale_cost, COALESCE(ws_sp, 0) + COALESCE(cs_sp, 0) AS other_chan_sales_price FROM channel_aggregates WHERE (COALESCE(ws_qty, 0) > 0 OR COALESCE(cs_qty, 0) > 0) ORDER BY item_sk ASC, ss_qty DESC, ss_wc DESC, ss_sp DESC, (COALESCE(ws_qty, 0) + COALESCE(cs_qty, 0)) ASC, (COALESCE(ws_wc, 0) + COALESCE(cs_wc, 0)) ASC, (COALESCE(ws_sp, 0) + COALESCE(cs_sp, 0)) ASC, ROUND(ss_qty / (COALESCE(ws_qty, 0) + COALESCE(cs_qty, 0)), 2) ASC LIMIT 100",
  "speedup": 1.0,
  "status": "NEUTRAL",
  "transforms": [
    "prefetch_fact_join"
  ],
  "hint": "- prefetch_fact_join: apply staged join pipeline (date \u2192 fact \u2192 aggregates); ign",
  "error_message": null,
  "error_messages": [],
  "error_category": null,
  "exploratory": true
}