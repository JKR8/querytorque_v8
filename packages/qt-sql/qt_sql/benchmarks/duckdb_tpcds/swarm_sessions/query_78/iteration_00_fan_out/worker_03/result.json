{
  "worker_id": 3,
  "strategy": "self_join_elimination",
  "examples_used": [
    "union_cte_split",
    "early_filter",
    "pushdown"
  ],
  "optimized_sql": "WITH\n  ws_2000 AS (SELECT d_year AS ws_sold_year, ws_item_sk, ws_bill_customer_sk AS ws_customer_sk, SUM(ws_quantity) AS ws_qty, SUM(ws_wholesale_cost) AS ws_wc, SUM(ws_sales_price) AS ws_sp FROM web_sales LEFT JOIN web_returns ON wr_order_number = ws_order_number AND ws_item_sk = wr_item_sk JOIN (SELECT d_date_sk FROM date_dim WHERE d_year = 2000) AS date_2000 ON ws_sold_date_sk = date_2000.d_date_sk WHERE wr_order_number IS NULL GROUP BY d_year, ws_item_sk, ws_bill_customer_sk),\n  cs_2000 AS (SELECT d_year AS cs_sold_year, cs_item_sk, cs_bill_customer_sk AS cs_customer_sk, SUM(cs_quantity) AS cs_qty, SUM(cs_wholesale_cost) AS cs_wc, SUM(cs_sales_price) AS cs_sp FROM catalog_sales LEFT JOIN catalog_returns ON cr_order_number = cs_order_number AND cs_item_sk = cr_item_sk JOIN (SELECT d_date_sk FROM date_dim WHERE d_year = 2000) AS date_2000 ON cs_sold_date_sk = date_2000.d_date_sk WHERE cr_order_number IS NULL GROUP BY d_year, cs_item_sk, cs_bill_customer_sk),\n  ss_2000 AS (SELECT d_year AS ss_sold_year, ss_item_sk, ss_customer_sk, SUM(ss_quantity) AS ss_qty, SUM(ss_wholesale_cost) AS ss_wc, SUM(ss_sales_price) AS ss_sp FROM store_sales LEFT JOIN store_returns ON sr_ticket_number = ss_ticket_number AND ss_item_sk = sr_item_sk JOIN (SELECT d_date_sk FROM date_dim WHERE d_year = 2000) AS date_2000 ON ss_sold_date_sk = date_2000.d_date_sk WHERE sr_ticket_number IS NULL GROUP BY d_year, ss_item_sk, ss_customer_sk)\nSELECT\n  ss_item_sk,\n  ROUND(ss_qty/(COALESCE(ws_qty,0)+COALESCE(cs_qty,0)),2) AS ratio,\n  ss_qty AS store_qty,\n  ss_wc AS store_wholesale_cost,\n  ss_sp AS store_sales_price,\n  COALESCE(ws_qty,0)+COALESCE(cs_qty,0) AS other_chan_qty,\n  COALESCE(ws_wc,0)+COALESCE(cs_wc,0) AS other_chan_wholesale_cost,\n  COALESCE(ws_sp,0)+COALESCE(cs_sp,0) AS other_chan_sales_price\nFROM ss_2000\nLEFT JOIN ws_2000 ON (ws_sold_year = ss_sold_year AND ws_item_sk = ss_item_sk AND ws_customer_sk = ss_customer_sk)\nLEFT JOIN cs_2000 ON (cs_sold_year = ss_sold_year AND cs_item_sk = ss_item_sk AND cs_customer_sk = ss_customer_sk)\nWHERE (COALESCE(ws_qty,0) > 0 OR COALESCE(cs_qty,0) > 0)\nORDER BY\n  ss_item_sk ASC,\n  ss_qty DESC,\n  ss_wc DESC,\n  ss_sp DESC,\n  (COALESCE(ws_qty,0)+COALESCE(cs_qty,0)) ASC,\n  (COALESCE(ws_wc,0)+COALESCE(cs_wc,0)) ASC,\n  (COALESCE(ws_sp,0)+COALESCE(cs_sp,0)) ASC,\n  ROUND(ss_qty/(COALESCE(ws_qty,0)+COALESCE(cs_qty,0)),2) ASC\nLIMIT 100",
  "speedup": 1.0,
  "status": "NEUTRAL",
  "transforms": [
    "union_cte_split"
  ],
  "hint": "- union_cte_split: apply splitting generic CTE by year; ignore UNION structure (",
  "error_message": null,
  "error_messages": [],
  "error_category": null
}