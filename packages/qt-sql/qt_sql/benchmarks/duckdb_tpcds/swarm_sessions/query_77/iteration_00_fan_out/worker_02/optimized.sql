WITH date_range AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN CAST('1998-08-05' AS DATE) AND (CAST('1998-08-05' AS DATE) + INTERVAL 30 DAY)), store_combined AS (SELECT store.s_store_sk, SUM(t.sales_amt) AS sales, SUM(t.return_amt) AS "returns", SUM(t.profit_amt) AS profit, SUM(t.loss_amt) AS profit_loss FROM (SELECT ss_store_sk AS store_sk, ss_ext_sales_price AS sales_amt, ss_net_profit AS profit_amt, 0 AS return_amt, 0 AS loss_amt FROM store_sales, date_range WHERE ss_sold_date_sk = date_range.d_date_sk UNION ALL SELECT sr_store_sk AS store_sk, 0 AS sales_amt, 0 AS profit_amt, sr_return_amt AS return_amt, sr_net_loss AS loss_amt FROM store_returns, date_range WHERE sr_returned_date_sk = date_range.d_date_sk) t, store WHERE t.store_sk = store.s_store_sk AND store.s_store_sk <= 100 GROUP BY store.s_store_sk), cs AS (SELECT cs_call_center_sk, SUM(cs_ext_sales_price) AS sales, SUM(cs_net_profit) AS profit FROM catalog_sales, date_range WHERE cs_sold_date_sk = date_range.d_date_sk GROUP BY cs_call_center_sk), cr AS (SELECT cr_call_center_sk, SUM(cr_return_amount) AS "returns", SUM(cr_net_loss) AS profit_loss FROM catalog_returns, date_range WHERE cr_returned_date_sk = date_range.d_date_sk GROUP BY cr_call_center_sk), web_combined AS (SELECT web_page.wp_web_page_sk, SUM(t.sales_amt) AS sales, SUM(t.return_amt) AS "returns", SUM(t.profit_amt) AS profit, SUM(t.loss_amt) AS profit_loss FROM (SELECT ws_web_page_sk AS page_sk, ws_ext_sales_price AS sales_amt, ws_net_profit AS profit_amt, 0 AS return_amt, 0 AS loss_amt FROM web_sales, date_range WHERE ws_sold_date_sk = date_range.d_date_sk UNION ALL SELECT wr_web_page_sk AS page_sk, 0 AS sales_amt, 0 AS profit_amt, wr_return_amt AS return_amt, wr_net_loss AS loss_amt FROM web_returns, date_range WHERE wr_returned_date_sk = date_range.d_date_sk) t, web_page WHERE t.page_sk = web_page.wp_web_page_sk GROUP BY web_page.wp_web_page_sk) SELECT channel, id, SUM(sales) AS sales, SUM("returns") AS "returns", SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, s_store_sk AS id, sales, "returns", (profit - profit_loss) AS profit FROM store_combined UNION ALL SELECT 'catalog channel' AS channel, cs_call_center_sk AS id, sales, "returns", (profit - profit_loss) AS profit FROM cs, cr UNION ALL SELECT 'web channel' AS channel, wp_web_page_sk AS id, sales, "returns", (profit - profit_loss) AS profit FROM web_combined) x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100