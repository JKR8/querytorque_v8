WITH bucket1_cte AS (SELECT COUNT(*) AS cnt, AVG(ss_ext_sales_price) AS avg_ext, AVG(ss_net_profit) AS avg_net FROM store_sales WHERE ss_quantity BETWEEN 1 AND 20), bucket2_cte AS (SELECT COUNT(*) AS cnt, AVG(ss_ext_sales_price) AS avg_ext, AVG(ss_net_profit) AS avg_net FROM store_sales WHERE ss_quantity BETWEEN 21 AND 40), bucket3_cte AS (SELECT COUNT(*) AS cnt, AVG(ss_ext_sales_price) AS avg_ext, AVG(ss_net_profit) AS avg_net FROM store_sales WHERE ss_quantity BETWEEN 41 AND 60), bucket4_cte AS (SELECT COUNT(*) AS cnt, AVG(ss_ext_sales_price) AS avg_ext, AVG(ss_net_profit) AS avg_net FROM store_sales WHERE ss_quantity BETWEEN 61 AND 80), bucket5_cte AS (SELECT COUNT(*) AS cnt, AVG(ss_ext_sales_price) AS avg_ext, AVG(ss_net_profit) AS avg_net FROM store_sales WHERE ss_quantity BETWEEN 81 AND 100) SELECT CASE WHEN bucket1_cte.cnt > 2972190 THEN bucket1_cte.avg_ext ELSE bucket1_cte.avg_net END AS bucket1, CASE WHEN bucket2_cte.cnt > 4505785 THEN bucket2_cte.avg_ext ELSE bucket2_cte.avg_net END AS bucket2, CASE WHEN bucket3_cte.cnt > 1575726 THEN bucket3_cte.avg_ext ELSE bucket3_cte.avg_net END AS bucket3, CASE WHEN bucket4_cte.cnt > 3188917 THEN bucket4_cte.avg_ext ELSE bucket4_cte.avg_net END AS bucket4, CASE WHEN bucket5_cte.cnt > 3525216 THEN bucket5_cte.avg_ext ELSE bucket5_cte.avg_net END AS bucket5 FROM reason CROSS JOIN bucket1_cte CROSS JOIN bucket2_cte CROSS JOIN bucket3_cte CROSS JOIN bucket4_cte CROSS JOIN bucket5_cte WHERE r_reason_sk = 1