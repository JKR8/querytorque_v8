### Part 1: Modified Logic Tree

```
QUERY: (single statement)
└── [MAIN] main_query [!]
    ├── [CTE] filtered_dates [=]
    ├── [CTE] filtered_stores [=]
    ├── [CTE] zip_intersect_with_storeprefix [~]
    │   ├── [SUBQUERY] zip_static [~] - Push store ZIP prefix filter early by joining with filtered_stores
    │   │   └── JOIN filtered_stores ON substr(ca.ca_zip,1,2) = st.s_zip2
    │   ├── [SUBQUERY] zip_preferred [~] - Push store ZIP prefix filter early by joining with filtered_stores
    │   │   └── JOIN filtered_stores ON substr(ca.ca_zip,1,2) = st.s_zip2
    │   └── INTERSECT (preserved)
    ├── [CTE] prefact [=]
    ├── [CTE] main_agg [=]
    └── [CTE] order_limit [=]
```

**Key changes to `zip_intersect_with_storeprefix`**: 
- Pushed store ZIP prefix filter into both sides of INTERSECT by joining with `filtered_stores` early
- Maintains INTERSECT structure (not converting to EXISTS/materialized CTE)
- Preserves intersection on 5-digit ZIPs (first SELECT column), while using 2-digit prefix for join

### Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "duckdb",
  "rewrite_rules": [
    {
      "id": "R1",
      "type": "early_filter_pushdown",
      "description": "Push store ZIP prefix filter into INTERSECT computation by joining filtered_stores early",
      "applied_to": ["zip_intersect_with_storeprefix"]
    }
  ],
  "statements": [
    {
      "target_table": null,
      "change": "modified",
      "components": {
        "filtered_dates": {
          "type": "cte",
          "change": "unchanged",
          "sql": "",
          "interfaces": {
            "outputs": ["d_date_sk"],
            "consumes": []
          }
        },
        "filtered_stores": {
          "type": "cte",
          "change": "unchanged",
          "sql": "",
          "interfaces": {
            "outputs": ["s_store_sk", "s_store_name", "s_zip", "s_zip2"],
            "consumes": []
          }
        },
        "zip_intersect_with_storeprefix": {
          "type": "cte",
          "change": "modified",
          "sql": "SELECT ca_zip, s_zip2 FROM (\n  SELECT substr(ca.ca_zip,1,5) AS ca_zip, st.s_zip2\n  FROM customer_address ca\n  JOIN filtered_stores st ON substr(ca.ca_zip,1,2) = st.s_zip2\n  WHERE substr(ca.ca_zip,1,5) IN (\n    '47602','16704','35863','28577','83910','36201',\n    '58412','48162','28055','41419','80332',\n    '38607','77817','24891','16226','18410',\n    '21231','59345','13918','51089','20317',\n    '17167','54585','67881','78366','47770',\n    '18360','51717','73108','14440','21800',\n    '89338','45859','65501','34948','25973',\n    '73219','25333','17291','10374','18829',\n    '60736','82620','41351','52094','19326',\n    '25214','54207','40936','21814','79077',\n    '25178','75742','77454','30621','89193',\n    '27369','41232','48567','83041','71948',\n    '37119','68341','14073','16891','62878',\n    '49130','19833','24286','27700','40979',\n    '50412','81504','94835','84844','71954',\n    '39503','57649','18434','24987','12350',\n    '86379','27413','44529','98569','16515',\n    '27287','24255','21094','16005','56436',\n    '91110','68293','56455','54558','10298',\n    '83647','32754','27052','51766','19444',\n    '13869','45645','94791','57631','20712',\n    '37788','41807','46507','21727','71836',\n    '81070','50632','88086','63991','20244',\n    '31655','51782','29818','63792','68605',\n    '94898','36430','57025','20601','82080',\n    '33869','22728','35834','29086','92645',\n    '98584','98072','11652','78093','57553',\n    '43830','71144','53565','18700','90209',\n    '71256','38353','54364','28571','96560',\n    '57839','56355','50679','45266','84680',\n    '34306','34972','48530','30106','15371',\n    '92380','84247','92292','68852','13338',\n    '34594','82602','70073','98069','85066',\n    '47289','11686','98862','26217','47529',\n    '63294','51793','35926','24227','14196',\n    '24594','32489','99060','49472','43432',\n    '49211','14312','88137','47369','56877',\n    '20534','81755','15794','12318','21060',\n    '73134','41255','63073','81003','73873',\n    '66057','51184','51195','45676','92696',\n    '70450','90669','98338','25264','38919',\n    '59226','58581','60298','17895','19489',\n    '52301','80846','95464','68770','51634',\n    '19988','18367','18421','11618','67975',\n    '25494','41352','95430','15734','62585',\n    '97173','33773','10425','75675','53535',\n    '17879','41967','12197','67998','79658',\n    '59130','72592','14851','43933','68101',\n    '50636','25717','71286','24660','58058',\n    '72991','95042','15543','33122','69280',\n    '11912','59386','27642','65177','17672',\n    '33467','64592','36335','54010','18767',\n    '63193','42361','49254','33113','33159',\n    '36479','59080','11855','81963','31016',\n    '49140','29392','41836','32958','53163',\n    '13844','73146','23952','65148','93498',\n    '14530','46131','58454','13376','13378',\n    '83986','12320','17193','59852','46081',\n    '98533','52389','13086','68843','31013',\n    '13261','60560','13443','45533','83583',\n    '11489','58218','19753','22911','25115',\n    '86709','27156','32669','13123','51933',\n    '39214','41331','66943','14155','69998',\n    '49101','70070','35076','14242','73021',\n    '59494','15782','29752','37914','74686',\n    '83086','34473','15751','81084','49230',\n    '91894','60624','17819','28810','63180',\n    '56224','39459','55233','75752','43639',\n    '55349','86057','62361','50788','31830',\n    '58062','18218','85761','60083','45484',\n    '21204','90229','70041','41162','35390',\n    '16364','39500','68908','26689','52868',\n    '81335','40146','11340','61527','61794',\n    '71997','30415','59004','29450','58117',\n    '69952','33562','83833','27385','61860',\n    '96435','48333','23065','32961','84919',\n    '61997','99132','22815','56600','68730',\n    '48017','95694','32919','88217','27116',\n    '28239','58032','18884','16791','21343',\n    '97462','18569','75660','15475'\n  )\n  INTERSECT\n  SELECT substr(ca.ca_zip,1,5) AS ca_zip, st.s_zip2\n  FROM customer_address ca\n  JOIN customer c ON ca.ca_address_sk = c.c_current_addr_sk\n  JOIN filtered_stores st ON substr(ca.ca_zip,1,2) = st.s_zip2\n  WHERE c.c_preferred_cust_flag = 'Y'\n  GROUP BY substr(ca.ca_zip,1,5), st.s_zip2\n  HAVING COUNT(*) > 10\n) AS zip_all",
          "interfaces": {
            "outputs": ["ca_zip", "s_zip2"],
            "consumes": ["filtered_stores"]
          }
        },
        "prefact": {
          "type": "cte",
          "change": "unchanged",
          "sql": "",
          "interfaces": {
            "outputs": ["s_store_name", "ss_net_profit"],
            "consumes": ["filtered_dates", "filtered_stores", "zip_intersect_with_storeprefix"]
          }
        },
        "main_agg": {
          "type": "cte",
          "change": "unchanged",
          "sql": "",
          "interfaces": {
            "outputs": ["s_store_name", "sum_ss_net_profit"],
            "consumes": ["prefact"]
          }
        },
        "order_limit": {
          "type": "cte",
          "change": "unchanged",
          "sql": "",
          "interfaces": {
            "outputs": ["s_store_name", "sum_ss_net_profit"],
            "consumes": ["main_agg"]
          }
        },
        "main_query": {
          "type": "main_query",
          "change": "modified",
          "sql": "WITH filtered_dates AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_qoy = 2 AND d_year = 1998\n),\nfiltered_stores AS (\n  SELECT s_store_sk, s_store_name, s_zip, substr(s_zip,1,2) AS s_zip2\n  FROM store\n),\nzip_intersect_with_storeprefix AS (\n  SELECT ca_zip, s_zip2\n  FROM (\n    SELECT substr(ca.ca_zip,1,5) AS ca_zip, st.s_zip2\n    FROM customer_address ca\n    JOIN filtered_stores st ON substr(ca.ca_zip,1,2) = st.s_zip2\n    WHERE substr(ca.ca_zip,1,5) IN (\n      '47602','16704','35863','28577','83910','36201',\n      '58412','48162','28055','41419','80332',\n      '38607','77817','24891','16226','18410',\n      '21231','59345','13918','51089','20317',\n      '17167','54585','67881','78366','47770',\n      '18360','51717','73108','14440','21800',\n      '89338','45859','65501','34948','25973',\n      '73219','25333','17291','10374','18829',\n      '60736','82620','41351','52094','19326',\n      '25214','54207','40936','21814','79077',\n      '25178','75742','77454','30621','89193',\n      '27369','41232','48567','83041','71948',\n      '37119','68341','14073','16891','62878',\n      '49130','19833','24286','27700','40979',\n      '50412','81504','94835','84844','71954',\n      '39503','57649','18434','24987','12350',\n      '86379','27413','44529','98569','16515',\n      '27287','24255','21094','16005','56436',\n      '91110','68293','56455','54558','10298',\n      '83647','32754','27052','51766','19444',\n      '13869','45645','94791','57631','20712',\n      '37788','41807','46507','21727','71836',\n      '81070','50632','88086','63991','20244',\n      '31655','51782','29818','63792','68605',\n      '94898','36430','57025','20601','82080',\n      '33869','22728','35834','29086','92645',\n      '98584','98072','11652','78093','57553',\n      '43830','71144','53565','18700','90209',\n      '71256','38353','54364','28571','96560',\n      '57839','56355','50679','45266','84680',\n      '34306','34972','48530','30106','15371',\n      '92380','84247','92292','68852','13338',\n      '34594','82602','70073','98069','85066',\n      '47289','11686','98862','26217','47529',\n      '63294','51793','35926','24227','14196',\n      '24594','32489','99060','49472','43432',\n      '49211','14312','88137','47369','56877',\n      '20534','81755','15794','12318','21060',\n      '73134','41255','63073','81003','73873',\n      '66057','51184','51195','45676','92696',\n      '70450','90669','98338','25264','38919',\n      '59226','58581','60298','17895','19489',\n      '52301','80846','95464','68770','51634',\n      '19988','18367','18421','11618','67975',\n      '25494','41352','95430','15734','62585',\n      '97173','33773','10425','75675','53535',\n      '17879','41967','12197','67998','79658',\n      '59130','72592','14851','43933','68101',\n      '50636','25717','71286','24660','58058',\n      '72991','95042','15543','33122','69280',\n      '11912','59386','27642','65177','17672',\n      '33467','64592','36335','54010','18767',\n      '63193','42361','49254','33113','33159',\n      '36479','59080','11855','81963','31016',\n      '49140','29392','41836','32958','53163',\n      '13844','73146','23952','65148','93498',\n      '14530','46131','58454','13376','13378',\n      '83986','12320','17193','59852','46081',\n      '98533','52389','13086','68843','31013',\n      '13261','60560','13443','45533','83583',\n      '11489','58218','19753','22911','25115',\n      '86709','27156','32669','13123','51933',\n      '39214','41331','66943','14155','69998',\n      '49101','70070','35076','14242','73021',\n      '59494','15782','29752','37914','74686',\n      '83086','34473','15751','81084','49230',\n      '91894','60624','17819','28810','63180',\n      '56224','39459','55233','75752','43639',\n      '55349','86057','62361','50788','31830',\n      '58062','18218','85761','60083','45484',\n      '21204','90229','70041','41162','35390',\n      '16364','39500','68908','26689','52868',\n      '81335','40146','11340','61527','61794',\n      '71997','30415','59004','29450','58117',\n      '69952','33562','83833','27385','61860',\n      '96435','48333','23065','32961','84919',\n      '61997','99132','22815','56600','68730',\n      '48017','95694','32919','88217','27116',\n      '28239','58032','18884','16791','21343',\n      '97462','18569','75660','15475'\n    )\n    INTERSECT\n    SELECT substr(ca.ca_zip,1,5) AS ca_zip, st.s_zip2\n    FROM customer_address ca\n    JOIN customer c ON ca.ca_address_sk = c.c_current_addr_sk\n    JOIN filtered_stores st ON substr(ca.ca_zip,1,2) = st.s_zip2\n    WHERE c.c_preferred_cust_flag = 'Y'\n    GROUP BY substr(ca.ca_zip,1,5), st.s_zip2\n    HAVING COUNT(*) > 10\n  ) AS zip_all\n),\nprefact AS (\n  SELECT st.s_store_name, ss.ss_net_profit\n  FROM store_sales ss\n  JOIN filtered_dates dd ON ss.ss_sold_date_sk = dd.d_date_sk\n  JOIN filtered_stores st ON ss.ss_store_sk = st.s_store_sk\n  JOIN zip_intersect_with_storeprefix zip ON st.s_zip2 = zip.s_zip2\n),\nmain_agg AS (\n  SELECT s_store_name, SUM(ss_net_profit) AS sum_ss_net_profit\n  FROM prefact\n  GROUP BY s_store_name\n),\norder_limit AS (\n  SELECT s_store_name, sum_ss_net_profit\n  FROM main_agg\n  ORDER BY s_store_name ASC\n  LIMIT 100\n)\nSELECT s_store_name, sum_ss_net_profit\nFROM order_limit",
          "interfaces": {
            "outputs": ["s_store_name", "sum_ss_net_profit"],
            "consumes": []
          }
        }
      },
      "reconstruction_order": [
        "filtered_dates",
        "filtered_stores",
        "zip_intersect_with_storeprefix",
        "prefact",
        "main_agg",
        "order_limit",
        "main_query"
      ],
      "assembly_template": "WITH {filtered_dates} AS ({filtered_dates.sql}),\n{filtered_stores} AS ({filtered_stores.sql}),\n{zip_intersect_with_storeprefix} AS ({zip_intersect_with_storeprefix.sql}),\n{prefact} AS ({prefact.sql}),\n{main_agg} AS ({main_agg.sql}),\n{order_limit} AS ({order_limit.sql})\n{main_query.sql}"
    }
  ],
  "macros": {},
  "frozen_blocks": [],
  "validation_checks": []
}
```

**Changes**: Pushed store ZIP prefix filter into both sides of INTERSECT by joining with `filtered_stores` early, while maintaining the INTERSECT structure on 5-digit ZIPs. This reduces the intermediate result size before the INTERSECT operation.

**Expected speedup**: ~2-4x by eliminating many non-matching ZIP prefixes early in both scans of customer_address, reducing INTERSECT computation and downstream joins.