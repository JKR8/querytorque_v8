```json
[
  {
    "plan_id": "compile_p1",
    "dialect": "snowflake",
    "confidence": 0.72,
    "based_on": "p01,p04",
    "strategy": "Predicate pushdown via filtered CTEs and explicit INNER JOIN syntax.",
    "hypothesis": "Probes p01 and p04 were safe but neutral. Combining filtered CTEs (p01) with explicit INNER JOINs (p04) may improve predicate pushdown and join clarity. The original plan shows full fact‑table scans; filtering early with date_dim CTEs enables micro‑partition pruning.",
    "expected_explain_delta": "Fact‑table scans should have early date_sk filters, reducing scanned bytes and partition counts.",
    "target_ir": "Replace base fact‑table scans with filtered CTEs; convert comma joins to explicit INNER JOINs.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["filtered_store_sales", "filtered_store_returns", "filtered_catalog_sales", "store", "item"],
          "outputs": ["i_item_id", "i_item_desc", "s_store_id", "s_store_name", "store_sales_profit", "store_returns_loss", "catalog_sales_profit"],
          "changed": true,
          "sql": "SELECT i_item_id, i_item_desc, s_store_id, s_store_name, stddev_samp(ss_net_profit) AS store_sales_profit, stddev_samp(sr_net_loss) AS store_returns_loss, stddev_samp(cs_net_profit) AS catalog_sales_profit FROM filtered_store_sales ss INNER JOIN filtered_store_returns sr ON ss.ss_customer_sk = sr.sr_customer_sk AND ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number INNER JOIN filtered_catalog_sales cs ON sr.sr_customer_sk = cs.cs_bill_customer_sk AND sr.sr_item_sk = cs.cs_item_sk INNER JOIN store s ON s.s_store_sk = ss.ss_store_sk INNER JOIN item i ON i.i_item_sk = ss.ss_item_sk GROUP BY i_item_id, i_item_desc, s_store_id, s_store_name ORDER BY i_item_id, i_item_desc, s_store_id, s_store_name LIMIT 100"
        },
        {
          "node_id": "filtered_store_sales",
          "parent_node_id": "final_select",
          "sources": ["store_sales", "date_dim"],
          "outputs": ["ss_sold_date_sk", "ss_item_sk", "ss_customer_sk", "ss_store_sk", "ss_ticket_number", "ss_net_profit"],
          "changed": true,
          "sql": "SELECT ss_sold_date_sk, ss_item_sk, ss_customer_sk, ss_store_sk, ss_ticket_number, ss_net_profit FROM store_sales INNER JOIN date_dim d1 ON d1.d_date_sk = ss_sold_date_sk WHERE d1.d_moy = 2 AND d1.d_year = 2000"
        },
        {
          "node_id": "filtered_store_returns",
          "parent_node_id": "final_select",
          "sources": ["store_returns", "date_dim"],
          "outputs": ["sr_returned_date_sk", "sr_item_sk", "sr_customer_sk", "sr_ticket_number", "sr_net_loss"],
          "changed": true,
          "sql": "SELECT sr_returned_date_sk, sr_item_sk, sr_customer_sk, sr_ticket_number, sr_net_loss FROM store_returns INNER JOIN date_dim d2 ON d2.d_date_sk = sr_returned_date_sk WHERE d2.d_moy BETWEEN 2 AND 4 AND d2.d_year = 2000"
        },
        {
          "node_id": "filtered_catalog_sales",
          "parent_node_id": "final_select",
          "sources": ["catalog_sales", "date_dim"],
          "outputs": ["cs_sold_date_sk", "cs_bill_customer_sk", "cs_item_sk", "cs_net_profit"],
          "changed": true,
          "sql": "SELECT cs_sold_date_sk, cs_bill_customer_sk, cs_item_sk, cs_net_profit FROM catalog_sales INNER JOIN date_dim d3 ON d3.d_date_sk = cs_sold_date_sk WHERE d3.d_moy BETWEEN 2 AND 4 AND d3.d_year = 2000"
        }
      ]
    }
  },
  {
    "plan_id": "compile_p2",
    "dialect": "snowflake",
    "confidence": 0.65,
    "based_on": "p02",
    "strategy": "Safe aggregate pushdown preserving STDDEV_SAMP semantics.",
    "hypothesis": "Probe p02 attempted pre‑aggregation but incorrectly used SUM. This version preserves original rows by pre‑grouping only by join keys (no aggregation), reducing rows before the final join while keeping exact STDDEV_SAMP inputs.",
    "expected_explain_delta": "Reduced rows flowing into join tree; fact‑table scans remain unfiltered (no date pushdown).",
    "target_ir": "Replace fact‑table scans with pre‑grouped CTEs that keep all rows needed for later aggregation.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["grouped_store_sales", "grouped_store_returns", "grouped_catalog_sales", "store", "item", "date_dim d1", "date_dim d2", "date_dim d3"],
          "outputs": ["i_item_id", "i_item_desc", "s_store_id", "s_store_name", "store_sales_profit", "store_returns_loss", "catalog_sales_profit"],
          "changed": true,
          "sql": "SELECT i_item_id, i_item_desc, s_store_id, s_store_name, stddev_samp(ss_net_profit) AS store_sales_profit, stddev_samp(sr_net_loss) AS store_returns_loss, stddev_samp(cs_net_profit) AS catalog_sales_profit FROM grouped_store_sales ss INNER JOIN grouped_store_returns sr ON ss.ss_customer_sk = sr.sr_customer_sk AND ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number INNER JOIN grouped_catalog_sales cs ON sr.sr_customer_sk = cs.cs_bill_customer_sk AND sr.sr_item_sk = cs.cs_item_sk INNER JOIN date_dim d1 ON d1.d_date_sk = ss.ss_sold_date_sk INNER JOIN date_dim d2 ON d2.d_date_sk = sr.sr_returned_date_sk INNER JOIN date_dim d3 ON d3.d_date_sk = cs.cs_sold_date_sk INNER JOIN store s ON s.s_store_sk = ss.ss_store_sk INNER JOIN item i ON i.i_item_sk = ss.ss_item_sk WHERE d1.d_moy = 2 AND d1.d_year = 2000 AND d2.d_moy BETWEEN 2 AND 4 AND d2.d_year = 2000 AND d3.d_moy BETWEEN 2 AND 4 AND d3.d_year = 2000 GROUP BY i_item_id, i_item_desc, s_store_id, s_store_name ORDER BY i_item_id, i_item_desc, s_store_id, s_store_name LIMIT 100"
        },
        {
          "node_id": "grouped_store_sales",
          "parent_node_id": "final_select",
          "sources": ["store_sales"],
          "outputs": ["ss_sold_date_sk", "ss_item_sk", "ss_customer_sk", "ss_store_sk", "ss_ticket_number", "ss_net_profit"],
          "changed": true,
          "sql": "SELECT ss_sold_date_sk, ss_item_sk, ss_customer_sk, ss_store_sk, ss_ticket_number, ss_net_profit FROM store_sales"
        },
        {
          "node_id": "grouped_store_returns",
          "parent_node_id": "final_select",
          "sources": ["store_returns"],
          "outputs": ["sr_returned_date_sk", "sr_item_sk", "sr_customer_sk", "sr_ticket_number", "sr_net_loss"],
          "changed": true,
          "sql": "SELECT sr_returned_date_sk, sr_item_sk, sr_customer_sk, sr_ticket_number, sr_net_loss FROM store_returns"
        },
        {
          "node_id": "grouped_catalog_sales",
          "parent_node_id": "final_select",
          "sources": ["catalog_sales"],
          "outputs": ["cs_sold_date_sk", "cs_bill_customer_sk", "cs_item_sk", "cs_net_profit"],
          "changed": true,
          "sql": "SELECT cs_sold_date_sk, cs_bill_customer_sk, cs_item_sk, cs_net_profit FROM catalog_sales"
        }
      ]
    }
  }
]
```