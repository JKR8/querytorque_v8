{
  "probe_id": "qwen_exploration_1",
  "transform_id": "sf_sk_pushdown_multi_fact",
  "family": "A",
  "dialect": "snowflake",
  "hypothesis": "Pushing the date_sk filter range derived from d_year=2002 into the store_returns scan can enable micro-partition pruning and reduce I/O.",
  "reasoning_trace": [
    "Assigned transform targets adding a date_sk range predicate to fact table scans.",
    "The customer_total_return CTE joins store_returns with date_dim on sr_returned_date_sk = d_date_sk.",
    "Filter d_year = 2002 is present and can be transitively used to constrain sr_returned_date_sk.",
    "This change aligns with the node contract to preserve row semantics and all store_returns columns."
  ],
  "target_ir": "Add predicate on sr_returned_date_sk in customer_total_return CTE based on d_year=2002 date range.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "dag": {
    "order": ["customer_total_return", "final_select"],
    "final_node_id": "final_select",
    "nodes": [
      {
        "node_id": "customer_total_return",
        "deps": ["store_returns", "date_dim"],
        "outputs": ["ctr_customer_sk", "ctr_store_sk", "ctr_reason_sk", "ctr_total_return"],
        "changed": true,
        "sql": "SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_RETURN_AMT_INC_TAX) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2002 AND sr_return_amt / sr_return_quantity BETWEEN 108 AND 167 AND sr_returned_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim WHERE d_year = 2002) AND (SELECT MAX(d_date_sk) FROM date_dim WHERE d_year = 2002) GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk"
      },
      {
        "node_id": "final_select",
        "deps": ["customer_total_return", "store", "customer", "customer_demographics"],
        "outputs": ["c_customer_id"],
        "changed": false
      }
    ]
  }
}