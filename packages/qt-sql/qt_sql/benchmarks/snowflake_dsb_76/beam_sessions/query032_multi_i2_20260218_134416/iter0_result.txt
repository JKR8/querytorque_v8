{
  "iteration": 0,
  "n_api_calls": 9,
  "beam_cost_usd": 0.0,
  "beam_cost_priced_calls": 0,
  "beam_cost_unpriced_calls": 9,
  "beam_token_totals": {
    "prompt_tokens": 0,
    "completion_tokens": 0,
    "total_tokens": 0,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 0,
    "reasoning_tokens": 0
  },
  "best_speedup": 1.05,
  "best_patch_id": "p12",
  "best_sql": "select  sum(cs_ext_discount_amt)  as \"excess discount amount\"\nfrom\n   catalog_sales\n   ,item\n   ,date_dim\nwhere\n(i_manufact_id in (184, 307, 365, 560, 681)\nor i_manager_id BETWEEN 42 and 71)\nand i_item_sk = cs_item_sk\nand d_date between '2001-02-23' and\n        cast('2001-02-23' as date) + interval '90 day'\nand d_date_sk = cs_sold_date_sk\nand cs_ext_discount_amt\n     > (\n         select\n            1.3 * avg(cs_ext_discount_amt)\n         from\n            catalog_sales\n           ,date_dim\n         where\n              cs_item_sk = i_item_sk\n          and d_date between '2001-02-23' and\n                             cast('2001-02-23' as date) + interval '90 day'\n          and d_date_sk = cs_sold_date_sk\n          and cs_list_price between 115 and 144\n          and cs_sales_price / cs_list_price BETWEEN 21 * 0.01 AND 41 * 0.01\n      )\norder by sum(cs_ext_discount_amt)\nlimit 100;",
  "patches": [
    {
      "patch_id": "p05",
      "family": "A",
      "transform": "sf_sk_pushdown_multi_fact",
      "relevance_score": 0.7,
      "status": "NEUTRAL",
      "speedup": 0.95,
      "semantic_passed": true,
      "error": null,
      "original_ms": 213.8,
      "patch_ms": 224.8,
      "output_sql": "SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM (SELECT cs_ext_discount_amt FROM catalog_sales, item, date_dim WHERE (i_manufact_id IN (184, 307, 365, 560, 681) OR i_manager_id BETWEEN 42 AND 71) AND i_item_sk = cs_item_sk AND d_date BETWEEN '2001-02-23' AND CAST('2001-02-23' AS DATE) + INTERVAL '90 day' AND d_date_sk = cs_sold_date_sk AND cs_sold_date_sk BETWEEN (SELECT d_date_sk FROM date_dim WHERE d_date = '2001-02-23') AND (SELECT d_date_sk FROM date_dim WHERE d_date = CAST('2001-02-23' AS DATE) + INTERVAL '90 day') AND cs_ext_discount_amt > (SELECT 1.3 * AVG(cs_ext_discount_amt) FROM catalog_sales, date_dim WHERE cs_item_sk = i_item_sk AND d_date BETWEEN '2001-02-23' AND CAST('2001-02-23' AS DATE) + INTERVAL '90 day' AND d_date_sk = cs_sold_date_sk AND cs_sold_date_sk BETWEEN (SELECT d_date_sk FROM date_dim WHERE d_date = '2001-02-23') AND (SELECT d_date_sk FROM date_dim WHERE d_date = CAST('2001-02-23' AS DATE) + INTERVAL '90 day') AND cs_list_price BETWEEN 115 AND 144 AND cs_sales_price / cs_list_price BETWEEN 21 * 0.01 AND 41 * 0.01)) ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Add explicit date_sk BETWEEN range predicate to catalog_sales joins using pre\u2011computed date_sk bounds from date_dim filter."
    },
    {
      "patch_id": "p10",
      "family": "A",
      "transform": "early_filter",
      "relevance_score": 0.68,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_items AS (SELECT i_item_sk FROM item WHERE i_manufact_id IN (184, 307, 365, 560, 681) OR i_manager_id BETWEEN 42 AND 71) SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales cs JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN filtered_items fi ON cs.cs_item_sk = fi.i_item_sk WHERE d.d_date BETWEEN '2001-02-23' AND CAST('2001-02-23' AS DATE) + INTERVAL '90 day' AND cs.cs_ext_discount_amt > (SELECT 1.3 * AVG(cs2.cs_ext_discount_amt) FROM catalog_sales cs2 JOIN date_dim d2 ON cs2.cs_sold_date_sk = d2.d_date_sk JOIN filtered_items fi2 ON cs2.cs_item_sk = fi2.i_item_sk WHERE d2.d_date BETWEEN '2001-02-23' AND CAST('2001-02-23' AS DATE) + INTERVAL '90 day' AND cs2.cs_list_price BETWEEN 115 AND 144 AND cs2.cs_sales_price / cs2.cs_list_price BETWEEN 0.21 AND 0.41);",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Push item OR filter into a subquery that returns only i_item_sk, then join early with catalog_sales to reduce fact scan rows."
    },
    {
      "patch_id": "p04",
      "family": "D",
      "transform": "or_to_union",
      "relevance_score": 0.55,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Split OR condition on item into two UNION ALL branches: one for i_manufact_id IN values, another for i_manager_id BETWEEN range. Preserve all other joins and filters."
    },
    {
      "patch_id": "p11",
      "family": "A",
      "transform": "multi_dimension_prefetch",
      "relevance_score": 0.58,
      "status": "REGRESSION",
      "speedup": 0.76,
      "semantic_passed": true,
      "error": null,
      "original_ms": 213.8,
      "patch_ms": 280.0,
      "output_sql": "WITH item_prefetch AS (SELECT i_item_sk, i_manufact_id, i_manager_id FROM item WHERE i_manufact_id IN (184, 307, 365, 560, 681) OR i_manager_id BETWEEN 42 AND 71), date_prefetch AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN '2001-02-23' AND DATEADD(day, 90, '2001-02-23')), catalog_sales_filtered AS (SELECT cs.cs_ext_discount_amt FROM catalog_sales cs JOIN item_prefetch i ON cs.cs_item_sk = i.i_item_sk JOIN date_prefetch d ON cs.cs_sold_date_sk = d.d_date_sk WHERE cs.cs_ext_discount_amt > (SELECT 1.3 * AVG(cs2.cs_ext_discount_amt) FROM catalog_sales cs2 JOIN date_prefetch d2 ON cs2.cs_sold_date_sk = d2.d_date_sk WHERE cs2.cs_item_sk = i.i_item_sk AND cs2.cs_list_price BETWEEN 115 AND 144 AND cs2.cs_sales_price / cs2.cs_list_price BETWEEN 0.21 AND 0.41)) select  sum(cs_ext_discount_amt)  as \"excess discount amount\"\nfrom\n   catalog_sales\n   ,item\n   ,date_dim\nwhere\n(i_manufact_id in (184, 307, 365, 560, 681)\nor i_manager_id BETWEEN 42 and 71)\nand i_item_sk = cs_item_sk\nand d_date between '2001-02-23' and\n        cast('2001-02-23' as date) + interval '90 day'\nand d_date_sk = cs_sold_date_sk\nand cs_ext_discount_amt\n     > (\n         select\n            1.3 * avg(cs_ext_discount_amt)\n         from\n            catalog_sales\n           ,date_dim\n         where\n              cs_item_sk = i_item_sk\n          and d_date between '2001-02-23' and\n                             cast('2001-02-23' as date) + interval '90 day'\n          and d_date_sk = cs_sold_date_sk\n          and cs_list_price between 115 and 144\n          and cs_sales_price / cs_list_price BETWEEN 21 * 0.01 AND 41 * 0.01\n      )\norder by sum(cs_ext_discount_amt)\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre\u2011filter both item and date_dim into CTEs, then join them with catalog_sales in a single CTE to reduce fact rows before final aggregation."
    },
    {
      "patch_id": "p12",
      "family": "C",
      "transform": "deferred_window_aggregation",
      "relevance_score": 0.52,
      "status": "NEUTRAL",
      "speedup": 1.05,
      "semantic_passed": true,
      "error": null,
      "original_ms": 213.8,
      "patch_ms": 204.1,
      "output_sql": "select  sum(cs_ext_discount_amt)  as \"excess discount amount\"\nfrom\n   catalog_sales\n   ,item\n   ,date_dim\nwhere\n(i_manufact_id in (184, 307, 365, 560, 681)\nor i_manager_id BETWEEN 42 and 71)\nand i_item_sk = cs_item_sk\nand d_date between '2001-02-23' and\n        cast('2001-02-23' as date) + interval '90 day'\nand d_date_sk = cs_sold_date_sk\nand cs_ext_discount_amt\n     > (\n         select\n            1.3 * avg(cs_ext_discount_amt)\n         from\n            catalog_sales\n           ,date_dim\n         where\n              cs_item_sk = i_item_sk\n          and d_date between '2001-02-23' and\n                             cast('2001-02-23' as date) + interval '90 day'\n          and d_date_sk = cs_sold_date_sk\n          and cs_list_price between 115 and 144\n          and cs_sales_price / cs_list_price BETWEEN 21 * 0.01 AND 41 * 0.01\n      )\norder by sum(cs_ext_discount_amt)\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Delay final aggregation until after threshold filter, computing sum only on qualifying rows rather than aggregating all rows then filtering."
    },
    {
      "patch_id": "p08",
      "family": "E",
      "transform": "materialize_cte",
      "relevance_score": 0.65,
      "status": "REGRESSION",
      "speedup": 0.91,
      "semantic_passed": true,
      "error": null,
      "original_ms": 213.8,
      "patch_ms": 234.0,
      "output_sql": "WITH main_query AS (WITH filtered_date_range AS (\n  SELECT d_date_sk, d_date\n  FROM date_dim\n  WHERE d_date BETWEEN '2001-02-23' AND DATEADD(day, 90, '2001-02-23')\n)\nSELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\"\nFROM catalog_sales, item, filtered_date_range\nWHERE (i_manufact_id IN (184, 307, 365, 560, 681)\n       OR i_manager_id BETWEEN 42 AND 71)\n  AND i_item_sk = cs_item_sk\n  AND d_date_sk = cs_sold_date_sk\n  AND cs_ext_discount_amt > (\n    SELECT 1.3 * AVG(cs_ext_discount_amt)\n    FROM catalog_sales, filtered_date_range\n    WHERE cs_item_sk = i_item_sk\n      AND d_date_sk = cs_sold_date_sk\n      AND cs_list_price BETWEEN 115 AND 144\n      AND cs_sales_price / cs_list_price BETWEEN 0.21 AND 0.41\n  )\nORDER BY SUM(cs_ext_discount_amt)\nLIMIT 100) select  sum(cs_ext_discount_amt)  as \"excess discount amount\"\nfrom\n   catalog_sales\n   ,item\n   ,date_dim\nwhere\n(i_manufact_id in (184, 307, 365, 560, 681)\nor i_manager_id BETWEEN 42 and 71)\nand i_item_sk = cs_item_sk\nand d_date between '2001-02-23' and\n        cast('2001-02-23' as date) + interval '90 day'\nand d_date_sk = cs_sold_date_sk\nand cs_ext_discount_amt\n     > (\n         select\n            1.3 * avg(cs_ext_discount_amt)\n         from\n            catalog_sales\n           ,date_dim\n         where\n              cs_item_sk = i_item_sk\n          and d_date between '2001-02-23' and\n                             cast('2001-02-23' as date) + interval '90 day'\n          and d_date_sk = cs_sold_date_sk\n          and cs_list_price between 115 and 144\n          and cs_sales_price / cs_list_price BETWEEN 21 * 0.01 AND 41 * 0.01\n      )\norder by sum(cs_ext_discount_amt)\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Materialize filtered date_dim CTE to ensure single scan and reuse across outer and inner branches."
    },
    {
      "patch_id": "p03",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.78,
      "status": "NEUTRAL",
      "speedup": 0.97,
      "semantic_passed": true,
      "error": null,
      "original_ms": 213.8,
      "patch_ms": 219.7,
      "output_sql": "WITH preaggregated_sales AS (SELECT cs_item_sk, cs_sold_date_sk, SUM(cs_ext_discount_amt) AS sum_cs_ext_discount_amt, COUNT(*) AS count_rows FROM catalog_sales WHERE cs_sold_date_sk IS NOT NULL GROUP BY cs_item_sk, cs_sold_date_sk) select  sum(cs_ext_discount_amt)  as \"excess discount amount\"\nfrom\n   catalog_sales\n   ,item\n   ,date_dim\nwhere\n(i_manufact_id in (184, 307, 365, 560, 681)\nor i_manager_id BETWEEN 42 and 71)\nand i_item_sk = cs_item_sk\nand d_date between '2001-02-23' and\n        cast('2001-02-23' as date) + interval '90 day'\nand d_date_sk = cs_sold_date_sk\nand cs_ext_discount_amt\n     > (\n         select\n            1.3 * avg(cs_ext_discount_amt)\n         from\n            catalog_sales\n           ,date_dim\n         where\n              cs_item_sk = i_item_sk\n          and d_date between '2001-02-23' and\n                             cast('2001-02-23' as date) + interval '90 day'\n          and d_date_sk = cs_sold_date_sk\n          and cs_list_price between 115 and 144\n          and cs_sales_price / cs_list_price BETWEEN 21 * 0.01 AND 41 * 0.01\n      )\norder by sum(cs_ext_discount_amt)\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-aggregate catalog_sales by cs_item_sk, cs_sold_date_sk with sum(cs_ext_discount_amt), count(*) before joining to item and date_dim, then compute threshold via window over pre-aggregated data."
    },
    {
      "patch_id": "p06",
      "family": "A",
      "transform": "dimension_cte_isolate",
      "relevance_score": 0.6,
      "status": "NEUTRAL",
      "speedup": 1.0,
      "semantic_passed": true,
      "error": null,
      "original_ms": 213.8,
      "patch_ms": 214.6,
      "output_sql": "WITH item_filtered AS (SELECT i_item_sk FROM item WHERE i_manufact_id IN (184, 307, 365, 560, 681) OR i_manager_id BETWEEN 42 AND 71), date_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2001-02-23' AND DATEADD(day, 90, '2001-02-23')), main_query AS (SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales JOIN item_filtered ON cs_item_sk = i_item_sk JOIN date_filtered ON cs_sold_date_sk = d_date_sk WHERE cs_ext_discount_amt > ( SELECT 1.3 * AVG(cs2.cs_ext_discount_amt) FROM catalog_sales cs2 JOIN date_filtered d2 ON cs2.cs_sold_date_sk = d2.d_date_sk WHERE cs2.cs_item_sk = i_item_sk AND cs2.cs_list_price BETWEEN 115 AND 144 AND cs2.cs_sales_price / cs2.cs_list_price BETWEEN 0.21 AND 0.41 ) ORDER BY SUM(cs_ext_discount_amt) LIMIT 100) select  sum(cs_ext_discount_amt)  as \"excess discount amount\"\nfrom\n   catalog_sales\n   ,item\n   ,date_dim\nwhere\n(i_manufact_id in (184, 307, 365, 560, 681)\nor i_manager_id BETWEEN 42 and 71)\nand i_item_sk = cs_item_sk\nand d_date between '2001-02-23' and\n        cast('2001-02-23' as date) + interval '90 day'\nand d_date_sk = cs_sold_date_sk\nand cs_ext_discount_amt\n     > (\n         select\n            1.3 * avg(cs_ext_discount_amt)\n         from\n            catalog_sales\n           ,date_dim\n         where\n              cs_item_sk = i_item_sk\n          and d_date between '2001-02-23' and\n                             cast('2001-02-23' as date) + interval '90 day'\n          and d_date_sk = cs_sold_date_sk\n          and cs_list_price between 115 and 144\n          and cs_sales_price / cs_list_price BETWEEN 21 * 0.01 AND 41 * 0.01\n      )\norder by sum(cs_ext_discount_amt)\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre\u2011filter item and date_dim into separate CTEs returning only surrogate keys, then join with catalog_sales."
    },
    {
      "patch_id": "p02",
      "family": "B",
      "transform": "sf_shared_scan_decorrelate",
      "relevance_score": 0.85,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH shared_sales AS (SELECT cs_item_sk, cs_ext_discount_amt FROM catalog_sales JOIN date_dim ON d_date_sk = cs_sold_date_sk WHERE d_date BETWEEN '2001-02-23' AND CAST('2001-02-23' AS DATE) + INTERVAL '90 day'), avg_discount AS (SELECT AVG(cs_ext_discount_amt) * 1.3 AS avg_threshold FROM catalog_sales cs2 JOIN date_dim d2 ON d2.d_date_sk = cs2.cs_sold_date_sk WHERE d2.d_date BETWEEN '2001-02-23' AND CAST('2001-02-23' AS DATE) + INTERVAL '90 day' AND cs2.cs_list_price BETWEEN 115 AND 144 AND cs2.cs_sales_price / cs2.cs_list_price BETWEEN 0.21 AND 0.41), filtered_outer AS (SELECT cs_ext_discount_amt FROM shared_sales JOIN item ON i_item_sk = cs_item_sk WHERE (i_manufact_id IN (184, 307, 365, 560, 681) OR i_manager_id BETWEEN 42 AND 71)) SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM filtered_outer WHERE cs_ext_discount_amt > (SELECT 1.3 * avg_threshold FROM avg_discount) ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Create shared CTE for catalog_sales filtered by date range and price conditions, compute per-item aggregates, then join for outer filter and final aggregation."
    },
    {
      "patch_id": "p07",
      "family": "C",
      "transform": "single_pass_aggregation",
      "relevance_score": 0.5,
      "status": "REGRESSION",
      "speedup": 0.91,
      "semantic_passed": true,
      "error": null,
      "original_ms": 213.8,
      "patch_ms": 235.1,
      "output_sql": "WITH single_pass_agg AS (WITH item_filtered AS (SELECT i_item_sk FROM item WHERE (i_manufact_id IN (184, 307, 365, 560, 681) OR i_manager_id BETWEEN 42 AND 71)), date_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2001-02-23' AND CAST('2001-02-23' AS DATE) + INTERVAL '90 day') SELECT cs.cs_item_sk, SUM(cs.cs_ext_discount_amt) AS total_discount, 1.3 * AVG(CASE WHEN cs.cs_list_price BETWEEN 115 AND 144 AND (cs.cs_sales_price / cs.cs_list_price) BETWEEN 0.21 AND 0.41 THEN cs.cs_ext_discount_amt END) AS avg_discount_threshold FROM catalog_sales cs JOIN item_filtered i ON cs.cs_item_sk = i.i_item_sk JOIN date_filtered d ON cs.cs_sold_date_sk = d.d_date_sk GROUP BY cs.cs_item_sk) select  sum(cs_ext_discount_amt)  as \"excess discount amount\"\nfrom\n   catalog_sales\n   ,item\n   ,date_dim\nwhere\n(i_manufact_id in (184, 307, 365, 560, 681)\nor i_manager_id BETWEEN 42 and 71)\nand i_item_sk = cs_item_sk\nand d_date between '2001-02-23' and\n        cast('2001-02-23' as date) + interval '90 day'\nand d_date_sk = cs_sold_date_sk\nand cs_ext_discount_amt\n     > (\n         select\n            1.3 * avg(cs_ext_discount_amt)\n         from\n            catalog_sales\n           ,date_dim\n         where\n              cs_item_sk = i_item_sk\n          and d_date between '2001-02-23' and\n                             cast('2001-02-23' as date) + interval '90 day'\n          and d_date_sk = cs_sold_date_sk\n          and cs_list_price between 115 and 144\n          and cs_sales_price / cs_list_price BETWEEN 21 * 0.01 AND 41 * 0.01\n      )\norder by sum(cs_ext_discount_amt)\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Consolidate outer and inner aggregations into single CTE that computes both sum(cs_ext_discount_amt) and avg(cs_ext_discount_amt) per item with appropriate filters via CASE."
    },
    {
      "patch_id": "p01",
      "family": "B",
      "transform": "sf_inline_decorrelate",
      "relevance_score": 0.92,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH shared_date_dim_filter AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN '2001-02-23' AND CAST('2001-02-23' AS DATE) + INTERVAL '90 day'), filtered_catalog_sales AS (SELECT cs.cs_item_sk, cs.cs_ext_discount_amt FROM catalog_sales cs JOIN shared_date_dim_filter d ON cs.cs_sold_date_sk = d.d_date_sk WHERE cs.cs_list_price BETWEEN 115 AND 144 AND cs.cs_sales_price / cs.cs_list_price BETWEEN 21 * 0.01 AND 41 * 0.01), item_threshold AS (SELECT cs_item_sk, 1.3 * AVG(cs_ext_discount_amt) AS threshold FROM filtered_catalog_sales GROUP BY cs_item_sk) SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM filtered_catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN item_threshold t ON cs.cs_item_sk = t.cs_item_sk WHERE cs.cs_ext_discount_amt > t.threshold ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Decompose correlated scalar subquery into 3 CTEs: (1) shared date_dim filtered CTE, (2) pre-filtered catalog_sales CTE with date join and price filters, (3) per-item aggregate threshold CTE. Join threshold CTE in main query."
    },
    {
      "patch_id": "p09",
      "family": "F",
      "transform": "inner_join_conversion",
      "relevance_score": 0.45,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales INNER JOIN item ON i_item_sk = cs_item_sk INNER JOIN date_dim ON d_date_sk = cs_sold_date_sk WHERE (i_manufact_id IN (184, 307, 365, 560, 681) OR i_manager_id BETWEEN 42 AND 71) AND d_date BETWEEN '2001-02-23' AND CAST('2001-02-23' AS DATE) + INTERVAL '90 day' AND cs_ext_discount_amt > (SELECT 1.3 * AVG(cs_ext_discount_amt) FROM catalog_sales INNER JOIN date_dim ON d_date_sk = cs_sold_date_sk WHERE d_date BETWEEN '2001-02-23' AND CAST('2001-02-23' AS DATE) + INTERVAL '90 day' AND cs_list_price BETWEEN 115 AND 144 AND cs_sales_price / cs_list_price BETWEEN 21 * 0.01 AND 41 * 0.01) ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Convert comma joins to explicit INNER JOIN syntax with ON clauses, keeping same join order."
    }
  ],
  "explains": {
    "p05": "GlobalStats | 109850 | 109850 | 1847267317248\n1 | 0 | Result | DATE_DIM.D_DATE_SK\n1 | 3 | [2] | Filter | DATE_DIM.D_DATE = '2001-02-23'\n1 | 4 | [3] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_DATE_SK, D_DATE | 1 | 1 | 2138624\n2 | 0 | Result | DATE_DIM.D_DATE_SK\n2 | 3 | [2] | Filter | DATE_DIM.D_DATE = '2001-05-24'\n2 | 4 | [3] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_DATE_SK, D_DATE | 1 | 1 | 2138624\n3 | 0 | Result | SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT)\n",
    "p11": "GlobalStats | 109848 | 109848 | 1847263040000\n1 | 0 | Result | SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT)\n1 | 1 | [0] | Limit | rowCount: 100\n1 | 2 | [1] | Aggregate | aggExprs: [SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT)]\n1 | 3 | [2] | Filter | (CATALOG_SALES.CS_EXT_DISCOUNT_AMT) > (1.3 * ((SUM(SUM_INTERNAL(SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT), COUNT(*)))) / (NVL(COUNT(COUNT_INTERNAL(COUNT(CATALOG_SALES.CS_EXT_DISCOUNT_AMT), COUNT(*))), 0))))\n1 | 4 | [3] | Aggregate | aggExprs: [SUM(SUM_INTERNAL(SUM(",
    "p12": "GlobalStats | 109848 | 109848 | 1847263040000\n1 | 0 | Result | SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT)\n1 | 1 | [0] | Limit | rowCount: 100\n1 | 2 | [1] | Aggregate | aggExprs: [SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT)]\n1 | 3 | [2] | Filter | (CATALOG_SALES.CS_EXT_DISCOUNT_AMT) > (1.3 * ((SUM(SUM_INTERNAL(SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT), COUNT(*)))) / (NVL(COUNT(COUNT_INTERNAL(COUNT(CATALOG_SALES.CS_EXT_DISCOUNT_AMT), COUNT(*))), 0))))\n1 | 4 | [3] | Aggregate | aggExprs: [SUM(SUM_INTERNAL(SUM(",
    "p08": "GlobalStats | 109848 | 109848 | 1847263040000\n1 | 0 | Result | SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT)\n1 | 1 | [0] | Limit | rowCount: 100\n1 | 2 | [1] | Aggregate | aggExprs: [SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT)]\n1 | 3 | [2] | Filter | (CATALOG_SALES.CS_EXT_DISCOUNT_AMT) > (1.3 * ((SUM(SUM_INTERNAL(SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT), COUNT(*)))) / (NVL(COUNT(COUNT_INTERNAL(COUNT(CATALOG_SALES.CS_EXT_DISCOUNT_AMT), COUNT(*))), 0))))\n1 | 4 | [3] | Aggregate | aggExprs: [SUM(SUM_INTERNAL(SUM(",
    "p03": "GlobalStats | 109848 | 109848 | 1847263040000\n1 | 0 | Result | SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT)\n1 | 1 | [0] | Limit | rowCount: 100\n1 | 2 | [1] | Aggregate | aggExprs: [SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT)]\n1 | 3 | [2] | Filter | (CATALOG_SALES.CS_EXT_DISCOUNT_AMT) > (1.3 * ((SUM(SUM_INTERNAL(SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT), COUNT(*)))) / (NVL(COUNT(COUNT_INTERNAL(COUNT(CATALOG_SALES.CS_EXT_DISCOUNT_AMT), COUNT(*))), 0))))\n1 | 4 | [3] | Aggregate | aggExprs: [SUM(SUM_INTERNAL(SUM(",
    "p06": "GlobalStats | 109848 | 109848 | 1847263040000\n1 | 0 | Result | SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT)\n1 | 1 | [0] | Limit | rowCount: 100\n1 | 2 | [1] | Aggregate | aggExprs: [SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT)]\n1 | 3 | [2] | Filter | (CATALOG_SALES.CS_EXT_DISCOUNT_AMT) > (1.3 * ((SUM(SUM_INTERNAL(SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT), COUNT(*)))) / (NVL(COUNT(COUNT_INTERNAL(COUNT(CATALOG_SALES.CS_EXT_DISCOUNT_AMT), COUNT(*))), 0))))\n1 | 4 | [3] | Aggregate | aggExprs: [SUM(SUM_INTERNAL(SUM(",
    "p07": "GlobalStats | 109848 | 109848 | 1847263040000\n1 | 0 | Result | SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT)\n1 | 1 | [0] | Limit | rowCount: 100\n1 | 2 | [1] | Aggregate | aggExprs: [SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT)]\n1 | 3 | [2] | Filter | (CATALOG_SALES.CS_EXT_DISCOUNT_AMT) > (1.3 * ((SUM(SUM_INTERNAL(SUM(CATALOG_SALES.CS_EXT_DISCOUNT_AMT), COUNT(*)))) / (NVL(COUNT(COUNT_INTERNAL(COUNT(CATALOG_SALES.CS_EXT_DISCOUNT_AMT), COUNT(*))), 0))))\n1 | 4 | [3] | Aggregate | aggExprs: [SUM(SUM_INTERNAL(SUM("
  }
}