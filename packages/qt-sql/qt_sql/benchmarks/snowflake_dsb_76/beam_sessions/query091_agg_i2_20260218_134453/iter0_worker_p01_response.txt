{
  "probe_id": "p12",
  "transform_id": "sf_sk_pushdown_multi_fact",
  "family": "A",
  "status": "success",
  "dialect": "snowflake",
  "hypothesis": "Pushing date_sk range filter from DATE_DIM into CATALOG_RETURNS scan reduces I/O by pruning micro-partitions early while preserving output semantics.",
  "reasoning_trace": [
    "Assigned transform targets predicate pushdown to reduce fact-table scan volume.",
    "Date_dim filter (d_year=2001, d_moy=12) is selective and can be converted to a range predicate on cr_returned_date_sk.",
    "Adding BETWEEN clause on cr_returned_date_sk enables Snowflake's micro-partition pruning without semantic drift.",
    "No structural changes needed; only WHERE clause of fact scan is modified."
  ],
  "target_ir": "CATALOG_RETURNS scan node adds BETWEEN predicate derived from filtered DATE_DIM rows.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": [],
        "outputs": ["Call_Center", "Call_Center_Name", "Manager", "Returns_Loss"],
        "changed": true,
        "sql": "WITH date_sk_range AS (\n  SELECT MIN(d_date_sk) AS min_date_sk, MAX(d_date_sk) AS max_date_sk\n  FROM date_dim\n  WHERE d_year = 2001 AND d_moy = 12\n)\nSELECT  \n        cc_call_center_id AS Call_Center,\n        cc_name AS Call_Center_Name,\n        cc_manager AS Manager,\n        SUM(cr_net_loss) AS Returns_Loss\nFROM\n        call_center,\n        catalog_returns,\n        date_dim,\n        customer,\n        customer_address,\n        customer_demographics,\n        household_demographics,\n        date_sk_range\nWHERE\n        cr_call_center_sk       = cc_call_center_sk\nAND     cr_returned_date_sk     = d_date_sk\nAND     cr_returning_customer_sk= c_customer_sk\nAND     cd_demo_sk              = c_current_cdemo_sk\nAND     hd_demo_sk              = c_current_hdemo_sk\nAND     ca_address_sk           = c_current_addr_sk\nAND     d_year                  = 2001 \nAND     d_moy                   = 12\nAND     ( (cd_marital_status       = 'M' and cd_education_status     = 'Unknown')\n        or(cd_marital_status       = 'W' and cd_education_status     = 'Advanced Degree'))\nAND     hd_buy_potential like '>10000%'\nAND     ca_gmt_offset           = -6\nAND     cr_returned_date_sk BETWEEN date_sk_range.min_date_sk AND date_sk_range.max_date_sk\ngroup by cc_call_center_id,cc_name,cc_manager,cd_marital_status,cd_education_status\norder by sum(cr_net_loss) desc;"
      }
    ]
  }
}