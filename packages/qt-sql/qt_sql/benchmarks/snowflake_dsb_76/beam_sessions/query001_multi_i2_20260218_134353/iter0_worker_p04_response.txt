{
  "probe_id": "p12",
  "transform_id": "early_filter",
  "family": "A",
  "status": "success",
  "dialect": "snowflake",
  "hypothesis": "Pushing the filter sr_reason_sk BETWEEN 17 AND 20 into the CTE customer_total_return reduces rows early in the aggregation, leveraging predicate pushdown and micro-partition pruning.",
  "reasoning_trace": [
    "Assigned hotspot is the customer_total_return CTE which scans the large STORE_RETURNS table.",
    "The filter sr_reason_sk BETWEEN 17 AND 20 is currently applied at the final select level but can be safely pushed down.",
    "Node contract confirms that all required sources and output columns are preserved with the new WHERE clause."
  ],
  "target_ir": "customer_total_return CTE includes an additional filter on sr_reason_sk BETWEEN 17 AND 20 in its WHERE clause; final_select remains unchanged.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["customer_total_return", "store", "customer", "customer_demographics"],
        "outputs": ["c_customer_id"],
        "changed": false
      },
      {
        "node_id": "customer_total_return",
        "parent_node_id": "final_select",
        "sources": ["store_returns", "date_dim"],
        "outputs": ["ctr_customer_sk", "ctr_store_sk", "ctr_reason_sk", "ctr_total_return"],
        "changed": true,
        "sql": "SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_RETURN_AMT_INC_TAX) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2000 AND sr_return_amt / sr_return_quantity BETWEEN 115 AND 174 AND sr_reason_sk BETWEEN 17 AND 20 GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk"
      }
    ]
  }
}