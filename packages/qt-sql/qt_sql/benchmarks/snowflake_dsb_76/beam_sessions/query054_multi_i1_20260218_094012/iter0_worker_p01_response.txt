{
  "probe_id": "p12",
  "transform_id": "sf_sk_pushdown_union_all",
  "family": "A",
  "dialect": "snowflake",
  "hypothesis": "Pushing explicit date_sk range filters into each branch of the UNION ALL between catalog_sales and web_sales enables micro-partition pruning, reducing I/O.",
  "reasoning_trace": [
    "Assigned transform targets the UNION ALL between catalog_sales and web_sales.",
    "The original query joins cs_or_ws_sales with date_dim to filter by d_moy = 1 and d_year = 1998.",
    "We derive a date_sk range from date_dim for the same period and push it into both branches of the UNION ALL.",
    "This change preserves all required output semantics and aligns with node_contract constraints."
  ],
  "target_ir": "cs_or_ws_sales CTE redefined with date_sk range filters pushed into catalog_sales and web_sales branches.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["segments"],
        "outputs": ["segment", "num_customers", "segment_base"],
        "changed": false
      },
      {
        "node_id": "segments",
        "parent_node_id": "final_select",
        "sources": ["my_revenue"],
        "outputs": ["segment"],
        "changed": false
      },
      {
        "node_id": "my_revenue",
        "parent_node_id": "segments",
        "sources": ["my_customers", "store_sales", "customer_address", "store", "date_dim"],
        "outputs": ["c_customer_sk", "revenue"],
        "changed": false
      },
      {
        "node_id": "my_customers",
        "parent_node_id": "my_revenue",
        "sources": ["item", "date_dim", "customer", "cs_or_ws_sales_prefetch"],
        "outputs": ["c_customer_sk", "c_current_addr_sk"],
        "changed": false
      },
      {
        "node_id": "cs_or_ws_sales_prefetch",
        "parent_node_id": "my_customers",
        "sources": ["catalog_sales", "web_sales", "date_dim"],
        "outputs": ["sold_date_sk", "customer_sk", "item_sk", "wholesale_cost"],
        "changed": true,
        "sql": "with date_range as (select d_date_sk as start_sk, d_date_sk as end_sk from date_dim where d_moy = 1 and d_year = 1998 limit 1)\nselect cs_sold_date_sk sold_date_sk, cs_bill_customer_sk customer_sk, cs_item_sk item_sk, cs_wholesale_cost wholesale_cost\nfrom catalog_sales, date_range\nwhere cs_sold_date_sk between date_range.start_sk and date_range.end_sk\nunion all\nselect ws_sold_date_sk sold_date_sk, ws_bill_customer_sk customer_sk, ws_item_sk item_sk, ws_wholesale_cost wholesale_cost\nfrom web_sales, date_range\nwhere ws_sold_date_sk between date_range.start_sk and date_range.end_sk"
      }
    ]
  }
}