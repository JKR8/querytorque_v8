{
  "probe_id": "scout_or_to_union",
  "transform_id": "or_to_union",
  "family": "D",
  "status": "success",
  "dialect": "snowflake",
  "hypothesis": "Decomposing the complex OR conditions in the WHERE clause into separate UNION ALL branches allows Snowflake to apply more efficient filtering and pruning per branch, reducing overall scan pressure on the large STORE_SALES table.",
  "reasoning_trace": [
    "Assigned transform targets OR decomposition to improve micro-partition pruning and reduce scan pressure.",
    "Three distinct OR branches are identified based on customer demographics and address conditions.",
    "Each branch isolates specific filter predicates to enable per-branch optimization.",
    "Aggregation is preserved at the final level to maintain output semantics."
  ],
  "target_ir": "Three UNION ALL branches replacing OR conditions, each with focused filters on demographics and address dimensions, followed by a final aggregation step.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["union_branches"],
        "outputs": ["AVG(ss_quantity)", "AVG(ss_ext_sales_price)", "AVG(ss_ext_wholesale_cost)", "SUM(ss_ext_wholesale_cost)"],
        "changed": false
      },
      {
        "node_id": "union_branches",
        "parent_node_id": "final_select",
        "sources": [],
        "outputs": ["ss_quantity", "ss_ext_sales_price", "ss_ext_wholesale_cost"],
        "changed": true,
        "sql": "SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost\nFROM (\n  SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost\n  FROM store_sales\n  JOIN store ON s_store_sk = ss_store_sk\n  JOIN customer_demographics cd1 ON cd1.cd_demo_sk = ss_cdemo_sk\n  JOIN household_demographics hd1 ON hd1.hd_demo_sk = ss_hdemo_sk\n  JOIN customer_address ca1 ON ca1.ca_address_sk = ss_addr_sk\n  JOIN date_dim d1 ON d1.d_date_sk = ss_sold_date_sk\n  WHERE d1.d_year = 2001\n    AND cd1.cd_marital_status = 'M'\n    AND cd1.cd_education_status = '2 yr Degree'\n    AND ss_sales_price BETWEEN 100.00 AND 150.00\n    AND hd1.hd_dep_count = 3\n    AND ca1.ca_country = 'United States'\n    AND ca1.ca_state IN ('CO', 'NC', 'TX')\n    AND ss_net_profit BETWEEN 100 AND 200\n  UNION ALL\n  SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost\n  FROM store_sales\n  JOIN store ON s_store_sk = ss_store_sk\n  JOIN customer_demographics cd2 ON cd2.cd_demo_sk = ss_cdemo_sk\n  JOIN household_demographics hd2 ON hd2.hd_demo_sk = ss_hdemo_sk\n  JOIN customer_address ca2 ON ca2.ca_address_sk = ss_addr_sk\n  JOIN date_dim d2 ON d2.d_date_sk = ss_sold_date_sk\n  WHERE d2.d_year = 2001\n    AND cd2.cd_marital_status = 'U'\n    AND cd2.cd_education_status = 'College'\n    AND ss_sales_price BETWEEN 50.00 AND 100.00\n    AND hd2.hd_dep_count = 1\n    AND ca2.ca_country = 'United States'\n    AND ca2.ca_state IN ('AR', 'NY', 'TX')\n    AND ss_net_profit BETWEEN 150 AND 300\n  UNION ALL\n  SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost\n  FROM store_sales\n  JOIN store ON s_store_sk = ss_store_sk\n  JOIN customer_demographics cd3 ON cd3.cd_demo_sk = ss_cdemo_sk\n  JOIN household_demographics hd3 ON hd3.hd_demo_sk = ss_hdemo_sk\n  JOIN customer_address ca3 ON ca3.ca_address_sk = ss_addr_sk\n  JOIN date_dim d3 ON d3.d_date_sk = ss_sold_date_sk\n  WHERE d3.d_year = 2001\n    AND cd3.cd_marital_status = 'S'\n    AND cd3.cd_education_status = 'Unknown'\n    AND ss_sales_price BETWEEN 150.00 AND 200.00\n    AND hd3.hd_dep_count = 1\n    AND ca3.ca_country = 'United States'\n    AND ca3.ca_state IN ('IA', 'IL', 'NC')\n    AND ss_net_profit BETWEEN 50 AND 250\n)"
      }
    ]
  }
}