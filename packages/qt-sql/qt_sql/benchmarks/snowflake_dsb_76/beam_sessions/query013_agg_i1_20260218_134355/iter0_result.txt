{
  "iteration": 0,
  "n_api_calls": 9,
  "beam_cost_usd": 0.0,
  "beam_cost_priced_calls": 0,
  "beam_cost_unpriced_calls": 9,
  "beam_token_totals": {
    "prompt_tokens": 0,
    "completion_tokens": 0,
    "total_tokens": 0,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 0,
    "reasoning_tokens": 0
  },
  "best_speedup": 1.01,
  "best_patch_id": "p03",
  "best_sql": "WITH preagg_store_sales AS (SELECT ss_store_sk, ss_cdemo_sk, ss_hdemo_sk, ss_sold_date_sk, ss_addr_sk, SUM(ss_quantity) AS sum_ss_quantity, COUNT(ss_quantity) AS count_ss_quantity, SUM(ss_ext_sales_price) AS sum_ss_ext_sales_price, COUNT(ss_ext_sales_price) AS count_ss_ext_sales_price, SUM(ss_ext_wholesale_cost) AS sum_ss_ext_wholesale_cost, COUNT(ss_ext_wholesale_cost) AS count_ss_ext_wholesale_cost FROM store_sales WHERE ss_sold_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_year = 2001) GROUP BY ss_store_sk, ss_cdemo_sk, ss_hdemo_sk, ss_sold_date_sk, ss_addr_sk) select avg(ss_quantity)\n,avg(ss_ext_sales_price)\n,avg(ss_ext_wholesale_cost)\n,sum(ss_ext_wholesale_cost)\nfrom store_sales\n   ,store\n   ,customer_demographics\n   ,household_demographics\n   ,customer_address\n   ,date_dim\nwhere s_store_sk = ss_store_sk\nand  ss_sold_date_sk = d_date_sk and d_year = 2001\nand((ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'M'\nand cd_education_status = '2 yr Degree'\nand ss_sales_price between 100.00 and 150.00\nand hd_dep_count = 3\n   )or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'U'\nand cd_education_status = 'College'\nand ss_sales_price between 50.00 and 100.00\nand hd_dep_count = 1\n   ) or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'S'\nand cd_education_status = 'Unknown'\nand ss_sales_price between 150.00 and 200.00\nand hd_dep_count = 1\n   ))\nand((ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('CO', 'NC', 'TX')\nand ss_net_profit between 100 and 200\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('AR', 'NY', 'TX')\nand ss_net_profit between 150 and 300\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('IA', 'IL', 'NC')\nand ss_net_profit between 50 and 250\n   ));",
  "patches": [
    {
      "patch_id": "p09",
      "family": "A",
      "transform": "dimension_cte_isolate",
      "relevance_score": 0.5,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre-filter each dimension table (customer_demographics, household_demographics, customer_address) into separate CTEs returning only surrogate keys before joining with store_sales."
    },
    {
      "patch_id": "p12",
      "family": "C",
      "transform": "early_filter",
      "relevance_score": 0.55,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH agg_store_sales AS (SELECT SUM(ss_quantity) AS ss_quantity_sum, COUNT(ss_quantity) AS ss_quantity_count, SUM(ss_ext_sales_price) AS ss_ext_sales_price_sum, COUNT(ss_ext_sales_price) AS ss_ext_sales_price_count, SUM(ss_ext_wholesale_cost) AS ss_ext_wholesale_cost_sum, COUNT(ss_ext_wholesale_cost) AS ss_ext_wholesale_cost_count FROM store_sales JOIN store ON s_store_sk = ss_store_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk AND d_year = 2001 JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN customer_address ON ss_addr_sk = ca_address_sk WHERE ((cd_marital_status = 'M' AND cd_education_status = '2 yr Degree' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3) OR (cd_marital_status = 'U' AND cd_education_status = 'College' AND ss_sales_price BETWEEN 50.00 AND 100.00 AND hd_dep_count = 1) OR (cd_marital_status = 'S' AND cd_education_status = 'Unknown' AND ss_sales_price BETWEEN 150.00 AND 200.00 AND hd_dep_count = 1)) AND ((ca_country = 'United States' AND ca_state IN ('CO', 'NC', 'TX') AND ss_net_profit BETWEEN 100 AND 200) OR (ca_country = 'United States' AND ca_state IN ('AR', 'NY', 'TX') AND ss_net_profit BETWEEN 150 AND 300) OR (ca_country = 'United States' AND ca_state IN ('IA', 'IL', 'NC') AND ss_net_profit BETWEEN 50 AND 250))) SELECT (agg.ss_quantity_sum / agg.ss_quantity_count) AS avg_ss_quantity, (agg.ss_ext_sales_price_sum / agg.ss_ext_sales_price_count) AS avg_ss_ext_sales_price, (agg.ss_ext_wholesale_cost_sum / agg.ss_ext_wholesale_cost_count) AS avg_ss_ext_wholesale_cost, agg.ss_ext_wholesale_cost_sum AS sum_ss_ext_wholesale_cost FROM agg_store_sales agg;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Consolidate aggregate computations into a single-pass CTE that pre-computes all needed sums and counts for averages before final joins, adapting from single_pass_aggregation."
    },
    {
      "patch_id": "p06",
      "family": "A",
      "transform": "prefetch_fact_join",
      "relevance_score": 0.5,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH date_filtered_sales AS (SELECT ss_store_sk, ss_cdemo_sk, ss_hdemo_sk, ss_addr_sk, ss_sold_date_sk, ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2001), address_filtered AS (SELECT ss_store_sk, ss_cdemo_sk, ss_hdemo_sk, ss_addr_sk, ss_sold_date_sk, ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost FROM date_filtered_sales JOIN customer_address ON ss_addr_sk = ca_address_sk WHERE (ca_country = 'United States' AND ca_state IN ('CO', 'NC', 'TX') AND ss_net_profit BETWEEN 100 AND 200) OR (ca_country = 'United States' AND ca_state IN ('AR', 'NY', 'TX') AND ss_net_profit BETWEEN 150 AND 300) OR (ca_country = 'United States' AND ca_state IN ('IA', 'IL', 'NC') AND ss_net_profit BETWEEN 50 AND 250)), demographic_filtered AS (SELECT ss_store_sk, ss_cdemo_sk, ss_hdemo_sk, ss_addr_sk, ss_sold_date_sk, ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost FROM date_filtered_sales JOIN customer_demographics ON ss_cdemo_sk = cd_demo_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk WHERE ((cd_marital_status = 'M' AND cd_education_status = '2 yr Degree' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3) OR (cd_marital_status = 'U' AND cd_education_status = 'College' AND ss_sales_price BETWEEN 50.00 AND 100.00 AND hd_dep_count = 1) OR (cd_marital_status = 'S' AND cd_education_status = 'Unknown' AND ss_sales_price BETWEEN 150.00 AND 200.00 AND hd_dep_count = 1))) SELECT AVG(ss_quantity), AVG(ss_ext_sales_price), AVG(ss_ext_wholesale_cost), SUM(ss_ext_wholesale_cost) FROM demographic_filtered JOIN address_filtered USING (ss_store_sk, ss_cdemo_sk, ss_hdemo_sk, ss_addr_sk, ss_sold_date_sk) JOIN store ON ss_store_sk = s_store_sk;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Build a CTE chain: first CTE filters dimensions, second CTE pre-joins filtered dimension keys with store_sales, subsequent CTEs handle remaining joins to progressively reduce data."
    },
    {
      "patch_id": "p08",
      "family": "E",
      "transform": "materialize_cte",
      "relevance_score": 0.4,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Materialize repeated dimension filter patterns into CTEs to avoid recomputation, focusing on customer_demographics and customer_address OR conditions."
    },
    {
      "patch_id": "p11",
      "family": "F",
      "transform": "inner_join_conversion",
      "relevance_score": 0.35,
      "status": "NEUTRAL",
      "speedup": 0.97,
      "semantic_passed": true,
      "error": null,
      "original_ms": 158.3,
      "patch_ms": 163.6,
      "output_sql": "SELECT AVG(ss_quantity), AVG(ss_ext_sales_price), AVG(ss_ext_wholesale_cost), SUM(ss_ext_wholesale_cost) FROM store_sales INNER JOIN store ON s_store_sk = ss_store_sk INNER JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk INNER JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk INNER JOIN customer_address ON ss_addr_sk = ca_address_sk INNER JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2001 AND (((ss_hdemo_sk=hd_demo_sk AND cd_demo_sk = ss_cdemo_sk AND cd_marital_status = 'M' AND cd_education_status = '2 yr Degree' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3) OR (ss_hdemo_sk=hd_demo_sk AND cd_demo_sk = ss_cdemo_sk AND cd_marital_status = 'U' AND cd_education_status = 'College' AND ss_sales_price BETWEEN 50.00 AND 100.00 AND hd_dep_count = 1) OR (ss_hdemo_sk=hd_demo_sk AND cd_demo_sk = ss_cdemo_sk AND cd_marital_status = 'S' AND cd_education_status = 'Unknown' AND ss_sales_price BETWEEN 150.00 AND 200.00 AND hd_dep_count = 1)) AND ((ss_addr_sk = ca_address_sk AND ca_country = 'United States' AND ca_state IN ('CO', 'NC', 'TX') AND ss_net_profit BETWEEN 100 AND 200) OR (ss_addr_sk = ca_address_sk AND ca_country = 'United States' AND ca_state IN ('AR', 'NY', 'TX') AND ss_net_profit BETWEEN 150 AND 300) OR (ss_addr_sk = ca_address_sk AND ca_country = 'United States' AND ca_state IN ('IA', 'IL', 'NC') AND ss_net_profit BETWEEN 50 AND 250)));",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Convert implicit comma joins to explicit INNER JOIN syntax and ensure optimal join order, though all joins are already INNER."
    },
    {
      "patch_id": "p01",
      "family": "A",
      "transform": "sf_sk_pushdown_multi_fact",
      "relevance_score": 0.85,
      "status": "NEUTRAL",
      "speedup": 1.01,
      "semantic_passed": true,
      "error": null,
      "original_ms": 158.3,
      "patch_ms": 157.4,
      "output_sql": "select avg(ss_quantity)\n,avg(ss_ext_sales_price)\n,avg(ss_ext_wholesale_cost)\n,sum(ss_ext_wholesale_cost)\nfrom store_sales\n   ,store\n   ,customer_demographics\n   ,household_demographics\n   ,customer_address\n   ,date_dim\nwhere s_store_sk = ss_store_sk\nand  ss_sold_date_sk = d_date_sk and d_year = 2001\nand((ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'M'\nand cd_education_status = '2 yr Degree'\nand ss_sales_price between 100.00 and 150.00\nand hd_dep_count = 3\n   )or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'U'\nand cd_education_status = 'College'\nand ss_sales_price between 50.00 and 100.00\nand hd_dep_count = 1\n   ) or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'S'\nand cd_education_status = 'Unknown'\nand ss_sales_price between 150.00 and 200.00\nand hd_dep_count = 1\n   ))\nand((ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('CO', 'NC', 'TX')\nand ss_net_profit between 100 and 200\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('AR', 'NY', 'TX')\nand ss_net_profit between 150 and 300\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('IA', 'IL', 'NC')\nand ss_net_profit between 50 and 250\n   ));",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Add a range filter on store_sales.ss_sold_date_sk derived from date_dim.d_year=2001 to enable micro-partition pruning in the fact table scan."
    },
    {
      "patch_id": "p03",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.8,
      "status": "NEUTRAL",
      "speedup": 1.01,
      "semantic_passed": true,
      "error": null,
      "original_ms": 158.3,
      "patch_ms": 156.0,
      "output_sql": "WITH preagg_store_sales AS (SELECT ss_store_sk, ss_cdemo_sk, ss_hdemo_sk, ss_sold_date_sk, ss_addr_sk, SUM(ss_quantity) AS sum_ss_quantity, COUNT(ss_quantity) AS count_ss_quantity, SUM(ss_ext_sales_price) AS sum_ss_ext_sales_price, COUNT(ss_ext_sales_price) AS count_ss_ext_sales_price, SUM(ss_ext_wholesale_cost) AS sum_ss_ext_wholesale_cost, COUNT(ss_ext_wholesale_cost) AS count_ss_ext_wholesale_cost FROM store_sales WHERE ss_sold_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_year = 2001) GROUP BY ss_store_sk, ss_cdemo_sk, ss_hdemo_sk, ss_sold_date_sk, ss_addr_sk) select avg(ss_quantity)\n,avg(ss_ext_sales_price)\n,avg(ss_ext_wholesale_cost)\n,sum(ss_ext_wholesale_cost)\nfrom store_sales\n   ,store\n   ,customer_demographics\n   ,household_demographics\n   ,customer_address\n   ,date_dim\nwhere s_store_sk = ss_store_sk\nand  ss_sold_date_sk = d_date_sk and d_year = 2001\nand((ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'M'\nand cd_education_status = '2 yr Degree'\nand ss_sales_price between 100.00 and 150.00\nand hd_dep_count = 3\n   )or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'U'\nand cd_education_status = 'College'\nand ss_sales_price between 50.00 and 100.00\nand hd_dep_count = 1\n   ) or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'S'\nand cd_education_status = 'Unknown'\nand ss_sales_price between 150.00 and 200.00\nand hd_dep_count = 1\n   ))\nand((ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('CO', 'NC', 'TX')\nand ss_net_profit between 100 and 200\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('AR', 'NY', 'TX')\nand ss_net_profit between 150 and 300\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('IA', 'IL', 'NC')\nand ss_net_profit between 50 and 250\n   ));",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-aggregate store_sales by join keys (ss_store_sk, ss_cdemo_sk, ss_hdemo_sk, ss_sold_date_sk, ss_addr_sk) before joining with dimension tables, computing partial sums and counts for averages."
    },
    {
      "patch_id": "p04",
      "family": "A",
      "transform": "early_filter",
      "relevance_score": 0.7,
      "status": "REGRESSION",
      "speedup": 0.93,
      "semantic_passed": true,
      "error": null,
      "original_ms": 158.3,
      "patch_ms": 170.0,
      "output_sql": "WITH cd_filtered AS (SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE cd_marital_status IN ('M', 'U', 'S') AND cd_education_status IN ('2 yr Degree', 'College', 'Unknown')), hd_filtered AS (SELECT hd_demo_sk, hd_dep_count FROM household_demographics WHERE hd_dep_count IN (1, 3)), ca_filtered AS (SELECT ca_address_sk, ca_state, ca_country FROM customer_address WHERE ca_country = 'United States' AND (ca_state IN ('CO', 'NC', 'TX') OR ca_state IN ('AR', 'NY', 'TX') OR ca_state IN ('IA', 'IL', 'NC'))), dd_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001), store_sales_joined AS (SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost FROM store_sales, store, cd_filtered, hd_filtered, ca_filtered, dd_filtered WHERE s_store_sk = ss_store_sk AND ss_sold_date_sk = dd_filtered.d_date_sk AND ss_hdemo_sk = hd_filtered.hd_demo_sk AND cd_filtered.cd_demo_sk = ss_cdemo_sk AND ss_addr_sk = ca_filtered.ca_address_sk AND ((ss_hdemo_sk=hd_filtered.hd_demo_sk AND cd_filtered.cd_marital_status = 'M' AND cd_filtered.cd_education_status = '2 yr Degree' AND ss_sales_price between 100.00 and 150.00 AND hd_filtered.hd_dep_count = 3) OR (ss_hdemo_sk=hd_filtered.hd_demo_sk AND cd_filtered.cd_marital_status = 'U' AND cd_filtered.cd_education_status = 'College' AND ss_sales_price between 50.00 and 100.00 AND hd_filtered.hd_dep_count = 1) OR (ss_hdemo_sk=hd_filtered.hd_demo_sk AND cd_filtered.cd_marital_status = 'S' AND cd_filtered.cd_education_status = 'Unknown' AND ss_sales_price between 150.00 and 200.00 AND hd_filtered.hd_dep_count = 1)) AND ((ss_addr_sk = ca_filtered.ca_address_sk AND ca_filtered.ca_country = 'United States' AND ca_filtered.ca_state in ('CO', 'NC', 'TX') AND ss_net_profit between 100 and 200) OR (ss_addr_sk = ca_filtered.ca_address_sk AND ca_filtered.ca_country = 'United States' AND ca_filtered.ca_state in ('AR', 'NY', 'TX') AND ss_net_profit between 150 and 300) OR (ss_addr_sk = ca_filtered.ca_address_sk AND ca_filtered.ca_country = 'United States' AND ca_filtered.ca_state in ('IA', 'IL', 'NC') AND ss_net_profit between 50 and 250))) SELECT AVG(ss_quantity), AVG(ss_ext_sales_price), AVG(ss_ext_wholesale_cost), SUM(ss_ext_wholesale_cost) FROM store_sales_joined;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Filter dimension tables (customer_demographics, household_demographics, customer_address, date_dim) into CTEs with selective predicates before joining with store_sales to reduce fact scan rows."
    },
    {
      "patch_id": "p07",
      "family": "A",
      "transform": "date_cte_isolate",
      "relevance_score": 0.45,
      "status": "NEUTRAL",
      "speedup": 0.98,
      "semantic_passed": true,
      "error": null,
      "original_ms": 158.3,
      "patch_ms": 161.4,
      "output_sql": "WITH filtered_date_dim AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 2001\n)\nselect avg(ss_quantity)\n,avg(ss_ext_sales_price)\n,avg(ss_ext_wholesale_cost)\n,sum(ss_ext_wholesale_cost)\nfrom store_sales\n   ,store\n   ,customer_demographics\n   ,household_demographics\n   ,customer_address\n   ,filtered_date_dim\nwhere s_store_sk = ss_store_sk\nand  ss_sold_date_sk = filtered_date_dim.d_date_sk\nand((ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'M'\nand cd_education_status = '2 yr Degree'\nand ss_sales_price between 100.00 and 150.00\nand hd_dep_count = 3\n   )or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'U'\nand cd_education_status = 'College'\nand ss_sales_price between 50.00 and 100.00\nand hd_dep_count = 1\n   ) or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'S'\nand cd_education_status = 'Unknown'\nand ss_sales_price between 150.00 and 200.00\nand hd_dep_count = 1\n   ))\nand((ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('CO', 'NC', 'TX')\nand ss_net_profit between 100 and 200\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('AR', 'NY', 'TX')\nand ss_net_profit between 150 and 300\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('IA', 'IL', 'NC')\nand ss_net_profit between 50 and 250\n   ));",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Isolate date_dim filter into a CTE to materialize a small hash table for d_year=2001, improving join efficiency with store_sales."
    },
    {
      "patch_id": "p05",
      "family": "A",
      "transform": "multi_dimension_prefetch",
      "relevance_score": 0.55,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Materialize all selective dimension filters into a single CTE that pre-joins dimension keys, then join with store_sales to compound selectivity."
    },
    {
      "patch_id": "p02",
      "family": "D",
      "transform": "or_to_union",
      "relevance_score": 0.6,
      "status": "REGRESSION",
      "speedup": 0.94,
      "semantic_passed": true,
      "error": null,
      "original_ms": 158.3,
      "patch_ms": 167.5,
      "output_sql": "WITH union_branches AS (SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost\nFROM (\n  SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost\n  FROM store_sales\n  JOIN store ON s_store_sk = ss_store_sk\n  JOIN customer_demographics cd1 ON cd1.cd_demo_sk = ss_cdemo_sk\n  JOIN household_demographics hd1 ON hd1.hd_demo_sk = ss_hdemo_sk\n  JOIN customer_address ca1 ON ca1.ca_address_sk = ss_addr_sk\n  JOIN date_dim d1 ON d1.d_date_sk = ss_sold_date_sk\n  WHERE d1.d_year = 2001\n    AND cd1.cd_marital_status = 'M'\n    AND cd1.cd_education_status = '2 yr Degree'\n    AND ss_sales_price BETWEEN 100.00 AND 150.00\n    AND hd1.hd_dep_count = 3\n    AND ca1.ca_country = 'United States'\n    AND ca1.ca_state IN ('CO', 'NC', 'TX')\n    AND ss_net_profit BETWEEN 100 AND 200\n  UNION ALL\n  SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost\n  FROM store_sales\n  JOIN store ON s_store_sk = ss_store_sk\n  JOIN customer_demographics cd2 ON cd2.cd_demo_sk = ss_cdemo_sk\n  JOIN household_demographics hd2 ON hd2.hd_demo_sk = ss_hdemo_sk\n  JOIN customer_address ca2 ON ca2.ca_address_sk = ss_addr_sk\n  JOIN date_dim d2 ON d2.d_date_sk = ss_sold_date_sk\n  WHERE d2.d_year = 2001\n    AND cd2.cd_marital_status = 'U'\n    AND cd2.cd_education_status = 'College'\n    AND ss_sales_price BETWEEN 50.00 AND 100.00\n    AND hd2.hd_dep_count = 1\n    AND ca2.ca_country = 'United States'\n    AND ca2.ca_state IN ('AR', 'NY', 'TX')\n    AND ss_net_profit BETWEEN 150 AND 300\n  UNION ALL\n  SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost\n  FROM store_sales\n  JOIN store ON s_store_sk = ss_store_sk\n  JOIN customer_demographics cd3 ON cd3.cd_demo_sk = ss_cdemo_sk\n  JOIN household_demographics hd3 ON hd3.hd_demo_sk = ss_hdemo_sk\n  JOIN customer_address ca3 ON ca3.ca_address_sk = ss_addr_sk\n  JOIN date_dim d3 ON d3.d_date_sk = ss_sold_date_sk\n  WHERE d3.d_year = 2001\n    AND cd3.cd_marital_status = 'S'\n    AND cd3.cd_education_status = 'Unknown'\n    AND ss_sales_price BETWEEN 150.00 AND 200.00\n    AND hd3.hd_dep_count = 1\n    AND ca3.ca_country = 'United States'\n    AND ca3.ca_state IN ('IA', 'IL', 'NC')\n    AND ss_net_profit BETWEEN 50 AND 250\n)) select avg(ss_quantity)\n,avg(ss_ext_sales_price)\n,avg(ss_ext_wholesale_cost)\n,sum(ss_ext_wholesale_cost)\nfrom store_sales\n   ,store\n   ,customer_demographics\n   ,household_demographics\n   ,customer_address\n   ,date_dim\nwhere s_store_sk = ss_store_sk\nand  ss_sold_date_sk = d_date_sk and d_year = 2001\nand((ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'M'\nand cd_education_status = '2 yr Degree'\nand ss_sales_price between 100.00 and 150.00\nand hd_dep_count = 3\n   )or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'U'\nand cd_education_status = 'College'\nand ss_sales_price between 50.00 and 100.00\nand hd_dep_count = 1\n   ) or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'S'\nand cd_education_status = 'Unknown'\nand ss_sales_price between 150.00 and 200.00\nand hd_dep_count = 1\n   ))\nand((ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('CO', 'NC', 'TX')\nand ss_net_profit between 100 and 200\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('AR', 'NY', 'TX')\nand ss_net_profit between 150 and 300\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('IA', 'IL', 'NC')\nand ss_net_profit between 50 and 250\n   ));",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Decompose OR conditions into separate UNION ALL branches, each with focused predicates on customer_demographics, household_demographics, and customer_address, while preserving aggregates."
    },
    {
      "patch_id": "p10",
      "family": "B",
      "transform": "sf_inline_decorrelate",
      "relevance_score": 0.3,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": false,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select avg(ss_quantity)\n,avg(ss_ext_sales_price)\n,avg(ss_ext_wholesale_cost)\n,sum(ss_ext_wholesale_cost)\nfrom store_sales\n   ,store\n   ,customer_demographics\n   ,household_demographics\n   ,customer_address\n   ,date_dim\nwhere s_store_sk = ss_store_sk\nand  ss_sold_date_sk = d_date_sk and d_year = 2001\nand((ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'M'\nand cd_education_status = '2 yr Degree'\nand ss_sales_price between 100.00 and 150.00\nand hd_dep_count = 3\n   )or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'U'\nand cd_education_status = 'College'\nand ss_sales_price between 50.00 and 100.00\nand hd_dep_count = 1\n   ) or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'S'\nand cd_education_status = 'Unknown'\nand ss_sales_price between 150.00 and 200.00\nand hd_dep_count = 1\n   ))\nand((ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('CO', 'NC', 'TX')\nand ss_net_profit between 100 and 200\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('AR', 'NY', 'TX')\nand ss_net_profit between 150 and 300\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('IA', 'IL', 'NC')\nand ss_net_profit between 50 and 250\n   ));",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Decompose any potential scalar subquery correlation (none present) into CTEs as an exploratory test, but adapt for aggregate pushdown patterns."
    }
  ],
  "explains": {
    "p11": "GlobalStats | 72978 | 70672 | 1213414464512\n1 | 0 | Result | SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*))))))), COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))) / (COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_WHOLESALE_COST, COUNT(",
    "p01": "GlobalStats | 72978 | 70672 | 1213414464512\n1 | 0 | Result | SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*))))))), COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))) / (COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_WHOLESALE_COST, COUNT(",
    "p03": "GlobalStats | 72978 | 70672 | 1213414464512\n1 | 0 | Result | SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*))))))), COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))) / (COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_WHOLESALE_COST, COUNT(",
    "p04": "GlobalStats | 72978 | 70672 | 1213414464512\n1 | 0 | Result | SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*))))))), COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))) / (COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_WHOLESALE_COST, COUNT(",
    "p07": "GlobalStats | 72978 | 70672 | 1213414464512\n1 | 0 | Result | SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*))))))), COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))) / (COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_WHOLESALE_COST, COUNT(",
    "p02": "GlobalStats | 72978 | 70672 | 1213414464512\n1 | 0 | Result | SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*))))))), COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))) / (COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_WHOLESALE_COST, COUNT("
  }
}