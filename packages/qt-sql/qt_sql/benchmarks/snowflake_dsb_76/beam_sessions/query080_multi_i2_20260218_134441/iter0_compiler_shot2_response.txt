```json
[
  {
    "plan_id": "attempt_p01_p03_hybrid",
    "dialect": "snowflake",
    "confidence": 0.72,
    "based_on": "p01,p03",
    "strategy": "Combine shared dimension CTE with date_sk pushdown for micro-partition pruning.",
    "hypothesis": "Probes p01 (1.06x) and p03 (1.06x) both showed improvement. Shared dimension CTE avoids redundant dimension scans while date_sk pushdown enables fact-table micro-partition pruning. Combining both addresses 95% of scan volume.",
    "expected_explain_delta": "Fact table scans should show micro-partition pruning via date_sk range; dimension scans reduced from 9 to 3.",
    "target_ir": "Add shared_dimensions CTE and date_range CTE; modify ssr, csr, wsr to use both.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "shared_dimensions",
          "parent_node_id": "final_select",
          "sources": ["date_dim", "item", "promotion"],
          "outputs": ["d_date_sk", "i_item_sk", "p_promo_sk"],
          "changed": true,
          "sql": "SELECT d_date_sk, i_item_sk, p_promo_sk FROM date_dim, item, promotion WHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 day' AND i_current_price > 50 AND i_category IN ('Men', 'Music') AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N'"
        },
        {
          "node_id": "date_range",
          "parent_node_id": "final_select",
          "sources": ["date_dim"],
          "outputs": ["min_d_date_sk", "max_d_date_sk"],
          "changed": true,
          "sql": "SELECT MIN(d_date_sk) AS min_d_date_sk, MAX(d_date_sk) AS max_d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 day'"
        },
        {
          "node_id": "ssr",
          "parent_node_id": "final_select",
          "sources": ["store_sales", "store_returns", "shared_dimensions", "store", "date_range"],
          "outputs": ["store_id", "sales", "returns", "profit"],
          "changed": true,
          "sql": "SELECT s_store_id AS store_id, SUM(ss_ext_sales_price) AS sales, SUM(COALESCE(sr_return_amt, 0)) AS returns, SUM(ss_net_profit - COALESCE(sr_net_loss, 0)) AS profit FROM store_sales LEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number), shared_dimensions, store WHERE ss_sold_date_sk = shared_dimensions.d_date_sk AND ss_store_sk = s_store_sk AND ss_item_sk = shared_dimensions.i_item_sk AND ss_promo_sk = shared_dimensions.p_promo_sk AND ss_wholesale_cost BETWEEN 21 AND 36 AND ss_sold_date_sk BETWEEN (SELECT min_d_date_sk FROM date_range) AND (SELECT max_d_date_sk FROM date_range) GROUP BY s_store_id"
        },
        {
          "node_id": "csr",
          "parent_node_id": "final_select",
          "sources": ["catalog_sales", "catalog_returns", "shared_dimensions", "catalog_page", "date_range"],
          "outputs": ["catalog_page_id", "sales", "returns", "profit"],
          "changed": true,
          "sql": "SELECT cp_catalog_page_id AS catalog_page_id, SUM(cs_ext_sales_price) AS sales, SUM(COALESCE(cr_return_amount, 0)) AS returns, SUM(cs_net_profit - COALESCE(cr_net_loss, 0)) AS profit FROM catalog_sales LEFT OUTER JOIN catalog_returns ON (cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number), shared_dimensions, catalog_page WHERE cs_sold_date_sk = shared_dimensions.d_date_sk AND cs_catalog_page_sk = cp_catalog_page_sk AND cs_item_sk = shared_dimensions.i_item_sk AND cs_promo_sk = shared_dimensions.p_promo_sk AND cs_wholesale_cost BETWEEN 21 AND 36 AND cs_sold_date_sk BETWEEN (SELECT min_d_date_sk FROM date_range) AND (SELECT max_d_date_sk FROM date_range) GROUP BY cp_catalog_page_id"
        },
        {
          "node_id": "wsr",
          "parent_node_id": "final_select",
          "sources": ["web_sales", "web_returns", "shared_dimensions", "web_site", "date_range"],
          "outputs": ["web_site_id", "sales", "returns", "profit"],
          "changed": true,
          "sql": "SELECT web_site_id, SUM(ws_ext_sales_price) AS sales, SUM(COALESCE(wr_return_amt, 0)) AS returns, SUM(ws_net_profit - COALESCE(wr_net_loss, 0)) AS profit FROM web_sales LEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number), shared_dimensions, web_site WHERE ws_sold_date_sk = shared_dimensions.d_date_sk AND ws_web_site_sk = web_site_sk AND ws_item_sk = shared_dimensions.i_item_sk AND ws_promo_sk = shared_dimensions.p_promo_sk AND ws_wholesale_cost BETWEEN 21 AND 36 AND ws_sold_date_sk BETWEEN (SELECT min_d_date_sk FROM date_range) AND (SELECT max_d_date_sk FROM date_range) GROUP BY web_site_id"
        },
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["ssr", "csr", "wsr"],
          "outputs": ["channel", "id", "sales", "returns", "profit"],
          "changed": false
        }
      ]
    }
  },
  {
    "plan_id": "attempt_p01_pushdown_only",
    "dialect": "snowflake",
    "confidence": 0.68,
    "based_on": "p01",
    "strategy": "Date_sk pushdown only, preserving original comma-join structure.",
    "hypothesis": "Simplest safe improvement: adding date_sk range pushdown to fact tables enables micro-partition pruning. Minimal structural change reduces risk while addressing primary scan hotspot.",
    "expected_explain_delta": "Fact table scans show micro-partition pruning via date_sk range filters.",
    "target_ir": "Modify ssr, csr, wsr to include date_sk BETWEEN subqueries.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "ssr",
          "parent_node_id": "final_select",
          "sources": ["store_sales", "store_returns", "date_dim", "store", "item", "promotion"],
          "outputs": ["store_id", "sales", "returns", "profit"],
          "changed": true,
          "sql": "SELECT s_store_id AS store_id, SUM(ss_ext_sales_price) AS sales, SUM(COALESCE(sr_return_amt, 0)) AS returns, SUM(ss_net_profit - COALESCE(sr_net_loss, 0)) AS profit FROM store_sales LEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number), date_dim, store, item, promotion WHERE ss_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 day' AND ss_store_sk = s_store_sk AND ss_item_sk = i_item_sk AND i_current_price > 50 AND ss_promo_sk = p_promo_sk AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND ss_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') AND ss_sold_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim WHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 day') AND (SELECT MAX(d_date_sk) FROM date_dim WHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 day') GROUP BY s_store_id"
        },
        {
          "node_id": "csr",
          "parent_node_id": "final_select",
          "sources": ["catalog_sales", "catalog_returns", "date_dim", "catalog_page", "item", "promotion"],
          "outputs": ["catalog_page_id", "sales", "returns", "profit"],
          "changed": true,
          "sql": "SELECT cp_catalog_page_id AS catalog_page_id, SUM(cs_ext_sales_price) AS sales, SUM(COALESCE(cr_return_amount, 0)) AS returns, SUM(cs_net_profit - COALESCE(cr_net_loss, 0)) AS profit FROM catalog_sales LEFT OUTER JOIN catalog_returns ON (cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number), date_dim, catalog_page, item, promotion WHERE cs_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 day' AND cs_catalog_page_sk = cp_catalog_page_sk AND cs_item_sk = i_item_sk AND i_current_price > 50 AND cs_promo_sk = p_promo_sk AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND cs_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') AND cs_sold_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim WHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 day') AND (SELECT MAX(d_date_sk) FROM date_dim WHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 day') GROUP BY cp_catalog_page_id"
        },
        {
          "node_id": "wsr",
          "parent_node_id": "final_select",
          "sources": ["web_sales", "web_returns", "date_dim", "web_site", "item", "promotion"],
          "outputs": ["web_site_id", "sales", "returns", "profit"],
          "changed": true,
          "sql": "SELECT web_site_id, SUM(ws_ext_sales_price) AS sales, SUM(COALESCE(wr_return_amt, 0)) AS returns, SUM(ws_net_profit - COALESCE(wr_net_loss, 0)) AS profit FROM web_sales LEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number), date_dim, web_site, item, promotion WHERE ws_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 day' AND ws_web_site_sk = web_site_sk AND ws_item_sk = i_item_sk AND i_current_price > 50 AND ws_promo_sk = p_promo_sk AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND ws_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') AND ws_sold_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim WHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 day') AND (SELECT MAX(d_date_sk) FROM date_dim WHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 day') GROUP BY web_site_id"
        },
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["ssr", "csr", "wsr"],
          "outputs": ["channel", "id", "sales", "returns", "profit"],
          "changed": false
        }
      ]
    }
  },
  {
    "plan_id": "attempt_residual_gap",
    "dialect": "snowflake",
    "confidence": 0.45,
    "based_on": "p02",
    "strategy": "Early aggregation with corrected column references to reduce join amplification.",
    "hypothesis": "Probe p02 failed with syntax error due to missing column. Residual gap: fact tables join dimensions before aggregation, amplifying rows. Pre-aggregating fact+returns tables before joining dimensions could reduce join cost if corrected. This attempts safe correction.",
    "expected_explain_delta": "Aggregate operators move earlier in plan; join cardinality reduced.",
    "target_ir": "Add pre-aggregate CTEs for each channel with correct column set, then join filtered dimensions.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "date_filter",
          "parent_node_id": "final_select",
          "sources": ["date_dim"],
          "outputs": ["d_date_sk"],
          "changed": true,
          "sql": "SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 day'"
        },
        {
          "node_id": "item_filter",
          "parent_node_id": "final_select",
          "sources": ["item"],
          "outputs": ["i_item_sk"],
          "changed": true,
          "sql": "SELECT i_item_sk FROM item WHERE i_current_price > 50 AND i_category IN ('Men', 'Music')"
        },
        {
          "node_id": "promotion_filter",
          "parent_node_id": "final_select",
          "sources": ["promotion"],
          "outputs": ["p_promo_sk"],
          "changed": true,
          "sql": "SELECT p_promo_sk FROM promotion WHERE p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N'"
        },
        {
          "node_id": "ssr",
          "parent_node_id": "final_select",
          "sources": ["store_sales", "store_returns", "date_filter", "store", "item_filter", "promotion_filter"],
          "outputs": ["store_id", "sales", "returns", "profit"],
          "changed": true,
          "sql": "SELECT s_store_id AS store_id, SUM(agg.sales) AS sales, SUM(agg.returns) AS returns, SUM(agg.profit) AS profit FROM (SELECT ss_store_sk, ss_item_sk, ss_promo_sk, SUM(ss_ext_sales_price) AS sales, SUM(COALESCE(sr_return_amt, 0)) AS returns, SUM(ss_net_profit - COALESCE(sr_net_loss, 0)) AS profit FROM store_sales LEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number) WHERE ss_sold_date_sk IN (SELECT d_date_sk FROM date_filter) AND ss_wholesale_cost BETWEEN 21 AND 36 GROUP BY ss_store_sk, ss_item_sk, ss_promo_sk) agg JOIN store ON agg.ss_store_sk = s_store_sk JOIN item_filter ON agg.ss_item_sk = item_filter.i_item_sk JOIN promotion_filter ON agg.ss_promo_sk = promotion_filter.p_promo_sk GROUP BY s_store_id"
        },
        {
          "node_id": "csr",
          "parent_node_id": "final_select",
          "sources": ["catalog_sales", "catalog_returns", "date_filter", "catalog_page", "item_filter", "promotion_filter"],
          "outputs": ["catalog_page_id", "sales", "returns", "profit"],
          "changed": true,
          "sql": "SELECT cp_catalog_page_id AS catalog_page_id, SUM(agg.sales) AS sales, SUM(agg.returns) AS returns, SUM(agg.profit) AS profit FROM (SELECT cs_catalog_page_sk, cs_item_sk, cs_promo_sk, SUM(cs_ext_sales_price) AS sales, SUM(COALESCE(cr_return_amount, 0)) AS returns, SUM(cs_net_profit - COALESCE(cr_net_loss, 0)) AS profit FROM catalog_sales LEFT OUTER JOIN catalog_returns ON (cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number) WHERE cs_sold_date_sk IN (SELECT d_date_sk FROM date_filter) AND cs_wholesale_cost BETWEEN 21 AND 36 GROUP BY cs_catalog_page_sk, cs_item_sk, cs_promo_sk) agg JOIN catalog_page ON agg.cs_catalog_page_sk = cp_catalog_page_sk JOIN item_filter ON agg.cs_item_sk = item_filter.i_item_sk JOIN promotion_filter ON agg.cs_promo_sk = promotion_filter.p_promo_sk GROUP BY cp_catalog_page_id"
        },
        {
          "node_id": "wsr",
          "parent_node_id": "final_select",
          "sources": ["web_sales", "web_returns", "date_filter", "web_site", "item_filter", "promotion_filter"],
          "outputs": ["web_site_id", "sales", "returns", "profit"],
          "changed": true,
          "sql": "SELECT web_site_id, SUM(agg.sales) AS sales, SUM(agg.returns) AS returns, SUM(agg.profit) AS profit FROM (SELECT ws_web_site_sk, ws_item_sk, ws_promo_sk, SUM(ws_ext_sales_price) AS sales, SUM(COALESCE(wr_return_amt, 0)) AS returns, SUM(ws_net_profit - COALESCE(wr_net_loss, 0)) AS profit FROM web_sales LEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number) WHERE ws_sold_date_sk IN (SELECT d_date_sk FROM date_filter) AND ws_wholesale_cost BETWEEN 21 AND 36 GROUP BY ws_web_site_sk, ws_item_sk, ws_promo_sk) agg JOIN web_site ON agg.ws_web_site_sk = web_site_sk JOIN item_filter ON agg.ws_item_sk = item_filter.i_item_sk JOIN promotion_filter ON agg.ws_promo_sk = promotion_filter.p_promo_sk GROUP BY web_site_id"
        },
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["ssr", "csr", "wsr"],
          "outputs": ["channel", "id", "sales", "returns", "profit"],
          "changed": false
        }
      ]
    }
  }
]
```