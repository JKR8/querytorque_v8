```json
{
  "plan_id": "compile_p1",
  "dialect": "snowflake",
  "confidence": 0.65,
  "based_on": "p01,p04",
  "strategy": "Explicit join conversion with filtered date_dim CTE to push predicate into store_sales scan",
  "hypothesis": "Convert comma joins to explicit INNER JOINs and push d1.d_year=1998 into a filtered CTE, enabling micro-partition pruning on store_sales.ss_sold_date_sk. This targets the largest hotspot (store_sales 1.2TB) by reducing scanned bytes early.",
  "expected_explain_delta": "Store_sales scan should show predicate on ss_sold_date_sk derived from d1.d_year=1998; join order may shift to push dimension filters earlier.",
  "target_ir": "Rewrite final_select with explicit joins and a filtered d1 CTE, preserving all original semantics.",
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["store_sales", "web_sales", "date_dim", "customer", "inventory", "store", "warehouse", "item", "customer_demographics", "household_demographics", "customer_address"],
        "outputs": ["cd_gender", "cd_marital_status", "cd_education_status", "hd_vehicle_count", "cnt"],
        "changed": true,
        "sql": "WITH d1_filtered AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 1998) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales INNER JOIN d1_filtered d1 ON store_sales.ss_sold_date_sk = d1.d_date_sk INNER JOIN web_sales ON web_sales.ws_item_sk = store_sales.ss_item_sk INNER JOIN date_dim d2 ON web_sales.ws_sold_date_sk = d2.d_date_sk INNER JOIN customer ON store_sales.ss_customer_sk = customer.c_customer_sk AND web_sales.ws_bill_customer_sk = customer.c_customer_sk INNER JOIN item ON store_sales.ss_item_sk = item.i_item_sk INNER JOIN inventory ON inventory.inv_item_sk = store_sales.ss_item_sk AND inventory.inv_date_sk = store_sales.ss_sold_date_sk AND inventory.inv_warehouse_sk = web_sales.ws_warehouse_sk INNER JOIN warehouse ON web_sales.ws_warehouse_sk = warehouse.w_warehouse_sk INNER JOIN store ON store.s_state = warehouse.w_state INNER JOIN customer_demographics ON customer.c_current_cdemo_sk = customer_demographics.cd_demo_sk INNER JOIN household_demographics ON customer.c_current_hdemo_sk = household_demographics.hd_demo_sk INNER JOIN customer_address ON customer.c_current_addr_sk = customer_address.ca_address_sk WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 day') AND inventory.inv_quantity_on_hand >= store_sales.ss_quantity AND item.i_category IN ('Men', 'Shoes', 'Sports') AND item.i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98) AND customer_address.ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA') AND web_sales.ws_wholesale_cost BETWEEN 76 AND 96 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt"
      }
    ]
  }
}
```