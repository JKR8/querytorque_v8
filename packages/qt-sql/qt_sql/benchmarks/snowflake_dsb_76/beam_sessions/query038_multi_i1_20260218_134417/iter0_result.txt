{
  "iteration": 0,
  "n_api_calls": 9,
  "beam_cost_usd": 0.02917754,
  "beam_cost_priced_calls": 8,
  "beam_cost_unpriced_calls": 1,
  "beam_token_totals": {
    "prompt_tokens": 90021,
    "completion_tokens": 24830,
    "total_tokens": 114851,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 25344,
    "reasoning_tokens": 12975
  },
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "p01",
      "family": "A",
      "transform": "sf_sk_pushdown_multi_fact",
      "relevance_score": 0.85,
      "status": "REGRESSION",
      "speedup": 0.94,
      "semantic_passed": true,
      "error": null,
      "original_ms": 152.4,
      "patch_ms": 161.8,
      "output_sql": "select  count(*) from (\n    select distinct c_last_name, c_first_name, d_date\n    from store_sales, date_dim, customer\n          where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n      and store_sales.ss_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1200 and 1200 + 11\n      and c_birth_month in (1, 2, 5, 12)\n      and ss_list_price between 193 and 252\n      and ss_wholesale_cost BETWEEN 35 AND 55\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from catalog_sales, date_dim, customer\n          where catalog_sales.cs_sold_date_sk = date_dim.d_date_sk\n      and catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1200 and 1200 + 11\n      and c_birth_month in (1, 2, 5, 12)\n      and cs_list_price between 193 and 252\n      and cs_wholesale_cost BETWEEN 35 AND 55\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from web_sales, date_dim, customer\n          where web_sales.ws_sold_date_sk = date_dim.d_date_sk\n      and web_sales.ws_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1200 and 1200 + 11\n      and c_birth_month in (1, 2, 5, 12)\n      and ws_list_price between 193 and 252\n      and ws_wholesale_cost BETWEEN 35 AND 55\n) hot_cust\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Push date_sk BETWEEN filter derived from d_month_seq range into each fact table scan (store_sales, catalog_sales, web_sales) to prune micro-partitions. Compute min/max date_sk from date_dim WHERE d_month_seq BETWEEN 1200 AND 1211."
    },
    {
      "patch_id": "p04",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.75,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": false,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select  count(*) from (\n    select distinct c_last_name, c_first_name, d_date\n    from store_sales, date_dim, customer\n          where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n      and store_sales.ss_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1200 and 1200 + 11\n      and c_birth_month in (1, 2, 5, 12)\n      and ss_list_price between 193 and 252\n      and ss_wholesale_cost BETWEEN 35 AND 55\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from catalog_sales, date_dim, customer\n          where catalog_sales.cs_sold_date_sk = date_dim.d_date_sk\n      and catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1200 and 1200 + 11\n      and c_birth_month in (1, 2, 5, 12)\n      and cs_list_price between 193 and 252\n      and cs_wholesale_cost BETWEEN 35 AND 55\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from web_sales, date_dim, customer\n          where web_sales.ws_sold_date_sk = date_dim.d_date_sk\n      and web_sales.ws_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1200 and 1200 + 11\n      and c_birth_month in (1, 2, 5, 12)\n      and ws_list_price between 193 and 252\n      and ws_wholesale_cost BETWEEN 35 AND 55\n) hot_cust\nlimit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre-aggregate each fact table by (sold_date_sk, customer_sk) before joining dimensions to reduce rows early."
    },
    {
      "patch_id": "p02",
      "family": "D",
      "transform": "intersect_to_exists",
      "relevance_score": 0.65,
      "status": "REGRESSION",
      "speedup": 0.89,
      "semantic_passed": true,
      "error": null,
      "original_ms": 152.4,
      "patch_ms": 171.7,
      "output_sql": "WITH intersect_rewrite AS (SELECT DISTINCT c.c_last_name, c.c_first_name, d.d_date\nFROM store_sales ss\nJOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk\nJOIN customer c ON ss.ss_customer_sk = c.c_customer_sk\nWHERE d.d_month_seq BETWEEN 1200 AND 1211\n  AND c.c_birth_month IN (1, 2, 5, 12)\n  AND ss.ss_list_price BETWEEN 193 AND 252\n  AND ss.ss_wholesale_cost BETWEEN 35 AND 55\n  AND EXISTS (\n    SELECT 1 FROM catalog_sales cs\n    JOIN date_dim d2 ON cs.cs_sold_date_sk = d2.d_date_sk\n    JOIN customer c2 ON cs.cs_bill_customer_sk = c2.c_customer_sk\n    WHERE d2.d_month_seq BETWEEN 1200 AND 1211\n      AND c2.c_birth_month IN (1, 2, 5, 12)\n      AND cs.cs_list_price BETWEEN 193 AND 252\n      AND cs.cs_wholesale_cost BETWEEN 35 AND 55\n      AND c2.c_last_name = c.c_last_name\n      AND c2.c_first_name = c.c_first_name\n      AND d2.d_date = d.d_date\n  )\n  AND EXISTS (\n    SELECT 1 FROM web_sales ws\n    JOIN date_dim d3 ON ws.ws_sold_date_sk = d3.d_date_sk\n    JOIN customer c3 ON ws.ws_bill_customer_sk = c3.c_customer_sk\n    WHERE d3.d_month_seq BETWEEN 1200 AND 1211\n      AND c3.c_birth_month IN (1, 2, 5, 12)\n      AND ws.ws_list_price BETWEEN 193 AND 252\n      AND ws.ws_wholesale_cost BETWEEN 35 AND 55\n      AND c3.c_last_name = c.c_last_name\n      AND c3.c_first_name = c.c_first_name\n      AND d3.d_date = d.d_date\n  )) select  count(*) from (\n    select distinct c_last_name, c_first_name, d_date\n    from store_sales, date_dim, customer\n          where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n      and store_sales.ss_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1200 and 1200 + 11\n      and c_birth_month in (1, 2, 5, 12)\n      and ss_list_price between 193 and 252\n      and ss_wholesale_cost BETWEEN 35 AND 55\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from catalog_sales, date_dim, customer\n          where catalog_sales.cs_sold_date_sk = date_dim.d_date_sk\n      and catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1200 and 1200 + 11\n      and c_birth_month in (1, 2, 5, 12)\n      and cs_list_price between 193 and 252\n      and cs_wholesale_cost BETWEEN 35 AND 55\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from web_sales, date_dim, customer\n          where web_sales.ws_sold_date_sk = date_dim.d_date_sk\n      and web_sales.ws_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1200 and 1200 + 11\n      and c_birth_month in (1, 2, 5, 12)\n      and ws_list_price between 193 and 252\n      and ws_wholesale_cost BETWEEN 35 AND 55\n) hot_cust\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Replace INTERSECT with EXISTS to avoid materializing full distinct per-branch; rewrite as WHERE EXISTS (SELECT 1 FROM branch2 WHERE ...) AND EXISTS (SELECT 1 FROM branch3 WHERE ...) on first branch."
    },
    {
      "patch_id": "p03",
      "family": "A",
      "transform": "shared_dimension_multi_channel",
      "relevance_score": 0.55,
      "status": "REGRESSION",
      "speedup": 0.84,
      "semantic_passed": true,
      "error": null,
      "original_ms": 152.4,
      "patch_ms": 182.3,
      "output_sql": "WITH filtered_date AS (select d_date_sk, d_date from date_dim where d_month_seq between 1200 and 1211), filtered_customer AS (select c_customer_sk, c_first_name, c_last_name from customer where c_birth_month in (1,2,5,12)), ss_branch AS (select distinct c.c_last_name, c.c_first_name, d.d_date\nfrom store_sales ss\njoin filtered_date d on ss.ss_sold_date_sk = d.d_date_sk\njoin filtered_customer c on ss.ss_customer_sk = c.c_customer_sk\nwhere ss.ss_list_price between 193 and 252\n  and ss.ss_wholesale_cost BETWEEN 35 AND 55), cs_branch AS (select distinct c.c_last_name, c.c_first_name, d.d_date\nfrom catalog_sales cs\njoin filtered_date d on cs.cs_sold_date_sk = d.d_date_sk\njoin filtered_customer c on cs.cs_bill_customer_sk = c.c_customer_sk\nwhere cs.cs_list_price between 193 and 252\n  and cs.cs_wholesale_cost BETWEEN 35 AND 55), ws_branch AS (select distinct c.c_last_name, c.c_first_name, d.d_date\nfrom web_sales ws\njoin filtered_date d on ws.ws_sold_date_sk = d.d_date_sk\njoin filtered_customer c on ws.ws_bill_customer_sk = c.c_customer_sk\nwhere ws.ws_list_price between 193 and 252\n  and ws.ws_wholesale_cost BETWEEN 35 AND 55), hot_cust AS (select distinct c_last_name, c_first_name, d_date from ss_branch\nintersect\nselect distinct c_last_name, c_first_name, d_date from cs_branch\nintersect\nselect distinct c_last_name, c_first_name, d_date from ws_branch) select count(*) from hot_cust limit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Extract filtered date_dim and customer into CTEs and reuse across three branches to avoid repeated dimension scans and early filtering."
    },
    {
      "patch_id": "compile_shared_dims",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Missing SQL for tree node `store_sales`",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "compile_fact_pushdown",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Missing SQL for tree node `store_sales`",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "compile_shared_dims",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Missing SQL for tree node `store_sales`",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "compile_fact_pushdown",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Missing SQL for tree node `store_sales`",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": null
    }
  ],
  "explains": {
    "p01": "GlobalStats | 156005 | 156005 | 2643575084032\n1 | 0 | Result | COUNT(*)\n1 | 1 | [0] | Limit | rowCount: 100\n1 | 2 | [1] | Aggregate | aggExprs: [COUNT(*)]\n1 | 3 | [2] | Aggregate | groupKeys: [CUSTOMER.C_LAST_NAME, CUSTOMER.C_FIRST_NAME, DATE_DIM.D_DATE]\n1 | 4 | [3] | Aggregate | groupKeys: [CUSTOMER.C_LAST_NAME, CUSTOMER.C_FIRST_NAME, DATE_DIM.D_DATE]\n1 | 5 | [4] | SemiJoin | joinKey: (CUSTOMER.C_FIRST_NAME = CUSTOMER.C_FIRST_NAME) AND (CUSTOMER.C_LAST_NAME = CUSTOMER.C_LAST_NAME) AND (DATE_DIM",
    "p02": "GlobalStats | 156005 | 156005 | 2643575084032\n1 | 0 | Result | COUNT(*)\n1 | 1 | [0] | Limit | rowCount: 100\n1 | 2 | [1] | Aggregate | aggExprs: [COUNT(*)]\n1 | 3 | [2] | Aggregate | groupKeys: [CUSTOMER.C_LAST_NAME, CUSTOMER.C_FIRST_NAME, DATE_DIM.D_DATE]\n1 | 4 | [3] | Aggregate | groupKeys: [CUSTOMER.C_LAST_NAME, CUSTOMER.C_FIRST_NAME, DATE_DIM.D_DATE]\n1 | 5 | [4] | SemiJoin | joinKey: (CUSTOMER.C_FIRST_NAME = CUSTOMER.C_FIRST_NAME) AND (CUSTOMER.C_LAST_NAME = CUSTOMER.C_LAST_NAME) AND (DATE_DIM",
    "p03": "GlobalStats | 155481 | 155481 | 2638913729536\n1 | 0 | Result | COUNT(*)\n1 | 1 | [0] | Limit | rowCount: 100\n1 | 2 | [1] | Aggregate | aggExprs: [COUNT(*)]\n1 | 3 | [2] | Aggregate | groupKeys: [C.C_LAST_NAME, C.C_FIRST_NAME, D.D_DATE]\n1 | 4 | [3] | Aggregate | groupKeys: [C.C_LAST_NAME, C.C_FIRST_NAME, D.D_DATE]\n1 | 5 | [4] | SemiJoin | joinKey: (C.C_FIRST_NAME = C.C_FIRST_NAME) AND (C.C_LAST_NAME = C.C_LAST_NAME) AND (D.D_DATE = D.D_DATE)\n1 | 6 | [5] | Aggregate | groupKeys: [C.C_LAST_NAME, C.C_"
  }
}