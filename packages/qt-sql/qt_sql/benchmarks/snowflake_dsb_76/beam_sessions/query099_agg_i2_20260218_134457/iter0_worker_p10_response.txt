{
  "probe_id": "scout_lane_probe",
  "transform_id": "channel_bitmap_aggregation",
  "family": "C",
  "status": "success",
  "dialect": "snowflake",
  "hypothesis": "Rewriting the five CASE-based conditional aggregations into a single IFF-based bucket assignment followed by GROUP BY and COUNT aggregation may reduce CPU overhead in Snowflake by consolidating expression evaluation.",
  "reasoning_trace": [
    "Assigned transform targets CASE-aggregation redundancy in the final aggregate.",
    "Bitmap-style aggregation using IFF to classify rows into buckets allows a single scan with bucket-key grouping.",
    "Final bucket counts are preserved via COUNT(*) per bucket after grouping."
  ],
  "target_ir": "Single-pass bucket assignment replaces five CASE expressions; aggregation consolidates counts by bucket key.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["bucketed_aggregation", "warehouse", "ship_mode", "call_center"],
        "outputs": [
          "SUBSTRING(w_warehouse_name, 1, 20)",
          "sm_type",
          "cc_name",
          "30 days",
          "31-60 days",
          "61-90 days",
          "91-120 days",
          ">120 days"
        ],
        "changed": false
      },
      {
        "node_id": "bucketed_aggregation",
        "parent_node_id": "final_select",
        "sources": ["catalog_sales_filtered", "date_dim"],
        "outputs": [
          "w_warehouse_name_sub",
          "sm_type",
          "cc_name",
          "30 days",
          "31-60 days",
          "61-90 days",
          "91-120 days",
          ">120 days"
        ],
        "changed": true,
        "sql": "SELECT SUBSTRING(w_warehouse_name, 1, 20) AS w_warehouse_name_sub, sm_type, cc_name, IFF((cs_ship_date_sk - cs_sold_date_sk) <= 30, 0, IFF((cs_ship_date_sk - cs_sold_date_sk) > 30 AND (cs_ship_date_sk - cs_sold_date_sk) <= 60, 1, IFF((cs_ship_date_sk - cs_sold_date_sk) > 60 AND (cs_ship_date_sk - cs_sold_date_sk) <= 90, 2, IFF((cs_ship_date_sk - cs_sold_date_sk) > 90 AND (cs_ship_date_sk - cs_sold_date_sk) <= 120, 3, IFF((cs_ship_date_sk - cs_sold_date_sk) > 120, 4, NULL))))) AS bucket_id, COUNT(*) AS bucket_count FROM catalog_sales_filtered cs JOIN date_dim d ON cs.cs_ship_date_sk = d.d_date_sk GROUP BY w_warehouse_name_sub, sm_type, cc_name, bucket_id"
      },
      {
        "node_id": "catalog_sales_filtered",
        "parent_node_id": "bucketed_aggregation",
        "sources": ["catalog_sales", "warehouse", "ship_mode", "call_center"],
        "outputs": ["cs_sold_date_sk", "cs_ship_date_sk", "cs_call_center_sk", "cs_ship_mode_sk", "cs_warehouse_sk", "cs_list_price"],
        "changed": false
      }
    ]
  }
}