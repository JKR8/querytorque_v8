{
  "probe_id": "scout_001",
  "transform_id": "aggregate_pushdown",
  "family": "C",
  "status": "success",
  "dialect": "snowflake",
  "hypothesis": "Pre-aggregating catalog_sales by warehouse, ship date, call center, and ship mode keys reduces data volume before dimension joins while preserving grouping and bucket logic.",
  "reasoning_trace": [
    "Target node scans full catalog_sales (54922/54922 parts) without early filtering.",
    "Assigned transform targets aggregation pushdown on cs_warehouse_sk, cs_ship_date_sk, cs_call_center_sk, cs_ship_mode_sk.",
    "Grouping keys in original query align with join keys to dimension tables.",
    "Conditional sum buckets can be computed early without semantic change."
  ],
  "target_ir": "Insert early aggregate CTE (catalog_sales_preagg) grouped by cs_warehouse_sk, cs_ship_date_sk, cs_call_center_sk, cs_ship_mode_sk with conditional bucket sums. Replace final aggregation source from catalog_sales to catalog_sales_preagg.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["catalog_sales_preagg", "warehouse", "ship_mode", "call_center", "date_dim"],
        "outputs": [
          "SUBSTRING(w_warehouse_name, 1, 20)",
          "sm_type",
          "cc_name",
          "30 days",
          "31-60 days",
          "61-90 days",
          "91-120 days",
          ">120 days"
        ],
        "changed": false
      },
      {
        "node_id": "catalog_sales_preagg",
        "parent_node_id": "final_select",
        "sources": ["catalog_sales"],
        "outputs": [
          "cs_warehouse_sk",
          "cs_call_center_sk",
          "cs_ship_mode_sk",
          "cs_ship_date_sk",
          "bucket_30_days",
          "bucket_31_60_days",
          "bucket_61_90_days",
          "bucket_91_120_days",
          "bucket_120_plus_days"
        ],
        "changed": true,
        "sql": "SELECT cs_warehouse_sk, cs_call_center_sk, cs_ship_mode_sk, cs_ship_date_sk,\n       SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS bucket_30_days,\n       SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS bucket_31_60_days,\n       SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS bucket_61_90_days,\n       SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS bucket_91_120_days,\n       SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS bucket_120_plus_days\nFROM catalog_sales\nWHERE cs_list_price BETWEEN 244 AND 273\nGROUP BY cs_warehouse_sk, cs_call_center_sk, cs_ship_mode_sk, cs_ship_date_sk"
      },
      {
        "node_id": "warehouse",
        "parent_node_id": "final_select",
        "sources": [],
        "outputs": ["w_warehouse_sk", "w_warehouse_name", "w_gmt_offset"],
        "changed": false
      },
      {
        "node_id": "ship_mode",
        "parent_node_id": "final_select",
        "sources": [],
        "outputs": ["sm_ship_mode_sk", "sm_type"],
        "changed": false
      },
      {
        "node_id": "call_center",
        "parent_node_id": "final_select",
        "sources": [],
        "outputs": ["cc_call_center_sk", "cc_name", "cc_class"],
        "changed": false
      },
      {
        "node_id": "date_dim",
        "parent_node_id": "final_select",
        "sources": [],
        "outputs": ["d_date_sk", "d_month_seq"],
        "changed": false
      }
    ]
  }
}