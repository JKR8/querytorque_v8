{
  "probe_id": "scout_dimension_prefetch_star",
  "transform_id": "dimension_prefetch_star",
  "family": "F",
  "status": "success",
  "dialect": "snowflake",
  "hypothesis": "Pre-filtering date_dim and store into CTEs before joining with fact tables reduces I/O and improves join order estimates.",
  "reasoning_trace": [
    "Assigned transform targets dimension prefetch to reduce scan size and improve join estimates.",
    "CTEs for d1, d2, and store are selective and safe to materialize.",
    "Join filters on d1 date range remain intact and pushable into fact scans."
  ],
  "target_ir": "Introduce CTEs for filtered date_dim (d1, d2) and store; preserve all join semantics and output.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["main_query"],
        "outputs": [
          "s_store_name",
          "s_company_id",
          "s_street_number",
          "s_street_name",
          "s_street_type",
          "s_suite_number",
          "s_city",
          "s_county",
          "s_state",
          "s_zip",
          "30 days",
          "31-60 days",
          "61-90 days",
          "91-120 days",
          ">120 days"
        ],
        "changed": false
      },
      {
        "node_id": "main_query",
        "parent_node_id": "final_select",
        "sources": ["store_sales", "store_returns", "filtered_store", "filtered_d1", "filtered_d2"],
        "outputs": [
          "s_store_name",
          "s_company_id",
          "s_street_number",
          "s_street_name",
          "s_street_type",
          "s_suite_number",
          "s_city",
          "s_county",
          "s_state",
          "s_zip",
          "30 days",
          "31-60 days",
          "61-90 days",
          "91-120 days",
          ">120 days"
        ],
        "changed": true,
        "sql": "select \n   s_store_name\n  ,s_company_id\n  ,s_street_number\n  ,s_street_name\n  ,s_street_type\n  ,s_suite_number\n  ,s_city\n  ,s_county\n  ,s_state\n  ,s_zip\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\"\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 30) and\n                 (sr_returned_date_sk - ss_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\"\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 60) and\n                 (sr_returned_date_sk - ss_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\"\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 90) and\n                 (sr_returned_date_sk - ss_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\"\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\"\nfrom\n   store_sales\n  ,store_returns\n  ,filtered_store\n  ,filtered_d1\n  ,filtered_d2\nwhere\n    ss_ticket_number = sr_ticket_number\nand ss_item_sk = sr_item_sk\nand ss_sold_date_sk   = filtered_d1.d_date_sk\nand sr_returned_date_sk   = filtered_d2.d_date_sk\nand ss_customer_sk = sr_customer_sk\nand ss_store_sk = filtered_store.s_store_sk\nand filtered_d1.d_date between (filtered_d2.d_date - interval '120 day')\n               and filtered_d2.d_date\ngroup by\n   s_store_name\n  ,s_company_id\n  ,s_street_number\n  ,s_street_name\n  ,s_street_type\n  ,s_suite_number\n  ,s_city\n  ,s_county\n  ,s_state\n  ,s_zip\norder by s_store_name\n        ,s_company_id\n        ,s_street_number\n        ,s_street_name\n        ,s_street_type\n        ,s_suite_number\n        ,s_city\n        ,s_county\n        ,s_state\n        ,s_zip\nlimit 100"
      },
      {
        "node_id": "filtered_d2",
        "parent_node_id": "main_query",
        "sources": ["date_dim"],
        "outputs": ["d_date_sk", "d_date"],
        "changed": true,
        "sql": "select d_date_sk, d_date from date_dim where d_year = 2000 and d_moy = 8"
      },
      {
        "node_id": "filtered_d1",
        "parent_node_id": "main_query",
        "sources": ["date_dim"],
        "outputs": ["d_date_sk", "d_date"],
        "changed": true,
        "sql": "select d_date_sk, d_date from date_dim"
      },
      {
        "node_id": "filtered_store",
        "parent_node_id": "main_query",
        "sources": ["store"],
        "outputs": [
          "s_store_sk",
          "s_store_name",
          "s_company_id",
          "s_street_number",
          "s_street_name",
          "s_street_type",
          "s_suite_number",
          "s_city",
          "s_county",
          "s_state",
          "s_zip"
        ],
        "changed": true,
        "sql": "select s_store_sk, s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip from store"
      }
    ]
  }
}