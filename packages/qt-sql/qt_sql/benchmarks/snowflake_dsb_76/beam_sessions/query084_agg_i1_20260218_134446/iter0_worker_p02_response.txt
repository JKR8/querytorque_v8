{
  "probe_id": "scout_dimension_cte_isolate",
  "transform_id": "dimension_cte_isolate",
  "family": "A",
  "status": "success",
  "dialect": "snowflake",
  "hypothesis": "Isolating dimension filters into CTEs preserves early pruning while enabling better join order and smaller hash tables for STORE_RETURNS probe.",
  "reasoning_trace": [
    "Each dimension table has selective filters that can be precomputed into small CTEs.",
    "CTEs return only required join keys, minimizing memory footprint and network transfer.",
    "Final join sequence maintains all original WHERE semantics and output contract."
  ],
  "target_ir": "Six CTEs added for each dimension with filters applied; main query joins CTEs and STORE_RETURNS.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": [],
        "outputs": ["customer_id", "customername"],
        "changed": true,
        "sql": "WITH\n  ca_filtered AS (\n    SELECT ca_address_sk\n    FROM customer_address\n    WHERE ca_city = 'Jackson'\n  ),\n  ib_filtered AS (\n    SELECT ib_income_band_sk\n    FROM income_band\n    WHERE ib_lower_bound >= 23567 AND ib_upper_bound <= 73567\n  ),\n  hd_filtered AS (\n    SELECT hd_demo_sk, hd_income_band_sk\n    FROM household_demographics\n  ),\n  cd_filtered AS (\n    SELECT cd_demo_sk\n    FROM customer_demographics\n  ),\n  c_filtered AS (\n    SELECT c_customer_id, c_first_name, c_last_name, c_current_cdemo_sk, c_current_hdemo_sk, c_current_addr_sk\n    FROM customer\n  ),\n  sr_filtered AS (\n    SELECT sr_cdemo_sk\n    FROM store_returns\n  )\nSELECT\n  c.c_customer_id AS customer_id,\n  COALESCE(c.c_last_name, '') || ', ' || COALESCE(c.c_first_name, '') AS customername\nFROM\n  c_filtered c\n  JOIN ca_filtered ca ON c.c_current_addr_sk = ca.ca_address_sk\n  JOIN cd_filtered cd ON c.c_current_cdemo_sk = cd.cd_demo_sk\n  JOIN hd_filtered hd ON c.c_current_hdemo_sk = hd.hd_demo_sk\n  JOIN ib_filtered ib ON hd.hd_income_band_sk = ib.ib_income_band_sk\n  JOIN sr_filtered sr ON cd.cd_demo_sk = sr.sr_cdemo_sk\nORDER BY c.c_customer_id\nLIMIT 100"
      }
    ]
  }
}