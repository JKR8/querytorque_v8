{
  "probe_id": "p12",
  "transform_id": "inner_join_conversion",
  "family": "F",
  "status": "success",
  "dialect": "snowflake",
  "hypothesis": "Converting comma joins to explicit INNER JOIN syntax may help Snowflake's cost-based optimizer better understand join relationships and improve join order planning.",
  "reasoning_trace": [
    "Original SQL uses comma joins in FROM clause which can obscure join conditions.",
    "Assigned transform targets converting these to explicit INNER JOIN syntax.",
    "Join conditions are already present in WHERE clause and will be moved to ON clauses.",
    "Output columns and row semantics are preserved as required."
  ],
  "target_ir": "Comma joins in FROM clause converted to explicit INNER JOIN with ON clauses; no change in data flow or output.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": [],
        "outputs": ["s_store_name", "i_item_desc", "revenue", "i_current_price", "i_wholesale_cost", "i_brand"],
        "changed": true,
        "sql": "SELECT s_store_name, i_item_desc, sc.revenue, i_current_price, i_wholesale_cost, i_brand FROM store AS s INNER JOIN item AS i ON (i.i_item_sk = sc.ss_item_sk AND s.s_store_sk = sc.ss_store_sk) INNER JOIN (SELECT ss_store_sk, avg(revenue) as ave FROM (SELECT ss_store_sk, ss_item_sk, sum(ss_sales_price) as revenue FROM store_sales AS ss INNER JOIN date_dim AS d ON ss.ss_sold_date_sk = d.d_date_sk WHERE d.d_month_seq BETWEEN 1195 AND 1195+11 AND ss.ss_sales_price / ss.ss_list_price BETWEEN 38 * 0.01 AND 48 * 0.01 GROUP BY ss_store_sk, ss_item_sk) sa GROUP BY ss_store_sk) AS sb ON sb.ss_store_sk = sc.ss_store_sk INNER JOIN (SELECT ss_store_sk, ss_item_sk, sum(ss_sales_price) as revenue FROM store_sales AS ss INNER JOIN date_dim AS d ON ss.ss_sold_date_sk = d.d_date_sk WHERE d.d_month_seq BETWEEN 1195 AND 1195+11 AND ss.ss_sales_price / ss.ss_list_price BETWEEN 38 * 0.01 AND 48 * 0.01 GROUP BY ss_store_sk, ss_item_sk) AS sc ON sb.ss_store_sk = sc.ss_store_sk WHERE i.i_manager_id BETWEEN 80 AND 84 AND s.s_state IN ('IA','IL','NC') ORDER BY s_store_name, i_item_desc LIMIT 100"
      }
    ]
  }
}