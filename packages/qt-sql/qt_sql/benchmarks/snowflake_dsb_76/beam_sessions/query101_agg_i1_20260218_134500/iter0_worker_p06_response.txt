{
  "probe_id": "scout_dimension_cte_isolate",
  "transform_id": "dimension_cte_isolate",
  "family": "A",
  "status": "success",
  "dialect": "snowflake",
  "hypothesis": "Isolating date_dim filters into CTEs reduces scan size and enables early pruning. Each CTE returns only required surrogate keys, preserving downstream join semantics.",
  "reasoning_trace": [
    "Assigned transform targets d1 and d2 date_dim aliases for CTE isolation.",
    "CTE-based filtering aligns with MICRO_PARTITION_PRUNING strength.",
    "New CTEs preserve all required node_contract fields: d_date_sk, d_date, and filters.",
    "Join order may improve by building smaller hash tables first."
  ],
  "target_ir": "Two new CTEs (date1_filtered, date2_filtered) replace inline date_dim scans; fact joins now reference CTEs.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": [],
        "outputs": ["c_customer_sk", "c_first_name", "c_last_name", "cnt"],
        "changed": false
      },
      {
        "node_id": "date1_cte",
        "parent_node_id": null,
        "sources": ["date_dim"],
        "outputs": ["d_date_sk", "d_date"],
        "changed": true,
        "sql": "SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 1998"
      },
      {
        "node_id": "date2_cte",
        "parent_node_id": null,
        "sources": ["date_dim"],
        "outputs": ["d_date_sk", "d_date"],
        "changed": true,
        "sql": "SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN (SELECT MIN(d_date) FROM date1_cte) AND (SELECT MIN(d_date) + INTERVAL '90 day' FROM date1_cte)"
      }
    ]
  }
}