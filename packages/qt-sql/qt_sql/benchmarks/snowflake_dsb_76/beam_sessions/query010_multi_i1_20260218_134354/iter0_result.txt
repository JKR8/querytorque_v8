{
  "iteration": 0,
  "n_api_calls": 7,
  "beam_cost_usd": 0.0363373,
  "beam_cost_priced_calls": 6,
  "beam_cost_unpriced_calls": 1,
  "beam_token_totals": {
    "prompt_tokens": 73402,
    "completion_tokens": 13108,
    "total_tokens": 86510,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 7060,
    "reasoning_tokens": 7688
  },
  "best_speedup": 1.03,
  "best_patch_id": "compile_p1",
  "best_sql": "WITH date_filtered AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 1999 AND d_moy BETWEEN 8 AND 11\n),\nitem_filtered AS (\n  SELECT i_item_sk\n  FROM item\n  WHERE i_category IN ('Children', 'Electronics', 'Music')\n    AND i_manager_id BETWEEN 66 AND 75\n)\nSELECT \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  COUNT(*) cnt1,\n  cd_purchase_estimate,\n  COUNT(*) cnt2,\n  cd_credit_rating,\n  COUNT(*) cnt3,\n  cd_dep_count,\n  COUNT(*) cnt4,\n  cd_dep_employed_count,\n  COUNT(*) cnt5,\n  cd_dep_college_count,\n  COUNT(*) cnt6\nFROM\n  customer c,\n  customer_address ca,\n  customer_demographics\nWHERE\n  c.c_current_addr_sk = ca.ca_address_sk\n  AND ca_county IN ('Grays Harbor County','Kootenai County','Pike County','Thomas County','Uinta County')\n  AND c.c_birth_month IN (1, 5)\n  AND cd_demo_sk = c.c_current_cdemo_sk\n  AND cd_marital_status IN ('U', 'U', 'M')\n  AND cd_education_status IN ('College', 'Primary', '2 yr Degree')\n  AND cd_gender = 'M'\n  AND EXISTS (\n    SELECT 1\n    FROM store_sales ss\n    INNER JOIN date_filtered df ON ss.ss_sold_date_sk = df.d_date_sk\n    INNER JOIN item_filtered it ON ss.ss_item_sk = it.i_item_sk\n    WHERE c.c_customer_sk = ss.ss_customer_sk\n      AND ss.ss_sales_price / ss.ss_list_price BETWEEN 20 * 0.01 AND 30 * 0.01\n  )\n  AND (\n    EXISTS (\n      SELECT 1\n      FROM web_sales ws\n      INNER JOIN date_filtered df ON ws.ws_sold_date_sk = df.d_date_sk\n      INNER JOIN item_filtered it ON ws.ws_item_sk = it.i_item_sk\n      WHERE c.c_customer_sk = ws.ws_bill_customer_sk\n        AND ws.ws_sales_price / ws.ws_list_price BETWEEN 20 * 0.01 AND 30 * 0.01\n    )\n    OR\n    EXISTS (\n      SELECT 1\n      FROM catalog_sales cs\n      INNER JOIN date_filtered df ON cs.cs_sold_date_sk = df.d_date_sk\n      INNER JOIN item_filtered it ON cs.cs_item_sk = it.i_item_sk\n      WHERE c.c_customer_sk = cs.cs_ship_customer_sk\n        AND cs.cs_sales_price / cs.cs_list_price BETWEEN 20 * 0.01 AND 30 * 0.01\n    )\n  )\nGROUP BY\n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  cd_purchase_estimate,\n  cd_credit_rating,\n  cd_dep_count,\n  cd_dep_employed_count,\n  cd_dep_college_count\nORDER BY\n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  cd_purchase_estimate,\n  cd_credit_rating,\n  cd_dep_count,\n  cd_dep_employed_count,\n  cd_dep_college_count\nLIMIT 100;",
  "patches": [
    {
      "patch_id": "p02",
      "family": "D",
      "transform": "or_to_union",
      "relevance_score": 0.55,
      "status": "REGRESSION",
      "speedup": 0.94,
      "semantic_passed": true,
      "error": null,
      "original_ms": 176.0,
      "patch_ms": 187.7,
      "output_sql": "select \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  count(*) cnt1,\n  cd_purchase_estimate,\n  count(*) cnt2,\n  cd_credit_rating,\n  count(*) cnt3,\n  cd_dep_count,\n  count(*) cnt4,\n  cd_dep_employed_count,\n  count(*) cnt5,\n  cd_dep_college_count,\n  count(*) cnt6\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  ca_county in ('Grays Harbor County','Kootenai County','Pike County','Thomas County','Uinta County') and\n  c.c_birth_month in (1, 5) and\n  cd_demo_sk = c.c_current_cdemo_sk\n  and cd_marital_status in ('U', 'U', 'M')\n  and cd_education_status in ('College', 'Primary', '2 yr Degree')\n  and cd_gender = 'M' and\n  exists (select *\n          from store_sales,date_dim, item\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 1999 and\n                d_moy between 8 and 8+3 and\n                ss_item_sk = i_item_sk and\n                i_category in ('Children', 'Electronics', 'Music')\n                and ss_sales_price / ss_list_price BETWEEN 20 * 0.01 AND 30 * 0.01\n                and i_manager_id BETWEEN 66 and 75\n                ) and\n   (exists (select *\n            from web_sales,date_dim, item\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 1999 and\n                  d_moy between 8 ANd 8+3 and\n                  ws_item_sk = i_item_sk and\n                  i_category in ('Children', 'Electronics', 'Music')\n                  and i_manager_id BETWEEN 66 and 75\n                  and ws_sales_price / ws_list_price BETWEEN 20 * 0.01 AND 30 * 0.01\n                  ) or\n    exists (select *\n            from catalog_sales,date_dim, item\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 1999 and\n                  d_moy between 8 and 8+3 and\n                  cs_item_sk = i_item_sk and\n                  i_category in ('Children', 'Electronics', 'Music')\n                  and i_manager_id BETWEEN 66 and 75\n                  and cs_sales_price / cs_list_price BETWEEN 20 * 0.01 AND 30 * 0.01\n                  ))\n group by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\n order by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Rewrite OR condition between web_sales and catalog_sales EXISTS as UNION ALL of two separate EXISTS subqueries, each with its own SELECT 1, wrapped in a single EXISTS."
    },
    {
      "patch_id": "p01",
      "family": "A",
      "transform": "sf_sk_pushdown_multi_fact",
      "relevance_score": 0.85,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": false,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  count(*) cnt1,\n  cd_purchase_estimate,\n  count(*) cnt2,\n  cd_credit_rating,\n  count(*) cnt3,\n  cd_dep_count,\n  count(*) cnt4,\n  cd_dep_employed_count,\n  count(*) cnt5,\n  cd_dep_college_count,\n  count(*) cnt6\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  ca_county in ('Grays Harbor County','Kootenai County','Pike County','Thomas County','Uinta County') and\n  c.c_birth_month in (1, 5) and\n  cd_demo_sk = c.c_current_cdemo_sk\n  and cd_marital_status in ('U', 'U', 'M')\n  and cd_education_status in ('College', 'Primary', '2 yr Degree')\n  and cd_gender = 'M' and\n  exists (select *\n          from store_sales,date_dim, item\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 1999 and\n                d_moy between 8 and 8+3 and\n                ss_item_sk = i_item_sk and\n                i_category in ('Children', 'Electronics', 'Music')\n                and ss_sales_price / ss_list_price BETWEEN 20 * 0.01 AND 30 * 0.01\n                and i_manager_id BETWEEN 66 and 75\n                ) and\n   (exists (select *\n            from web_sales,date_dim, item\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 1999 and\n                  d_moy between 8 ANd 8+3 and\n                  ws_item_sk = i_item_sk and\n                  i_category in ('Children', 'Electronics', 'Music')\n                  and i_manager_id BETWEEN 66 and 75\n                  and ws_sales_price / ws_list_price BETWEEN 20 * 0.01 AND 30 * 0.01\n                  ) or\n    exists (select *\n            from catalog_sales,date_dim, item\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 1999 and\n                  d_moy between 8 and 8+3 and\n                  cs_item_sk = i_item_sk and\n                  i_category in ('Children', 'Electronics', 'Music')\n                  and i_manager_id BETWEEN 66 and 75\n                  and cs_sales_price / cs_list_price BETWEEN 20 * 0.01 AND 30 * 0.01\n                  ))\n group by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\n order by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\nlimit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Add date_sk BETWEEN derived from date_dim filter (d_year=1999, d_moy between 8 and 11) to each fact table (store_sales, catalog_sales, web_sales) in the WHERE clause, preserving existing join conditions."
    },
    {
      "patch_id": "p03",
      "family": "A",
      "transform": "multi_date_range_cte",
      "relevance_score": 0.45,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": false,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  count(*) cnt1,\n  cd_purchase_estimate,\n  count(*) cnt2,\n  cd_credit_rating,\n  count(*) cnt3,\n  cd_dep_count,\n  count(*) cnt4,\n  cd_dep_employed_count,\n  count(*) cnt5,\n  cd_dep_college_count,\n  count(*) cnt6\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  ca_county in ('Grays Harbor County','Kootenai County','Pike County','Thomas County','Uinta County') and\n  c.c_birth_month in (1, 5) and\n  cd_demo_sk = c.c_current_cdemo_sk\n  and cd_marital_status in ('U', 'U', 'M')\n  and cd_education_status in ('College', 'Primary', '2 yr Degree')\n  and cd_gender = 'M' and\n  exists (select *\n          from store_sales,date_dim, item\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 1999 and\n                d_moy between 8 and 8+3 and\n                ss_item_sk = i_item_sk and\n                i_category in ('Children', 'Electronics', 'Music')\n                and ss_sales_price / ss_list_price BETWEEN 20 * 0.01 AND 30 * 0.01\n                and i_manager_id BETWEEN 66 and 75\n                ) and\n   (exists (select *\n            from web_sales,date_dim, item\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 1999 and\n                  d_moy between 8 ANd 8+3 and\n                  ws_item_sk = i_item_sk and\n                  i_category in ('Children', 'Electronics', 'Music')\n                  and i_manager_id BETWEEN 66 and 75\n                  and ws_sales_price / ws_list_price BETWEEN 20 * 0.01 AND 30 * 0.01\n                  ) or\n    exists (select *\n            from catalog_sales,date_dim, item\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 1999 and\n                  d_moy between 8 and 8+3 and\n                  cs_item_sk = i_item_sk and\n                  i_category in ('Children', 'Electronics', 'Music')\n                  and i_manager_id BETWEEN 66 and 75\n                  and cs_sales_price / cs_list_price BETWEEN 20 * 0.01 AND 30 * 0.01\n                  ))\n group by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\n order by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\nlimit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Create a CTE for filtered date_dim (d_year=1999, d_moy between 8 and 11) and join it to each fact table (store_sales, catalog_sales, web_sales) to avoid repeated scans of date_dim."
    },
    {
      "patch_id": "p04",
      "family": "B",
      "transform": "composite_decorrelate_union",
      "relevance_score": 0.4,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": false,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  count(*) cnt1,\n  cd_purchase_estimate,\n  count(*) cnt2,\n  cd_credit_rating,\n  count(*) cnt3,\n  cd_dep_count,\n  count(*) cnt4,\n  cd_dep_employed_count,\n  count(*) cnt5,\n  cd_dep_college_count,\n  count(*) cnt6\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  ca_county in ('Grays Harbor County','Kootenai County','Pike County','Thomas County','Uinta County') and\n  c.c_birth_month in (1, 5) and\n  cd_demo_sk = c.c_current_cdemo_sk\n  and cd_marital_status in ('U', 'U', 'M')\n  and cd_education_status in ('College', 'Primary', '2 yr Degree')\n  and cd_gender = 'M' and\n  exists (select *\n          from store_sales,date_dim, item\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 1999 and\n                d_moy between 8 and 8+3 and\n                ss_item_sk = i_item_sk and\n                i_category in ('Children', 'Electronics', 'Music')\n                and ss_sales_price / ss_list_price BETWEEN 20 * 0.01 AND 30 * 0.01\n                and i_manager_id BETWEEN 66 and 75\n                ) and\n   (exists (select *\n            from web_sales,date_dim, item\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 1999 and\n                  d_moy between 8 ANd 8+3 and\n                  ws_item_sk = i_item_sk and\n                  i_category in ('Children', 'Electronics', 'Music')\n                  and i_manager_id BETWEEN 66 and 75\n                  and ws_sales_price / ws_list_price BETWEEN 20 * 0.01 AND 30 * 0.01\n                  ) or\n    exists (select *\n            from catalog_sales,date_dim, item\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 1999 and\n                  d_moy between 8 and 8+3 and\n                  cs_item_sk = i_item_sk and\n                  i_category in ('Children', 'Electronics', 'Music')\n                  and i_manager_id BETWEEN 66 and 75\n                  and cs_sales_price / cs_list_price BETWEEN 20 * 0.01 AND 30 * 0.01\n                  ))\n group by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\n order by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\nlimit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Extract shared dimension filters (date_dim, item) into CTEs, decorrelate EXISTS checks by pre-materializing customer keys from each fact table that satisfy filters, then join via UNION."
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "NEUTRAL",
      "speedup": 1.03,
      "semantic_passed": true,
      "error": null,
      "original_ms": 226.7,
      "patch_ms": 220.2,
      "output_sql": "WITH date_filtered AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 1999 AND d_moy BETWEEN 8 AND 11\n),\nitem_filtered AS (\n  SELECT i_item_sk\n  FROM item\n  WHERE i_category IN ('Children', 'Electronics', 'Music')\n    AND i_manager_id BETWEEN 66 AND 75\n)\nSELECT \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  COUNT(*) cnt1,\n  cd_purchase_estimate,\n  COUNT(*) cnt2,\n  cd_credit_rating,\n  COUNT(*) cnt3,\n  cd_dep_count,\n  COUNT(*) cnt4,\n  cd_dep_employed_count,\n  COUNT(*) cnt5,\n  cd_dep_college_count,\n  COUNT(*) cnt6\nFROM\n  customer c,\n  customer_address ca,\n  customer_demographics\nWHERE\n  c.c_current_addr_sk = ca.ca_address_sk\n  AND ca_county IN ('Grays Harbor County','Kootenai County','Pike County','Thomas County','Uinta County')\n  AND c.c_birth_month IN (1, 5)\n  AND cd_demo_sk = c.c_current_cdemo_sk\n  AND cd_marital_status IN ('U', 'U', 'M')\n  AND cd_education_status IN ('College', 'Primary', '2 yr Degree')\n  AND cd_gender = 'M'\n  AND EXISTS (\n    SELECT 1\n    FROM store_sales ss\n    INNER JOIN date_filtered df ON ss.ss_sold_date_sk = df.d_date_sk\n    INNER JOIN item_filtered it ON ss.ss_item_sk = it.i_item_sk\n    WHERE c.c_customer_sk = ss.ss_customer_sk\n      AND ss.ss_sales_price / ss.ss_list_price BETWEEN 20 * 0.01 AND 30 * 0.01\n  )\n  AND (\n    EXISTS (\n      SELECT 1\n      FROM web_sales ws\n      INNER JOIN date_filtered df ON ws.ws_sold_date_sk = df.d_date_sk\n      INNER JOIN item_filtered it ON ws.ws_item_sk = it.i_item_sk\n      WHERE c.c_customer_sk = ws.ws_bill_customer_sk\n        AND ws.ws_sales_price / ws.ws_list_price BETWEEN 20 * 0.01 AND 30 * 0.01\n    )\n    OR\n    EXISTS (\n      SELECT 1\n      FROM catalog_sales cs\n      INNER JOIN date_filtered df ON cs.cs_sold_date_sk = df.d_date_sk\n      INNER JOIN item_filtered it ON cs.cs_item_sk = it.i_item_sk\n      WHERE c.c_customer_sk = cs.cs_ship_customer_sk\n        AND cs.cs_sales_price / cs.cs_list_price BETWEEN 20 * 0.01 AND 30 * 0.01\n    )\n  )\nGROUP BY\n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  cd_purchase_estimate,\n  cd_credit_rating,\n  cd_dep_count,\n  cd_dep_employed_count,\n  cd_dep_college_count\nORDER BY\n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  cd_purchase_estimate,\n  cd_credit_rating,\n  cd_dep_count,\n  cd_dep_employed_count,\n  cd_dep_college_count\nLIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p02": "GlobalStats | 155746 | 155746 | 2639773342720\n1 | 0 | Result | CUSTOMER_DEMOGRAPHICS.CD_GENDER, CUSTOMER_DEMOGRAPHICS.CD_MARITAL_STATUS, CUSTOMER_DEMOGRAPHICS.CD_EDUCATION_STATUS, COUNT(*), CUSTOMER_DEMOGRAPHICS.CD_PURCHASE_ESTIMATE, COUNT(*), CUSTOMER_DEMOGRAPHICS.CD_CREDIT_RATING, COUNT(*), CUSTOMER_DEMOGRAPHICS.CD_DEP_COUNT, COUNT(*), CUSTOMER_DEMOGRAPHICS.CD_DEP_EMPLOYED_COUNT, COUNT(*), CUSTOMER_DEMOGRAPHICS.CD_DEP_COLLEGE_COUNT, COUNT(*)\n1 | 1 | [0] | SortWithLimit | sortKey: [CUSTOMER_DEM",
    "compile_p1": "GlobalStats | 155740 | 155740 | 2639721442304\n1 | 0 | Result | CUSTOMER_DEMOGRAPHICS.CD_GENDER, CUSTOMER_DEMOGRAPHICS.CD_MARITAL_STATUS, CUSTOMER_DEMOGRAPHICS.CD_EDUCATION_STATUS, COUNT(*), CUSTOMER_DEMOGRAPHICS.CD_PURCHASE_ESTIMATE, COUNT(*), CUSTOMER_DEMOGRAPHICS.CD_CREDIT_RATING, COUNT(*), CUSTOMER_DEMOGRAPHICS.CD_DEP_COUNT, COUNT(*), CUSTOMER_DEMOGRAPHICS.CD_DEP_EMPLOYED_COUNT, COUNT(*), CUSTOMER_DEMOGRAPHICS.CD_DEP_COLLEGE_COUNT, COUNT(*)\n1 | 1 | [0] | SortWithLimit | sortKey: [CUSTOMER_DEM"
  }
}