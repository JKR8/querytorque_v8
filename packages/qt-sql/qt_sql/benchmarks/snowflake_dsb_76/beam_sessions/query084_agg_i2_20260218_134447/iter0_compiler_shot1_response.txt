[
  {
    "plan_id": "compile_p03",
    "dialect": "snowflake",
    "confidence": 0.8,
    "based_on": "p03",
    "strategy": "Explicit INNER JOIN syntax conversion.",
    "hypothesis": "Probe p03 achieved 1.14x speedup by converting comma‑separated joins to explicit INNER JOIN syntax, which may improve predicate pushdown and join planning in Snowflake.",
    "expected_explain_delta": "Join operators become explicit inner joins; potential for better predicate propagation.",
    "target_ir": "Convert final_select to explicit INNER JOINs while preserving original join order.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": [],
          "outputs": ["customer_id", "customername"],
          "changed": true,
          "sql": "SELECT c.c_customer_id AS customer_id, COALESCE(c.c_last_name, '') || ', ' || COALESCE(c.c_first_name, '') AS customername FROM customer c INNER JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk INNER JOIN household_demographics hd ON hd.hd_demo_sk = c.c_current_hdemo_sk INNER JOIN income_band ib ON ib.ib_income_band_sk = hd.hd_income_band_sk INNER JOIN store_returns sr ON sr.sr_cdemo_sk = cd.cd_demo_sk WHERE ca.ca_city = 'Mount Vernon' AND ib.ib_lower_bound >= 40374 AND ib.ib_upper_bound <= 40374 + 50000 ORDER BY c.c_customer_id LIMIT 100"
        }
      ]
    }
  },
  {
    "plan_id": "compile_cte_prefilter",
    "dialect": "snowflake",
    "confidence": 0.65,
    "based_on": "p02,p04",
    "strategy": "CTE pre‑filtering to reduce fact‑table scan.",
    "hypothesis": "Failed probes p02 and p04 attempted CTE isolation but had syntax errors. This rewrite pre‑filters all dimension keys into a single CTE, then joins with STORE_RETURNS, targeting the residual 124 GB scan.",
    "expected_explain_delta": "STORE_RETURNS scan should show predicate pushdown on SR_CDEMO_SK, reducing I/O.",
    "target_ir": "Introduce a CTE that pre‑filters customers and their demographic keys, then join with STORE_RETURNS.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "filtered_customers",
          "parent_node_id": "final_select",
          "sources": ["customer", "customer_address", "customer_demographics", "household_demographics", "income_band"],
          "outputs": ["c_customer_id", "c_first_name", "c_last_name", "cd_demo_sk"],
          "changed": true,
          "sql": "SELECT c.c_customer_id, c.c_first_name, c.c_last_name, cd.cd_demo_sk FROM customer c INNER JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk INNER JOIN household_demographics hd ON hd.hd_demo_sk = c.c_current_hdemo_sk INNER JOIN income_band ib ON ib.ib_income_band_sk = hd.hd_income_band_sk WHERE ca.ca_city = 'Mount Vernon' AND ib.ib_lower_bound >= 40374 AND ib.ib_upper_bound <= 40374 + 50000"
        },
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["filtered_customers", "store_returns"],
          "outputs": ["customer_id", "customername"],
          "changed": true,
          "sql": "SELECT fc.c_customer_id AS customer_id, COALESCE(fc.c_last_name, '') || ', ' || COALESCE(fc.c_first_name, '') AS customername FROM filtered_customers fc INNER JOIN store_returns sr ON sr.sr_cdemo_sk = fc.cd_demo_sk ORDER BY fc.c_customer_id LIMIT 100"
        }
      ]
    }
  }
]