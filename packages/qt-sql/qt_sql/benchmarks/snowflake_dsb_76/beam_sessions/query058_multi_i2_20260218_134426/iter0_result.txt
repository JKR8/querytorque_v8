{
  "iteration": 0,
  "n_api_calls": 8,
  "beam_cost_usd": 0.0,
  "beam_cost_priced_calls": 0,
  "beam_cost_unpriced_calls": 8,
  "beam_token_totals": {
    "prompt_tokens": 0,
    "completion_tokens": 0,
    "total_tokens": 0,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 0,
    "reasoning_tokens": 0
  },
  "best_speedup": 1.14,
  "best_patch_id": "p06",
  "best_sql": "WITH filtered_date_dim AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '2001-06-06')), ss_filtered_fact AS (SELECT i.i_item_id, c.c_birth_year, ss.ss_ext_sales_price FROM store_sales ss JOIN filtered_date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk WHERE ss.ss_list_price BETWEEN 168 AND 197 AND i.i_manager_id BETWEEN 42 AND 71 AND c.c_birth_year BETWEEN 1985 AND 1991), cs_filtered_fact AS (SELECT i.i_item_id, c.c_birth_year, cs.cs_ext_sales_price FROM catalog_sales cs JOIN filtered_date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk WHERE cs.cs_list_price BETWEEN 168 AND 197 AND i.i_manager_id BETWEEN 42 AND 71 AND c.c_birth_year BETWEEN 1985 AND 1991), ws_filtered_fact AS (SELECT i.i_item_id, c.c_birth_year, ws.ws_ext_sales_price FROM web_sales ws JOIN filtered_date_dim d ON ws.ws_sold_date_sk = d.d_date_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk WHERE ws.ws_list_price BETWEEN 168 AND 197 AND i.i_manager_id BETWEEN 42 AND 71 AND c.c_birth_year BETWEEN 1985 AND 1991), ss_items AS (SELECT i_item_id AS item_id, c_birth_year AS birth_year, SUM(ss_ext_sales_price) AS ss_item_rev FROM ss_filtered_fact GROUP BY i_item_id, c_birth_year), cs_items AS (SELECT i_item_id AS item_id, c_birth_year AS birth_year, SUM(cs_ext_sales_price) AS cs_item_rev FROM cs_filtered_fact GROUP BY i_item_id, c_birth_year), ws_items AS (SELECT i_item_id AS item_id, c_birth_year AS birth_year, SUM(ws_ext_sales_price) AS ws_item_rev FROM ws_filtered_fact GROUP BY i_item_id, c_birth_year) SELECT ss_items.item_id, ss_items.birth_year, ss_item_rev, ss_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ss_dev, cs_item_rev, cs_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS cs_dev, ws_item_rev, ws_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ws_dev, (ss_item_rev + cs_item_rev + ws_item_rev) / 3 AS average FROM ss_items, cs_items, ws_items WHERE ss_items.item_id = cs_items.item_id AND ss_items.item_id = ws_items.item_id AND ss_items.birth_year = cs_items.birth_year AND ss_items.birth_year = ws_items.birth_year AND ss_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev AND ss_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND cs_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND cs_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND ws_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND ws_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev ORDER BY item_id, birth_year, ss_item_rev LIMIT 100;",
  "patches": [
    {
      "patch_id": "p03",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.7,
      "status": "WIN",
      "speedup": 1.11,
      "semantic_passed": true,
      "error": null,
      "original_ms": 251.2,
      "patch_ms": 227.3,
      "output_sql": "WITH ss_items AS (SELECT i_item_id AS item_id, c_birth_year AS birth_year, SUM(ss_ext_sales_price) AS ss_item_rev FROM (SELECT ss_item_sk, ss_customer_sk, ss_sold_date_sk, SUM(ss_ext_sales_price) AS ss_ext_sales_price FROM store_sales WHERE ss_sold_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '2001-06-06')) AND ss_list_price BETWEEN 168 AND 197 GROUP BY ss_item_sk, ss_customer_sk, ss_sold_date_sk) ss_agg JOIN item ON ss_agg.ss_item_sk = i_item_sk JOIN date_dim ON ss_agg.ss_sold_date_sk = d_date_sk JOIN customer ON ss_agg.ss_customer_sk = c_customer_sk WHERE i_manager_id BETWEEN 42 AND 71 AND c_birth_year BETWEEN 1985 AND 1991 GROUP BY i_item_id, c_birth_year), cs_items AS (SELECT i_item_id AS item_id, c_birth_year AS birth_year, SUM(cs_ext_sales_price) AS cs_item_rev FROM (SELECT cs_item_sk, cs_bill_customer_sk, cs_sold_date_sk, SUM(cs_ext_sales_price) AS cs_ext_sales_price FROM catalog_sales WHERE cs_sold_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '2001-06-06')) AND cs_list_price BETWEEN 168 AND 197 GROUP BY cs_item_sk, cs_bill_customer_sk, cs_sold_date_sk) cs_agg JOIN item ON cs_agg.cs_item_sk = i_item_sk JOIN date_dim ON cs_agg.cs_sold_date_sk = d_date_sk JOIN customer ON cs_agg.cs_bill_customer_sk = c_customer_sk WHERE i_manager_id BETWEEN 42 AND 71 AND c_birth_year BETWEEN 1985 AND 1991 GROUP BY i_item_id, c_birth_year), ws_items AS (SELECT i_item_id AS item_id, c_birth_year AS birth_year, SUM(ws_ext_sales_price) AS ws_item_rev FROM (SELECT ws_item_sk, ws_bill_customer_sk, ws_sold_date_sk, SUM(ws_ext_sales_price) AS ws_ext_sales_price FROM web_sales WHERE ws_sold_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '2001-06-06')) AND ws_list_price BETWEEN 168 AND 197 GROUP BY ws_item_sk, ws_bill_customer_sk, ws_sold_date_sk) ws_agg JOIN item ON ws_agg.ws_item_sk = i_item_sk JOIN date_dim ON ws_agg.ws_sold_date_sk = d_date_sk JOIN customer ON ws_agg.ws_bill_customer_sk = c_customer_sk WHERE i_manager_id BETWEEN 42 AND 71 AND c_birth_year BETWEEN 1985 AND 1991 GROUP BY i_item_id, c_birth_year) SELECT ss_items.item_id, ss_items.birth_year, ss_item_rev, ss_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ss_dev, cs_item_rev, cs_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS cs_dev, ws_item_rev, ws_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ws_dev, (ss_item_rev + cs_item_rev + ws_item_rev) / 3 AS average FROM ss_items, cs_items, ws_items WHERE ss_items.item_id = cs_items.item_id AND ss_items.item_id = ws_items.item_id AND ss_items.birth_year = cs_items.birth_year AND ss_items.birth_year = ws_items.birth_year AND ss_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev AND ss_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND cs_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND cs_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND ws_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND ws_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev ORDER BY item_id, birth_year, ss_item_rev LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-aggregate each fact table by (item_sk, customer_sk, sold_date_sk) before joining with dimensions, then final aggregate by (item_id, birth_year)."
    },
    {
      "patch_id": "p05",
      "family": "E",
      "transform": "materialize_cte",
      "relevance_score": 0.5,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Materialize the filtered date_dim subquery result as a CTE with explicit MATERIALIZED hint (if supported) to avoid repeated computation."
    },
    {
      "patch_id": "p02",
      "family": "A",
      "transform": "shared_dimension_multi_channel",
      "relevance_score": 0.75,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Extract filtered dimension tables (item, customer, date_dim) into shared CTEs and reference them in each channel CTE to avoid repeated scans."
    },
    {
      "patch_id": "p04",
      "family": "C",
      "transform": "channel_bitmap_aggregation",
      "relevance_score": 0.55,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH consolidated_items AS (WITH date_filter AS (SELECT d_date FROM date_dim WHERE d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '2001-06-06'))\nSELECT \n  i_item_id AS item_id,\n  c_birth_year AS birth_year,\n  SUM(CASE WHEN src = 'ss' THEN ext_sales_price ELSE 0 END) AS ss_item_rev,\n  SUM(CASE WHEN src = 'cs' THEN ext_sales_price ELSE 0 END) AS cs_item_rev,\n  SUM(CASE WHEN src = 'ws' THEN ext_sales_price ELSE 0 END) AS ws_item_rev\nFROM (\n  SELECT 'ss' AS src, ss_ext_sales_price AS ext_sales_price, ss_item_sk, ss_customer_sk, ss_sold_date_sk\n  FROM store_sales\n  WHERE ss_list_price BETWEEN 168 AND 197\n    AND ss_sold_date_sk IN (SELECT d_date_sk FROM date_filter)\n  UNION ALL\n  SELECT 'cs' AS src, cs_ext_sales_price AS ext_sales_price, cs_item_sk AS ss_item_sk, cs_bill_customer_sk AS ss_customer_sk, cs_sold_date_sk AS ss_sold_date_sk\n  FROM catalog_sales\n  WHERE cs_list_price BETWEEN 168 AND 197\n    AND cs_sold_date_sk IN (SELECT d_date_sk FROM date_filter)\n  UNION ALL\n  SELECT 'ws' AS src, ws_ext_sales_price AS ext_sales_price, ws_item_sk AS ss_item_sk, ws_bill_customer_sk AS ss_customer_sk, ws_sold_date_sk AS ss_sold_date_sk\n  FROM web_sales\n  WHERE ws_list_price BETWEEN 168 AND 197\n    AND ws_sold_date_sk IN (SELECT d_date_sk FROM date_filter)\n) sales\nJOIN item ON sales.ss_item_sk = i_item_sk\nJOIN customer ON sales.ss_customer_sk = c_customer_sk\nWHERE i_manager_id BETWEEN 42 AND 71\n  AND c_birth_year BETWEEN 1985 AND 1991\nGROUP BY i_item_id, c_birth_year) SELECT ss_items.item_id, ss_items.birth_year, ss_item_rev, ss_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ss_dev, cs_item_rev, cs_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS cs_dev, ws_item_rev, ws_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ws_dev, (ss_item_rev + cs_item_rev + ws_item_rev) / 3 AS average FROM ss_items, cs_items, ws_items WHERE ss_items.item_id = cs_items.item_id AND ss_items.item_id = ws_items.item_id AND ss_items.birth_year = cs_items.birth_year AND ss_items.birth_year = ws_items.birth_year AND ss_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev AND ss_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND cs_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND cs_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND ws_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND ws_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev ORDER BY item_id, birth_year, ss_item_rev LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Consolidate three channel scans into a single UNION ALL scan with conditional aggregation, then pivot into separate columns."
    },
    {
      "patch_id": "p08",
      "family": "B",
      "transform": "sf_inline_decorrelate",
      "relevance_score": 0.8,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Decompose date_dim subquery into explicit CTEs: one to get d_month_seq constant, another to get d_date_sk range, then join directly."
    },
    {
      "patch_id": "p06",
      "family": "A",
      "transform": "prefetch_fact_join",
      "relevance_score": 0.6,
      "status": "WIN",
      "speedup": 1.14,
      "semantic_passed": true,
      "error": null,
      "original_ms": 251.2,
      "patch_ms": 219.6,
      "output_sql": "WITH filtered_date_dim AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '2001-06-06')), ss_filtered_fact AS (SELECT i.i_item_id, c.c_birth_year, ss.ss_ext_sales_price FROM store_sales ss JOIN filtered_date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk WHERE ss.ss_list_price BETWEEN 168 AND 197 AND i.i_manager_id BETWEEN 42 AND 71 AND c.c_birth_year BETWEEN 1985 AND 1991), cs_filtered_fact AS (SELECT i.i_item_id, c.c_birth_year, cs.cs_ext_sales_price FROM catalog_sales cs JOIN filtered_date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk WHERE cs.cs_list_price BETWEEN 168 AND 197 AND i.i_manager_id BETWEEN 42 AND 71 AND c.c_birth_year BETWEEN 1985 AND 1991), ws_filtered_fact AS (SELECT i.i_item_id, c.c_birth_year, ws.ws_ext_sales_price FROM web_sales ws JOIN filtered_date_dim d ON ws.ws_sold_date_sk = d.d_date_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk WHERE ws.ws_list_price BETWEEN 168 AND 197 AND i.i_manager_id BETWEEN 42 AND 71 AND c.c_birth_year BETWEEN 1985 AND 1991), ss_items AS (SELECT i_item_id AS item_id, c_birth_year AS birth_year, SUM(ss_ext_sales_price) AS ss_item_rev FROM ss_filtered_fact GROUP BY i_item_id, c_birth_year), cs_items AS (SELECT i_item_id AS item_id, c_birth_year AS birth_year, SUM(cs_ext_sales_price) AS cs_item_rev FROM cs_filtered_fact GROUP BY i_item_id, c_birth_year), ws_items AS (SELECT i_item_id AS item_id, c_birth_year AS birth_year, SUM(ws_ext_sales_price) AS ws_item_rev FROM ws_filtered_fact GROUP BY i_item_id, c_birth_year) SELECT ss_items.item_id, ss_items.birth_year, ss_item_rev, ss_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ss_dev, cs_item_rev, cs_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS cs_dev, ws_item_rev, ws_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ws_dev, (ss_item_rev + cs_item_rev + ws_item_rev) / 3 AS average FROM ss_items, cs_items, ws_items WHERE ss_items.item_id = cs_items.item_id AND ss_items.item_id = ws_items.item_id AND ss_items.birth_year = cs_items.birth_year AND ss_items.birth_year = ws_items.birth_year AND ss_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev AND ss_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND cs_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND cs_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND ws_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND ws_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev ORDER BY item_id, birth_year, ss_item_rev LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Stage joins: first filter dimensions, then join with fact keys, then aggregate, in a progressive reduction chain."
    },
    {
      "patch_id": "p01",
      "family": "A",
      "transform": "sf_sk_pushdown_multi_fact",
      "relevance_score": 0.85,
      "status": "WIN",
      "speedup": 1.1,
      "semantic_passed": true,
      "error": null,
      "original_ms": 251.2,
      "patch_ms": 227.8,
      "output_sql": "WITH ss_items AS (select i_item_id item_id, c_birth_year birth_year, sum(ss_ext_sales_price) ss_item_rev from store_sales, item, date_dim, customer where ss_item_sk = i_item_sk and ss_sold_date_sk = d_date_sk and d_date_sk between (select min(d_date_sk) from date_dim where d_month_seq = (select d_month_seq from date_dim where d_date = '2001-06-06')) and (select max(d_date_sk) from date_dim where d_month_seq = (select d_month_seq from date_dim where d_date = '2001-06-06')) and ss_list_price between 168 and 197 and i_manager_id BETWEEN 42 and 71 and ss_customer_sk = c_customer_sk and c_birth_year BETWEEN 1985 AND 1991 group by i_item_id, c_birth_year), cs_items AS (select i_item_id item_id, c_birth_year birth_year, sum(cs_ext_sales_price) cs_item_rev from catalog_sales, item, date_dim, customer where cs_item_sk = i_item_sk and cs_sold_date_sk = d_date_sk and d_date_sk between (select min(d_date_sk) from date_dim where d_month_seq = (select d_month_seq from date_dim where d_date = '2001-06-06')) and (select max(d_date_sk) from date_dim where d_month_seq = (select d_month_seq from date_dim where d_date = '2001-06-06')) and cs_list_price between 168 and 197 and i_manager_id BETWEEN 42 and 71 and cs_bill_customer_sk = c_customer_sk and c_birth_year BETWEEN 1985 AND 1991 group by i_item_id, c_birth_year), ws_items AS (select i_item_id item_id, c_birth_year birth_year, sum(ws_ext_sales_price) ws_item_rev from web_sales, item, date_dim, customer where ws_item_sk = i_item_sk and ws_sold_date_sk = d_date_sk and d_date_sk between (select min(d_date_sk) from date_dim where d_month_seq = (select d_month_seq from date_dim where d_date = '2001-06-06')) and (select max(d_date_sk) from date_dim where d_month_seq = (select d_month_seq from date_dim where d_date = '2001-06-06')) and ws_list_price between 168 and 197 and i_manager_id BETWEEN 42 and 71 and ws_bill_customer_sk = c_customer_sk and c_birth_year BETWEEN 1985 AND 1991 group by i_item_id, c_birth_year) SELECT ss_items.item_id, ss_items.birth_year, ss_item_rev, ss_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ss_dev, cs_item_rev, cs_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS cs_dev, ws_item_rev, ws_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ws_dev, (ss_item_rev + cs_item_rev + ws_item_rev) / 3 AS average FROM ss_items, cs_items, ws_items WHERE ss_items.item_id = cs_items.item_id AND ss_items.item_id = ws_items.item_id AND ss_items.birth_year = cs_items.birth_year AND ss_items.birth_year = ws_items.birth_year AND ss_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev AND ss_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND cs_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND cs_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND ws_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND ws_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev ORDER BY item_id, birth_year, ss_item_rev LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Add explicit date_sk BETWEEN range derived from d_month_seq subquery to each fact table join condition to enable micro-partition pruning."
    },
    {
      "patch_id": "p07",
      "family": "F",
      "transform": "inner_join_conversion",
      "relevance_score": 0.45,
      "status": "WIN",
      "speedup": 1.13,
      "semantic_passed": true,
      "error": null,
      "original_ms": 251.2,
      "patch_ms": 222.6,
      "output_sql": "WITH ss_items AS (SELECT i_item_id AS item_id, c_birth_year AS birth_year, SUM(ss_ext_sales_price) AS ss_item_rev FROM store_sales, item, date_dim, customer WHERE ss_item_sk = i_item_sk AND d_date IN (SELECT d_date FROM date_dim WHERE d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '2001-06-06')) AND ss_sold_date_sk = d_date_sk AND ss_list_price BETWEEN 168 AND 197 AND i_manager_id BETWEEN 42 AND 71 AND ss_customer_sk = c_customer_sk AND c_birth_year BETWEEN 1985 AND 1991 GROUP BY i_item_id, c_birth_year), cs_items AS (SELECT i_item_id AS item_id, c_birth_year AS birth_year, SUM(cs_ext_sales_price) AS cs_item_rev FROM catalog_sales, item, date_dim, customer WHERE cs_item_sk = i_item_sk AND d_date IN (SELECT d_date FROM date_dim WHERE d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '2001-06-06')) AND cs_sold_date_sk = d_date_sk AND cs_list_price BETWEEN 168 AND 197 AND i_manager_id BETWEEN 42 AND 71 AND cs_bill_customer_sk = c_customer_sk AND c_birth_year BETWEEN 1985 AND 1991 GROUP BY i_item_id, c_birth_year), ws_items AS (SELECT i_item_id AS item_id, c_birth_year AS birth_year, SUM(ws_ext_sales_price) AS ws_item_rev FROM web_sales, item, date_dim, customer WHERE ws_item_sk = i_item_sk AND d_date IN (SELECT d_date FROM date_dim WHERE d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '2001-06-06')) AND ws_sold_date_sk = d_date_sk AND ws_list_price BETWEEN 168 AND 197 AND i_manager_id BETWEEN 42 AND 71 AND ws_bill_customer_sk = c_customer_sk AND c_birth_year BETWEEN 1985 AND 1991 GROUP BY i_item_id, c_birth_year) SELECT ss_items.item_id, ss_items.birth_year, ss_item_rev, ss_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ss_dev, cs_item_rev, cs_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS cs_dev, ws_item_rev, ws_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ws_dev, (ss_item_rev + cs_item_rev + ws_item_rev) / 3 AS average FROM ss_items, cs_items, ws_items WHERE ss_items.item_id = cs_items.item_id AND ss_items.item_id = ws_items.item_id AND ss_items.birth_year = cs_items.birth_year AND ss_items.birth_year = ws_items.birth_year AND ss_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev AND ss_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND cs_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND cs_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND ws_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND ws_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev ORDER BY item_id, birth_year, ss_item_rev LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Convert implicit comma joins to explicit INNER JOIN syntax and ensure join order places smallest filtered dimension first."
    }
  ],
  "explains": {
    "p03": "GlobalStats | 156015 | 153503 | 2600841139712\n1 | 0 | Result | DATE_DIM.D_MONTH_SEQ\n1 | 3 | [2] | Filter | DATE_DIM.D_DATE = '2001-06-06'\n1 | 4 | [3] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_DATE, D_MONTH_SEQ | 1 | 1 | 2138624\n2 | 0 | Result | ITEM.I_ITEM_ID, CUSTOMER.C_BIRTH_YEAR, SUM(SUM(SUM(SUM(SUM(SUM(SUM(SUM(STORE_SALES.SS_EXT_SALES_PRICE)))))))), (SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM(SUM(SUM(SUM(SUM(STORE_SALES.SS_EXT_SALES_PRICE)))))))), SCALED_ROUND_INT_DIVIDE(((",
    "p06": "GlobalStats | 156010 | 156010 | 2643644380160\n1 | 0 | Result | DATE_DIM.D_MONTH_SEQ\n1 | 3 | [2] | Filter | DATE_DIM.D_DATE = '2001-06-06'\n1 | 4 | [3] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_DATE, D_MONTH_SEQ | 1 | 1 | 2138624\n2 | 0 | Result | I.I_ITEM_ID, C.C_BIRTH_YEAR, SUM(SUM(SUM(SUM(SUM(SS.SS_EXT_SALES_PRICE))))), (SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM(SUM(SS.SS_EXT_SALES_PRICE))))), (((SUM(SUM(SUM(SUM(SUM(SS.SS_EXT_SALES_PRICE)))))) + (SUM(SUM(SUM(SUM(SUM(CS.CS_EXT_",
    "p01": "GlobalStats | 156014 | 153502 | 2600839001088\n1 | 0 | Result | DATE_DIM.D_MONTH_SEQ\n1 | 3 | [2] | Filter | DATE_DIM.D_DATE = '2001-06-06'\n1 | 4 | [3] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_DATE, D_MONTH_SEQ | 1 | 1 | 2138624\n2 | 0 | Result | MIN(DATE_DIM.D_DATE_SK)\n2 | 1 | [0] | Aggregate | aggExprs: [MIN(DATE_DIM.D_DATE_SK)]\n2 | 2 | [1] | Filter | DATE_DIM.D_MONTH_SEQ = Subquery(Step1)\n2 | 3 | [2] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_DATE_SK, D_",
    "p07": "GlobalStats | 156015 | 156015 | 2643655073280\n1 | 0 | Result | DATE_DIM.D_MONTH_SEQ\n1 | 3 | [2] | Filter | DATE_DIM.D_DATE = '2001-06-06'\n1 | 4 | [3] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_DATE, D_MONTH_SEQ | 1 | 1 | 2138624\n2 | 0 | Result | ITEM.I_ITEM_ID, CUSTOMER.C_BIRTH_YEAR, SUM(SUM(SUM(SUM(SUM(STORE_SALES.SS_EXT_SALES_PRICE))))), (SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM(SUM(STORE_SALES.SS_EXT_SALES_PRICE))))), (((SUM(SUM(SUM(SUM(SUM(STORE_SALES.SS_EXT_SALES_PRICE)))"
  }
}