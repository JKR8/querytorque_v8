{
  "iteration": 0,
  "n_api_calls": 4,
  "beam_cost_usd": 0.0,
  "beam_cost_priced_calls": 0,
  "beam_cost_unpriced_calls": 4,
  "beam_token_totals": {
    "prompt_tokens": 0,
    "completion_tokens": 0,
    "total_tokens": 0,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 0,
    "reasoning_tokens": 0
  },
  "best_speedup": 1.14,
  "best_patch_id": "p03",
  "best_sql": "WITH my_customers AS (with preagg_sales as (select cs_bill_customer_sk as customer_sk, cs_sold_date_sk as sold_date_sk, cs_item_sk as item_sk, count(*) as cnt from catalog_sales where cs_wholesale_cost between 35 and 65 group by cs_bill_customer_sk, cs_sold_date_sk, cs_item_sk union all select ws_bill_customer_sk as customer_sk, ws_sold_date_sk as sold_date_sk, ws_item_sk as item_sk, count(*) as cnt from web_sales where ws_wholesale_cost between 35 and 65 group by ws_bill_customer_sk, ws_sold_date_sk, ws_item_sk) select distinct c.c_customer_sk, c.c_current_addr_sk from preagg_sales cs_or_ws_sales join item i on cs_or_ws_sales.item_sk = i.i_item_sk join date_dim d on cs_or_ws_sales.sold_date_sk = d.d_date_sk join customer c on cs_or_ws_sales.customer_sk = c.c_customer_sk where i.i_category = 'Electronics' and i.i_class = 'personal' and d.d_moy = 1 and d.d_year = 1998 and c.c_birth_year between 1928 and 1941), my_revenue AS (SELECT c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers, store_sales, customer_address, store, date_dim WHERE c_current_addr_sk = ca_address_sk AND ca_county = s_county AND ca_state = s_state AND ss_sold_date_sk = d_date_sk AND c_customer_sk = ss_customer_sk AND ss_wholesale_cost BETWEEN 35 AND 65 AND s_state IN ('AR', 'CO', 'IA', 'IL', 'KY', 'NC', 'NM', 'NY', 'PA', 'TX') AND d_month_seq BETWEEN (SELECT DISTINCT d_month_seq + 1 FROM date_dim WHERE d_year = 1998 AND d_moy = 1) AND (SELECT DISTINCT d_month_seq + 3 FROM date_dim WHERE d_year = 1998 AND d_moy = 1) GROUP BY c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
  "patches": [
    {
      "patch_id": "p01",
      "family": "A",
      "transform": "sf_sk_pushdown_union_all",
      "relevance_score": 0.87,
      "status": "WIN",
      "speedup": 1.11,
      "semantic_passed": true,
      "error": null,
      "original_ms": 254.5,
      "patch_ms": 230.3,
      "output_sql": "WITH my_customers AS (with date_range as (select min(d_date_sk) as min_sk, max(d_date_sk) as max_sk from date_dim where d_moy = 1 and d_year = 1998)\nselect distinct c_customer_sk, c_current_addr_sk\nfrom (select cs_sold_date_sk sold_date_sk, cs_bill_customer_sk customer_sk, cs_item_sk item_sk, cs_wholesale_cost wholesale_cost\n      from catalog_sales\n      where cs_sold_date_sk between (select min_sk from date_range) and (select max_sk from date_range)\n      union all\n      select ws_sold_date_sk sold_date_sk, ws_bill_customer_sk customer_sk, ws_item_sk item_sk, ws_wholesale_cost wholesale_cost\n      from web_sales\n      where ws_sold_date_sk between (select min_sk from date_range) and (select max_sk from date_range)\n     ) cs_or_ws_sales,\n     item,\n     date_dim,\n     customer\nwhere sold_date_sk = d_date_sk\n  and item_sk = i_item_sk\n  and i_category = 'Electronics'\n  and i_class = 'personal'\n  and c_customer_sk = cs_or_ws_sales.customer_sk\n  and d_moy = 1\n  and d_year = 1998\n  and wholesale_cost BETWEEN 35 AND 65\n  and c_birth_year BETWEEN 1928 AND 1941), my_revenue AS (SELECT c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers, store_sales, customer_address, store, date_dim WHERE c_current_addr_sk = ca_address_sk AND ca_county = s_county AND ca_state = s_state AND ss_sold_date_sk = d_date_sk AND c_customer_sk = ss_customer_sk AND ss_wholesale_cost BETWEEN 35 AND 65 AND s_state IN ('AR', 'CO', 'IA', 'IL', 'KY', 'NC', 'NM', 'NY', 'PA', 'TX') AND d_month_seq BETWEEN (SELECT DISTINCT d_month_seq + 1 FROM date_dim WHERE d_year = 1998 AND d_moy = 1) AND (SELECT DISTINCT d_month_seq + 3 FROM date_dim WHERE d_year = 1998 AND d_moy = 1) GROUP BY c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Push date_sk range predicate into UNION ALL branches of my_customers CTE. Precompute date_sk range from date_dim WHERE d_moy=1 AND d_year=1998, apply as cs_sold_date_sk BETWEEN min_sk AND max_sk and ws_sold_date_sk BETWEEN min_sk AND max_sk."
    },
    {
      "patch_id": "p06",
      "family": "E",
      "transform": "materialize_cte",
      "relevance_score": 0.45,
      "status": "IMPROVED",
      "speedup": 1.09,
      "semantic_passed": true,
      "error": null,
      "original_ms": 254.5,
      "patch_ms": 233.7,
      "output_sql": "WITH my_customers AS (select /*+ MATERIALIZED */ distinct c_customer_sk, c_current_addr_sk from ( select cs_sold_date_sk sold_date_sk, cs_bill_customer_sk customer_sk, cs_item_sk item_sk, cs_wholesale_cost wholesale_cost from catalog_sales union all select ws_sold_date_sk sold_date_sk, ws_bill_customer_sk customer_sk, ws_item_sk item_sk, ws_wholesale_cost wholesale_cost from web_sales ) cs_or_ws_sales, item, date_dim, customer where sold_date_sk = d_date_sk and item_sk = i_item_sk and i_category = 'Electronics' and i_class = 'personal' and c_customer_sk = cs_or_ws_sales.customer_sk and d_moy = 1 and d_year = 1998 and wholesale_cost BETWEEN 35 AND 65 and c_birth_year BETWEEN 1928 AND 1941), my_revenue AS (SELECT c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers, store_sales, customer_address, store, date_dim WHERE c_current_addr_sk = ca_address_sk AND ca_county = s_county AND ca_state = s_state AND ss_sold_date_sk = d_date_sk AND c_customer_sk = ss_customer_sk AND ss_wholesale_cost BETWEEN 35 AND 65 AND s_state IN ('AR', 'CO', 'IA', 'IL', 'KY', 'NC', 'NM', 'NY', 'PA', 'TX') AND d_month_seq BETWEEN (SELECT DISTINCT d_month_seq + 1 FROM date_dim WHERE d_year = 1998 AND d_moy = 1) AND (SELECT DISTINCT d_month_seq + 3 FROM date_dim WHERE d_year = 1998 AND d_moy = 1) GROUP BY c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Materialize my_customers CTE to avoid recomputation during my_revenue processing. Use Snowflake's MATERIALIZED hint or subquery factoring."
    },
    {
      "patch_id": "p07",
      "family": "A",
      "transform": "shared_dimension_multi_channel",
      "relevance_score": 0.5,
      "status": "NEUTRAL",
      "speedup": 1.02,
      "semantic_passed": true,
      "error": null,
      "original_ms": 254.5,
      "patch_ms": 249.6,
      "output_sql": "WITH shared_date_filter AS (select d_date_sk from date_dim where d_moy = 1 and d_year = 1998), my_customers AS (select distinct c_customer_sk\n        , c_current_addr_sk\n from\n        ( select cs_sold_date_sk sold_date_sk,\n                 cs_bill_customer_sk customer_sk,\n                 cs_item_sk item_sk,\n                 cs_wholesale_cost wholesale_cost\n          from   catalog_sales\n          join shared_date_filter on cs_sold_date_sk = shared_date_filter.d_date_sk\n          union all\n          select ws_sold_date_sk sold_date_sk,\n                 ws_bill_customer_sk customer_sk,\n                 ws_item_sk item_sk,\n                 ws_wholesale_cost wholesale_cost\n          from   web_sales\n          join shared_date_filter on ws_sold_date_sk = shared_date_filter.d_date_sk\n         ) cs_or_ws_sales,\n         item,\n         customer\n where   item_sk = i_item_sk\n         and i_category = 'Electronics'\n         and i_class = 'personal'\n         and c_customer_sk = cs_or_ws_sales.customer_sk\n         and wholesale_cost BETWEEN 35 AND 65\n         and c_birth_year BETWEEN 1928 AND 1941), my_revenue AS (SELECT c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers, store_sales, customer_address, store, date_dim WHERE c_current_addr_sk = ca_address_sk AND ca_county = s_county AND ca_state = s_state AND ss_sold_date_sk = d_date_sk AND c_customer_sk = ss_customer_sk AND ss_wholesale_cost BETWEEN 35 AND 65 AND s_state IN ('AR', 'CO', 'IA', 'IL', 'KY', 'NC', 'NM', 'NY', 'PA', 'TX') AND d_month_seq BETWEEN (SELECT DISTINCT d_month_seq + 1 FROM date_dim WHERE d_year = 1998 AND d_moy = 1) AND (SELECT DISTINCT d_month_seq + 3 FROM date_dim WHERE d_year = 1998 AND d_moy = 1) GROUP BY c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Create single filtered date_dim CTE shared across catalog_sales and web_sales channels in my_customers CTE. Replace separate date_dim references with CTE join."
    },
    {
      "patch_id": "p02",
      "family": "A",
      "transform": "sf_sk_pushdown_multi_fact",
      "relevance_score": 0.82,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH my_customers AS (SELECT DISTINCT c_customer_sk, c_current_addr_sk FROM (SELECT cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk, cs_wholesale_cost AS wholesale_cost FROM catalog_sales UNION ALL SELECT ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk, ws_wholesale_cost AS wholesale_cost FROM web_sales) AS cs_or_ws_sales, item, date_dim, customer WHERE sold_date_sk = d_date_sk AND item_sk = i_item_sk AND i_category = 'Electronics' AND i_class = 'personal' AND c_customer_sk = cs_or_ws_sales.customer_sk AND d_moy = 1 AND d_year = 1998 AND wholesale_cost BETWEEN 35 AND 65 AND c_birth_year BETWEEN 1928 AND 1941), my_revenue AS (with date_range as (\n  select\n    (select distinct d1.d_date_sk\n     from date_dim d1\n     where d1.d_month_seq = (select distinct d_month_seq+1 from date_dim where d_year = 1998 and d_moy = 1)\n       and d1.d_year = 1998 and d1.d_moy = 1) as min_sk,\n    (select distinct d2.d_date_sk\n     from date_dim d2\n     where d2.d_month_seq = (select distinct d_month_seq+3 from date_dim where d_year = 1998 and d_moy = 1)\n       and d2.d_year = 1998 and d2.d_moy = 1) as max_sk\n)\nselect c_customer_sk,\n       sum(ss_ext_sales_price) as revenue\nfrom my_customers,\n     store_sales,\n     customer_address,\n     store,\n     date_range\nwhere c_current_addr_sk = ca_address_sk\n  and ca_county = s_county\n  and ca_state = s_state\n  and ss_sold_date_sk between date_range.min_sk and date_range.max_sk\n  and c_customer_sk = ss_customer_sk\n  and ss_wholesale_cost BETWEEN 35 AND 65\n  and s_state in ('AR','CO','IA','IL','KY','NC','NM','NY','PA','TX')\ngroup by c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Push date_sk range predicate into store_sales scan in my_revenue CTE. Compute d_month_seq range from subqueries, convert to date_sk range via date_dim lookup, apply as ss_sold_date_sk BETWEEN min_sk AND max_sk."
    },
    {
      "patch_id": "p04",
      "family": "B",
      "transform": "sf_inline_decorrelate",
      "relevance_score": 0.68,
      "status": "REGRESSION",
      "speedup": 0.27,
      "semantic_passed": true,
      "error": null,
      "original_ms": 254.5,
      "patch_ms": 952.3,
      "output_sql": "WITH my_customers AS (SELECT DISTINCT c_customer_sk, c_current_addr_sk FROM (SELECT cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk, cs_wholesale_cost AS wholesale_cost FROM catalog_sales UNION ALL SELECT ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk, ws_wholesale_cost AS wholesale_cost FROM web_sales) AS cs_or_ws_sales, item, date_dim, customer WHERE sold_date_sk = d_date_sk AND item_sk = i_item_sk AND i_category = 'Electronics' AND i_class = 'personal' AND c_customer_sk = cs_or_ws_sales.customer_sk AND d_moy = 1 AND d_year = 1998 AND wholesale_cost BETWEEN 35 AND 65 AND c_birth_year BETWEEN 1928 AND 1941), d_month_seq_bounds AS (select \n  (select distinct d_month_seq+1 from date_dim where d_year = 1998 and d_moy = 1) as min_seq,\n  (select distinct d_month_seq+3 from date_dim where d_year = 1998 and d_moy = 1) as max_seq), my_revenue AS (select c_customer_sk,\n       sum(ss_ext_sales_price) as revenue\nfrom   my_customers,\n       store_sales,\n       customer_address,\n       store,\n       date_dim,\n       d_month_seq_bounds\nwhere  c_current_addr_sk = ca_address_sk\n       and ca_county = s_county\n       and ca_state = s_state\n       and ss_sold_date_sk = d_date_sk\n       and c_customer_sk = ss_customer_sk\n       and ss_wholesale_cost BETWEEN 35 AND 65\n       and s_state in ('AR','CO','IA'\n                   ,'IL','KY','NC'\n                   ,'NM','NY','PA'\n                   ,'TX')\n       and d_month_seq between d_month_seq_bounds.min_seq and d_month_seq_bounds.max_seq\ngroup by c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Decompose correlated date_dim subqueries in my_revenue CTE into precomputed date_sk range CTE. Replace (SELECT d_month_seq+1 FROM date_dim WHERE d_year=1998 AND d_moy=1) with constant CTE values."
    },
    {
      "patch_id": "p03",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.75,
      "status": "WIN",
      "speedup": 1.14,
      "semantic_passed": true,
      "error": null,
      "original_ms": 254.5,
      "patch_ms": 224.1,
      "output_sql": "WITH my_customers AS (with preagg_sales as (select cs_bill_customer_sk as customer_sk, cs_sold_date_sk as sold_date_sk, cs_item_sk as item_sk, count(*) as cnt from catalog_sales where cs_wholesale_cost between 35 and 65 group by cs_bill_customer_sk, cs_sold_date_sk, cs_item_sk union all select ws_bill_customer_sk as customer_sk, ws_sold_date_sk as sold_date_sk, ws_item_sk as item_sk, count(*) as cnt from web_sales where ws_wholesale_cost between 35 and 65 group by ws_bill_customer_sk, ws_sold_date_sk, ws_item_sk) select distinct c.c_customer_sk, c.c_current_addr_sk from preagg_sales cs_or_ws_sales join item i on cs_or_ws_sales.item_sk = i.i_item_sk join date_dim d on cs_or_ws_sales.sold_date_sk = d.d_date_sk join customer c on cs_or_ws_sales.customer_sk = c.c_customer_sk where i.i_category = 'Electronics' and i.i_class = 'personal' and d.d_moy = 1 and d.d_year = 1998 and c.c_birth_year between 1928 and 1941), my_revenue AS (SELECT c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers, store_sales, customer_address, store, date_dim WHERE c_current_addr_sk = ca_address_sk AND ca_county = s_county AND ca_state = s_state AND ss_sold_date_sk = d_date_sk AND c_customer_sk = ss_customer_sk AND ss_wholesale_cost BETWEEN 35 AND 65 AND s_state IN ('AR', 'CO', 'IA', 'IL', 'KY', 'NC', 'NM', 'NY', 'PA', 'TX') AND d_month_seq BETWEEN (SELECT DISTINCT d_month_seq + 1 FROM date_dim WHERE d_year = 1998 AND d_moy = 1) AND (SELECT DISTINCT d_month_seq + 3 FROM date_dim WHERE d_year = 1998 AND d_moy = 1) GROUP BY c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-aggregate catalog_sales and web_sales by (cs_bill_customer_sk, cs_sold_date_sk, cs_item_sk) before semi-joins with item and date_dim in my_customers CTE. Maintain distinctness requirement via COUNT(*)."
    },
    {
      "patch_id": "p05",
      "family": "A",
      "transform": "dimension_cte_isolate",
      "relevance_score": 0.55,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_item AS (select i_item_sk from item where i_category = 'Electronics' and i_class = 'personal'), filtered_date AS (select d_date_sk from date_dim where d_moy = 1 and d_year = 1998), filtered_customer AS (select c_customer_sk, c_current_addr_sk from customer where c_birth_year BETWEEN 1928 AND 1941), my_customers AS (select distinct c_customer_sk, c_current_addr_sk from (select cs_sold_date_sk sold_date_sk, cs_bill_customer_sk customer_sk, cs_item_sk item_sk, cs_wholesale_cost wholesale_cost from catalog_sales union all select ws_sold_date_sk sold_date_sk, ws_bill_customer_sk customer_sk, ws_item_sk item_sk, ws_wholesale_cost wholesale_cost from web_sales) cs_or_ws_sales, filtered_item, filtered_date, filtered_customer where sold_date_sk = d_date_sk and item_sk = i_item_sk and i_category = 'Electronics' and i_class = 'personal' and c_customer_sk = cs_or_ws_sales.customer_sk and d_moy = 1 and d_year = 1998 and wholesale_cost BETWEEN 35 AND 65 and c_birth_year BETWEEN 1928 AND 1941), my_revenue AS (SELECT c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers, store_sales, customer_address, store, date_dim WHERE c_current_addr_sk = ca_address_sk AND ca_county = s_county AND ca_state = s_state AND ss_sold_date_sk = d_date_sk AND c_customer_sk = ss_customer_sk AND ss_wholesale_cost BETWEEN 35 AND 65 AND s_state IN ('AR', 'CO', 'IA', 'IL', 'KY', 'NC', 'NM', 'NY', 'PA', 'TX') AND d_month_seq BETWEEN (SELECT DISTINCT d_month_seq + 1 FROM date_dim WHERE d_year = 1998 AND d_moy = 1) AND (SELECT DISTINCT d_month_seq + 3 FROM date_dim WHERE d_year = 1998 AND d_moy = 1) GROUP BY c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Extract small dimension filters (item, date_dim, customer) into separate CTEs before joining with fact tables in my_customers CTE. Create filtered_item, filtered_date, filtered_customer CTEs."
    },
    {
      "patch_id": "p08",
      "family": "F",
      "transform": "inner_join_conversion",
      "relevance_score": 0.4,
      "status": "IMPROVED",
      "speedup": 1.1,
      "semantic_passed": true,
      "error": null,
      "original_ms": 254.5,
      "patch_ms": 231.4,
      "output_sql": "WITH my_customers AS (SELECT DISTINCT c.c_customer_sk, c.c_current_addr_sk FROM (SELECT cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk, cs_wholesale_cost AS wholesale_cost FROM catalog_sales UNION ALL SELECT ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk, ws_wholesale_cost AS wholesale_cost FROM web_sales) cs_or_ws_sales INNER JOIN item i ON cs_or_ws_sales.item_sk = i.i_item_sk INNER JOIN date_dim d ON cs_or_ws_sales.sold_date_sk = d.d_date_sk INNER JOIN customer c ON cs_or_ws_sales.customer_sk = c.c_customer_sk WHERE i.i_category = 'Electronics' AND i.i_class = 'personal' AND d.d_moy = 1 AND d.d_year = 1998 AND cs_or_ws_sales.wholesale_cost BETWEEN 35 AND 65 AND c.c_birth_year BETWEEN 1928 AND 1941), my_revenue AS (SELECT c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers, store_sales, customer_address, store, date_dim WHERE c_current_addr_sk = ca_address_sk AND ca_county = s_county AND ca_state = s_state AND ss_sold_date_sk = d_date_sk AND c_customer_sk = ss_customer_sk AND ss_wholesale_cost BETWEEN 35 AND 65 AND s_state IN ('AR', 'CO', 'IA', 'IL', 'KY', 'NC', 'NM', 'NY', 'PA', 'TX') AND d_month_seq BETWEEN (SELECT DISTINCT d_month_seq + 1 FROM date_dim WHERE d_year = 1998 AND d_moy = 1) AND (SELECT DISTINCT d_month_seq + 3 FROM date_dim WHERE d_year = 1998 AND d_moy = 1) GROUP BY c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Convert comma-separated joins in my_customers CTE to explicit INNER JOIN syntax to improve cardinality estimation and join ordering flexibility."
    }
  ],
  "explains": {
    "p01": "GlobalStats | 155745 | 153233 | 2596910891008\n1 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 1\n1 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 1]\n1 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND (DATE_DIM.D_MOY = 1)\n1 | 5 | [4] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_MONTH_SEQ, D_YEAR, D_MOY | 1 | 1 | 2138624\n2 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 3\n2 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 3]\n2 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND",
    "p06": "GlobalStats | 155743 | 153231 | 2596906613760\n1 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 1\n1 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 1]\n1 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND (DATE_DIM.D_MOY = 1)\n1 | 5 | [4] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_MONTH_SEQ, D_YEAR, D_MOY | 1 | 1 | 2138624\n2 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 3\n2 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 3]\n2 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND",
    "p07": "GlobalStats | 155743 | 153437 | 2600424714752\n1 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 1\n1 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 1]\n1 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND (DATE_DIM.D_MOY = 1)\n1 | 5 | [4] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_MONTH_SEQ, D_YEAR, D_MOY | 1 | 1 | 2138624\n2 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 3\n2 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 3]\n2 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND",
    "p04": "GlobalStats | 155743 | 155537 | 2636202446336\n1 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 1\n1 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 1]\n1 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND (DATE_DIM.D_MOY = 1)\n1 | 5 | [4] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_MONTH_SEQ, D_YEAR, D_MOY | 1 | 1 | 2138624\n2 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 3\n2 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 3]\n2 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND",
    "p03": "GlobalStats | 155743 | 153231 | 2596906613760\n1 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 1\n1 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 1]\n1 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND (DATE_DIM.D_MOY = 1)\n1 | 5 | [4] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_MONTH_SEQ, D_YEAR, D_MOY | 1 | 1 | 2138624\n2 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 3\n2 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 3]\n2 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND",
    "p08": "GlobalStats | 155743 | 153231 | 2596906613760\n1 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 1\n1 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 1]\n1 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND (DATE_DIM.D_MOY = 1)\n1 | 5 | [4] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_MONTH_SEQ, D_YEAR, D_MOY | 1 | 1 | 2138624\n2 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 3\n2 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 3]\n2 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND"
  }
}