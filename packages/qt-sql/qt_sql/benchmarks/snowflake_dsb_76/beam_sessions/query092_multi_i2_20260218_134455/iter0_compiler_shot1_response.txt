```json
[
  {
    "plan_id": "compile_p1_decorr",
    "dialect": "snowflake",
    "confidence": 0.68,
    "based_on": "p01",
    "strategy": "Decorrelation of correlated scalar aggregate via precomputed per-item averages, removing repeated rescans of web_sales.",
    "hypothesis": "Primary hotspot is correlated subquery causing repeated full scans of WEB_SALES (461 GB each). p01 decorrelation attempt was safe but showed neutral speedup (0.97x). This attempt uses inner join and explicit grouping to preserve semantics while eliminating nested-loop pattern.",
    "expected_explain_delta": "Remove nested-loop correlation operators; reduce WEB_SALES scans from two full scans to one scan for outer join and one aggregated scan for inner precomputation.",
    "target_ir": "Add item_avg_discount CTE computing per-item average under inner filter; rewrite final_select as join with threshold comparison.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["web_sales", "item", "date_dim", "item_avg_discount"],
          "outputs": ["Excess Discount Amount"],
          "changed": true,
          "sql": "SELECT SUM(ws.ws_ext_discount_amt) AS \"Excess Discount Amount\" FROM web_sales ws JOIN item i ON i.i_item_sk = ws.ws_item_sk JOIN date_dim d ON d.d_date_sk = ws.ws_sold_date_sk JOIN item_avg_discount a ON ws.ws_item_sk = a.ws_item_sk WHERE (i.i_manufact_id BETWEEN 797 AND 996 OR i.i_category IN ('Men', 'Shoes', 'Sports')) AND d.d_date BETWEEN '1999-01-29' AND CAST('1999-01-29' AS DATE) + INTERVAL '90 day' AND ws.ws_wholesale_cost BETWEEN 35 AND 55 AND ws.ws_ext_discount_amt > 1.3 * a.avg_discount ORDER BY SUM(ws.ws_ext_discount_amt) LIMIT 100"
        },
        {
          "node_id": "item_avg_discount",
          "parent_node_id": "final_select",
          "sources": ["web_sales", "date_dim"],
          "outputs": ["ws_item_sk", "avg_discount"],
          "changed": true,
          "sql": "SELECT ws_item_sk, AVG(ws_ext_discount_amt) AS avg_discount FROM web_sales JOIN date_dim ON d_date_sk = ws_sold_date_sk WHERE d_date BETWEEN '1999-01-29' AND CAST('1999-01-29' AS DATE) + INTERVAL '90 day' AND ws_wholesale_cost BETWEEN 35 AND 55 AND ws_sales_price / ws_list_price BETWEEN 76 * 0.01 AND 91 * 0.01 GROUP BY ws_item_sk"
        }
      ]
    }
  }
]
```