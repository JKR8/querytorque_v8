{
  "iteration": 0,
  "n_api_calls": 3,
  "beam_cost_usd": 0.0,
  "beam_cost_priced_calls": 0,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 0,
    "completion_tokens": 0,
    "total_tokens": 0,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 0,
    "reasoning_tokens": 0
  },
  "best_speedup": 1.17,
  "best_patch_id": "compile_p08",
  "best_sql": "SELECT SUBSTRING(r_reason_desc, 1, 20), AVG(ws_quantity), AVG(wr_refunded_cash), AVG(wr_fee) FROM web_sales INNER JOIN web_returns ON ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number INNER JOIN web_page ON ws_web_page_sk = wp_web_page_sk INNER JOIN date_dim ON ws_sold_date_sk = d_date_sk INNER JOIN customer_demographics cd1 ON cd1.cd_demo_sk = wr_refunded_cdemo_sk INNER JOIN customer_demographics cd2 ON cd2.cd_demo_sk = wr_returning_cdemo_sk INNER JOIN customer_address ON ca_address_sk = wr_refunded_addr_sk INNER JOIN reason ON r_reason_sk = wr_reason_sk WHERE d_year = 2000 AND ((cd1.cd_marital_status = 'S' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'College' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 100.00 AND 150.00) OR (cd1.cd_marital_status = 'W' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'Unknown' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 50.00 AND 100.00) OR (cd1.cd_marital_status = 'M' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'Secondary' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 150.00 AND 200.00)) AND ((ca_country = 'United States' AND ca_state IN ('NC', 'PA', 'TX') AND ws_net_profit BETWEEN 100 AND 200) OR (ca_country = 'United States' AND ca_state IN ('AR', 'CO', 'NY') AND ws_net_profit BETWEEN 150 AND 300) OR (ca_country = 'United States' AND ca_state IN ('IA', 'IL', 'TX') AND ws_net_profit BETWEEN 50 AND 250)) GROUP BY r_reason_desc ORDER BY SUBSTRING(r_reason_desc, 1, 20), AVG(ws_quantity), AVG(wr_refunded_cash), AVG(wr_fee) LIMIT 100;",
  "patches": [
    {
      "patch_id": "p07",
      "family": "E",
      "transform": "materialize_cte",
      "relevance_score": 0.5,
      "status": "REGRESSION",
      "speedup": 0.63,
      "semantic_passed": true,
      "error": null,
      "original_ms": 152.5,
      "patch_ms": 243.5,
      "output_sql": "select  substring(r_reason_desc,1,20)\n       ,avg(ws_quantity)\n       ,avg(wr_refunded_cash)\n       ,avg(wr_fee)\n from web_sales, web_returns, web_page, customer_demographics cd1,\n      customer_demographics cd2, customer_address, date_dim, reason\n where ws_web_page_sk = wp_web_page_sk\n   and ws_item_sk = wr_item_sk\n   and ws_order_number = wr_order_number\n   and ws_sold_date_sk = d_date_sk and d_year = 2000\n   and cd1.cd_demo_sk = wr_refunded_cdemo_sk\n   and cd2.cd_demo_sk = wr_returning_cdemo_sk\n   and ca_address_sk = wr_refunded_addr_sk\n   and r_reason_sk = wr_reason_sk\n   and\n   (\n    (\n     cd1.cd_marital_status = 'S'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'College'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 100.00 and 150.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'W'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Unknown'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 50.00 and 100.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'M'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Secondary'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 150.00 and 200.00\n    )\n   )\n   and\n   (\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('NC', 'PA', 'TX')\n     and ws_net_profit between 100 and 200\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('AR', 'CO', 'NY')\n     and ws_net_profit between 150 and 300\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('IA', 'IL', 'TX')\n     and ws_net_profit between 50 and 250\n    )\n   )\ngroup by r_reason_desc\norder by substring(r_reason_desc,1,20)\n        ,avg(ws_quantity)\n        ,avg(wr_refunded_cash)\n        ,avg(wr_fee)\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Materialize the filtered web_sales and web_returns join result (with date and demo filters) into a CTE to avoid repeated subtree scans in aggregation levels."
    },
    {
      "patch_id": "p05",
      "family": "C",
      "transform": "channel_bitmap_aggregation",
      "relevance_score": 0.6,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": true,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select  substring(r_reason_desc,1,20)\n       ,avg(ws_quantity)\n       ,avg(wr_refunded_cash)\n       ,avg(wr_fee)\n from web_sales, web_returns, web_page, customer_demographics cd1,\n      customer_demographics cd2, customer_address, date_dim, reason\n where ws_web_page_sk = wp_web_page_sk\n   and ws_item_sk = wr_item_sk\n   and ws_order_number = wr_order_number\n   and ws_sold_date_sk = d_date_sk and d_year = 2000\n   and cd1.cd_demo_sk = wr_refunded_cdemo_sk\n   and cd2.cd_demo_sk = wr_returning_cdemo_sk\n   and ca_address_sk = wr_refunded_addr_sk\n   and r_reason_sk = wr_reason_sk\n   and\n   (\n    (\n     cd1.cd_marital_status = 'S'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'College'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 100.00 and 150.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'W'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Unknown'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 50.00 and 100.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'M'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Secondary'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 150.00 and 200.00\n    )\n   )\n   and\n   (\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('NC', 'PA', 'TX')\n     and ws_net_profit between 100 and 200\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('AR', 'CO', 'NY')\n     and ws_net_profit between 150 and 300\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('IA', 'IL', 'TX')\n     and ws_net_profit between 50 and 250\n    )\n   )\ngroup by r_reason_desc\norder by substring(r_reason_desc,1,20)\n        ,avg(ws_quantity)\n        ,avg(wr_refunded_cash)\n        ,avg(wr_fee)\nlimit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Consolidate the two customer_demographics scans (cd1, cd2) into a single scan with conditional aggregation for the matching logic."
    },
    {
      "patch_id": "p02",
      "family": "D",
      "transform": "or_to_union",
      "relevance_score": 0.7,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": false,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select  substring(r_reason_desc,1,20)\n       ,avg(ws_quantity)\n       ,avg(wr_refunded_cash)\n       ,avg(wr_fee)\n from web_sales, web_returns, web_page, customer_demographics cd1,\n      customer_demographics cd2, customer_address, date_dim, reason\n where ws_web_page_sk = wp_web_page_sk\n   and ws_item_sk = wr_item_sk\n   and ws_order_number = wr_order_number\n   and ws_sold_date_sk = d_date_sk and d_year = 2000\n   and cd1.cd_demo_sk = wr_refunded_cdemo_sk\n   and cd2.cd_demo_sk = wr_returning_cdemo_sk\n   and ca_address_sk = wr_refunded_addr_sk\n   and r_reason_sk = wr_reason_sk\n   and\n   (\n    (\n     cd1.cd_marital_status = 'S'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'College'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 100.00 and 150.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'W'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Unknown'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 50.00 and 100.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'M'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Secondary'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 150.00 and 200.00\n    )\n   )\n   and\n   (\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('NC', 'PA', 'TX')\n     and ws_net_profit between 100 and 200\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('AR', 'CO', 'NY')\n     and ws_net_profit between 150 and 300\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('IA', 'IL', 'TX')\n     and ws_net_profit between 50 and 250\n    )\n   )\ngroup by r_reason_desc\norder by substring(r_reason_desc,1,20)\n        ,avg(ws_quantity)\n        ,avg(wr_refunded_cash)\n        ,avg(wr_fee)\nlimit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Split the 3-way OR on (cd_marital_status, cd_education_status, ws_sales_price) into three UNION ALL branches, each with a focused predicate set, preserving other filters."
    },
    {
      "patch_id": "p01",
      "family": "A",
      "transform": "sf_sk_pushdown_multi_fact",
      "relevance_score": 0.85,
      "status": "REGRESSION",
      "speedup": 0.63,
      "semantic_passed": true,
      "error": null,
      "original_ms": 152.5,
      "patch_ms": 243.3,
      "output_sql": "WITH date_range AS (SELECT MIN(d_date_sk) AS min_sk, MAX(d_date_sk) AS max_sk FROM date_dim WHERE d_year = 2000), web_sales_pruned AS (SELECT * FROM web_sales WHERE ws_sold_date_sk BETWEEN (SELECT min_sk FROM date_range) AND (SELECT max_sk FROM date_range)) select  substring(r_reason_desc,1,20)\n       ,avg(ws_quantity)\n       ,avg(wr_refunded_cash)\n       ,avg(wr_fee)\n from web_sales, web_returns, web_page, customer_demographics cd1,\n      customer_demographics cd2, customer_address, date_dim, reason\n where ws_web_page_sk = wp_web_page_sk\n   and ws_item_sk = wr_item_sk\n   and ws_order_number = wr_order_number\n   and ws_sold_date_sk = d_date_sk and d_year = 2000\n   and cd1.cd_demo_sk = wr_refunded_cdemo_sk\n   and cd2.cd_demo_sk = wr_returning_cdemo_sk\n   and ca_address_sk = wr_refunded_addr_sk\n   and r_reason_sk = wr_reason_sk\n   and\n   (\n    (\n     cd1.cd_marital_status = 'S'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'College'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 100.00 and 150.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'W'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Unknown'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 50.00 and 100.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'M'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Secondary'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 150.00 and 200.00\n    )\n   )\n   and\n   (\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('NC', 'PA', 'TX')\n     and ws_net_profit between 100 and 200\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('AR', 'CO', 'NY')\n     and ws_net_profit between 150 and 300\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('IA', 'IL', 'TX')\n     and ws_net_profit between 50 and 250\n    )\n   )\ngroup by r_reason_desc\norder by substring(r_reason_desc,1,20)\n        ,avg(ws_quantity)\n        ,avg(wr_refunded_cash)\n        ,avg(wr_fee)\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Add explicit ws_sold_date_sk BETWEEN min_sk AND max_sk derived from date_dim filter (d_year=2000) to WEB_SALES scan, using a CTE to compute date_sk range."
    },
    {
      "patch_id": "p04",
      "family": "A",
      "transform": "multi_dimension_prefetch",
      "relevance_score": 0.55,
      "status": "REGRESSION",
      "speedup": 0.51,
      "semantic_passed": true,
      "error": null,
      "original_ms": 152.5,
      "patch_ms": 301.1,
      "output_sql": "WITH web_sales_prefetch AS (SELECT ws_web_page_sk, ws_item_sk, ws_order_number, ws_sold_date_sk, ws_quantity, ws_sales_price, ws_net_profit FROM web_sales), web_returns_prefetch AS (SELECT wr_item_sk, wr_refunded_cdemo_sk, wr_refunded_addr_sk, wr_returning_cdemo_sk, wr_reason_sk, wr_order_number, wr_fee, wr_refunded_cash FROM web_returns), date_dim_cte AS (SELECT d_date_sk, d_year FROM date_dim WHERE d_year = 2000), customer_demographics_cd1_cte AS (SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE cd_marital_status IN ('S', 'W', 'M') AND cd_education_status IN ('College', 'Unknown', 'Secondary')), customer_demographics_cd2_cte AS (SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE cd_marital_status IN ('S', 'W', 'M') AND cd_education_status IN ('College', 'Unknown', 'Secondary')), customer_address_cte AS (SELECT ca_address_sk, ca_state, ca_country FROM customer_address WHERE ca_country = 'United States' AND ca_state IN ('NC', 'PA', 'TX', 'AR', 'CO', 'NY', 'IA', 'IL', 'TX')), reason_cte AS (SELECT r_reason_sk, r_reason_desc FROM reason), web_page_cte AS (SELECT wp_web_page_sk FROM web_page) SELECT SUBSTRING(r_reason_desc, 1, 20), AVG(ws_quantity), AVG(wr_refunded_cash), AVG(wr_fee) FROM web_sales_prefetch, web_returns_prefetch, web_page_cte, customer_demographics_cd1_cte cd1, customer_demographics_cd2_cte cd2, customer_address_cte, reason_cte, date_dim_cte WHERE web_sales_prefetch.ws_web_page_sk = web_page_cte.wp_web_page_sk AND web_sales_prefetch.ws_item_sk = web_returns_prefetch.wr_item_sk AND web_sales_prefetch.ws_order_number = web_returns_prefetch.wr_order_number AND web_sales_prefetch.ws_sold_date_sk = date_dim_cte.d_date_sk AND cd1.cd_demo_sk = web_returns_prefetch.wr_refunded_cdemo_sk AND cd2.cd_demo_sk = web_returns_prefetch.wr_returning_cdemo_sk AND customer_address_cte.ca_address_sk = web_returns_prefetch.wr_refunded_addr_sk AND reason_cte.r_reason_sk = web_returns_prefetch.wr_reason_sk AND ((cd1.cd_marital_status = 'S' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'College' AND cd1.cd_education_status = cd2.cd_education_status AND web_sales_prefetch.ws_sales_price BETWEEN 100.00 AND 150.00) OR (cd1.cd_marital_status = 'W' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'Unknown' AND cd1.cd_education_status = cd2.cd_education_status AND web_sales_prefetch.ws_sales_price BETWEEN 50.00 AND 100.00) OR (cd1.cd_marital_status = 'M' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'Secondary' AND cd1.cd_education_status = cd2.cd_education_status AND web_sales_prefetch.ws_sales_price BETWEEN 150.00 AND 200.00)) AND ((customer_address_cte.ca_country = 'United States' AND customer_address_cte.ca_state IN ('NC', 'PA', 'TX') AND web_sales_prefetch.ws_net_profit BETWEEN 100 AND 200) OR (customer_address_cte.ca_country = 'United States' AND customer_address_cte.ca_state IN ('AR', 'CO', 'NY') AND web_sales_prefetch.ws_net_profit BETWEEN 150 AND 300) OR (customer_address_cte.ca_country = 'United States' AND customer_address_cte.ca_state IN ('IA', 'IL', 'TX') AND web_sales_prefetch.ws_net_profit BETWEEN 50 AND 250)) GROUP BY r_reason_desc ORDER BY SUBSTRING(r_reason_desc, 1, 20), AVG(ws_quantity), AVG(wr_refunded_cash), AVG(wr_fee) LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Create CTEs for all selective dimensions (date_dim, customer_demographics cd1, cd2, customer_address, reason, web_page) with their filters, then join with fact tables."
    },
    {
      "patch_id": "p03",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.75,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": true,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select  substring(r_reason_desc,1,20)\n       ,avg(ws_quantity)\n       ,avg(wr_refunded_cash)\n       ,avg(wr_fee)\n from web_sales, web_returns, web_page, customer_demographics cd1,\n      customer_demographics cd2, customer_address, date_dim, reason\n where ws_web_page_sk = wp_web_page_sk\n   and ws_item_sk = wr_item_sk\n   and ws_order_number = wr_order_number\n   and ws_sold_date_sk = d_date_sk and d_year = 2000\n   and cd1.cd_demo_sk = wr_refunded_cdemo_sk\n   and cd2.cd_demo_sk = wr_returning_cdemo_sk\n   and ca_address_sk = wr_refunded_addr_sk\n   and r_reason_sk = wr_reason_sk\n   and\n   (\n    (\n     cd1.cd_marital_status = 'S'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'College'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 100.00 and 150.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'W'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Unknown'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 50.00 and 100.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'M'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Secondary'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 150.00 and 200.00\n    )\n   )\n   and\n   (\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('NC', 'PA', 'TX')\n     and ws_net_profit between 100 and 200\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('AR', 'CO', 'NY')\n     and ws_net_profit between 150 and 300\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('IA', 'IL', 'TX')\n     and ws_net_profit between 50 and 250\n    )\n   )\ngroup by r_reason_desc\norder by substring(r_reason_desc,1,20)\n        ,avg(ws_quantity)\n        ,avg(wr_refunded_cash)\n        ,avg(wr_fee)\nlimit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre-aggregate web_sales by (ws_item_sk, ws_order_number, ws_web_page_sk, ws_sold_date_sk) and web_returns by (wr_item_sk, wr_order_number, wr_reason_sk) before joining, computing partial sums/counts for averages."
    },
    {
      "patch_id": "p06",
      "family": "B",
      "transform": "sf_inline_decorrelate",
      "relevance_score": 0.45,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": false,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select  substring(r_reason_desc,1,20)\n       ,avg(ws_quantity)\n       ,avg(wr_refunded_cash)\n       ,avg(wr_fee)\n from web_sales, web_returns, web_page, customer_demographics cd1,\n      customer_demographics cd2, customer_address, date_dim, reason\n where ws_web_page_sk = wp_web_page_sk\n   and ws_item_sk = wr_item_sk\n   and ws_order_number = wr_order_number\n   and ws_sold_date_sk = d_date_sk and d_year = 2000\n   and cd1.cd_demo_sk = wr_refunded_cdemo_sk\n   and cd2.cd_demo_sk = wr_returning_cdemo_sk\n   and ca_address_sk = wr_refunded_addr_sk\n   and r_reason_sk = wr_reason_sk\n   and\n   (\n    (\n     cd1.cd_marital_status = 'S'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'College'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 100.00 and 150.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'W'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Unknown'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 50.00 and 100.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'M'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Secondary'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 150.00 and 200.00\n    )\n   )\n   and\n   (\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('NC', 'PA', 'TX')\n     and ws_net_profit between 100 and 200\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('AR', 'CO', 'NY')\n     and ws_net_profit between 150 and 300\n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('IA', 'IL', 'TX')\n     and ws_net_profit between 50 and 250\n    )\n   )\ngroup by r_reason_desc\norder by substring(r_reason_desc,1,20)\n        ,avg(ws_quantity)\n        ,avg(wr_refunded_cash)\n        ,avg(wr_fee)\nlimit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Decompose any implicit correlation (none present) \u2014 not applicable; repurpose as exploration: extract OR on ca_state and ws_net_profit into separate CTE for predicate isolation."
    },
    {
      "patch_id": "p08",
      "family": "F",
      "transform": "inner_join_conversion",
      "relevance_score": 0.4,
      "status": "REGRESSION",
      "speedup": 0.86,
      "semantic_passed": true,
      "error": null,
      "original_ms": 152.5,
      "patch_ms": 177.4,
      "output_sql": "SELECT\n  SUBSTRING(r_reason_desc, 1, 20),\n  AVG(ws_quantity),\n  AVG(wr_refunded_cash),\n  AVG(wr_fee)\nFROM web_sales\nINNER JOIN web_returns\n  ON ws_item_sk = wr_item_sk\n  AND ws_order_number = wr_order_number\nINNER JOIN web_page\n  ON ws_web_page_sk = wp_web_page_sk\nINNER JOIN date_dim\n  ON ws_sold_date_sk = d_date_sk\nINNER JOIN customer_demographics cd1\n  ON cd1.cd_demo_sk = wr_refunded_cdemo_sk\nINNER JOIN customer_demographics cd2\n  ON cd2.cd_demo_sk = wr_returning_cdemo_sk\nINNER JOIN customer_address\n  ON ca_address_sk = wr_refunded_addr_sk\nINNER JOIN reason\n  ON r_reason_sk = wr_reason_sk\nWHERE d_year = 2000\n  AND (\n    (\n      cd1.cd_marital_status = 'S'\n      AND cd1.cd_marital_status = cd2.cd_marital_status\n      AND cd1.cd_education_status = 'College'\n      AND cd1.cd_education_status = cd2.cd_education_status\n      AND ws_sales_price BETWEEN 100.00 AND 150.00\n    )\n    OR (\n      cd1.cd_marital_status = 'W'\n      AND cd1.cd_marital_status = cd2.cd_marital_status\n      AND cd1.cd_education_status = 'Unknown'\n      AND cd1.cd_education_status = cd2.cd_education_status\n      AND ws_sales_price BETWEEN 50.00 AND 100.00\n    )\n    OR (\n      cd1.cd_marital_status = 'M'\n      AND cd1.cd_marital_status = cd2.cd_marital_status\n      AND cd1.cd_education_status = 'Secondary'\n      AND cd1.cd_education_status = cd2.cd_education_status\n      AND ws_sales_price BETWEEN 150.00 AND 200.00\n    )\n  )\n  AND (\n    (\n      ca_country = 'United States'\n      AND ca_state IN ('NC', 'PA', 'TX')\n      AND ws_net_profit BETWEEN 100 AND 200\n    )\n    OR (\n      ca_country = 'United States'\n      AND ca_state IN ('AR', 'CO', 'NY')\n      AND ws_net_profit BETWEEN 150 AND 300\n    )\n    OR (\n      ca_country = 'United States'\n      AND ca_state IN ('IA', 'IL', 'TX')\n      AND ws_net_profit BETWEEN 50 AND 250\n    )\n  )\nGROUP BY r_reason_desc\nORDER BY SUBSTRING(r_reason_desc, 1, 20), AVG(ws_quantity), AVG(wr_refunded_cash), AVG(wr_fee)\nLIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Convert comma-separated joins to explicit INNER JOIN syntax to give optimizer clearer join constraints."
    },
    {
      "patch_id": "compile_p08",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 1.17,
      "semantic_passed": true,
      "error": null,
      "original_ms": 138.7,
      "patch_ms": 118.9,
      "output_sql": "SELECT SUBSTRING(r_reason_desc, 1, 20), AVG(ws_quantity), AVG(wr_refunded_cash), AVG(wr_fee) FROM web_sales INNER JOIN web_returns ON ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number INNER JOIN web_page ON ws_web_page_sk = wp_web_page_sk INNER JOIN date_dim ON ws_sold_date_sk = d_date_sk INNER JOIN customer_demographics cd1 ON cd1.cd_demo_sk = wr_refunded_cdemo_sk INNER JOIN customer_demographics cd2 ON cd2.cd_demo_sk = wr_returning_cdemo_sk INNER JOIN customer_address ON ca_address_sk = wr_refunded_addr_sk INNER JOIN reason ON r_reason_sk = wr_reason_sk WHERE d_year = 2000 AND ((cd1.cd_marital_status = 'S' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'College' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 100.00 AND 150.00) OR (cd1.cd_marital_status = 'W' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'Unknown' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 50.00 AND 100.00) OR (cd1.cd_marital_status = 'M' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'Secondary' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 150.00 AND 200.00)) AND ((ca_country = 'United States' AND ca_state IN ('NC', 'PA', 'TX') AND ws_net_profit BETWEEN 100 AND 200) OR (ca_country = 'United States' AND ca_state IN ('AR', 'CO', 'NY') AND ws_net_profit BETWEEN 150 AND 300) OR (ca_country = 'United States' AND ca_state IN ('IA', 'IL', 'TX') AND ws_net_profit BETWEEN 50 AND 250)) GROUP BY r_reason_desc ORDER BY SUBSTRING(r_reason_desc, 1, 20), AVG(ws_quantity), AVG(wr_refunded_cash), AVG(wr_fee) LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p01_revised",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 1.12,
      "semantic_passed": true,
      "error": null,
      "original_ms": 138.7,
      "patch_ms": 123.4,
      "output_sql": "WITH date_range AS (SELECT MIN(d_date_sk) AS min_sk, MAX(d_date_sk) AS max_sk FROM date_dim WHERE d_year = 2000) SELECT SUBSTRING(r_reason_desc, 1, 20), AVG(ws_quantity), AVG(wr_refunded_cash), AVG(wr_fee) FROM web_sales CROSS JOIN date_range, web_returns, web_page, customer_demographics cd1, customer_demographics cd2, customer_address, date_dim, reason WHERE ws_sold_date_sk BETWEEN date_range.min_sk AND date_range.max_sk AND ws_web_page_sk = wp_web_page_sk AND ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number AND ws_sold_date_sk = d_date_sk AND d_year = 2000 AND cd1.cd_demo_sk = wr_refunded_cdemo_sk AND cd2.cd_demo_sk = wr_returning_cdemo_sk AND ca_address_sk = wr_refunded_addr_sk AND r_reason_sk = wr_reason_sk AND ((cd1.cd_marital_status = 'S' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'College' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 100.00 AND 150.00) OR (cd1.cd_marital_status = 'W' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'Unknown' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 50.00 AND 100.00) OR (cd1.cd_marital_status = 'M' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'Secondary' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 150.00 AND 200.00)) AND ((ca_country = 'United States' AND ca_state IN ('NC', 'PA', 'TX') AND ws_net_profit BETWEEN 100 AND 200) OR (ca_country = 'United States' AND ca_state IN ('AR', 'CO', 'NY') AND ws_net_profit BETWEEN 150 AND 300) OR (ca_country = 'United States' AND ca_state IN ('IA', 'IL', 'TX') AND ws_net_profit BETWEEN 50 AND 250)) GROUP BY r_reason_desc ORDER BY SUBSTRING(r_reason_desc, 1, 20), AVG(ws_quantity), AVG(wr_refunded_cash), AVG(wr_fee) LIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p07": "GlobalStats | 30129 | 30124 | 500899529728\n1 | 0 | Result | SUBSTRING(REASON.R_REASON_DESC, 1, 20), SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM_INTERNAL(SUM_INTERNAL(SUM(SUM_INTERNAL(WEB_SALES.WS_QUANTITY, COUNT(*))), COUNT(*)), COUNT(*)))), COUNT(COUNT(COUNT_INTERNAL(COUNT_INTERNAL(COUNT(COUNT_INTERNAL(WEB_SALES.WS_QUANTITY, COUNT(*))), COUNT(*)), COUNT(*))))), (SUM(SUM(SUM_INTERNAL(SUM_INTERNAL(SUM(SUM(SUM(SUM(WEB_RETURNS.WR_REFUNDED_CASH)))), COUNT(*)), COUNT(*))))) / (COUNT(COUNT(COUNT_INTERNAL(COUN",
    "p01": "GlobalStats | 30129 | 30124 | 500899529728\n1 | 0 | Result | SUBSTRING(REASON.R_REASON_DESC, 1, 20), SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM_INTERNAL(SUM_INTERNAL(SUM(SUM_INTERNAL(WEB_SALES.WS_QUANTITY, COUNT(*))), COUNT(*)), COUNT(*)))), COUNT(COUNT(COUNT_INTERNAL(COUNT_INTERNAL(COUNT(COUNT_INTERNAL(WEB_SALES.WS_QUANTITY, COUNT(*))), COUNT(*)), COUNT(*))))), (SUM(SUM(SUM_INTERNAL(SUM_INTERNAL(SUM(SUM(SUM(SUM(WEB_RETURNS.WR_REFUNDED_CASH)))), COUNT(*)), COUNT(*))))) / (COUNT(COUNT(COUNT_INTERNAL(COUN",
    "p04": "GlobalStats | 30129 | 30124 | 500899529728\n1 | 0 | Result | SUBSTRING(REASON.R_REASON_DESC, 1, 20), SCALED_ROUND_INT_DIVIDE(SUM(SUM_INTERNAL(SUM(SUM(SUM_INTERNAL(SUM_INTERNAL(WEB_SALES.WS_QUANTITY, COUNT(*)), COUNT(*)))), COUNT(*))), COUNT(COUNT_INTERNAL(COUNT(COUNT(COUNT_INTERNAL(COUNT_INTERNAL(WEB_SALES.WS_QUANTITY, COUNT(*)), COUNT(*)))), COUNT(*)))), (SUM(SUM_INTERNAL(SUM(SUM(SUM_INTERNAL(SUM(SUM(SUM(WEB_RETURNS.WR_REFUNDED_CASH))), COUNT(*)))), COUNT(*)))) / (COUNT(COUNT_INTERNAL(COUNT(COUN",
    "p08": "GlobalStats | 30129 | 30124 | 500899529728\n1 | 0 | Result | SUBSTRING(REASON.R_REASON_DESC, 1, 20), SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM_INTERNAL(SUM_INTERNAL(SUM(SUM_INTERNAL(WEB_SALES.WS_QUANTITY, COUNT(*))), COUNT(*)), COUNT(*)))), COUNT(COUNT(COUNT_INTERNAL(COUNT_INTERNAL(COUNT(COUNT_INTERNAL(WEB_SALES.WS_QUANTITY, COUNT(*))), COUNT(*)), COUNT(*))))), (SUM(SUM(SUM_INTERNAL(SUM_INTERNAL(SUM(SUM(SUM(SUM(WEB_RETURNS.WR_REFUNDED_CASH)))), COUNT(*)), COUNT(*))))) / (COUNT(COUNT(COUNT_INTERNAL(COUN",
    "compile_p08": "GlobalStats | 30129 | 30124 | 500899529728\n1 | 0 | Result | SUBSTRING(REASON.R_REASON_DESC, 1, 20), SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM_INTERNAL(SUM_INTERNAL(SUM(SUM_INTERNAL(WEB_SALES.WS_QUANTITY, COUNT(*))), COUNT(*)), COUNT(*)))), COUNT(COUNT(COUNT_INTERNAL(COUNT_INTERNAL(COUNT(COUNT_INTERNAL(WEB_SALES.WS_QUANTITY, COUNT(*))), COUNT(*)), COUNT(*))))), (SUM(SUM(SUM_INTERNAL(SUM_INTERNAL(SUM(SUM(SUM(SUM(WEB_RETURNS.WR_REFUNDED_CASH)))), COUNT(*)), COUNT(*))))) / (COUNT(COUNT(COUNT_INTERNAL(COUN",
    "compile_p01_revised": "GlobalStats | 30130 | 30125 | 500901668352\n1 | 0 | Result | SUBSTRING(REASON.R_REASON_DESC, 1, 20), SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM_INTERNAL(SUM(SUM(SUM_INTERNAL(WEB_SALES.WS_QUANTITY, COUNT(*)))), COUNT(*)))), COUNT(COUNT(COUNT_INTERNAL(COUNT(COUNT(COUNT_INTERNAL(WEB_SALES.WS_QUANTITY, COUNT(*)))), COUNT(*))))), (SUM(SUM(SUM_INTERNAL(SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(WEB_RETURNS.WR_REFUNDED_CASH, COUNT(*))))))), COUNT(*))))) / (COUNT(COUNT(COUNT_INTERNAL(COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_I"
  }
}