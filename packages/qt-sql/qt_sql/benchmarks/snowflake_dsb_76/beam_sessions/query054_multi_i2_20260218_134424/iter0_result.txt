{
  "iteration": 0,
  "n_api_calls": 4,
  "beam_cost_usd": 0.0,
  "beam_cost_priced_calls": 0,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 0,
    "completion_tokens": 0,
    "total_tokens": 0,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 0,
    "reasoning_tokens": 0
  },
  "best_speedup": 1.1,
  "best_patch_id": "p07",
  "best_sql": "WITH my_customers AS (SELECT DISTINCT c_customer_sk, c_current_addr_sk FROM (SELECT cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk, cs_wholesale_cost AS wholesale_cost FROM catalog_sales UNION ALL SELECT ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk, ws_wholesale_cost AS wholesale_cost FROM web_sales) cs_or_ws_sales INNER JOIN item ON item_sk = i_item_sk INNER JOIN date_dim ON sold_date_sk = d_date_sk INNER JOIN customer ON customer_sk = c_customer_sk WHERE i_category = 'Home' AND i_class = 'curtains/drapes' AND d_moy = 5 AND d_year = 1998 AND wholesale_cost BETWEEN 70 AND 100 AND c_birth_year BETWEEN 1942 AND 1955), my_revenue AS (SELECT c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers INNER JOIN store_sales ON c_customer_sk = ss_customer_sk INNER JOIN customer_address ON c_current_addr_sk = ca_address_sk INNER JOIN store ON ca_county = s_county AND ca_state = s_state INNER JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE ss_wholesale_cost BETWEEN 70 AND 100 AND s_state IN ('AR','GA','IN','KS','KY','NC','OH','PA','SD','VA') AND d_month_seq BETWEEN (SELECT DISTINCT d_month_seq+1 FROM date_dim WHERE d_year = 1998 AND d_moy = 5) AND (SELECT DISTINCT d_month_seq+3 FROM date_dim WHERE d_year = 1998 AND d_moy = 5) GROUP BY c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
  "patches": [
    {
      "patch_id": "p06",
      "family": "E",
      "transform": "materialize_cte",
      "relevance_score": 0.55,
      "status": "REGRESSION",
      "speedup": 0.9,
      "semantic_passed": true,
      "error": null,
      "original_ms": 171.0,
      "patch_ms": 190.3,
      "output_sql": "WITH my_customers AS (SELECT DISTINCT c_customer_sk, c_current_addr_sk FROM (SELECT cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk, cs_wholesale_cost AS wholesale_cost FROM catalog_sales UNION ALL SELECT ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk, ws_wholesale_cost AS wholesale_cost FROM web_sales) AS cs_or_ws_sales, item, date_dim, customer WHERE sold_date_sk = d_date_sk AND item_sk = i_item_sk AND i_category = 'Home' AND i_class = 'curtains/drapes' AND c_customer_sk = cs_or_ws_sales.customer_sk AND d_moy = 5 AND d_year = 1998 AND wholesale_cost BETWEEN 70 AND 100 AND c_birth_year BETWEEN 1942 AND 1955), my_revenue AS (SELECT c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers, store_sales, customer_address, store, date_dim WHERE c_current_addr_sk = ca_address_sk AND ca_county = s_county AND ca_state = s_state AND ss_sold_date_sk = d_date_sk AND c_customer_sk = ss_customer_sk AND ss_wholesale_cost BETWEEN 70 AND 100 AND s_state IN ('AR', 'GA', 'IN', 'KS', 'KY', 'NC', 'OH', 'PA', 'SD', 'VA') AND d_month_seq BETWEEN (SELECT DISTINCT d_month_seq + 1 FROM date_dim WHERE d_year = 1998 AND d_moy = 5) AND (SELECT DISTINCT d_month_seq + 3 FROM date_dim WHERE d_year = 1998 AND d_moy = 5) GROUP BY c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Materialize the my_customers CTE to avoid recomputation of its complex union\u2011all and joins when referenced in my_revenue."
    },
    {
      "patch_id": "p01",
      "family": "A",
      "transform": "sf_sk_pushdown_union_all",
      "relevance_score": 0.85,
      "status": "REGRESSION",
      "speedup": 0.91,
      "semantic_passed": true,
      "error": null,
      "original_ms": 171.0,
      "patch_ms": 187.2,
      "output_sql": "WITH my_customers AS (select distinct c_customer_sk, c_current_addr_sk from ( select cs_sold_date_sk sold_date_sk, cs_bill_customer_sk customer_sk, cs_item_sk item_sk, cs_wholesale_cost wholesale_cost from catalog_sales where cs_sold_date_sk between (select min(d_date_sk) from date_dim where d_moy = 5 and d_year = 1998) and (select max(d_date_sk) from date_dim where d_moy = 5 and d_year = 1998) union all select ws_sold_date_sk sold_date_sk, ws_bill_customer_sk customer_sk, ws_item_sk item_sk, ws_wholesale_cost wholesale_cost from web_sales where ws_sold_date_sk between (select min(d_date_sk) from date_dim where d_moy = 5 and d_year = 1998) and (select max(d_date_sk) from date_dim where d_moy = 5 and d_year = 1998) ) cs_or_ws_sales, item, date_dim, customer where sold_date_sk = d_date_sk and item_sk = i_item_sk and i_category = 'Home' and i_class = 'curtains/drapes' and c_customer_sk = cs_or_ws_sales.customer_sk and d_moy = 5 and d_year = 1998 and wholesale_cost BETWEEN 70 AND 100 and c_birth_year BETWEEN 1942 AND 1955), my_revenue AS (SELECT c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers, store_sales, customer_address, store, date_dim WHERE c_current_addr_sk = ca_address_sk AND ca_county = s_county AND ca_state = s_state AND ss_sold_date_sk = d_date_sk AND c_customer_sk = ss_customer_sk AND ss_wholesale_cost BETWEEN 70 AND 100 AND s_state IN ('AR', 'GA', 'IN', 'KS', 'KY', 'NC', 'OH', 'PA', 'SD', 'VA') AND d_month_seq BETWEEN (SELECT DISTINCT d_month_seq + 1 FROM date_dim WHERE d_year = 1998 AND d_moy = 5) AND (SELECT DISTINCT d_month_seq + 3 FROM date_dim WHERE d_year = 1998 AND d_moy = 5) GROUP BY c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Push date_sk BETWEEN range derived from date_dim filter (d_moy=5, d_year=1998) into each UNION ALL branch of catalog_sales and web_sales in my_customers CTE."
    },
    {
      "patch_id": "p03",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.75,
      "status": "REGRESSION",
      "speedup": 0.92,
      "semantic_passed": true,
      "error": null,
      "original_ms": 171.0,
      "patch_ms": 186.9,
      "output_sql": "WITH my_customers AS (SELECT DISTINCT c_customer_sk, c_current_addr_sk FROM (SELECT cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk, cs_wholesale_cost AS wholesale_cost FROM catalog_sales UNION ALL SELECT ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk, ws_wholesale_cost AS wholesale_cost FROM web_sales) AS cs_or_ws_sales, item, date_dim, customer WHERE sold_date_sk = d_date_sk AND item_sk = i_item_sk AND i_category = 'Home' AND i_class = 'curtains/drapes' AND c_customer_sk = cs_or_ws_sales.customer_sk AND d_moy = 5 AND d_year = 1998 AND wholesale_cost BETWEEN 70 AND 100 AND c_birth_year BETWEEN 1942 AND 1955), agg_store_sales AS (SELECT ss_customer_sk,\n       ss_sold_date_sk,\n       SUM(ss_ext_sales_price) AS revenue_agg\nFROM store_sales\nWHERE ss_wholesale_cost BETWEEN 70 AND 100\nGROUP BY ss_customer_sk, ss_sold_date_sk), my_revenue AS (select c_customer_sk,\n       sum(revenue_agg) as revenue\nfrom   my_customers,\n       agg_store_sales,\n       customer_address,\n       store,\n       date_dim\nwhere  c_current_addr_sk = ca_address_sk\n       and ca_county = s_county\n       and ca_state = s_state\n       and agg_store_sales.ss_sold_date_sk = d_date_sk\n       and c_customer_sk = agg_store_sales.ss_customer_sk\n       and s_state in ('AR','GA','IN'\n                   ,'KS','KY','NC'\n                   ,'OH','PA','SD'\n                   ,'VA')\n       and d_month_seq between (select distinct d_month_seq+1\n                                from   date_dim where d_year = 1998 and d_moy = 5)\n                          and  (select distinct d_month_seq+3\n                                from   date_dim where d_year = 1998 and d_moy = 5)\ngroup by c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre\u2011aggregate store_sales by ss_customer_sk, ss_sold_date_sk before joining with date_dim and other dimensions in my_revenue CTE."
    },
    {
      "patch_id": "p04",
      "family": "C",
      "transform": "single_pass_aggregation",
      "relevance_score": 0.65,
      "status": "REGRESSION",
      "speedup": 0.84,
      "semantic_passed": true,
      "error": null,
      "original_ms": 171.0,
      "patch_ms": 203.4,
      "output_sql": "WITH cs_or_ws_sales AS (SELECT sold_date_sk, customer_sk, item_sk, wholesale_cost FROM (SELECT cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk, cs_wholesale_cost AS wholesale_cost FROM catalog_sales WHERE cs_wholesale_cost BETWEEN 70 AND 100 UNION ALL SELECT ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk, ws_wholesale_cost AS wholesale_cost FROM web_sales WHERE ws_wholesale_cost BETWEEN 70 AND 100)), my_customers AS (SELECT DISTINCT c_customer_sk, c_current_addr_sk FROM (SELECT cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk, cs_wholesale_cost AS wholesale_cost FROM catalog_sales UNION ALL SELECT ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk, ws_wholesale_cost AS wholesale_cost FROM web_sales) AS cs_or_ws_sales, item, date_dim, customer WHERE sold_date_sk = d_date_sk AND item_sk = i_item_sk AND i_category = 'Home' AND i_class = 'curtains/drapes' AND c_customer_sk = cs_or_ws_sales.customer_sk AND d_moy = 5 AND d_year = 1998 AND wholesale_cost BETWEEN 70 AND 100 AND c_birth_year BETWEEN 1942 AND 1955), my_revenue AS (SELECT c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers, store_sales, customer_address, store, date_dim WHERE c_current_addr_sk = ca_address_sk AND ca_county = s_county AND ca_state = s_state AND ss_sold_date_sk = d_date_sk AND c_customer_sk = ss_customer_sk AND ss_wholesale_cost BETWEEN 70 AND 100 AND s_state IN ('AR', 'GA', 'IN', 'KS', 'KY', 'NC', 'OH', 'PA', 'SD', 'VA') AND d_month_seq BETWEEN (SELECT DISTINCT d_month_seq + 1 FROM date_dim WHERE d_year = 1998 AND d_moy = 5) AND (SELECT DISTINCT d_month_seq + 3 FROM date_dim WHERE d_year = 1998 AND d_moy = 5) GROUP BY c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Consolidate multiple aggregations on catalog_sales/web_sales in my_customers into a single CTE that computes distinct customer_sk, item_sk, sold_date_sk with all filters applied once."
    },
    {
      "patch_id": "p07",
      "family": "F",
      "transform": "inner_join_conversion",
      "relevance_score": 0.5,
      "status": "IMPROVED",
      "speedup": 1.1,
      "semantic_passed": true,
      "error": null,
      "original_ms": 171.0,
      "patch_ms": 155.6,
      "output_sql": "WITH my_customers AS (SELECT DISTINCT c_customer_sk, c_current_addr_sk FROM (SELECT cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk, cs_wholesale_cost AS wholesale_cost FROM catalog_sales UNION ALL SELECT ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk, ws_wholesale_cost AS wholesale_cost FROM web_sales) cs_or_ws_sales INNER JOIN item ON item_sk = i_item_sk INNER JOIN date_dim ON sold_date_sk = d_date_sk INNER JOIN customer ON customer_sk = c_customer_sk WHERE i_category = 'Home' AND i_class = 'curtains/drapes' AND d_moy = 5 AND d_year = 1998 AND wholesale_cost BETWEEN 70 AND 100 AND c_birth_year BETWEEN 1942 AND 1955), my_revenue AS (SELECT c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers INNER JOIN store_sales ON c_customer_sk = ss_customer_sk INNER JOIN customer_address ON c_current_addr_sk = ca_address_sk INNER JOIN store ON ca_county = s_county AND ca_state = s_state INNER JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE ss_wholesale_cost BETWEEN 70 AND 100 AND s_state IN ('AR','GA','IN','KS','KY','NC','OH','PA','SD','VA') AND d_month_seq BETWEEN (SELECT DISTINCT d_month_seq+1 FROM date_dim WHERE d_year = 1998 AND d_moy = 5) AND (SELECT DISTINCT d_month_seq+3 FROM date_dim WHERE d_year = 1998 AND d_moy = 5) GROUP BY c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Convert comma\u2011separated joins in my_customers and my_revenue to explicit INNER JOIN syntax to improve optimizer join\u2011order flexibility."
    },
    {
      "patch_id": "p02",
      "family": "A",
      "transform": "sf_sk_pushdown_multi_fact",
      "relevance_score": 0.82,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": true,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH my_customers AS (SELECT DISTINCT c_customer_sk, c_current_addr_sk FROM (SELECT cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk, cs_wholesale_cost AS wholesale_cost FROM catalog_sales UNION ALL SELECT ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk, ws_wholesale_cost AS wholesale_cost FROM web_sales) AS cs_or_ws_sales, item, date_dim, customer WHERE sold_date_sk = d_date_sk AND item_sk = i_item_sk AND i_category = 'Home' AND i_class = 'curtains/drapes' AND c_customer_sk = cs_or_ws_sales.customer_sk AND d_moy = 5 AND d_year = 1998 AND wholesale_cost BETWEEN 70 AND 100 AND c_birth_year BETWEEN 1942 AND 1955), my_revenue AS (SELECT c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers, store_sales, customer_address, store, date_dim WHERE c_current_addr_sk = ca_address_sk AND ca_county = s_county AND ca_state = s_state AND ss_sold_date_sk = d_date_sk AND c_customer_sk = ss_customer_sk AND ss_wholesale_cost BETWEEN 70 AND 100 AND s_state IN ('AR', 'GA', 'IN', 'KS', 'KY', 'NC', 'OH', 'PA', 'SD', 'VA') AND d_month_seq BETWEEN (SELECT DISTINCT d_month_seq + 1 FROM date_dim WHERE d_year = 1998 AND d_moy = 5) AND (SELECT DISTINCT d_month_seq + 3 FROM date_dim WHERE d_year = 1998 AND d_moy = 5) GROUP BY c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Push date_sk BETWEEN range derived from date_dim filter (d_month_seq between subqueries) into store_sales scan in my_revenue CTE."
    },
    {
      "patch_id": "p05",
      "family": "A",
      "transform": "date_cte_isolate",
      "relevance_score": 0.6,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: 000904 (42000): 01c27e77-3205-67d8-0002-fcfe0002bb8e: SQL compilation error: error line 27 at position 12\ninvalid identifier 'D_MOY'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date_dim AS (select d_date_sk, d_month_seq\nfrom   date_dim\nwhere  d_moy = 5\n       and d_year = 1998), my_customers AS (select distinct c_customer_sk\n       , c_current_addr_sk\nfrom\n       ( select cs_sold_date_sk sold_date_sk,\n                cs_bill_customer_sk customer_sk,\n                cs_item_sk item_sk,\n                cs_wholesale_cost wholesale_cost\n         from   catalog_sales\n         union all\n         select ws_sold_date_sk sold_date_sk,\n                ws_bill_customer_sk customer_sk,\n                ws_item_sk item_sk,\n                ws_wholesale_cost wholesale_cost\n         from   web_sales\n        ) cs_or_ws_sales,\n        item,\n        filtered_date_dim,\n        customer\nwhere   sold_date_sk = d_date_sk\n        and item_sk = i_item_sk\n        and i_category = 'Home'\n        and i_class = 'curtains/drapes'\n        and c_customer_sk = cs_or_ws_sales.customer_sk\n        and d_moy = 5\n        and d_year = 1998\n        and wholesale_cost BETWEEN 70 AND 100\n        and c_birth_year BETWEEN 1942 AND 1955), my_revenue AS (select c_customer_sk,\n       sum(ss_ext_sales_price) as revenue\nfrom   my_customers,\n       store_sales,\n       customer_address,\n       store,\n       filtered_date_dim\nwhere  c_current_addr_sk = ca_address_sk\n       and ca_county = s_county\n       and ca_state = s_state\n       and ss_sold_date_sk = d_date_sk\n       and c_customer_sk = ss_customer_sk\n       and ss_wholesale_cost BETWEEN 70 AND 100\n       and s_state in ('AR','GA','IN'\n                   ,'KS','KY','NC'\n                   ,'OH','PA','SD'\n                   ,'VA')\n       and d_month_seq between (select distinct d_month_seq+1\n                                from   filtered_date_dim)\n                          and  (select distinct d_month_seq+3\n                                from   filtered_date_dim)\ngroup by c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Materialize filtered date_dim rows for d_moy=5, d_year=1998 into a CTE and reuse it in my_customers and my_revenue CTEs to avoid repeated scans."
    },
    {
      "patch_id": "p08",
      "family": "C",
      "transform": "channel_bitmap_aggregation",
      "relevance_score": 0.45,
      "status": "NEUTRAL",
      "speedup": 0.95,
      "semantic_passed": true,
      "error": null,
      "original_ms": 171.0,
      "patch_ms": 179.2,
      "output_sql": "WITH my_customers AS (with channel_sales as (\n  select \n    'catalog' as channel,\n    cs_sold_date_sk as sold_date_sk,\n    cs_bill_customer_sk as customer_sk,\n    cs_item_sk as item_sk,\n    cs_wholesale_cost as wholesale_cost\n  from catalog_sales\n  where cs_wholesale_cost between 70 and 100\n    and cs_bill_customer_sk is not null\n    and cs_sold_date_sk is not null\n  union all\n  select \n    'web' as channel,\n    ws_sold_date_sk as sold_date_sk,\n    ws_bill_customer_sk as customer_sk,\n    ws_item_sk as item_sk,\n    ws_wholesale_cost as wholesale_cost\n  from web_sales\n  where ws_wholesale_cost between 70 and 100\n    and ws_bill_customer_sk is not null\n    and ws_sold_date_sk is not null\n)\nselect distinct c_customer_sk, c_current_addr_sk\nfrom channel_sales cs_or_ws_sales\njoin item on item_sk = i_item_sk\njoin date_dim on sold_date_sk = d_date_sk\njoin customer on c_customer_sk = cs_or_ws_sales.customer_sk\nwhere i_category = 'Home'\n  and i_class = 'curtains/drapes'\n  and d_moy = 5\n  and d_year = 1998\n  and c_birth_year between 1942 and 1955), my_revenue AS (SELECT c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers, store_sales, customer_address, store, date_dim WHERE c_current_addr_sk = ca_address_sk AND ca_county = s_county AND ca_state = s_state AND ss_sold_date_sk = d_date_sk AND c_customer_sk = ss_customer_sk AND ss_wholesale_cost BETWEEN 70 AND 100 AND s_state IN ('AR', 'GA', 'IN', 'KS', 'KY', 'NC', 'OH', 'PA', 'SD', 'VA') AND d_month_seq BETWEEN (SELECT DISTINCT d_month_seq + 1 FROM date_dim WHERE d_year = 1998 AND d_moy = 5) AND (SELECT DISTINCT d_month_seq + 3 FROM date_dim WHERE d_year = 1998 AND d_moy = 5) GROUP BY c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Consolidate catalog_sales and web_sales scans into a single scan with a channel discriminator column, then aggregate with conditional sums per channel."
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "NEUTRAL",
      "speedup": 0.97,
      "semantic_passed": true,
      "error": null,
      "original_ms": 228.4,
      "patch_ms": 236.1,
      "output_sql": "WITH agg_store_sales AS (SELECT ss_customer_sk, ss_sold_date_sk, SUM(ss_ext_sales_price) AS revenue_agg FROM store_sales WHERE ss_wholesale_cost BETWEEN 70 AND 100 AND ss_customer_sk IS NOT NULL AND ss_sold_date_sk IS NOT NULL GROUP BY ss_customer_sk, ss_sold_date_sk), channel_sales AS (SELECT 'catalog' AS channel, cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk, cs_wholesale_cost AS wholesale_cost FROM catalog_sales WHERE cs_wholesale_cost BETWEEN 70 AND 100 AND cs_bill_customer_sk IS NOT NULL AND cs_sold_date_sk IS NOT NULL AND cs_sold_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim WHERE d_moy = 5 AND d_year = 1998) AND (SELECT MAX(d_date_sk) FROM date_dim WHERE d_moy = 5 AND d_year = 1998) UNION ALL SELECT 'web' AS channel, ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk, ws_wholesale_cost AS wholesale_cost FROM web_sales WHERE ws_wholesale_cost BETWEEN 70 AND 100 AND ws_bill_customer_sk IS NOT NULL AND ws_sold_date_sk IS NOT NULL AND ws_sold_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim WHERE d_moy = 5 AND d_year = 1998) AND (SELECT MAX(d_date_sk) FROM date_dim WHERE d_moy = 5 AND d_year = 1998)), my_customers AS (SELECT DISTINCT c_customer_sk, c_current_addr_sk FROM channel_sales cs_or_ws_sales, item, date_dim, customer WHERE sold_date_sk = d_date_sk AND item_sk = i_item_sk AND i_category = 'Home' AND i_class = 'curtains/drapes' AND c_customer_sk = cs_or_ws_sales.customer_sk AND d_moy = 5 AND d_year = 1998 AND wholesale_cost BETWEEN 70 AND 100 AND c_birth_year BETWEEN 1942 AND 1955), my_revenue AS (SELECT c_customer_sk, SUM(revenue_agg) AS revenue FROM my_customers, agg_store_sales, customer_address, store, date_dim WHERE c_current_addr_sk = ca_address_sk AND ca_county = s_county AND ca_state = s_state AND agg_store_sales.ss_sold_date_sk = d_date_sk AND c_customer_sk = agg_store_sales.ss_customer_sk AND s_state IN ('AR','GA','IN','KS','KY','NC','OH','PA','SD','VA') AND d_month_seq BETWEEN (SELECT DISTINCT d_month_seq+1 FROM date_dim WHERE d_year = 1998 AND d_moy = 5) AND (SELECT DISTINCT d_month_seq+3 FROM date_dim WHERE d_year = 1998 AND d_moy = 5) GROUP BY c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p2",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Row count: orig=100, patch=0",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date_dim AS (SELECT d_date_sk, d_month_seq FROM date_dim WHERE d_moy = 5 AND d_year = 1998), my_customers AS (SELECT DISTINCT c_customer_sk, c_current_addr_sk FROM ( SELECT cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk, cs_wholesale_cost AS wholesale_cost FROM catalog_sales WHERE cs_sold_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM filtered_date_dim) AND (SELECT MAX(d_date_sk) FROM filtered_date_dim) UNION ALL SELECT ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk, ws_wholesale_cost AS wholesale_cost FROM web_sales WHERE ws_sold_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM filtered_date_dim) AND (SELECT MAX(d_date_sk) FROM filtered_date_dim) ) cs_or_ws_sales, item, filtered_date_dim, customer WHERE sold_date_sk = d_date_sk AND item_sk = i_item_sk AND i_category = 'Home' AND i_class = 'curtains/drapes' AND c_customer_sk = cs_or_ws_sales.customer_sk AND wholesale_cost BETWEEN 70 AND 100 AND c_birth_year BETWEEN 1942 AND 1955), my_revenue AS (SELECT c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers, store_sales, customer_address, store, filtered_date_dim WHERE c_current_addr_sk = ca_address_sk AND ca_county = s_county AND ca_state = s_state AND ss_sold_date_sk = d_date_sk AND c_customer_sk = ss_customer_sk AND ss_wholesale_cost BETWEEN 70 AND 100 AND s_state IN ('AR','GA','IN','KS','KY','NC','OH','PA','SD','VA') AND d_month_seq BETWEEN (SELECT DISTINCT d_month_seq+1 FROM filtered_date_dim) AND (SELECT DISTINCT d_month_seq+3 FROM filtered_date_dim) GROUP BY c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Row count: orig=100, patch=0",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH agg_store_sales AS (SELECT ss_customer_sk, ss_sold_date_sk, SUM(ss_ext_sales_price) AS revenue_agg FROM store_sales WHERE ss_wholesale_cost BETWEEN 70 AND 100 GROUP BY ss_customer_sk, ss_sold_date_sk), filtered_date_dim AS (SELECT d_date_sk, d_month_seq FROM date_dim WHERE d_moy = 5 AND d_year = 1998), my_customers AS (SELECT DISTINCT c_customer_sk, c_current_addr_sk FROM ( SELECT cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk, cs_wholesale_cost AS wholesale_cost FROM catalog_sales WHERE cs_sold_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM filtered_date_dim) AND (SELECT MAX(d_date_sk) FROM filtered_date_dim) AND cs_wholesale_cost BETWEEN 70 AND 100 UNION ALL SELECT ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk, ws_wholesale_cost AS wholesale_cost FROM web_sales WHERE ws_sold_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM filtered_date_dim) AND (SELECT MAX(d_date_sk) FROM filtered_date_dim) AND ws_wholesale_cost BETWEEN 70 AND 100 ) cs_or_ws_sales INNER JOIN item ON cs_or_ws_sales.item_sk = item.i_item_sk INNER JOIN filtered_date_dim ON cs_or_ws_sales.sold_date_sk = filtered_date_dim.d_date_sk INNER JOIN customer ON cs_or_ws_sales.customer_sk = customer.c_customer_sk WHERE item.i_category = 'Home' AND item.i_class = 'curtains/drapes' AND customer.c_birth_year BETWEEN 1942 AND 1955), my_revenue AS (SELECT c_customer_sk, SUM(revenue_agg) AS revenue FROM my_customers INNER JOIN agg_store_sales ON my_customers.c_customer_sk = agg_store_sales.ss_customer_sk INNER JOIN customer_address ON my_customers.c_current_addr_sk = customer_address.ca_address_sk INNER JOIN store ON customer_address.ca_county = store.s_county AND customer_address.ca_state = store.s_state INNER JOIN filtered_date_dim ON agg_store_sales.ss_sold_date_sk = filtered_date_dim.d_date_sk WHERE store.s_state IN ('AR','GA','IN','KS','KY','NC','OH','PA','SD','VA') AND filtered_date_dim.d_month_seq BETWEEN (SELECT DISTINCT d_month_seq+1 FROM filtered_date_dim) AND (SELECT DISTINCT d_month_seq+3 FROM filtered_date_dim) GROUP BY c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "compile_p2",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: 090109 (22000): 01c27e78-3205-67d8-0002-fcfe0002bc52: Warehouse 'COMPUTE_WH' was suspended while SQL was waiting to be scheduled. SQL execution canceled.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH agg_store_sales AS (SELECT ss_customer_sk, ss_sold_date_sk, SUM(ss_ext_sales_price) AS revenue_agg FROM store_sales WHERE ss_wholesale_cost BETWEEN 70 AND 100 GROUP BY ss_customer_sk, ss_sold_date_sk), channel_sales AS (SELECT 'catalog' AS channel, cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk, cs_wholesale_cost AS wholesale_cost FROM catalog_sales WHERE cs_wholesale_cost BETWEEN 70 AND 100 AND cs_bill_customer_sk IS NOT NULL AND cs_sold_date_sk IS NOT NULL UNION ALL SELECT 'web' AS channel, ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk, ws_wholesale_cost AS wholesale_cost FROM web_sales WHERE ws_wholesale_cost BETWEEN 70 AND 100 AND ws_bill_customer_sk IS NOT NULL AND ws_sold_date_sk IS NOT NULL), filtered_date_dim AS (SELECT d_date_sk, d_month_seq FROM date_dim WHERE d_moy = 5 AND d_year = 1998), my_customers AS (SELECT DISTINCT c_customer_sk, c_current_addr_sk FROM channel_sales INNER JOIN item ON channel_sales.item_sk = item.i_item_sk INNER JOIN filtered_date_dim ON channel_sales.sold_date_sk = filtered_date_dim.d_date_sk INNER JOIN customer ON channel_sales.customer_sk = customer.c_customer_sk WHERE item.i_category = 'Home' AND item.i_class = 'curtains/drapes' AND customer.c_birth_year BETWEEN 1942 AND 1955), my_revenue AS (SELECT c_customer_sk, SUM(revenue_agg) AS revenue FROM my_customers INNER JOIN agg_store_sales ON my_customers.c_customer_sk = agg_store_sales.ss_customer_sk INNER JOIN customer_address ON my_customers.c_current_addr_sk = customer_address.ca_address_sk INNER JOIN store ON customer_address.ca_county = store.s_county AND customer_address.ca_state = store.s_state INNER JOIN filtered_date_dim ON agg_store_sales.ss_sold_date_sk = filtered_date_dim.d_date_sk WHERE store.s_state IN ('AR','GA','IN','KS','KY','NC','OH','PA','SD','VA') AND filtered_date_dim.d_month_seq BETWEEN (SELECT DISTINCT d_month_seq+1 FROM filtered_date_dim) AND (SELECT DISTINCT d_month_seq+3 FROM filtered_date_dim) GROUP BY c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100;",
      "has_explain": false,
      "description": null
    }
  ],
  "explains": {
    "p06": "GlobalStats | 155743 | 153231 | 2596906613760\n1 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 1\n1 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 1]\n1 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND (DATE_DIM.D_MOY = 5)\n1 | 5 | [4] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_MONTH_SEQ, D_YEAR, D_MOY | 1 | 1 | 2138624\n2 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 3\n2 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 3]\n2 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND",
    "p01": "GlobalStats | 155745 | 153233 | 2596910891008\n1 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 1\n1 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 1]\n1 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND (DATE_DIM.D_MOY = 5)\n1 | 5 | [4] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_MONTH_SEQ, D_YEAR, D_MOY | 1 | 1 | 2138624\n2 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 3\n2 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 3]\n2 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND",
    "p03": "GlobalStats | 155743 | 153231 | 2596906613760\n1 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 1\n1 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 1]\n1 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND (DATE_DIM.D_MOY = 5)\n1 | 5 | [4] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_MONTH_SEQ, D_YEAR, D_MOY | 1 | 1 | 2138624\n2 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 3\n2 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 3]\n2 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND",
    "p04": "GlobalStats | 155743 | 153231 | 2596906613760\n1 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 1\n1 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 1]\n1 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND (DATE_DIM.D_MOY = 5)\n1 | 5 | [4] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_MONTH_SEQ, D_YEAR, D_MOY | 1 | 1 | 2138624\n2 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 3\n2 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 3]\n2 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND",
    "p07": "GlobalStats | 155743 | 153231 | 2596906613760\n1 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 1\n1 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 1]\n1 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND (DATE_DIM.D_MOY = 5)\n1 | 5 | [4] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_MONTH_SEQ, D_YEAR, D_MOY | 1 | 1 | 2138624\n2 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 3\n2 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 3]\n2 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND",
    "p08": "GlobalStats | 155743 | 153231 | 2596906613760\n1 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 1\n1 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 1]\n1 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND (DATE_DIM.D_MOY = 5)\n1 | 5 | [4] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_MONTH_SEQ, D_YEAR, D_MOY | 1 | 1 | 2138624\n2 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 3\n2 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 3]\n2 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND",
    "compile_p1": "GlobalStats | 155745 | 153233 | 2596910891008\n1 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 1\n1 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 1]\n1 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND (DATE_DIM.D_MOY = 5)\n1 | 5 | [4] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_MONTH_SEQ, D_YEAR, D_MOY | 1 | 1 | 2138624\n2 | 0 | Result | DATE_DIM.D_MONTH_SEQ + 3\n2 | 3 | [2] | Aggregate | groupKeys: [DATE_DIM.D_MONTH_SEQ + 3]\n2 | 4 | [3] | Filter | (DATE_DIM.D_YEAR = 1998) AND"
  }
}