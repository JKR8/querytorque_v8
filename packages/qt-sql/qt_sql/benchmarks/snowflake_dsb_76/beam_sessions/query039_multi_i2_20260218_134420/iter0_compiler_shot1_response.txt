```json
{
  "plan_id": "compile_p1",
  "dialect": "snowflake",
  "confidence": 0.68,
  "based_on": "p02,p04",
  "strategy": "Combine early month filtering with direct aggregation to reduce CTE materialization volume.",
  "hypothesis": "Probes showed all attempts regressed, but p02's early month filtering addresses the key inefficiency of computing all months before filtering. p04's direct aggregation approach is semantically safe. Original plan scans 3.66GB inventory but filters d_moy late. Early month restriction reduces work.",
  "expected_explain_delta": "Reduce inventory scan volume via early date filter and eliminate CTE self-join by computing conditional aggregates in single pass.",
  "target_ir": "Replace CTE with single-pass conditional aggregation filtering months 5 and 6 early.",
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["inv_conditional"],
        "outputs": ["inv1_w_warehouse_sk", "inv1_i_item_sk", "inv1_d_moy", "inv1_mean", "inv1_cov", "inv2_w_warehouse_sk", "inv2_i_item_sk", "inv2_d_moy", "inv2_mean", "inv2_cov"],
        "changed": true,
        "sql": "SELECT w_warehouse_sk as inv1_w_warehouse_sk, i_item_sk as inv1_i_item_sk, 5 as inv1_d_moy, mean_5 as inv1_mean, cov_5 as inv1_cov, w_warehouse_sk as inv2_w_warehouse_sk, i_item_sk as inv2_i_item_sk, 6 as inv2_d_moy, mean_6 as inv2_mean, cov_6 as inv2_cov FROM inv_conditional WHERE mean_5 IS NOT NULL AND mean_6 IS NOT NULL AND cov_5 > 1 AND cov_6 > 1 ORDER BY inv1_w_warehouse_sk, inv1_i_item_sk, inv1_d_moy, inv1_mean, inv1_cov, inv2_d_moy, inv2_mean, inv2_cov"
      },
      {
        "node_id": "inv_conditional",
        "parent_node_id": "final_select",
        "sources": ["inventory", "item", "warehouse", "date_dim"],
        "outputs": ["w_warehouse_sk", "i_item_sk", "mean_5", "stdev_5", "cov_5", "mean_6", "stdev_6", "cov_6"],
        "changed": true,
        "sql": "SELECT w.w_warehouse_sk, i.i_item_sk, AVG(CASE WHEN d.d_moy = 5 THEN inv.inv_quantity_on_hand END) as mean_5, STDDEV_SAMP(CASE WHEN d.d_moy = 5 THEN inv.inv_quantity_on_hand END) as stdev_5, CASE WHEN mean_5 = 0 THEN NULL ELSE stdev_5 / mean_5 END as cov_5, AVG(CASE WHEN d.d_moy = 6 THEN inv.inv_quantity_on_hand END) as mean_6, STDDEV_SAMP(CASE WHEN d.d_moy = 6 THEN inv.inv_quantity_on_hand END) as stdev_6, CASE WHEN mean_6 = 0 THEN NULL ELSE stdev_6 / mean_6 END as cov_6 FROM inventory inv JOIN item i ON inv.inv_item_sk = i.i_item_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN date_dim d ON inv.inv_date_sk = d.d_date_sk WHERE d.d_year = 2002 AND d.d_moy IN (5, 6) AND i.i_category IN ('Shoes', 'Sports') AND i.i_manager_id BETWEEN 42 AND 61 AND inv.inv_quantity_on_hand BETWEEN 791 AND 991 GROUP BY w.w_warehouse_sk, i.i_item_sk HAVING mean_5 IS NOT NULL AND mean_6 IS NOT NULL"
      }
    ]
  }
}
```