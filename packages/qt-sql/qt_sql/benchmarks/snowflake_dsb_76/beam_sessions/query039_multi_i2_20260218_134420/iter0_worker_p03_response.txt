{
  "probe_id": "scout_dimension_cte_isolate",
  "transform_id": "dimension_cte_isolate",
  "family": "A",
  "status": "success",
  "dialect": "snowflake",
  "hypothesis": "Pre-filtering dimension tables (item, warehouse, date_dim) into small CTEs before joining with inventory reduces fact table scan size by pushing down selective filters early.",
  "reasoning_trace": [
    "Assigned transform targets early filtering of dimension tables to reduce inventory scan size.",
    "Created small CTEs for item, warehouse, and date_dim with required surrogate keys and filters preserved.",
    "Main CTE 'inv' now joins filtered dimension CTEs instead of base tables, enabling smaller hash tables and early pruning.",
    "Output columns and semantics preserved exactly as required by node_contract."
  ],
  "target_ir": "item, warehouse, and date_dim are isolated into small filtered CTEs; inv now joins these CTEs instead of base tables.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["inv"],
        "outputs": ["w_warehouse_sk", "i_item_sk", "d_moy", "mean", "cov", "w_warehouse_sk", "i_item_sk", "d_moy", "mean", "cov"],
        "changed": false
      },
      {
        "node_id": "inv",
        "parent_node_id": "final_select",
        "sources": ["inventory", "item_filtered", "warehouse_filtered", "date_dim_filtered"],
        "outputs": ["w_warehouse_name", "w_warehouse_sk", "i_item_sk", "d_moy", "stdev", "mean", "cov"],
        "changed": true,
        "sql": "with item_filtered as (select i_item_sk from item where i_category IN ('Shoes', 'Sports') and i_manager_id BETWEEN 42 and 61), warehouse_filtered as (select w_warehouse_sk, w_warehouse_name from warehouse), date_dim_filtered as (select d_date_sk, d_moy from date_dim where d_year=2002 and d_moy in (5,6)) select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy ,stdev,mean, case mean when 0 then null else stdev/mean end cov from(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy ,stddev_samp(inv_quantity_on_hand) stdev,avg(inv_quantity_on_hand) mean from inventory ,item_filtered ,warehouse_filtered ,date_dim_filtered where inv_item_sk = i_item_sk and inv_warehouse_sk = w_warehouse_sk and inv_date_sk = d_date_sk and inv_quantity_on_hand between 791 and 991 group by w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy) foo where case mean when 0 then 0 else stdev/mean end > 1"
      }
    ]
  }
}