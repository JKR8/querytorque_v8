{
  "iteration": 0,
  "n_api_calls": 2,
  "beam_cost_usd": 0.0,
  "beam_cost_priced_calls": 0,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 0,
    "completion_tokens": 0,
    "total_tokens": 0,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 0,
    "reasoning_tokens": 0
  },
  "best_speedup": 1.07,
  "best_patch_id": "compile_p1",
  "best_sql": "WITH inv_2 AS (SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, stdev, mean, CASE mean WHEN 0 THEN NULL ELSE stdev/mean END AS cov FROM ( SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, STDDEV_SAMP(inv_quantity_on_hand) AS stdev, AVG(inv_quantity_on_hand) AS mean FROM inventory JOIN item ON inv_item_sk = i_item_sk JOIN warehouse ON inv_warehouse_sk = w_warehouse_sk JOIN date_dim ON inv_date_sk = d_date_sk WHERE d_year = 2002 AND d_moy = 2 AND i_category IN ('Jewelry', 'Men') AND i_manager_id BETWEEN 81 AND 100 AND inv_quantity_on_hand BETWEEN 0 AND 200 AND inv_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim WHERE d_year=2002 AND d_moy=2) AND (SELECT MAX(d_date_sk) FROM date_dim WHERE d_year=2002 AND d_moy=2) GROUP BY w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy ) foo WHERE CASE mean WHEN 0 THEN 0 ELSE stdev/mean END > 1), inv_3 AS (SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, stdev, mean, CASE mean WHEN 0 THEN NULL ELSE stdev/mean END AS cov FROM ( SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, STDDEV_SAMP(inv_quantity_on_hand) AS stdev, AVG(inv_quantity_on_hand) AS mean FROM inventory JOIN item ON inv_item_sk = i_item_sk JOIN warehouse ON inv_warehouse_sk = w_warehouse_sk JOIN date_dim ON inv_date_sk = d_date_sk WHERE d_year = 2002 AND d_moy = 3 AND i_category IN ('Jewelry', 'Men') AND i_manager_id BETWEEN 81 AND 100 AND inv_quantity_on_hand BETWEEN 0 AND 200 AND inv_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim WHERE d_year=2002 AND d_moy=3) AND (SELECT MAX(d_date_sk) FROM date_dim WHERE d_year=2002 AND d_moy=3) GROUP BY w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy ) foo WHERE CASE mean WHEN 0 THEN 0 ELSE stdev/mean END > 1) SELECT inv_2.w_warehouse_sk, inv_2.i_item_sk, inv_2.d_moy, inv_2.mean, inv_2.cov, inv_3.w_warehouse_sk, inv_3.i_item_sk, inv_3.d_moy, inv_3.mean, inv_3.cov FROM inv_2, inv_3 WHERE inv_2.i_item_sk = inv_3.i_item_sk AND inv_2.w_warehouse_sk = inv_3.w_warehouse_sk ORDER BY inv_2.w_warehouse_sk, inv_2.i_item_sk, inv_2.d_moy, inv_2.mean, inv_2.cov, inv_3.d_moy, inv_3.mean, inv_3.cov;",
  "patches": [
    {
      "patch_id": "p01",
      "family": "F",
      "transform": "self_join_decomposition",
      "relevance_score": 0.85,
      "status": "REGRESSION",
      "speedup": 0.92,
      "semantic_passed": true,
      "error": null,
      "original_ms": 182.6,
      "patch_ms": 197.6,
      "output_sql": "WITH inv_2 AS (select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n       ,stdev,mean, case mean when 0 then null else stdev/mean end cov\n from(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n            ,stddev_samp(inv_quantity_on_hand) stdev,avg(inv_quantity_on_hand) mean\n      from inventory\n          ,item\n          ,warehouse\n          ,date_dim\n      where inv_item_sk = i_item_sk\n        and inv_warehouse_sk = w_warehouse_sk\n        and inv_date_sk = d_date_sk\n        and d_year = 2002\n        and i_category IN ('Jewelry', 'Men')\n        and i_manager_id BETWEEN 81 and 100\n        and inv_quantity_on_hand between 0 and 200\n        and d_moy = 2\n      group by w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy) foo\n where case mean when 0 then 0 else stdev/mean end > 1), inv_3 AS (select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n       ,stdev,mean, case mean when 0 then null else stdev/mean end cov\n from(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n            ,stddev_samp(inv_quantity_on_hand) stdev,avg(inv_quantity_on_hand) mean\n      from inventory\n          ,item\n          ,warehouse\n          ,date_dim\n      where inv_item_sk = i_item_sk\n        and inv_warehouse_sk = w_warehouse_sk\n        and inv_date_sk = d_date_sk\n        and d_year = 2002\n        and i_category IN ('Jewelry', 'Men')\n        and i_manager_id BETWEEN 81 and 100\n        and inv_quantity_on_hand between 0 and 200\n        and d_moy = 3\n      group by w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy) foo\n where case mean when 0 then 0 else stdev/mean end > 1) select inv_2.w_warehouse_sk,inv_2.i_item_sk,inv_2.d_moy,inv_2.mean, inv_2.cov\n        ,inv_3.w_warehouse_sk,inv_3.i_item_sk,inv_3.d_moy,inv_3.mean, inv_3.cov\nfrom inv_2,inv_3\nwhere inv_2.i_item_sk = inv_3.i_item_sk\n  and inv_2.w_warehouse_sk =  inv_3.w_warehouse_sk\norder by inv_2.w_warehouse_sk,inv_2.i_item_sk,inv_2.d_moy,inv_2.mean,inv_2.cov\n        ,inv_3.d_moy,inv_3.mean, inv_3.cov;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Split CTE 'inv' into two separate CTEs, inv_2 and inv_3, each filtering d_moy=2 and d_moy=3 respectively in their definitions, and compute aggregates and cov filter per month."
    },
    {
      "patch_id": "p02",
      "family": "A",
      "transform": "sf_sk_pushdown_multi_fact",
      "relevance_score": 0.75,
      "status": "REGRESSION",
      "speedup": 0.9,
      "semantic_passed": true,
      "error": null,
      "original_ms": 182.6,
      "patch_ms": 202.7,
      "output_sql": "WITH inv AS (select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n       ,stdev,mean, case mean when 0 then null else stdev/mean end cov\n from(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n            ,stddev_samp(inv_quantity_on_hand) stdev,avg(inv_quantity_on_hand) mean\n      from inventory\n          ,item\n          ,warehouse\n          ,date_dim\n      where inv_item_sk = i_item_sk\n        and inv_warehouse_sk = w_warehouse_sk\n        and inv_date_sk = d_date_sk\n        and d_year =2002\n        and i_category IN ('Jewelry', 'Men')\n        and i_manager_id BETWEEN 81 and 100\n        and inv_quantity_on_hand between 0 and 200\n        and inv_date_sk between (select min(d_date_sk) from date_dim where d_year=2002 and d_moy in (2,3)) and (select max(d_date_sk) from date_dim where d_year=2002 and d_moy in (2,3))\n      group by w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy) foo\n where case mean when 0 then 0 else stdev/mean end > 1) SELECT inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov, inv2.w_warehouse_sk, inv2.i_item_sk, inv2.d_moy, inv2.mean, inv2.cov FROM inv AS inv1, inv AS inv2 WHERE inv1.i_item_sk = inv2.i_item_sk AND inv1.w_warehouse_sk = inv2.w_warehouse_sk AND inv1.d_moy = 2 AND inv2.d_moy = 2 + 1 ORDER BY inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov, inv2.d_moy, inv2.mean, inv2.cov;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Derive date_sk range from date_dim filter (d_year=2002 AND d_moy IN (2,3)) and push as inv_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim WHERE ...) AND (SELECT MAX(d_date_sk) FROM date_dim WHERE ...) into inventory scan."
    },
    {
      "patch_id": "p03",
      "family": "A",
      "transform": "dimension_cte_isolate",
      "relevance_score": 0.55,
      "status": "REGRESSION",
      "speedup": 0.84,
      "semantic_passed": true,
      "error": null,
      "original_ms": 182.6,
      "patch_ms": 216.8,
      "output_sql": "WITH inv AS (WITH item_filtered AS (\n  SELECT i_item_sk\n  FROM item\n  WHERE i_category IN ('Jewelry', 'Men')\n    AND i_manager_id BETWEEN 81 AND 100\n),\nwarehouse_filtered AS (\n  SELECT w_warehouse_sk, w_warehouse_name\n  FROM warehouse\n),\ndate_dim_filtered AS (\n  SELECT d_date_sk, d_moy\n  FROM date_dim\n  WHERE d_year = 2002\n    AND d_moy IN (2, 3)\n)\nSELECT w.w_warehouse_name, w.w_warehouse_sk, i.i_item_sk, d.d_moy,\n       stddev_samp(inv.inv_quantity_on_hand) AS stdev,\n       avg(inv.inv_quantity_on_hand) AS mean,\n       CASE WHEN avg(inv.inv_quantity_on_hand) = 0 THEN NULL ELSE stddev_samp(inv.inv_quantity_on_hand)/avg(inv.inv_quantity_on_hand) END AS cov\nFROM inventory inv\nJOIN item_filtered i ON inv.inv_item_sk = i.i_item_sk\nJOIN warehouse_filtered w ON inv.inv_warehouse_sk = w.w_warehouse_sk\nJOIN date_dim_filtered d ON inv.inv_date_sk = d.d_date_sk\nWHERE inv.inv_quantity_on_hand BETWEEN 0 AND 200\nGROUP BY w.w_warehouse_name, w.w_warehouse_sk, i.i_item_sk, d.d_moy\nHAVING CASE WHEN avg(inv.inv_quantity_on_hand) = 0 THEN 0 ELSE stddev_samp(inv.inv_quantity_on_hand)/avg(inv.inv_quantity_on_hand) END > 1) SELECT inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov, inv2.w_warehouse_sk, inv2.i_item_sk, inv2.d_moy, inv2.mean, inv2.cov FROM inv AS inv1, inv AS inv2 WHERE inv1.i_item_sk = inv2.i_item_sk AND inv1.w_warehouse_sk = inv2.w_warehouse_sk AND inv1.d_moy = 2 AND inv2.d_moy = 2 + 1 ORDER BY inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov, inv2.d_moy, inv2.mean, inv2.cov;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-filter date_dim (d_year=2002, d_moy IN (2,3)), item (i_category IN, i_manager_id BETWEEN), and warehouse into separate CTEs returning only surrogate keys and needed attributes, then join with inventory."
    },
    {
      "patch_id": "p04",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.5,
      "status": "REGRESSION",
      "speedup": 0.82,
      "semantic_passed": true,
      "error": null,
      "original_ms": 182.6,
      "patch_ms": 223.1,
      "output_sql": "WITH inv AS (SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, stdev, mean, CASE mean WHEN 0 THEN NULL ELSE stdev / mean END AS cov FROM (SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, STDDEV_SAMP(inv_quantity_on_hand) AS stdev, AVG(inv_quantity_on_hand) AS mean FROM inventory, item, warehouse, date_dim WHERE inv_item_sk = i_item_sk AND inv_warehouse_sk = w_warehouse_sk AND inv_date_sk = d_date_sk AND d_year = 2002 AND i_category IN ('Jewelry', 'Men') AND i_manager_id BETWEEN 81 AND 100 AND inv_quantity_on_hand BETWEEN 0 AND 200 GROUP BY w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy) AS foo WHERE CASE mean WHEN 0 THEN 0 ELSE stdev / mean END > 1) SELECT inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov, inv2.w_warehouse_sk, inv2.i_item_sk, inv2.d_moy, inv2.mean, inv2.cov FROM inv AS inv1, inv AS inv2 WHERE inv1.i_item_sk = inv2.i_item_sk AND inv1.w_warehouse_sk = inv2.w_warehouse_sk AND inv1.d_moy = 2 AND inv2.d_moy = 2 + 1 ORDER BY inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov, inv2.d_moy, inv2.mean, inv2.cov;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-aggregate inventory by inv_item_sk, inv_warehouse_sk, inv_date_sk (sum, sum of squares, count) before joining with dimensions, then compute stddev and avg after joining with item, warehouse, date_dim."
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "IMPROVED",
      "speedup": 1.07,
      "semantic_passed": true,
      "error": null,
      "original_ms": 167.3,
      "patch_ms": 155.9,
      "output_sql": "WITH inv_2 AS (SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, stdev, mean, CASE mean WHEN 0 THEN NULL ELSE stdev/mean END AS cov FROM ( SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, STDDEV_SAMP(inv_quantity_on_hand) AS stdev, AVG(inv_quantity_on_hand) AS mean FROM inventory JOIN item ON inv_item_sk = i_item_sk JOIN warehouse ON inv_warehouse_sk = w_warehouse_sk JOIN date_dim ON inv_date_sk = d_date_sk WHERE d_year = 2002 AND d_moy = 2 AND i_category IN ('Jewelry', 'Men') AND i_manager_id BETWEEN 81 AND 100 AND inv_quantity_on_hand BETWEEN 0 AND 200 AND inv_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim WHERE d_year=2002 AND d_moy=2) AND (SELECT MAX(d_date_sk) FROM date_dim WHERE d_year=2002 AND d_moy=2) GROUP BY w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy ) foo WHERE CASE mean WHEN 0 THEN 0 ELSE stdev/mean END > 1), inv_3 AS (SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, stdev, mean, CASE mean WHEN 0 THEN NULL ELSE stdev/mean END AS cov FROM ( SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, STDDEV_SAMP(inv_quantity_on_hand) AS stdev, AVG(inv_quantity_on_hand) AS mean FROM inventory JOIN item ON inv_item_sk = i_item_sk JOIN warehouse ON inv_warehouse_sk = w_warehouse_sk JOIN date_dim ON inv_date_sk = d_date_sk WHERE d_year = 2002 AND d_moy = 3 AND i_category IN ('Jewelry', 'Men') AND i_manager_id BETWEEN 81 AND 100 AND inv_quantity_on_hand BETWEEN 0 AND 200 AND inv_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim WHERE d_year=2002 AND d_moy=3) AND (SELECT MAX(d_date_sk) FROM date_dim WHERE d_year=2002 AND d_moy=3) GROUP BY w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy ) foo WHERE CASE mean WHEN 0 THEN 0 ELSE stdev/mean END > 1) SELECT inv_2.w_warehouse_sk, inv_2.i_item_sk, inv_2.d_moy, inv_2.mean, inv_2.cov, inv_3.w_warehouse_sk, inv_3.i_item_sk, inv_3.d_moy, inv_3.mean, inv_3.cov FROM inv_2, inv_3 WHERE inv_2.i_item_sk = inv_3.i_item_sk AND inv_2.w_warehouse_sk = inv_3.w_warehouse_sk ORDER BY inv_2.w_warehouse_sk, inv_2.i_item_sk, inv_2.d_moy, inv_2.mean, inv_2.cov, inv_3.d_moy, inv_3.mean, inv_3.cov;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p2",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "NEUTRAL",
      "speedup": 1.04,
      "semantic_passed": true,
      "error": null,
      "original_ms": 167.3,
      "patch_ms": 160.2,
      "output_sql": "WITH inv AS (SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, stdev, mean, CASE mean WHEN 0 THEN NULL ELSE stdev/mean END AS cov FROM ( SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, STDDEV_SAMP(inv_quantity_on_hand) AS stdev, AVG(inv_quantity_on_hand) AS mean FROM inventory, item, warehouse, date_dim WHERE inv_item_sk = i_item_sk AND inv_warehouse_sk = w_warehouse_sk AND inv_date_sk = d_date_sk AND d_year = 2002 AND i_category IN ('Jewelry', 'Men') AND i_manager_id BETWEEN 81 AND 100 AND inv_quantity_on_hand BETWEEN 0 AND 200 AND inv_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim WHERE d_year=2002 AND d_moy IN (2,3)) AND (SELECT MAX(d_date_sk) FROM date_dim WHERE d_year=2002 AND d_moy IN (2,3)) GROUP BY w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy ) foo WHERE CASE mean WHEN 0 THEN 0 ELSE stdev/mean END > 1) SELECT inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov, inv2.w_warehouse_sk, inv2.i_item_sk, inv2.d_moy, inv2.mean, inv2.cov FROM inv AS inv1, inv AS inv2 WHERE inv1.i_item_sk = inv2.i_item_sk AND inv1.w_warehouse_sk = inv2.w_warehouse_sk AND inv1.d_moy = 2 AND inv2.d_moy = 2 + 1 ORDER BY inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov, inv2.d_moy, inv2.mean, inv2.cov;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p3",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "NEUTRAL",
      "speedup": 0.97,
      "semantic_passed": true,
      "error": null,
      "original_ms": 167.3,
      "patch_ms": 171.7,
      "output_sql": "WITH inv_2 AS (SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, stdev, mean, CASE mean WHEN 0 THEN NULL ELSE stdev/mean END AS cov FROM ( SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, STDDEV_SAMP(inv_quantity_on_hand) AS stdev, AVG(inv_quantity_on_hand) AS mean FROM inventory, item, warehouse, date_dim WHERE inv_item_sk = i_item_sk AND inv_warehouse_sk = w_warehouse_sk AND inv_date_sk = d_date_sk AND d_year = 2002 AND d_moy = 2 AND i_category IN ('Jewelry', 'Men') AND i_manager_id BETWEEN 81 AND 100 AND inv_quantity_on_hand BETWEEN 0 AND 200 GROUP BY w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy ) foo WHERE CASE mean WHEN 0 THEN 0 ELSE stdev/mean END > 1), inv_3 AS (SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, stdev, mean, CASE mean WHEN 0 THEN NULL ELSE stdev/mean END AS cov FROM ( SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, STDDEV_SAMP(inv_quantity_on_hand) AS stdev, AVG(inv_quantity_on_hand) AS mean FROM inventory, item, warehouse, date_dim WHERE inv_item_sk = i_item_sk AND inv_warehouse_sk = w_warehouse_sk AND inv_date_sk = d_date_sk AND d_year = 2002 AND d_moy = 3 AND i_category IN ('Jewelry', 'Men') AND i_manager_id BETWEEN 81 AND 100 AND inv_quantity_on_hand BETWEEN 0 AND 200 GROUP BY w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy ) foo WHERE CASE mean WHEN 0 THEN 0 ELSE stdev/mean END > 1) SELECT inv_2.w_warehouse_sk, inv_2.i_item_sk, inv_2.d_moy, inv_2.mean, inv_2.cov, inv_3.w_warehouse_sk, inv_3.i_item_sk, inv_3.d_moy, inv_3.mean, inv_3.cov FROM inv_2, inv_3 WHERE inv_2.i_item_sk = inv_3.i_item_sk AND inv_2.w_warehouse_sk = inv_3.w_warehouse_sk ORDER BY inv_2.w_warehouse_sk, inv_2.i_item_sk, inv_2.d_moy, inv_2.mean, inv_2.cov, inv_3.d_moy, inv_3.mean, inv_3.cov;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p4",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.88,
      "semantic_passed": true,
      "error": null,
      "original_ms": 167.3,
      "patch_ms": 190.3,
      "output_sql": "WITH inv AS (WITH item_filtered AS ( SELECT i_item_sk FROM item WHERE i_category IN ('Jewelry', 'Men') AND i_manager_id BETWEEN 81 AND 100 ), warehouse_filtered AS ( SELECT w_warehouse_sk, w_warehouse_name FROM warehouse ), date_dim_filtered AS ( SELECT d_date_sk, d_moy FROM date_dim WHERE d_year = 2002 AND d_moy IN (2,3) ) SELECT w.w_warehouse_name, w.w_warehouse_sk, i.i_item_sk, d.d_moy, STDDEV_SAMP(inv.inv_quantity_on_hand) AS stdev, AVG(inv.inv_quantity_on_hand) AS mean, CASE WHEN AVG(inv.inv_quantity_on_hand) = 0 THEN NULL ELSE STDDEV_SAMP(inv.inv_quantity_on_hand)/AVG(inv.inv_quantity_on_hand) END AS cov FROM inventory inv JOIN item_filtered i ON inv.inv_item_sk = i.i_item_sk JOIN warehouse_filtered w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN date_dim_filtered d ON inv.inv_date_sk = d.d_date_sk WHERE inv.inv_quantity_on_hand BETWEEN 0 AND 200 AND inv.inv_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim_filtered) AND (SELECT MAX(d_date_sk) FROM date_dim_filtered) GROUP BY w.w_warehouse_name, w.w_warehouse_sk, i.i_item_sk, d.d_moy HAVING CASE WHEN AVG(inv.inv_quantity_on_hand) = 0 THEN 0 ELSE STDDEV_SAMP(inv.inv_quantity_on_hand)/AVG(inv.inv_quantity_on_hand) END > 1) SELECT inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov, inv2.w_warehouse_sk, inv2.i_item_sk, inv2.d_moy, inv2.mean, inv2.cov FROM inv AS inv1, inv AS inv2 WHERE inv1.i_item_sk = inv2.i_item_sk AND inv1.w_warehouse_sk = inv2.w_warehouse_sk AND inv1.d_moy = 2 AND inv2.d_moy = 2 + 1 ORDER BY inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov, inv2.d_moy, inv2.mean, inv2.cov;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p01": "GlobalStats | 566 | 566 | 7369408512\n1 | 0 | Result | WAREHOUSE.W_WAREHOUSE_SK, ITEM.I_ITEM_SK, DATE_DIM.D_MOY, SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM_INTERNAL(INVENTORY.INV_QUANTITY_ON_HAND, COUNT(*))))), COUNT(COUNT(COUNT(COUNT_INTERNAL(INVENTORY.INV_QUANTITY_ON_HAND, COUNT(*)))))), CASE SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM_INTERNAL(INVENTORY.INV_QUANTITY_ON_HAND, COUNT(*))))), COUNT(COUNT(COUNT(COUNT_INTERNAL(INVENTORY.INV_QUANTITY_ON_HAND, COUNT(*)))))) WHEN 0 THEN null ELSE (SQRT(TO_DOU",
    "p02": "GlobalStats | 285 | 285 | 3688981504\n1 | 0 | Result | MIN(DATE_DIM.D_DATE_SK)\n1 | 1 | [0] | Aggregate | aggExprs: [MIN(DATE_DIM.D_DATE_SK)]\n1 | 2 | [1] | Filter | (DATE_DIM.D_YEAR = 2002) AND (DATE_DIM.D_MOY IN 2 IN 3)\n1 | 3 | [2] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_DATE_SK, D_YEAR, D_MOY | 1 | 1 | 2138624\n2 | 0 | Result | MAX(DATE_DIM.D_DATE_SK)\n2 | 1 | [0] | Aggregate | aggExprs: [MAX(DATE_DIM.D_DATE_SK)]\n2 | 2 | [1] | Filter | (DATE_DIM.D_YEAR = 2002) AND (DATE_DIM.",
    "p03": "GlobalStats | 283 | 283 | 3684704256\n1 | 0 | Result | INV1.W_WAREHOUSE_SK, INV1.I_ITEM_SK, INV1.D_MOY, INV1.MEAN, INV1.COV, INV2.W_WAREHOUSE_SK, INV2.I_ITEM_SK, INV2.D_MOY, INV2.MEAN, INV2.COV\n1 | 1 | [0] | Sort | INV1.W_WAREHOUSE_SK ASC NULLS LAST, INV1.I_ITEM_SK ASC NULLS LAST, INV1.D_MOY ASC NULLS LAST, INV1.MEAN ASC NULLS LAST, INV1.COV ASC NULLS LAST, INV2.D_MOY ASC NULLS LAST, INV2.MEAN ASC NULLS LAST, INV2.COV ASC NULLS LAST\n1 | 2 | [1] | InnerJoin | joinKey: (INV1.I_ITEM_SK = INV2.I_ITEM",
    "p04": "GlobalStats | 283 | 283 | 3684704256\n1 | 0 | Result | INV1.W_WAREHOUSE_SK, INV1.I_ITEM_SK, INV1.D_MOY, INV1.MEAN, INV1.COV, INV2.W_WAREHOUSE_SK, INV2.I_ITEM_SK, INV2.D_MOY, INV2.MEAN, INV2.COV\n1 | 1 | [0] | Sort | INV1.W_WAREHOUSE_SK ASC NULLS LAST, INV1.I_ITEM_SK ASC NULLS LAST, INV1.D_MOY ASC NULLS LAST, INV1.MEAN ASC NULLS LAST, INV1.COV ASC NULLS LAST, INV2.D_MOY ASC NULLS LAST, INV2.MEAN ASC NULLS LAST, INV2.COV ASC NULLS LAST\n1 | 2 | [1] | InnerJoin | joinKey: (INV1.I_ITEM_SK = INV2.I_ITEM",
    "compile_p1": "GlobalStats | 570 | 570 | 7377963008\n1 | 0 | Result | MIN(DATE_DIM.D_DATE_SK)\n1 | 1 | [0] | Aggregate | aggExprs: [MIN(DATE_DIM.D_DATE_SK)]\n1 | 2 | [1] | Filter | (DATE_DIM.D_YEAR = 2002) AND (DATE_DIM.D_MOY = 3)\n1 | 3 | [2] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_DATE_SK, D_YEAR, D_MOY | 1 | 1 | 2138624\n2 | 0 | Result | MAX(DATE_DIM.D_DATE_SK)\n2 | 1 | [0] | Aggregate | aggExprs: [MAX(DATE_DIM.D_DATE_SK)]\n2 | 2 | [1] | Filter | (DATE_DIM.D_YEAR = 2002) AND (DATE_DIM.D_MOY ",
    "compile_p2": "GlobalStats | 285 | 285 | 3688981504\n1 | 0 | Result | MIN(DATE_DIM.D_DATE_SK)\n1 | 1 | [0] | Aggregate | aggExprs: [MIN(DATE_DIM.D_DATE_SK)]\n1 | 2 | [1] | Filter | (DATE_DIM.D_YEAR = 2002) AND (DATE_DIM.D_MOY IN 2 IN 3)\n1 | 3 | [2] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_DATE_SK, D_YEAR, D_MOY | 1 | 1 | 2138624\n2 | 0 | Result | MAX(DATE_DIM.D_DATE_SK)\n2 | 1 | [0] | Aggregate | aggExprs: [MAX(DATE_DIM.D_DATE_SK)]\n2 | 2 | [1] | Filter | (DATE_DIM.D_YEAR = 2002) AND (DATE_DIM.",
    "compile_p3": "GlobalStats | 566 | 566 | 7369408512\n1 | 0 | Result | WAREHOUSE.W_WAREHOUSE_SK, ITEM.I_ITEM_SK, DATE_DIM.D_MOY, SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM_INTERNAL(INVENTORY.INV_QUANTITY_ON_HAND, COUNT(*))))), COUNT(COUNT(COUNT(COUNT_INTERNAL(INVENTORY.INV_QUANTITY_ON_HAND, COUNT(*)))))), CASE SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM_INTERNAL(INVENTORY.INV_QUANTITY_ON_HAND, COUNT(*))))), COUNT(COUNT(COUNT(COUNT_INTERNAL(INVENTORY.INV_QUANTITY_ON_HAND, COUNT(*)))))) WHEN 0 THEN null ELSE (SQRT(TO_DOU",
    "compile_p4": "GlobalStats | 285 | 285 | 3688981504\n1 | 0 | Result | MIN(DATE_DIM.D_DATE_SK)\n1 | 1 | [0] | Aggregate | aggExprs: [MIN(DATE_DIM.D_DATE_SK)]\n1 | 2 | [1] | Filter | (DATE_DIM.D_YEAR = 2002) AND (DATE_DIM.D_MOY IN 2 IN 3)\n1 | 3 | [2] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_DATE_SK, D_YEAR, D_MOY | 1 | 1 | 2138624\n2 | 0 | Result | MAX(DATE_DIM.D_DATE_SK)\n2 | 1 | [0] | Aggregate | aggExprs: [MAX(DATE_DIM.D_DATE_SK)]\n2 | 2 | [1] | Filter | (DATE_DIM.D_YEAR = 2002) AND (DATE_DIM."
  }
}