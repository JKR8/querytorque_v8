{
  "iteration": 0,
  "n_api_calls": 6,
  "beam_cost_usd": 0.0,
  "beam_cost_priced_calls": 0,
  "beam_cost_unpriced_calls": 6,
  "beam_token_totals": {
    "prompt_tokens": 0,
    "completion_tokens": 0,
    "total_tokens": 0,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 0,
    "reasoning_tokens": 0
  },
  "best_speedup": 1.15,
  "best_patch_id": "p07",
  "best_sql": "WITH ss_date_filtered AS (SELECT ss.ss_quantity, ss.ss_ext_sales_price, ss.ss_ext_wholesale_cost, ss.ss_net_profit, ss.ss_store_sk, ss.ss_cdemo_sk, ss.ss_hdemo_sk, ss.ss_addr_sk FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE d.d_year = 2001) select avg(ss_quantity)\n,avg(ss_ext_sales_price)\n,avg(ss_ext_wholesale_cost)\n,sum(ss_ext_wholesale_cost)\nfrom store_sales\n   ,store\n   ,customer_demographics\n   ,household_demographics\n   ,customer_address\n   ,date_dim\nwhere s_store_sk = ss_store_sk\nand  ss_sold_date_sk = d_date_sk and d_year = 2001\nand((ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'M'\nand cd_education_status = '2 yr Degree'\nand ss_sales_price between 100.00 and 150.00\nand hd_dep_count = 3\n   )or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'S'\nand cd_education_status = 'Primary'\nand ss_sales_price between 50.00 and 100.00\nand hd_dep_count = 1\n   ) or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'W'\nand cd_education_status = 'Primary'\nand ss_sales_price between 150.00 and 200.00\nand hd_dep_count = 1\n   ))\nand((ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('GA', 'KY', 'SD')\nand ss_net_profit between 100 and 200\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('AR', 'IN', 'VA')\nand ss_net_profit between 150 and 300\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('KS', 'OH', 'SD')\nand ss_net_profit between 50 and 250\n   ));",
  "patches": [
    {
      "patch_id": "p01",
      "family": "A",
      "transform": "sf_sk_pushdown_multi_fact",
      "relevance_score": 0.85,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select avg(ss_quantity)\n,avg(ss_ext_sales_price)\n,avg(ss_ext_wholesale_cost)\n,sum(ss_ext_wholesale_cost)\nfrom store_sales\n   ,store\ncustomer_demographics\n,household_demographics\n,customer_address\n,date_dim\nwhere s_store_sk = ss_store_sk\nand  ss_sold_date_sk = d_date_sk and d_year = 2001\nand ((ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'M'\nand cd_education_status = '2 yr Degree'\nand ss_sales_price between 100.00 and 150.00\nand hd_dep_count = 3\n   )or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'S'\nand cd_education_status = 'Primary'\nand ss_sales_price between 50.00 and 100.00\nand hd_dep_count = 1\n   ) or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'W'\nand cd_education_status = 'Primary'\nand ss_sales_price between 150.00 and 200.00\nand hd_dep_count = 1\n   ))\nand((ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('GA', 'KY', 'SD')\nand ss_net_profit between 100 and 200\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('AR', 'IN', 'VA')\nand ss_net_profit between 150 and 300\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('KS', 'OH', 'SD')\nand ss_net_profit between 50 and 250\n   ))\nand ss_sold_date_sk between (select min(d_date_sk) from date_dim where d_year = 2001) and (select max(d_date_sk) from date_dim where d_year = 2001);",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Push d_year=2001 filter as SS_SOLD_DATE_SK BETWEEN (SELECT MIN(D_DATE_SK) FROM date_dim WHERE d_year=2001) AND (SELECT MAX(D_DATE_SK) FROM date_dim WHERE d_year=2001) into the STORE_SALES scan, enabling micro\u2011partition pruning on date key."
    },
    {
      "patch_id": "p12",
      "family": "C",
      "transform": "channel_bitmap_aggregation",
      "relevance_score": 0.55,
      "status": "NEUTRAL",
      "speedup": 0.99,
      "semantic_passed": true,
      "error": null,
      "original_ms": 174.4,
      "patch_ms": 176.9,
      "output_sql": "WITH agg_store_sales AS (SELECT\n  AVG(CASE\n    WHEN (cd_marital_status = 'M' AND cd_education_status = '2 yr Degree' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3 AND ca_state IN ('GA', 'KY', 'SD') AND ss_net_profit BETWEEN 100 AND 200) OR\n         (cd_marital_status = 'S' AND cd_education_status = 'Primary' AND ss_sales_price BETWEEN 50.00 AND 100.00 AND hd_dep_count = 1 AND ca_state IN ('AR', 'IN', 'VA') AND ss_net_profit BETWEEN 150 AND 300) OR\n         (cd_marital_status = 'W' AND cd_education_status = 'Primary' AND ss_sales_price BETWEEN 150.00 AND 200.00 AND hd_dep_count = 1 AND ca_state IN ('KS', 'OH', 'SD') AND ss_net_profit BETWEEN 50 AND 250)\n    THEN ss_quantity\n  END) AS ss_quantity,\n  AVG(CASE\n    WHEN (cd_marital_status = 'M' AND cd_education_status = '2 yr Degree' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3 AND ca_state IN ('GA', 'KY', 'SD') AND ss_net_profit BETWEEN 100 AND 200) OR\n         (cd_marital_status = 'S' AND cd_education_status = 'Primary' AND ss_sales_price BETWEEN 50.00 AND 100.00 AND hd_dep_count = 1 AND ca_state IN ('AR', 'IN', 'VA') AND ss_net_profit BETWEEN 150 AND 300) OR\n         (cd_marital_status = 'W' AND cd_education_status = 'Primary' AND ss_sales_price BETWEEN 150.00 AND 200.00 AND hd_dep_count = 1 AND ca_state IN ('KS', 'OH', 'SD') AND ss_net_profit BETWEEN 50 AND 250)\n    THEN ss_ext_sales_price\n  END) AS ss_ext_sales_price,\n  AVG(CASE\n    WHEN (cd_marital_status = 'M' AND cd_education_status = '2 yr Degree' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3 AND ca_state IN ('GA', 'KY', 'SD') AND ss_net_profit BETWEEN 100 AND 200) OR\n         (cd_marital_status = 'S' AND cd_education_status = 'Primary' AND ss_sales_price BETWEEN 50.00 AND 100.00 AND hd_dep_count = 1 AND ca_state IN ('AR', 'IN', 'VA') AND ss_net_profit BETWEEN 150 AND 300) OR\n         (cd_marital_status = 'W' AND cd_education_status = 'Primary' AND ss_sales_price BETWEEN 150.00 AND 200.00 AND hd_dep_count = 1 AND ca_state IN ('KS', 'OH', 'SD') AND ss_net_profit BETWEEN 50 AND 250)\n    THEN ss_ext_wholesale_cost\n  END) AS ss_ext_wholesale_cost,\n  SUM(CASE\n    WHEN (cd_marital_status = 'M' AND cd_education_status = '2 yr Degree' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3 AND ca_state IN ('GA', 'KY', 'SD') AND ss_net_profit BETWEEN 100 AND 200) OR\n         (cd_marital_status = 'S' AND cd_education_status = 'Primary' AND ss_sales_price BETWEEN 50.00 AND 100.00 AND hd_dep_count = 1 AND ca_state IN ('AR', 'IN', 'VA') AND ss_net_profit BETWEEN 150 AND 300) OR\n         (cd_marital_status = 'W' AND cd_education_status = 'Primary' AND ss_sales_price BETWEEN 150.00 AND 200.00 AND hd_dep_count = 1 AND ca_state IN ('KS', 'OH', 'SD') AND ss_net_profit BETWEEN 50 AND 250)\n    THEN ss_ext_wholesale_cost\n  END) AS ss_ext_wholesale_cost\nFROM store_sales\nJOIN store ON s_store_sk = ss_store_sk\nJOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk\nJOIN household_demographics ON hd_demo_sk = ss_hdemo_sk\nJOIN customer_address ON ca_address_sk = ss_addr_sk\nJOIN date_dim ON d_date_sk = ss_sold_date_sk\nWHERE d_year = 2001\n  AND cd_marital_status IN ('M','S','W')\n  AND cd_education_status IN ('2 yr Degree','Primary')\n  AND hd_dep_count IN (3,1)\n  AND ca_country = 'United States'\n  AND ca_state IN ('GA','KY','SD','AR','IN','VA','KS','OH','SD')) select avg(ss_quantity)\n,avg(ss_ext_sales_price)\n,avg(ss_ext_wholesale_cost)\n,sum(ss_ext_wholesale_cost)\nfrom store_sales\n   ,store\n   ,customer_demographics\n   ,household_demographics\n   ,customer_address\n   ,date_dim\nwhere s_store_sk = ss_store_sk\nand  ss_sold_date_sk = d_date_sk and d_year = 2001\nand((ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'M'\nand cd_education_status = '2 yr Degree'\nand ss_sales_price between 100.00 and 150.00\nand hd_dep_count = 3\n   )or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'S'\nand cd_education_status = 'Primary'\nand ss_sales_price between 50.00 and 100.00\nand hd_dep_count = 1\n   ) or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'W'\nand cd_education_status = 'Primary'\nand ss_sales_price between 150.00 and 200.00\nand hd_dep_count = 1\n   ))\nand((ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('GA', 'KY', 'SD')\nand ss_net_profit between 100 and 200\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('AR', 'IN', 'VA')\nand ss_net_profit between 150 and 300\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('KS', 'OH', 'SD')\nand ss_net_profit between 50 and 250\n   ));",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Consolidate the three OR branches into a single scan with CASE\u2011based conditional aggregates, removing the need for OR join filters."
    },
    {
      "patch_id": "p03",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.8,
      "status": "NEUTRAL",
      "speedup": 1.01,
      "semantic_passed": true,
      "error": null,
      "original_ms": 174.4,
      "patch_ms": 173.2,
      "output_sql": "WITH preagg_store_sales AS (SELECT ss_store_sk, ss_cdemo_sk, ss_hdemo_sk, ss_addr_sk, ss_sold_date_sk, SUM(ss_quantity) AS sum_ss_quantity, COUNT(ss_quantity) AS count_ss_quantity, SUM(ss_ext_sales_price) AS sum_ss_ext_sales_price, COUNT(ss_ext_sales_price) AS count_ss_ext_sales_price, SUM(ss_ext_wholesale_cost) AS sum_ss_ext_wholesale_cost, COUNT(ss_ext_wholesale_cost) AS count_ss_ext_wholesale_cost FROM store_sales WHERE ss_sales_price BETWEEN 50 AND 200 AND ss_net_profit BETWEEN 50 AND 300 GROUP BY ss_store_sk, ss_cdemo_sk, ss_hdemo_sk, ss_addr_sk, ss_sold_date_sk) select avg(ss_quantity)\n,avg(ss_ext_sales_price)\n,avg(ss_ext_wholesale_cost)\n,sum(ss_ext_wholesale_cost)\nfrom store_sales\n   ,store\n   ,customer_demographics\n   ,household_demographics\n   ,customer_address\n   ,date_dim\nwhere s_store_sk = ss_store_sk\nand  ss_sold_date_sk = d_date_sk and d_year = 2001\nand((ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'M'\nand cd_education_status = '2 yr Degree'\nand ss_sales_price between 100.00 and 150.00\nand hd_dep_count = 3\n   )or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'S'\nand cd_education_status = 'Primary'\nand ss_sales_price between 50.00 and 100.00\nand hd_dep_count = 1\n   ) or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'W'\nand cd_education_status = 'Primary'\nand ss_sales_price between 150.00 and 200.00\nand hd_dep_count = 1\n   ))\nand((ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('GA', 'KY', 'SD')\nand ss_net_profit between 100 and 200\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('AR', 'IN', 'VA')\nand ss_net_profit between 150 and 300\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('KS', 'OH', 'SD')\nand ss_net_profit between 50 and 250\n   ));",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre\u2011aggregate STORE_SALES at the lowest possible grain (SS_STORE_SK, SS_CDEMO_SK, SS_HDEMO_SK, SS_SOLD_DATE_SK, SS_ADDR_SK) before joining dimensions, keeping all necessary measures (SUM, COUNT) for final averages."
    },
    {
      "patch_id": "p09",
      "family": "A",
      "transform": "dimension_cte_isolate",
      "relevance_score": 0.75,
      "status": "REGRESSION",
      "speedup": 0.95,
      "semantic_passed": true,
      "error": null,
      "original_ms": 174.4,
      "patch_ms": 183.8,
      "output_sql": "WITH store_cte AS (SELECT s_store_sk FROM store), customer_demographics_cte AS (SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE cd_marital_status IN ('M','S','W') AND cd_education_status IN ('2 yr Degree','Primary')), household_demographics_cte AS (SELECT hd_demo_sk, hd_dep_count FROM household_demographics WHERE hd_dep_count IN (3,1)), customer_address_cte AS (SELECT ca_address_sk, ca_country, ca_state FROM customer_address WHERE ca_country = 'United States' AND ca_state IN ('GA','KY','SD','AR','IN','VA','KS','OH','SD')), date_dim_cte AS (SELECT d_date_sk, d_year FROM date_dim WHERE d_year = 2001), store_sales_filtered AS (SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost FROM store_sales ss JOIN store_cte s ON ss.ss_store_sk = s.s_store_sk JOIN date_dim_cte d ON ss.ss_sold_date_sk = d.d_date_sk JOIN customer_demographics_cte cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN household_demographics_cte hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN customer_address_cte ca ON ss.ss_addr_sk = ca.ca_address_sk WHERE ( (cd.cd_marital_status = 'M' AND cd.cd_education_status = '2 yr Degree' AND ss.ss_sales_price BETWEEN 100.00 AND 150.00 AND hd.hd_dep_count = 3) OR (cd.cd_marital_status = 'S' AND cd.cd_education_status = 'Primary' AND ss.ss_sales_price BETWEEN 50.00 AND 100.00 AND hd.hd_dep_count = 1) OR (cd.cd_marital_status = 'W' AND cd.cd_education_status = 'Primary' AND ss.ss_sales_price BETWEEN 150.00 AND 200.00 AND hd.hd_dep_count = 1) ) AND ( (ca.ca_country = 'United States' AND ca.ca_state IN ('GA', 'KY', 'SD') AND ss.ss_net_profit BETWEEN 100 AND 200) OR (ca.ca_country = 'United States' AND ca.ca_state IN ('AR', 'IN', 'VA') AND ss.ss_net_profit BETWEEN 150 AND 300) OR (ca.ca_country = 'United States' AND ca.ca_state IN ('KS', 'OH', 'SD') AND ss.ss_net_profit BETWEEN 50 AND 250) )) SELECT AVG(ss_quantity), AVG(ss_ext_sales_price), AVG(ss_ext_wholesale_cost), SUM(ss_ext_wholesale_cost) FROM store_sales_filtered;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre\u2011filter each dimension table into a CTE returning only surrogate keys and required attributes, then join with store_sales."
    },
    {
      "patch_id": "p02",
      "family": "D",
      "transform": "or_to_union",
      "relevance_score": 0.65,
      "status": "IMPROVED",
      "speedup": 1.09,
      "semantic_passed": true,
      "error": null,
      "original_ms": 174.4,
      "patch_ms": 160.3,
      "output_sql": "select avg(ss_quantity)\n,avg(ss_ext_sales_price)\n,avg(ss_ext_wholesale_cost)\n,sum(ss_ext_wholesale_cost)\nfrom store_sales\n   ,store\n   ,customer_demographics\n   ,household_demographics\n   ,customer_address\n   ,date_dim\nwhere s_store_sk = ss_store_sk\nand  ss_sold_date_sk = d_date_sk and d_year = 2001\nand((ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'M'\nand cd_education_status = '2 yr Degree'\nand ss_sales_price between 100.00 and 150.00\nand hd_dep_count = 3\n   )or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'S'\nand cd_education_status = 'Primary'\nand ss_sales_price between 50.00 and 100.00\nand hd_dep_count = 1\n   ) or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'W'\nand cd_education_status = 'Primary'\nand ss_sales_price between 150.00 and 200.00\nand hd_dep_count = 1\n   ))\nand((ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('GA', 'KY', 'SD')\nand ss_net_profit between 100 and 200\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('AR', 'IN', 'VA')\nand ss_net_profit between 150 and 300\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('KS', 'OH', 'SD')\nand ss_net_profit between 50 and 250\n   ));",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Convert OR join filters on customer_demographics/household_demographics and customer_address into UNION ALL branches, each with a single conjunctive filter, enabling partition pruning per branch."
    },
    {
      "patch_id": "p07",
      "family": "A",
      "transform": "prefetch_fact_join",
      "relevance_score": 0.55,
      "status": "WIN",
      "speedup": 1.15,
      "semantic_passed": true,
      "error": null,
      "original_ms": 174.4,
      "patch_ms": 151.8,
      "output_sql": "WITH ss_date_filtered AS (SELECT ss.ss_quantity, ss.ss_ext_sales_price, ss.ss_ext_wholesale_cost, ss.ss_net_profit, ss.ss_store_sk, ss.ss_cdemo_sk, ss.ss_hdemo_sk, ss.ss_addr_sk FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE d.d_year = 2001) select avg(ss_quantity)\n,avg(ss_ext_sales_price)\n,avg(ss_ext_wholesale_cost)\n,sum(ss_ext_wholesale_cost)\nfrom store_sales\n   ,store\n   ,customer_demographics\n   ,household_demographics\n   ,customer_address\n   ,date_dim\nwhere s_store_sk = ss_store_sk\nand  ss_sold_date_sk = d_date_sk and d_year = 2001\nand((ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'M'\nand cd_education_status = '2 yr Degree'\nand ss_sales_price between 100.00 and 150.00\nand hd_dep_count = 3\n   )or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'S'\nand cd_education_status = 'Primary'\nand ss_sales_price between 50.00 and 100.00\nand hd_dep_count = 1\n   ) or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'W'\nand cd_education_status = 'Primary'\nand ss_sales_price between 150.00 and 200.00\nand hd_dep_count = 1\n   ))\nand((ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('GA', 'KY', 'SD')\nand ss_net_profit between 100 and 200\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('AR', 'IN', 'VA')\nand ss_net_profit between 150 and 300\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('KS', 'OH', 'SD')\nand ss_net_profit between 50 and 250\n   ));",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Stage joins: first filter date_dim, join with store_sales to get date\u2011filtered fact rows; then join result with remaining dimensions."
    },
    {
      "patch_id": "p08",
      "family": "A",
      "transform": "date_cte_isolate",
      "relevance_score": 0.7,
      "status": "NEUTRAL",
      "speedup": 1.02,
      "semantic_passed": true,
      "error": null,
      "original_ms": 174.4,
      "patch_ms": 171.4,
      "output_sql": "WITH date_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001) select avg(ss_quantity)\n,avg(ss_ext_sales_price)\n,avg(ss_ext_wholesale_cost)\n,sum(ss_ext_wholesale_cost)\nfrom store_sales\n   ,store\n   ,customer_demographics\n   ,household_demographics\n   ,customer_address\n   ,date_filtered\nwhere s_store_sk = ss_store_sk\nand  ss_sold_date_sk = d_date_sk\nand((ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'M'\nand cd_education_status = '2 yr Degree'\nand ss_sales_price between 100.00 and 150.00\nand hd_dep_count = 3\n   )or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'S'\nand cd_education_status = 'Primary'\nand ss_sales_price between 50.00 and 100.00\nand hd_dep_count = 1\n   ) or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'W'\nand cd_education_status = 'Primary'\nand ss_sales_price between 150.00 and 200.00\nand hd_dep_count = 1\n   ))\nand((ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('GA', 'KY', 'SD')\nand ss_net_profit between 100 and 200\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('AR', 'IN', 'VA')\nand ss_net_profit between 150 and 300\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('KS', 'OH', 'SD')\nand ss_net_profit between 50 and 250\n   ));",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Isolate date_dim filter into a tiny CTE containing only D_DATE_SK for d_year=2001, then join with store_sales."
    },
    {
      "patch_id": "p05",
      "family": "A",
      "transform": "multi_dimension_prefetch",
      "relevance_score": 0.6,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH prefetch_dimensions AS (SELECT cd.cd_demo_sk, hd.hd_demo_sk, ca.ca_address_sk, d.d_date_sk FROM customer_demographics cd, household_demographics hd, customer_address ca, date_dim d WHERE ((cd.cd_marital_status = 'M' AND cd.cd_education_status = '2 yr Degree' AND hd.hd_dep_count = 3) OR (cd.cd_marital_status = 'S' AND cd.cd_education_status = 'Primary' AND hd.hd_dep_count = 1) OR (cd.cd_marital_status = 'W' AND cd.cd_education_status = 'Primary' AND hd.hd_dep_count = 1)) AND ((ca.ca_country = 'United States' AND ca.ca_state IN ('GA', 'KY', 'SD') AND ss_net_profit BETWEEN 100 AND 200) OR (ca.ca_country = 'United States' AND ca.ca_state IN ('AR', 'IN', 'VA') AND ss_net_profit BETWEEN 150 AND 300) OR (ca.ca_country = 'United States' AND ca.ca_state IN ('KS', 'OH', 'SD') AND ss_net_profit BETWEEN 50 AND 250)) AND d.d_year = 2001) SELECT AVG(ss_quantity), AVG(ss_ext_sales_price), AVG(ss_ext_wholesale_cost), SUM(ss_ext_wholesale_cost) FROM store_sales ss JOIN prefetch_dimensions pd ON ss.ss_cdemo_sk = pd.cd_demo_sk AND ss.ss_hdemo_sk = pd.hd_demo_sk AND ss.ss_addr_sk = pd.ca_address_sk AND ss.ss_sold_date_sk = pd.d_date_sk;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Combine all dimension pre\u2011filtering into a single CTE that returns the Cartesian product of filtered dimension keys, then join once with store_sales."
    },
    {
      "patch_id": "p04",
      "family": "A",
      "transform": "early_filter",
      "relevance_score": 0.75,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_store_sales AS (SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost, ss_store_sk, ss_cdemo_sk, ss_hdemo_sk, ss_addr_sk, ss_sold_date_sk FROM store_sales), store_cte AS (SELECT s_store_sk FROM store), customer_demographics_cte AS (SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE cd_marital_status IN ('M','S','W') AND cd_education_status IN ('2 yr Degree','Primary')), household_demographics_cte AS (SELECT hd_demo_sk, hd_dep_count FROM household_demographics WHERE hd_dep_count IN (3,1)), customer_address_cte AS (SELECT ca_address_sk, ca_country, ca_state FROM customer_address WHERE ca_country = 'United States' AND ca_state IN ('GA','KY','SD','AR','IN','VA','KS','OH','SD')), date_dim_cte AS (SELECT d_date_sk, d_year FROM date_dim WHERE d_year = 2001) SELECT AVG(ss_quantity), AVG(ss_ext_sales_price), AVG(ss_ext_wholesale_cost), SUM(ss_ext_wholesale_cost) FROM filtered_store_sales JOIN store_cte ON s_store_sk = ss_store_sk JOIN customer_demographics_cte ON cd_demo_sk = ss_cdemo_sk JOIN household_demographics_cte ON hd_demo_sk = ss_hdemo_sk JOIN customer_address_cte ON ca_address_sk = ss_addr_sk JOIN date_dim_cte ON d_date_sk = ss_sold_date_sk;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre\u2011filter all dimension tables (store, customer_demographics, household_demographics, customer_address, date_dim) into CTEs containing only surrogate keys and needed attributes, then join with store_sales."
    },
    {
      "patch_id": "p10",
      "family": "F",
      "transform": "inner_join_conversion",
      "relevance_score": 0.5,
      "status": "WIN",
      "speedup": 1.11,
      "semantic_passed": true,
      "error": null,
      "original_ms": 174.4,
      "patch_ms": 157.2,
      "output_sql": "SELECT AVG(ss_quantity), AVG(ss_ext_sales_price), AVG(ss_ext_wholesale_cost), SUM(ss_ext_wholesale_cost) FROM store_sales INNER JOIN store ON s_store_sk = ss_store_sk INNER JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk INNER JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk INNER JOIN customer_address ON ss_addr_sk = ca_address_sk INNER JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2001 AND ((cd_marital_status = 'M' AND cd_education_status = '2 yr Degree' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3) OR (cd_marital_status = 'S' AND cd_education_status = 'Primary' AND ss_sales_price BETWEEN 50.00 AND 100.00 AND hd_dep_count = 1) OR (cd_marital_status = 'W' AND cd_education_status = 'Primary' AND ss_sales_price BETWEEN 150.00 AND 200.00 AND hd_dep_count = 1)) AND ((ca_country = 'United States' AND ca_state IN ('GA', 'KY', 'SD') AND ss_net_profit BETWEEN 100 AND 200) OR (ca_country = 'United States' AND ca_state IN ('AR', 'IN', 'VA') AND ss_net_profit BETWEEN 150 AND 300) OR (ca_country = 'United States' AND ca_state IN ('KS', 'OH', 'SD') AND ss_net_profit BETWEEN 50 AND 250));",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Convert comma\u2011separated joins to explicit INNER JOIN .. ON syntax, preserving all existing predicates."
    },
    {
      "patch_id": "p06",
      "family": "A",
      "transform": "sf_sk_pushdown_union_all",
      "relevance_score": 0.7,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": false,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select avg(ss_quantity)\n,avg(ss_ext_sales_price)\n,avg(ss_ext_wholesale_cost)\n,sum(ss_ext_wholesale_cost)\nfrom store_sales\n   ,store\n   ,customer_demographics\n   ,household_demographics\n   ,customer_address\n   ,date_dim\nwhere s_store_sk = ss_store_sk\nand  ss_sold_date_sk = d_date_sk and d_year = 2001\nand((ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'M'\nand cd_education_status = '2 yr Degree'\nand ss_sales_price between 100.00 and 150.00\nand hd_dep_count = 3\n   )or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'S'\nand cd_education_status = 'Primary'\nand ss_sales_price between 50.00 and 100.00\nand hd_dep_count = 1\n   ) or\n   (ss_hdemo_sk=hd_demo_sk\nand cd_demo_sk = ss_cdemo_sk\nand cd_marital_status = 'W'\nand cd_education_status = 'Primary'\nand ss_sales_price between 150.00 and 200.00\nand hd_dep_count = 1\n   ))\nand((ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('GA', 'KY', 'SD')\nand ss_net_profit between 100 and 200\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('AR', 'IN', 'VA')\nand ss_net_profit between 150 and 300\n   ) or\n   (ss_addr_sk = ca_address_sk\nand ca_country = 'United States'\nand ca_state in ('KS', 'OH', 'SD')\nand ss_net_profit between 50 and 250\n   ));",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] If OR conditions are split into UNION ALL branches (as in p02), push the date_sk range derived from d_year=2001 into each branch\u2019s fact scan."
    },
    {
      "patch_id": "p11",
      "family": "E",
      "transform": "materialize_cte",
      "relevance_score": 0.45,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_store_sales AS (WITH filtered_store_sales AS (SELECT * FROM store_sales WHERE ss_sales_price BETWEEN 50 AND 200 AND ss_net_profit BETWEEN 50 AND 300) SELECT * FROM filtered_store_sales) SELECT avg(ss_quantity), avg(ss_ext_sales_price), avg(ss_ext_wholesale_cost), sum(ss_ext_wholesale_cost) FROM filtered_store_sales ss, store s, customer_demographics cd, household_demographics hd, customer_address ca, date_dim d WHERE s_store_sk = ss_store_sk AND ss_sold_date_sk = d_date_sk AND d_year = 2001 AND ((ss_hdemo_sk=hd_demo_sk AND cd_demo_sk = ss_cdemo_sk AND cd_marital_status = 'M' AND cd_education_status = '2 yr Degree' AND ss_sales_price between 100.00 and 150.00 AND hd_dep_count = 3) OR (ss_hdemo_sk=hd_demo_sk AND cd_demo_sk = ss_cdemo_sk AND cd_marital_status = 'S' AND cd_education_status = 'Primary' AND ss_sales_price between 50.00 and 100.00 AND hd_dep_count = 1) OR (ss_hdemo_sk=hd_demo_sk AND cd_demo_sk = ss_cdemo_sk AND cd_marital_status = 'W' AND cd_education_status = 'Primary' AND ss_sales_price between 150.00 and 200.00 AND hd_dep_count = 1)) AND ((ss_addr_sk = ca_address_sk AND ca_country = 'United States' AND ca_state in ('GA', 'KY', 'SD') AND ss_net_profit between 100 and 200) OR (ss_addr_sk = ca_address_sk AND ca_country = 'United States' AND ca_state in ('AR', 'IN', 'VA') AND ss_net_profit between 150 and 300) OR (ss_addr_sk = ca_address_sk AND ca_country = 'United States' AND ca_state in ('KS', 'OH', 'SD') AND ss_net_profit between 50 and 250));",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Materialize the filtered store_sales scan (with date pushdown if present) into a CTE to avoid repeated scanning in the aggregation stack."
    }
  ],
  "explains": {
    "p12": "GlobalStats | 72978 | 70672 | 1213414464512\n1 | 0 | Result | SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*))))))), COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))) / (COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_WHOLESALE_COST, COUNT(",
    "p03": "GlobalStats | 72978 | 70672 | 1213414464512\n1 | 0 | Result | SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*))))))), COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))) / (COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_WHOLESALE_COST, COUNT(",
    "p09": "GlobalStats | 72978 | 70672 | 1213414464512\n1 | 0 | Result | SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(SS.SS_QUANTITY, COUNT(*))))))), COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(SS.SS_QUANTITY, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(SS.SS_EXT_SALES_PRICE, COUNT(*)))))))) / (COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(SS.SS_EXT_SALES_PRICE, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(SS.SS_EXT_WHOLESALE_COST, COUNT(*)))))))) / (COUNT(COUNT(COUNT(COUNT(COUNT(CO",
    "p02": "GlobalStats | 72978 | 70672 | 1213414464512\n1 | 0 | Result | SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*))))))), COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))) / (COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_WHOLESALE_COST, COUNT(",
    "p07": "GlobalStats | 72978 | 70672 | 1213414464512\n1 | 0 | Result | SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*))))))), COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))) / (COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_WHOLESALE_COST, COUNT(",
    "p08": "GlobalStats | 72978 | 70672 | 1213414464512\n1 | 0 | Result | SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*))))))), COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))) / (COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_WHOLESALE_COST, COUNT(",
    "p10": "GlobalStats | 72978 | 70672 | 1213414464512\n1 | 0 | Result | SCALED_ROUND_INT_DIVIDE(SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*))))))), COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_QUANTITY, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))) / (COUNT(COUNT(COUNT(COUNT(COUNT(COUNT_INTERNAL(STORE_SALES.SS_EXT_SALES_PRICE, COUNT(*)))))))), (SUM(SUM(SUM(SUM(SUM(SUM_INTERNAL(STORE_SALES.SS_EXT_WHOLESALE_COST, COUNT("
  }
}