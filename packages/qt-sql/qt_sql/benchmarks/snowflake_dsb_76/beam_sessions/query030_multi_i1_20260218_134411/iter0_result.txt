{
  "iteration": 0,
  "n_api_calls": 6,
  "beam_cost_usd": 0.0,
  "beam_cost_priced_calls": 0,
  "beam_cost_unpriced_calls": 6,
  "beam_token_totals": {
    "prompt_tokens": 0,
    "completion_tokens": 0,
    "total_tokens": 0,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 0,
    "reasoning_tokens": 0
  },
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "p12",
      "family": "A",
      "transform": "dimension_cte_isolate",
      "relevance_score": 0.45,
      "status": "REGRESSION",
      "speedup": 0.86,
      "semantic_passed": true,
      "error": null,
      "original_ms": 210.6,
      "patch_ms": 245.8,
      "output_sql": "WITH customer_total_return AS (WITH date_dim_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999), item_filtered AS (SELECT i_item_sk FROM item WHERE i_manager_id BETWEEN 42 AND 51) SELECT wr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, wr_reason_sk AS ctr_reason_sk, SUM(wr_return_amt) AS ctr_total_return FROM web_returns JOIN date_dim_filtered ON wr_returned_date_sk = d_date_sk JOIN customer_address ON wr_returning_addr_sk = ca_address_sk JOIN item_filtered ON wr_item_sk = i_item_sk WHERE wr_return_amt / wr_return_quantity BETWEEN 193 AND 222 GROUP BY wr_returning_customer_sk, ca_state, wr_reason_sk) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date, ctr_total_return FROM customer_total_return AS ctr1, customer_address, customer WHERE ctr1.ctr_total_return > (SELECT AVG(ctr_total_return) * 1.2 FROM customer_total_return AS ctr2 WHERE ctr1.ctr_state = ctr2.ctr_state) AND ca_address_sk = c_current_addr_sk AND ca_state IN ('CA', 'MI', 'SD', 'VA') AND ctr1.ctr_customer_sk = c_customer_sk AND ctr1.ctr_reason_sk IN (22, 23) AND c_birth_year BETWEEN 1945 AND 1951 ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date, ctr_total_return LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Isolate small dimension filters (date_dim, item) into CTEs returning only surrogate keys before joining with web_returns."
    },
    {
      "patch_id": "p06",
      "family": "B",
      "transform": "sf_inline_decorrelate",
      "relevance_score": 0.65,
      "status": "REGRESSION",
      "speedup": 0.83,
      "semantic_passed": true,
      "error": null,
      "original_ms": 210.6,
      "patch_ms": 253.8,
      "output_sql": "WITH shared_scan AS (SELECT wr_returning_customer_sk AS ctr_customer_sk ,ca_state AS ctr_state ,wr_reason_sk AS ctr_reason_sk ,SUM(wr_return_amt) AS ctr_total_return FROM web_returns ,date_dim ,customer_address ,item WHERE wr_returned_date_sk = d_date_sk AND d_year =1999 AND wr_returning_addr_sk = ca_address_sk AND wr_item_sk = i_item_sk AND i_manager_id BETWEEN 42 and 51 AND wr_return_amt / wr_return_quantity between 193 and 222 GROUP BY wr_returning_customer_sk ,ca_state, wr_reason_sk), per_state_avg AS (SELECT ctr_state, AVG(ctr_total_return) * 1.2 AS avg_ctr_total_return FROM shared_scan GROUP BY ctr_state), filtered_main_query AS (SELECT s1.ctr_customer_sk, s1.ctr_state, s1.ctr_reason_sk, s1.ctr_total_return FROM shared_scan s1 JOIN per_state_avg s2 ON s1.ctr_state = s2.ctr_state WHERE s1.ctr_total_return > s2.avg_ctr_total_return) SELECT c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address ,c_last_review_date,ctr_total_return FROM filtered_main_query ctr1 ,customer_address ,customer WHERE ca_address_sk = c_current_addr_sk AND ca_state in ('CA', 'MI', 'SD', 'VA') AND ctr1.ctr_customer_sk = c_customer_sk AND ctr1.ctr_reason_sk in (22, 23) AND c_birth_year BETWEEN 1945 AND 1951 ORDER BY c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address ,c_last_review_date,ctr_total_return LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Alternative decorrelation: decompose into 3 CTEs (shared scan, per-key threshold, filtered main query) for correlated subquery."
    },
    {
      "patch_id": "p01",
      "family": "B",
      "transform": "sf_shared_scan_decorrelate",
      "relevance_score": 0.85,
      "status": "REGRESSION",
      "speedup": 0.76,
      "semantic_passed": true,
      "error": null,
      "original_ms": 210.6,
      "patch_ms": 275.9,
      "output_sql": "WITH customer_total_return AS (SELECT wr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, wr_reason_sk AS ctr_reason_sk, SUM(wr_return_amt) AS ctr_total_return FROM web_returns, date_dim, customer_address, item WHERE wr_returned_date_sk = d_date_sk AND d_year = 1999 AND wr_returning_addr_sk = ca_address_sk AND wr_item_sk = i_item_sk AND i_manager_id BETWEEN 42 AND 51 AND wr_return_amt / wr_return_quantity BETWEEN 193 AND 222 GROUP BY wr_returning_customer_sk, ca_state, wr_reason_sk), avg_state_return AS (select ctr_state, avg(ctr_total_return)*1.2 as threshold from customer_total_return group by ctr_state) select  c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag\n       ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address\n       ,c_last_review_date,ctr_total_return\n from customer_total_return ctr1\n     ,customer_address\n     ,customer\n     ,avg_state_return\n where ctr1.ctr_total_return > avg_state_return.threshold\n       and ca_address_sk = c_current_addr_sk\n       and ca_state in ('CA', 'MI', 'SD', 'VA')\n       and ctr1.ctr_customer_sk = c_customer_sk\n       and ctr1.ctr_reason_sk in (22, 23)\n       and avg_state_return.ctr_state = ctr1.ctr_state\n      and c_birth_year BETWEEN 1945 AND 1951\n order by c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag\n                  ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address\n                  ,c_last_review_date,ctr_total_return\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Decompose correlated scalar subquery into shared CTE for customer_total_return and separate CTE for per-state average threshold, then join in main query."
    },
    {
      "patch_id": "p03",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.6,
      "status": "REGRESSION",
      "speedup": 0.87,
      "semantic_passed": true,
      "error": null,
      "original_ms": 210.6,
      "patch_ms": 242.2,
      "output_sql": "WITH customer_total_return AS (WITH pre_agg_web_returns AS (\n  SELECT \n    wr_returning_customer_sk,\n    wr_reason_sk,\n    wr_returning_addr_sk,\n    wr_item_sk,\n    wr_returned_date_sk,\n    SUM(wr_return_amt) AS wr_return_amt_sum\n  FROM web_returns\n  WHERE (wr_return_amt / wr_return_quantity) BETWEEN 193 AND 222\n  GROUP BY \n    wr_returning_customer_sk,\n    wr_reason_sk,\n    wr_returning_addr_sk,\n    wr_item_sk,\n    wr_returned_date_sk\n)\nSELECT \n  wr.wr_returning_customer_sk AS ctr_customer_sk,\n  ca.ca_state AS ctr_state,\n  wr.wr_reason_sk AS ctr_reason_sk,\n  SUM(wr.wr_return_amt_sum) AS ctr_total_return\nFROM pre_agg_web_returns wr\nJOIN date_dim d ON wr.wr_returned_date_sk = d.d_date_sk\nJOIN customer_address ca ON wr.wr_returning_addr_sk = ca.ca_address_sk\nJOIN item i ON wr.wr_item_sk = i.i_item_sk\nWHERE d.d_year = 1999\n  AND i.i_manager_id BETWEEN 42 AND 51\nGROUP BY \n  wr.wr_returning_customer_sk,\n  ca.ca_state,\n  wr.wr_reason_sk) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date, ctr_total_return FROM customer_total_return AS ctr1, customer_address, customer WHERE ctr1.ctr_total_return > (SELECT AVG(ctr_total_return) * 1.2 FROM customer_total_return AS ctr2 WHERE ctr1.ctr_state = ctr2.ctr_state) AND ca_address_sk = c_current_addr_sk AND ca_state IN ('CA', 'MI', 'SD', 'VA') AND ctr1.ctr_customer_sk = c_customer_sk AND ctr1.ctr_reason_sk IN (22, 23) AND c_birth_year BETWEEN 1945 AND 1951 ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date, ctr_total_return LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-aggregate web_returns by wr_returning_customer_sk, wr_reason_sk, wr_returning_addr_sk, wr_item_sk, wr_returned_date_sk before joining with dimensions in CTE."
    },
    {
      "patch_id": "p08",
      "family": "F",
      "transform": "inner_join_conversion",
      "relevance_score": 0.4,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH customer_total_return AS (SELECT wr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, wr_reason_sk AS ctr_reason_sk, SUM(wr_return_amt) AS ctr_total_return FROM web_returns INNER JOIN date_dim ON wr_returned_date_sk = d_date_sk INNER JOIN customer_address ON wr_returning_addr_sk = ca_address_sk INNER JOIN item ON wr_item_sk = i_item_sk WHERE d_year = 1999 AND i_manager_id BETWEEN 42 AND 51 AND wr_return_amt / wr_return_quantity BETWEEN 193 AND 222 GROUP BY wr_returning_customer_sk, ca_state, wr_reason_sk) SELECT c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address,c_last_review_date,ctr_total_return FROM customer_total_return ctr1 INNER JOIN customer_address ON ctr1.ctr_state = customer_address.ca_state INNER JOIN customer ON ctr1.ctr_customer_sk = customer.c_customer_sk WHERE ctr1.ctr_total_return > (SELECT avg(ctr_total_return)*1.2 FROM customer_total_return ctr2 WHERE ctr1.ctr_state = ctr2.ctr_state) AND customer_address.ca_state IN ('CA', 'MI', 'SD', 'VA') AND ctr1.ctr_reason_sk IN (22, 23) AND customer.c_birth_year BETWEEN 1945 AND 1951 ORDER BY c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address,c_last_review_date,ctr_total_return LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Convert comma joins to explicit INNER JOIN syntax in CTE and main query for better join order flexibility."
    },
    {
      "patch_id": "p07",
      "family": "E",
      "transform": "materialize_cte",
      "relevance_score": 0.45,
      "status": "NEUTRAL",
      "speedup": 0.97,
      "semantic_passed": true,
      "error": null,
      "original_ms": 210.6,
      "patch_ms": 218.2,
      "output_sql": "WITH customer_total_return AS (SELECT wr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, wr_reason_sk AS ctr_reason_sk, SUM(wr_return_amt) AS ctr_total_return FROM web_returns, date_dim, customer_address, item WHERE wr_returned_date_sk = d_date_sk AND d_year = 1999 AND wr_returning_addr_sk = ca_address_sk AND wr_item_sk = i_item_sk AND i_manager_id BETWEEN 42 AND 51 AND wr_return_amt / wr_return_quantity BETWEEN 193 AND 222 GROUP BY wr_returning_customer_sk, ca_state, wr_reason_sk) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date, ctr_total_return FROM customer_total_return AS ctr1, customer_address, customer WHERE ctr1.ctr_total_return > (SELECT AVG(ctr_total_return) * 1.2 FROM customer_total_return AS ctr2 WHERE ctr1.ctr_state = ctr2.ctr_state) AND ca_address_sk = c_current_addr_sk AND ca_state IN ('CA', 'MI', 'SD', 'VA') AND ctr1.ctr_customer_sk = c_customer_sk AND ctr1.ctr_reason_sk IN (22, 23) AND c_birth_year BETWEEN 1945 AND 1951 ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date, ctr_total_return LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Materialize the customer_total_return CTE explicitly to ensure single computation and reuse in main query and subquery."
    },
    {
      "patch_id": "p02",
      "family": "A",
      "transform": "sf_sk_pushdown_multi_fact",
      "relevance_score": 0.75,
      "status": "REGRESSION",
      "speedup": 0.75,
      "semantic_passed": true,
      "error": null,
      "original_ms": 210.6,
      "patch_ms": 282.2,
      "output_sql": "WITH customer_total_return AS (SELECT wr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, wr_reason_sk AS ctr_reason_sk, SUM(wr_return_amt) AS ctr_total_return FROM web_returns, date_dim, customer_address, item WHERE wr_returned_date_sk = d_date_sk AND d_year = 1999 AND wr_returning_addr_sk = ca_address_sk AND wr_item_sk = i_item_sk AND i_manager_id BETWEEN 42 AND 51 AND wr_return_amt / wr_return_quantity BETWEEN 193 AND 222 AND wr_returned_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim WHERE d_year = 1999) AND (SELECT MAX(d_date_sk) FROM date_dim WHERE d_year = 1999) GROUP BY wr_returning_customer_sk, ca_state, wr_reason_sk) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date, ctr_total_return FROM customer_total_return AS ctr1, customer_address, customer WHERE ctr1.ctr_total_return > (SELECT AVG(ctr_total_return) * 1.2 FROM customer_total_return AS ctr2 WHERE ctr1.ctr_state = ctr2.ctr_state) AND ca_address_sk = c_current_addr_sk AND ca_state IN ('CA', 'MI', 'SD', 'VA') AND ctr1.ctr_customer_sk = c_customer_sk AND ctr1.ctr_reason_sk IN (22, 23) AND c_birth_year BETWEEN 1945 AND 1951 ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date, ctr_total_return LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Add explicit wr_returned_date_sk BETWEEN filter derived from d_year=1999 to WEB_RETURNS scan in CTE definition."
    },
    {
      "patch_id": "p10",
      "family": "A",
      "transform": "prefetch_fact_join",
      "relevance_score": 0.45,
      "status": "REGRESSION",
      "speedup": 0.73,
      "semantic_passed": true,
      "error": null,
      "original_ms": 210.6,
      "patch_ms": 289.4,
      "output_sql": "WITH filtered_web_returns AS (SELECT wr_returning_customer_sk, wr_returning_addr_sk, wr_item_sk, wr_reason_sk, wr_return_amt FROM web_returns JOIN date_dim ON wr_returned_date_sk = d_date_sk JOIN item ON wr_item_sk = i_item_sk WHERE d_year = 1999 AND i_manager_id BETWEEN 42 AND 51 AND wr_return_amt / wr_return_quantity BETWEEN 193 AND 222), customer_total_return AS (SELECT fwr.wr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, wr_reason_sk AS ctr_reason_sk, SUM(fwr.wr_return_amt) AS ctr_total_return FROM filtered_web_returns fwr JOIN customer_address ON fwr.wr_returning_addr_sk = ca_address_sk GROUP BY fwr.wr_returning_customer_sk, ca_state, wr_reason_sk) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date, ctr_total_return FROM customer_total_return AS ctr1, customer_address, customer WHERE ctr1.ctr_total_return > (SELECT AVG(ctr_total_return) * 1.2 FROM customer_total_return AS ctr2 WHERE ctr1.ctr_state = ctr2.ctr_state) AND ca_address_sk = c_current_addr_sk AND ca_state IN ('CA', 'MI', 'SD', 'VA') AND ctr1.ctr_customer_sk = c_customer_sk AND ctr1.ctr_reason_sk IN (22, 23) AND c_birth_year BETWEEN 1945 AND 1951 ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date, ctr_total_return LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Stage dimension filters into CTEs and progressively join with web_returns to reduce fact scan early."
    },
    {
      "patch_id": "p04",
      "family": "A",
      "transform": "early_filter",
      "relevance_score": 0.55,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre-filter customer_address for ca_state IN ('CA','MI','SD','VA') and customer for c_birth_year BETWEEN 1945 AND 1951 into CTEs before joining with customer_total_return in main query."
    },
    {
      "patch_id": "p09",
      "family": "C",
      "transform": "single_pass_aggregation",
      "relevance_score": 0.5,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": false,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH customer_total_return AS (SELECT wr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, wr_reason_sk AS ctr_reason_sk, SUM(wr_return_amt) AS ctr_total_return FROM web_returns, date_dim, customer_address, item WHERE wr_returned_date_sk = d_date_sk AND d_year = 1999 AND wr_returning_addr_sk = ca_address_sk AND wr_item_sk = i_item_sk AND i_manager_id BETWEEN 42 AND 51 AND wr_return_amt / wr_return_quantity BETWEEN 193 AND 222 GROUP BY wr_returning_customer_sk, ca_state, wr_reason_sk) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date, ctr_total_return FROM customer_total_return AS ctr1, customer_address, customer WHERE ctr1.ctr_total_return > (SELECT AVG(ctr_total_return) * 1.2 FROM customer_total_return AS ctr2 WHERE ctr1.ctr_state = ctr2.ctr_state) AND ca_address_sk = c_current_addr_sk AND ca_state IN ('CA', 'MI', 'SD', 'VA') AND ctr1.ctr_customer_sk = c_customer_sk AND ctr1.ctr_reason_sk IN (22, 23) AND c_birth_year BETWEEN 1945 AND 1951 ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date, ctr_total_return LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Consolidate multiple aggregate stages in CTE into single-pass aggregation using grouping sets if appropriate."
    },
    {
      "patch_id": "p05",
      "family": "A",
      "transform": "multi_dimension_prefetch",
      "relevance_score": 0.5,
      "status": "REGRESSION",
      "speedup": 0.84,
      "semantic_passed": true,
      "error": null,
      "original_ms": 210.6,
      "patch_ms": 252.2,
      "output_sql": "WITH prefetch_date_dim AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999), prefetch_item AS (SELECT i_item_sk, i_manager_id FROM item WHERE i_manager_id BETWEEN 42 AND 51), prefetch_customer_address AS (SELECT ca_address_sk, ca_state FROM customer_address), customer_total_return AS (SELECT wr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, wr_reason_sk AS ctr_reason_sk, SUM(wr_return_amt) AS ctr_total_return FROM web_returns JOIN prefetch_date_dim d ON wr_returned_date_sk = d.d_date_sk JOIN prefetch_customer_address ca ON wr_returning_addr_sk = ca.ca_address_sk JOIN prefetch_item i ON wr_item_sk = i.i_item_sk WHERE i_manager_id BETWEEN 42 AND 51 AND wr_return_amt / wr_return_quantity BETWEEN 193 AND 222 GROUP BY wr_returning_customer_sk, ca_state, wr_reason_sk) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date, ctr_total_return FROM customer_total_return AS ctr1, customer_address, customer WHERE ctr1.ctr_total_return > (SELECT AVG(ctr_total_return) * 1.2 FROM customer_total_return AS ctr2 WHERE ctr1.ctr_state = ctr2.ctr_state) AND ca_address_sk = c_current_addr_sk AND ca_state IN ('CA', 'MI', 'SD', 'VA') AND ctr1.ctr_customer_sk = c_customer_sk AND ctr1.ctr_reason_sk IN (22, 23) AND c_birth_year BETWEEN 1945 AND 1951 ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_day, c_birth_month, c_birth_year, c_birth_country, c_login, c_email_address, c_last_review_date, ctr_total_return LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Create CTEs for pre-filtered date_dim (d_year=1999), item (i_manager_id BETWEEN 42 and 51), and customer_address (for returning address) before joining with web_returns in CTE definition."
    },
    {
      "patch_id": "p11",
      "family": "B",
      "transform": "decorrelate",
      "relevance_score": 0.4,
      "status": "REGRESSION",
      "speedup": 0.79,
      "semantic_passed": true,
      "error": null,
      "original_ms": 210.6,
      "patch_ms": 266.3,
      "output_sql": "WITH customer_total_return AS (SELECT wr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, wr_reason_sk AS ctr_reason_sk, SUM(wr_return_amt) AS ctr_total_return FROM web_returns, date_dim, customer_address, item WHERE wr_returned_date_sk = d_date_sk AND d_year = 1999 AND wr_returning_addr_sk = ca_address_sk AND wr_item_sk = i_item_sk AND i_manager_id BETWEEN 42 AND 51 AND wr_return_amt / wr_return_quantity BETWEEN 193 AND 222 GROUP BY wr_returning_customer_sk, ca_state, wr_reason_sk), avg_by_state AS (SELECT ctr_state, AVG(ctr_total_return) AS avg_return FROM customer_total_return GROUP BY ctr_state) SELECT c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address ,c_last_review_date,ctr_total_return FROM customer_total_return ctr1 ,customer_address ,customer ,avg_by_state WHERE ctr1.ctr_total_return > avg_by_state.avg_return * 1.2 AND ca_address_sk = c_current_addr_sk AND ca_state in ('CA', 'MI', 'SD', 'VA') AND ctr1.ctr_customer_sk = c_customer_sk AND ctr1.ctr_reason_sk in (22, 23) AND c_birth_year BETWEEN 1945 AND 1951 AND ctr1.ctr_state = avg_by_state.ctr_state ORDER BY c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address ,c_last_review_date,ctr_total_return LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Portability candidate: decorrelate subquery by precomputing average by state in CTE and joining."
    }
  ],
  "explains": {
    "p12": "GlobalStats | 3065 | 3065 | 43056616448\n1 | 0 | Result | CUSTOMER.C_CUSTOMER_ID, CUSTOMER.C_SALUTATION, CUSTOMER.C_FIRST_NAME, CUSTOMER.C_LAST_NAME, CUSTOMER.C_PREFERRED_CUST_FLAG, CUSTOMER.C_BIRTH_DAY, CUSTOMER.C_BIRTH_MONTH, CUSTOMER.C_BIRTH_YEAR, CUSTOMER.C_BIRTH_COUNTRY, CUSTOMER.C_EMAIL_ADDRESS, CUSTOMER.C_LAST_REVIEW_DATE, CTR1.CTR_TOTAL_RETURN\n1 | 1 | [0] | SortWithLimit | sortKey: [CUSTOMER.C_CUSTOMER_ID ASC NULLS LAST, CUSTOMER.C_SALUTATION ASC NULLS LAST, CUSTOMER.C_FIRST_NAME ASC NULL",
    "p06": "GlobalStats | 3065 | 3065 | 43056616448\n1 | 0 | Result | CUSTOMER.C_CUSTOMER_ID, CUSTOMER.C_SALUTATION, CUSTOMER.C_FIRST_NAME, CUSTOMER.C_LAST_NAME, CUSTOMER.C_PREFERRED_CUST_FLAG, CUSTOMER.C_BIRTH_DAY, CUSTOMER.C_BIRTH_MONTH, CUSTOMER.C_BIRTH_YEAR, CUSTOMER.C_BIRTH_COUNTRY, CUSTOMER.C_EMAIL_ADDRESS, CUSTOMER.C_LAST_REVIEW_DATE, S1.CTR_TOTAL_RETURN\n1 | 1 | [0] | SortWithLimit | sortKey: [CUSTOMER.C_CUSTOMER_ID ASC NULLS LAST, CUSTOMER.C_SALUTATION ASC NULLS LAST, CUSTOMER.C_FIRST_NAME ASC NULLS ",
    "p01": "GlobalStats | 3065 | 3065 | 43056616448\n1 | 0 | Result | CUSTOMER.C_CUSTOMER_ID, CUSTOMER.C_SALUTATION, CUSTOMER.C_FIRST_NAME, CUSTOMER.C_LAST_NAME, CUSTOMER.C_PREFERRED_CUST_FLAG, CUSTOMER.C_BIRTH_DAY, CUSTOMER.C_BIRTH_MONTH, CUSTOMER.C_BIRTH_YEAR, CUSTOMER.C_BIRTH_COUNTRY, CUSTOMER.C_EMAIL_ADDRESS, CUSTOMER.C_LAST_REVIEW_DATE, CTR1.CTR_TOTAL_RETURN\n1 | 1 | [0] | SortWithLimit | sortKey: [CUSTOMER.C_CUSTOMER_ID ASC NULLS LAST, CUSTOMER.C_SALUTATION ASC NULLS LAST, CUSTOMER.C_FIRST_NAME ASC NULL",
    "p03": "GlobalStats | 3065 | 3002 | 41986293248\n1 | 0 | Result | CUSTOMER.C_CUSTOMER_ID, CUSTOMER.C_SALUTATION, CUSTOMER.C_FIRST_NAME, CUSTOMER.C_LAST_NAME, CUSTOMER.C_PREFERRED_CUST_FLAG, CUSTOMER.C_BIRTH_DAY, CUSTOMER.C_BIRTH_MONTH, CUSTOMER.C_BIRTH_YEAR, CUSTOMER.C_BIRTH_COUNTRY, CUSTOMER.C_EMAIL_ADDRESS, CUSTOMER.C_LAST_REVIEW_DATE, CTR1.CTR_TOTAL_RETURN\n1 | 1 | [0] | SortWithLimit | sortKey: [CUSTOMER.C_CUSTOMER_ID ASC NULLS LAST, CUSTOMER.C_SALUTATION ASC NULLS LAST, CUSTOMER.C_FIRST_NAME ASC NULL",
    "p07": "GlobalStats | 3065 | 3065 | 43056616448\n1 | 0 | Result | CUSTOMER.C_CUSTOMER_ID, CUSTOMER.C_SALUTATION, CUSTOMER.C_FIRST_NAME, CUSTOMER.C_LAST_NAME, CUSTOMER.C_PREFERRED_CUST_FLAG, CUSTOMER.C_BIRTH_DAY, CUSTOMER.C_BIRTH_MONTH, CUSTOMER.C_BIRTH_YEAR, CUSTOMER.C_BIRTH_COUNTRY, CUSTOMER.C_EMAIL_ADDRESS, CUSTOMER.C_LAST_REVIEW_DATE, CTR1.CTR_TOTAL_RETURN\n1 | 1 | [0] | SortWithLimit | sortKey: [CUSTOMER.C_CUSTOMER_ID ASC NULLS LAST, CUSTOMER.C_SALUTATION ASC NULLS LAST, CUSTOMER.C_FIRST_NAME ASC NULL",
    "p02": "GlobalStats | 3067 | 3004 | 41990570496\n1 | 0 | Result | MIN(DATE_DIM.D_DATE_SK)\n1 | 1 | [0] | Aggregate | aggExprs: [MIN(DATE_DIM.D_DATE_SK)]\n1 | 2 | [1] | Filter | DATE_DIM.D_YEAR = 1999\n1 | 3 | [2] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM | D_DATE_SK, D_YEAR | 1 | 1 | 2138624\n2 | 0 | Result | MAX(DATE_DIM.D_DATE_SK)\n2 | 1 | [0] | Aggregate | aggExprs: [MAX(DATE_DIM.D_DATE_SK)]\n2 | 2 | [1] | Filter | DATE_DIM.D_YEAR = 1999\n2 | 3 | [2] | TableScan | SNOWFLAKE_SAMPLE_DATA.TPCDS",
    "p10": "GlobalStats | 3065 | 3065 | 43056616448\n1 | 0 | Result | CUSTOMER.C_CUSTOMER_ID, CUSTOMER.C_SALUTATION, CUSTOMER.C_FIRST_NAME, CUSTOMER.C_LAST_NAME, CUSTOMER.C_PREFERRED_CUST_FLAG, CUSTOMER.C_BIRTH_DAY, CUSTOMER.C_BIRTH_MONTH, CUSTOMER.C_BIRTH_YEAR, CUSTOMER.C_BIRTH_COUNTRY, CUSTOMER.C_EMAIL_ADDRESS, CUSTOMER.C_LAST_REVIEW_DATE, CTR1.CTR_TOTAL_RETURN\n1 | 1 | [0] | SortWithLimit | sortKey: [CUSTOMER.C_CUSTOMER_ID ASC NULLS LAST, CUSTOMER.C_SALUTATION ASC NULLS LAST, CUSTOMER.C_FIRST_NAME ASC NULL",
    "p05": "GlobalStats | 3065 | 3065 | 43056616448\n1 | 0 | Result | CUSTOMER.C_CUSTOMER_ID, CUSTOMER.C_SALUTATION, CUSTOMER.C_FIRST_NAME, CUSTOMER.C_LAST_NAME, CUSTOMER.C_PREFERRED_CUST_FLAG, CUSTOMER.C_BIRTH_DAY, CUSTOMER.C_BIRTH_MONTH, CUSTOMER.C_BIRTH_YEAR, CUSTOMER.C_BIRTH_COUNTRY, CUSTOMER.C_EMAIL_ADDRESS, CUSTOMER.C_LAST_REVIEW_DATE, CTR1.CTR_TOTAL_RETURN\n1 | 1 | [0] | SortWithLimit | sortKey: [CUSTOMER.C_CUSTOMER_ID ASC NULLS LAST, CUSTOMER.C_SALUTATION ASC NULLS LAST, CUSTOMER.C_FIRST_NAME ASC NULL",
    "p11": "GlobalStats | 3065 | 3065 | 43056616448\n1 | 0 | Result | CUSTOMER.C_CUSTOMER_ID, CUSTOMER.C_SALUTATION, CUSTOMER.C_FIRST_NAME, CUSTOMER.C_LAST_NAME, CUSTOMER.C_PREFERRED_CUST_FLAG, CUSTOMER.C_BIRTH_DAY, CUSTOMER.C_BIRTH_MONTH, CUSTOMER.C_BIRTH_YEAR, CUSTOMER.C_BIRTH_COUNTRY, CUSTOMER.C_EMAIL_ADDRESS, CUSTOMER.C_LAST_REVIEW_DATE, CTR1.CTR_TOTAL_RETURN\n1 | 1 | [0] | SortWithLimit | sortKey: [CUSTOMER.C_CUSTOMER_ID ASC NULLS LAST, CUSTOMER.C_SALUTATION ASC NULLS LAST, CUSTOMER.C_FIRST_NAME ASC NULL"
  }
}