{
  "iteration": 0,
  "n_api_calls": 2,
  "beam_cost_usd": 0.0,
  "beam_cost_priced_calls": 0,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 0,
    "completion_tokens": 0,
    "total_tokens": 0,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 0,
    "reasoning_tokens": 0
  },
  "best_speedup": 1.34,
  "best_patch_id": "compile_p1",
  "best_sql": "WITH ss_agg AS (SELECT ca_county, d_year, SUM(CASE WHEN d_qoy = 1 THEN ss_ext_sales_price ELSE 0 END) AS store_sales_q1, SUM(CASE WHEN d_qoy = 2 THEN ss_ext_sales_price ELSE 0 END) AS store_sales_q2, SUM(CASE WHEN d_qoy = 3 THEN ss_ext_sales_price ELSE 0 END) AS store_sales_q3 FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN item ON ss_item_sk = i_item_sk WHERE i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ss_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA','IL') AND d_year = 1998 AND d_qoy IN (1,2,3) GROUP BY ca_county, d_year), ws_agg AS (SELECT ca_county, d_year, SUM(CASE WHEN d_qoy = 1 THEN ws_ext_sales_price ELSE 0 END) AS web_sales_q1, SUM(CASE WHEN d_qoy = 2 THEN ws_ext_sales_price ELSE 0 END) AS web_sales_q2, SUM(CASE WHEN d_qoy = 3 THEN ws_ext_sales_price ELSE 0 END) AS web_sales_q3 FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN customer_address ON ws_bill_addr_sk = ca_address_sk JOIN item ON ws_item_sk = i_item_sk WHERE i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ws_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA','IL') AND d_year = 1998 AND d_qoy IN (1,2,3) GROUP BY ca_county, d_year) SELECT ss.ca_county, ss.d_year, CASE WHEN ws.web_sales_q1 > 0 THEN ws.web_sales_q2 / ws.web_sales_q1 ELSE NULL END AS web_q1_q2_increase, CASE WHEN ss.store_sales_q1 > 0 THEN ss.store_sales_q2 / ss.store_sales_q1 ELSE NULL END AS store_q1_q2_increase, CASE WHEN ws.web_sales_q2 > 0 THEN ws.web_sales_q3 / ws.web_sales_q2 ELSE NULL END AS web_q2_q3_increase, CASE WHEN ss.store_sales_q2 > 0 THEN ss.store_sales_q3 / ss.store_sales_q2 ELSE NULL END AS store_q2_q3_increase FROM ss_agg ss JOIN ws_agg ws ON ss.ca_county = ws.ca_county AND ss.d_year = ws.d_year WHERE CASE WHEN ws.web_sales_q1 > 0 THEN ws.web_sales_q2 / ws.web_sales_q1 ELSE NULL END > CASE WHEN ss.store_sales_q1 > 0 THEN ss.store_sales_q2 / ss.store_sales_q1 ELSE NULL END AND CASE WHEN ws.web_sales_q2 > 0 THEN ws.web_sales_q3 / ws.web_sales_q2 ELSE NULL END > CASE WHEN ss.store_sales_q2 > 0 THEN ss.store_sales_q3 / ss.store_sales_q2 ELSE NULL END ORDER BY ss.d_year;",
  "patches": [
    {
      "patch_id": "p01",
      "family": "A",
      "transform": "sf_sk_pushdown_multi_fact",
      "relevance_score": 0.8,
      "status": "NEUTRAL",
      "speedup": 1.0,
      "semantic_passed": true,
      "error": null,
      "original_ms": 169.4,
      "patch_ms": 170.2,
      "output_sql": "WITH ss AS (select ca_county,d_qoy, d_year,sum(ss_ext_sales_price) as store_sales from store_sales,date_dim,customer_address, item where ss_sold_date_sk = d_date_sk and ss_addr_sk=ca_address_sk and ss_item_sk = i_item_sk and i_color IN ('navajo', 'orchid') and i_manager_id BETWEEN 8 and 27 and ss_list_price between 86 and 100 and ca_state in ('IA','IL') and d_year = 1998 and d_qoy IN (1,2,3) and ss_sold_date_sk between 2450815 and 2451179 group by ca_county,d_qoy, d_year), ws AS (select ca_county,d_qoy, d_year,sum(ws_ext_sales_price) as web_sales from web_sales,date_dim,customer_address, item where ws_sold_date_sk = d_date_sk and ws_bill_addr_sk=ca_address_sk and ws_item_sk = i_item_sk and i_color IN ('navajo', 'orchid') and i_manager_id BETWEEN 8 and 27 and ws_list_price between 86 and 100 and ca_state in ('IA','IL') and d_year = 1998 and d_qoy IN (1,2,3) and ws_sold_date_sk between 2450815 and 2451179 group by ca_county,d_qoy, d_year) SELECT ss1.ca_county, ss1.d_year, ws2.web_sales / ws1.web_sales AS web_q1_q2_increase, ss2.store_sales / ss1.store_sales AS store_q1_q2_increase, ws3.web_sales / ws2.web_sales AS web_q2_q3_increase, ss3.store_sales / ss2.store_sales AS store_q2_q3_increase FROM ss AS ss1, ss AS ss2, ss AS ss3, ws AS ws1, ws AS ws2, ws AS ws3 WHERE ss1.d_qoy = 1 AND ss1.d_year = 1998 AND ss1.ca_county = ss2.ca_county AND ss2.d_qoy = 2 AND ss2.d_year = 1998 AND ss2.ca_county = ss3.ca_county AND ss3.d_qoy = 3 AND ss3.d_year = 1998 AND ss1.ca_county = ws1.ca_county AND ws1.d_qoy = 1 AND ws1.d_year = 1998 AND ws1.ca_county = ws2.ca_county AND ws2.d_qoy = 2 AND ws2.d_year = 1998 AND ws1.ca_county = ws3.ca_county AND ws3.d_qoy = 3 AND ws3.d_year = 1998 AND CASE WHEN ws1.web_sales > 0 THEN ws2.web_sales / ws1.web_sales ELSE NULL END > CASE WHEN ss1.store_sales > 0 THEN ss2.store_sales / ss1.store_sales ELSE NULL END AND CASE WHEN ws2.web_sales > 0 THEN ws3.web_sales / ws2.web_sales ELSE NULL END > CASE WHEN ss2.store_sales > 0 THEN ss3.store_sales / ss2.store_sales ELSE NULL END ORDER BY ss1.d_year;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Add date_sk BETWEEN predicates to STORE_SALES and WEB_SALES scans based on d_year=1998 and d_qoy IN (1,2,3) to enable micro-partition pruning in CTEs ss and ws."
    },
    {
      "patch_id": "p02",
      "family": "C",
      "transform": "channel_bitmap_aggregation",
      "relevance_score": 0.7,
      "status": "REGRESSION",
      "speedup": 0.88,
      "semantic_passed": true,
      "error": null,
      "original_ms": 169.4,
      "patch_ms": 193.2,
      "output_sql": "WITH ss AS (SELECT ca_county, d_qoy, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales, date_dim, customer_address, item WHERE ss_sold_date_sk = d_date_sk AND ss_addr_sk = ca_address_sk AND ss_item_sk = i_item_sk AND i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ss_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA', 'IL') GROUP BY ca_county, d_qoy, d_year), ws AS (SELECT ca_county, d_qoy, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales, date_dim, customer_address, item WHERE ws_sold_date_sk = d_date_sk AND ws_bill_addr_sk = ca_address_sk AND ws_item_sk = i_item_sk AND i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ws_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA', 'IL') GROUP BY ca_county, d_qoy, d_year) SELECT ss1.ca_county, ss1.d_year, ws2.web_sales / ws1.web_sales AS web_q1_q2_increase, ss2.store_sales / ss1.store_sales AS store_q1_q2_increase, ws3.web_sales / ws2.web_sales AS web_q2_q3_increase, ss3.store_sales / ss2.store_sales AS store_q2_q3_increase FROM ss AS ss1, ss AS ss2, ss AS ss3, ws AS ws1, ws AS ws2, ws AS ws3 WHERE ss1.d_qoy = 1 AND ss1.d_year = 1998 AND ss1.ca_county = ss2.ca_county AND ss2.d_qoy = 2 AND ss2.d_year = 1998 AND ss2.ca_county = ss3.ca_county AND ss3.d_qoy = 3 AND ss3.d_year = 1998 AND ss1.ca_county = ws1.ca_county AND ws1.d_qoy = 1 AND ws1.d_year = 1998 AND ws1.ca_county = ws2.ca_county AND ws2.d_qoy = 2 AND ws2.d_year = 1998 AND ws1.ca_county = ws3.ca_county AND ws3.d_qoy = 3 AND ws3.d_year = 1998 AND CASE WHEN ws1.web_sales > 0 THEN ws2.web_sales / ws1.web_sales ELSE NULL END > CASE WHEN ss1.store_sales > 0 THEN ss2.store_sales / ss1.store_sales ELSE NULL END AND CASE WHEN ws2.web_sales > 0 THEN ws3.web_sales / ws2.web_sales ELSE NULL END > CASE WHEN ss2.store_sales > 0 THEN ss3.store_sales / ss2.store_sales ELSE NULL END ORDER BY ss1.d_year;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Consolidate multiple quarter scans of ss and ws CTEs into single scans using CASE WHEN expressions to compute store_sales and web_sales for d_qoy=1,2,3 in one pass per fact table."
    },
    {
      "patch_id": "p03",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.6,
      "status": "REGRESSION",
      "speedup": 0.85,
      "semantic_passed": true,
      "error": null,
      "original_ms": 169.4,
      "patch_ms": 199.4,
      "output_sql": "WITH ss_agg AS (SELECT ss_addr_sk, ss_item_sk, ss_sold_date_sk AS d_date_sk, ss_list_price, SUM(ss_ext_sales_price) AS ss_ext_sales_price FROM store_sales GROUP BY ss_addr_sk, ss_item_sk, ss_sold_date_sk, ss_list_price), ws_agg AS (SELECT ws_bill_addr_sk, ws_item_sk, ws_sold_date_sk AS d_date_sk, ws_list_price, SUM(ws_ext_sales_price) AS ws_ext_sales_price FROM web_sales GROUP BY ws_bill_addr_sk, ws_item_sk, ws_sold_date_sk, ws_list_price), ss AS (SELECT ca_county, d_qoy, d_year, SUM(ss_ext_sales_price) AS store_sales FROM ss_agg JOIN date_dim ON ss_agg.d_date_sk = date_dim.d_date_sk JOIN customer_address ON ss_agg.ss_addr_sk = customer_address.ca_address_sk JOIN item ON ss_agg.ss_item_sk = item.i_item_sk WHERE i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ss_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA','IL') GROUP BY ca_county, d_qoy, d_year), ws AS (SELECT ca_county, d_qoy, d_year, SUM(ws_ext_sales_price) AS web_sales FROM ws_agg JOIN date_dim ON ws_agg.d_date_sk = date_dim.d_date_sk JOIN customer_address ON ws_agg.ws_bill_addr_sk = customer_address.ca_address_sk JOIN item ON ws_agg.ws_item_sk = item.i_item_sk WHERE i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ws_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA','IL') GROUP BY ca_county, d_qoy, d_year) SELECT ss1.ca_county, ss1.d_year, ws2.web_sales / ws1.web_sales AS web_q1_q2_increase, ss2.store_sales / ss1.store_sales AS store_q1_q2_increase, ws3.web_sales / ws2.web_sales AS web_q2_q3_increase, ss3.store_sales / ss2.store_sales AS store_q2_q3_increase FROM ss AS ss1, ss AS ss2, ss AS ss3, ws AS ws1, ws AS ws2, ws AS ws3 WHERE ss1.d_qoy = 1 AND ss1.d_year = 1998 AND ss1.ca_county = ss2.ca_county AND ss2.d_qoy = 2 AND ss2.d_year = 1998 AND ss2.ca_county = ss3.ca_county AND ss3.d_qoy = 3 AND ss3.d_year = 1998 AND ss1.ca_county = ws1.ca_county AND ws1.d_qoy = 1 AND ws1.d_year = 1998 AND ws1.ca_county = ws2.ca_county AND ws2.d_qoy = 2 AND ws2.d_year = 1998 AND ws1.ca_county = ws3.ca_county AND ws3.d_qoy = 3 AND ws3.d_year = 1998 AND CASE WHEN ws1.web_sales > 0 THEN ws2.web_sales / ws1.web_sales ELSE NULL END > CASE WHEN ss1.store_sales > 0 THEN ss2.store_sales / ss1.store_sales ELSE NULL END AND CASE WHEN ws2.web_sales > 0 THEN ws3.web_sales / ws2.web_sales ELSE NULL END > CASE WHEN ss2.store_sales > 0 THEN ss3.store_sales / ss2.store_sales ELSE NULL END ORDER BY ss1.d_year;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-aggregate STORE_SALES and WEB_SALES by ca_address_sk and d_date_sk before joining with customer_address and date_dim in CTEs ss and ws to reduce row volume early."
    },
    {
      "patch_id": "p04",
      "family": "F",
      "transform": "self_join_decomposition",
      "relevance_score": 0.5,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: 002003 (42S02): 01c27ccc-3205-67d4-0002-fcfe00024e0a: SQL compilation error:\nObject 'SS' does not exist or not authorized.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH ss_q1 AS (SELECT ca_county, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales, date_dim, customer_address, item WHERE ss_sold_date_sk = d_date_sk AND ss_addr_sk = ca_address_sk AND ss_item_sk = i_item_sk AND i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ss_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA', 'IL') AND d_qoy = 1 AND d_year = 1998 GROUP BY ca_county, d_year), ss_q2 AS (SELECT ca_county, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales, date_dim, customer_address, item WHERE ss_sold_date_sk = d_date_sk AND ss_addr_sk = ca_address_sk AND ss_item_sk = i_item_sk AND i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ss_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA', 'IL') AND d_qoy = 2 AND d_year = 1998 GROUP BY ca_county, d_year), ss_q3 AS (SELECT ca_county, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales, date_dim, customer_address, item WHERE ss_sold_date_sk = d_date_sk AND ss_addr_sk = ca_address_sk AND ss_item_sk = i_item_sk AND i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ss_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA', 'IL') AND d_qoy = 3 AND d_year = 1998 GROUP BY ca_county, d_year), ws_q1 AS (SELECT ca_county, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales, date_dim, customer_address, item WHERE ws_sold_date_sk = d_date_sk AND ws_bill_addr_sk = ca_address_sk AND ws_item_sk = i_item_sk AND i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ws_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA', 'IL') AND d_qoy = 1 AND d_year = 1998 GROUP BY ca_county, d_year), ws_q2 AS (SELECT ca_county, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales, date_dim, customer_address, item WHERE ws_sold_date_sk = d_date_sk AND ws_bill_addr_sk = ca_address_sk AND ws_item_sk = i_item_sk AND i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ws_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA', 'IL') AND d_qoy = 2 AND d_year = 1998 GROUP BY ca_county, d_year), ws_q3 AS (SELECT ca_county, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales, date_dim, customer_address, item WHERE ws_sold_date_sk = d_date_sk AND ws_bill_addr_sk = ca_address_sk AND ws_item_sk = i_item_sk AND i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ws_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA', 'IL') AND d_qoy = 3 AND d_year = 1998 GROUP BY ca_county, d_year) SELECT ss1.ca_county, ss1.d_year, ws2.web_sales / ws1.web_sales AS web_q1_q2_increase, ss2.store_sales / ss1.store_sales AS store_q1_q2_increase, ws3.web_sales / ws2.web_sales AS web_q2_q3_increase, ss3.store_sales / ss2.store_sales AS store_q2_q3_increase FROM ss AS ss1, ss AS ss2, ss AS ss3, ws AS ws1, ws AS ws2, ws AS ws3 WHERE ss1.d_qoy = 1 AND ss1.d_year = 1998 AND ss1.ca_county = ss2.ca_county AND ss2.d_qoy = 2 AND ss2.d_year = 1998 AND ss2.ca_county = ss3.ca_county AND ss3.d_qoy = 3 AND ss3.d_year = 1998 AND ss1.ca_county = ws1.ca_county AND ws1.d_qoy = 1 AND ws1.d_year = 1998 AND ws1.ca_county = ws2.ca_county AND ws2.d_qoy = 2 AND ws2.d_year = 1998 AND ws1.ca_county = ws3.ca_county AND ws3.d_qoy = 3 AND ws3.d_year = 1998 AND CASE WHEN ws1.web_sales > 0 THEN ws2.web_sales / ws1.web_sales ELSE NULL END > CASE WHEN ss1.store_sales > 0 THEN ss2.store_sales / ss1.store_sales ELSE NULL END AND CASE WHEN ws2.web_sales > 0 THEN ws3.web_sales / ws2.web_sales ELSE NULL END > CASE WHEN ss2.store_sales > 0 THEN ss3.store_sales / ss2.store_sales ELSE NULL END ORDER BY ss1.d_year;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Split CTEs ss and ws into separate CTEs for each d_qoy value (1,2,3) to embed filters and avoid self-joins in the final select."
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 1.34,
      "semantic_passed": true,
      "error": null,
      "original_ms": 217.2,
      "patch_ms": 162.2,
      "output_sql": "WITH ss_agg AS (SELECT ca_county, d_year, SUM(CASE WHEN d_qoy = 1 THEN ss_ext_sales_price ELSE 0 END) AS store_sales_q1, SUM(CASE WHEN d_qoy = 2 THEN ss_ext_sales_price ELSE 0 END) AS store_sales_q2, SUM(CASE WHEN d_qoy = 3 THEN ss_ext_sales_price ELSE 0 END) AS store_sales_q3 FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN item ON ss_item_sk = i_item_sk WHERE i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ss_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA','IL') AND d_year = 1998 AND d_qoy IN (1,2,3) GROUP BY ca_county, d_year), ws_agg AS (SELECT ca_county, d_year, SUM(CASE WHEN d_qoy = 1 THEN ws_ext_sales_price ELSE 0 END) AS web_sales_q1, SUM(CASE WHEN d_qoy = 2 THEN ws_ext_sales_price ELSE 0 END) AS web_sales_q2, SUM(CASE WHEN d_qoy = 3 THEN ws_ext_sales_price ELSE 0 END) AS web_sales_q3 FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN customer_address ON ws_bill_addr_sk = ca_address_sk JOIN item ON ws_item_sk = i_item_sk WHERE i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ws_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA','IL') AND d_year = 1998 AND d_qoy IN (1,2,3) GROUP BY ca_county, d_year) SELECT ss.ca_county, ss.d_year, CASE WHEN ws.web_sales_q1 > 0 THEN ws.web_sales_q2 / ws.web_sales_q1 ELSE NULL END AS web_q1_q2_increase, CASE WHEN ss.store_sales_q1 > 0 THEN ss.store_sales_q2 / ss.store_sales_q1 ELSE NULL END AS store_q1_q2_increase, CASE WHEN ws.web_sales_q2 > 0 THEN ws.web_sales_q3 / ws.web_sales_q2 ELSE NULL END AS web_q2_q3_increase, CASE WHEN ss.store_sales_q2 > 0 THEN ss.store_sales_q3 / ss.store_sales_q2 ELSE NULL END AS store_q2_q3_increase FROM ss_agg ss JOIN ws_agg ws ON ss.ca_county = ws.ca_county AND ss.d_year = ws.d_year WHERE CASE WHEN ws.web_sales_q1 > 0 THEN ws.web_sales_q2 / ws.web_sales_q1 ELSE NULL END > CASE WHEN ss.store_sales_q1 > 0 THEN ss.store_sales_q2 / ss.store_sales_q1 ELSE NULL END AND CASE WHEN ws.web_sales_q2 > 0 THEN ws.web_sales_q3 / ws.web_sales_q2 ELSE NULL END > CASE WHEN ss.store_sales_q2 > 0 THEN ss.store_sales_q3 / ss.store_sales_q2 ELSE NULL END ORDER BY ss.d_year;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_pivot",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 1.3,
      "semantic_passed": true,
      "error": null,
      "original_ms": 217.2,
      "patch_ms": 166.5,
      "output_sql": "WITH ss_pivot AS (SELECT ca_county, d_year, SUM(CASE WHEN d_qoy = 1 THEN ss_ext_sales_price ELSE 0 END) AS store_sales_q1, SUM(CASE WHEN d_qoy = 2 THEN ss_ext_sales_price ELSE 0 END) AS store_sales_q2, SUM(CASE WHEN d_qoy = 3 THEN ss_ext_sales_price ELSE 0 END) AS store_sales_q3 FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN item ON ss_item_sk = i_item_sk WHERE i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ss_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA','IL') AND d_year = 1998 AND d_qoy IN (1,2,3) GROUP BY ca_county, d_year), ws_pivot AS (SELECT ca_county, d_year, SUM(CASE WHEN d_qoy = 1 THEN ws_ext_sales_price ELSE 0 END) AS web_sales_q1, SUM(CASE WHEN d_qoy = 2 THEN ws_ext_sales_price ELSE 0 END) AS web_sales_q2, SUM(CASE WHEN d_qoy = 3 THEN ws_ext_sales_price ELSE 0 END) AS web_sales_q3 FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN customer_address ON ws_bill_addr_sk = ca_address_sk JOIN item ON ws_item_sk = i_item_sk WHERE i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ws_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA','IL') AND d_year = 1998 AND d_qoy IN (1,2,3) GROUP BY ca_county, d_year) SELECT ss_pivot.ca_county, ss_pivot.d_year, CASE WHEN ws_pivot.web_sales_q1 > 0 THEN ws_pivot.web_sales_q2 / ws_pivot.web_sales_q1 ELSE NULL END AS web_q1_q2_increase, CASE WHEN ss_pivot.store_sales_q1 > 0 THEN ss_pivot.store_sales_q2 / ss_pivot.store_sales_q1 ELSE NULL END AS store_q1_q2_increase, CASE WHEN ws_pivot.web_sales_q2 > 0 THEN ws_pivot.web_sales_q3 / ws_pivot.web_sales_q2 ELSE NULL END AS web_q2_q3_increase, CASE WHEN ss_pivot.store_sales_q2 > 0 THEN ss_pivot.store_sales_q3 / ss_pivot.store_sales_q2 ELSE NULL END AS store_q2_q3_increase FROM ss_pivot JOIN ws_pivot ON ss_pivot.ca_county = ws_pivot.ca_county AND ss_pivot.d_year = ws_pivot.d_year WHERE CASE WHEN ws_pivot.web_sales_q1 > 0 THEN ws_pivot.web_sales_q2 / ws_pivot.web_sales_q1 ELSE NULL END > CASE WHEN ss_pivot.store_sales_q1 > 0 THEN ss_pivot.store_sales_q2 / ss_pivot.store_sales_q1 ELSE NULL END AND CASE WHEN ws_pivot.web_sales_q2 > 0 THEN ws_pivot.web_sales_q3 / ws_pivot.web_sales_q2 ELSE NULL END > CASE WHEN ss_pivot.store_sales_q2 > 0 THEN ss_pivot.store_sales_q3 / ss_pivot.store_sales_q2 ELSE NULL END ORDER BY ss_pivot.d_year;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p01": "GlobalStats | 100815 | 19898 | 332672101888\n1 | 0 | Result | SS1.CA_COUNTY, SS1.D_YEAR, (WS2.WEB_SALES) / (WS1.WEB_SALES), (SS2.STORE_SALES) / (SS1.STORE_SALES), (WS3.WEB_SALES) / (WS2.WEB_SALES), (SS3.STORE_SALES) / (SS2.STORE_SALES)\n1 | 1 | [0] | Sort | SS1.D_YEAR ASC NULLS LAST\n1 | 2 | [1] | InnerJoin | joinKey: (SS3.CA_COUNTY = SS2.CA_COUNTY), joinFilter: (CASE_FLATTENED(WS2.WEB_SALES > 0, (WS3.WEB_SALES) / (WS2.WEB_SALES), null)) > (CASE_FLATTENED(SS2.STORE_SALES > 0, (SS3.STORE_SALES) / (S",
    "p02": "GlobalStats | 100815 | 98504 | 1675189827072\n1 | 0 | Result | SS1.CA_COUNTY, SS1.D_YEAR, (WS2.WEB_SALES) / (WS1.WEB_SALES), (SS2.STORE_SALES) / (SS1.STORE_SALES), (WS3.WEB_SALES) / (WS2.WEB_SALES), (SS3.STORE_SALES) / (SS2.STORE_SALES)\n1 | 1 | [0] | Sort | SS1.D_YEAR ASC NULLS LAST\n1 | 2 | [1] | InnerJoin | joinKey: (WS1.CA_COUNTY = SS1.CA_COUNTY), joinFilter: (CASE_FLATTENED(WS1.WEB_SALES > 0, (WS2.WEB_SALES) / (WS1.WEB_SALES), null)) > (CASE_FLATTENED(SS1.STORE_SALES > 0, (SS2.STORE_SALES) / (",
    "p03": "GlobalStats | 100815 | 98504 | 1675189827072\n1 | 0 | Result | SS1.CA_COUNTY, SS1.D_YEAR, SCALED_ROUND_INT_DIVIDE(WS2.WEB_SALES, WS1.WEB_SALES), SCALED_ROUND_INT_DIVIDE(SS2.STORE_SALES, SS1.STORE_SALES), SCALED_ROUND_INT_DIVIDE(WS3.WEB_SALES, WS2.WEB_SALES), SCALED_ROUND_INT_DIVIDE(SS3.STORE_SALES, SS2.STORE_SALES)\n1 | 1 | [0] | Sort | SS1.D_YEAR ASC NULLS LAST\n1 | 2 | [1] | InnerJoin | joinKey: (WS1.CA_COUNTY = SS1.CA_COUNTY), joinFilter: (CASE_FLATTENED(WS1.WEB_SALES > 0, SCALED_ROUND_INT_DIVID",
    "compile_p1": "GlobalStats | 100815 | 98504 | 1675189827072\n1 | 0 | Result | CUSTOMER_ADDRESS.CA_COUNTY, DATE_DIM.D_YEAR, CASE_FLATTENED((SUM(CASE_FLATTENED(DATE_DIM.D_QOY = 1, WEB_SALES.WS_EXT_SALES_PRICE, 0))) > 0, (SUM(CASE_FLATTENED(DATE_DIM.D_QOY = 2, WEB_SALES.WS_EXT_SALES_PRICE, 0))) / (SUM(CASE_FLATTENED(DATE_DIM.D_QOY = 1, WEB_SALES.WS_EXT_SALES_PRICE, 0))), null), CASE_FLATTENED((SUM(CASE_FLATTENED(DATE_DIM.D_QOY = 1, STORE_SALES.SS_EXT_SALES_PRICE, 0))) > 0, (SUM(CASE_FLATTENED(DATE_DIM.D_QOY = 2, S",
    "compile_pivot": "GlobalStats | 100815 | 98504 | 1675189827072\n1 | 0 | Result | CUSTOMER_ADDRESS.CA_COUNTY, DATE_DIM.D_YEAR, CASE_FLATTENED((SUM(CASE_FLATTENED(DATE_DIM.D_QOY = 1, WEB_SALES.WS_EXT_SALES_PRICE, 0))) > 0, (SUM(CASE_FLATTENED(DATE_DIM.D_QOY = 2, WEB_SALES.WS_EXT_SALES_PRICE, 0))) / (SUM(CASE_FLATTENED(DATE_DIM.D_QOY = 1, WEB_SALES.WS_EXT_SALES_PRICE, 0))), null), CASE_FLATTENED((SUM(CASE_FLATTENED(DATE_DIM.D_QOY = 1, STORE_SALES.SS_EXT_SALES_PRICE, 0))) > 0, (SUM(CASE_FLATTENED(DATE_DIM.D_QOY = 2, S"
  }
}