{
  "probe_id": "p12",
  "transform_id": "dimension_cte_isolate",
  "family": "A",
  "dialect": "snowflake",
  "hypothesis": "Isolating customer_demographics filtering into a CTE reduces its join size with customer, preserving all required filters and output semantics.",
  "reasoning_trace": [
    "Assigned transform targets early filtering of customer_demographics to reduce downstream join cost.",
    "Node contract requires cd_marital_status, cd_education_status, and cd_gender filters to be preserved exactly.",
    "Output column cd_demo_sk must remain available for join key propagation."
  ],
  "target_ir": "customer_demographics is pre-filtered into a small CTE; final_select joins to it as before.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "dag": {
    "order": ["customer_total_return", "filtered_cd", "final_select"],
    "final_node_id": "final_select",
    "nodes": [
      {
        "node_id": "customer_total_return",
        "deps": [],
        "outputs": ["ctr_customer_sk", "ctr_store_sk", "ctr_reason_sk", "ctr_total_return"],
        "changed": false
      },
      {
        "node_id": "filtered_cd",
        "deps": [],
        "outputs": ["cd_demo_sk"],
        "changed": true,
        "sql": "SELECT cd_demo_sk FROM customer_demographics WHERE cd_marital_status IN ('M') AND cd_education_status IN ('Advanced Degree', 'College') AND cd_gender = 'F'"
      },
      {
        "node_id": "final_select",
        "deps": ["customer_total_return", "store", "customer", "filtered_cd"],
        "outputs": ["c_customer_id"],
        "changed": false
      }
    ]
  }
}