{
  "probe_id": "scout_multi_dimension_prefetch",
  "transform_id": "multi_dimension_prefetch",
  "family": "A",
  "status": "success",
  "dialect": "snowflake",
  "hypothesis": "Pre-filtering selective dimensions (date_dim, item, customer, customer_address) into CTEs before joining with store_sales can reduce the fact table scan size via early pruning.",
  "reasoning_trace": [
    "Assigned transform targets prefetch of selective dimensions to reduce fact scan.",
    "All selective filters on dimensions are deterministic and safe to push into CTEs.",
    "No function wrapping on partition keys like ss_sold_date_sk â€” pruning is preserved.",
    "CTEs are single-use and inline naturally without materialization risk."
  ],
  "target_ir": "Introduce 4 CTEs for filtered dimensions; store_sales joins with them.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["filtered_date", "filtered_item", "filtered_customer", "filtered_ca", "store_sales", "store"],
        "outputs": ["brand_id", "brand", "i_manufact_id", "i_manufact", "ext_price"],
        "changed": true,
        "sql": "WITH filtered_date AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 2002 AND d_moy = 4\n),\nfiltered_item AS (\n  SELECT i_item_sk, i_brand_id, i_brand, i_manufact_id, i_manufact\n  FROM item\n  WHERE i_category = 'Jewelry'\n),\nfiltered_customer AS (\n  SELECT c_customer_sk, c_current_addr_sk\n  FROM customer\n  WHERE c_birth_month = 1\n),\nfiltered_ca AS (\n  SELECT ca_address_sk, ca_zip\n  FROM customer_address\n  WHERE ca_state = 'IL'\n)\nSELECT  i.i_brand_id AS brand_id, i.i_brand AS brand, i.i_manufact_id, i.i_manufact,\n        SUM(ss.ss_ext_sales_price) AS ext_price\nFROM store_sales ss\nJOIN filtered_date d ON ss.ss_sold_date_sk = d.d_date_sk\nJOIN filtered_item i ON ss.ss_item_sk = i.i_item_sk\nJOIN filtered_customer c ON ss.ss_customer_sk = c.c_customer_sk\nJOIN filtered_ca ca ON c.c_current_addr_sk = ca.ca_address_sk\nJOIN store s ON ss.ss_store_sk = s.s_store_sk\nWHERE ss.ss_wholesale_cost BETWEEN 35 AND 55\n  AND SUBSTRING(ca.ca_zip, 1, 5) <> SUBSTRING(s.s_zip, 1, 5)\nGROUP BY i.i_brand, i.i_brand_id, i.i_manufact_id, i.i_manufact\nORDER BY ext_price DESC, i.i_brand, i.i_brand_id, i.i_manufact_id, i.i_manufact\nLIMIT 100"
      }
    ]
  }
}