{
  "probe_id": "scout_early_filter",
  "transform_id": "early_filter",
  "family": "A",
  "status": "success",
  "dialect": "snowflake",
  "hypothesis": "Applying selective dimension filters (date, item, customer, customer_address, store) before joining with store_sales can reduce the size of the fact table scan via micro-partition pruning.",
  "reasoning_trace": [
    "Assigned transform targets moving filters earlier to enable pruning on STORE_SALES.",
    "All required filters are preserved and pushed into CTEs to allow early filtering.",
    "CTEs ensure each dimension is filtered once and reused, avoiding duplication.",
    "Final join order is preserved to maintain semantic equivalence."
  ],
  "target_ir": "Dimension tables are filtered early in CTEs; STORE_SALES joins last with all filters applied.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["filtered_store_sales", "item_filtered", "customer_filtered", "customer_address_filtered", "store_filtered", "date_filtered"],
        "outputs": ["brand_id", "brand", "i_manufact_id", "i_manufact", "ext_price"],
        "changed": true,
        "sql": "SELECT i_brand_id AS brand_id, i_brand AS brand, i_manufact_id, i_manufact, SUM(ss_ext_sales_price) AS ext_price FROM filtered_store_sales ss JOIN date_filtered d ON ss.ss_sold_date_sk = d.d_date_sk JOIN item_filtered i ON ss.ss_item_sk = i.i_item_sk JOIN customer_filtered c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address_filtered ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN store_filtered s ON ss.ss_store_sk = s.s_store_sk GROUP BY i_brand, i_brand_id, i_manufact_id, i_manufact ORDER BY ext_price DESC, i_brand, i_brand_id, i_manufact_id, i_manufact LIMIT 100"
      },
      {
        "node_id": "date_filtered",
        "parent_node_id": "final_select",
        "sources": ["date_dim"],
        "outputs": ["d_date_sk", "d_year", "d_moy"],
        "changed": true,
        "sql": "SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE d_year = 2002 AND d_moy = 4"
      },
      {
        "node_id": "item_filtered",
        "parent_node_id": "final_select",
        "sources": ["item"],
        "outputs": ["i_item_sk", "i_brand_id", "i_brand", "i_manufact_id", "i_manufact"],
        "changed": true,
        "sql": "SELECT i_item_sk, i_brand_id, i_brand, i_manufact_id, i_manufact FROM item WHERE i_category = 'Jewelry'"
      },
      {
        "node_id": "customer_filtered",
        "parent_node_id": "final_select",
        "sources": ["customer"],
        "outputs": ["c_customer_sk", "c_current_addr_sk", "c_birth_month"],
        "changed": true,
        "sql": "SELECT c_customer_sk, c_current_addr_sk, c_birth_month FROM customer WHERE c_birth_month = 1"
      },
      {
        "node_id": "customer_address_filtered",
        "parent_node_id": "final_select",
        "sources": ["customer_address"],
        "outputs": ["ca_address_sk", "ca_state", "ca_zip"],
        "changed": true,
        "sql": "SELECT ca_address_sk, ca_state, ca_zip FROM customer_address WHERE ca_state = 'IL'"
      },
      {
        "node_id": "store_filtered",
        "parent_node_id": "final_select",
        "sources": ["store"],
        "outputs": ["s_store_sk", "s_zip"],
        "changed": true,
        "sql": "SELECT s_store_sk, s_zip FROM store"
      },
      {
        "node_id": "filtered_store_sales",
        "parent_node_id": "final_select",
        "sources": ["store_sales"],
        "outputs": ["ss_sold_date_sk", "ss_item_sk", "ss_customer_sk", "ss_store_sk", "ss_wholesale_cost", "ss_ext_sales_price"],
        "changed": true,
        "sql": "SELECT ss_sold_date_sk, ss_item_sk, ss_customer_sk, ss_store_sk, ss_wholesale_cost, ss_ext_sales_price FROM store_sales WHERE ss_wholesale_cost BETWEEN 35 AND 55"
      }
    ]
  }
}