```json
[
  {
    "plan_id": "compile_p1",
    "dialect": "snowflake",
    "confidence": 0.75,
    "based_on": "p01,p03",
    "strategy": "Decorrelate scalar aggregate subquery by pre-computing per-store average threshold in separate CTE.",
    "hypothesis": "Probes p01 and p03 attempted decorrelation but had semantic issues. This safe rewrite computes store averages from the same CTE, preserving correlation semantics while removing repeated per-store re-aggregation.",
    "expected_explain_delta": "Correlated subquery join (node 1.7) and aggregate (node 1.9) replaced with single aggregate CTE and regular join.",
    "target_ir": "Add store_averages CTE and update final_select to join with it instead of correlated subquery.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["customer_total_return", "store_averages", "store", "customer", "customer_demographics"],
          "outputs": ["c_customer_id"],
          "changed": true,
          "sql": "SELECT c_customer_id FROM customer_total_return ctr1 JOIN store_averages sa ON ctr1.ctr_store_sk = sa.ctr_store_sk AND ctr1.ctr_total_return > sa.avg_ctr_total_return, store, customer, customer_demographics WHERE ctr1.ctr_reason_sk BETWEEN 43 AND 46 AND s_store_sk = ctr1.ctr_store_sk AND s_state IN ('IL', 'KY', 'TX') AND ctr1.ctr_customer_sk = c_customer_sk AND c_current_cdemo_sk = cd_demo_sk AND cd_marital_status IN ('M', 'M') AND cd_education_status IN ('Advanced Degree', 'College') AND cd_gender = 'F' AND c_birth_month = 2 AND c_birth_year BETWEEN 1965 AND 1971 ORDER BY c_customer_id LIMIT 100"
        },
        {
          "node_id": "store_averages",
          "parent_node_id": "final_select",
          "sources": ["customer_total_return"],
          "outputs": ["ctr_store_sk", "avg_ctr_total_return"],
          "changed": true,
          "sql": "SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS avg_ctr_total_return FROM customer_total_return GROUP BY ctr_store_sk"
        },
        {
          "node_id": "customer_total_return",
          "parent_node_id": "final_select",
          "sources": ["store_returns", "date_dim"],
          "outputs": ["ctr_customer_sk", "ctr_store_sk", "ctr_reason_sk", "ctr_total_return"],
          "changed": false
        }
      ]
    }
  }
]
```