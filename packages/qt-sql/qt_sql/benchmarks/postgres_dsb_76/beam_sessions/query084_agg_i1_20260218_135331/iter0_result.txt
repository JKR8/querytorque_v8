{
  "iteration": 0,
  "n_api_calls": 10,
  "beam_cost_usd": 0.03167315,
  "beam_cost_priced_calls": 10,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 111802,
    "completion_tokens": 25730,
    "total_tokens": 137532,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 42688,
    "reasoning_tokens": 14798
  },
  "best_speedup": 20.27,
  "best_patch_id": "p03",
  "best_sql": "WITH ca_filtered AS (\n  SELECT *\n  FROM customer_address\n  WHERE ca_city = 'Jackson'\n),\nib_filtered AS (\n  SELECT *\n  FROM income_band\n  WHERE ib_lower_bound >= 23567 AND ib_upper_bound <= 23567 + 50000\n),\nhd_filtered AS (\n  SELECT *\n  FROM household_demographics\n),\ncd_filtered AS (\n  SELECT *\n  FROM customer_demographics\n)\nSELECT c_customer_id AS customer_id,\n       COALESCE(c_last_name, '') || ', ' || COALESCE(c_first_name, '') AS customername\nFROM customer,\n     ca_filtered,\n     cd_filtered,\n     hd_filtered,\n     ib_filtered,\n     store_returns\nWHERE c_current_addr_sk = ca_address_sk\n  AND ib_income_band_sk = hd_income_band_sk\n  AND cd_demo_sk = c_current_cdemo_sk\n  AND hd_demo_sk = c_current_hdemo_sk\n  AND sr_cdemo_sk = cd_demo_sk\nORDER BY c_customer_id\nLIMIT 100;",
  "patches": [
    {
      "patch_id": "p01",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.85,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Unchanged node `store_returns` must omit sql",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Convert comma joins to explicit INNER JOINs and pre-filter all selective dimensions (`customer_address`, `income_band`, `household_demographics`, `customer_demographics`) into MATERIALIZED CTEs, then join the reduced dimension keys to `customer` and `store_returns`."
    },
    {
      "patch_id": "p02",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.8,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing SQL for tree node `household_demographics`",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Materialize filtered `customer_address` and `income_band` into CTEs, convert comma joins to explicit JOINs, and join `customer` early with the `customer_address` CTE to push city filter."
    },
    {
      "patch_id": "p03",
      "family": "A",
      "transform": "early_filter",
      "relevance_score": 0.6,
      "status": "WIN",
      "speedup": 20.27,
      "semantic_passed": true,
      "error": null,
      "original_ms": 2242.7,
      "patch_ms": 110.6,
      "output_sql": "WITH ca_filtered AS (\n  SELECT *\n  FROM customer_address\n  WHERE ca_city = 'Jackson'\n),\nib_filtered AS (\n  SELECT *\n  FROM income_band\n  WHERE ib_lower_bound >= 23567 AND ib_upper_bound <= 23567 + 50000\n),\nhd_filtered AS (\n  SELECT *\n  FROM household_demographics\n),\ncd_filtered AS (\n  SELECT *\n  FROM customer_demographics\n)\nSELECT c_customer_id AS customer_id,\n       COALESCE(c_last_name, '') || ', ' || COALESCE(c_first_name, '') AS customername\nFROM customer,\n     ca_filtered,\n     cd_filtered,\n     hd_filtered,\n     ib_filtered,\n     store_returns\nWHERE c_current_addr_sk = ca_address_sk\n  AND ib_income_band_sk = hd_income_band_sk\n  AND cd_demo_sk = c_current_cdemo_sk\n  AND hd_demo_sk = c_current_hdemo_sk\n  AND sr_cdemo_sk = cd_demo_sk\nORDER BY c_customer_id\nLIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-filter `customer_address`, `income_band`, `household_demographics`, and `customer_demographics` into separate CTEs, then join them with `customer` and `store_returns` using comma joins (original syntax) to test predicate pushdown alone."
    },
    {
      "patch_id": "p04",
      "family": "E",
      "transform": "pg_self_join_decomposition",
      "relevance_score": 0.55,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Row count: orig=100, patch=0",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH consolidated_dimension AS (SELECT ca.ca_address_sk, cd.cd_demo_sk, hd.hd_demo_sk FROM customer_address ca JOIN household_demographics hd ON ca.ca_address_sk = hd.hd_demo_sk JOIN income_band ib ON ib.ib_income_band_sk = hd.hd_income_band_sk JOIN customer_demographics cd ON cd.cd_demo_sk = hd.hd_demo_sk WHERE ca.ca_city = 'Jackson' AND ib.ib_lower_bound >= 23567 AND ib.ib_upper_bound <= 23567 + 50000) SELECT c.c_customer_id AS customer_id, COALESCE(c.c_last_name, '') || ', ' || COALESCE(c.c_first_name, '') AS customername FROM customer c JOIN consolidated_dimension cd ON c.c_current_addr_sk = cd.ca_address_sk AND c.c_current_cdemo_sk = cd.cd_demo_sk AND c.c_current_hdemo_sk = cd.hd_demo_sk JOIN store_returns sr ON sr.sr_cdemo_sk = cd.cd_demo_sk ORDER BY c.c_customer_id LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Materialize the join of filtered dimensions (`customer_address`, `income_band`, `household_demographics`, `customer_demographics`) into a single CTE, then join once with `customer` and `store_returns` to avoid repeated dimension rescans."
    },
    {
      "patch_id": "compile_p03",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.78,
      "semantic_passed": true,
      "error": null,
      "original_ms": 59.8,
      "patch_ms": 76.8,
      "output_sql": "WITH ca_filtered AS (SELECT * FROM customer_address WHERE ca_city = 'Jackson'), ib_filtered AS (SELECT * FROM income_band WHERE ib_lower_bound >= 23567 AND ib_upper_bound <= 23567 + 50000), hd_filtered AS (SELECT * FROM household_demographics), cd_filtered AS (SELECT * FROM customer_demographics) SELECT c_customer_id AS customer_id, COALESCE(c_last_name, '') || ', ' || COALESCE(c_first_name, '') AS customername FROM customer, ca_filtered, cd_filtered, hd_filtered, ib_filtered, store_returns WHERE c_current_addr_sk = ca_address_sk AND ib_income_band_sk = hd_income_band_sk AND cd_demo_sk = c_current_cdemo_sk AND hd_demo_sk = c_current_hdemo_sk AND sr_cdemo_sk = cd_demo_sk ORDER BY c_customer_id LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_explicit",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.78,
      "semantic_passed": true,
      "error": null,
      "original_ms": 59.8,
      "patch_ms": 76.8,
      "output_sql": "WITH ca_filtered AS (SELECT * FROM customer_address WHERE ca_city = 'Jackson'), ib_filtered AS (SELECT * FROM income_band WHERE ib_lower_bound >= 23567 AND ib_upper_bound <= 23567 + 50000), hd_filtered AS (SELECT * FROM household_demographics), cd_filtered AS (SELECT * FROM customer_demographics) SELECT c_customer_id AS customer_id, COALESCE(c_last_name, '') || ', ' || COALESCE(c_first_name, '') AS customername FROM customer JOIN ca_filtered ON c_current_addr_sk = ca_address_sk JOIN cd_filtered ON cd_demo_sk = c_current_cdemo_sk JOIN hd_filtered ON hd_demo_sk = c_current_hdemo_sk JOIN ib_filtered ON ib_income_band_sk = hd_income_band_sk JOIN store_returns ON sr_cdemo_sk = cd_demo_sk ORDER BY c_customer_id LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.84,
      "semantic_passed": true,
      "error": null,
      "original_ms": 59.8,
      "patch_ms": 71.0,
      "output_sql": "WITH ca_filtered AS (SELECT * FROM customer_address WHERE ca_city = 'Jackson'), ib_filtered AS (SELECT * FROM income_band WHERE ib_lower_bound >= 23567 AND ib_upper_bound <= 23567 + 50000), hd_filtered AS (SELECT * FROM household_demographics), cd_filtered AS (SELECT * FROM customer_demographics) SELECT c_customer_id AS customer_id, COALESCE(c_last_name, '') || ', ' || COALESCE(c_first_name, '') AS customername FROM customer, ca_filtered, cd_filtered, hd_filtered, ib_filtered, store_returns WHERE c_current_addr_sk = ca_address_sk AND ib_income_band_sk = hd_income_band_sk AND cd_demo_sk = c_current_cdemo_sk AND hd_demo_sk = c_current_hdemo_sk AND sr_cdemo_sk = cd_demo_sk ORDER BY c_customer_id LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p2",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.81,
      "semantic_passed": true,
      "error": null,
      "original_ms": 59.8,
      "patch_ms": 73.4,
      "output_sql": "SELECT c_customer_id AS customer_id, COALESCE(c_last_name, '') || ', ' || COALESCE(c_first_name, '') AS customername FROM customer JOIN customer_address ON c_current_addr_sk = ca_address_sk AND ca_city = 'Jackson' JOIN customer_demographics ON cd_demo_sk = c_current_cdemo_sk JOIN household_demographics ON hd_demo_sk = c_current_hdemo_sk JOIN income_band ON ib_income_band_sk = hd_income_band_sk AND ib_lower_bound >= 23567 AND ib_upper_bound <= 23567 + 50000 JOIN store_returns ON sr_cdemo_sk = cd_demo_sk ORDER BY c_customer_id LIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p03": "Limit  (rows=100, time=119.907)\n  Gather Merge  (rows=100, time=119.9)\n    Sort  (rows=100, time=119.389)\n      Nested Loop  (rows=131, time=119.277)\n        Nested Loop  (rows=35, time=118.388)\n          Hash Join  (rows=37, time=117.853)\n            Nested Loop  (rows=188, time=117.701)\n              Hash Join  (rows=193, time=116.175)\n                Seq Scan on customer  (rows=500000, time=54.392)\n                Hash  (rows=98, time=30.134)\n                  Seq Scan on customer_address  (r",
    "compile_p03": "Limit  (rows=100, time=79.562)\n  Gather Merge  (rows=100, time=79.557)\n    Sort  (rows=100, time=79.248)\n      Nested Loop  (rows=131, time=79.194)\n        Nested Loop  (rows=35, time=78.909)\n          Hash Join  (rows=37, time=78.66)\n            Nested Loop  (rows=188, time=78.583)\n              Hash Join  (rows=193, time=77.946)\n                Seq Scan on customer  (rows=500000, time=34.195)\n                Hash  (rows=98, time=21.872)\n                  Seq Scan on customer_address  (rows=98,",
    "compile_explicit": "Limit  (rows=100, time=74.062)\n  Gather Merge  (rows=100, time=74.056)\n    Sort  (rows=100, time=73.681)\n      Nested Loop  (rows=131, time=73.622)\n        Nested Loop  (rows=35, time=73.331)\n          Hash Join  (rows=37, time=73.073)\n            Nested Loop  (rows=188, time=72.99)\n              Hash Join  (rows=193, time=72.357)\n                Seq Scan on customer  (rows=500000, time=33.4)\n                Hash  (rows=98, time=17.889)\n                  Seq Scan on customer_address  (rows=98, t",
    "compile_p1": "Limit  (rows=100, time=74.469)\n  Gather Merge  (rows=100, time=74.465)\n    Sort  (rows=100, time=74.124)\n      Nested Loop  (rows=131, time=74.072)\n        Nested Loop  (rows=35, time=73.815)\n          Hash Join  (rows=37, time=73.563)\n            Nested Loop  (rows=188, time=73.491)\n              Hash Join  (rows=193, time=72.92)\n                Seq Scan on customer  (rows=500000, time=33.268)\n                Hash  (rows=98, time=17.908)\n                  Seq Scan on customer_address  (rows=98,",
    "compile_p2": "Limit  (rows=100, time=70.65)\n  Gather Merge  (rows=100, time=70.645)\n    Sort  (rows=100, time=70.31)\n      Nested Loop  (rows=131, time=70.257)\n        Nested Loop  (rows=35, time=69.997)\n          Hash Join  (rows=37, time=69.731)\n            Nested Loop  (rows=188, time=69.644)\n              Hash Join  (rows=193, time=69.133)\n                Seq Scan on customer  (rows=500000, time=31.168)\n                Hash  (rows=98, time=17.369)\n                  Seq Scan on customer_address  (rows=98, "
  }
}