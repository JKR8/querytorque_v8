{
  "iteration": 0,
  "n_api_calls": 9,
  "best_speedup": 1.11,
  "best_patch_id": "t3",
  "best_sql": "WITH ssr AS (SELECT s_store_id AS store_id, SUM(ss_ext_sales_price) AS sales, SUM(COALESCE(sr_return_amt, 0)) AS returns, SUM(ss_net_profit - COALESCE(sr_net_loss, 0)) AS profit FROM store_sales LEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number), date_dim, store, item, promotion WHERE ss_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 DAY' AND ss_store_sk = s_store_sk AND ss_item_sk = i_item_sk AND i_current_price > 50 AND ss_promo_sk = p_promo_sk AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND ss_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') GROUP BY s_store_id), csr AS (SELECT cp_catalog_page_id AS catalog_page_id, SUM(cs_ext_sales_price) AS sales, SUM(COALESCE(cr_return_amount, 0)) AS returns, SUM(cs_net_profit - COALESCE(cr_net_loss, 0)) AS profit FROM catalog_sales LEFT OUTER JOIN catalog_returns ON (cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number), date_dim, catalog_page, item, promotion WHERE cs_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 DAY' AND cs_catalog_page_sk = cp_catalog_page_sk AND cs_item_sk = i_item_sk AND i_current_price > 50 AND cs_promo_sk = p_promo_sk AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND cs_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') GROUP BY cp_catalog_page_id), wsr AS (SELECT web_site_id, SUM(ws_ext_sales_price) AS sales, SUM(COALESCE(wr_return_amt, 0)) AS returns, SUM(ws_net_profit - COALESCE(wr_net_loss, 0)) AS profit FROM web_sales LEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number), date_dim, web_site, item, promotion WHERE ws_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 DAY' AND ws_web_site_sk = web_site_sk AND ws_item_sk = i_item_sk AND i_current_price > 50 AND ws_promo_sk = p_promo_sk AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND ws_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') GROUP BY web_site_id), agg_store_returns AS (SELECT sr_item_sk, sr_ticket_number, SUM(sr_return_amt) AS return_amt, SUM(sr_net_loss) AS net_loss FROM store_returns GROUP BY sr_item_sk, sr_ticket_number), agg_catalog_returns AS (SELECT cr_item_sk, cr_order_number, SUM(cr_return_amount) AS return_amt, SUM(cr_net_loss) AS net_loss FROM catalog_returns GROUP BY cr_item_sk, cr_order_number), agg_web_returns AS (SELECT wr_item_sk, wr_order_number, SUM(wr_return_amt) AS return_amt, SUM(wr_net_loss) AS net_loss FROM web_returns GROUP BY wr_item_sk, wr_order_number) SELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, returns, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, returns, profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, returns, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100;",
  "patches": [
    {
      "patch_id": "t1",
      "family": "E",
      "transform": "multi_dimension_prefetch",
      "relevance_score": 0.98,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Step s4 failed: No target found for replace_from step s4",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false
    },
    {
      "patch_id": "t3",
      "family": "C",
      "transform": "returns_preaggregation",
      "relevance_score": 0.85,
      "status": "WIN",
      "speedup": 1.11,
      "semantic_passed": true,
      "error": null,
      "original_ms": 134.9,
      "patch_ms": 122.0,
      "output_sql": "WITH ssr AS (SELECT s_store_id AS store_id, SUM(ss_ext_sales_price) AS sales, SUM(COALESCE(sr_return_amt, 0)) AS returns, SUM(ss_net_profit - COALESCE(sr_net_loss, 0)) AS profit FROM store_sales LEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number), date_dim, store, item, promotion WHERE ss_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 DAY' AND ss_store_sk = s_store_sk AND ss_item_sk = i_item_sk AND i_current_price > 50 AND ss_promo_sk = p_promo_sk AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND ss_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') GROUP BY s_store_id), csr AS (SELECT cp_catalog_page_id AS catalog_page_id, SUM(cs_ext_sales_price) AS sales, SUM(COALESCE(cr_return_amount, 0)) AS returns, SUM(cs_net_profit - COALESCE(cr_net_loss, 0)) AS profit FROM catalog_sales LEFT OUTER JOIN catalog_returns ON (cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number), date_dim, catalog_page, item, promotion WHERE cs_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 DAY' AND cs_catalog_page_sk = cp_catalog_page_sk AND cs_item_sk = i_item_sk AND i_current_price > 50 AND cs_promo_sk = p_promo_sk AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND cs_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') GROUP BY cp_catalog_page_id), wsr AS (SELECT web_site_id, SUM(ws_ext_sales_price) AS sales, SUM(COALESCE(wr_return_amt, 0)) AS returns, SUM(ws_net_profit - COALESCE(wr_net_loss, 0)) AS profit FROM web_sales LEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number), date_dim, web_site, item, promotion WHERE ws_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 DAY' AND ws_web_site_sk = web_site_sk AND ws_item_sk = i_item_sk AND i_current_price > 50 AND ws_promo_sk = p_promo_sk AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND ws_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') GROUP BY web_site_id), agg_store_returns AS (SELECT sr_item_sk, sr_ticket_number, SUM(sr_return_amt) AS return_amt, SUM(sr_net_loss) AS net_loss FROM store_returns GROUP BY sr_item_sk, sr_ticket_number), agg_catalog_returns AS (SELECT cr_item_sk, cr_order_number, SUM(cr_return_amount) AS return_amt, SUM(cr_net_loss) AS net_loss FROM catalog_returns GROUP BY cr_item_sk, cr_order_number), agg_web_returns AS (SELECT wr_item_sk, wr_order_number, SUM(wr_return_amt) AS return_amt, SUM(wr_net_loss) AS net_loss FROM web_returns GROUP BY wr_item_sk, wr_order_number) SELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, returns, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, returns, profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, returns, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "t2",
      "family": "F",
      "transform": "explicit_join_restructure",
      "relevance_score": 0.95,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Step s4 failed: Cannot parse body sql_fragment: Required keyword: 'expressions' missing for <class 'sqlglot.expressions.Aliases'>. Line 1, Col: 14.\n  ssr AS (\u001b[4mSELECT\u001b[0m s_store_id AS store_id, SUM(ss_ext_sales_price) AS sales, SUM(COALESCE(sr_return_amt, 0)) AS return",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false
    },
    {
      "patch_id": "syn_w1",
      "family": "A",
      "transform": "early_filter",
      "relevance_score": 0.3,
      "status": "IMPROVED",
      "speedup": 1.06,
      "semantic_passed": true,
      "error": null,
      "original_ms": 134.9,
      "patch_ms": 127.4,
      "output_sql": "WITH ssr AS (SELECT s_store_id AS store_id, SUM(ss_ext_sales_price) AS sales, SUM(COALESCE(sr_return_amt, 0)) AS returns, SUM(ss_net_profit - COALESCE(sr_net_loss, 0)) AS profit FROM store_sales LEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number), date_dim, store, item, promotion WHERE ss_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 DAY' AND ss_store_sk = s_store_sk AND ss_item_sk = i_item_sk AND i_current_price > 50 AND ss_promo_sk = p_promo_sk AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND ss_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') GROUP BY s_store_id), csr AS (SELECT cp_catalog_page_id AS catalog_page_id, SUM(cs_ext_sales_price) AS sales, SUM(COALESCE(cr_return_amount, 0)) AS returns, SUM(cs_net_profit - COALESCE(cr_net_loss, 0)) AS profit FROM catalog_sales LEFT OUTER JOIN catalog_returns ON (cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number), date_dim, catalog_page, item, promotion WHERE cs_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 DAY' AND cs_catalog_page_sk = cp_catalog_page_sk AND cs_item_sk = i_item_sk AND i_current_price > 50 AND cs_promo_sk = p_promo_sk AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND cs_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') GROUP BY cp_catalog_page_id), wsr AS (SELECT web_site_id, SUM(ws_ext_sales_price) AS sales, SUM(COALESCE(wr_return_amt, 0)) AS returns, SUM(ws_net_profit - COALESCE(wr_net_loss, 0)) AS profit FROM web_sales LEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number), date_dim, web_site, item, promotion WHERE ws_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 DAY' AND ws_web_site_sk = web_site_sk AND ws_item_sk = i_item_sk AND i_current_price > 50 AND ws_promo_sk = p_promo_sk AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND ws_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') GROUP BY web_site_id), filtered_date AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 DAY'), filtered_promotion AS (SELECT p_promo_sk FROM promotion WHERE p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N'), filtered_item AS (SELECT i_item_sk FROM item WHERE i_current_price > 50 AND i_category IN ('Men', 'Music')) SELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, returns, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, returns, profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, returns, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100;",
      "has_explain": true
    }
  ],
  "explains": {
    "t3": "Limit  (rows=6, time=165.952)\n  Aggregate  (rows=6, time=165.949)\n    Sort  (rows=3, time=165.928)\n      Append  (rows=3, time=165.896)\n        Subquery Scan (ssr)  (rows=2, time=67.972)\n          Aggregate  (rows=2, time=67.964)\n            Sort  (rows=2, time=67.941)\n              Nested Loop  (rows=2, time=67.918)\n                Nested Loop  (rows=2, time=67.863)\n                  Gather  (rows=2, time=67.745)\n                    Nested Loop  (rows=1, time=26.922)\n                      Hash ",
    "syn_w1": "Limit  (rows=6, time=165.75)\n  Aggregate  (rows=6, time=165.748)\n    Sort  (rows=3, time=165.719)\n      Append  (rows=3, time=165.694)\n        Subquery Scan (ssr)  (rows=2, time=57.315)\n          Aggregate  (rows=2, time=57.309)\n            Sort  (rows=2, time=57.289)\n              Nested Loop  (rows=2, time=57.27)\n                Nested Loop  (rows=2, time=57.203)\n                  Gather  (rows=2, time=57.128)\n                    Nested Loop  (rows=1, time=21.823)\n                      Hash Jo"
  }
}