[
  {
    "target_id": "t1",
    "family": "E",
    "transform": "multi_dimension_prefetch",
    "relevance_score": 0.95,
    "hypothesis": "Nested loops re-scan dimension tables for each fact row. Materializing filtered dimensions as CTEs enables efficient hash joins and eliminates redundant scans.",
    "target_ir": "S0 [SELECT]\n  CTE: filtered_date (via Q1)\n    FROM: date_dim\n    WHERE: d_year = 2002\n  CTE: filtered_store (via Q2)\n    FROM: store\n    WHERE: s_state = 'IA'\n  CTE: filtered_item (via Q3)\n    FROM: item\n    WHERE: i_category = 'Sports'\n  CTE: filtered_cd (via Q4)\n    FROM: customer_demographics\n    WHERE: cd_gender = 'F' AND cd_marital_status = 'M' AND cd_education_status = 'Primary'\n  MAIN QUERY (via Q0)\n    FROM: store_sales\n    INNER JOIN filtered_date ON ss_sold_date_sk = filtered_date.d_date_sk\n    INNER JOIN filtered_store ON ss_store_sk = filtered_store.s_store_sk\n    INNER JOIN filtered_item ON ss_item_sk = filtered_item.i_item_sk\n    INNER JOIN filtered_cd ON ss_cdemo_sk = filtered_cd.cd_demo_sk\n    GROUP BY ROLLUP (i_item_id, s_state)\n    ORDER BY i_item_id, s_state\n    LIMIT 100",
    "recommended_examples": [
      "multi_dimension_prefetch"
    ]
  },
  {
    "target_id": "t2",
    "family": "A",
    "transform": "predicate_pushback",
    "relevance_score": 0.85,
    "hypothesis": "Filters on dimension tables (e.g., date_dim.d_year) are applied late. Isolating them in CTEs reduces join cardinality early.",
    "target_ir": "S0 [SELECT]\n  CTE: prefiltered_date (via Q1)\n    FROM: date_dim\n    WHERE: d_year = 2002\n  CTE: prefiltered_store (via Q2)\n    FROM: store\n    WHERE: s_state = 'IA'\n  CTE: prefiltered_item (via Q3)\n    FROM: item\n    WHERE: i_category = 'Sports'\n  CTE: prefiltered_cd (via Q4)\n    FROM: customer_demographics\n    WHERE: cd_gender = 'F' AND cd_marital_status = 'M' AND cd_education_status = 'Primary'\n  MAIN QUERY (via Q0)\n    FROM: store_sales, prefiltered_date, prefiltered_store, prefiltered_item, prefiltered_cd\n    WHERE: ss_sold_date_sk = prefiltered_date.d_date_sk\n      AND ss_store_sk = prefiltered_store.s_store_sk\n      AND ss_item_sk = prefiltered_item.i_item_sk\n      AND ss_cdemo_sk = prefiltered_cd.cd_demo_sk\n    GROUP BY ROLLUP (i_item_id, s_state)\n    ORDER BY i_item_id, s_state\n    LIMIT 100",
    "recommended_examples": [
      "pg_date_cte_explicit_join"
    ]
  },
  {
    "target_id": "t3",
    "family": "F",
    "transform": "explicit_join_restructure",
    "relevance_score": 0.75,
    "hypothesis": "Implicit comma-joins obscure join dependencies. Explicit joins clarify relationships and enable better planner decisions.",
    "target_ir": "S0 [SELECT]\n  MAIN QUERY (via Q0)\n    FROM: store_sales\n    INNER JOIN date_dim ON ss_sold_date_sk = d_date_sk\n    INNER JOIN store ON ss_store_sk = s_store_sk\n    INNER JOIN item ON ss_item_sk = i_item_sk\n    INNER JOIN customer_demographics ON ss_cdemo_sk = cd_demo_sk\n    WHERE: cd_gender = 'F' \n      AND cd_marital_status = 'M' \n      AND cd_education_status = 'Primary'\n      AND d_year = 2002\n      AND s_state = 'IA'\n      AND i_category = 'Sports'\n    GROUP BY ROLLUP (i_item_id, s_state)\n    ORDER BY i_item_id, s_state\n    LIMIT 100",
    "recommended_examples": [
      "pg_explicit_join_materialized"
    ]
  }
]