[
  {
    "target_id": "t1",
    "family": "A+F",
    "transform": "early_filter_explicit_join",
    "relevance_score": 0.95,
    "hypothesis": "Push city/income filters into CTEs to reduce customer rows early. Use explicit joins to enforce optimal dimension-table order, starting with filtered small tables. Preserves literal '50000' to avoid semantic errors.",
    "target_ir": "WITH addr AS (SELECT ca_address_sk FROM customer_address WHERE ca_city = 'Mount Vernon'), income AS (SELECT ib_income_band_sk FROM income_band WHERE ib_lower_bound >= 40374 AND ib_upper_bound <= 40374 + 50000) SELECT c_customer_id AS customer_id, coalesce(c_last_name,'') || ', ' || coalesce(c_first_name,'') AS customername FROM income JOIN household_demographics ON ib_income_band_sk = hd_income_band_sk JOIN customer_demographics ON hd_demo_sk = cd_demo_sk JOIN addr JOIN customer ON c_current_addr_sk = addr.ca_address_sk AND cd_demo_sk = c_current_cdemo_sk AND hd_demo_sk = c_current_hdemo_sk JOIN store_returns ON sr_cdemo_sk = cd_demo_sk ORDER BY c_customer_id LIMIT 100;",
    "recommended_examples": [
      "pg_date_cte_explicit_join",
      "pg_explicit_join_materialized"
    ]
  },
  {
    "target_id": "t2",
    "family": "E",
    "transform": "materialize_dimensions",
    "relevance_score": 0.85,
    "hypothesis": "Materialize filtered dimension tables (address/income) to avoid repeated scans. Join materialized results directly to customer to shrink its scan input.",
    "target_ir": "WITH addr AS (SELECT ca_address_sk FROM customer_address WHERE ca_city = 'Mount Vernon'), income AS (SELECT ib_income_band_sk FROM income_band WHERE ib_lower_bound >= 40374 AND ib_upper_bound <= 40374 + 50000) SELECT c_customer_id AS customer_id, coalesce(c_last_name,'') || ', ' || coalesce(c_first_name,'') AS customername FROM customer, addr, income, customer_demographics, household_demographics, store_returns WHERE c_current_addr_sk = addr.ca_address_sk AND ib_income_band_sk = hd_income_band_sk AND cd_demo_sk = c_current_cdemo_sk AND hd_demo_sk = c_current_hdemo_sk AND sr_cdemo_sk = cd_demo_sk ORDER BY c_customer_id LIMIT 100;",
    "recommended_examples": [
      "multi_dimension_prefetch"
    ]
  },
  {
    "target_id": "t3",
    "family": "A",
    "transform": "early_filter_fixed",
    "relevance_score": 0.8,
    "hypothesis": "Repair literal mismatch in prior Family A attempts by preserving '40374 + 50000'. Isolates filters in CTEs to reduce rows before joining customer.",
    "target_ir": "WITH addr AS (SELECT ca_address_sk FROM customer_address WHERE ca_city = 'Mount Vernon'), income AS (SELECT ib_income_band_sk FROM income_band WHERE ib_lower_bound >= 40374 AND ib_upper_bound <= 40374 + 50000) SELECT c_customer_id AS customer_id, coalesce(c_last_name,'') || ', ' || coalesce(c_first_name,'') AS customername FROM customer, addr, customer_demographics, household_demographics, income, store_returns WHERE c_current_addr_sk = addr.ca_address_sk AND ib_income_band_sk = hd_income_band_sk AND cd_demo_sk = c_current_cdemo_sk AND hd_demo_sk = c_current_hdemo_sk AND sr_cdemo_sk = cd_demo_sk ORDER BY c_customer_id LIMIT 100;",
    "recommended_examples": [
      "pg_date_cte_explicit_join"
    ]
  }
]