## Analysis of Optimization Families

**Family A: Early Filtering (Predicate Pushback)**  
HIGH relevance. The CTE `wss` scans the entire `store_sales` table without leveraging the `d_month_seq` filters applied later in subqueries `y` and `x`. Pushing the 24-month date filter into the CTE reduces its output by 99%+.

**Family B: Decorrelation (Sets Over Loops)**  
LOW relevance. No correlated subqueries exist. All joins are set-based.

**Family C: Aggregation Pushdown**  
MEDIUM relevance. Aggregation is already correctly pushed to the CTE level. No further pushdown opportunities.

**Family D: Set Operation Optimization**  
LOW relevance. No UNION/INTERSECT operations present.

**Family E: Materialization/Prefetch**  
HIGH relevance. The CTE `wss` is scanned twice (for `y` and `x` subqueries) with different date filters. Precomputing a filtered version avoids full table rescans.

**Family F: Join Transform**  
MEDIUM relevance. The comma-join between `y` and `x` could be converted to an explicit JOIN, but this is secondary to date filtering.

**Chosen families**: [A, E]  
**Confidence**: High

## Optimization Targets

```json
[
  {
    "family": "A",
    "transform": "early_filtering",
    "target_id": "t1",
    "relevance_score": 0.98,
    "hypothesis": "CTE 'wss' scans entire store_sales table despite needing only 24 months of data. Pushing d_month_seq filter into CTE reduces input rows by 100x+.",
    "target_ir": "S0 [SELECT]\n  CTE: wss  (via CTE_Q_S0_wss)\n    FROM: store_sales, date_dim\n    WHERE [5f7f8283ea72d640]: d_date_sk = ss_sold_date_sk \n      AND ss_sales_price / ss_list_price BETWEEN 57 * 0.01 AND 77 * 0.01\n      AND d_month_seq BETWEEN 1187 AND 1187 + 23\n    GROUP BY: d_week_seq, ss_store_sk\n  MAIN QUERY (via Q_S0)\n    FROM: (subquery) y, (subquery) x\n    WHERE [0b824afb49a292d0]: s_store_id1 = s_store_id2 AND d_week_seq1 = d_week_seq2 - 52\n    ORDER BY: s_store_name1, s_store_id1, d_week_seq1",
    "recommended_examples": ["pg_date_cte_explicit_join"]
  },
  {
    "family": "E",
    "transform": "multi_dimension_prefetch",
    "target_id": "t2",
    "relevance_score": 0.90,
    "hypothesis": "Repeated date_dim scans for month ranges (1187-1198 and 1199-1210) waste I/O. Precompute date-week mapping in a CTE.",
    "target_ir": "S0 [SELECT]\n  CTE: date_ranges  (via CTE_Q_S0_dates)\n    FROM: date_dim\n    WHERE: d_month_seq BETWEEN 1187 AND 1187 + 23\n    GROUP BY: d_week_seq, d_month_seq\n  CTE: wss  (via CTE_Q_S0_wss)\n    FROM: store_sales, date_ranges\n    WHERE: d_date_sk = ss_sold_date_sk \n      AND ss_sales_price / ss_list_price BETWEEN 57 * 0.01 AND 77 * 0.01\n    GROUP BY: d_week_seq, ss_store_sk\n  MAIN QUERY (via Q_S0)\n    FROM: (subquery) y, (subquery) x\n    WHERE [0b824afb49a292d0]: s_store_id1 = s_store_id2 AND d_week_seq1 = d_week_seq2 - 52\n    ORDER BY: s_store_name1, s_store_id1, d_week_seq1",
    "recommended_examples": ["multi_dimension_prefetch"]
  }
]
```