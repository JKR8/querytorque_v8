{
  "plan_id": "compile_p1",
  "dialect": "postgres",
  "hypothesis": "All four probes regressed or violated semantics, indicating comma‑join conversion and CTE fencing did not improve performance. The original plan’s largest hotspot is a hash‑join building 110k rows from store_returns after date‑filtered nested loops. Residual gap is the oversized hash table; no probe addressed this. Attempt a minimal rewrite that pushes the selective date‑dim filters earlier into the fact‑table scans while preserving explicit joins, avoiding CTE fences.",
  "target_ir": "Replace comma joins with explicit INNER JOINs, keep date‑dim filters inline, and maintain the same join graph.",
  "confidence": 0.45,
  "based_on": "",
  "strategy": "Explicit join syntax with inline predicate pushdown, no CTEs, no aggregation pushdown.",
  "expected_explain_delta": "Expect earlier reduction of store_returns rows via date‑dim filter, smaller hash‑table build, and better join‑order flexibility.",
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": [],
        "outputs": ["i_item_id", "i_item_desc", "s_store_id", "s_store_name", "store_sales_profit", "store_returns_loss", "catalog_sales_profit"],
        "changed": true,
        "sql": "SELECT i_item_id, i_item_desc, s_store_id, s_store_name, max(ss_net_profit) AS store_sales_profit, max(sr_net_loss) AS store_returns_loss, max(cs_net_profit) AS catalog_sales_profit FROM store_sales INNER JOIN date_dim d1 ON d1.d_date_sk = ss_sold_date_sk AND d1.d_moy = 3 AND d1.d_year = 1999 INNER JOIN store ON s_store_sk = ss_store_sk INNER JOIN item ON i_item_sk = ss_item_sk INNER JOIN store_returns ON ss_customer_sk = sr_customer_sk AND ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number INNER JOIN date_dim d2 ON sr_returned_date_sk = d2.d_date_sk AND d2.d_moy BETWEEN 3 AND 3 + 2 AND d2.d_year = 1999 INNER JOIN catalog_sales ON sr_customer_sk = cs_bill_customer_sk AND sr_item_sk = cs_item_sk INNER JOIN date_dim d3 ON cs_sold_date_sk = d3.d_date_sk AND d3.d_moy BETWEEN 3 AND 3 + 2 AND d3.d_year = 1999 GROUP BY i_item_id, i_item_desc, s_store_id, s_store_name ORDER BY i_item_id, i_item_desc, s_store_id, s_store_name LIMIT 100"
      }
    ]
  }
}