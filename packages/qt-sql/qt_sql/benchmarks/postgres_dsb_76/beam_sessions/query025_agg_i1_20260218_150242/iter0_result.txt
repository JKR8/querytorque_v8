{
  "iteration": 0,
  "n_api_calls": 10,
  "beam_cost_usd": 0.03516323,
  "beam_cost_priced_calls": 10,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 133684,
    "completion_tokens": 18718,
    "total_tokens": 152402,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 48576,
    "reasoning_tokens": 8223
  },
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "p01",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.85,
      "status": "REGRESSION",
      "speedup": 0.62,
      "semantic_passed": true,
      "error": null,
      "original_ms": 574.9,
      "patch_ms": 927.4,
      "output_sql": "WITH d1 AS (SELECT d_date_sk FROM date_dim WHERE d_moy = 3 AND d_year = 1999),\n     d2 AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 3 AND 5 AND d_year = 1999),\n     d3 AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 3 AND 5 AND d_year = 1999)\nSELECT \n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n ,max(ss_net_profit) as store_sales_profit\n ,max(sr_net_loss) as store_returns_loss\n ,max(cs_net_profit) as catalog_sales_profit\n from\n store_sales\n INNER JOIN store_returns ON ss_customer_sk = sr_customer_sk AND ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number\n INNER JOIN catalog_sales ON sr_customer_sk = cs_bill_customer_sk AND sr_item_sk = cs_item_sk\n INNER JOIN d1 ON d1.d_date_sk = ss_sold_date_sk\n INNER JOIN d2 ON d2.d_date_sk = sr_returned_date_sk\n INNER JOIN d3 ON d3.d_date_sk = cs_sold_date_sk\n INNER JOIN store ON s_store_sk = ss_store_sk\n INNER JOIN item ON i_item_sk = ss_item_sk\n group by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n order by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n limit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Replace comma joins with explicit INNER JOIN syntax and pre-filter date_dim d1, d2, d3 into separate CTEs to create tiny hash tables for the optimizer."
    },
    {
      "patch_id": "p02",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.8,
      "status": "REGRESSION",
      "speedup": 0.74,
      "semantic_passed": true,
      "error": null,
      "original_ms": 574.9,
      "patch_ms": 777.4,
      "output_sql": "WITH store_sales_prefetch AS (SELECT ss_sold_date_sk, ss_item_sk, ss_store_sk, ss_customer_sk, ss_ticket_number, ss_net_profit FROM store_sales), store_returns_prefetch AS (SELECT sr_returned_date_sk, sr_item_sk, sr_customer_sk, sr_ticket_number, sr_net_loss FROM store_returns), catalog_sales_prefetch AS (SELECT cs_sold_date_sk, cs_bill_customer_sk, cs_item_sk, cs_net_profit FROM catalog_sales), d1_prefetch AS (SELECT d_date_sk FROM date_dim WHERE d_moy = 3 AND d_year = 1999), d2_prefetch AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 3 AND 5 AND d_year = 1999), d3_prefetch AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 3 AND 5 AND d_year = 1999), store_prefetch AS (SELECT s_store_sk, s_store_id, s_store_name FROM store), item_prefetch AS (SELECT i_item_sk, i_item_id, i_item_desc FROM item) SELECT i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name, MAX(ss.ss_net_profit) AS store_sales_profit, MAX(sr.sr_net_loss) AS store_returns_loss, MAX(cs.cs_net_profit) AS catalog_sales_profit FROM store_sales_prefetch ss JOIN store_returns_prefetch sr ON ss.ss_customer_sk = sr.sr_customer_sk AND ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number JOIN catalog_sales_prefetch cs ON sr.sr_customer_sk = cs.cs_bill_customer_sk AND sr.sr_item_sk = cs.cs_item_sk JOIN d1_prefetch d1 ON d1.d_date_sk = ss.ss_sold_date_sk JOIN d2_prefetch d2 ON d2.d_date_sk = sr.sr_returned_date_sk JOIN d3_prefetch d3 ON d3.d_date_sk = cs.cs_sold_date_sk JOIN store_prefetch s ON s.s_store_sk = ss.ss_store_sk JOIN item_prefetch i ON i.i_item_sk = ss.ss_item_sk GROUP BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name ORDER BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-filter all three date_dim tables and store/item into CTEs, then join fact tables against these pre\u2011materialized tiny dimension sets using explicit JOIN syntax."
    },
    {
      "patch_id": "p03",
      "family": "A",
      "transform": "multi_date_range_cte",
      "relevance_score": 0.65,
      "status": "REGRESSION",
      "speedup": 0.62,
      "semantic_passed": true,
      "error": null,
      "original_ms": 574.9,
      "patch_ms": 927.5,
      "output_sql": "select \n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n ,max(ss_net_profit) as store_sales_profit\n ,max(sr_net_loss) as store_returns_loss\n ,max(cs_net_profit) as catalog_sales_profit\n from\n store_sales\n ,store_returns\n ,catalog_sales\n ,date_dim d1\n ,date_dim d2\n ,date_dim d3\n ,store\n ,item\n where\n d1.d_moy = 3\n and d1.d_year = 1999\n and d1.d_date_sk = ss_sold_date_sk\n and i_item_sk = ss_item_sk\n and s_store_sk = ss_store_sk\n and ss_customer_sk = sr_customer_sk\n and ss_item_sk = sr_item_sk\n and ss_ticket_number = sr_ticket_number\n and sr_returned_date_sk = d2.d_date_sk\n and d2.d_moy               between 3 and  3 + 2\n and d2.d_year              = 1999\n and sr_customer_sk = cs_bill_customer_sk\n and sr_item_sk = cs_item_sk\n and cs_sold_date_sk = d3.d_date_sk\n and d3.d_moy               between 3 and  3 + 2\n and d3.d_year              = 1999\n group by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n order by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n limit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Create separate CTEs for each date_dim alias (d1, d2, d3) with their respective filters, then join fact tables directly to these CTEs."
    },
    {
      "patch_id": "p04",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.55,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": true,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select \n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n ,max(ss_net_profit) as store_sales_profit\n ,max(sr_net_loss) as store_returns_loss\n ,max(cs_net_profit) as catalog_sales_profit\n from\n store_sales\n ,store_returns\n ,catalog_sales\n ,date_dim d1\n ,date_dim d2\n ,date_dim d3\n ,store\n ,item\n where\n d1.d_moy = 3\n and d1.d_year = 1999\n and d1.d_date_sk = ss_sold_date_sk\n and i_item_sk = ss_item_sk\n and s_store_sk = ss_store_sk\n and ss_customer_sk = sr_customer_sk\n and ss_item_sk = sr_item_sk\n and ss_ticket_number = sr_ticket_number\n and sr_returned_date_sk = d2.d_date_sk\n and d2.d_moy               between 3 and  3 + 2\n and d2.d_year              = 1999\n and sr_customer_sk = cs_bill_customer_sk\n and sr_item_sk = cs_item_sk\n and cs_sold_date_sk = d3.d_date_sk\n and d3.d_moy               between 3 and  3 + 2\n and d3.d_year              = 1999\n group by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n order by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n limit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre\u2011aggregate store_sales, store_returns, catalog_sales by (ss_item_sk, ss_customer_sk, ss_ticket_number, ss_store_sk) before joining with dimensions, then compute final MAX aggregates after joins."
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "NEUTRAL",
      "speedup": 0.96,
      "semantic_passed": true,
      "error": null,
      "original_ms": 1598.2,
      "patch_ms": 1672.6,
      "output_sql": "SELECT i_item_id, i_item_desc, s_store_id, s_store_name, max(ss_net_profit) AS store_sales_profit, max(sr_net_loss) AS store_returns_loss, max(cs_net_profit) AS catalog_sales_profit FROM store_sales INNER JOIN date_dim d1 ON d1.d_date_sk = ss_sold_date_sk AND d1.d_moy = 3 AND d1.d_year = 1999 INNER JOIN store ON s_store_sk = ss_store_sk INNER JOIN item ON i_item_sk = ss_item_sk INNER JOIN store_returns ON ss_customer_sk = sr_customer_sk AND ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number INNER JOIN date_dim d2 ON sr_returned_date_sk = d2.d_date_sk AND d2.d_moy BETWEEN 3 AND 3 + 2 AND d2.d_year = 1999 INNER JOIN catalog_sales ON sr_customer_sk = cs_bill_customer_sk AND sr_item_sk = cs_item_sk INNER JOIN date_dim d3 ON cs_sold_date_sk = d3.d_date_sk AND d3.d_moy BETWEEN 3 AND 3 + 2 AND d3.d_year = 1999 GROUP BY i_item_id, i_item_desc, s_store_id, s_store_name ORDER BY i_item_id, i_item_desc, s_store_id, s_store_name LIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p01": "Limit  (rows=0, time=810.769)\n  Aggregate  (rows=0, time=810.766)\n    Nested Loop  (rows=0, time=810.763)\n      Gather Merge  (rows=16, time=810.722)\n        Sort  (rows=8, time=612.324)\n          Nested Loop  (rows=8, time=612.255)\n            Nested Loop  (rows=8, time=612.075)\n              Nested Loop  (rows=8, time=611.946)\n                Hash Join  (rows=8, time=611.674)\n                  Nested Loop  (rows=170, time=611.218)\n                    Nested Loop  (rows=164792, time=27.348)\n   ",
    "p02": "Limit  (rows=0, time=737.494)\n  Aggregate  (rows=0, time=737.492)\n    Nested Loop  (rows=0, time=737.49)\n      Gather Merge  (rows=16, time=737.459)\n        Sort  (rows=8, time=569.288)\n          Nested Loop  (rows=8, time=569.204)\n            Nested Loop  (rows=8, time=568.981)\n              Nested Loop  (rows=8, time=568.857)\n                Hash Join  (rows=8, time=568.649)\n                  Nested Loop  (rows=170, time=568.139)\n                    Nested Loop  (rows=164792, time=27.589)\n    ",
    "p03": "Limit  (rows=0, time=759.722)\n  Aggregate  (rows=0, time=759.718)\n    Nested Loop  (rows=0, time=759.716)\n      Gather Merge  (rows=16, time=759.682)\n        Sort  (rows=8, time=565.341)\n          Nested Loop  (rows=8, time=565.228)\n            Nested Loop  (rows=8, time=565.073)\n              Nested Loop  (rows=8, time=564.938)\n                Hash Join  (rows=8, time=564.735)\n                  Nested Loop  (rows=170, time=564.217)\n                    Nested Loop  (rows=164792, time=26.133)\n   ",
    "compile_p1": "Limit  (rows=0, time=2147.665)\n  Aggregate  (rows=0, time=2147.661)\n    Nested Loop  (rows=0, time=2147.659)\n      Gather Merge  (rows=16, time=2147.611)\n        Sort  (rows=16, time=2146.926)\n          Nested Loop  (rows=16, time=2146.826)\n            Nested Loop  (rows=16, time=2146.429)\n              Nested Loop  (rows=16, time=2146.152)\n                Hash Join  (rows=16, time=2145.509)\n                  Nested Loop  (rows=339, time=2144.337)\n                    Nested Loop  (rows=329585, t"
  }
}