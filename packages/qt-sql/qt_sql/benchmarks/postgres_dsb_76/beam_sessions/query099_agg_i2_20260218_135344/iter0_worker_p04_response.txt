{
  "probe_id": "scout_early_filter",
  "transform_id": "early_filter",
  "family": "A",
  "status": "success",
  "dialect": "postgresql",
  "hypothesis": "Pre-filtering small dimension tables (ship_mode, warehouse, call_center) into CTEs before joining with catalog_sales reduces row count early and avoids late Nested Loop fanout.",
  "reasoning_trace": [
    "Nested Loop between date_dim and catalog_sales dominates runtime (67.2s); early dimension filtering can reduce fanout.",
    "Dimension tables ship_mode, warehouse, call_center are small (â‰¤20 rows) and filtered late; CTE staging enables early selectivity.",
    "Explicit JOIN syntax improves optimizer understanding and enables better predicate pushdown than comma joins.",
    "CTE reuse is not required here since each dimension is used once; materialization is acceptable for small tables."
  ],
  "target_ir": "ship_mode, warehouse, and call_center become filtered CTEs; FROM clause replaced with explicit JOINs.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": [],
        "outputs": [
          "SUBSTRING(w_warehouse_name FROM 1 FOR 20)",
          "sm_type",
          "cc_name",
          "30 days",
          "31-60 days",
          "61-90 days",
          "91-120 days",
          ">120 days"
        ],
        "changed": true,
        "sql": "WITH filtered_ship_mode AS (\n  SELECT sm_ship_mode_sk, sm_type\n  FROM ship_mode\n  WHERE sm_type = 'LIBRARY'\n),\nfiltered_warehouse AS (\n  SELECT w_warehouse_sk, w_warehouse_name, w_gmt_offset\n  FROM warehouse\n  WHERE w_gmt_offset = -5\n),\nfiltered_call_center AS (\n  SELECT cc_call_center_sk, cc_name, cc_class\n  FROM call_center\n  WHERE cc_class = 'medium'\n)\nSELECT \n  SUBSTRING(w_warehouse_name, 1, 20),\n  sm_type,\n  cc_name,\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\",\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\",\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\",\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\",\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\"\nFROM catalog_sales\nJOIN date_dim ON cs_ship_date_sk = d_date_sk\nJOIN filtered_warehouse ON cs_warehouse_sk = w_warehouse_sk\nJOIN filtered_ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk\nJOIN filtered_call_center ON cs_call_center_sk = cc_call_center_sk\nWHERE d_month_seq BETWEEN 1191 AND 1191 + 23\n  AND cs_list_price BETWEEN 244 AND 273\nGROUP BY SUBSTRING(w_warehouse_name, 1, 20), sm_type, cc_name\nORDER BY SUBSTRING(w_warehouse_name, 1, 20), sm_type, cc_name\nLIMIT 100"
      }
    ]
  }
}