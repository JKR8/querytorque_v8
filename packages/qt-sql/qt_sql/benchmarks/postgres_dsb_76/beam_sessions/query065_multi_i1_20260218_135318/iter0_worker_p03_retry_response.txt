{
  "probe_id": "p03",
  "transform_id": "dimension_prefetch_star",
  "family": "F",
  "status": "success",
  "dialect": "postgresql",
  "hypothesis": "Pre-filtering store and item dimensions with selective predicates reduces Merge Join input sizes and improves join order.",
  "reasoning_trace": [
    "Assigned transform targets early dimension filtering to reduce Merge Join inputs.",
    "Store and item filters are selective and applied late in original plan.",
    "Creating CTEs for filtered dimensions aligns with PostgreSQL optimizer strengths.",
    "Explicit JOIN syntax improves cardinality estimation over comma joins."
  ],
  "target_ir": "store_filtered and item_filtered CTEs added; final_select rewritten with explicit JOINs; sb and sc nodes now include full SQL.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["sb", "sc", "store_filtered", "item_filtered"],
        "outputs": ["s_store_name", "i_item_desc", "revenue", "i_current_price", "i_wholesale_cost", "i_brand"],
        "changed": true,
        "sql": "SELECT s.s_store_name, i.i_item_desc, sc.revenue, i.i_current_price, i.i_wholesale_cost, i.i_brand FROM store_filtered s JOIN item_filtered i ON s.s_store_sk = i.i_item_sk JOIN sb ON s.s_store_sk = sb.ss_store_sk JOIN sc ON sb.ss_store_sk = sc.ss_store_sk AND i.i_item_sk = sc.ss_item_sk WHERE sc.revenue <= 0.1 * sb.ave ORDER BY s.s_store_name, i.i_item_desc LIMIT 100"
      },
      {
        "node_id": "store_filtered",
        "parent_node_id": "final_select",
        "sources": ["store"],
        "outputs": ["s_store_sk", "s_store_name"],
        "changed": true,
        "sql": "SELECT s_store_sk, s_store_name FROM store WHERE s_state IN ('IA','IL','NC')"
      },
      {
        "node_id": "item_filtered",
        "parent_node_id": "final_select",
        "sources": ["item"],
        "outputs": ["i_item_sk", "i_item_desc", "i_current_price", "i_wholesale_cost", "i_brand"],
        "changed": true,
        "sql": "SELECT i_item_sk, i_item_desc, i_current_price, i_wholesale_cost, i_brand FROM item WHERE i_manager_id BETWEEN 80 AND 84"
      },
      {
        "node_id": "sb",
        "parent_node_id": "final_select",
        "sources": ["sa"],
        "outputs": ["ss_store_sk", "ave"],
        "changed": true,
        "sql": "SELECT ss_store_sk, avg(revenue) as ave FROM sa GROUP BY ss_store_sk"
      },
      {
        "node_id": "sa",
        "parent_node_id": "sb",
        "sources": ["store_sales", "date_dim"],
        "outputs": ["ss_store_sk", "ss_item_sk", "revenue"],
        "changed": true,
        "sql": "SELECT ss_store_sk, ss_item_sk, sum(ss_sales_price) as revenue FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_month_seq between 1195 and 1195+11 AND ss_sales_price / ss_list_price BETWEEN 38 * 0.01 AND 48 * 0.01 GROUP BY ss_store_sk, ss_item_sk"
      },
      {
        "node_id": "sc",
        "parent_node_id": "final_select",
        "sources": ["store_sales", "date_dim"],
        "outputs": ["ss_store_sk", "ss_item_sk", "revenue"],
        "changed": true,
        "sql": "SELECT ss_store_sk, ss_item_sk, sum(ss_sales_price) as revenue FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_month_seq between 1195 and 1195+11 AND ss_sales_price / ss_list_price BETWEEN 38 * 0.01 AND 48 * 0.01 GROUP BY ss_store_sk, ss_item_sk"
      }
    ]
  }
}