Worker Role: W4
Family: A+E
Transform: push_item_filter_into_common_scan
Status: OK

--- OUTPUT SQL ---
WITH filtered_items AS (SELECT i_item_sk FROM item WHERE i_manufact_id BETWEEN 797 AND 996 OR i_category IN ('Men', 'Shoes', 'Sports')), filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1999-01-29' AND CAST('1999-01-29' AS DATE) + INTERVAL '90 DAY'), common_scan AS (SELECT ws_item_sk, ws_sold_date_sk, ws_ext_discount_amt, ws_wholesale_cost, ws_sales_price, ws_list_price FROM web_sales JOIN filtered_items ON i_item_sk = ws_item_sk JOIN filtered_dates ON d_date_sk = ws_sold_date_sk WHERE ws_wholesale_cost BETWEEN 35 AND 55) SELECT SUM(ws_ext_discount_amt) AS "Excess Discount Amount" FROM common_scan WHERE ws_ext_discount_amt > (SELECT 1.3 * AVG(ws_ext_discount_amt) FROM common_scan AS cs2 WHERE cs2.ws_item_sk = common_scan.ws_item_sk AND cs2.ws_sales_price / cs2.ws_list_price BETWEEN 0.76 AND 0.91) ORDER BY SUM(ws_ext_discount_amt) LIMIT 100;