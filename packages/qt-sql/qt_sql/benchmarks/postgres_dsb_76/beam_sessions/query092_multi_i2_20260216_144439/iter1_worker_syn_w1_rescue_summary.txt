Worker Role: W1
Family: A+B
Transform: push_item_filters_early
Status: OK

--- OUTPUT SQL ---
WITH filtered_items AS (SELECT i_item_sk FROM item WHERE i_manufact_id BETWEEN 797 AND 996 OR i_category IN ('Men', 'Shoes', 'Sports')), common_scan AS (SELECT ws_item_sk, ws_ext_discount_amt, ws_sales_price, ws_list_price, ws_wholesale_cost FROM web_sales INNER JOIN date_dim ON d_date_sk = ws_sold_date_sk WHERE d_date BETWEEN '1999-01-29' AND CAST('1999-01-29' AS DATE) + INTERVAL '90 DAY' AND ws_wholesale_cost BETWEEN 35 AND 55), threshold_computation AS (SELECT ws_item_sk, 1.3 * AVG(ws_ext_discount_amt) AS threshold FROM common_scan WHERE ws_sales_price / ws_list_price BETWEEN 76 * 0.01 AND 91 * 0.01 GROUP BY ws_item_sk), outer_rows AS (SELECT cs.ws_item_sk, cs.ws_ext_discount_amt FROM common_scan AS cs INNER JOIN filtered_items AS fi ON cs.ws_item_sk = fi.i_item_sk), final_filtered AS (SELECT o.ws_ext_discount_amt FROM outer_rows AS o INNER JOIN threshold_computation AS t ON o.ws_item_sk = t.ws_item_sk WHERE o.ws_ext_discount_amt > t.threshold) SELECT SUM(ws_ext_discount_amt) AS "Excess Discount Amount" FROM final_filtered ORDER BY SUM(ws_ext_discount_amt) LIMIT 100;