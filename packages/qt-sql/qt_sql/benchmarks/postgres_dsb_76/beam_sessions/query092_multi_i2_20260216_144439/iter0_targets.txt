[
  {
    "target_id": "t1",
    "family": "B",
    "transform": "shared_scan_decorrelate",
    "relevance_score": 0.95,
    "hypothesis": "Correlated scalar subquery re-scans web_sales per row. Decorrelate by precomputing per-item thresholds in a CTE, sharing a base scan of web_sales and date_dim to avoid repeated work.",
    "target_ir": "S0 [SELECT]\n  CTE: common_scan  (via Q1)\n    FROM: web_sales\n    INNER JOIN date_dim ON d_date_sk = ws_sold_date_sk\n    WHERE: d_date BETWEEN '1999-01-29' AND (cast('1999-01-29' as date) + interval '90 day')\n      AND ws_wholesale_cost BETWEEN 35 AND 55\n  CTE: thresholds  (via Q2)\n    FROM: common_scan\n    WHERE: (ws_sales_price / ws_list_price) BETWEEN 0.76 AND 0.91\n    GROUP BY: ws_item_sk\n    SELECT: ws_item_sk, 1.3 * AVG(ws_ext_discount_amt) AS threshold\n  MAIN QUERY (via Q0)\n    FROM: common_scan cs\n    INNER JOIN item i ON cs.ws_item_sk = i.i_item_sk\n    INNER JOIN thresholds t ON cs.ws_item_sk = t.ws_item_sk\n    WHERE: (i.i_manufact_id BETWEEN 797 AND 996 OR i.i_category IN ('Men', 'Shoes', 'Sports'))\n      AND cs.ws_ext_discount_amt > t.threshold\n    ORDER BY: sum(ws_ext_discount_amt)\n    LIMIT: 100",
    "recommended_examples": [
      "pg_shared_scan_decorrelate"
    ]
  },
  {
    "target_id": "t2",
    "family": "E",
    "transform": "multi_dimension_prefetch",
    "relevance_score": 0.85,
    "hypothesis": "Shared date_dim/web_sales scan reused in main query + subquery. Precompute filtered base set to avoid redundant scans.",
    "target_ir": "S0 [SELECT]\n  CTE: base_sales  (via Q1)\n    FROM: web_sales\n    INNER JOIN date_dim ON d_date_sk = ws_sold_date_sk\n    WHERE: d_date BETWEEN '1999-01-29' AND (cast('1999-01-29' as date) + interval '90 day')\n      AND ws_wholesale_cost BETWEEN 35 AND 55\n  MAIN QUERY (via Q0)\n    FROM: base_sales bs\n    INNER JOIN item i ON bs.ws_item_sk = i.i_item_sk\n    WHERE: (i.i_manufact_id BETWEEN 797 AND 996 OR i.i_category IN ('Men', 'Shoes', 'Sports'))\n      AND bs.ws_ext_discount_amt > (\n        SELECT 1.3 * AVG(ws_ext_discount_amt)\n        FROM base_sales bs2\n        WHERE bs2.ws_item_sk = i.i_item_sk\n          AND (bs2.ws_sales_price / bs2.ws_list_price) BETWEEN 0.76 AND 0.91\n      )\n    ORDER BY: sum(ws_ext_discount_amt)\n    LIMIT: 100",
    "recommended_examples": [
      "multi_dimension_prefetch"
    ]
  },
  {
    "target_id": "t3",
    "family": "F",
    "transform": "explicit_join_materialized",
    "relevance_score": 0.75,
    "hypothesis": "Implicit comma-joins obscure join dependencies. Convert to explicit INNER JOINs with materialized base scan.",
    "target_ir": "S0 [SELECT]\n  CTE: filtered_dates  (via Q1)\n    FROM: date_dim\n    WHERE: d_date BETWEEN '1999-01-29' AND (cast('1999-01-29' as date) + interval '90 day')\n  CTE: filtered_web_sales  (via Q2)\n    FROM: web_sales\n    INNER JOIN filtered_dates ON d_date_sk = ws_sold_date_sk\n    WHERE: ws_wholesale_cost BETWEEN 35 AND 55\n  MAIN QUERY (via Q0)\n    FROM: filtered_web_sales ws\n    INNER JOIN item i ON ws.ws_item_sk = i.i_item_sk\n    WHERE: (i.i_manufact_id BETWEEN 797 AND 996 OR i.i_category IN ('Men', 'Shoes', 'Sports'))\n      AND ws.ws_ext_discount_amt > (\n        SELECT 1.3 * AVG(ws_ext_discount_amt)\n        FROM filtered_web_sales ws2\n        WHERE ws2.ws_item_sk = i.i_item_sk\n          AND (ws2.ws_sales_price / ws2.ws_list_price) BETWEEN 0.76 AND 0.91\n      )\n    ORDER BY: sum(ws_ext_discount_amt)\n    LIMIT: 100",
    "recommended_examples": [
      "pg_explicit_join_materialized"
    ]
  }
]