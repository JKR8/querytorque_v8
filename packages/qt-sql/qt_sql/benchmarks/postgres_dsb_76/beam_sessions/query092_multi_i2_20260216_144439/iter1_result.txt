{
  "iteration": 1,
  "n_api_calls": 6,
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "t1_rescue",
      "family": "B+E",
      "transform": "decorrelate_subquery_with_prefilter",
      "relevance_score": 0.95,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Equivalence (after retry): checksum c3a8064db6e63f6372e7e728577502b0 vs c68bea3e0cd84340929d2991a7779b9c",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_web_sales AS (SELECT ws_item_sk, ws_sold_date_sk, ws_ext_discount_amt, ws_wholesale_cost, ws_sales_price, ws_list_price FROM web_sales WHERE ws_wholesale_cost BETWEEN 35 AND 55 AND ws_sales_price / ws_list_price BETWEEN 76 * 0.01 AND 91 * 0.01), filtered_date_dim AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN '1999-01-29' AND CAST('1999-01-29' AS DATE) + INTERVAL '90 DAY'), thresholds AS (SELECT ws_item_sk, 1.3 * AVG(ws_ext_discount_amt) AS threshold FROM filtered_web_sales JOIN filtered_date_dim ON ws_sold_date_sk = d_date_sk GROUP BY ws_item_sk) SELECT SUM(ws_ext_discount_amt) AS \"Excess Discount Amount\" FROM filtered_web_sales AS fws JOIN item AS i ON i.i_item_sk = fws.ws_item_sk JOIN filtered_date_dim AS dd ON fws.ws_sold_date_sk = dd.d_date_sk JOIN thresholds AS t ON fws.ws_item_sk = t.ws_item_sk WHERE (i_manufact_id BETWEEN 797 AND 996 OR i_category IN ('Men', 'Shoes', 'Sports')) AND fws.ws_ext_discount_amt > t.threshold ORDER BY SUM(fws.ws_ext_discount_amt) LIMIT 100;",
      "has_explain": false
    },
    {
      "patch_id": "syn_w1_rescue",
      "family": "A+B",
      "transform": "push_item_filters_early",
      "relevance_score": 0.8,
      "status": "PENDING",
      "speedup": null,
      "semantic_passed": true,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_items AS (SELECT i_item_sk FROM item WHERE i_manufact_id BETWEEN 797 AND 996 OR i_category IN ('Men', 'Shoes', 'Sports')), common_scan AS (SELECT ws_item_sk, ws_ext_discount_amt, ws_sales_price, ws_list_price, ws_wholesale_cost FROM web_sales INNER JOIN date_dim ON d_date_sk = ws_sold_date_sk WHERE d_date BETWEEN '1999-01-29' AND CAST('1999-01-29' AS DATE) + INTERVAL '90 DAY' AND ws_wholesale_cost BETWEEN 35 AND 55), threshold_computation AS (SELECT ws_item_sk, 1.3 * AVG(ws_ext_discount_amt) AS threshold FROM common_scan WHERE ws_sales_price / ws_list_price BETWEEN 76 * 0.01 AND 91 * 0.01 GROUP BY ws_item_sk), outer_rows AS (SELECT cs.ws_item_sk, cs.ws_ext_discount_amt FROM common_scan AS cs INNER JOIN filtered_items AS fi ON cs.ws_item_sk = fi.i_item_sk), final_filtered AS (SELECT o.ws_ext_discount_amt FROM outer_rows AS o INNER JOIN threshold_computation AS t ON o.ws_item_sk = t.ws_item_sk WHERE o.ws_ext_discount_amt > t.threshold) SELECT SUM(ws_ext_discount_amt) AS \"Excess Discount Amount\" FROM final_filtered ORDER BY SUM(ws_ext_discount_amt) LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "t2_refine",
      "family": "F",
      "transform": "explicit_join_order",
      "relevance_score": 0.85,
      "status": "PENDING",
      "speedup": null,
      "semantic_passed": true,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_items AS (SELECT i_item_sk FROM item WHERE i_manufact_id BETWEEN 797 AND 996 OR i_category IN ('Men', 'Shoes', 'Sports')), filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1999-01-29' AND CAST('1999-01-29' AS DATE) + INTERVAL '90 DAY') SELECT SUM(ws_ext_discount_amt) AS \"Excess Discount Amount\" FROM web_sales INNER JOIN filtered_items ON ws_item_sk = filtered_items.i_item_sk INNER JOIN filtered_dates ON ws_sold_date_sk = filtered_dates.d_date_sk WHERE ws_wholesale_cost BETWEEN 35 AND 55 AND ws_ext_discount_amt > (SELECT 1.3 * AVG(ws_ext_discount_amt) FROM web_sales INNER JOIN filtered_dates ON ws_sold_date_sk = filtered_dates.d_date_sk WHERE ws_item_sk = filtered_items.i_item_sk AND ws_wholesale_cost BETWEEN 35 AND 55 AND ws_sales_price / ws_list_price BETWEEN 76 * 0.01 AND 91 * 0.01) ORDER BY SUM(ws_ext_discount_amt) LIMIT 100;",
      "has_explain": true
    }
  ],
  "explains": {
    "syn_w1_rescue": "Limit  (rows=1, time=40.925)\n  Gather  (rows=13441, time=28.387)\n    Nested Loop  (rows=6720, time=25.902)\n      Seq Scan on date_dim  (rows=46, time=4.63)\n      Index Scan on web_sales  (rows=148, time=0.455)\n  Sort  (rows=1, time=40.853)\n    Aggregate  (rows=1, time=40.823)\n      Nested Loop  (rows=2067, time=40.664)\n        Hash Join  (rows=3962, time=37.004)\n          CTE Scan (cs)  (rows=13441, time=4.733)\n          Hash  (rows=824, time=30.731)\n            Aggregate  (rows=824, time=30.664",
    "t2_refine": "Limit  (rows=1, time=8655.793)\n  Index Scan on date_dim  (rows=91, time=1.311)\n  Sort  (rows=1, time=8655.789)\n    Aggregate  (rows=1, time=8655.773)\n      Hash Join  (rows=2067, time=8654.124)\n        Nested Loop  (rows=13441, time=33.913)\n          CTE Scan (filtered_dates)  (rows=91, time=0.642)\n          Index Scan on web_sales  (rows=148, time=0.341)\n        Hash  (rows=46621, time=32.961)\n          Seq Scan on item  (rows=46621, time=28.05)\n        Aggregate  (rows=1, time=1.296)\n         "
  }
}