{
  "iteration": 0,
  "n_api_calls": 14,
  "beam_cost_usd": 0.05174275,
  "beam_cost_priced_calls": 14,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 175574,
    "completion_tokens": 40679,
    "total_tokens": 216253,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 60608,
    "reasoning_tokens": 20697
  },
  "best_speedup": 1.27,
  "best_patch_id": "p06",
  "best_sql": "WITH filtered_date_dim AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1191 AND 1191 + 23), filtered_catalog_sales AS (SELECT cs_ship_date_sk, cs_sold_date_sk, cs_warehouse_sk, cs_ship_mode_sk, cs_call_center_sk, cs_list_price FROM catalog_sales WHERE cs_list_price BETWEEN 244 AND 273) select \n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\"\nfrom\n   filtered_catalog_sales cs\n  ,warehouse w\n  ,ship_mode sm\n  ,call_center cc\n  ,filtered_date_dim d\nwhere\n  cs_ship_date_sk   = d_date_sk\n  and cs_warehouse_sk   = w_warehouse_sk\n  and cs_ship_mode_sk   = sm_ship_mode_sk\n  and cs_call_center_sk = cc_call_center_sk\n  and sm_type = 'LIBRARY'\n  and cc_class = 'medium'\n  and w_gmt_offset = -5\ngroup by\n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\norder by substring(w_warehouse_name,1,20)\n        ,sm_type\n        ,cc_name\nlimit 100;",
  "patches": [
    {
      "patch_id": "p07",
      "family": "A",
      "transform": "early_filter",
      "relevance_score": 0.7,
      "status": "REGRESSION",
      "speedup": 0.29,
      "semantic_passed": true,
      "error": null,
      "original_ms": 9251.1,
      "patch_ms": 31984.7,
      "output_sql": "SELECT\n  SUBSTRING(w_warehouse_name, 1, 20),\n  sm_type,\n  cc_name,\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\",\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\",\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\",\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\",\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\"\nFROM\n  date_dim d\nJOIN\n  catalog_sales cs ON cs_ship_date_sk = d_date_sk\nJOIN\n  warehouse w ON cs_warehouse_sk = w_warehouse_sk\nJOIN\n  ship_mode sm ON cs_ship_mode_sk = sm_ship_mode_sk\nJOIN\n  call_center cc ON cs_call_center_sk = cc_call_center_sk\nWHERE\n  d_month_seq BETWEEN 1191 AND 1191 + 23\n  AND cs_list_price BETWEEN 244 AND 273\n  AND sm_type = 'LIBRARY'\n  AND cc_class = 'medium'\n  AND w_gmt_offset = -5\nGROUP BY\n  SUBSTRING(w_warehouse_name, 1, 20),\n  sm_type,\n  cc_name\nORDER BY\n  SUBSTRING(w_warehouse_name, 1, 20),\n  sm_type,\n  cc_name\nLIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Push cs_list_price filter into catalog_sales scan early by restructuring joins to start with date_dim and catalog_sales with all selective predicates applied."
    },
    {
      "patch_id": "p05",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.6,
      "status": "REGRESSION",
      "speedup": 0.39,
      "semantic_passed": true,
      "error": null,
      "original_ms": 9251.1,
      "patch_ms": 23715.5,
      "output_sql": "WITH preagg_catalog_sales AS (SELECT cs_ship_date_sk, cs_warehouse_sk, cs_ship_mode_sk, cs_call_center_sk, sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end) as \"30 days\", sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end ) as \"31-60 days\", sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end) as \"61-90 days\", sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end) as \"91-120 days\", sum(case when (cs_ship_date_sk - cs_sold_date_sk  > 120) then 1 else 0 end) as \">120 days\" FROM catalog_sales WHERE cs_list_price between 244 and 273 GROUP BY cs_ship_date_sk, cs_warehouse_sk, cs_ship_mode_sk, cs_call_center_sk) select \n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\"\nfrom\n   catalog_sales\n  ,warehouse\n  ,ship_mode\n  ,call_center\n  ,date_dim\nwhere\nd_month_seq between 1191 and 1191 + 23\nand cs_ship_date_sk   = d_date_sk\nand cs_warehouse_sk   = w_warehouse_sk\nand cs_ship_mode_sk   = sm_ship_mode_sk\nand cs_call_center_sk = cc_call_center_sk\nand cs_list_price between 244 and 273\nand sm_type = 'LIBRARY'\nand cc_class = 'medium'\nand w_gmt_offset = -5\ngroup by\n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\norder by substring(w_warehouse_name,1,20)\n        ,sm_type\n        ,cc_name\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-aggregate catalog_sales by cs_ship_date_sk, cs_warehouse_sk, cs_ship_mode_sk, cs_call_center_sk with conditional sums before joining dimensions."
    },
    {
      "patch_id": "p01",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.85,
      "status": "REGRESSION",
      "speedup": 0.29,
      "semantic_passed": true,
      "error": null,
      "original_ms": 9251.1,
      "patch_ms": 31984.7,
      "output_sql": "WITH joined_data AS (WITH filtered_dates AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_month_seq BETWEEN 1191 AND 1191 + 23\n)\nSELECT cs.cs_sold_date_sk, cs.cs_ship_date_sk, cs.cs_warehouse_sk, cs.cs_ship_mode_sk, cs.cs_call_center_sk\nFROM catalog_sales cs\nJOIN filtered_dates fd ON cs.cs_ship_date_sk = fd.d_date_sk\nWHERE cs.cs_list_price BETWEEN 244 AND 273), aggregate_node AS (SELECT SUBSTRING(w.w_warehouse_name FROM 1 FOR 20) AS w_warehouse_name_sub, sm.sm_type, cc.cc_name,\n       SUM(CASE WHEN (cs.cs_ship_date_sk - cs.cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\",\n       SUM(CASE WHEN (cs.cs_ship_date_sk - cs.cs_sold_date_sk > 30) AND (cs.cs_ship_date_sk - cs.cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\",\n       SUM(CASE WHEN (cs.cs_ship_date_sk - cs.cs_sold_date_sk > 60) AND (cs.cs_ship_date_sk - cs.cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\",\n       SUM(CASE WHEN (cs.cs_ship_date_sk - cs.cs_sold_date_sk > 90) AND (cs.cs_ship_date_sk - cs.cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\",\n       SUM(CASE WHEN (cs.cs_ship_date_sk - cs.cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\"\nFROM joined_data cs\nJOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk\nJOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk\nJOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk\nWHERE sm.sm_type = 'LIBRARY'\n  AND cc.cc_class = 'medium'\n  AND w.w_gmt_offset = -5\nGROUP BY SUBSTRING(w.w_warehouse_name FROM 1 FOR 20), sm.sm_type, cc.cc_name\nORDER BY SUBSTRING(w.w_warehouse_name FROM 1 FOR 20), sm.sm_type, cc.cc_name\nLIMIT 100) select \n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\"\nfrom\n   catalog_sales\n  ,warehouse\n  ,ship_mode\n  ,call_center\n  ,date_dim\nwhere\nd_month_seq between 1191 and 1191 + 23\nand cs_ship_date_sk   = d_date_sk\nand cs_warehouse_sk   = w_warehouse_sk\nand cs_ship_mode_sk   = sm_ship_mode_sk\nand cs_call_center_sk = cc_call_center_sk\nand cs_list_price between 244 and 273\nand sm_type = 'LIBRARY'\nand cc_class = 'medium'\nand w_gmt_offset = -5\ngroup by\n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\norder by substring(w_warehouse_name,1,20)\n        ,sm_type\n        ,cc_name\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Isolate date_dim filter into a CTE, convert comma joins to explicit JOIN syntax, and join with catalog_sales early to allow better join reordering and early filtering."
    },
    {
      "patch_id": "p06",
      "family": "F",
      "transform": "materialized_dimension_fact_prefilter",
      "relevance_score": 0.58,
      "status": "WIN",
      "speedup": 1.27,
      "semantic_passed": true,
      "error": null,
      "original_ms": 9251.1,
      "patch_ms": 7277.5,
      "output_sql": "WITH filtered_date_dim AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1191 AND 1191 + 23), filtered_catalog_sales AS (SELECT cs_ship_date_sk, cs_sold_date_sk, cs_warehouse_sk, cs_ship_mode_sk, cs_call_center_sk, cs_list_price FROM catalog_sales WHERE cs_list_price BETWEEN 244 AND 273) select \n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\"\nfrom\n   filtered_catalog_sales cs\n  ,warehouse w\n  ,ship_mode sm\n  ,call_center cc\n  ,filtered_date_dim d\nwhere\n  cs_ship_date_sk   = d_date_sk\n  and cs_warehouse_sk   = w_warehouse_sk\n  and cs_ship_mode_sk   = sm_ship_mode_sk\n  and cs_call_center_sk = cc_call_center_sk\n  and sm_type = 'LIBRARY'\n  and cc_class = 'medium'\n  and w_gmt_offset = -5\ngroup by\n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\norder by substring(w_warehouse_name,1,20)\n        ,sm_type\n        ,cc_name\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Materialize filtered date_dim and catalog_sales into CTEs, then join with other dimensions to reduce search space for join predicates."
    },
    {
      "patch_id": "p02",
      "family": "A",
      "transform": "multi_dimension_prefetch",
      "relevance_score": 0.55,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: relation \"filtered_catalog_sales\" does not exist\nLINE 26:   filtered_catalog_sales cs\n           ^\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_warehouse AS (\n  SELECT w_warehouse_sk\n  FROM warehouse\n  WHERE w_gmt_offset = -5\n),\nfiltered_ship_mode AS (\n  SELECT sm_ship_mode_sk\n  FROM ship_mode\n  WHERE sm_type = 'LIBRARY'\n),\nfiltered_call_center AS (\n  SELECT cc_call_center_sk\n  FROM call_center\n  WHERE cc_class = 'medium'\n)\nSELECT\n  SUBSTRING(w_warehouse_name FROM 1 FOR 20),\n  sm_type,\n  cc_name,\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\",\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\",\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\",\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\",\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\"\nFROM\n  filtered_catalog_sales cs\nJOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk\nJOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk\nJOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk\nJOIN date_dim d ON cs.cs_ship_date_sk = d.d_date_sk\nWHERE\n  d.d_month_seq BETWEEN 1191 AND 1191 + 23\nGROUP BY\n  SUBSTRING(w_warehouse_name FROM 1 FOR 20),\n  sm_type,\n  cc_name\nORDER BY\n  SUBSTRING(w_warehouse_name FROM 1 FOR 20),\n  sm_type,\n  cc_name\nLIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre-filter all selective dimensions (date_dim, warehouse, ship_mode, call_center) into CTEs, then join with catalog_sales in a single pass to compound selectivity."
    },
    {
      "patch_id": "p03",
      "family": "A",
      "transform": "prefetch_fact_join",
      "relevance_score": 0.5,
      "status": "REGRESSION",
      "speedup": 0.83,
      "semantic_passed": true,
      "error": null,
      "original_ms": 9251.1,
      "patch_ms": 11149.8,
      "output_sql": "WITH filtered_catalog_sales AS (WITH filtered_date_dim AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1191 AND 1191 + 23) SELECT cs.cs_ship_date_sk, cs.cs_sold_date_sk, cs.cs_warehouse_sk, cs.cs_ship_mode_sk, cs.cs_call_center_sk, cs.cs_list_price FROM catalog_sales cs JOIN filtered_date_dim dd ON cs.cs_ship_date_sk = dd.d_date_sk WHERE cs.cs_list_price BETWEEN 244 AND 273) SELECT SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name, SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM filtered_catalog_sales cs JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk WHERE sm.sm_type = 'LIBRARY' AND cc.cc_class = 'medium' AND w.w_gmt_offset = -5 GROUP BY SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name ORDER BY SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Build CTE chain: filter date_dim, join with catalog_sales, then progressively join with other dimensions to reduce fact table rows early."
    },
    {
      "patch_id": "p04",
      "family": "A",
      "transform": "dimension_cte_isolate",
      "relevance_score": 0.52,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Retry failed: Missing SQL for tree node `ship_mode`",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH catalog_sales_prefiltered AS (SELECT cs_sold_date_sk, cs_ship_date_sk, cs_call_center_sk, cs_ship_mode_sk, cs_warehouse_sk, cs_list_price FROM catalog_sales WHERE cs_list_price BETWEEN 244 AND 273), ship_mode_cte AS (SELECT sm_ship_mode_sk FROM ship_mode WHERE sm_type = 'LIBRARY'), call_center_cte AS (SELECT cc_call_center_sk FROM call_center WHERE cc_class = 'medium'), warehouse_cte AS (SELECT w_warehouse_sk FROM warehouse WHERE w_gmt_offset = -5), date_dim_cte AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1191 AND 1191 + 23) SELECT SUBSTRING(w_warehouse_name,1,20) ,sm_type ,cc_name ,sum(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30 ) THEN 1 ELSE 0 END) AS \"30 days\" ,sum(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END ) AS \"31-60 days\" ,sum(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\" ,sum(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\" ,sum(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM catalog_sales_prefiltered cs JOIN date_dim_cte d ON cs.cs_ship_date_sk = d.d_date_sk JOIN ship_mode_cte sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN call_center_cte cc ON cs.cs_call_center_sk = cc.cc_call_center_sk JOIN warehouse_cte w ON cs.cs_warehouse_sk = w.w_warehouse_sk GROUP BY SUBSTRING(w_warehouse_name,1,20) ,sm_type ,cc_name ORDER BY SUBSTRING(w_warehouse_name,1,20) ,sm_type ,cc_name LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre-filter each dimension table into CTEs returning only surrogate keys, then join with catalog_sales to reduce scan rows."
    },
    {
      "patch_id": "p08",
      "family": "A",
      "transform": "sf_sk_pushdown_multi_fact",
      "relevance_score": 0.45,
      "status": "REGRESSION",
      "speedup": 0.74,
      "semantic_passed": true,
      "error": null,
      "original_ms": 9251.1,
      "patch_ms": 12549.3,
      "output_sql": "select \n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\"\nfrom\n   catalog_sales\n  ,warehouse\n  ,ship_mode\n  ,call_center\n  ,date_dim\nwhere\nd_month_seq between 1191 and 1191 + 23\nand cs_ship_date_sk   = d_date_sk\nand cs_warehouse_sk   = w_warehouse_sk\nand cs_ship_mode_sk   = sm_ship_mode_sk\nand cs_call_center_sk = cc_call_center_sk\nand cs_list_price between 244 and 273\nand sm_type = 'LIBRARY'\nand cc_class = 'medium'\nand w_gmt_offset = -5\ngroup by\n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\norder by substring(w_warehouse_name,1,20)\n        ,sm_type\n        ,cc_name\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Push date_sk range predicate (derived from d_month_seq) directly into catalog_sales join condition to enable partition pruning or index usage."
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Missing SQL for tree node `warehouse`",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "compile_p2",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: Column mismatch: 1 missing, 1 extra",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date_dim AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_month_seq BETWEEN 1191 AND 1191 + 23\n),\nfiltered_warehouse AS (\n  SELECT w_warehouse_sk, w_warehouse_name\n  FROM warehouse\n  WHERE w_gmt_offset = -5\n),\nfiltered_ship_mode AS (\n  SELECT sm_ship_mode_sk, sm_type\n  FROM ship_mode\n  WHERE sm_type = 'LIBRARY'\n),\nfiltered_call_center AS (\n  SELECT cc_call_center_sk, cc_name\n  FROM call_center\n  WHERE cc_class = 'medium'\n),\nfiltered_catalog_sales AS (\n  SELECT cs_ship_date_sk, cs_sold_date_sk, cs_warehouse_sk, cs_ship_mode_sk, cs_call_center_sk\n  FROM catalog_sales\n  WHERE cs_list_price BETWEEN 244 AND 273\n)\nSELECT\n  SUBSTRING(w.w_warehouse_name, 1, 20),\n  sm.sm_type,\n  cc.cc_name,\n  SUM(CASE WHEN (cs.cs_ship_date_sk - cs.cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\",\n  SUM(CASE WHEN (cs.cs_ship_date_sk - cs.cs_sold_date_sk > 30) AND (cs.cs_ship_date_sk - cs.cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\",\n  SUM(CASE WHEN (cs.cs_ship_date_sk - cs.cs_sold_date_sk > 60) AND (cs.cs_ship_date_sk - cs.cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\",\n  SUM(CASE WHEN (cs.cs_ship_date_sk - cs.cs_sold_date_sk > 90) AND (cs.cs_ship_date_sk - cs.cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\",\n  SUM(CASE WHEN (cs.cs_ship_date_sk - cs.cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\"\nFROM filtered_catalog_sales cs\nJOIN filtered_date_dim d ON cs.cs_ship_date_sk = d.d_date_sk\nJOIN filtered_warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk\nJOIN filtered_ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk\nJOIN filtered_call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk\nGROUP BY SUBSTRING(w.w_warehouse_name, 1, 20), sm.sm_type, cc.cc_name\nORDER BY SUBSTRING(w.w_warehouse_name, 1, 20), sm.sm_type, cc.cc_name\nLIMIT 100;",
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.57,
      "semantic_passed": true,
      "error": null,
      "original_ms": 6990.5,
      "patch_ms": 12254.2,
      "output_sql": "WITH filtered_date_dim AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1191 AND 1191 + 23), filtered_catalog_sales AS (SELECT cs_ship_date_sk, cs_sold_date_sk, cs_warehouse_sk, cs_ship_mode_sk, cs_call_center_sk, cs_list_price FROM catalog_sales WHERE cs_list_price BETWEEN 244 AND 273) SELECT substring(w_warehouse_name,1,20), sm_type, cc_name, sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end) as \"30 days\", sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end ) as \"31-60 days\", sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end) as \"61-90 days\", sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end) as \"91-120 days\", sum(case when (cs_ship_date_sk - cs_sold_date_sk  > 120) then 1 else 0 end) as \">120 days\" FROM filtered_catalog_sales cs, warehouse w, ship_mode sm, call_center cc, filtered_date_dim d WHERE cs_ship_date_sk = d_date_sk AND cs_warehouse_sk = w_warehouse_sk AND cs_ship_mode_sk = sm_ship_mode_sk AND cs_call_center_sk = cc_call_center_sk AND sm_type = 'LIBRARY' AND cc_class = 'medium' AND w_gmt_offset = -5 GROUP BY substring(w_warehouse_name,1,20), sm_type, cc_name ORDER BY substring(w_warehouse_name,1,20), sm_type, cc_name LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p2",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "IMPROVED",
      "speedup": 1.1,
      "semantic_passed": true,
      "error": null,
      "original_ms": 6990.5,
      "patch_ms": 6370.4,
      "output_sql": "WITH filtered_date_dim AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1191 AND 1191 + 23), filtered_catalog_sales AS (SELECT cs_ship_date_sk, cs_sold_date_sk, cs_warehouse_sk, cs_ship_mode_sk, cs_call_center_sk, cs_list_price FROM catalog_sales WHERE cs_list_price BETWEEN 244 AND 273) SELECT substring(w_warehouse_name,1,20), sm_type, cc_name, sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end) as \"30 days\", sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end ) as \"31-60 days\", sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end) as \"61-90 days\", sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end) as \"91-120 days\", sum(case when (cs_ship_date_sk - cs_sold_date_sk  > 120) then 1 else 0 end) as \">120 days\" FROM filtered_catalog_sales cs JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk JOIN filtered_date_dim d ON cs.cs_ship_date_sk = d.d_date_sk WHERE sm.sm_type = 'LIBRARY' AND cc.cc_class = 'medium' AND w.w_gmt_offset = -5 GROUP BY substring(w_warehouse_name,1,20), sm_type, cc_name ORDER BY substring(w_warehouse_name,1,20), sm_type, cc_name LIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p07": "Limit  (rows=11, time=14468.095)\n  Aggregate  (rows=11, time=14468.092)\n    Gather Merge  (rows=11, time=14468.08)\n      Aggregate  (rows=11, time=14467.475)\n        Sort  (rows=2477, time=14467.041)\n          Nested Loop  (rows=2477, time=14457.532)\n            Hash Join  (rows=3861, time=14426.868)\n              Hash Join  (rows=14844, time=14409.063)\n                Nested Loop  (rows=77609, time=14358.02)\n                  Index Only Scan on date_dim (d)  (rows=731, time=4.333)\n             ",
    "p05": "Limit  (rows=11, time=6345.751)\n  Aggregate  (rows=11, time=6345.747)\n    Gather Merge  (rows=18, time=6345.71)\n      Aggregate  (rows=9, time=4953.954)\n        Sort  (rows=1238, time=4953.55)\n          Nested Loop  (rows=1238, time=4949.955)\n            Hash Join  (rows=1930, time=4940.342)\n              Hash Join  (rows=7422, time=4934.273)\n                Nested Loop  (rows=38804, time=4919.703)\n                  Index Only Scan on date_dim  (rows=366, time=2.155)\n                  Index Scan",
    "p01": "Limit  (rows=11, time=11929.725)\n  Aggregate  (rows=11, time=11929.72)\n    Gather Merge  (rows=18, time=11929.685)\n      Aggregate  (rows=9, time=9466.552)\n        Sort  (rows=1238, time=9466.045)\n          Nested Loop  (rows=1238, time=9459.728)\n            Hash Join  (rows=1930, time=9439.201)\n              Hash Join  (rows=7422, time=9424.745)\n                Nested Loop  (rows=38804, time=9389.793)\n                  Index Only Scan on date_dim  (rows=366, time=2.92)\n                  Index S",
    "p06": "Limit  (rows=11, time=13940.67)\n  Aggregate  (rows=11, time=13940.662)\n    Gather Merge  (rows=18, time=13940.622)\n      Aggregate  (rows=9, time=10894.851)\n        Sort  (rows=1238, time=10894.443)\n          Nested Loop  (rows=1238, time=10887.11)\n            Hash Join  (rows=1930, time=10864.452)\n              Hash Join  (rows=7422, time=10848.268)\n                Nested Loop  (rows=38804, time=10808.813)\n                  Index Only Scan on date_dim  (rows=366, time=4.5)\n                  Ind",
    "p03": "Limit  (rows=11, time=13308.729)\n  Aggregate  (rows=11, time=13308.722)\n    Gather Merge  (rows=18, time=13308.694)\n      Aggregate  (rows=9, time=10688.569)\n        Sort  (rows=1238, time=10688.223)\n          Nested Loop  (rows=1238, time=10681.481)\n            Hash Join  (rows=1930, time=10658.952)\n              Hash Join  (rows=7422, time=10643.565)\n                Nested Loop  (rows=38804, time=10604.911)\n                  Index Only Scan on date_dim  (rows=366, time=4.553)\n                 ",
    "p08": "Limit  (rows=11, time=10977.016)\n  Aggregate  (rows=11, time=10977.011)\n    Gather Merge  (rows=18, time=10976.987)\n      Aggregate  (rows=9, time=9230.461)\n        Sort  (rows=1238, time=9230.091)\n          Nested Loop  (rows=1238, time=9224.033)\n            Hash Join  (rows=1930, time=9205.351)\n              Hash Join  (rows=7422, time=9192.659)\n                Nested Loop  (rows=38804, time=9160.335)\n                  Index Only Scan on date_dim  (rows=366, time=3.452)\n                  Index",
    "compile_p1": "Limit  (rows=11, time=15839.919)\n  Aggregate  (rows=11, time=15839.915)\n    Gather Merge  (rows=11, time=15839.902)\n      Aggregate  (rows=11, time=15839.234)\n        Sort  (rows=2477, time=15838.736)\n          Nested Loop  (rows=2477, time=15829.213)\n            Hash Join  (rows=3861, time=15800.168)\n              Hash Join  (rows=14844, time=15779.52)\n                Nested Loop  (rows=77609, time=15724.06)\n                  Index Only Scan on date_dim  (rows=731, time=5.128)\n                 ",
    "compile_p2": "Limit  (rows=11, time=10529.909)\n  Aggregate  (rows=11, time=10529.905)\n    Gather Merge  (rows=18, time=10529.88)\n      Aggregate  (rows=9, time=8337.253)\n        Sort  (rows=1238, time=8336.92)\n          Nested Loop  (rows=1238, time=8331.234)\n            Hash Join  (rows=1930, time=8313.956)\n              Hash Join  (rows=7422, time=8302.454)\n                Nested Loop  (rows=38804, time=8275.09)\n                  Index Only Scan on date_dim  (rows=366, time=3.057)\n                  Index Sc"
  }
}