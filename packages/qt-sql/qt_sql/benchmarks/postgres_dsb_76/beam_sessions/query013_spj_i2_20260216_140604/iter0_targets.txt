[
  {
    "target_id": "t1",
    "family": "E",
    "transform": "multi_dimension_prefetch",
    "relevance_score": 0.97,
    "hypothesis": "Repeated dimension scans (customer_demographics, customer_address) in OR branches cause redundant work. Materialize pre-filtered dimensions first.",
    "target_ir": "S0 [SELECT]\n  CTE: prefetch_demo (via Q1)\n    FROM: customer_demographics\n    WHERE: (cd_marital_status = 'M' AND cd_education_status = '2 yr Degree')\n           OR (cd_marital_status = 'S' AND cd_education_status = 'Primary')\n           OR (cd_marital_status = 'W' AND cd_education_status = 'Primary')\n  CTE: prefetch_addr (via Q2)\n    FROM: customer_address\n    WHERE: ca_country = 'United States'\n           AND (\n                 (ca_state IN ('GA','KY','SD'))\n                 OR (ca_state IN ('AR','IN','VA'))\n                 OR (ca_state IN ('KS','OH','SD'))\n               )\n  MAIN QUERY (via Q0)\n    FROM: store_sales\n    INNER JOIN store ON s_store_sk = ss_store_sk\n    INNER JOIN date_dim ON ss_sold_date_sk = d_date_sk\n    INNER JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk\n    INNER JOIN prefetch_demo ON cd_demo_sk = ss_cdemo_sk\n    INNER JOIN prefetch_addr ON ss_addr_sk = ca_address_sk\n    WHERE: d_year = 2001\n           AND (\n                 (ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3)\n                 OR (ss_sales_price BETWEEN 50.00 AND 100.00 AND hd_dep_count = 1)\n                 OR (ss_sales_price BETWEEN 150.00 AND 200.00 AND hd_dep_count = 1)\n               )\n           AND (\n                 (ss_net_profit BETWEEN 100 AND 200)\n                 OR (ss_net_profit BETWEEN 150 AND 300)\n                 OR (ss_net_profit BETWEEN 50 AND 250)\n               )\n    AGGREGATE: MIN(ss_quantity), MIN(ss_ext_sales_price), MIN(ss_ext_wholesale_cost), MIN(ss_ext_wholesale_cost)",
    "recommended_examples": [
      "multi_dimension_prefetch"
    ]
  },
  {
    "target_id": "t2",
    "family": "D",
    "transform": "or_to_union",
    "relevance_score": 0.93,
    "hypothesis": "OR conditions force nested loop evaluation. Convert to UNION ALL branches for independent optimization.",
    "target_ir": "S0 [SELECT]\n  CTE: branch1 (via Q1)\n    FROM: store_sales\n    INNER JOIN store ON s_store_sk = ss_store_sk\n    INNER JOIN date_dim ON ss_sold_date_sk = d_date_sk\n    INNER JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk\n    INNER JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk\n    INNER JOIN customer_address ON ss_addr_sk = ca_address_sk\n    WHERE: d_year = 2001\n           AND cd_marital_status = 'M'\n           AND cd_education_status = '2 yr Degree'\n           AND ss_sales_price BETWEEN 100.00 AND 150.00\n           AND hd_dep_count = 3\n           AND ca_country = 'United States'\n           AND ca_state IN ('GA','KY','SD')\n           AND ss_net_profit BETWEEN 100 AND 200\n  CTE: branch2 (via Q2)\n    FROM: ... (same joins)\n    WHERE: ... (S/Primary/50-100/dep_count=1/AR-IN-VA/150-300)\n  CTE: branch3 (via Q3)\n    FROM: ... (same joins)\n    WHERE: ... (W/Primary/150-200/dep_count=1/KS-OH-SD/50-250)\n  MAIN QUERY (via Q0)\n    FROM: (\n        SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost FROM branch1\n        UNION ALL\n        SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost FROM branch2\n        UNION ALL\n        SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost FROM branch3\n    ) unified\n    AGGREGATE: MIN(ss_quantity), MIN(ss_ext_sales_price), MIN(ss_ext_wholesale_cost), MIN(ss_ext_wholesale_cost)",
    "recommended_examples": [
      "pg_intersect_to_exists"
    ]
  },
  {
    "target_id": "t3",
    "family": "F",
    "transform": "explicit_join_ordering",
    "relevance_score": 0.88,
    "hypothesis": "Implicit cross joins prevent optimal join order. Restructure as explicit joins with selective tables first.",
    "target_ir": "S0 [SELECT]\n  FROM: date_dim\n  INNER JOIN store_sales ON d_date_sk = ss_sold_date_sk\n  INNER JOIN store ON s_store_sk = ss_store_sk\n  INNER JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk\n  INNER JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk\n  INNER JOIN customer_address ON ss_addr_sk = ca_address_sk\n  WHERE: d_year = 2001\n         AND (\n               (cd_marital_status = 'M' AND cd_education_status = '2 yr Degree' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3)\n               OR ... (other OR conditions)\n             )\n         AND (\n               (ca_country = 'United States' AND ca_state IN ('GA','KY','SD') AND ss_net_profit BETWEEN 100 AND 200)\n               OR ... (other OR conditions)\n             )\n  AGGREGATE: MIN(ss_quantity), MIN(ss_ext_sales_price), MIN(ss_ext_wholesale_cost), MIN(ss_ext_wholesale_cost)",
    "recommended_examples": [
      "pg_explicit_join_materialized"
    ]
  },
  {
    "target_id": "t4",
    "family": "A",
    "transform": "dimension_predicate_push",
    "relevance_score": 0.85,
    "hypothesis": "Late-applied dimension filters increase join cardinality. Push date_dim and household_demographics filters earlier.",
    "target_ir": "S0 [SELECT]\n  CTE: filtered_date (via Q1)\n    FROM: date_dim\n    WHERE: d_year = 2001\n  CTE: filtered_hd (via Q2)\n    FROM: household_demographics\n    WHERE: hd_dep_count IN (1,3)\n  MAIN QUERY (via Q0)\n    FROM: store_sales\n    INNER JOIN store ON s_store_sk = ss_store_sk\n    INNER JOIN filtered_date ON ss_sold_date_sk = d_date_sk\n    INNER JOIN filtered_hd ON ss_hdemo_sk = hd_demo_sk\n    INNER JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk\n    INNER JOIN customer_address ON ss_addr_sk = ca_address_sk\n    WHERE: ... (original OR conditions)\n    AGGREGATE: MIN(ss_quantity), MIN(ss_ext_sales_price), MIN(ss_ext_wholesale_cost), MIN(ss_ext_wholesale_cost)",
    "recommended_examples": [
      "pg_date_cte_explicit_join"
    ]
  }
]