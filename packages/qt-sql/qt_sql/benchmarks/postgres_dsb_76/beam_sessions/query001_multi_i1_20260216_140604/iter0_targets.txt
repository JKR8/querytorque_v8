[
  {
    "target_id": "t1",
    "family": "B",
    "transform": "decorrelate_subquery",
    "relevance_score": 0.95,
    "hypothesis": "Correlated subquery re-scans entire customer_total_return CTE per row of outer CTE scan. Decorrelation eliminates per-row execution by precomputing store-level aggregates.",
    "target_ir": "S0 [SELECT]\n  CTE: customer_total_return  (via CTE_Q_S0_customer_total_return)\n    FROM: store_returns, date_dim\n    WHERE [ddc05012d854ff26]: sr_returned_date_sk = d_date_sk AND d_year = 2002 AND sr_return_amt / sr_return_quantity BETWEEN 108 AND 167\n    GROUP BY: sr_customer_sk, sr_store_sk, sr_reason_sk\n  CTE: store_avg_return\n    FROM: customer_total_return\n    GROUP BY: ctr_store_sk\n    SELECT: ctr_store_sk, AVG(ctr_total_return)*1.2 AS threshold\n  MAIN QUERY (via Q_S0)\n    FROM: customer_total_return ctr1\n    INNER JOIN store_avg_return sar ON ctr1.ctr_store_sk = sar.ctr_store_sk\n    , store, customer, customer_demographics\n    WHERE [a05952426f9ba20b]: ctr1.ctr_total_return > sar.threshold\n    AND ctr1.ctr_reason_sk BETWEEN 43 AND 46\n    AND s_store_sk = ctr1.ctr_store_sk\n    AND s_state IN ('IL', 'KY', 'TX')\n    AND ctr1.ctr_customer_sk = c_customer_sk\n    AND c_current_cdemo_sk = cd_demo_sk\n    AND cd_marital_status IN ('M', 'M')\n    AND cd_education_status IN ('Advanced Degree', 'College')\n    AND cd_gender = 'F'\n    AND c_birth_month = 2\n    AND c_birth_year BETWEEN 1965 AND 1971\n    ORDER BY: c_customer_id\n    LIMIT: 100",
    "recommended_examples": [
      "pg_shared_scan_decorrelate"
    ]
  },
  {
    "target_id": "t2",
    "family": "A",
    "transform": "push_store_filters",
    "relevance_score": 0.85,
    "hypothesis": "Store state filter applied late in main query. Pushing into CTE reduces rows before aggregation and eliminates separate store scan.",
    "target_ir": "S0 [SELECT]\n  CTE: customer_total_return  (via CTE_Q_S0_customer_total_return)\n    FROM: store_returns, date_dim, store\n    WHERE [ddc05012d854ff26]: sr_returned_date_sk = d_date_sk \n      AND d_year = 2002 \n      AND sr_return_amt / sr_return_quantity BETWEEN 108 AND 167\n      AND s_store_sk = sr_store_sk\n      AND s_state IN ('IL', 'KY', 'TX')\n    GROUP BY: sr_customer_sk, sr_store_sk, sr_reason_sk\n  MAIN QUERY (via Q_S0)\n    FROM: customer_total_return ctr1, customer, customer_demographics\n    WHERE [a05952426f9ba20b]: ctr1.ctr_total_return > (subquery remains)\n    AND ctr1.ctr_reason_sk BETWEEN 43 AND 46\n    AND ctr1.ctr_customer_sk = c_customer_sk\n    AND c_current_cdemo_sk = cd_demo_sk\n    AND cd_marital_status IN ('M', 'M')\n    AND cd_education_status IN ('Advanced Degree', 'College')\n    AND cd_gender = 'F'\n    AND c_birth_month = 2\n    AND c_birth_year BETWEEN 1965 AND 1971\n    ORDER BY: c_customer_id\n    LIMIT: 100",
    "recommended_examples": [
      "pg_date_cte_explicit_join"
    ]
  },
  {
    "target_id": "t3",
    "family": "A",
    "transform": "push_reason_filter",
    "relevance_score": 0.75,
    "hypothesis": "ctr_reason_sk filter applied late in main query. Pushing into CTE reduces aggregation workload.",
    "target_ir": "S0 [SELECT]\n  CTE: customer_total_return  (via CTE_Q_S0_customer_total_return)\n    FROM: store_returns, date_dim\n    WHERE [ddc05012d854ff26]: sr_returned_date_sk = d_date_sk \n      AND d_year = 2002 \n      AND sr_return_amt / sr_return_quantity BETWEEN 108 AND 167\n      AND sr_reason_sk BETWEEN 43 AND 46\n    GROUP BY: sr_customer_sk, sr_store_sk, sr_reason_sk\n  MAIN QUERY (via Q_S0)\n    FROM: customer_total_return ctr1, store, customer, customer_demographics\n    WHERE [a05952426f9ba20b]: ctr1.ctr_total_return > (subquery remains)\n    AND s_store_sk = ctr1.ctr_store_sk\n    AND s_state IN ('IL', 'KY', 'TX')\n    AND ctr1.ctr_customer_sk = c_customer_sk\n    AND c_current_cdemo_sk = cd_demo_sk\n    AND cd_marital_status IN ('M', 'M')\n    AND cd_education_status IN ('Advanced Degree', 'College')\n    AND cd_gender = 'F'\n    AND c_birth_month = 2\n    AND c_birth_year BETWEEN 1965 AND 1971\n    ORDER BY: c_customer_id\n    LIMIT: 100",
    "recommended_examples": [
      "pg_date_cte_explicit_join"
    ]
  }
]