[
  {
    "target_id": "t1",
    "family": "E",
    "transform": "multi_dimension_prefetch",
    "relevance_score": 0.95,
    "hypothesis": "Repeated full scans of date_dim and customer tables across three INTERSECT branches cause redundant I/O and computation. Precomputing filtered dimension tables eliminates 3x repeated work.",
    "target_ir": "S0 [SELECT]\n  CTE: filtered_date (via Q1)\n    FROM: date_dim\n    WHERE: d_month_seq BETWEEN 1200 AND 1211\n    PROJECT: d_date_sk, d_date\n  CTE: filtered_cust (via Q2)\n    FROM: customer\n    WHERE: c_birth_month IN (1,2,5,12)\n    PROJECT: c_customer_sk, c_last_name, c_first_name\n  MAIN QUERY (via Q0)\n    FROM: (\n      SELECT DISTINCT c_last_name, c_first_name, d_date\n      FROM store_sales\n        JOIN filtered_date ON ss_sold_date_sk = d_date_sk\n        JOIN filtered_cust ON ss_customer_sk = c_customer_sk\n      WHERE ss_list_price BETWEEN 193 AND 252\n        AND ss_wholesale_cost BETWEEN 35 AND 55\n      INTERSECT\n      ... (catalog_sales/web_sales branches use same CTEs)\n    ) hot_cust\n  LIMIT: 100",
    "recommended_examples": [
      "multi_dimension_prefetch"
    ]
  },
  {
    "target_id": "t2",
    "family": "D",
    "transform": "intersect_to_exists",
    "relevance_score": 0.85,
    "hypothesis": "INTERSECT operations materialize three large distinct sets before comparison. EXISTS semi-joins avoid full distinct materialization and enable pipelined evaluation.",
    "target_ir": "S0 [SELECT]\n  CTE: base_sales (via Q1)\n    SELECT DISTINCT c_last_name, c_first_name, d_date\n    FROM store_sales, date_dim, customer\n    WHERE ss_sold_date_sk = d_date_sk\n      AND ss_customer_sk = c_customer_sk\n      AND d_month_seq BETWEEN 1200 AND 1211\n      AND c_birth_month IN (1,2,5,12)\n      AND ss_list_price BETWEEN 193 AND 252\n      AND ss_wholesale_cost BETWEEN 35 AND 55\n  MAIN QUERY (via Q0)\n    SELECT COUNT(*)\n    FROM base_sales bs\n    WHERE EXISTS (\n      SELECT 1 \n      FROM catalog_sales, date_dim, customer\n      WHERE cs_sold_date_sk = d_date_sk\n        AND cs_bill_customer_sk = c_customer_sk\n        AND d_month_seq BETWEEN 1200 AND 1211\n        AND c_birth_month IN (1,2,5,12)\n        AND cs_list_price BETWEEN 193 AND 252\n        AND cs_wholesale_cost BETWEEN 35 AND 55\n        AND c_last_name = bs.c_last_name\n        AND c_first_name = bs.c_first_name\n        AND d_date = bs.d_date\n    )\n    AND EXISTS (...web_sales branch...)",
    "recommended_examples": [
      "pg_intersect_to_exists"
    ]
  },
  {
    "target_id": "t3",
    "family": "A",
    "transform": "predicate_push_into_cte",
    "relevance_score": 0.75,
    "hypothesis": "Sales table filters (list_price/wholesale_cost) are applied after dimension joins. Pushing filters into dimension-prefetch CTEs reduces join cardinality.",
    "target_ir": "S0 [SELECT]\n  CTE: filtered_date (via Q1)\n    FROM: date_dim\n    WHERE: d_month_seq BETWEEN 1200 AND 1211\n  CTE: filtered_cust (via Q2)\n    FROM: customer\n    WHERE: c_birth_month IN (1,2,5,12)\n    AND ss_list_price BETWEEN 193 AND 252  -- Pushed predicate\n    AND ss_wholesale_cost BETWEEN 35 AND 55\n  ... (rest same as t1)",
    "recommended_examples": [
      "pg_date_cte_explicit_join"
    ]
  }
]