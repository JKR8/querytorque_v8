{
  "probe_id": "p01",
  "transform_id": "or_to_union",
  "family": "D",
  "dialect": "postgres",
  "hypothesis": "Splitting the multi-column OR predicate into UNION ALL branches may enable index-specific optimizations per branch and reduce row amplification from late filtering.",
  "reasoning_trace": [
    "OR condition spans cd_marital_status and cd_education_status â€” not a same-column OR",
    "Each branch targets a distinct demographic profile: (M, Unknown) and (W, Advanced Degree)",
    "UNION ALL can allow separate index scans on customer_demographics if indexes support it"
  ],
  "target_ir": "Two UNION ALL branches, each with a simplified WHERE predicate on customer_demographics; all other joins and filters preserved.",
  "steps": [
    {
      "step_id": "s1",
      "op": "wrap_query_with_cte",
      "target": {"by_node_id": "S0"},
      "payload": {
        "cte_name": "demographic_branch_1",
        "cte_query_sql": "SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, cr_net_loss FROM call_center, catalog_returns, date_dim, customer, customer_address, customer_demographics, household_demographics WHERE cr_call_center_sk = cc_call_center_sk AND cr_returned_date_sk = d_date_sk AND cr_returning_customer_sk = c_customer_sk AND cd_demo_sk = c_current_cdemo_sk AND hd_demo_sk = c_current_hdemo_sk AND ca_address_sk = c_current_addr_sk AND d_year = 1998 AND d_moy = 2 AND cd_marital_status = 'M' AND cd_education_status = 'Unknown' AND hd_buy_potential LIKE '1001-5000%' AND ca_gmt_offset = -7"
      }
    },
    {
      "step_id": "s2",
      "op": "replace_body",
      "target": {"by_node_id": "S0"},
      "payload": {
        "sql_fragment": "SELECT cc_call_center_id AS Call_Center, cc_name AS Call_Center_Name, cc_manager AS Manager, SUM(cr_net_loss) AS Returns_Loss FROM (SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, cr_net_loss FROM demographic_branch_1 UNION ALL SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, cr_net_loss FROM call_center, catalog_returns, date_dim, customer, customer_address, customer_demographics, household_demographics WHERE cr_call_center_sk = cc_call_center_sk AND cr_returned_date_sk = d_date_sk AND cr_returning_customer_sk = c_customer_sk AND cd_demo_sk = c_current_cdemo_sk AND hd_demo_sk = c_current_hdemo_sk AND ca_address_sk = c_current_addr_sk AND d_year = 1998 AND d_moy = 2 AND cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree' AND hd_buy_potential LIKE '1001-5000%' AND ca_gmt_offset = -7) AS combined_results GROUP BY cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status ORDER BY SUM(cr_net_loss) DESC"
      }
    }
  ]
}