{
  "probe_id": "p01",
  "transform_id": "aggregate_pushdown",
  "family": "C",
  "dialect": "postgres",
  "hypothesis": "Pre-aggregating catalog_returns on join keys reduces row count before dimension joins, avoiding expensive nested loops.",
  "reasoning_trace": [
    "catalog_returns has 2.1M rows and dominates query cost via sequential scan",
    "GROUP BY keys (cr_call_center_sk, cr_returning_customer_sk) align with join keys",
    "Early aggregation preserves sum semantics while reducing rows for join processing"
  ],
  "target_ir": "CTE-based pre-aggregation of catalog_returns grouped by join keys, joined explicitly with dimension tables",
  "steps": [
    {
      "step_id": "s1",
      "op": "insert_cte",
      "target": {"by_node_id": "S0"},
      "payload": {
        "cte_name": "agg_cr",
        "cte_query_sql": "SELECT cr_call_center_sk, cr_returning_customer_sk, SUM(cr_net_loss) AS loss FROM catalog_returns GROUP BY cr_call_center_sk, cr_returning_customer_sk"
      }
    },
    {
      "step_id": "s2",
      "op": "replace_from",
      "target": {"by_node_id": "S0"},
      "payload": {
        "from_sql": "call_center JOIN agg_cr ON cc_call_center_sk = cr_call_center_sk JOIN date_dim ON cr_returned_date_sk = d_date_sk JOIN customer ON cr_returning_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk"
      }
    },
    {
      "step_id": "s3",
      "op": "replace_select",
      "target": {"by_node_id": "S0"},
      "payload": {
        "sql_fragment": "cc_call_center_id Call_Center, cc_name Call_Center_Name, cc_manager Manager, SUM(loss) Returns_Loss"
      }
    }
  ]
}