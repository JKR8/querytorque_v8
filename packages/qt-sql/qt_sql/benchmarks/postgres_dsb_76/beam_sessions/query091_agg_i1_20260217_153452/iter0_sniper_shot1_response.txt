[
  {
    "plan_id": "snipe_p1",
    "dialect": "postgres",
    "confidence": 0.8,
    "based_on": "p01",
    "strategy": "Explicit join conversion to optimize join planning",
    "hypothesis": "Original comma joins prevent optimal join ordering. Converting to explicit JOIN syntax will improve row estimates and enable better join optimization decisions, reducing the sequential scan impact on catalog_returns.",
    "target_ir": "Explicit INNER JOIN structure replacing comma joins",
    "steps": [
      {
        "step_id": "s1",
        "op": "replace_body",
        "target": {"by_node_id": "S0"},
        "payload": {
          "sql_fragment": "SELECT cc_call_center_id Call_Center, cc_name Call_Center_Name, cc_manager Manager, SUM(cr_net_loss) Returns_Loss FROM call_center INNER JOIN catalog_returns ON cr_call_center_sk = cc_call_center_sk INNER JOIN date_dim ON cr_returned_date_sk = d_date_sk INNER JOIN customer ON cr_returning_customer_sk = c_customer_sk INNER JOIN customer_address ON ca_address_sk = c_current_addr_sk INNER JOIN customer_demographics ON cd_demo_sk = c_current_cdemo_sk INNER JOIN household_demographics ON hd_demo_sk = c_current_hdemo_sk WHERE d_year = 1998 AND d_moy = 2 AND ((cd_marital_status = 'M' AND cd_education_status = 'Unknown') OR (cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree')) AND hd_buy_potential LIKE '1001-5000%' AND ca_gmt_offset = -7 GROUP BY cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status ORDER BY SUM(cr_net_loss) DESC;"
        }
      }
    ]
  },
  {
    "plan_id": "snipe_p2",
    "dialect": "postgres",
    "confidence": 0.7,
    "based_on": "p02,p01",
    "strategy": "Date CTE isolation with explicit joins",
    "hypothesis": "Isolating date_dim filter in a CTE reduces fact table joins early while explicit JOIN syntax improves planner decisions. Combined approach targets both sequential scan and nested loop bottlenecks observed in original plan.",
    "target_ir": "CTE-filtered date dimension + explicit star-join structure",
    "steps": [
      {
        "step_id": "s1",
        "op": "insert_cte",
        "target": {"by_node_id": "S0"},
        "payload": {
          "cte_name": "date_cte",
          "cte_query_sql": "SELECT d_date_sk FROM date_dim WHERE d_year = 1998 AND d_moy = 2"
        }
      },
      {
        "step_id": "s2",
        "op": "replace_body",
        "target": {"by_node_id": "S0"},
        "payload": {
          "sql_fragment": "SELECT cc_call_center_id Call_Center, cc_name Call_Center_Name, cc_manager Manager, SUM(cr_net_loss) Returns_Loss FROM call_center INNER JOIN catalog_returns ON cr_call_center_sk = cc_call_center_sk INNER JOIN date_cte ON cr_returned_date_sk = date_cte.d_date_sk INNER JOIN customer ON cr_returning_customer_sk = c_customer_sk INNER JOIN customer_address ON ca_address_sk = c_current_addr_sk INNER JOIN customer_demographics ON cd_demo_sk = c_current_cdemo_sk INNER JOIN household_demographics ON hd_demo_sk = c_current_hdemo_sk WHERE ((cd_marital_status = 'M' AND cd_education_status = 'Unknown') OR (cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree')) AND hd_buy_potential LIKE '1001-5000%' AND ca_gmt_offset = -7 GROUP BY cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status ORDER BY SUM(cr_net_loss) DESC;"
        }
      }
    ]
  }
]