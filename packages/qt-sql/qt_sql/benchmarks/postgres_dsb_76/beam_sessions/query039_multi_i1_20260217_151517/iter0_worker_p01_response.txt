{
  "probe_id": "p01",
  "transform_id": "early_filter",
  "family": "A",
  "dialect": "postgres",
  "hypothesis": "Push d_moy filter into CTE subquery to reduce inventory scan size and enable earlier partition pruning on date_dim.",
  "reasoning_trace": [
    "CTE materializes full year data before d_moy filtering, causing expensive hash join on 2.4M+ rows",
    "Self-join amplifies cost when d_moy is filtered late",
    "Adding 'AND d_moy IN (2,3)' in CTE enables index-based pruning and smaller intermediate result"
  ],
  "target_ir": "CTE with d_moy restriction applied early; main query self-join preserved with same projection and filters",
  "steps": [
    {
      "step_id": "s1",
      "op": "replace_where_predicate",
      "target": {
        "by_node_id": "S0",
        "by_anchor_hash": "ceb681f4fee117f7"
      },
      "payload": {
        "expr_sql": "d_moy IN (2,3) AND case mean when 0 then 0 else stdev/mean end > 1"
      }
    },
    {
      "step_id": "s2",
      "op": "replace_where_predicate",
      "target": {
        "by_node_id": "S1",
        "by_anchor_hash": "ceb681f4fee117f7"
      },
      "payload": {
        "expr_sql": "d_moy IN (2,3) AND case mean when 0 then 0 else stdev/mean end > 1"
      }
    }
  ]
}