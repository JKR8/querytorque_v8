{
  "plan_id": "postgres_explicit_join_reorder_shoes",
  "dialect": "postgres",
  "description": "Convert comma joins to explicit INNER JOINs and reorder join sequence to prioritize selective filters. Materialize filtered date and item dimensions into CTEs for improved cardinality estimation and join performance.",
  "preconditions": [
    {
      "kind": "parse_ok"
    }
  ],
  "postconditions": [
    {
      "kind": "parse_ok"
    }
  ],
  "steps": [
    {
      "step_id": "s1",
      "op": "insert_cte",
      "target": {
        "by_node_id": "S0"
      },
      "payload": {
        "cte_name": "filtered_date_dim",
        "cte_query_sql": "SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy = 2"
      },
      "description": "Insert CTE 'filtered_date_dim' for pre-filtering date dimension"
    },
    {
      "step_id": "s2",
      "op": "insert_cte",
      "target": {
        "by_node_id": "S0"
      },
      "payload": {
        "cte_name": "filtered_item_dim",
        "cte_query_sql": "SELECT i_item_sk FROM item WHERE i_category = 'Shoes'"
      },
      "description": "Insert CTE 'filtered_item_dim' for pre-filtering item dimension"
    },
    {
      "step_id": "s3",
      "op": "replace_from",
      "target": {
        "by_node_id": "S0"
      },
      "payload": {
        "from_sql": "customer_address INNER JOIN customer ON c_current_addr_sk = ca_address_sk INNER JOIN store_sales ON ss_customer_sk = c_customer_sk INNER JOIN filtered_date_dim ON d_date_sk = ss_sold_date_sk INNER JOIN filtered_item_dim ON ss_item_sk = i_item_sk INNER JOIN store ON ss_store_sk = s_store_sk"
      },
      "description": "Replace comma-join FROM with explicit INNER JOINs in selective order"
    },
    {
      "step_id": "s4",
      "op": "replace_where_predicate",
      "target": {
        "by_node_id": "S0"
      },
      "payload": {
        "expr_sql": "ca_state = 'KS' AND c_birth_month = 2 AND ss_wholesale_cost BETWEEN 76 AND 96 AND substring(ca_zip,1,5) <> substring(s_zip,1,5)"
      },
      "description": "Replace WHERE clause with remaining predicates"
    }
  ]
}