{
  "iteration": 0,
  "n_api_calls": 9,
  "beam_cost_usd": 0.02832808,
  "beam_cost_priced_calls": 9,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 119079,
    "completion_tokens": 18458,
    "total_tokens": 137537,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 48448,
    "reasoning_tokens": 9041
  },
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "p03",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.75,
      "status": "REGRESSION",
      "speedup": 0.82,
      "semantic_passed": true,
      "error": null,
      "original_ms": 2485.0,
      "patch_ms": 3049.0,
      "output_sql": "WITH cool_cust AS (with filtered_date_dim as (\n  select d_date_sk, d_date\n  from date_dim\n  where d_month_seq between 1213 and 1213+11\n)\nselect distinct c_last_name, c_first_name, d_date\nfrom (\n  (\n    select distinct c_last_name, c_first_name, d_date\n    from store_sales\n    join filtered_date_dim on store_sales.ss_sold_date_sk = filtered_date_dim.d_date_sk\n    join customer on store_sales.ss_customer_sk = customer.c_customer_sk\n    where ss_list_price between 168 and 197\n      and c_birth_year BETWEEN 1968 AND 1974\n      and ss_wholesale_cost BETWEEN 76 AND 86\n  )\n  except\n  (\n    select distinct c_last_name, c_first_name, d_date\n    from catalog_sales\n    join filtered_date_dim on catalog_sales.cs_sold_date_sk = filtered_date_dim.d_date_sk\n    join customer on catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n    where cs_list_price between 168 and 197\n      and c_birth_year BETWEEN 1968 AND 1974\n      and cs_wholesale_cost BETWEEN 76 AND 86\n  )\n  except\n  (\n    select distinct c_last_name, c_first_name, d_date\n    from web_sales\n    join filtered_date_dim on web_sales.ws_sold_date_sk = filtered_date_dim.d_date_sk\n    join customer on web_sales.ws_bill_customer_sk = customer.c_customer_sk\n    where ws_list_price between 168 and 197\n      and c_birth_year BETWEEN 1968 AND 1974\n      and ws_wholesale_cost BETWEEN 76 AND 86\n  )\n) cool_cust) select count(*)\nfrom cool_cust;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Materialize filtered date_dim once as a CTE and convert comma joins to explicit JOIN syntax to give planner better cardinality estimates."
    },
    {
      "patch_id": "p01",
      "family": "A",
      "transform": "shared_dimension_multi_channel",
      "relevance_score": 0.85,
      "status": "NEUTRAL",
      "speedup": 0.96,
      "semantic_passed": true,
      "error": null,
      "original_ms": 2485.0,
      "patch_ms": 2581.1,
      "output_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq BETWEEN 1213 AND 1224), filtered_customers AS (SELECT c_customer_sk, c_last_name, c_first_name FROM customer WHERE c_birth_year BETWEEN 1968 AND 1974), store_branch AS (SELECT DISTINCT c_last_name, c_first_name, d_date FROM store_sales, filtered_dates, filtered_customers WHERE store_sales.ss_sold_date_sk = filtered_dates.d_date_sk AND store_sales.ss_customer_sk = filtered_customers.c_customer_sk AND ss_list_price BETWEEN 168 AND 197 AND ss_wholesale_cost BETWEEN 76 AND 86), catalog_branch AS (SELECT DISTINCT c_last_name, c_first_name, d_date FROM catalog_sales, filtered_dates, filtered_customers WHERE catalog_sales.cs_sold_date_sk = filtered_dates.d_date_sk AND catalog_sales.cs_bill_customer_sk = filtered_customers.c_customer_sk AND cs_list_price BETWEEN 168 AND 197 AND cs_wholesale_cost BETWEEN 76 AND 86), web_branch AS (SELECT DISTINCT c_last_name, c_first_name, d_date FROM web_sales, filtered_dates, filtered_customers WHERE web_sales.ws_sold_date_sk = filtered_dates.d_date_sk AND web_sales.ws_bill_customer_sk = filtered_customers.c_customer_sk AND ws_list_price BETWEEN 168 AND 197 AND ws_wholesale_cost BETWEEN 76 AND 86), except_combined AS ((SELECT c_last_name, c_first_name, d_date FROM store_branch) EXCEPT (SELECT c_last_name, c_first_name, d_date FROM catalog_branch) EXCEPT (SELECT c_last_name, c_first_name, d_date FROM web_branch)) SELECT COUNT(*) FROM except_combined;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Extract common date_dim and customer filters into two CTEs (filtered_dates, filtered_customers) and reference them in all three EXCEPT branches to eliminate redundant scans."
    },
    {
      "patch_id": "p02",
      "family": "D",
      "transform": "intersect_to_exists",
      "relevance_score": 0.65,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Checksum mismatch",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "SELECT COUNT(*) FROM (SELECT DISTINCT c_last_name, c_first_name, d_date FROM store_sales, date_dim, customer WHERE store_sales.ss_sold_date_sk = date_dim.d_date_sk AND store_sales.ss_customer_sk = customer.c_customer_sk AND d_month_seq BETWEEN 1213 AND 1213+11 AND ss_list_price BETWEEN 168 AND 197 AND c_birth_year BETWEEN 1968 AND 1974 AND ss_wholesale_cost BETWEEN 76 AND 86 AND NOT EXISTS (SELECT 1 FROM catalog_sales, date_dim dd1, customer cc1 WHERE catalog_sales.cs_sold_date_sk = dd1.d_date_sk AND catalog_sales.cs_bill_customer_sk = cc1.c_customer_sk AND dd1.d_month_seq BETWEEN 1213 AND 1213+11 AND catalog_sales.cs_list_price BETWEEN 168 AND 197 AND cc1.c_birth_year BETWEEN 1968 AND 1974 AND cc1.c_customer_sk = customer.c_customer_sk AND dd1.d_date_sk = date_dim.d_date_sk AND catalog_sales.cs_wholesale_cost BETWEEN 76 AND 86) AND NOT EXISTS (SELECT 1 FROM web_sales, date_dim dd2, customer cc2 WHERE web_sales.ws_sold_date_sk = dd2.d_date_sk AND web_sales.ws_bill_customer_sk = cc2.c_customer_sk AND dd2.d_month_seq BETWEEN 1213 AND 1213+11 AND web_sales.ws_list_price BETWEEN 168 AND 197 AND cc2.c_birth_year BETWEEN 1968 AND 1974 AND cc2.c_customer_sk = customer.c_customer_sk AND dd2.d_date_sk = date_dim.d_date_sk AND web_sales.ws_wholesale_cost BETWEEN 76 AND 86)) AS cool_cust;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Rewrite EXCEPT operations to NOT EXISTS correlated subqueries, allowing semi-join optimization and early elimination of rows."
    },
    {
      "patch_id": "p04",
      "family": "C",
      "transform": "single_pass_aggregation",
      "relevance_score": 0.55,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Checksum mismatch",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH consolidated_customers AS (SELECT DISTINCT c.c_last_name, c.c_first_name, d.d_date FROM (SELECT ss_customer_sk AS customer_sk, ss_sold_date_sk AS date_sk, 'store' AS source FROM store_sales WHERE ss_list_price BETWEEN 168 AND 197 AND ss_wholesale_cost BETWEEN 76 AND 86 UNION ALL SELECT cs_bill_customer_sk AS customer_sk, cs_sold_date_sk AS date_sk, 'catalog' AS source FROM catalog_sales WHERE cs_list_price BETWEEN 168 AND 197 AND cs_wholesale_cost BETWEEN 76 AND 86 UNION ALL SELECT ws_bill_customer_sk AS customer_sk, ws_sold_date_sk AS date_sk, 'web' AS source FROM web_sales WHERE ws_list_price BETWEEN 168 AND 197 AND ws_wholesale_cost BETWEEN 76 AND 86) fact_union JOIN date_dim d ON fact_union.date_sk = d.d_date_sk JOIN customer c ON fact_union.customer_sk = c.c_customer_sk WHERE d.d_month_seq BETWEEN 1213 AND 1224 AND c.c_birth_year BETWEEN 1968 AND 1974) SELECT COUNT(*) FROM consolidated_customers cool_cust;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Consolidate three independent fact table scans into a single scan with conditional logic, then compute set difference via aggregation."
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.91,
      "semantic_passed": true,
      "error": null,
      "original_ms": 3638.5,
      "patch_ms": 3979.9,
      "output_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq BETWEEN 1213 AND 1213+11), filtered_customers AS (SELECT c_customer_sk, c_last_name, c_first_name FROM customer WHERE c_birth_year BETWEEN 1968 AND 1974) SELECT COUNT(*) FROM ((SELECT DISTINCT c_last_name, c_first_name, d_date FROM store_sales JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk JOIN filtered_customers ON store_sales.ss_customer_sk = filtered_customers.c_customer_sk WHERE ss_list_price BETWEEN 168 AND 197 AND ss_wholesale_cost BETWEEN 76 AND 86) EXCEPT (SELECT DISTINCT c_last_name, c_first_name, d_date FROM catalog_sales JOIN filtered_dates ON catalog_sales.cs_sold_date_sk = filtered_dates.d_date_sk JOIN filtered_customers ON catalog_sales.cs_bill_customer_sk = filtered_customers.c_customer_sk WHERE cs_list_price BETWEEN 168 AND 197 AND cs_wholesale_cost BETWEEN 76 AND 86) EXCEPT (SELECT DISTINCT c_last_name, c_first_name, d_date FROM web_sales JOIN filtered_dates ON web_sales.ws_sold_date_sk = filtered_dates.d_date_sk JOIN filtered_customers ON web_sales.ws_bill_customer_sk = filtered_customers.c_customer_sk WHERE ws_list_price BETWEEN 168 AND 197 AND ws_wholesale_cost BETWEEN 76 AND 86)) cool_cust;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p2",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.78,
      "semantic_passed": true,
      "error": null,
      "original_ms": 3638.5,
      "patch_ms": 4661.2,
      "output_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq BETWEEN 1213 AND 1213+11) SELECT COUNT(*) FROM ((SELECT DISTINCT c_last_name, c_first_name, d_date FROM store_sales JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk, customer WHERE store_sales.ss_customer_sk = customer.c_customer_sk AND ss_list_price BETWEEN 168 AND 197 AND c_birth_year BETWEEN 1968 AND 1974 AND ss_wholesale_cost BETWEEN 76 AND 86) EXCEPT (SELECT DISTINCT c_last_name, c_first_name, d_date FROM catalog_sales JOIN filtered_dates ON catalog_sales.cs_sold_date_sk = filtered_dates.d_date_sk, customer WHERE catalog_sales.cs_bill_customer_sk = customer.c_customer_sk AND cs_list_price BETWEEN 168 AND 197 AND c_birth_year BETWEEN 1968 AND 1974 AND cs_wholesale_cost BETWEEN 76 AND 86) EXCEPT (SELECT DISTINCT c_last_name, c_first_name, d_date FROM web_sales JOIN filtered_dates ON web_sales.ws_sold_date_sk = filtered_dates.d_date_sk, customer WHERE web_sales.ws_bill_customer_sk = customer.c_customer_sk AND ws_list_price BETWEEN 168 AND 197 AND c_birth_year BETWEEN 1968 AND 1974 AND ws_wholesale_cost BETWEEN 76 AND 86)) cool_cust;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p03": "Aggregate  (rows=1, time=3044.932)\n  Unique  (rows=6520, time=3044.747)\n    Index Scan on date_dim  (rows=365, time=0.995)\n    Sort  (rows=6520, time=3044.277)\n      Subquery Scan (cool_cust)  (rows=6520, time=3036.262)\n        SetOp  (rows=6520, time=3035.618)\n          Append  (rows=7948, time=3032.579)\n            Result  (rows=6522, time=2484.126)\n              SetOp  (rows=6522, time=2483.676)\n                Append  (rows=7413, time=2480.099)\n                  Subquery Scan (*SELECT* 1)  (",
    "p01": "Aggregate  (rows=1, time=2440.194)\n  Index Scan on date_dim  (rows=365, time=1.059)\n  Seq Scan on customer  (rows=63204, time=93.834)\n  Subquery Scan (except_combined)  (rows=6520, time=2440.011)\n    SetOp  (rows=6520, time=2439.636)\n      Append  (rows=7948, time=2437.802)\n        Result  (rows=6522, time=2007.196)\n          SetOp  (rows=6522, time=2006.804)\n            Append  (rows=7413, time=2005.214)\n              Subquery Scan (*SELECT* 1)  (rows=6528, time=1263.84)\n                Unique ",
    "compile_p1": "Aggregate  (rows=1, time=3645.444)\n  Index Scan on date_dim  (rows=365, time=2.652)\n  Seq Scan on customer  (rows=63204, time=146.139)\n  Subquery Scan (cool_cust)  (rows=6520, time=3645.166)\n    SetOp  (rows=6520, time=3644.74)\n      Sort  (rows=7948, time=3643.68)\n        Append  (rows=7948, time=3632.987)\n          Result  (rows=6522, time=2929.47)\n            SetOp  (rows=6522, time=2929.156)\n              Sort  (rows=7413, time=2928.491)\n                Append  (rows=7413, time=2917.36)\n    ",
    "compile_p2": "Aggregate  (rows=1, time=4546.056)\n  Index Scan on date_dim  (rows=365, time=2.169)\n  Subquery Scan (cool_cust)  (rows=6520, time=4545.79)\n    SetOp  (rows=6520, time=4544.392)\n      Append  (rows=7948, time=4537.604)\n        Result  (rows=6522, time=3562.152)\n          SetOp  (rows=6522, time=3560.61)\n            Append  (rows=7413, time=3555.332)\n              Subquery Scan (*SELECT* 1)  (rows=6528, time=2348.298)\n                Unique  (rows=6528, time=2347.792)\n                  Sort  (rows"
  }
}