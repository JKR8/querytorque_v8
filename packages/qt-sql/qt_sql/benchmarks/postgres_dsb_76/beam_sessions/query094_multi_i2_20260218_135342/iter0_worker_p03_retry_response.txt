{
  "probe_id": "p03",
  "transform_id": "pg_self_join_decomposition",
  "family": "E",
  "status": "failed",
  "failure_reason": "Execution failure due to transaction abort; CTE-based rewrite introduced SQL error.",
  "partial_work": {
    "attempted_approach": "Introduce filtered_web_sales CTE and reuse in main query and EXISTS subquery",
    "blocking_issue": "CTE definition missing required join columns (ws_ship_date_sk, ws_ship_addr_sk, ws_web_site_sk) causing downstream join failures",
    "hypothesis_still_valid": true
  },
  "dialect": "postgres",
  "hypothesis": "Materializing filtered web_sales once can reduce repeated scans, but CTE must include all columns needed for downstream joins.",
  "reasoning_trace": [
    "Previous attempt failed because CTE projection was incomplete for downstream joins",
    "ws_ship_date_sk, ws_ship_addr_sk, and ws_web_site_sk are required to join to date_dim, customer_address, and web_site respectively",
    "NOT EXISTS path remains unchanged as it references web_returns directly"
  ],
  "target_ir": "No structural change due to execution failure.",
  "verification": {
    "executable": false,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": [],
        "outputs": [
          "order count",
          "total shipping cost",
          "total net profit"
        ],
        "changed": false
      }
    ]
  }
}