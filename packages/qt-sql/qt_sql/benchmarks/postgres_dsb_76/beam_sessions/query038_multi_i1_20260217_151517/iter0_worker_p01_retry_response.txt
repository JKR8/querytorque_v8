{
  "probe_id": "p01",
  "transform_id": "intersect_to_exists",
  "family": "D",
  "dialect": "postgres",
  "hypothesis": "Replace INTERSECT with EXISTS to avoid full materialization and sorting of large sets, enabling semi-join optimizations that stop at first match.",
  "reasoning_trace": [
    "Target correlated EXISTS logic on catalog_sales and web_sales matching (c_last_name, c_first_name, d_date)",
    "Preserve all original filters including d_month_seq expression exactly as written"
  ],
  "target_ir": "Base store_sales query with two EXISTS subqueries for catalog_sales and web_sales, preserving all original projections and filters.",
  "steps": [
    {
      "step_id": "s1",
      "op": "replace_body",
      "target": {"by_node_id": "S0"},
      "payload": {
        "sql_fragment": "SELECT COUNT(*) FROM ( SELECT DISTINCT c_last_name, c_first_name, d_date FROM store_sales, date_dim, customer WHERE store_sales.ss_sold_date_sk = date_dim.d_date_sk AND store_sales.ss_customer_sk = customer.c_customer_sk AND d_month_seq BETWEEN 1200 AND 1200 + 11 AND c_birth_month IN (1, 2, 5, 12) AND ss_list_price BETWEEN 193 AND 252 AND ss_wholesale_cost BETWEEN 35 AND 55 AND EXISTS ( SELECT 1 FROM catalog_sales, date_dim dd2, customer c2 WHERE catalog_sales.cs_sold_date_sk = dd2.d_date_sk AND catalog_sales.cs_bill_customer_sk = c2.c_customer_sk AND c2.c_last_name = customer.c_last_name AND c2.c_first_name = customer.c_first_name AND dd2.d_date = date_dim.d_date AND dd2.d_month_seq BETWEEN 1200 AND 1200 + 11 AND c2.c_birth_month IN (1, 2, 5, 12) AND cs_list_price BETWEEN 193 AND 252 AND cs_wholesale_cost BETWEEN 35 AND 55 ) AND EXISTS ( SELECT 1 FROM web_sales, date_dim dd3, customer c3 WHERE web_sales.ws_sold_date_sk = dd3.d_date_sk AND web_sales.ws_bill_customer_sk = c3.c_customer_sk AND c3.c_last_name = customer.c_last_name AND c3.c_first_name = customer.c_first_name AND dd3.d_date = date_dim.d_date AND dd3.d_month_seq BETWEEN 1200 AND 1200 + 11 AND c3.c_birth_month IN (1, 2, 5, 12) AND ws_list_price BETWEEN 193 AND 252 AND ws_wholesale_cost BETWEEN 35 AND 55 ) ) hot_cust LIMIT 100"
      }
    }
  ]
}