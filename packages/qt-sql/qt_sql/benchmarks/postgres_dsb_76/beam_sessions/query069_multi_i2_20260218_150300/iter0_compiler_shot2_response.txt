[
  {
    "plan_id": "compile_explicit_join_only",
    "dialect": "postgres",
    "confidence": 0.20,
    "based_on": "p02",
    "strategy": "Minimal comma-join fix to explicit JOIN syntax, preserving protected EXISTS subqueries.",
    "hypothesis": "All decorrelation probes regressed (0.39x–0.78x) due to breaking PostgreSQL's native semi‑join optimization for EXISTS/NOT EXISTS. The only safe transform is converting comma joins to explicit JOINs, which may improve cardinality estimation without introducing CTE fences.",
    "expected_explain_delta": "Same nested‑loop correlation but with improved row estimates from explicit join topology; no change to index scan amplification.",
    "target_ir": "Update final_select join syntax only.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["customer", "customer_address", "customer_demographics"],
          "outputs": ["cd_gender", "cd_marital_status", "cd_education_status", "cnt1", "cd_purchase_estimate", "cnt2", "cd_credit_rating", "cnt3"],
          "changed": true,
          "sql": "SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) cnt1, cd_purchase_estimate, COUNT(*) cnt2, cd_credit_rating, COUNT(*) cnt3 FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cd_demo_sk = c.c_current_cdemo_sk WHERE ca_state IN ('GA','KY','SD') AND cd_marital_status IN ('D', 'W', 'U') AND cd_education_status IN ('Primary','College') AND EXISTS (SELECT * FROM store_sales, date_dim WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 3 AND 3+2 AND ss_list_price BETWEEN 52 AND 141) AND (NOT EXISTS (SELECT * FROM web_sales, date_dim WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 3 AND 3+2 AND ws_list_price BETWEEN 52 AND 141) AND NOT EXISTS (SELECT * FROM catalog_sales, date_dim WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 3 AND 3+2 AND cs_list_price BETWEEN 52 AND 141)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100"
        }
      ]
    }
  }
]