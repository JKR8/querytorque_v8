[
  {
    "target_id": "t1",
    "family": "E",
    "transform": "cte_materialization",
    "relevance_score": 0.95,
    "hypothesis": "CTEs frequent_ss_items and best_ss_customer are scanned multiple times in UNION branches. Materialization prevents redundant computation.",
    "target_ir": "S0 [SELECT]\n  CTE: frequent_ss_items MATERIALIZED\n    FROM: store_sales, date_dim, item\n    WHERE [89fc2fb260a938e8]: ss_sold_date_sk=d_date_sk AND ss_item_sk=i_item_sk AND d_year=1998 AND i_manager_id BETWEEN 81 AND 100 AND i_category IN (...)\n    GROUP BY: SUBSTRING(i_item_desc,1,30), i_item_sk, d_date\n    HAVING: count(*) >4\n  CTE: max_store_sales MATERIALIZED\n    FROM: (subquery)\n  CTE: best_ss_customer MATERIALIZED\n    FROM: store_sales, customer\n    WHERE [8e7b5f6e04cda7e3]: ss_customer_sk=c_customer_sk AND c_birth_year BETWEEN 1934 AND 1940\n    GROUP BY: c_customer_sk\n  MAIN QUERY\n    FROM: (UNION subqueries with single CTE scans)",
    "recommended_examples": [
      "multi_cte_materialization"
    ]
  },
  {
    "target_id": "t2",
    "family": "A",
    "transform": "predicate_pushdown",
    "relevance_score": 0.85,
    "hypothesis": "Dimension filters on date_dim and item apply too late. Pushing d_year=1998 and i_manager_id filters earlier reduces join cardinality.",
    "target_ir": "S0 [SELECT]\n  CTE: frequent_ss_items\n    FROM: item\n      -> date_dim\n      -> store_sales\n    WHERE [PUSHED]: i_manager_id BETWEEN 81 AND 100 AND i_category IN (...) AND d_year=1998\n    (rest unchanged)\n  CTE: max_store_sales\n    FROM: date_dim\n      -> store_sales\n      -> customer\n    WHERE [PUSHED]: d_year=1998 AND ss_wholesale_cost BETWEEN 11 AND 21",
    "recommended_examples": [
      "pg_date_cte_explicit_join"
    ]
  },
  {
    "target_id": "t3",
    "family": "F",
    "transform": "explicit_join_ordering",
    "relevance_score": 0.75,
    "hypothesis": "Implicit comma joins prevent optimal join ordering. Explicit JOIN syntax enables better dimension-table-first ordering.",
    "target_ir": "S0 [SELECT]\n  CTE: frequent_ss_items\n    FROM: item\n    INNER JOIN store_sales ON ss_item_sk=i_item_sk\n    INNER JOIN date_dim ON ss_sold_date_sk=d_date_sk\n    WHERE: (filters unchanged)\n  CTE: max_store_sales\n    FROM: date_dim\n    INNER JOIN store_sales ON ss_sold_date_sk=d_date_sk\n    INNER JOIN customer ON ss_customer_sk=c_customer_sk\n    WHERE: (filters unchanged)",
    "recommended_examples": [
      "pg_explicit_join_materialized"
    ]
  },
  {
    "target_id": "t4",
    "family": "C",
    "transform": "preaggregation",
    "relevance_score": 0.7,
    "hypothesis": "frequent_ss_items aggregates after joining large tables. Pre-aggregating store_sales before joining dimensions reduces data volume.",
    "target_ir": "CTE: frequent_ss_items\n  FROM: (\n    SELECT ss_item_sk, ss_sold_date_sk, COUNT(*) cnt\n    FROM store_sales\n    GROUP BY ss_item_sk, ss_sold_date_sk\n    HAVING COUNT(*) >4\n  ) preagg\n  JOIN item ON i_item_sk=preagg.ss_item_sk\n  JOIN date_dim ON d_date_sk=preagg.ss_sold_date_sk\n  WHERE: d_year=1998 AND i_manager_id BETWEEN...",
    "recommended_examples": [
      "pg_materialized_dimension_fact_prefilter"
    ]
  }
]