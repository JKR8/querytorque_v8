Worker Role: W2
Family: C+B
Transform: agg_pushdown_before_joins+decorrelate_date_scan
Status: OK

--- OUTPUT SQL ---
WITH filtered_date AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2000), valid_date_pairs AS (SELECT d1.d_date_sk AS d1_sk, d2.d_date_sk AS d2_sk FROM filtered_date AS d1 JOIN date_dim AS d2 ON d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY')), agg_store_sales_returns AS (SELECT ss_customer_sk, ss_item_sk, COUNT(*) AS ss_cnt FROM store_sales JOIN store_returns ON ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk GROUP BY ss_customer_sk, ss_item_sk) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM agg_store_sales_returns AS ssr JOIN web_sales AS ws ON ssr.ss_customer_sk = ws.ws_bill_customer_sk AND ssr.ss_item_sk = ws.ws_item_sk JOIN valid_date_pairs AS vdp ON ws.ws_sold_date_sk = vdp.d2_sk JOIN filtered_date AS d1 ON vdp.d1_sk = d1.d_date_sk JOIN item AS i ON ssr.ss_item_sk = i.i_item_sk JOIN customer AS c ON ssr.ss_customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE i.i_category IN ('Children', 'Home', 'Women') AND ca.ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA') AND hd_income_band_sk BETWEEN 8 AND 14 AND hd.hd_buy_potential = '501-1000' AND ssr.ss_cnt > 0 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;