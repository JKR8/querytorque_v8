{
  "probe_id": "scout_dimension_prefetch_star",
  "transform_id": "dimension_prefetch_star",
  "family": "F",
  "status": "success",
  "dialect": "postgresql",
  "hypothesis": "Pre-filtering selective dimensions (date_dim, customer_demographics, customer, customer_address) into MATERIALIZED CTEs enables explicit JOINs with better cardinality estimates and avoids nested loop bottlenecks.",
  "reasoning_trace": [
    "Assigned transform targets comma-join syntax with poor join ordering and predicate placement.",
    "Dimension tables are filtered early using WHERE conditions; materializing them improves join selectivity.",
    "Explicit JOIN syntax enables PostgreSQL to reorder joins and push predicates effectively.",
    "CTE reuse is not required here since each dimension is used once, but materialization still helps with stats visibility."
  ],
  "target_ir": "Introduce CTEs for filtered dimensions, replace comma joins with explicit JOINs, preserve all output columns and semantics.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["item1", "item2", "s1", "s2", "filtered_date_dim", "filtered_customer", "filtered_customer_address", "filtered_customer_demographics"],
        "outputs": ["i_item_sk", "i_item_sk", "cnt"],
        "changed": true,
        "sql": "SELECT item1.i_item_sk, item2.i_item_sk, COUNT(*) AS cnt FROM item AS item1 JOIN item AS item2 ON item1.i_item_sk < item2.i_item_sk JOIN store_sales AS s1 ON s1.ss_item_sk = item1.i_item_sk JOIN store_sales AS s2 ON s2.ss_item_sk = item2.i_item_sk AND s1.ss_ticket_number = s2.ss_ticket_number JOIN filtered_date_dim AS d ON d.d_date_sk = s1.ss_sold_date_sk JOIN filtered_customer AS c ON s1.ss_customer_sk = c.c_customer_sk JOIN filtered_customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN filtered_customer_demographics AS cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE item1.i_category IN ('Electronics', 'Jewelry') AND item2.i_manager_id BETWEEN 81 AND 100 AND s1.ss_list_price BETWEEN 108 AND 122 AND s2.ss_list_price BETWEEN 108 AND 122 GROUP BY item1.i_item_sk, item2.i_item_sk ORDER BY cnt"
      },
      {
        "node_id": "filtered_date_dim",
        "parent_node_id": "final_select",
        "sources": ["date_dim"],
        "outputs": ["d_date_sk", "d_year"],
        "changed": true,
        "sql": "SELECT d_date_sk, d_year FROM date_dim WHERE d_year BETWEEN 1998 AND 1999"
      },
      {
        "node_id": "filtered_customer_demographics",
        "parent_node_id": "final_select",
        "sources": ["customer_demographics"],
        "outputs": ["cd_demo_sk", "cd_marital_status", "cd_education_status"],
        "changed": true,
        "sql": "SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE cd_marital_status = 'S' AND cd_education_status = 'College'"
      },
      {
        "node_id": "filtered_customer",
        "parent_node_id": "final_select",
        "sources": ["customer"],
        "outputs": ["c_customer_sk", "c_current_cdemo_sk", "c_current_addr_sk"],
        "changed": true,
        "sql": "SELECT c_customer_sk, c_current_cdemo_sk, c_current_addr_sk FROM customer"
      },
      {
        "node_id": "filtered_customer_address",
        "parent_node_id": "final_select",
        "sources": ["customer_address"],
        "outputs": ["ca_address_sk"],
        "changed": true,
        "sql": "SELECT ca_address_sk FROM customer_address"
      },
      {
        "node_id": "item1",
        "parent_node_id": "final_select",
        "sources": ["item"],
        "outputs": ["i_item_sk", "i_category"],
        "changed": false
      },
      {
        "node_id": "item2",
        "parent_node_id": "final_select",
        "sources": ["item"],
        "outputs": ["i_item_sk", "i_manager_id"],
        "changed": false
      },
      {
        "node_id": "s1",
        "parent_node_id": "final_select",
        "sources": ["store_sales"],
        "outputs": ["ss_item_sk", "ss_ticket_number", "ss_customer_sk", "ss_sold_date_sk", "ss_list_price"],
        "changed": false
      },
      {
        "node_id": "s2",
        "parent_node_id": "final_select",
        "sources": ["store_sales"],
        "outputs": ["ss_item_sk", "ss_ticket_number", "ss_list_price"],
        "changed": false
      }
    ]
  }
}