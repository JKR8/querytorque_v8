[
  {
    "target_id": "t1",
    "family": "A",
    "transform": "predicate_pushback",
    "relevance_score": 0.95,
    "hypothesis": "Dimension filters (item/customer_demographics/household_demographics) are applied after joining with large fact tables. Pre-filtering in CTEs reduces join cardinality.",
    "target_ir": "S0 [SELECT]\n  CTE: filtered_item (via Q1)\n    FROM: item\n    WHERE: i_category IN ('Men','Shoes','Sports')\n  CTE: filtered_cd (via Q2)\n    FROM: customer_demographics\n    WHERE: cd_marital_status='S' AND cd_dep_count BETWEEN 9 AND 11\n  CTE: filtered_hd (via Q3)\n    FROM: household_demographics\n    WHERE: hd_buy_potential='>10000'\n  MAIN QUERY (via Q0)\n    FROM: catalog_sales\n    JOIN inventory ON (cs_item_sk=inv_item_sk)\n    JOIN warehouse ON (inv_warehouse_sk=w_warehouse_sk)\n    JOIN filtered_item ON (i_item_sk=cs_item_sk)\n    JOIN filtered_cd ON (cs_bill_cdemo_sk=cd_demo_sk)\n    JOIN filtered_hd ON (cs_bill_hdemo_sk=hd_demo_sk)\n    ... [rest unchanged]",
    "recommended_examples": [
      "pg_date_cte_explicit_join"
    ]
  },
  {
    "target_id": "t2",
    "family": "E",
    "transform": "date_prefetch",
    "relevance_score": 0.9,
    "hypothesis": "Repeated scans of date_dim (d1/d2/d3) with overlapping week/date filters cause redundant I/O. Materialize date ranges first.",
    "target_ir": "S0 [SELECT]\n  CTE: date_range (via Q1)\n    FROM: date_dim\n    WHERE: d_year=1999 OR d_date > (SELECT MIN(d_date) FROM date_dim WHERE d_year=1999) + interval '3 days'\n  MAIN QUERY (via Q0)\n    FROM: catalog_sales\n    JOIN inventory ON (cs_item_sk=inv_item_sk)\n    ...\n    JOIN date_range d1 ON (cs_sold_date_sk=d1.d_date_sk)\n    JOIN date_range d2 ON (inv_date_sk=d2.d_date_sk)\n    JOIN date_range d3 ON (cs_ship_date_sk=d3.d_date_sk)\n    WHERE: d1.d_week_seq=d2.d_week_seq AND d3.d_date > d1.d_date+interval '3 day' AND d1.d_year=1999\n    ... [rest unchanged]",
    "recommended_examples": [
      "multi_dimension_prefetch"
    ]
  },
  {
    "target_id": "t3",
    "family": "C",
    "transform": "fact_agg_pushdown",
    "relevance_score": 0.8,
    "hypothesis": "GROUP BY keys are supersets of fact-dimension join keys. Pre-aggregate catalog_sales/inventory before joining dimensions.",
    "target_ir": "S0 [SELECT]\n  CTE: agg_facts (via Q1)\n    FROM: catalog_sales\n    JOIN inventory ON (cs_item_sk=inv_item_sk)\n    WHERE: cs_wholesale_cost BETWEEN 76 AND 96\n    GROUP BY: cs_item_sk, inv_warehouse_sk, cs_sold_date_sk\n    MEASURES: SUM(CASE...END) AS no_promo, ...\n  MAIN QUERY (via Q0)\n    FROM: agg_facts\n    JOIN item ON (i_item_sk=cs_item_sk)\n    JOIN warehouse ON (w_warehouse_sk=inv_warehouse_sk)\n    JOIN date_dim d1 ON (cs_sold_date_sk=d1.d_date_sk)\n    ... [dimension joins]\n    GROUP BY: i_item_desc, w_warehouse_name, d1.d_week_seq",
    "recommended_examples": [
      "pg_materialized_dimension_fact_prefilter"
    ]
  },
  {
    "target_id": "t4",
    "family": "F",
    "transform": "join_restructure",
    "relevance_score": 0.75,
    "hypothesis": "Implicit cross-join between date_dim aliases prevents predicate pushdown. Convert to explicit hierarchy with filtered CTEs.",
    "target_ir": "S0 [SELECT]\n  CTE: base_dates (via Q1)\n    FROM: date_dim\n    WHERE: d_year=1999\n  CTE: d2_dates (via Q2)\n    FROM: date_dim\n    WHERE: d_week_seq IN (SELECT d_week_seq FROM base_dates)\n  MAIN QUERY (via Q0)\n    FROM: catalog_sales\n    JOIN base_dates d1 ON (cs_sold_date_sk=d1.d_date_sk)\n    JOIN inventory ON (cs_item_sk=inv_item_sk)\n    JOIN d2_dates d2 ON (inv_date_sk=d2.d_date_sk AND d1.d_week_seq=d2.d_week_seq)\n    ... [restructured joins]",
    "recommended_examples": [
      "pg_explicit_join_materialized"
    ]
  }
]