{
  "plan_id": "fixed_push_filters_into_union",
  "dialect": "postgres",
  "description": "Push filters into the union branches of cs_or_ws_sales to reduce row counts early. Ensure 'item_sk', 'sold_date_sk', 'wholesale_cost' are preserved in each branch.",
  "preconditions": [
    {
      "kind": "parse_ok"
    }
  ],
  "postconditions": [
    {
      "kind": "parse_ok"
    }
  ],
  "steps": [
    {
      "step_id": "s1",
      "op": "replace_body",
      "target": {
        "by_node_id": "CTE_Q_S0_my_customers"
      },
      "payload": {
        "sql_fragment": "with cs_filtered as (\n  select cs_sold_date_sk sold_date_sk,\n         cs_bill_customer_sk customer_sk,\n         cs_item_sk item_sk,\n         cs_wholesale_cost wholesale_cost\n  from   catalog_sales, item, date_dim\n  where  cs_item_sk = i_item_sk\n         and i_category = 'Electronics'\n         and i_class = 'personal'\n         and cs_sold_date_sk = d_date_sk\n         and d_moy = 1\n         and d_year = 1998\n         and cs_wholesale_cost BETWEEN 35 AND 65\n),\nws_filtered as (\n  select ws_sold_date_sk sold_date_sk,\n         ws_bill_customer_sk customer_sk,\n         ws_item_sk item_sk,\n         ws_wholesale_cost wholesale_cost\n  from   web_sales, item, date_dim\n  where  ws_item_sk = i_item_sk\n         and i_category = 'Electronics'\n         and i_class = 'personal'\n         and ws_sold_date_sk = d_date_sk\n         and d_moy = 1\n         and d_year = 1998\n         and ws_wholesale_cost BETWEEN 35 AND 65\n)\nselect distinct c_customer_sk, c_current_addr_sk\nfrom (select * from cs_filtered\n      union all\n      select * from ws_filtered) cs_or_ws_sales,\n     customer\nwhere c_customer_sk = cs_or_ws_sales.customer_sk\n      and c_birth_year BETWEEN 1928 AND 1941"
      }
    }
  ]
}