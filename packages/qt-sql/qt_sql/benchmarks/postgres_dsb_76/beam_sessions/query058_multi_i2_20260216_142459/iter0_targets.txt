[
  {
    "target_id": "t1",
    "family": "B,E",
    "transform": "decorrelate_date_subquery",
    "relevance_score": 0.98,
    "hypothesis": "Correlated date subquery re-scans date_dim 6+ times. Precompute date_range as a reusable CTE to eliminate nested subqueries and redundant scans.",
    "target_ir": "S0 [SELECT]\n  CTE: date_range  (via CTE_Q_date_range)\n    FROM: date_dim\n    WHERE: d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '2001-06-06')\n  CTE: ss_items  (via CTE_Q_ss_items)\n    FROM: store_sales, item, customer\n    WHERE: ss_item_sk = i_item_sk\n      AND ss_sold_date_sk IN (SELECT d_date_sk FROM date_range)\n      AND ss_list_price BETWEEN 168 AND 197\n      AND i_manager_id BETWEEN 42 AND 71\n      AND ss_customer_sk = c_customer_sk\n      AND c_birth_year BETWEEN 1985 AND 1991\n    GROUP BY: i_item_id, c_birth_year\n  CTE: cs_items  (via CTE_Q_cs_items)\n    FROM: catalog_sales, item, customer\n    WHERE: cs_item_sk = i_item_sk\n      AND cs_sold_date_sk IN (SELECT d_date_sk FROM date_range)\n      AND cs_list_price BETWEEN 168 AND 197\n      AND i_manager_id BETWEEN 42 AND 71\n      AND cs_bill_customer_sk = c_customer_sk\n      AND c_birth_year BETWEEN 1985 AND 1991\n    GROUP BY: i_item_id, c_birth_year\n  CTE: ws_items  (via CTE_Q_ws_items)\n    FROM: web_sales, item, customer\n    WHERE: ws_item_sk = i_item_sk\n      AND ws_sold_date_sk IN (SELECT d_date_sk FROM date_range)\n      AND ws_list_price BETWEEN 168 AND 197\n      AND i_manager_id BETWEEN 42 AND 71\n      AND ws_bill_customer_sk = c_customer_sk\n      AND c_birth_year BETWEEN 1985 AND 1991\n    GROUP BY: i_item_id, c_birth_year\n  MAIN QUERY (via Q_main)\n    FROM: ss_items, cs_items, ws_items\n    WHERE: ss_items.item_id = cs_items.item_id\n      AND ss_items.item_id = ws_items.item_id\n      AND ss_items.birth_year = cs_items.birth_year\n      AND ss_items.birth_year = ws_items.birth_year\n      AND ... (revenue conditions)\n    ORDER BY: item_id, birth_year, ss_item_rev",
    "recommended_examples": [
      "pg_shared_scan_decorrelate",
      "multi_dimension_prefetch"
    ]
  },
  {
    "target_id": "t2",
    "family": "A",
    "transform": "push_filters_into_ctes",
    "relevance_score": 0.85,
    "hypothesis": "Filters (e.g., price, manager_id, birth_year) are applied late in CTEs. Move them closer to table scans to reduce join sizes early.",
    "target_ir": "S0 [SELECT]\n  CTE: date_range  (via CTE_Q_date_range)\n    FROM: date_dim\n    WHERE: d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '2001-06-06')\n  CTE: ss_items  (via CTE_Q_ss_items)\n    FROM: store_sales\n    JOIN item ON ss_item_sk = i_item_sk AND i_manager_id BETWEEN 42 AND 71\n    JOIN customer ON ss_customer_sk = c_customer_sk AND c_birth_year BETWEEN 1985 AND 1991\n    WHERE: ss_sold_date_sk IN (SELECT d_date_sk FROM date_range)\n      AND ss_list_price BETWEEN 168 AND 197\n    GROUP BY: i_item_id, c_birth_year\n  ... (cs_items/ws_items similarly optimized)\n  MAIN QUERY: unchanged",
    "recommended_examples": [
      "pg_date_cte_explicit_join"
    ]
  },
  {
    "target_id": "t3",
    "family": "F",
    "transform": "cte_join_to_explicit",
    "relevance_score": 0.75,
    "hypothesis": "Comma joins in CTEs obscure join relationships. Convert to explicit INNER JOINs for better predicate pushdown planning.",
    "target_ir": "S0 [SELECT]\n  CTE: ss_items  (via CTE_Q_ss_items)\n    FROM: store_sales\n    INNER JOIN item ON ss_item_sk = i_item_sk\n    INNER JOIN customer ON ss_customer_sk = c_customer_sk\n    INNER JOIN date_range ON ss_sold_date_sk = d_date_sk\n    WHERE: ... (filters)\n    GROUP BY: ...\n  ... (cs_items/ws_items similarly optimized)\n  MAIN QUERY: unchanged",
    "recommended_examples": [
      "pg_explicit_join_materialized"
    ]
  }
]