{
  "probe_id": "scout_lane_date_cte_explicit_join",
  "transform_id": "date_cte_explicit_join",
  "family": "A",
  "status": "success",
  "dialect": "postgresql",
  "hypothesis": "Isolating date_dim filtering into a MATERIALIZED CTE and converting comma joins to explicit JOIN syntax will enable better hash join planning with tiny probe tables, reducing intermediate result sizes and improving join order.",
  "reasoning_trace": [
    "Assigned transform targets comma-style joins and late date_dim filter application.",
    "Materializing filtered date_dim as CTE reduces its footprint for downstream joins.",
    "Explicit JOIN syntax allows PostgreSQL optimizer to better reorder joins based on cardinality.",
    "Preserved all required WHERE predicates and output semantics including GROUP BY and ORDER BY."
  ],
  "target_ir": "date_dim filtered into CTE; FROM clause converted to explicit JOINs; no semantic changes.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["filtered_dates", "item AS item1", "item AS item2", "store_sales AS s1", "store_sales AS s2", "customer", "customer_address", "customer_demographics"],
        "outputs": ["item1.i_item_sk", "item2.i_item_sk", "count(*) as cnt"],
        "changed": true,
        "sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year BETWEEN 1999 AND 1999 + 1) SELECT item1.i_item_sk, item2.i_item_sk, count(*) as cnt FROM item AS item1 JOIN item AS item2 ON item1.i_item_sk < item2.i_item_sk JOIN store_sales AS s1 ON s1.ss_item_sk = item1.i_item_sk JOIN store_sales AS s2 ON s2.ss_item_sk = item2.i_item_sk AND s1.ss_ticket_number = s2.ss_ticket_number JOIN customer ON s1.ss_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk JOIN filtered_dates fd ON fd.d_date_sk = s1.ss_sold_date_sk WHERE item1.i_category IN ('Electronics', 'Men') AND item2.i_manager_id BETWEEN 44 AND 63 AND cd_marital_status = 'D' AND cd_education_status = 'College' AND s1.ss_list_price BETWEEN 115 AND 129 AND s2.ss_list_price BETWEEN 115 AND 129 GROUP BY item1.i_item_sk, item2.i_item_sk ORDER BY cnt"
      },
      {
        "node_id": "filtered_dates",
        "parent_node_id": "final_select",
        "sources": ["date_dim"],
        "outputs": ["d_date_sk"],
        "changed": true,
        "sql": "SELECT d_date_sk FROM date_dim WHERE d_year BETWEEN 1999 AND 1999 + 1"
      }
    ]
  }
}