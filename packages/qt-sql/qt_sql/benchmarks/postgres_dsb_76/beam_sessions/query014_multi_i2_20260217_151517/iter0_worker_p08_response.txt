{
  "probe_id": "p01",
  "transform_id": "inner_join_conversion",
  "family": "F",
  "dialect": "postgres",
  "hypothesis": "Convert comma-join between this_year and last_year to explicit INNER JOIN to enable better join ordering and predicate pushdown in PostgreSQL.",
  "reasoning_trace": [
    "Main query uses comma-join syntax: FROM (subquery) this_year, (subquery) last_year",
    "PostgreSQL treats comma joins as lower precedence and may not optimize join order effectively",
    "Explicit INNER JOIN with ON condition allows better cardinality estimation and plan choices"
  ],
  "target_ir": "Replace comma-join with INNER JOIN ... ON using the existing WHERE join conditions; preserve all filters and projections.",
  "steps": [
    {
      "step_id": "s1",
      "op": "replace_from",
      "target": {"by_node_id": "S0"},
      "payload": {
        "from_sql": "(select 'store' channel, i_brand_id,i_class_id,i_category_id\n        ,sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n     ,item\n     ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n   and ss_item_sk = i_item_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_week_seq = (select d_week_seq\n                     from date_dim\n                     where d_year = 1999 + 1\n                       and d_moy = 12\n                       and d_dom = 12)\n   and i_category IN ('Electronics', 'Shoes', 'Sports')\n   and i_manager_id BETWEEN 42 and 51\n   and ss_wholesale_cost BETWEEN 76 AND 96\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) this_year\nINNER JOIN\n(select 'store' channel, i_brand_id,i_class_id\n        ,i_category_id, sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n     ,item\n     ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n   and ss_item_sk = i_item_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_week_seq = (select d_week_seq\n                     from date_dim\n                     where d_year = 1999\n                       and d_moy = 12\n                       and d_dom = 12)\n   and i_category IN ('Electronics', 'Shoes', 'Sports')\n   and ss_wholesale_cost BETWEEN 76 AND 96\n   and i_manager_id BETWEEN 42 and 51\ngroup by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) last_year\nON this_year.i_brand_id = last_year.i_brand_id\n  AND this_year.i_class_id = last_year.i_class_id\n  AND this_year.i_category_id = last_year.i_category_id"
      }
    }
  ]
}