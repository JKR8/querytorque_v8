{
  "probe_id": "p01",
  "transform_id": "shared_dimension_multi_channel",
  "family": "A",
  "dialect": "postgres",
  "hypothesis": "Extract shared item and date_dim filters into a single CTE to avoid repeated scans across store, catalog, and web sales channels.",
  "reasoning_trace": [
    "Multiple channel CTEs (store_sales, catalog_sales, web_sales) apply identical filters on item and date_dim.",
    "Shared filters on i_category, i_manager_id, d_year, and cost ranges cause redundant large scans.",
    "Creating one filtered_items_and_dates CTE allows each sales channel to join early and reduce row flow."
  ],
  "target_ir": "Single CTE with item/date_dim filters; each sales channel joins to it instead of scanning dimensions repeatedly.",
  "steps": [
    {
      "step_id": "s1",
      "op": "insert_cte",
      "target": {"by_node_id": "S0"},
      "payload": {
        "cte_name": "filtered_items_and_dates",
        "cte_query_sql": "SELECT i_item_sk, i_brand_id, i_class_id, i_category_id, d_date_sk FROM item, date_dim d1 WHERE i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND d1.d_year BETWEEN 1999 AND 2001"
      }
    }
  ]
}