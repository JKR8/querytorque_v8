{
  "iteration": 0,
  "n_api_calls": 5,
  "best_speedup": 1.08,
  "best_patch_id": "t1",
  "best_sql": "WITH dim_w AS (SELECT * FROM warehouse WHERE w_gmt_offset = -5), dim_sm AS (SELECT * FROM ship_mode WHERE sm_type = 'LIBRARY'), dim_cc AS (SELECT * FROM call_center WHERE cc_class = 'medium') SELECT SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name, SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM catalog_sales JOIN dim_w ON cs_warehouse_sk = w_warehouse_sk JOIN dim_sm ON cs_ship_mode_sk = sm_ship_mode_sk JOIN dim_cc ON cs_call_center_sk = cc_call_center_sk JOIN date_dim ON cs_ship_date_sk = d_date_sk WHERE d_month_seq BETWEEN 1191 AND 1191 + 23 AND cs_list_price BETWEEN 244 AND 273 GROUP BY SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name ORDER BY SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name LIMIT 100;",
  "patches": [
    {
      "patch_id": "t1",
      "family": "F",
      "transform": "join_restructure_dimension_first",
      "relevance_score": 0.98,
      "status": "IMPROVED",
      "speedup": 1.08,
      "semantic_passed": true,
      "error": null,
      "original_ms": 4024.1,
      "patch_ms": 3734.8,
      "output_sql": "WITH dim_w AS (SELECT * FROM warehouse WHERE w_gmt_offset = -5), dim_sm AS (SELECT * FROM ship_mode WHERE sm_type = 'LIBRARY'), dim_cc AS (SELECT * FROM call_center WHERE cc_class = 'medium') SELECT SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name, SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM catalog_sales JOIN dim_w ON cs_warehouse_sk = w_warehouse_sk JOIN dim_sm ON cs_ship_mode_sk = sm_ship_mode_sk JOIN dim_cc ON cs_call_center_sk = cc_call_center_sk JOIN date_dim ON cs_ship_date_sk = d_date_sk WHERE d_month_seq BETWEEN 1191 AND 1191 + 23 AND cs_list_price BETWEEN 244 AND 273 GROUP BY SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name ORDER BY SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "t3",
      "family": "A",
      "transform": "push_dimension_filters",
      "relevance_score": 0.85,
      "status": "NEUTRAL",
      "speedup": 1.02,
      "semantic_passed": true,
      "error": null,
      "original_ms": 4024.1,
      "patch_ms": 3956.1,
      "output_sql": "WITH filtered_warehouse AS (SELECT * FROM warehouse WHERE w_gmt_offset = -5), filtered_ship_mode AS (SELECT * FROM ship_mode WHERE sm_type = 'LIBRARY'), filtered_call_center AS (SELECT * FROM call_center WHERE cc_class = 'medium') SELECT SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name, SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM catalog_sales, filtered_warehouse, filtered_ship_mode, filtered_call_center, date_dim WHERE cs_ship_date_sk = d_date_sk AND cs_warehouse_sk = w_warehouse_sk AND cs_ship_mode_sk = sm_ship_mode_sk AND cs_call_center_sk = cc_call_center_sk AND d_month_seq BETWEEN 1191 AND 1191 + 23 AND cs_list_price BETWEEN 244 AND 273 GROUP BY SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name ORDER BY SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "t2",
      "family": "C",
      "transform": "aggregate_before_dimension_join",
      "relevance_score": 0.9,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Equivalence execution error: column \"cs_ship_date_sk\" does not exist\nLINE 1: ... FROM 1 FOR 20), sm_type, cc_name, SUM(CASE WHEN (cs_ship_da...\n                                                             ^\nHINT:  Perhaps you meant to reference the column \"agg_cs.cs_ship_mode_sk\".\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH agg_cs AS (SELECT cs_warehouse_sk, cs_ship_mode_sk, cs_call_center_sk, SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM catalog_sales JOIN date_dim ON cs_ship_date_sk = d_date_sk WHERE d_month_seq BETWEEN 1191 AND 1191 + 23 AND cs_list_price BETWEEN 244 AND 273 GROUP BY cs_warehouse_sk, cs_ship_mode_sk, cs_call_center_sk) SELECT SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name, SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM agg_cs JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk JOIN call_center ON cs_call_center_sk = cc_call_center_sk WHERE w_gmt_offset = -5 AND sm_type = 'LIBRARY' AND cc_class = 'medium' GROUP BY SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name ORDER BY SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name LIMIT 100;",
      "has_explain": false
    },
    {
      "patch_id": "t4",
      "family": "E",
      "transform": "materialize_dimensions",
      "relevance_score": 0.8,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Equivalence execution error: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH mat_ship_mode AS (SELECT * FROM ship_mode WHERE sm_type = 'LIBRARY'), mat_warehouse AS (SELECT * FROM warehouse WHERE w_gmt_offset = -5), mat_call_center AS (SELECT * FROM call_center WHERE cc_class = 'medium') SELECT SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name, SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM catalog_sales, mat_warehouse, mat_ship_mode, mat_call_center, date_dim WHERE cs_warehouse_sk = w_warehouse_sk AND cs_ship_mode_sk = sm_ship_mode_sk AND cs_call_center_sk = cc_call_center_sk AND cs_ship_date_sk = d_date_sk AND d_month_seq BETWEEN 1191 AND 1191 + 23 AND cs_list_price BETWEEN 244 AND 273 GROUP BY SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name ORDER BY SUBSTRING(w_warehouse_name FROM 1 FOR 20), sm_type, cc_name LIMIT 100;",
      "has_explain": false
    }
  ],
  "explains": {
    "t1": "Limit  (rows=11, time=4252.148)\n  Aggregate  (rows=11, time=4252.146)\n    Gather Merge  (rows=25, time=4252.137)\n      Aggregate  (rows=8, time=4136.132)\n        Sort  (rows=826, time=4135.98)\n          Nested Loop  (rows=826, time=4133.176)\n            Hash Join  (rows=1287, time=4124.916)\n              Hash Join  (rows=4948, time=4119.75)\n                Nested Loop  (rows=25870, time=4108.706)\n                  Index Only Scan on date_dim  (rows=244, time=1.424)\n                  Index Scan o",
    "t3": "Limit  (rows=11, time=3951.342)\n  Aggregate  (rows=11, time=3951.34)\n    Gather Merge  (rows=25, time=3951.331)\n      Aggregate  (rows=8, time=3789.071)\n        Sort  (rows=826, time=3788.927)\n          Nested Loop  (rows=826, time=3786.594)\n            Hash Join  (rows=1287, time=3780.257)\n              Hash Join  (rows=4948, time=3776.546)\n                Nested Loop  (rows=25870, time=3767.554)\n                  Index Only Scan on date_dim  (rows=244, time=1.13)\n                  Index Scan o"
  }
}