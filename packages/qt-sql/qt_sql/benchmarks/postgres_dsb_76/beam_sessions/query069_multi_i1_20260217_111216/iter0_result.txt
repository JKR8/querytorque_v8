{
  "iteration": 0,
  "n_api_calls": 24,
  "best_speedup": 34.45,
  "best_patch_id": "p12",
  "best_sql": "WITH valid_store_sales AS (SELECT DISTINCT ss_customer_sk FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ss_list_price BETWEEN 80 AND 169) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c, customer_address AS ca, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_state IN ('CO', 'NC', 'TX') AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('S', 'M', 'U') AND cd_education_status IN ('Primary', 'College') AND EXISTS(SELECT 1 FROM valid_store_sales AS vss WHERE c.c_customer_sk = vss.ss_customer_sk) AND (NOT EXISTS(SELECT * FROM web_sales, date_dim WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ws_list_price BETWEEN 80 AND 169) AND NOT EXISTS(SELECT * FROM catalog_sales, date_dim WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND cs_list_price BETWEEN 80 AND 169)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
  "patches": [
    {
      "patch_id": "p05",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.85,
      "status": "NEUTRAL",
      "speedup": 0.99,
      "semantic_passed": true,
      "error": null,
      "original_ms": 13501.2,
      "patch_ms": 13664.9,
      "output_sql": "SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c INNER JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN customer_demographics AS cd ON cd_demo_sk = c.c_current_cdemo_sk WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_state IN ('CO', 'NC', 'TX') AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('S', 'M', 'U') AND cd_education_status IN ('Primary', 'College') AND EXISTS(SELECT * FROM store_sales, date_dim WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ss_list_price BETWEEN 80 AND 169) AND (NOT EXISTS(SELECT * FROM web_sales, date_dim WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ws_list_price BETWEEN 80 AND 169) AND NOT EXISTS(SELECT * FROM catalog_sales, date_dim WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND cs_list_price BETWEEN 80 AND 169)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": true,
      "description": "Convert comma joins to explicit INNER JOIN syntax: FROM customer c INNER JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN customer_demographics cd ON cd_demo_sk = c.c_current_cdemo_sk"
    },
    {
      "patch_id": "p04",
      "family": "E",
      "transform": "pg_self_join_decomposition",
      "relevance_score": 0.9,
      "status": "NEUTRAL",
      "speedup": 0.98,
      "semantic_passed": true,
      "error": null,
      "original_ms": 13501.2,
      "patch_ms": 13768.3,
      "output_sql": "WITH date_range AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 12) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c, customer_address AS ca, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_state IN ('CO', 'NC', 'TX') AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('S', 'M', 'U') AND cd_education_status IN ('Primary', 'College') AND EXISTS(SELECT * FROM store_sales, date_dim WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ss_list_price BETWEEN 80 AND 169) AND (NOT EXISTS(SELECT * FROM web_sales, date_dim WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ws_list_price BETWEEN 80 AND 169) AND NOT EXISTS(SELECT * FROM catalog_sales, date_dim WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND cs_list_price BETWEEN 80 AND 169)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": true,
      "description": "Materialize filtered date_dim as CTE date_range: SELECT d_date_sk FROM date_dim WHERE d_year=2002 AND d_moy BETWEEN 10-12"
    },
    {
      "patch_id": "p02",
      "family": "B",
      "transform": "early_filter_decorrelate",
      "relevance_score": 0.95,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Row count: orig=80, patch=0",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH web_customers AS (SELECT DISTINCT ws_bill_customer_sk FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ws_list_price BETWEEN 80 AND 169) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c, customer_address AS ca, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_state IN ('CO', 'NC', 'TX') AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('S', 'M', 'U') AND cd_education_status IN ('Primary', 'College') AND EXISTS(SELECT * FROM store_sales, date_dim WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ss_list_price BETWEEN 80 AND 169) AND NOT EXISTS(SELECT * FROM catalog_sales, date_dim WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND cs_list_price BETWEEN 80 AND 169) AND NOT c.c_customer_sk IN (SELECT ws_bill_customer_sk FROM web_customers) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": false,
      "description": "Decorrelate web_sales NOT EXISTS via CTE web_customers: SELECT DISTINCT ws_bill_customer_sk FROM web_sales JOIN date_dim WHERE d_year=2002 AND d_moy BETWEEN 10-12 AND ws_list_price BETWEEN 80-169"
    },
    {
      "patch_id": "p06",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.8,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic mismatch: Optimized query failed: Binder Error: Referenced table \"ca\" not found!\nCandidate tables: \"c\", \"customer_demographics\"\n\nLINE 1: ...ress_sk, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_state IN ('",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_ca AS (SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('CO', 'NC', 'TX')) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c JOIN filtered_ca ON c.c_current_addr_sk = filtered_ca.ca_address_sk, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_state IN ('CO', 'NC', 'TX') AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('S', 'M', 'U') AND cd_education_status IN ('Primary', 'College') AND EXISTS(SELECT * FROM store_sales, date_dim WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ss_list_price BETWEEN 80 AND 169) AND (NOT EXISTS(SELECT * FROM web_sales, date_dim WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ws_list_price BETWEEN 80 AND 169) AND NOT EXISTS(SELECT * FROM catalog_sales, date_dim WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND cs_list_price BETWEEN 80 AND 169)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": false,
      "description": "Pre-filter customer_address into CTE filtered_ca: SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('CO','NC','TX')"
    },
    {
      "patch_id": "p07",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.8,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic mismatch: Optimized query failed: Binder Error: Referenced column \"cd_marital_status\" not found in FROM clause!\nCandidate bindings: \"c_email_address\", \"ca_address_id\", \"c_last_review_date_sk\", \"c_last_name\", \"c_salutation\"\n\nLINE 1: ..",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_cd AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_marital_status IN ('S', 'M', 'U') AND cd_education_status IN ('Primary', 'College')) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN filtered_cd AS cd ON cd.cd_demo_sk = c.c_current_cdemo_sk WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_state IN ('CO', 'NC', 'TX') AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('S', 'M', 'U') AND cd_education_status IN ('Primary', 'College') AND EXISTS(SELECT * FROM store_sales, date_dim WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ss_list_price BETWEEN 80 AND 169) AND (NOT EXISTS(SELECT * FROM web_sales, date_dim WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ws_list_price BETWEEN 80 AND 169) AND NOT EXISTS(SELECT * FROM catalog_sales, date_dim WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND cs_list_price BETWEEN 80 AND 169)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": false,
      "description": "Pre-filter customer_demographics into CTE filtered_cd: SELECT cd_demo_sk FROM customer_demographics WHERE cd_marital_status IN ('S','M','U') AND cd_education_status IN ('Primary','College')"
    },
    {
      "patch_id": "p10",
      "family": "A",
      "transform": "shared_dimension_multi_channel",
      "relevance_score": 0.65,
      "status": "NEUTRAL",
      "speedup": 0.99,
      "semantic_passed": true,
      "error": null,
      "original_ms": 13501.2,
      "patch_ms": 13641.5,
      "output_sql": "WITH date_range AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 12) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics AS cd ON cd.cd_demo_sk = c.c_current_cdemo_sk WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_state IN ('CO', 'NC', 'TX') AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('S', 'M', 'U') AND cd_education_status IN ('Primary', 'College') AND EXISTS(SELECT * FROM store_sales, date_dim WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ss_list_price BETWEEN 80 AND 169) AND (NOT EXISTS(SELECT * FROM web_sales, date_dim WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ws_list_price BETWEEN 80 AND 169) AND NOT EXISTS(SELECT * FROM catalog_sales, date_dim WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND cs_list_price BETWEEN 80 AND 169)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": true,
      "description": "Reuse date_range CTE in all sales channel CTEs (p01-p03)"
    },
    {
      "patch_id": "p03",
      "family": "B",
      "transform": "early_filter_decorrelate",
      "relevance_score": 0.95,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Row count: orig=80, patch=0",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH catalog_customers AS (SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND cs_list_price BETWEEN 80 AND 169) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c, customer_address AS ca, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_state IN ('CO', 'NC', 'TX') AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('S', 'M', 'U') AND cd_education_status IN ('Primary', 'College') AND EXISTS(SELECT * FROM store_sales, date_dim WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ss_list_price BETWEEN 80 AND 169) AND NOT EXISTS(SELECT * FROM web_sales, date_dim WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ws_list_price BETWEEN 80 AND 169) AND NOT c.c_customer_sk IN (SELECT cs_ship_customer_sk FROM catalog_customers) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": false,
      "description": "Decorrelate catalog_sales NOT EXISTS via CTE catalog_customers: SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales JOIN date_dim WHERE d_year=2002 AND d_moy BETWEEN 10-12 AND cs_list_price BETWEEN 80-169"
    },
    {
      "patch_id": "p08",
      "family": "E",
      "transform": "materialize_cte",
      "relevance_score": 0.75,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic mismatch: Optimized query failed: Binder Error: Referenced column \"cd_gender\" not found in FROM clause!\nCandidate bindings: \"c_current_cdemo_sk\", \"c_customer_sk\"\n\nLINE 1: ... 10 AND 10 + 2 AND cs_list_price BETWEEN 80 AND 169)) GROUP ",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH base_customers AS (SELECT c.c_customer_sk, c.c_current_cdemo_sk FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics AS cd ON cd.cd_demo_sk = c.c_current_cdemo_sk WHERE ca.ca_state IN ('CO', 'NC', 'TX') AND cd.cd_marital_status IN ('S', 'M', 'U') AND cd.cd_education_status IN ('Primary', 'College')) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM base_customers AS c WHERE EXISTS(SELECT * FROM store_sales, date_dim WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ss_list_price BETWEEN 80 AND 169) AND (NOT EXISTS(SELECT * FROM web_sales, date_dim WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ws_list_price BETWEEN 80 AND 169) AND NOT EXISTS(SELECT * FROM catalog_sales, date_dim WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND cs_list_price BETWEEN 80 AND 169)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": false,
      "description": "Combine customer + filtered_ca + filtered_cd into CTE base_customers: SELECT c_customer_sk, c_current_cdemo_sk FROM customer JOIN filtered_ca JOIN filtered_cd"
    },
    {
      "patch_id": "p12",
      "family": "B",
      "transform": "decorrelate",
      "relevance_score": 0.7,
      "status": "WIN",
      "speedup": 34.45,
      "semantic_passed": true,
      "error": null,
      "original_ms": 13480.4,
      "patch_ms": 391.3,
      "output_sql": "WITH valid_store_sales AS (SELECT DISTINCT ss_customer_sk FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ss_list_price BETWEEN 80 AND 169) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c, customer_address AS ca, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_state IN ('CO', 'NC', 'TX') AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('S', 'M', 'U') AND cd_education_status IN ('Primary', 'College') AND EXISTS(SELECT 1 FROM valid_store_sales AS vss WHERE c.c_customer_sk = vss.ss_customer_sk) AND (NOT EXISTS(SELECT * FROM web_sales, date_dim WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ws_list_price BETWEEN 80 AND 169) AND NOT EXISTS(SELECT * FROM catalog_sales, date_dim WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND cs_list_price BETWEEN 80 AND 169)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": true,
      "description": "Convert store_sales EXISTS to LEFT JOIN ... WHERE IS NOT NULL"
    },
    {
      "patch_id": "p13",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.6,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: LITERAL MISMATCH: Original literals missing from rewrite \u2014 numbers: ['10.0', '169.0', '2.0', '2002.0', '80.0']. The rewrite changed filter values instead of preserving them.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH base_customers AS (SELECT c_customer_sk, cd_demo_sk, cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ca_state IN ('CO', 'NC', 'TX')) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM base_customers AS bc, customer_demographics AS cd WHERE cd_demo_sk = bc.cd_demo_sk AND cd_marital_status IN ('S', 'M', 'U') AND cd_education_status IN ('Primary', 'College') GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": false,
      "description": "Pre-aggregate customer counts in base_customers CTE before sales joins"
    },
    {
      "patch_id": "p09",
      "family": "B",
      "transform": "composite_decorrelate_union",
      "relevance_score": 0.6,
      "status": "REGRESSION",
      "speedup": 0.16,
      "semantic_passed": true,
      "error": null,
      "original_ms": 13480.4,
      "patch_ms": 84467.3,
      "output_sql": "WITH unified_sales_channels AS (SELECT ss_customer_sk AS cust_key, 'store' AS channel FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ss_list_price BETWEEN 80 AND 169 UNION ALL SELECT ws_bill_customer_sk AS cust_key, 'web' AS channel FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ws_list_price BETWEEN 80 AND 169 UNION ALL SELECT cs_ship_customer_sk AS cust_key, 'catalog' AS channel FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND cs_list_price BETWEEN 80 AND 169) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c, customer_address AS ca, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_state IN ('CO', 'NC', 'TX') AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('S', 'M', 'U') AND cd_education_status IN ('Primary', 'College') AND EXISTS(SELECT 1 FROM unified_sales_channels AS u WHERE u.cust_key = c.c_customer_sk AND u.channel = 'store') AND NOT EXISTS(SELECT 1 FROM unified_sales_channels AS u WHERE u.cust_key = c.c_customer_sk AND u.channel = 'web') AND NOT EXISTS(SELECT 1 FROM unified_sales_channels AS u WHERE u.cust_key = c.c_customer_sk AND u.channel = 'catalog') GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": true,
      "description": "Combine all sales channel checks into single CTE: SELECT ss_customer_sk AS cust_key, 'store' AS channel FROM store_sales JOIN date_range UNION ALL ..."
    },
    {
      "patch_id": "p01",
      "family": "B",
      "transform": "early_filter_decorrelate",
      "relevance_score": 0.95,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: COLUMN REF MISMATCH: Original columns missing from rewrite \u2014 ['cs_list_price', 'cs_ship_customer_sk', 'cs_sold_date_sk', 'ws_bill_customer_sk', 'ws_list_price']. The rewrite references different table columns.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH store_customers AS (SELECT DISTINCT ss_customer_sk FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ss_list_price BETWEEN 80 AND 169) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c, customer_address AS ca, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_state IN ('CO', 'NC', 'TX') AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('S', 'M', 'U') AND cd_education_status IN ('Primary', 'College') AND EXISTS(SELECT 1 FROM store_customers WHERE ss_customer_sk = c.c_customer_sk) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": false,
      "description": "Decorrelate store_sales EXISTS by creating CTE store_customers: SELECT DISTINCT ss_customer_sk FROM store_sales JOIN date_dim WHERE d_year=2002 AND d_moy BETWEEN 10-12 AND ss_list_price BETWEEN 80-169"
    },
    {
      "patch_id": "p11",
      "family": "A",
      "transform": "sf_sk_pushdown_multi_fact",
      "relevance_score": 0.55,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic mismatch: Optimized query failed: Binder Error: Referenced column \"ss_list_price\" not found in FROM clause!\nCandidate bindings: \"c_first_shipto_date_sk\", \"ca_location_type\", \"c_last_name\", \"c_birth_year\", \"c_customer_id\"\n\nLINE 1: ...e",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_store_sales AS (SELECT ss_customer_sk, ss_sold_date_sk FROM store_sales WHERE ss_sold_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2) AND (SELECT MAX(d_date_sk) FROM date_dim WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2)) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c, customer_address AS ca, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_state IN ('CO', 'NC', 'TX') AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('S', 'M', 'U') AND cd_education_status IN ('Primary', 'College') AND EXISTS(SELECT * FROM filtered_store_sales AS fss, date_dim WHERE fss.ss_customer_sk = c.c_customer_sk AND fss.ss_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ss_list_price BETWEEN 80 AND 169) AND (NOT EXISTS(SELECT * FROM web_sales, date_dim WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND ws_list_price BETWEEN 80 AND 169) AND NOT EXISTS(SELECT * FROM catalog_sales, date_dim WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 10 + 2 AND cs_list_price BETWEEN 80 AND 169)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": false,
      "description": "Add date_sk BETWEEN to store_sales CTE: WHERE ss_sold_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_range) AND (SELECT MAX(d_date_sk) FROM date_range"
    },
    {
      "patch_id": "p14",
      "family": "C",
      "transform": "channel_bitmap_aggregation",
      "relevance_score": 0.5,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic mismatch: Optimized query failed: Binder Error: Referenced table \"sc\" not found!\nCandidate tables: \"customer_demographics\"\n\nLINE 1: ..._channels AS sc WHERE sc.customer_sk = c.c_customer_sk AND sc.has_web_sale = 2) AND NOT EXISTS(SELE",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH sales_channels AS (SELECT ss_customer_sk AS customer_sk, 1 AS has_store_sale FROM store_sales WHERE ss_list_price BETWEEN 80 AND 169 AND ss_sold_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 12) UNION ALL SELECT ws_bill_customer_sk AS customer_sk, 2 AS has_web_sale FROM web_sales WHERE ws_list_price BETWEEN 80 AND 169 AND ws_sold_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 12) UNION ALL SELECT cs_ship_customer_sk AS customer_sk, 3 AS has_catalog_sale FROM catalog_sales WHERE cs_list_price BETWEEN 80 AND 169 AND cs_sold_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 12)) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c, customer_address AS ca, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_state IN ('CO', 'NC', 'TX') AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('S', 'M', 'U') AND cd_education_status IN ('Primary', 'College') AND EXISTS(SELECT 1 FROM sales_channels AS sc WHERE sc.customer_sk = c.c_customer_sk AND sc.has_store_sale = 1) AND NOT EXISTS(SELECT 1 FROM sales_channels AS sc WHERE sc.customer_sk = c.c_customer_sk AND sc.has_web_sale = 2) AND NOT EXISTS(SELECT 1 FROM sales_channels AS sc WHERE sc.customer_sk = c.c_customer_sk AND sc.has_catalog_sale = 3) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": false,
      "description": "Consolidate sales channel checks via CASE: MAX(CASE WHEN channel='store' THEN 1 END) AS has_store_sale"
    }
  ],
  "explains": {
    "p05": "Limit  (rows=80, time=25574.484)\n  Aggregate  (rows=80, time=25574.401)\n    Nested Loop  (rows=964, time=25570.88)\n      Nested Loop  (rows=1105, time=5699.016)\n        Gather Merge  (rows=1128, time=236.207)\n          Sort  (rows=376, time=223.735)\n            Nested Loop  (rows=376, time=223.193)\n              Hash Join  (rows=1691, time=212.581)\n                Hash Join  (rows=22398, time=31.821)\n                  Seq Scan on customer (c)  (rows=166667, time=10.524)\n                  Hash  (",
    "p04": "Limit  (rows=80, time=25499.844)\n  Aggregate  (rows=80, time=25499.766)\n    Nested Loop  (rows=964, time=25496.498)\n      Nested Loop  (rows=1105, time=5692.496)\n        Gather Merge  (rows=1128, time=244.37)\n          Sort  (rows=376, time=229.095)\n            Nested Loop  (rows=376, time=228.631)\n              Hash Join  (rows=1691, time=217.468)\n                Hash Join  (rows=22398, time=34.192)\n                  Seq Scan on customer (c)  (rows=166667, time=11.847)\n                  Hash  (",
    "p10": "Limit  (rows=80, time=25567.496)\n  Aggregate  (rows=80, time=25567.406)\n    Nested Loop  (rows=964, time=25564.092)\n      Nested Loop  (rows=1105, time=5701.947)\n        Gather Merge  (rows=1128, time=237.048)\n          Sort  (rows=376, time=224.888)\n            Nested Loop  (rows=376, time=224.451)\n              Hash Join  (rows=1691, time=214.229)\n                Hash Join  (rows=22398, time=32.461)\n                  Seq Scan on customer (c)  (rows=166667, time=10.985)\n                  Hash  ",
    "p12": "Limit  (rows=80, time=485.353)\n  Aggregate  (rows=80, time=485.349)\n    Sort  (rows=964, time=485.245)\n      Nested Loop  (rows=964, time=484.521)\n        Hash Join  (rows=4472, time=467.334)\n          Gather  (rows=60877, time=222.193)\n            Hash Join  (rows=20292, time=216.776)\n              Hash Join  (rows=20621, time=175.781)\n                Hash Join  (rows=22398, time=31.639)\n                  Seq Scan on customer (c)  (rows=166667, time=10.332)\n                  Hash  (rows=11220, ",
    "p09": "Limit  (rows=80, time=93929.918)\n  Gather  (rows=868669, time=137.88)\n    Append  (rows=289556, time=166.2)\n      Nested Loop  (rows=225936, time=99.902)\n        Index Only Scan on date_dim  (rows=46, time=0.289)\n        Index Only Scan on store_sales  (rows=4912, time=1.959)\n      Nested Loop  (rows=166228, time=102.743)\n        Index Only Scan on date_dim (date_dim_1)  (rows=46, time=0.246)\n        Index Scan on catalog_sales  (rows=3614, time=2.067)\n      Nested Loop  (rows=84341, time=62.68)"
  }
}