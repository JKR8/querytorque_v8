{
  "probe_id": "p12",
  "transform_id": "multi_date_range_cte",
  "family": "A",
  "status": "success",
  "dialect": "postgres",
  "hypothesis": "Creating separate CTEs for each date range allows PostgreSQL to push down date filters into each subquery's fact table scan, reducing I/O and correlated loop iterations.",
  "reasoning_trace": [
    "Assigned transform targets correlated subqueries with repeated date_dim scans.",
    "Each subquery gets its own CTE with pre-filtered d_date_sk values.",
    "Fact table joins now reference CTEs instead of scanning date_dim repeatedly.",
    "PostgreSQL can push predicates into CTE scans and reduce outer loop iterations."
  ],
  "target_ir": "Three new CTEs (date_range1, date_range2, date_range3) replace inline date_dim scans; subqueries join to CTEs.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": [],
        "outputs": [
          "cd_gender",
          "cd_marital_status",
          "cd_education_status",
          "cnt1",
          "cd_purchase_estimate",
          "cnt2",
          "cd_credit_rating",
          "cnt3"
        ],
        "changed": true,
        "sql": "WITH date_range1 AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy BETWEEN 3 AND 5), date_range2 AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy BETWEEN 3 AND 5), date_range3 AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy BETWEEN 3 AND 5) select cd_gender, cd_marital_status, cd_education_status, count(*) cnt1, cd_purchase_estimate, count(*) cnt2, cd_credit_rating, count(*) cnt3 from customer c,customer_address ca,customer_demographics cd where c.c_current_addr_sk = ca.ca_address_sk and ca_state in ('GA','KY','SD') and cd_demo_sk = c.c_current_cdemo_sk and cd_marital_status in ('D', 'W', 'U') and cd_education_status in ('Primary', 'College') and exists (select * from store_sales,date_range1 d1 where c.c_customer_sk = ss_customer_sk and ss_sold_date_sk = d1.d_date_sk and ss_list_price between 52 and 141) and (not exists (select * from web_sales,date_range2 d2 where c.c_customer_sk = ws_bill_customer_sk and ws_sold_date_sk = d2.d_date_sk and ws_list_price between 52 and 141) and not exists (select * from catalog_sales,date_range3 d3 where c.c_customer_sk = cs_ship_customer_sk and cs_sold_date_sk = d3.d_date_sk and cs_list_price between 52 and 141)) group by cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating order by cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating limit 100"
      }
    ]
  }
}