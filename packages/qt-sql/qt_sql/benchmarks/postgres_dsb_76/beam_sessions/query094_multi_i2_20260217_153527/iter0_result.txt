{
  "iteration": 0,
  "n_api_calls": 17,
  "beam_cost_usd": 0.09398906,
  "beam_cost_priced_calls": 17,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 80441,
    "completion_tokens": 31615,
    "total_tokens": 112056,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 27072
  },
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "p08",
      "family": "A",
      "transform": "date_cte_isolate",
      "relevance_score": 0.7,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY') SELECT COUNT(DISTINCT ws_order_number) AS \"order count\", SUM(ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws_net_profit) AS \"total net profit\" FROM web_sales AS ws1 JOIN filtered_dates AS fd ON ws1.ws_ship_date_sk = fd.d_date_sk, customer_address, web_site WHERE d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY' AND ws1.ws_ship_date_sk = d_date_sk AND ws1.ws_ship_addr_sk = ca_address_sk AND ca_state IN ('MO', 'MT', 'OK', 'SC', 'TX', 'WI') AND ws1.ws_web_site_sk = web_site_sk AND web_gmt_offset >= -5 AND ws1.ws_list_price BETWEEN 253 AND 282 AND EXISTS(SELECT * FROM web_sales AS ws2 WHERE ws1.ws_order_number = ws2.ws_order_number AND ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk) AND NOT EXISTS(SELECT * FROM web_returns AS wr1 WHERE ws1.ws_order_number = wr1.wr_order_number AND wr1.wr_reason_sk IN (8, 18, 20, 23, 41)) ORDER BY COUNT(DISTINCT ws_order_number) LIMIT 100;",
      "has_explain": false,
      "description": "Create filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE ...). Replace date_dim in FROM with filtered_dates"
    },
    {
      "patch_id": "p03",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.85,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH date_cte AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY') SELECT COUNT(DISTINCT ws_order_number) AS \"order count\", SUM(ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws_net_profit) AS \"total net profit\" FROM web_sales AS ws1 INNER JOIN date_cte ON ws1.ws_ship_date_sk = date_cte.d_date_sk INNER JOIN customer_address ON ws1.ws_ship_addr_sk = customer_address.ca_address_sk INNER JOIN web_site ON ws1.ws_web_site_sk = web_site.web_site_sk WHERE d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY' AND ws1.ws_ship_date_sk = d_date_sk AND ws1.ws_ship_addr_sk = ca_address_sk AND ca_state IN ('MO', 'MT', 'OK', 'SC', 'TX', 'WI') AND ws1.ws_web_site_sk = web_site_sk AND web_gmt_offset >= -5 AND ws1.ws_list_price BETWEEN 253 AND 282 AND EXISTS(SELECT * FROM web_sales AS ws2 WHERE ws1.ws_order_number = ws2.ws_order_number AND ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk) AND NOT EXISTS(SELECT * FROM web_returns AS wr1 WHERE ws1.ws_order_number = wr1.wr_order_number AND wr1.wr_reason_sk IN (8, 18, 20, 23, 41)) ORDER BY COUNT(DISTINCT ws_order_number) LIMIT 100;",
      "has_explain": false,
      "description": "Create date_cte AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY'), then convert comma joins to INNER JOIN date_cte ON ws1.ws_ship_date_sk = date_cte.d_date_sk"
    },
    {
      "patch_id": "p01",
      "family": "B",
      "transform": "early_filter_decorrelate",
      "relevance_score": 0.9,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH multi_warehouse AS (SELECT ws_order_number FROM web_sales GROUP BY ws_order_number HAVING COUNT(DISTINCT ws_warehouse_sk) > 1) SELECT COUNT(DISTINCT ws_order_number) AS \"order count\", SUM(ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws_net_profit) AS \"total net profit\" FROM web_sales AS ws1, date_dim, customer_address, web_site WHERE d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY' AND ws1.ws_ship_date_sk = d_date_sk AND ws1.ws_ship_addr_sk = ca_address_sk AND ca_state IN ('MO', 'MT', 'OK', 'SC', 'TX', 'WI') AND ws1.ws_web_site_sk = web_site_sk AND web_gmt_offset >= -5 AND ws1.ws_list_price BETWEEN 253 AND 282 AND ws1.ws_order_number IN (SELECT ws_order_number FROM multi_warehouse) AND NOT EXISTS(SELECT * FROM web_returns AS wr1 WHERE ws1.ws_order_number = wr1.wr_order_number AND wr1.wr_reason_sk IN (8, 18, 20, 23, 41)) ORDER BY COUNT(DISTINCT ws_order_number) LIMIT 100;",
      "has_explain": false,
      "description": "Replace EXISTS subquery with CTE: WITH multi_warehouse AS (SELECT ws_order_number FROM web_sales GROUP BY ws_order_number HAVING COUNT(DISTINCT ws_warehouse_sk) > 1) THEN JOIN multi_warehouse ON ws1.ws_order_number = multi_warehouse.ws_order_number"
    },
    {
      "patch_id": "p11",
      "family": "B",
      "transform": "decorrelate",
      "relevance_score": 0.7,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH problem_orders AS (SELECT DISTINCT wr_order_number FROM web_returns WHERE wr_reason_sk IN (8, 18, 20, 23, 41)) SELECT COUNT(DISTINCT ws_order_number) AS \"order count\", SUM(ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws_net_profit) AS \"total net profit\" FROM web_sales AS ws1, date_dim, customer_address, web_site WHERE d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY' AND ws1.ws_ship_date_sk = d_date_sk AND ws1.ws_ship_addr_sk = ca_address_sk AND ca_state IN ('MO', 'MT', 'OK', 'SC', 'TX', 'WI') AND ws1.ws_web_site_sk = web_site_sk AND web_gmt_offset >= -5 AND ws1.ws_list_price BETWEEN 253 AND 282 AND EXISTS(SELECT * FROM web_sales AS ws2 WHERE ws1.ws_order_number = ws2.ws_order_number AND ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk) AND NOT EXISTS(SELECT 1 FROM problem_orders AS po WHERE ws1.ws_order_number = po.wr_order_number) ORDER BY COUNT(DISTINCT ws_order_number) LIMIT 100;",
      "has_explain": false,
      "description": "Minimal decorrelation: Create problem_orders AS (SELECT DISTINCT wr_order_number FROM web_returns WHERE wr_reason_sk IN (8,18,20,23,41)) without additional filters"
    },
    {
      "patch_id": "p04",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.85,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH ca_prefilter AS (SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('MO', 'MT', 'OK', 'SC', 'TX', 'WI')), site_prefilter AS (SELECT web_site_sk FROM web_site WHERE web_gmt_offset >= -5) SELECT COUNT(DISTINCT ws_order_number) AS \"order count\", SUM(ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws_net_profit) AS \"total net profit\" FROM web_sales AS ws1 JOIN date_dim ON ws1.ws_ship_date_sk = d_date_sk JOIN ca_prefilter ON ws1.ws_ship_addr_sk = ca_prefilter.ca_address_sk JOIN site_prefilter ON ws1.ws_web_site_sk = site_prefilter.web_site_sk WHERE d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY' AND ws1.ws_ship_date_sk = d_date_sk AND ws1.ws_ship_addr_sk = ca_address_sk AND ca_state IN ('MO', 'MT', 'OK', 'SC', 'TX', 'WI') AND ws1.ws_web_site_sk = web_site_sk AND web_gmt_offset >= -5 AND ws1.ws_list_price BETWEEN 253 AND 282 AND EXISTS(SELECT * FROM web_sales AS ws2 WHERE ws1.ws_order_number = ws2.ws_order_number AND ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk) AND NOT EXISTS(SELECT * FROM web_returns AS wr1 WHERE ws1.ws_order_number = wr1.wr_order_number AND wr1.wr_reason_sk IN (8, 18, 20, 23, 41)) ORDER BY COUNT(DISTINCT ws_order_number) LIMIT 100;",
      "has_explain": false,
      "description": "Create ca_prefilter AS (SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('MO','MT','OK','SC','TX','WI')), site_prefilter AS (SELECT web_site_sk FROM web_site WHERE web_gmt_offset >= -5). Convert joins to INNER JOIN ca_prefilter ON ws1.ws_ship_addr_sk = ca_prefilter.ca_address_sk INNER JOIN site_prefilter ON ws1.ws_web_site_sk = site_prefilter.web_site_sk"
    },
    {
      "patch_id": "p02",
      "family": "B",
      "transform": "early_filter_decorrelate",
      "relevance_score": 0.9,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH problem_returns AS (SELECT wr_order_number FROM web_returns WHERE wr_reason_sk IN (8, 18, 20, 23, 41) GROUP BY wr_order_number) SELECT COUNT(DISTINCT ws_order_number) AS \"order count\", SUM(ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws_net_profit) AS \"total net profit\" FROM web_sales AS ws1, date_dim, customer_address, web_site WHERE d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY' AND ws1.ws_ship_date_sk = d_date_sk AND ws1.ws_ship_addr_sk = ca_address_sk AND ca_state IN ('MO', 'MT', 'OK', 'SC', 'TX', 'WI') AND ws1.ws_web_site_sk = web_site_sk AND web_gmt_offset >= -5 AND ws1.ws_list_price BETWEEN 253 AND 282 AND EXISTS(SELECT * FROM web_sales AS ws2 WHERE ws1.ws_order_number = ws2.ws_order_number AND ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk) AND problem_returns.wr_order_number IS NULL ORDER BY COUNT(DISTINCT ws_order_number) LIMIT 100;",
      "has_explain": false,
      "description": "Replace NOT EXISTS with CTE: WITH problem_returns AS (SELECT wr_order_number FROM web_returns WHERE wr_reason_sk IN (8,18,20,23,41) GROUP BY wr_order_number) THEN LEFT JOIN problem_returns ON ws1.ws_order_number = problem_returns.wr_order_number WHERE wr_order_number IS NULL"
    },
    {
      "patch_id": "p10",
      "family": "B",
      "transform": "decorrelate",
      "relevance_score": 0.7,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: LITERAL MISMATCH: Original literals missing from rewrite \u2014 numbers: ['18.0', '20.0', '23.0', '41.0', '8.0']. The rewrite changed filter values instead of preserving them.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH warehouse_pairs AS (SELECT DISTINCT ws_order_number FROM web_sales AS ws2 WHERE EXISTS(SELECT 1 FROM web_sales AS ws3 WHERE ws2.ws_order_number = ws3.ws_order_number AND ws2.ws_warehouse_sk <> ws3.ws_warehouse_sk)) SELECT COUNT(DISTINCT ws_order_number) AS \"order count\", SUM(ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws_net_profit) AS \"total net profit\" FROM web_sales AS ws1 JOIN date_dim ON ws1.ws_ship_date_sk = d_date_sk JOIN customer_address ON ws1.ws_ship_addr_sk = ca_address_sk JOIN web_site ON ws1.ws_web_site_sk = web_site_sk JOIN warehouse_pairs AS wp ON wp.ws_order_number = ws1.ws_order_number WHERE d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY' AND ca_state IN ('MO', 'MT', 'OK', 'SC', 'TX', 'WI') AND web_gmt_offset >= -5 AND ws1.ws_list_price BETWEEN 253 AND 282 ORDER BY COUNT(DISTINCT ws_order_number) LIMIT 100;",
      "has_explain": false,
      "description": "Minimal decorrelation: Create warehouse_pairs AS (SELECT DISTINCT ws_order_number FROM web_sales ws2 WHERE ws1.ws_order_number = ws2.ws_order_number AND ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk) without early filtering"
    },
    {
      "patch_id": "p05",
      "family": "E",
      "transform": "pg_self_join_decomposition",
      "relevance_score": 0.8,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH ws_base AS (SELECT ws_order_number, ws_warehouse_sk, ws_ext_ship_cost, ws_net_profit FROM web_sales WHERE ws_list_price BETWEEN 253 AND 282) SELECT COUNT(DISTINCT ws_order_number) AS \"order count\", SUM(ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws_net_profit) AS \"total net profit\" FROM ws_base AS ws1, date_dim, customer_address, web_site WHERE d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY' AND ws1.ws_ship_date_sk = d_date_sk AND ws1.ws_ship_addr_sk = ca_address_sk AND ca_state IN ('MO', 'MT', 'OK', 'SC', 'TX', 'WI') AND ws1.ws_web_site_sk = web_site_sk AND web_gmt_offset >= -5 AND EXISTS(SELECT * FROM ws_base AS ws2 WHERE ws1.ws_order_number = ws2.ws_order_number AND ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk) AND NOT EXISTS(SELECT * FROM web_returns AS wr1 WHERE ws1.ws_order_number = wr1.wr_order_number AND wr1.wr_reason_sk IN (8, 18, 20, 23, 41)) ORDER BY COUNT(DISTINCT ws_order_number) LIMIT 100;",
      "has_explain": false,
      "description": "Create ws_base AS (SELECT ws_order_number, ws_warehouse_sk, ws_ext_ship_cost, ws_net_profit FROM web_sales WHERE ws_list_price BETWEEN 253 AND 282). Replace all ws1 references with ws_base and update EXISTS subquery to use ws_base"
    },
    {
      "patch_id": "p06",
      "family": "A",
      "transform": "prefetch_fact_join",
      "relevance_score": 0.6,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH date_cte AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY'), ws_prefilter AS (SELECT * FROM web_sales AS ws INNER JOIN date_cte AS dd ON ws.ws_ship_date_sk = dd.d_date_sk WHERE ws.ws_list_price BETWEEN 253 AND 282) SELECT COUNT(DISTINCT ws_order_number) AS \"order count\", SUM(ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws_net_profit) AS \"total net profit\" FROM ws_prefilter AS ws1, customer_address, web_site WHERE d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY' AND ws1.ws_ship_date_sk = d_date_sk AND ws1.ws_ship_addr_sk = ca_address_sk AND ca_state IN ('MO', 'MT', 'OK', 'SC', 'TX', 'WI') AND ws1.ws_web_site_sk = web_site_sk AND web_gmt_offset >= -5 AND ws1.ws_list_price BETWEEN 253 AND 282 AND EXISTS(SELECT * FROM web_sales AS ws2 WHERE ws1.ws_order_number = ws2.ws_order_number AND ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk) AND NOT EXISTS(SELECT * FROM web_returns AS wr1 WHERE ws1.ws_order_number = wr1.wr_order_number AND wr1.wr_reason_sk IN (8, 18, 20, 23, 41)) ORDER BY COUNT(DISTINCT ws_order_number) LIMIT 100;",
      "has_explain": false,
      "description": "Stage reduction: 1) date_cte (as p03), 2) ws_prefilter AS (SELECT * FROM web_sales INNER JOIN date_cte ON ws_ship_date_sk=d_date_sk WHERE ws_list_price BETWEEN 253 AND 282), 3) Join ws_prefilter with other dimensions"
    },
    {
      "patch_id": "p07",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.5,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: LITERAL MISMATCH: Original literals missing from rewrite \u2014 numbers: ['18.0', '20.0', '23.0', '41.0', '8.0']. The rewrite changed filter values instead of preserving them.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH ws_agg AS (SELECT ws_order_number, SUM(ws_ext_ship_cost) AS ship_cost, SUM(ws_net_profit) AS profit, MAX(ws_warehouse_sk) AS warehouse_sk FROM web_sales WHERE ws_list_price BETWEEN 253 AND 282 GROUP BY ws_order_number) SELECT COUNT(DISTINCT ws_order_number) AS \"order count\", SUM(ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws_net_profit) AS \"total net profit\" FROM ws_agg JOIN date_dim ON ws_agg.ws_order_number = ws1.ws_order_number AND ws1.ws_ship_date_sk = d_date_sk JOIN customer_address ON ws1.ws_ship_addr_sk = ca_address_sk JOIN web_site ON ws1.ws_web_site_sk = web_site_sk WHERE d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY' AND ca_state IN ('MO', 'MT', 'OK', 'SC', 'TX', 'WI') AND web_gmt_offset >= -5 AND ws1.ws_list_price BETWEEN 253 AND 282 ORDER BY COUNT(DISTINCT ws_order_number) LIMIT 100;",
      "has_explain": false,
      "description": "Create ws_agg AS (SELECT ws_order_number, SUM(ws_ext_ship_cost) AS ship_cost, SUM(ws_net_profit) AS profit, MAX(ws_warehouse_sk) AS warehouse_sk FROM web_sales WHERE ... GROUP BY ws_order_number). Replace original ws1 with ws_agg in main FROM"
    },
    {
      "patch_id": "p09",
      "family": "B",
      "transform": "composite_decorrelate_union",
      "relevance_score": 0.5,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH order_flags AS (SELECT o.ws_order_number, EXISTS(SELECT 1 FROM web_sales AS w WHERE w.ws_order_number = o.ws_order_number AND w.ws_warehouse_sk <> o.ws_warehouse_sk) AS multi_wh, NOT EXISTS(SELECT 1 FROM web_returns AS wr1 WHERE wr1.wr_order_number = o.ws_order_number AND wr1.wr_reason_sk IN (8, 18, 20, 23, 41)) AS has_return FROM web_sales AS o) SELECT COUNT(DISTINCT ws_order_number) AS \"order count\", SUM(ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws_net_profit) AS \"total net profit\" FROM web_sales AS ws1 JOIN date_dim ON ws1.ws_ship_date_sk = d_date_sk JOIN customer_address ON ws1.ws_ship_addr_sk = ca_address_sk JOIN web_site ON ws1.ws_web_site_sk = web_site_sk JOIN order_flags AS OF ON ws1.ws_order_number = OF.ws_order_number WHERE d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY' AND ca_state IN ('MO', 'MT', 'OK', 'SC', 'TX', 'WI') AND web_gmt_offset >= -5 AND ws1.ws_list_price BETWEEN 253 AND 282 AND OF.multi_wh = TRUE AND OF.has_return = FALSE ORDER BY COUNT(DISTINCT ws_order_number) LIMIT 100;",
      "has_explain": false,
      "description": "Combine p01/p02 into single CTE: order_flags AS (SELECT o.ws_order_number, EXISTS(SELECT 1 FROM web_sales w WHERE w.ws_order_number=o.ws_order_number AND w.ws_warehouse_sk <> o.ws_warehouse_sk) AS multi_wh, EXISTS(SELECT 1 FROM web_returns ...) AS has_return FROM web_sales o). Then filter WHERE multi_wh=true AND has_return=false"
    },
    {
      "patch_id": "p12",
      "family": "C",
      "transform": "single_pass_aggregation",
      "relevance_score": 0.4,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH order_summary AS (SELECT ws_order_number, COUNT(DISTINCT ws_warehouse_sk) > 1 AS multi_wh, SUM(ws_ext_ship_cost) AS ship_cost, SUM(ws_net_profit) AS profit FROM web_sales GROUP BY ws_order_number) SELECT COUNT(DISTINCT os.ws_order_number) AS \"order count\", SUM(os.ship_cost) AS \"total shipping cost\", SUM(os.profit) AS \"total net profit\" FROM order_summary AS os JOIN web_sales AS ws1 ON os.ws_order_number = ws1.ws_order_number JOIN date_dim AS dd ON ws1.ws_ship_date_sk = dd.d_date_sk JOIN customer_address AS ca ON ws1.ws_ship_addr_sk = ca.ca_address_sk JOIN web_site AS w ON ws1.ws_web_site_sk = w.web_site_sk WHERE dd.d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY' AND ca.ca_state IN ('MO', 'MT', 'OK', 'SC', 'TX', 'WI') AND w.web_gmt_offset >= -5 AND ws1.ws_list_price BETWEEN 253 AND 282 AND os.multi_wh = TRUE AND NOT EXISTS(SELECT 1 FROM web_returns AS wr1 WHERE os.ws_order_number = wr1.wr_order_number AND wr1.wr_reason_sk IN (8, 18, 20, 23, 41)) ORDER BY COUNT(DISTINCT os.ws_order_number) LIMIT 100;",
      "has_explain": false,
      "description": "Consolidate aggregations: Create order_summary AS (SELECT ws_order_number, COUNT(DISTINCT ws_warehouse_sk) > 1 AS multi_wh, SUM(ws_ext_ship_cost) AS ship_cost, SUM(ws_net_profit) AS profit FROM web_sales ... GROUP BY ws_order_number). Replace main query with join to order_summary"
    },
    {
      "patch_id": "snipe_p1",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Step s2 failed: replace_from requires from_sql",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p2",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Step s3 failed: replace_from requires from_sql",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p1",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Step s2 failed: replace_from requires from_sql",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p2",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH date_cte AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY'), ws_prefilter AS (SELECT ws1.* FROM web_sales AS ws1 INNER JOIN date_cte ON ws1.ws_ship_date_sk = date_cte.d_date_sk WHERE ws1.ws_list_price BETWEEN 253 AND 282), multi_warehouse AS (SELECT ws_order_number FROM web_sales GROUP BY ws_order_number HAVING COUNT(DISTINCT ws_warehouse_sk) > 1), problem_orders AS (SELECT wr_order_number FROM web_returns WHERE wr_reason_sk IN (8, 18, 20, 23, 41)) SELECT COUNT(DISTINCT ws1.ws_order_number) AS \"order count\", SUM(ws1.ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws1.ws_net_profit) AS \"total net profit\" FROM ws_prefilter AS ws1 INNER JOIN customer_address ON ws1.ws_ship_addr_sk = customer_address.ca_address_sk INNER JOIN web_site ON ws1.ws_web_site_sk = web_site.web_site_sk INNER JOIN multi_warehouse AS mw ON ws1.ws_order_number = mw.ws_order_number LEFT JOIN problem_orders AS po ON ws1.ws_order_number = po.wr_order_number WHERE customer_address.ca_state IN ('MO', 'MT', 'OK', 'SC', 'TX', 'WI') AND web_site.web_gmt_offset >= -5 AND po.wr_order_number IS NULL ORDER BY COUNT(DISTINCT ws_order_number) LIMIT 100;",
      "has_explain": false,
      "description": null
    }
  ],
  "explains": {}
}