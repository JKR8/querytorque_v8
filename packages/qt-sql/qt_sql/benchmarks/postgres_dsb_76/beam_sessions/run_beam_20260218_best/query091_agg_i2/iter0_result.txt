{
  "iteration": 0,
  "n_api_calls": 8,
  "beam_cost_usd": 0.02699174,
  "beam_cost_priced_calls": 8,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 99896,
    "completion_tokens": 15680,
    "total_tokens": 115576,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 26688,
    "reasoning_tokens": 5868
  },
  "best_speedup": 2.37,
  "best_patch_id": "compile_p1",
  "best_sql": "WITH filtered_customer AS (\n  SELECT \n    c.c_customer_sk,\n    cd.cd_marital_status,\n    cd.cd_education_status\n  FROM customer c\n  JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk\n  JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk\n  JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk\n  WHERE \n    hd.hd_buy_potential LIKE '>10000%'\n    AND ca.ca_gmt_offset = -6\n    AND ( (cd.cd_marital_status = 'M' AND cd.cd_education_status = 'Unknown')\n          OR (cd.cd_marital_status = 'W' AND cd.cd_education_status = 'Advanced Degree') )\n)\nSELECT \n  cc.cc_call_center_id AS Call_Center,\n  cc.cc_name AS Call_Center_Name,\n  cc.cc_manager AS Manager,\n  SUM(cr.cr_net_loss) AS Returns_Loss\nFROM \n  filtered_customer fc\n  JOIN catalog_returns cr ON fc.c_customer_sk = cr.cr_returning_customer_sk\n  JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk\n  JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk\nWHERE \n  d.d_year = 2001\n  AND d.d_moy = 12\nGROUP BY \n  cc.cc_call_center_id, \n  cc.cc_name, \n  cc.cc_manager,\n  fc.cd_marital_status,\n  fc.cd_education_status\nORDER BY \n  SUM(cr.cr_net_loss) DESC;",
  "patches": [
    {
      "patch_id": "p03",
      "family": "D",
      "transform": "or_to_union",
      "relevance_score": 0.45,
      "status": "REGRESSION",
      "speedup": 0.78,
      "semantic_passed": true,
      "error": null,
      "original_ms": 381.3,
      "patch_ms": 487.0,
      "output_sql": "select  \n        cc_call_center_id Call_Center,\n        cc_name Call_Center_Name,\n        cc_manager Manager,\n        sum(cr_net_loss) Returns_Loss\nfrom\n        call_center,\n        catalog_returns,\n        date_dim,\n        customer,\n        customer_address,\n        customer_demographics,\n        household_demographics\nwhere\n        cr_call_center_sk       = cc_call_center_sk\nand     cr_returned_date_sk     = d_date_sk\nand     cr_returning_customer_sk= c_customer_sk\nand     cd_demo_sk              = c_current_cdemo_sk\nand     hd_demo_sk              = c_current_hdemo_sk\nand     ca_address_sk           = c_current_addr_sk\nand     d_year                  = 2001 \nand     d_moy                   = 12\nand     ( (cd_marital_status       = 'M' and cd_education_status     = 'Unknown')\n        or(cd_marital_status       = 'W' and cd_education_status     = 'Advanced Degree'))\nand     hd_buy_potential like '>10000%'\nand     ca_gmt_offset           = -6\ngroup by cc_call_center_id,cc_name,cc_manager,cd_marital_status,cd_education_status\norder by sum(cr_net_loss) desc;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Split the OR condition on customer_demographics into two UNION ALL branches, each with a separate CTE pre\u2011filtering the dimension, then union the results before joining with customer."
    },
    {
      "patch_id": "p04",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.65,
      "status": "REGRESSION",
      "speedup": 0.77,
      "semantic_passed": true,
      "error": null,
      "original_ms": 381.3,
      "patch_ms": 495.8,
      "output_sql": "WITH filtered_date AS (SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE d_year = 2001 AND d_moy = 12) SELECT cc.cc_call_center_id AS Call_Center, cc.cc_name AS Call_Center_Name, cc.cc_manager AS Manager, SUM(cr.cr_net_loss) AS Returns_Loss FROM call_center cc INNER JOIN catalog_returns cr ON cc.cc_call_center_sk = cr.cr_call_center_sk INNER JOIN filtered_date fd ON cr.cr_returned_date_sk = fd.d_date_sk INNER JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk INNER JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk INNER JOIN household_demographics hd ON hd.hd_demo_sk = c.c_current_hdemo_sk INNER JOIN customer_address ca ON ca.ca_address_sk = c.c_current_addr_sk WHERE fd.d_year = 2001 AND fd.d_moy = 12 AND ((cd.cd_marital_status = 'M' AND cd.cd_education_status = 'Unknown') OR (cd.cd_marital_status = 'W' AND cd.cd_education_status = 'Advanced Degree')) AND hd.hd_buy_potential LIKE '>10000%' AND ca.ca_gmt_offset = -6 GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_manager, cd.cd_marital_status, cd.cd_education_status ORDER BY SUM(cr.cr_net_loss) DESC;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Convert comma joins to explicit INNER JOIN syntax and isolate date_dim into a CTE to ensure its filter is applied before joining with catalog_returns."
    },
    {
      "patch_id": "p01",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.82,
      "status": "REGRESSION",
      "speedup": 0.77,
      "semantic_passed": true,
      "error": null,
      "original_ms": 381.3,
      "patch_ms": 495.7,
      "output_sql": "WITH filtered_cd AS (SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE (cd_marital_status = 'M' AND cd_education_status = 'Unknown') OR (cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree')), filtered_hd AS (SELECT hd_demo_sk, hd_buy_potential FROM household_demographics WHERE hd_buy_potential LIKE '>10000%'), filtered_ca AS (SELECT ca_address_sk, ca_gmt_offset FROM customer_address WHERE ca_gmt_offset = -6), filtered_customers AS (SELECT c.c_customer_sk, cd.cd_marital_status, cd.cd_education_status FROM customer c JOIN filtered_cd cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN filtered_hd hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN filtered_ca ca ON c.c_current_addr_sk = ca.ca_address_sk), agg_results AS (SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_manager, fc.cd_marital_status, fc.cd_education_status, cr.cr_net_loss FROM filtered_customers fc JOIN catalog_returns cr ON fc.c_customer_sk = cr.cr_returning_customer_sk JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk WHERE d.d_year = 2001 AND d.d_moy = 12) SELECT cc_call_center_id AS Call_Center, cc_name AS Call_Center_Name, cc_manager AS Manager, sum(cr_net_loss) AS Returns_Loss FROM agg_results GROUP BY cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status ORDER BY sum(cr_net_loss) DESC;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-filter all selective dimension tables (customer_demographics, household_demographics, customer_address) into separate CTEs with their filters, then join them with customer, then join the reduced customer keyset with catalog_returns, date_dim, and call_center using explicit JOIN syntax."
    },
    {
      "patch_id": "p02",
      "family": "A",
      "transform": "early_filter_decorrelate",
      "relevance_score": 0.75,
      "status": "REGRESSION",
      "speedup": 0.78,
      "semantic_passed": true,
      "error": null,
      "original_ms": 381.3,
      "patch_ms": 486.0,
      "output_sql": "WITH customer_demographics_filtered AS (SELECT cd_demo_sk FROM customer_demographics WHERE (cd_marital_status = 'M' AND cd_education_status = 'Unknown') OR (cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree')), customer_filtered AS (SELECT c.c_customer_sk, c.c_current_hdemo_sk, c.c_current_addr_sk FROM customer c JOIN customer_demographics_filtered cdf ON c.c_current_cdemo_sk = cdf.cd_demo_sk), main_join AS (SELECT cr.cr_call_center_sk AS cc_call_center_sk, cr.cr_net_loss AS cr_net_loss FROM catalog_returns cr JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk JOIN customer_filtered cf ON cr.cr_returning_customer_sk = cf.c_customer_sk JOIN household_demographics hd ON cf.c_current_hdemo_sk = hd.hd_demo_sk JOIN customer_address ca ON cf.c_current_addr_sk = ca.ca_address_sk WHERE d.d_year = 2001 AND d.d_moy = 12 AND hd.hd_buy_potential LIKE '>10000%' AND ca.ca_gmt_offset = -6) SELECT cc.cc_call_center_id AS Call_Center, cc.cc_name AS Call_Center_Name, cc.cc_manager AS Manager, SUM(mj.cr_net_loss) AS Returns_Loss FROM main_join mj JOIN call_center cc ON mj.cc_call_center_sk = cc.cc_call_center_sk GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_manager ORDER BY SUM(mj.cr_net_loss) DESC;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Push OR predicate on customer_demographics into a CTE, then join with customer, household_demographics, and customer_address to produce a filtered customer keyset before joining with catalog_returns."
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 2.37,
      "semantic_passed": true,
      "error": null,
      "original_ms": 2750.6,
      "patch_ms": 1158.2,
      "output_sql": "WITH filtered_customer AS (\n  SELECT \n    c.c_customer_sk,\n    cd.cd_marital_status,\n    cd.cd_education_status\n  FROM customer c\n  JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk\n  JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk\n  JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk\n  WHERE \n    hd.hd_buy_potential LIKE '>10000%'\n    AND ca.ca_gmt_offset = -6\n    AND ( (cd.cd_marital_status = 'M' AND cd.cd_education_status = 'Unknown')\n          OR (cd.cd_marital_status = 'W' AND cd.cd_education_status = 'Advanced Degree') )\n)\nSELECT \n  cc.cc_call_center_id AS Call_Center,\n  cc.cc_name AS Call_Center_Name,\n  cc.cc_manager AS Manager,\n  SUM(cr.cr_net_loss) AS Returns_Loss\nFROM \n  filtered_customer fc\n  JOIN catalog_returns cr ON fc.c_customer_sk = cr.cr_returning_customer_sk\n  JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk\n  JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk\nWHERE \n  d.d_year = 2001\n  AND d.d_moy = 12\nGROUP BY \n  cc.cc_call_center_id, \n  cc.cc_name, \n  cc.cc_manager,\n  fc.cd_marital_status,\n  fc.cd_education_status\nORDER BY \n  SUM(cr.cr_net_loss) DESC;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p2",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 2.37,
      "semantic_passed": true,
      "error": null,
      "original_ms": 2750.6,
      "patch_ms": 1160.7,
      "output_sql": "SELECT \n  cc.cc_call_center_id AS Call_Center,\n  cc.cc_name AS Call_Center_Name,\n  cc.cc_manager AS Manager,\n  SUM(cr.cr_net_loss) AS Returns_Loss\nFROM \n  call_center cc,\n  catalog_returns cr,\n  date_dim d,\n  LATERAL (\n    SELECT \n      c.c_customer_sk,\n      cd.cd_marital_status,\n      cd.cd_education_status\n    FROM \n      customer c\n      JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk\n      JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk\n      JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk\n    WHERE \n      cr.cr_returning_customer_sk = c.c_customer_sk\n      AND hd.hd_buy_potential LIKE '>10000%'\n      AND ca.ca_gmt_offset = -6\n      AND ( (cd.cd_marital_status = 'M' AND cd.cd_education_status = 'Unknown')\n            OR (cd.cd_marital_status = 'W' AND cd.cd_education_status = 'Advanced Degree') )\n  ) fc\nWHERE \n  cr.cr_call_center_sk = cc.cc_call_center_sk\n  AND cr.cr_returned_date_sk = d.d_date_sk\n  AND d.d_year = 2001\n  AND d.d_moy = 12\nGROUP BY \n  cc.cc_call_center_id, \n  cc.cc_name, \n  cc.cc_manager,\n  fc.cd_marital_status,\n  fc.cd_education_status\nORDER BY \n  SUM(cr.cr_net_loss) DESC;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p03": "Sort  (rows=8, time=465.711)\n  Aggregate  (rows=8, time=465.694)\n    Gather Merge  (rows=8, time=465.684)\n      Aggregate  (rows=8, time=465.16)\n        Sort  (rows=470, time=465.086)\n          Nested Loop  (rows=470, time=464.489)\n            Nested Loop  (rows=869, time=457.287)\n              Nested Loop  (rows=5564, time=411.767)\n                Nested Loop  (rows=31226, time=379.475)\n                  Hash Join  (rows=31526, time=217.0)\n                    Hash Join  (rows=32159, time=213.18",
    "p04": "Sort  (rows=8, time=442.917)\n  Aggregate  (rows=8, time=442.903)\n    Gather Merge  (rows=8, time=442.893)\n      Aggregate  (rows=8, time=442.538)\n        Sort  (rows=470, time=442.467)\n          Nested Loop  (rows=470, time=441.991)\n            Nested Loop  (rows=869, time=435.378)\n              Nested Loop  (rows=5564, time=393.542)\n                Nested Loop  (rows=31226, time=362.184)\n                  Hash Join  (rows=31526, time=213.833)\n                    Hash Join  (rows=32159, time=210",
    "p01": "Sort  (rows=8, time=439.061)\n  Aggregate  (rows=8, time=439.048)\n    Gather Merge  (rows=8, time=439.037)\n      Aggregate  (rows=8, time=438.584)\n        Sort  (rows=470, time=438.514)\n          Nested Loop  (rows=470, time=438.056)\n            Nested Loop  (rows=869, time=431.455)\n              Nested Loop  (rows=5564, time=389.789)\n                Nested Loop  (rows=31226, time=359.719)\n                  Hash Join  (rows=31526, time=209.975)\n                    Hash Join  (rows=32159, time=206",
    "p02": "Sort  (rows=8, time=457.824)\n  Aggregate  (rows=8, time=457.807)\n    Sort  (rows=470, time=457.739)\n      Gather  (rows=470, time=456.378)\n        Nested Loop  (rows=470, time=455.381)\n          Nested Loop  (rows=869, time=448.471)\n            Nested Loop  (rows=5564, time=405.053)\n              Nested Loop  (rows=31226, time=373.915)\n                Hash Join  (rows=31526, time=216.106)\n                  Hash Join  (rows=32159, time=212.156)\n                    Seq Scan on catalog_returns (cr)",
    "compile_p1": "Sort  (rows=8, time=1312.857)\n  Aggregate  (rows=8, time=1312.835)\n    Gather Merge  (rows=8, time=1312.814)\n      Aggregate  (rows=8, time=1312.238)\n        Sort  (rows=470, time=1312.031)\n          Nested Loop  (rows=470, time=1310.647)\n            Nested Loop  (rows=869, time=1293.85)\n              Nested Loop  (rows=5564, time=1184.255)\n                Nested Loop  (rows=31226, time=1073.386)\n                  Hash Join  (rows=31526, time=652.916)\n                    Hash Join  (rows=32159, ",
    "compile_p2": "Sort  (rows=8, time=1012.085)\n  Aggregate  (rows=8, time=1011.987)\n    Gather Merge  (rows=8, time=1011.976)\n      Aggregate  (rows=8, time=1010.354)\n        Sort  (rows=470, time=1010.269)\n          Nested Loop  (rows=470, time=1009.06)\n            Nested Loop  (rows=869, time=993.515)\n              Nested Loop  (rows=5564, time=894.152)\n                Nested Loop  (rows=31226, time=796.008)\n                  Hash Join  (rows=31526, time=424.179)\n                    Hash Join  (rows=32159, tim"
  }
}