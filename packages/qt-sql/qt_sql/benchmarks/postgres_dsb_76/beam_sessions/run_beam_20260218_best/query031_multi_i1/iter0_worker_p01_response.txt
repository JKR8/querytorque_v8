{
  "probe_id": "p0",
  "transform_id": "date_cte_explicit_join",
  "family": "A",
  "status": "success",
  "dialect": "postgres",
  "hypothesis": "Converting comma-style joins to explicit INNER JOINs in the ss and ws CTEs, and pre-filtering date_dim into a small CTE, will allow PostgreSQL to use hash joins and reduce row count early.",
  "reasoning_trace": [
    "Assigned transform targets comma joins in ss and ws CTEs.",
    "Pre-filtering date_dim into a small CTE reduces the dimension table size for joining.",
    "Explicit JOIN syntax helps the optimizer choose better join orders and avoid nested loops.",
    "Node contract fields are preserved, and no semantic drift is introduced."
  ],
  "target_ir": "ss and ws CTEs use explicit JOIN syntax; date_dim pre-filtered into a small CTE.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["ss", "ws"],
        "outputs": ["ca_county", "d_year", "web_q1_q2_increase", "store_q1_q2_increase", "web_q2_q3_increase", "store_q2_q3_increase"],
        "changed": false
      },
      {
        "node_id": "ss",
        "parent_node_id": "final_select",
        "sources": ["store_sales", "date_dim", "customer_address", "item"],
        "outputs": ["ca_county", "d_qoy", "d_year", "store_sales"],
        "changed": true,
        "sql": "SELECT ca_county, d_qoy, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales ss INNER JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk INNER JOIN item i ON ss.ss_item_sk = i.i_item_sk INNER JOIN (SELECT d_date_sk FROM date_dim WHERE d_year = 1998) d_filtered ON ss.ss_sold_date_sk = d_filtered.d_date_sk WHERE i.i_color IN ('navajo', 'orchid') AND i.i_manager_id BETWEEN 8 AND 27 AND ss.ss_list_price BETWEEN 86 AND 100 AND ca.ca_state IN ('IA', 'IL') GROUP BY ca_county, d_qoy, d_year"
      },
      {
        "node_id": "ws",
        "parent_node_id": "final_select",
        "sources": ["web_sales", "date_dim", "customer_address", "item"],
        "outputs": ["ca_county", "d_qoy", "d_year", "web_sales"],
        "changed": true,
        "sql": "SELECT ca_county, d_qoy, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales ws INNER JOIN customer_address ca ON ws.ws_bill_addr_sk = ca.ca_address_sk INNER JOIN item i ON ws.ws_item_sk = i.i_item_sk INNER JOIN (SELECT d_date_sk FROM date_dim WHERE d_year = 1998) d_filtered ON ws.ws_sold_date_sk = d_filtered.d_date_sk WHERE i.i_color IN ('navajo', 'orchid') AND i.i_manager_id BETWEEN 8 AND 27 AND ws.ws_list_price BETWEEN 86 AND 100 AND ca.ca_state IN ('IA', 'IL') GROUP BY ca_county, d_qoy, d_year"
      }
    ]
  }
}