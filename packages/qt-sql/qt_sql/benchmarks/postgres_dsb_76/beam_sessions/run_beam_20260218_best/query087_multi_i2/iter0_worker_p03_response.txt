{
  "probe_id": "p12",
  "transform_id": "date_cte_explicit_join",
  "family": "F",
  "status": "success",
  "dialect": "postgres",
  "hypothesis": "Materializing filtered date_dim once as a CTE and converting comma joins to explicit JOIN syntax will reduce repeated scans and improve cardinality estimates.",
  "reasoning_trace": [
    "Assigned transform targets comma-join pattern with repeated date_dim scans.",
    "Creating a CTE for filtered date_dim reduces scan count from 3 to 1.",
    "Explicit JOIN syntax gives planner better join and cardinality modeling."
  ],
  "target_ir": "filtered_date_dim CTE added; comma joins replaced with explicit JOINs in three subqueries.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["cool_cust"],
        "outputs": ["count(*)"],
        "changed": true,
        "sql": "select count(*)\nfrom cool_cust"
      },
      {
        "node_id": "cool_cust",
        "parent_node_id": "final_select",
        "sources": ["filtered_date_dim", "store_sales", "catalog_sales", "web_sales", "customer"],
        "outputs": ["c_last_name", "c_first_name", "d_date"],
        "changed": true,
        "sql": "with filtered_date_dim as (\n  select d_date_sk, d_date\n  from date_dim\n  where d_month_seq between 1213 and 1213+11\n)\nselect distinct c_last_name, c_first_name, d_date\nfrom (\n  (\n    select distinct c_last_name, c_first_name, d_date\n    from store_sales\n    join filtered_date_dim on store_sales.ss_sold_date_sk = filtered_date_dim.d_date_sk\n    join customer on store_sales.ss_customer_sk = customer.c_customer_sk\n    where ss_list_price between 168 and 197\n      and c_birth_year BETWEEN 1968 AND 1974\n      and ss_wholesale_cost BETWEEN 76 AND 86\n  )\n  except\n  (\n    select distinct c_last_name, c_first_name, d_date\n    from catalog_sales\n    join filtered_date_dim on catalog_sales.cs_sold_date_sk = filtered_date_dim.d_date_sk\n    join customer on catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n    where cs_list_price between 168 and 197\n      and c_birth_year BETWEEN 1968 AND 1974\n      and cs_wholesale_cost BETWEEN 76 AND 86\n  )\n  except\n  (\n    select distinct c_last_name, c_first_name, d_date\n    from web_sales\n    join filtered_date_dim on web_sales.ws_sold_date_sk = filtered_date_dim.d_date_sk\n    join customer on web_sales.ws_bill_customer_sk = customer.c_customer_sk\n    where ws_list_price between 168 and 197\n      and c_birth_year BETWEEN 1968 AND 1974\n      and ws_wholesale_cost BETWEEN 76 AND 86\n  )\n) cool_cust"
      }
    ]
  }
}