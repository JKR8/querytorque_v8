```json
[
  {
    "plan_id": "compile_p1",
    "dialect": "postgres",
    "confidence": 0.58,
    "based_on": "p01",
    "strategy": "Convert comma joins to explicit INNER JOIN syntax while preserving original join order; push date_dim d1 filter early via CTE.",
    "hypothesis": "Probe p01 regressed (0.41x) but its explicit-join rewrite may be salvageable with less aggressive join reordering. Original plan shows severe cardinality misestimate at Gather (est=1, act=1917). Explicit joins give planner more flexibility, and filtered CTE on d1 may help reduce nested-loop amplification. Maintain all original join conditions and semantic safety.",
    "expected_explain_delta": "Nested loops may remain but with better cardinality estimates; explicit join syntax may enable better reordering.",
    "target_ir": "Replace comma joins with explicit INNER JOINs; isolate date_dim d1 filter into a CTE.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["filtered_d1", "store_sales", "store_returns", "web_sales", "date_dim_d2", "item", "customer", "customer_address", "household_demographics"],
          "outputs": ["c_customer_sk", "c_first_name", "c_last_name", "cnt"],
          "changed": true,
          "sql": "SELECT c.c_customer_sk, c.c_first_name, c.c_last_name, COUNT(*) AS cnt FROM filtered_d1 d1 INNER JOIN store_returns sr ON sr.sr_returned_date_sk = d1.d_date_sk INNER JOIN store_sales ss ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk INNER JOIN web_sales ws ON ss.ss_customer_sk = ws.ws_bill_customer_sk AND ws.ws_item_sk = sr.sr_item_sk INNER JOIN date_dim d2 ON ws.ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 day') INNER JOIN item i ON i.i_item_sk = ss.ss_item_sk INNER JOIN customer c ON c.c_customer_sk = ss.ss_customer_sk INNER JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE i.i_category IN ('Children', 'Home', 'Women') AND ca.ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA') AND hd.hd_income_band_sk BETWEEN 8 AND 14 AND hd.hd_buy_potential = '501-1000' AND ss.ss_sales_price / ss.ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01 GROUP BY c.c_customer_sk, c.c_first_name, c.c_last_name ORDER BY cnt"
        },
        {
          "node_id": "filtered_d1",
          "parent_node_id": "final_select",
          "sources": ["date_dim"],
          "outputs": ["d_date_sk", "d_date"],
          "changed": true,
          "sql": "SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2000"
        }
      ]
    }
  },
  {
    "plan_id": "compile_p2",
    "dialect": "postgres",
    "confidence": 0.45,
    "based_on": "p03",
    "strategy": "Prefilter selective dimensions via CTEs, correct syntax error from p03, and join facts to filtered dimensions.",
    "hypothesis": "Probe p03 failed with syntax error (sr.ws_bill_customer_sk). Corrected version pre‑filters item, customer_address, household_demographics, and date_dim d1 to reduce rows early. This targets residual gap: original nested loop between date_dim d1 and store_returns (rows=389199) remains unaddressed by other probes. CTEs may act as optimization fences, but selective filters are high‑cardinality reductions.",
    "expected_explain_delta": "Index scans on dimension tables become CTE scans; nested‑loop input rows reduced before joining with large fact tables.",
    "target_ir": "Add four dimension‑prefilter CTEs and rewrite main join to use explicit joins with filtered CTEs.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["filtered_item", "filtered_ca", "filtered_hd", "filtered_d1", "store_sales", "store_returns", "web_sales", "date_dim_d2", "customer"],
          "outputs": ["c_customer_sk", "c_first_name", "c_last_name", "cnt"],
          "changed": true,
          "sql": "SELECT c.c_customer_sk, c.c_first_name, c.c_last_name, COUNT(*) AS cnt FROM store_sales ss INNER JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk INNER JOIN web_sales ws ON ss.ss_customer_sk = ws.ws_bill_customer_sk AND sr.sr_item_sk = ws.ws_item_sk INNER JOIN filtered_d1 d1 ON sr.sr_returned_date_sk = d1.d_date_sk INNER JOIN date_dim d2 ON ws.ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 day') INNER JOIN filtered_item i ON i.i_item_sk = ss.ss_item_sk INNER JOIN customer c ON c.c_customer_sk = ss.ss_customer_sk INNER JOIN filtered_ca ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN filtered_hd hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE ss.ss_sales_price / ss.ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01 GROUP BY c.c_customer_sk, c.c_first_name, c.c_last_name ORDER BY cnt"
        },
        {
          "node_id": "filtered_d1",
          "parent_node_id": "final_select",
          "sources": ["date_dim"],
          "outputs": ["d_date_sk", "d_date"],
          "changed": true,
          "sql": "SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2000"
        },
        {
          "node_id": "filtered_item",
          "parent_node_id": "final_select",
          "sources": ["item"],
          "outputs": ["i_item_sk"],
          "changed": true,
          "sql": "SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Home', 'Women')"
        },
        {
          "node_id": "filtered_ca",
          "parent_node_id": "final_select",
          "sources": ["customer_address"],
          "outputs": ["ca_address_sk"],
          "changed": true,
          "sql": "SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA')"
        },
        {
          "node_id": "filtered_hd",
          "parent_node_id": "final_select",
          "sources": ["household_demographics"],
          "outputs": ["hd_demo_sk"],
          "changed": true,
          "sql": "SELECT hd_demo_sk FROM household_demographics WHERE hd_income_band_sk BETWEEN 8 AND 14 AND hd_buy_potential = '501-1000'"
        }
      ]
    }
  }
]
```