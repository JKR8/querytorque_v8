{
  "probe_id": "p12",
  "transform_id": "dimension_prefetch_star",
  "family": "F",
  "status": "success",
  "dialect": "postgresql",
  "hypothesis": "Pre-filtering customer, customer_address, and customer_demographics into dedicated CTEs with selective predicates enables PostgreSQL to build tiny hash tables for faster joins and better cardinality estimates.",
  "reasoning_trace": [
    "Assigned transform targets comma-join structure with selective dimension filters.",
    "Changing FROM comma-join to explicit INNER JOINs after prefetching dimensions aligns with PostgreSQL optimizer strengths.",
    "Dimension CTEs isolate selective predicates and allow hash join optimizations."
  ],
  "target_ir": "Dimension tables pre-filtered into CTEs; comma-join replaced with explicit INNER JOINs.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["customer_prefetch", "customer_address_prefetch", "customer_demographics_prefetch"],
        "outputs": ["cd_gender", "cd_marital_status", "cd_education_status", "cnt1", "cd_purchase_estimate", "cnt2", "cd_credit_rating", "cnt3", "cd_dep_count", "cnt4", "cd_dep_employed_count", "cnt5", "cd_dep_college_count", "cnt6"],
        "changed": true,
        "sql": "SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(*) AS cnt1, cd.cd_purchase_estimate, COUNT(*) AS cnt2, cd.cd_credit_rating, COUNT(*) AS cnt3, cd.cd_dep_count, COUNT(*) AS cnt4, cd.cd_dep_employed_count, COUNT(*) AS cnt5, cd.cd_dep_college_count, COUNT(*) AS cnt6 FROM customer_prefetch c INNER JOIN customer_address_prefetch ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN customer_demographics_prefetch cd ON cd.cd_demo_sk = c.c_current_cdemo_sk WHERE EXISTS (SELECT 1 FROM store_sales, date_dim, item WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5+3 AND ss_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 75 * 0.01 AND i_manager_id BETWEEN 91 AND 100) AND (EXISTS (SELECT 1 FROM web_sales, date_dim, item WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5+3 AND ws_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100 AND ws_sales_price / ws_list_price BETWEEN 65 * 0.01 AND 75 * 0.01) OR EXISTS (SELECT 1 FROM catalog_sales, date_dim, item WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5+3 AND cs_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100 AND cs_sales_price / cs_list_price BETWEEN 65 * 0.01 AND 75 * 0.01)) GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, cd.cd_dep_count, cd.cd_dep_employed_count, cd.cd_dep_college_count ORDER BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, cd.cd_dep_count, cd.cd_dep_employed_count, cd.cd_dep_college_count LIMIT 100"
      },
      {
        "node_id": "customer_prefetch",
        "parent_node_id": "final_select",
        "sources": ["customer"],
        "outputs": ["c_customer_sk", "c_current_addr_sk", "c_current_cdemo_sk"],
        "changed": true,
        "sql": "SELECT c_customer_sk, c_current_addr_sk, c_current_cdemo_sk FROM customer WHERE c_birth_month IN (4, 5)"
      },
      {
        "node_id": "customer_address_prefetch",
        "parent_node_id": "final_select",
        "sources": ["customer_address"],
        "outputs": ["ca_address_sk"],
        "changed": true,
        "sql": "SELECT ca_address_sk FROM customer_address WHERE ca_county IN ('Alameda County','Lexington city','Pender County','Petroleum County','Walworth County')"
      },
      {
        "node_id": "customer_demographics_prefetch",
        "parent_node_id": "final_select",
        "sources": ["customer_demographics"],
        "outputs": ["cd_demo_sk", "cd_gender", "cd_marital_status", "cd_education_status", "cd_purchase_estimate", "cd_credit_rating", "cd_dep_count", "cd_dep_employed_count", "cd_dep_college_count"],
        "changed": true,
        "sql": "SELECT cd_demo_sk, cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count FROM customer_demographics WHERE cd_marital_status IN ('U', 'S', 'U') AND cd_education_status IN ('College', 'Secondary', 'College') AND cd_gender = 'M'"
      }
    ]
  }
}