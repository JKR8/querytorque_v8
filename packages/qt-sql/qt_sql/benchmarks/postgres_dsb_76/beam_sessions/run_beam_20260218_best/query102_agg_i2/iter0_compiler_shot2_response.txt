[
  {
    "plan_id": "compile_explicit_no_cte",
    "dialect": "postgres",
    "confidence": 0.65,
    "based_on": "p01",
    "strategy": "Convert comma joins to explicit INNER JOIN syntax without CTE fences to enable native PostgreSQL join reordering and predicate pushdown.",
    "hypothesis": "All probes regressed or failed, but original plan shows severe cardinality underestimation at Merge Join driving nested loop. Explicit JOINs may improve predicate pushback and join order flexibility while respecting PostgreSQL's optimizer strengths.",
    "expected_explain_delta": "Merge Join replaced by hash joins, nested loop eliminated, early dimension filters applied before fact scans.",
    "target_ir": "Replace final_select with explicit INNER JOIN ON syntax preserving all original predicates.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["store_sales", "web_sales", "date_dim", "date_dim", "customer", "inventory", "store", "warehouse", "item", "customer_demographics", "household_demographics", "customer_address"],
          "outputs": ["cd_gender", "cd_marital_status", "cd_education_status", "hd_vehicle_count", "cnt"],
          "changed": true,
          "sql": "SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales ss INNER JOIN item i ON ss.ss_item_sk = i.i_item_sk INNER JOIN web_sales ws ON ws.ws_item_sk = ss.ss_item_sk INNER JOIN date_dim d1 ON ss.ss_sold_date_sk = d1.d_date_sk INNER JOIN date_dim d2 ON ws.ws_sold_date_sk = d2.d_date_sk INNER JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk AND ws.ws_bill_customer_sk = c.c_customer_sk INNER JOIN inventory inv ON inv.inv_item_sk = ss.ss_item_sk AND inv.inv_date_sk = ss.ss_sold_date_sk AND inv.inv_quantity_on_hand >= ss.ss_quantity INNER JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk AND inv.inv_warehouse_sk = w.w_warehouse_sk INNER JOIN store s ON s.s_state = w.w_state INNER JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk INNER JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk INNER JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 day') AND i.i_category IN ('Men', 'Shoes', 'Sports') AND i.i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98) AND ca.ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA') AND d1.d_year = 1998 AND ws.ws_wholesale_cost BETWEEN 76 AND 96 GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, hd.hd_vehicle_count ORDER BY cnt"
        }
      ]
    }
  }
]