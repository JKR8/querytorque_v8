{
  "iteration": 0,
  "n_api_calls": 8,
  "beam_cost_usd": 0.03102846,
  "beam_cost_priced_calls": 8,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 94141,
    "completion_tokens": 7605,
    "total_tokens": 101746,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 13933,
    "reasoning_tokens": 0
  },
  "best_speedup": 1.05,
  "best_patch_id": "compile_p2",
  "best_sql": "WITH date_dim_prefetch AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002), store_prefetch AS (SELECT s_store_sk, s_state FROM store WHERE s_state = 'IA'), item_prefetch AS (SELECT i_item_sk, i_item_id, i_category FROM item WHERE i_category = 'Sports'), customer_demographics_prefetch AS (SELECT cd_demo_sk, cd_gender, cd_marital_status, cd_education_status FROM customer_demographics WHERE cd_gender = 'F' AND cd_marital_status = 'M' AND cd_education_status = 'Primary') SELECT i.i_item_id, s.s_state, GROUPING(s.s_state) AS g_state, AVG(ss.ss_quantity) AS agg1, AVG(ss.ss_list_price) AS agg2, AVG(ss.ss_coupon_amt) AS agg3, AVG(ss.ss_sales_price) AS agg4 FROM store_sales ss JOIN date_dim_prefetch d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store_prefetch s ON ss.ss_store_sk = s.s_store_sk JOIN item_prefetch i ON ss.ss_item_sk = i.i_item_sk JOIN customer_demographics_prefetch cd ON ss.ss_cdemo_sk = cd.cd_demo_sk GROUP BY ROLLUP (i.i_item_id, s.s_state) ORDER BY i.i_item_id, s.s_state LIMIT 100;",
  "patches": [
    {
      "patch_id": "p01",
      "family": "A",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.85,
      "status": "REGRESSION",
      "speedup": 0.76,
      "semantic_passed": true,
      "error": null,
      "original_ms": 7.8,
      "patch_ms": 10.3,
      "output_sql": "WITH filtered_date_dim AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 2002\n)\nSELECT \n  i_item_id,\n  s_state, \n  grouping(s_state) g_state,\n  avg(ss_quantity) agg1,\n  avg(ss_list_price) agg2,\n  avg(ss_coupon_amt) agg3,\n  avg(ss_sales_price) agg4\nFROM store_sales\nJOIN filtered_date_dim ON ss_sold_date_sk = d_date_sk\nJOIN item ON ss_item_sk = i_item_sk\nJOIN store ON ss_store_sk = s_store_sk\nJOIN customer_demographics ON ss_cdemo_sk = cd_demo_sk\nWHERE cd_gender = 'F' \n  AND cd_marital_status = 'M' \n  AND cd_education_status = 'Primary' \n  AND s_state = 'IA' \n  AND i_category = 'Sports'\nGROUP BY rollup (i_item_id, s_state)\nORDER BY i_item_id, s_state\nLIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Materialize selective date_dim filter into a CTE and convert comma joins to explicit JOINs for better cardinality propagation."
    },
    {
      "patch_id": "p04",
      "family": "E",
      "transform": "materialize_cte",
      "relevance_score": 0.55,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: column \"i_item_id\" does not exist\nLINE 1: ..._state = 'IA' AND i.i_category = 'Sports') SELECT i_item_id,...\n                                                             ^\nHINT:  Perhaps you meant to reference the column \"df.i_item_sk\".\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH dimension_filter AS (SELECT d.d_date_sk, i.i_item_sk, s.s_store_sk FROM date_dim d JOIN store s ON TRUE JOIN item i ON TRUE WHERE d.d_year = 2002 AND s.s_state = 'IA' AND i.i_category = 'Sports') SELECT i_item_id, s_state, GROUPING(s_state) AS g_state, AVG(ss_quantity) AS agg1, AVG(ss_list_price) AS agg2, AVG(ss_coupon_amt) AS agg3, AVG(ss_sales_price) AS agg4 FROM store_sales ss JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN dimension_filter df ON ss.ss_sold_date_sk = df.d_date_sk AND ss.ss_item_sk = df.i_item_sk AND ss.ss_store_sk = df.s_store_sk WHERE cd.cd_gender = 'F' AND cd.cd_marital_status = 'M' AND cd.cd_education_status = 'Primary' GROUP BY ROLLUP (i_item_id, s_state) ORDER BY i_item_id, s_state LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Materialize the result of the filtered dimension joins into a single CTE to avoid repeated scans or late filtering effects."
    },
    {
      "patch_id": "p02",
      "family": "A",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.78,
      "status": "REGRESSION",
      "speedup": 0.76,
      "semantic_passed": true,
      "error": null,
      "original_ms": 7.8,
      "patch_ms": 10.2,
      "output_sql": "WITH store_sales_prefetch AS (SELECT ss_sold_date_sk, ss_item_sk, ss_store_sk, ss_cdemo_sk, ss_quantity, ss_list_price, ss_coupon_amt, ss_sales_price FROM store_sales), date_dim_prefetch AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002), store_prefetch AS (SELECT s_store_sk, s_state FROM store WHERE s_state = 'IA'), item_prefetch AS (SELECT i_item_sk, i_item_id, i_category FROM item WHERE i_category = 'Sports'), customer_demographics_prefetch AS (SELECT cd_demo_sk, cd_gender, cd_marital_status, cd_education_status FROM customer_demographics WHERE cd_gender = 'F' AND cd_marital_status = 'M' AND cd_education_status = 'Primary') SELECT i.i_item_id, s.s_state, GROUPING(s.s_state) AS g_state, AVG(ss.ss_quantity) AS agg1, AVG(ss.ss_list_price) AS agg2, AVG(ss.ss_coupon_amt) AS agg3, AVG(ss.ss_sales_price) AS agg4 FROM store_sales_prefetch ss JOIN date_dim_prefetch d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store_prefetch s ON ss.ss_store_sk = s.s_store_sk JOIN item_prefetch i ON ss.ss_item_sk = i.i_item_sk JOIN customer_demographics_prefetch cd ON ss.ss_cdemo_sk = cd.cd_demo_sk GROUP BY ROLLUP (i.i_item_id, s.s_state) ORDER BY i.i_item_id, s.s_state LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-filter all selective dimensions (date_dim, store, item, customer_demographics) into CTEs before joining with store_sales to reduce fact-table probe volume."
    },
    {
      "patch_id": "p03",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.62,
      "status": "REGRESSION",
      "speedup": 0.71,
      "semantic_passed": true,
      "error": null,
      "original_ms": 7.8,
      "patch_ms": 10.9,
      "output_sql": "select  i_item_id,\n        s_state, grouping(s_state) g_state,\n        avg(ss_quantity) agg1,\n        avg(ss_list_price) agg2,\n        avg(ss_coupon_amt) agg3,\n        avg(ss_sales_price) agg4\nfrom store_sales, customer_demographics, date_dim, store, item\nwhere ss_sold_date_sk = d_date_sk and\n      ss_item_sk = i_item_sk and\n      ss_store_sk = s_store_sk and\n      ss_cdemo_sk = cd_demo_sk and\n      cd_gender = 'F' and\n      cd_marital_status = 'M' and\n      cd_education_status = 'Primary' and\n      d_year = 2002 and\n      s_state = 'IA' and\n     i_category  = 'Sports'\n group by rollup (i_item_id, s_state)\n order by i_item_id\n         ,s_state\n limit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-aggregate store_sales by join keys (ss_item_sk, ss_store_sk, ss_cdemo_sk) before joining with dimensions to reduce join input volume."
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.74,
      "semantic_passed": true,
      "error": null,
      "original_ms": 6.9,
      "patch_ms": 9.4,
      "output_sql": "WITH filtered_date_dim AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002) SELECT i_item_id, s_state, grouping(s_state) g_state, avg(ss_quantity) agg1, avg(ss_list_price) agg2, avg(ss_coupon_amt) agg3, avg(ss_sales_price) agg4 FROM store_sales JOIN filtered_date_dim ON ss_sold_date_sk = d_date_sk JOIN item ON ss_item_sk = i_item_sk JOIN store ON ss_store_sk = s_store_sk JOIN customer_demographics ON ss_cdemo_sk = cd_demo_sk WHERE cd_gender = 'F' AND cd_marital_status = 'M' AND cd_education_status = 'Primary' AND s_state = 'IA' AND i_category = 'Sports' GROUP BY rollup (i_item_id, s_state) ORDER BY i_item_id, s_state LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p2",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "NEUTRAL",
      "speedup": 1.05,
      "semantic_passed": true,
      "error": null,
      "original_ms": 6.9,
      "patch_ms": 6.6,
      "output_sql": "WITH date_dim_prefetch AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002), store_prefetch AS (SELECT s_store_sk, s_state FROM store WHERE s_state = 'IA'), item_prefetch AS (SELECT i_item_sk, i_item_id, i_category FROM item WHERE i_category = 'Sports'), customer_demographics_prefetch AS (SELECT cd_demo_sk, cd_gender, cd_marital_status, cd_education_status FROM customer_demographics WHERE cd_gender = 'F' AND cd_marital_status = 'M' AND cd_education_status = 'Primary') SELECT i.i_item_id, s.s_state, GROUPING(s.s_state) AS g_state, AVG(ss.ss_quantity) AS agg1, AVG(ss.ss_list_price) AS agg2, AVG(ss.ss_coupon_amt) AS agg3, AVG(ss.ss_sales_price) AS agg4 FROM store_sales ss JOIN date_dim_prefetch d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store_prefetch s ON ss.ss_store_sk = s.s_store_sk JOIN item_prefetch i ON ss.ss_item_sk = i.i_item_sk JOIN customer_demographics_prefetch cd ON ss.ss_cdemo_sk = cd.cd_demo_sk GROUP BY ROLLUP (i.i_item_id, s.s_state) ORDER BY i.i_item_id, s.s_state LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.75,
      "semantic_passed": true,
      "error": null,
      "original_ms": 6.9,
      "patch_ms": 9.1,
      "output_sql": "SELECT i_item_id, s_state, grouping(s_state) g_state, avg(ss_quantity) agg1, avg(ss_list_price) agg2, avg(ss_coupon_amt) agg3, avg(ss_sales_price) agg4 FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN item ON ss_item_sk = i_item_sk JOIN store ON ss_store_sk = s_store_sk JOIN customer_demographics ON ss_cdemo_sk = cd_demo_sk WHERE cd_gender = 'F' AND cd_marital_status = 'M' AND cd_education_status = 'Primary' AND d_year = 2002 AND s_state = 'IA' AND i_category = 'Sports' GROUP BY rollup (i_item_id, s_state) ORDER BY i_item_id, s_state LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p2",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.76,
      "semantic_passed": true,
      "error": null,
      "original_ms": 6.9,
      "patch_ms": 9.0,
      "output_sql": "SELECT i.i_item_id, s.s_state, grouping(s.s_state) g_state, avg(ss.ss_quantity) agg1, avg(ss.ss_list_price) agg2, avg(ss.ss_coupon_amt) agg3, avg(ss.ss_sales_price) agg4 FROM (SELECT ss_sold_date_sk, ss_item_sk, ss_store_sk, ss_cdemo_sk, ss_quantity, ss_list_price, ss_coupon_amt, ss_sales_price FROM store_sales) ss JOIN (SELECT d_date_sk FROM date_dim WHERE d_year = 2002) d ON ss.ss_sold_date_sk = d.d_date_sk JOIN (SELECT i_item_sk, i_item_id FROM item WHERE i_category = 'Sports') i ON ss.ss_item_sk = i.i_item_sk JOIN (SELECT s_store_sk, s_state FROM store WHERE s_state = 'IA') s ON ss.ss_store_sk = s.s_store_sk JOIN (SELECT cd_demo_sk FROM customer_demographics WHERE cd_gender = 'F' AND cd_marital_status = 'M' AND cd_education_status = 'Primary') cd ON ss.ss_cdemo_sk = cd.cd_demo_sk GROUP BY rollup (i.i_item_id, s.s_state) ORDER BY i.i_item_id, s.s_state LIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p01": "Limit  (rows=1, time=6.058)\n  Aggregate  (rows=1, time=6.056)\n    Sort  (rows=0, time=6.043)\n      Gather  (rows=0, time=6.017)\n        Nested Loop  (rows=0, time=1.339)\n          Nested Loop  (rows=0, time=1.338)\n            Nested Loop  (rows=0, time=1.338)\n              Index Only Scan on date_dim  (rows=122, time=0.236)\n              Nested Loop  (rows=0, time=0.009)\n                Seq Scan on store  (rows=0, time=0.009)\n                Index Only Scan on store_sales  (rows=0, time=0.0)\n   ",
    "p02": "Limit  (rows=1, time=6.118)\n  Aggregate  (rows=1, time=6.116)\n    Sort  (rows=0, time=6.107)\n      Gather  (rows=0, time=6.077)\n        Nested Loop  (rows=0, time=1.357)\n          Nested Loop  (rows=0, time=1.356)\n            Nested Loop  (rows=0, time=1.356)\n              Index Only Scan on date_dim  (rows=122, time=0.246)\n              Nested Loop  (rows=0, time=0.009)\n                Seq Scan on store  (rows=0, time=0.009)\n                Index Only Scan on store_sales  (rows=0, time=0.0)\n   ",
    "p03": "Limit  (rows=1, time=19.909)\n  Aggregate  (rows=1, time=19.907)\n    Sort  (rows=0, time=19.898)\n      Gather  (rows=0, time=19.879)\n        Nested Loop  (rows=0, time=1.319)\n          Nested Loop  (rows=0, time=1.319)\n            Nested Loop  (rows=0, time=1.318)\n              Index Only Scan on date_dim  (rows=122, time=0.227)\n              Nested Loop  (rows=0, time=0.009)\n                Seq Scan on store  (rows=0, time=0.009)\n                Index Only Scan on store_sales  (rows=0, time=0.0)",
    "compile_p1": "Limit  (rows=1, time=5.661)\n  Aggregate  (rows=1, time=5.658)\n    Sort  (rows=0, time=5.653)\n      Gather  (rows=0, time=5.637)\n        Nested Loop  (rows=0, time=1.321)\n          Nested Loop  (rows=0, time=1.321)\n            Nested Loop  (rows=0, time=1.32)\n              Index Only Scan on date_dim  (rows=122, time=0.232)\n              Nested Loop  (rows=0, time=0.009)\n                Seq Scan on store  (rows=0, time=0.009)\n                Index Only Scan on store_sales  (rows=0, time=0.0)\n    ",
    "compile_p2": "Limit  (rows=1, time=7.56)\n  Aggregate  (rows=1, time=7.558)\n    Sort  (rows=0, time=7.546)\n      Gather  (rows=0, time=7.53)\n        Nested Loop  (rows=0, time=1.292)\n          Nested Loop  (rows=0, time=1.291)\n            Nested Loop  (rows=0, time=1.291)\n              Index Only Scan on date_dim  (rows=122, time=0.215)\n              Nested Loop  (rows=0, time=0.009)\n                Seq Scan on store  (rows=0, time=0.009)\n                Index Only Scan on store_sales  (rows=0, time=0.0)\n     "
  }
}