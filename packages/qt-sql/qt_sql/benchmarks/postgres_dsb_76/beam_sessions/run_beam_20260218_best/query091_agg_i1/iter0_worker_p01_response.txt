{
  "probe_id": "p12",
  "transform_id": "dimension_prefetch_star",
  "family": "F",
  "status": "success",
  "dialect": "postgresql",
  "hypothesis": "Pre-filtering selective dimensions into CTEs before joining with catalog_returns improves join order and cardinality estimates. Explicit JOIN syntax enables better optimization paths.",
  "reasoning_trace": [
    "Assigned transform targets comma-join weakness with selective dimension fanout.",
    "All dimension tables are small and have selective filters; materializing them early reduces catalog_returns probe set.",
    "Explicit JOIN syntax preserves semantics while enabling better optimizer decisions."
  ],
  "target_ir": "Each selective dimension becomes a CTE; catalog_returns joins explicitly with pre-filtered dimensions.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["cr_filtered"],
        "outputs": ["Call_Center", "Call_Center_Name", "Manager", "Returns_Loss"],
        "changed": true,
        "sql": "SELECT cc.cc_call_center_id AS Call_Center, cc.cc_name AS Call_Center_Name, cc.cc_manager AS Manager, SUM(cr.cr_net_loss) AS Returns_Loss FROM cr_filtered cr JOIN date_dim_filtered d ON cr.cr_returned_date_sk = d.d_date_sk JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN customer_address_filtered ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics_filtered cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics_filtered hd ON c.c_current_hdemo_sk = hd.hd_demo_sk GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_manager, cd.cd_marital_status, cd.cd_education_status ORDER BY SUM(cr.cr_net_loss) DESC"
      },
      {
        "node_id": "cr_filtered",
        "parent_node_id": "final_select",
        "sources": ["catalog_returns"],
        "outputs": ["cr_call_center_sk", "cr_returned_date_sk", "cr_returning_customer_sk", "cr_net_loss"],
        "changed": true,
        "sql": "SELECT cr_call_center_sk, cr_returned_date_sk, cr_returning_customer_sk, cr_net_loss FROM catalog_returns"
      },
      {
        "node_id": "date_dim_filtered",
        "parent_node_id": "final_select",
        "sources": ["date_dim"],
        "outputs": ["d_date_sk"],
        "changed": true,
        "sql": "SELECT d_date_sk FROM date_dim WHERE d_year = 1998 AND d_moy = 2"
      },
      {
        "node_id": "customer_address_filtered",
        "parent_node_id": "final_select",
        "sources": ["customer_address"],
        "outputs": ["ca_address_sk"],
        "changed": true,
        "sql": "SELECT ca_address_sk FROM customer_address WHERE ca_gmt_offset = -7"
      },
      {
        "node_id": "customer_demographics_filtered",
        "parent_node_id": "final_select",
        "sources": ["customer_demographics"],
        "outputs": ["cd_demo_sk"],
        "changed": true,
        "sql": "SELECT cd_demo_sk FROM customer_demographics WHERE (cd_marital_status = 'M' AND cd_education_status = 'Unknown') OR (cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree')"
      },
      {
        "node_id": "household_demographics_filtered",
        "parent_node_id": "final_select",
        "sources": ["household_demographics"],
        "outputs": ["hd_demo_sk"],
        "changed": true,
        "sql": "SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential LIKE '1001-5000%'"
      }
    ]
  }
}