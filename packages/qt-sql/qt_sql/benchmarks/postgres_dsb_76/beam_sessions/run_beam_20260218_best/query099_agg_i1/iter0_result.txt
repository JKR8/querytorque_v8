{
  "iteration": 0,
  "n_api_calls": 8,
  "beam_cost_usd": 0.02704063,
  "beam_cost_priced_calls": 8,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 96682,
    "completion_tokens": 19231,
    "total_tokens": 115913,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 37888,
    "reasoning_tokens": 9479
  },
  "best_speedup": 1.01,
  "best_patch_id": "p01",
  "best_sql": "WITH filtered_date_dim AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1192 AND 1192 + 23) SELECT SUBSTRING(w_warehouse_name, 1, 20), sm_type, cc_name, SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM catalog_sales cs INNER JOIN filtered_date_dim dd ON cs.cs_ship_date_sk = dd.d_date_sk INNER JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk INNER JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk INNER JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk WHERE cs.cs_list_price BETWEEN 86 AND 115 AND sm.sm_type = 'EXPRESS' AND cc.cc_class = 'small' AND w.w_gmt_offset = -5 GROUP BY SUBSTRING(w_warehouse_name, 1, 20), sm_type, cc_name ORDER BY SUBSTRING(w_warehouse_name, 1, 20), sm_type, cc_name LIMIT 100;",
  "patches": [
    {
      "patch_id": "p01",
      "family": "A",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.85,
      "status": "NEUTRAL",
      "speedup": 1.01,
      "semantic_passed": true,
      "error": null,
      "original_ms": 54.0,
      "patch_ms": 53.2,
      "output_sql": "WITH filtered_date_dim AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1192 AND 1192 + 23) SELECT SUBSTRING(w_warehouse_name, 1, 20), sm_type, cc_name, SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM catalog_sales cs INNER JOIN filtered_date_dim dd ON cs.cs_ship_date_sk = dd.d_date_sk INNER JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk INNER JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk INNER JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk WHERE cs.cs_list_price BETWEEN 86 AND 115 AND sm.sm_type = 'EXPRESS' AND cc.cc_class = 'small' AND w.w_gmt_offset = -5 GROUP BY SUBSTRING(w_warehouse_name, 1, 20), sm_type, cc_name ORDER BY SUBSTRING(w_warehouse_name, 1, 20), sm_type, cc_name LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Convert comma joins to explicit INNER JOIN syntax and isolate date_dim filter into a CTE to create a tiny hash table for the fact\u2011table probe."
    },
    {
      "patch_id": "p02",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.8,
      "status": "REGRESSION",
      "speedup": 0.63,
      "semantic_passed": true,
      "error": null,
      "original_ms": 54.0,
      "patch_ms": 85.3,
      "output_sql": "WITH date_cte AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_month_seq BETWEEN 1192 AND 1192 + 23\n),\nwarehouse_cte AS (\n  SELECT w_warehouse_sk, w_warehouse_name\n  FROM warehouse\n  WHERE w_gmt_offset = -5\n),\nship_mode_cte AS (\n  SELECT sm_ship_mode_sk, sm_type\n  FROM ship_mode\n  WHERE sm_type = 'EXPRESS'\n),\ncall_center_cte AS (\n  SELECT cc_call_center_sk, cc_name\n  FROM call_center\n  WHERE cc_class = 'small'\n)\nSELECT \n   SUBSTRING(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\n  ,SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30 ) THEN 1 ELSE 0 END)  AS \"30 days\"\n  ,SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND\n                 (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END )  AS \"31-60 days\"\n  ,SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND\n                 (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END)  AS \"61-90 days\"\n  ,SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND\n                 (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END)  AS \"91-120 days\"\n  ,SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk  > 120) THEN 1 ELSE 0 END)  AS \">120 days\"\nFROM\n   catalog_sales\n  JOIN date_cte ON cs_ship_date_sk = d_date_sk\n  JOIN warehouse_cte ON cs_warehouse_sk = w_warehouse_sk\n  JOIN ship_mode_cte ON cs_ship_mode_sk = sm_ship_mode_sk\n  JOIN call_center_cte ON cs_call_center_sk = cc_call_center_sk\nWHERE\n  cs_list_price BETWEEN 86 AND 115\ngroup by\n   SUBSTRING(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\norder by SUBSTRING(w_warehouse_name,1,20)\n        ,sm_type\n        ,cc_name\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre\u2011filter all selective dimensions (date_dim, call_center, warehouse, ship_mode) into separate CTEs, then join them with catalog_sales using explicit JOIN syntax."
    },
    {
      "patch_id": "p03",
      "family": "A",
      "transform": "multi_dimension_prefetch",
      "relevance_score": 0.55,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Checksum mismatch",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH combined_dimensions_cte AS (SELECT\n  w.w_warehouse_sk,\n  sm.sm_ship_mode_sk,\n  cc.cc_call_center_sk,\n  d.d_date_sk,\n  w.w_warehouse_name,\n  sm.sm_type,\n  cc.cc_name\nFROM\n  warehouse w\nJOIN\n  ship_mode sm ON TRUE\nJOIN\n  call_center cc ON TRUE\nJOIN\n  date_dim d ON TRUE\nWHERE\n  w.w_gmt_offset = -5\n  AND sm.sm_type = 'EXPRESS'\n  AND cc.cc_class = 'small'\n  AND d.d_month_seq BETWEEN 1192 AND 1192 + 23) SELECT\n  SUBSTRING(w_warehouse_name FROM 1 FOR 20),\n  sm_type,\n  cc_name,\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\",\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\",\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\",\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\",\n  SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\"\nFROM\n  catalog_sales\nJOIN\n  combined_dimensions_cte ON cs_warehouse_sk = w_warehouse_sk\n                          AND cs_ship_mode_sk = sm_ship_mode_sk\n                          AND cs_call_center_sk = cc_call_center_sk\n                          AND cs_ship_date_sk = d_date_sk\nGROUP BY\n  SUBSTRING(w_warehouse_name FROM 1 FOR 20),\n  sm_type,\n  cc_name\nORDER BY\n  SUBSTRING(w_warehouse_name FROM 1 FOR 20),\n  sm_type,\n  cc_name\nLIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre\u2011filter all selective dimensions into a single CTE that joins them together, then join that CTE with catalog_sales. (Portability candidate from DuckDB; test on PostgreSQL.)"
    },
    {
      "patch_id": "p04",
      "family": "A",
      "transform": "prefetch_fact_join",
      "relevance_score": 0.5,
      "status": "REGRESSION",
      "speedup": 0.46,
      "semantic_passed": true,
      "error": null,
      "original_ms": 54.0,
      "patch_ms": 118.1,
      "output_sql": "WITH fact_date_cte AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1192 AND 1192 + 23), fact_date_sales AS (SELECT cs_ship_date_sk, cs_sold_date_sk, cs_warehouse_sk, cs_ship_mode_sk, cs_call_center_sk, cs_list_price FROM catalog_sales JOIN fact_date_cte ON cs_ship_date_sk = d_date_sk) SELECT substring(w_warehouse_name, 1, 20), sm_type, cc_name, SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM fact_date_sales JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk JOIN call_center ON cs_call_center_sk = cc_call_center_sk WHERE cs_list_price BETWEEN 86 AND 115 AND sm_type = 'EXPRESS' AND cc_class = 'small' AND w_gmt_offset = -5 GROUP BY substring(w_warehouse_name, 1, 20), sm_type, cc_name ORDER BY substring(w_warehouse_name, 1, 20), sm_type, cc_name LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Stage\u2011reduce: first CTE filters date_dim, second CTE joins filtered date keys with catalog_sales, third CTE joins remaining dimensions. (Portability candidate from DuckDB.)"
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.85,
      "semantic_passed": true,
      "error": null,
      "original_ms": 166.4,
      "patch_ms": 195.8,
      "output_sql": "SELECT\n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\"\nFROM catalog_sales\nINNER JOIN date_dim ON cs_ship_date_sk = d_date_sk AND d_month_seq between 1192 and 1192 + 23\nINNER JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk AND w_gmt_offset = -5\nINNER JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk AND sm_type = 'EXPRESS'\nINNER JOIN call_center ON cs_call_center_sk = cc_call_center_sk AND cc_class = 'small'\nWHERE cs_list_price between 86 and 115\nGROUP BY substring(w_warehouse_name,1,20), sm_type, cc_name\nORDER BY substring(w_warehouse_name,1,20), sm_type, cc_name\nLIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p2",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.92,
      "semantic_passed": true,
      "error": null,
      "original_ms": 166.4,
      "patch_ms": 181.5,
      "output_sql": "SELECT\n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\"\nFROM catalog_sales\nINNER JOIN (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1192 AND 1192 + 23) dd ON cs_ship_date_sk = dd.d_date_sk\nINNER JOIN (SELECT w_warehouse_sk, w_warehouse_name FROM warehouse WHERE w_gmt_offset = -5) w ON cs_warehouse_sk = w.w_warehouse_sk\nINNER JOIN (SELECT sm_ship_mode_sk, sm_type FROM ship_mode WHERE sm_type = 'EXPRESS') sm ON cs_ship_mode_sk = sm.sm_ship_mode_sk\nINNER JOIN (SELECT cc_call_center_sk, cc_name FROM call_center WHERE cc_class = 'small') cc ON cs_call_center_sk = cc.cc_call_center_sk\nWHERE cs_list_price BETWEEN 86 AND 115\nGROUP BY substring(w_warehouse_name,1,20), sm_type, cc_name\nORDER BY substring(w_warehouse_name,1,20), sm_type, cc_name\nLIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p01": "Limit  (rows=4, time=66.13)\n  Aggregate  (rows=4, time=66.127)\n    Gather Merge  (rows=10, time=66.08)\n      Aggregate  (rows=3, time=50.958)\n        Sort  (rows=767, time=50.83)\n          Nested Loop  (rows=767, time=50.384)\n            Index Only Scan on date_dim  (rows=244, time=0.7)\n            Nested Loop  (rows=3, time=0.203)\n              Seq Scan on call_center (cc)  (rows=3, time=0.002)\n              Nested Loop  (rows=1, time=0.066)\n                Seq Scan on warehouse (w)  (rows=2, t",
    "p02": "Limit  (rows=4, time=58.407)\n  Aggregate  (rows=4, time=58.404)\n    Gather Merge  (rows=10, time=58.39)\n      Aggregate  (rows=3, time=49.866)\n        Sort  (rows=767, time=49.632)\n          Nested Loop  (rows=767, time=49.195)\n            Index Only Scan on date_dim  (rows=244, time=0.676)\n            Nested Loop  (rows=3, time=0.198)\n              Seq Scan on call_center  (rows=3, time=0.002)\n              Nested Loop  (rows=1, time=0.065)\n                Seq Scan on warehouse  (rows=2, time=0",
    "p04": "Limit  (rows=4, time=56.874)\n  Aggregate  (rows=4, time=56.871)\n    Gather Merge  (rows=10, time=56.862)\n      Aggregate  (rows=3, time=46.827)\n        Sort  (rows=767, time=46.682)\n          Nested Loop  (rows=767, time=46.32)\n            Index Only Scan on date_dim  (rows=244, time=0.649)\n            Nested Loop  (rows=3, time=0.186)\n              Seq Scan on call_center  (rows=3, time=0.002)\n              Nested Loop  (rows=1, time=0.061)\n                Seq Scan on warehouse  (rows=2, time=0",
    "compile_p1": "Limit  (rows=4, time=209.346)\n  Aggregate  (rows=4, time=209.342)\n    Gather Merge  (rows=8, time=209.311)\n      Aggregate  (rows=4, time=168.162)\n        Sort  (rows=1150, time=167.801)\n          Nested Loop  (rows=1150, time=166.168)\n            Index Only Scan on date_dim  (rows=366, time=2.282)\n            Nested Loop  (rows=3, time=0.445)\n              Seq Scan on call_center  (rows=3, time=0.005)\n              Nested Loop  (rows=1, time=0.145)\n                Seq Scan on warehouse  (rows=2",
    "compile_p2": "Limit  (rows=4, time=206.661)\n  Aggregate  (rows=4, time=206.654)\n    Gather Merge  (rows=8, time=206.624)\n      Aggregate  (rows=4, time=161.124)\n        Sort  (rows=1150, time=160.719)\n          Nested Loop  (rows=1150, time=159.226)\n            Index Only Scan on date_dim  (rows=366, time=2.772)\n            Nested Loop  (rows=3, time=0.425)\n              Seq Scan on call_center  (rows=3, time=0.005)\n              Nested Loop  (rows=1, time=0.139)\n                Seq Scan on warehouse  (rows=2"
  }
}