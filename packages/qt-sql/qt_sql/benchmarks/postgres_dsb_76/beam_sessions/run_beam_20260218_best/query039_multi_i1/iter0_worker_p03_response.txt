{
  "probe_id": "scout_1",
  "transform_id": "aggregate_pushdown",
  "family": "C",
  "status": "success",
  "dialect": "postgres",
  "hypothesis": "Pre-aggregating inventory by inv_item_sk, inv_warehouse_sk, and inv_date_sk before joining with dimensions reduces input rows to downstream operators while preserving output semantics.",
  "reasoning_trace": [
    "Assigned transform targets early aggregation on inventory to reduce row count before dimension joins.",
    "Grouping keys (inv_item_sk, inv_warehouse_sk, inv_date_sk) align with downstream join keys, enabling safe pushdown.",
    "Aggregation statistics (sum, count, sum of squares) are preserved for later stddev/avg computation.",
    "CTE reuse is avoided by rewriting the body once and filtering post-aggregate."
  ],
  "target_ir": "inventory is pre-aggregated into inv_agg CTE; dimension joins occur after aggregation.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["inv"],
        "outputs": ["w_warehouse_sk", "i_item_sk", "d_moy", "mean", "cov", "w_warehouse_sk", "i_item_sk", "d_moy", "mean", "cov"],
        "changed": false
      },
      {
        "node_id": "inv",
        "parent_node_id": "final_select",
        "sources": ["inv_agg", "item", "warehouse", "date_dim"],
        "outputs": ["w_warehouse_name", "w_warehouse_sk", "i_item_sk", "d_moy", "stdev", "mean", "cov"],
        "changed": true,
        "sql": "WITH inv_agg AS (SELECT inv_item_sk, inv_warehouse_sk, inv_date_sk, SUM(inv_quantity_on_hand) AS sum_qoh, COUNT(*) AS cnt_qoh, SUM(inv_quantity_on_hand * inv_quantity_on_hand) AS sum_sq_qoh FROM inventory WHERE inv_quantity_on_hand BETWEEN 0 AND 200 GROUP BY inv_item_sk, inv_warehouse_sk, inv_date_sk) SELECT w.w_warehouse_name, w.w_warehouse_sk, i.i_item_sk, d.d_moy, SQRT((ia.sum_sq_qoh - (ia.sum_qoh * ia.sum_qoh / ia.cnt_qoh)) / (ia.cnt_qoh - 1)) AS stdev, (ia.sum_qoh / ia.cnt_qoh) AS mean, CASE WHEN (ia.sum_qoh / ia.cnt_qoh) = 0 THEN NULL ELSE SQRT((ia.sum_sq_qoh - (ia.sum_qoh * ia.sum_qoh / ia.cnt_qoh)) / (ia.cnt_qoh - 1)) / (ia.sum_qoh / ia.cnt_qoh) END AS cov FROM inv_agg ia JOIN item i ON ia.inv_item_sk = i.i_item_sk JOIN warehouse w ON ia.inv_warehouse_sk = w.w_warehouse_sk JOIN date_dim d ON ia.inv_date_sk = d.d_date_sk WHERE d.d_year = 2002 AND i.i_category IN ('Jewelry', 'Men') AND i.i_manager_id BETWEEN 81 AND 100"
      }
    ]
  }
}