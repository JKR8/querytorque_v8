[
  {
    "plan_id": "compile_p1",
    "dialect": "postgres",
    "confidence": 0.50,
    "based_on": "",
    "strategy": "Convert comma joins to explicit INNER JOINs to enable better join reordering and potentially avoid nested-loop amplification.",
    "hypothesis": "Original plan shows nested-loop warehouse join amplifying materialized subplan 10x. Explicit join syntax may allow optimizer to choose hash join instead. No filter pushdown due to failed equivalence probes.",
    "expected_explain_delta": "Nested-loop join between warehouse and materialized subplan may become hash join, reducing loop amplification.",
    "target_ir": "Update inv node to use explicit JOIN syntax; keep all other semantics identical.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["inv"],
          "outputs": ["w_warehouse_sk", "i_item_sk", "d_moy", "mean", "cov", "w_warehouse_sk", "i_item_sk", "d_moy", "mean", "cov"],
          "changed": false
        },
        {
          "node_id": "inv",
          "parent_node_id": "final_select",
          "sources": ["inventory", "item", "warehouse", "date_dim"],
          "outputs": ["w_warehouse_name", "w_warehouse_sk", "i_item_sk", "d_moy", "stdev", "mean", "cov"],
          "changed": true,
          "sql": "SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, stdev, mean, CASE mean WHEN 0 THEN NULL ELSE stdev / mean END AS cov FROM (SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, STDDEV_SAMP(inv_quantity_on_hand) AS stdev, AVG(inv_quantity_on_hand) AS mean FROM inventory JOIN item ON inv_item_sk = i_item_sk JOIN warehouse ON inv_warehouse_sk = w_warehouse_sk JOIN date_dim ON inv_date_sk = d_date_sk WHERE d_year = 2002 AND i_category IN ('Jewelry', 'Men') AND i_manager_id BETWEEN 81 AND 100 AND inv_quantity_on_hand BETWEEN 0 AND 200 GROUP BY w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy) AS foo WHERE CASE mean WHEN 0 THEN 0 ELSE stdev / mean END > 1"
        }
      ]
    }
  }
]