```json
[
  {
    "plan_id": "compile_p1",
    "dialect": "postgres",
    "confidence": 0.7,
    "based_on": "p01,p02",
    "strategy": "Explicit JOINs with early dimension filtering via CTEs to reduce nested-loop amplification.",
    "hypothesis": "Original nested loops amplify rows before applying selective OR filters. Failed probes show semantic violation in tree structure, but explicit JOINs with filtered dimension CTEs address the primary hotspot. This attempt materializes filtered dimensions first.",
    "expected_explain_delta": "Nested loops replaced by hash joins, earlier filtering of customer_demographics and customer_address reduces rows entering web_sales/web_returns joins.",
    "target_ir": "Convert comma joins to explicit JOINs; add filtered CTEs for customer_demographics and customer_address; push date_dim filter early.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["cd_filtered", "cd_filtered2", "ca_filtered", "date_dim_filtered", "web_sales", "web_returns", "web_page", "reason"],
          "outputs": ["SUBSTRING(r_reason_desc FROM 1 FOR 20)", "AVG(ws_quantity)", "AVG(wr_refunded_cash)", "AVG(wr_fee)"],
          "changed": true,
          "sql": "WITH cd_filtered AS (\n  SELECT cd_demo_sk, cd_marital_status, cd_education_status\n  FROM customer_demographics\n  WHERE (cd_marital_status = 'S' AND cd_education_status = 'College')\n     OR (cd_marital_status = 'W' AND cd_education_status = 'Unknown')\n     OR (cd_marital_status = 'M' AND cd_education_status = 'Secondary')\n),\nca_filtered AS (\n  SELECT ca_address_sk\n  FROM customer_address\n  WHERE ca_country = 'United States'\n    AND (ca_state IN ('NC', 'PA', 'TX')\n         OR ca_state IN ('AR', 'CO', 'NY')\n         OR ca_state IN ('IA', 'IL', 'TX'))\n),\ndate_dim_filtered AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 2000\n)\nSELECT substring(r_reason_desc,1,20),\n       avg(ws_quantity),\n       avg(wr_refunded_cash),\n       avg(wr_fee)\nFROM web_sales\nJOIN web_returns ON ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number\nJOIN web_page ON ws_web_page_sk = wp_web_page_sk\nJOIN cd_filtered cd1 ON cd1.cd_demo_sk = wr_refunded_cdemo_sk\nJOIN cd_filtered cd2 ON cd2.cd_demo_sk = wr_returning_cdemo_sk\nJOIN ca_filtered ON ca_filtered.ca_address_sk = wr_refunded_addr_sk\nJOIN date_dim_filtered d ON ws_sold_date_sk = d.d_date_sk\nJOIN reason ON r_reason_sk = wr_reason_sk\nWHERE (\n      (cd1.cd_marital_status = 'S' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'College' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 100.00 AND 150.00)\n   OR (cd1.cd_marital_status = 'W' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'Unknown' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 50.00 AND 100.00)\n   OR (cd1.cd_marital_status = 'M' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'Secondary' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 150.00 AND 200.00)\n      )\n  AND (\n      (ca_filtered.ca_address_sk IS NOT NULL AND ws_net_profit BETWEEN 100 AND 200)\n   OR (ca_filtered.ca_address_sk IS NOT NULL AND ws_net_profit BETWEEN 150 AND 300)\n   OR (ca_filtered.ca_address_sk IS NOT NULL AND ws_net_profit BETWEEN 50 AND 250)\n      )\nGROUP BY r_reason_desc\nORDER BY substring(r_reason_desc,1,20),\n         avg(ws_quantity),\n         avg(wr_refunded_cash),\n         avg(wr_fee)\nLIMIT 100"
        },
        {
          "node_id": "cd_filtered",
          "parent_node_id": "final_select",
          "sources": ["customer_demographics"],
          "outputs": ["cd_demo_sk", "cd_marital_status", "cd_education_status"],
          "changed": true,
          "sql": "SELECT cd_demo_sk, cd_marital_status, cd_education_status\nFROM customer_demographics\nWHERE (cd_marital_status = 'S' AND cd_education_status = 'College')\n   OR (cd_marital_status = 'W' AND cd_education_status = 'Unknown')\n   OR (cd_marital_status = 'M' AND cd_education_status = 'Secondary')"
        },
        {
          "node_id": "ca_filtered",
          "parent_node_id": "final_select",
          "sources": ["customer_address"],
          "outputs": ["ca_address_sk"],
          "changed": true,
          "sql": "SELECT ca_address_sk\nFROM customer_address\nWHERE ca_country = 'United States'\n  AND (ca_state IN ('NC', 'PA', 'TX')\n       OR ca_state IN ('AR', 'CO', 'NY')\n       OR ca_state IN ('IA', 'IL', 'TX'))"
        },
        {
          "node_id": "date_dim_filtered",
          "parent_node_id": "final_select",
          "sources": ["date_dim"],
          "outputs": ["d_date_sk"],
          "changed": true,
          "sql": "SELECT d_date_sk\nFROM date_dim\nWHERE d_year = 2000"
        }
      ]
    }
  },
  {
    "plan_id": "compile_p2",
    "dialect": "postgres",
    "confidence": 0.65,
    "based_on": "p03,p04",
    "strategy": "Simplify OR predicates via UNION ALL to assist planner; maintain explicit JOINs.",
    "hypothesis": "Complex OR predicates on cd1/cd2 and ca_state cause late filtering. Splitting into UNION ALL branches may enable better index usage despite PostgreSQL's BitmapOr, as original plan shows high misestimate. This is a distinct pathway from CTE materialization.",
    "expected_explain_delta": "OR branches become separate subplans with earlier filtering, reducing nested-loop fanout.",
    "target_ir": "Break OR groups into UNION ALL of three branches for cd conditions, each with explicit JOINs.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["branch1", "branch2", "branch3"],
          "outputs": ["SUBSTRING(r_reason_desc FROM 1 FOR 20)", "AVG(ws_quantity)", "AVG(wr_refunded_cash)", "AVG(wr_fee)"],
          "changed": true,
          "sql": "SELECT substring(r_reason_desc,1,20),\n       avg(ws_quantity),\n       avg(wr_refunded_cash),\n       avg(wr_fee)\nFROM (\n  -- Branch 1: cd_marital_status = 'S', cd_education_status = 'College', ws_sales_price 100-150\n  SELECT r_reason_desc, ws_quantity, wr_refunded_cash, wr_fee\n  FROM web_sales\n  JOIN web_returns ON ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number\n  JOIN web_page ON ws_web_page_sk = wp_web_page_sk\n  JOIN customer_demographics cd1 ON cd1.cd_demo_sk = wr_refunded_cdemo_sk\n  JOIN customer_demographics cd2 ON cd2.cd_demo_sk = wr_returning_cdemo_sk\n  JOIN customer_address ON ca_address_sk = wr_refunded_addr_sk\n  JOIN date_dim ON ws_sold_date_sk = d_date_sk AND d_year = 2000\n  JOIN reason ON r_reason_sk = wr_reason_sk\n  WHERE cd1.cd_marital_status = 'S' AND cd1.cd_marital_status = cd2.cd_marital_status\n    AND cd1.cd_education_status = 'College' AND cd1.cd_education_status = cd2.cd_education_status\n    AND ws_sales_price BETWEEN 100.00 AND 150.00\n    AND ca_country = 'United States'\n    AND ( (ca_state IN ('NC', 'PA', 'TX') AND ws_net_profit BETWEEN 100 AND 200)\n       OR (ca_state IN ('AR', 'CO', 'NY') AND ws_net_profit BETWEEN 150 AND 300)\n       OR (ca_state IN ('IA', 'IL', 'TX') AND ws_net_profit BETWEEN 50 AND 250) )\n  UNION ALL\n  -- Branch 2: cd_marital_status = 'W', cd_education_status = 'Unknown', ws_sales_price 50-100\n  SELECT r_reason_desc, ws_quantity, wr_refunded_cash, wr_fee\n  FROM web_sales\n  JOIN web_returns ON ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number\n  JOIN web_page ON ws_web_page_sk = wp_web_page_sk\n  JOIN customer_demographics cd1 ON cd1.cd_demo_sk = wr_refunded_cdemo_sk\n  JOIN customer_demographics cd2 ON cd2.cd_demo_sk = wr_returning_cdemo_sk\n  JOIN customer_address ON ca_address_sk = wr_refunded_addr_sk\n  JOIN date_dim ON ws_sold_date_sk = d_date_sk AND d_year = 2000\n  JOIN reason ON r_reason_sk = wr_reason_sk\n  WHERE cd1.cd_marital_status = 'W' AND cd1.cd_marital_status = cd2.cd_marital_status\n    AND cd1.cd_education_status = 'Unknown' AND cd1.cd_education_status = cd2.cd_education_status\n    AND ws_sales_price BETWEEN 50.00 AND 100.00\n    AND ca_country = 'United States'\n    AND ( (ca_state IN ('NC', 'PA', 'TX') AND ws_net_profit BETWEEN 100 AND 200)\n       OR (ca_state IN ('AR', 'CO', 'NY') AND ws_net_profit BETWEEN 150 AND 300)\n       OR (ca_state IN ('IA', 'IL', 'TX') AND ws_net_profit BETWEEN 50 AND 250) )\n  UNION ALL\n  -- Branch 3: cd_marital_status = 'M', cd_education_status = 'Secondary', ws_sales_price 150-200\n  SELECT r_reason_desc, ws_quantity, wr_refunded_cash, wr_fee\n  FROM web_sales\n  JOIN web_returns ON ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number\n  JOIN web_page ON ws_web_page_sk = wp_web_page_sk\n  JOIN customer_demographics cd1 ON cd1.cd_demo_sk = wr_refunded_cdemo_sk\n  JOIN customer_demographics cd2 ON cd2.cd_demo_sk = wr_returning_cdemo_sk\n  JOIN customer_address ON ca_address_sk = wr_refunded_addr_sk\n  JOIN date_dim ON ws_sold_date_sk = d_date_sk AND d_year = 2000\n  JOIN reason ON r_reason_sk = wr_reason_sk\n  WHERE cd1.cd_marital_status = 'M' AND cd1.cd_marital_status = cd2.cd_marital_status\n    AND cd1.cd_education_status = 'Secondary' AND cd1.cd_education_status = cd2.cd_education_status\n    AND ws_sales_price BETWEEN 150.00 AND 200.00\n    AND ca_country = 'United States'\n    AND ( (ca_state IN ('NC', 'PA', 'TX') AND ws_net_profit BETWEEN 100 AND 200)\n       OR (ca_state IN ('AR', 'CO', 'NY') AND ws_net_profit BETWEEN 150 AND 300)\n       OR (ca_state IN ('IA', 'IL', 'TX') AND ws_net_profit BETWEEN 50 AND 250) )\n) AS all_branches\nGROUP BY r_reason_desc\nORDER BY substring(r_reason_desc,1,20),\n         avg(ws_quantity),\n         avg(wr_refunded_cash),\n         avg(wr_fee)\nLIMIT 100"
        }
      ]
    }
  }
]
```