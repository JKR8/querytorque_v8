{
  "iteration": 0,
  "n_api_calls": 10,
  "beam_cost_usd": 0.04534076,
  "beam_cost_priced_calls": 9,
  "beam_cost_unpriced_calls": 1,
  "beam_token_totals": {
    "prompt_tokens": 115112,
    "completion_tokens": 22331,
    "total_tokens": 137443,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 38272,
    "reasoning_tokens": 12539
  },
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "p01",
      "family": "A",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.75,
      "status": "REGRESSION",
      "speedup": 0.82,
      "semantic_passed": true,
      "error": null,
      "original_ms": 420.0,
      "patch_ms": 515.3,
      "output_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE d_year = 1999 AND d_moy = 2) SELECT i_brand_id AS brand_id, i_brand AS brand, i_manufact_id, i_manufact, SUM(ss_ext_sales_price) AS ext_price FROM filtered_dates d JOIN store_sales ss ON d.d_date_sk = ss.ss_sold_date_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk WHERE i.i_category = 'Shoes' AND d.d_year = 1999 AND d.d_moy = 2 AND SUBSTRING(ca.ca_zip, 1, 5) <> SUBSTRING(s.s_zip, 1, 5) AND ca.ca_state = 'KS' AND c.c_birth_month = 2 AND ss.ss_wholesale_cost BETWEEN 76 AND 96 GROUP BY i_brand, i_brand_id, i_manufact_id, i_manufact ORDER BY ext_price DESC, i_brand, i_brand_id, i_manufact_id, i_manufact LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Convert comma\u2011separated joins to explicit JOIN syntax and isolate date_dim filter into a CTE to create a tiny hash table for early probing."
    },
    {
      "patch_id": "p04",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.55,
      "status": "REGRESSION",
      "speedup": 0.81,
      "semantic_passed": true,
      "error": null,
      "original_ms": 420.0,
      "patch_ms": 515.8,
      "output_sql": "WITH preagg_store_sales AS (SELECT ss.ss_item_sk, ss.ss_customer_sk, ss.ss_store_sk, d.d_date_sk, SUM(ss.ss_ext_sales_price) AS ext_price FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE ss.ss_wholesale_cost BETWEEN 76 AND 96 AND d.d_year = 1999 AND d.d_moy = 2 GROUP BY ss.ss_item_sk, ss.ss_customer_sk, ss.ss_store_sk, d.d_date_sk) select  i_brand_id brand_id, i_brand brand, i_manufact_id, i_manufact,\n \tsum(ss_ext_sales_price) ext_price\n  from date_dim, store_sales, item,customer,customer_address,store\n  where  d_date_sk = ss_sold_date_sk\n    and ss_item_sk = i_item_sk\n    and ss_customer_sk = c_customer_sk\n    and c_current_addr_sk = ca_address_sk\n    and ss_store_sk = s_store_sk\n    AND i_category  = 'Shoes'\n    and d_year=1999\n    and d_moy = 2\n    and substring(ca_zip,1,5) <> substring(s_zip,1,5)\n    and ca_state  = 'KS'\n    and c_birth_month = 2\n    and ss_wholesale_cost BETWEEN 76 AND 96\n group by i_brand\n      ,i_brand_id\n      ,i_manufact_id\n      ,i_manufact\n order by ext_price desc\n         ,i_brand\n         ,i_brand_id\n         ,i_manufact_id\n         ,i_manufact\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre\u2011aggregate store_sales by ss_item_sk, ss_customer_sk, ss_store_sk and date_sk before joining with dimensions, preserving the sum(ss_ext_sales_price) and filters on wholesale_cost."
    },
    {
      "patch_id": "p02",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.7,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Row count: orig=31, patch=100",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH store_sales_cte AS (SELECT ss_sold_date_sk, ss_item_sk, ss_customer_sk, ss_store_sk, ss_ext_sales_price, ss_wholesale_cost FROM store_sales WHERE ss_wholesale_cost BETWEEN 76 AND 96), date_dim_cte AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy = 2), customer_cte AS (SELECT c_customer_sk, c_current_addr_sk FROM customer WHERE c_birth_month = 2), customer_address_cte AS (SELECT ca_address_sk, ca_zip, ca_state FROM customer_address WHERE ca_state = 'KS'), store_cte AS (SELECT s_store_sk, s_zip FROM store), main_join AS (SELECT ss.ss_item_sk, ss.ss_ext_sales_price FROM store_sales_cte ss JOIN date_dim_cte d ON ss.ss_sold_date_sk = d.d_date_sk JOIN customer_cte c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address_cte ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN store_cte s ON ss.ss_store_sk = s.s_store_sk WHERE substring(ca.ca_zip,1,5) <> substring(s.s_zip,1,5)) SELECT i.i_brand_id AS brand_id, i.i_brand AS brand, i.i_manufact_id, i.i_manufact, SUM(mj.ss_ext_sales_price) AS ext_price FROM main_join mj JOIN item i ON mj.ss_item_sk = i.i_item_sk GROUP BY i.i_brand, i.i_brand_id, i.i_manufact_id, i.i_manufact ORDER BY ext_price DESC, i.i_brand, i.i_brand_id, i.i_manufact_id, i.i_manufact LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre\u2011filter all selective dimensions (date_dim, item, customer, customer_address, store) into separate CTEs, then join the CTEs with store_sales using explicit JOIN syntax."
    },
    {
      "patch_id": "p03",
      "family": "F",
      "transform": "materialized_dimension_fact_prefilter",
      "relevance_score": 0.65,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: column c.c_current_addr_sk does not exist\nLINE 1: ..._customer_sk JOIN filtered_customer_address ca ON c.c_curren...\n                                                             ^\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_store_sales AS (SELECT ss_item_sk, ss_ext_sales_price, ss_wholesale_cost, ss_customer_sk, ss_store_sk, ss_sold_date_sk FROM store_sales WHERE ss_wholesale_cost BETWEEN 76 AND 96), filtered_date_dim AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy = 2), filtered_customer AS (SELECT c_customer_sk FROM customer WHERE c_birth_month = 2), filtered_customer_address AS (SELECT ca_address_sk FROM customer_address WHERE ca_state = 'KS'), filtered_store AS (SELECT s_store_sk FROM store), reduction_join AS (WITH filtered_date_dim AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy = 2), filtered_item AS (SELECT i_item_sk FROM item WHERE i_category = 'Shoes'), filtered_customer AS (SELECT c_customer_sk FROM customer WHERE c_birth_month = 2), filtered_customer_address AS (SELECT ca_address_sk FROM customer_address WHERE ca_state = 'KS'), filtered_store AS (SELECT s_store_sk FROM store) SELECT ss.ss_item_sk, ss.ss_ext_sales_price, ss.ss_wholesale_cost, ss.ss_customer_sk, ss.ss_store_sk, ss.ss_sold_date_sk FROM store_sales ss JOIN filtered_date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN filtered_item i ON ss.ss_item_sk = i.i_item_sk JOIN filtered_customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN filtered_customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN filtered_store s ON ss.ss_store_sk = s.s_store_sk WHERE ss.ss_wholesale_cost BETWEEN 76 AND 96) SELECT i.i_brand_id AS brand_id, i.i_brand AS brand, i.i_manufact_id, i.i_manufact, SUM(ss.ss_ext_sales_price) AS ext_price FROM reduction_join ss JOIN item i ON ss.ss_item_sk = i.i_item_sk WHERE i.i_category = 'Shoes' GROUP BY i.i_brand, i.i_brand_id, i.i_manufact_id, i.i_manufact ORDER BY ext_price DESC, i.i_brand, i.i_brand_id, i.i_manufact_id, i.i_manufact LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Materialize filtered dimension keys (date_dim, item, customer, customer_address, store) into CTEs, then join them with store_sales in a staged reduction before applying the non\u2011equi zip condition."
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.88,
      "semantic_passed": true,
      "error": null,
      "original_ms": 396.8,
      "patch_ms": 448.5,
      "output_sql": "SELECT i_brand_id AS brand_id, i_brand AS brand, i_manufact_id, i_manufact, SUM(ss_ext_sales_price) AS ext_price FROM date_dim d JOIN store_sales ss ON d.d_date_sk = ss.ss_sold_date_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk WHERE i.i_category = 'Shoes' AND d.d_year = 1999 AND d.d_moy = 2 AND SUBSTRING(ca.ca_zip, 1, 5) <> SUBSTRING(s.s_zip, 1, 5) AND ca.ca_state = 'KS' AND c.c_birth_month = 2 AND ss.ss_wholesale_cost BETWEEN 76 AND 96 GROUP BY i_brand, i_brand_id, i_manufact_id, i_manufact ORDER BY ext_price DESC, i_brand, i_brand_id, i_manufact_id, i_manufact LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.88,
      "semantic_passed": true,
      "error": null,
      "original_ms": 396.8,
      "patch_ms": 448.8,
      "output_sql": "SELECT i_brand_id AS brand_id, i_brand AS brand, i_manufact_id, i_manufact, SUM(ss_ext_sales_price) AS ext_price FROM date_dim d JOIN store_sales ss ON d.d_date_sk = ss.ss_sold_date_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk WHERE i.i_category = 'Shoes' AND d.d_year = 1999 AND d.d_moy = 2 AND SUBSTRING(ca.ca_zip, 1, 5) <> SUBSTRING(s.s_zip, 1, 5) AND ca.ca_state = 'KS' AND c.c_birth_month = 2 AND ss.ss_wholesale_cost BETWEEN 76 AND 96 GROUP BY i_brand, i_brand_id, i_manufact_id, i_manufact ORDER BY ext_price DESC, i_brand, i_brand_id, i_manufact_id, i_manufact LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p2",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.88,
      "semantic_passed": true,
      "error": null,
      "original_ms": 396.8,
      "patch_ms": 448.5,
      "output_sql": "WITH filtered_date AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy = 2), filtered_item AS (SELECT i_item_sk, i_brand_id, i_brand, i_manufact_id, i_manufact FROM item WHERE i_category = 'Shoes'), filtered_customer AS (SELECT c_customer_sk, c_current_addr_sk FROM customer WHERE c_birth_month = 2), filtered_customer_address AS (SELECT ca_address_sk, ca_zip FROM customer_address WHERE ca_state = 'KS'), filtered_store AS (SELECT s_store_sk, s_zip FROM store) SELECT i.i_brand_id AS brand_id, i.i_brand AS brand, i.i_manufact_id, i.i_manufact, SUM(ss.ss_ext_sales_price) AS ext_price FROM store_sales ss JOIN filtered_date d ON ss.ss_sold_date_sk = d.d_date_sk JOIN filtered_item i ON ss.ss_item_sk = i.i_item_sk JOIN filtered_customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN filtered_customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN filtered_store s ON ss.ss_store_sk = s.s_store_sk WHERE ss.ss_wholesale_cost BETWEEN 76 AND 96 AND SUBSTRING(ca.ca_zip, 1, 5) <> SUBSTRING(s.s_zip, 1, 5) GROUP BY i.i_brand, i.i_brand_id, i.i_manufact_id, i.i_manufact ORDER BY ext_price DESC, i.i_brand, i.i_brand_id, i.i_manufact_id, i.i_manufact LIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p01": "Limit  (rows=31, time=523.117)\n  Sort  (rows=31, time=523.114)\n    Aggregate  (rows=31, time=523.084)\n      Gather Merge  (rows=31, time=523.058)\n        Aggregate  (rows=10, time=174.494)\n          Sort  (rows=12, time=174.484)\n            Nested Loop  (rows=12, time=174.404)\n              Nested Loop  (rows=433, time=171.179)\n                Nested Loop  (rows=4389, time=144.429)\n                  Hash Join  (rows=41155, time=54.705)\n                    Nested Loop  (rows=41672, time=49.832)\n ",
    "p04": "Limit  (rows=31, time=482.836)\n  Sort  (rows=31, time=482.833)\n    Aggregate  (rows=31, time=482.805)\n      Gather Merge  (rows=31, time=482.786)\n        Aggregate  (rows=10, time=161.834)\n          Sort  (rows=12, time=161.825)\n            Nested Loop  (rows=12, time=161.769)\n              Nested Loop  (rows=433, time=158.806)\n                Nested Loop  (rows=4389, time=134.01)\n                  Hash Join  (rows=41155, time=52.919)\n                    Nested Loop  (rows=41672, time=48.301)\n  ",
    "compile_p1": "Limit  (rows=31, time=366.527)\n  Sort  (rows=31, time=366.524)\n    Aggregate  (rows=31, time=366.499)\n      Gather Merge  (rows=31, time=366.48)\n        Aggregate  (rows=31, time=366.134)\n          Sort  (rows=37, time=366.108)\n            Nested Loop  (rows=37, time=366.033)\n              Nested Loop  (rows=1299, time=359.675)\n                Nested Loop  (rows=13167, time=309.49)\n                  Hash Join  (rows=123464, time=151.456)\n                    Nested Loop  (rows=125015, time=138.36",
    "compile_p2": "Limit  (rows=31, time=365.567)\n  Sort  (rows=31, time=365.565)\n    Aggregate  (rows=31, time=365.539)\n      Gather Merge  (rows=31, time=365.517)\n        Aggregate  (rows=31, time=365.196)\n          Sort  (rows=37, time=365.174)\n            Nested Loop  (rows=37, time=365.089)\n              Nested Loop  (rows=1299, time=358.437)\n                Nested Loop  (rows=13167, time=307.766)\n                  Hash Join  (rows=123464, time=149.863)\n                    Nested Loop  (rows=125015, time=137."
  }
}