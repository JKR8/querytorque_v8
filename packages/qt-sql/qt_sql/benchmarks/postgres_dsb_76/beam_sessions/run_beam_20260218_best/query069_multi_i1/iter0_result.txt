{
  "iteration": 0,
  "n_api_calls": 10,
  "beam_cost_usd": 0.00993628,
  "beam_cost_priced_calls": 2,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 36867,
    "completion_tokens": 7229,
    "total_tokens": 44096,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 18432,
    "reasoning_tokens": 5250
  },
  "best_speedup": 17.7,
  "best_patch_id": "compile_p1",
  "best_sql": "WITH filtered_customers AS (SELECT c.c_customer_sk, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk WHERE ca.ca_state IN ('CO','NC','TX') AND cd.cd_marital_status IN ('S','M','U') AND cd.cd_education_status IN ('Primary','College')), date_range AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 12), store_customers AS (SELECT DISTINCT ss_customer_sk FROM store_sales ss JOIN date_range dr ON ss.ss_sold_date_sk = dr.d_date_sk WHERE ss.ss_list_price BETWEEN 80 AND 169), web_customers AS (SELECT DISTINCT ws_bill_customer_sk FROM web_sales ws JOIN date_range dr ON ws.ws_sold_date_sk = dr.d_date_sk WHERE ws.ws_list_price BETWEEN 80 AND 169), catalog_customers AS (SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales cs JOIN date_range dr ON cs.cs_sold_date_sk = dr.d_date_sk WHERE cs.cs_list_price BETWEEN 80 AND 169) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) cnt1, cd_purchase_estimate, COUNT(*) cnt2, cd_credit_rating, COUNT(*) cnt3 FROM filtered_customers fc INNER JOIN store_customers sc ON fc.c_customer_sk = sc.ss_customer_sk LEFT JOIN web_customers wc ON fc.c_customer_sk = wc.ws_bill_customer_sk LEFT JOIN catalog_customers cc ON fc.c_customer_sk = cc.cs_ship_customer_sk WHERE wc.ws_bill_customer_sk IS NULL AND cc.cs_ship_customer_sk IS NULL GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
  "patches": [
    {
      "patch_id": "p05",
      "family": "C",
      "transform": "channel_bitmap_aggregation",
      "relevance_score": 0.55,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  count(*) cnt1,\n  cd_purchase_estimate,\n  count(*) cnt2,\n  cd_credit_rating,\n  count(*) cnt3\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  ca_state in ('CO','NC','TX') and\n  cd_demo_sk = c.c_current_cdemo_sk\n  and cd_marital_status in ('S', 'M', 'U')\n  and cd_education_status in ('Primary', 'College') and\n  exists (select *\n          from store_sales,date_dim\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 2002 and\n                d_moy between 10 and 10+2\n                and ss_list_price between 80 and 169\n          ) and\n   (not exists (select *\n            from web_sales,date_dim\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 2002 and\n                  d_moy between 10 and 10+2\n                  and ws_list_price between 80 and 169\n            ) and\n    not exists (select *\n            from catalog_sales,date_dim\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 2002 and\n                  d_moy between 10 and 10+2\n                  and cs_list_price between 80 and 169)\n            )\n group by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n order by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n limit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Consolidate the three fact-table scans into a single scan per fact table using UNION ALL and conditional aggregation to compute existence flags, then join once with customer. (Note: This is a portability candidate; use as exploration.)"
    },
    {
      "patch_id": "p03",
      "family": "A",
      "transform": "multi_dimension_prefetch",
      "relevance_score": 0.7,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  count(*) cnt1,\n  cd_purchase_estimate,\n  count(*) cnt2,\n  cd_credit_rating,\n  count(*) cnt3\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  ca_state in ('CO','NC','TX') and\n  cd_demo_sk = c.c_current_cdemo_sk\n  and cd_marital_status in ('S', 'M', 'U')\n  and cd_education_status in ('Primary', 'College') and\n  exists (select *\n          from store_sales,date_dim\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 2002 and\n                d_moy between 10 and 10+2\n                and ss_list_price between 80 and 169\n          ) and\n   (not exists (select *\n            from web_sales,date_dim\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 2002 and\n                  d_moy between 10 and 10+2\n                  and ws_list_price between 80 and 169\n            ) and\n    not exists (select *\n            from catalog_sales,date_dim\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 2002 and\n                  d_moy between 10 and 10+2\n                  and cs_list_price between 80 and 169)\n            )\n group by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n order by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n limit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre-filter customer, customer_address, customer_demographics into a single CTE returning only c_customer_sk and required demographic columns, applying all dimension filters early. Then join this CTE with the fact channels."
    },
    {
      "patch_id": "p01",
      "family": "B",
      "transform": "early_filter_decorrelate",
      "relevance_score": 0.85,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_customers AS (SELECT c.c_customer_sk, c.c_current_cdemo_sk, ca.ca_state FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ca.ca_state IN ('CO','NC','TX')), store_customers AS (SELECT DISTINCT ss.ss_customer_sk FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE d.d_year = 2002 AND d.d_moy BETWEEN 10 AND 12 AND ss.ss_list_price BETWEEN 80 AND 169), web_customers AS (SELECT DISTINCT ws.ws_bill_customer_sk FROM web_sales ws JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk WHERE d.d_year = 2002 AND d.d_moy BETWEEN 10 AND 12 AND ws.ws_list_price BETWEEN 80 AND 169), catalog_customers AS (SELECT DISTINCT cs.cs_ship_customer_sk FROM catalog_sales cs JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk WHERE d.d_year = 2002 AND d.d_moy BETWEEN 10 AND 12 AND cs.cs_list_price BETWEEN 80 AND 169) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) cnt1, cd_purchase_estimate, COUNT(*) cnt2, cd_credit_rating, COUNT(*) cnt3 FROM filtered_customers c JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN store_customers ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN web_customers ws ON c.c_customer_sk = ws.ws_bill_customer_sk LEFT JOIN catalog_customers cs ON c.c_customer_sk = cs.cs_ship_customer_sk WHERE ss.ss_customer_sk IS NOT NULL AND ws.ws_bill_customer_sk IS NULL AND cs.cs_ship_customer_sk IS NULL GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Decorrelate the three EXISTS/NOT EXISTS subqueries by precomputing distinct customer keys for each channel (store, web, catalog) that meet the date and price filters, then join as anti/semi-joins. Pre-filter customer, customer_address, customer_demographics into a CTE to reduce outer rows."
    },
    {
      "patch_id": "p02",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.75,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": true,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  count(*) cnt1,\n  cd_purchase_estimate,\n  count(*) cnt2,\n  cd_credit_rating,\n  count(*) cnt3\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  ca_state in ('CO','NC','TX') and\n  cd_demo_sk = c.c_current_cdemo_sk\n  and cd_marital_status in ('S', 'M', 'U')\n  and cd_education_status in ('Primary', 'College') and\n  exists (select *\n          from store_sales,date_dim\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 2002 and\n                d_moy between 10 and 10+2\n                and ss_list_price between 80 and 169\n          ) and\n   (not exists (select *\n            from web_sales,date_dim\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 2002 and\n                  d_moy between 10 and 10+2\n                  and ws_list_price between 80 and 169\n            ) and\n    not exists (select *\n            from catalog_sales,date_dim\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 2002 and\n                  d_moy between 10 and 10+2\n                  and cs_list_price between 80 and 169)\n            )\n group by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n order by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n limit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Isolate date_dim filter into a CTE returning d_date_sk for d_year=2002 and d_moy between 10 and 12; convert comma joins to explicit INNER JOIN syntax; join the date CTE with each fact table in separate CTEs to enable hash joins with tiny dimension."
    },
    {
      "patch_id": "p07",
      "family": "F",
      "transform": "materialized_dimension_fact_prefilter",
      "relevance_score": 0.6,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  count(*) cnt1,\n  cd_purchase_estimate,\n  count(*) cnt2,\n  cd_credit_rating,\n  count(*) cnt3\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  ca_state in ('CO','NC','TX') and\n  cd_demo_sk = c.c_current_cdemo_sk\n  and cd_marital_status in ('S', 'M', 'U')\n  and cd_education_status in ('Primary', 'College') and\n  exists (select *\n          from store_sales,date_dim\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 2002 and\n                d_moy between 10 and 10+2\n                and ss_list_price between 80 and 169\n          ) and\n   (not exists (select *\n            from web_sales,date_dim\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 2002 and\n                  d_moy between 10 and 10+2\n                  and ws_list_price between 80 and 169\n            ) and\n    not exists (select *\n            from catalog_sales,date_dim\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 2002 and\n                  d_moy between 10 and 10+2\n                  and cs_list_price between 80 and 169)\n            )\n group by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n order by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n limit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Stage reduction: create a CTE that pre-joins date_dim with each fact table, filtering on date and price, returning only customer_sk. Materialize these CTEs to create small hash tables for anti/semi-joins."
    },
    {
      "patch_id": "p06",
      "family": "E",
      "transform": "pg_self_join_decomposition",
      "relevance_score": 0.65,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  count(*) cnt1,\n  cd_purchase_estimate,\n  count(*) cnt2,\n  cd_credit_rating,\n  count(*) cnt3\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  ca_state in ('CO','NC','TX') and\n  cd_demo_sk = c.c_current_cdemo_sk\n  and cd_marital_status in ('S', 'M', 'U')\n  and cd_education_status in ('Primary', 'College') and\n  exists (select *\n          from store_sales,date_dim\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 2002 and\n                d_moy between 10 and 10+2\n                and ss_list_price between 80 and 169\n          ) and\n   (not exists (select *\n            from web_sales,date_dim\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 2002 and\n                  d_moy between 10 and 10+2\n                  and ws_list_price between 80 and 169\n            ) and\n    not exists (select *\n            from catalog_sales,date_dim\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 2002 and\n                  d_moy between 10 and 10+2\n                  and cs_list_price between 80 and 169)\n            )\n group by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n order by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n limit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Materialize the filtered customer\u2013address\u2013demographics join once as a CTE, then join it with precomputed channel key sets. Avoid recomputing the dimension join for each channel check."
    },
    {
      "patch_id": "p04",
      "family": "B",
      "transform": "inline_decorrelate_materialized",
      "relevance_score": 0.8,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: could not write to file \"base/pgsql_tmp/pgsql_tmp24713.847\": No space left on device\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH store_customers AS (SELECT DISTINCT ss_customer_sk FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 12 AND ss_list_price BETWEEN 80 AND 169), web_customers AS (SELECT DISTINCT ws_bill_customer_sk FROM web_sales, date_dim WHERE ws_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 12 AND ws_list_price BETWEEN 80 AND 169), catalog_customers AS (SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales, date_dim WHERE cs_sold_date_sk = d_date_sk AND d_year = 2002 AND d_moy BETWEEN 10 AND 12 AND cs_list_price BETWEEN 80 AND 169) SELECT cd_gender, cd_marital_status, cd_education_status, count(*) cnt1, cd_purchase_estimate, count(*) cnt2, cd_credit_rating, count(*) cnt3 FROM customer c, customer_address ca, customer_demographics cd, store_customers, web_customers, catalog_customers WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_state IN ('CO','NC','TX') AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('S', 'M', 'U') AND cd_education_status IN ('Primary', 'College') AND EXISTS (SELECT 1 FROM store_customers sc WHERE c.c_customer_sk = sc.ss_customer_sk) AND NOT EXISTS (SELECT 1 FROM web_customers wc WHERE c.c_customer_sk = wc.ws_bill_customer_sk) AND NOT EXISTS (SELECT 1 FROM catalog_customers cc WHERE c.c_customer_sk = cc.cs_ship_customer_sk) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Use MATERIALIZED CTEs to precompute distinct customer keys for each channel, forcing PostgreSQL to materialize the small key sets and break correlation. Keep EXISTS/NOT EXISTS as anti/semi-joins but with precomputed key sets."
    },
    {
      "patch_id": "p08",
      "family": "D",
      "transform": "intersect_to_exists",
      "relevance_score": 0.45,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  count(*) cnt1,\n  cd_purchase_estimate,\n  count(*) cnt2,\n  cd_credit_rating,\n  count(*) cnt3\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  ca_state in ('CO','NC','TX') and\n  cd_demo_sk = c.c_current_cdemo_sk\n  and cd_marital_status in ('S', 'M', 'U')\n  and cd_education_status in ('Primary', 'College') and\n  exists (select *\n          from store_sales,date_dim\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 2002 and\n                d_moy between 10 and 10+2\n                and ss_list_price between 80 and 169\n          ) and\n   (not exists (select *\n            from web_sales,date_dim\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 2002 and\n                  d_moy between 10 and 10+2\n                  and ws_list_price between 80 and 169\n            ) and\n    not exists (select *\n            from catalog_sales,date_dim\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 2002 and\n                  d_moy between 10 and 10+2\n                  and cs_list_price between 80 and 169)\n            )\n group by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n order by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n limit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Convert the NOT EXISTS patterns to INTERSECT operations to see if PostgreSQL can optimize them better. (Note: This is exploratory; guardrail G_PG_CTE_EXISTS_INTERSECT_RISK warns of potential regression.)"
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 14.35,
      "semantic_passed": true,
      "error": null,
      "original_ms": 14638.2,
      "patch_ms": 1020.4,
      "output_sql": "WITH filtered_customers AS (SELECT c.c_customer_sk, c.c_current_cdemo_sk, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk WHERE ca.ca_state IN ('CO','NC','TX') AND cd.cd_marital_status IN ('S', 'M', 'U') AND cd.cd_education_status IN ('Primary', 'College')), store_customers AS (SELECT DISTINCT ss_customer_sk FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE d.d_year = 2002 AND d.d_moy BETWEEN 10 AND 12 AND ss.ss_list_price BETWEEN 80 AND 169), web_customers AS (SELECT DISTINCT ws_bill_customer_sk FROM web_sales ws JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk WHERE d.d_year = 2002 AND d.d_moy BETWEEN 10 AND 12 AND ws.ws_list_price BETWEEN 80 AND 169), catalog_customers AS (SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales cs JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk WHERE d.d_year = 2002 AND d.d_moy BETWEEN 10 AND 12 AND cs.cs_list_price BETWEEN 80 AND 169) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM filtered_customers c JOIN store_customers ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN web_customers ws ON c.c_customer_sk = ws.ws_bill_customer_sk LEFT JOIN catalog_customers cs ON c.c_customer_sk = cs.cs_ship_customer_sk WHERE ws.ws_bill_customer_sk IS NULL AND cs.cs_ship_customer_sk IS NULL GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 17.7,
      "semantic_passed": true,
      "error": null,
      "original_ms": 14638.2,
      "patch_ms": 826.9,
      "output_sql": "WITH filtered_customers AS (SELECT c.c_customer_sk, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk WHERE ca.ca_state IN ('CO','NC','TX') AND cd.cd_marital_status IN ('S','M','U') AND cd.cd_education_status IN ('Primary','College')), date_range AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 12), store_customers AS (SELECT DISTINCT ss_customer_sk FROM store_sales ss JOIN date_range dr ON ss.ss_sold_date_sk = dr.d_date_sk WHERE ss.ss_list_price BETWEEN 80 AND 169), web_customers AS (SELECT DISTINCT ws_bill_customer_sk FROM web_sales ws JOIN date_range dr ON ws.ws_sold_date_sk = dr.d_date_sk WHERE ws.ws_list_price BETWEEN 80 AND 169), catalog_customers AS (SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales cs JOIN date_range dr ON cs.cs_sold_date_sk = dr.d_date_sk WHERE cs.cs_list_price BETWEEN 80 AND 169) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) cnt1, cd_purchase_estimate, COUNT(*) cnt2, cd_credit_rating, COUNT(*) cnt3 FROM filtered_customers fc INNER JOIN store_customers sc ON fc.c_customer_sk = sc.ss_customer_sk LEFT JOIN web_customers wc ON fc.c_customer_sk = wc.ws_bill_customer_sk LEFT JOIN catalog_customers cc ON fc.c_customer_sk = cc.cs_ship_customer_sk WHERE wc.ws_bill_customer_sk IS NULL AND cc.cs_ship_customer_sk IS NULL GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "compile_p1": "Limit  (rows=80, time=830.065)\n  Index Only Scan on date_dim  (rows=92, time=0.157)\n  Aggregate  (rows=80, time=830.058)\n    Sort  (rows=964, time=829.95)\n      Nested Loop  (rows=964, time=829.148)\n        Hash Join  (rows=4472, time=800.513)\n          Hash Join  (rows=4959, time=507.407)\n            Hash Join  (rows=5074, time=435.593)\n              Hash Join  (rows=67194, time=127.328)\n                Seq Scan on customer (c)  (rows=500000, time=41.909)\n                Hash  (rows=33661, time"
  }
}