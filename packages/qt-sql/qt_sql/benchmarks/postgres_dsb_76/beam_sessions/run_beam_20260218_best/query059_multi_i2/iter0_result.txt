{
  "iteration": 0,
  "n_api_calls": 9,
  "beam_cost_usd": 0.03664666,
  "beam_cost_priced_calls": 9,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 116260,
    "completion_tokens": 34233,
    "total_tokens": 150493,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 45888,
    "reasoning_tokens": 19053
  },
  "best_speedup": 1.65,
  "best_patch_id": "compile_p04_based",
  "best_sql": "WITH filtered_store_sales AS (SELECT d_week_seq,\n        ss_store_sk,\n        SUM(CASE WHEN (d_day_name='Sunday') THEN ss_sales_price ELSE NULL END) sun_sales,\n        SUM(CASE WHEN (d_day_name='Monday') THEN ss_sales_price ELSE NULL END) mon_sales,\n        SUM(CASE WHEN (d_day_name='Tuesday') THEN ss_sales_price ELSE NULL END) tue_sales,\n        SUM(CASE WHEN (d_day_name='Wednesday') THEN ss_sales_price ELSE NULL END) wed_sales,\n        SUM(CASE WHEN (d_day_name='Thursday') THEN ss_sales_price ELSE NULL END) thu_sales,\n        SUM(CASE WHEN (d_day_name='Friday') THEN ss_sales_price ELSE NULL END) fri_sales,\n        SUM(CASE WHEN (d_day_name='Saturday') THEN ss_sales_price ELSE NULL END) sat_sales\n FROM store_sales\n JOIN date_dim ON d_date_sk = ss_sold_date_sk\n JOIN store ON ss_store_sk = s_store_sk\n WHERE ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 85 * 0.01\n   AND s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')\n GROUP BY d_week_seq, ss_store_sk)\n SELECT s_store_name1,s_store_id1,d_week_seq1\n       ,sun_sales1/sun_sales2,mon_sales1/mon_sales2\n       ,tue_sales1/tue_sales2,wed_sales1/wed_sales2,thu_sales1/thu_sales2\n       ,fri_sales1/fri_sales2,sat_sales1/sat_sales2\n FROM\n (SELECT s_store_name s_store_name1,filtered_store_sales.d_week_seq d_week_seq1\n        ,s_store_id s_store_id1,sun_sales sun_sales1\n        ,mon_sales mon_sales1,tue_sales tue_sales1\n        ,wed_sales wed_sales1,thu_sales thu_sales1\n        ,fri_sales fri_sales1,sat_sales sat_sales1\n  FROM filtered_store_sales\n  JOIN store ON filtered_store_sales.ss_store_sk = s_store_sk\n  JOIN date_dim d ON d.d_week_seq = filtered_store_sales.d_week_seq\n  WHERE d_month_seq BETWEEN 1183 AND 1183 + 11\n    AND s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')\n ) y,\n (SELECT s_store_name s_store_name2,filtered_store_sales.d_week_seq d_week_seq2\n        ,s_store_id s_store_id2,sun_sales sun_sales2\n        ,mon_sales mon_sales2,tue_sales tue_sales2\n        ,wed_sales wed_sales2,thu_sales thu_sales2\n        ,fri_sales fri_sales2,sat_sales sat_sales2\n  FROM filtered_store_sales\n  JOIN store ON filtered_store_sales.ss_store_sk = s_store_sk\n  JOIN date_dim d ON d.d_week_seq = filtered_store_sales.d_week_seq\n  WHERE d_month_seq BETWEEN 1183 + 12 AND 1183 + 23\n    AND s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')\n ) x\n WHERE s_store_id1=s_store_id2\n   AND d_week_seq1=d_week_seq2-52\n ORDER BY s_store_name1,s_store_id1,d_week_seq1\n LIMIT 100;",
  "patches": [
    {
      "patch_id": "p01",
      "family": "A",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.85,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Checksum mismatch",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH wss AS (SELECT d_week_seq, ss_store_sk, SUM(CASE WHEN (d_day_name = 'Sunday') THEN ss_sales_price ELSE NULL END) AS sun_sales, SUM(CASE WHEN (d_day_name = 'Monday') THEN ss_sales_price ELSE NULL END) AS mon_sales, SUM(CASE WHEN (d_day_name = 'Tuesday') THEN ss_sales_price ELSE NULL END) AS tue_sales, SUM(CASE WHEN (d_day_name = 'Wednesday') THEN ss_sales_price ELSE NULL END) AS wed_sales, SUM(CASE WHEN (d_day_name = 'Thursday') THEN ss_sales_price ELSE NULL END) AS thu_sales, SUM(CASE WHEN (d_day_name = 'Friday') THEN ss_sales_price ELSE NULL END) AS fri_sales, SUM(CASE WHEN (d_day_name = 'Saturday') THEN ss_sales_price ELSE NULL END) AS sat_sales FROM store_sales, date_dim WHERE d_date_sk = ss_sold_date_sk AND ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 85 * 0.01 GROUP BY d_week_seq, ss_store_sk), date_filter AS (SELECT DISTINCT d_week_seq, d_month_seq FROM date_dim WHERE d_month_seq BETWEEN 1183 AND 1183 + 23) SELECT s_store_name1, s_store_id1, d_week_seq1, sun_sales1 / sun_sales2, mon_sales1 / mon_sales2, tue_sales1 / tue_sales2, wed_sales1 / wed_sales2, thu_sales1 / thu_sales2, fri_sales1 / fri_sales2, sat_sales1 / sat_sales2 FROM (SELECT s_store_name AS s_store_name1, wss.d_week_seq AS d_week_seq1, s_store_id AS s_store_id1, sun_sales AS sun_sales1, mon_sales AS mon_sales1, tue_sales AS tue_sales1, wed_sales AS wed_sales1, thu_sales AS thu_sales1, fri_sales AS fri_sales1, sat_sales AS sat_sales1 FROM wss JOIN store ON wss.ss_store_sk = store.s_store_sk JOIN date_filter d ON d.d_week_seq = wss.d_week_seq WHERE d.d_month_seq BETWEEN 1183 AND 1183 + 11 AND store.s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')) y JOIN (SELECT s_store_name AS s_store_name2, wss.d_week_seq AS d_week_seq2, s_store_id AS s_store_id2, sun_sales AS sun_sales2, mon_sales AS mon_sales2, tue_sales AS tue_sales2, wed_sales AS wed_sales2, thu_sales AS thu_sales2, fri_sales AS fri_sales2, sat_sales AS sat_sales2 FROM wss JOIN store ON wss.ss_store_sk = store.s_store_sk JOIN date_filter d ON d.d_week_seq = wss.d_week_seq WHERE d.d_month_seq BETWEEN 1183 + 12 AND 1183 + 23 AND store.s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')) x ON s_store_id1 = s_store_id2 AND d_week_seq1 = d_week_seq2 - 52 ORDER BY s_store_name1, s_store_id1, d_week_seq1 LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Replace comma-joins with explicit INNER JOIN syntax and extract date_dim filters into CTEs to enable predicate pushdown into store_sales scan."
    },
    {
      "patch_id": "p02",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.8,
      "status": "WIN",
      "speedup": 1.31,
      "semantic_passed": true,
      "error": null,
      "original_ms": 26378.3,
      "patch_ms": 20145.8,
      "output_sql": "WITH wss AS (SELECT d_week_seq, ss_store_sk, SUM(CASE WHEN (d_day_name = 'Sunday') THEN ss_sales_price ELSE NULL END) AS sun_sales, SUM(CASE WHEN (d_day_name = 'Monday') THEN ss_sales_price ELSE NULL END) AS mon_sales, SUM(CASE WHEN (d_day_name = 'Tuesday') THEN ss_sales_price ELSE NULL END) AS tue_sales, SUM(CASE WHEN (d_day_name = 'Wednesday') THEN ss_sales_price ELSE NULL END) AS wed_sales, SUM(CASE WHEN (d_day_name = 'Thursday') THEN ss_sales_price ELSE NULL END) AS thu_sales, SUM(CASE WHEN (d_day_name = 'Friday') THEN ss_sales_price ELSE NULL END) AS fri_sales, SUM(CASE WHEN (d_day_name = 'Saturday') THEN ss_sales_price ELSE NULL END) AS sat_sales FROM store_sales, date_dim WHERE d_date_sk = ss_sold_date_sk AND ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 85 * 0.01 GROUP BY d_week_seq, ss_store_sk), filtered_date_dim AS (SELECT d_week_seq, d_month_seq FROM date_dim WHERE d_month_seq BETWEEN 1183 AND 1183 + 23), filtered_store AS (SELECT s_store_sk, s_store_id, s_store_name, s_state FROM store WHERE s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')) SELECT s_store_name1,s_store_id1,d_week_seq1\n,sun_sales1/sun_sales2,mon_sales1/mon_sales2\n,tue_sales1/tue_sales2,wed_sales1/wed_sales2,thu_sales1/thu_sales2\n,fri_sales1/fri_sales2,sat_sales1/sat_sales2\nFROM\n(SELECT s_store_name s_store_name1,wss.d_week_seq d_week_seq1\n,s_store_id s_store_id1,sun_sales sun_sales1\n,mon_sales mon_sales1,tue_sales tue_sales1\n,wed_sales wed_sales1,thu_sales thu_sales1\n,fri_sales fri_sales1,sat_sales sat_sales1\nFROM wss\nJOIN filtered_store fs1 ON ss_store_sk = fs1.s_store_sk\nJOIN filtered_date_dim fd1 ON fd1.d_week_seq = wss.d_week_seq\nWHERE fd1.d_month_seq BETWEEN 1183 AND 1183 + 11\nAND fs1.s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')\n) y\nJOIN\n(SELECT s_store_name s_store_name2,wss.d_week_seq d_week_seq2\n,s_store_id s_store_id2,sun_sales sun_sales2\n,mon_sales mon_sales2,tue_sales tue_sales2\n,wed_sales wed_sales2,thu_sales thu_sales2\n,fri_sales fri_sales2,sat_sales sat_sales2\nFROM wss\nJOIN filtered_store fs2 ON ss_store_sk = fs2.s_store_sk\nJOIN filtered_date_dim fd2 ON fd2.d_week_seq = wss.d_week_seq\nWHERE fd2.d_month_seq BETWEEN 1183 + 12 AND 1183 + 23\nAND fs2.s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')\n) x\nON s_store_id1=s_store_id2 AND d_week_seq1=d_week_seq2-52\nORDER BY s_store_name1,s_store_id1,d_week_seq1\nLIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Materialize filtered date_dim and store rows into CTEs before joining with store_sales, enabling small hash table probes and join-order flexibility."
    },
    {
      "patch_id": "p03",
      "family": "A",
      "transform": "multi_dimension_prefetch",
      "relevance_score": 0.65,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Checksum mismatch",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH wss_early_1 AS (SELECT d_week_seq, ss_store_sk, SUM(CASE WHEN (d_day_name='Sunday') THEN ss_sales_price ELSE NULL END) sun_sales, SUM(CASE WHEN (d_day_name='Monday') THEN ss_sales_price ELSE NULL END) mon_sales, SUM(CASE WHEN (d_day_name='Tuesday') THEN ss_sales_price ELSE NULL END) tue_sales, SUM(CASE WHEN (d_day_name='Wednesday') THEN ss_sales_price ELSE NULL END) wed_sales, SUM(CASE WHEN (d_day_name='Thursday') THEN ss_sales_price ELSE NULL END) thu_sales, SUM(CASE WHEN (d_day_name='Friday') THEN ss_sales_price ELSE NULL END) fri_sales, SUM(CASE WHEN (d_day_name='Saturday') THEN ss_sales_price ELSE NULL END) sat_sales FROM store_sales, date_dim WHERE d_date_sk = ss_sold_date_sk AND ss_sales_price / ss_list_price BETWEEN 0.65 AND 0.85 AND d_month_seq BETWEEN 1183 AND 1194 GROUP BY d_week_seq, ss_store_sk), wss_early_2 AS (SELECT d_week_seq, ss_store_sk, SUM(CASE WHEN (d_day_name='Sunday') THEN ss_sales_price ELSE NULL END) sun_sales, SUM(CASE WHEN (d_day_name='Monday') THEN ss_sales_price ELSE NULL END) mon_sales, SUM(CASE WHEN (d_day_name='Tuesday') THEN ss_sales_price ELSE NULL END) tue_sales, SUM(CASE WHEN (d_day_name='Wednesday') THEN ss_sales_price ELSE NULL END) wed_sales, SUM(CASE WHEN (d_day_name='Thursday') THEN ss_sales_price ELSE NULL END) thu_sales, SUM(CASE WHEN (d_day_name='Friday') THEN ss_sales_price ELSE NULL END) fri_sales, SUM(CASE WHEN (d_day_name='Saturday') THEN ss_sales_price ELSE NULL END) sat_sales FROM store_sales, date_dim WHERE d_date_sk = ss_sold_date_sk AND ss_sales_price / ss_list_price BETWEEN 0.65 AND 0.85 AND d_month_seq BETWEEN 1195 AND 1206 GROUP BY d_week_seq, ss_store_sk) SELECT s_store_name1, s_store_id1, d_week_seq1, sun_sales1 / sun_sales2, mon_sales1 / mon_sales2, tue_sales1 / tue_sales2, wed_sales1 / wed_sales2, thu_sales1 / thu_sales2, fri_sales1 / fri_sales2, sat_sales1 / sat_sales2 FROM (SELECT s_store_name s_store_name1, wss_early_1.d_week_seq d_week_seq1, s_store_id s_store_id1, sun_sales sun_sales1, mon_sales mon_sales1, tue_sales tue_sales1, wed_sales wed_sales1, thu_sales thu_sales1, fri_sales fri_sales1, sat_sales sat_sales1 FROM wss_early_1, store, date_dim d WHERE d.d_week_seq = wss_early_1.d_week_seq AND ss_store_sk = s_store_sk AND d_month_seq BETWEEN 1183 AND 1183 + 11 AND s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')) y, (SELECT s_store_name s_store_name2, wss_early_2.d_week_seq d_week_seq2, s_store_id s_store_id2, sun_sales sun_sales2, mon_sales mon_sales2, tue_sales tue_sales2, wed_sales wed_sales2, thu_sales thu_sales2, fri_sales fri_sales2, sat_sales sat_sales2 FROM wss_early_2, store, date_dim d WHERE d.d_week_seq = wss_early_2.d_week_seq AND ss_store_sk = s_store_sk AND d_month_seq BETWEEN 1183 + 12 AND 1183 + 23 AND s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')) x WHERE s_store_id1 = s_store_id2 AND d_week_seq1 = d_week_seq2 - 52 ORDER BY s_store_name1, s_store_id1, d_week_seq1 LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Create separate CTEs for each date_dim filter range (1183-1194, 1195-1206) to allow partition pruning and separate store_sales scans."
    },
    {
      "patch_id": "p04",
      "family": "E",
      "transform": "pg_self_join_decomposition",
      "relevance_score": 0.55,
      "status": "WIN",
      "speedup": 1.61,
      "semantic_passed": true,
      "error": null,
      "original_ms": 26378.3,
      "patch_ms": 16421.0,
      "output_sql": "WITH filtered_store_sales AS (SELECT d_week_seq,\n        ss_store_sk,\n        SUM(CASE WHEN (d_day_name='Sunday') THEN ss_sales_price ELSE NULL END) sun_sales,\n        SUM(CASE WHEN (d_day_name='Monday') THEN ss_sales_price ELSE NULL END) mon_sales,\n        SUM(CASE WHEN (d_day_name='Tuesday') THEN ss_sales_price ELSE NULL END) tue_sales,\n        SUM(CASE WHEN (d_day_name='Wednesday') THEN ss_sales_price ELSE NULL END) wed_sales,\n        SUM(CASE WHEN (d_day_name='Thursday') THEN ss_sales_price ELSE NULL END) thu_sales,\n        SUM(CASE WHEN (d_day_name='Friday') THEN ss_sales_price ELSE NULL END) fri_sales,\n        SUM(CASE WHEN (d_day_name='Saturday') THEN ss_sales_price ELSE NULL END) sat_sales\n FROM store_sales\n JOIN date_dim ON d_date_sk = ss_sold_date_sk\n JOIN store ON ss_store_sk = s_store_sk\n WHERE ss_sales_price / ss_list_price BETWEEN 0.65 AND 0.85\n   AND s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')\n GROUP BY d_week_seq, ss_store_sk), y AS (SELECT s_store_name s_store_name1,filtered_wss.d_week_seq d_week_seq1\n        ,s_store_id s_store_id1,sun_sales sun_sales1\n        ,mon_sales mon_sales1,tue_sales tue_sales1\n        ,wed_sales wed_sales1,thu_sales thu_sales1\n        ,fri_sales fri_sales1,sat_sales sat_sales1\n  FROM filtered_store_sales filtered_wss\n  JOIN store ON filtered_wss.ss_store_sk = s_store_sk\n  JOIN date_dim d ON d.d_week_seq = filtered_wss.d_week_seq\n  WHERE d_month_seq BETWEEN 1183 AND 1183 + 11\n    AND s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')), x AS (SELECT s_store_name s_store_name2,filtered_wss.d_week_seq d_week_seq2\n        ,s_store_id s_store_id2,sun_sales sun_sales2\n        ,mon_sales mon_sales2,tue_sales tue_sales2\n        ,wed_sales wed_sales2,thu_sales thu_sales2\n        ,fri_sales fri_sales2,sat_sales sat_sales2\n  FROM filtered_store_sales filtered_wss\n  JOIN store ON filtered_wss.ss_store_sk = s_store_sk\n  JOIN date_dim d ON d.d_week_seq = filtered_wss.d_week_seq\n  WHERE d_month_seq BETWEEN 1183 + 12 AND 1183 + 23\n    AND s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')) SELECT s_store_name1,s_store_id1,d_week_seq1\n       ,sun_sales1/sun_sales2,mon_sales1/mon_sales2\n       ,tue_sales1/tue_sales2,wed_sales1/wed_sales2,thu_sales1/thu_sales2\n       ,fri_sales1/fri_sales2,sat_sales1/sat_sales2\n FROM\n (SELECT s_store_name s_store_name1,filtered_wss.d_week_seq d_week_seq1\n        ,s_store_id s_store_id1,sun_sales sun_sales1\n        ,mon_sales mon_sales1,tue_sales tue_sales1\n        ,wed_sales wed_sales1,thu_sales thu_sales1\n        ,fri_sales fri_sales1,sat_sales sat_sales1\n  FROM filtered_store_sales filtered_wss\n  JOIN store ON filtered_wss.ss_store_sk = s_store_sk\n  JOIN date_dim d ON d.d_week_seq = filtered_wss.d_week_seq\n  WHERE d_month_seq BETWEEN 1183 AND 1183 + 11\n    AND s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')\n ) y,\n (SELECT s_store_name s_store_name2,filtered_wss.d_week_seq d_week_seq2\n        ,s_store_id s_store_id2,sun_sales sun_sales2\n        ,mon_sales mon_sales2,tue_sales tue_sales2\n        ,wed_sales wed_sales2,thu_sales thu_sales2\n        ,fri_sales fri_sales2,sat_sales sat_sales2\n  FROM filtered_store_sales filtered_wss\n  JOIN store ON filtered_wss.ss_store_sk = s_store_sk\n  JOIN date_dim d ON d.d_week_seq = filtered_wss.d_week_seq\n  WHERE d_month_seq BETWEEN 1183 + 12 AND 1183 + 23\n    AND s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')) x\n WHERE s_store_id1=s_store_id2\n   AND d_week_seq1=d_week_seq2-52\n ORDER BY s_store_name1,s_store_id1,d_week_seq1\nLIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Materialize filtered store_sales+date_dim+store join once, then derive wss1 and wss2 via filtered scans of the materialized result."
    },
    {
      "patch_id": "compile_p04_based",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 1.65,
      "semantic_passed": true,
      "error": null,
      "original_ms": 36950.2,
      "patch_ms": 22386.9,
      "output_sql": "WITH filtered_store_sales AS (SELECT d_week_seq,\n        ss_store_sk,\n        SUM(CASE WHEN (d_day_name='Sunday') THEN ss_sales_price ELSE NULL END) sun_sales,\n        SUM(CASE WHEN (d_day_name='Monday') THEN ss_sales_price ELSE NULL END) mon_sales,\n        SUM(CASE WHEN (d_day_name='Tuesday') THEN ss_sales_price ELSE NULL END) tue_sales,\n        SUM(CASE WHEN (d_day_name='Wednesday') THEN ss_sales_price ELSE NULL END) wed_sales,\n        SUM(CASE WHEN (d_day_name='Thursday') THEN ss_sales_price ELSE NULL END) thu_sales,\n        SUM(CASE WHEN (d_day_name='Friday') THEN ss_sales_price ELSE NULL END) fri_sales,\n        SUM(CASE WHEN (d_day_name='Saturday') THEN ss_sales_price ELSE NULL END) sat_sales\n FROM store_sales\n JOIN date_dim ON d_date_sk = ss_sold_date_sk\n JOIN store ON ss_store_sk = s_store_sk\n WHERE ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 85 * 0.01\n   AND s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')\n GROUP BY d_week_seq, ss_store_sk)\n SELECT s_store_name1,s_store_id1,d_week_seq1\n       ,sun_sales1/sun_sales2,mon_sales1/mon_sales2\n       ,tue_sales1/tue_sales2,wed_sales1/wed_sales2,thu_sales1/thu_sales2\n       ,fri_sales1/fri_sales2,sat_sales1/sat_sales2\n FROM\n (SELECT s_store_name s_store_name1,filtered_store_sales.d_week_seq d_week_seq1\n        ,s_store_id s_store_id1,sun_sales sun_sales1\n        ,mon_sales mon_sales1,tue_sales tue_sales1\n        ,wed_sales wed_sales1,thu_sales thu_sales1\n        ,fri_sales fri_sales1,sat_sales sat_sales1\n  FROM filtered_store_sales\n  JOIN store ON filtered_store_sales.ss_store_sk = s_store_sk\n  JOIN date_dim d ON d.d_week_seq = filtered_store_sales.d_week_seq\n  WHERE d_month_seq BETWEEN 1183 AND 1183 + 11\n    AND s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')\n ) y,\n (SELECT s_store_name s_store_name2,filtered_store_sales.d_week_seq d_week_seq2\n        ,s_store_id s_store_id2,sun_sales sun_sales2\n        ,mon_sales mon_sales2,tue_sales tue_sales2\n        ,wed_sales wed_sales2,thu_sales thu_sales2\n        ,fri_sales fri_sales2,sat_sales sat_sales2\n  FROM filtered_store_sales\n  JOIN store ON filtered_store_sales.ss_store_sk = s_store_sk\n  JOIN date_dim d ON d.d_week_seq = filtered_store_sales.d_week_seq\n  WHERE d_month_seq BETWEEN 1183 + 12 AND 1183 + 23\n    AND s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')\n ) x\n WHERE s_store_id1=s_store_id2\n   AND d_week_seq1=d_week_seq2-52\n ORDER BY s_store_name1,s_store_id1,d_week_seq1\n LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p02_based",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "NEUTRAL",
      "speedup": 0.98,
      "semantic_passed": true,
      "error": null,
      "original_ms": 36950.2,
      "patch_ms": 37598.2,
      "output_sql": "WITH wss AS (SELECT d_week_seq,\n        ss_store_sk,\n        SUM(CASE WHEN (d_day_name='Sunday') THEN ss_sales_price ELSE NULL END) sun_sales,\n        SUM(CASE WHEN (d_day_name='Monday') THEN ss_sales_price ELSE NULL END) mon_sales,\n        SUM(CASE WHEN (d_day_name='Tuesday') THEN ss_sales_price ELSE NULL END) tue_sales,\n        SUM(CASE WHEN (d_day_name='Wednesday') THEN ss_sales_price ELSE NULL END) wed_sales,\n        SUM(CASE WHEN (d_day_name='Thursday') THEN ss_sales_price ELSE NULL END) thu_sales,\n        SUM(CASE WHEN (d_day_name='Friday') THEN ss_sales_price ELSE NULL END) fri_sales,\n        SUM(CASE WHEN (d_day_name='Saturday') THEN ss_sales_price ELSE NULL END) sat_sales\n FROM store_sales, date_dim\n WHERE d_date_sk = ss_sold_date_sk\n AND ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 85 * 0.01\n GROUP BY d_week_seq, ss_store_sk),\n filtered_date_dim AS (SELECT d_week_seq, d_month_seq FROM date_dim WHERE d_month_seq BETWEEN 1183 AND 1183 + 23),\n filtered_store AS (SELECT s_store_sk, s_store_id, s_store_name, s_state FROM store WHERE s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA'))\n SELECT s_store_name1,s_store_id1,d_week_seq1\n       ,sun_sales1/sun_sales2,mon_sales1/mon_sales2\n       ,tue_sales1/tue_sales2,wed_sales1/wed_sales2,thu_sales1/thu_sales2\n       ,fri_sales1/fri_sales2,sat_sales1/sat_sales2\n FROM\n (SELECT s_store_name s_store_name1,wss.d_week_seq d_week_seq1\n        ,s_store_id s_store_id1,sun_sales sun_sales1\n        ,mon_sales mon_sales1,tue_sales tue_sales1\n        ,wed_sales wed_sales1,thu_sales thu_sales1\n        ,fri_sales fri_sales1,sat_sales sat_sales1\n  FROM wss\n  JOIN filtered_store fs1 ON ss_store_sk = fs1.s_store_sk\n  JOIN filtered_date_dim fd1 ON fd1.d_week_seq = wss.d_week_seq\n  WHERE fd1.d_month_seq BETWEEN 1183 AND 1183 + 11\n    AND fs1.s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')\n ) y\n JOIN\n (SELECT s_store_name s_store_name2,wss.d_week_seq d_week_seq2\n        ,s_store_id s_store_id2,sun_sales sun_sales2\n        ,mon_sales mon_sales2,tue_sales tue_sales2\n        ,wed_sales wed_sales2,thu_sales thu_sales2\n        ,fri_sales fri_sales2,sat_sales sat_sales2\n  FROM wss\n  JOIN filtered_store fs2 ON ss_store_sk = fs2.s_store_sk\n  JOIN filtered_date_dim fd2 ON fd2.d_week_seq = wss.d_week_seq\n  WHERE fd2.d_month_seq BETWEEN 1183 + 12 AND 1183 + 23\n    AND fs2.s_state IN ('AR','GA','IN','KS','KY','OH','SD','VA')\n ) x\n ON s_store_id1=s_store_id2 AND d_week_seq1=d_week_seq2-52\n ORDER BY s_store_name1,s_store_id1,d_week_seq1\n LIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p02": "Limit  (rows=100, time=24685.232)\n  Aggregate  (rows=9175, time=24513.017)\n    Gather Merge  (rows=3952325, time=23463.762)\n      Sort  (rows=3952325, time=23248.138)\n        Nested Loop  (rows=3952325, time=19929.31)\n          Seq Scan on store_sales  (rows=4000474, time=18603.062)\n          Memoize  (rows=1, time=0.0)\n            Index Scan on date_dim  (rows=1, time=0.023)\n  Index Scan on date_dim (date_dim_1)  (rows=731, time=0.565)\n  Seq Scan on store  (rows=26, time=0.259)\n  Sort  (rows=10",
    "p04": "Limit  (rows=100, time=16965.052)\n  Aggregate  (rows=2368, time=16685.109)\n    Gather Merge  (rows=528989, time=16534.227)\n      Sort  (rows=528989, time=16503.314)\n        Nested Loop  (rows=528989, time=16167.725)\n          Hash Join  (rows=532213, time=15853.469)\n            Seq Scan on store_sales  (rows=4000474, time=15463.135)\n            Hash  (rows=26, time=0.114)\n              Seq Scan on store (store_2)  (rows=26, time=0.095)\n          Memoize  (rows=1, time=0.0)\n            Index Scan",
    "compile_p04_based": "Limit  (rows=100, time=9201.039)\n  Aggregate  (rows=2368, time=8973.53)\n    Gather Merge  (rows=528989, time=8857.322)\n      Sort  (rows=176330, time=8752.823)\n        Nested Loop  (rows=176330, time=8626.089)\n          Hash Join  (rows=177404, time=8526.51)\n            Seq Scan on store_sales  (rows=1333491, time=8401.858)\n            Hash  (rows=26, time=0.069)\n              Seq Scan on store (store_2)  (rows=26, time=0.06)\n          Memoize  (rows=1, time=0.0)\n            Index Scan on date_d",
    "compile_p02_based": "Limit  (rows=100, time=21017.737)\n  Aggregate  (rows=9175, time=20817.926)\n    Gather Merge  (rows=3952325, time=19616.348)\n      Sort  (rows=3952325, time=19371.162)\n        Nested Loop  (rows=3952325, time=16481.975)\n          Seq Scan on store_sales  (rows=4000474, time=15269.684)\n          Memoize  (rows=1, time=0.0)\n            Index Scan on date_dim  (rows=1, time=0.015)\n  Index Scan on date_dim (date_dim_1)  (rows=731, time=0.477)\n  Seq Scan on store  (rows=26, time=0.124)\n  Sort  (rows=1"
  }
}