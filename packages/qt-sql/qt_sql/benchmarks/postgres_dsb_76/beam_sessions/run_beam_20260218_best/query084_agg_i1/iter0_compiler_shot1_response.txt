[
  {
    "plan_id": "compile_p03",
    "dialect": "postgres",
    "confidence": 0.85,
    "based_on": "p03",
    "strategy": "Pre‑filter selective dimensions into CTEs, keep comma‑join syntax to let planner push filters.",
    "hypothesis": "Winning probe p03 shows 20.27× speedup by pre‑filtering customer_address and income_band, reducing the large sequential scan on customer. Comma‑join syntax preserved to avoid structural risk.",
    "expected_explain_delta": "Sequential scan on customer replaced by filtered scan or index scan; nested‑loop amplification reduced.",
    "target_ir": "Add CTEs for customer_address and income_band, keep original join conditions in WHERE.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": [],
          "outputs": ["customer_id", "customername"],
          "changed": true,
          "sql": "WITH ca_filtered AS (SELECT * FROM customer_address WHERE ca_city = 'Jackson'), ib_filtered AS (SELECT * FROM income_band WHERE ib_lower_bound >= 23567 AND ib_upper_bound <= 23567 + 50000), hd_filtered AS (SELECT * FROM household_demographics), cd_filtered AS (SELECT * FROM customer_demographics) SELECT c_customer_id AS customer_id, COALESCE(c_last_name, '') || ', ' || COALESCE(c_first_name, '') AS customername FROM customer, ca_filtered, cd_filtered, hd_filtered, ib_filtered, store_returns WHERE c_current_addr_sk = ca_address_sk AND ib_income_band_sk = hd_income_band_sk AND cd_demo_sk = c_current_cdemo_sk AND hd_demo_sk = c_current_hdemo_sk AND sr_cdemo_sk = cd_demo_sk ORDER BY c_customer_id LIMIT 100"
        }
      ]
    }
  },
  {
    "plan_id": "compile_explicit",
    "dialect": "postgres",
    "confidence": 0.80,
    "based_on": "p03",
    "strategy": "Pre‑filter selective dimensions into CTEs and convert comma joins to explicit INNER JOINs to guide the planner.",
    "hypothesis": "Explicit join syntax may improve join ordering and reduce nested loops, building on the speedup of p03. Semantic equivalence is preserved by keeping all original join conditions.",
    "expected_explain_delta": "Sequential scan on customer reduced; hash joins may replace nested loops; better join order possible.",
    "target_ir": "Add CTEs and change join syntax to explicit JOINs while preserving all original predicates.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": [],
          "outputs": ["customer_id", "customername"],
          "changed": true,
          "sql": "WITH ca_filtered AS (SELECT * FROM customer_address WHERE ca_city = 'Jackson'), ib_filtered AS (SELECT * FROM income_band WHERE ib_lower_bound >= 23567 AND ib_upper_bound <= 23567 + 50000), hd_filtered AS (SELECT * FROM household_demographics), cd_filtered AS (SELECT * FROM customer_demographics) SELECT c_customer_id AS customer_id, COALESCE(c_last_name, '') || ', ' || COALESCE(c_first_name, '') AS customername FROM customer JOIN ca_filtered ON c_current_addr_sk = ca_address_sk JOIN cd_filtered ON cd_demo_sk = c_current_cdemo_sk JOIN hd_filtered ON hd_demo_sk = c_current_hdemo_sk JOIN ib_filtered ON ib_income_band_sk = hd_income_band_sk JOIN store_returns ON sr_cdemo_sk = cd_demo_sk ORDER BY c_customer_id LIMIT 100"
        }
      ]
    }
  }
]