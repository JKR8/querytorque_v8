{
  "probe_id": "p12",
  "transform_id": "early_filter",
  "family": "A",
  "status": "success",
  "dialect": "postgres",
  "hypothesis": "Introducing CTEs for small, filtered dimension tables can enable earlier filtering and reduce the row count entering the large customer scan, while preserving the original comma-join syntax for join-order flexibility.",
  "reasoning_trace": [
    "Assigned transform targets early filtering of dimension tables to reduce large customer scan.",
    "CTEs for `customer_address`, `income_band`, `household_demographics`, and `customer_demographics` allow pre-filtering while maintaining original comma-join FROM clause.",
    "PostgreSQL optimizer may push predicates through CTE boundaries when referenced early, reducing customer scan rows."
  ],
  "target_ir": "Dimension tables are filtered into CTEs; main query retains comma joins but references CTEs for early filtering.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": [],
        "outputs": ["customer_id", "customername"],
        "changed": true,
        "sql": "WITH ca_filtered AS (\n  SELECT *\n  FROM customer_address\n  WHERE ca_city = 'Jackson'\n),\nib_filtered AS (\n  SELECT *\n  FROM income_band\n  WHERE ib_lower_bound >= 23567 AND ib_upper_bound <= 23567 + 50000\n),\nhd_filtered AS (\n  SELECT *\n  FROM household_demographics\n),\ncd_filtered AS (\n  SELECT *\n  FROM customer_demographics\n)\nSELECT c_customer_id AS customer_id,\n       COALESCE(c_last_name, '') || ', ' || COALESCE(c_first_name, '') AS customername\nFROM customer,\n     ca_filtered,\n     cd_filtered,\n     hd_filtered,\n     ib_filtered,\n     store_returns\nWHERE c_current_addr_sk = ca_address_sk\n  AND ib_income_band_sk = hd_income_band_sk\n  AND cd_demo_sk = c_current_cdemo_sk\n  AND hd_demo_sk = c_current_hdemo_sk\n  AND sr_cdemo_sk = cd_demo_sk\nORDER BY c_customer_id\nLIMIT 100"
      }
    ]
  }
}