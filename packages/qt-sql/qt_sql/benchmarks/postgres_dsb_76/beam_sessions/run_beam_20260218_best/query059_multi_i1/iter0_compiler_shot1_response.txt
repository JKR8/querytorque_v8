```json
{
  "plan_id": "compile_p1",
  "dialect": "postgres",
  "confidence": 0.84,
  "based_on": "p01",
  "strategy": "Push date-range filters directly into separate CTEs to eliminate full store_sales scan.",
  "hypothesis": "WIN probe p01 reduced runtime by 1.36x by scanning store_sales only for the required date ranges (d_month_seq 1187‑1198 and 1199‑1210) instead of the full table, addressing the primary hotspot. Residual gaps: comma‑joins remain but explicit‑join rewrites regressed in other probes.",
  "expected_explain_delta": "CTE scans wss and wss_1 replaced by wss_y and wss_x with filtered store_sales scans; Hash Join rows reduced.",
  "target_ir": "Replace single wss CTE with two date‑filtered CTEs wss_y and wss_x, update final_select to reference them.",
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["wss_y", "wss_x", "store", "date_dim"],
        "outputs": ["s_store_name1", "s_store_id1", "d_week_seq1", "sun_sales1/sun_sales2", "mon_sales1/mon_sales2", "tue_sales1/tue_sales2", "wed_sales1/wed_sales2", "thu_sales1/thu_sales2", "fri_sales1/fri_sales2", "sat_sales1/sat_sales2"],
        "changed": true,
        "sql": "SELECT s_store_name1,s_store_id1,d_week_seq1,sun_sales1/sun_sales2,mon_sales1/mon_sales2,tue_sales1/tue_sales2,wed_sales1/wed_sales2,thu_sales1/thu_sales2,fri_sales1/fri_sales2,sat_sales1/sat_sales2 FROM (SELECT s_store_name s_store_name1,wss_y.d_week_seq d_week_seq1,s_store_id s_store_id1,sun_sales sun_sales1,mon_sales mon_sales1,tue_sales tue_sales1,wed_sales wed_sales1,thu_sales thu_sales1,fri_sales fri_sales1,sat_sales sat_sales1 FROM wss_y,store,date_dim d WHERE d.d_week_seq = wss_y.d_week_seq AND ss_store_sk = s_store_sk AND d_month_seq BETWEEN 1187 AND 1187 + 11 AND s_state IN ('AR','CO','IA','IL','NC','NY','PA','TX')) y, (SELECT s_store_name s_store_name2,wss_x.d_week_seq d_week_seq2,s_store_id s_store_id2,sun_sales sun_sales2,mon_sales mon_sales2,tue_sales tue_sales2,wed_sales wed_sales2,thu_sales thu_sales2,fri_sales fri_sales2,sat_sales sat_sales2 FROM wss_x,store,date_dim d WHERE d.d_week_seq = wss_x.d_week_seq AND ss_store_sk = s_store_sk AND d_month_seq BETWEEN 1187 + 12 AND 1187 + 23 AND s_state IN ('AR','CO','IA','IL','NC','NY','PA','TX')) x WHERE s_store_id1=s_store_id2 AND d_week_seq1=d_week_seq2-52 ORDER BY s_store_name1,s_store_id1,d_week_seq1 LIMIT 100"
      },
      {
        "node_id": "wss_y",
        "parent_node_id": "final_select",
        "sources": ["store_sales", "date_dim"],
        "outputs": ["d_week_seq", "ss_store_sk", "sun_sales", "mon_sales", "tue_sales", "wed_sales", "thu_sales", "fri_sales", "sat_sales"],
        "changed": true,
        "sql": "SELECT d_week_seq, ss_store_sk, SUM(CASE WHEN (d_day_name='Sunday') THEN ss_sales_price ELSE NULL END) sun_sales, SUM(CASE WHEN (d_day_name='Monday') THEN ss_sales_price ELSE NULL END) mon_sales, SUM(CASE WHEN (d_day_name='Tuesday') THEN ss_sales_price ELSE NULL END) tue_sales, SUM(CASE WHEN (d_day_name='Wednesday') THEN ss_sales_price ELSE NULL END) wed_sales, SUM(CASE WHEN (d_day_name='Thursday') THEN ss_sales_price ELSE NULL END) thu_sales, SUM(CASE WHEN (d_day_name='Friday') THEN ss_sales_price ELSE NULL END) fri_sales, SUM(CASE WHEN (d_day_name='Saturday') THEN ss_sales_price ELSE NULL END) sat_sales FROM store_sales, date_dim WHERE d_date_sk = ss_sold_date_sk AND ss_sales_price / ss_list_price BETWEEN 57 * 0.01 AND 77 * 0.01 AND d_month_seq BETWEEN 1187 AND 1187 + 11 GROUP BY d_week_seq, ss_store_sk"
      },
      {
        "node_id": "wss_x",
        "parent_node_id": "final_select",
        "sources": ["store_sales", "date_dim"],
        "outputs": ["d_week_seq", "ss_store_sk", "sun_sales", "mon_sales", "tue_sales", "wed_sales", "thu_sales", "fri_sales", "sat_sales"],
        "changed": true,
        "sql": "SELECT d_week_seq, ss_store_sk, SUM(CASE WHEN (d_day_name='Sunday') THEN ss_sales_price ELSE NULL END) sun_sales, SUM(CASE WHEN (d_day_name='Monday') THEN ss_sales_price ELSE NULL END) mon_sales, SUM(CASE WHEN (d_day_name='Tuesday') THEN ss_sales_price ELSE NULL END) tue_sales, SUM(CASE WHEN (d_day_name='Wednesday') THEN ss_sales_price ELSE NULL END) wed_sales, SUM(CASE WHEN (d_day_name='Thursday') THEN ss_sales_price ELSE NULL END) thu_sales, SUM(CASE WHEN (d_day_name='Friday') THEN ss_sales_price ELSE NULL END) fri_sales, SUM(CASE WHEN (d_day_name='Saturday') THEN ss_sales_price ELSE NULL END) sat_sales FROM store_sales, date_dim WHERE d_date_sk = ss_sold_date_sk AND ss_sales_price / ss_list_price BETWEEN 57 * 0.01 AND 77 * 0.01 AND d_month_seq BETWEEN 1187 + 12 AND 1187 + 23 GROUP BY d_week_seq, ss_store_sk"
      }
    ]
  }
}
```