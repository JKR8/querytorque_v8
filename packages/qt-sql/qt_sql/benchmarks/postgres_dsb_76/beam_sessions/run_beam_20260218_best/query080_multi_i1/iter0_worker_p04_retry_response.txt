{
  "probe_id": "p04",
  "transform_id": "inner_join_conversion",
  "family": "F",
  "status": "failed",
  "failure_reason": "Row count mismatch after INNER JOIN conversion indicates semantic drift. LEFT JOINs were preserving fact rows without matching returns, which INNER JOINs removed, changing result cardinality.",
  "partial_work": {
    "attempted_approach": "Convert LEFT JOINs to INNER JOINs in ssr, csr, and wsr CTEs to reduce nested loop overhead",
    "blocking_issue": "INNER JOINs eliminated fact rows with no matching returns, violating output cardinality contract",
    "hypothesis_still_valid": false
  },
  "dialect": "postgres",
  "hypothesis": "INNER JOIN conversion unsafe due to cardinality dependency on unmatched fact rows. LEFT JOINs are required to preserve all fact rows regardless of return existence.",
  "reasoning_trace": [
    "LEFT JOINs in original query preserve all fact rows (store_sales, catalog_sales, web_sales) even when no matching return row exists.",
    "INNER JOINs remove fact rows with no return matches, which changes the aggregation base and reduces final row count.",
    "Profit calculation uses COALESCE to treat missing returns as zero, not to filter them out â€” confirming LEFT JOIN semantics are required."
  ],
  "target_ir": "No structural change.",
  "verification": {
    "executable": false,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": false,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["wsr", "ssr", "csr"],
        "outputs": ["channel", "id", "sales", "returns", "profit"],
        "changed": false
      },
      {
        "node_id": "ssr",
        "parent_node_id": "final_select",
        "sources": ["store_sales", "store_returns", "date_dim", "store", "item", "promotion"],
        "outputs": ["store_id", "sales", "returns", "profit"],
        "changed": false
      },
      {
        "node_id": "csr",
        "parent_node_id": "final_select",
        "sources": ["catalog_sales", "catalog_returns", "date_dim", "catalog_page", "item", "promotion"],
        "outputs": ["catalog_page_id", "sales", "returns", "profit"],
        "changed": false
      },
      {
        "node_id": "wsr",
        "parent_node_id": "final_select",
        "sources": ["web_sales", "web_returns", "date_dim", "web_site", "item", "promotion"],
        "outputs": ["web_site_id", "sales", "returns", "profit"],
        "changed": false
      }
    ]
  }
}