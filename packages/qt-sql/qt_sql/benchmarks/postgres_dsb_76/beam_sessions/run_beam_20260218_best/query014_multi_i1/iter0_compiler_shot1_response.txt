[
  {
    "plan_id": "compile_p01",
    "dialect": "postgres",
    "confidence": 0.85,
    "based_on": "p01",
    "strategy": "intersect_to_exists",
    "hypothesis": "Probe p01 validated 4.01x speedup by replacing INTERSECT operations in cross_items with EXISTS, reducing materialization cost and improving cardinality estimates for the final nested loop.",
    "expected_explain_delta": "INTERSECT SetOp replaced by three EXISTS semi‑joins; cross_items CTE scan time reduced from 7s to ~1s; final nested‑loop cardinality estimates improve.",
    "target_ir": "Replace cross_items CTE definition; keep avg_sales and final_select unchanged.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["store_sales", "item", "date_dim", "avg_sales", "cross_items"],
          "outputs": ["ty_channel", "ty_brand", "ty_class", "ty_category", "ty_sales", "ty_number_sales", "ly_channel", "ly_brand", "ly_class", "ly_category", "ly_sales", "ly_number_sales"],
          "changed": false
        },
        {
          "node_id": "avg_sales",
          "parent_node_id": "final_select",
          "sources": ["web_sales", "date_dim", "store_sales", "catalog_sales"],
          "outputs": ["average_sales"],
          "changed": false
        },
        {
          "node_id": "cross_items",
          "parent_node_id": "final_select",
          "sources": ["item", "web_sales", "date_dim", "store_sales", "catalog_sales"],
          "outputs": ["ss_item_sk"],
          "changed": true,
          "sql": "SELECT i_item_sk AS ss_item_sk FROM item WHERE i_category IN ('Electronics', 'Jewelry', 'Men') AND i_manager_id BETWEEN 91 AND 100 AND EXISTS (SELECT 1 FROM store_sales iss JOIN item iss_item ON iss.ss_item_sk = iss_item.i_item_sk JOIN date_dim d1 ON iss.ss_sold_date_sk = d1.d_date_sk WHERE iss_item.i_item_sk = item.i_item_sk AND d1.d_year BETWEEN 1999 AND 1999 + 2 AND iss_item.i_category IN ('Electronics', 'Jewelry', 'Men') AND iss_item.i_manager_id BETWEEN 91 AND 100 AND iss.ss_wholesale_cost BETWEEN 35 AND 55) AND EXISTS (SELECT 1 FROM catalog_sales ics JOIN item ics_item ON ics.cs_item_sk = ics_item.i_item_sk JOIN date_dim d2 ON ics.cs_sold_date_sk = d2.d_date_sk WHERE ics_item.i_item_sk = item.i_item_sk AND d2.d_year BETWEEN 1999 AND 1999 + 2 AND ics_item.i_category IN ('Electronics', 'Jewelry', 'Men') AND ics_item.i_manager_id BETWEEN 91 AND 100 AND ics.cs_wholesale_cost BETWEEN 35 AND 55) AND EXISTS (SELECT 1 FROM web_sales iws JOIN item iws_item ON iws.ws_item_sk = iws_item.i_item_sk JOIN date_dim d3 ON iws.ws_sold_date_sk = d3.d_date_sk WHERE iws_item.i_item_sk = item.i_item_sk AND d3.d_year BETWEEN 1999 AND 1999 + 2 AND iws_item.i_category IN ('Electronics', 'Jewelry', 'Men') AND iws_item.i_manager_id BETWEEN 91 AND 100 AND iws.ws_wholesale_cost BETWEEN 35 AND 55)"
        }
      ]
    }
  }
]