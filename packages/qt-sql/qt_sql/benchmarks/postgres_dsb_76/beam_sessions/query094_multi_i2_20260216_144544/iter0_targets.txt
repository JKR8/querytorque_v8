[
  {
    "target_id": "t1",
    "family": "B",
    "transform": "decorrelate_exists",
    "relevance_score": 0.98,
    "hypothesis": "Correlated EXISTS subquery forces nested loop over web_sales (1185 iterations). Precomputing multi-warehouse orders as a set eliminates per-row rescans.",
    "target_ir": "S0 [SELECT]\n  CTE: multi_warehouse_orders  (via Q1)\n    FROM: web_sales\n    GROUP BY: ws_order_number\n    HAVING: COUNT(DISTINCT ws_warehouse_sk) > 1\n  MAIN QUERY (via Q0)\n    FROM: web_sales ws1\n      INNER JOIN date_dim ON ws1.ws_ship_date_sk = d_date_sk\n      INNER JOIN customer_address ON ws1.ws_ship_addr_sk = ca_address_sk\n      INNER JOIN web_site ON ws1.ws_web_site_sk = web_site_sk\n      INNER JOIN multi_warehouse_orders m ON ws1.ws_order_number = m.ws_order_number\n    WHERE: d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY'\n      AND ca_state IN ('MO','MT','OK','SC','TX','WI')\n      AND web_gmt_offset >= -5\n      AND ws1.ws_list_price BETWEEN 253 AND 282\n      AND NOT EXISTS (SELECT * FROM web_returns wr1 WHERE ws1.ws_order_number = wr1.wr_order_number AND wr1.wr_reason_sk IN (8,18,20,23,41))\n    ORDER BY: COUNT(DISTINCT ws_order_number)",
    "recommended_examples": [
      "pg_shared_scan_decorrelate"
    ]
  },
  {
    "target_id": "t2",
    "family": "E",
    "transform": "prefilter_materialize",
    "relevance_score": 0.65,
    "hypothesis": "Repeated web_sales scans (main query + decorrelation CTE) can share a materialized prefiltered version. Date/list_price filters reduce base dataset.",
    "target_ir": "S0 [SELECT]\n  CTE: prefiltered_sales  (via Q1)\n    FROM: web_sales\n      INNER JOIN date_dim ON ws_ship_date_sk = d_date_sk\n    WHERE: d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY'\n      AND ws_list_price BETWEEN 253 AND 282\n  CTE: multi_warehouse_orders  (via Q2)\n    FROM: prefiltered_sales\n    GROUP BY: ws_order_number\n    HAVING: COUNT(DISTINCT ws_warehouse_sk) > 1\n  MAIN QUERY (via Q0)\n    FROM: prefiltered_sales ws1\n      INNER JOIN customer_address ON ws1.ws_ship_addr_sk = ca_address_sk\n      INNER JOIN web_site ON ws1.ws_web_site_sk = web_site_sk\n      INNER JOIN multi_warehouse_orders m ON ws1.ws_order_number = m.ws_order_number\n    WHERE: ca_state IN ('MO','MT','OK','SC','TX','WI')\n      AND web_gmt_offset >= -5\n      AND NOT EXISTS (SELECT * FROM web_returns wr1 WHERE ws1.ws_order_number = wr1.wr_order_number AND wr1.wr_reason_sk IN (8,18,20,23,41))\n    ORDER BY: COUNT(DISTINCT ws_order_number)",
    "recommended_examples": [
      "multi_dimension_prefetch"
    ]
  },
  {
    "target_id": "t3",
    "family": "F",
    "transform": "explicit_join_syntax",
    "relevance_score": 0.5,
    "hypothesis": "Implicit comma joins hinder predicate pushdown clarity. Explicit INNER JOIN syntax improves optimizer control.",
    "target_ir": "S0 [SELECT]\n  MAIN QUERY (via Q0)\n    FROM: web_sales ws1\n      INNER JOIN date_dim ON ws1.ws_ship_date_sk = d_date_sk\n      INNER JOIN customer_address ON ws1.ws_ship_addr_sk = ca_address_sk\n      INNER JOIN web_site ON ws1.ws_web_site_sk = web_site_sk\n    WHERE: d_date BETWEEN '1999-10-01' AND CAST('1999-10-01' AS DATE) + INTERVAL '60 DAY'\n      AND ca_state IN ('MO','MT','OK','SC','TX','WI')\n      AND web_gmt_offset >= -5\n      AND ws1.ws_list_price BETWEEN 253 AND 282\n      AND EXISTS (SELECT * FROM web_sales ws2 WHERE ws1.ws_order_number = ws2.ws_order_number AND ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk)\n      AND NOT EXISTS (SELECT * FROM web_returns wr1 WHERE ws1.ws_order_number = wr1.wr_order_number AND wr1.wr_reason_sk IN (8,18,20,23,41))\n    ORDER BY: COUNT(DISTINCT ws_order_number)",
    "recommended_examples": [
      "pg_explicit_join_materialized"
    ]
  }
]