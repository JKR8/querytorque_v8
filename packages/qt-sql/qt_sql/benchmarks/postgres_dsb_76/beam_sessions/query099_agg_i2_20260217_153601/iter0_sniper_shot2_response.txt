[
  {
    "plan_id": "snipe_p1",
    "dialect": "postgres",
    "confidence": 0.80,
    "based_on": "original",
    "strategy": "Explicit joins and pre-join fact-date with filters",
    "hypothesis": "Nested Loop between date_dim and catalog_sales dominates execution (170s). Pre-joining and filtering in CTE reduces rows before joining dimensions. Explicit JOINs improve cardinality estimates.",
    "target_ir": "CTE for prejoined_fact, explicit JOINs with dimensions, simplified WHERE",
    "steps": [
      {
        "step_id": "s1",
        "op": "insert_cte",
        "target": {"by_node_id": "S0"},
        "payload": {
          "cte_name": "prejoined_fact",
          "cte_query_sql": "SELECT cs_ship_date_sk, cs_sold_date_sk, cs_warehouse_sk, cs_ship_mode_sk, cs_call_center_sk FROM catalog_sales JOIN date_dim ON cs_ship_date_sk = d_date_sk WHERE d_month_seq BETWEEN 1191 AND 1191 + 23 AND cs_list_price BETWEEN 244 AND 273"
        }
      },
      {
        "step_id": "s2",
        "op": "replace_from",
        "target": {"by_node_id": "S0"},
        "payload": {
          "from_sql": "prejoined_fact AS pf JOIN warehouse ON pf.cs_warehouse_sk = warehouse.w_warehouse_sk JOIN ship_mode ON pf.cs_ship_mode_sk = ship_mode.sm_ship_mode_sk JOIN call_center ON pf.cs_call_center_sk = call_center.cc_call_center_sk"
        }
      },
      {
        "step_id": "s3",
        "op": "replace_where_predicate",
        "target": {"by_node_id": "S0"},
        "payload": {
          "predicate_sql": "sm_type = 'LIBRARY' AND cc_class = 'medium' AND w_gmt_offset = -5"
        }
      }
    ]
  },
  {
    "plan_id": "snipe_p2",
    "dialect": "postgres",
    "confidence": 0.70,
    "based_on": "original",
    "strategy": "Explicit joins with early fact filtering",
    "hypothesis": "Pushing list_price filter into CTE reduces fact table early while explicit JOINs address comma-join weakness. Retains date_dim join flexibility.",
    "target_ir": "CTE for filtered fact, explicit JOINs with all tables, retained date filter",
    "steps": [
      {
        "step_id": "s1",
        "op": "insert_cte",
        "target": {"by_node_id": "S0"},
        "payload": {
          "cte_name": "filtered_cs",
          "cte_query_sql": "SELECT * FROM catalog_sales WHERE cs_list_price BETWEEN 244 AND 273"
        }
      },
      {
        "step_id": "s2",
        "op": "replace_from",
        "target": {"by_node_id": "S0"},
        "payload": {
          "from_sql": "filtered_cs AS cs JOIN date_dim ON cs.cs_ship_date_sk = date_dim.d_date_sk JOIN warehouse ON cs.cs_warehouse_sk = warehouse.w_warehouse_sk JOIN ship_mode ON cs.cs_ship_mode_sk = ship_mode.sm_ship_mode_sk JOIN call_center ON cs.cs_call_center_sk = call_center.cc_call_center_sk"
        }
      },
      {
        "step_id": "s3",
        "op": "replace_where_predicate",
        "target": {"by_node_id": "S0"},
        "payload": {
          "predicate_sql": "d_month_seq BETWEEN 1191 AND 1191 + 23 AND sm_type = 'LIBRARY' AND cc_class = 'medium' AND w_gmt_offset = -5"
        }
      }
    ]
  }
]