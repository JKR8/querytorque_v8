{
  "iteration": 0,
  "n_api_calls": 17,
  "beam_cost_usd": 0.08688133,
  "beam_cost_priced_calls": 17,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 97077,
    "completion_tokens": 27824,
    "total_tokens": 124901,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 28224
  },
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "p11",
      "family": "F",
      "transform": "inner_join_conversion",
      "relevance_score": 0.95,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales INNER JOIN item ON ss_item_sk = i_item_sk INNER JOIN web_sales ON ws_item_sk = ss_item_sk INNER JOIN date_dim AS d1 ON ss_sold_date_sk = d1.d_date_sk INNER JOIN date_dim AS d2 ON ws_sold_date_sk = d2.d_date_sk INNER JOIN customer ON ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk INNER JOIN inventory ON inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity INNER JOIN store ON s_state = w_state INNER JOIN warehouse ON ws_warehouse_sk = w_warehouse_sk AND inv_warehouse_sk = w_warehouse_sk INNER JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk INNER JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk INNER JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ss_item_sk = i_item_sk AND ws_item_sk = ss_item_sk AND ss_sold_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk AND ws_warehouse_sk = inv_warehouse_sk AND ws_warehouse_sk = w_warehouse_sk AND inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity AND s_state = w_state AND i_category IN ('Men', 'Shoes', 'Sports') AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98) AND c_current_cdemo_sk = cd_demo_sk AND c_current_hdemo_sk = hd_demo_sk AND c_current_addr_sk = ca_address_sk AND ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA') AND d1.d_year = 1998 AND ws_wholesale_cost BETWEEN 76 AND 96 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Convert all comma joins to explicit INNER JOIN syntax with ON conditions"
    },
    {
      "patch_id": "p04",
      "family": "F",
      "transform": "materialized_dimension_fact_prefilter",
      "relevance_score": 0.8,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_items AS (SELECT i_item_sk FROM item WHERE i_category IN ('Men', 'Shoes', 'Sports') AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98)), filtered_inventory AS (SELECT inv_item_sk, inv_warehouse_sk, inv_date_sk FROM inventory WHERE inv_quantity_on_hand >= 0) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales JOIN filtered_items AS fi ON ss_item_sk = fi.i_item_sk JOIN filtered_inventory AS finv ON finv.inv_item_sk = ss_item_sk AND finv.inv_warehouse_sk = ss_warehouse_sk AND finv.inv_date_sk = ss_sold_date_sk WHERE ss_item_sk = i_item_sk AND ws_item_sk = ss_item_sk AND ss_sold_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk AND ws_warehouse_sk = inv_warehouse_sk AND ws_warehouse_sk = w_warehouse_sk AND inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity AND s_state = w_state AND i_category IN ('Men', 'Shoes', 'Sports') AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98) AND c_current_cdemo_sk = cd_demo_sk AND c_current_hdemo_sk = hd_demo_sk AND c_current_addr_sk = ca_address_sk AND ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA') AND d1.d_year = 1998 AND ws_wholesale_cost BETWEEN 76 AND 96 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Materialize filtered item (i_manager_id IN(...)) and inventory (inv_quantity_on_hand >= ss_quantity) as CTEs before sales join"
    },
    {
      "patch_id": "p08",
      "family": "A",
      "transform": "early_filter",
      "relevance_score": 0.85,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_item AS (SELECT i_item_sk FROM item WHERE i_category IN ('Men', 'Shoes', 'Sports') AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98)) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales, web_sales, date_dim AS d1, date_dim AS d2, customer, inventory, store, warehouse, item, customer_demographics, household_demographics, customer_address WHERE ss_item_sk = filtered_item.i_item_sk AND ws_item_sk = ss_item_sk AND ss_sold_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk AND ws_warehouse_sk = inv_warehouse_sk AND ws_warehouse_sk = w_warehouse_sk AND inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity AND s_state = w_state AND c_current_cdemo_sk = cd_demo_sk AND c_current_hdemo_sk = hd_demo_sk AND c_current_addr_sk = ca_address_sk AND ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA') AND d1.d_year = 1998 AND ws_wholesale_cost BETWEEN 76 AND 96 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Push i_category and i_manager_id filters directly into item CTE definition"
    },
    {
      "patch_id": "p12",
      "family": "E",
      "transform": "materialize_cte",
      "relevance_score": 0.75,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_inventory AS (SELECT inv_item_sk, inv_warehouse_sk, inv_date_sk FROM inventory WHERE inv_quantity_on_hand >= ss_quantity) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales, web_sales, date_dim AS d1, date_dim AS d2, customer, filtered_inventory AS inv, store, warehouse, item, customer_demographics, household_demographics, customer_address WHERE ss_item_sk = i_item_sk AND ws_item_sk = ss_item_sk AND ss_sold_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk AND ws_warehouse_sk = inv_warehouse_sk AND ws_warehouse_sk = w_warehouse_sk AND inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND s_state = w_state AND i_category IN ('Men', 'Shoes', 'Sports') AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98) AND c_current_cdemo_sk = cd_demo_sk AND c_current_hdemo_sk = hd_demo_sk AND c_current_addr_sk = ca_address_sk AND ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA') AND d1.d_year = 1998 AND ws_wholesale_cost BETWEEN 76 AND 96 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Materialize filtered inventory (inv_quantity_on_hand >= ss_quantity) as CTE before sales join"
    },
    {
      "patch_id": "p03",
      "family": "B",
      "transform": "inline_decorrelate_materialized",
      "relevance_score": 0.85,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_customer_dims AS (SELECT c_customer_sk FROM customer JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA')) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales, web_sales, date_dim AS d1, date_dim AS d2, inventory, store, warehouse, item, filtered_customer_dims AS fc, household_demographics, customer_address WHERE ss_item_sk = i_item_sk AND ws_item_sk = ss_item_sk AND ss_sold_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ss_customer_sk = fc.c_customer_sk AND ws_bill_customer_sk = fc.c_customer_sk AND ws_warehouse_sk = inv_warehouse_sk AND ws_warehouse_sk = w_warehouse_sk AND inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity AND s_state = w_state AND i_category IN ('Men', 'Shoes', 'Sports') AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98) AND d1.d_year = 1998 AND ws_wholesale_cost BETWEEN 76 AND 96 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Create MATERIALIZED CTE for pre-joined customer+demographics+address with filters applied before sales join"
    },
    {
      "patch_id": "p07",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.9,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date_dim AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 1998) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales JOIN web_sales ON ss_item_sk = ws_item_sk AND ss_sold_date_sk = ws_sold_date_sk JOIN filtered_date_dim AS d1 ON ss_sold_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') JOIN customer ON ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk JOIN inventory ON inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_warehouse_sk = ws_warehouse_sk JOIN store ON s_state = w_state JOIN warehouse AS w ON ws_warehouse_sk = w_warehouse_sk JOIN item AS i ON ss_item_sk = i_item_sk JOIN customer_demographics AS cd ON c_current_cdemo_sk = cd_demo_sk JOIN household_demographics AS hd ON c_current_hdemo_sk = hd_demo_sk JOIN customer_address AS ca ON c_current_addr_sk = ca_address_sk WHERE inv_quantity_on_hand >= ss_quantity AND i_category IN ('Men', 'Shoes', 'Sports') AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98) AND ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA') AND ws_wholesale_cost BETWEEN 76 AND 96 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Materialize date_dim d1 filter (d_year=1998) as CTE, convert d2 BETWEEN to explicit JOIN condition"
    },
    {
      "patch_id": "p02",
      "family": "E",
      "transform": "pg_self_join_decomposition",
      "relevance_score": 0.88,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH date_dim_d1 AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 1998), date_dim_d2 AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN '1998-01-01' AND '1998-12-31') SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales JOIN web_sales ON ss_item_sk = ws_item_sk JOIN date_dim_d1 AS d1 ON ss_sold_date_sk = d1.d_date_sk JOIN date_dim_d2 AS d2 ON ws_sold_date_sk = d2.d_date_sk JOIN customer ON ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk JOIN inventory ON inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity JOIN store ON s_state = w_state JOIN warehouse ON ws_warehouse_sk = w_warehouse_sk AND ws_warehouse_sk = inv_warehouse_sk JOIN item ON ss_item_sk = i_item_sk JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND i_category IN ('Men', 'Shoes', 'Sports') AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98) AND ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA') AND ws_wholesale_cost BETWEEN 76 AND 96 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Materialize filtered date_dim d1 (d_year=1998) and d2 (d2 BETWEEN condition) as separate CTEs before joining with sales"
    },
    {
      "patch_id": "p01",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.92,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date_dim_d1 AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998), filtered_item AS (SELECT i_item_sk FROM item WHERE i_category IN ('Men', 'Shoes', 'Sports') AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98)), filtered_customer_address AS (SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA')) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales AS ss JOIN web_sales AS ws ON ss.ss_item_sk = ws.ws_item_sk JOIN filtered_date_dim_d1 AS d1 ON ss.ss_sold_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk AND ws.ws_bill_customer_sk = c.c_customer_sk JOIN inventory AS inv ON inv.inv_item_sk = ss.ss_item_sk AND inv.inv_date_sk = ss.ss_sold_date_sk AND inv.inv_quantity_on_hand >= ss.ss_quantity JOIN store AS s ON s.s_state = w.w_state JOIN warehouse AS w ON ws.ws_warehouse_sk = w.w_warehouse_sk AND ws.ws_warehouse_sk = inv.inv_warehouse_sk JOIN filtered_item AS i ON ss.ss_item_sk = i.i_item_sk JOIN customer_demographics AS cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN filtered_customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ss_item_sk = i_item_sk AND ws_item_sk = ss_item_sk AND ss_sold_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk AND ws_warehouse_sk = inv_warehouse_sk AND ws_warehouse_sk = w_warehouse_sk AND inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity AND s_state = w_state AND i_category IN ('Men', 'Shoes', 'Sports') AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98) AND c_current_cdemo_sk = cd_demo_sk AND c_current_hdemo_sk = hd_demo_sk AND c_current_addr_sk = ca_address_sk AND ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA') AND d1.d_year = 1998 AND ws_wholesale_cost BETWEEN 76 AND 96 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Convert comma joins to explicit INNER JOINs. Pre-filter selective dimensions (date_dim d1, item, customer_address) into CTEs with MATERIALIZED keyword"
    },
    {
      "patch_id": "p09",
      "family": "A",
      "transform": "prefetch_fact_join",
      "relevance_score": 0.55,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_store_sales AS (SELECT ss_item_sk, ss_customer_sk, ss_sold_date_sk, ss_quantity, ss_wholesale_cost FROM store_sales WHERE ss_wholesale_cost BETWEEN 76 AND 96 AND ss_item_sk IN (SELECT i_item_sk FROM item WHERE i_category IN ('Men', 'Shoes', 'Sports') AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98))) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM filtered_store_sales AS ss JOIN web_sales AS ws ON ss.ss_item_sk = ws.ws_item_sk JOIN date_dim AS d1 ON ss.ss_sold_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk AND ws.ws_bill_customer_sk = c.c_customer_sk JOIN inventory AS inv ON inv.inv_item_sk = ss.ss_item_sk AND inv.inv_date_sk = ss.ss_sold_date_sk AND inv.inv_quantity_on_hand >= ss.ss_quantity JOIN store AS s ON s.s_state = w.w_state JOIN warehouse AS w ON ws.ws_warehouse_sk = w.w_warehouse_sk AND ws.ws_warehouse_sk = inv.inv_warehouse_sk JOIN customer_demographics AS cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ss_item_sk = i_item_sk AND ws_item_sk = ss_item_sk AND ss_sold_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk AND ws_warehouse_sk = inv_warehouse_sk AND ws_warehouse_sk = w_warehouse_sk AND inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity AND s_state = w_state AND i_category IN ('Men', 'Shoes', 'Sports') AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98) AND c_current_cdemo_sk = cd_demo_sk AND c_current_hdemo_sk = hd_demo_sk AND c_current_addr_sk = ca_address_sk AND ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA') AND d1.d_year = 1998 AND ws_wholesale_cost BETWEEN 76 AND 96 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Stage joins: 1) Filter dimensions \u2192 2) Join with store_sales \u2192 3) Join with web_sales"
    },
    {
      "patch_id": "p05",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.65,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: COLUMN REF MISMATCH: Original columns missing from rewrite \u2014 ['inv_warehouse_sk']. The rewrite references different table columns.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH ss_agg AS (SELECT ss_item_sk, ss_customer_sk, ss_sold_date_sk, SUM(ss_quantity) AS total_ss_quantity FROM store_sales GROUP BY ss_item_sk, ss_customer_sk, ss_sold_date_sk), ws_agg AS (SELECT ws_item_sk, ws_bill_customer_sk, ws_sold_date_sk, SUM(ws_quantity) AS total_ws_quantity FROM web_sales GROUP BY ws_item_sk, ws_bill_customer_sk, ws_sold_date_sk) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM ss_agg AS sa JOIN ws_agg AS wa ON sa.ss_item_sk = wa.ws_item_sk AND sa.ss_customer_sk = wa.ws_bill_customer_sk AND sa.ss_sold_date_sk = wa.ws_sold_date_sk JOIN date_dim AS d1 ON sa.ss_sold_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON wa.ws_sold_date_sk = d2.d_date_sk JOIN customer AS c ON sa.ss_customer_sk = c.c_customer_sk JOIN item AS i ON sa.ss_item_sk = i.i_item_sk JOIN inventory AS inv ON sa.ss_item_sk = inv.inv_item_sk AND sa.ss_sold_date_sk = inv.inv_date_sk JOIN store AS s ON s.s_state = w.w_state JOIN warehouse AS w ON wa.ws_warehouse_sk = w.w_warehouse_sk JOIN customer_demographics AS cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND i_category IN ('Men', 'Shoes', 'Sports') AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98) AND ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA') AND d1.d_year = 1998 AND wa.ws_wholesale_cost BETWEEN 76 AND 96 AND inv.inv_quantity_on_hand >= sa.total_ss_quantity GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Pre-aggregate store_sales/web_sales by item/customer/date keys before joining dimensions"
    },
    {
      "patch_id": "p10",
      "family": "A",
      "transform": "sf_sk_pushdown_multi_fact",
      "relevance_score": 0.5,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998), ss_filtered AS (SELECT * FROM store_sales WHERE ss_sold_date_sk IN (SELECT d_date_sk FROM filtered_dates)), ws_filtered AS (SELECT * FROM web_sales WHERE ws_sold_date_sk IN (SELECT d_date_sk FROM filtered_dates)) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM ss_filtered AS ss, ws_filtered AS ws, date_dim AS d1, date_dim AS d2, customer, inventory, store, warehouse, item, customer_demographics, household_demographics, customer_address WHERE ss.ss_item_sk = i_item_sk AND ws.ws_item_sk = ss.ss_item_sk AND ss.ss_sold_date_sk = d1.d_date_sk AND ws.ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ss.ss_customer_sk = c_customer_sk AND ws.ws_bill_customer_sk = c_customer_sk AND ws.ws_warehouse_sk = inv_warehouse_sk AND ws.ws_warehouse_sk = w_warehouse_sk AND inv_item_sk = ss.ss_item_sk AND inv_date_sk = ss.ss_sold_date_sk AND inv_quantity_on_hand >= ss.ss_quantity AND s_state = w_state AND i_category IN ('Men', 'Shoes', 'Sports') AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98) AND c_current_cdemo_sk = cd_demo_sk AND c_current_hdemo_sk = hd_demo_sk AND c_current_addr_sk = ca_address_sk AND ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA') AND d1.d_year = 1998 AND ws.ws_wholesale_cost BETWEEN 76 AND 96 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Add d_date_sk range condition to store_sales/web_sales scans via CTE pushdown"
    },
    {
      "patch_id": "p06",
      "family": "A",
      "transform": "multi_dimension_prefetch",
      "relevance_score": 0.6,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998), filtered_items AS (SELECT i_item_sk FROM item WHERE i_category IN ('Men', 'Shoes', 'Sports') AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98)), filtered_customers AS (SELECT c_customer_sk, c_current_cdemo_sk, c_current_hdemo_sk, c_current_addr_sk FROM customer WHERE NOT c_current_addr_sk IS NULL), filtered_addresses AS (SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA')) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales AS ss JOIN web_sales AS ws ON ss.ss_item_sk = ws.ws_item_sk JOIN filtered_dates AS d1 ON ss.ss_sold_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') JOIN filtered_items AS i ON ss.ss_item_sk = i.i_item_sk JOIN filtered_customers AS c ON ss.ss_customer_sk = c.c_customer_sk AND ws.ws_bill_customer_sk = c.c_customer_sk JOIN filtered_addresses AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN inventory AS inv ON inv_item_sk = ss.ss_item_sk AND inv_date_sk = ss.ss_sold_date_sk AND inv_quantity_on_hand >= ss.ss_quantity JOIN store AS s ON s_state = w_state JOIN warehouse AS w ON ws.ws_warehouse_sk = w.w_warehouse_sk WHERE ss.ss_item_sk = i.i_item_sk AND ws.ws_item_sk = ss.ss_item_sk AND ss.ss_sold_date_sk = d1.d_date_sk AND ws.ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ss.ss_customer_sk = c.c_customer_sk AND ws.ws_bill_customer_sk = c.c_customer_sk AND ws.ws_warehouse_sk = inv.inv_warehouse_sk AND ws.ws_warehouse_sk = w.w_warehouse_sk AND inv.inv_item_sk = ss.ss_item_sk AND inv.inv_date_sk = ss.ss_sold_date_sk AND inv.inv_quantity_on_hand >= ss.ss_quantity AND s.s_state = w.w_state AND i.i_category IN ('Men', 'Shoes', 'Sports') AND i.i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98) AND c.c_current_cdemo_sk = cd_demo_sk AND c.c_current_hdemo_sk = hd_demo_sk AND c.c_current_addr_sk = ca.ca_address_sk AND ca.ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA') AND d1.d_year = 1998 AND ws.ws_wholesale_cost BETWEEN 76 AND 96 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Combine all dimension filters (date_dim, item, customer, etc.) into single prefetch CTE before sales joins"
    },
    {
      "patch_id": "snipe_p1",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date_dim AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 1998) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales INNER JOIN item ON ss_item_sk = i_item_sk INNER JOIN web_sales ON ws_item_sk = ss_item_sk INNER JOIN filtered_date_dim AS d1 ON ss_sold_date_sk = d1.d_date_sk INNER JOIN date_dim AS d2 ON ws_sold_date_sk = d2.d_date_sk INNER JOIN customer ON ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk INNER JOIN inventory ON inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity INNER JOIN store ON s_state = w_state INNER JOIN warehouse ON ws_warehouse_sk = w_warehouse_sk AND inv_warehouse_sk = w_warehouse_sk INNER JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk INNER JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk INNER JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND i_category IN ('Men', 'Shoes', 'Sports') AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98) AND ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA') AND ws_wholesale_cost BETWEEN 76 AND 96 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p2",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_customer AS (SELECT c_customer_sk, cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count FROM customer JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA')), filtered_item AS (SELECT i_item_sk FROM item WHERE i_category IN ('Men', 'Shoes', 'Sports') AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98)) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales INNER JOIN filtered_item ON ss_item_sk = i_item_sk INNER JOIN web_sales ON ws_item_sk = ss_item_sk INNER JOIN date_dim AS d1 ON ss_sold_date_sk = d1.d_date_sk INNER JOIN date_dim AS d2 ON ws_sold_date_sk = d2.d_date_sk INNER JOIN filtered_customer ON ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk INNER JOIN inventory ON inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity INNER JOIN store ON s_state = w_state INNER JOIN warehouse ON ws_warehouse_sk = w_warehouse_sk AND inv_warehouse_sk = w_warehouse_sk WHERE d1.d_year = 1998 AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ws_wholesale_cost BETWEEN 76 AND 96 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p1",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: COLUMN REF MISMATCH: Original columns missing from rewrite \u2014 ['inv_warehouse_sk']. The rewrite references different table columns.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date_dim_d1 AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 1998), filtered_item AS (SELECT i_item_sk FROM item WHERE i_category IN ('Men', 'Shoes', 'Sports') AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98)), filtered_customer_address AS (SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA')) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales INNER JOIN web_sales ON store_sales.ss_item_sk = web_sales.ws_item_sk INNER JOIN filtered_date_dim_d1 AS d1 ON store_sales.ss_sold_date_sk = d1.d_date_sk INNER JOIN date_dim AS d2 ON web_sales.ws_sold_date_sk = d2.d_date_sk INNER JOIN customer ON store_sales.ss_customer_sk = customer.c_customer_sk AND web_sales.ws_bill_customer_sk = customer.c_customer_sk INNER JOIN inventory ON inventory.inv_item_sk = store_sales.ss_item_sk AND inventory.inv_date_sk = store_sales.ss_sold_date_sk INNER JOIN store ON store.s_state = warehouse.w_state INNER JOIN warehouse ON web_sales.ws_warehouse_sk = warehouse.w_warehouse_sk INNER JOIN filtered_item AS i ON store_sales.ss_item_sk = i.i_item_sk INNER JOIN customer_demographics ON customer.c_current_cdemo_sk = customer_demographics.cd_demo_sk INNER JOIN household_demographics ON customer.c_current_hdemo_sk = household_demographics.hd_demo_sk INNER JOIN filtered_customer_address AS ca ON customer.c_current_addr_sk = ca.ca_address_sk WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND inventory.inv_quantity_on_hand >= store_sales.ss_quantity AND web_sales.ws_wholesale_cost BETWEEN 76 AND 96 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p2",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: COLUMN REF MISMATCH: Original columns missing from rewrite \u2014 ['inv_warehouse_sk']. The rewrite references different table columns.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_customer_dims AS (SELECT c_customer_sk, cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count FROM customer JOIN customer_demographics ON customer.c_current_cdemo_sk = customer_demographics.cd_demo_sk JOIN household_demographics ON customer.c_current_hdemo_sk = household_demographics.hd_demo_sk JOIN customer_address ON customer.c_current_addr_sk = customer_address.ca_address_sk WHERE customer_address.ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA')), filtered_date_dim_d1 AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 1998) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales INNER JOIN web_sales ON store_sales.ss_item_sk = web_sales.ws_item_sk INNER JOIN filtered_date_dim_d1 AS d1 ON store_sales.ss_sold_date_sk = d1.d_date_sk INNER JOIN date_dim AS d2 ON web_sales.ws_sold_date_sk = d2.d_date_sk INNER JOIN filtered_customer_dims AS c ON store_sales.ss_customer_sk = c.c_customer_sk AND web_sales.ws_bill_customer_sk = c.c_customer_sk INNER JOIN inventory ON inventory.inv_item_sk = store_sales.ss_item_sk AND inventory.inv_date_sk = store_sales.ss_sold_date_sk INNER JOIN store ON store.s_state = warehouse.w_state INNER JOIN warehouse ON web_sales.ws_warehouse_sk = warehouse.w_warehouse_sk INNER JOIN item ON store_sales.ss_item_sk = item.i_item_sk WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND inventory.inv_quantity_on_hand >= store_sales.ss_quantity AND item.i_category IN ('Men', 'Shoes', 'Sports') AND item.i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98) AND web_sales.ws_wholesale_cost BETWEEN 76 AND 96 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": null
    }
  ],
  "explains": {}
}