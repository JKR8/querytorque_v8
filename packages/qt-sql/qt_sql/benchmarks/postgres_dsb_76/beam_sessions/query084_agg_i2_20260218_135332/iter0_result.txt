{
  "iteration": 0,
  "n_api_calls": 10,
  "beam_cost_usd": 0.02985946,
  "beam_cost_priced_calls": 10,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 111812,
    "completion_tokens": 22386,
    "total_tokens": 134198,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 50048,
    "reasoning_tokens": 12748
  },
  "best_speedup": 1.07,
  "best_patch_id": "p03",
  "best_sql": "SELECT c.c_customer_id AS customer_id, COALESCE(c.c_last_name, '') || ', ' || COALESCE(c.c_first_name, '') AS customername FROM customer c INNER JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk INNER JOIN household_demographics hd ON hd.hd_demo_sk = c.c_current_hdemo_sk INNER JOIN income_band ib ON ib.ib_income_band_sk = hd.hd_income_band_sk INNER JOIN store_returns sr ON sr.sr_cdemo_sk = cd.cd_demo_sk WHERE ca.ca_city = 'Mount Vernon' AND ib.ib_lower_bound >= 40374 AND ib.ib_upper_bound <= 40374 + 50000 ORDER BY c.c_customer_id LIMIT 100;",
  "patches": [
    {
      "patch_id": "p03",
      "family": "F",
      "transform": "explicit_join_materialized",
      "relevance_score": 0.7,
      "status": "IMPROVED",
      "speedup": 1.07,
      "semantic_passed": true,
      "error": null,
      "original_ms": 64.4,
      "patch_ms": 60.3,
      "output_sql": "SELECT c.c_customer_id AS customer_id, COALESCE(c.c_last_name, '') || ', ' || COALESCE(c.c_first_name, '') AS customername FROM customer c INNER JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk INNER JOIN household_demographics hd ON hd.hd_demo_sk = c.c_current_hdemo_sk INNER JOIN income_band ib ON ib.ib_income_band_sk = hd.hd_income_band_sk INNER JOIN store_returns sr ON sr.sr_cdemo_sk = cd.cd_demo_sk WHERE ca.ca_city = 'Mount Vernon' AND ib.ib_lower_bound >= 40374 AND ib.ib_upper_bound <= 40374 + 50000 ORDER BY c.c_customer_id LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Convert comma joins to explicit INNER JOINs and materialize filtered customer_address and income_band in CTEs to create tiny hash tables."
    },
    {
      "patch_id": "p01",
      "family": "A",
      "transform": "dimension_cte_isolate",
      "relevance_score": 0.55,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: missing FROM-clause entry for table \"ib_filtered\"\nLINE 1: ...usehold_demographics hd ON hd.hd_income_band_sk = ib_filtere...\n                                                             ^\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH ca_filtered AS (SELECT ca_address_sk FROM customer_address WHERE ca_city = 'Mount Vernon'), ib_filtered AS (SELECT ib_income_band_sk, ib_lower_bound, ib_upper_bound FROM income_band WHERE ib_lower_bound >= 40374 AND ib_upper_bound <= 90374) SELECT c.c_customer_id AS customer_id, COALESCE(c.c_last_name, '') || ', ' || COALESCE(c.c_first_name, '') AS customername FROM customer c JOIN ca_filtered ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN household_demographics hd ON hd.hd_income_band_sk = ib_filtered.ib_income_band_sk JOIN ib_filtered ON ib_filtered.ib_income_band_sk = hd.hd_income_band_sk JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN store_returns sr ON sr.sr_cdemo_sk = cd.cd_demo_sk ORDER BY c.c_customer_id LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre-filter customer_address by ca_city and income_band by range into CTEs, then join with customer using explicit JOIN syntax."
    },
    {
      "patch_id": "p04",
      "family": "A",
      "transform": "multi_dimension_prefetch",
      "relevance_score": 0.65,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH customer_prefetch AS (SELECT c_customer_sk, c_customer_id, c_current_cdemo_sk, c_current_hdemo_sk, c_current_addr_sk, c_first_name, c_last_name FROM customer), customer_address_prefetch AS (SELECT ca_address_sk, ca_city FROM customer_address WHERE ca_city = 'Mount Vernon'), income_band_prefetch AS (SELECT ib_income_band_sk, ib_lower_bound, ib_upper_bound FROM income_band WHERE ib_lower_bound >= 40374 AND ib_upper_bound <= 40374 + 50000), household_demographics_prefetch AS (SELECT hd_demo_sk, hd_income_band_sk FROM household_demographics), customer_demographics AS (SELECT cd_demo_sk FROM customer_demographics), store_returns AS (SELECT sr_cdemo_sk FROM store_returns) SELECT c.c_customer_id AS customer_id, COALESCE(c.c_last_name, '') || ', ' || COALESCE(c.c_first_name, '') AS customername FROM customer_prefetch c JOIN customer_address_prefetch ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN household_demographics_prefetch hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band_prefetch ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk ORDER BY c.c_customer_id LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre-filter all selective dimensions (customer_address, income_band, household_demographics) into CTEs before joining with customer, using explicit JOIN syntax."
    },
    {
      "patch_id": "p02",
      "family": "A",
      "transform": "early_filter",
      "relevance_score": 0.5,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select  c_customer_id as customer_id\n       , coalesce(c_last_name,'') || ', ' || coalesce(c_first_name,'') as customername\n from customer\n     ,customer_address\n     ,customer_demographics\n     ,household_demographics\n     ,income_band\n     ,store_returns\n where ca_city\t        =  'Mount Vernon'\n   and c_current_addr_sk = ca_address_sk\n   and ib_lower_bound   >=  40374\n   and ib_upper_bound   <=  40374 + 50000\n   and ib_income_band_sk = hd_income_band_sk\n   and cd_demo_sk = c_current_cdemo_sk\n   and hd_demo_sk = c_current_hdemo_sk\n   and sr_cdemo_sk = cd_demo_sk\n order by c_customer_id\n limit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Filter customer_address and income_band first, then join with customer, using explicit JOIN syntax and preserving all original predicates."
    },
    {
      "patch_id": "compile_p03",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.71,
      "semantic_passed": true,
      "error": null,
      "original_ms": 58.9,
      "patch_ms": 83.2,
      "output_sql": "SELECT c.c_customer_id AS customer_id, COALESCE(c.c_last_name, '') || ', ' || COALESCE(c.c_first_name, '') AS customername FROM customer c INNER JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk INNER JOIN household_demographics hd ON hd.hd_demo_sk = c.c_current_hdemo_sk INNER JOIN income_band ib ON ib.ib_income_band_sk = hd.hd_income_band_sk INNER JOIN store_returns sr ON sr.sr_cdemo_sk = cd.cd_demo_sk WHERE ca.ca_city = 'Mount Vernon' AND ib.ib_lower_bound >= 40374 AND ib.ib_upper_bound <= 40374 + 50000 ORDER BY c.c_customer_id LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_fixed_cte",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.7,
      "semantic_passed": true,
      "error": null,
      "original_ms": 58.9,
      "patch_ms": 84.1,
      "output_sql": "WITH ca_filtered AS (SELECT ca_address_sk FROM customer_address WHERE ca_city = 'Mount Vernon'), ib_filtered AS (SELECT ib_income_band_sk FROM income_band WHERE ib_lower_bound >= 40374 AND ib_upper_bound <= 40374 + 50000) SELECT c.c_customer_id AS customer_id, COALESCE(c.c_last_name, '') || ', ' || COALESCE(c.c_first_name, '') AS customername FROM customer c JOIN ca_filtered ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN ib_filtered ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN store_returns sr ON sr.sr_cdemo_sk = cd.cd_demo_sk ORDER BY c.c_customer_id LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p03",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.76,
      "semantic_passed": true,
      "error": null,
      "original_ms": 58.9,
      "patch_ms": 77.9,
      "output_sql": "SELECT c.c_customer_id AS customer_id, COALESCE(c.c_last_name, '') || ', ' || COALESCE(c.c_first_name, '') AS customername FROM customer c INNER JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk INNER JOIN household_demographics hd ON hd.hd_demo_sk = c.c_current_hdemo_sk INNER JOIN income_band ib ON ib.ib_income_band_sk = hd.hd_income_band_sk INNER JOIN store_returns sr ON sr.sr_cdemo_sk = cd.cd_demo_sk WHERE ca.ca_city = 'Mount Vernon' AND ib.ib_lower_bound >= 40374 AND ib.ib_upper_bound <= 40374 + 50000 ORDER BY c.c_customer_id LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_cte_prefilter",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.71,
      "semantic_passed": true,
      "error": null,
      "original_ms": 58.9,
      "patch_ms": 83.3,
      "output_sql": "WITH filtered_ca AS (SELECT ca_address_sk FROM customer_address WHERE ca_city = 'Mount Vernon'), filtered_ib AS (SELECT ib_income_band_sk FROM income_band WHERE ib_lower_bound >= 40374 AND ib_upper_bound <= 90374) SELECT c.c_customer_id AS customer_id, COALESCE(c.c_last_name, '') || ', ' || COALESCE(c.c_first_name, '') AS customername FROM customer c JOIN filtered_ca ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN household_demographics hd ON hd.hd_demo_sk = c.c_current_hdemo_sk JOIN filtered_ib ib ON ib.ib_income_band_sk = hd.hd_income_band_sk JOIN store_returns sr ON sr.sr_cdemo_sk = cd.cd_demo_sk ORDER BY c.c_customer_id LIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p03": "Limit  (rows=100, time=82.084)\n  Gather Merge  (rows=100, time=82.08)\n    Sort  (rows=100, time=81.731)\n      Nested Loop  (rows=559, time=81.556)\n        Nested Loop  (rows=114, time=79.937)\n          Hash Join  (rows=117, time=78.855)\n            Nested Loop  (rows=605, time=78.708)\n              Hash Join  (rows=622, time=77.094)\n                Seq Scan on customer (c)  (rows=500000, time=35.185)\n                Hash  (rows=297, time=16.589)\n                  Seq Scan on customer_address (ca",
    "compile_p03": "Limit  (rows=100, time=76.929)\n  Gather Merge  (rows=100, time=76.924)\n    Sort  (rows=100, time=76.538)\n      Nested Loop  (rows=559, time=76.384)\n        Nested Loop  (rows=114, time=75.749)\n          Hash Join  (rows=117, time=75.388)\n            Nested Loop  (rows=605, time=75.285)\n              Hash Join  (rows=622, time=74.323)\n                Seq Scan on customer (c)  (rows=500000, time=32.429)\n                Hash  (rows=297, time=18.167)\n                  Seq Scan on customer_address (c",
    "compile_fixed_cte": "Limit  (rows=100, time=80.618)\n  Gather Merge  (rows=100, time=80.612)\n    Sort  (rows=100, time=80.185)\n      Nested Loop  (rows=559, time=80.02)\n        Nested Loop  (rows=114, time=79.315)\n          Hash Join  (rows=117, time=78.916)\n            Nested Loop  (rows=605, time=78.804)\n              Hash Join  (rows=622, time=77.696)\n                Seq Scan on customer (c)  (rows=500000, time=34.077)\n                Hash  (rows=297, time=19.311)\n                  Seq Scan on customer_address  (r",
    "compile_cte_prefilter": "Limit  (rows=100, time=81.592)\n  Gather Merge  (rows=100, time=81.587)\n    Sort  (rows=100, time=81.253)\n      Nested Loop  (rows=559, time=81.078)\n        Nested Loop  (rows=114, time=80.314)\n          Hash Join  (rows=117, time=79.875)\n            Nested Loop  (rows=605, time=79.749)\n              Hash Join  (rows=622, time=77.645)\n                Seq Scan on customer (c)  (rows=500000, time=35.331)\n                Hash  (rows=297, time=17.345)\n                  Seq Scan on customer_address  ("
  }
}