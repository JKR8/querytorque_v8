{
  "iteration": 1,
  "n_api_calls": 5,
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "t1",
      "family": "B+A",
      "transform": "pivot_quarters_with_early_filters",
      "relevance_score": 0.95,
      "status": "REGRESSION",
      "speedup": 0.12,
      "semantic_passed": true,
      "error": null,
      "original_ms": 66.9,
      "patch_ms": 566.9,
      "output_sql": "WITH ss AS (SELECT ca_county, d_qoy, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales, date_dim, customer_address, item WHERE ss_sold_date_sk = d_date_sk AND ss_addr_sk = ca_address_sk AND ss_item_sk = i_item_sk AND i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ss_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA', 'IL') GROUP BY ca_county, d_qoy, d_year), ws AS (SELECT ca_county, d_qoy, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales, date_dim, customer_address, item WHERE ws_sold_date_sk = d_date_sk AND ws_bill_addr_sk = ca_address_sk AND ws_item_sk = i_item_sk AND i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ws_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA', 'IL') GROUP BY ca_county, d_qoy, d_year), ss_filtered AS (SELECT ca_county, d_qoy, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN item ON ss_item_sk = i_item_sk WHERE i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ss_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA', 'IL') AND d_year = 1998 AND d_qoy IN (1, 2, 3) GROUP BY ca_county, d_qoy, d_year), ws_filtered AS (SELECT ca_county, d_qoy, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN customer_address ON ws_bill_addr_sk = ca_address_sk JOIN item ON ws_item_sk = i_item_sk WHERE i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ws_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA', 'IL') AND d_year = 1998 AND d_qoy IN (1, 2, 3) GROUP BY ca_county, d_qoy, d_year), ss_pivoted AS (SELECT ca_county, MAX(CASE WHEN d_qoy = 1 THEN store_sales END) AS q1_store_sales, MAX(CASE WHEN d_qoy = 2 THEN store_sales END) AS q2_store_sales, MAX(CASE WHEN d_qoy = 3 THEN store_sales END) AS q3_store_sales FROM ss_filtered GROUP BY ca_county), ws_pivoted AS (SELECT ca_county, MAX(CASE WHEN d_qoy = 1 THEN web_sales END) AS q1_web_sales, MAX(CASE WHEN d_qoy = 2 THEN web_sales END) AS q2_web_sales, MAX(CASE WHEN d_qoy = 3 THEN web_sales END) AS q3_web_sales FROM ws_filtered GROUP BY ca_county) SELECT ss_pivoted.ca_county, 1998 AS d_year, (CAST(q2_web_sales AS DOUBLE PRECISION) / NULLIF(q1_web_sales, 0)) AS web_q1_q2_increase, (CAST(q2_store_sales AS DOUBLE PRECISION) / NULLIF(q1_store_sales, 0)) AS store_q1_q2_increase, (CAST(q3_web_sales AS DOUBLE PRECISION) / NULLIF(q2_web_sales, 0)) AS web_q2_q3_increase, (CAST(q3_store_sales AS DOUBLE PRECISION) / NULLIF(q2_store_sales, 0)) AS store_q2_q3_increase FROM ss_pivoted JOIN ws_pivoted ON ss_pivoted.ca_county = ws_pivoted.ca_county WHERE (CASE WHEN q1_web_sales > 0 THEN CAST(q2_web_sales AS DOUBLE PRECISION) / q1_web_sales ELSE NULL END) > (CASE WHEN q1_store_sales > 0 THEN CAST(q2_store_sales AS DOUBLE PRECISION) / q1_store_sales ELSE NULL END) AND (CASE WHEN q2_web_sales > 0 THEN CAST(q3_web_sales AS DOUBLE PRECISION) / q2_web_sales ELSE NULL END) > (CASE WHEN q2_store_sales > 0 THEN CAST(q3_store_sales AS DOUBLE PRECISION) / q2_store_sales ELSE NULL END) ORDER BY d_year;",
      "has_explain": true
    },
    {
      "patch_id": "t4",
      "family": "C",
      "transform": "early_aggregate_web_sales",
      "relevance_score": 0.75,
      "status": "NEUTRAL",
      "speedup": 1.0,
      "semantic_passed": true,
      "error": null,
      "original_ms": 66.9,
      "patch_ms": 67.0,
      "output_sql": "WITH ss AS (SELECT ca_county, d_qoy, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales, date_dim, customer_address, item WHERE ss_sold_date_sk = d_date_sk AND ss_addr_sk = ca_address_sk AND ss_item_sk = i_item_sk AND i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ss_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA', 'IL') GROUP BY ca_county, d_qoy, d_year), ws AS (SELECT ca_county, d_qoy, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales, date_dim, customer_address, item WHERE ws_sold_date_sk = d_date_sk AND ws_bill_addr_sk = ca_address_sk AND ws_item_sk = i_item_sk AND i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ws_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA', 'IL') GROUP BY ca_county, d_qoy, d_year), ws_agg AS (SELECT ca_county, d_qoy, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN customer_address ON ws_bill_addr_sk = ca_address_sk JOIN item ON ws_item_sk = i_item_sk WHERE i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ws_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA', 'IL') GROUP BY ca_county, d_qoy, d_year), ss_agg AS (SELECT ca_county, d_qoy, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN item ON ss_item_sk = i_item_sk WHERE i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ss_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA', 'IL') GROUP BY ca_county, d_qoy, d_year) SELECT ss1.ca_county, ss1.d_year, ws2.web_sales / ws1.web_sales AS web_q1_q2_increase, ss2.store_sales / ss1.store_sales AS store_q1_q2_increase, ws3.web_sales / ws2.web_sales AS web_q2_q3_increase, ss3.store_sales / ss2.store_sales AS store_q2_q3_increase FROM ss_agg AS ss1, ss_agg AS ss2, ss_agg AS ss3, ws_agg AS ws1, ws_agg AS ws2, ws_agg AS ws3 WHERE ss1.d_qoy = 1 AND ss1.d_year = 1998 AND ss1.ca_county = ss2.ca_county AND ss2.d_qoy = 2 AND ss2.d_year = 1998 AND ss2.ca_county = ss3.ca_county AND ss3.d_qoy = 3 AND ss3.d_year = 1998 AND ss1.ca_county = ws1.ca_county AND ws1.d_qoy = 1 AND ws1.d_year = 1998 AND ws1.ca_county = ws2.ca_county AND ws2.d_qoy = 2 AND ws2.d_year = 1998 AND ws1.ca_county = ws3.ca_county AND ws3.d_qoy = 3 AND ws3.d_year = 1998 AND CASE WHEN ws1.web_sales > 0 THEN ws2.web_sales / ws1.web_sales ELSE NULL END > CASE WHEN ss1.store_sales > 0 THEN ss2.store_sales / ss1.store_sales ELSE NULL END AND CASE WHEN ws2.web_sales > 0 THEN ws3.web_sales / ws2.web_sales ELSE NULL END > CASE WHEN ss2.store_sales > 0 THEN ss3.store_sales / ss2.store_sales ELSE NULL END ORDER BY ss1.d_year;",
      "has_explain": true
    },
    {
      "patch_id": "t2",
      "family": "E+B+F+A",
      "transform": "prefilter_dimensions_then_pivot+explicit_joins_with_filter_pushdown",
      "relevance_score": 0.85,
      "status": "NEUTRAL",
      "speedup": 1.0,
      "semantic_passed": true,
      "error": null,
      "original_ms": 66.9,
      "patch_ms": 66.9,
      "output_sql": "WITH ss AS (SELECT ca_county, d_qoy, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales, date_dim, customer_address, item WHERE ss_sold_date_sk = d_date_sk AND ss_addr_sk = ca_address_sk AND ss_item_sk = i_item_sk AND i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ss_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA', 'IL') GROUP BY ca_county, d_qoy, d_year), ws AS (SELECT ca_county, d_qoy, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales, date_dim, customer_address, item WHERE ws_sold_date_sk = d_date_sk AND ws_bill_addr_sk = ca_address_sk AND ws_item_sk = i_item_sk AND i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27 AND ws_list_price BETWEEN 86 AND 100 AND ca_state IN ('IA', 'IL') GROUP BY ca_county, d_qoy, d_year), filtered_items AS (SELECT i_item_sk FROM item WHERE i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27), filtered_addresses AS (SELECT ca_address_sk, ca_county FROM customer_address WHERE ca_state IN ('IA', 'IL')) SELECT ss1.ca_county, ss1.d_year, ws2.web_sales / ws1.web_sales AS web_q1_q2_increase, ss2.store_sales / ss1.store_sales AS store_q1_q2_increase, ws3.web_sales / ws2.web_sales AS web_q2_q3_increase, ss3.store_sales / ss2.store_sales AS store_q2_q3_increase FROM ss AS ss1 INNER JOIN ss AS ss2 ON ss1.ca_county = ss2.ca_county AND ss2.d_qoy = 2 AND ss2.d_year = 1998 INNER JOIN ss AS ss3 ON ss2.ca_county = ss3.ca_county AND ss3.d_qoy = 3 AND ss3.d_year = 1998 INNER JOIN ws AS ws1 ON ss1.ca_county = ws1.ca_county AND ws1.d_qoy = 1 AND ws1.d_year = 1998 INNER JOIN ws AS ws2 ON ws1.ca_county = ws2.ca_county AND ws2.d_qoy = 2 AND ws2.d_year = 1998 INNER JOIN ws AS ws3 ON ws1.ca_county = ws3.ca_county AND ws3.d_qoy = 3 AND ws3.d_year = 1998 WHERE ss1.d_qoy = 1 AND ss1.d_year = 1998 AND (CASE WHEN ws1.web_sales > 0 THEN ws2.web_sales / ws1.web_sales ELSE NULL END) > (CASE WHEN ss1.store_sales > 0 THEN ss2.store_sales / ss1.store_sales ELSE NULL END) AND (CASE WHEN ws2.web_sales > 0 THEN ws3.web_sales / ws2.web_sales ELSE NULL END) > (CASE WHEN ss2.store_sales > 0 THEN ss3.store_sales / ss2.store_sales ELSE NULL END) ORDER BY ss1.d_year;",
      "has_explain": true
    }
  ],
  "explains": {
    "t1": "Hash Join  (rows=0, time=573.863)\n  Aggregate  (rows=21, time=440.571)\n    Aggregate  (rows=21, time=440.56)\n      Sort  (rows=24, time=440.539)\n        Gather  (rows=24, time=440.487)\n          Nested Loop  (rows=12, time=429.913)\n            Nested Loop  (rows=216, time=428.413)\n              Nested Loop  (rows=151512, time=248.915)\n                Seq Scan on date_dim  (rows=137, time=2.615)\n                Index Only Scan on store_sales  (rows=1106, time=1.742)\n              Index Scan on it",
    "t4": "Nested Loop  (rows=0, time=67.639)\n  Aggregate  (rows=0, time=0.0)\n    Gather Merge  (rows=0, time=0.0)\n      Aggregate  (rows=0, time=0.0)\n        Sort  (rows=0, time=0.0)\n          Nested Loop  (rows=0, time=0.0)\n            Nested Loop  (rows=0, time=0.0)\n              Nested Loop  (rows=0, time=0.0)\n                Index Scan on item  (rows=0, time=0.0)\n                Bitmap Heap Scan on web_sales  (rows=0, time=0.0)\n                  Bitmap Index Scan  (rows=0, time=0.0)\n              Inde",
    "t2": "Nested Loop  (rows=0, time=71.623)\n  Aggregate  (rows=173, time=71.534)\n    Gather Merge  (rows=179, time=71.468)\n      Aggregate  (rows=60, time=63.026)\n        Sort  (rows=62, time=62.996)\n          Nested Loop  (rows=62, time=62.912)\n            Nested Loop  (rows=63, time=62.633)\n              Nested Loop  (rows=1048, time=56.3)\n                Index Scan on item  (rows=89, time=12.22)\n                Bitmap Heap Scan on store_sales  (rows=12, time=0.491)\n                  Bitmap Index Scan "
  }
}