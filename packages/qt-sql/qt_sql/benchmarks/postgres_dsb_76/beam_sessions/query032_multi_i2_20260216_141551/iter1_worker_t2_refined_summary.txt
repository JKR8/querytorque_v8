Worker Role: W2
Family: B+E
Transform: base_sales_prefetch+decorrelate_minimal
Status: OK

--- OUTPUT SQL ---
WITH base_sales AS (SELECT cs_item_sk, cs_ext_discount_amt, cs_list_price, cs_sales_price FROM catalog_sales INNER JOIN date_dim ON d_date_sk = cs_sold_date_sk WHERE d_date BETWEEN '2001-02-23' AND CAST('2001-02-23' AS DATE) + INTERVAL '90 DAY'), item_filter AS (SELECT i_item_sk FROM item WHERE i_manufact_id IN (184, 307, 365, 560, 681) OR i_manager_id BETWEEN 42 AND 71), threshold AS (SELECT cs_item_sk, 1.3 * AVG(cs_ext_discount_amt) AS threshold FROM base_sales WHERE cs_list_price BETWEEN 115 AND 144 AND cs_sales_price / cs_list_price BETWEEN 21 * 0.01 AND 41 * 0.01 GROUP BY cs_item_sk) SELECT SUM(cs_ext_discount_amt) AS "excess discount amount" FROM base_sales JOIN item_filter ON base_sales.cs_item_sk = item_filter.i_item_sk JOIN threshold ON base_sales.cs_item_sk = threshold.cs_item_sk WHERE cs_ext_discount_amt > threshold ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;