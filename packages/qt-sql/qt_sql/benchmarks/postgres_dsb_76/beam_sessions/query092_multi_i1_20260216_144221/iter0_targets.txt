[
  {
    "target_id": "t1",
    "family": "B",
    "transform": "decorrelation_shared_scan",
    "relevance_score": 0.95,
    "hypothesis": "Correlated subquery re-scans web_sales/date_dim per row. Precompute item thresholds in CTE using shared base scan to eliminate per-row execution.",
    "target_ir": "S0 [SELECT]\n  CTE: common_scan  (via Q1)\n    FROM: web_sales INNER JOIN date_dim ON d_date_sk = ws_sold_date_sk\n    WHERE: d_date BETWEEN '2002-03-06' AND CAST('2002-03-06' AS DATE) + INTERVAL '90 day'\n      AND ws_wholesale_cost BETWEEN 16 AND 36\n  CTE: item_thresholds  (via Q2)\n    FROM: common_scan\n    WHERE: ws_sales_price / ws_list_price BETWEEN 0.35 AND 0.50\n    GROUP BY: ws_item_sk\n    SELECT: ws_item_sk, 1.3 * AVG(ws_ext_discount_amt) AS threshold\n  MAIN QUERY (via Q0)\n    FROM: common_scan\n      INNER JOIN item ON i_item_sk = ws_item_sk\n      INNER JOIN item_thresholds ON common_scan.ws_item_sk = item_thresholds.ws_item_sk\n    WHERE: (i_manufact_id BETWEEN 566 AND 765 OR i_category IN ('Children','Jewelry','Men'))\n      AND ws_ext_discount_amt > item_thresholds.threshold\n    ORDER BY: SUM(ws_ext_discount_amt)",
    "recommended_examples": [
      "pg_shared_scan_decorrelate"
    ]
  },
  {
    "target_id": "t2",
    "family": "E",
    "transform": "materialize_shared_filters",
    "relevance_score": 0.85,
    "hypothesis": "Duplicate scans of web_sales/date_dim with identical date/wholesale filters. Materialize filtered dataset in CTE for reuse.",
    "target_ir": "S0 [SELECT]\n  CTE: filtered_sales  (via Q1)\n    FROM: web_sales\n      INNER JOIN date_dim ON d_date_sk = ws_sold_date_sk\n    WHERE: d_date BETWEEN '2002-03-06' AND CAST('2002-03-06' AS DATE) + INTERVAL '90 day'\n      AND ws_wholesale_cost BETWEEN 16 AND 36\n  MAIN QUERY (via Q0)\n    FROM: filtered_sales\n      INNER JOIN item ON i_item_sk = ws_item_sk\n    WHERE: (i_manufact_id BETWEEN 566 AND 765 OR i_category IN ('Children','Jewelry','Men'))\n      AND ws_ext_discount_amt > (subquery remains temporarily)\n    ORDER BY: SUM(ws_ext_discount_amt)",
    "recommended_examples": [
      "multi_dimension_prefetch"
    ]
  },
  {
    "target_id": "t3",
    "family": "F",
    "transform": "explicit_join_syntax",
    "relevance_score": 0.75,
    "hypothesis": "Implicit comma joins prevent optimal join ordering. Convert to explicit INNER JOINs for better optimizer guidance.",
    "target_ir": "S0 [SELECT]\n  MAIN QUERY (via Q0)\n    FROM: web_sales\n      INNER JOIN item ON i_item_sk = ws_item_sk\n      INNER JOIN date_dim ON d_date_sk = ws_sold_date_sk\n    WHERE: (i_manufact_id BETWEEN 566 AND 765 OR i_category IN ('Children','Jewelry','Men'))\n      AND d_date BETWEEN '2002-03-06' AND CAST('2002-03-06' AS DATE) + INTERVAL '90 day'\n      AND ws_wholesale_cost BETWEEN 16 AND 36\n      AND ws_ext_discount_amt > (subquery)\n    ORDER BY: SUM(ws_ext_discount_amt)",
    "recommended_examples": [
      "pg_explicit_join_materialized"
    ]
  }
]