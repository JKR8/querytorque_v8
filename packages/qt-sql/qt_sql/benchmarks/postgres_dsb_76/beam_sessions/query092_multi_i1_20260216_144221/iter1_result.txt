{
  "iteration": 1,
  "n_api_calls": 6,
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "S0:45f976cc8e3ef038",
      "family": "B",
      "transform": "decorrelate_fixed_literals",
      "relevance_score": 0.98,
      "status": "PENDING",
      "speedup": null,
      "semantic_passed": true,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_sales AS (SELECT ws_item_sk, ws_ext_discount_amt, ws_sales_price, ws_list_price FROM web_sales INNER JOIN date_dim ON d_date_sk = ws_sold_date_sk WHERE d_date BETWEEN '2002-03-06' AND CAST('2002-03-06' AS DATE) + INTERVAL '90 DAY' AND ws_wholesale_cost BETWEEN 16 AND 36), item_thresholds AS (SELECT ws_item_sk, 1.3 * AVG(ws_ext_discount_amt) AS threshold FROM filtered_sales WHERE ws_sales_price / ws_list_price BETWEEN 35 * 0.01 AND 50 * 0.01 GROUP BY ws_item_sk) SELECT SUM(filtered_sales.ws_ext_discount_amt) AS \"Excess Discount Amount\" FROM filtered_sales INNER JOIN item ON i_item_sk = filtered_sales.ws_item_sk INNER JOIN item_thresholds ON filtered_sales.ws_item_sk = item_thresholds.ws_item_sk WHERE (i_manufact_id BETWEEN 566 AND 765 OR i_category IN ('Children', 'Jewelry', 'Men')) AND filtered_sales.ws_ext_discount_amt > item_thresholds.threshold ORDER BY SUM(filtered_sales.ws_ext_discount_amt) LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "S0",
      "family": "E+B",
      "transform": "materialize_shared_filters_then_decorrelate",
      "relevance_score": 0.92,
      "status": "PENDING",
      "speedup": null,
      "semantic_passed": false,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_sales AS (SELECT ws_item_sk, ws_ext_discount_amt, ws_sales_price, ws_list_price FROM web_sales INNER JOIN date_dim ON d_date_sk = ws_sold_date_sk WHERE d_date BETWEEN '2002-03-06' AND CAST('2002-03-06' AS DATE) + INTERVAL '90 DAY' AND ws_wholesale_cost BETWEEN 16 AND 36), item_thresholds AS (SELECT fs.ws_item_sk, 1.3 * AVG(fs.ws_ext_discount_amt) AS threshold FROM filtered_sales AS fs WHERE fs.ws_sales_price / fs.ws_list_price BETWEEN 35 * 0.01 AND 50 * 0.01 GROUP BY fs.ws_item_sk), qualified_items AS (SELECT fs.ws_ext_discount_amt FROM filtered_sales AS fs INNER JOIN item AS i ON i_item_sk = fs.ws_item_sk LEFT JOIN item_thresholds AS t ON fs.ws_item_sk = t.ws_item_sk WHERE (i_manufact_id BETWEEN 566 AND 765 OR i_category IN ('Children', 'Jewelry', 'Men')) AND (t.threshold IS NULL OR fs.ws_ext_discount_amt > t.threshold)) SELECT SUM(ws_ext_discount_amt) AS \"Excess Discount Amount\" FROM qualified_items ORDER BY SUM(ws_ext_discount_amt) LIMIT 100;",
      "has_explain": false
    },
    {
      "patch_id": "S0",
      "family": "E+B",
      "transform": "materialize_shared_filters_then_decorrelate",
      "relevance_score": 0.92,
      "status": "PENDING",
      "speedup": null,
      "semantic_passed": false,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_sales AS (SELECT ws_item_sk, ws_ext_discount_amt, ws_sales_price, ws_list_price FROM web_sales INNER JOIN date_dim ON d_date_sk = ws_sold_date_sk WHERE d_date BETWEEN '2002-03-06' AND CAST('2002-03-06' AS DATE) + INTERVAL '90 DAY' AND ws_wholesale_cost BETWEEN 16 AND 36), item_thresholds AS (SELECT fs.ws_item_sk, 1.3 * AVG(fs.ws_ext_discount_amt) AS threshold FROM filtered_sales AS fs WHERE fs.ws_sales_price / fs.ws_list_price BETWEEN 35 * 0.01 AND 50 * 0.01 GROUP BY fs.ws_item_sk), qualified_items AS (SELECT fs.ws_ext_discount_amt FROM filtered_sales AS fs INNER JOIN item AS i ON i_item_sk = fs.ws_item_sk LEFT JOIN item_thresholds AS t ON fs.ws_item_sk = t.ws_item_sk WHERE (i_manufact_id BETWEEN 566 AND 765 OR i_category IN ('Children', 'Jewelry', 'Men')) AND (t.threshold IS NULL OR fs.ws_ext_discount_amt > t.threshold)) SELECT SUM(ws_ext_discount_amt) AS \"Excess Discount Amount\" FROM qualified_items ORDER BY SUM(ws_ext_discount_amt) LIMIT 100;",
      "has_explain": false
    },
    {
      "patch_id": "S0",
      "family": "E+B",
      "transform": "materialize_shared_filters_then_decorrelate",
      "relevance_score": 0.92,
      "status": "PENDING",
      "speedup": null,
      "semantic_passed": false,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_sales AS (SELECT ws_item_sk, ws_ext_discount_amt, ws_sales_price, ws_list_price FROM web_sales INNER JOIN date_dim ON d_date_sk = ws_sold_date_sk WHERE d_date BETWEEN '2002-03-06' AND CAST('2002-03-06' AS DATE) + INTERVAL '90 DAY' AND ws_wholesale_cost BETWEEN 16 AND 36), item_thresholds AS (SELECT fs.ws_item_sk, 1.3 * AVG(fs.ws_ext_discount_amt) AS threshold FROM filtered_sales AS fs WHERE fs.ws_sales_price / fs.ws_list_price BETWEEN 35 * 0.01 AND 50 * 0.01 GROUP BY fs.ws_item_sk), qualified_items AS (SELECT fs.ws_ext_discount_amt FROM filtered_sales AS fs INNER JOIN item AS i ON i_item_sk = fs.ws_item_sk LEFT JOIN item_thresholds AS t ON fs.ws_item_sk = t.ws_item_sk WHERE (i_manufact_id BETWEEN 566 AND 765 OR i_category IN ('Children', 'Jewelry', 'Men')) AND (t.threshold IS NULL OR fs.ws_ext_discount_amt > t.threshold)) SELECT SUM(ws_ext_discount_amt) AS \"Excess Discount Amount\" FROM qualified_items ORDER BY SUM(ws_ext_discount_amt) LIMIT 100;",
      "has_explain": false
    }
  ],
  "explains": {
    "S0:45f976cc8e3ef038": "Limit  (rows=1, time=68.725)\n  Gather  (rows=33972, time=36.683)\n    Nested Loop  (rows=16986, time=31.81)\n      Seq Scan on date_dim  (rows=46, time=4.676)\n      Index Scan on web_sales  (rows=373, time=0.572)\n  Sort  (rows=1, time=68.654)\n    Aggregate  (rows=1, time=68.638)\n      Hash Join  (rows=992, time=68.582)\n        CTE Scan (filtered_sales)  (rows=33972, time=6.896)\n        Hash  (rows=931, time=59.725)\n          Nested Loop  (rows=931, time=59.545)\n            Aggregate  (rows=2367, t"
  }
}