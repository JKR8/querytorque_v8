### Analysis of Optimization Families

**Family A (Early Filtering)**: LOW  
The query already applies dimension table filters (item, date_dim) directly in the WHERE clause. No late-applied filters to push down.

**Family B (Decorrelation)**: HIGH  
The correlated subquery re-scans web_sales/date_dim per outer row. This is the primary bottleneck due to repeated full scans and expensive per-row aggregation.

**Family C (Aggregation Pushdown)**: LOW  
No GROUP BY keys in the main query match join keys. The final aggregation is a single SUM() with no intermediate size reduction opportunity.

**Family D (Set Operation Optimization)**: LOW  
No INTERSECT/UNION operations exist. The OR condition in WHERE is efficiently handled by standard boolean evaluation.

**Family E (Materialization/Prefetch)**: HIGH  
The subquery scans the same tables (web_sales/date_dim) with identical date/wholesale filters as the main query. This causes duplicate full scans.

**Family F (Join Transform)**: MEDIUM  
Implicit comma joins exist. Converting to explicit INNER JOINs could help the optimizer, but this is secondary to decorrelation.

**Chosen families**: [B, E, F]  
**Confidence**: High (B/E are critical path optimizations, F is complementary best-practice)

---

### Optimization Targets

```json
[
  {
    "family": "B",
    "transform": "decorrelation_shared_scan",
    "target_id": "t1",
    "relevance_score": 0.95,
    "hypothesis": "Correlated subquery re-scans web_sales/date_dim per row. Precompute item thresholds in CTE using shared base scan to eliminate per-row execution.",
    "target_ir": "S0 [SELECT]\n  CTE: common_scan  (via Q1)\n    FROM: web_sales INNER JOIN date_dim ON d_date_sk = ws_sold_date_sk\n    WHERE: d_date BETWEEN '2002-03-06' AND CAST('2002-03-06' AS DATE) + INTERVAL '90 day'\n      AND ws_wholesale_cost BETWEEN 16 AND 36\n  CTE: item_thresholds  (via Q2)\n    FROM: common_scan\n    WHERE: ws_sales_price / ws_list_price BETWEEN 0.35 AND 0.50\n    GROUP BY: ws_item_sk\n    SELECT: ws_item_sk, 1.3 * AVG(ws_ext_discount_amt) AS threshold\n  MAIN QUERY (via Q0)\n    FROM: common_scan\n      INNER JOIN item ON i_item_sk = ws_item_sk\n      INNER JOIN item_thresholds ON common_scan.ws_item_sk = item_thresholds.ws_item_sk\n    WHERE: (i_manufact_id BETWEEN 566 AND 765 OR i_category IN ('Children','Jewelry','Men'))\n      AND ws_ext_discount_amt > item_thresholds.threshold\n    ORDER BY: SUM(ws_ext_discount_amt)",
    "recommended_examples": ["pg_shared_scan_decorrelate"]
  },
  {
    "family": "E",
    "transform": "materialize_shared_filters",
    "target_id": "t2",
    "relevance_score": 0.85,
    "hypothesis": "Duplicate scans of web_sales/date_dim with identical date/wholesale filters. Materialize filtered dataset in CTE for reuse.",
    "target_ir": "S0 [SELECT]\n  CTE: filtered_sales  (via Q1)\n    FROM: web_sales\n      INNER JOIN date_dim ON d_date_sk = ws_sold_date_sk\n    WHERE: d_date BETWEEN '2002-03-06' AND CAST('2002-03-06' AS DATE) + INTERVAL '90 day'\n      AND ws_wholesale_cost BETWEEN 16 AND 36\n  MAIN QUERY (via Q0)\n    FROM: filtered_sales\n      INNER JOIN item ON i_item_sk = ws_item_sk\n    WHERE: (i_manufact_id BETWEEN 566 AND 765 OR i_category IN ('Children','Jewelry','Men'))\n      AND ws_ext_discount_amt > (subquery remains temporarily)\n    ORDER BY: SUM(ws_ext_discount_amt)",
    "recommended_examples": ["multi_dimension_prefetch"]
  },
  {
    "family": "F",
    "transform": "explicit_join_syntax",
    "target_id": "t3",
    "relevance_score": 0.75,
    "hypothesis": "Implicit comma joins prevent optimal join ordering. Convert to explicit INNER JOINs for better optimizer guidance.",
    "target_ir": "S0 [SELECT]\n  MAIN QUERY (via Q0)\n    FROM: web_sales\n      INNER JOIN item ON i_item_sk = ws_item_sk\n      INNER JOIN date_dim ON d_date_sk = ws_sold_date_sk\n    WHERE: (i_manufact_id BETWEEN 566 AND 765 OR i_category IN ('Children','Jewelry','Men'))\n      AND d_date BETWEEN '2002-03-06' AND CAST('2002-03-06' AS DATE) + INTERVAL '90 day'\n      AND ws_wholesale_cost BETWEEN 16 AND 36\n      AND ws_ext_discount_amt > (subquery)\n    ORDER BY: SUM(ws_ext_discount_amt)",
    "recommended_examples": ["pg_explicit_join_materialized"]
  }
]
```

### Key Rationale
1. **t1 (Primary)**: Combines Family B/E to eliminate the correlated subquery via:
   - `common_scan` CTE materializes filtered web_sales/date_dim
   - `item_thresholds` CTE precomputes per-item aggregates
   - Main query joins CTEs instead of re-executing subquery
   - *Worker routing*: W4 ("Wildcard") for maximum impact

2. **t2 (Secondary)**: Isolated materialization (Family E):
   - Pre-filters web_sales/date_dim once via CTE
   - Reduces I/O for duplicate scans
   - *Worker routing*: W3 ("Builder") for materialization

3. **t3 (Secondary)**: Join restructuring (Family F):
   - Converts comma joins to explicit INNER JOIN syntax
   - Enables better cost-based optimization
   - *Worker routing*: W3 ("Builder") for join transforms

All transformations preserve final SUM() aggregation and LIMIT 100. No redundant changes proposed.