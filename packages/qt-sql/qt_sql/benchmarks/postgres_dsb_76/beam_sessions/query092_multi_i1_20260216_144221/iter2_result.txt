{
  "iteration": 2,
  "n_api_calls": 3,
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "t1",
      "family": "A+B",
      "transform": "decorrelate_with_early_filter",
      "relevance_score": 0.95,
      "status": "PENDING",
      "speedup": null,
      "semantic_passed": true,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_items AS (SELECT i_item_sk FROM item WHERE i_manufact_id BETWEEN 566 AND 765 OR i_category IN ('Children', 'Jewelry', 'Men')), common_scan AS (SELECT ws_item_sk, ws_ext_discount_amt, ws_sales_price, ws_list_price FROM web_sales INNER JOIN date_dim ON d_date_sk = ws_sold_date_sk WHERE d_date BETWEEN '2002-03-06' AND CAST('2002-03-06' AS DATE) + INTERVAL '90 DAY' AND ws_wholesale_cost BETWEEN 16 AND 36), threshold_computation AS (SELECT cs.ws_item_sk, 1.3 * AVG(cs.ws_ext_discount_amt) AS threshold FROM common_scan AS cs INNER JOIN filtered_items AS fi ON cs.ws_item_sk = fi.i_item_sk WHERE cs.ws_sales_price / cs.ws_list_price BETWEEN 35 * 0.01 AND 50 * 0.01 GROUP BY cs.ws_item_sk), outer_rows AS (SELECT cs.ws_item_sk, cs.ws_ext_discount_amt FROM common_scan AS cs INNER JOIN filtered_items AS fi ON cs.ws_item_sk = fi.i_item_sk), join_filter AS (SELECT o.ws_ext_discount_amt FROM outer_rows AS o INNER JOIN threshold_computation AS t ON o.ws_item_sk = t.ws_item_sk WHERE o.ws_ext_discount_amt > t.threshold) SELECT SUM(ws_ext_discount_amt) AS \"Excess Discount Amount\" FROM join_filter ORDER BY SUM(ws_ext_discount_amt) LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "t2",
      "family": "A",
      "transform": "early_filter_qualified_sales",
      "relevance_score": 0.9,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1 structural: LITERAL MISMATCH: Original literals missing from rewrite \u2014 numbers: ['0.01', '35.0', '50.0']. The rewrite changed filter values instead of preserving them.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2002-03-06' AND CAST('2002-03-06' AS DATE) + INTERVAL '90 DAY'), qualified_items AS (SELECT i_item_sk FROM item WHERE i_manufact_id BETWEEN 566 AND 765 OR i_category IN ('Children', 'Jewelry', 'Men')), filtered_sales AS (SELECT ws_ext_discount_amt, ws_item_sk, ws_sold_date_sk FROM web_sales JOIN qualified_items ON i_item_sk = ws_item_sk JOIN filtered_dates ON d_date_sk = ws_sold_date_sk WHERE ws_wholesale_cost BETWEEN 16 AND 36) SELECT SUM(ws_ext_discount_amt) AS \"Excess Discount Amount\" FROM filtered_sales WHERE ws_ext_discount_amt > (SELECT 1.3 * AVG(ws_ext_discount_amt) FROM filtered_sales WHERE ws_sales_price / ws_list_price BETWEEN 0.35 AND 0.50) ORDER BY SUM(ws_ext_discount_amt) LIMIT 100;",
      "has_explain": false
    }
  ],
  "explains": {
    "t1": "Limit  (rows=1, time=97.835)\n  Seq Scan on item  (rows=39811, time=30.545)\n  Gather  (rows=33972, time=34.992)\n    Nested Loop  (rows=16986, time=30.656)\n      Seq Scan on date_dim  (rows=46, time=4.34)\n      Index Scan on web_sales  (rows=373, time=0.555)\n  Sort  (rows=1, time=97.745)\n    Aggregate  (rows=1, time=97.722)\n      Hash Join  (rows=992, time=97.637)\n        CTE Scan (fi)  (rows=39811, time=1.832)\n        Hash  (rows=992, time=93.168)\n          Hash Join  (rows=992, time=93.017)\n    "
  }
}