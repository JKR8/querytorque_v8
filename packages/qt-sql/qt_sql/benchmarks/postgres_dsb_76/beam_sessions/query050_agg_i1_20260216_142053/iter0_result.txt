{
  "iteration": 0,
  "n_api_calls": 5,
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "t1",
      "family": "F",
      "transform": "explicit_join_materialized",
      "relevance_score": 0.95,
      "status": "REGRESSION",
      "speedup": 0.74,
      "semantic_passed": true,
      "error": null,
      "original_ms": 485.7,
      "patch_ms": 657.3,
      "output_sql": "WITH d2_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2000 AND d_moy = 8), d1_date_bounds AS (SELECT MIN(d_date) AS min_d2_date, MAX(d_date) AS max_d2_date FROM d2_dates), d1_dates AS (SELECT d_date_sk, d_date FROM date_dim, d1_date_bounds WHERE d_date BETWEEN (min_d2_date - INTERVAL '120 DAY') AND max_d2_date), filtered_sales AS (SELECT ss_ticket_number, ss_item_sk, ss_customer_sk, ss_store_sk, d1_dates.d_date AS sold_date, ss_sold_date_sk FROM store_sales INNER JOIN d1_dates ON store_sales.ss_sold_date_sk = d1_dates.d_date_sk), filtered_returns AS (SELECT sr_ticket_number, sr_item_sk, sr_customer_sk, d2_dates.d_date AS return_date, sr_returned_date_sk FROM store_returns INNER JOIN d2_dates ON store_returns.sr_returned_date_sk = d2_dates.d_date_sk) SELECT s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip, SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 30) AND (sr_returned_date_sk - ss_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 60) AND (sr_returned_date_sk - ss_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 90) AND (sr_returned_date_sk - ss_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM filtered_sales INNER JOIN filtered_returns ON filtered_sales.ss_ticket_number = filtered_returns.sr_ticket_number AND filtered_sales.ss_item_sk = filtered_returns.sr_item_sk AND filtered_sales.ss_customer_sk = filtered_returns.sr_customer_sk INNER JOIN store ON filtered_sales.ss_store_sk = store.s_store_sk WHERE filtered_sales.sold_date BETWEEN (filtered_returns.return_date - INTERVAL '120 DAY') AND filtered_returns.return_date GROUP BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip ORDER BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "syn_w1",
      "family": "A",
      "transform": "early_filter",
      "relevance_score": 0.3,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Equivalence execution error: column \"sr_returned_date_sk\" does not exist\nLINE 1: ... s_city, s_county, s_state, s_zip, SUM(CASE WHEN (sr_returne...\n                                                             ^\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH d2_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2000 AND d_moy = 8), d1_date_bounds AS (SELECT MIN(d_date) AS min_d2_date, MAX(d_date) AS max_d2_date FROM d2_dates), d1_dates AS (SELECT d_date_sk, d_date FROM date_dim, d1_date_bounds WHERE d_date BETWEEN (min_d2_date - INTERVAL '120 DAY') AND max_d2_date), filtered_sales AS (SELECT ss_ticket_number, ss_item_sk, ss_customer_sk, ss_store_sk, d1_dates.d_date AS sold_date, d1_dates.d_date_sk AS sold_date_sk FROM store_sales INNER JOIN d1_dates ON store_sales.ss_sold_date_sk = d1_dates.d_date_sk), filtered_returns AS (SELECT sr_ticket_number, sr_item_sk, sr_customer_sk, d2_dates.d_date AS return_date, d2_dates.d_date_sk AS return_date_sk FROM store_returns INNER JOIN d2_dates ON store_returns.sr_returned_date_sk = d2_dates.d_date_sk) SELECT s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip, SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 30) AND (sr_returned_date_sk - ss_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 60) AND (sr_returned_date_sk - ss_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 90) AND (sr_returned_date_sk - ss_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM filtered_sales INNER JOIN filtered_returns ON filtered_sales.ss_ticket_number = filtered_returns.sr_ticket_number AND filtered_sales.ss_item_sk = filtered_returns.sr_item_sk AND filtered_sales.ss_customer_sk = filtered_returns.sr_customer_sk INNER JOIN store ON filtered_sales.ss_store_sk = store.s_store_sk WHERE filtered_sales.sold_date BETWEEN (filtered_returns.return_date - INTERVAL '120 DAY') AND filtered_returns.return_date GROUP BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip ORDER BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip LIMIT 100;",
      "has_explain": false
    },
    {
      "patch_id": "syn_w2",
      "family": "B",
      "transform": "decorrelate",
      "relevance_score": 0.3,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Equivalence execution error: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH d2_dates AS (SELECT * FROM date_dim WHERE d_year = 2000 AND d_moy = 8), d1_date_bounds AS (SELECT MIN(d_date) AS min_d2_date, MAX(d_date) AS max_d2_date FROM d2_dates), d1_dates AS (SELECT * FROM date_dim WHERE d_date BETWEEN (SELECT min_d2_date - INTERVAL '120 DAY' FROM d1_date_bounds) AND (SELECT max_d2_date FROM d1_date_bounds)), filtered_sales AS (SELECT ss_ticket_number, ss_item_sk, ss_customer_sk, ss_store_sk, d1_dates.d_date AS sold_date FROM store_sales INNER JOIN d1_dates ON store_sales.ss_sold_date_sk = d1_dates.d_date_sk), filtered_returns AS (SELECT sr_ticket_number, sr_item_sk, sr_customer_sk, d2_dates.d_date AS return_date FROM store_returns INNER JOIN d2_dates ON store_returns.sr_returned_date_sk = d2_dates.d_date_sk) SELECT s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip, SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 30) AND (sr_returned_date_sk - ss_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 60) AND (sr_returned_date_sk - ss_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 90) AND (sr_returned_date_sk - ss_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM filtered_sales INNER JOIN filtered_returns ON filtered_sales.ss_ticket_number = filtered_returns.sr_ticket_number AND filtered_sales.ss_item_sk = filtered_returns.sr_item_sk AND filtered_sales.ss_customer_sk = filtered_returns.sr_customer_sk INNER JOIN store ON filtered_sales.ss_store_sk = store.s_store_sk WHERE filtered_sales.sold_date BETWEEN (filtered_returns.return_date - INTERVAL '120 DAY') AND filtered_returns.return_date GROUP BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip ORDER BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip LIMIT 100;",
      "has_explain": false
    },
    {
      "patch_id": "syn_w3",
      "family": "E",
      "transform": "materialize_cte",
      "relevance_score": 0.3,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Equivalence execution error: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH d2_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2000 AND d_moy = 8), d1_date_bounds AS (SELECT MIN(d_date) AS min_d2_date, MAX(d_date) AS max_d2_date FROM d2_dates), d1_dates AS (SELECT d_date_sk, d_date FROM date_dim, d1_date_bounds WHERE d_date BETWEEN (min_d2_date - INTERVAL '120 DAY') AND max_d2_date), filtered_sales AS (SELECT ss_ticket_number, ss_item_sk, ss_customer_sk, ss_store_sk, d1_dates.d_date AS sold_date FROM store_sales INNER JOIN d1_dates ON store_sales.ss_sold_date_sk = d1_dates.d_date_sk), filtered_returns AS (SELECT sr_ticket_number, sr_item_sk, sr_customer_sk FROM store_returns INNER JOIN d2_dates ON store_returns.sr_returned_date_sk = d2_dates.d_date_sk) SELECT s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip, SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 30) AND (sr_returned_date_sk - ss_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 60) AND (sr_returned_date_sk - ss_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 90) AND (sr_returned_date_sk - ss_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM filtered_sales INNER JOIN filtered_returns ON filtered_sales.ss_ticket_number = filtered_returns.sr_ticket_number AND filtered_sales.ss_item_sk = filtered_returns.sr_item_sk AND filtered_sales.ss_customer_sk = filtered_returns.sr_customer_sk INNER JOIN store ON filtered_sales.ss_store_sk = store.s_store_sk WHERE filtered_sales.sold_date BETWEEN (filtered_returns.return_date - INTERVAL '120 DAY') AND filtered_returns.return_date GROUP BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip ORDER BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip LIMIT 100;",
      "has_explain": false
    }
  ],
  "explains": {
    "t1": "Limit  (rows=30, time=981.499)\n  Index Scan on date_dim (date_dim_1)  (rows=31, time=0.037)\n  Aggregate  (rows=30, time=981.49)\n    Sort  (rows=52123, time=962.606)\n      Nested Loop  (rows=52123, time=884.962)\n        Nested Loop  (rows=52750, time=602.244)\n          Nested Loop  (rows=52750, time=472.555)\n            Nested Loop  (rows=68299, time=419.025)\n              Nested Loop  (rows=92208, time=13.802)\n                CTE Scan (d2_dates)  (rows=31, time=0.041)\n                Index Only "
  }
}