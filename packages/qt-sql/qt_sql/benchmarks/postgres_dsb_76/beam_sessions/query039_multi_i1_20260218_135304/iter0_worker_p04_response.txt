{
  "probe_id": "scout_001",
  "transform_id": "materialize_cte",
  "family": "E",
  "status": "success",
  "dialect": "postgresql",
  "hypothesis": "Adding MATERIALIZED keyword to the CTE 'inv' prevents repeated computation of the same subplan in the self-join, reducing runtime overhead.",
  "reasoning_trace": [
    "Assigned transform targets CTE materialization to reduce repeated scans.",
    "Execution plan shows CTE inv is scanned twice with identical filters and computations.",
    "Materializing the CTE avoids recomputing the aggregate subquery for each side of the self-join."
  ],
  "target_ir": "CTE 'inv' becomes explicitly materialized; final_select remains unchanged.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["inv"],
        "outputs": ["w_warehouse_sk", "i_item_sk", "d_moy", "mean", "cov", "w_warehouse_sk", "i_item_sk", "d_moy", "mean", "cov"],
        "changed": false
      },
      {
        "node_id": "inv",
        "parent_node_id": "final_select",
        "sources": ["inventory", "item", "warehouse", "date_dim"],
        "outputs": ["w_warehouse_name", "w_warehouse_sk", "i_item_sk", "d_moy", "stdev", "mean", "cov"],
        "changed": true,
        "sql": "WITH inv AS MATERIALIZED (SELECT w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy ,stdev,mean, case mean when 0 then null else stdev/mean end cov FROM (SELECT w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy ,stddev_samp(inv_quantity_on_hand) stdev,avg(inv_quantity_on_hand) mean FROM inventory ,item ,warehouse ,date_dim WHERE inv_item_sk = i_item_sk AND inv_warehouse_sk = w_warehouse_sk AND inv_date_sk = d_date_sk AND d_year =2002 AND i_category IN ('Jewelry', 'Men') AND i_manager_id BETWEEN 81 and 100 AND inv_quantity_on_hand between 0 and 200 GROUP BY w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy) foo WHERE case mean when 0 then 0 else stdev/mean end > 1) SELECT * FROM inv"
      }
    ]
  }
}