{
  "probe_id": "p01",
  "transform_id": "sf_sk_pushdown_multi_fact",
  "family": "A",
  "dialect": "postgres",
  "hypothesis": "Pushing ss_sold_date_sk filter early reduces store_sales rows before expensive joins, avoiding late Nested Loop amplification.",
  "reasoning_trace": [
    "Execution plan shows Nested Loop cost hotspot from unfiltered store_sales scan",
    "d1 date range is computed but applied late after store_sales joins",
    "COMMA_JOIN_WEAKNESS prevents optimal join reordering and predicate pushdown",
    "Adding explicit BETWEEN on ss_sold_date_sk enables index scan on store_sales"
  ],
  "target_ir": "Explicit JOIN syntax with pushed-down d1 date filter on store_sales WHERE clause",
  "steps": [
    {
      "step_id": "s1",
      "op": "replace_where_predicate",
      "target": {
        "by_node_id": "S0",
        "by_anchor_hash": "444f6473896f7965"
      },
      "payload": {
        "expr_sql": "d2.d_year = 1999 AND d2.d_moy = 7 AND ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk AND ss_sold_date_sk = d1.d_date_sk AND sr_returned_date_sk = d2.d_date_sk AND ss_customer_sk = sr_customer_sk AND ss_store_sk = s_store_sk AND d1.d_date BETWEEN (d2.d_date - interval '120 day') AND d2.d_date AND ss_sold_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim WHERE d_year = 1999 AND d_moy = 7) AND (SELECT MAX(d_date_sk) FROM date_dim WHERE d_year = 1999 AND d_moy = 7)"
      }
    }
  ]
}