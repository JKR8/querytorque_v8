{
  "probe_id": "p01",
  "transform_id": "single_pass_aggregation",
  "family": "C",
  "dialect": "postgres",
  "hypothesis": "Consolidate multiple CASE-based aggregations into a single pass to reduce redundant scans and improve aggregation efficiency.",
  "reasoning_trace": [
    "Multiple SUM(CASE ...) expressions over the same tables imply repeated scans.",
    "PostgreSQL benefits from reducing aggregate node count via CASE consolidation."
  ],
  "target_ir": "Single aggregation pass with conditional flags replacing multiple CASE expressions; bucket logic preserved.",
  "steps": [
    {
      "step_id": "s1",
      "op": "replace_select",
      "target": {"by_node_id": "S0"},
      "payload": {
        "sql_fragment": "s_store_name ,s_company_id ,s_street_number ,s_street_name ,s_street_type ,s_suite_number ,s_city ,s_county ,s_state ,s_zip ,sum(case when (sr_returned_date_sk - ss_sold_date_sk <= 30 ) then 1 else 0 end) as \"30 days\" ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 30) and (sr_returned_date_sk - ss_sold_date_sk <= 60) then 1 else 0 end ) as \"31-60 days\" ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 60) and (sr_returned_date_sk - ss_sold_date_sk <= 90) then 1 else 0 end) as \"61-90 days\" ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 90) and (sr_returned_date_sk - ss_sold_date_sk <= 120) then 1 else 0 end) as \"91-120 days\" ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 120) then 1 else 0 end) as \">120 days\""
      }
    }
  ]
}