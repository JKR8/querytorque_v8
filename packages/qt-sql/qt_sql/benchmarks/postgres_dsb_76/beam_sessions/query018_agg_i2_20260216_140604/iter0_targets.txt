[
  {
    "target_id": "t1",
    "family": "F",
    "transform": "join_restructure_materialized",
    "relevance_score": 0.98,
    "hypothesis": "Implicit joins force suboptimal join order. Materializing filtered dimensions first and restructuring joins reduces intermediate rows from 135K.",
    "target_ir": "S0 [SELECT]\n  CTE: filtered_date (via Q1)\n    FROM: date_dim\n    WHERE: d_year = 1999\n  CTE: filtered_item (via Q2)\n    FROM: item\n    WHERE: i_category = 'Music'\n  CTE: filtered_demo (via Q3)\n    FROM: customer_demographics\n    WHERE: cd_gender = 'F' AND cd_education_status = '4 yr Degree'\n  CTE: filtered_addr (via Q4)\n    FROM: customer_address\n    WHERE: ca_state IN ('AR', 'IN', 'VA')\n  MAIN QUERY (via Q0)\n    FROM: catalog_sales\n      INNER JOIN filtered_date ON cs_sold_date_sk = d_date_sk\n      INNER JOIN filtered_item ON cs_item_sk = i_item_sk\n      INNER JOIN filtered_demo ON cs_bill_cdemo_sk = cd_demo_sk\n      INNER JOIN customer ON cs_bill_customer_sk = c_customer_sk\n      INNER JOIN filtered_addr ON c_current_addr_sk = ca_address_sk\n    WHERE: cs_wholesale_cost BETWEEN 5 AND 10\n      AND c_birth_month = 12\n    GROUP BY: rollup (i_item_id, ca_country, ca_state, ca_county)\n    ORDER BY: ca_country, ca_state, ca_county, i_item_id",
    "recommended_examples": [
      "pg_explicit_join_materialized"
    ]
  },
  {
    "target_id": "t2",
    "family": "A",
    "transform": "predicate_pushdown",
    "relevance_score": 0.9,
    "hypothesis": "Filters on customer_demographics (gender/education) and customer_address (state) are applied late. Pushing them into CTEs reduces nested loop probes.",
    "target_ir": "S0 [SELECT]\n  CTE: prefiltered_demo (via Q1)\n    FROM: customer_demographics\n    WHERE: cd_gender = 'F' AND cd_education_status = '4 yr Degree'\n  CTE: prefiltered_addr (via Q2)\n    FROM: customer_address\n    WHERE: ca_state IN ('AR', 'IN', 'VA')\n  MAIN QUERY (via Q0)\n    FROM: catalog_sales, prefiltered_demo, customer, prefiltered_addr, date_dim, item\n    WHERE: cs_sold_date_sk = d_date_sk\n      AND cs_item_sk = i_item_sk\n      AND cs_bill_cdemo_sk = cd_demo_sk\n      AND cs_bill_customer_sk = c_customer_sk\n      AND c_current_addr_sk = ca_address_sk\n      AND d_year = 1999\n      AND c_birth_month = 12\n      AND cs_wholesale_cost BETWEEN 5 AND 10\n      AND i_category = 'Music'\n    GROUP BY: rollup (i_item_id, ca_country, ca_state, ca_county)\n    ORDER BY: ca_country, ca_state, ca_county, i_item_id",
    "recommended_examples": [
      "pg_date_cte_explicit_join"
    ]
  },
  {
    "target_id": "t3",
    "family": "E",
    "transform": "dimension_prefetch",
    "relevance_score": 0.85,
    "hypothesis": "Repeated customer\u2192address rescans per catalog_sales row. Pre-joining customer+address into a CTE avoids redundant scans.",
    "target_ir": "S0 [SELECT]\n  CTE: cust_with_addr (via Q1)\n    FROM: customer\n      INNER JOIN customer_address ON c_current_addr_sk = ca_address_sk\n    WHERE: ca_state IN ('AR', 'IN', 'VA')\n      AND c_birth_month = 12\n  MAIN QUERY (via Q0)\n    FROM: catalog_sales\n      INNER JOIN date_dim ON cs_sold_date_sk = d_date_sk\n      INNER JOIN item ON cs_item_sk = i_item_sk\n      INNER JOIN customer_demographics ON cs_bill_cdemo_sk = cd_demo_sk\n      INNER JOIN cust_with_addr ON cs_bill_customer_sk = c_customer_sk\n    WHERE: d_year = 1999\n      AND cd_gender = 'F' AND cd_education_status = '4 yr Degree'\n      AND cs_wholesale_cost BETWEEN 5 AND 10\n      AND i_category = 'Music'\n    GROUP BY: rollup (i_item_id, ca_country, ca_state, ca_county)\n    ORDER BY: ca_country, ca_state, ca_county, i_item_id",
    "recommended_examples": [
      "multi_dimension_prefetch"
    ]
  }
]