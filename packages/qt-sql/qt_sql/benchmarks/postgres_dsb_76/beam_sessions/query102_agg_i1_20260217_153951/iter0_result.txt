{
  "iteration": 0,
  "n_api_calls": 24,
  "beam_cost_usd": 0.1215096,
  "beam_cost_priced_calls": 24,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 131420,
    "completion_tokens": 42336,
    "total_tokens": 173756,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 51968
  },
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "p08",
      "family": "F",
      "transform": "inner_join_conversion",
      "relevance_score": 0.9,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales, web_sales, date_dim AS d1, date_dim AS d2, customer, inventory, store JOIN warehouse ON store.s_state = warehouse.w_state, item, customer_demographics, household_demographics, customer_address WHERE ss_item_sk = i_item_sk AND ws_item_sk = ss_item_sk AND ss_sold_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk AND ws_warehouse_sk = inv_warehouse_sk AND ws_warehouse_sk = w_warehouse_sk AND inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity AND s_state = w_state AND i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93) AND c_current_cdemo_sk = cd_demo_sk AND c_current_hdemo_sk = hd_demo_sk AND c_current_addr_sk = ca_address_sk AND ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA') AND d1.d_year = 2001 AND ws_wholesale_cost BETWEEN 35 AND 55 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Convert warehouse JOIN to INNER JOIN since s_state=w_state filter exists"
    },
    {
      "patch_id": "p09",
      "family": "A",
      "transform": "prefetch_fact_join",
      "relevance_score": 0.78,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_store_sales AS (SELECT ss_item_sk, ss_customer_sk, ss_quantity, ss_sold_date_sk FROM store_sales JOIN date_dim AS d1 ON ss_sold_date_sk = d1.d_date_sk WHERE d1.d_year = 2001) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM filtered_store_sales AS ss JOIN web_sales AS ws ON ss.ss_item_sk = ws.ws_item_sk JOIN date_dim AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk AND ws.ws_bill_customer_sk = c.c_customer_sk JOIN item AS i ON ss.ss_item_sk = i.i_item_sk JOIN inventory AS inv ON inv_item_sk = ss.ss_item_sk AND inv_date_sk = ss.ss_sold_date_sk AND inv_quantity_on_hand >= ss.ss_quantity JOIN store AS s ON s_state = w_state JOIN warehouse AS w ON ws.ws_warehouse_sk = w.w_warehouse_sk AND inv.inv_warehouse_sk = w.w_warehouse_sk JOIN customer_demographics AS cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93) AND ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA') AND ws_wholesale_cost BETWEEN 35 AND 55 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Stage store_sales joins: dim CTE \u2192 fact CTE \u2192 remaining joins"
    },
    {
      "patch_id": "p03",
      "family": "F",
      "transform": "materialized_dimension_fact_prefilter",
      "relevance_score": 0.88,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_store_sales AS (SELECT ss_item_sk, ss_quantity, ss_sold_date_sk, ss_customer_sk FROM store_sales WHERE NOT ss_item_sk IS NULL AND NOT ss_quantity IS NULL), filtered_inventory AS (SELECT inv_item_sk, inv_quantity_on_hand, inv_date_sk FROM inventory WHERE NOT inv_item_sk IS NULL AND NOT inv_quantity_on_hand IS NULL) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM filtered_store_sales AS ss JOIN filtered_inventory AS i ON ss.ss_item_sk = i.inv_item_sk AND i.inv_quantity_on_hand >= ss.ss_quantity WHERE ss_item_sk = i_item_sk AND ws_item_sk = ss_item_sk AND ss_sold_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk AND ws_warehouse_sk = inv_warehouse_sk AND ws_warehouse_sk = w_warehouse_sk AND inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity AND s_state = w_state AND i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93) AND c_current_cdemo_sk = cd_demo_sk AND c_current_hdemo_sk = hd_demo_sk AND c_current_addr_sk = ca_address_sk AND ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA') AND d1.d_year = 2001 AND ws_wholesale_cost BETWEEN 35 AND 55 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Materialize pre-joined store_sales with dimensions before non-equi inventory join"
    },
    {
      "patch_id": "p14",
      "family": "A",
      "transform": "multi_date_range_cte",
      "relevance_score": 0.8,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: COLUMN REF MISMATCH: Original columns missing from rewrite \u2014 ['inv_warehouse_sk']. The rewrite references different table columns.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_d2_dates AS (SELECT d2.d_date_sk, d1.d_date AS anchor_date FROM date_dim AS d1 JOIN date_dim AS d2 ON d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') WHERE d1.d_year = 2001) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales AS ss JOIN item AS i ON ss.ss_item_sk = i.i_item_sk JOIN web_sales AS ws ON ws.ws_item_sk = ss.ss_item_sk AND ws.ws_sold_date_sk = fd.d_date_sk JOIN filtered_d2_dates AS fd ON TRUE JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk AND ws.ws_bill_customer_sk = c.c_customer_sk JOIN inventory AS inv ON inv.inv_item_sk = ss.ss_item_sk AND inv_date_sk = ss.ss_sold_date_sk AND inv_quantity_on_hand >= ss.ss_quantity JOIN store AS s ON s.s_state = w.w_state JOIN warehouse AS w ON ws.ws_warehouse_sk = w.w_warehouse_sk JOIN customer_demographics AS cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ss.ss_sold_date_sk = d1.d_date_sk AND d1.d_year = 2001 AND i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93) AND ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA') AND ws.ws_wholesale_cost BETWEEN 35 AND 55 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Materialize d2 date range as CTE parameterized by d1"
    },
    {
      "patch_id": "p01",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.92,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date_dim AS (SELECT * FROM date_dim WHERE d_year = 2001) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales INNER JOIN web_sales ON ss_item_sk = ws_item_sk AND ws_sold_date_sk = d2.d_date_sk INNER JOIN filtered_date_dim AS d1 ON ss_sold_date_sk = d1.d_date_sk INNER JOIN date_dim AS d2 ON d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') INNER JOIN customer ON ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk INNER JOIN item ON ss_item_sk = i_item_sk INNER JOIN inventory ON inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity INNER JOIN store ON s_state = w_state INNER JOIN warehouse ON ws_warehouse_sk = w_warehouse_sk AND inv_warehouse_sk = w_warehouse_sk INNER JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk INNER JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk INNER JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ss_item_sk = i_item_sk AND ws_item_sk = ss_item_sk AND ss_sold_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk AND ws_warehouse_sk = inv_warehouse_sk AND ws_warehouse_sk = w_warehouse_sk AND inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity AND s_state = w_state AND i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93) AND c_current_cdemo_sk = cd_demo_sk AND c_current_hdemo_sk = hd_demo_sk AND c_current_addr_sk = ca_address_sk AND ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA') AND d1.d_year = 2001 AND ws_wholesale_cost BETWEEN 35 AND 55 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Convert comma-joins to explicit INNER JOIN syntax. Isolate date_dim d1 filter into CTE."
    },
    {
      "patch_id": "p05",
      "family": "B",
      "transform": "early_filter_decorrelate",
      "relevance_score": 0.75,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date_ranges AS (SELECT d1.d_date_sk AS d1_date_sk, d1.d_date AS start_date, (d1.d_date + INTERVAL '30 DAY') AS end_date FROM date_dim AS d1 WHERE d1.d_year = 2001) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales, web_sales, date_dim AS d1, date_dim AS d2, customer, inventory, store, warehouse, item, customer_demographics, household_demographics, customer_address, filtered_date_ranges WHERE ss_item_sk = i_item_sk AND ws_item_sk = ss_item_sk AND ss_sold_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN filtered_date_ranges.start_date AND filtered_date_ranges.end_date AND ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk AND ws_warehouse_sk = inv_warehouse_sk AND ws_warehouse_sk = w_warehouse_sk AND inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity AND s_state = w_state AND i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93) AND c_current_cdemo_sk = cd_demo_sk AND c_current_hdemo_sk = hd_demo_sk AND c_current_addr_sk = ca_address_sk AND ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA') AND ws_wholesale_cost BETWEEN 35 AND 55 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Push d2 date range filter into CTE correlated with d1"
    },
    {
      "patch_id": "p02",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.85,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: COLUMN REF MISMATCH: Original columns missing from rewrite \u2014 ['c_current_addr_sk', 'inv_warehouse_sk', 'w_state', 'ws_sold_date_sk']. The rewrite references different table columns.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_items AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93)), filtered_addresses AS (SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA')), filtered_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2001) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales AS ss JOIN web_sales AS ws ON ws_item_sk = ss.ss_item_sk JOIN filtered_items AS fi ON ss.ss_item_sk = fi.i_item_sk JOIN filtered_addresses AS fa ON ss.ss_addr_sk = fa.ca_address_sk JOIN filtered_dates AS d1 ON ss.ss_sold_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk AND ws.ws_bill_customer_sk = c.c_customer_sk JOIN inventory AS inv ON inv.inv_item_sk = ss.ss_item_sk AND inv.inv_date_sk = ss.ss_sold_date_sk AND inv.inv_quantity_on_hand >= ss.ss_quantity JOIN store AS s ON s.s_state = ws.ws_warehouse_sk JOIN warehouse AS w ON ws.ws_warehouse_sk = w.w_warehouse_sk JOIN customer_demographics AS cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE ws_wholesale_cost BETWEEN 35 AND 55 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Create CTEs for filtered dimensions: item, customer_address, date_dim d1"
    },
    {
      "patch_id": "p04",
      "family": "E",
      "transform": "pg_self_join_decomposition",
      "relevance_score": 0.8,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: COLUMN REF MISMATCH: Original columns missing from rewrite \u2014 ['inv_warehouse_sk']. The rewrite references different table columns.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_store_sales AS (SELECT ss_item_sk, ss_customer_sk, ss_sold_date_sk, ss_quantity, ss_ticket_number FROM store_sales JOIN item ON ss_item_sk = i_item_sk JOIN date_dim AS d1 ON ss_sold_date_sk = d1.d_date_sk WHERE i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93) AND d1.d_year = 2001) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM filtered_store_sales AS ss JOIN web_sales AS ws ON ss.ss_item_sk = ws.ws_item_sk JOIN date_dim AS d1 ON ss.ss_sold_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk AND ws.ws_bill_customer_sk = c.c_customer_sk JOIN inventory AS inv ON ss.ss_item_sk = inv.inv_item_sk AND ss.ss_sold_date_sk = inv.inv_date_sk AND inv.inv_quantity_on_hand >= ss.ss_quantity JOIN store AS s ON s.s_state = w.w_state JOIN warehouse AS w ON ws.ws_warehouse_sk = w.w_warehouse_sk JOIN customer_demographics AS cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA') AND ws_wholesale_cost BETWEEN 35 AND 55 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Materialize filtered store_sales+dimensions CTE before joining web_sales"
    },
    {
      "patch_id": "p11",
      "family": "A",
      "transform": "early_filter",
      "relevance_score": 0.7,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH hd_filtered AS (SELECT hd_demo_sk, hd_vehicle_count FROM household_demographics) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales, web_sales, date_dim AS d1, date_dim AS d2, customer, inventory, store, warehouse, item, customer_demographics, hd_filtered, customer_address WHERE ss_item_sk = i_item_sk AND ws_item_sk = ss_item_sk AND ss_sold_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk AND ws_warehouse_sk = inv_warehouse_sk AND ws_warehouse_sk = w_warehouse_sk AND inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity AND s_state = w_state AND i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93) AND c_current_cdemo_sk = cd_demo_sk AND c_current_hdemo_sk = hd_demo_sk AND c_current_addr_sk = ca_address_sk AND ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA') AND d1.d_year = 2001 AND ws_wholesale_cost BETWEEN 35 AND 55 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Isolate household_demographics CTE despite no filter"
    },
    {
      "patch_id": "p12",
      "family": "C",
      "transform": "deferred_window_aggregation",
      "relevance_score": 0.75,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH pre_agg_sales AS (SELECT ss_customer_sk, ws_bill_customer_sk, COUNT(*) AS sale_count FROM store_sales, web_sales, date_dim AS d1, date_dim AS d2, item, inventory, store, warehouse WHERE ss_item_sk = i_item_sk AND ws_item_sk = ss_item_sk AND ss_sold_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ws_warehouse_sk = inv_warehouse_sk AND ws_warehouse_sk = w_warehouse_sk AND inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity AND s_state = w_state AND i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93) AND d1.d_year = 2001 AND ws_wholesale_cost BETWEEN 35 AND 55 GROUP BY ss_customer_sk, ws_bill_customer_sk) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM pre_agg_sales AS pas JOIN customer AS c ON pas.ss_customer_sk = c.c_customer_sk AND pas.ws_bill_customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca_address_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd_demo_sk JOIN customer_demographics AS cd ON c.c_current_cdemo_sk = cd_demo_sk WHERE ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA') GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Delay customer_demographics join until after initial aggregation"
    },
    {
      "patch_id": "p10",
      "family": "A",
      "transform": "sf_sk_pushdown_multi_fact",
      "relevance_score": 0.55,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH valid_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales, web_sales, valid_dates AS d1, valid_dates AS d2, customer, inventory, store, warehouse, item, customer_demographics, household_demographics, customer_address WHERE ss_item_sk = i_item_sk AND ws_item_sk = ss_item_sk AND ss_sold_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk AND ws_warehouse_sk = inv_warehouse_sk AND ws_warehouse_sk = w_warehouse_sk AND inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity AND s_state = w_state AND i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93) AND c_current_cdemo_sk = cd_demo_sk AND c_current_hdemo_sk = hd_demo_sk AND c_current_addr_sk = ca_address_sk AND ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA') AND d1.d_year = 2001 AND ws_wholesale_cost BETWEEN 35 AND 55 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Add d_date_sk range filter to web_sales based on d1 CTE"
    },
    {
      "patch_id": "p13",
      "family": "A",
      "transform": "shared_dimension_multi_channel",
      "relevance_score": 0.5,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH shared_dimensions AS (SELECT i_item_sk, c_customer_sk FROM item, customer WHERE i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93) AND c_current_addr_sk = ca_address_sk AND ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA')) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales, web_sales, date_dim AS d1, date_dim AS d2, inventory, store, warehouse, shared_dimensions, customer_demographics, household_demographics, customer_address WHERE ss_item_sk = i_item_sk AND ws_item_sk = ss_item_sk AND ss_sold_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk AND ws_warehouse_sk = inv_warehouse_sk AND ws_warehouse_sk = w_warehouse_sk AND inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity AND s_state = w_state AND c_current_cdemo_sk = cd_demo_sk AND c_current_hdemo_sk = hd_demo_sk AND c_current_addr_sk = ca_address_sk AND ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA') AND d1.d_year = 2001 AND ws_wholesale_cost BETWEEN 35 AND 55 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Create shared CTE for item/customer filters used by both store_sales/web_sales"
    },
    {
      "patch_id": "p06",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.65,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH ss_agg AS (SELECT ss_item_sk, ss_customer_sk, ss_sold_date_sk, SUM(ss_quantity) AS total_quantity FROM store_sales GROUP BY ss_item_sk, ss_customer_sk, ss_sold_date_sk) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM ss_agg JOIN web_sales ON ss_agg.ss_item_sk = web_sales.ws_item_sk AND ss_agg.ss_customer_sk = web_sales.ws_bill_customer_sk AND ss_agg.ss_sold_date_sk = web_sales.ws_sold_date_sk JOIN date_dim AS d1 ON ss_agg.ss_sold_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON web_sales.ws_sold_date_sk = d2.d_date_sk JOIN customer ON web_sales.ws_bill_customer_sk = customer.c_customer_sk JOIN inventory ON web_sales.ws_item_sk = inventory.inv_item_sk AND web_sales.ws_sold_date_sk = inventory.inv_date_sk JOIN store ON inventory.inv_warehouse_sk = store.s_store_sk JOIN warehouse ON web_sales.ws_warehouse_sk = warehouse.w_warehouse_sk JOIN item ON web_sales.ws_item_sk = item.i_item_sk JOIN customer_demographics ON customer.c_current_cdemo_sk = customer_demographics.cd_demo_sk JOIN household_demographics ON customer.c_current_hdemo_sk = household_demographics.hd_demo_sk JOIN customer_address ON customer.c_current_addr_sk = customer_address.ca_address_sk WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND inv_quantity_on_hand >= ss_agg.total_quantity AND s_state = warehouse.w_state AND i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93) AND ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA') AND d1.d_year = 2001 AND web_sales.ws_wholesale_cost BETWEEN 35 AND 55 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Pre-aggregate store_sales by ss_item_sk before joining dimensions"
    },
    {
      "patch_id": "p07",
      "family": "A",
      "transform": "multi_dimension_prefetch",
      "relevance_score": 0.6,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH prefiltered_item AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93)), prefiltered_customer_address AS (SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA')), prefiltered_household_demographics AS (SELECT hd_demo_sk FROM household_demographics) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales, web_sales, date_dim AS d1, date_dim AS d2, customer, inventory, store, warehouse, prefiltered_item AS pi, prefiltered_customer_address AS pca, prefiltered_household_demographics AS phd, customer_demographics WHERE ss_item_sk = pi.i_item_sk AND ws_item_sk = ss_item_sk AND ss_sold_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk AND ws_warehouse_sk = inv_warehouse_sk AND ws_warehouse_sk = w_warehouse_sk AND inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity AND s_state = w_state AND c_current_cdemo_sk = cd_demo_sk AND c_current_hdemo_sk = phd.hd_demo_sk AND c_current_addr_sk = pca.ca_address_sk AND d1.d_year = 2001 AND ws_wholesale_cost BETWEEN 35 AND 55 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": "Combine item/customer_address/household_demographics into single prefetch CTE"
    },
    {
      "patch_id": "snipe_p1",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_item AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93)), filtered_d1 AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2001) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales INNER JOIN web_sales ON store_sales.ss_item_sk = web_sales.ws_item_sk INNER JOIN filtered_d1 AS d1 ON store_sales.ss_sold_date_sk = d1.d_date_sk INNER JOIN date_dim AS d2 ON web_sales.ws_sold_date_sk = d2.d_date_sk INNER JOIN customer ON store_sales.ss_customer_sk = customer.c_customer_sk AND web_sales.ws_bill_customer_sk = customer.c_customer_sk INNER JOIN inventory ON store_sales.ss_item_sk = inventory.inv_item_sk AND store_sales.ss_sold_date_sk = inventory.inv_date_sk AND web_sales.ws_warehouse_sk = inventory.inv_warehouse_sk AND inventory.inv_quantity_on_hand >= store_sales.ss_quantity INNER JOIN warehouse ON web_sales.ws_warehouse_sk = warehouse.w_warehouse_sk INNER JOIN filtered_item ON store_sales.ss_item_sk = filtered_item.i_item_sk INNER JOIN customer_demographics ON customer.c_current_cdemo_sk = customer_demographics.cd_demo_sk INNER JOIN household_demographics ON customer.c_current_hdemo_sk = household_demographics.hd_demo_sk INNER JOIN customer_address ON customer.c_current_addr_sk = customer_address.ca_address_sk, store WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND store.s_state = warehouse.w_state AND customer_address.ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA') AND web_sales.ws_wholesale_cost BETWEEN 35 AND 55 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p2",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH store_sales_inv AS (SELECT ss.ss_item_sk, ss.ss_customer_sk, ss.ss_quantity, ss.ss_sold_date_sk, d1.d_date, inv.inv_warehouse_sk FROM store_sales AS ss JOIN item AS i ON ss.ss_item_sk = i.i_item_sk JOIN date_dim AS d1 ON ss.ss_sold_date_sk = d1.d_date_sk JOIN inventory AS inv ON ss.ss_item_sk = inv.inv_item_sk AND ss.ss_sold_date_sk = inv.inv_date_sk AND inv.inv_quantity_on_hand >= ss.ss_quantity WHERE i.i_category IN ('Children', 'Jewelry', 'Men') AND i.i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93) AND d1.d_year = 2001) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales_inv AS ssi INNER JOIN web_sales AS ws ON ws.ws_item_sk = ssi.ss_item_sk AND ws.ws_warehouse_sk = ssi.inv_warehouse_sk INNER JOIN date_dim AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk INNER JOIN customer AS c ON ssi.ss_customer_sk = c.c_customer_sk AND ws.ws_bill_customer_sk = c.c_customer_sk INNER JOIN warehouse AS w ON ws.ws_warehouse_sk = w.w_warehouse_sk INNER JOIN customer_demographics AS cd ON c.c_current_cdemo_sk = cd.cd_demo_sk INNER JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk INNER JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk, store AS s WHERE d2.d_date BETWEEN ssi.d_date AND (ssi.d_date + INTERVAL '30 DAY') AND s.s_state = w.w_state AND ca.ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA') AND ws.ws_wholesale_cost BETWEEN 35 AND 55 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p1",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Step s2 failed: replace_from requires from_sql",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p2",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Step s2 failed: replace_from requires from_sql",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": null
    }
  ],
  "explains": {}
}