{
  "probe_id": "p01",
  "transform_id": "materialized_dimension_fact_prefilter",
  "family": "F",
  "dialect": "postgres",
  "hypothesis": "Pre-filter store_sales and inventory into materialized CTEs to reduce input rows for the expensive non-equi join on inv_quantity_on_hand >= ss_quantity.",
  "reasoning_trace": [
    "Non-equi join between inventory and store_sales is a known hotspot.",
    "Both tables are large and currently unfiltered before the join.",
    "Materializing filtered versions of these tables should reduce row count significantly."
  ],
  "target_ir": "Two CTEs (filtered_store_sales, filtered_inventory) with selective WHERE clauses, joined explicitly in the main query.",
  "steps": [
    {
      "step_id": "s1",
      "op": "insert_cte",
      "target": {"by_node_id": "S0"},
      "payload": {
        "cte_name": "filtered_store_sales",
        "cte_query_sql": "SELECT ss_item_sk, ss_quantity, ss_sold_date_sk, ss_customer_sk FROM store_sales WHERE ss_item_sk IS NOT NULL AND ss_quantity IS NOT NULL"
      }
    },
    {
      "step_id": "s2",
      "op": "insert_cte",
      "target": {"by_node_id": "S0"},
      "payload": {
        "cte_name": "filtered_inventory",
        "cte_query_sql": "SELECT inv_item_sk, inv_quantity_on_hand, inv_date_sk FROM inventory WHERE inv_item_sk IS NOT NULL AND inv_quantity_on_hand IS NOT NULL"
      }
    },
    {
      "step_id": "s3",
      "op": "replace_from",
      "target": {"by_node_id": "S0"},
      "payload": {
        "from_sql": "filtered_store_sales ss JOIN filtered_inventory i ON ss.ss_item_sk = i.inv_item_sk AND i.inv_quantity_on_hand >= ss.ss_quantity"
      }
    }
  ]
}