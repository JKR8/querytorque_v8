[
  {
    "plan_id": "compile_p1",
    "dialect": "postgres",
    "confidence": 0.25,
    "based_on": "",
    "strategy": "Safe no-change fallback due to insufficient evidence.",
    "hypothesis": "All four probes regressed (0.88x) or failed; CTE materialization fences likely blocked pushdown and increased overhead. No winning evidence supports a safe rewrite.",
    "expected_explain_delta": "No change; preserve original plan.",
    "target_ir": "Keep original join topology and aggregation.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": [],
          "outputs": ["i_item_desc", "w_warehouse_name", "d_week_seq", "no_promo", "promo", "total_cnt"],
          "changed": false
        }
      ]
    }
  },
  {
    "plan_id": "compile_p2",
    "dialect": "postgres",
    "confidence": 0.35,
    "based_on": "",
    "strategy": "Remove redundant left join to catalog_returns and retain explicit join syntax.",
    "hypothesis": "catalog_returns left join uses primary key but no columns are selected; removal eliminates a potential join branch without semantic change. Avoids CTE fences that caused regressions.",
    "expected_explain_delta": "Eliminate one left join branch; may reduce join complexity.",
    "target_ir": "Update final_select by dropping unused left join.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": [],
          "outputs": ["i_item_desc", "w_warehouse_name", "d_week_seq", "no_promo", "promo", "total_cnt"],
          "changed": true,
          "sql": "select  i_item_desc\n      ,w_warehouse_name\n      ,d1.d_week_seq\n      ,sum(case when p_promo_sk is null then 1 else 0 end) no_promo\n      ,sum(case when p_promo_sk is not null then 1 else 0 end) promo\n      ,count(*) total_cnt\nfrom catalog_sales\njoin inventory on (cs_item_sk = inv_item_sk)\njoin warehouse on (w_warehouse_sk=inv_warehouse_sk)\njoin item on (i_item_sk = cs_item_sk)\njoin customer_demographics on (cs_bill_cdemo_sk = cd_demo_sk)\njoin household_demographics on (cs_bill_hdemo_sk = hd_demo_sk)\njoin date_dim d1 on (cs_sold_date_sk = d1.d_date_sk)\njoin date_dim d2 on (inv_date_sk = d2.d_date_sk)\njoin date_dim d3 on (cs_ship_date_sk = d3.d_date_sk)\nleft outer join promotion on (cs_promo_sk=p_promo_sk)\nwhere d1.d_week_seq = d2.d_week_seq\n  and inv_quantity_on_hand < cs_quantity\n  and d3.d_date > d1.d_date + interval '3 day'\n  and hd_buy_potential = '>10000'\n  and d1.d_year = 1998\n  and cd_marital_status = 'U'\n  and cd_dep_count between 9 and 11\n  and i_category IN ('Children', 'Jewelry', 'Men')\n  and cs_wholesale_cost BETWEEN 35 AND 55\ngroup by i_item_desc,w_warehouse_name,d1.d_week_seq\norder by total_cnt desc, i_item_desc, w_warehouse_name, d_week_seq\nlimit 100;"
        }
      ]
    }
  }
]