```json
[
  {
    "plan_id": "compile_p1",
    "dialect": "postgres",
    "hypothesis": "Removing unnecessary LEFT JOIN to catalog_returns (unused in SELECT/WHERE/GROUP BY) reduces join complexity while preserving semantics, as catalog_returns has primary key (cr_item_sk, cr_order_number) guaranteeing at most one match per catalog_sales row.",
    "target_ir": "Remove catalog_returns left join from final_select.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": [],
          "outputs": ["i_item_desc", "w_warehouse_name", "d_week_seq", "no_promo", "promo", "total_cnt"],
          "changed": true,
          "sql": "SELECT i_item_desc, w_warehouse_name, d1.d_week_seq, SUM(CASE WHEN p_promo_sk IS NULL THEN 1 ELSE 0 END) no_promo, SUM(CASE WHEN p_promo_sk IS NOT NULL THEN 1 ELSE 0 END) promo, COUNT(*) total_cnt FROM catalog_sales JOIN inventory ON (cs_item_sk = inv_item_sk) JOIN warehouse ON (w_warehouse_sk = inv_warehouse_sk) JOIN item ON (i_item_sk = cs_item_sk) JOIN customer_demographics ON (cs_bill_cdemo_sk = cd_demo_sk) JOIN household_demographics ON (cs_bill_hdemo_sk = hd_demo_sk) JOIN date_dim d1 ON (cs_sold_date_sk = d1.d_date_sk) JOIN date_dim d2 ON (inv_date_sk = d2.d_date_sk) JOIN date_dim d3 ON (cs_ship_date_sk = d3.d_date_sk) LEFT OUTER JOIN promotion ON (cs_promo_sk = p_promo_sk) WHERE d1.d_week_seq = d2.d_week_seq AND inv_quantity_on_hand < cs_quantity AND d3.d_date > d1.d_date + INTERVAL '3 day' AND hd_buy_potential = '>10000' AND d1.d_year = 1998 AND cd_marital_status = 'U' AND cd_dep_count BETWEEN 9 AND 11 AND i_category IN ('Children', 'Jewelry', 'Men') AND cs_wholesale_cost BETWEEN 35 AND 55 GROUP BY i_item_desc, w_warehouse_name, d1.d_week_seq ORDER BY total_cnt DESC, i_item_desc, w_warehouse_name, d_week_seq LIMIT 100"
        }
      ]
    },
    "confidence": 0.5,
    "based_on": "",
    "strategy": "Remove unused left join to simplify join graph.",
    "expected_explain_delta": "Eliminate catalog_returns scan and its associated join operator."
  },
  {
    "plan_id": "compile_p2",
    "dialect": "postgres",
    "hypothesis": "Prefilter selective dimension tables (item, customer_demographics, household_demographics, date_dim d1) and catalog_sales in a CTE to reduce rows before joining with inventory, warehouse, and remaining date_dim aliases, targeting the large Nested Loop (163k rows) and Hash Join (5.7s) hotspots.",
    "target_ir": "Add filtered_catalog_sales CTE and update final_select join graph.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "filtered_catalog_sales",
          "parent_node_id": "final_select",
          "sources": ["catalog_sales", "item", "customer_demographics", "household_demographics", "date_dim"],
          "outputs": ["cs_item_sk", "cs_order_number", "cs_quantity", "cs_wholesale_cost", "cs_bill_cdemo_sk", "cs_bill_hdemo_sk", "cs_sold_date_sk", "cs_ship_date_sk", "cs_promo_sk", "i_item_desc", "d_week_seq", "d_date"],
          "changed": true,
          "sql": "SELECT cs.cs_item_sk, cs.cs_order_number, cs.cs_quantity, cs.cs_wholesale_cost, cs.cs_bill_cdemo_sk, cs.cs_bill_hdemo_sk, cs.cs_sold_date_sk, cs.cs_ship_date_sk, cs.cs_promo_sk, i.i_item_desc, d1.d_week_seq, d1.d_date FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk JOIN date_dim d1 ON cs.cs_sold_date_sk = d1.d_date_sk WHERE cs.cs_wholesale_cost BETWEEN 35 AND 55 AND i.i_category IN ('Children', 'Jewelry', 'Men') AND cd.cd_marital_status = 'U' AND cd.cd_dep_count BETWEEN 9 AND 11 AND hd.hd_buy_potential = '>10000' AND d1.d_year = 1998"
        },
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["filtered_catalog_sales", "inventory", "warehouse", "date_dim", "date_dim", "promotion"],
          "outputs": ["i_item_desc", "w_warehouse_name", "d_week_seq", "no_promo", "promo", "total_cnt"],
          "changed": true,
          "sql": "SELECT fc.i_item_desc, w.w_warehouse_name, fc.d_week_seq, SUM(CASE WHEN p.p_promo_sk IS NULL THEN 1 ELSE 0 END) no_promo, SUM(CASE WHEN p.p_promo_sk IS NOT NULL THEN 1 ELSE 0 END) promo, COUNT(*) total_cnt FROM filtered_catalog_sales fc JOIN inventory inv ON fc.cs_item_sk = inv.inv_item_sk AND inv.inv_quantity_on_hand < fc.cs_quantity JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN date_dim d2 ON inv.inv_date_sk = d2.d_date_sk JOIN date_dim d3 ON fc.cs_ship_date_sk = d3.d_date_sk LEFT JOIN promotion p ON fc.cs_promo_sk = p.p_promo_sk WHERE fc.d_week_seq = d2.d_week_seq AND d3.d_date > fc.d_date + INTERVAL '3 day' GROUP BY fc.i_item_desc, w.w_warehouse_name, fc.d_week_seq ORDER BY total_cnt DESC, fc.i_item_desc, w.w_warehouse_name, fc.d_week_seq LIMIT 100"
        }
      ]
    },
    "confidence": 0.4,
    "based_on": "",
    "strategy": "Pre-aggregation filtering via CTE to reduce rows before non-equi joins.",
    "expected_explain_delta": "Replace large Nested Loop with filtered join, reduce Hash Join input rows."
  }
]
```