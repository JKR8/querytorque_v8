{
  "iteration": 0,
  "n_api_calls": 8,
  "beam_cost_usd": 0.02627805,
  "beam_cost_priced_calls": 8,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 98933,
    "completion_tokens": 18802,
    "total_tokens": 117735,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 34624,
    "reasoning_tokens": 10234
  },
  "best_speedup": 1.02,
  "best_patch_id": "compile_p2",
  "best_sql": "SELECT MIN(ss_quantity),\n       MIN(ss_ext_sales_price),\n       MIN(ss_ext_wholesale_cost),\n       MIN(ss_ext_wholesale_cost)\nFROM store_sales\nINNER JOIN store ON s_store_sk = ss_store_sk\nINNER JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk\nINNER JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk\nINNER JOIN customer_address ON ss_addr_sk = ca_address_sk\nINNER JOIN date_dim ON ss_sold_date_sk = d_date_sk\nWHERE d_year = 2001\n  AND (\n    (cd_marital_status = 'M'\n     AND cd_education_status = '2 yr Degree'\n     AND ss_sales_price BETWEEN 100.00 AND 150.00\n     AND hd_dep_count = 3)\n    OR\n    (cd_marital_status = 'S'\n     AND cd_education_status = 'Primary'\n     AND ss_sales_price BETWEEN 50.00 AND 100.00\n     AND hd_dep_count = 1)\n    OR\n    (cd_marital_status = 'W'\n     AND cd_education_status = 'Primary'\n     AND ss_sales_price BETWEEN 150.00 AND 200.00\n     AND hd_dep_count = 1)\n  )\n  AND (\n    (ca_country = 'United States'\n     AND ca_state IN ('GA', 'KY', 'SD')\n     AND ss_net_profit BETWEEN 100 AND 200)\n    OR\n    (ca_country = 'United States'\n     AND ca_state IN ('AR', 'IN', 'VA')\n     AND ss_net_profit BETWEEN 150 AND 300)\n    OR\n    (ca_country = 'United States'\n     AND ca_state IN ('KS', 'OH', 'SD')\n     AND ss_net_profit BETWEEN 50 AND 250)\n  );",
  "patches": [
    {
      "patch_id": "p01",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.85,
      "status": "REGRESSION",
      "speedup": 0.67,
      "semantic_passed": true,
      "error": null,
      "original_ms": 933.8,
      "patch_ms": 1384.6,
      "output_sql": "select min(ss_quantity)\n       ,min(ss_ext_sales_price)\n       ,min(ss_ext_wholesale_cost)\n       ,min(ss_ext_wholesale_cost)\n from store_sales\n     ,store\n     ,customer_demographics\n     ,household_demographics\n     ,customer_address\n     ,date_dim\n where s_store_sk = ss_store_sk\n and  ss_sold_date_sk = d_date_sk and d_year = 2001\n and((ss_hdemo_sk=hd_demo_sk\n  and cd_demo_sk = ss_cdemo_sk\n  and cd_marital_status = 'M'\n  and cd_education_status = '2 yr Degree'\n  and ss_sales_price between 100.00 and 150.00\n  and hd_dep_count = 3\n     )or\n     (ss_hdemo_sk=hd_demo_sk\n  and cd_demo_sk = ss_cdemo_sk\n  and cd_marital_status = 'S'\n  and cd_education_status = 'Primary'\n  and ss_sales_price between 50.00 and 100.00\n  and hd_dep_count = 1\n     ) or\n     (ss_hdemo_sk=hd_demo_sk\n  and cd_demo_sk = ss_cdemo_sk\n  and cd_marital_status = 'W'\n  and cd_education_status = 'Primary'\n  and ss_sales_price between 150.00 and 200.00\n  and hd_dep_count = 1\n     ))\n and((ss_addr_sk = ca_address_sk\n  and ca_country = 'United States'\n  and ca_state in ('GA', 'KY', 'SD')\n  and ss_net_profit between 100 and 200\n     ) or\n     (ss_addr_sk = ca_address_sk\n  and ca_country = 'United States'\n  and ca_state in ('AR', 'IN', 'VA')\n  and ss_net_profit between 150 and 300\n     ) or\n     (ss_addr_sk = ca_address_sk\n  and ca_country = 'United States'\n  and ca_state in ('KS', 'OH', 'SD')\n  and ss_net_profit between 50 and 250\n     ));",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Convert comma joins to explicit INNER JOIN syntax and pre\u2011filter date_dim (d_year=2001) into a CTE, then join with store_sales using explicit JOIN ON clauses."
    },
    {
      "patch_id": "p02",
      "family": "A",
      "transform": "dimension_cte_isolate",
      "relevance_score": 0.75,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Checksum mismatch",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_cd AS (SELECT cd_demo_sk FROM customer_demographics WHERE (cd_marital_status = 'M' AND cd_education_status = '2 yr Degree') OR (cd_marital_status = 'S' AND cd_education_status = 'Primary') OR (cd_marital_status = 'W' AND cd_education_status = 'Primary')), filtered_ca AS (SELECT ca_address_sk FROM customer_address WHERE ca_country = 'United States' AND (ca_state IN ('GA', 'KY', 'SD') OR ca_state IN ('AR', 'IN', 'VA') OR ca_state IN ('KS', 'OH', 'SD'))) SELECT MIN(ss_quantity), MIN(ss_ext_sales_price), MIN(ss_ext_wholesale_cost), MIN(ss_ext_wholesale_cost) FROM store_sales JOIN store ON s_store_sk = ss_store_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk AND d_year = 2001 JOIN filtered_cd ON cd_demo_sk = ss_cdemo_sk JOIN filtered_ca ON ca_address_sk = ss_addr_sk;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre\u2011filter customer_demographics and customer_address into separate CTEs embedding their OR\u2011branch predicates before joining to store_sales."
    },
    {
      "patch_id": "p03",
      "family": "A",
      "transform": "multi_dimension_prefetch",
      "relevance_score": 0.65,
      "status": "NEUTRAL",
      "speedup": 0.97,
      "semantic_passed": true,
      "error": null,
      "original_ms": 933.8,
      "patch_ms": 959.4,
      "output_sql": "WITH filtered_date_dim AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001), filtered_household_demographics AS (SELECT hd_demo_sk, hd_dep_count FROM household_demographics WHERE hd_dep_count IN (3, 1)), filtered_store AS (SELECT s_store_sk FROM store), filtered_customer_demographics AS (SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics), filtered_customer_address AS (SELECT ca_address_sk, ca_country, ca_state FROM customer_address WHERE ca_country = 'United States'), main_join AS (SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost FROM store_sales ss JOIN filtered_date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN filtered_household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN filtered_store s ON ss.ss_store_sk = s.s_store_sk JOIN filtered_customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN filtered_customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk WHERE ((cd.cd_marital_status = 'M' AND cd.cd_education_status = '2 yr Degree' AND ss.ss_sales_price BETWEEN 100.00 AND 150.00 AND hd.hd_dep_count = 3) OR (cd.cd_marital_status = 'S' AND cd.cd_education_status = 'Primary' AND ss.ss_sales_price BETWEEN 50.00 AND 100.00 AND hd.hd_dep_count = 1) OR (cd.cd_marital_status = 'W' AND cd.cd_education_status = 'Primary' AND ss.ss_sales_price BETWEEN 150.00 AND 200.00 AND hd.hd_dep_count = 1)) AND ((ca.ca_country = 'United States' AND ca.ca_state IN ('GA', 'KY', 'SD') AND ss.ss_net_profit BETWEEN 100 AND 200) OR (ca.ca_country = 'United States' AND ca.ca_state IN ('AR', 'IN', 'VA') AND ss.ss_net_profit BETWEEN 150 AND 300) OR (ca.ca_country = 'United States' AND ca.ca_state IN ('KS', 'OH', 'SD') AND ss.ss_net_profit BETWEEN 50 AND 250))) SELECT MIN(ss_quantity), MIN(ss_ext_sales_price), MIN(ss_ext_wholesale_cost), MIN(ss_ext_wholesale_cost) FROM main_join;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Create CTEs for all dimension tables (date_dim, household_demographics, store, customer_demographics, customer_address) with their selective filters, then join them to store_sales in a single explicit\u2011join chain."
    },
    {
      "patch_id": "p04",
      "family": "B",
      "transform": "early_filter_decorrelate",
      "relevance_score": 0.55,
      "status": "REGRESSION",
      "speedup": 0.52,
      "semantic_passed": true,
      "error": null,
      "original_ms": 933.8,
      "patch_ms": 1803.8,
      "output_sql": "WITH hd_filtered AS (SELECT hd_demo_sk, hd_dep_count FROM household_demographics WHERE hd_dep_count IN (3, 1)), s_filtered AS (SELECT s_store_sk FROM store) SELECT MIN(ss_quantity), MIN(ss_ext_sales_price), MIN(ss_ext_wholesale_cost), MIN(ss_ext_wholesale_cost) FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN hd_filtered hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN customer_demographics cd ON cd.cd_demo_sk = ss.ss_cdemo_sk JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN s_filtered s ON s.s_store_sk = ss.ss_store_sk WHERE d.d_year = 2001 AND ((cd.cd_marital_status = 'M' AND cd.cd_education_status = '2 yr Degree' AND ss.ss_sales_price BETWEEN 100.00 AND 150.00 AND hd.hd_dep_count = 3) OR (cd.cd_marital_status = 'S' AND cd.cd_education_status = 'Primary' AND ss.ss_sales_price BETWEEN 50.00 AND 100.00 AND hd.hd_dep_count = 1) OR (cd.cd_marital_status = 'W' AND cd.cd_education_status = 'Primary' AND ss.ss_sales_price BETWEEN 150.00 AND 200.00 AND hd.hd_dep_count = 1)) AND ((ca.ca_country = 'United States' AND ca.ca_state IN ('GA', 'KY', 'SD') AND ss.ss_net_profit BETWEEN 100 AND 200) OR (ca.ca_country = 'United States' AND ca.ca_state IN ('AR', 'IN', 'VA') AND ss.ss_net_profit BETWEEN 150 AND 300) OR (ca.ca_country = 'United States' AND ca.ca_state IN ('KS', 'OH', 'SD') AND ss.ss_net_profit BETWEEN 50 AND 250));",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Apply early filter pushdown to household_demographics and store, and convert implicit join predicates to explicit JOIN ON clauses."
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.73,
      "semantic_passed": true,
      "error": null,
      "original_ms": 1342.3,
      "patch_ms": 1830.7,
      "output_sql": "select min(ss_quantity)\n       ,min(ss_ext_sales_price)\n       ,min(ss_ext_wholesale_cost)\n       ,min(ss_ext_wholesale_cost)\n from store_sales\n     ,store\n     ,customer_demographics\n     ,household_demographics\n     ,customer_address\n     ,date_dim\n where s_store_sk = ss_store_sk\n and  ss_sold_date_sk = d_date_sk and d_year = 2001\n and((ss_hdemo_sk=hd_demo_sk\n  and cd_demo_sk = ss_cdemo_sk\n  and cd_marital_status = 'M'\n  and cd_education_status = '2 yr Degree'\n  and ss_sales_price between 100.00 and 150.00\n  and hd_dep_count = 3\n     )or\n     (ss_hdemo_sk=hd_demo_sk\n  and cd_demo_sk = ss_cdemo_sk\n  and cd_marital_status = 'S'\n  and cd_education_status = 'Primary'\n  and ss_sales_price between 50.00 and 100.00\n  and hd_dep_count = 1\n     ) or\n     (ss_hdemo_sk=hd_demo_sk\n  and cd_demo_sk = ss_cdemo_sk\n  and cd_marital_status = 'W'\n  and cd_education_status = 'Primary'\n  and ss_sales_price between 150.00 and 200.00\n  and hd_dep_count = 1\n     ))\n and((ss_addr_sk = ca_address_sk\n  and ca_country = 'United States'\n  and ca_state in ('GA', 'KY', 'SD')\n  and ss_net_profit between 100 and 200\n     ) or\n     (ss_addr_sk = ca_address_sk\n  and ca_country = 'United States'\n  and ca_state in ('AR', 'IN', 'VA')\n  and ss_net_profit between 150 and 300\n     ) or\n     (ss_addr_sk = ca_address_sk\n  and ca_country = 'United States'\n  and ca_state in ('KS', 'OH', 'SD')\n  and ss_net_profit between 50 and 250\n     ));",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p2",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "NEUTRAL",
      "speedup": 1.02,
      "semantic_passed": true,
      "error": null,
      "original_ms": 1342.3,
      "patch_ms": 1314.7,
      "output_sql": "SELECT MIN(ss_quantity),\n       MIN(ss_ext_sales_price),\n       MIN(ss_ext_wholesale_cost),\n       MIN(ss_ext_wholesale_cost)\nFROM store_sales\nINNER JOIN store ON s_store_sk = ss_store_sk\nINNER JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk\nINNER JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk\nINNER JOIN customer_address ON ss_addr_sk = ca_address_sk\nINNER JOIN date_dim ON ss_sold_date_sk = d_date_sk\nWHERE d_year = 2001\n  AND (\n    (cd_marital_status = 'M'\n     AND cd_education_status = '2 yr Degree'\n     AND ss_sales_price BETWEEN 100.00 AND 150.00\n     AND hd_dep_count = 3)\n    OR\n    (cd_marital_status = 'S'\n     AND cd_education_status = 'Primary'\n     AND ss_sales_price BETWEEN 50.00 AND 100.00\n     AND hd_dep_count = 1)\n    OR\n    (cd_marital_status = 'W'\n     AND cd_education_status = 'Primary'\n     AND ss_sales_price BETWEEN 150.00 AND 200.00\n     AND hd_dep_count = 1)\n  )\n  AND (\n    (ca_country = 'United States'\n     AND ca_state IN ('GA', 'KY', 'SD')\n     AND ss_net_profit BETWEEN 100 AND 200)\n    OR\n    (ca_country = 'United States'\n     AND ca_state IN ('AR', 'IN', 'VA')\n     AND ss_net_profit BETWEEN 150 AND 300)\n    OR\n    (ca_country = 'United States'\n     AND ca_state IN ('KS', 'OH', 'SD')\n     AND ss_net_profit BETWEEN 50 AND 250)\n  );",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p01": "Aggregate  (rows=1, time=1055.538)\n  Gather  (rows=3, time=1055.519)\n    Aggregate  (rows=1, time=694.446)\n      Nested Loop  (rows=22, time=694.32)\n        Nested Loop  (rows=980, time=675.557)\n          Hash Join  (rows=6247, time=592.396)\n            Hash Join  (rows=6265, time=589.641)\n              Nested Loop  (rows=56045, time=572.203)\n                Index Only Scan on date_dim  (rows=122, time=2.028)\n                Index Only Scan on store_sales  (rows=461, time=4.646)\n              Ha",
    "p03": "Aggregate  (rows=1, time=1084.382)\n  Gather  (rows=3, time=1084.37)\n    Aggregate  (rows=1, time=705.324)\n      Nested Loop  (rows=22, time=705.181)\n        Nested Loop  (rows=22, time=704.908)\n          Nested Loop  (rows=981, time=685.098)\n            Hash Join  (rows=6265, time=601.53)\n              Nested Loop  (rows=56045, time=583.751)\n                Index Only Scan on date_dim  (rows=122, time=2.19)\n                Index Only Scan on store_sales (ss)  (rows=461, time=4.74)\n              ",
    "p04": "Aggregate  (rows=1, time=1005.005)\n  Gather  (rows=3, time=1004.988)\n    Aggregate  (rows=1, time=659.489)\n      Nested Loop  (rows=22, time=659.33)\n        Nested Loop  (rows=22, time=659.051)\n          Nested Loop  (rows=981, time=640.596)\n            Hash Join  (rows=6265, time=561.477)\n              Nested Loop  (rows=56045, time=545.154)\n                Index Only Scan on date_dim (d)  (rows=122, time=1.527)\n                Index Only Scan on store_sales (ss)  (rows=461, time=4.43)\n        ",
    "compile_p1": "Aggregate  (rows=1, time=2572.948)\n  Gather  (rows=1, time=2572.931)\n    Aggregate  (rows=1, time=2572.186)\n      Nested Loop  (rows=65, time=2571.743)\n        Nested Loop  (rows=2940, time=2487.771)\n          Hash Join  (rows=18741, time=2136.424)\n            Hash Join  (rows=18795, time=2125.435)\n              Nested Loop  (rows=168134, time=2052.358)\n                Index Only Scan on date_dim  (rows=365, time=3.708)\n                Index Only Scan on store_sales  (rows=461, time=5.566)\n     ",
    "compile_p2": "Aggregate  (rows=1, time=1623.44)\n  Gather  (rows=2, time=1623.404)\n    Aggregate  (rows=1, time=1542.603)\n      Nested Loop  (rows=32, time=1542.318)\n        Nested Loop  (rows=1470, time=1497.89)\n          Hash Join  (rows=9370, time=1307.664)\n            Hash Join  (rows=9398, time=1301.216)\n              Nested Loop  (rows=84067, time=1260.806)\n                Index Only Scan on date_dim  (rows=182, time=159.1)\n                Index Only Scan on store_sales  (rows=461, time=5.986)\n          "
  }
}