{
  "probe_id": "p01",
  "transform_id": "materialize_cte",
  "family": "E",
  "dialect": "postgres",
  "hypothesis": "Materializing filtered_item_cte and filtered_date_cte with MATERIALIZED keyword prevents predicate blindness and reduces repeated dimension rescans in correlated EXISTS subqueries.",
  "reasoning_trace": [
    "EXISTS subqueries in store_sales, web_sales, and catalog_sales repeat the same item and date filters.",
    "PostgreSQL can materialize CTEs to avoid recomputing shared predicates across multiple correlated subquery loops.",
    "This avoids repeated index scans on item and date_dim inside nested loop joins."
  ],
  "target_ir": "Two materialized CTEs (filtered_item_cte, filtered_date_cte) are added to the top-level WITH clause and referenced in the main query.",
  "steps": [
    {
      "step_id": "s1",
      "op": "insert_cte",
      "target": {"by_node_id": "S0"},
      "payload": {
        "cte_name": "filtered_item_cte",
        "cte_query_sql": "SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100"
      }
    },
    {
      "step_id": "s2",
      "op": "insert_cte",
      "target": {"by_node_id": "S0"},
      "payload": {
        "cte_name": "filtered_date_cte",
        "cte_query_sql": "SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy BETWEEN 5 AND 8"
      }
    }
  ]
}