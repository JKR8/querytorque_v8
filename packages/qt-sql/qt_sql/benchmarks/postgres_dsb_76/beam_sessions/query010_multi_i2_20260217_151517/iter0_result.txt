{
  "iteration": 0,
  "n_api_calls": 24,
  "beam_cost_usd": 0.1164248,
  "beam_cost_priced_calls": 24,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 150223,
    "completion_tokens": 37027,
    "total_tokens": 187250,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 56000
  },
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "p05",
      "family": "A",
      "transform": "date_cte_isolate",
      "relevance_score": 0.85,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date_cte AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy BETWEEN 5 AND 8) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c, customer_address AS ca, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County') AND c.c_birth_month IN (4, 5) AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('U', 'S', 'U') AND cd_education_status IN ('College', 'Secondary', 'College') AND cd_gender = 'M' AND EXISTS(SELECT * FROM store_sales, date_dim, item WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND ss_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 75 * 0.01 AND i_manager_id BETWEEN 91 AND 100) AND (EXISTS(SELECT * FROM web_sales, date_dim, item WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND ws_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100 AND ws_sales_price / ws_list_price BETWEEN 65 * 0.01 AND 75 * 0.01) OR EXISTS(SELECT * FROM catalog_sales, date_dim, item WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND cs_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100 AND cs_sales_price / cs_list_price BETWEEN 65 * 0.01 AND 75 * 0.01)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "has_explain": false,
      "description": "Create filtered_date_cte AS MATERIALIZED SELECT d_date_sk FROM date_dim WHERE d_year=1999 AND d_moy BETWEEN 5 AND 8. Replace all date_dim scans in sales CTEs with this CTE"
    },
    {
      "patch_id": "p08",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.9,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics AS cd ON cd.cd_demo_sk = c.c_current_cdemo_sk WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County') AND c.c_birth_month IN (4, 5) AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('U', 'S', 'U') AND cd_education_status IN ('College', 'Secondary', 'College') AND cd_gender = 'M' AND EXISTS(SELECT * FROM store_sales, date_dim, item WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND ss_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 75 * 0.01 AND i_manager_id BETWEEN 91 AND 100) AND (EXISTS(SELECT * FROM web_sales, date_dim, item WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND ws_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100 AND ws_sales_price / ws_list_price BETWEEN 65 * 0.01 AND 75 * 0.01) OR EXISTS(SELECT * FROM catalog_sales, date_dim, item WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND cs_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100 AND cs_sales_price / cs_list_price BETWEEN 65 * 0.01 AND 75 * 0.01)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "has_explain": false,
      "description": "Convert main FROM clause to explicit joins: customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics ON cd_demo_sk = c.c_current_cdemo_sk"
    },
    {
      "patch_id": "p13",
      "family": "F",
      "transform": "inner_join_conversion",
      "relevance_score": 0.95,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c INNER JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County') AND c.c_birth_month IN (4, 5) AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('U', 'S', 'U') AND cd_education_status IN ('College', 'Secondary', 'College') AND cd_gender = 'M' AND EXISTS(SELECT * FROM store_sales, date_dim, item WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND ss_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 75 * 0.01 AND i_manager_id BETWEEN 91 AND 100) AND (EXISTS(SELECT * FROM web_sales, date_dim, item WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND ws_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100 AND ws_sales_price / ws_list_price BETWEEN 65 * 0.01 AND 75 * 0.01) OR EXISTS(SELECT * FROM catalog_sales, date_dim, item WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND cs_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100 AND cs_sales_price / cs_list_price BETWEEN 65 * 0.01 AND 75 * 0.01)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "has_explain": false,
      "description": "Convert customer_address join to INNER JOIN since ca_county filter eliminates NULLs"
    },
    {
      "patch_id": "p01",
      "family": "B",
      "transform": "early_filter_decorrelate",
      "relevance_score": 0.92,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: COLUMN REF MISMATCH: Original columns missing from rewrite \u2014 ['cs_item_sk', 'cs_list_price', 'cs_sales_price', 'cs_ship_customer_sk', 'cs_sold_date_sk']. The rewrite references different table columns.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH store_sales_filtered AS (SELECT DISTINCT ss_customer_sk FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN item ON ss_item_sk = i_item_sk WHERE d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND i_category IN ('Children', 'Home', 'Women') AND ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 75 * 0.01 AND i_manager_id BETWEEN 91 AND 100) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c, customer_address AS ca, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County') AND c.c_birth_month IN (4, 5) AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('U', 'S', 'U') AND cd_education_status IN ('College', 'Secondary', 'College') AND cd_gender = 'M' AND c.c_customer_sk IN (SELECT ss_customer_sk FROM store_sales_filtered) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "has_explain": false,
      "description": "Decorate store_sales EXISTS: Create CTE store_sales_cte SELECT DISTINCT ss_customer_sk FROM store_sales JOIN date_dim JOIN item WITH filters. Replace EXISTS with c.c_customer_sk IN (SELECT ss_customer_sk FROM store_sales_cte)"
    },
    {
      "patch_id": "p06",
      "family": "A",
      "transform": "dimension_cte_isolate",
      "relevance_score": 0.85,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: LITERAL MISMATCH: Original literals missing from rewrite \u2014 numbers: ['0.01', '1999.0', '3.0', '65.0', '75.0']. The rewrite changed filter values instead of preserving them.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_item_cte AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c, customer_address AS ca, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County') AND c.c_birth_month IN (4, 5) AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('U', 'S', 'U') AND cd_education_status IN ('College', 'Secondary', 'College') AND cd_gender = 'M' GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "has_explain": false,
      "description": "Create filtered_item_cte AS MATERIALIZED SELECT i_item_sk FROM item WHERE i_category IN ('Children','Home','Women') AND i_manager_id BETWEEN 91 AND 100. Replace all item scans in sales CTEs with this CTE"
    },
    {
      "patch_id": "p02",
      "family": "B",
      "transform": "early_filter_decorrelate",
      "relevance_score": 0.92,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH web_sales_cte AS (SELECT DISTINCT ws_bill_customer_sk FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN item ON ws_item_sk = i_item_sk WHERE d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100 AND ws_sales_price / ws_list_price BETWEEN 65 * 0.01 AND 75 * 0.01) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c, customer_address AS ca, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County') AND c.c_birth_month IN (4, 5) AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('U', 'S', 'U') AND cd_education_status IN ('College', 'Secondary', 'College') AND cd_gender = 'M' AND EXISTS(SELECT * FROM store_sales, date_dim AS d1, item AS i1 WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d1.d_date_sk AND d1.d_year = 1999 AND d1.d_moy BETWEEN 5 AND 5 + 3 AND ss_item_sk = i1.i_item_sk AND i1.i_category IN ('Children', 'Home', 'Women') AND i1.i_manager_id BETWEEN 91 AND 100 AND ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 75 * 0.01) AND (c.c_customer_sk IN (SELECT ws_bill_customer_sk FROM web_sales_cte) OR EXISTS(SELECT * FROM catalog_sales, date_dim AS d2, item AS i2 WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d2.d_date_sk AND d2.d_year = 1999 AND d2.d_moy BETWEEN 5 AND 5 + 3 AND cs_item_sk = i2.i_item_sk AND i2.i_category IN ('Children', 'Home', 'Women') AND i2.i_manager_id BETWEEN 91 AND 100 AND cs_sales_price / cs_list_price BETWEEN 65 * 0.01 AND 75 * 0.01)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "has_explain": false,
      "description": "Decorate web_sales EXISTS: Create CTE web_sales_cte SELECT DISTINCT ws_bill_customer_sk FROM web_sales JOIN date_dim JOIN item WITH filters. Replace EXISTS with c.c_customer_sk IN (SELECT ws_bill_customer_sk FROM web_sales_cte)"
    },
    {
      "patch_id": "p03",
      "family": "B",
      "transform": "early_filter_decorrelate",
      "relevance_score": 0.92,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH catalog_sales_cte AS (SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk JOIN item ON cs_item_sk = i_item_sk WHERE d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND i_category IN ('Children', 'Home', 'Women') AND cs_sales_price / cs_list_price BETWEEN 65 * 0.01 AND 75 * 0.01 AND i_manager_id BETWEEN 91 AND 100) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c, customer_address AS ca, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County') AND c.c_birth_month IN (4, 5) AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('U', 'S', 'U') AND cd_education_status IN ('College', 'Secondary', 'College') AND cd_gender = 'M' AND EXISTS(SELECT * FROM store_sales, date_dim, item WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND ss_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 75 * 0.01 AND i_manager_id BETWEEN 91 AND 100) AND (EXISTS(SELECT * FROM web_sales, date_dim, item WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND ws_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100 AND ws_sales_price / ws_list_price BETWEEN 65 * 0.01 AND 75 * 0.01) OR c.c_customer_sk IN (SELECT cs_ship_customer_sk FROM catalog_sales_cte)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "has_explain": false,
      "description": "Decorate catalog_sales EXISTS: Create CTE catalog_sales_cte SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales JOIN date_dim JOIN item WITH filters. Replace EXISTS with c.c_customer_sk IN (SELECT cs_ship_customer_sk FROM catalog_sales_cte)"
    },
    {
      "patch_id": "p12",
      "family": "A",
      "transform": "early_filter",
      "relevance_score": 0.85,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH ca_filtered AS (SELECT * FROM customer_address WHERE ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County')) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c JOIN ca_filtered AS ca ON c.c_current_addr_sk = ca.ca_address_sk, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County') AND c.c_birth_month IN (4, 5) AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('U', 'S', 'U') AND cd_education_status IN ('College', 'Secondary', 'College') AND cd_gender = 'M' AND EXISTS(SELECT * FROM store_sales, date_dim, item WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND ss_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 75 * 0.01 AND i_manager_id BETWEEN 91 AND 100) AND (EXISTS(SELECT * FROM web_sales, date_dim, item WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND ws_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100 AND ws_sales_price / ws_list_price BETWEEN 65 * 0.01 AND 75 * 0.01) OR EXISTS(SELECT * FROM catalog_sales, date_dim, item WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND cs_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100 AND cs_sales_price / cs_list_price BETWEEN 65 * 0.01 AND 75 * 0.01)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "has_explain": false,
      "description": "Add county filter to customer_address CTE: Create ca_filtered AS SELECT * FROM customer_address WHERE ca_county IN (...). Join with customer in main query"
    },
    {
      "patch_id": "p10",
      "family": "A",
      "transform": "shared_dimension_multi_channel",
      "relevance_score": 0.78,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date_cte AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy BETWEEN 5 AND 8), filtered_item_cte AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c, customer_address AS ca, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County') AND c.c_birth_month IN (4, 5) AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('U', 'S', 'U') AND cd_education_status IN ('College', 'Secondary', 'College') AND cd_gender = 'M' AND EXISTS(SELECT * FROM store_sales, date_dim, item WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND ss_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 75 * 0.01 AND i_manager_id BETWEEN 91 AND 100) AND (EXISTS(SELECT * FROM web_sales, date_dim, item WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND ws_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100 AND ws_sales_price / ws_list_price BETWEEN 65 * 0.01 AND 75 * 0.01) OR EXISTS(SELECT * FROM catalog_sales, date_dim, item WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND cs_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100 AND cs_sales_price / cs_list_price BETWEEN 65 * 0.01 AND 75 * 0.01)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "has_explain": false,
      "description": "Consolidate dimension CTEs: Replace individual date/item CTEs in sales CTEs with shared filtered_date_cte and filtered_item_cte"
    },
    {
      "patch_id": "p09",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.8,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_customer_demographics AS (SELECT * FROM customer_demographics WHERE cd_gender = 'M' AND cd_marital_status IN ('U', 'S', 'U') AND cd_education_status IN ('College', 'Secondary', 'College')) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN filtered_customer_demographics AS cd ON cd.cd_demo_sk = c.c_current_cdemo_sk WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County') AND c.c_birth_month IN (4, 5) AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('U', 'S', 'U') AND cd_education_status IN ('College', 'Secondary', 'College') AND cd_gender = 'M' AND EXISTS(SELECT * FROM store_sales, date_dim, item WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND ss_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 75 * 0.01 AND i_manager_id BETWEEN 91 AND 100) AND (EXISTS(SELECT * FROM web_sales, date_dim, item WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND ws_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100 AND ws_sales_price / ws_list_price BETWEEN 65 * 0.01 AND 75 * 0.01) OR EXISTS(SELECT * FROM catalog_sales, date_dim, item WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND cs_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100 AND cs_sales_price / cs_list_price BETWEEN 65 * 0.01 AND 75 * 0.01)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "has_explain": false,
      "description": "Add filtered dimension CTEs to main query: Pre-join customer with filtered customer_demographics CTE (WHERE cd_gender='M' AND cd_marital_status IN (...) AND cd_education_status IN (...))"
    },
    {
      "patch_id": "p07",
      "family": "E",
      "transform": "pg_self_join_decomposition",
      "relevance_score": 0.88,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH date_filter AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3), filtered_item AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100), store_sales_filtered AS (SELECT ss_customer_sk, ss_item_sk, ss_sales_price, ss_list_price FROM store_sales WHERE EXISTS(SELECT 1 FROM date_filter AS df WHERE df.d_date_sk = ss_sold_date_sk) AND EXISTS(SELECT 1 FROM filtered_item AS fi WHERE fi.i_item_sk = ss_item_sk)), web_sales_filtered AS (SELECT ws_bill_customer_sk, ws_item_sk, ws_sales_price, ws_list_price FROM web_sales WHERE EXISTS(SELECT 1 FROM date_filter AS df WHERE df.d_date_sk = ws_sold_date_sk) AND EXISTS(SELECT 1 FROM filtered_item AS fi WHERE fi.i_item_sk = ws_item_sk)), catalog_sales_filtered AS (SELECT cs_ship_customer_sk, cs_item_sk, cs_sales_price, cs_list_price FROM catalog_sales WHERE EXISTS(SELECT 1 FROM date_filter AS df WHERE df.d_date_sk = cs_sold_date_sk) AND EXISTS(SELECT 1 FROM filtered_item AS fi WHERE fi.i_item_sk = cs_item_sk)) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics AS cd ON cd.cd_demo_sk = c.c_current_cdemo_sk WHERE ca.ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County') AND c.c_birth_month IN (4, 5) AND cd.cd_marital_status IN ('U', 'S', 'U') AND cd.cd_education_status IN ('College', 'Secondary', 'College') AND cd.cd_gender = 'M' AND EXISTS(SELECT 1 FROM store_sales_filtered AS ssf WHERE c.c_customer_sk = ssf.ss_customer_sk AND ssf.ss_sales_price / ssf.ss_list_price BETWEEN 65 * 0.01 AND 75 * 0.01) AND (EXISTS(SELECT 1 FROM web_sales_filtered AS wsf WHERE c.c_customer_sk = wsf.ws_bill_customer_sk AND wsf.ws_sales_price / wsf.ws_list_price BETWEEN 65 * 0.01 AND 75 * 0.01) OR EXISTS(SELECT 1 FROM catalog_sales_filtered AS csf WHERE c.c_customer_sk = csf.cs_ship_customer_sk AND csf.cs_sales_price / csf.cs_list_price BETWEEN 65 * 0.01 AND 75 * 0.01)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "has_explain": false,
      "description": "Materialize sales CTEs: Add MATERIALIZED keyword to store_sales_cte, web_sales_cte, catalog_sales_cte definitions to prevent inlining"
    },
    {
      "patch_id": "p11",
      "family": "E",
      "transform": "materialize_cte",
      "relevance_score": 0.7,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_item_cte AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100), filtered_date_cte AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy BETWEEN 5 AND 8) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c, customer_address AS ca, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County') AND c.c_birth_month IN (4, 5) AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('U', 'S', 'U') AND cd_education_status IN ('College', 'Secondary', 'College') AND cd_gender = 'M' AND EXISTS(SELECT * FROM store_sales, date_dim, item WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND ss_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 75 * 0.01 AND i_manager_id BETWEEN 91 AND 100) AND (EXISTS(SELECT * FROM web_sales, date_dim, item WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND ws_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100 AND ws_sales_price / ws_list_price BETWEEN 65 * 0.01 AND 75 * 0.01) OR EXISTS(SELECT * FROM catalog_sales, date_dim, item WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND cs_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100 AND cs_sales_price / cs_list_price BETWEEN 65 * 0.01 AND 75 * 0.01)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "has_explain": false,
      "description": "Force materialization of filtered_date_cte and filtered_item_cte with MATERIALIZED keyword"
    },
    {
      "patch_id": "p04",
      "family": "B",
      "transform": "composite_decorrelate_union",
      "relevance_score": 0.75,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH web_catalog_union AS ((SELECT ws_bill_customer_sk AS customer_sk FROM web_sales WHERE ws_sold_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3) AND ws_item_sk IN (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100) AND ws_sales_price / ws_list_price BETWEEN 65 * 0.01 AND 75 * 0.01) UNION (SELECT cs_ship_customer_sk AS customer_sk FROM catalog_sales WHERE cs_sold_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3) AND cs_item_sk IN (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100) AND cs_sales_price / cs_list_price BETWEEN 65 * 0.01 AND 75 * 0.01)) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c, customer_address AS ca, customer_demographics WHERE c.c_current_addr_sk = ca.ca_address_sk AND ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County') AND c.c_birth_month IN (4, 5) AND cd_demo_sk = c.c_current_cdemo_sk AND cd_marital_status IN ('U', 'S', 'U') AND cd_education_status IN ('College', 'Secondary', 'College') AND cd_gender = 'M' AND EXISTS(SELECT 1 FROM store_sales, date_dim, item WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3 AND ss_item_sk = i_item_sk AND i_category IN ('Children', 'Home', 'Women') AND ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 75 * 0.01 AND i_manager_id BETWEEN 91 AND 100) AND c.c_customer_sk IN (SELECT customer_sk FROM web_catalog_union) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "has_explain": false,
      "description": "Combine web/catalog EXISTS: Create CTE web_catalog_union AS (SELECT ws_bill_customer_sk FROM web_sales_cte UNION SELECT cs_ship_customer_sk FROM catalog_sales_cte). Replace OR condition with c.c_customer_sk IN (SELECT * FROM web_catalog_union)"
    },
    {
      "patch_id": "p14",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.65,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: COLUMN REF MISMATCH: Original columns missing from rewrite \u2014 ['cs_item_sk', 'cs_list_price', 'cs_sales_price', 'cs_ship_customer_sk', 'cs_sold_date_sk']. The rewrite references different table columns.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH store_sales_agg AS (SELECT ss_customer_sk, COUNT(*) AS ss_count FROM store_sales WHERE ss_sold_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy BETWEEN 5 AND 5 + 3) AND ss_item_sk IN (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100) AND ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 75 * 0.01 GROUP BY ss_customer_sk) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics AS cd ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN store_sales_agg AS ssa ON ssa.ss_customer_sk = c.c_customer_sk WHERE ca.ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County') AND c.c_birth_month IN (4, 5) AND cd.cd_marital_status IN ('U', 'S', 'U') AND cd.cd_education_status IN ('College', 'Secondary', 'College') AND cd.cd_gender = 'M' GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "has_explain": false,
      "description": "Push COUNT() into sales CTEs: Modify store_sales_cte to include COUNT() per customer, then reference in main SELECT"
    },
    {
      "patch_id": "snipe_p1",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: LITERAL MISMATCH: Original literals missing from rewrite \u2014 numbers: ['3.0']. The rewrite changed filter values instead of preserving them.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH store_sales_cte AS (SELECT DISTINCT ss_customer_sk FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN item ON ss_item_sk = i_item_sk WHERE d_year = 1999 AND d_moy BETWEEN 5 AND 8 AND i_category IN ('Children', 'Home', 'Women') AND ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 75 * 0.01 AND i_manager_id BETWEEN 91 AND 100), web_catalog_union AS (SELECT ws_bill_customer_sk AS customer_sk FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN item ON ws_item_sk = i_item_sk WHERE d_year = 1999 AND d_moy BETWEEN 5 AND 8 AND i_category IN ('Children', 'Home', 'Women') AND ws_sales_price / ws_list_price BETWEEN 65 * 0.01 AND 75 * 0.01 AND i_manager_id BETWEEN 91 AND 100 UNION SELECT cs_ship_customer_sk FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk JOIN item ON cs_item_sk = i_item_sk WHERE d_year = 1999 AND d_moy BETWEEN 5 AND 8 AND i_category IN ('Children', 'Home', 'Women') AND cs_sales_price / cs_list_price BETWEEN 65 * 0.01 AND 75 * 0.01 AND i_manager_id BETWEEN 91 AND 100) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics AS cd ON cd_demo_sk = c.c_current_cdemo_sk WHERE ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County') AND c.c_birth_month IN (4, 5) AND cd_marital_status IN ('U', 'S', 'U') AND cd_education_status IN ('College', 'Secondary', 'College') AND cd_gender = 'M' AND c.c_customer_sk IN (SELECT ss_customer_sk FROM store_sales_cte) AND c.c_customer_sk IN (SELECT customer_sk FROM web_catalog_union) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p2",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: LITERAL MISMATCH: Original literals missing from rewrite \u2014 numbers: ['3.0']. The rewrite changed filter values instead of preserving them.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy BETWEEN 5 AND 8), filtered_item AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics AS cd ON cd.cd_demo_sk = c.c_current_cdemo_sk WHERE ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County') AND c.c_birth_month IN (4, 5) AND cd_marital_status IN ('U', 'S', 'U') AND cd_education_status IN ('College', 'Secondary', 'College') AND cd_gender = 'M' AND EXISTS(SELECT * FROM store_sales JOIN filtered_date ON ss_sold_date_sk = d_date_sk JOIN filtered_item ON ss_item_sk = i_item_sk WHERE c.c_customer_sk = ss_customer_sk AND ss_sales_price / ss_list_price BETWEEN 65 * 0.01 AND 75 * 0.01) AND (EXISTS(SELECT * FROM web_sales JOIN filtered_date ON ws_sold_date_sk = d_date_sk JOIN filtered_item ON ws_item_sk = i_item_sk WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sales_price / ws_list_price BETWEEN 65 * 0.01 AND 75 * 0.01) OR EXISTS(SELECT * FROM catalog_sales JOIN filtered_date ON cs_sold_date_sk = d_date_sk JOIN filtered_item ON cs_item_sk = i_item_sk WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sales_price / cs_list_price BETWEEN 65 * 0.01 AND 75 * 0.01)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p1",
      "family": "A+B",
      "transform": "dimension_cte_isolate_with_sales_cte",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: LITERAL MISMATCH: Original literals missing from rewrite \u2014 numbers: ['3.0']. The rewrite changed filter values instead of preserving them.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy BETWEEN 5 AND 8), filtered_item AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100), store_sales_cte AS (SELECT ss_customer_sk FROM store_sales JOIN filtered_date ON store_sales.ss_sold_date_sk = filtered_date.d_date_sk JOIN filtered_item ON store_sales.ss_item_sk = filtered_item.i_item_sk WHERE store_sales.ss_sales_price / store_sales.ss_list_price BETWEEN 65 * 0.01 AND 75 * 0.01), web_sales_cte AS (SELECT ws_bill_customer_sk FROM web_sales JOIN filtered_date ON web_sales.ws_sold_date_sk = filtered_date.d_date_sk JOIN filtered_item ON web_sales.ws_item_sk = filtered_item.i_item_sk WHERE web_sales.ws_sales_price / web_sales.ws_list_price BETWEEN 65 * 0.01 AND 75 * 0.01), catalog_sales_cte AS (SELECT cs_ship_customer_sk FROM catalog_sales JOIN filtered_date ON catalog_sales.cs_sold_date_sk = filtered_date.d_date_sk JOIN filtered_item ON catalog_sales.cs_item_sk = filtered_item.i_item_sk WHERE catalog_sales.cs_sales_price / catalog_sales.cs_list_price BETWEEN 65 * 0.01 AND 75 * 0.01) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics ON cd_demo_sk = c.c_current_cdemo_sk WHERE ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County') AND c.c_birth_month IN (4, 5) AND cd_marital_status IN ('U', 'S', 'U') AND cd_education_status IN ('College', 'Secondary', 'College') AND cd_gender = 'M' AND EXISTS(SELECT 1 FROM store_sales_cte WHERE store_sales_cte.ss_customer_sk = c.c_customer_sk) AND (EXISTS(SELECT 1 FROM web_sales_cte WHERE web_sales_cte.ws_bill_customer_sk = c.c_customer_sk) OR EXISTS(SELECT 1 FROM catalog_sales_cte WHERE catalog_sales_cte.cs_ship_customer_sk = c.c_customer_sk)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p2",
      "family": "B+OR",
      "transform": "or_to_union_all",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: LITERAL MISMATCH: Original literals missing from rewrite \u2014 numbers: ['3.0']. The rewrite changed filter values instead of preserving them.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy BETWEEN 5 AND 8), filtered_item AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Home', 'Women') AND i_manager_id BETWEEN 91 AND 100), store_sales_cte AS (SELECT ss_customer_sk FROM store_sales JOIN filtered_date ON store_sales.ss_sold_date_sk = filtered_date.d_date_sk JOIN filtered_item ON store_sales.ss_item_sk = filtered_item.i_item_sk WHERE store_sales.ss_sales_price / store_sales.ss_list_price BETWEEN 65 * 0.01 AND 75 * 0.01), union_web_catalog AS (SELECT ws_bill_customer_sk AS customer_sk FROM web_sales JOIN filtered_date ON web_sales.ws_sold_date_sk = filtered_date.d_date_sk JOIN filtered_item ON web_sales.ws_item_sk = filtered_item.i_item_sk WHERE web_sales.ws_sales_price / web_sales.ws_list_price BETWEEN 65 * 0.01 AND 75 * 0.01 UNION ALL SELECT cs_ship_customer_sk FROM catalog_sales JOIN filtered_date ON catalog_sales.cs_sold_date_sk = filtered_date.d_date_sk JOIN filtered_item ON catalog_sales.cs_item_sk = filtered_item.i_item_sk WHERE catalog_sales.cs_sales_price / catalog_sales.cs_list_price BETWEEN 65 * 0.01 AND 75 * 0.01) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics ON cd_demo_sk = c.c_current_cdemo_sk WHERE ca_county IN ('Alameda County', 'Lexington city', 'Pender County', 'Petroleum County', 'Walworth County') AND c.c_birth_month IN (4, 5) AND cd_marital_status IN ('U', 'S', 'U') AND cd_education_status IN ('College', 'Secondary', 'College') AND cd_gender = 'M' AND EXISTS(SELECT 1 FROM store_sales_cte WHERE store_sales_cte.ss_customer_sk = c.c_customer_sk) AND EXISTS(SELECT 1 FROM union_web_catalog WHERE union_web_catalog.customer_sk = c.c_customer_sk) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100;",
      "has_explain": false,
      "description": null
    }
  ],
  "explains": {}
}