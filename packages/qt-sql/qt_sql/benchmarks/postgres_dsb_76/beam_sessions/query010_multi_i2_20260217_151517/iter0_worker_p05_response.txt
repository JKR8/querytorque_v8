{
  "probe_id": "p01",
  "transform_id": "date_cte_isolate",
  "family": "A",
  "dialect": "postgres",
  "hypothesis": "Isolate repeated date_dim scans into a single materialized CTE to reduce rescans and enable hash reuse.",
  "reasoning_trace": [
    "Plan shows 3 identical date_dim scans with d_year=1999 and d_moy BETWEEN 5 AND 8.",
    "Each scan is executed per outer row due to correlated subqueries in EXISTS clauses.",
    "Materialized CTE will allow one scan and hash-based reuse."
  ],
  "target_ir": "CTE filtered_date_cte replaces all date_dim scans; original WHERE conditions preserved via join or filter.",
  "steps": [
    {
      "step_id": "s1",
      "op": "insert_cte",
      "target": {"by_node_id": "S0"},
      "payload": {
        "cte_name": "filtered_date_cte",
        "cte_query_sql": "SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy BETWEEN 5 AND 8"
      }
    }
  ]
}