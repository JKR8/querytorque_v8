### Optimization Targets

```json
[
  {
    "family": "D",
    "transform": "set_operation_to_exists",
    "target_id": "t1",
    "relevance_score": 0.95,
    "hypothesis": "INTERSECT operations materialize large intermediate results from store_sales/catalog_sales/web_sales. Replacing with EXISTS avoids full materialization and leverages indexes on item_sk.",
    "target_ir": "S0 [SELECT]\n  CTE: cross_items  (via CTE_Q_S0_cross_items)\n    FROM: item\n    WHERE: i_category IN ('Electronics','Jewelry','Men') AND i_manager_id BETWEEN 91 AND 100\n      AND EXISTS (SELECT 1 FROM store_sales, date_dim WHERE ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 2001 AND ss_wholesale_cost BETWEEN 35 AND 55)\n      AND EXISTS (SELECT 1 FROM catalog_sales, date_dim WHERE cs_item_sk = i_item_sk AND cs_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 2001 AND cs_wholesale_cost BETWEEN 35 AND 55)\n      AND EXISTS (SELECT 1 FROM web_sales, date_dim WHERE ws_item_sk = i_item_sk AND ws_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 2001 AND ws_wholesale_cost BETWEEN 35 AND 55)",
    "recommended_examples": ["pg_intersect_to_exists"]
  },
  {
    "family": "C",
    "transform": "aggregation_pushdown",
    "target_id": "t2",
    "relevance_score": 0.85,
    "hypothesis": "avg_sales CTE processes 1.8M rows before aggregation. Pre-aggregate sales tables separately before UNION to reduce intermediate data volume.",
    "target_ir": "S0 [SELECT]\n  CTE: store_agg  (via Q1)\n    FROM: store_sales, date_dim\n    WHERE: ss_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 2001 AND ss_wholesale_cost BETWEEN 35 AND 55\n    GROUP BY: (none)\n    SELECT: SUM(ss_quantity*ss_list_price) AS sum_sales, COUNT(*) AS cnt\n  CTE: catalog_agg  (via Q2)\n    FROM: catalog_sales, date_dim\n    WHERE: cs_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 2001 AND cs_wholesale_cost BETWEEN 35 AND 55\n    GROUP BY: (none)\n    SELECT: SUM(cs_quantity*cs_list_price) AS sum_sales, COUNT(*) AS cnt\n  CTE: web_agg  (via Q3)\n    FROM: web_sales, date_dim\n    WHERE: ws_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 2001 AND ws_wholesale_cost BETWEEN 35 AND 55\n    GROUP BY: (none)\n    SELECT: SUM(ws_quantity*ws_list_price) AS sum_sales, COUNT(*) AS cnt\n  CTE: avg_sales  (via Q4)\n    FROM: store_agg, catalog_agg, web_agg\n    SELECT: (COALESCE(store_agg.sum_sales,0) + COALESCE(catalog_agg.sum_sales,0) + COALESCE(web_agg.sum_sales,0)) \n            / (COALESCE(store_agg.cnt,0) + COALESCE(catalog_agg.cnt,0) + COALESCE(web_agg.cnt,0)) AS average_sales",
    "recommended_examples": ["pg_materialized_dimension_fact_prefilter"]
  }
]
```

## Analysis
**Family A (Early Filtering)**: MEDIUM  
Filters exist on sales tables but aren't pushed into INTERSECT branches. Outer item table has redundant filters (already applied in subqueries).

**Family B (Decorrelation)**: LOW  
No correlated subqueries detected. Scalar subqueries (d_week_seq) execute once and are not performance-critical.

**Family C (Aggregation Pushdown)**: HIGH  
avg_sales CTE processes 1.8M rows before aggregation. Pre-aggregating sales tables reduces intermediate data volume significantly.

**Family D (Set Operations)**: HIGH  
INTERSECT operations materialize 384K rows from web_sales alone. EXISTS conversion avoids materialization and leverages indexes.

**Family E (Materialization)**: MEDIUM  
cross_items CTE is reused but its computation is inefficient. avg_sales is scanned twice but not the bottleneck.

**Family F (Join Transform)**: LOW  
Explicit joins already exist. No comma-join patterns or self-joins requiring restructuring.

**Chosen families**: D, C  
**Confidence**: High (both transformations address distinct bottlenecks confirmed by execution plan)