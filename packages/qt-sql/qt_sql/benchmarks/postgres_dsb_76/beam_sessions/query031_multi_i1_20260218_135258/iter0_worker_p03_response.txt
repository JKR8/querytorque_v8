{
  "probe_id": "p12",
  "transform_id": "shared_dimension_multi_channel",
  "family": "A",
  "status": "success",
  "dialect": "postgres",
  "hypothesis": "Creating a shared dimension CTE reduces redundant scans of item, date_dim, and customer_address. Each channel CTE (store_sales, web_sales) joins to this prefiltered dimension set, preserving all output semantics while reducing repeated work.",
  "reasoning_trace": [
    "Assigned transform targets shared dimension reuse across store_sales and web_sales channels.",
    "Extracted common filters on item, date_dim, and customer_address into a single CTE.",
    "Each channel now joins to the shared dimension CTE instead of scanning dimensions independently.",
    "Output columns and grouping keys preserved exactly in each aggregate CTE."
  ],
  "target_ir": "shared_dim CTE filters item, date_dim, customer_address; ss and ws CTEs join to it.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["ss1", "ss2", "ss3", "ws1", "ws2", "ws3"],
        "outputs": ["ca_county", "d_year", "web_q1_q2_increase", "store_q1_q2_increase", "web_q2_q3_increase", "store_q2_q3_increase"],
        "changed": false
      },
      {
        "node_id": "ss1",
        "parent_node_id": "final_select",
        "sources": ["ss"],
        "outputs": ["ca_county", "d_qoy", "d_year", "store_sales"],
        "changed": false
      },
      {
        "node_id": "ss2",
        "parent_node_id": "final_select",
        "sources": ["ss"],
        "outputs": ["ca_county", "d_qoy", "d_year", "store_sales"],
        "changed": false
      },
      {
        "node_id": "ss3",
        "parent_node_id": "final_select",
        "sources": ["ss"],
        "outputs": ["ca_county", "d_qoy", "d_year", "store_sales"],
        "changed": false
      },
      {
        "node_id": "ws1",
        "parent_node_id": "final_select",
        "sources": ["ws"],
        "outputs": ["ca_county", "d_qoy", "d_year", "web_sales"],
        "changed": false
      },
      {
        "node_id": "ws2",
        "parent_node_id": "final_select",
        "sources": ["ws"],
        "outputs": ["ca_county", "d_qoy", "d_year", "web_sales"],
        "changed": false
      },
      {
        "node_id": "ws3",
        "parent_node_id": "final_select",
        "sources": ["ws"],
        "outputs": ["ca_county", "d_qoy", "d_year", "web_sales"],
        "changed": false
      },
      {
        "node_id": "ss",
        "parent_node_id": "ss1",
        "sources": ["store_sales", "shared_dim"],
        "outputs": ["ca_county", "d_qoy", "d_year", "store_sales"],
        "changed": true,
        "sql": "SELECT sd.ca_county, sd.d_qoy, sd.d_year, SUM(ss.ss_ext_sales_price) AS store_sales FROM store_sales ss JOIN shared_dim sd ON ss.ss_sold_date_sk = sd.d_date_sk AND ss.ss_addr_sk = sd.ca_address_sk AND ss.ss_item_sk = sd.i_item_sk GROUP BY sd.ca_county, sd.d_qoy, sd.d_year"
      },
      {
        "node_id": "ws",
        "parent_node_id": "ws1",
        "sources": ["web_sales", "shared_dim"],
        "outputs": ["ca_county", "d_qoy", "d_year", "web_sales"],
        "changed": true,
        "sql": "SELECT sd.ca_county, sd.d_qoy, sd.d_year, SUM(ws.ws_ext_sales_price) AS web_sales FROM web_sales ws JOIN shared_dim sd ON ws.ws_sold_date_sk = sd.d_date_sk AND ws.ws_bill_addr_sk = sd.ca_address_sk AND ws.ws_item_sk = sd.i_item_sk GROUP BY sd.ca_county, sd.d_qoy, sd.d_year"
      },
      {
        "node_id": "shared_dim",
        "parent_node_id": "ss",
        "sources": ["item", "date_dim", "customer_address"],
        "outputs": ["i_item_sk", "d_date_sk", "ca_address_sk", "ca_county", "d_qoy", "d_year"],
        "changed": true,
        "sql": "SELECT i.i_item_sk, d.d_date_sk, ca.ca_address_sk, ca.ca_county, d.d_qoy, d.d_year FROM item i JOIN date_dim d ON i.i_item_sk = d.d_date_sk JOIN customer_address ca ON ca.ca_address_sk = d.d_date_sk WHERE i.i_color IN ('navajo', 'orchid') AND i.i_manager_id BETWEEN 8 AND 27 AND ca.ca_state IN ('IA','IL')"
      }
    ]
  }
}