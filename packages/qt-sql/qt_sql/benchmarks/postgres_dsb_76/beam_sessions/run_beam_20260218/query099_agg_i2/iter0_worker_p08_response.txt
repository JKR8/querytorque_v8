{
  "probe_id": "sf_sk_pushdown_multi_fact",
  "transform_id": "sf_sk_pushdown_multi_fact",
  "family": "A",
  "status": "success",
  "dialect": "postgresql",
  "hypothesis": "Pushing the date_sk range predicate derived from d_month_seq directly into catalog_sales can enable better index usage or partition pruning, reducing scanned rows.",
  "reasoning_trace": [
    "Assigned transform targets pushing date_sk range into catalog_sales join condition.",
    "The original query uses a comma join with cs_ship_date_sk = d_date_sk, enabling predicate pushdown opportunity.",
    "PostgreSQL can benefit from explicit BETWEEN on cs_ship_date_sk when d_month_seq is resolved early.",
    "No structural change needed; predicate added directly in WHERE clause of final_select."
  ],
  "target_ir": "Predicate 'cs_ship_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim WHERE d_month_seq BETWEEN 1191 AND 1214) AND (SELECT MAX(d_date_sk) FROM date_dim WHERE d_month_seq BETWEEN 1191 AND 1214)' added to final_select.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": [],
        "outputs": [
          "SUBSTRING(w_warehouse_name FROM 1 FOR 20)",
          "sm_type",
          "cc_name",
          "30 days",
          "31-60 days",
          "61-90 days",
          "91-120 days",
          ">120 days"
        ],
        "changed": true,
        "sql": "select \n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\"\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\"\nfrom\n   catalog_sales\n  ,warehouse\n  ,ship_mode\n  ,call_center\n  ,date_dim\nwhere\nd_month_seq between 1191 and 1191 + 23\nand cs_ship_date_sk   = d_date_sk\nand cs_warehouse_sk   = w_warehouse_sk\nand cs_ship_mode_sk   = sm_ship_mode_sk\nand cs_call_center_sk = cc_call_center_sk\nand cs_list_price between 244 and 273\nand sm_type = 'LIBRARY'\nand cc_class = 'medium'\nand w_gmt_offset = -5\nand cs_ship_date_sk between (select min(d_date_sk) from date_dim where d_month_seq between 1191 and 1191+23) and (select max(d_date_sk) from date_dim where d_month_seq between 1191 and 1191+23)\ngroup by\n   substring(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\norder by substring(w_warehouse_name,1,20)\n        ,sm_type\n        ,cc_name\nlimit 100;"
      }
    ]
  }
}