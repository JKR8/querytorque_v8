{
  "iteration": 0,
  "n_api_calls": 9,
  "beam_cost_usd": 0.02646438,
  "beam_cost_priced_calls": 9,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 119228,
    "completion_tokens": 13796,
    "total_tokens": 133024,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 52672,
    "reasoning_tokens": 6063
  },
  "best_speedup": 4.88,
  "best_patch_id": "compile_p1",
  "best_sql": "SELECT COUNT(*) FROM ( SELECT DISTINCT c_last_name, c_first_name, d_date FROM store_sales, date_dim, customer WHERE store_sales.ss_sold_date_sk = date_dim.d_date_sk AND store_sales.ss_customer_sk = customer.c_customer_sk AND d_month_seq BETWEEN 1200 AND 1200 + 11 AND c_birth_month IN (1, 2, 5, 12) AND ss_list_price BETWEEN 193 AND 252 AND ss_wholesale_cost BETWEEN 35 AND 55 AND EXISTS ( SELECT 1 FROM catalog_sales, date_dim dd1, customer cc1 WHERE catalog_sales.cs_sold_date_sk = dd1.d_date_sk AND catalog_sales.cs_bill_customer_sk = cc1.c_customer_sk AND dd1.d_month_seq BETWEEN 1200 AND 1200 + 11 AND cc1.c_birth_month IN (1, 2, 5, 12) AND cs_list_price BETWEEN 193 AND 252 AND cs_wholesale_cost BETWEEN 35 AND 55 AND cc1.c_last_name = customer.c_last_name AND cc1.c_first_name = customer.c_first_name AND dd1.d_date = date_dim.d_date ) AND EXISTS ( SELECT 1 FROM web_sales, date_dim dd2, customer cc2 WHERE web_sales.ws_sold_date_sk = dd2.d_date_sk AND web_sales.ws_bill_customer_sk = cc2.c_customer_sk AND dd2.d_month_seq BETWEEN 1200 AND 1200 + 11 AND cc2.c_birth_month IN (1, 2, 5, 12) AND ws_list_price BETWEEN 193 AND 252 AND ws_wholesale_cost BETWEEN 35 AND 55 AND cc2.c_last_name = customer.c_last_name AND cc2.c_first_name = customer.c_first_name AND dd2.d_date = date_dim.d_date ) ) hot_cust LIMIT 100;",
  "patches": [
    {
      "patch_id": "p01",
      "family": "D",
      "transform": "intersect_to_exists",
      "relevance_score": 0.85,
      "status": "WIN",
      "speedup": 4.15,
      "semantic_passed": true,
      "error": null,
      "original_ms": 778.2,
      "patch_ms": 187.7,
      "output_sql": "SELECT COUNT(*) FROM ( SELECT DISTINCT c_last_name, c_first_name, d_date FROM store_sales, date_dim, customer WHERE store_sales.ss_sold_date_sk = date_dim.d_date_sk AND store_sales.ss_customer_sk = customer.c_customer_sk AND d_month_seq BETWEEN 1200 AND 1211 AND c_birth_month IN (1, 2, 5, 12) AND ss_list_price BETWEEN 193 AND 252 AND ss_wholesale_cost BETWEEN 35 AND 55 AND EXISTS ( SELECT 1 FROM catalog_sales, date_dim dd1, customer cc1 WHERE catalog_sales.cs_sold_date_sk = dd1.d_date_sk AND catalog_sales.cs_bill_customer_sk = cc1.c_customer_sk AND dd1.d_month_seq BETWEEN 1200 AND 1211 AND cc1.c_birth_month IN (1, 2, 5, 12) AND cs_list_price BETWEEN 193 AND 252 AND cs_wholesale_cost BETWEEN 35 AND 55 AND cc1.c_last_name = customer.c_last_name AND cc1.c_first_name = customer.c_first_name AND dd1.d_date = date_dim.d_date ) AND EXISTS ( SELECT 1 FROM web_sales, date_dim dd2, customer cc2 WHERE web_sales.ws_sold_date_sk = dd2.d_date_sk AND web_sales.ws_bill_customer_sk = cc2.c_customer_sk AND dd2.d_month_seq BETWEEN 1200 AND 1211 AND cc2.c_birth_month IN (1, 2, 5, 12) AND ws_list_price BETWEEN 193 AND 252 AND ws_wholesale_cost BETWEEN 35 AND 55 AND cc2.c_last_name = customer.c_last_name AND cc2.c_first_name = customer.c_first_name AND dd2.d_date = date_dim.d_date ) ) hot_cust LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Replace INTERSECT with EXISTS semi-joins: compute store_sales distinct set as base, then filter with EXISTS on catalog_sales and web_sales matching on (c_last_name, c_first_name, d_date). Preserve all original filters and DISTINCT semantics."
    },
    {
      "patch_id": "p03",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.75,
      "status": "REGRESSION",
      "speedup": 0.57,
      "semantic_passed": true,
      "error": null,
      "original_ms": 778.2,
      "patch_ms": 1355.0,
      "output_sql": "WITH date_range AS (\n  SELECT d_date_sk, d_date\n  FROM date_dim\n  WHERE d_month_seq BETWEEN 1200 AND 1211\n)\nSELECT COUNT(*)\nFROM (\n  SELECT DISTINCT c_last_name, c_first_name, d_date\n  FROM store_sales\n  INNER JOIN date_range ON store_sales.ss_sold_date_sk = date_range.d_date_sk\n  INNER JOIN customer ON store_sales.ss_customer_sk = customer.c_customer_sk\n  WHERE c_birth_month IN (1, 2, 5, 12)\n    AND ss_list_price BETWEEN 193 AND 252\n    AND ss_wholesale_cost BETWEEN 35 AND 55\n  INTERSECT\n  SELECT DISTINCT c_last_name, c_first_name, d_date\n  FROM catalog_sales\n  INNER JOIN date_range ON catalog_sales.cs_sold_date_sk = date_range.d_date_sk\n  INNER JOIN customer ON catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n  WHERE c_birth_month IN (1, 2, 5, 12)\n    AND cs_list_price BETWEEN 193 AND 252\n    AND cs_wholesale_cost BETWEEN 35 AND 55\n  INTERSECT\n  SELECT DISTINCT c_last_name, c_first_name, d_date\n  FROM web_sales\n  INNER JOIN date_range ON web_sales.ws_sold_date_sk = date_range.d_date_sk\n  INNER JOIN customer ON web_sales.ws_bill_customer_sk = customer.c_customer_sk\n  WHERE c_birth_month IN (1, 2, 5, 12)\n    AND ws_list_price BETWEEN 193 AND 252\n    AND ws_wholesale_cost BETWEEN 35 AND 55\n) hot_cust\nLIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Materialize filtered date_dim into a CTE, convert comma joins to explicit INNER JOIN syntax, and join once per sales channel. Keep INTERSECT structure but reduce date_dim rescans."
    },
    {
      "patch_id": "p02",
      "family": "D",
      "transform": "multi_intersect_exists_cte",
      "relevance_score": 0.65,
      "status": "NEUTRAL",
      "speedup": 0.96,
      "semantic_passed": true,
      "error": null,
      "original_ms": 778.2,
      "patch_ms": 813.0,
      "output_sql": "select  count(*) from (\n    select distinct c_last_name, c_first_name, d_date\n    from store_sales, date_dim, customer\n          where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n      and store_sales.ss_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1200 and 1200 + 11\n      and c_birth_month in (1, 2, 5, 12)\n      and ss_list_price between 193 and 252\n      and ss_wholesale_cost BETWEEN 35 AND 55\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from catalog_sales, date_dim, customer\n          where catalog_sales.cs_sold_date_sk = date_dim.d_date_sk\n      and catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1200 and 1200 + 11\n      and c_birth_month in (1, 2, 5, 12)\n      and cs_list_price between 193 and 252\n      and cs_wholesale_cost BETWEEN 35 AND 55\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from web_sales, date_dim, customer\n          where web_sales.ws_sold_date_sk = date_dim.d_date_sk\n      and web_sales.ws_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1200 and 1200 + 11\n      and c_birth_month in (1, 2, 5, 12)\n      and ws_list_price between 193 and 252\n      and ws_wholesale_cost BETWEEN 35 AND 55\n) hot_cust\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Create CTE for shared date_dim and customer filters, then use EXISTS semi-joins across channels. Materialize filtered date_dim and customer keys once, join with each sales table in separate EXISTS subqueries."
    },
    {
      "patch_id": "p04",
      "family": "E",
      "transform": "pg_self_join_decomposition",
      "relevance_score": 0.55,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": true,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select  count(*) from (\n    select distinct c_last_name, c_first_name, d_date\n    from store_sales, date_dim, customer\n          where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n      and store_sales.ss_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1200 and 1200 + 11\n      and c_birth_month in (1, 2, 5, 12)\n      and ss_list_price between 193 and 252\n      and ss_wholesale_cost BETWEEN 35 AND 55\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from catalog_sales, date_dim, customer\n          where catalog_sales.cs_sold_date_sk = date_dim.d_date_sk\n      and catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1200 and 1200 + 11\n      and c_birth_month in (1, 2, 5, 12)\n      and cs_list_price between 193 and 252\n      and cs_wholesale_cost BETWEEN 35 AND 55\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from web_sales, date_dim, customer\n          where web_sales.ws_sold_date_sk = date_dim.d_date_sk\n      and web_sales.ws_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1200 and 1200 + 11\n      and c_birth_month in (1, 2, 5, 12)\n      and ws_list_price between 193 and 252\n      and ws_wholesale_cost BETWEEN 35 AND 55\n) hot_cust\nlimit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Materialize the combined sales data (all three channels) with dimension filters in a single CTE, then compute distinct intersection via grouping. Use UNION ALL to combine channels, then group by (c_last_name, c_first_name, d_date) and filter HAVING COUNT(DISTINCT channel)=3."
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 4.88,
      "semantic_passed": true,
      "error": null,
      "original_ms": 855.5,
      "patch_ms": 175.5,
      "output_sql": "SELECT COUNT(*) FROM ( SELECT DISTINCT c_last_name, c_first_name, d_date FROM store_sales, date_dim, customer WHERE store_sales.ss_sold_date_sk = date_dim.d_date_sk AND store_sales.ss_customer_sk = customer.c_customer_sk AND d_month_seq BETWEEN 1200 AND 1200 + 11 AND c_birth_month IN (1, 2, 5, 12) AND ss_list_price BETWEEN 193 AND 252 AND ss_wholesale_cost BETWEEN 35 AND 55 AND EXISTS ( SELECT 1 FROM catalog_sales, date_dim dd1, customer cc1 WHERE catalog_sales.cs_sold_date_sk = dd1.d_date_sk AND catalog_sales.cs_bill_customer_sk = cc1.c_customer_sk AND dd1.d_month_seq BETWEEN 1200 AND 1200 + 11 AND cc1.c_birth_month IN (1, 2, 5, 12) AND cs_list_price BETWEEN 193 AND 252 AND cs_wholesale_cost BETWEEN 35 AND 55 AND cc1.c_last_name = customer.c_last_name AND cc1.c_first_name = customer.c_first_name AND dd1.d_date = date_dim.d_date ) AND EXISTS ( SELECT 1 FROM web_sales, date_dim dd2, customer cc2 WHERE web_sales.ws_sold_date_sk = dd2.d_date_sk AND web_sales.ws_bill_customer_sk = cc2.c_customer_sk AND dd2.d_month_seq BETWEEN 1200 AND 1200 + 11 AND cc2.c_birth_month IN (1, 2, 5, 12) AND ws_list_price BETWEEN 193 AND 252 AND ws_wholesale_cost BETWEEN 35 AND 55 AND cc2.c_last_name = customer.c_last_name AND cc2.c_first_name = customer.c_first_name AND dd2.d_date = date_dim.d_date ) ) hot_cust LIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p01": "Limit  (rows=1, time=169.612)\n  Aggregate  (rows=1, time=169.609)\n    Unique  (rows=0, time=169.605)\n      Sort  (rows=0, time=169.605)\n        Nested Loop  (rows=0, time=169.575)\n          Aggregate  (rows=0, time=169.574)\n            Nested Loop  (rows=0, time=169.571)\n              Gather  (rows=0, time=169.57)\n                Nested Loop  (rows=0, time=83.811)\n                  Index Scan on date_dim (dd2)  (rows=122, time=3.271)\n                  Index Scan on web_sales  (rows=0, time=0.66)",
    "p03": "Limit  (rows=1, time=1411.649)\n  Index Scan on date_dim  (rows=366, time=0.204)\n  Aggregate  (rows=1, time=1411.645)\n    Subquery Scan (hot_cust)  (rows=0, time=1411.639)\n      SetOp  (rows=0, time=1411.638)\n        Append  (rows=0, time=1411.625)\n          Subquery Scan (*SELECT* 3)  (rows=0, time=231.92)\n            Unique  (rows=0, time=231.92)\n              Sort  (rows=0, time=231.918)\n                Nested Loop  (rows=0, time=231.894)\n                  Nested Loop  (rows=0, time=231.892)\n ",
    "p02": "Limit  (rows=1, time=837.511)\n  Aggregate  (rows=1, time=837.509)\n    Subquery Scan (hot_cust)  (rows=0, time=837.503)\n      SetOp  (rows=0, time=837.501)\n        Append  (rows=0, time=837.499)\n          Subquery Scan (*SELECT* 3)  (rows=0, time=147.814)\n            Unique  (rows=0, time=147.812)\n              Gather Merge  (rows=0, time=147.81)\n                Sort  (rows=0, time=143.626)\n                  Nested Loop  (rows=0, time=143.597)\n                    Nested Loop  (rows=0, time=143.59",
    "compile_p1": "Limit  (rows=1, time=192.729)\n  Aggregate  (rows=1, time=192.726)\n    Unique  (rows=0, time=192.72)\n      Sort  (rows=0, time=192.717)\n        Nested Loop  (rows=0, time=192.699)\n          Aggregate  (rows=0, time=192.695)\n            Nested Loop  (rows=0, time=192.689)\n              Gather  (rows=0, time=192.687)\n                Nested Loop  (rows=0, time=93.767)\n                  Index Scan on date_dim (dd2)  (rows=122, time=3.539)\n                  Index Scan on web_sales  (rows=0, time=0.739"
  }
}