[
  {
    "plan_id": "compile_p03",
    "dialect": "postgres",
    "confidence": 0.8,
    "based_on": "p03",
    "strategy": "Explicit join conversion to arm optimizer reordering.",
    "hypothesis": "Probe p03 validated with 1.07x speedup by converting comma joins to explicit INNER JOINs, enabling better join order selection. No CTE fences introduced.",
    "expected_explain_delta": "Hash join order may change; sequential scans remain but join topology is clearer for optimizer.",
    "target_ir": "Update final_select join syntax only.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["customer", "customer_address", "customer_demographics", "household_demographics", "income_band", "store_returns"],
          "outputs": ["customer_id", "customername"],
          "changed": true,
          "sql": "SELECT c.c_customer_id AS customer_id, COALESCE(c.c_last_name, '') || ', ' || COALESCE(c.c_first_name, '') AS customername FROM customer c INNER JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk INNER JOIN household_demographics hd ON hd.hd_demo_sk = c.c_current_hdemo_sk INNER JOIN income_band ib ON ib.ib_income_band_sk = hd.hd_income_band_sk INNER JOIN store_returns sr ON sr.sr_cdemo_sk = cd.cd_demo_sk WHERE ca.ca_city = 'Mount Vernon' AND ib.ib_lower_bound >= 40374 AND ib.ib_upper_bound <= 40374 + 50000 ORDER BY c.c_customer_id LIMIT 100"
        }
      ]
    }
  },
  {
    "plan_id": "compile_fixed_cte",
    "dialect": "postgres",
    "confidence": 0.6,
    "based_on": "p01",
    "strategy": "Fixed CTE pre‑filtering of selective dimensions.",
    "hypothesis": "Probe p01 failed with syntax error (missing FROM entry). Corrected join condition and CTE references to pre‑filter customer_address and income_band, reducing rows before joining with large customer table.",
    "expected_explain_delta": "Sequential scan on customer may be eliminated or reduced via hash join with tiny filtered CTEs.",
    "target_ir": "Add ca_filtered and ib_filtered CTEs, update final_select join graph.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "ca_filtered",
          "parent_node_id": "final_select",
          "sources": ["customer_address"],
          "outputs": ["ca_address_sk"],
          "changed": true,
          "sql": "SELECT ca_address_sk FROM customer_address WHERE ca_city = 'Mount Vernon'"
        },
        {
          "node_id": "ib_filtered",
          "parent_node_id": "final_select",
          "sources": ["income_band"],
          "outputs": ["ib_income_band_sk"],
          "changed": true,
          "sql": "SELECT ib_income_band_sk FROM income_band WHERE ib_lower_bound >= 40374 AND ib_upper_bound <= 40374 + 50000"
        },
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["customer", "ca_filtered", "customer_demographics", "household_demographics", "ib_filtered", "store_returns"],
          "outputs": ["customer_id", "customername"],
          "changed": true,
          "sql": "SELECT c.c_customer_id AS customer_id, COALESCE(c.c_last_name, '') || ', ' || COALESCE(c.c_first_name, '') AS customername FROM customer c JOIN ca_filtered ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN ib_filtered ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN store_returns sr ON sr.sr_cdemo_sk = cd.cd_demo_sk ORDER BY c.c_customer_id LIMIT 100"
        }
      ]
    }
  }
]