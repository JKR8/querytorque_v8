[
  {
    "plan_id": "compile_p03",
    "dialect": "postgres",
    "confidence": 0.70,
    "based_on": "p03",
    "strategy": "Convert comma joins to explicit INNER JOIN syntax to arm optimizer join reordering.",
    "hypothesis": "Probe p03 (1.07x speedup) shows explicit join syntax improves plan; no structural changes needed. Comma joins limit PostgreSQL's join reorder flexibility.",
    "expected_explain_delta": "Same join order but explicit join nodes may allow better cost estimates.",
    "target_ir": "Update final_select to use explicit JOIN ON syntax.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["customer", "customer_address", "customer_demographics", "household_demographics", "income_band", "store_returns"],
          "outputs": ["customer_id", "customername"],
          "changed": true,
          "sql": "SELECT c.c_customer_id AS customer_id, COALESCE(c.c_last_name, '') || ', ' || COALESCE(c.c_first_name, '') AS customername FROM customer c INNER JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk INNER JOIN household_demographics hd ON hd.hd_demo_sk = c.c_current_hdemo_sk INNER JOIN income_band ib ON ib.ib_income_band_sk = hd.hd_income_band_sk INNER JOIN store_returns sr ON sr.sr_cdemo_sk = cd.cd_demo_sk WHERE ca.ca_city = 'Mount Vernon' AND ib.ib_lower_bound >= 40374 AND ib.ib_upper_bound <= 40374 + 50000 ORDER BY c.c_customer_id LIMIT 100"
        }
      ]
    }
  },
  {
    "plan_id": "compile_cte_prefilter",
    "dialect": "postgres",
    "confidence": 0.60,
    "based_on": "p01,p04",
    "strategy": "Pre‑filter selective dimensions (customer_address, income_band) in CTEs before joining to customer.",
    "hypothesis": "Failed probes p01/p04 attempted CTE pre‑filtering but had syntax errors; fixing those may push city/income‑band filters earlier and reduce customer scan size.",
    "expected_explain_delta": "Filtered CTEs become small hash tables; customer may switch to index scan on c_current_addr_sk.",
    "target_ir": "Add filtered_ca and filtered_ib CTE nodes; update final_select to reference them.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "filtered_ca",
          "parent_node_id": "final_select",
          "sources": ["customer_address"],
          "outputs": ["ca_address_sk"],
          "changed": true,
          "sql": "SELECT ca_address_sk FROM customer_address WHERE ca_city = 'Mount Vernon'"
        },
        {
          "node_id": "filtered_ib",
          "parent_node_id": "final_select",
          "sources": ["income_band"],
          "outputs": ["ib_income_band_sk"],
          "changed": true,
          "sql": "SELECT ib_income_band_sk FROM income_band WHERE ib_lower_bound >= 40374 AND ib_upper_bound <= 90374"
        },
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["customer", "filtered_ca", "customer_demographics", "household_demographics", "filtered_ib", "store_returns"],
          "outputs": ["customer_id", "customername"],
          "changed": true,
          "sql": "SELECT c.c_customer_id AS customer_id, COALESCE(c.c_last_name, '') || ', ' || COALESCE(c.c_first_name, '') AS customername FROM customer c JOIN filtered_ca ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN household_demographics hd ON hd.hd_demo_sk = c.c_current_hdemo_sk JOIN filtered_ib ib ON ib.ib_income_band_sk = hd.hd_income_band_sk JOIN store_returns sr ON sr.sr_cdemo_sk = cd.cd_demo_sk ORDER BY c.c_customer_id LIMIT 100"
        }
      ]
    }
  }
]