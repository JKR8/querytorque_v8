{
  "probe_id": "p02",
  "transform_id": "dimension_prefetch_star",
  "family": "F",
  "status": "success",
  "dialect": "postgresql",
  "hypothesis": "Pre-filtering selective dimensions (date_dim, item, customer, customer_address, household_demographics) into MATERIALIZED CTEs reduces store_sales scan size and enables early hash joins, addressing the Nested Loop and cardinality underestimation issues.",
  "reasoning_trace": [
    "Assigned transform targets comma-join pattern with late dimension filtering.",
    "Materialized CTEs for selective dimensions align with PostgreSQL optimizer strengths.",
    "Explicit JOIN syntax improves predicate pushdown and cardinality estimation."
  ],
  "target_ir": "Selective dimensions prefetched into materialized CTEs; FROM clause rewritten to explicit JOINs.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": [],
        "outputs": [
          "cd_gender",
          "cd_marital_status",
          "cd_education_status",
          "hd_vehicle_count",
          "cnt"
        ],
        "changed": true,
        "sql": "WITH date_dim_d1 AS MATERIALIZED (\n  SELECT *\n  FROM date_dim\n  WHERE d_year = 1998\n),\nitem_filtered AS MATERIALIZED (\n  SELECT *\n  FROM item\n  WHERE i_category IN ('Men', 'Shoes', 'Sports')\n    AND i_manager_id IN (6, 11, 16, 17, 19, 28, 47, 82, 88, 98)\n),\ncustomer_filtered AS MATERIALIZED (\n  SELECT *\n  FROM customer\n),\ncustomer_address_filtered AS MATERIALIZED (\n  SELECT *\n  FROM customer_address\n  WHERE ca_state IN ('AR', 'CA', 'KS', 'NY', 'VA')\n),\nhousehold_demographics_filtered AS MATERIALIZED (\n  SELECT *\n  FROM household_demographics\n)\nSELECT \n    cd.cd_gender,\n    cd.cd_marital_status,\n    cd.cd_education_status,\n    hd.hd_vehicle_count,\n    COUNT(*) AS cnt\nFROM\n    store_sales ss\nJOIN item_filtered i ON ss.ss_item_sk = i.i_item_sk\nJOIN web_sales ws ON ws.ws_item_sk = ss.ss_item_sk\nJOIN date_dim_d1 d1 ON ss.ss_sold_date_sk = d1.d_date_sk\nJOIN date_dim d2 ON ws.ws_sold_date_sk = d2.d_date_sk\nJOIN customer_filtered c ON ss.ss_customer_sk = c.c_customer_sk AND ws.ws_bill_customer_sk = c.c_customer_sk\nJOIN inventory inv ON inv.inv_item_sk = ss.ss_item_sk AND inv.inv_date_sk = ss.ss_sold_date_sk AND inv.inv_quantity_on_hand >= ss.ss_quantity\nJOIN store s ON s.s_state = w.w_state\nJOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk\nJOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk\nJOIN household_demographics_filtered hd ON c.c_current_hdemo_sk = hd.hd_demo_sk\nJOIN customer_address_filtered ca ON c.c_current_addr_sk = ca.ca_address_sk\nWHERE\n    d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 day')\n    AND ws.ws_wholesale_cost BETWEEN 76 AND 96\nGROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, hd.hd_vehicle_count\nORDER BY cnt"
      }
    ]
  }
}