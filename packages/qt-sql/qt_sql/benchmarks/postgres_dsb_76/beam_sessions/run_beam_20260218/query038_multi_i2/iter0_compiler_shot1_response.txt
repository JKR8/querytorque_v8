[
  {
    "plan_id": "compile_p1",
    "dialect": "postgres",
    "confidence": 0.72,
    "based_on": "p01",
    "strategy": "Replace INTERSECT with EXISTS semi-joins to eliminate SetOp materialization.",
    "hypothesis": "Primary hotspot is SetOp intersection of three large materialized sets (15737 ms). Gold example pg_intersect_to_exists shows 1.78x speedup. Probe p01 failed due to equivalence mismatch but hypothesis remains valid: replace symmetric INTERSECT with EXISTS semi-joins using store_sales as driving branch.",
    "expected_explain_delta": "SetOp Append replaced by nested loop semi-joins; three separate dimension scans remain but SetOp elimination reduces intermediate materialization.",
    "target_ir": "Convert INTERSECT branches to EXISTS correlated subqueries, preserving original DISTINCT semantics.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["store_sales", "date_dim", "customer"],
          "outputs": ["count"],
          "changed": true,
          "sql": "SELECT COUNT(*) FROM (SELECT DISTINCT c_last_name, c_first_name, d_date FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk WHERE d_month_seq BETWEEN 1207 AND 1218 AND c_birth_month IN (2, 3, 4, 10) AND ss_list_price BETWEEN 241 AND 300 AND ss_wholesale_cost BETWEEN 76 AND 96 AND EXISTS (SELECT 1 FROM catalog_sales cs JOIN date_dim d2 ON cs.cs_sold_date_sk = d2.d_date_sk JOIN customer c2 ON cs.cs_bill_customer_sk = c2.c_customer_sk WHERE d2.d_month_seq BETWEEN 1207 AND 1218 AND c2.c_birth_month IN (2, 3, 4, 10) AND cs_list_price BETWEEN 241 AND 300 AND cs_wholesale_cost BETWEEN 76 AND 96 AND c2.c_last_name = c.c_last_name AND c2.c_first_name = c.c_first_name AND d2.d_date = d.d_date) AND EXISTS (SELECT 1 FROM web_sales ws JOIN date_dim d3 ON ws.ws_sold_date_sk = d3.d_date_sk JOIN customer c3 ON ws.ws_bill_customer_sk = c3.c_customer_sk WHERE d3.d_month_seq BETWEEN 1207 AND 1218 AND c3.c_birth_month IN (2, 3, 4, 10) AND ws_list_price BETWEEN 241 AND 300 AND ws_wholesale_cost BETWEEN 76 AND 96 AND c3.c_last_name = c.c_last_name AND c3.c_first_name = c.c_first_name AND d3.d_date = d.d_date)) hot_cust LIMIT 100"
        }
      ]
    }
  }
]