{
  "iteration": 0,
  "n_api_calls": 20,
  "beam_cost_usd": 0.03592279,
  "beam_cost_priced_calls": 15,
  "beam_cost_unpriced_calls": 5,
  "beam_token_totals": {
    "prompt_tokens": 177676,
    "completion_tokens": 22157,
    "total_tokens": 199833,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 94912,
    "reasoning_tokens": 7636
  },
  "best_speedup": 21.59,
  "best_patch_id": "p03",
  "best_sql": "WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_RETURN_AMT_INC_TAX) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2002 AND sr_return_amt / sr_return_quantity BETWEEN 108 AND 167 GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk), filtered_store AS (SELECT s_store_sk FROM store WHERE s_state IN ('IL', 'KY', 'TX')), filtered_customer AS (SELECT c_customer_sk, c_current_cdemo_sk, c_customer_id FROM customer WHERE c_birth_month = 2 AND c_birth_year BETWEEN 1965 AND 1971), filtered_customer_demographics AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_marital_status IN ('M', 'M') AND cd_education_status IN ('Advanced Degree', 'College') AND cd_gender = 'F') SELECT c.c_customer_id\nFROM customer_total_return ctr1\nJOIN filtered_store s ON s.s_store_sk = ctr1.ctr_store_sk\nJOIN filtered_customer c ON ctr1.ctr_customer_sk = c.c_customer_sk\nJOIN filtered_customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk\nWHERE ctr1.ctr_reason_sk BETWEEN 43 AND 46\nORDER BY c.c_customer_id\nLIMIT 100;",
  "patches": [
    {
      "patch_id": "p01",
      "family": "B",
      "transform": "inline_decorrelate_materialized",
      "relevance_score": 0.92,
      "status": "WIN",
      "speedup": 9.64,
      "semantic_passed": true,
      "error": null,
      "original_ms": 12516.6,
      "patch_ms": 1298.6,
      "output_sql": "WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_RETURN_AMT_INC_TAX) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2002 AND sr_return_amt / sr_return_quantity BETWEEN 108 AND 167 GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk), store_avg AS (SELECT ctr2.ctr_store_sk, AVG(ctr2.ctr_total_return) * 1.2 AS threshold FROM customer_total_return ctr2 GROUP BY ctr2.ctr_store_sk) SELECT c_customer_id FROM customer_total_return ctr1, store_avg, store, customer, customer_demographics WHERE ctr1.ctr_total_return > store_avg.threshold AND ctr1.ctr_reason_sk BETWEEN 43 AND 46 AND s_store_sk = ctr1.ctr_store_sk AND s_state IN ('IL', 'KY', 'TX') AND ctr1.ctr_customer_sk = c_customer_sk AND c_current_cdemo_sk = cd_demo_sk AND cd_marital_status IN ('M', 'M') AND cd_education_status IN ('Advanced Degree', 'College') AND cd_gender = 'F' AND c_birth_month = 2 AND c_birth_year BETWEEN 1965 AND 1971 ORDER BY c_customer_id LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Replace correlated scalar subquery with a MATERIALIZED CTE that pre\u2011computes per\u2011store average threshold, then join to ctr1."
    },
    {
      "patch_id": "p02",
      "family": "B",
      "transform": "early_filter_decorrelate",
      "relevance_score": 0.85,
      "status": "WIN",
      "speedup": 9.55,
      "semantic_passed": true,
      "error": null,
      "original_ms": 12516.6,
      "patch_ms": 1310.2,
      "output_sql": "WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(sr_return_amt_inc_tax) AS ctr_total_return FROM store_returns JOIN date_dim ON sr_returned_date_sk = d_date_sk WHERE d_year = 2002 AND sr_return_amt / sr_return_quantity BETWEEN 108 AND 167 GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk), store_avg AS (SELECT ctr_store_sk, AVG(ctr_total_return) AS avg_return FROM customer_total_return GROUP BY ctr_store_sk) SELECT c_customer_id FROM customer_total_return ctr1 JOIN store_avg sa ON ctr1.ctr_store_sk = sa.ctr_store_sk JOIN store ON s_store_sk = ctr1.ctr_store_sk JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk WHERE ctr1.ctr_total_return > sa.avg_return * 1.2 AND ctr1.ctr_reason_sk BETWEEN 43 AND 46 AND s_state IN ('IL', 'KY', 'TX') AND cd_marital_status IN ('M', 'M') AND cd_education_status IN ('Advanced Degree', 'College') AND cd_gender = 'F' AND c_birth_month = 2 AND c_birth_year BETWEEN 1965 AND 1971 ORDER BY c_customer_id LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Push dimension filters into CTEs, then decorrelate subquery by pre\u2011computing store\u2011level average from filtered fact data."
    },
    {
      "patch_id": "p03",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.75,
      "status": "WIN",
      "speedup": 21.59,
      "semantic_passed": true,
      "error": null,
      "original_ms": 12516.6,
      "patch_ms": 579.7,
      "output_sql": "WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_RETURN_AMT_INC_TAX) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2002 AND sr_return_amt / sr_return_quantity BETWEEN 108 AND 167 GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk), filtered_store AS (SELECT s_store_sk FROM store WHERE s_state IN ('IL', 'KY', 'TX')), filtered_customer AS (SELECT c_customer_sk, c_current_cdemo_sk, c_customer_id FROM customer WHERE c_birth_month = 2 AND c_birth_year BETWEEN 1965 AND 1971), filtered_customer_demographics AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_marital_status IN ('M', 'M') AND cd_education_status IN ('Advanced Degree', 'College') AND cd_gender = 'F') SELECT c.c_customer_id\nFROM customer_total_return ctr1\nJOIN filtered_store s ON s.s_store_sk = ctr1.ctr_store_sk\nJOIN filtered_customer c ON ctr1.ctr_customer_sk = c.c_customer_sk\nJOIN filtered_customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk\nWHERE ctr1.ctr_reason_sk BETWEEN 43 AND 46\nORDER BY c.c_customer_id\nLIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre\u2011filter store, customer, customer_demographics into separate MATERIALIZED CTEs, then join with ctr1 using explicit JOIN syntax."
    },
    {
      "patch_id": "p04",
      "family": "E",
      "transform": "pg_self_join_decomposition",
      "relevance_score": 0.7,
      "status": "REGRESSION",
      "speedup": 0.91,
      "semantic_passed": true,
      "error": null,
      "original_ms": 12516.6,
      "patch_ms": 13684.0,
      "output_sql": "WITH shared_scan AS (SELECT sr_customer_sk, sr_store_sk, sr_reason_sk, SR_RETURN_AMT_INC_TAX FROM store_returns JOIN date_dim ON sr_returned_date_sk = d_date_sk WHERE d_year = 2002 AND sr_return_amt / sr_return_quantity BETWEEN 108 AND 167), customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_RETURN_AMT_INC_TAX) AS ctr_total_return FROM shared_scan GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk) SELECT c_customer_id FROM customer_total_return ctr1 JOIN store ON s_store_sk = ctr1.ctr_store_sk JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk WHERE ctr1.ctr_total_return > (SELECT AVG(ctr2.ctr_total_return) * 1.2 FROM customer_total_return ctr2 WHERE ctr1.ctr_store_sk = ctr2.ctr_store_sk) AND ctr1.ctr_reason_sk BETWEEN 43 AND 46 AND s_state IN ('IL', 'KY', 'TX') AND cd_marital_status IN ('M', 'M') AND cd_education_status IN ('Advanced Degree', 'College') AND cd_gender = 'F' AND c_birth_month = 2 AND c_birth_year BETWEEN 1965 AND 1971 ORDER BY c_customer_id LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Materialize the filtered store_returns\u2011date_dim join once, then compute both the main CTE and the subquery aggregate from the same materialized set."
    },
    {
      "patch_id": "p07",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.6,
      "status": "REGRESSION",
      "speedup": 0.92,
      "semantic_passed": true,
      "error": null,
      "original_ms": 12516.6,
      "patch_ms": 13628.5,
      "output_sql": "WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_RETURN_AMT_INC_TAX) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2002 AND sr_return_amt / sr_return_quantity BETWEEN 108 AND 167 GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk) SELECT c_customer_id FROM customer_total_return AS ctr1, store, customer, customer_demographics WHERE ctr1.ctr_total_return > (SELECT AVG(ctr_total_return) * 1.2 FROM customer_total_return AS ctr2 WHERE ctr1.ctr_store_sk = ctr2.ctr_store_sk) AND ctr1.ctr_reason_sk BETWEEN 43 AND 46 AND s_store_sk = ctr1.ctr_store_sk AND s_state IN ('IL', 'KY', 'TX') AND ctr1.ctr_customer_sk = c_customer_sk AND c_current_cdemo_sk = cd_demo_sk AND cd_marital_status IN ('M', 'M') AND cd_education_status IN ('Advanced Degree', 'College') AND cd_gender = 'F' AND c_birth_month = 2 AND c_birth_year BETWEEN 1965 AND 1971 ORDER BY c_customer_id LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre\u2011aggregate store_returns by store_sk, customer_sk, reason_sk before joining with date_dim, then compute the outer aggregate."
    },
    {
      "patch_id": "p05",
      "family": "B",
      "transform": "decorrelate",
      "relevance_score": 0.55,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: column \"c_customer_id\" does not exist\nLINE 1: ...stomer_total_return GROUP BY ctr_store_sk) SELECT c_customer...\n                                                             ^\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_RETURN_AMT_INC_TAX) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2002 AND sr_return_amt / sr_return_quantity BETWEEN 108 AND 167 GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk), avg_store_return AS (SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS avg_ctr_total_return FROM customer_total_return GROUP BY ctr_store_sk) SELECT c_customer_id FROM customer_total_return ctr1 JOIN avg_store_return ON ctr1.ctr_store_sk = avg_store_return.ctr_store_sk WHERE ctr1.ctr_total_return > avg_store_return.avg_ctr_total_return AND ctr1.ctr_reason_sk BETWEEN 43 AND 46 AND s_store_sk = ctr1.ctr_store_sk AND s_state IN ('IL', 'KY', 'TX') AND ctr1.ctr_customer_sk = c_customer_sk AND c_current_cdemo_sk = cd_demo_sk AND cd_marital_status IN ('M', 'M') AND cd_education_status IN ('Advanced Degree', 'College') AND cd_gender = 'F' AND c_birth_month = 2 AND c_birth_year BETWEEN 1965 AND 1971 ORDER BY c_customer_id LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Convert correlated subquery to a standalone CTE with GROUP BY store_sk, then join with ctr1 (DuckDB\u2011style, PostgreSQL adaptation)."
    },
    {
      "patch_id": "p08",
      "family": "F",
      "transform": "materialized_dimension_fact_prefilter",
      "relevance_score": 0.65,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_RETURN_AMT_INC_TAX) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2002 AND sr_return_amt / sr_return_quantity BETWEEN 108 AND 167 GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk) SELECT c_customer_id FROM customer_total_return AS ctr1, store, customer, customer_demographics WHERE ctr1.ctr_total_return > (SELECT AVG(ctr_total_return) * 1.2 FROM customer_total_return AS ctr2 WHERE ctr1.ctr_store_sk = ctr2.ctr_store_sk) AND ctr1.ctr_reason_sk BETWEEN 43 AND 46 AND s_store_sk = ctr1.ctr_store_sk AND s_state IN ('IL', 'KY', 'TX') AND ctr1.ctr_customer_sk = c_customer_sk AND c_current_cdemo_sk = cd_demo_sk AND cd_marital_status IN ('M', 'M') AND cd_education_status IN ('Advanced Degree', 'College') AND cd_gender = 'F' AND c_birth_month = 2 AND c_birth_year BETWEEN 1965 AND 1971 ORDER BY c_customer_id LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Materialize filtered dimension keys (store, customer, customer_demographics) and pre\u2011join with store_returns before the main CTE aggregation."
    },
    {
      "patch_id": "p06",
      "family": "B",
      "transform": "sf_shared_scan_decorrelate",
      "relevance_score": 0.5,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_RETURN_AMT_INC_TAX) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2002 AND sr_return_amt / sr_return_quantity BETWEEN 108 AND 167 GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk), avg_cte AS (SELECT ctr_store_sk, AVG(ctr_total_return) AS avg_return FROM customer_total_return GROUP BY ctr_store_sk) SELECT c_customer_id FROM customer_total_return ctr1 JOIN store ON s_store_sk = ctr1.ctr_store_sk JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk JOIN avg_cte ON ctr1.ctr_store_sk = avg_cte.ctr_store_sk WHERE ctr1.ctr_total_return > avg_cte.avg_return * 1.2 AND ctr1.ctr_reason_sk BETWEEN 43 AND 46 AND s_state IN ('IL', 'KY', 'TX') AND cd_marital_status IN ('M', 'M') AND cd_education_status IN ('Advanced Degree', 'College') AND cd_gender = 'F' AND c_birth_month = 2 AND c_birth_year BETWEEN 1965 AND 1971 ORDER BY c_customer_id LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Decompose correlated subquery using shared scan CTE (Snowflake\u2011style, adapted for PostgreSQL)."
    }
  ],
  "explains": {
    "p01": "Limit  (rows=0, time=2518.064)\n  Aggregate  (rows=95599, time=2463.913)\n    Gather Merge  (rows=95599, time=2424.941)\n      Aggregate  (rows=95599, time=2420.091)\n        Sort  (rows=95923, time=2384.966)\n          Nested Loop  (rows=95923, time=2321.441)\n            Index Only Scan on date_dim  (rows=365, time=2.148)\n            Index Scan on store_returns  (rows=263, time=6.321)\n  Sort  (rows=0, time=2517.952)\n    Nested Loop  (rows=0, time=2517.938)\n      Nested Loop  (rows=0, time=2517.936)\n",
    "p02": "Limit  (rows=0, time=1783.727)\n  Aggregate  (rows=95599, time=1747.035)\n    Gather Merge  (rows=95599, time=1711.948)\n      Aggregate  (rows=95599, time=1707.39)\n        Sort  (rows=95923, time=1674.972)\n          Nested Loop  (rows=95923, time=1635.847)\n            Index Only Scan on date_dim  (rows=365, time=1.919)\n            Index Scan on store_returns  (rows=263, time=4.449)\n  Sort  (rows=0, time=1783.609)\n    Nested Loop  (rows=0, time=1783.594)\n      Nested Loop  (rows=0, time=1783.592)\n ",
    "p03": "Limit  (rows=0, time=1584.614)\n  Sort  (rows=0, time=1584.613)\n    Nested Loop  (rows=0, time=1584.597)\n      Nested Loop  (rows=0, time=1584.595)\n        Nested Loop  (rows=79, time=1583.374)\n          Aggregate  (rows=1845, time=1581.627)\n            Sort  (rows=1845, time=1581.116)\n              Gather  (rows=1845, time=1579.162)\n                Nested Loop  (rows=1845, time=1578.002)\n                  Index Only Scan on date_dim  (rows=365, time=2.207)\n                  Index Scan on store_r",
    "p04": "Limit  (rows=0, time=12581.597)\n  Aggregate  (rows=95599, time=2916.267)\n    Gather Merge  (rows=95599, time=2868.191)\n      Aggregate  (rows=95599, time=2862.6)\n        Sort  (rows=95923, time=2818.187)\n          Nested Loop  (rows=95923, time=2755.08)\n            Index Only Scan on date_dim  (rows=365, time=2.458)\n            Index Scan on store_returns  (rows=263, time=7.501)\n  Sort  (rows=0, time=12581.435)\n    Nested Loop  (rows=0, time=12581.418)\n      Nested Loop  (rows=0, time=12581.416)",
    "p07": "Limit  (rows=0, time=13791.408)\n  Aggregate  (rows=95599, time=3396.638)\n    Gather Merge  (rows=95599, time=3351.095)\n      Aggregate  (rows=95599, time=3345.353)\n        Sort  (rows=95923, time=3304.557)\n          Nested Loop  (rows=95923, time=3251.766)\n            Index Only Scan on date_dim  (rows=365, time=3.517)\n            Index Scan on store_returns  (rows=263, time=8.859)\n  Sort  (rows=0, time=13791.318)\n    Nested Loop  (rows=0, time=13791.271)\n      Nested Loop  (rows=0, time=13791.2"
  }
}