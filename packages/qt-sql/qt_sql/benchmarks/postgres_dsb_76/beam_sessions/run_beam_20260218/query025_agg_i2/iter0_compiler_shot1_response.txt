{
  "plan_id": "compile_p1",
  "dialect": "postgres",
  "confidence": 0.7,
  "based_on": "COMMA_JOIN_WEAKNESS pattern, p01,p02,p04 regression evidence",
  "strategy": "Explicit join conversion without CTE fences to enable join reordering and predicate pushdown.",
  "hypothesis": "All CTE-based rewrites regressed due to materialization fences blocking join reordering and parallel flow. Converting comma joins to explicit INNER JOINs with filters in ON clauses preserves semantics while allowing optimizer freedom.",
  "expected_explain_delta": "Hash join build order may change, nested loops may reduce, and Gather Merge cardinality estimate should improve.",
  "target_ir": "Replace comma joins with explicit JOINs, moving date_dim filters to respective ON clauses.",
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": [],
        "outputs": ["i_item_id", "i_item_desc", "s_store_id", "s_store_name", "store_sales_profit", "store_returns_loss", "catalog_sales_profit"],
        "changed": true,
        "sql": "SELECT i_item_id, i_item_desc, s_store_id, s_store_name, stddev_samp(ss_net_profit) AS store_sales_profit, stddev_samp(sr_net_loss) AS store_returns_loss, stddev_samp(cs_net_profit) AS catalog_sales_profit FROM store_sales INNER JOIN date_dim d1 ON d1.d_date_sk = ss_sold_date_sk AND d1.d_moy = 2 AND d1.d_year = 2000 INNER JOIN store ON s_store_sk = ss_store_sk INNER JOIN item ON i_item_sk = ss_item_sk INNER JOIN store_returns ON ss_customer_sk = sr_customer_sk AND ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number INNER JOIN date_dim d2 ON sr_returned_date_sk = d2.d_date_sk AND d2.d_moy BETWEEN 2 AND 4 AND d2.d_year = 2000 INNER JOIN catalog_sales ON sr_customer_sk = cs_bill_customer_sk AND sr_item_sk = cs_item_sk INNER JOIN date_dim d3 ON cs_sold_date_sk = d3.d_date_sk AND d3.d_moy BETWEEN 2 AND 4 AND d3.d_year = 2000 GROUP BY i_item_id, i_item_desc, s_store_id, s_store_name ORDER BY i_item_id, i_item_desc, s_store_id, s_store_name LIMIT 100"
      }
    ]
  }
}