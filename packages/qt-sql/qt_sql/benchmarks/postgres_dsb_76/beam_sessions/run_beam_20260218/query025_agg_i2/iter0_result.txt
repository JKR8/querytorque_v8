{
  "iteration": 0,
  "n_api_calls": 6,
  "beam_cost_usd": 0.02262218,
  "beam_cost_priced_calls": 6,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 79313,
    "completion_tokens": 10700,
    "total_tokens": 90013,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 12288,
    "reasoning_tokens": 4003
  },
  "best_speedup": 1.2,
  "best_patch_id": "compile_p1",
  "best_sql": "SELECT i_item_id, i_item_desc, s_store_id, s_store_name, stddev_samp(ss_net_profit) AS store_sales_profit, stddev_samp(sr_net_loss) AS store_returns_loss, stddev_samp(cs_net_profit) AS catalog_sales_profit FROM store_sales INNER JOIN date_dim d1 ON d1.d_date_sk = ss_sold_date_sk AND d1.d_moy = 2 AND d1.d_year = 2000 INNER JOIN store ON s_store_sk = ss_store_sk INNER JOIN item ON i_item_sk = ss_item_sk INNER JOIN store_returns ON ss_customer_sk = sr_customer_sk AND ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number INNER JOIN date_dim d2 ON sr_returned_date_sk = d2.d_date_sk AND d2.d_moy BETWEEN 2 AND 4 AND d2.d_year = 2000 INNER JOIN catalog_sales ON sr_customer_sk = cs_bill_customer_sk AND sr_item_sk = cs_item_sk INNER JOIN date_dim d3 ON cs_sold_date_sk = d3.d_date_sk AND d3.d_moy BETWEEN 2 AND 4 AND d3.d_year = 2000 GROUP BY i_item_id, i_item_desc, s_store_id, s_store_name ORDER BY i_item_id, i_item_desc, s_store_id, s_store_name LIMIT 100;",
  "patches": [
    {
      "patch_id": "p03",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.6,
      "status": "REGRESSION",
      "speedup": 0.6,
      "semantic_passed": true,
      "error": null,
      "original_ms": 602.8,
      "patch_ms": 1007.9,
      "output_sql": "select \n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n ,stddev_samp(ss_net_profit) as store_sales_profit\n ,stddev_samp(sr_net_loss) as store_returns_loss\n ,stddev_samp(cs_net_profit) as catalog_sales_profit\n from\n store_sales\n ,store_returns\n ,catalog_sales\n ,date_dim d1\n ,date_dim d2\n ,date_dim d3\n ,store\n ,item\n where\n d1.d_moy = 2\n and d1.d_year = 2000\n and d1.d_date_sk = ss_sold_date_sk\n and i_item_sk = ss_item_sk\n and s_store_sk = ss_store_sk\n and ss_customer_sk = sr_customer_sk\n and ss_item_sk = sr_item_sk\n and ss_ticket_number = sr_ticket_number\n and sr_returned_date_sk = d2.d_date_sk\n and d2.d_moy               between 2 and  2 + 2\n and d2.d_year              = 2000\n and sr_customer_sk = cs_bill_customer_sk\n and sr_item_sk = cs_item_sk\n and cs_sold_date_sk = d3.d_date_sk\n and d3.d_moy               between 2 and  2 + 2\n and d3.d_year              = 2000\n group by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n order by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n limit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-aggregate store_sales, store_returns, and catalog_sales by their join keys (item_sk, store_sk, date_sk) before joining with dimensions. Use CTEs with partial aggregates."
    },
    {
      "patch_id": "p02",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.8,
      "status": "REGRESSION",
      "speedup": 0.6,
      "semantic_passed": true,
      "error": null,
      "original_ms": 602.8,
      "patch_ms": 1007.5,
      "output_sql": "WITH d1 AS (SELECT d_date_sk FROM date_dim WHERE d_moy = 2 AND d_year = 2000), d2 AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 2 AND 4 AND d_year = 2000), d3 AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 2 AND 4 AND d_year = 2000) SELECT i_item_id, i_item_desc, s_store_id, s_store_name, stddev_samp(ss_net_profit) AS store_sales_profit, stddev_samp(sr_net_loss) AS store_returns_loss, stddev_samp(cs_net_profit) AS catalog_sales_profit FROM store_sales JOIN d1 ON d1.d_date_sk = ss_sold_date_sk JOIN store ON s_store_sk = ss_store_sk JOIN item ON i_item_sk = ss_item_sk JOIN store_returns ON ss_customer_sk = sr_customer_sk AND ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number JOIN d2 ON sr_returned_date_sk = d2.d_date_sk JOIN catalog_sales ON sr_customer_sk = cs_bill_customer_sk AND sr_item_sk = cs_item_sk JOIN d3 ON cs_sold_date_sk = d3.d_date_sk GROUP BY i_item_id, i_item_desc, s_store_id, s_store_name ORDER BY i_item_id, i_item_desc, s_store_id, s_store_name LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Materialize selective date_dim filters into CTEs and convert comma joins to explicit JOIN syntax. Keep store and item as regular joins."
    },
    {
      "patch_id": "p01",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.85,
      "status": "REGRESSION",
      "speedup": 0.6,
      "semantic_passed": true,
      "error": null,
      "original_ms": 602.8,
      "patch_ms": 1009.7,
      "output_sql": "WITH cte_d1 AS (SELECT d_date_sk FROM date_dim WHERE d_moy = 2 AND d_year = 2000), cte_d2 AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 2 AND 4 AND d_year = 2000), cte_d3 AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 2 AND 4 AND d_year = 2000), cte_store AS (SELECT s_store_sk, s_store_id, s_store_name FROM store), cte_item AS (SELECT i_item_sk, i_item_id, i_item_desc FROM item) SELECT i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name, stddev_samp(ss.ss_net_profit) AS store_sales_profit, stddev_samp(sr.sr_net_loss) AS store_returns_loss, stddev_samp(cs.cs_net_profit) AS catalog_sales_profit FROM store_sales ss INNER JOIN cte_d1 d1 ON d1.d_date_sk = ss.ss_sold_date_sk INNER JOIN cte_item i ON i.i_item_sk = ss.ss_item_sk INNER JOIN cte_store s ON s.s_store_sk = ss.ss_store_sk INNER JOIN store_returns sr ON ss.ss_customer_sk = sr.sr_customer_sk AND ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number INNER JOIN cte_d2 d2 ON sr.sr_returned_date_sk = d2.d_date_sk INNER JOIN catalog_sales cs ON sr.sr_customer_sk = cs.cs_bill_customer_sk AND sr.sr_item_sk = cs.cs_item_sk INNER JOIN cte_d3 d3 ON cs.cs_sold_date_sk = d3.d_date_sk GROUP BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name ORDER BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Convert comma joins to explicit INNER JOINs and pre-filter all three date_dim aliases (d1,d2,d3) and store/item into separate CTEs before joining fact tables. Preserve all original predicates."
    },
    {
      "patch_id": "p04",
      "family": "A",
      "transform": "multi_date_range_cte",
      "relevance_score": 0.55,
      "status": "REGRESSION",
      "speedup": 0.6,
      "semantic_passed": true,
      "error": null,
      "original_ms": 602.8,
      "patch_ms": 1007.0,
      "output_sql": "WITH d1_filtered AS (SELECT ss.ss_item_sk, ss.ss_store_sk, ss.ss_customer_sk, ss.ss_ticket_number, ss.ss_net_profit FROM store_sales ss JOIN date_dim d1 ON d1.d_date_sk = ss.ss_sold_date_sk WHERE d1.d_moy = 2 AND d1.d_year = 2000), d2_filtered AS (SELECT sr.sr_customer_sk, sr.sr_item_sk, sr.sr_ticket_number, sr.sr_net_loss FROM store_returns sr JOIN date_dim d2 ON sr.sr_returned_date_sk = d2.d_date_sk WHERE d2.d_moy BETWEEN 2 AND 4 AND d2.d_year = 2000), d3_filtered AS (SELECT cs.cs_bill_customer_sk, cs.cs_item_sk, cs.cs_net_profit FROM catalog_sales cs JOIN date_dim d3 ON cs.cs_sold_date_sk = d3.d_date_sk WHERE d3.d_moy BETWEEN 2 AND 4 AND d3.d_year = 2000) SELECT i_item_id, i_item_desc, s_store_id, s_store_name, stddev_samp(ss_net_profit) AS store_sales_profit, stddev_samp(sr_net_loss) AS store_returns_loss, stddev_samp(cs_net_profit) AS catalog_sales_profit FROM d1_filtered, d2_filtered, d3_filtered, store, item WHERE d1_filtered.ss_item_sk = item.i_item_sk AND d1_filtered.ss_store_sk = store.s_store_sk AND d1_filtered.ss_customer_sk = d2_filtered.sr_customer_sk AND d1_filtered.ss_item_sk = d2_filtered.sr_item_sk AND d1_filtered.ss_ticket_number = d2_filtered.sr_ticket_number AND d2_filtered.sr_customer_sk = d3_filtered.cs_bill_customer_sk AND d2_filtered.sr_item_sk = d3_filtered.cs_item_sk GROUP BY i_item_id, i_item_desc, s_store_id, s_store_name ORDER BY i_item_id, i_item_desc, s_store_id, s_store_name LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Create separate CTEs for each date_dim alias with their filters, then join them to respective fact tables early. Keep comma joins but push date filters into CTEs."
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 1.2,
      "semantic_passed": true,
      "error": null,
      "original_ms": 977.9,
      "patch_ms": 812.8,
      "output_sql": "SELECT i_item_id, i_item_desc, s_store_id, s_store_name, stddev_samp(ss_net_profit) AS store_sales_profit, stddev_samp(sr_net_loss) AS store_returns_loss, stddev_samp(cs_net_profit) AS catalog_sales_profit FROM store_sales INNER JOIN date_dim d1 ON d1.d_date_sk = ss_sold_date_sk AND d1.d_moy = 2 AND d1.d_year = 2000 INNER JOIN store ON s_store_sk = ss_store_sk INNER JOIN item ON i_item_sk = ss_item_sk INNER JOIN store_returns ON ss_customer_sk = sr_customer_sk AND ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number INNER JOIN date_dim d2 ON sr_returned_date_sk = d2.d_date_sk AND d2.d_moy BETWEEN 2 AND 4 AND d2.d_year = 2000 INNER JOIN catalog_sales ON sr_customer_sk = cs_bill_customer_sk AND sr_item_sk = cs_item_sk INNER JOIN date_dim d3 ON cs_sold_date_sk = d3.d_date_sk AND d3.d_moy BETWEEN 2 AND 4 AND d3.d_year = 2000 GROUP BY i_item_id, i_item_desc, s_store_id, s_store_name ORDER BY i_item_id, i_item_desc, s_store_id, s_store_name LIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p03": "Limit  (rows=2, time=1383.624)\n  Aggregate  (rows=2, time=1383.621)\n    Nested Loop  (rows=2, time=1383.609)\n      Gather Merge  (rows=13, time=1383.585)\n        Sort  (rows=4, time=461.285)\n          Nested Loop  (rows=4, time=461.198)\n            Nested Loop  (rows=4, time=461.089)\n              Nested Loop  (rows=4, time=460.928)\n                Hash Join  (rows=4, time=460.755)\n                  Nested Loop  (rows=63, time=460.541)\n                    Nested Loop  (rows=72770, time=19.141)\n ",
    "p02": "Limit  (rows=2, time=741.682)\n  Aggregate  (rows=2, time=741.68)\n    Nested Loop  (rows=2, time=741.672)\n      Gather Merge  (rows=13, time=741.643)\n        Sort  (rows=4, time=247.39)\n          Nested Loop  (rows=4, time=247.332)\n            Nested Loop  (rows=4, time=247.281)\n              Nested Loop  (rows=4, time=247.243)\n                Hash Join  (rows=4, time=247.156)\n                  Nested Loop  (rows=63, time=247.011)\n                    Nested Loop  (rows=72770, time=15.615)\n       ",
    "p01": "Limit  (rows=2, time=633.537)\n  Aggregate  (rows=2, time=633.535)\n    Nested Loop  (rows=2, time=633.526)\n      Gather Merge  (rows=13, time=633.498)\n        Sort  (rows=4, time=211.688)\n          Nested Loop  (rows=4, time=211.647)\n            Nested Loop  (rows=4, time=211.613)\n              Nested Loop  (rows=4, time=211.56)\n                Hash Join  (rows=4, time=211.465)\n                  Nested Loop  (rows=63, time=211.314)\n                    Nested Loop  (rows=72770, time=11.739)\n      ",
    "p04": "Limit  (rows=2, time=704.776)\n  Aggregate  (rows=2, time=704.773)\n    Nested Loop  (rows=2, time=704.76)\n      Gather Merge  (rows=13, time=704.727)\n        Sort  (rows=4, time=235.617)\n          Nested Loop  (rows=4, time=235.579)\n            Nested Loop  (rows=4, time=235.529)\n              Nested Loop  (rows=4, time=235.494)\n                Hash Join  (rows=4, time=235.412)\n                  Nested Loop  (rows=63, time=235.266)\n                    Nested Loop  (rows=72770, time=12.466)\n      ",
    "compile_p1": "Limit  (rows=2, time=891.168)\n  Aggregate  (rows=2, time=891.165)\n    Nested Loop  (rows=2, time=891.143)\n      Gather Merge  (rows=13, time=891.095)\n        Sort  (rows=13, time=890.633)\n          Nested Loop  (rows=13, time=890.573)\n            Nested Loop  (rows=13, time=890.375)\n              Nested Loop  (rows=13, time=890.243)\n                Hash Join  (rows=13, time=889.973)\n                  Nested Loop  (rows=189, time=889.397)\n                    Nested Loop  (rows=218310, time=42.275"
  }
}