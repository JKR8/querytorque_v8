{
  "iteration": 0,
  "n_api_calls": 8,
  "beam_cost_usd": 0.02489488,
  "beam_cost_priced_calls": 8,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 100777,
    "completion_tokens": 14889,
    "total_tokens": 115666,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 38016,
    "reasoning_tokens": 6881
  },
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "p01",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.82,
      "status": "REGRESSION",
      "speedup": 0.81,
      "semantic_passed": true,
      "error": null,
      "original_ms": 871.3,
      "patch_ms": 1069.5,
      "output_sql": "WITH date_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999), agg_results AS (SELECT i.i_item_id, ca.ca_country, ca.ca_state, ca.ca_county, cs.cs_quantity, cs.cs_list_price, cs.cs_coupon_amt, cs.cs_sales_price, cs.cs_net_profit, c.c_birth_year FROM catalog_sales cs INNER JOIN date_filtered d ON cs.cs_sold_date_sk = d.d_date_sk INNER JOIN item i ON cs.cs_item_sk = i.i_item_sk INNER JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk INNER JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk INNER JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE cd.cd_gender = 'F' AND cd.cd_education_status = '4 yr Degree' AND c.c_birth_month = 12 AND ca.ca_state in ('AR', 'IN', 'VA') AND cs.cs_wholesale_cost BETWEEN 5 AND 10 AND i.i_category = 'Music') SELECT i_item_id, ca_country, ca_state, ca_county, avg( cast(cs_quantity as decimal(12,2))) agg1, avg( cast(cs_list_price as decimal(12,2))) agg2, avg( cast(cs_coupon_amt as decimal(12,2))) agg3, avg( cast(cs_sales_price as decimal(12,2))) agg4, avg( cast(cs_net_profit as decimal(12,2))) agg5, avg( cast(c_birth_year as decimal(12,2))) agg6 FROM agg_results GROUP BY rollup (i_item_id, ca_country, ca_state, ca_county) ORDER BY ca_country, ca_state, ca_county, i_item_id LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Convert comma joins to explicit INNER JOIN syntax and isolate date_dim filter (d_year=1999) into a CTE to create a tiny hash table for the fact\u2011table probe."
    },
    {
      "patch_id": "p04",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.48,
      "status": "NEUTRAL",
      "speedup": 0.99,
      "semantic_passed": true,
      "error": null,
      "original_ms": 871.3,
      "patch_ms": 881.6,
      "output_sql": "select  i_item_id,\n        ca_country,\n        ca_state,\n        ca_county,\n        avg( cast(cs_quantity as decimal(12,2))) agg1,\n        avg( cast(cs_list_price as decimal(12,2))) agg2,\n        avg( cast(cs_coupon_amt as decimal(12,2))) agg3,\n        avg( cast(cs_sales_price as decimal(12,2))) agg4,\n        avg( cast(cs_net_profit as decimal(12,2))) agg5,\n        avg( cast(c_birth_year as decimal(12,2))) agg6\nfrom catalog_sales, customer_demographics, customer, customer_address, date_dim, item\nwhere cs_sold_date_sk = d_date_sk and\n      cs_item_sk = i_item_sk and\n      cs_bill_cdemo_sk = cd_demo_sk and\n      cs_bill_customer_sk = c_customer_sk and\n      cd_gender = 'F' and\n      cd_education_status = '4 yr Degree' and\n      c_current_addr_sk = ca_address_sk and\n      d_year = 1999 and\n      c_birth_month = 12 and\n      ca_state in ('AR', 'IN', 'VA')\n      and cs_wholesale_cost BETWEEN 5 AND 10\n      AND i_category = 'Music'\n group by rollup (i_item_id, ca_country, ca_state, ca_county)\n order by ca_country,\n        ca_state,\n        ca_county,\n\ti_item_id\n limit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre\u2011aggregate catalog_sales by cs_item_sk and cs_bill_customer_sk (join keys) before joining with dimensions, then compute the final ROLLUP on dimension columns."
    },
    {
      "patch_id": "p02",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.78,
      "status": "REGRESSION",
      "speedup": 0.69,
      "semantic_passed": true,
      "error": null,
      "original_ms": 871.3,
      "patch_ms": 1259.5,
      "output_sql": "WITH date_dim_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999),\n     customer_demographics_filtered AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_gender = 'F' AND cd_education_status = '4 yr Degree'),\n     customer_filtered AS (SELECT c_customer_sk, c_current_addr_sk, c_birth_year FROM customer WHERE c_birth_month = 12),\n     customer_address_filtered AS (SELECT ca_address_sk, ca_country, ca_state, ca_county FROM customer_address WHERE ca_state IN ('AR', 'IN', 'VA')),\n     item_filtered AS (SELECT i_item_sk, i_item_id FROM item WHERE i_category = 'Music'),\n     cs_filtered AS (\n       SELECT cs.cs_quantity, cs.cs_list_price, cs.cs_coupon_amt, cs.cs_sales_price, cs.cs_net_profit,\n              c.c_birth_year,\n              i.i_item_id,\n              ca.ca_country, ca.ca_state, ca.ca_county\n       FROM catalog_sales cs\n       JOIN date_dim_filtered d ON cs.cs_sold_date_sk = d.d_date_sk\n       JOIN customer_demographics_filtered cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk\n       JOIN customer_filtered c ON cs.cs_bill_customer_sk = c.c_customer_sk\n       JOIN customer_address_filtered ca ON c.c_current_addr_sk = ca.ca_address_sk\n       JOIN item_filtered i ON cs.cs_item_sk = i.i_item_sk\n       WHERE cs.cs_wholesale_cost BETWEEN 5 AND 10\n     )\nSELECT i_item_id,\n       ca_country,\n       ca_state,\n       ca_county,\n       AVG(CAST(cs_quantity AS DECIMAL(12,2))) AS agg1,\n       AVG(CAST(cs_list_price AS DECIMAL(12,2))) AS agg2,\n       AVG(CAST(cs_coupon_amt AS DECIMAL(12,2))) AS agg3,\n       AVG(CAST(cs_sales_price AS DECIMAL(12,2))) AS agg4,\n       AVG(CAST(cs_net_profit AS DECIMAL(12,2))) AS agg5,\n       AVG(CAST(c_birth_year AS DECIMAL(12,2))) AS agg6\nFROM cs_filtered\nGROUP BY ROLLUP (i_item_id, ca_country, ca_state, ca_county)\nORDER BY ca_country, ca_state, ca_county, i_item_id\nLIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre\u2011filter all selective dimensions (date_dim, customer_demographics, customer, customer_address, item) into separate CTEs, then join them with catalog_sales using explicit JOIN syntax."
    },
    {
      "patch_id": "p03",
      "family": "A",
      "transform": "early_filter",
      "relevance_score": 0.55,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": true,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "select  i_item_id,\n        ca_country,\n        ca_state,\n        ca_county,\n        avg( cast(cs_quantity as decimal(12,2))) agg1,\n        avg( cast(cs_list_price as decimal(12,2))) agg2,\n        avg( cast(cs_coupon_amt as decimal(12,2))) agg3,\n        avg( cast(cs_sales_price as decimal(12,2))) agg4,\n        avg( cast(cs_net_profit as decimal(12,2))) agg5,\n        avg( cast(c_birth_year as decimal(12,2))) agg6\nfrom catalog_sales, customer_demographics, customer, customer_address, date_dim, item\nwhere cs_sold_date_sk = d_date_sk and\n      cs_item_sk = i_item_sk and\n      cs_bill_cdemo_sk = cd_demo_sk and\n      cs_bill_customer_sk = c_customer_sk and\n      cd_gender = 'F' and\n      cd_education_status = '4 yr Degree' and\n      c_current_addr_sk = ca_address_sk and\n      d_year = 1999 and\n      c_birth_month = 12 and\n      ca_state in ('AR', 'IN', 'VA')\n      and cs_wholesale_cost BETWEEN 5 AND 10\n      AND i_category = 'Music'\n group by rollup (i_item_id, ca_country, ca_state, ca_county)\n order by ca_country,\n        ca_state,\n        ca_county,\n\ti_item_id\n limit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Push selective dimension filters (date_dim, customer_demographics, customer, customer_address, item) into CTEs and join them with catalog_sales using explicit JOINs, preserving the original WHERE predicates."
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "NEUTRAL",
      "speedup": 0.97,
      "semantic_passed": true,
      "error": null,
      "original_ms": 1818.7,
      "patch_ms": 1869.1,
      "output_sql": "SELECT i.i_item_id, ca.ca_country, ca.ca_state, ca.ca_county, AVG(CAST(cs.cs_quantity AS DECIMAL(12,2))) AS agg1, AVG(CAST(cs.cs_list_price AS DECIMAL(12,2))) AS agg2, AVG(CAST(cs.cs_coupon_amt AS DECIMAL(12,2))) AS agg3, AVG(CAST(cs.cs_sales_price AS DECIMAL(12,2))) AS agg4, AVG(CAST(cs.cs_net_profit AS DECIMAL(12,2))) AS agg5, AVG(CAST(c.c_birth_year AS DECIMAL(12,2))) AS agg6 FROM catalog_sales cs INNER JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk AND d.d_year = 1999 INNER JOIN item i ON cs.cs_item_sk = i.i_item_sk AND i.i_category = 'Music' INNER JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk AND cd.cd_gender = 'F' AND cd.cd_education_status = '4 yr Degree' INNER JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk AND c.c_birth_month = 12 INNER JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk AND ca.ca_state IN ('AR', 'IN', 'VA') WHERE cs.cs_wholesale_cost BETWEEN 5 AND 10 GROUP BY ROLLUP (i.i_item_id, ca.ca_country, ca.ca_state, ca.ca_county) ORDER BY ca.ca_country, ca.ca_state, ca.ca_county, i.i_item_id LIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p01": "Limit  (rows=1, time=916.038)\n  Sort  (rows=1, time=916.035)\n    Aggregate  (rows=1, time=915.983)\n      Sort  (rows=0, time=915.967)\n        Nested Loop  (rows=0, time=915.944)\n          Gather  (rows=2, time=915.872)\n            Nested Loop  (rows=1, time=740.572)\n              Nested Loop  (rows=39, time=739.493)\n                Nested Loop  (rows=585, time=727.715)\n                  Nested Loop  (rows=67790, time=364.588)\n                    Index Only Scan on date_dim  (rows=182, time=2.238",
    "p04": "Limit  (rows=1, time=881.821)\n  Sort  (rows=1, time=881.817)\n    Aggregate  (rows=1, time=881.756)\n      Sort  (rows=0, time=881.734)\n        Nested Loop  (rows=0, time=881.71)\n          Gather  (rows=2, time=881.639)\n            Nested Loop  (rows=1, time=479.705)\n              Nested Loop  (rows=26, time=479.027)\n                Nested Loop  (rows=390, time=471.493)\n                  Nested Loop  (rows=45193, time=233.671)\n                    Index Only Scan on date_dim  (rows=122, time=1.461)",
    "p02": "Limit  (rows=1, time=948.67)\n  Sort  (rows=1, time=948.666)\n    Aggregate  (rows=1, time=948.603)\n      Sort  (rows=0, time=948.585)\n        Nested Loop  (rows=0, time=948.554)\n          Gather  (rows=2, time=948.46)\n            Nested Loop  (rows=1, time=756.473)\n              Nested Loop  (rows=39, time=755.361)\n                Nested Loop  (rows=585, time=743.791)\n                  Nested Loop  (rows=67790, time=367.604)\n                    Index Only Scan on date_dim  (rows=182, time=1.877)\n",
    "compile_p1": "Limit  (rows=1, time=1619.612)\n  Sort  (rows=1, time=1619.608)\n    Aggregate  (rows=1, time=1619.557)\n      Sort  (rows=0, time=1619.541)\n        Nested Loop  (rows=0, time=1619.53)\n          Gather  (rows=2, time=1619.385)\n            Nested Loop  (rows=2, time=1618.721)\n              Nested Loop  (rows=78, time=1615.521)\n                Nested Loop  (rows=1170, time=1586.529)\n                  Nested Loop  (rows=135580, time=714.911)\n                    Index Only Scan on date_dim (d)  (rows=3"
  }
}