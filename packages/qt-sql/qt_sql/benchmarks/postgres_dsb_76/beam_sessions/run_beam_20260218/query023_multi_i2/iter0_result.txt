{
  "iteration": 0,
  "n_api_calls": 10,
  "beam_cost_usd": 0.03672668,
  "beam_cost_priced_calls": 10,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 146228,
    "completion_tokens": 29273,
    "total_tokens": 175501,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 71232,
    "reasoning_tokens": 17454
  },
  "best_speedup": 1.26,
  "best_patch_id": "p01",
  "best_sql": "WITH filtered_date_dim AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 1999), max_store_sales AS (SELECT MAX(csales) AS tpcds_cmax FROM (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS csales FROM store_sales, customer, date_dim WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND ss_wholesale_cost BETWEEN 26 AND 36 GROUP BY c_customer_sk) AS tmp1), frequent_ss_items AS (SELECT substring(i_item_desc,1,30) AS itemdesc, i_item_sk AS item_sk, d_date AS solddate, count(*) AS cnt FROM store_sales INNER JOIN filtered_date_dim ON ss_sold_date_sk = d_date_sk INNER JOIN item ON ss_item_sk = i_item_sk WHERE i_manager_id BETWEEN 44 AND 63 AND i_category IN ('Men', 'Music', 'Sports') GROUP BY substring(i_item_desc,1,30), i_item_sk, d_date HAVING count(*) > 4), best_ss_customer AS (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS ssales FROM store_sales, customer WHERE ss_customer_sk = c_customer_sk AND c_birth_year BETWEEN 1987 AND 1993 GROUP BY c_customer_sk HAVING SUM(ss_quantity * ss_sales_price) > (95 / 100.0) * (SELECT * FROM max_store_sales)) SELECT SUM(sales) FROM (SELECT cs_quantity * cs_list_price AS sales FROM catalog_sales, date_dim WHERE d_year = 1999 AND d_moy = 5 AND cs_sold_date_sk = d_date_sk AND cs_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND cs_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) AND cs_wholesale_cost BETWEEN 26 AND 36 UNION ALL SELECT ws_quantity * ws_list_price AS sales FROM web_sales, date_dim WHERE d_year = 1999 AND d_moy = 5 AND ws_sold_date_sk = d_date_sk AND ws_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND ws_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) AND ws_wholesale_cost BETWEEN 26 AND 36) AS tmp2 LIMIT 100;",
  "patches": [
    {
      "patch_id": "p01",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.8,
      "status": "WIN",
      "speedup": 1.26,
      "semantic_passed": true,
      "error": null,
      "original_ms": 2677.6,
      "patch_ms": 2117.6,
      "output_sql": "WITH filtered_date_dim AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 1999), max_store_sales AS (SELECT MAX(csales) AS tpcds_cmax FROM (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS csales FROM store_sales, customer, date_dim WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND ss_wholesale_cost BETWEEN 26 AND 36 GROUP BY c_customer_sk) AS tmp1), frequent_ss_items AS (SELECT substring(i_item_desc,1,30) AS itemdesc, i_item_sk AS item_sk, d_date AS solddate, count(*) AS cnt FROM store_sales INNER JOIN filtered_date_dim ON ss_sold_date_sk = d_date_sk INNER JOIN item ON ss_item_sk = i_item_sk WHERE i_manager_id BETWEEN 44 AND 63 AND i_category IN ('Men', 'Music', 'Sports') GROUP BY substring(i_item_desc,1,30), i_item_sk, d_date HAVING count(*) > 4), best_ss_customer AS (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS ssales FROM store_sales, customer WHERE ss_customer_sk = c_customer_sk AND c_birth_year BETWEEN 1987 AND 1993 GROUP BY c_customer_sk HAVING SUM(ss_quantity * ss_sales_price) > (95 / 100.0) * (SELECT * FROM max_store_sales)) SELECT SUM(sales) FROM (SELECT cs_quantity * cs_list_price AS sales FROM catalog_sales, date_dim WHERE d_year = 1999 AND d_moy = 5 AND cs_sold_date_sk = d_date_sk AND cs_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND cs_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) AND cs_wholesale_cost BETWEEN 26 AND 36 UNION ALL SELECT ws_quantity * ws_list_price AS sales FROM web_sales, date_dim WHERE d_year = 1999 AND d_moy = 5 AND ws_sold_date_sk = d_date_sk AND ws_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND ws_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) AND ws_wholesale_cost BETWEEN 26 AND 36) AS tmp2 LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Convert comma-separated joins in frequent_ss_items CTE to explicit INNER JOINs and pre-filter date_dim into a materialized CTE for early selectivity, preserving all predicates."
    },
    {
      "patch_id": "p03",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.5,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: column \"c.c_customer_sk\" must appear in the GROUP BY clause or be used in an aggregate function\nLINE 1: ...ustomer_sk) AS tmp1), best_ss_customer AS (SELECT c.c_custom...\n                                                             ^\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH frequent_ss_items AS (SELECT SUBSTRING(i_item_desc FROM 1 FOR 30) AS itemdesc, i_item_sk AS item_sk, d_date AS solddate, COUNT(*) AS cnt FROM store_sales, date_dim, item WHERE ss_sold_date_sk = d_date_sk AND ss_item_sk = i_item_sk AND d_year = 1999 AND i_manager_id BETWEEN 44 AND 63 AND i_category IN ('Men', 'Music', 'Sports') GROUP BY SUBSTRING(i_item_desc FROM 1 FOR 30), i_item_sk, d_date HAVING COUNT(*) > 4), max_store_sales AS (SELECT MAX(csales) AS tpcds_cmax FROM (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS csales FROM store_sales, customer, date_dim WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND ss_wholesale_cost BETWEEN 26 AND 36 GROUP BY c_customer_sk) AS tmp1), best_ss_customer AS (SELECT c.c_customer_sk, ssbc.total_sales AS ssales FROM customer c JOIN (SELECT ss_customer_sk, SUM(ss_quantity * ss_sales_price) AS total_sales FROM store_sales WHERE ss_customer_sk IS NOT NULL GROUP BY ss_customer_sk) ssbc ON c.c_customer_sk = ssbc.ss_customer_sk CROSS JOIN max_store_sales mss HAVING ssbc.total_sales > (95/100.0) * mss.tpcds_cmax) SELECT SUM(sales) FROM (SELECT cs_quantity * cs_list_price AS sales FROM catalog_sales, date_dim WHERE d_year = 1999 AND d_moy = 5 AND cs_sold_date_sk = d_date_sk AND cs_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND cs_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) AND cs_wholesale_cost BETWEEN 26 AND 36 UNION ALL SELECT ws_quantity * ws_list_price AS sales FROM web_sales, date_dim WHERE d_year = 1999 AND d_moy = 5 AND ws_sold_date_sk = d_date_sk AND ws_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND ws_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) AND ws_wholesale_cost BETWEEN 26 AND 36) AS tmp2 LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre-aggregate store_sales by customer key in best_ss_customer CTE before joining with customer dimension, while preserving the HAVING filter on max_store_sales."
    },
    {
      "patch_id": "p02",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.75,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "with date_dim_prefetch as (select d_date_sk from date_dim where d_year = 1999 and d_moy = 5), item_prefetch as (select i_item_sk from item where i_manager_id between 44 and 63 and i_category in ('Men', 'Music', 'Sports')), customer_prefetch as (select c_customer_sk from customer where c_birth_year between 1987 and 1993) select sum(sales) from (select cs_quantity*cs_list_price sales from catalog_sales join date_dim_prefetch on cs_sold_date_sk = d_date_sk join item_prefetch on cs_item_sk = i_item_sk join customer_prefetch on cs_bill_customer_sk = c_customer_sk where cs_wholesale_cost between 26 and 36 and cs_item_sk in (select item_sk from frequent_ss_items) and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer) union all select ws_quantity*ws_list_price sales from web_sales join date_dim_prefetch ddp2 on ws_sold_date_sk = ddp2.d_date_sk join item_prefetch ip2 on ws_item_sk = ip2.i_item_sk join customer_prefetch cp2 on ws_bill_customer_sk = cp2.c_customer_sk where ws_wholesale_cost between 26 and 36 and ws_item_sk in (select item_sk from frequent_ss_items) and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)) tmp2 limit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre-filter all selective dimensions (date_dim, item, customer) into materialized CTEs before fact-table joins in the final_select, using explicit JOIN syntax to improve cardinality estimates."
    },
    {
      "patch_id": "p04",
      "family": "E",
      "transform": "materialize_cte",
      "relevance_score": 0.4,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_store_sales AS (SELECT ss.ss_item_sk, ss.ss_customer_sk, ss.ss_quantity, ss.ss_sales_price, ss.ss_sold_date_sk FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE d.d_year = 1999 AND ss.ss_wholesale_cost BETWEEN 26 AND 36), frequent_ss_items AS (SELECT substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt FROM filtered_store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk WHERE i_manager_id BETWEEN 44 and 63 AND i_category IN ('Men', 'Music', 'Sports') GROUP BY substring(i_item_desc,1,30),i_item_sk,d_date HAVING count(*) >4), max_store_sales AS (SELECT max(csales) tpcds_cmax FROM (SELECT c_customer_sk,sum(ss_quantity*ss_sales_price) csales FROM filtered_store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk GROUP BY c_customer_sk) tmp1), best_ss_customer AS (SELECT c_customer_sk,sum(ss_quantity*ss_sales_price) ssales FROM filtered_store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk GROUP BY c_customer_sk HAVING sum(ss_quantity*ss_sales_price) > (95/100.0) * (SELECT tpcds_cmax FROM max_store_sales)) SELECT SUM(sales) FROM (SELECT cs_quantity * cs_list_price AS sales FROM catalog_sales, date_dim WHERE d_year = 1999 AND d_moy = 5 AND cs_sold_date_sk = d_date_sk AND cs_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND cs_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) AND cs_wholesale_cost BETWEEN 26 AND 36 UNION ALL SELECT ws_quantity * ws_list_price AS sales FROM web_sales, date_dim WHERE d_year = 1999 AND d_moy = 5 AND ws_sold_date_sk = d_date_sk AND ws_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND ws_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) AND ws_wholesale_cost BETWEEN 26 AND 36) AS tmp2 LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Materialize a shared filtered store_sales CTE with common predicates (e.g., date range and wholesale cost) to avoid redundant scans across multiple CTEs, referenced by frequent_ss_items and best_ss_customer."
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.59,
      "semantic_passed": true,
      "error": null,
      "original_ms": 4266.8,
      "patch_ms": 7194.1,
      "output_sql": "WITH filtered_date_dim AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 1999), max_store_sales AS (SELECT MAX(csales) AS tpcds_cmax FROM (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS csales FROM store_sales, customer, date_dim WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND ss_wholesale_cost BETWEEN 26 AND 36 GROUP BY c_customer_sk) AS tmp1), frequent_ss_items AS (SELECT substring(i_item_desc,1,30) AS itemdesc, i_item_sk AS item_sk, d_date AS solddate, count(*) AS cnt FROM store_sales INNER JOIN filtered_date_dim ON ss_sold_date_sk = d_date_sk INNER JOIN item ON ss_item_sk = i_item_sk WHERE i_manager_id BETWEEN 44 AND 63 AND i_category IN ('Men', 'Music', 'Sports') GROUP BY substring(i_item_desc,1,30), i_item_sk, d_date HAVING count(*) > 4), best_ss_customer AS (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS ssales FROM store_sales, customer WHERE ss_customer_sk = c_customer_sk AND c_birth_year BETWEEN 1987 AND 1993 GROUP BY c_customer_sk HAVING SUM(ss_quantity * ss_sales_price) > (95 / 100.0) * (SELECT * FROM max_store_sales)) SELECT SUM(sales) FROM (SELECT cs_quantity * cs_list_price AS sales FROM catalog_sales, date_dim WHERE d_year = 1999 AND d_moy = 5 AND cs_sold_date_sk = d_date_sk AND cs_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND cs_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) AND cs_wholesale_cost BETWEEN 26 AND 36 UNION ALL SELECT ws_quantity * ws_list_price AS sales FROM web_sales, date_dim WHERE d_year = 1999 AND d_moy = 5 AND ws_sold_date_sk = d_date_sk AND ws_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND ws_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) AND ws_wholesale_cost BETWEEN 26 AND 36) AS tmp2 LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p2",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.66,
      "semantic_passed": true,
      "error": null,
      "original_ms": 4266.8,
      "patch_ms": 6496.8,
      "output_sql": "WITH date_dim_final AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy = 5), filtered_date_dim AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 1999), frequent_ss_items AS (SELECT substring(i_item_desc,1,30) AS itemdesc, i_item_sk AS item_sk, d_date AS solddate, count(*) AS cnt FROM store_sales INNER JOIN filtered_date_dim ON ss_sold_date_sk = d_date_sk INNER JOIN item ON ss_item_sk = i_item_sk WHERE i_manager_id BETWEEN 44 AND 63 AND i_category IN ('Men', 'Music', 'Sports') GROUP BY substring(i_item_desc,1,30), i_item_sk, d_date HAVING count(*) > 4), max_store_sales AS (SELECT MAX(csales) AS tpcds_cmax FROM (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS csales FROM store_sales INNER JOIN customer ON ss_customer_sk = c_customer_sk INNER JOIN filtered_date_dim ON ss_sold_date_sk = d_date_sk WHERE ss_wholesale_cost BETWEEN 26 AND 36 GROUP BY c_customer_sk) AS tmp1), best_ss_customer AS (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS ssales FROM store_sales INNER JOIN customer ON ss_customer_sk = c_customer_sk CROSS JOIN max_store_sales WHERE c_birth_year BETWEEN 1987 AND 1993 GROUP BY c_customer_sk, max_store_sales.tpcds_cmax HAVING SUM(ss_quantity * ss_sales_price) > (95/100.0) * tpcds_cmax) SELECT SUM(sales) FROM (SELECT cs_quantity * cs_list_price AS sales FROM catalog_sales INNER JOIN date_dim_final ON cs_sold_date_sk = d_date_sk WHERE cs_wholesale_cost BETWEEN 26 AND 36 AND cs_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND cs_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) UNION ALL SELECT ws_quantity * ws_list_price AS sales FROM web_sales INNER JOIN date_dim_final ON ws_sold_date_sk = d_date_sk WHERE ws_wholesale_cost BETWEEN 26 AND 36 AND ws_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND ws_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer)) AS tmp2 LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.67,
      "semantic_passed": true,
      "error": null,
      "original_ms": 4266.8,
      "patch_ms": 6340.2,
      "output_sql": "WITH date_dim_final AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 1999 AND d_moy = 5), filtered_date_dim AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 1999), max_store_sales AS (SELECT MAX(csales) AS tpcds_cmax FROM (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS csales FROM store_sales, customer, date_dim WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND ss_wholesale_cost BETWEEN 26 AND 36 GROUP BY c_customer_sk) AS tmp1), frequent_ss_items AS (SELECT substring(i_item_desc,1,30) AS itemdesc, i_item_sk AS item_sk, d_date AS solddate, count(*) AS cnt FROM store_sales INNER JOIN filtered_date_dim ON ss_sold_date_sk = d_date_sk INNER JOIN item ON ss_item_sk = i_item_sk WHERE i_manager_id BETWEEN 44 AND 63 AND i_category IN ('Men', 'Music', 'Sports') GROUP BY substring(i_item_desc,1,30), i_item_sk, d_date HAVING count(*) > 4), best_ss_customer AS (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS ssales FROM store_sales, customer WHERE ss_customer_sk = c_customer_sk AND c_birth_year BETWEEN 1987 AND 1993 GROUP BY c_customer_sk HAVING SUM(ss_quantity * ss_sales_price) > (95 / 100.0) * (SELECT * FROM max_store_sales)) SELECT SUM(sales) FROM (SELECT cs_quantity * cs_list_price AS sales FROM catalog_sales INNER JOIN date_dim_final ON cs_sold_date_sk = d_date_sk INNER JOIN frequent_ss_items fsi ON cs_item_sk = fsi.item_sk INNER JOIN best_ss_customer bsc ON cs_bill_customer_sk = bsc.c_customer_sk WHERE cs_wholesale_cost BETWEEN 26 AND 36 UNION ALL SELECT ws_quantity * ws_list_price AS sales FROM web_sales INNER JOIN date_dim_final d ON ws_sold_date_sk = d.d_date_sk INNER JOIN frequent_ss_items fsi2 ON ws_item_sk = fsi2.item_sk INNER JOIN best_ss_customer bsc2 ON ws_bill_customer_sk = bsc2.c_customer_sk WHERE ws_wholesale_cost BETWEEN 26 AND 36) tmp2 LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p2",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "REGRESSION",
      "speedup": 0.59,
      "semantic_passed": true,
      "error": null,
      "original_ms": 4266.8,
      "patch_ms": 7192.1,
      "output_sql": "WITH filtered_date_dim AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 1999), max_store_sales AS (SELECT MAX(csales) AS tpcds_cmax FROM (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS csales FROM store_sales, customer, date_dim WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND ss_wholesale_cost BETWEEN 26 AND 36 GROUP BY c_customer_sk) AS tmp1), frequent_ss_items AS (SELECT substring(i_item_desc,1,30) AS itemdesc, i_item_sk AS item_sk, d_date AS solddate, count(*) AS cnt FROM store_sales INNER JOIN filtered_date_dim ON ss_sold_date_sk = d_date_sk INNER JOIN item ON ss_item_sk = i_item_sk WHERE i_manager_id BETWEEN 44 AND 63 AND i_category IN ('Men', 'Music', 'Sports') GROUP BY substring(i_item_desc,1,30), i_item_sk, d_date HAVING count(*) > 4), best_ss_customer AS (SELECT c.c_customer_sk, SUM(ss.ss_quantity * ss.ss_sales_price) AS ssales FROM store_sales ss INNER JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk WHERE c.c_birth_year BETWEEN 1987 AND 1993 GROUP BY c.c_customer_sk HAVING SUM(ss.ss_quantity * ss.ss_sales_price) > (95/100.0) * (SELECT tpcds_cmax FROM max_store_sales)) SELECT SUM(sales) FROM (SELECT cs_quantity * cs_list_price AS sales FROM catalog_sales, date_dim WHERE d_year = 1999 AND d_moy = 5 AND cs_sold_date_sk = d_date_sk AND cs_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND cs_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) AND cs_wholesale_cost BETWEEN 26 AND 36 UNION ALL SELECT ws_quantity * ws_list_price AS sales FROM web_sales, date_dim WHERE d_year = 1999 AND d_moy = 5 AND ws_sold_date_sk = d_date_sk AND ws_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND ws_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) AND ws_wholesale_cost BETWEEN 26 AND 36) AS tmp2 LIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p01": "Limit  (rows=1, time=3505.532)\n  Aggregate  (rows=2, time=154.964)\n    Gather Merge  (rows=83570, time=142.811)\n      Aggregate  (rows=27857, time=116.836)\n        Sort  (rows=30562, time=110.193)\n          Hash Join  (rows=30562, time=84.069)\n            Nested Loop  (rows=208254, time=64.626)\n              Seq Scan on item  (rows=1389, time=13.055)\n              Index Only Scan on store_sales  (rows=150, time=0.028)\n            Hash  (rows=365, time=0.168)\n              Index Scan on date_dim ",
    "compile_p1": "Limit  (rows=1, time=5177.22)\n  Index Scan on date_dim  (rows=31, time=0.087)\n  Aggregate  (rows=2, time=343.912)\n    Gather Merge  (rows=83570, time=324.122)\n      Aggregate  (rows=83570, time=318.688)\n        Sort  (rows=91687, time=295.56)\n          Hash Join  (rows=91687, time=205.995)\n            Nested Loop  (rows=624762, time=153.061)\n              Seq Scan on item  (rows=4168, time=33.804)\n              Index Only Scan on store_sales  (rows=150, time=0.021)\n            Hash  (rows=365, t",
    "compile_p2": "Limit  (rows=1, time=4677.774)\n  Aggregate  (rows=2, time=301.767)\n    Gather Merge  (rows=83570, time=288.35)\n      Aggregate  (rows=41785, time=181.124)\n        Sort  (rows=45844, time=172.3)\n          Hash Join  (rows=45844, time=128.369)\n            Nested Loop  (rows=312381, time=99.013)\n              Seq Scan on item  (rows=2084, time=24.319)\n              Index Only Scan on store_sales  (rows=150, time=0.027)\n            Hash  (rows=365, time=0.331)\n              Index Scan on date_dim (d"
  }
}