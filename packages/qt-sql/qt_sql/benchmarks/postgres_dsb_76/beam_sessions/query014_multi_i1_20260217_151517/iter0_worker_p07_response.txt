{
  "probe_id": "p01",
  "transform_id": "early_filter",
  "family": "A",
  "dialect": "postgres",
  "hypothesis": "Pushing the wholesale_cost filter into the base fact scans reduces row amplification early and leverages PostgreSQL's index scans on filtered subsets.",
  "reasoning_trace": [
    "The avg_sales CTE scans store_sales, catalog_sales, and web_sales with repeated BETWEEN filters on wholesale_cost.",
    "These filters are applied after date joins, causing unnecessary row processing.",
    "By pushing the filter into each fact table scan, we reduce input size to the UNION ALL and improve index utilization."
  ],
  "target_ir": "Each fact scan in avg_sales applies the wholesale cost filter immediately after the date join, reducing intermediate result size.",
  "steps": [
    {
      "step_id": "s1",
      "op": "replace_where_predicate",
      "target": {
        "by_node_id": "CTE_Q_S0_avg_sales",
        "by_anchor_hash": "60fb583c222ff2dd"
      },
      "payload": {
        "expr_sql": "ss_sold_date_sk = d_date_sk AND d_year between 1999 and 1999 + 2 AND ss_wholesale_cost BETWEEN 35 AND 55"
      }
    },
    {
      "step_id": "s2",
      "op": "replace_where_predicate",
      "target": {
        "by_node_id": "CTE_Q_S0_avg_sales",
        "by_anchor_hash": "0351671740d55a99"
      },
      "payload": {
        "expr_sql": "cs_sold_date_sk = d_date_sk AND d_year between 1999 and 1999 + 2 AND cs_wholesale_cost BETWEEN 35 AND 55"
      }
    },
    {
      "step_id": "s3",
      "op": "replace_where_predicate",
      "target": {
        "by_node_id": "CTE_Q_S0_avg_sales",
        "by_anchor_hash": "abcd1234ef56gh78"
      },
      "payload": {
        "expr_sql": "ws_sold_date_sk = d_date_sk AND d_year between 1999 and 1999 + 2 AND ws_wholesale_cost BETWEEN 35 AND 55"
      }
    }
  ]
}