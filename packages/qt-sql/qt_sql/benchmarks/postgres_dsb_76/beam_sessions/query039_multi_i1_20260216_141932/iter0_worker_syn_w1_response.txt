{
  "plan_id": "postgres_reducer_cardinality_reduction",
  "dialect": "postgres",
  "description": "Apply early filtering in CTE by pushing down d_moy predicate and retaining only necessary columns. Convert self-cross join to explicit join with pushed filters.",
  "preconditions": [
    {
      "kind": "parse_ok"
    }
  ],
  "postconditions": [
    {
      "kind": "parse_ok"
    }
  ],
  "steps": [
    {
      "step_id": "s1",
      "op": "replace_body",
      "target": {
        "by_node_id": "CTE_Q_S0_inv"
      },
      "payload": {
        "sql_fragment": "SELECT w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy,stddev_samp(inv_quantity_on_hand) stdev,avg(inv_quantity_on_hand) mean FROM inventory,item,warehouse,date_dim WHERE inv_item_sk = i_item_sk AND inv_warehouse_sk = w_warehouse_sk AND inv_date_sk = d_date_sk AND d_year = 2002 AND i_category IN ('Jewelry', 'Men') AND i_manager_id BETWEEN 81 AND 100 AND inv_quantity_on_hand BETWEEN 0 AND 200 AND d_moy IN (2, 3) GROUP BY w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy"
      },
      "description": "Replace CTE body with early filtered and grouped query"
    },
    {
      "step_id": "s2",
      "op": "replace_where_predicate",
      "target": {
        "by_node_id": "Q_S0",
        "by_anchor_hash": "7c17a3840cbbb8b9"
      },
      "payload": {
        "expr_sql": "inv1.i_item_sk = inv2.i_item_sk AND inv1.w_warehouse_sk = inv2.w_warehouse_sk AND inv1.d_moy = 2 AND inv2.d_moy = 3"
      },
      "description": "Replace main query WHERE clause with simplified join condition"
    }
  ]
}