{
  "probe_id": "p01",
  "transform_id": "materialize_cte",
  "family": "E",
  "dialect": "postgres",
  "hypothesis": "Materializing the store_sales subquery into a CTE will avoid repeated scans and enable reuse in decorrelation steps.",
  "reasoning_trace": [
    "The store_sales subquery is used in an EXISTS clause with specific filters on list price, date range, and customer key.",
    "Extracting this pattern into a CTE named ss_filtered ensures it's computed once and reused, reducing runtime cost.",
    "This aligns with the node contract requiring 'ss_filtered' in FROM and preserving original list_price and date filters."
  ],
  "target_ir": "A new CTE named ss_filtered is added that selects ss_customer_sk from store_sales joined with date_dim, applying all relevant filters.",
  "steps": [
    {
      "step_id": "s1",
      "op": "insert_cte",
      "target": {"by_node_id": "S0"},
      "payload": {
        "cte_name": "ss_filtered",
        "cte_query_sql": "SELECT ss_customer_sk FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 12 AND ss_list_price BETWEEN 80 AND 169"
      }
    }
  ]
}