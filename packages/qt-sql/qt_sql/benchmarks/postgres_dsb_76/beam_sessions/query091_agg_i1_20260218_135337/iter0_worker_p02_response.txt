{
  "probe_id": "scout_dimension_prefetch_star",
  "transform_id": "dimension_prefetch_star",
  "family": "F",
  "status": "success",
  "dialect": "postgresql",
  "hypothesis": "Pre-filtering selective dimensions into CTEs reduces catalog_returns scan size. Explicit JOINs improve cardinality estimates and enable early pruning.",
  "reasoning_trace": [
    "Sequential scan on catalog_returns dominates runtime (1579ms).",
    "Dimension filters are applied after the fact scan; moving them earlier should reduce rows.",
    "OR condition on customer_demographics uses index but is still late; no change to avoid fighting BitmapOr strength.",
    "All required dimensions (date_dim, customer_demographics, household_demographics, customer_address, call_center) have selective filters."
  ],
  "target_ir": "Dimension tables filtered early into CTEs, joined into a small keyset, then joined with catalog_returns.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["cr_filtered"],
        "outputs": ["Call_Center", "Call_Center_Name", "Manager", "Returns_Loss"],
        "changed": true,
        "sql": "SELECT cc.cc_call_center_id AS Call_Center, cc.cc_name AS Call_Center_Name, cc.cc_manager AS Manager, SUM(cr.cr_net_loss) AS Returns_Loss FROM cr_filtered cr JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_manager ORDER BY SUM(cr.cr_net_loss) DESC"
      },
      {
        "node_id": "cr_filtered",
        "parent_node_id": "final_select",
        "sources": ["catalog_returns", "dim_keyset"],
        "outputs": ["cr_call_center_sk", "cr_net_loss"],
        "changed": true,
        "sql": "SELECT cr.cr_call_center_sk, cr.cr_net_loss FROM catalog_returns cr JOIN dim_keyset dk ON cr.cr_returned_date_sk = dk.d_date_sk AND cr.cr_returning_customer_sk = dk.c_customer_sk AND cr.cr_call_center_sk = dk.cc_call_center_sk"
      },
      {
        "node_id": "dim_keyset",
        "parent_node_id": "cr_filtered",
        "sources": ["date_dim", "customer", "customer_demographics", "household_demographics", "customer_address", "call_center"],
        "outputs": ["d_date_sk", "c_customer_sk", "cc_call_center_sk"],
        "changed": true,
        "sql": "WITH date_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998 AND d_moy = 2), customer_filtered AS (SELECT c_customer_sk, c_current_cdemo_sk, c_current_hdemo_sk, c_current_addr_sk FROM customer), cd_filtered AS (SELECT cd_demo_sk FROM customer_demographics WHERE (cd_marital_status = 'M' AND cd_education_status = 'Unknown') OR (cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree')), hd_filtered AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential LIKE '1001-5000%'), ca_filtered AS (SELECT ca_address_sk FROM customer_address WHERE ca_gmt_offset = -7) SELECT d.d_date_sk, c.c_customer_sk, cc.cc_call_center_sk FROM date_filtered d JOIN customer_filtered c ON TRUE JOIN cd_filtered cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN hd_filtered hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN ca_filtered ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk"
      }
    ]
  }
}