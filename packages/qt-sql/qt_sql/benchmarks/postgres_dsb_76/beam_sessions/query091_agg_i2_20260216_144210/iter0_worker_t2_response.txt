{
  "plan_id": "postgres_multi_dimension_prefetch_explicit_join",
  "dialect": "postgres",
  "description": "Pre-filter dimension tables (customer_demographics, household_demographics, customer_address) into a CTE and convert comma joins to explicit INNER JOINs for better join ordering and predicate pushdown.",
  "preconditions": [
    {
      "kind": "parse_ok"
    }
  ],
  "postconditions": [
    {
      "kind": "parse_ok"
    }
  ],
  "steps": [
    {
      "step_id": "s1",
      "op": "insert_cte",
      "target": {
        "by_node_id": "S0"
      },
      "payload": {
        "cte_name": "prefetched_dims",
        "cte_query_sql": "SELECT cd_demo_sk, hd_demo_sk, ca_address_sk, cd_marital_status, cd_education_status FROM customer_demographics, household_demographics, customer_address WHERE ((cd_marital_status = 'M' AND cd_education_status = 'Unknown') OR (cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree')) AND hd_buy_potential LIKE '>10000%' AND ca_gmt_offset = -6"
      },
      "description": "Insert CTE 'prefetched_dims' to pre-filter dimension tables"
    },
    {
      "step_id": "s2",
      "op": "replace_from",
      "target": {
        "by_node_id": "S0"
      },
      "payload": {
        "from_sql": "catalog_returns JOIN date_dim ON cr_returned_date_sk = d_date_sk JOIN call_center ON cr_call_center_sk = cc_call_center_sk JOIN customer ON cr_returning_customer_sk = c_customer_sk JOIN prefetched_dims ON cd_demo_sk = c_current_cdemo_sk AND hd_demo_sk = c_current_hdemo_sk AND ca_address_sk = c_current_addr_sk"
      },
      "description": "Replace FROM clause with explicit JOINs and prefetched_dims CTE"
    },
    {
      "step_id": "s3",
      "op": "replace_where_predicate",
      "target": {
        "by_node_id": "S0"
      },
      "payload": {
        "expr_sql": "d_year = 2001 AND d_moy = 12"
      },
      "description": "Replace WHERE clause to keep only date filters in main query"
    }
  ]
}