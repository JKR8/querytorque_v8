{
  "probe_id": "p12",
  "transform_id": "intersect_to_exists",
  "family": "D",
  "status": "success",
  "dialect": "postgresql",
  "hypothesis": "Rewriting EXCEPT operations using NOT EXISTS anti-joins avoids full materialization of each branch and leverages PostgreSQL's semi-join short-circuit behavior.",
  "reasoning_trace": [
    "Assigned transform targets EXCEPT set operations for rewrite to NOT EXISTS.",
    "Each EXCEPT branch preserves original filtering and join conditions exactly.",
    "NOT EXISTS subqueries are correlated on output columns to maintain semantics.",
    "Final SELECT preserves DISTINCT and column ordering from original query."
  ],
  "target_ir": "Single branch with two NOT EXISTS anti-joins replacing EXCEPT set operations.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["store_sales_branch"],
        "outputs": ["count(*)"],
        "changed": true,
        "sql": "SELECT COUNT(*) FROM (SELECT DISTINCT c_last_name, c_first_name, d_date FROM store_sales, date_dim, customer WHERE store_sales.ss_sold_date_sk = date_dim.d_date_sk AND store_sales.ss_customer_sk = customer.c_customer_sk AND d_month_seq BETWEEN 1214 AND 1214+11 AND ss_list_price BETWEEN 242 AND 271 AND c_birth_year BETWEEN 1955 AND 1961 AND ss_wholesale_cost BETWEEN 35 AND 45 AND NOT EXISTS (SELECT 1 FROM catalog_sales, date_dim AS date_dim_1, customer AS customer_1 WHERE catalog_sales.cs_sold_date_sk = date_dim_1.d_date_sk AND catalog_sales.cs_bill_customer_sk = customer_1.c_customer_sk AND date_dim_1.d_month_seq BETWEEN 1214 AND 1214+11 AND cs_list_price BETWEEN 242 AND 271 AND customer_1.c_birth_year BETWEEN 1955 AND 1961 AND cs_wholesale_cost BETWEEN 35 AND 45 AND catalog_sales.cs_bill_customer_sk = customer.c_customer_sk AND catalog_sales.cs_sold_date_sk = date_dim.d_date_sk AND catalog_sales.cs_list_price = store_sales.ss_list_price AND customer_1.c_last_name = customer.c_last_name AND customer_1.c_first_name = customer.c_first_name AND date_dim_1.d_date = date_dim.d_date) AND NOT EXISTS (SELECT 1 FROM web_sales, date_dim AS date_dim_2, customer AS customer_2 WHERE web_sales.ws_sold_date_sk = date_dim_2.d_date_sk AND web_sales.ws_bill_customer_sk = customer_2.c_customer_sk AND date_dim_2.d_month_seq BETWEEN 1214 AND 1214+11 AND ws_list_price BETWEEN 242 AND 271 AND customer_2.c_birth_year BETWEEN 1955 AND 1961 AND ws_wholesale_cost BETWEEN 35 AND 45 AND web_sales.ws_bill_customer_sk = customer.c_customer_sk AND web_sales.ws_sold_date_sk = date_dim.d_date_sk AND web_sales.ws_list_price = store_sales.ss_list_price AND customer_2.c_last_name = customer.c_last_name AND customer_2.c_first_name = customer.c_first_name AND date_dim_2.d_date = date_dim.d_date)) AS cool_cust"
      }
    ]
  }
}