{
  "probe_id": "p01",
  "transform_id": "or_to_union",
  "family": "D",
  "dialect": "postgres",
  "hypothesis": "Splitting the OR conditions on cd1 into 3 UNION ALL branches may enable index scans per branch instead of a single seq scan with complex filter.",
  "reasoning_trace": [
    "OR conditions on different cd1 columns may block index usage",
    "Three distinct branches allow planner to choose optimal access path per branch",
    "Each branch is self-contained with full projection and filters"
  ],
  "target_ir": "Three UNION ALL branches, each with a simplified WHERE condition on cd1 and full original projection",
  "steps": [
    {
      "step_id": "s1",
      "op": "wrap_query_with_cte",
      "target": {"by_node_id": "S0"},
      "payload": {
        "cte_name": "branch_1",
        "cte_query_sql": "select  substring(r_reason_desc,1,20) as r_reason_desc_sub, avg(ws_quantity) as avg_ws_quantity, avg(wr_refunded_cash) as avg_wr_refunded_cash, avg(wr_fee) as avg_wr_fee from web_sales, web_returns, web_page, customer_demographics cd1, customer_demographics cd2, customer_address, date_dim, reason where ws_web_page_sk = wp_web_page_sk and ws_item_sk = wr_item_sk and ws_order_number = wr_order_number and ws_sold_date_sk = d_date_sk and d_year = 2000 and cd1.cd_demo_sk = wr_refunded_cdemo_sk and cd2.cd_demo_sk = wr_returning_cdemo_sk and ca_address_sk = wr_refunded_addr_sk and r_reason_sk = wr_reason_sk and cd1.cd_marital_status = 'S' and cd1.cd_marital_status = cd2.cd_marital_status and cd1.cd_education_status = 'College' and cd1.cd_education_status = cd2.cd_education_status and ws_sales_price between 100.00 and 150.00 and ((ca_country = 'United States' and ca_state in ('NC', 'PA', 'TX') and ws_net_profit between 100 and 200) or (ca_country = 'United States' and ca_state in ('AR', 'CO', 'NY') and ws_net_profit between 150 and 300) or (ca_country = 'United States' and ca_state in ('IA', 'IL', 'TX') and ws_net_profit between 50 and 250)) group by r_reason_desc"
      }
    },
    {
      "step_id": "s2",
      "op": "insert_cte",
      "target": {"by_node_id": "S0"},
      "payload": {
        "cte_name": "branch_2",
        "cte_query_sql": "select  substring(r_reason_desc,1,20) as r_reason_desc_sub, avg(ws_quantity) as avg_ws_quantity, avg(wr_refunded_cash) as avg_wr_refunded_cash, avg(wr_fee) as avg_wr_fee from web_sales, web_returns, web_page, customer_demographics cd1, customer_demographics cd2, customer_address, date_dim, reason where ws_web_page_sk = wp_web_page_sk and ws_item_sk = wr_item_sk and ws_order_number = wr_order_number and ws_sold_date_sk = d_date_sk and d_year = 2000 and cd1.cd_demo_sk = wr_refunded_cdemo_sk and cd2.cd_demo_sk = wr_returning_cdemo_sk and ca_address_sk = wr_refunded_addr_sk and r_reason_sk = wr_reason_sk and cd1.cd_marital_status = 'W' and cd1.cd_marital_status = cd2.cd_marital_status and cd1.cd_education_status = 'Unknown' and cd1.cd_education_status = cd2.cd_education_status and ws_sales_price between 50.00 and 100.00 and ((ca_country = 'United States' and ca_state in ('NC', 'PA', 'TX') and ws_net_profit between 100 and 200) or (ca_country = 'United States' and ca_state in ('AR', 'CO', 'NY') and ws_net_profit between 150 and 300) or (ca_country = 'United States' and ca_state in ('IA', 'IL', 'TX') and ws_net_profit between 50 and 250)) group by r_reason_desc"
      }
    },
    {
      "step_id": "s3",
      "op": "insert_cte",
      "target": {"by_node_id": "S0"},
      "payload": {
        "cte_name": "branch_3",
        "cte_query_sql": "select  substring(r_reason_desc,1,20) as r_reason_desc_sub, avg(ws_quantity) as avg_ws_quantity, avg(wr_refunded_cash) as avg_wr_refunded_cash, avg(wr_fee) as avg_wr_fee from web_sales, web_returns, web_page, customer_demographics cd1, customer_demographics cd2, customer_address, date_dim, reason where ws_web_page_sk = wp_web_page_sk and ws_item_sk = wr_item_sk and ws_order_number = wr_order_number and ws_sold_date_sk = d_date_sk and d_year = 2000 and cd1.cd_demo_sk = wr_refunded_cdemo_sk and cd2.cd_demo_sk = wr_returning_cdemo_sk and ca_address_sk = wr_refunded_addr_sk and r_reason_sk = wr_reason_sk and cd1.cd_marital_status = 'M' and cd1.cd_marital_status = cd2.cd_marital_status and cd1.cd_education_status = 'Secondary' and cd1.cd_education_status = cd2.cd_education_status and ws_sales_price between 150.00 and 200.00 and ((ca_country = 'United States' and ca_state in ('NC', 'PA', 'TX') and ws_net_profit between 100 and 200) or (ca_country = 'United States' and ca_state in ('AR', 'CO', 'NY') and ws_net_profit between 150 and 300) or (ca_country = 'United States' and ca_state in ('IA', 'IL', 'TX') and ws_net_profit between 50 and 250)) group by r_reason_desc"
      }
    },
    {
      "step_id": "s4",
      "op": "replace_body",
      "target": {"by_node_id": "S0"},
      "payload": {
        "sql_fragment": "select * from branch_1 union all select * from branch_2 union all select * from branch_3 order by r_reason_desc_sub, avg_ws_quantity, avg_wr_refunded_cash, avg_wr_fee limit 100"
      }
    }
  ]
}