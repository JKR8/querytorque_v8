{
  "iteration": 0,
  "n_api_calls": 6,
  "best_speedup": 1.14,
  "best_patch_id": "t2",
  "best_sql": "WITH filtered_dates AS (SELECT d2.d_date_sk AS ret_date_sk, d1.d_date_sk AS sold_date_sk FROM date_dim AS d2 JOIN date_dim AS d1 ON d1.d_date BETWEEN (d2.d_date - INTERVAL '120 DAY') AND d2.d_date WHERE d2.d_year = 1999 AND d2.d_moy = 7) SELECT s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip, SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 30) AND (sr_returned_date_sk - ss_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 60) AND (sr_returned_date_sk - ss_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 90) AND (sr_returned_date_sk - ss_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM store_sales JOIN store_returns ON ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk AND ss_customer_sk = sr_customer_sk JOIN filtered_dates AS fd ON ss_sold_date_sk = fd.sold_date_sk AND sr_returned_date_sk = fd.ret_date_sk JOIN store ON ss_store_sk = s_store_sk WHERE TRUE GROUP BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip ORDER BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip LIMIT 100;",
  "patches": [
    {
      "patch_id": "t1",
      "family": "C",
      "transform": "aggregation_pushdown",
      "relevance_score": 0.95,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Equivalence execution error: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH pre_agg AS (SELECT ss_store_sk, SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 30 AND sr_returned_date_sk - ss_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 60 AND sr_returned_date_sk - ss_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 90 AND sr_returned_date_sk - ss_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM store_sales JOIN store_returns ON ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk AND ss_customer_sk = sr_customer_sk JOIN date_dim AS d1 ON ss_sold_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON sr_returned_date_sk = d2.d_date_sk WHERE d2.d_year = 1999 AND d2.d_moy = 7 AND d1.d_date BETWEEN (d2.d_date - INTERVAL '120 DAY') AND d2.d_date GROUP BY ss_store_sk) SELECT s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip, \"30 days\", \"31-60 days\", \"61-90 days\", \"91-120 days\", \">120 days\" FROM pre_agg JOIN store ON ss_store_sk = s_store_sk ORDER BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip LIMIT 100;",
      "has_explain": false
    },
    {
      "patch_id": "t2",
      "family": "A",
      "transform": "early_filtering",
      "relevance_score": 0.85,
      "status": "WIN",
      "speedup": 1.14,
      "semantic_passed": true,
      "error": null,
      "original_ms": 518.3,
      "patch_ms": 454.1,
      "output_sql": "WITH filtered_dates AS (SELECT d2.d_date_sk AS ret_date_sk, d1.d_date_sk AS sold_date_sk FROM date_dim AS d2 JOIN date_dim AS d1 ON d1.d_date BETWEEN (d2.d_date - INTERVAL '120 DAY') AND d2.d_date WHERE d2.d_year = 1999 AND d2.d_moy = 7) SELECT s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip, SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 30) AND (sr_returned_date_sk - ss_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 60) AND (sr_returned_date_sk - ss_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 90) AND (sr_returned_date_sk - ss_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM store_sales JOIN store_returns ON ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk AND ss_customer_sk = sr_customer_sk JOIN filtered_dates AS fd ON ss_sold_date_sk = fd.sold_date_sk AND sr_returned_date_sk = fd.ret_date_sk JOIN store ON ss_store_sk = s_store_sk WHERE TRUE GROUP BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip ORDER BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "t3",
      "family": "F",
      "transform": "join_transform",
      "relevance_score": 0.75,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Equivalence execution error: column reference \"d_date_sk\" is ambiguous\nLINE 1: ...9 AND d_moy = 7), filtered_date_dim_d1 AS (SELECT d_date_sk,...\n                                                             ^\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date_dim_d2 AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 1999 AND d_moy = 7), filtered_date_dim_d1 AS (SELECT d_date_sk, d_date FROM date_dim AS d2 JOIN (SELECT d_date_sk, d_date FROM date_dim) AS d1 ON d1.d_date BETWEEN (d2.d_date - INTERVAL '120 DAY') AND d2.d_date WHERE d2.d_year = 1999 AND d2.d_moy = 7) SELECT s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip, SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 30) AND (sr_returned_date_sk - ss_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 60) AND (sr_returned_date_sk - ss_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 90) AND (sr_returned_date_sk - ss_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM filtered_date_dim_d2 AS d2 JOIN store_returns ON sr_returned_date_sk = d2.d_date_sk JOIN store_sales ON ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk AND ss_customer_sk = sr_customer_sk JOIN filtered_date_dim_d1 AS d1 ON ss_sold_date_sk = d1.d_date_sk JOIN store ON ss_store_sk = s_store_sk GROUP BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip ORDER BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip LIMIT 100;",
      "has_explain": false
    },
    {
      "patch_id": "syn_w2",
      "family": "B",
      "transform": "decorrelate",
      "relevance_score": 0.3,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Equivalence execution error: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH pre_agg AS (SELECT ss_store_sk, SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 30 AND sr_returned_date_sk - ss_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 60 AND sr_returned_date_sk - ss_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 90 AND sr_returned_date_sk - ss_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM store_sales JOIN store_returns ON ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk AND ss_customer_sk = sr_customer_sk JOIN date_dim AS d1 ON ss_sold_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON sr_returned_date_sk = d2.d_date_sk WHERE d2.d_year = 1999 AND d2.d_moy = 7 AND d1.d_date BETWEEN (d2.d_date - INTERVAL '120 DAY') AND d2.d_date GROUP BY ss_store_sk) SELECT s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip, \"30 days\", \"31-60 days\", \"61-90 days\", \"91-120 days\", \">120 days\" FROM pre_agg JOIN store ON ss_store_sk = s_store_sk ORDER BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip LIMIT 100;",
      "has_explain": false
    }
  ],
  "explains": {
    "t2": "Limit  (rows=30, time=566.373)\n  Aggregate  (rows=30, time=566.366)\n    Nested Loop  (rows=39154, time=556.024)\n      Gather Merge  (rows=81513, time=498.078)\n        Sort  (rows=40756, time=368.68)\n          Nested Loop  (rows=40756, time=308.23)\n            Nested Loop  (rows=41734, time=277.119)\n              Nested Loop  (rows=56294, time=12.576)\n                Seq Scan on date_dim (d2)  (rows=16, time=3.257)\n                Index Only Scan on store_returns  (rows=3632, time=0.345)\n        "
  }
}