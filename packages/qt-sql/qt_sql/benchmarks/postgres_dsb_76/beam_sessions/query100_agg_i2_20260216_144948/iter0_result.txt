{
  "iteration": 0,
  "n_api_calls": 6,
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "t1",
      "family": "E",
      "transform": "multi_dimension_prefetch",
      "relevance_score": 0.98,
      "status": "REGRESSION",
      "speedup": 0.5,
      "semantic_passed": true,
      "error": null,
      "original_ms": 2938.7,
      "patch_ms": 5868.4,
      "output_sql": "WITH prefetched_sales AS (SELECT ss_ticket_number, ss_item_sk, ss_customer_sk, ss_sold_date_sk, ss_list_price FROM store_sales WHERE ss_list_price BETWEEN 115 AND 129) SELECT item1.i_item_sk, item2.i_item_sk, COUNT(*) AS cnt FROM prefetched_sales AS s1 INNER JOIN prefetched_sales AS s2 ON s1.ss_ticket_number = s2.ss_ticket_number INNER JOIN item AS item1 ON s1.ss_item_sk = item1.i_item_sk INNER JOIN item AS item2 ON s2.ss_item_sk = item2.i_item_sk INNER JOIN date_dim ON d_date_sk = s1.ss_sold_date_sk INNER JOIN customer ON s1.ss_customer_sk = c_customer_sk INNER JOIN customer_address ON c_current_addr_sk = ca_address_sk INNER JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk WHERE item1.i_item_sk < item2.i_item_sk AND d_year BETWEEN 1999 AND 2000 AND item1.i_category IN ('Electronics', 'Men') AND item2.i_manager_id BETWEEN 44 AND 63 AND cd_marital_status = 'D' AND cd_education_status = 'College' GROUP BY item1.i_item_sk, item2.i_item_sk ORDER BY cnt;",
      "has_explain": true
    },
    {
      "patch_id": "t3",
      "family": "A",
      "transform": "item_filter_pushdown",
      "relevance_score": 0.9,
      "status": "REGRESSION",
      "speedup": 0.49,
      "semantic_passed": true,
      "error": null,
      "original_ms": 2938.7,
      "patch_ms": 6012.9,
      "output_sql": "WITH filtered_item1 AS (SELECT * FROM item WHERE i_category IN ('Electronics', 'Men')), filtered_item2 AS (SELECT * FROM item WHERE i_manager_id BETWEEN 44 AND 63), prefetched_sales AS (SELECT ss_item_sk, ss_ticket_number, ss_customer_sk, ss_sold_date_sk, ss_list_price FROM store_sales WHERE ss_list_price BETWEEN 115 AND 129) SELECT item1.i_item_sk, item2.i_item_sk, COUNT(*) AS cnt FROM prefetched_sales AS s1 INNER JOIN filtered_item1 AS item1 ON s1.ss_item_sk = item1.i_item_sk INNER JOIN prefetched_sales AS s2 ON s1.ss_ticket_number = s2.ss_ticket_number INNER JOIN filtered_item2 AS item2 ON s2.ss_item_sk = item2.i_item_sk INNER JOIN date_dim ON s1.ss_sold_date_sk = d_date_sk INNER JOIN customer ON s1.ss_customer_sk = c_customer_sk INNER JOIN customer_address ON c_current_addr_sk = ca_address_sk INNER JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk WHERE item1.i_item_sk < item2.i_item_sk AND d_year BETWEEN 1999 AND 2000 AND cd_marital_status = 'D' AND cd_education_status = 'College' GROUP BY item1.i_item_sk, item2.i_item_sk ORDER BY cnt;",
      "has_explain": true
    },
    {
      "patch_id": "t4",
      "family": "C",
      "transform": "ticket_item_aggregate",
      "relevance_score": 0.85,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1 structural: COLUMN REF MISMATCH: Original columns missing from rewrite \u2014 ['c_current_addr_sk', 'ca_address_sk', 'cd_education_status', 'cd_marital_status']. The rewrite references different table columns.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH ticket_items AS (SELECT ss_ticket_number, ss_item_sk, ss_customer_sk FROM store_sales AS s JOIN date_dim AS d ON d.d_date_sk = s.ss_sold_date_sk WHERE d.d_year BETWEEN 1999 AND 2000 AND s.ss_list_price BETWEEN 115 AND 129 GROUP BY ss_ticket_number, ss_item_sk, ss_customer_sk), filtered_tickets AS (SELECT t.ss_ticket_number, t.ss_item_sk FROM ticket_items AS t JOIN customer AS c ON t.ss_customer_sk = c.c_customer_sk JOIN customer_demographics AS cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE cd.marital_status = 'D' AND cd.education_status = 'College') SELECT item1.i_item_sk, item2.i_item_sk, COUNT(*) AS cnt FROM filtered_tickets AS t1 JOIN filtered_tickets AS t2 ON t1.ss_ticket_number = t2.ss_ticket_number JOIN item AS item1 ON t1.ss_item_sk = item1.i_item_sk JOIN item AS item2 ON t2.ss_item_sk = item2.i_item_sk WHERE item1.i_item_sk < item2.i_item_sk AND item1.i_category IN ('Electronics', 'Men') AND item2.i_manager_id BETWEEN 44 AND 63 GROUP BY item1.i_item_sk, item2.i_item_sk ORDER BY cnt;",
      "has_explain": false
    },
    {
      "patch_id": "t2",
      "family": "F",
      "transform": "explicit_join_restructure",
      "relevance_score": 0.95,
      "status": "REGRESSION",
      "speedup": 0.62,
      "semantic_passed": true,
      "error": null,
      "original_ms": 2938.7,
      "patch_ms": 4773.1,
      "output_sql": "WITH prefetched_sales AS (SELECT ss_ticket_number, ss_item_sk, ss_customer_sk, ss_sold_date_sk FROM store_sales WHERE ss_list_price BETWEEN 115 AND 129) SELECT item1.i_item_sk, item2.i_item_sk, COUNT(*) AS cnt FROM prefetched_sales AS s1 INNER JOIN item AS item1 ON s1.ss_item_sk = item1.i_item_sk INNER JOIN prefetched_sales AS s2 ON s1.ss_ticket_number = s2.ss_ticket_number AND s1.ss_item_sk < s2.ss_item_sk INNER JOIN item AS item2 ON s2.ss_item_sk = item2.i_item_sk INNER JOIN date_dim ON s1.ss_sold_date_sk = d_date_sk INNER JOIN customer ON s1.ss_customer_sk = c_customer_sk INNER JOIN customer_address ON c_current_addr_sk = ca_address_sk INNER JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk WHERE d_year BETWEEN 1999 AND 1999 + 1 AND item1.i_category IN ('Electronics', 'Men') AND item2.i_manager_id BETWEEN 44 AND 63 AND cd_marital_status = 'D' AND cd_education_status = 'College' GROUP BY item1.i_item_sk, item2.i_item_sk ORDER BY cnt;",
      "has_explain": true
    }
  ],
  "explains": {
    "t1": "Sort  (rows=368, time=6556.326)\n  Gather  (rows=1975996, time=1338.647)\n    Seq Scan on store_sales  (rows=987998, time=2303.653)\n  Aggregate  (rows=368, time=6556.097)\n    Hash Join  (rows=838, time=6555.056)\n      Hash Join  (rows=316921, time=302.954)\n        CTE Scan (s2)  (rows=1975996, time=102.376)\n        Hash  (rows=20310, time=39.871)\n          Seq Scan on item (item2)  (rows=20310, time=34.893)\n      Hash  (rows=10965, time=6215.487)\n        Nested Loop  (rows=10965, time=6207.316)\n  ",
    "t3": "Sort  (rows=368, time=6310.489)\n  Gather  (rows=1975996, time=1319.223)\n    Seq Scan on store_sales  (rows=987998, time=2257.822)\n  Aggregate  (rows=368, time=6310.236)\n    Hash Join  (rows=838, time=6309.168)\n      Hash Join  (rows=316921, time=306.159)\n        CTE Scan (s2)  (rows=1975996, time=97.885)\n        Hash  (rows=20310, time=47.037)\n          Seq Scan on item (item_1)  (rows=20310, time=42.207)\n      Hash  (rows=10965, time=5963.809)\n        Nested Loop  (rows=10965, time=5956.789)\n  ",
    "t2": "Sort  (rows=368, time=5614.26)\n  Gather  (rows=1975996, time=833.255)\n    Seq Scan on store_sales  (rows=658665, time=1490.49)\n  Aggregate  (rows=368, time=5614.085)\n    Hash Join  (rows=838, time=5613.252)\n      Hash Join  (rows=316921, time=274.495)\n        CTE Scan (s2)  (rows=1975996, time=93.211)\n        Hash  (rows=20310, time=30.483)\n          Seq Scan on item (item2)  (rows=20310, time=27.438)\n      Hash  (rows=10965, time=5305.945)\n        Nested Loop  (rows=10965, time=5298.887)\n      "
  }
}