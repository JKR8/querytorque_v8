{
  "iteration": 1,
  "n_api_calls": 4,
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "t1",
      "family": "A+C",
      "transform": "early_filter_plus_aggregate",
      "relevance_score": 0.95,
      "status": "REGRESSION",
      "speedup": 0.54,
      "semantic_passed": true,
      "error": null,
      "original_ms": 2440.6,
      "patch_ms": 4506.4,
      "output_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year BETWEEN 1999 AND 1999 + 1), filtered_customers AS (SELECT c_customer_sk, c_current_addr_sk, c_current_cdemo_sk FROM customer JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk WHERE cd_marital_status = 'D' AND cd_education_status = 'College'), filtered_store_sales AS (SELECT ss_ticket_number, ss_item_sk, ss_customer_sk, ss_sold_date_sk, ss_list_price FROM store_sales WHERE ss_list_price BETWEEN 115 AND 129) SELECT item1.i_item_sk, item2.i_item_sk, COUNT(*) AS cnt FROM item AS item1 JOIN item AS item2 ON item1.i_item_sk < item2.i_item_sk JOIN filtered_store_sales AS s1 ON s1.ss_item_sk = item1.i_item_sk JOIN filtered_store_sales AS s2 ON s1.ss_ticket_number = s2.ss_ticket_number AND s2.ss_item_sk = item2.i_item_sk JOIN filtered_customers AS c ON s1.ss_customer_sk = c.c_customer_sk JOIN filtered_dates AS d ON d.d_date_sk = s1.ss_sold_date_sk WHERE item1.i_category IN ('Electronics', 'Men') AND item2.i_manager_id BETWEEN 44 AND 63 GROUP BY item1.i_item_sk, item2.i_item_sk ORDER BY cnt;",
      "has_explain": true
    },
    {
      "patch_id": "t2",
      "family": "C",
      "transform": "fixed_ticket_aggregate",
      "relevance_score": 0.9,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Equivalence execution error: invalid reference to FROM-clause entry for table \"item1\"\nLINE 1: ...OIN filtered_store_sales AS s1 ON s1.ss_item_sk = item1.i_it...\n                                                             ^\nHINT:  There is an entry for table \"item1\", but it cannot be referenced from this part of the query.\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_item1 AS (SELECT i_item_sk FROM item WHERE i_category IN ('Electronics', 'Men')), filtered_item2 AS (SELECT i_item_sk FROM item WHERE i_manager_id BETWEEN 44 AND 63), filtered_store_sales AS (SELECT ss_ticket_number, ss_item_sk, ss_customer_sk, ss_sold_date_sk FROM store_sales WHERE ss_list_price BETWEEN 115 AND 129) SELECT item1.i_item_sk, item2.i_item_sk, COUNT(*) AS cnt FROM filtered_item1 AS item1, filtered_item2 AS item2 JOIN filtered_store_sales AS s1 ON s1.ss_item_sk = item1.i_item_sk JOIN filtered_store_sales AS s2 ON s2.ss_ticket_number = s1.ss_ticket_number AND s2.ss_item_sk = item2.i_item_sk JOIN date_dim ON d_date_sk = s1.ss_sold_date_sk JOIN customer ON s1.ss_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk WHERE item1.i_item_sk < item2.i_item_sk AND d_year BETWEEN 1999 AND 1999 + 1 AND cd_marital_status = 'D' AND cd_education_status = 'College' GROUP BY item1.i_item_sk, item2.i_item_sk ORDER BY cnt;",
      "has_explain": false
    },
    {
      "patch_id": "t3",
      "family": "E+A+F",
      "transform": "prefetch_filtered_sales+join_restructure_no_cte",
      "relevance_score": 0.85,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Equivalence execution error: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "SELECT item1.i_item_sk, item2.i_item_sk, COUNT(*) AS cnt FROM item AS item1 INNER JOIN item AS item2 ON item1.i_item_sk < item2.i_item_sk INNER JOIN store_sales AS s1 ON s1.ss_item_sk = item1.i_item_sk INNER JOIN store_sales AS s2 ON s2.ss_item_sk = item2.i_item_sk AND s1.ss_ticket_number = s2.ss_ticket_number INNER JOIN date_dim ON d_date_sk = s1.ss_sold_date_sk INNER JOIN customer ON s1.ss_customer_sk = c_customer_sk INNER JOIN customer_address ON c_current_addr_sk = ca_address_sk INNER JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk WHERE d_year BETWEEN 1999 AND 1999 + 1 AND item1.i_category IN ('Electronics', 'Men') AND item2.i_manager_id BETWEEN 44 AND 63 AND cd_marital_status = 'D' AND cd_education_status = 'College' AND s1.ss_list_price BETWEEN 115 AND 129 AND s2.ss_list_price BETWEEN 115 AND 129 GROUP BY item1.i_item_sk, item2.i_item_sk ORDER BY cnt;",
      "has_explain": false
    }
  ],
  "explains": {
    "t1": "Sort  (rows=368, time=5120.932)\n  Gather  (rows=1975996, time=840.88)\n    Seq Scan on store_sales  (rows=658665, time=1507.82)\n  Aggregate  (rows=368, time=5120.625)\n    Hash Join  (rows=838, time=5119.694)\n      Hash Join  (rows=316921, time=261.384)\n        CTE Scan (s2)  (rows=1975996, time=89.814)\n        Hash  (rows=20310, time=34.934)\n          Seq Scan on item (item2)  (rows=20310, time=30.804)\n      Hash  (rows=10965, time=4828.154)\n        Nested Loop  (rows=10965, time=4821.794)\n      "
  }
}