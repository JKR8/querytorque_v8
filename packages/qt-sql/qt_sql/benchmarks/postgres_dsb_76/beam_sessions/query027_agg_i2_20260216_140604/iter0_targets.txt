[
  {
    "target_id": "t1",
    "family": "C",
    "transform": "aggregation_pushdown",
    "relevance_score": 0.95,
    "hypothesis": "GROUP BY happens too late after large joins. Pre-aggregating store_sales by foreign keys (ss_item_sk, ss_store_sk) after filtering with selective dimensions reduces intermediate rows by 10-100x.",
    "target_ir": "S0 [SELECT]\n  CTE: filtered_date  (via Q1)\n    FROM: date_dim\n    WHERE: d_year = 1999\n  CTE: filtered_cd  (via Q2)\n    FROM: customer_demographics\n    WHERE: cd_gender = 'M' AND cd_marital_status = 'W' AND cd_education_status = 'Secondary'\n  CTE: pre_agg  (via Q3)\n    FROM: store_sales\n    JOIN: filtered_date ON ss_sold_date_sk = d_date_sk\n    JOIN: filtered_cd ON ss_cdemo_sk = cd_demo_sk\n    GROUP BY: ss_item_sk, ss_store_sk\n  CTE: filtered_store  (via Q4)\n    FROM: store\n    WHERE: s_state = 'OH'\n  CTE: filtered_item  (via Q5)\n    FROM: item\n    WHERE: i_category = 'Music'\n  MAIN QUERY (via Q0)\n    FROM: pre_agg\n    JOIN: filtered_store ON ss_store_sk = s_store_sk\n    JOIN: filtered_item ON ss_item_sk = i_item_sk\n    GROUP BY: ROLLUP (i_item_id, s_state)\n    ORDER BY: i_item_id, s_state\n    LIMIT: 100",
    "recommended_examples": [
      "pg_materialized_dimension_fact_prefilter"
    ]
  },
  {
    "target_id": "t2",
    "family": "F",
    "transform": "explicit_join_restructure",
    "relevance_score": 0.85,
    "hypothesis": "Implicit comma joins prevent optimal join order. Explicit JOINs enable predicate pushdown to store_sales early and reorder joins to prioritize selective dimensions.",
    "target_ir": "S0 [SELECT]\n  MAIN QUERY (via Q0)\n    FROM: store_sales\n    INNER JOIN: date_dim ON ss_sold_date_sk = d_date_sk\n    INNER JOIN: customer_demographics ON ss_cdemo_sk = cd_demo_sk\n    INNER JOIN: store ON ss_store_sk = s_store_sk\n    INNER JOIN: item ON ss_item_sk = i_item_sk\n    WHERE: d_year = 1999\n      AND cd_gender = 'M'\n      AND cd_marital_status = 'W'\n      AND cd_education_status = 'Secondary'\n      AND s_state = 'OH'\n      AND i_category = 'Music'\n    GROUP BY: ROLLUP (i_item_id, s_state)\n    ORDER BY: i_item_id, s_state\n    LIMIT: 100",
    "recommended_examples": [
      "pg_explicit_join_materialized"
    ]
  },
  {
    "target_id": "t3",
    "family": "A",
    "transform": "dimension_filter_ctes",
    "relevance_score": 0.8,
    "hypothesis": "Filters on dimension tables (store, item) are applied late. Materializing them as CTEs allows early reduction of store_sales rows via foreign key joins.",
    "target_ir": "S0 [SELECT]\n  CTE: filtered_store  (via Q1)\n    FROM: store\n    WHERE: s_state = 'OH'\n  CTE: filtered_item  (via Q2)\n    FROM: item\n    WHERE: i_category = 'Music'\n  MAIN QUERY (via Q0)\n    FROM: store_sales\n    JOIN: filtered_store ON ss_store_sk = s_store_sk\n    JOIN: filtered_item ON ss_item_sk = i_item_sk\n    JOIN: date_dim ON ss_sold_date_sk = d_date_sk\n    JOIN: customer_demographics ON ss_cdemo_sk = cd_demo_sk\n    WHERE: d_year = 1999\n      AND cd_gender = 'M'\n      AND cd_marital_status = 'W'\n      AND cd_education_status = 'Secondary'\n    GROUP BY: ROLLUP (i_item_id, s_state)\n    ORDER BY: i_item_id, s_state\n    LIMIT: 100",
    "recommended_examples": [
      "pg_date_cte_explicit_join"
    ]
  }
]