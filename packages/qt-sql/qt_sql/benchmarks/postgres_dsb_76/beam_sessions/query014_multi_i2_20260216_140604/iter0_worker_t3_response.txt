{
  "plan_id": "postgres_push_item_filters_into_intersect",
  "dialect": "postgres",
  "description": "Push item filters (i_category, i_manager_id) into each branch of the INTERSECT in cross_items CTE to reduce row counts early.",
  "preconditions": [
    {
      "kind": "parse_ok"
    }
  ],
  "postconditions": [
    {
      "kind": "parse_ok"
    }
  ],
  "steps": [
    {
      "step_id": "s1",
      "op": "replace_body",
      "target": {
        "by_node_id": "CTE_Q_S0_cross_items"
      },
      "payload": {
        "sql_fragment": "with cross_items as (select i_item_sk ss_item_sk from item, (select iss.i_brand_id brand_id, iss.i_class_id class_id, iss.i_category_id category_id from store_sales, item iss, date_dim d1 where ss_item_sk = iss.i_item_sk and ss_sold_date_sk = d1.d_date_sk and d1.d_year between 1999 and 1999 + 2 and iss.i_category IN ('Electronics', 'Shoes', 'Sports') and iss.i_manager_id BETWEEN 42 and 51 and ss_wholesale_cost BETWEEN 76 AND 96 intersect select ics.i_brand_id, ics.i_class_id, ics.i_category_id from catalog_sales, item ics, date_dim d2 where cs_item_sk = ics.i_item_sk and cs_sold_date_sk = d2.d_date_sk and d2.d_year between 1999 and 1999 + 2 and ics.i_category IN ('Electronics', 'Shoes', 'Sports') and ics.i_manager_id BETWEEN 42 and 51 and cs_wholesale_cost BETWEEN 76 AND 96 intersect select iws.i_brand_id, iws.i_class_id, iws.i_category_id from web_sales, item iws, date_dim d3 where ws_item_sk = iws.i_item_sk and ws_sold_date_sk = d3.d_date_sk and ws_wholesale_cost BETWEEN 76 AND 96 and d3.d_year between 1999 and 1999 + 2 and iws.i_category IN ('Electronics', 'Shoes', 'Sports') and iws.i_manager_id BETWEEN 42 and 51) x where i_brand_id = brand_id and i_class_id = class_id and i_category_id = category_id and i_category IN ('Electronics', 'Shoes', 'Sports') and i_manager_id BETWEEN 42 and 51)"
      },
      "description": "Rewrite cross_items CTE with item filters pushed into each INTERSECT branch"
    }
  ]
}