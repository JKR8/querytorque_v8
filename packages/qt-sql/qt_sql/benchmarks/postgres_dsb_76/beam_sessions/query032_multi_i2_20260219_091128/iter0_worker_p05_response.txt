{
  "probe_id": "p12",
  "transform_id": "dimension_prefetch_star",
  "family": "F",
  "status": "success",
  "dialect": "postgresql",
  "hypothesis": "Pre-filtering item and date_dim into CTEs reduces main query scan size and enables better join order via explicit JOIN syntax.",
  "reasoning_trace": [
    "Assigned transform targets dimension prefetch to reduce fact-table fanout.",
    "Item and date_dim are filtered early with selective predicates.",
    "Explicit JOIN syntax improves PostgreSQL's cardinality estimation."
  ],
  "target_ir": "item_prefetch and date_prefetch become CTEs; catalog_sales joins explicitly with them.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["catalog_sales", "item_prefetch", "date_prefetch"],
        "outputs": ["excess discount amount"],
        "changed": true,
        "sql": "WITH item_prefetch AS (SELECT i_item_sk FROM item WHERE i_manufact_id IN (184,307,365,560,681) OR i_manager_id BETWEEN 42 AND 71), date_prefetch AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2001-02-23' AND cast('2001-02-23' as date) + interval '90 day') SELECT sum(cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales JOIN item_prefetch ON catalog_sales.cs_item_sk = item_prefetch.i_item_sk JOIN date_prefetch ON catalog_sales.cs_sold_date_sk = date_prefetch.d_date_sk WHERE cs_ext_discount_amt > (SELECT 1.3 * avg(cs_ext_discount_amt) FROM catalog_sales cs2 JOIN date_prefetch dp2 ON cs2.cs_sold_date_sk = dp2.d_date_sk WHERE cs2.cs_item_sk = item_prefetch.i_item_sk AND cs2.cs_list_price BETWEEN 115 AND 144 AND cs2.cs_sales_price / cs2.cs_list_price BETWEEN 21 * 0.01 AND 41 * 0.01) ORDER BY sum(cs_ext_discount_amt) LIMIT 100"
      },
      {
        "node_id": "item_prefetch",
        "parent_node_id": "final_select",
        "sources": ["item"],
        "outputs": ["i_item_sk"],
        "changed": false
      },
      {
        "node_id": "date_prefetch",
        "parent_node_id": "final_select",
        "sources": ["date_dim"],
        "outputs": ["d_date_sk"],
        "changed": false
      }
    ]
  }
}