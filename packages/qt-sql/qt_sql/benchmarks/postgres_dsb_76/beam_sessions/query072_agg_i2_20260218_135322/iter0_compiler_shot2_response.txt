[
  {
    "plan_id": "compile_p1",
    "dialect": "postgres",
    "confidence": 0.45,
    "based_on": "p01,p04",
    "strategy": "Pre-filter selective dimensions with catalog_sales using explicit joins, avoiding CTE fences that block pushdown.",
    "hypothesis": "Two syntax-error probes attempted early filtering but failed on execution. Corrected syntax and removed forced MATERIALIZED CTEs to allow predicate pushdown and join reordering while preserving semantics.",
    "expected_explain_delta": "Early hash joins with household_demographics, customer_demographics, item, and date_dim d1 reduce rows before expensive nested loops with inventory and date_dim d2/d3.",
    "target_ir": "Add prefiltered_catalog_sales node with explicit joins to selective dimensions; keep final_select structure unchanged.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["prefiltered_catalog_sales", "inventory", "warehouse", "date_dim d2", "date_dim d3", "promotion", "catalog_returns"],
          "outputs": ["i_item_desc", "w_warehouse_name", "d_week_seq", "no_promo", "promo", "total_cnt"],
          "changed": false
        },
        {
          "node_id": "prefiltered_catalog_sales",
          "parent_node_id": "final_select",
          "sources": ["catalog_sales", "household_demographics", "customer_demographics", "item", "date_dim d1"],
          "outputs": ["cs_item_sk", "cs_order_number", "cs_bill_cdemo_sk", "cs_bill_hdemo_sk", "cs_sold_date_sk", "cs_ship_date_sk", "cs_promo_sk", "cs_quantity", "cs_wholesale_cost", "i_item_desc", "d_week_seq", "d_date"],
          "changed": true,
          "sql": "SELECT cs.cs_item_sk, cs.cs_order_number, cs.cs_bill_cdemo_sk, cs.cs_bill_hdemo_sk, cs.cs_sold_date_sk, cs.cs_ship_date_sk, cs.cs_promo_sk, cs.cs_quantity, cs.cs_wholesale_cost, i.i_item_desc, d1.d_week_seq, d1.d_date FROM catalog_sales cs JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN date_dim d1 ON cs.cs_sold_date_sk = d1.d_date_sk WHERE hd.hd_buy_potential = '>10000' AND cd.cd_marital_status = 'S' AND cd.cd_dep_count BETWEEN 9 AND 11 AND i.i_category IN ('Men', 'Shoes', 'Sports') AND d1.d_year = 1999 AND cs.cs_wholesale_cost BETWEEN 76 AND 96"
        }
      ]
    }
  }
]