{
  "plan_id": "postgres_explicit_join_restructure_customer_return",
  "dialect": "postgres",
  "description": "Convert implicit comma joins in CTE to explicit INNER JOINs to enable better predicate pushdown and join order optimization, especially for the date_dim filter.",
  "preconditions": [
    {
      "kind": "parse_ok"
    }
  ],
  "postconditions": [
    {
      "kind": "parse_ok"
    }
  ],
  "steps": [
    {
      "step_id": "s1",
      "op": "replace_body",
      "target": {
        "by_node_id": "S0",
        "by_label": "customer_total_return"
      },
      "payload": {
        "sql_fragment": "customer_total_return AS (SELECT cr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, SUM(cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns INNER JOIN date_dim ON cr_returned_date_sk = d_date_sk INNER JOIN customer_address ON cr_returning_addr_sk = ca_address_sk WHERE d_year = 2000 GROUP BY cr_returning_customer_sk, ca_state)"
      },
      "description": "Replace CTE body with explicit INNER JOINs and move d_year filter into WHERE clause"
    }
  ]
}