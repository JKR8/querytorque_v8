{
  "iteration": 0,
  "n_api_calls": 15,
  "beam_cost_usd": 0.09258339,
  "beam_cost_priced_calls": 15,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 79774,
    "completion_tokens": 30142,
    "total_tokens": 109916,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 19456
  },
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "p10",
      "family": "E",
      "transform": "pg_self_join_decomposition",
      "relevance_score": 0.8,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_store_sales AS (SELECT ss_ticket_number, ss_item_sk, ss_customer_sk FROM store_sales WHERE ss_sales_price / ss_list_price BETWEEN 0.76 AND 0.96) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM filtered_store_sales AS ss, store_returns AS sr, web_sales AS ws, date_dim AS d1, date_dim AS d2, item AS i, customer AS c, customer_address AS ca, household_demographics AS hd WHERE ss_ticket_number = sr_ticket_number AND ss_customer_sk = ws_bill_customer_sk AND ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND c_current_hdemo_sk = hd_demo_sk AND ss_item_sk = sr_item_sk AND sr_item_sk = ws_item_sk AND i_item_sk = ss_item_sk AND i_category IN ('Children', 'Home', 'Women') AND sr_returned_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA') AND d1.d_year = 2000 AND hd_income_band_sk BETWEEN 8 AND 14 AND hd_buy_potential = '501-1000' AND ss_sales_price / ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Materialize store_sales with ss_sales_price/ss_list_price filter into CTE before joining with store_returns."
    },
    {
      "patch_id": "p12",
      "family": "A",
      "transform": "multi_dimension_prefetch",
      "relevance_score": 0.7,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_dimensions AS (SELECT d1.d_date_sk, i_item_sk, hd_demo_sk FROM date_dim AS d1, item, household_demographics WHERE d1.d_year = 2000 AND i_category IN ('Children', 'Home', 'Women') AND hd_income_band_sk BETWEEN 8 AND 14 AND hd_buy_potential = '501-1000') SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales JOIN store_returns ON ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk JOIN web_sales ON ss_customer_sk = ws_bill_customer_sk JOIN customer ON ss_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN filtered_dimensions AS fd ON sr_returned_date_sk = fd.d_date_sk AND ss_item_sk = fd.i_item_sk AND c_current_hdemo_sk = fd.hd_demo_sk JOIN date_dim AS d2 ON ws_sold_date_sk = d2.d_date_sk WHERE ss_ticket_number = sr_ticket_number AND ss_customer_sk = ws_bill_customer_sk AND ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND c_current_hdemo_sk = hd_demo_sk AND ss_item_sk = sr_item_sk AND sr_item_sk = ws_item_sk AND i_item_sk = ss_item_sk AND i_category IN ('Children', 'Home', 'Women') AND sr_returned_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA') AND d1.d_year = 2000 AND hd_income_band_sk BETWEEN 8 AND 14 AND hd_buy_potential = '501-1000' AND ss_sales_price / ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Combine d1, item, hd filters into single CTE, then join with store_returns in one step."
    },
    {
      "patch_id": "p05",
      "family": "A",
      "transform": "dimension_cte_isolate",
      "relevance_score": 0.7,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_households AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_income_band_sk BETWEEN 8 AND 14 AND hd_buy_potential = '501-1000') SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales, store_returns, web_sales, date_dim AS d1, date_dim AS d2, item, customer, customer_address, filtered_households WHERE ss_ticket_number = sr_ticket_number AND ss_customer_sk = ws_bill_customer_sk AND ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND c_current_hdemo_sk = filtered_households.hd_demo_sk AND ss_item_sk = sr_item_sk AND sr_item_sk = ws_item_sk AND i_item_sk = ss_item_sk AND i_category IN ('Children', 'Home', 'Women') AND sr_returned_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA') AND d1.d_year = 2000 AND ss_sales_price / ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Create CTE for household_demographics (hd_income_band_sk BETWEEN 8 AND 14) and join early with customer."
    },
    {
      "patch_id": "p07",
      "family": "A",
      "transform": "multi_date_range_cte",
      "relevance_score": 0.75,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_d2 AS (SELECT d2.d_date_sk, d2.d_date FROM date_dim AS d2 JOIN date_dim AS d1 ON d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') WHERE d1.d_year = 2000) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales, store_returns, web_sales, date_dim AS d1, filtered_d2 AS d2, item, customer, customer_address, household_demographics WHERE ss_ticket_number = sr_ticket_number AND ss_customer_sk = ws_bill_customer_sk AND ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND c_current_hdemo_sk = hd_demo_sk AND ss_item_sk = sr_item_sk AND sr_item_sk = ws_item_sk AND i_item_sk = ss_item_sk AND i_category IN ('Children', 'Home', 'Women') AND sr_returned_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA') AND hd_income_band_sk BETWEEN 8 AND 14 AND hd_buy_potential = '501-1000' AND ss_sales_price / ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Materialize d2 range as CTE using d1 min/max: WHERE d_date BETWEEN (SELECT MIN(d_date) FROM d1) AND (SELECT MAX(d_date) + 90 FROM d1)"
    },
    {
      "patch_id": "p03",
      "family": "F",
      "transform": "materialized_dimension_fact_prefilter",
      "relevance_score": 0.85,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date_dim AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2000), filtered_item AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Home', 'Women')) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales AS ss JOIN store_returns AS sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN web_sales AS ws ON ss.ss_customer_sk = ws.ws_bill_customer_sk AND sr.sr_item_sk = ws.ws_item_sk JOIN filtered_date_dim AS d1 ON sr.sr_returned_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk JOIN filtered_item AS i ON i.i_item_sk = ss.ss_item_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE ss_ticket_number = sr_ticket_number AND ss_customer_sk = ws_bill_customer_sk AND ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND c_current_hdemo_sk = hd_demo_sk AND ss_item_sk = sr_item_sk AND sr_item_sk = ws_item_sk AND i_item_sk = ss_item_sk AND i_category IN ('Children', 'Home', 'Women') AND sr_returned_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA') AND d1.d_year = 2000 AND hd_income_band_sk BETWEEN 8 AND 14 AND hd_buy_potential = '501-1000' AND ss_sales_price / ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Create CTEs for filtered dimensions (d1, item, hd) and pre-join with store_returns before joining with store_sales."
    },
    {
      "patch_id": "p04",
      "family": "B",
      "transform": "early_filter_decorrelate",
      "relevance_score": 0.9,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_store_returns AS (SELECT sr_item_sk, sr_ticket_number FROM store_returns AS sr JOIN date_dim AS d1 ON sr.sr_returned_date_sk = d1.d_date_sk WHERE d1.d_year = 2000) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales, filtered_store_returns, web_sales, date_dim AS d2, item, customer, customer_address, household_demographics WHERE ss_ticket_number = sr_ticket_number AND ss_customer_sk = ws_bill_customer_sk AND ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND c_current_hdemo_sk = hd_demo_sk AND ss_item_sk = sr_item_sk AND sr_item_sk = ws_item_sk AND i_item_sk = ss_item_sk AND i_category IN ('Children', 'Home', 'Women') AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN (SELECT MIN(d1.d_date) FROM date_dim AS d1 WHERE d1.d_year = 2000) AND ((SELECT MIN(d1.d_date) FROM date_dim AS d1 WHERE d1.d_year = 2000) + INTERVAL '90 DAY') AND ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA') AND hd_income_band_sk BETWEEN 8 AND 14 AND hd_buy_potential = '501-1000' AND ss_sales_price / ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Push d1 filter into CTE definition. Pre-join store_returns with d1_cte before main query."
    },
    {
      "patch_id": "p02",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.88,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH d1_cte AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2000), d2_cte AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN (SELECT MIN(d_date) FROM date_dim WHERE d_year = 2000) AND (SELECT MIN(d_date) + INTERVAL '90 DAY' FROM date_dim WHERE d_year = 2000)) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales AS ss JOIN store_returns AS sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN web_sales AS ws ON ss.ss_customer_sk = ws.ws_bill_customer_sk AND sr.sr_item_sk = ws.ws_item_sk JOIN d1_cte AS d1 ON sr.sr_returned_date_sk = d1.d_date_sk JOIN d2_cte AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk JOIN item AS i ON i.i_item_sk = ss.ss_item_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE i.i_category IN ('Children', 'Home', 'Women') AND ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA') AND hd_income_band_sk BETWEEN 8 AND 14 AND hd_buy_potential = '501-1000' AND ss.ss_sales_price / ss.ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Materialize filtered d1 (d_year=2000) and d2 (d_date range) as CTEs. Use explicit JOINs between date CTEs and fact tables."
    },
    {
      "patch_id": "p01",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.92,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date_dim_d1 AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2000), filtered_item AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Home', 'Women')), filtered_customer_address AS (SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA')), filtered_household_demographics AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_income_band_sk BETWEEN 8 AND 14 AND hd_buy_potential = '501-1000') SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales AS ss JOIN store_returns AS sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN web_sales AS ws ON sr.sr_item_sk = ws.ws_item_sk AND ss.ss_customer_sk = ws.ws_bill_customer_sk JOIN filtered_date_dim_d1 AS d1 ON sr.sr_returned_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk JOIN filtered_item AS i ON i.i_item_sk = ss.ss_item_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk JOIN filtered_customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN filtered_household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ss_sales_price / ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Convert all comma joins to explicit INNER JOIN syntax. Pre-filter selective dimensions (d1, item, hd, ca) into CTEs before joining with fact tables."
    },
    {
      "patch_id": "p11",
      "family": "A",
      "transform": "sf_sk_pushdown_multi_fact",
      "relevance_score": 0.55,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_store_returns AS (SELECT * FROM store_returns WHERE sr_returned_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim WHERE d_year = 2000) AND (SELECT MAX(d_date_sk) FROM date_dim WHERE d_year = 2000)), filtered_web_sales AS (SELECT * FROM web_sales WHERE ws_sold_date_sk BETWEEN (SELECT MIN(d_date_sk) FROM date_dim WHERE d_year = 2000) AND (SELECT MAX(d_date_sk) FROM date_dim WHERE d_year = 2000)) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM filtered_store_returns, filtered_web_sales, date_dim AS d1, date_dim AS d2, item, customer, customer_address, household_demographics WHERE ss_ticket_number = sr_ticket_number AND ss_customer_sk = ws_bill_customer_sk AND ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND c_current_hdemo_sk = hd_demo_sk AND ss_item_sk = sr_item_sk AND sr_item_sk = ws_item_sk AND i_item_sk = ss_item_sk AND i_category IN ('Children', 'Home', 'Women') AND sr_returned_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA') AND d1.d_year = 2000 AND hd_income_band_sk BETWEEN 8 AND 14 AND hd_buy_potential = '501-1000' AND ss_sales_price / ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Add d_date_sk BETWEEN filter to store_returns and web_sales CTEs using d1/d2 surrogate keys."
    },
    {
      "patch_id": "p08",
      "family": "A",
      "transform": "shared_dimension_multi_channel",
      "relevance_score": 0.68,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_items AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Home', 'Women')) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales AS ss JOIN store_returns AS sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN web_sales AS ws ON ss.ss_customer_sk = ws.ws_bill_customer_sk AND sr.sr_item_sk = ws.ws_item_sk JOIN date_dim AS d1 ON sr.sr_returned_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN filtered_items AS fi ON fi.i_item_sk = ss.ss_item_sk WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA') AND d1.d_year = 2000 AND hd_income_band_sk BETWEEN 8 AND 14 AND hd_buy_potential = '501-1000' AND ss.ss_sales_price / ss.ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Create shared CTE for item (i_category filter) referenced by both store and web sales paths."
    },
    {
      "patch_id": "p09",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.6,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH agg_store_returns AS (SELECT sr_ticket_number, sr_item_sk, COUNT(*) AS return_cnt FROM store_returns GROUP BY sr_ticket_number, sr_item_sk) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales AS ss JOIN agg_store_returns AS sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN web_sales AS ws ON ss.ss_customer_sk = ws.ws_bill_customer_sk AND sr.sr_item_sk = ws.ws_item_sk JOIN date_dim AS d1 ON sr.sr_returned_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk JOIN item AS i ON i.i_item_sk = ss.ss_item_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE ss_ticket_number = sr_ticket_number AND ss_customer_sk = ws_bill_customer_sk AND ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND c_current_hdemo_sk = hd_demo_sk AND ss_item_sk = sr_item_sk AND sr_item_sk = ws_item_sk AND i_item_sk = ss_item_sk AND i_category IN ('Children', 'Home', 'Women') AND sr_returned_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA') AND d1.d_year = 2000 AND hd_income_band_sk BETWEEN 8 AND 14 AND hd_buy_potential = '501-1000' AND ss_sales_price / ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Pre-aggregate store_returns by sr_ticket_number, sr_item_sk before joining with store_sales."
    },
    {
      "patch_id": "p06",
      "family": "A",
      "transform": "prefetch_fact_join",
      "relevance_score": 0.65,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date_item AS (SELECT d1.d_date_sk, i_item_sk FROM date_dim AS d1, item WHERE d1.d_year = 2000 AND i_category IN ('Children', 'Home', 'Women')), prejoined_returns AS (SELECT sr_item_sk, sr_ticket_number, sr_returned_date_sk FROM store_returns JOIN filtered_date_item AS fdi ON sr_item_sk = fdi.i_item_sk AND sr_returned_date_sk = fdi.d_date_sk) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales AS ss JOIN prejoined_returns AS sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN web_sales AS ws ON ss.ss_customer_sk = ws.ws_bill_customer_sk AND sr.sr_item_sk = ws.ws_item_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN date_dim AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk WHERE ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA') AND hd_income_band_sk BETWEEN 8 AND 14 AND hd_buy_potential = '501-1000' AND ss_sales_price / ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01 AND d2.d_date BETWEEN (SELECT MIN(d_date) FROM filtered_date_item) AND (SELECT MIN(d_date) + INTERVAL '90 DAY' FROM filtered_date_item) GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Build CTE chain: 1) Filter d1, item, hd 2) Pre-join with store_returns 3) Join result with store_sales and customer."
    },
    {
      "patch_id": "snipe_p1",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH d1_cte AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2000), d2_cte AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN (SELECT MIN(d_date) FROM d1_cte) AND (SELECT MAX(d_date) + INTERVAL '90 DAY' FROM d1_cte)) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales AS ss JOIN store_returns AS sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN web_sales AS ws ON ss.ss_customer_sk = ws.ws_bill_customer_sk AND sr.sr_item_sk = ws.ws_item_sk JOIN d1_cte AS d1 ON sr.sr_returned_date_sk = d1.d_date_sk JOIN d2_cte AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk JOIN item AS i ON i.i_item_sk = ss.ss_item_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE i.i_category IN ('Children', 'Home', 'Women') AND ca.ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA') AND hd.hd_income_band_sk BETWEEN 8 AND 14 AND hd.hd_buy_potential = '501-1000' AND ss.ss_sales_price / ss.ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p2",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_dims AS (SELECT d1.d_date_sk, i.i_item_sk, hd.hd_demo_sk FROM date_dim AS d1, item AS i, household_demographics AS hd WHERE d1.d_year = 2000 AND i.i_category IN ('Children', 'Home', 'Women') AND hd.hd_income_band_sk BETWEEN 8 AND 14 AND hd.hd_buy_potential = '501-1000'), prejoined_returns AS (SELECT sr.sr_ticket_number, sr.sr_item_sk, sr.sr_returned_date_sk FROM store_returns AS sr JOIN filtered_dims AS fd ON sr.sr_returned_date_sk = fd.d_date_sk AND sr.sr_item_sk = fd.i_item_sk) SELECT c.c_customer_sk, c.c_first_name, c.c_last_name, COUNT(*) AS cnt FROM store_sales AS ss JOIN prejoined_returns AS pr ON ss.ss_ticket_number = pr.sr_ticket_number AND ss.ss_item_sk = pr.sr_item_sk JOIN web_sales AS ws ON ss.ss_customer_sk = ws.ws_bill_customer_sk AND pr.sr_item_sk = ws.ws_item_sk JOIN date_dim AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN filtered_dims AS fd ON c.c_current_hdemo_sk = fd.hd_demo_sk WHERE ca.ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA') AND d2.d_date BETWEEN (SELECT MIN(d_date) FROM filtered_dims) AND (SELECT MIN(d_date) + INTERVAL '90 DAY' FROM filtered_dims) AND ss.ss_sales_price / ss.ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01 GROUP BY c.c_customer_sk, c.c_first_name, c.c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p1",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: COLUMN REF MISMATCH: Original columns missing from rewrite \u2014 ['sr_item_sk', 'ws_item_sk']. The rewrite references different table columns.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH d1_cte AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2000), item_cte AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Home', 'Women')), ca_cte AS (SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA')), hd_cte AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_income_band_sk BETWEEN 8 AND 14 AND hd_buy_potential = '501-1000') SELECT c.c_customer_sk, c.c_first_name, c.c_last_name, COUNT(*) AS cnt FROM store_sales AS ss JOIN store_returns AS sr ON ss.ss_ticket_number = sr.sr_ticket_number JOIN web_sales AS ws ON ss.ss_customer_sk = ws.ws_bill_customer_sk JOIN d1_cte AS d1 ON sr.sr_returned_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk JOIN item_cte AS i ON ss.ss_item_sk = i.i_item_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk JOIN ca_cte AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN hd_cte AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ss.ss_sales_price / ss.ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01 GROUP BY c.c_customer_sk, c.c_first_name, c.c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p2",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: COLUMN REF MISMATCH: Original columns missing from rewrite \u2014 ['sr_item_sk', 'ws_item_sk']. The rewrite references different table columns.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_returns AS (SELECT sr.*, d1.d_date FROM store_returns AS sr JOIN date_dim AS d1 ON sr.sr_returned_date_sk = d1.d_date_sk WHERE d1.d_year = 2000) SELECT c.c_customer_sk, c.c_first_name, c.c_last_name, COUNT(*) AS cnt FROM store_sales AS ss JOIN filtered_returns AS sr ON ss.ss_ticket_number = sr.sr_ticket_number JOIN web_sales AS ws ON ss.ss_customer_sk = ws.ws_bill_customer_sk JOIN date_dim AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk JOIN item AS i ON ss.ss_item_sk = i.i_item_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE d2.d_date BETWEEN sr.d_date AND (sr.d_date + INTERVAL '90 DAY') AND i.i_category IN ('Children', 'Home', 'Women') AND ca.ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA') AND hd.hd_income_band_sk BETWEEN 8 AND 14 AND hd.hd_buy_potential = '501-1000' AND ss.ss_sales_price / ss.ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01 GROUP BY c.c_customer_sk, c.c_first_name, c.c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": null
    }
  ],
  "explains": {}
}