{
  "iteration": 2,
  "n_api_calls": 7,
  "best_speedup": 1.05,
  "best_patch_id": "t1",
  "best_sql": "WITH filtered_addresses AS (SELECT ca_address_sk FROM customer_address WHERE ca_city = 'Jackson'), filtered_income_bands AS (SELECT ib_income_band_sk FROM income_band WHERE ib_lower_bound >= 23567 AND ib_upper_bound <= 23567 + 50000) SELECT c_customer_id AS customer_id, COALESCE(c_last_name, '') || ', ' || COALESCE(c_first_name, '') AS customername FROM customer JOIN filtered_addresses ON c_current_addr_sk = ca_address_sk JOIN customer_demographics ON cd_demo_sk = c_current_cdemo_sk JOIN household_demographics ON hd_demo_sk = c_current_hdemo_sk JOIN filtered_income_bands ON hd_income_band_sk = ib_income_band_sk JOIN store_returns ON sr_cdemo_sk = cd_demo_sk WHERE TRUE ORDER BY c_customer_id LIMIT 100;",
  "patches": [
    {
      "patch_id": "t1",
      "family": "A+F",
      "transform": "early_filter_explicit_join",
      "relevance_score": 0.95,
      "status": "IMPROVED",
      "speedup": 1.05,
      "semantic_passed": true,
      "error": null,
      "original_ms": 31.9,
      "patch_ms": 30.3,
      "output_sql": "WITH filtered_addresses AS (SELECT ca_address_sk FROM customer_address WHERE ca_city = 'Jackson'), filtered_income_bands AS (SELECT ib_income_band_sk FROM income_band WHERE ib_lower_bound >= 23567 AND ib_upper_bound <= 23567 + 50000) SELECT c_customer_id AS customer_id, COALESCE(c_last_name, '') || ', ' || COALESCE(c_first_name, '') AS customername FROM customer JOIN filtered_addresses ON c_current_addr_sk = ca_address_sk JOIN customer_demographics ON cd_demo_sk = c_current_cdemo_sk JOIN household_demographics ON hd_demo_sk = c_current_hdemo_sk JOIN filtered_income_bands ON hd_income_band_sk = ib_income_band_sk JOIN store_returns ON sr_cdemo_sk = cd_demo_sk WHERE TRUE ORDER BY c_customer_id LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "t2",
      "family": "A+E",
      "transform": "prefetch_high_selectivity",
      "relevance_score": 0.85,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Equivalence (after retry): row count 19 vs 100",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_customer_address AS (SELECT ca_address_sk FROM customer_address WHERE ca_city = 'Jackson'), filtered_income_band AS (SELECT ib_income_band_sk FROM income_band WHERE ib_lower_bound >= 23567 AND ib_upper_bound <= 23567 + 50000), aggregated_store_returns AS (SELECT sr_cdemo_sk FROM store_returns GROUP BY sr_cdemo_sk) SELECT c_customer_id AS customer_id, COALESCE(c_last_name, '') || ', ' || COALESCE(c_first_name, '') AS customername FROM customer JOIN filtered_customer_address ON c_current_addr_sk = ca_address_sk JOIN household_demographics ON hd_demo_sk = c_current_hdemo_sk JOIN filtered_income_band ON hd_income_band_sk = ib_income_band_sk JOIN customer_demographics ON cd_demo_sk = c_current_cdemo_sk JOIN aggregated_store_returns ON sr_cdemo_sk = cd_demo_sk WHERE TRUE ORDER BY c_customer_id LIMIT 100;",
      "has_explain": false
    },
    {
      "patch_id": "t4",
      "family": "B",
      "transform": "decorrelate_optional_scan",
      "relevance_score": 0.75,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Equivalence (retry failed): Row count mismatch: original=100, patch=0",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_customers AS (SELECT c_customer_id, c_first_name, c_last_name, c_current_cdemo_sk, c_current_hdemo_sk, c_current_addr_sk FROM customer INNER JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ca_city = 'Jackson'), valid_income_bands AS (SELECT ib_income_band_sk FROM income_band WHERE ib_lower_bound >= 23567 AND ib_upper_bound <= 23567 + 50000), joined_demographics AS (SELECT cd_demo_sk FROM customer_demographics AS cd INNER JOIN household_demographics AS hd ON cd.cd_demo_sk = hd.hd_demo_sk INNER JOIN valid_income_bands AS vib ON hd.hd_income_band_sk = vib.ib_income_band_sk) SELECT c_customer_id AS customer_id, COALESCE(c_last_name, '') || ', ' || COALESCE(c_first_name, '') AS customername FROM filtered_customers AS fc LEFT JOIN store_returns AS sr ON sr.sr_cdemo_sk = fc.c_current_cdemo_sk INNER JOIN joined_demographics AS jd ON jd.cd_demo_sk = fc.c_current_cdemo_sk WHERE TRUE ORDER BY c_customer_id LIMIT 100;",
      "has_explain": false
    },
    {
      "patch_id": "t3",
      "family": "E",
      "transform": "literal_preserve_prefetch",
      "relevance_score": 0.8,
      "status": "REGRESSION",
      "speedup": 0.9,
      "semantic_passed": true,
      "error": null,
      "original_ms": 31.9,
      "patch_ms": 35.3,
      "output_sql": "WITH filtered_income_band AS (SELECT ib_income_band_sk FROM income_band WHERE ib_lower_bound >= 23567 AND ib_upper_bound <= 23567 + 50000), filtered_address AS (SELECT ca_address_sk FROM customer_address WHERE ca_city = 'Jackson') SELECT c_customer_id AS customer_id, COALESCE(c_last_name, '') || ', ' || COALESCE(c_first_name, '') AS customername FROM customer JOIN filtered_address ON c_current_addr_sk = ca_address_sk JOIN customer_demographics ON cd_demo_sk = c_current_cdemo_sk JOIN household_demographics ON hd_demo_sk = c_current_hdemo_sk JOIN filtered_income_band ON ib_income_band_sk = hd_income_band_sk JOIN store_returns ON sr_cdemo_sk = cd_demo_sk WHERE TRUE ORDER BY c_customer_id LIMIT 100;",
      "has_explain": true
    }
  ],
  "explains": {
    "t1": "Limit  (rows=100, time=39.494)\n  Gather Merge  (rows=100, time=39.488)\n    Sort  (rows=42, time=32.887)\n      Nested Loop  (rows=44, time=32.836)\n        Nested Loop  (rows=12, time=32.606)\n          Hash Join  (rows=12, time=32.4)\n            Nested Loop  (rows=63, time=32.261)\n              Hash Join  (rows=64, time=31.805)\n                Seq Scan on customer  (rows=166667, time=15.212)\n                Hash  (rows=33, time=8.889)\n                  Seq Scan on customer_address  (rows=33, time=",
    "t3": "Limit  (rows=100, time=37.883)\n  Gather Merge  (rows=100, time=37.876)\n    Sort  (rows=43, time=31.072)\n      Nested Loop  (rows=44, time=31.018)\n        Nested Loop  (rows=12, time=30.809)\n          Hash Join  (rows=12, time=30.617)\n            Nested Loop  (rows=63, time=30.476)\n              Hash Join  (rows=64, time=30.054)\n                Seq Scan on customer  (rows=166667, time=14.217)\n                Hash  (rows=33, time=8.205)\n                  Seq Scan on customer_address  (rows=33, tim"
  }
}