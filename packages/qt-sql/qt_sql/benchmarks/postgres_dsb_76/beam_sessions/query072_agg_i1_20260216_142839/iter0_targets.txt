[
  {
    "target_id": "t1",
    "family": "E",
    "transform": "multi_dimension_prefetch",
    "relevance_score": 0.95,
    "hypothesis": "Repeated full scans of date_dim for d1/d2/d3 cause redundant I/O. Prefetch filtered date_dim rows once for reuse across aliases.",
    "target_ir": "S0 [SELECT]\n  CTE: prefetched_dates  (via Q1)\n    FROM: date_dim\n    WHERE: d_year = 1998\n  MAIN QUERY (via Q0)\n    FROM: catalog_sales\n      JOIN prefetched_dates d1 ON (cs_sold_date_sk = d1.d_date_sk)\n      JOIN inventory ON (cs_item_sk = inv_item_sk)\n      JOIN prefetched_dates d2 ON (inv_date_sk = d2.d_date_sk)\n      JOIN prefetched_dates d3 ON (cs_ship_date_sk = d3.d_date_sk)\n      JOIN warehouse ON (w_warehouse_sk = inv_warehouse_sk)\n      JOIN item ON (i_item_sk = cs_item_sk)\n      JOIN customer_demographics ON (cs_bill_cdemo_sk = cd_demo_sk)\n      JOIN household_demographics ON (cs_bill_hdemo_sk = hd_demo_sk)\n      LEFT JOIN promotion ON (cs_promo_sk = p_promo_sk)\n      LEFT JOIN catalog_returns ON (cr_item_sk = cs_item_sk AND cr_order_number = cs_order_number)\n    WHERE [caca0908ce6d7a53]: d1.d_week_seq = d2.d_week_seq \n      AND inv_quantity_on_hand < cs_quantity \n      AND d3.d_date > d1.d_date + interval '3 day'\n      AND hd_buy_potential = '>10000'\n      AND cd_marital_status = 'U'\n      AND cd_dep_count BETWEEN 9 AND 11\n      AND i_category IN ('Children','Jewelry','Men')\n      AND cs_wholesale_cost BETWEEN 35 AND 55\n    GROUP BY: i_item_desc, w_warehouse_name, d1.d_week_seq\n    ORDER BY: total_cnt DESC, i_item_desc, w_warehouse_name, d_week_seq",
    "recommended_examples": [
      "multi_dimension_prefetch"
    ]
  },
  {
    "target_id": "t2",
    "family": "A",
    "transform": "dimension_filter_pushdown",
    "relevance_score": 0.85,
    "hypothesis": "Expensive nested loops caused by late-applied dimension filters. Push filters to CTEs to reduce join cardinality early.",
    "target_ir": "S0 [SELECT]\n  CTE: filtered_demographics  (via Q1)\n    FROM: customer_demographics\n    WHERE: cd_marital_status = 'U' AND cd_dep_count BETWEEN 9 AND 11\n  CTE: filtered_household  (via Q2)\n    FROM: household_demographics\n    WHERE: hd_buy_potential = '>10000'\n  CTE: filtered_items  (via Q3)\n    FROM: item\n    WHERE: i_category IN ('Children','Jewelry','Men')\n  MAIN QUERY (via Q0)\n    FROM: catalog_sales\n      JOIN filtered_demographics ON (cs_bill_cdemo_sk = cd_demo_sk)\n      JOIN filtered_household ON (cs_bill_hdemo_sk = hd_demo_sk)\n      JOIN filtered_items ON (i_item_sk = cs_item_sk)\n      ... [rest unchanged] ...",
    "recommended_examples": [
      "pg_date_cte_explicit_join"
    ]
  },
  {
    "target_id": "t3",
    "family": "F",
    "transform": "date_self_join_elimination",
    "relevance_score": 0.75,
    "hypothesis": "Self-join on date_dim (d1/d2) for week_seq comparison forces redundant processing. Use single date_dim instance with combined filters.",
    "target_ir": "S0 [SELECT]\n  MAIN QUERY (via Q0)\n    FROM: catalog_sales\n      JOIN date_dim d ON (cs_sold_date_sk = d.d_date_sk)\n      JOIN inventory ON (cs_item_sk = inv_item_sk AND inv_date_sk = d.d_date_sk)\n      ... [rest unchanged] ...\n    WHERE [MODIFIED]: \n      d.d_week_seq = d.d_week_seq  /* tautology */\n      AND d.d_year = 1998\n      AND ... [other conditions]",
    "recommended_examples": [
      "pg_explicit_join_materialized"
    ]
  }
]