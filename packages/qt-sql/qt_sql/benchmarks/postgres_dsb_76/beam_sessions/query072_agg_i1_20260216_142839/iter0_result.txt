{
  "iteration": 0,
  "n_api_calls": 5,
  "best_speedup": 7.77,
  "best_patch_id": "t1",
  "best_sql": "WITH prefetched_dates AS (SELECT d_date_sk, d_date, d_week_seq, d_year FROM date_dim WHERE d_year = 1998) SELECT i_item_desc, w_warehouse_name, d1.d_week_seq, SUM(CASE WHEN p_promo_sk IS NULL THEN 1 ELSE 0 END) AS no_promo, SUM(CASE WHEN NOT p_promo_sk IS NULL THEN 1 ELSE 0 END) AS promo, COUNT(*) AS total_cnt FROM catalog_sales JOIN prefetched_dates AS d1 ON (cs_sold_date_sk = d1.d_date_sk) JOIN inventory ON (cs_item_sk = inv_item_sk) JOIN prefetched_dates AS d2 ON (inv_date_sk = d2.d_date_sk) JOIN prefetched_dates AS d3 ON (cs_ship_date_sk = d3.d_date_sk) JOIN warehouse ON (w_warehouse_sk = inv_warehouse_sk) JOIN item ON (i_item_sk = cs_item_sk) JOIN customer_demographics ON (cs_bill_cdemo_sk = cd_demo_sk) JOIN household_demographics ON (cs_bill_hdemo_sk = hd_demo_sk) LEFT JOIN promotion ON (cs_promo_sk = p_promo_sk) LEFT JOIN catalog_returns ON (cr_item_sk = cs_item_sk AND cr_order_number = cs_order_number) WHERE d1.d_week_seq = d2.d_week_seq AND inv_quantity_on_hand < cs_quantity AND d3.d_date > d1.d_date + INTERVAL '3 DAY' AND hd_buy_potential = '>10000' AND cd_marital_status = 'U' AND cd_dep_count BETWEEN 9 AND 11 AND i_category IN ('Children', 'Jewelry', 'Men') AND cs_wholesale_cost BETWEEN 35 AND 55 GROUP BY i_item_desc, w_warehouse_name, d1.d_week_seq ORDER BY total_cnt DESC, i_item_desc, w_warehouse_name, d_week_seq LIMIT 100;",
  "patches": [
    {
      "patch_id": "t1",
      "family": "E",
      "transform": "multi_dimension_prefetch",
      "relevance_score": 0.95,
      "status": "WIN",
      "speedup": 7.77,
      "semantic_passed": true,
      "error": null,
      "original_ms": 449.9,
      "patch_ms": 57.9,
      "output_sql": "WITH prefetched_dates AS (SELECT d_date_sk, d_date, d_week_seq, d_year FROM date_dim WHERE d_year = 1998) SELECT i_item_desc, w_warehouse_name, d1.d_week_seq, SUM(CASE WHEN p_promo_sk IS NULL THEN 1 ELSE 0 END) AS no_promo, SUM(CASE WHEN NOT p_promo_sk IS NULL THEN 1 ELSE 0 END) AS promo, COUNT(*) AS total_cnt FROM catalog_sales JOIN prefetched_dates AS d1 ON (cs_sold_date_sk = d1.d_date_sk) JOIN inventory ON (cs_item_sk = inv_item_sk) JOIN prefetched_dates AS d2 ON (inv_date_sk = d2.d_date_sk) JOIN prefetched_dates AS d3 ON (cs_ship_date_sk = d3.d_date_sk) JOIN warehouse ON (w_warehouse_sk = inv_warehouse_sk) JOIN item ON (i_item_sk = cs_item_sk) JOIN customer_demographics ON (cs_bill_cdemo_sk = cd_demo_sk) JOIN household_demographics ON (cs_bill_hdemo_sk = hd_demo_sk) LEFT JOIN promotion ON (cs_promo_sk = p_promo_sk) LEFT JOIN catalog_returns ON (cr_item_sk = cs_item_sk AND cr_order_number = cs_order_number) WHERE d1.d_week_seq = d2.d_week_seq AND inv_quantity_on_hand < cs_quantity AND d3.d_date > d1.d_date + INTERVAL '3 DAY' AND hd_buy_potential = '>10000' AND cd_marital_status = 'U' AND cd_dep_count BETWEEN 9 AND 11 AND i_category IN ('Children', 'Jewelry', 'Men') AND cs_wholesale_cost BETWEEN 35 AND 55 GROUP BY i_item_desc, w_warehouse_name, d1.d_week_seq ORDER BY total_cnt DESC, i_item_desc, w_warehouse_name, d_week_seq LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "t2",
      "family": "A",
      "transform": "dimension_filter_pushdown",
      "relevance_score": 0.85,
      "status": "NEUTRAL",
      "speedup": 1.0,
      "semantic_passed": true,
      "error": null,
      "original_ms": 449.9,
      "patch_ms": 450.3,
      "output_sql": "WITH filtered_demographics AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_marital_status = 'U' AND cd_dep_count BETWEEN 9 AND 11), filtered_household AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential = '>10000'), filtered_items AS (SELECT i_item_sk, i_item_desc FROM item WHERE i_category IN ('Children', 'Jewelry', 'Men')) SELECT i_item_desc, w_warehouse_name, d1.d_week_seq, SUM(CASE WHEN p_promo_sk IS NULL THEN 1 ELSE 0 END) AS no_promo, SUM(CASE WHEN NOT p_promo_sk IS NULL THEN 1 ELSE 0 END) AS promo, COUNT(*) AS total_cnt FROM catalog_sales JOIN inventory ON (cs_item_sk = inv_item_sk) JOIN warehouse ON (w_warehouse_sk = inv_warehouse_sk) JOIN filtered_items ON (i_item_sk = cs_item_sk) JOIN filtered_demographics ON (cs_bill_cdemo_sk = cd_demo_sk) JOIN filtered_household ON (cs_bill_hdemo_sk = hd_demo_sk) JOIN date_dim AS d1 ON (cs_sold_date_sk = d1.d_date_sk) JOIN date_dim AS d2 ON (inv_date_sk = d2.d_date_sk) JOIN date_dim AS d3 ON (cs_ship_date_sk = d3.d_date_sk) LEFT OUTER JOIN promotion ON (cs_promo_sk = p_promo_sk) LEFT OUTER JOIN catalog_returns ON (cr_item_sk = cs_item_sk AND cr_order_number = cs_order_number) WHERE d1.d_week_seq = d2.d_week_seq AND inv_quantity_on_hand < cs_quantity AND d3.d_date > d1.d_date + INTERVAL '3 DAY' AND d1.d_year = 1998 AND cs_wholesale_cost BETWEEN 35 AND 55 GROUP BY i_item_desc, w_warehouse_name, d1.d_week_seq ORDER BY total_cnt DESC, i_item_desc, w_warehouse_name, d_week_seq LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "t3",
      "family": "F",
      "transform": "date_self_join_elimination",
      "relevance_score": 0.75,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Equivalence execution error: missing FROM-clause entry for table \"d1\"\nLINE 1: ...ear = 1998) SELECT i_item_desc, w_warehouse_name, d1.d_week_...\n                                                             ^\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_date_dim AS (SELECT * FROM date_dim WHERE d_year = 1998) SELECT i_item_desc, w_warehouse_name, d1.d_week_seq, SUM(CASE WHEN p_promo_sk IS NULL THEN 1 ELSE 0 END) AS no_promo, SUM(CASE WHEN NOT p_promo_sk IS NULL THEN 1 ELSE 0 END) AS promo, COUNT(*) AS total_cnt FROM catalog_sales JOIN filtered_date_dim AS d ON (cs_sold_date_sk = d.d_date_sk) JOIN inventory ON (cs_item_sk = inv_item_sk AND inv_date_sk = d.d_date_sk) JOIN warehouse ON (w_warehouse_sk = inv_warehouse_sk) JOIN item ON (i_item_sk = cs_item_sk) JOIN customer_demographics ON (cs_bill_cdemo_sk = cd_demo_sk) JOIN household_demographics ON (cs_bill_hdemo_sk = hd_demo_sk) LEFT OUTER JOIN promotion ON (cs_promo_sk = p_promo_sk) LEFT OUTER JOIN catalog_returns ON (cr_item_sk = cs_item_sk AND cr_order_number = cs_order_number) WHERE d.d_week_seq = d.d_week_seq AND inv_quantity_on_hand < cs_quantity AND d.d_date + INTERVAL '3 DAY' < (SELECT d_date FROM filtered_date_dim WHERE d_date_sk = cs_ship_date_sk) AND hd_buy_potential = '>10000' AND cd_marital_status = 'U' AND cd_dep_count BETWEEN 9 AND 11 AND i_category IN ('Children', 'Jewelry', 'Men') AND cs_wholesale_cost BETWEEN 35 AND 55 GROUP BY i_item_desc, w_warehouse_name, d1.d_week_seq ORDER BY total_cnt DESC, i_item_desc, w_warehouse_name, d_week_seq LIMIT 100;",
      "has_explain": false
    },
    {
      "patch_id": "syn_w2",
      "family": "B",
      "transform": "decorrelate",
      "relevance_score": 0.3,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Equivalence execution error: current transaction is aborted, commands ignored until end of transaction block\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH prefetched_dates AS (SELECT d_date_sk, d_date, d_week_seq, d_year FROM date_dim WHERE d_year = 1998) SELECT i_item_desc, w_warehouse_name, d1.d_week_seq, SUM(CASE WHEN p_promo_sk IS NULL THEN 1 ELSE 0 END) AS no_promo, SUM(CASE WHEN NOT p_promo_sk IS NULL THEN 1 ELSE 0 END) AS promo, COUNT(*) AS total_cnt FROM catalog_sales JOIN prefetched_dates AS d1 ON (cs_sold_date_sk = d1.d_date_sk) JOIN inventory ON (cs_item_sk = inv_item_sk) JOIN prefetched_dates AS d2 ON (inv_date_sk = d2.d_date_sk) JOIN prefetched_dates AS d3 ON (cs_ship_date_sk = d3.d_date_sk) JOIN warehouse ON (w_warehouse_sk = inv_warehouse_sk) JOIN item ON (i_item_sk = cs_item_sk) JOIN customer_demographics ON (cs_bill_cdemo_sk = cd_demo_sk) JOIN household_demographics ON (cs_bill_hdemo_sk = hd_demo_sk) LEFT JOIN promotion ON (cs_promo_sk = p_promo_sk) LEFT JOIN catalog_returns ON (cr_item_sk = cs_item_sk AND cr_order_number = cs_order_number) WHERE d1.d_week_seq = d2.d_week_seq AND inv_quantity_on_hand < cs_quantity AND d3.d_date > d1.d_date + INTERVAL '3 DAY' AND hd_buy_potential = '>10000' AND d1.d_year = 1998 AND cd_marital_status = 'U' AND cd_dep_count BETWEEN 9 AND 11 AND i_category IN ('Children', 'Jewelry', 'Men') AND cs_wholesale_cost BETWEEN 35 AND 55 GROUP BY i_item_desc, w_warehouse_name, d1.d_week_seq ORDER BY total_cnt DESC, i_item_desc, w_warehouse_name, d_week_seq LIMIT 100;",
      "has_explain": false
    }
  ],
  "explains": {
    "t1": "Limit  (rows=0, time=42.18)\n  Index Scan on date_dim  (rows=0, time=0.0)\n  Sort  (rows=0, time=42.176)\n    Aggregate  (rows=0, time=42.152)\n      Sort  (rows=0, time=42.15)\n        Nested Loop  (rows=0, time=42.144)\n          Nested Loop  (rows=0, time=42.143)\n            Nested Loop  (rows=0, time=42.142)\n              Nested Loop  (rows=0, time=42.14)\n                Nested Loop  (rows=0, time=42.139)\n                  Nested Loop  (rows=0, time=42.138)\n                    Nested Loop  (rows=0",
    "t2": "Limit  (rows=0, time=494.596)\n  Sort  (rows=0, time=494.593)\n    Aggregate  (rows=0, time=494.582)\n      Nested Loop  (rows=0, time=494.58)\n        Gather Merge  (rows=0, time=494.577)\n          Sort  (rows=0, time=488.204)\n            Nested Loop  (rows=0, time=488.183)\n              Nested Loop  (rows=0, time=488.182)\n                Nested Loop  (rows=0, time=488.18)\n                  Nested Loop  (rows=0, time=488.179)\n                    Hash Join  (rows=0, time=488.178)\n                   "
  }
}