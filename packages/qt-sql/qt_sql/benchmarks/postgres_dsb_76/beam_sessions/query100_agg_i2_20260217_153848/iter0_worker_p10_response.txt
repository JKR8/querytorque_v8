{
  "probe_id": "p01",
  "transform_id": "multi_dimension_prefetch",
  "family": "A",
  "dialect": "postgres",
  "hypothesis": "Pre-filtering customer, customer_address, and customer_demographics into a single CTE reduces row amplification from comma joins and enables efficient hash join with store_sales.",
  "reasoning_trace": [
    "Comma-join weakness causes nested loops and late filtering on customer_demographics",
    "Dimension tables have selective filters that can be pre-applied in a CTE",
    "Multi-dimension prefetch pattern isolates early selectivity to reduce fact table scan size"
  ],
  "target_ir": "Single CTE (dim_cte) encapsulating filtered customer dimensions; main query joins store_sales to dim_cte",
  "steps": [
    {
      "step_id": "s1",
      "op": "insert_cte",
      "target": {"by_node_id": "S0"},
      "payload": {
        "cte_name": "dim_cte",
        "cte_query_sql": "SELECT c_customer_sk FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE cd.cd_marital_status = 'D' AND cd.cd_education_status = 'College'"
      }
    },
    {
      "step_id": "s2",
      "op": "replace_from",
      "target": {"by_node_id": "S0"},
      "payload": {
        "from_sql": "item AS item1, item AS item2, store_sales AS s1, store_sales AS s2, date_dim, dim_cte"
      }
    }
  ]
}