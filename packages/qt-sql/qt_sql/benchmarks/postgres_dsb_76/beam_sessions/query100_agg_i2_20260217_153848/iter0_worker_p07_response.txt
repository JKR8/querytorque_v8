{
  "probe_id": "p01",
  "transform_id": "self_join_decomposition",
  "family": "F",
  "dialect": "postgres",
  "hypothesis": "Decompose self-join on item into two CTEs to allow early filtering and reduce nested loop cardinality.",
  "reasoning_trace": [
    "FROM clause contains self-join on item as item1, item2 with inequality condition",
    "Non-equi join (item1.i_item_sk < item2.i_item_sk) causes row explosion without early filtering",
    "PostgreSQL planner struggles with comma-join and non_equi_join_input_blindness"
  ],
  "target_ir": "Two materialized CTEs for filtered item scans; main query joins them with explicit JOIN syntax.",
  "steps": [
    {
      "step_id": "s1",
      "op": "insert_cte",
      "target": {"by_node_id": "S0"},
      "payload": {
        "cte_name": "item1_cte",
        "cte_query_sql": "SELECT i_item_sk FROM item WHERE i_category IN ('Electronics', 'Men')"
      }
    },
    {
      "step_id": "s2",
      "op": "insert_cte",
      "target": {"by_node_id": "S0"},
      "payload": {
        "cte_name": "item2_cte",
        "cte_query_sql": "SELECT i_item_sk FROM item WHERE i_manager_id BETWEEN 44 AND 63"
      }
    },
    {
      "step_id": "s3",
      "op": "replace_from",
      "target": {"by_node_id": "S0"},
      "payload": {
        "from_sql": "item1_cte, item2_cte, store_sales AS s1, store_sales AS s2, date_dim, customer, customer_address, customer_demographics"
      }
    }
  ]
}