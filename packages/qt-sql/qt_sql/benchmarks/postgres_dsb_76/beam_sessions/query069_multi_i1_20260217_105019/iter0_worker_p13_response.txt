```json
{
  "probe_id": "p01",
  "transform_id": "materialize_cte",
  "family": "E",
  "dialect": "postgres",
  "hypothesis": "Materializing customer+address join into a CTE will eliminate repeated scans and enable reuse in subqueries.",
  "reasoning_trace": [
    "Target comma-join between customer and customer_address causing poor estimates",
    "Node contract requires preserving c_customer_sk and c_current_cdemo_sk in output",
    "Anti-join hotspots on web_sales/catalog_sales suggest early filtering benefit"
  ],
  "target_ir": "Main query references materialized customer+address CTE; subqueries unchanged but decorrelated",
  "steps": [
    {
      "step_id": "s1",
      "op": "insert_cte",
      "target": {"by_node_id": "S0"},
      "payload": {
        "cte_name": "filtered_customer_address",
        "cte_query_sql": "SELECT c_customer_sk, c_current_cdemo_sk, c_current_addr_sk FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ca_state IN ('CO','NC','TX')"
      }
    },
    {
      "step_id": "s2",
      "op": "replace_from",
      "target": {"by_node_id": "S0"},
      "payload": {
        "from_sql": "filtered_customer_address fca, customer_demographics cd"
      }
    },
    {
      "step_id": "s3",
      "op": "replace_where_predicate",
      "target": {"by_node_id": "S0", "by_anchor_hash": "dae945277e160f9b"},
      "payload": {
        "expr_sql": "cd_demo_sk = fca.c_current_cdemo_sk AND cd_marital_status in ('S', 'M', 'U') AND cd_education_status in ('Primary', 'College') AND exists (select * from store_sales,date_dim where fca.c_customer_sk = ss_customer_sk and ss_sold_date_sk = d_date_sk and d_year = 2002 and d_moy between 10 and 10+2 and ss_list_price between 80 and 169) and (not exists (select * from web_sales,date_dim where fca.c_customer_sk = ws_bill_customer_sk and ws_sold_date_sk = d_date_sk and d_year = 2002 and d_moy between 10 and 10+2 and ws_list_price between 80 and 169) and not exists (select * from catalog_sales,date_dim where fca.c_customer_sk = cs_ship_customer_sk and cs_sold_date_sk = d_date_sk and d_year = 2002 and d_moy between 10 and 10+2 and cs_list_price between 80 and 169))"
      }
    }
  ]
}
```