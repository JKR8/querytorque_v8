[
  {
    "target_id": "t2",
    "family": "B",
    "transform": "decorrelate_state_thresholds",
    "relevance_score": 0.98,
    "hypothesis": "Eliminate correlated subquery by precomputing state thresholds in a separate CTE. This avoids per-row re-execution of the aggregate over the entire CTE (currently 595.771ms).",
    "target_ir": "S0: insert_cte(cte_name='state_thresholds', cte_query='SELECT ctr_state, AVG(ctr_total_return)*1.2 AS avg_threshold FROM customer_total_return GROUP BY ctr_state', after_cte='customer_total_return'); S0: replace_where_predicate(anchor_hash='bf1e0f73684cdf2e', new_predicate='ctr1.ctr_total_return > st.avg_threshold AND st.ctr_state = ctr1.ctr_state AND ca_address_sk = c_current_addr_sk AND ca_state IN (''OK'', ''SC'', ''TX'', ''WI'') AND ctr1.ctr_customer_sk = c_customer_sk AND ctr1.ctr_reason_sk IN (20, 36) AND c_birth_year BETWEEN 1985 AND 1991'); S0: replace_from(new_from='customer_total_return ctr1, customer_address, customer, state_thresholds st')",
    "recommended_examples": [
      "pg_shared_scan_decorrelate"
    ]
  },
  {
    "target_id": "t3",
    "family": "A+B",
    "transform": "push_reason_filter_then_decorrelate",
    "relevance_score": 0.9,
    "hypothesis": "First push wr_reason_sk filter into CTE to reduce aggregation workload (Seq Scan on web_returns currently 566.786ms), then apply decorrelation. Early filter reduces input to expensive aggregation.",
    "target_ir": "S0: replace_where_predicate(anchor_hash='abbc651b66e2994c', new_predicate='wr_returned_date_sk = d_date_sk AND d_year = 2002 AND wr_returning_addr_sk = ca_address_sk AND wr_item_sk = i_item_sk AND i_manager_id BETWEEN 68 AND 77 AND wr_return_amt / wr_return_quantity BETWEEN 242 AND 271 AND wr_reason_sk IN (20, 36)'); S0: insert_cte(cte_name='state_thresholds', cte_query='SELECT ctr_state, AVG(ctr_total_return)*1.2 AS avg_threshold FROM customer_total_return GROUP BY ctr_state', after_cte='customer_total_return'); S0: replace_where_predicate(anchor_hash='bf1e0f73684cdf2e', new_predicate='ctr1.ctr_total_return > st.avg_threshold AND st.ctr_state = ctr1.ctr_state AND ca_address_sk = c_current_addr_sk AND ca_state IN (''OK'', ''SC'', ''TX'', ''WI'') AND ctr1.ctr_customer_sk = c_customer_sk AND c_birth_year BETWEEN 1985 AND 1991'); S0: replace_from(new_from='customer_total_return ctr1, customer_address, customer, state_thresholds st')",
    "recommended_examples": [
      "pg_date_cte_explicit_join",
      "pg_shared_scan_decorrelate"
    ]
  }
]