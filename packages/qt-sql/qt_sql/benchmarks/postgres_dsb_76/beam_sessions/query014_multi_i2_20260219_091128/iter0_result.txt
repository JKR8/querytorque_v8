{
  "iteration": 0,
  "n_api_calls": 2,
  "beam_cost_usd": 0.0108767,
  "beam_cost_priced_calls": 1,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 28642,
    "completion_tokens": 7930,
    "total_tokens": 36572,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 0,
    "reasoning_tokens": 6080
  },
  "best_speedup": 84.54,
  "best_patch_id": "compile_p1",
  "best_sql": "WITH avg_sales AS (SELECT AVG(quantity * list_price) AS average_sales FROM (SELECT ss_quantity AS quantity, ss_list_price AS list_price FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2 AND ss_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT cs_quantity AS quantity, cs_list_price AS list_price FROM catalog_sales, date_dim WHERE cs_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2 AND cs_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT ws_quantity AS quantity, ws_list_price AS list_price FROM web_sales, date_dim WHERE ws_sold_date_sk = d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96 AND d_year BETWEEN 1999 AND 1999 + 2) AS x), cross_items AS (WITH date_filter AS (SELECT d_date_sk FROM date_dim WHERE d_year BETWEEN 1999 AND 1999 + 2), channel_store AS (SELECT iss.i_item_sk, iss.i_brand_id, iss.i_class_id, iss.i_category_id FROM store_sales ss JOIN item iss ON ss.ss_item_sk = iss.i_item_sk JOIN date_filter df ON ss.ss_sold_date_sk = df.d_date_sk WHERE iss.i_category IN ('Electronics', 'Shoes', 'Sports') AND iss.i_manager_id BETWEEN 42 AND 51 AND ss.ss_wholesale_cost BETWEEN 76 AND 96), channel_catalog AS (SELECT ics.i_item_sk, ics.i_brand_id, ics.i_class_id, ics.i_category_id FROM catalog_sales cs JOIN item ics ON cs.cs_item_sk = ics.i_item_sk JOIN date_filter df ON cs.cs_sold_date_sk = df.d_date_sk WHERE ics.i_category IN ('Electronics', 'Shoes', 'Sports') AND ics.i_manager_id BETWEEN 42 AND 51 AND cs.cs_wholesale_cost BETWEEN 76 AND 96), channel_web AS (SELECT iws.i_item_sk, iws.i_brand_id, iws.i_class_id, iws.i_category_id FROM web_sales ws JOIN item iws ON ws.ws_item_sk = iws.i_item_sk JOIN date_filter df ON ws.ws_sold_date_sk = df.d_date_sk WHERE iws.i_category IN ('Electronics', 'Shoes', 'Sports') AND iws.i_manager_id BETWEEN 42 AND 51 AND ws.ws_wholesale_cost BETWEEN 76 AND 96) SELECT i.i_item_sk AS ss_item_sk FROM item i WHERE i.i_category IN ('Electronics', 'Shoes', 'Sports') AND i.i_manager_id BETWEEN 42 AND 51 AND EXISTS (SELECT 1 FROM channel_store cs WHERE cs.i_brand_id = i.i_brand_id AND cs.i_class_id = i.i_class_id AND cs.i_category_id = i.i_category_id) AND EXISTS (SELECT 1 FROM channel_catalog cc WHERE cc.i_brand_id = i.i_brand_id AND cc.i_class_id = i.i_class_id AND cc.i_category_id = i.i_category_id) AND EXISTS (SELECT 1 FROM channel_web cw WHERE cw.i_brand_id = i.i_brand_id AND cw.i_class_id = i.i_class_id AND cw.i_category_id = i.i_category_id)) SELECT this_year.channel AS ty_channel, this_year.i_brand_id AS ty_brand, this_year.i_class_id AS ty_class, this_year.i_category_id AS ty_category, this_year.sales AS ty_sales, this_year.number_sales AS ty_number_sales, last_year.channel AS ly_channel, last_year.i_brand_id AS ly_brand, last_year.i_class_id AS ly_class, last_year.i_category_id AS ly_category, last_year.sales AS ly_sales, last_year.number_sales AS ly_number_sales FROM (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 + 1 AND d_moy = 12 AND d_dom = 12) AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND ss_wholesale_cost BETWEEN 76 AND 96 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)) AS this_year, (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 AND d_moy = 12 AND d_dom = 12) AND i_category IN ('Electronics', 'Shoes', 'Sports') AND ss_wholesale_cost BETWEEN 76 AND 96 AND i_manager_id BETWEEN 42 AND 51 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)) AS last_year WHERE this_year.i_brand_id = last_year.i_brand_id AND this_year.i_class_id = last_year.i_class_id AND this_year.i_category_id = last_year.i_category_id ORDER BY this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id LIMIT 100;",
  "patches": [
    {
      "patch_id": "p06",
      "family": "A",
      "transform": "multi_date_range_cte",
      "relevance_score": 0.65,
      "status": "ERROR",
      "speedup": 0.0,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": "column d1.d_year does not exist\nLINE 1: ....i_item_sk AND ss_sold_date_sk = d1.d_date_sk AND d1.d_year ...\n                                                             ^\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH d1 AS (SELECT d_date_sk FROM date_dim WHERE d_year BETWEEN 1999 AND 1999 + 2), d2 AS (SELECT d_date_sk FROM date_dim WHERE d_year BETWEEN 1999 AND 1999 + 2), d3 AS (SELECT d_date_sk FROM date_dim WHERE d_year BETWEEN 1999 AND 1999 + 2), cross_items AS (SELECT i_item_sk ss_item_sk FROM item, (SELECT iss.i_brand_id brand_id, iss.i_class_id class_id, iss.i_category_id category_id FROM store_sales, item iss, d1 WHERE ss_item_sk = iss.i_item_sk AND ss_sold_date_sk = d1.d_date_sk AND d1.d_year BETWEEN 1999 AND 1999 + 2 AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND ss_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT ics.i_brand_id, ics.i_class_id, ics.i_category_id FROM catalog_sales, item ics, d2 WHERE cs_item_sk = ics.i_item_sk AND cs_sold_date_sk = d2.d_date_sk AND d2.d_year BETWEEN 1999 AND 1999 + 2 AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND cs_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT iws.i_brand_id, iws.i_class_id, iws.i_category_id FROM web_sales, item iws, d3 WHERE ws_item_sk = iws.i_item_sk AND ws_sold_date_sk = d3.d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96 AND d3.d_year BETWEEN 1999 AND 1999 + 2) x WHERE i_brand_id = brand_id AND i_class_id = class_id AND i_category_id = category_id AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51), avg_sales AS (SELECT avg(quantity * list_price) average_sales FROM (SELECT ss_quantity quantity, ss_list_price list_price FROM store_sales, d1 WHERE ss_sold_date_sk = d1.d_date_sk AND d1.d_year BETWEEN 1999 AND 1999 + 2 AND ss_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT cs_quantity quantity, cs_list_price list_price FROM catalog_sales, d2 WHERE cs_sold_date_sk = d2.d_date_sk AND d2.d_year BETWEEN 1999 AND 1999 + 2 AND cs_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT ws_quantity quantity, ws_list_price list_price FROM web_sales, d3 WHERE ws_sold_date_sk = d3.d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96 AND d3.d_year BETWEEN 1999 AND 1999 + 2) x) SELECT this_year.channel AS ty_channel, this_year.i_brand_id AS ty_brand, this_year.i_class_id AS ty_class, this_year.i_category_id AS ty_category, this_year.sales AS ty_sales, this_year.number_sales AS ty_number_sales, last_year.channel AS ly_channel, last_year.i_brand_id AS ly_brand, last_year.i_class_id AS ly_class, last_year.i_category_id AS ly_category, last_year.sales AS ly_sales, last_year.number_sales AS ly_number_sales FROM (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 + 1 AND d_moy = 12 AND d_dom = 12) AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND ss_wholesale_cost BETWEEN 76 AND 96 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)) AS this_year, (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 AND d_moy = 12 AND d_dom = 12) AND i_category IN ('Electronics', 'Shoes', 'Sports') AND ss_wholesale_cost BETWEEN 76 AND 96 AND i_manager_id BETWEEN 42 AND 51 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)) AS last_year WHERE this_year.i_brand_id = last_year.i_brand_id AND this_year.i_class_id = last_year.i_class_id AND this_year.i_category_id = last_year.i_category_id ORDER BY this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Create separate date_dim CTEs for each alias (d1, d2, d3, etc.) with their specific filters to enable partition pruning."
    },
    {
      "patch_id": "p11",
      "family": "F",
      "transform": "pg_explicit_join_materialized",
      "relevance_score": 0.73,
      "status": "WIN",
      "speedup": 19.65,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": null,
      "original_ms": 300000.0,
      "patch_ms": 15265.4,
      "output_sql": "WITH this_year AS (WITH cross_items AS MATERIALIZED (SELECT i_item_sk ss_item_sk FROM item i INNER JOIN (SELECT iss.i_brand_id brand_id, iss.i_class_id class_id, iss.i_category_id category_id FROM store_sales ss INNER JOIN item iss ON ss.ss_item_sk = iss.i_item_sk INNER JOIN date_dim d1 ON ss.ss_sold_date_sk = d1.d_date_sk WHERE d1.d_year BETWEEN 1999 AND 1999 + 2 AND iss.i_category IN ('Electronics', 'Shoes', 'Sports') AND iss.i_manager_id BETWEEN 42 AND 51 AND ss.ss_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT ics.i_brand_id, ics.i_class_id, ics.i_category_id FROM catalog_sales cs INNER JOIN item ics ON cs.cs_item_sk = ics.i_item_sk INNER JOIN date_dim d2 ON cs.cs_sold_date_sk = d2.d_date_sk WHERE d2.d_year BETWEEN 1999 AND 1999 + 2 AND ics.i_category IN ('Electronics', 'Shoes', 'Sports') AND ics.i_manager_id BETWEEN 42 AND 51 AND cs.cs_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT iws.i_brand_id, iws.i_class_id, iws.i_category_id FROM web_sales ws INNER JOIN item iws ON ws.ws_item_sk = iws.i_item_sk INNER JOIN date_dim d3 ON ws.ws_sold_date_sk = d3.d_date_sk WHERE ws.ws_wholesale_cost BETWEEN 76 AND 96 AND d3.d_year BETWEEN 1999 AND 1999 + 2) x ON i.i_brand_id = x.brand_id AND i.i_class_id = x.class_id AND i.i_category_id = x.category_id WHERE i.i_category IN ('Electronics', 'Shoes', 'Sports') AND i.i_manager_id BETWEEN 42 AND 51), avg_sales AS MATERIALIZED (SELECT avg(quantity * list_price) average_sales FROM (SELECT ss_quantity quantity, ss_list_price list_price FROM store_sales INNER JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year BETWEEN 1999 AND 1999 + 2 AND ss_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT cs_quantity quantity, cs_list_price list_price FROM catalog_sales INNER JOIN date_dim ON cs_sold_date_sk = d_date_sk WHERE d_year BETWEEN 1999 AND 1999 + 2 AND cs_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT ws_quantity quantity, ws_list_price list_price FROM web_sales INNER JOIN date_dim ON ws_sold_date_sk = d_date_sk WHERE ws_wholesale_cost BETWEEN 76 AND 96 AND d_year BETWEEN 1999 AND 1999 + 2) x) SELECT 'store' channel, i.i_brand_id, i.i_class_id, i.i_category_id, sum(ss.ss_quantity * ss.ss_list_price) sales, count(*) number_sales FROM store_sales ss INNER JOIN item i ON ss.ss_item_sk = i.i_item_sk INNER JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE ss.ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND d.d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 + 1 AND d_moy = 12 AND d_dom = 12) AND i.i_category IN ('Electronics', 'Shoes', 'Sports') AND i.i_manager_id BETWEEN 42 AND 51 AND ss.ss_wholesale_cost BETWEEN 76 AND 96 GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id HAVING sum(ss.ss_quantity * ss.ss_list_price) > (SELECT average_sales FROM avg_sales)), last_year AS (WITH cross_items AS MATERIALIZED (SELECT i_item_sk ss_item_sk FROM item i INNER JOIN (SELECT iss.i_brand_id brand_id, iss.i_class_id class_id, iss.i_category_id category_id FROM store_sales ss INNER JOIN item iss ON ss.ss_item_sk = iss.i_item_sk INNER JOIN date_dim d1 ON ss.ss_sold_date_sk = d1.d_date_sk WHERE d1.d_year BETWEEN 1999 AND 1999 + 2 AND iss.i_category IN ('Electronics', 'Shoes', 'Sports') AND iss.i_manager_id BETWEEN 42 AND 51 AND ss.ss_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT ics.i_brand_id, ics.i_class_id, ics.i_category_id FROM catalog_sales cs INNER JOIN item ics ON cs.cs_item_sk = ics.i_item_sk INNER JOIN date_dim d2 ON cs.cs_sold_date_sk = d2.d_date_sk WHERE d2.d_year BETWEEN 1999 AND 1999 + 2 AND ics.i_category IN ('Electronics', 'Shoes', 'Sports') AND ics.i_manager_id BETWEEN 42 AND 51 AND cs.cs_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT iws.i_brand_id, iws.i_class_id, iws.i_category_id FROM web_sales ws INNER JOIN item iws ON ws.ws_item_sk = iws.i_item_sk INNER JOIN date_dim d3 ON ws.ws_sold_date_sk = d3.d_date_sk WHERE ws.ws_wholesale_cost BETWEEN 76 AND 96 AND d3.d_year BETWEEN 1999 AND 1999 + 2) x ON i.i_brand_id = x.brand_id AND i.i_class_id = x.class_id AND i.i_category_id = x.category_id WHERE i.i_category IN ('Electronics', 'Shoes', 'Sports') AND i.i_manager_id BETWEEN 42 AND 51), avg_sales AS MATERIALIZED (SELECT avg(quantity * list_price) average_sales FROM (SELECT ss_quantity quantity, ss_list_price list_price FROM store_sales INNER JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year BETWEEN 1999 AND 1999 + 2 AND ss_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT cs_quantity quantity, cs_list_price list_price FROM catalog_sales INNER JOIN date_dim ON cs_sold_date_sk = d_date_sk WHERE d_year BETWEEN 1999 AND 1999 + 2 AND cs_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT ws_quantity quantity, ws_list_price list_price FROM web_sales INNER JOIN date_dim ON ws_sold_date_sk = d_date_sk WHERE ws_wholesale_cost BETWEEN 76 AND 96 AND d_year BETWEEN 1999 AND 1999 + 2) x) SELECT 'store' channel, i.i_brand_id, i.i_class_id, i.i_category_id, sum(ss.ss_quantity * ss.ss_list_price) sales, count(*) number_sales FROM store_sales ss INNER JOIN item i ON ss.ss_item_sk = i.i_item_sk INNER JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE ss.ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND d.d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 AND d_moy = 12 AND d_dom = 12) AND i.i_category IN ('Electronics', 'Shoes', 'Sports') AND ss.ss_wholesale_cost BETWEEN 76 AND 96 AND i.i_manager_id BETWEEN 42 AND 51 GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id HAVING sum(ss.ss_quantity * ss.ss_list_price) > (SELECT average_sales FROM avg_sales)) SELECT this_year.channel ty_channel, this_year.i_brand_id ty_brand, this_year.i_class_id ty_class, this_year.i_category_id ty_category, this_year.sales ty_sales, this_year.number_sales ty_number_sales, last_year.channel ly_channel, last_year.i_brand_id ly_brand, last_year.i_class_id ly_class, last_year.i_category_id ly_category, last_year.sales ly_sales, last_year.number_sales ly_number_sales FROM this_year INNER JOIN last_year ON this_year.i_brand_id = last_year.i_brand_id AND this_year.i_class_id = last_year.i_class_id AND this_year.i_category_id = last_year.i_category_id ORDER BY this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Convert all comma joins to explicit INNER JOIN and materialize cross_items and avg_sales as MATERIALIZED CTEs for reuse."
    },
    {
      "patch_id": "p09",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.77,
      "status": "WIN",
      "speedup": 46.59,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": null,
      "original_ms": 300000.0,
      "patch_ms": 6438.5,
      "output_sql": "WITH prefiltered_date_dim AS (SELECT d_date_sk, d_week_seq, d_year, d_moy, d_dom FROM date_dim WHERE d_year BETWEEN 1999 AND 1999 + 2), prefiltered_item AS (SELECT i_item_sk, i_brand_id, i_class_id, i_category_id FROM item WHERE i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51), cross_items AS (SELECT i_item_sk AS ss_item_sk FROM item, (SELECT iss.i_brand_id AS brand_id, iss.i_class_id AS class_id, iss.i_category_id AS category_id FROM store_sales, item AS iss, date_dim AS d1 WHERE ss_item_sk = iss.i_item_sk AND ss_sold_date_sk = d1.d_date_sk AND d1.d_year BETWEEN 1999 AND 1999 + 2 AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND ss_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT ics.i_brand_id, ics.i_class_id, ics.i_category_id FROM catalog_sales, item AS ics, date_dim AS d2 WHERE cs_item_sk = ics.i_item_sk AND cs_sold_date_sk = d2.d_date_sk AND d2.d_year BETWEEN 1999 AND 1999 + 2 AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND cs_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT iws.i_brand_id, iws.i_class_id, iws.i_category_id FROM web_sales, item AS iws, date_dim AS d3 WHERE ws_item_sk = iws.i_item_sk AND ws_sold_date_sk = d3.d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96 AND d3.d_year BETWEEN 1999 AND 1999 + 2) AS x WHERE i_brand_id = brand_id AND i_class_id = class_id AND i_category_id = category_id AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51), avg_sales AS (SELECT AVG(quantity * list_price) AS average_sales FROM (SELECT ss_quantity AS quantity, ss_list_price AS list_price FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2 AND ss_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT cs_quantity AS quantity, cs_list_price AS list_price FROM catalog_sales, date_dim WHERE cs_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2 AND cs_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT ws_quantity AS quantity, ws_list_price AS list_price FROM web_sales, date_dim WHERE ws_sold_date_sk = d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96 AND d_year BETWEEN 1999 AND 1999 + 2) AS x), this_year AS (SELECT 'store' channel, i.i_brand_id, i.i_class_id, i.i_category_id, SUM(ss.ss_quantity * ss.ss_list_price) sales, COUNT(*) number_sales FROM store_sales ss JOIN cross_items ci ON ss.ss_item_sk = ci.ss_item_sk JOIN prefiltered_item i ON ss.ss_item_sk = i.i_item_sk JOIN prefiltered_date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE d.d_week_seq = (SELECT d_week_seq FROM prefiltered_date_dim WHERE d_year = 1999 + 1 AND d_moy = 12 AND d_dom = 12) GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id HAVING SUM(ss.ss_quantity * ss.ss_list_price) > (SELECT average_sales FROM avg_sales)), last_year AS (SELECT 'store' channel, i.i_brand_id, i.i_class_id, i.i_category_id, SUM(ss.ss_quantity * ss.ss_list_price) sales, COUNT(*) number_sales FROM store_sales ss JOIN cross_items ci ON ss.ss_item_sk = ci.ss_item_sk JOIN prefiltered_item i ON ss.ss_item_sk = i.i_item_sk JOIN prefiltered_date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE d.d_week_seq = (SELECT d_week_seq FROM prefiltered_date_dim WHERE d_year = 1999 AND d_moy = 12 AND d_dom = 12) GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id HAVING SUM(ss.ss_quantity * ss.ss_list_price) > (SELECT average_sales FROM avg_sales)) SELECT this_year.channel ty_channel, this_year.i_brand_id ty_brand, this_year.i_class_id ty_class, this_year.i_category_id ty_category, this_year.sales ty_sales, this_year.number_sales ty_number_sales, last_year.channel ly_channel, last_year.i_brand_id ly_brand, last_year.i_class_id ly_class, last_year.i_category_id ly_category, last_year.sales ly_sales, last_year.number_sales ly_number_sales FROM this_year JOIN last_year ON this_year.i_brand_id = last_year.i_brand_id AND this_year.i_class_id = last_year.i_class_id AND this_year.i_category_id = last_year.i_category_id ORDER BY this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-filter all selective dimensions (date_dim, item) into CTEs and use explicit star-join topology with fact tables."
    },
    {
      "patch_id": "p08",
      "family": "D",
      "transform": "union_cte_split",
      "relevance_score": 0.6,
      "status": "WIN",
      "speedup": 30.79,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": null,
      "original_ms": 300000.0,
      "patch_ms": 9742.8,
      "output_sql": "WITH cross_items AS (SELECT i_item_sk AS ss_item_sk FROM item, (SELECT iss.i_brand_id AS brand_id, iss.i_class_id AS class_id, iss.i_category_id AS category_id FROM store_sales, item AS iss, date_dim AS d1 WHERE ss_item_sk = iss.i_item_sk AND ss_sold_date_sk = d1.d_date_sk AND d1.d_year BETWEEN 1999 AND 1999 + 2 AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND ss_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT ics.i_brand_id, ics.i_class_id, ics.i_category_id FROM catalog_sales, item AS ics, date_dim AS d2 WHERE cs_item_sk = ics.i_item_sk AND cs_sold_date_sk = d2.d_date_sk AND d2.d_year BETWEEN 1999 AND 1999 + 2 AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND cs_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT iws.i_brand_id, iws.i_class_id, iws.i_category_id FROM web_sales, item AS iws, date_dim AS d3 WHERE ws_item_sk = iws.i_item_sk AND ws_sold_date_sk = d3.d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96 AND d3.d_year BETWEEN 1999 AND 1999 + 2) AS x WHERE i_brand_id = brand_id AND i_class_id = class_id AND i_category_id = category_id AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51), store_avg AS (SELECT avg(ss_quantity*ss_list_price) average_sales FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_year between 1999 and 1999 + 2 AND ss_wholesale_cost BETWEEN 76 AND 96), catalog_avg AS (SELECT avg(cs_quantity*cs_list_price) average_sales FROM catalog_sales, date_dim WHERE cs_sold_date_sk = d_date_sk AND d_year between 1999 and 1999 + 2 AND cs_wholesale_cost BETWEEN 76 AND 96), web_avg AS (SELECT avg(ws_quantity*ws_list_price) average_sales FROM web_sales, date_dim WHERE ws_sold_date_sk = d_date_sk AND d_year between 1999 and 1999 + 2 AND ws_wholesale_cost BETWEEN 76 AND 96) select  this_year.channel ty_channel\n                           ,this_year.i_brand_id ty_brand\n                           ,this_year.i_class_id ty_class\n                           ,this_year.i_category_id ty_category\n                           ,this_year.sales ty_sales\n                           ,this_year.number_sales ty_number_sales\n                           ,last_year.channel ly_channel\n                           ,last_year.i_brand_id ly_brand\n                           ,last_year.i_class_id ly_class\n                           ,last_year.i_category_id ly_category\n                           ,last_year.sales ly_sales\n                           ,last_year.number_sales ly_number_sales\n from\n (select 'store' channel, i_brand_id,i_class_id,i_category_id\n        ,sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n     ,item\n     ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n   and ss_item_sk = i_item_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_week_seq = (select d_week_seq\n                     from date_dim\n                     where d_year = 1999 + 1\n                       and d_moy = 12\n                       and d_dom = 12)\n   and i_category IN ('Electronics', 'Shoes', 'Sports')\n   and i_manager_id BETWEEN 42 and 51\n   and ss_wholesale_cost BETWEEN 76 AND 96\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from store_avg)) this_year,\n (select 'store' channel, i_brand_id,i_class_id\n        ,i_category_id, sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n     ,item\n     ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n   and ss_item_sk = i_item_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_week_seq = (select d_week_seq\n                     from date_dim\n                     where d_year = 1999\n                       and d_moy = 12\n                       and d_dom = 12)\n   and i_category IN ('Electronics', 'Shoes', 'Sports')\n   and ss_wholesale_cost BETWEEN 76 AND 96\n   and i_manager_id BETWEEN 42 and 51\ngroup by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from store_avg)) last_year\n where this_year.i_brand_id= last_year.i_brand_id\n   and this_year.i_class_id = last_year.i_class_id\n   and this_year.i_category_id = last_year.i_category_id\n order by this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id\n limit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Split avg_sales CTE into three specialized CTEs (store_avg, catalog_avg, web_avg) to allow separate optimization of each channel."
    },
    {
      "patch_id": "p07",
      "family": "B",
      "transform": "inline_decorrelate_materialized",
      "relevance_score": 0.8,
      "status": "WIN",
      "speedup": 30.69,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": null,
      "original_ms": 300000.0,
      "patch_ms": 9774.6,
      "output_sql": "with cross_items as (select i_item_sk ss_item_sk from item, (select iss.i_brand_id brand_id ,iss.i_class_id class_id ,iss.i_category_id category_id from store_sales ,item iss ,date_dim d1 where ss_item_sk = iss.i_item_sk and ss_sold_date_sk = d1.d_date_sk and d1.d_year between 1999 AND 1999 + 2 and i_category IN ('Electronics', 'Shoes', 'Sports') and i_manager_id BETWEEN 42 and 51 and ss_wholesale_cost BETWEEN 76 AND 96 intersect select ics.i_brand_id ,ics.i_class_id ,ics.i_category_id from catalog_sales ,item ics ,date_dim d2 where cs_item_sk = ics.i_item_sk and cs_sold_date_sk = d2.d_date_sk and d2.d_year between 1999 AND 1999 + 2 and i_category IN ('Electronics', 'Shoes', 'Sports') and i_manager_id BETWEEN 42 and 51 and cs_wholesale_cost BETWEEN 76 AND 96 intersect select iws.i_brand_id ,iws.i_class_id ,iws.i_category_id from web_sales ,item iws ,date_dim d3 where ws_item_sk = iws.i_item_sk and ws_sold_date_sk = d3.d_date_sk and ws_wholesale_cost BETWEEN 76 AND 96 and d3.d_year between 1999 AND 1999 + 2) x where i_brand_id = brand_id and i_class_id = class_id and i_category_id = category_id and i_category IN ('Electronics', 'Shoes', 'Sports') and i_manager_id BETWEEN 42 and 51), avg_sales as (select avg(quantity*list_price) average_sales from (select ss_quantity quantity ,ss_list_price list_price from store_sales ,date_dim where ss_sold_date_sk = d_date_sk and d_year between 1999 and 1999 + 2 and ss_wholesale_cost BETWEEN 76 AND 96 union all select cs_quantity quantity ,cs_list_price list_price from catalog_sales ,date_dim where cs_sold_date_sk = d_date_sk and d_year between 1999 and 1999 + 2 and cs_wholesale_cost BETWEEN 76 AND 96 union all select ws_quantity quantity ,ws_list_price list_price from web_sales ,date_dim where ws_sold_date_sk = d_date_sk and ws_wholesale_cost BETWEEN 76 AND 96 and d_year between 1999 and 1999 + 2) x), d_week_seq_1999 as materialized (select d_week_seq from date_dim where d_year = 1999 and d_moy = 12 and d_dom = 12), d_week_seq_2000 as materialized (select d_week_seq from date_dim where d_year = 1999+1 and d_moy=12 and d_dom=12) select this_year.channel ty_channel ,this_year.i_brand_id ty_brand ,this_year.i_class_id ty_class ,this_year.i_category_id ty_category ,this_year.sales ty_sales ,this_year.number_sales ty_number_sales ,last_year.channel ly_channel ,last_year.i_brand_id ly_brand ,last_year.i_class_id ly_class ,last_year.i_category_id ly_category ,last_year.sales ly_sales ,last_year.number_sales ly_number_sales from (select 'store' channel, i_brand_id,i_class_id,i_category_id ,sum(ss_quantity*ss_list_price) sales, count(*) number_sales from store_sales ,item ,date_dim where ss_item_sk in (select ss_item_sk from cross_items) and ss_item_sk = i_item_sk and ss_sold_date_sk = d_date_sk and d_week_seq = (select d_week_seq from d_week_seq_2000) and i_category IN ('Electronics', 'Shoes', 'Sports') and i_manager_id BETWEEN 42 and 51 and ss_wholesale_cost BETWEEN 76 AND 96 group by i_brand_id,i_class_id,i_category_id having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) this_year, (select 'store' channel, i_brand_id,i_class_id ,i_category_id, sum(ss_quantity*ss_list_price) sales, count(*) number_sales from store_sales ,item ,date_dim where ss_item_sk in (select ss_item_sk from cross_items) and ss_item_sk = i_item_sk and ss_sold_date_sk = d_date_sk and d_week_seq = (select d_week_seq from d_week_seq_1999) and i_category IN ('Electronics', 'Shoes', 'Sports') and ss_wholesale_cost BETWEEN 76 AND 96 and i_manager_id BETWEEN 42 and 51 group by i_brand_id,i_class_id,i_category_id having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) last_year where this_year.i_brand_id= last_year.i_brand_id and this_year.i_class_id = last_year.i_class_id and this_year.i_category_id = last_year.i_category_id order by this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id limit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Decorrelate scalar subqueries in main query (d_week_seq selects) using MATERIALIZED CTEs with pre-computed date keys."
    },
    {
      "patch_id": "p03",
      "family": "A",
      "transform": "pg_date_cte_explicit_join",
      "relevance_score": 0.78,
      "status": "ERROR",
      "speedup": 0.0,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": "column d1.d_year does not exist\nLINE 12:  where d1.d_year between 1999 AND 1999 + 2\n                ^\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH cross_items AS (with date_filter1 as (select d_date_sk from date_dim where d_year between 1999 AND 1999 + 2),\n     date_filter2 as (select d_date_sk from date_dim where d_year between 1999 AND 1999 + 2),\n     date_filter3 as (select d_date_sk from date_dim where d_year between 1999 AND 1999 + 2)\nselect i_item_sk ss_item_sk\nfrom item\nJOIN (select iss.i_brand_id brand_id\n     ,iss.i_class_id class_id\n     ,iss.i_category_id category_id\n from store_sales\n     JOIN item iss ON ss_item_sk = iss.i_item_sk\n     JOIN date_filter1 d1 ON ss_sold_date_sk = d1.d_date_sk\n where d1.d_year between 1999 AND 1999 + 2\n   and i_category IN ('Electronics', 'Shoes', 'Sports')\n   and i_manager_id BETWEEN 42 and 51\n   and ss_wholesale_cost BETWEEN 76 AND 96\nintersect\n select ics.i_brand_id\n     ,ics.i_class_id\n     ,ics.i_category_id\n from catalog_sales\n     JOIN item ics ON cs_item_sk = ics.i_item_sk\n     JOIN date_filter2 d2 ON cs_sold_date_sk = d2.d_date_sk\n where d2.d_year between 1999 AND 1999 + 2\n   and i_category IN ('Electronics', 'Shoes', 'Sports')\n   and i_manager_id BETWEEN 42 and 51\n   and cs_wholesale_cost BETWEEN 76 AND 96\nintersect\n select iws.i_brand_id\n     ,iws.i_class_id\n     ,iws.i_category_id\n from web_sales\n     JOIN item iws ON ws_item_sk = iws.i_item_sk\n     JOIN date_filter3 d3 ON ws_sold_date_sk = d3.d_date_sk\n where ws_wholesale_cost BETWEEN 76 AND 96\n   and d3.d_year between 1999 AND 1999 + 2) x\n ON i_brand_id = brand_id\n      and i_class_id = class_id\n      and i_category_id = category_id\n      and i_category IN ('Electronics', 'Shoes', 'Sports')\n      and i_manager_id BETWEEN 42 and 51), avg_sales AS (with date_filter4 as (select d_date_sk from date_dim where d_year between 1999 and 1999 + 2),\n     date_filter5 as (select d_date_sk from date_dim where d_year between 1999 and 1999 + 2),\n     date_filter6 as (select d_date_sk from date_dim where d_year between 1999 and 1999 + 2)\nselect avg(quantity*list_price) average_sales\n  from (select ss_quantity quantity\n             ,ss_list_price list_price\n       from store_sales\n           JOIN date_filter4 ON ss_sold_date_sk = d_date_sk\n         and d_year between 1999 and 1999 + 2\n         and ss_wholesale_cost BETWEEN 76 AND 96\n       union all\n       select cs_quantity quantity\n             ,cs_list_price list_price\n       from catalog_sales\n           JOIN date_filter5 ON cs_sold_date_sk = d_date_sk\n         and d_year between 1999 and 1999 + 2\n         and cs_wholesale_cost BETWEEN 76 AND 96\n       union all\n       select ws_quantity quantity\n             ,ws_list_price list_price\n       from web_sales\n           JOIN date_filter6 ON ws_sold_date_sk = d_date_sk\n        and ws_wholesale_cost BETWEEN 76 AND 96\n         and d_year between 1999 and 1999 + 2) x) select  this_year.channel ty_channel\n                           ,this_year.i_brand_id ty_brand\n                           ,this_year.i_class_id ty_class\n                           ,this_year.i_category_id ty_category\n                           ,this_year.sales ty_sales\n                           ,this_year.number_sales ty_number_sales\n                           ,last_year.channel ly_channel\n                           ,last_year.i_brand_id ly_brand\n                           ,last_year.i_class_id ly_class\n                           ,last_year.i_category_id ly_category\n                           ,last_year.sales ly_sales\n                           ,last_year.number_sales ly_number_sales\n from\n (select 'store' channel, i_brand_id,i_class_id,i_category_id\n        ,sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n     JOIN item ON ss_item_sk = i_item_sk\n     JOIN date_dim ON ss_sold_date_sk = d_date_sk\n where ss_item_sk in (select ss_item_sk from cross_items)\n   and d_week_seq = (select d_week_seq\n                     from date_dim\n                     where d_year = 1999 + 1\n                       and d_moy = 12\n                       and d_dom = 12)\n   and i_category IN ('Electronics', 'Shoes', 'Sports')\n   and i_manager_id BETWEEN 42 and 51\n   and ss_wholesale_cost BETWEEN 76 AND 96\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) this_year\n JOIN\n (select 'store' channel, i_brand_id,i_class_id\n        ,i_category_id, sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n     JOIN item ON ss_item_sk = i_item_sk\n     JOIN date_dim ON ss_sold_date_sk = d_date_sk\n where ss_item_sk in (select ss_item_sk from cross_items)\n   and d_week_seq = (select d_week_seq\n                     from date_dim\n                     where d_year = 1999\n                       and d_moy = 12\n                       and d_dom = 12)\n   and i_category IN ('Electronics', 'Shoes', 'Sports')\n   and ss_wholesale_cost BETWEEN 76 AND 96\n   and i_manager_id BETWEEN 42 and 51\ngroup by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) last_year\n ON this_year.i_brand_id= last_year.i_brand_id\n   and this_year.i_class_id = last_year.i_class_id\n   and this_year.i_category_id = last_year.i_category_id\n order by this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id\n limit 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Isolate date_dim filters into explicit CTEs and convert comma joins to explicit JOIN syntax for better cardinality estimation."
    },
    {
      "patch_id": "p12",
      "family": "D",
      "transform": "multi_intersect_exists_cte",
      "relevance_score": 0.62,
      "status": "WIN",
      "speedup": 57.17,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": null,
      "original_ms": 300000.0,
      "patch_ms": 5247.5,
      "output_sql": "WITH avg_sales AS (SELECT AVG(quantity * list_price) AS average_sales FROM (SELECT ss_quantity AS quantity, ss_list_price AS list_price FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2 AND ss_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT cs_quantity AS quantity, cs_list_price AS list_price FROM catalog_sales, date_dim WHERE cs_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2 AND cs_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT ws_quantity AS quantity, ws_list_price AS list_price FROM web_sales, date_dim WHERE ws_sold_date_sk = d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96 AND d_year BETWEEN 1999 AND 1999 + 2) AS x), cross_items AS (WITH date_filter AS (SELECT d_date_sk FROM date_dim WHERE d_year BETWEEN 1999 AND 1999 + 2), channel_store AS (SELECT iss.i_item_sk, iss.i_brand_id, iss.i_class_id, iss.i_category_id FROM store_sales ss JOIN item iss ON ss.ss_item_sk = iss.i_item_sk JOIN date_filter df ON ss.ss_sold_date_sk = df.d_date_sk WHERE iss.i_category IN ('Electronics', 'Shoes', 'Sports') AND iss.i_manager_id BETWEEN 42 AND 51 AND ss.ss_wholesale_cost BETWEEN 76 AND 96), channel_catalog AS (SELECT ics.i_item_sk, ics.i_brand_id, ics.i_class_id, ics.i_category_id FROM catalog_sales cs JOIN item ics ON cs.cs_item_sk = ics.i_item_sk JOIN date_filter df ON cs.cs_sold_date_sk = df.d_date_sk WHERE ics.i_category IN ('Electronics', 'Shoes', 'Sports') AND ics.i_manager_id BETWEEN 42 AND 51 AND cs.cs_wholesale_cost BETWEEN 76 AND 96), channel_web AS (SELECT iws.i_item_sk, iws.i_brand_id, iws.i_class_id, iws.i_category_id FROM web_sales ws JOIN item iws ON ws.ws_item_sk = iws.i_item_sk JOIN date_filter df ON ws.ws_sold_date_sk = df.d_date_sk WHERE iws.i_category IN ('Electronics', 'Shoes', 'Sports') AND iws.i_manager_id BETWEEN 42 AND 51 AND ws.ws_wholesale_cost BETWEEN 76 AND 96) SELECT i.i_item_sk AS ss_item_sk FROM item i WHERE i.i_category IN ('Electronics', 'Shoes', 'Sports') AND i.i_manager_id BETWEEN 42 AND 51 AND EXISTS (SELECT 1 FROM channel_store cs WHERE cs.i_brand_id = i.i_brand_id AND cs.i_class_id = i.i_class_id AND cs.i_category_id = i.i_category_id) AND EXISTS (SELECT 1 FROM channel_catalog cc WHERE cc.i_brand_id = i.i_brand_id AND cc.i_class_id = i.i_class_id AND cc.i_category_id = i.i_category_id) AND EXISTS (SELECT 1 FROM channel_web cw WHERE cw.i_brand_id = i.i_brand_id AND cw.i_class_id = i.i_class_id AND cw.i_category_id = i.i_category_id)) SELECT this_year.channel AS ty_channel, this_year.i_brand_id AS ty_brand, this_year.i_class_id AS ty_class, this_year.i_category_id AS ty_category, this_year.sales AS ty_sales, this_year.number_sales AS ty_number_sales, last_year.channel AS ly_channel, last_year.i_brand_id AS ly_brand, last_year.i_class_id AS ly_class, last_year.i_category_id AS ly_category, last_year.sales AS ly_sales, last_year.number_sales AS ly_number_sales FROM (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 + 1 AND d_moy = 12 AND d_dom = 12) AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND ss_wholesale_cost BETWEEN 76 AND 96 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)) AS this_year, (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 AND d_moy = 12 AND d_dom = 12) AND i_category IN ('Electronics', 'Shoes', 'Sports') AND ss_wholesale_cost BETWEEN 76 AND 96 AND i_manager_id BETWEEN 42 AND 51 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)) AS last_year WHERE this_year.i_brand_id = last_year.i_brand_id AND this_year.i_class_id = last_year.i_class_id AND this_year.i_category_id = last_year.i_category_id ORDER BY this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Convert INTERSECT to correlated EXISTS with pre-materialized date and channel CTEs to avoid full branch materialization."
    },
    {
      "patch_id": "p02",
      "family": "C",
      "transform": "pg_materialized_dimension_fact_prefilter",
      "relevance_score": 0.82,
      "status": "WIN",
      "speedup": 16.23,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": null,
      "original_ms": 300000.0,
      "patch_ms": 18480.3,
      "output_sql": "WITH filtered_date_dim AS (SELECT * FROM date_dim WHERE d_year BETWEEN 1999 AND 1999 + 2), filtered_item AS (SELECT * FROM item WHERE i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51), avg_sales AS (WITH filtered_date_dim AS MATERIALIZED (SELECT * FROM date_dim WHERE d_year BETWEEN 1999 AND 1999 + 2) SELECT avg(quantity * list_price) average_sales FROM (SELECT ss_quantity quantity, ss_list_price list_price FROM store_sales, filtered_date_dim WHERE ss_sold_date_sk = d_date_sk AND ss_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT cs_quantity quantity, cs_list_price list_price FROM catalog_sales, filtered_date_dim WHERE cs_sold_date_sk = d_date_sk AND cs_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT ws_quantity quantity, ws_list_price list_price FROM web_sales, filtered_date_dim WHERE ws_sold_date_sk = d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96) x), cross_items AS (WITH filtered_date_dim AS MATERIALIZED (SELECT * FROM date_dim WHERE d_year BETWEEN 1999 AND 1999 + 2), filtered_item AS MATERIALIZED (SELECT * FROM item WHERE i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51) SELECT i_item_sk ss_item_sk FROM filtered_item, (SELECT iss.i_brand_id brand_id, iss.i_class_id class_id, iss.i_category_id category_id FROM store_sales, filtered_item iss, filtered_date_dim d1 WHERE ss_item_sk = iss.i_item_sk AND ss_sold_date_sk = d1.d_date_sk AND ss_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT ics.i_brand_id, ics.i_class_id, ics.i_category_id FROM catalog_sales, filtered_item ics, filtered_date_dim d2 WHERE cs_item_sk = ics.i_item_sk AND cs_sold_date_sk = d2.d_date_sk AND cs_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT iws.i_brand_id, iws.i_class_id, iws.i_category_id FROM web_sales, filtered_item iws, filtered_date_dim d3 WHERE ws_item_sk = iws.i_item_sk AND ws_sold_date_sk = d3.d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96) x WHERE i_brand_id = brand_id AND i_class_id = class_id AND i_category_id = category_id) SELECT this_year.channel AS ty_channel, this_year.i_brand_id AS ty_brand, this_year.i_class_id AS ty_class, this_year.i_category_id AS ty_category, this_year.sales AS ty_sales, this_year.number_sales AS ty_number_sales, last_year.channel AS ly_channel, last_year.i_brand_id AS ly_brand, last_year.i_class_id AS ly_class, last_year.i_category_id AS ly_category, last_year.sales AS ly_sales, last_year.number_sales AS ly_number_sales FROM (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 + 1 AND d_moy = 12 AND d_dom = 12) AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND ss_wholesale_cost BETWEEN 76 AND 96 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)) AS this_year, (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 AND d_moy = 12 AND d_dom = 12) AND i_category IN ('Electronics', 'Shoes', 'Sports') AND ss_wholesale_cost BETWEEN 76 AND 96 AND i_manager_id BETWEEN 42 AND 51 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)) AS last_year WHERE this_year.i_brand_id = last_year.i_brand_id AND this_year.i_class_id = last_year.i_class_id AND this_year.i_category_id = last_year.i_category_id ORDER BY this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-filter date_dim and item into MATERIALIZED CTEs before joining with fact tables in avg_sales and main query to reduce input sizes."
    },
    {
      "patch_id": "p01",
      "family": "D",
      "transform": "pg_intersect_to_exists",
      "relevance_score": 0.85,
      "status": "WIN",
      "speedup": 34.8,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": null,
      "original_ms": 300000.0,
      "patch_ms": 8621.7,
      "output_sql": "WITH avg_sales AS (SELECT AVG(quantity * list_price) AS average_sales FROM (SELECT ss_quantity AS quantity, ss_list_price AS list_price FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2 AND ss_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT cs_quantity AS quantity, cs_list_price AS list_price FROM catalog_sales, date_dim WHERE cs_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2 AND cs_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT ws_quantity AS quantity, ws_list_price AS list_price FROM web_sales, date_dim WHERE ws_sold_date_sk = d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96 AND d_year BETWEEN 1999 AND 1999 + 2) AS x), cross_items AS (SELECT i.i_item_sk AS ss_item_sk FROM item i WHERE i.i_category IN ('Electronics', 'Shoes', 'Sports') AND i.i_manager_id BETWEEN 42 AND 51 AND EXISTS (SELECT 1 FROM store_sales ss JOIN date_dim d1 ON ss.ss_sold_date_sk = d1.d_date_sk WHERE ss.ss_item_sk = i.i_item_sk AND d1.d_year BETWEEN 1999 AND 1999 + 2 AND ss.ss_wholesale_cost BETWEEN 76 AND 96) AND EXISTS (SELECT 1 FROM catalog_sales cs JOIN date_dim d2 ON cs.cs_sold_date_sk = d2.d_date_sk WHERE cs.cs_item_sk = i.i_item_sk AND d2.d_year BETWEEN 1999 AND 1999 + 2 AND cs.cs_wholesale_cost BETWEEN 76 AND 96) AND EXISTS (SELECT 1 FROM web_sales ws JOIN date_dim d3 ON ws.ws_sold_date_sk = d3.d_date_sk WHERE ws.ws_item_sk = i.i_item_sk AND d3.d_year BETWEEN 1999 AND 1999 + 2 AND ws.ws_wholesale_cost BETWEEN 76 AND 96)) SELECT this_year.channel AS ty_channel, this_year.i_brand_id AS ty_brand, this_year.i_class_id AS ty_class, this_year.i_category_id AS ty_category, this_year.sales AS ty_sales, this_year.number_sales AS ty_number_sales, last_year.channel AS ly_channel, last_year.i_brand_id AS ly_brand, last_year.i_class_id AS ly_class, last_year.i_category_id AS ly_category, last_year.sales AS ly_sales, last_year.number_sales AS ly_number_sales FROM (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 + 1 AND d_moy = 12 AND d_dom = 12) AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND ss_wholesale_cost BETWEEN 76 AND 96 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)) AS this_year, (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 AND d_moy = 12 AND d_dom = 12) AND i_category IN ('Electronics', 'Shoes', 'Sports') AND ss_wholesale_cost BETWEEN 76 AND 96 AND i_manager_id BETWEEN 42 AND 51 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)) AS last_year WHERE this_year.i_brand_id = last_year.i_brand_id AND this_year.i_class_id = last_year.i_class_id AND this_year.i_category_id = last_year.i_category_id ORDER BY this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Replace INTERSECT in cross_items CTE with EXISTS semi-joins to avoid full materialization and sorting of large intermediate sets."
    },
    {
      "patch_id": "p04",
      "family": "E",
      "transform": "pg_self_join_decomposition",
      "relevance_score": 0.75,
      "status": "ERROR",
      "speedup": 0.0,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": "column \"avgs.average_sales\" must appear in the GROUP BY clause or be used in an aggregate function\nLINE 1: ...d HAVING SUM(ss.ss_quantity * ss.ss_list_price) > avgs.avera...\n                                                             ^\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH cross_items AS (SELECT i_item_sk AS ss_item_sk FROM item, (SELECT iss.i_brand_id AS brand_id, iss.i_class_id AS class_id, iss.i_category_id AS category_id FROM store_sales, item AS iss, date_dim AS d1 WHERE ss_item_sk = iss.i_item_sk AND ss_sold_date_sk = d1.d_date_sk AND d1.d_year BETWEEN 1999 AND 1999 + 2 AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND ss_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT ics.i_brand_id, ics.i_class_id, ics.i_category_id FROM catalog_sales, item AS ics, date_dim AS d2 WHERE cs_item_sk = ics.i_item_sk AND cs_sold_date_sk = d2.d_date_sk AND d2.d_year BETWEEN 1999 AND 1999 + 2 AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND cs_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT iws.i_brand_id, iws.i_class_id, iws.i_category_id FROM web_sales, item AS iws, date_dim AS d3 WHERE ws_item_sk = iws.i_item_sk AND ws_sold_date_sk = d3.d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96 AND d3.d_year BETWEEN 1999 AND 1999 + 2) AS x WHERE i_brand_id = brand_id AND i_class_id = class_id AND i_category_id = category_id AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51), avg_sales AS (SELECT AVG(quantity * list_price) AS average_sales FROM (SELECT ss_quantity AS quantity, ss_list_price AS list_price FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2 AND ss_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT cs_quantity AS quantity, cs_list_price AS list_price FROM catalog_sales, date_dim WHERE cs_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2 AND cs_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT ws_quantity AS quantity, ws_list_price AS list_price FROM web_sales, date_dim WHERE ws_sold_date_sk = d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96 AND d_year BETWEEN 1999 AND 1999 + 2) AS x), this_year AS (SELECT 'store' AS channel, i.i_brand_id, i.i_class_id, i.i_category_id, SUM(ss.ss_quantity * ss.ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk CROSS JOIN cross_items ci CROSS JOIN avg_sales avgs WHERE ss.ss_item_sk = ci.ss_item_sk AND d.d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 + 1 AND d_moy = 12 AND d_dom = 12) AND i.i_category IN ('Electronics', 'Shoes', 'Sports') AND i.i_manager_id BETWEEN 42 AND 51 AND ss.ss_wholesale_cost BETWEEN 76 AND 96 GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id HAVING SUM(ss.ss_quantity * ss.ss_list_price) > avgs.average_sales), last_year AS (SELECT 'store' AS channel, i.i_brand_id, i.i_class_id, i.i_category_id, SUM(ss.ss_quantity * ss.ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk CROSS JOIN cross_items ci CROSS JOIN avg_sales avgs WHERE ss.ss_item_sk = ci.ss_item_sk AND d.d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 AND d_moy = 12 AND d_dom = 12) AND i.i_category IN ('Electronics', 'Shoes', 'Sports') AND i.i_manager_id BETWEEN 42 AND 51 AND ss.ss_wholesale_cost BETWEEN 76 AND 96 GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id HAVING SUM(ss.ss_quantity * ss.ss_list_price) > avgs.average_sales) SELECT ty.channel AS ty_channel, ty.i_brand_id AS ty_brand, ty.i_class_id AS ty_class, ty.i_category_id AS ty_category, ty.sales AS ty_sales, ty.number_sales AS ty_number_sales, ly.channel AS ly_channel, ly.i_brand_id AS ly_brand, ly.i_class_id AS ly_class, ly.i_category_id AS ly_category, ly.sales AS ly_sales, ly.number_sales AS ly_number_sales FROM this_year ty JOIN last_year ly ON ty.i_brand_id = ly.i_brand_id AND ty.i_class_id = ly.i_class_id AND ty.i_category_id = ly.i_category_id ORDER BY ty.channel, ty.i_brand_id, ty.i_class_id, ty.i_category_id LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Decompose main query self-join (this_year/last_year) into separate CTEs with embedded date filters to avoid full materialization and post-filtering."
    },
    {
      "patch_id": "p05",
      "family": "C",
      "transform": "channel_bitmap_aggregation",
      "relevance_score": 0.72,
      "status": "WIN",
      "speedup": 25.89,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": null,
      "original_ms": 300000.0,
      "patch_ms": 11586.2,
      "output_sql": "WITH cross_items AS (SELECT i_item_sk AS ss_item_sk FROM item, (SELECT iss.i_brand_id AS brand_id, iss.i_class_id AS class_id, iss.i_category_id AS category_id FROM store_sales, item AS iss, date_dim AS d1 WHERE ss_item_sk = iss.i_item_sk AND ss_sold_date_sk = d1.d_date_sk AND d1.d_year BETWEEN 1999 AND 1999 + 2 AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND ss_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT ics.i_brand_id, ics.i_class_id, ics.i_category_id FROM catalog_sales, item AS ics, date_dim AS d2 WHERE cs_item_sk = ics.i_item_sk AND cs_sold_date_sk = d2.d_date_sk AND d2.d_year BETWEEN 1999 AND 1999 + 2 AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND cs_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT iws.i_brand_id, iws.i_class_id, iws.i_category_id FROM web_sales, item AS iws, date_dim AS d3 WHERE ws_item_sk = iws.i_item_sk AND ws_sold_date_sk = d3.d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96 AND d3.d_year BETWEEN 1999 AND 1999 + 2) AS x WHERE i_brand_id = brand_id AND i_class_id = class_id AND i_category_id = category_id AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51), avg_sales AS (SELECT AVG(quantity * list_price) AS average_sales FROM (SELECT CASE WHEN channel = 'store' THEN ss_quantity ELSE 0 END AS quantity, CASE WHEN channel = 'store' THEN ss_list_price ELSE 0 END AS list_price FROM (SELECT 'store' AS channel, ss_quantity, ss_list_price, ss_sold_date_sk, ss_wholesale_cost FROM store_sales UNION ALL SELECT 'catalog' AS channel, cs_quantity, cs_list_price, cs_sold_date_sk, cs_wholesale_cost FROM catalog_sales UNION ALL SELECT 'web' AS channel, ws_quantity, ws_list_price, ws_sold_date_sk, ws_wholesale_cost FROM web_sales) sales JOIN date_dim d ON sales.ss_sold_date_sk = d.d_date_sk WHERE d.d_year BETWEEN 1999 AND 1999 + 2 AND sales.ss_wholesale_cost BETWEEN 76 AND 96) x) SELECT this_year.channel AS ty_channel, this_year.i_brand_id AS ty_brand, this_year.i_class_id AS ty_class, this_year.i_category_id AS ty_category, this_year.sales AS ty_sales, this_year.number_sales AS ty_number_sales, last_year.channel AS ly_channel, last_year.i_brand_id AS ly_brand, last_year.i_class_id AS ly_class, last_year.i_category_id AS ly_category, last_year.sales AS ly_sales, last_year.number_sales AS ly_number_sales FROM (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 + 1 AND d_moy = 12 AND d_dom = 12) AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND ss_wholesale_cost BETWEEN 76 AND 96 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)) AS this_year, (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 AND d_moy = 12 AND d_dom = 12) AND i_category IN ('Electronics', 'Shoes', 'Sports') AND ss_wholesale_cost BETWEEN 76 AND 96 AND i_manager_id BETWEEN 42 AND 51 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)) AS last_year WHERE this_year.i_brand_id = last_year.i_brand_id AND this_year.i_class_id = last_year.i_class_id AND this_year.i_category_id = last_year.i_category_id ORDER BY this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Consolidate repeated fact table scans in avg_sales CTE into single-pass conditional aggregation per channel using CASE expressions."
    },
    {
      "patch_id": "p10",
      "family": "C",
      "transform": "single_pass_aggregation",
      "relevance_score": 0.58,
      "status": "ERROR",
      "speedup": 0.0,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": "relation \"combined_sales\" does not exist\nLINE 46:   FROM combined_sales\n                ^\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH cross_items AS (SELECT i_item_sk AS ss_item_sk FROM item, (SELECT iss.i_brand_id AS brand_id, iss.i_class_id AS class_id, iss.i_category_id AS category_id FROM store_sales, item AS iss, date_dim AS d1 WHERE ss_item_sk = iss.i_item_sk AND ss_sold_date_sk = d1.d_date_sk AND d1.d_year BETWEEN 1999 AND 1999 + 2 AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND ss_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT ics.i_brand_id, ics.i_class_id, ics.i_category_id FROM catalog_sales, item AS ics, date_dim AS d2 WHERE cs_item_sk = ics.i_item_sk AND cs_sold_date_sk = d2.d_date_sk AND d2.d_year BETWEEN 1999 AND 1999 + 2 AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND cs_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT iws.i_brand_id, iws.i_class_id, iws.i_category_id FROM web_sales, item AS iws, date_dim AS d3 WHERE ws_item_sk = iws.i_item_sk AND ws_sold_date_sk = d3.d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96 AND d3.d_year BETWEEN 1999 AND 1999 + 2) AS x WHERE i_brand_id = brand_id AND i_class_id = class_id AND i_category_id = category_id AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51), avg_sales AS (SELECT AVG(quantity * list_price) AS average_sales FROM (SELECT ss_quantity AS quantity, ss_list_price AS list_price FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2 AND ss_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT cs_quantity AS quantity, cs_list_price AS list_price FROM catalog_sales, date_dim WHERE cs_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2 AND cs_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT ws_quantity AS quantity, ws_list_price AS list_price FROM web_sales, date_dim WHERE ws_sold_date_sk = d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96 AND d_year BETWEEN 1999 AND 1999 + 2) AS x) SELECT \n  this_year.ty_channel,\n  this_year.ty_brand,\n  this_year.ty_class,\n  this_year.ty_category,\n  this_year.ty_sales,\n  this_year.ty_number_sales,\n  last_year.ly_channel,\n  last_year.ly_brand,\n  last_year.ly_class,\n  last_year.ly_category,\n  last_year.ly_sales,\n  last_year.ly_number_sales\nFROM (\n  SELECT \n    'store' AS channel,\n    i_brand_id,\n    i_class_id,\n    i_category_id,\n    SUM(CASE WHEN d_year = 1999 + 1 AND d_moy = 12 AND d_dom = 12 THEN ss_quantity * ss_list_price ELSE 0 END) AS ty_sales,\n    SUM(CASE WHEN d_year = 1999 AND d_moy = 12 AND d_dom = 12 THEN ss_quantity * ss_list_price ELSE 0 END) AS ly_sales,\n    SUM(CASE WHEN d_year = 1999 + 1 AND d_moy = 12 AND d_dom = 12 THEN 1 ELSE 0 END) AS ty_number_sales,\n    SUM(CASE WHEN d_year = 1999 AND d_moy = 12 AND d_dom = 12 THEN 1 ELSE 0 END) AS ly_number_sales\n  FROM store_sales\n  JOIN item ON ss_item_sk = i_item_sk\n  JOIN date_dim ON ss_sold_date_sk = d_date_sk\n  WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items)\n    AND d_week_seq IN (\n      SELECT d_week_seq\n      FROM date_dim\n      WHERE (d_year = 1999 + 1 AND d_moy = 12 AND d_dom = 12)\n         OR (d_year = 1999 AND d_moy = 12 AND d_dom = 12)\n    )\n    AND i_category IN ('Electronics', 'Shoes', 'Sports')\n    AND i_manager_id BETWEEN 42 AND 51\n    AND ss_wholesale_cost BETWEEN 76 AND 96\n  GROUP BY i_brand_id, i_class_id, i_category_id\n  HAVING SUM(CASE WHEN d_year = 1999 + 1 AND d_moy = 12 AND d_dom = 12 THEN ss_quantity * ss_list_price ELSE 0 END) > (SELECT average_sales FROM avg_sales)\n     AND SUM(CASE WHEN d_year = 1999 AND d_moy = 12 AND d_dom = 12 THEN ss_quantity * ss_list_price ELSE 0 END) > (SELECT average_sales FROM avg_sales)\n) combined_sales\nJOIN (\n  SELECT \n    i_brand_id AS ty_brand,\n    i_class_id AS ty_class,\n    i_category_id AS ty_category\n  FROM combined_sales\n) this_year ON combined_sales.i_brand_id = this_year.ty_brand\n              AND combined_sales.i_class_id = this_year.ty_class\n              AND combined_sales.i_category_id = this_year.ty_category\nJOIN (\n  SELECT \n    i_brand_id AS ly_brand,\n    i_class_id AS ly_class,\n    i_category_id AS ly_category\n  FROM combined_sales\n) last_year ON this_year.ty_brand = last_year.ly_brand\n              AND this_year.ty_class = last_year.ly_class\n              AND this_year.ty_category = last_year.ly_category\nORDER BY this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id\nLIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Consolidate multiple aggregations in main query (sales and number_sales) into single-pass computations to reduce repeated store_sales scans."
    },
    {
      "patch_id": "compile_p01",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 76.25,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": null,
      "original_ms": 300000.0,
      "patch_ms": 3934.5,
      "output_sql": "WITH cross_items AS (SELECT i.i_item_sk AS ss_item_sk FROM item i WHERE i.i_category IN ('Electronics', 'Shoes', 'Sports') AND i.i_manager_id BETWEEN 42 AND 51 AND EXISTS (SELECT 1 FROM store_sales ss JOIN item iss ON ss.ss_item_sk = iss.i_item_sk JOIN date_dim d1 ON ss.ss_sold_date_sk = d1.d_date_sk WHERE d1.d_year BETWEEN 1999 AND 1999 + 2 AND iss.i_brand_id = i.i_brand_id AND iss.i_class_id = i.i_class_id AND iss.i_category_id = i.i_category_id AND iss.i_category IN ('Electronics', 'Shoes', 'Sports') AND iss.i_manager_id BETWEEN 42 AND 51 AND ss.ss_wholesale_cost BETWEEN 76 AND 96) AND EXISTS (SELECT 1 FROM catalog_sales cs JOIN item ics ON cs.cs_item_sk = ics.i_item_sk JOIN date_dim d2 ON cs.cs_sold_date_sk = d2.d_date_sk WHERE d2.d_year BETWEEN 1999 AND 1999 + 2 AND ics.i_brand_id = i.i_brand_id AND ics.i_class_id = i.i_class_id AND ics.i_category_id = i.i_category_id AND ics.i_category IN ('Electronics', 'Shoes', 'Sports') AND ics.i_manager_id BETWEEN 42 AND 51 AND cs.cs_wholesale_cost BETWEEN 76 AND 96) AND EXISTS (SELECT 1 FROM web_sales ws JOIN item iws ON ws.ws_item_sk = iws.i_item_sk JOIN date_dim d3 ON ws.ws_sold_date_sk = d3.d_date_sk WHERE d3.d_year BETWEEN 1999 AND 1999 + 2 AND iws.i_brand_id = i.i_brand_id AND iws.i_class_id = i.i_class_id AND iws.i_category_id = i.i_category_id AND iws.i_category IN ('Electronics', 'Shoes', 'Sports') AND iws.i_manager_id BETWEEN 42 AND 51 AND ws.ws_wholesale_cost BETWEEN 76 AND 96)), avg_sales AS (SELECT AVG(quantity * list_price) AS average_sales FROM (SELECT ss_quantity AS quantity, ss_list_price AS list_price FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2 AND ss_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT cs_quantity AS quantity, cs_list_price AS list_price FROM catalog_sales, date_dim WHERE cs_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2 AND cs_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT ws_quantity AS quantity, ws_list_price AS list_price FROM web_sales, date_dim WHERE ws_sold_date_sk = d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96 AND d_year BETWEEN 1999 AND 1999 + 2) AS x) SELECT this_year.channel AS ty_channel, this_year.i_brand_id AS ty_brand, this_year.i_class_id AS ty_class, this_year.i_category_id AS ty_category, this_year.sales AS ty_sales, this_year.number_sales AS ty_number_sales, last_year.channel AS ly_channel, last_year.i_brand_id AS ly_brand, last_year.i_class_id AS ly_class, last_year.i_category_id AS ly_category, last_year.sales AS ly_sales, last_year.number_sales AS ly_number_sales FROM (SELECT 'store' AS channel, i.i_brand_id, i.i_class_id, i.i_category_id, SUM(ss.ss_quantity * ss.ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE ss.ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND d.d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 + 1 AND d_moy = 12 AND d_dom = 12) AND i.i_category IN ('Electronics', 'Shoes', 'Sports') AND i.i_manager_id BETWEEN 42 AND 51 AND ss.ss_wholesale_cost BETWEEN 76 AND 96 GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id HAVING SUM(ss.ss_quantity * ss.ss_list_price) > (SELECT average_sales FROM avg_sales)) this_year JOIN (SELECT 'store' AS channel, i.i_brand_id, i.i_class_id, i.i_category_id, SUM(ss.ss_quantity * ss.ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE ss.ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND d.d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 AND d_moy = 12 AND d_dom = 12) AND i.i_category IN ('Electronics', 'Shoes', 'Sports') AND ss.ss_wholesale_cost BETWEEN 76 AND 96 AND i.i_manager_id BETWEEN 42 AND 51 GROUP BY i.i_brand_id, i.i_class_id, i.i_category_id HAVING SUM(ss.ss_quantity * ss.ss_list_price) > (SELECT average_sales FROM avg_sales)) last_year ON this_year.i_brand_id = last_year.i_brand_id AND this_year.i_class_id = last_year.i_class_id AND this_year.i_category_id = last_year.i_category_id ORDER BY this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p02",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 17.65,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": null,
      "original_ms": 300000.0,
      "patch_ms": 16995.9,
      "output_sql": "WITH filtered_date_dim AS (SELECT d_date_sk FROM date_dim WHERE d_year BETWEEN 1999 AND 1999 + 2), filtered_item AS (SELECT i_item_sk, i_brand_id, i_class_id, i_category_id FROM item WHERE i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51), avg_sales AS (WITH filtered_date_dim AS (SELECT d_date_sk FROM date_dim WHERE d_year BETWEEN 1999 AND 1999 + 2) SELECT avg(quantity * list_price) average_sales FROM (SELECT ss_quantity quantity, ss_list_price list_price FROM store_sales, filtered_date_dim WHERE ss_sold_date_sk = d_date_sk AND ss_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT cs_quantity quantity, cs_list_price list_price FROM catalog_sales, filtered_date_dim WHERE cs_sold_date_sk = d_date_sk AND cs_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT ws_quantity quantity, ws_list_price list_price FROM web_sales, filtered_date_dim WHERE ws_sold_date_sk = d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96) x), cross_items AS (WITH filtered_date_dim AS (SELECT d_date_sk FROM date_dim WHERE d_year BETWEEN 1999 AND 1999 + 2), filtered_item AS (SELECT i_item_sk, i_brand_id, i_class_id, i_category_id FROM item WHERE i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51) SELECT i.i_item_sk AS ss_item_sk FROM filtered_item i, (SELECT iss.i_brand_id brand_id, iss.i_class_id class_id, iss.i_category_id category_id FROM store_sales, filtered_item iss, filtered_date_dim d1 WHERE ss_item_sk = iss.i_item_sk AND ss_sold_date_sk = d1.d_date_sk AND ss_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT ics.i_brand_id, ics.i_class_id, ics.i_category_id FROM catalog_sales, filtered_item ics, filtered_date_dim d2 WHERE cs_item_sk = ics.i_item_sk AND cs_sold_date_sk = d2.d_date_sk AND cs_wholesale_cost BETWEEN 76 AND 96 INTERSECT SELECT iws.i_brand_id, iws.i_class_id, iws.i_category_id FROM web_sales, filtered_item iws, filtered_date_dim d3 WHERE ws_item_sk = iws.i_item_sk AND ws_sold_date_sk = d3.d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96) x WHERE i.i_brand_id = x.brand_id AND i.i_class_id = x.class_id AND i.i_category_id = x.category_id) SELECT this_year.channel AS ty_channel, this_year.i_brand_id AS ty_brand, this_year.i_class_id AS ty_class, this_year.i_category_id AS ty_category, this_year.sales AS ty_sales, this_year.number_sales AS ty_number_sales, last_year.channel AS ly_channel, last_year.i_brand_id AS ly_brand, last_year.i_class_id AS ly_class, last_year.i_category_id AS ly_category, last_year.sales AS ly_sales, last_year.number_sales AS ly_number_sales FROM (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 + 1 AND d_moy = 12 AND d_dom = 12) AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND ss_wholesale_cost BETWEEN 76 AND 96 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)) AS this_year, (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 AND d_moy = 12 AND d_dom = 12) AND i_category IN ('Electronics', 'Shoes', 'Sports') AND ss_wholesale_cost BETWEEN 76 AND 96 AND i_manager_id BETWEEN 42 AND 51 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)) AS last_year WHERE this_year.i_brand_id = last_year.i_brand_id AND this_year.i_class_id = last_year.i_class_id AND this_year.i_category_id = last_year.i_category_id ORDER BY this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 84.54,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": null,
      "original_ms": 300000.0,
      "patch_ms": 3548.5,
      "output_sql": "WITH avg_sales AS (SELECT AVG(quantity * list_price) AS average_sales FROM (SELECT ss_quantity AS quantity, ss_list_price AS list_price FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2 AND ss_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT cs_quantity AS quantity, cs_list_price AS list_price FROM catalog_sales, date_dim WHERE cs_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2 AND cs_wholesale_cost BETWEEN 76 AND 96 UNION ALL SELECT ws_quantity AS quantity, ws_list_price AS list_price FROM web_sales, date_dim WHERE ws_sold_date_sk = d_date_sk AND ws_wholesale_cost BETWEEN 76 AND 96 AND d_year BETWEEN 1999 AND 1999 + 2) AS x), cross_items AS (WITH date_filter AS (SELECT d_date_sk FROM date_dim WHERE d_year BETWEEN 1999 AND 1999 + 2), channel_store AS (SELECT iss.i_item_sk, iss.i_brand_id, iss.i_class_id, iss.i_category_id FROM store_sales ss JOIN item iss ON ss.ss_item_sk = iss.i_item_sk JOIN date_filter df ON ss.ss_sold_date_sk = df.d_date_sk WHERE iss.i_category IN ('Electronics', 'Shoes', 'Sports') AND iss.i_manager_id BETWEEN 42 AND 51 AND ss.ss_wholesale_cost BETWEEN 76 AND 96), channel_catalog AS (SELECT ics.i_item_sk, ics.i_brand_id, ics.i_class_id, ics.i_category_id FROM catalog_sales cs JOIN item ics ON cs.cs_item_sk = ics.i_item_sk JOIN date_filter df ON cs.cs_sold_date_sk = df.d_date_sk WHERE ics.i_category IN ('Electronics', 'Shoes', 'Sports') AND ics.i_manager_id BETWEEN 42 AND 51 AND cs.cs_wholesale_cost BETWEEN 76 AND 96), channel_web AS (SELECT iws.i_item_sk, iws.i_brand_id, iws.i_class_id, iws.i_category_id FROM web_sales ws JOIN item iws ON ws.ws_item_sk = iws.i_item_sk JOIN date_filter df ON ws.ws_sold_date_sk = df.d_date_sk WHERE iws.i_category IN ('Electronics', 'Shoes', 'Sports') AND iws.i_manager_id BETWEEN 42 AND 51 AND ws.ws_wholesale_cost BETWEEN 76 AND 96) SELECT i.i_item_sk AS ss_item_sk FROM item i WHERE i.i_category IN ('Electronics', 'Shoes', 'Sports') AND i.i_manager_id BETWEEN 42 AND 51 AND EXISTS (SELECT 1 FROM channel_store cs WHERE cs.i_brand_id = i.i_brand_id AND cs.i_class_id = i.i_class_id AND cs.i_category_id = i.i_category_id) AND EXISTS (SELECT 1 FROM channel_catalog cc WHERE cc.i_brand_id = i.i_brand_id AND cc.i_class_id = i.i_class_id AND cc.i_category_id = i.i_category_id) AND EXISTS (SELECT 1 FROM channel_web cw WHERE cw.i_brand_id = i.i_brand_id AND cw.i_class_id = i.i_class_id AND cw.i_category_id = i.i_category_id)) SELECT this_year.channel AS ty_channel, this_year.i_brand_id AS ty_brand, this_year.i_class_id AS ty_class, this_year.i_category_id AS ty_category, this_year.sales AS ty_sales, this_year.number_sales AS ty_number_sales, last_year.channel AS ly_channel, last_year.i_brand_id AS ly_brand, last_year.i_class_id AS ly_class, last_year.i_category_id AS ly_category, last_year.sales AS ly_sales, last_year.number_sales AS ly_number_sales FROM (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 + 1 AND d_moy = 12 AND d_dom = 12) AND i_category IN ('Electronics', 'Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 51 AND ss_wholesale_cost BETWEEN 76 AND 96 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)) AS this_year, (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM store_sales, item, date_dim WHERE ss_item_sk IN (SELECT ss_item_sk FROM cross_items) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_year = 1999 AND d_moy = 12 AND d_dom = 12) AND i_category IN ('Electronics', 'Shoes', 'Sports') AND ss_wholesale_cost BETWEEN 76 AND 96 AND i_manager_id BETWEEN 42 AND 51 GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales)) AS last_year WHERE this_year.i_brand_id = last_year.i_brand_id AND this_year.i_class_id = last_year.i_class_id AND this_year.i_category_id = last_year.i_category_id ORDER BY this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id LIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p11": "Limit  (cost=4797689.55..4797689.55 rows=1 width=168) (actual time=16915.598..16915.975 rows=55 loops=1)\n  ->  Sort  (cost=4797689.55..4797689.55 rows=1 width=168) (actual time=16915.596..16915.971 rows=55 loops=1)\n        Sort Key: ('store'::text), i.i_brand_id, i.i_class_id, i.i_category_id\n        Sort Method: quicksort  Memory: 32kB\n        ->  Nested Loop  (cost=4797689.42..4797689.54 rows=1 width=168) (actual time=16900.298..16915.949 rows=55 loops=1)\n              Join Filter: ((i.i_brand",
    "p09": "Limit  (cost=2408642.05..2408642.05 rows=1 width=168) (actual time=6607.306..6607.569 rows=100 loops=1)\n  CTE prefiltered_date_dim\n    ->  Bitmap Heap Scan on date_dim  (cost=22.86..1498.82 rows=1421 width=20) (actual time=0.033..0.183 rows=1096 loops=1)\n          Recheck Cond: ((d_year >= 1999) AND (d_year <= 2001))\n          Heap Blocks: exact=22\n          ->  Bitmap Index Scan on _dta_index_date_dim_6_661577395__k7_k9  (cost=0.00..22.50 rows=1421 width=0) (actual time=0.023..0.023 rows=1096 l",
    "p08": "Limit  (cost=1727765.22..1727765.23 rows=1 width=168) (actual time=10284.457..10284.651 rows=57 loops=1)\n  CTE cross_items\n    ->  Hash Join  (cost=1201490.94..1210410.74 rows=1 width=4) (actual time=3992.518..4015.692 rows=4735 loops=1)\n          Hash Cond: ((item_2.i_brand_id = x.brand_id) AND (item_2.i_class_id = x.class_id) AND (item_2.i_category_id = x.category_id))\n          ->  Seq Scan on item item_2  (cost=0.00..8882.50 rows=4737 width=16) (actual time=0.028..22.288 rows=4750 loops=1)\n ",
    "p07": "Limit  (cost=2399860.75..2399860.75 rows=1 width=168) (actual time=11136.184..11136.427 rows=55 loops=1)\n  CTE cross_items\n    ->  Hash Join  (cost=1201490.94..1210410.74 rows=1 width=4) (actual time=3783.931..3807.156 rows=4735 loops=1)\n          Hash Cond: ((item_2.i_brand_id = x.brand_id) AND (item_2.i_class_id = x.class_id) AND (item_2.i_category_id = x.category_id))\n          ->  Seq Scan on item item_2  (cost=0.00..8882.50 rows=4737 width=16) (actual time=0.054..22.371 rows=4750 loops=1)\n ",
    "p12": "Limit  (cost=2682897.47..2682897.48 rows=1 width=168) (actual time=4509.764..4510.431 rows=55 loops=1)\n  CTE avg_sales\n    ->  Finalize Aggregate  (cost=1187418.09..1187418.10 rows=1 width=32) (actual time=2093.430..2093.533 rows=1 loops=1)\n          ->  Gather  (cost=1187417.86..1187418.07 rows=2 width=32) (actual time=1836.486..2093.509 rows=3 loops=1)\n                Workers Planned: 2\n                Workers Launched: 2\n                ->  Partial Aggregate  (cost=1186417.86..1186417.87 rows",
    "p02": "Limit  (cost=5209410.19..5209410.19 rows=1 width=168) (actual time=21502.679..21502.750 rows=55 loops=1)\n  CTE avg_sales\n    ->  Aggregate  (cost=2317596.24..2317596.25 rows=1 width=32) (actual time=8441.617..8441.634 rows=1 loops=1)\n          CTE filtered_date_dim\n            ->  Bitmap Heap Scan on date_dim date_dim_2  (cost=22.86..1498.82 rows=1421 width=118) (actual time=0.026..0.182 rows=1096 loops=1)\n                  Recheck Cond: ((d_year >= 1999) AND (d_year <= 2001))\n                  ",
    "p01": "Limit  (cost=2082172.86..2082172.86 rows=1 width=168) (actual time=8837.529..8900.742 rows=52 loops=1)\n  CTE avg_sales\n    ->  Finalize Aggregate  (cost=1187418.09..1187418.10 rows=1 width=32) (actual time=2195.318..2195.409 rows=1 loops=1)\n          ->  Gather  (cost=1187417.86..1187418.07 rows=2 width=32) (actual time=1912.780..2195.391 rows=3 loops=1)\n                Workers Planned: 2\n                Workers Launched: 2\n                ->  Partial Aggregate  (cost=1186417.86..1186417.87 rows",
    "p05": "Limit  (cost=2405250.64..2405250.64 rows=1 width=168) (actual time=11302.046..11302.277 rows=76 loops=1)\n  CTE cross_items\n    ->  Hash Join  (cost=1201490.94..1210410.74 rows=1 width=4) (actual time=3946.015..3968.882 rows=4735 loops=1)\n          Hash Cond: ((item_2.i_brand_id = x.brand_id) AND (item_2.i_class_id = x.class_id) AND (item_2.i_category_id = x.category_id))\n          ->  Seq Scan on item item_2  (cost=0.00..8882.50 rows=4737 width=16) (actual time=0.026..21.996 rows=4750 loops=1)\n ",
    "compile_p01": "Limit  (cost=2434521.25..2434521.25 rows=1 width=168) (actual time=3767.866..3768.833 rows=55 loops=1)\n  CTE cross_items\n    ->  Gather  (cost=1209415.04..1232393.86 rows=4632 width=4) (actual time=1875.174..1883.063 rows=4735 loops=1)\n          Workers Planned: 2\n          Workers Launched: 2\n          ->  Parallel Hash Semi Join  (cost=1208415.04..1230930.66 rows=1930 width=4) (actual time=1871.684..1878.808 rows=1578 loops=3)\n                Hash Cond: ((iss.i_brand_id = iws.i_brand_id) AND (",
    "compile_p02": "Limit  (cost=5206501.97..5206501.98 rows=1 width=168) (actual time=18296.167..18296.214 rows=55 loops=1)\n  CTE avg_sales\n    ->  Aggregate  (cost=2316142.13..2316142.14 rows=1 width=32) (actual time=7275.728..7275.738 rows=1 loops=1)\n          CTE filtered_date_dim\n            ->  Index Only Scan using _dta_index_date_dim_6_661577395__k7_k1 on date_dim date_dim_2  (cost=0.29..44.71 rows=1421 width=4) (actual time=0.011..0.122 rows=1096 loops=1)\n                  Index Cond: ((d_year >= 1999) AND",
    "compile_p1": "Limit  (cost=2682897.47..2682897.48 rows=1 width=168) (actual time=3890.664..3891.193 rows=55 loops=1)\n  CTE avg_sales\n    ->  Finalize Aggregate  (cost=1187418.09..1187418.10 rows=1 width=32) (actual time=1834.516..1834.576 rows=1 loops=1)\n          ->  Gather  (cost=1187417.86..1187418.07 rows=2 width=32) (actual time=1569.314..1834.560 rows=3 loops=1)\n                Workers Planned: 2\n                Workers Launched: 2\n                ->  Partial Aggregate  (cost=1186417.86..1186417.87 rows"
  }
}