{
  "probe_id": "p01",
  "transform_id": "or_to_union",
  "family": "D",
  "dialect": "postgres",
  "hypothesis": "Splitting the OR condition on different columns into UNION ALL branches may enable index-based access paths per branch, avoiding a bitmap or sequential scan on item.",
  "reasoning_trace": [
    "OR condition spans i_manufact_id (range) and i_category (list), which may block efficient index usage",
    "UNION ALL allows each branch to use targeted index scans: one for i_manufact_id, one for i_category",
    "Subquery correlation remains intact as filters are preserved structurally"
  ],
  "target_ir": "Two-branch UNION ALL in place of OR; each branch joins web_sales/item/date_dim with focused WHERE; outer query unchanged",
  "steps": [
    {
      "step_id": "s1",
      "op": "replace_body",
      "target": {"by_node_id": "S0"},
      "payload": {
        "sql_fragment": "(SELECT sum(ws_ext_discount_amt) AS \"Excess Discount Amount\" FROM web_sales, item, date_dim WHERE i_manufact_id BETWEEN 797 AND 996 AND i_item_sk = ws_item_sk AND d_date BETWEEN '1999-01-29' AND cast('1999-01-29' as date) + interval '90 day' AND d_date_sk = ws_sold_date_sk AND ws_wholesale_cost BETWEEN 35 AND 55 AND ws_ext_discount_amt > (SELECT 1.3 * avg(ws_ext_discount_amt) FROM web_sales, date_dim WHERE ws_item_sk = i_item_sk AND d_date BETWEEN '1999-01-29' AND cast('1999-01-29' as date) + interval '90 day' AND d_date_sk = ws_sold_date_sk AND ws_wholesale_cost BETWEEN 35 AND 55 AND ws_sales_price / ws_list_price BETWEEN 76 * 0.01 AND 91 * 0.01)) UNION ALL (SELECT sum(ws_ext_discount_amt) AS \"Excess Discount Amount\" FROM web_sales, item, date_dim WHERE i_category IN ('Men', 'Shoes', 'Sports') AND i_item_sk = ws_item_sk AND d_date BETWEEN '1999-01-29' AND cast('1999-01-29' as date) + interval '90 day' AND d_date_sk = ws_sold_date_sk AND ws_wholesale_cost BETWEEN 35 AND 55 AND ws_ext_discount_amt > (SELECT 1.3 * avg(ws_ext_discount_amt) FROM web_sales, date_dim WHERE ws_item_sk = i_item_sk AND d_date BETWEEN '1999-01-29' AND cast('1999-01-29' as date) + interval '90 day' AND d_date_sk = ws_sold_date_sk AND ws_wholesale_cost BETWEEN 35 AND 55 AND ws_sales_price / ws_list_price BETWEEN 76 * 0.01 AND 91 * 0.01))"
      }
    }
  ]
}