```json
[
  {
    "plan_id": "compile_p1",
    "dialect": "postgres",
    "confidence": 0.92,
    "based_on": "p02,p01",
    "strategy": "Decorrelation by precomputing state averages and converting comma joins to explicit INNER JOINs.",
    "hypothesis": "Winning probes p02 (274x) and p01 (190x) show decorrelation of the correlated scalar subquery eliminates the primary hotspot. The simplified decorrelation shape from p02 is chosen for clarity and performance, with explicit join syntax to aid optimizer.",
    "expected_explain_delta": "Correlated SubPlan 2 disappears; Nested Loop with CTE scan filter becomes a Hash Join with precomputed state averages; overall cost drops significantly.",
    "target_ir": "Add avg_state_return node, update customer_total_return and final_select with explicit joins.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["customer_total_return", "avg_state_return", "customer", "customer_address"],
          "outputs": ["c_customer_id", "c_salutation", "c_first_name", "c_last_name", "ca_street_number", "ca_street_name", "ca_street_type", "ca_suite_number", "ca_city", "ca_county", "ca_state", "ca_zip", "ca_country", "ca_gmt_offset", "ca_location_type", "ctr_total_return"],
          "changed": true,
          "sql": "SELECT c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr1.ctr_total_return FROM customer_total_return ctr1 JOIN avg_state_return avg ON ctr1.ctr_state = avg.ctr_state JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ctr1.ctr_total_return > avg.avg_ctr_total_return AND ca_state = 'OH' ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr1.ctr_total_return LIMIT 100"
        },
        {
          "node_id": "avg_state_return",
          "parent_node_id": "final_select",
          "sources": ["customer_total_return"],
          "outputs": ["ctr_state", "avg_ctr_total_return"],
          "changed": true,
          "sql": "SELECT ctr_state, AVG(ctr_total_return) * 1.2 AS avg_ctr_total_return FROM customer_total_return GROUP BY ctr_state"
        },
        {
          "node_id": "customer_total_return",
          "parent_node_id": "final_select",
          "sources": ["catalog_returns", "date_dim", "customer_address"],
          "outputs": ["ctr_customer_sk", "ctr_state", "ctr_total_return"],
          "changed": true,
          "sql": "SELECT cr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, SUM(cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns INNER JOIN date_dim ON cr_returned_date_sk = d_date_sk INNER JOIN customer_address ON cr_returning_addr_sk = ca_address_sk WHERE d_year = 2002 GROUP BY cr_returning_customer_sk, ca_state"
        }
      ]
    }
  },
  {
    "plan_id": "compile_p2",
    "dialect": "postgres",
    "confidence": 0.87,
    "based_on": "p01,p02",
    "strategy": "Decorrelation with staged filtering and materialized CTEs to further reduce initial scan volume.",
    "hypothesis": "Alternative decorrelation pathway using filtered base tables before aggregation, inspired by p01's nested CTEs. This may reduce rows fed into the aggregate by pre-joining filtered date_dim early.",
    "expected_explain_delta": "Correlated subquery removed; initial catalog_returns scan filtered by date_dim via hash join; state average computed from preâ€‘filtered CTE.",
    "target_ir": "Add date_dim_filtered and catalog_returns_filtered nodes, update customer_total_return and final_select accordingly.",
    "tree": {
      "root_node_id": "final_select",
      "nodes": [
        {
          "node_id": "final_select",
          "parent_node_id": null,
          "sources": ["customer_total_return", "state_avg", "customer", "customer_address"],
          "outputs": ["c_customer_id", "c_salutation", "c_first_name", "c_last_name", "ca_street_number", "ca_street_name", "ca_street_type", "ca_suite_number", "ca_city", "ca_county", "ca_state", "ca_zip", "ca_country", "ca_gmt_offset", "ca_location_type", "ctr_total_return"],
          "changed": true,
          "sql": "SELECT c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr1.ctr_total_return FROM customer_total_return ctr1 JOIN state_avg sa ON ctr1.ctr_state = sa.ctr_state JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ctr1.ctr_total_return > sa.threshold AND ca_state = 'OH' ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr1.ctr_total_return LIMIT 100"
        },
        {
          "node_id": "state_avg",
          "parent_node_id": "final_select",
          "sources": ["customer_total_return"],
          "outputs": ["ctr_state", "threshold"],
          "changed": true,
          "sql": "SELECT ctr_state, AVG(ctr_total_return) * 1.2 AS threshold FROM customer_total_return GROUP BY ctr_state"
        },
        {
          "node_id": "customer_total_return",
          "parent_node_id": "final_select",
          "sources": ["catalog_returns_filtered", "customer_address"],
          "outputs": ["ctr_customer_sk", "ctr_state", "ctr_total_return"],
          "changed": true,
          "sql": "SELECT crf.cr_returning_customer_sk AS ctr_customer_sk, ca.ca_state AS ctr_state, SUM(crf.cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns_filtered crf INNER JOIN customer_address ca ON crf.cr_returning_addr_sk = ca.ca_address_sk GROUP BY crf.cr_returning_customer_sk, ca.ca_state"
        },
        {
          "node_id": "catalog_returns_filtered",
          "parent_node_id": "customer_total_return",
          "sources": ["catalog_returns", "date_dim_filtered"],
          "outputs": ["cr_returning_customer_sk", "cr_returning_addr_sk", "cr_return_amt_inc_tax"],
          "changed": true,
          "sql": "SELECT cr_returning_customer_sk, cr_returning_addr_sk, cr_return_amt_inc_tax FROM catalog_returns WHERE cr_returned_date_sk IN (SELECT d_date_sk FROM date_dim_filtered)"
        },
        {
          "node_id": "date_dim_filtered",
          "parent_node_id": "catalog_returns_filtered",
          "sources": ["date_dim"],
          "outputs": ["d_date_sk"],
          "changed": true,
          "sql": "SELECT d_date_sk FROM date_dim WHERE d_year = 2002"
        }
      ]
    }
  }
]
```