{
  "iteration": 0,
  "n_api_calls": 3,
  "beam_cost_usd": 0.01368249,
  "beam_cost_priced_calls": 2,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 37087,
    "completion_tokens": 9923,
    "total_tokens": 47010,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 0,
    "reasoning_tokens": 6128
  },
  "best_speedup": 307.77,
  "best_patch_id": "compile_p1",
  "best_sql": "WITH customer_total_return AS (SELECT cr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, SUM(cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns INNER JOIN date_dim ON cr_returned_date_sk = d_date_sk INNER JOIN customer_address ON cr_returning_addr_sk = ca_address_sk WHERE d_year = 2002 GROUP BY cr_returning_customer_sk, ca_state), avg_state_return AS (SELECT ctr_state, AVG(ctr_total_return) AS avg_ctr_total_return FROM customer_total_return GROUP BY ctr_state) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return FROM customer_total_return ctr1 JOIN avg_state_return avg ON ctr1.ctr_state = avg.ctr_state JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ctr1.ctr_total_return > avg.avg_ctr_total_return * 1.2 AND ca_state = 'OH' ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return LIMIT 100;",
  "patches": [
    {
      "patch_id": "p10",
      "family": "A",
      "transform": "prefetch_fact_join",
      "relevance_score": 0.48,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "correctness_verified": false,
      "error": "Retry failed: Missing `tree` object",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Build a CTE chain: first filter date_dim, pre-join with catalog_returns, then join customer_address, exploring staged reduction."
    },
    {
      "patch_id": "p03",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.65,
      "status": "ERROR",
      "speedup": 0.0,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": "canceling statement due to statement timeout\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH customer_total_return AS (SELECT cr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, SUM(cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns INNER JOIN date_dim ON cr_returned_date_sk = d_date_sk INNER JOIN customer_address ON cr_returning_addr_sk = ca_address_sk WHERE d_year = 2002 GROUP BY cr_returning_customer_sk, ca_state) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return FROM customer_total_return ctr1 INNER JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk INNER JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ctr1.ctr_total_return > (SELECT AVG(ctr_total_return) * 1.2 FROM customer_total_return ctr2 WHERE ctr1.ctr_state = ctr2.ctr_state) AND ca_state = 'OH' ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Convert comma-separated joins in CTE and final SELECT to explicit INNER JOIN syntax to improve optimizer planning."
    },
    {
      "patch_id": "p02",
      "family": "B",
      "transform": "early_filter_decorrelate",
      "relevance_score": 0.85,
      "status": "WIN",
      "speedup": 274.45,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": null,
      "original_ms": 300000.0,
      "patch_ms": 1093.1,
      "output_sql": "WITH customer_total_return AS (SELECT cr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, SUM(cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns, date_dim, customer_address WHERE cr_returned_date_sk = d_date_sk AND d_year = 2002 AND cr_returning_addr_sk = ca_address_sk GROUP BY cr_returning_customer_sk, ca_state), avg_state_return AS (SELECT ctr_state, AVG(ctr_total_return) AS avg_ctr_total_return FROM customer_total_return GROUP BY ctr_state) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return FROM customer_total_return ctr1 JOIN avg_state_return avg ON ctr1.ctr_state = avg.ctr_state JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ctr1.ctr_total_return > avg.avg_ctr_total_return * 1.2 AND ca_state = 'OH' ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Push dimension filters (date_dim d_year=2002) into CTE definitions and decorrelate subquery by pre-computing state averages with early filtering."
    },
    {
      "patch_id": "p09",
      "family": "A",
      "transform": "multi_dimension_prefetch",
      "relevance_score": 0.5,
      "status": "ERROR",
      "speedup": 0.0,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": "missing FROM-clause entry for table \"c\"\nLINE 1: ...ustomer_address_filtered ca ON ca.ca_address_sk = c.c_curren...\n                                                             ^\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH date_dim_filtered AS (SELECT d_date_sk, d_year FROM date_dim WHERE d_year = 2002), customer_address_filtered AS (SELECT ca_address_sk, ca_state, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_zip, ca_country, ca_gmt_offset, ca_location_type FROM customer_address WHERE ca_state = 'OH'), customer_total_return AS (SELECT cr.cr_returning_customer_sk AS ctr_customer_sk, ca.ca_state AS ctr_state, SUM(cr.cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns cr JOIN date_dim_filtered d ON cr.cr_returned_date_sk = d.d_date_sk JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk GROUP BY cr.cr_returning_customer_sk, ca.ca_state) SELECT c.c_customer_id, c.c_salutation, c.c_first_name, c.c_last_name, ca.ca_street_number, ca.ca_street_name, ca.ca_street_type, ca.ca_suite_number, ca.ca_city, ca.ca_county, ca.ca_state, ca.ca_zip, ca.ca_country, ca.ca_gmt_offset, ca.ca_location_type, ctr.ctr_total_return FROM customer_total_return ctr JOIN customer_address_filtered ca ON ca.ca_address_sk = c.c_current_addr_sk JOIN customer c ON ctr.ctr_customer_sk = c.c_customer_sk WHERE ctr.ctr_total_return > (SELECT AVG(ctr2.ctr_total_return) * 1.2 FROM customer_total_return ctr2 WHERE ctr2.ctr_state = ctr.ctr_state) AND ca.ca_state = 'OH' ORDER BY c.c_customer_id, c.c_salutation, c.c_first_name, c.c_last_name, ca.ca_street_number, ca.ca_street_name, ca.ca_street_type, ca.ca_suite_number, ca.ca_city, ca.ca_county, ca.ca_state, ca.ca_zip, ca.ca_country, ca.ca_gmt_offset, ca.ca_location_type, ctr.ctr_total_return LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre-filter all selective dimensions (date_dim d_year=2002 and customer_address with ca_state='OH' where safe) into CTEs before fact table join, exploring early filtering."
    },
    {
      "patch_id": "p01",
      "family": "B",
      "transform": "inline_decorrelate_materialized",
      "relevance_score": 0.92,
      "status": "WIN",
      "speedup": 190.94,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": null,
      "original_ms": 300000.0,
      "patch_ms": 1571.2,
      "output_sql": "WITH customer_total_return AS (WITH date_dim_filtered AS MATERIALIZED (SELECT d_date_sk FROM date_dim WHERE d_year = 2002), catalog_returns_filtered AS MATERIALIZED (SELECT cr_returning_customer_sk, cr_returning_addr_sk, cr_return_amt_inc_tax FROM catalog_returns WHERE cr_returned_date_sk IN (SELECT d_date_sk FROM date_dim_filtered)), customer_total_return AS MATERIALIZED (SELECT cr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, SUM(cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns_filtered, customer_address WHERE cr_returning_addr_sk = ca_address_sk GROUP BY cr_returning_customer_sk, ca_state) SELECT * FROM customer_total_return), state_avg_threshold AS (WITH state_avg AS (SELECT ctr_state, AVG(ctr_total_return) AS avg_return FROM customer_total_return GROUP BY ctr_state) SELECT ctr_state, avg_return * 1.2 AS threshold FROM state_avg) SELECT c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset,ca_location_type,ctr_total_return FROM customer_total_return ctr1 JOIN state_avg_threshold sat ON ctr1.ctr_state = sat.ctr_state JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ctr1.ctr_total_return > sat.threshold AND ca_state = 'OH' ORDER BY c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset,ca_location_type,ctr_total_return LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Decompose correlated scalar subquery into 3 MATERIALIZED CTEs: pre-filter date_dim, pre-filter catalog_returns, compute per-state average threshold, then join in final query to replace SubPlan 2."
    },
    {
      "patch_id": "p06",
      "family": "C",
      "transform": "single_pass_aggregation",
      "relevance_score": 0.4,
      "status": "ERROR",
      "speedup": 0.0,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": "column \"c_current_addr_sk\" does not exist\nLINE 1: ...tr_state JOIN customer_address ON ca_address_sk = c_current_...\n                                                             ^\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH customer_total_return AS (SELECT cr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, SUM(cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns, date_dim, customer_address WHERE cr_returned_date_sk = d_date_sk AND d_year = 2002 AND cr_returning_addr_sk = ca_address_sk GROUP BY cr_returning_customer_sk, ca_state), state_avg_cte AS (SELECT ctr_state, AVG(ctr_total_return) AS avg_ctr_total_return FROM customer_total_return GROUP BY ctr_state) SELECT c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset,ca_location_type,ctr_total_return FROM customer_total_return ctr1 JOIN state_avg_cte sa ON ctr1.ctr_state = sa.ctr_state JOIN customer_address ON ca_address_sk = c_current_addr_sk JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk WHERE ctr1.ctr_total_return > sa.avg_ctr_total_return * 1.2 AND ca_state = 'OH' ORDER BY c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset,ca_location_type,ctr_total_return LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Consolidate multiple aggregate computations (if any) into a single scan of catalog_returns, but query has only one aggregate; explore for potential future extensions."
    },
    {
      "patch_id": "p07",
      "family": "E",
      "transform": "pg_self_join_decomposition",
      "relevance_score": 0.6,
      "status": "ERROR",
      "speedup": 0.0,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": "column \"c_current_addr_sk\" does not exist\nLINE 1: ...tr_state JOIN customer_address ON ca_address_sk = c_current_...\n                                                             ^\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH customer_total_return AS (SELECT cr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, SUM(cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns, date_dim, customer_address WHERE cr_returned_date_sk = d_date_sk AND d_year = 2002 AND cr_returning_addr_sk = ca_address_sk GROUP BY cr_returning_customer_sk, ca_state), avg_by_state AS (SELECT ctr_state, AVG(ctr_total_return) AS avg_return FROM customer_total_return GROUP BY ctr_state) SELECT c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset,ca_location_type,ctr_total_return FROM customer_total_return ctr1 JOIN avg_by_state ON ctr1.ctr_state = avg_by_state.ctr_state JOIN customer_address ON ca_address_sk = c_current_addr_sk JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk WHERE ctr1.ctr_total_return > avg_by_state.avg_return * 1.2 AND ca_state = 'OH' ORDER BY c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset,ca_location_type,ctr_total_return LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Materialize the CTE customer_total_return once and derive both ctr1 and ctr2 scans from it, avoiding correlated re-execution by pre-computing state averages separately."
    },
    {
      "patch_id": "p11",
      "family": "F",
      "transform": "self_join_decomposition",
      "relevance_score": 0.35,
      "status": "ERROR",
      "speedup": 0.0,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": "canceling statement due to statement timeout\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH customer_total_return AS (SELECT cr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, SUM(cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns, date_dim, customer_address WHERE cr_returned_date_sk = d_date_sk AND d_year = 2002 AND cr_returning_addr_sk = ca_address_sk GROUP BY cr_returning_customer_sk, ca_state) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return FROM customer_total_return AS ctr1, customer_address, customer WHERE ctr1.ctr_total_return > (SELECT AVG(ctr_total_return) * 1.2 FROM customer_total_return AS ctr2 WHERE ctr1.ctr_state = ctr2.ctr_state) AND ca_address_sk = c_current_addr_sk AND ca_state = 'OH' AND ctr1.ctr_customer_sk = c_customer_sk ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Split CTE customer_total_return into separate CTEs for different filter values if applicable, but query has no such self-join; explore for pattern learning."
    },
    {
      "patch_id": "p05",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.5,
      "status": "ERROR",
      "speedup": 0.0,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": "canceling statement due to statement timeout\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH customer_total_return AS (SELECT cr.cr_returning_customer_sk AS ctr_customer_sk, ca.ca_state AS ctr_state, SUM(cr.cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns cr JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk WHERE d.d_year = 2002 GROUP BY cr.cr_returning_customer_sk, ca.ca_state) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return FROM customer_total_return AS ctr1, customer_address, customer WHERE ctr1.ctr_total_return > (SELECT AVG(ctr_total_return) * 1.2 FROM customer_total_return AS ctr2 WHERE ctr1.ctr_state = ctr2.ctr_state) AND ca_address_sk = c_current_addr_sk AND ca_state = 'OH' AND ctr1.ctr_customer_sk = c_customer_sk ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre-aggregate catalog_returns by cr_returning_customer_sk and ca_state before joining with date_dim and customer_address in the CTE."
    },
    {
      "patch_id": "p08",
      "family": "E",
      "transform": "materialize_cte",
      "relevance_score": 0.45,
      "status": "ERROR",
      "speedup": 0.0,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": "canceling statement due to statement timeout\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH customer_total_return AS (with customer_total_return as materialized (select cr_returning_customer_sk as ctr_customer_sk, ca_state as ctr_state, sum(cr_return_amt_inc_tax) as ctr_total_return from catalog_returns, date_dim, customer_address where cr_returned_date_sk = d_date_sk and d_year = 2002 and cr_returning_addr_sk = ca_address_sk group by cr_returning_customer_sk, ca_state) select * from customer_total_return) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return FROM customer_total_return AS ctr1, customer_address, customer WHERE ctr1.ctr_total_return > (SELECT AVG(ctr_total_return) * 1.2 FROM customer_total_return AS ctr2 WHERE ctr1.ctr_state = ctr2.ctr_state) AND ca_address_sk = c_current_addr_sk AND ca_state = 'OH' AND ctr1.ctr_customer_sk = c_customer_sk ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Ensure CTE customer_total_return is materialized (default in PostgreSQL) and explore if explicit MATERIALIZED keyword improves performance by preventing inlining."
    },
    {
      "patch_id": "p04",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.55,
      "status": "ERROR",
      "speedup": 0.0,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": "canceling statement due to statement timeout\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH date_dim_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002), customer_address_filtered AS (SELECT ca_address_sk, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type FROM customer_address WHERE ca_state = 'OH'), customer_total_return AS (SELECT cr.cr_returning_customer_sk AS ctr_customer_sk, ca1.ca_state AS ctr_state, SUM(cr.cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns cr JOIN date_dim_filtered d ON cr.cr_returned_date_sk = d.d_date_sk JOIN customer_address ca1 ON cr.cr_returning_addr_sk = ca1.ca_address_sk GROUP BY cr.cr_returning_customer_sk, ca1.ca_state) SELECT c.c_customer_id, c.c_salutation, c.c_first_name, c.c_last_name, ca.ca_street_number, ca.ca_street_name, ca.ca_street_type, ca.ca_suite_number, ca.ca_city, ca.ca_county, ca.ca_state, ca.ca_zip, ca.ca_country, ca.ca_gmt_offset, ca.ca_location_type, ctr.ctr_total_return FROM customer_total_return ctr JOIN customer c ON ctr.ctr_customer_sk = c.c_customer_sk JOIN customer_address_filtered ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ctr.ctr_total_return > (SELECT AVG(ctr2.ctr_total_return) * 1.2 FROM customer_total_return ctr2 WHERE ctr.ctr_state = ctr2.ctr_state) ORDER BY c.c_customer_id, c.c_salutation, c.c_first_name, c.c_last_name, ca.ca_street_number, ca.ca_street_name, ca.ca_street_type, ca.ca_suite_number, ca.ca_city, ca.ca_county, ca.ca_state, ca.ca_zip, ca.ca_country, ca.ca_gmt_offset, ca.ca_location_type, ctr.ctr_total_return LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre-filter selective dimensions (date_dim d_year=2002, customer_address ca_state='OH' where safe) into CTEs before joining with fact tables, using explicit JOINs."
    },
    {
      "patch_id": "p12",
      "family": "F",
      "transform": "inner_join_conversion",
      "relevance_score": 0.3,
      "status": "ERROR",
      "speedup": 0.0,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": "canceling statement due to statement timeout\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH customer_total_return AS (SELECT cr.cr_returning_customer_sk AS ctr_customer_sk, ca.ca_state AS ctr_state, SUM(cr.cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns cr JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk WHERE d.d_year = 2002 GROUP BY cr.cr_returning_customer_sk, ca.ca_state) SELECT c.c_customer_id, c.c_salutation, c.c_first_name, c.c_last_name, ca.ca_street_number, ca.ca_street_name, ca.ca_street_type, ca.ca_suite_number, ca.ca_city, ca.ca_county, ca.ca_state, ca.ca_zip, ca.ca_country, ca.ca_gmt_offset, ca.ca_location_type, ctr1.ctr_total_return FROM customer_total_return ctr1 JOIN customer c ON ctr1.ctr_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ctr1.ctr_total_return > (SELECT AVG(ctr2.ctr_total_return) * 1.2 FROM customer_total_return ctr2 WHERE ctr1.ctr_state = ctr2.ctr_state) AND ca.ca_state = 'OH' ORDER BY c.c_customer_id, c.c_salutation, c.c_first_name, c.c_last_name, ca.ca_street_number, ca.ca_street_name, ca.ca_street_type, ca.ca_suite_number, ca.ca_city, ca.ca_county, ca.ca_state, ca.ca_zip, ca.ca_country, ca.ca_gmt_offset, ca.ca_location_type, ctr1.ctr_total_return LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Convert any implicit LEFT JOINs to INNER JOINs if semantics allow, but query uses INNER joins; explore for completeness."
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 259.2,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": null,
      "original_ms": 300000.0,
      "patch_ms": 1157.4,
      "output_sql": "WITH customer_total_return AS (SELECT cr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, SUM(cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns INNER JOIN date_dim ON cr_returned_date_sk = d_date_sk INNER JOIN customer_address ON cr_returning_addr_sk = ca_address_sk WHERE d_year = 2002 GROUP BY cr_returning_customer_sk, ca_state), avg_state_return AS (SELECT ctr_state, AVG(ctr_total_return) * 1.2 AS avg_ctr_total_return FROM customer_total_return GROUP BY ctr_state) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr1.ctr_total_return FROM customer_total_return ctr1 JOIN avg_state_return avg ON ctr1.ctr_state = avg.ctr_state JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ctr1.ctr_total_return > avg.avg_ctr_total_return AND ca_state = 'OH' ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr1.ctr_total_return LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p2",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 298.31,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": null,
      "original_ms": 300000.0,
      "patch_ms": 1005.7,
      "output_sql": "WITH date_dim_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002), catalog_returns_filtered AS (SELECT cr_returning_customer_sk, cr_returning_addr_sk, cr_return_amt_inc_tax FROM catalog_returns WHERE cr_returned_date_sk IN (SELECT d_date_sk FROM date_dim_filtered)), customer_total_return AS (SELECT crf.cr_returning_customer_sk AS ctr_customer_sk, ca.ca_state AS ctr_state, SUM(crf.cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns_filtered crf INNER JOIN customer_address ca ON crf.cr_returning_addr_sk = ca.ca_address_sk GROUP BY crf.cr_returning_customer_sk, ca.ca_state), state_avg AS (SELECT ctr_state, AVG(ctr_total_return) * 1.2 AS threshold FROM customer_total_return GROUP BY ctr_state) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr1.ctr_total_return FROM customer_total_return ctr1 JOIN state_avg sa ON ctr1.ctr_state = sa.ctr_state JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ctr1.ctr_total_return > sa.threshold AND ca_state = 'OH' ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr1.ctr_total_return LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 307.77,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": null,
      "original_ms": 300000.0,
      "patch_ms": 974.8,
      "output_sql": "WITH customer_total_return AS (SELECT cr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, SUM(cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns INNER JOIN date_dim ON cr_returned_date_sk = d_date_sk INNER JOIN customer_address ON cr_returning_addr_sk = ca_address_sk WHERE d_year = 2002 GROUP BY cr_returning_customer_sk, ca_state), avg_state_return AS (SELECT ctr_state, AVG(ctr_total_return) AS avg_ctr_total_return FROM customer_total_return GROUP BY ctr_state) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return FROM customer_total_return ctr1 JOIN avg_state_return avg ON ctr1.ctr_state = avg.ctr_state JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ctr1.ctr_total_return > avg.avg_ctr_total_return * 1.2 AND ca_state = 'OH' ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p2",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 296.75,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": null,
      "original_ms": 300000.0,
      "patch_ms": 1011.0,
      "output_sql": "WITH date_dim_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002), catalog_returns_filtered AS (SELECT cr_returning_customer_sk, cr_returning_addr_sk, cr_return_amt_inc_tax FROM catalog_returns WHERE cr_returned_date_sk IN (SELECT d_date_sk FROM date_dim_filtered)), customer_total_return AS (SELECT cr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, SUM(cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns_filtered INNER JOIN customer_address ON cr_returning_addr_sk = ca_address_sk GROUP BY cr_returning_customer_sk, ca_state), state_avg_threshold AS (SELECT ctr_state, AVG(ctr_total_return) * 1.2 AS threshold FROM customer_total_return GROUP BY ctr_state) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return FROM customer_total_return ctr1 JOIN state_avg_threshold sat ON ctr1.ctr_state = sat.ctr_state JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ctr1.ctr_total_return > sat.threshold AND ca_state = 'OH' ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return LIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p02": "Limit  (cost=76733.18..76733.43 rows=100 width=236) (actual time=1057.103..1057.187 rows=100 loops=1)\n  CTE customer_total_return\n    ->  Finalize GroupAggregate  (cost=57954.65..59468.38 rows=11977 width=39) (actual time=280.874..514.324 rows=383807 loops=1)\n          Group Key: catalog_returns.cr_returning_customer_sk, customer_address_1.ca_state\n          ->  Gather Merge  (cost=57954.65..59218.86 rows=9980 width=39) (actual time=280.867..379.769 rows=387837 loops=1)\n                Workers P",
    "p01": "Limit  (cost=119736.31..119736.56 rows=100 width=236) (actual time=1188.472..1188.491 rows=100 loops=1)\n  CTE customer_total_return\n    ->  CTE Scan on customer_total_return customer_total_return_1  (cost=103726.26..103930.26 rows=10200 width=48) (actual time=516.263..696.441 rows=383807 loops=1)\n          CTE date_dim_filtered\n            ->  Index Only Scan using _dta_index_date_dim_6_661577395__k7_k1 on date_dim  (cost=0.29..15.54 rows=414 width=4) (actual time=0.011..2.337 rows=365 loops=1)\n",
    "compile_p1": "Limit  (cost=76733.18..76733.43 rows=100 width=236) (actual time=1225.760..1225.887 rows=100 loops=1)\n  CTE customer_total_return\n    ->  Finalize GroupAggregate  (cost=57954.65..59468.38 rows=11977 width=39) (actual time=342.415..579.109 rows=383807 loops=1)\n          Group Key: catalog_returns.cr_returning_customer_sk, customer_address_1.ca_state\n          ->  Gather Merge  (cost=57954.65..59218.86 rows=9980 width=39) (actual time=342.406..444.094 rows=387776 loops=1)\n                Workers P",
    "compile_p2": "Limit  (cost=76733.63..76733.88 rows=100 width=236) (actual time=1218.887..1219.050 rows=100 loops=1)\n  CTE customer_total_return\n    ->  Finalize GroupAggregate  (cost=57954.65..59468.38 rows=11977 width=39) (actual time=378.280..613.980 rows=383807 loops=1)\n          Group Key: catalog_returns.cr_returning_customer_sk, customer_address_1.ca_state\n          ->  Gather Merge  (cost=57954.65..59218.86 rows=9980 width=39) (actual time=378.271..479.773 rows=387816 loops=1)\n                Workers P"
  }
}