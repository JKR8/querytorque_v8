{
  "iteration": 0,
  "n_api_calls": 13,
  "beam_cost_usd": 0.05425455,
  "beam_cost_priced_calls": 12,
  "beam_cost_unpriced_calls": 1,
  "beam_token_totals": {
    "prompt_tokens": 216202,
    "completion_tokens": 28454,
    "total_tokens": 244656,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 91648,
    "reasoning_tokens": 11779
  },
  "best_speedup": 1.02,
  "best_patch_id": "compile_explicit_joins",
  "best_sql": "WITH ssr AS (SELECT s_store_id AS store_id, SUM(ss_ext_sales_price) AS sales, SUM(COALESCE(sr_return_amt, 0)) AS returns, SUM(ss_net_profit - COALESCE(sr_net_loss, 0)) AS profit FROM store_sales LEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number) INNER JOIN date_dim ON ss_sold_date_sk = d_date_sk INNER JOIN store ON ss_store_sk = s_store_sk INNER JOIN item ON ss_item_sk = i_item_sk INNER JOIN promotion ON ss_promo_sk = p_promo_sk WHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 day' AND i_current_price > 50 AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND ss_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') GROUP BY s_store_id), csr AS (SELECT cp_catalog_page_id AS catalog_page_id, SUM(cs_ext_sales_price) AS sales, SUM(COALESCE(cr_return_amount, 0)) AS returns, SUM(cs_net_profit - COALESCE(cr_net_loss, 0)) AS profit FROM catalog_sales LEFT OUTER JOIN catalog_returns ON (cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number) INNER JOIN date_dim ON cs_sold_date_sk = d_date_sk INNER JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk INNER JOIN item ON cs_item_sk = i_item_sk INNER JOIN promotion ON cs_promo_sk = p_promo_sk WHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 day' AND i_current_price > 50 AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND cs_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') GROUP BY cp_catalog_page_id), wsr AS (SELECT web_site_id, SUM(ws_ext_sales_price) AS sales, SUM(COALESCE(wr_return_amt, 0)) AS returns, SUM(ws_net_profit - COALESCE(wr_net_loss, 0)) AS profit FROM web_sales LEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number) INNER JOIN date_dim ON ws_sold_date_sk = d_date_sk INNER JOIN web_site ON ws_web_site_sk = web_site_sk INNER JOIN item ON ws_item_sk = i_item_sk INNER JOIN promotion ON ws_promo_sk = p_promo_sk WHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 day' AND i_current_price > 50 AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND ws_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') GROUP BY web_site_id) SELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, returns, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, returns, profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, returns, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100;",
  "patches": [
    {
      "patch_id": "p01",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.85,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Row count: orig=6, patch=23",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH date_dim_prefetch AS (select d_date_sk\nfrom date_dim\nwhere d_date between cast('1999-10-21' as date)\n           and cast('1999-10-21' as date) + interval '30 day'), item_prefetch AS (select i_item_sk, i_current_price, i_category\nfrom item\nwhere i_current_price > 50\n  and i_category IN ('Men', 'Music')), promotion_prefetch AS (select p_promo_sk, p_channel_email, p_channel_tv, p_channel_radio, p_channel_press, p_channel_event\nfrom promotion\nwhere p_channel_email = 'Y'\n  and p_channel_tv = 'N'\n  and p_channel_radio = 'N'\n  and p_channel_press = 'N'\n  and p_channel_event = 'N'), ssr AS (select  s_store_id as store_id,\n         sum(ss_ext_sales_price) as sales,\n         sum(coalesce(sr_return_amt, 0)) as returns,\n         sum(ss_net_profit - coalesce(sr_net_loss, 0)) as profit\n from store_sales left outer join store_returns on\n        (ss_item_sk = sr_item_sk and ss_ticket_number = sr_ticket_number)\n join date_dim_prefetch on ss_sold_date_sk = d_date_sk\n join store on ss_store_sk = s_store_sk\n join item_prefetch on ss_item_sk = i_item_sk\n join promotion_prefetch on ss_promo_sk = p_promo_sk\ngroup by s_store_id), csr AS (select  cp_catalog_page_id as catalog_page_id,\n         sum(cs_ext_sales_price) as sales,\n         sum(coalesce(cr_return_amount, 0)) as returns,\n         sum(cs_net_profit - coalesce(cr_net_loss, 0)) as profit\n from catalog_sales left outer join catalog_returns on\n        (cs_item_sk = cr_item_sk and cs_order_number = cr_order_number)\n join date_dim_prefetch on cs_sold_date_sk = d_date_sk\n join catalog_page on cs_catalog_page_sk = cp_catalog_page_sk\n join item_prefetch on cs_item_sk = i_item_sk\n join promotion_prefetch on cs_promo_sk = p_promo_sk\ngroup by cp_catalog_page_id), wsr AS (select  web_site_id,\n         sum(ws_ext_sales_price) as sales,\n         sum(coalesce(wr_return_amt, 0)) as returns,\n         sum(ws_net_profit - coalesce(wr_net_loss, 0)) as profit\n from web_sales left outer join web_returns on\n        (ws_item_sk = wr_item_sk and ws_order_number = wr_order_number)\n join date_dim_prefetch on ws_sold_date_sk = d_date_sk\n join web_site on ws_web_site_sk = web_site_sk\n join item_prefetch on ws_item_sk = i_item_sk\n join promotion_prefetch on ws_promo_sk = p_promo_sk\ngroup by web_site_id) SELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, returns, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, returns, profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, returns, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Pre-filter all selective dimensions (date_dim, item, promotion) into separate CTEs with their predicates, then rewrite each channel CTE (ssr, csr, wsr) to use explicit JOIN syntax with these dimension CTEs, preserving all original filters and aggregates."
    },
    {
      "patch_id": "p02",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.75,
      "status": "REGRESSION",
      "speedup": 0.91,
      "semantic_passed": true,
      "error": null,
      "original_ms": 97.1,
      "patch_ms": 107.0,
      "output_sql": "WITH date_range AS (select d_date_sk\nfrom date_dim\nwhere d_date between cast('1999-10-21' as date)\n           and cast('1999-10-21' as date) + interval '30 day'), ssr AS (select  s_store_id as store_id,\n         sum(ss_ext_sales_price) as sales,\n         sum(coalesce(sr_return_amt, 0)) as returns,\n         sum(ss_net_profit - coalesce(sr_net_loss, 0)) as profit\n from store_sales left outer join store_returns on\n        (ss_item_sk = sr_item_sk and ss_ticket_number = sr_ticket_number)\n    JOIN date_range ON ss_sold_date_sk = date_range.d_date_sk\n    JOIN store ON ss_store_sk = s_store_sk\n    JOIN item ON ss_item_sk = i_item_sk\n    JOIN promotion ON ss_promo_sk = p_promo_sk\nwhere i_current_price > 50\n      and p_channel_email = 'Y'\n      and p_channel_tv = 'N'\n      and p_channel_radio = 'N'\n      and p_channel_press = 'N'\n      and p_channel_event = 'N'\n      and ss_wholesale_cost BETWEEN 21 AND 36\n      and i_category IN ('Men', 'Music')\ngroup by s_store_id), csr AS (select  cp_catalog_page_id as catalog_page_id,\n         sum(cs_ext_sales_price) as sales,\n         sum(coalesce(cr_return_amount, 0)) as returns,\n         sum(cs_net_profit - coalesce(cr_net_loss, 0)) as profit\n from catalog_sales left outer join catalog_returns on\n        (cs_item_sk = cr_item_sk and cs_order_number = cr_order_number)\n    JOIN date_range ON cs_sold_date_sk = date_range.d_date_sk\n    JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk\n    JOIN item ON cs_item_sk = i_item_sk\n    JOIN promotion ON cs_promo_sk = p_promo_sk\nwhere i_current_price > 50\n      and p_channel_email = 'Y'\n      and p_channel_tv = 'N'\n      and p_channel_radio = 'N'\n      and p_channel_press = 'N'\n      and p_channel_event = 'N'\n      and cs_wholesale_cost BETWEEN 21 AND 36\n      and i_category IN ('Men', 'Music')\ngroup by cp_catalog_page_id), wsr AS (select  web_site_id,\n         sum(ws_ext_sales_price) as sales,\n         sum(coalesce(wr_return_amt, 0)) as returns,\n         sum(ws_net_profit - coalesce(wr_net_loss, 0)) as profit\n from web_sales left outer join web_returns on\n        (ws_item_sk = wr_item_sk and ws_order_number = wr_order_number)\n    JOIN date_range ON ws_sold_date_sk = date_range.d_date_sk\n    JOIN web_site ON ws_web_site_sk = web_site_sk\n    JOIN item ON ws_item_sk = i_item_sk\n    JOIN promotion ON ws_promo_sk = p_promo_sk\nwhere i_current_price > 50\n      and p_channel_email = 'Y'\n      and p_channel_tv = 'N'\n      and p_channel_radio = 'N'\n      and p_channel_press = 'N'\n      and p_channel_event = 'N'\n      and ws_wholesale_cost BETWEEN 21 AND 36\n      and i_category IN ('Men', 'Music')\ngroup by web_site_id) SELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, returns, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, returns, profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, returns, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Isolate date_dim filter into a CTE for the date range, then rewrite each channel CTE to use explicit JOIN with this date CTE, keeping other dimensions in the FROM clause with explicit joins."
    },
    {
      "patch_id": "p04",
      "family": "A",
      "transform": "shared_dimension_multi_channel",
      "relevance_score": 0.5,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Execution: column \"ss_promo_sk\" does not exist\nLINE 7:   and ss_promo_sk = p_promo_sk\n              ^\nHINT:  Perhaps you meant to reference the column \"promotion.p_promo_sk\".\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH shared_dims AS (select d_date_sk, i_item_sk, p_promo_sk, p_channel_email, p_channel_tv, p_channel_radio, p_channel_press, p_channel_event\nfrom date_dim, item, promotion\nwhere d_date between cast('1999-10-21' as date)\n             and cast('1999-10-21' as date) + interval '30 day'\n  and i_current_price > 50\n  and i_category IN ('Men', 'Music')\n  and ss_promo_sk = p_promo_sk\n  and p_channel_email = 'Y'\n  and p_channel_tv = 'N'\n  and p_channel_radio = 'N'\n  and p_channel_press = 'N'\n  and p_channel_event = 'N'), ssr AS (select  s_store_id as store_id,\n         sum(ss_ext_sales_price) as sales,\n         sum(coalesce(sr_return_amt, 0)) as returns,\n         sum(ss_net_profit - coalesce(sr_net_loss, 0)) as profit\n from store_sales left outer join store_returns on\n        (ss_item_sk = sr_item_sk and ss_ticket_number = sr_ticket_number)\n    join shared_dims on ss_sold_date_sk = shared_dims.d_date_sk\n                      and ss_item_sk = shared_dims.i_item_sk\n                      and ss_promo_sk = shared_dims.p_promo_sk\n    join store on ss_store_sk = s_store_sk\nwhere ss_wholesale_cost BETWEEN 21 AND 36\n      and shared_dims.p_channel_email = 'Y'\n      and shared_dims.p_channel_tv = 'N'\n      and shared_dims.p_channel_radio = 'N'\n      and shared_dims.p_channel_press = 'N'\n      and shared_dims.p_channel_event = 'N'\ngroup by s_store_id), csr AS (select  cp_catalog_page_id as catalog_page_id,\n         sum(cs_ext_sales_price) as sales,\n         sum(coalesce(cr_return_amount, 0)) as returns,\n         sum(cs_net_profit - coalesce(cr_net_loss, 0)) as profit\n from catalog_sales left outer join catalog_returns on\n        (cs_item_sk = cr_item_sk and cs_order_number = cr_order_number)\n    join shared_dims on cs_sold_date_sk = shared_dims.d_date_sk\n                      and cs_item_sk = shared_dims.i_item_sk\n                      and cs_promo_sk = shared_dims.p_promo_sk\n    join catalog_page on cs_catalog_page_sk = cp_catalog_page_sk\nwhere cs_wholesale_cost BETWEEN 21 AND 36\n      and shared_dims.p_channel_email = 'Y'\n      and shared_dims.p_channel_tv = 'N'\n      and shared_dims.p_channel_radio = 'N'\n      and shared_dims.p_channel_press = 'N'\n      and shared_dims.p_channel_event = 'N'\ngroup by cp_catalog_page_id), wsr AS (select  web_site_id,\n         sum(ws_ext_sales_price) as sales,\n         sum(coalesce(wr_return_amt, 0)) as returns,\n         sum(ws_net_profit - coalesce(wr_net_loss, 0)) as profit\n from web_sales left outer join web_returns on\n        (ws_item_sk = wr_item_sk and ws_order_number = wr_order_number)\n    join shared_dims on ws_sold_date_sk = shared_dims.d_date_sk\n                      and ws_item_sk = shared_dims.i_item_sk\n                      and ws_promo_sk = shared_dims.p_promo_sk\n    join web_site on ws_web_site_sk = web_site_sk\nwhere ws_wholesale_cost BETWEEN 21 AND 36\n      and shared_dims.p_channel_email = 'Y'\n      and shared_dims.p_channel_tv = 'N'\n      and shared_dims.p_channel_radio = 'N'\n      and shared_dims.p_channel_press = 'N'\n      and shared_dims.p_channel_event = 'N'\ngroup by web_site_id) SELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, returns, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, returns, profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, returns, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Extract shared dimension filters (date_dim, item, promotion) into a single CTE that returns filtered surrogate keys, then reference this CTE in each channel CTE to avoid redundant dimension scans."
    },
    {
      "patch_id": "p03",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.6,
      "status": "REGRESSION",
      "speedup": 0.91,
      "semantic_passed": true,
      "error": null,
      "original_ms": 97.1,
      "patch_ms": 107.0,
      "output_sql": "WITH ssr AS (SELECT s_store_id AS store_id, SUM(ss_ext_sales_price) AS sales, SUM(COALESCE(sr_return_amt, 0)) AS returns, SUM(ss_net_profit - COALESCE(sr_net_loss, 0)) AS profit FROM store_sales LEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number), date_dim, store, item, promotion WHERE ss_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 DAY' AND ss_store_sk = s_store_sk AND ss_item_sk = i_item_sk AND i_current_price > 50 AND ss_promo_sk = p_promo_sk AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND ss_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') GROUP BY s_store_id), csr AS (SELECT cp_catalog_page_id AS catalog_page_id, SUM(cs_ext_sales_price) AS sales, SUM(COALESCE(cr_return_amount, 0)) AS returns, SUM(cs_net_profit - COALESCE(cr_net_loss, 0)) AS profit FROM catalog_sales LEFT OUTER JOIN catalog_returns ON (cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number), date_dim, catalog_page, item, promotion WHERE cs_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 DAY' AND cs_catalog_page_sk = cp_catalog_page_sk AND cs_item_sk = i_item_sk AND i_current_price > 50 AND cs_promo_sk = p_promo_sk AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND cs_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') GROUP BY cp_catalog_page_id), wsr AS (SELECT web_site_id, SUM(ws_ext_sales_price) AS sales, SUM(COALESCE(wr_return_amt, 0)) AS returns, SUM(ws_net_profit - COALESCE(wr_net_loss, 0)) AS profit FROM web_sales LEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number), date_dim, web_site, item, promotion WHERE ws_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 DAY' AND ws_web_site_sk = web_site_sk AND ws_item_sk = i_item_sk AND i_current_price > 50 AND ws_promo_sk = p_promo_sk AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND ws_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') GROUP BY web_site_id) SELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, returns, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, returns, profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, returns, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-aggregate each fact table (store_sales, catalog_sales, web_sales) on their join keys (ss_item_sk, ss_promo_sk, etc.) before joining dimensions, then adjust channel CTEs to join with these pre-aggregated fact CTEs."
    },
    {
      "patch_id": "compile_explicit_joins",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "NEUTRAL",
      "speedup": 1.02,
      "semantic_passed": true,
      "error": null,
      "original_ms": 159.0,
      "patch_ms": 155.5,
      "output_sql": "WITH ssr AS (SELECT s_store_id AS store_id, SUM(ss_ext_sales_price) AS sales, SUM(COALESCE(sr_return_amt, 0)) AS returns, SUM(ss_net_profit - COALESCE(sr_net_loss, 0)) AS profit FROM store_sales LEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number) INNER JOIN date_dim ON ss_sold_date_sk = d_date_sk INNER JOIN store ON ss_store_sk = s_store_sk INNER JOIN item ON ss_item_sk = i_item_sk INNER JOIN promotion ON ss_promo_sk = p_promo_sk WHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 day' AND i_current_price > 50 AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND ss_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') GROUP BY s_store_id), csr AS (SELECT cp_catalog_page_id AS catalog_page_id, SUM(cs_ext_sales_price) AS sales, SUM(COALESCE(cr_return_amount, 0)) AS returns, SUM(cs_net_profit - COALESCE(cr_net_loss, 0)) AS profit FROM catalog_sales LEFT OUTER JOIN catalog_returns ON (cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number) INNER JOIN date_dim ON cs_sold_date_sk = d_date_sk INNER JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk INNER JOIN item ON cs_item_sk = i_item_sk INNER JOIN promotion ON cs_promo_sk = p_promo_sk WHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 day' AND i_current_price > 50 AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND cs_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') GROUP BY cp_catalog_page_id), wsr AS (SELECT web_site_id, SUM(ws_ext_sales_price) AS sales, SUM(COALESCE(wr_return_amt, 0)) AS returns, SUM(ws_net_profit - COALESCE(wr_net_loss, 0)) AS profit FROM web_sales LEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number) INNER JOIN date_dim ON ws_sold_date_sk = d_date_sk INNER JOIN web_site ON ws_web_site_sk = web_site_sk INNER JOIN item ON ws_item_sk = i_item_sk INNER JOIN promotion ON ws_promo_sk = p_promo_sk WHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 day' AND i_current_price > 50 AND p_channel_email = 'Y' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N' AND ws_wholesale_cost BETWEEN 21 AND 36 AND i_category IN ('Men', 'Music') GROUP BY web_site_id) SELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, returns, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, returns, profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, returns, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "NEUTRAL",
      "speedup": 1.02,
      "semantic_passed": true,
      "error": null,
      "original_ms": 159.0,
      "patch_ms": 155.6,
      "output_sql": "WITH ssr AS (SELECT s_store_id AS store_id,\n       SUM(ss_ext_sales_price) AS sales,\n       SUM(COALESCE(sr_return_amt, 0)) AS returns,\n       SUM(ss_net_profit - COALESCE(sr_net_loss, 0)) AS profit\nFROM store_sales\nLEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number)\nINNER JOIN date_dim ON ss_sold_date_sk = d_date_sk\nINNER JOIN store ON ss_store_sk = s_store_sk\nINNER JOIN item ON ss_item_sk = i_item_sk\nINNER JOIN promotion ON ss_promo_sk = p_promo_sk\nWHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 DAY'\n  AND i_current_price > 50\n  AND p_channel_email = 'Y'\n  AND p_channel_tv = 'N'\n  AND p_channel_radio = 'N'\n  AND p_channel_press = 'N'\n  AND p_channel_event = 'N'\n  AND ss_wholesale_cost BETWEEN 21 AND 36\n  AND i_category IN ('Men', 'Music')\nGROUP BY s_store_id), csr AS (SELECT cp_catalog_page_id AS catalog_page_id,\n       SUM(cs_ext_sales_price) AS sales,\n       SUM(COALESCE(cr_return_amount, 0)) AS returns,\n       SUM(cs_net_profit - COALESCE(cr_net_loss, 0)) AS profit\nFROM catalog_sales\nLEFT OUTER JOIN catalog_returns ON (cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number)\nINNER JOIN date_dim ON cs_sold_date_sk = d_date_sk\nINNER JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk\nINNER JOIN item ON cs_item_sk = i_item_sk\nINNER JOIN promotion ON cs_promo_sk = p_promo_sk\nWHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 DAY'\n  AND i_current_price > 50\n  AND p_channel_email = 'Y'\n  AND p_channel_tv = 'N'\n  AND p_channel_radio = 'N'\n  AND p_channel_press = 'N'\n  AND p_channel_event = 'N'\n  AND cs_wholesale_cost BETWEEN 21 AND 36\n  AND i_category IN ('Men', 'Music')\nGROUP BY cp_catalog_page_id), wsr AS (SELECT web_site_id,\n       SUM(ws_ext_sales_price) AS sales,\n       SUM(COALESCE(wr_return_amt, 0)) AS returns,\n       SUM(ws_net_profit - COALESCE(wr_net_loss, 0)) AS profit\nFROM web_sales\nLEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number)\nINNER JOIN date_dim ON ws_sold_date_sk = d_date_sk\nINNER JOIN web_site ON ws_web_site_sk = web_site_sk\nINNER JOIN item ON ws_item_sk = i_item_sk\nINNER JOIN promotion ON ws_promo_sk = p_promo_sk\nWHERE d_date BETWEEN CAST('1999-10-21' AS DATE) AND CAST('1999-10-21' AS DATE) + INTERVAL '30 DAY'\n  AND i_current_price > 50\n  AND p_channel_email = 'Y'\n  AND p_channel_tv = 'N'\n  AND p_channel_radio = 'N'\n  AND p_channel_press = 'N'\n  AND p_channel_event = 'N'\n  AND ws_wholesale_cost BETWEEN 21 AND 36\n  AND i_category IN ('Men', 'Music')\nGROUP BY web_site_id) SELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, returns, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, returns, profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, returns, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p02": "Limit  (rows=6, time=90.833)\n  Index Scan on date_dim  (rows=31, time=1.131)\n  Aggregate  (rows=6, time=90.83)\n    Sort  (rows=3, time=90.815)\n      Append  (rows=3, time=90.793)\n        Subquery Scan (ssr)  (rows=2, time=34.172)\n          Aggregate  (rows=2, time=34.168)\n            Sort  (rows=2, time=34.154)\n              Nested Loop  (rows=2, time=34.138)\n                Nested Loop  (rows=2, time=34.105)\n                  Nested Loop  (rows=614, time=31.667)\n                    Hash Join  (",
    "p03": "Limit  (rows=6, time=104.066)\n  Aggregate  (rows=6, time=104.065)\n    Sort  (rows=3, time=104.049)\n      Append  (rows=3, time=104.029)\n        Subquery Scan (ssr)  (rows=2, time=38.843)\n          Aggregate  (rows=2, time=38.838)\n            Sort  (rows=2, time=38.824)\n              Nested Loop  (rows=2, time=38.806)\n                Nested Loop  (rows=2, time=38.783)\n                  Gather  (rows=2, time=38.746)\n                    Nested Loop  (rows=1, time=14.687)\n                      Hash ",
    "compile_explicit_joins": "Limit  (rows=6, time=182.497)\n  Aggregate  (rows=6, time=182.494)\n    Sort  (rows=3, time=182.471)\n      Append  (rows=3, time=182.445)\n        Subquery Scan (ssr)  (rows=2, time=79.376)\n          Aggregate  (rows=2, time=79.368)\n            Sort  (rows=2, time=79.348)\n              Nested Loop  (rows=2, time=79.328)\n                Nested Loop  (rows=2, time=79.278)\n                  Gather  (rows=2, time=79.194)\n                    Nested Loop  (rows=2, time=78.356)\n                      Hash ",
    "compile_p1": "Limit  (rows=6, time=199.386)\n  Aggregate  (rows=6, time=199.382)\n    Sort  (rows=3, time=199.362)\n      Append  (rows=3, time=199.337)\n        Subquery Scan (ssr)  (rows=2, time=76.954)\n          Aggregate  (rows=2, time=76.945)\n            Sort  (rows=2, time=76.921)\n              Nested Loop  (rows=2, time=76.898)\n                Nested Loop  (rows=2, time=76.824)\n                  Gather  (rows=2, time=76.696)\n                    Nested Loop  (rows=2, time=75.747)\n                      Hash "
  }
}