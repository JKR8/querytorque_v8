{
  "iteration": 1,
  "n_api_calls": 4,
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "t1",
      "family": "E+B",
      "transform": "date_materialization_then_decorrelate",
      "relevance_score": 0.95,
      "status": "REGRESSION",
      "speedup": 0.67,
      "semantic_passed": true,
      "error": null,
      "original_ms": 339.7,
      "patch_ms": 505.3,
      "output_sql": "WITH date_filter AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy BETWEEN 3 AND 3 + 2), store_sales_filtered AS (SELECT DISTINCT ss_customer_sk FROM store_sales JOIN date_filter ON ss_sold_date_sk = d_date_sk WHERE ss_list_price BETWEEN 52 AND 141), web_sales_filtered AS (SELECT DISTINCT ws_bill_customer_sk FROM web_sales JOIN date_filter ON ws_sold_date_sk = d_date_sk WHERE ws_list_price BETWEEN 52 AND 141), catalog_sales_filtered AS (SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales JOIN date_filter ON cs_sold_date_sk = d_date_sk WHERE cs_list_price BETWEEN 52 AND 141) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics AS cd ON cd_demo_sk = c.c_current_cdemo_sk LEFT JOIN store_sales_filtered AS ssf ON c.c_customer_sk = ssf.ss_customer_sk LEFT JOIN web_sales_filtered AS wsf ON c.c_customer_sk = wsf.ws_bill_customer_sk LEFT JOIN catalog_sales_filtered AS csf ON c.c_customer_sk = csf.cs_ship_customer_sk WHERE ca_state IN ('GA', 'KY', 'SD') AND cd_marital_status IN ('D', 'W', 'U') AND cd_education_status IN ('Primary', 'College') AND NOT ssf.ss_customer_sk IS NULL AND wsf.ws_bill_customer_sk IS NULL AND csf.cs_ship_customer_sk IS NULL GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "t2",
      "family": "A",
      "transform": "dimension_prefilter",
      "relevance_score": 0.9,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1 structural: LITERAL MISMATCH: Original literals missing from rewrite \u2014 numbers: ['2.0']. The rewrite changed filter values instead of preserving them.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_ca AS (SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('GA', 'KY', 'SD')), filtered_cd AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_marital_status IN ('D', 'W', 'U') AND cd_education_status IN ('Primary', 'College')) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer AS c JOIN filtered_ca ON c.c_current_addr_sk = filtered_ca.ca_address_sk JOIN filtered_cd ON c.c_current_cdemo_sk = filtered_cd.cd_demo_sk WHERE EXISTS(SELECT * FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE c.c_customer_sk = ss_customer_sk AND d_year = 1999 AND d_moy BETWEEN 3 AND 5 AND ss_list_price BETWEEN 52 AND 141) AND NOT EXISTS(SELECT * FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk WHERE c.c_customer_sk = ws_bill_customer_sk AND d_year = 1999 AND d_moy BETWEEN 3 AND 5 AND ws_list_price BETWEEN 52 AND 141) AND NOT EXISTS(SELECT * FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk WHERE c.c_customer_sk = cs_ship_customer_sk AND d_year = 1999 AND d_moy BETWEEN 3 AND 5 AND cs_list_price BETWEEN 52 AND 141) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": false
    },
    {
      "patch_id": "t3",
      "family": "E+F",
      "transform": "date_materialization_rescue+explicit_join_optimize",
      "relevance_score": 0.85,
      "status": "REGRESSION",
      "speedup": 0.75,
      "semantic_passed": true,
      "error": null,
      "original_ms": 339.7,
      "patch_ms": 455.0,
      "output_sql": "WITH date_filter AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy BETWEEN 3 AND 3 + 2) SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer_address AS ca INNER JOIN customer AS c ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN customer_demographics AS cd ON cd.cd_demo_sk = c.c_current_cdemo_sk WHERE ca_state IN ('GA', 'KY', 'SD') AND cd_marital_status IN ('D', 'W', 'U') AND cd_education_status IN ('Primary', 'College') AND EXISTS(SELECT * FROM store_sales JOIN date_filter AS df ON ss_sold_date_sk = df.d_date_sk WHERE c.c_customer_sk = ss_customer_sk AND ss_list_price BETWEEN 52 AND 141) AND (NOT EXISTS(SELECT * FROM web_sales JOIN date_filter AS df ON ws_sold_date_sk = df.d_date_sk WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_list_price BETWEEN 52 AND 141) AND NOT EXISTS(SELECT * FROM catalog_sales JOIN date_filter AS df ON cs_sold_date_sk = df.d_date_sk WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_list_price BETWEEN 52 AND 141)) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100;",
      "has_explain": true
    }
  ],
  "explains": {
    "t1": "Limit  (rows=80, time=700.314)\n  Index Only Scan on date_dim  (rows=92, time=0.154)\n  Aggregate  (rows=80, time=700.308)\n    Sort  (rows=914, time=700.205)\n      Nested Loop  (rows=914, time=699.42)\n        Hash Join  (rows=3921, time=675.207)\n          Hash Join  (rows=4201, time=528.412)\n            Hash Join  (rows=4341, time=450.01)\n              Hash Join  (rows=54247, time=121.864)\n                Seq Scan on customer (c)  (rows=500000, time=40.823)\n                Hash  (rows=27053, time=",
    "t3": "Limit  (rows=80, time=680.769)\n  Index Only Scan on date_dim  (rows=92, time=0.151)\n  Aggregate  (rows=80, time=680.76)\n    Sort  (rows=914, time=680.594)\n      Hash Join  (rows=914, time=679.465)\n        Hash Join  (rows=986, time=493.983)\n          Hash Join  (rows=1011, time=418.244)\n            Gather  (rows=13551, time=128.2)\n              Hash Join  (rows=4517, time=129.278)\n                Seq Scan on customer_demographics (cd)  (rows=109760, time=70.126)\n                Hash  (rows=18082"
  }
}