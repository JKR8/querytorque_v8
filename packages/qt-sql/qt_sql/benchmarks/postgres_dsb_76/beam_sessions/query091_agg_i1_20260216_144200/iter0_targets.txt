[
  {
    "target_id": "t1",
    "family": "A",
    "transform": "early_filtering",
    "relevance_score": 0.95,
    "hypothesis": "Sequential scan on catalog_returns (719k rows) processes unnecessary data. Dimension filters (date_dim:28 rows, call_center:24 rows) should be pushed into CTEs first to reduce fact table joins.",
    "target_ir": "S0 [SELECT]\n  CTE: filtered_date (via Q1)\n    FROM: date_dim\n    WHERE: d_year = 1998 AND d_moy = 2\n  CTE: filtered_call_center (via Q2)\n    FROM: call_center\n  CTE: filtered_demographics (via Q3)\n    FROM: customer_demographics\n    WHERE: (cd_marital_status = 'M' AND cd_education_status = 'Unknown') OR (cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree')\n  CTE: filtered_household (via Q4)\n    FROM: household_demographics\n    WHERE: hd_buy_potential LIKE '1001-5000%'\n  CTE: filtered_address (via Q5)\n    FROM: customer_address\n    WHERE: ca_gmt_offset = -7\n  MAIN QUERY (via Q0)\n    FROM: catalog_returns\n    JOIN: filtered_date ON cr_returned_date_sk = d_date_sk\n    JOIN: filtered_call_center ON cr_call_center_sk = cc_call_center_sk\n    JOIN: customer ON cr_returning_customer_sk = c_customer_sk\n    JOIN: filtered_demographics ON cd_demo_sk = c_current_cdemo_sk\n    JOIN: filtered_household ON hd_demo_sk = c_current_hdemo_sk\n    JOIN: filtered_address ON ca_address_sk = c_current_addr_sk\n    GROUP BY: cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status\n    ORDER BY: SUM(cr_net_loss) DESC",
    "recommended_examples": [
      "pg_date_cte_explicit_join"
    ]
  },
  {
    "target_id": "t2",
    "family": "C",
    "transform": "aggregation_pushdown",
    "relevance_score": 0.85,
    "hypothesis": "GROUP BY happens after 7-way join. Pre-aggregating catalog_returns after selective dimension joins reduces intermediate rows.",
    "target_ir": "S0 [SELECT]\n  CTE: pre_agg (via Q1)\n    SELECT: cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, SUM(cr_net_loss) AS loss_sum\n    FROM: catalog_returns\n    JOIN: date_dim ON cr_returned_date_sk = d_date_sk\n    JOIN: call_center ON cr_call_center_sk = cc_call_center_sk\n    JOIN: customer ON cr_returning_customer_sk = c_customer_sk\n    JOIN: customer_demographics ON cd_demo_sk = c_current_cdemo_sk\n    JOIN: household_demographics ON hd_demo_sk = c_current_hdemo_sk\n    JOIN: customer_address ON ca_address_sk = c_current_addr_sk\n    WHERE: d_year = 1998 AND d_moy = 2\n      AND ((cd_marital_status = 'M' AND cd_education_status = 'Unknown') OR (cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree'))\n      AND hd_buy_potential LIKE '1001-5000%'\n      AND ca_gmt_offset = -7\n    GROUP BY: cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status\n  MAIN QUERY (via Q0)\n    FROM: pre_agg\n    ORDER BY: loss_sum DESC",
    "recommended_examples": [
      "pg_materialized_dimension_fact_prefilter"
    ]
  }
]