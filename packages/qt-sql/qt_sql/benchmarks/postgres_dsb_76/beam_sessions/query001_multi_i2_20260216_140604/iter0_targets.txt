[
  {
    "target_id": "t1",
    "family": "B",
    "transform": "shared_scan_decorrelate",
    "relevance_score": 0.95,
    "hypothesis": "Correlated subquery re-scans customer_total_return per row of ctr1. Compute store-level averages upfront to eliminate per-row execution.",
    "target_ir": "S0 [SELECT]\n  CTE: customer_total_return  (via CTE_Q_S0_customer_total_return)\n    FROM: store_returns, date_dim\n    WHERE [70b678372a29c55c]: sr_returned_date_sk = d_date_sk AND d_year = 2000 AND sr_return_amt / sr_return_quantity BETWEEN 115 AND 174\n    GROUP BY: sr_customer_sk, sr_store_sk, sr_reason_sk\n  CTE: store_avg_return  (new)\n    FROM: customer_total_return\n    GROUP BY: ctr_store_sk\n    SELECT: ctr_store_sk, AVG(ctr_total_return) * 1.2 AS avg_return\n  MAIN QUERY (via Q_S0)\n    FROM: customer_total_return ctr1\n    INNER JOIN store_avg_return sar ON ctr1.ctr_store_sk = sar.ctr_store_sk\n    , store, customer, customer_demographics\n    WHERE: ctr1.ctr_total_return > sar.avg_return\n      AND ctr1.ctr_reason_sk BETWEEN 17 AND 20\n      AND s_store_sk = ctr1.ctr_store_sk\n      AND s_state IN ('IA', 'KY', 'NE')\n      AND ctr1.ctr_customer_sk = c_customer_sk\n      AND c_current_cdemo_sk = cd_demo_sk\n      AND cd_marital_status IN ('S', 'S')\n      AND cd_education_status IN ('4 yr Degree', '4 yr Degree')\n      AND cd_gender = 'M'\n      AND c_birth_month = 4\n      AND c_birth_year BETWEEN 1987 AND 1993\n    ORDER BY: c_customer_id\n    LIMIT 100",
    "recommended_examples": [
      "pg_shared_scan_decorrelate"
    ]
  },
  {
    "target_id": "t2",
    "family": "F",
    "transform": "explicit_join",
    "relevance_score": 0.65,
    "hypothesis": "Comma-separated joins obscure join conditions. Use explicit INNER JOIN to clarify relationships and aid optimizer decisions.",
    "target_ir": "S0 [SELECT]\n  ... (CTEs unchanged from original) ...\n  MAIN QUERY (via Q_S0)\n    FROM: customer_total_return ctr1\n    INNER JOIN store ON s_store_sk = ctr1.ctr_store_sk\n    INNER JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk\n    INNER JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk\n    WHERE: ctr1.ctr_total_return > (SELECT AVG(ctr_total_return)*1.2 FROM customer_total_return ctr2 WHERE ctr1.ctr_store_sk = ctr2.ctr_store_sk)\n      AND ctr1.ctr_reason_sk BETWEEN 17 AND 20\n      AND s_state IN ('IA', 'KY', 'NE')\n      AND cd_marital_status IN ('S', 'S')\n      AND cd_education_status IN ('4 yr Degree', '4 yr Degree')\n      AND cd_gender = 'M'\n      AND c_birth_month = 4\n      AND c_birth_year BETWEEN 1987 AND 1993\n    ORDER BY: c_customer_id\n    LIMIT 100",
    "recommended_examples": [
      "pg_explicit_join_materialized"
    ]
  }
]