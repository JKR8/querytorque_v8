[
  {
    "target_id": "ctr1_early_filter",
    "family": "B+A",
    "transform": "decorrelate_subquery_and_push_filters",
    "relevance_score": 0.98,
    "hypothesis": "Decorrelation (B) removes the correlated subquery's per-row execution, reducing the main nested loop's cost. Adding early filtering (A) on ctr_reason_sk and s_state in the CTE reduces aggregation input rows. The original plan spent 34,350ms on CTE Scan (ctr1); pushing these filters into the CTE WHERE clause (sr_reason_sk BETWEEN 17 AND 20) and joining store early (s_state IN states) will reduce the CTE's row count.",
    "target_ir": "S0: Push sr_reason_sk BETWEEN 17 AND 20 into CTE_Q_S0_customer_total_return (WHERE [70b678372a29c55c]). Join store in CTE to apply s_state filter early.",
    "recommended_examples": [
      "shared_scan_decorrelate",
      "pg_date_cte_explicit_join"
    ]
  },
  {
    "target_id": "prefilter_demo",
    "family": "B+E",
    "transform": "prefilter_customer_demographics",
    "relevance_score": 0.9,
    "hypothesis": "Pre-filter customer and customer_demographics with their respective constraints (cd_marital_status, c_birth_month, etc.) into standalone CTEs. This reduces rows fed into the final Nested Loop (0 rows, 0.017ms in original), which scans these tables. The current plan shows Index Scans on customer/customer_demographics with low time, but pre-aggregating could reduce join complexity.",
    "target_ir": "Add CTEs for pre-filtered customer (WHERE c_birth_month=4 AND ...) and customer_demographics (cd_marital_status='S'...). Replace raw table joins with these CTEs in Q_S0.",
    "recommended_examples": [
      "multi_dimension_prefetch"
    ]
  },
  {
    "target_id": "cte_join_store",
    "family": "B+F",
    "transform": "explicit_join_store_in_cte",
    "relevance_score": 0.85,
    "hypothesis": "Join store with store_returns in the CTE to push s_state filtering earlier. The original CTE groups by sr_store_sk but doesn\u2019t filter stores until the main query. Adding an explicit INNER JOIN store in the CTE and applying s_state there (Family F) reduces sr_store_sk candidates before aggregation, cutting CTE output rows (original: 2,902 rows).",
    "target_ir": "Modify CTE_Q_S0_customer_total_return to JOIN store ON sr_store_sk = s_store_sk, moving s_state IN (...) into CTE WHERE.",
    "recommended_examples": [
      "pg_explicit_join_materialized"
    ]
  },
  {
    "target_id": "fix_t4_error",
    "family": "E",
    "transform": "rescue_dimension_prefetch",
    "relevance_score": 0.8,
    "hypothesis": "Patch t4 failed due to a column alias error (c_current_cdemo_sk vs cd_demo_sk). Fix the JOIN condition in customer_demographics_filtered to reference the correct alias (cd_demo_sk) while preserving dimension prefetching. This would reduce rows in the final Nested Loop.",
    "target_ir": "In t4's SQL, correct ON c.c_current_cdemo_sk = cd.cd_demo_sk and ensure all CTE column aliases match main query references.",
    "recommended_examples": [
      "multi_dimension_prefetch"
    ]
  }
]