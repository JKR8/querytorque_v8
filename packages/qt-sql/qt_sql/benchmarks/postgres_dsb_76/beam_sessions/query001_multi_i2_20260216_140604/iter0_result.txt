{
  "iteration": 0,
  "n_api_calls": 5,
  "best_speedup": 61.86,
  "best_patch_id": "t2",
  "best_sql": "WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_RETURN_AMT_INC_TAX) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2000 AND sr_return_amt / sr_return_quantity BETWEEN 115 AND 174 GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk), avg_return_by_store AS (SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS threshold FROM customer_total_return GROUP BY ctr_store_sk) SELECT c_customer_id FROM customer_total_return AS ctr1 INNER JOIN store ON s_store_sk = ctr1.ctr_store_sk INNER JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk INNER JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk INNER JOIN avg_return_by_store ON ctr1.ctr_store_sk = avg_return_by_store.ctr_store_sk WHERE ctr1.ctr_total_return > avg_return_by_store.threshold AND ctr1.ctr_reason_sk BETWEEN 17 AND 20 AND s_state IN ('IA', 'KY', 'NE') AND cd_marital_status IN ('S', 'S') AND cd_education_status IN ('4 yr Degree', '4 yr Degree') AND cd_gender = 'M' AND c_birth_month = 4 AND c_birth_year BETWEEN 1987 AND 1993 ORDER BY c_customer_id LIMIT 100;",
  "patches": [
    {
      "patch_id": "t1",
      "family": "B",
      "transform": "shared_scan_decorrelate",
      "relevance_score": 0.95,
      "status": "WIN",
      "speedup": 61.44,
      "semantic_passed": true,
      "error": null,
      "original_ms": 29213.7,
      "patch_ms": 475.5,
      "output_sql": "WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_RETURN_AMT_INC_TAX) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2000 AND sr_return_amt / sr_return_quantity BETWEEN 115 AND 174 GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk), store_avg_return AS (SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS avg_return FROM customer_total_return GROUP BY ctr_store_sk) SELECT c_customer_id FROM customer_total_return AS ctr1 INNER JOIN store_avg_return AS sar ON ctr1.ctr_store_sk = sar.ctr_store_sk, store, customer, customer_demographics WHERE ctr1.ctr_total_return > sar.avg_return AND ctr1.ctr_reason_sk BETWEEN 17 AND 20 AND s_store_sk = ctr1.ctr_store_sk AND s_state IN ('IA', 'KY', 'NE') AND ctr1.ctr_customer_sk = c_customer_sk AND c_current_cdemo_sk = cd_demo_sk AND cd_marital_status IN ('S', 'S') AND cd_education_status IN ('4 yr Degree', '4 yr Degree') AND cd_gender = 'M' AND c_birth_month = 4 AND c_birth_year BETWEEN 1987 AND 1993 ORDER BY c_customer_id LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "t2",
      "family": "F",
      "transform": "explicit_join",
      "relevance_score": 0.65,
      "status": "WIN",
      "speedup": 61.86,
      "semantic_passed": true,
      "error": null,
      "original_ms": 29213.7,
      "patch_ms": 472.3,
      "output_sql": "WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_RETURN_AMT_INC_TAX) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2000 AND sr_return_amt / sr_return_quantity BETWEEN 115 AND 174 GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk), avg_return_by_store AS (SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS threshold FROM customer_total_return GROUP BY ctr_store_sk) SELECT c_customer_id FROM customer_total_return AS ctr1 INNER JOIN store ON s_store_sk = ctr1.ctr_store_sk INNER JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk INNER JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk INNER JOIN avg_return_by_store ON ctr1.ctr_store_sk = avg_return_by_store.ctr_store_sk WHERE ctr1.ctr_total_return > avg_return_by_store.threshold AND ctr1.ctr_reason_sk BETWEEN 17 AND 20 AND s_state IN ('IA', 'KY', 'NE') AND cd_marital_status IN ('S', 'S') AND cd_education_status IN ('4 yr Degree', '4 yr Degree') AND cd_gender = 'M' AND c_birth_month = 4 AND c_birth_year BETWEEN 1987 AND 1993 ORDER BY c_customer_id LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "syn_w1",
      "family": "A",
      "transform": "early_filter",
      "relevance_score": 0.3,
      "status": "WIN",
      "speedup": 61.41,
      "semantic_passed": true,
      "error": null,
      "original_ms": 29213.7,
      "patch_ms": 475.7,
      "output_sql": "WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_RETURN_AMT_INC_TAX) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2000 AND sr_return_amt / sr_return_quantity BETWEEN 115 AND 174 GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk), store_avg_return AS (SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS avg_return FROM customer_total_return GROUP BY ctr_store_sk) SELECT c_customer_id FROM customer_total_return AS ctr1 INNER JOIN store_avg_return AS sar ON ctr1.ctr_store_sk = sar.ctr_store_sk, store, customer, customer_demographics WHERE ctr1.ctr_total_return > sar.avg_return AND ctr1.ctr_reason_sk BETWEEN 17 AND 20 AND s_store_sk = ctr1.ctr_store_sk AND s_state IN ('IA', 'KY', 'NE') AND ctr1.ctr_customer_sk = c_customer_sk AND c_current_cdemo_sk = cd_demo_sk AND cd_marital_status IN ('S', 'S') AND cd_education_status IN ('4 yr Degree', '4 yr Degree') AND cd_gender = 'M' AND c_birth_month = 4 AND c_birth_year BETWEEN 1987 AND 1993 ORDER BY c_customer_id LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "syn_w2",
      "family": "B",
      "transform": "decorrelate",
      "relevance_score": 0.3,
      "status": "WIN",
      "speedup": 60.17,
      "semantic_passed": true,
      "error": null,
      "original_ms": 29213.7,
      "patch_ms": 485.5,
      "output_sql": "WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_RETURN_AMT_INC_TAX) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2000 AND sr_return_amt / sr_return_quantity BETWEEN 115 AND 174 GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk), store_avg_return AS (SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS avg_return FROM customer_total_return GROUP BY ctr_store_sk) SELECT c_customer_id FROM customer_total_return AS ctr1 INNER JOIN store_avg_return AS sar ON ctr1.ctr_store_sk = sar.ctr_store_sk, store, customer, customer_demographics WHERE ctr1.ctr_total_return > sar.avg_return AND ctr1.ctr_reason_sk BETWEEN 17 AND 20 AND s_store_sk = ctr1.ctr_store_sk AND s_state IN ('IA', 'KY', 'NE') AND ctr1.ctr_customer_sk = c_customer_sk AND c_current_cdemo_sk = cd_demo_sk AND cd_marital_status IN ('S', 'S') AND cd_education_status IN ('4 yr Degree', '4 yr Degree') AND cd_gender = 'M' AND c_birth_month = 4 AND c_birth_year BETWEEN 1987 AND 1993 ORDER BY c_customer_id LIMIT 100;",
      "has_explain": true
    }
  ],
  "explains": {
    "t1": "Limit  (rows=0, time=606.181)\n  Aggregate  (rows=93169, time=577.107)\n    Gather Merge  (rows=93235, time=548.709)\n      Aggregate  (rows=31078, time=365.562)\n        Sort  (rows=31155, time=356.082)\n          Nested Loop  (rows=31155, time=346.247)\n            Index Only Scan on date_dim  (rows=122, time=0.443)\n            Index Scan on store_returns  (rows=255, time=2.815)\n  Sort  (rows=0, time=606.139)\n    Nested Loop  (rows=0, time=606.128)\n      Nested Loop  (rows=6, time=606.072)\n        N",
    "t2": "Limit  (rows=0, time=576.046)\n  Aggregate  (rows=93169, time=545.945)\n    Gather Merge  (rows=93235, time=516.27)\n      Aggregate  (rows=31078, time=337.017)\n        Sort  (rows=31155, time=327.597)\n          Nested Loop  (rows=31155, time=317.705)\n            Index Only Scan on date_dim  (rows=122, time=0.46)\n            Index Scan on store_returns  (rows=255, time=2.582)\n  Sort  (rows=0, time=575.994)\n    Nested Loop  (rows=0, time=575.984)\n      Nested Loop  (rows=6, time=575.924)\n        Nes",
    "syn_w1": "Limit  (rows=0, time=585.792)\n  Aggregate  (rows=93169, time=555.74)\n    Gather Merge  (rows=93235, time=526.963)\n      Aggregate  (rows=31078, time=347.74)\n        Sort  (rows=31155, time=338.139)\n          Nested Loop  (rows=31155, time=327.859)\n            Index Only Scan on date_dim  (rows=122, time=0.577)\n            Index Scan on store_returns  (rows=255, time=2.663)\n  Sort  (rows=0, time=585.74)\n    Nested Loop  (rows=0, time=585.73)\n      Nested Loop  (rows=6, time=585.641)\n        Neste",
    "syn_w2": "Limit  (rows=0, time=665.188)\n  Aggregate  (rows=93169, time=635.305)\n    Gather Merge  (rows=93235, time=606.716)\n      Aggregate  (rows=31078, time=399.304)\n        Sort  (rows=31155, time=390.003)\n          Nested Loop  (rows=31155, time=378.811)\n            Index Only Scan on date_dim  (rows=122, time=0.516)\n            Index Scan on store_returns  (rows=255, time=3.08)\n  Sort  (rows=0, time=665.104)\n    Nested Loop  (rows=0, time=665.093)\n      Nested Loop  (rows=6, time=665.013)\n        Ne"
  }
}