Worker Role: W3
Family: E
Transform: rescue_dimension_prefetch
Status: OK

--- OUTPUT SQL ---
WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_RETURN_AMT_INC_TAX) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2000 AND sr_return_amt / sr_return_quantity BETWEEN 115 AND 174 GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk), customer_demographics_filtered AS (SELECT cd_demo_sk, cd_marital_status, cd_education_status, cd_gender FROM customer_demographics WHERE cd_marital_status IN ('S', 'S') AND cd_education_status IN ('4 yr Degree', '4 yr Degree') AND cd_gender = 'M'), store_filtered AS (SELECT s_store_sk, s_state FROM store WHERE s_state IN ('IA', 'KY', 'NE')) SELECT c_customer_id FROM customer_total_return AS ctr1, store_filtered AS s, customer AS c, customer_demographics_filtered AS cd WHERE ctr1.ctr_total_return > (SELECT AVG(ctr_total_return) * 1.2 FROM customer_total_return AS ctr2 WHERE ctr1.ctr_store_sk = ctr2.ctr_store_sk) AND ctr1.ctr_reason_sk BETWEEN 17 AND 20 AND s.s_store_sk = ctr1.ctr_store_sk AND ctr1.ctr_customer_sk = c.c_customer_sk AND c.c_current_cdemo_sk = cd.cd_demo_sk AND c.c_birth_month = 4 AND c.c_birth_year BETWEEN 1987 AND 1993 ORDER BY c_customer_id LIMIT 100;