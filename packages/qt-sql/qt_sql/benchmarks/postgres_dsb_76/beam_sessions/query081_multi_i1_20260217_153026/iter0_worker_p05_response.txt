{
  "probe_id": "p01",
  "transform_id": "date_cte_isolate",
  "family": "A",
  "dialect": "postgres",
  "hypothesis": "Isolating the filtered date_dim scan into a CTE will enable PostgreSQL to materialize it once and improve join planning with catalog_returns.",
  "reasoning_trace": [
    "The original query uses comma-join syntax which is known to cause poor estimates in PostgreSQL.",
    "Filtering date_dim to only d_year=2000 reduces its cardinality significantly, making CTE materialization beneficial.",
    "Replacing the direct reference to date_dim with a pre-filtered CTE allows better optimization of the join with catalog_returns."
  ],
  "target_ir": "CTE-based filtered date dimension joined explicitly with catalog_returns using INNER JOIN syntax",
  "steps": [
    {
      "step_id": "s1",
      "op": "insert_cte",
      "target": {"by_node_id": "S0"},
      "payload": {
        "cte_name": "date_filtered",
        "cte_query_sql": "SELECT d_date_sk FROM date_dim WHERE d_year = 2000"
      }
    },
    {
      "step_id": "s2",
      "op": "replace_from",
      "target": {"by_node_id": "S0"},
      "payload": {
        "from_sql": "catalog_returns cr INNER JOIN date_filtered df ON cr.cr_returned_date_sk = df.d_date_sk, customer_address ca"
      }
    },
    {
      "step_id": "s3",
      "op": "replace_expr_subtree",
      "target": {"by_node_id": "S0", "by_anchor_hash": "c0335294749216b8"},
      "payload": {
        "expr_sql": "cr.cr_returning_addr_sk = ca.ca_address_sk"
      }
    }
  ]
}