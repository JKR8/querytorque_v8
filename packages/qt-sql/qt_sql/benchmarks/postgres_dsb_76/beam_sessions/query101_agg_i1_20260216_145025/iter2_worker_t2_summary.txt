Worker Role: W2
Family: C+A+B
Transform: prefilter_agg_pushdown+date_pair_decorrelation
Status: OK

--- OUTPUT SQL ---
WITH filtered_d1 AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 1998), filtered_d2 AS (SELECT d_date_sk, d_date FROM date_dim), filtered_item AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Electronics', 'Music')), filtered_ca AS (SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('AR', 'CO', 'NC', 'NY', 'TX')), filtered_hd AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_income_band_sk BETWEEN 7 AND 13 AND hd_buy_potential = '0-500'), agg_store_sales AS (SELECT ss_customer_sk, ss_item_sk, ss_ticket_number, ss_sales_price, ss_list_price FROM store_sales WHERE ss_sales_price / ss_list_price BETWEEN 0.35 AND 0.55), agg_store_returns AS (SELECT sr_customer_sk, sr_item_sk, sr_ticket_number FROM store_returns), agg_web_sales AS (SELECT ws_bill_customer_sk, ws_item_sk FROM web_sales) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM customer AS c JOIN filtered_ca AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN filtered_hd AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN agg_store_sales AS ss ON c.c_customer_sk = ss.ss_customer_sk JOIN agg_store_returns AS sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN agg_web_sales AS ws ON ss.ss_customer_sk = ws.ws_bill_customer_sk AND sr.sr_item_sk = ws.ws_item_sk JOIN filtered_item AS i ON ss.ss_item_sk = i.i_item_sk JOIN filtered_d1 AS d1 ON sr.sr_returned_date_sk = d1.d_date_sk JOIN filtered_d2 AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;