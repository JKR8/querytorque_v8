[
  {
    "target_id": "t1",
    "family": "B",
    "transform": "shared_scan_decorrelate",
    "relevance_score": 0.95,
    "hypothesis": "Correlated subquery re-executes CTE per-row for state averages. Precompute aggregates in standalone CTE to eliminate nested loop.",
    "target_ir": "S0 [SELECT]\n  CTE: customer_total_return  (via CTE_Q_S0_customer_total_return)\n    FROM: web_returns, date_dim, customer_address, item\n    WHERE [b04b10b69569f03b]: wr_returned_date_sk = d_date_sk AND d_year = 1999 AND wr_returning_addr_sk = ca_address_sk AND wr_item_sk = i_item_sk AND i_manager_id BETWEEN 42 and 51 AND wr_return_amt / wr_return_quantity between 193 and 222\n    GROUP BY: wr_returning_customer_sk, ca_state, wr_reason_sk\n  CTE: state_averages  (new)\n    FROM: customer_total_return\n    GROUP BY: ctr_state\n    SELECT: ctr_state, AVG(ctr_total_return) AS avg_return\n  MAIN QUERY (via Q_S0)\n    FROM: customer_total_return ctr1, customer_address, customer, state_averages sa\n    WHERE [new]: ctr1.ctr_total_return > sa.avg_return * 1.2 \n          AND ctr1.ctr_state = sa.ctr_state\n          AND ca_address_sk = c_current_addr_sk\n          AND ca_state IN ('CA', 'MI', 'SD', 'VA')\n          AND ctr1.ctr_customer_sk = c_customer_sk\n          AND ctr1.ctr_reason_sk IN (22, 23)\n          AND c_birth_year BETWEEN 1945 AND 1951\n    ORDER BY: c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address,c_last_review_date_sk,ctr_total_return",
    "recommended_examples": [
      "pg_shared_scan_decorrelate"
    ]
  },
  {
    "target_id": "t2",
    "family": "A",
    "transform": "predicate_pushback",
    "relevance_score": 0.85,
    "hypothesis": "Push reason_sk filter into CTE to reduce early aggregation cardinality. State filter cannot be pushed due to downstream average dependency.",
    "target_ir": "S0 [SELECT]\n  CTE: customer_total_return  (modified)\n    FROM: web_returns, date_dim, customer_address, item\n    WHERE [b04b10b69569f03b]: wr_returned_date_sk = d_date_sk AND d_year = 1999 AND wr_returning_addr_sk = ca_address_sk AND wr_item_sk = i_item_sk AND i_manager_id BETWEEN 42 and 51 AND wr_return_amt / wr_return_quantity between 193 and 222 AND wr_reason_sk IN (22,23)\n    GROUP BY: wr_returning_customer_sk, ca_state, wr_reason_sk\n  ... (rest matches original structure)",
    "recommended_examples": [
      "pg_date_cte_explicit_join"
    ]
  }
]