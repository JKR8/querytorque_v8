{
  "iteration": 0,
  "n_api_calls": 7,
  "best_speedup": 8.97,
  "best_patch_id": "t1",
  "best_sql": "WITH frequent_ss_items AS (SELECT SUBSTRING(i_item_desc FROM 1 FOR 30) AS itemdesc, i_item_sk AS item_sk, d_date AS solddate, COUNT(*) AS cnt FROM store_sales, date_dim, item WHERE ss_sold_date_sk = d_date_sk AND ss_item_sk = i_item_sk AND d_year = 1999 AND i_manager_id BETWEEN 44 AND 63 AND i_category IN ('Men', 'Music', 'Sports') GROUP BY SUBSTRING(i_item_desc FROM 1 FOR 30), i_item_sk, d_date HAVING COUNT(*) > 4), max_store_sales AS (SELECT MAX(csales) AS tpcds_cmax FROM (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS csales FROM store_sales, customer, date_dim WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND ss_wholesale_cost BETWEEN 26 AND 36 GROUP BY c_customer_sk) AS tmp1), best_ss_customer AS (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS ssales FROM store_sales, customer WHERE ss_customer_sk = c_customer_sk AND c_birth_year BETWEEN 1987 AND 1993 GROUP BY c_customer_sk HAVING SUM(ss_quantity * ss_sales_price) > (95 / 100.0) * (SELECT * FROM max_store_sales)), main_sales AS (SELECT cs_quantity * cs_list_price AS sales, cs_bill_customer_sk, cs_item_sk, cs_wholesale_cost FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy = 5 UNION ALL SELECT ws_quantity * ws_list_price, ws_bill_customer_sk, ws_item_sk, ws_wholesale_cost FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy = 5) SELECT SUM(sales) FROM main_sales WHERE cs_wholesale_cost BETWEEN 26 AND 36 AND cs_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND cs_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) LIMIT 100;",
  "patches": [
    {
      "patch_id": "t1",
      "family": "E",
      "transform": "materialization_prefetch",
      "relevance_score": 0.95,
      "status": "WIN",
      "speedup": 8.97,
      "semantic_passed": true,
      "error": null,
      "original_ms": 1098.2,
      "patch_ms": 122.5,
      "output_sql": "WITH frequent_ss_items AS (SELECT SUBSTRING(i_item_desc FROM 1 FOR 30) AS itemdesc, i_item_sk AS item_sk, d_date AS solddate, COUNT(*) AS cnt FROM store_sales, date_dim, item WHERE ss_sold_date_sk = d_date_sk AND ss_item_sk = i_item_sk AND d_year = 1999 AND i_manager_id BETWEEN 44 AND 63 AND i_category IN ('Men', 'Music', 'Sports') GROUP BY SUBSTRING(i_item_desc FROM 1 FOR 30), i_item_sk, d_date HAVING COUNT(*) > 4), max_store_sales AS (SELECT MAX(csales) AS tpcds_cmax FROM (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS csales FROM store_sales, customer, date_dim WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND ss_wholesale_cost BETWEEN 26 AND 36 GROUP BY c_customer_sk) AS tmp1), best_ss_customer AS (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS ssales FROM store_sales, customer WHERE ss_customer_sk = c_customer_sk AND c_birth_year BETWEEN 1987 AND 1993 GROUP BY c_customer_sk HAVING SUM(ss_quantity * ss_sales_price) > (95 / 100.0) * (SELECT * FROM max_store_sales)), main_sales AS (SELECT cs_quantity * cs_list_price AS sales, cs_bill_customer_sk, cs_item_sk, cs_wholesale_cost FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy = 5 UNION ALL SELECT ws_quantity * ws_list_price, ws_bill_customer_sk, ws_item_sk, ws_wholesale_cost FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy = 5) SELECT SUM(sales) FROM main_sales WHERE cs_wholesale_cost BETWEEN 26 AND 36 AND cs_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND cs_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "t2",
      "family": "A",
      "transform": "predicate_pushback",
      "relevance_score": 0.85,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Step s1 failed: No target found for replace_body step s1",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false
    },
    {
      "patch_id": "syn_w2",
      "family": "B",
      "transform": "decorrelate",
      "relevance_score": 0.3,
      "status": "WIN",
      "speedup": 8.77,
      "semantic_passed": true,
      "error": null,
      "original_ms": 1098.2,
      "patch_ms": 125.2,
      "output_sql": "WITH frequent_ss_items AS (SELECT SUBSTRING(i_item_desc FROM 1 FOR 30) AS itemdesc, i_item_sk AS item_sk, d_date AS solddate, COUNT(*) AS cnt FROM store_sales, date_dim, item WHERE ss_sold_date_sk = d_date_sk AND ss_item_sk = i_item_sk AND d_year = 1999 AND i_manager_id BETWEEN 44 AND 63 AND i_category IN ('Men', 'Music', 'Sports') GROUP BY SUBSTRING(i_item_desc FROM 1 FOR 30), i_item_sk, d_date HAVING COUNT(*) > 4), max_store_sales AS (SELECT MAX(csales) AS tpcds_cmax FROM (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS csales FROM store_sales, customer, date_dim WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND ss_wholesale_cost BETWEEN 26 AND 36 GROUP BY c_customer_sk) AS tmp1), best_ss_customer AS (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS ssales FROM store_sales, customer WHERE ss_customer_sk = c_customer_sk AND c_birth_year BETWEEN 1987 AND 1993 GROUP BY c_customer_sk HAVING SUM(ss_quantity * ss_sales_price) > (95 / 100.0) * (SELECT * FROM max_store_sales)), main_sales AS (SELECT cs_quantity * cs_list_price AS sales, cs_bill_customer_sk, cs_item_sk, cs_wholesale_cost FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy = 5 UNION ALL SELECT ws_quantity * ws_list_price, ws_bill_customer_sk, ws_item_sk, ws_wholesale_cost FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy = 5) SELECT SUM(sales) FROM main_sales WHERE cs_wholesale_cost BETWEEN 26 AND 36 AND cs_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND cs_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "syn_w3",
      "family": "E",
      "transform": "materialize_cte",
      "relevance_score": 0.3,
      "status": "WIN",
      "speedup": 8.72,
      "semantic_passed": true,
      "error": null,
      "original_ms": 1098.2,
      "patch_ms": 125.9,
      "output_sql": "WITH frequent_ss_items AS (SELECT SUBSTRING(i_item_desc FROM 1 FOR 30) AS itemdesc, i_item_sk AS item_sk, d_date AS solddate, COUNT(*) AS cnt FROM store_sales, date_dim, item WHERE ss_sold_date_sk = d_date_sk AND ss_item_sk = i_item_sk AND d_year = 1999 AND i_manager_id BETWEEN 44 AND 63 AND i_category IN ('Men', 'Music', 'Sports') GROUP BY SUBSTRING(i_item_desc FROM 1 FOR 30), i_item_sk, d_date HAVING COUNT(*) > 4), max_store_sales AS (SELECT MAX(csales) AS tpcds_cmax FROM (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS csales FROM store_sales, customer, date_dim WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year = 1999 AND ss_wholesale_cost BETWEEN 26 AND 36 GROUP BY c_customer_sk) AS tmp1), best_ss_customer AS (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS ssales FROM store_sales, customer WHERE ss_customer_sk = c_customer_sk AND c_birth_year BETWEEN 1987 AND 1993 GROUP BY c_customer_sk HAVING SUM(ss_quantity * ss_sales_price) > (95 / 100.0) * (SELECT * FROM max_store_sales)), main_sales AS (SELECT cs_quantity * cs_list_price AS sales, cs_bill_customer_sk, cs_item_sk, cs_wholesale_cost FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy = 5 UNION ALL SELECT ws_quantity * ws_list_price AS sales, ws_bill_customer_sk, ws_item_sk, ws_wholesale_cost FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk AND d_year = 1999 AND d_moy = 5) SELECT SUM(sales) FROM main_sales WHERE cs_wholesale_cost BETWEEN 26 AND 36 AND cs_item_sk IN (SELECT item_sk FROM frequent_ss_items) AND cs_bill_customer_sk IN (SELECT c_customer_sk FROM best_ss_customer) LIMIT 100;",
      "has_explain": true
    }
  ],
  "explains": {
    "t1": "Limit  (rows=1, time=210.967)\n  Aggregate  (rows=1, time=210.964)\n    Merge Join  (rows=0, time=210.959)\n      Sort  (rows=0, time=210.951)\n        Hash Join  (rows=0, time=210.935)\n          Gather  (rows=20669, time=49.787)\n            Append  (rows=6890, time=23.674)\n              Subquery Scan (*SELECT* 1)  (rows=5444, time=11.106)\n                Nested Loop  (rows=5444, time=10.72)\n                  Index Only Scan on date_dim  (rows=16, time=0.384)\n                  Index Scan on catalog_",
    "syn_w2": "Limit  (rows=1, time=180.664)\n  Aggregate  (rows=1, time=180.662)\n    Merge Join  (rows=0, time=180.658)\n      Sort  (rows=0, time=180.652)\n        Hash Join  (rows=0, time=180.637)\n          Gather  (rows=20669, time=46.942)\n            Append  (rows=6890, time=22.154)\n              Subquery Scan (*SELECT* 1)  (rows=5444, time=10.981)\n                Nested Loop  (rows=5444, time=10.619)\n                  Index Only Scan on date_dim  (rows=16, time=0.388)\n                  Index Scan on catalog",
    "syn_w3": "Limit  (rows=1, time=179.296)\n  Aggregate  (rows=1, time=179.294)\n    Merge Join  (rows=0, time=179.289)\n      Sort  (rows=0, time=179.283)\n        Hash Join  (rows=0, time=179.277)\n          Gather  (rows=20669, time=46.596)\n            Append  (rows=6890, time=21.604)\n              Subquery Scan (*SELECT* 1)  (rows=5444, time=10.173)\n                Nested Loop  (rows=5444, time=9.827)\n                  Index Only Scan on date_dim  (rows=16, time=0.309)\n                  Index Scan on catalog_"
  }
}