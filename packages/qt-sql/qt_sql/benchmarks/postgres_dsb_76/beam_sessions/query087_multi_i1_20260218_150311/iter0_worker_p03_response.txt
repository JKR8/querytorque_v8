{
  "probe_id": "p12",
  "transform_id": "dimension_prefetch_star",
  "family": "F",
  "status": "success",
  "dialect": "postgres",
  "hypothesis": "Pre-filtering date_dim and customer into MATERIALIZED CTEs reduces redundant scans and enables better join planning in PostgreSQL.",
  "reasoning_trace": [
    "Three branches scan date_dim and customer redundantly with identical filters.",
    "Materialized CTEs isolate filtered dimensions once, enabling hash join reuse.",
    "Explicit JOIN syntax aligns with PostgreSQL strength in join reordering.",
    "No correlated subqueries or OR-splitting risks present."
  ],
  "target_ir": "Add date_prefetch and customer_prefetch CTEs; rewrite branches to join explicitly.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["branch_1", "branch_2", "branch_3"],
        "outputs": ["*"],
        "changed": true,
        "sql": "select count(*) from ((select distinct c_last_name, c_first_name, d_date from branch_1) except (select distinct c_last_name, c_first_name, d_date from branch_2) except (select distinct c_last_name, c_first_name, d_date from branch_3)) cool_cust"
      },
      {
        "node_id": "branch_1",
        "parent_node_id": "final_select",
        "sources": ["store_sales", "date_prefetch", "customer_prefetch"],
        "outputs": ["c_last_name", "c_first_name", "d_date"],
        "changed": true,
        "sql": "select distinct c.c_last_name, c.c_first_name, d.d_date from store_sales ss join date_prefetch d on ss.ss_sold_date_sk = d.d_date_sk join customer_prefetch c on ss.ss_customer_sk = c.c_customer_sk"
      },
      {
        "node_id": "branch_2",
        "parent_node_id": "final_select",
        "sources": ["catalog_sales", "date_prefetch", "customer_prefetch"],
        "outputs": ["c_last_name", "c_first_name", "d_date"],
        "changed": true,
        "sql": "select distinct c.c_last_name, c.c_first_name, d.d_date from catalog_sales cs join date_prefetch d on cs.cs_sold_date_sk = d.d_date_sk join customer_prefetch c on cs.cs_bill_customer_sk = c.c_customer_sk"
      },
      {
        "node_id": "branch_3",
        "parent_node_id": "final_select",
        "sources": ["web_sales", "date_prefetch", "customer_prefetch"],
        "outputs": ["c_last_name", "c_first_name", "d_date"],
        "changed": true,
        "sql": "select distinct c.c_last_name, c.c_first_name, d.d_date from web_sales ws join date_prefetch d on ws.ws_sold_date_sk = d.d_date_sk join customer_prefetch c on ws.ws_bill_customer_sk = c.c_customer_sk"
      },
      {
        "node_id": "date_prefetch",
        "parent_node_id": null,
        "sources": ["date_dim"],
        "outputs": ["d_date_sk", "d_date"],
        "changed": true,
        "sql": "select d_date_sk, d_date from date_dim where d_month_seq between 1214 and 1214+11"
      },
      {
        "node_id": "customer_prefetch",
        "parent_node_id": null,
        "sources": ["customer"],
        "outputs": ["c_customer_sk", "c_last_name", "c_first_name"],
        "changed": true,
        "sql": "select c_customer_sk, c_last_name, c_first_name from customer where c_birth_year BETWEEN 1955 AND 1961"
      }
    ]
  }
}