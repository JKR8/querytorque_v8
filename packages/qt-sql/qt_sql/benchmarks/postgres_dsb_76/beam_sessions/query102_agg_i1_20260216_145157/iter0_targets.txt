[
  {
    "target_id": "t1",
    "family": "A",
    "transform": "early_filtering",
    "relevance_score": 0.98,
    "hypothesis": "Late-applied filters on date_dim, item, and customer_address cause large intermediate joins. Pushing filters into CTEs reduces cardinality before expensive joins.",
    "target_ir": "S0 [SELECT]\n  CTE: filtered_d1 (via Q1)\n    FROM: date_dim\n    WHERE: d_year = 2001\n  CTE: filtered_item (via Q2)\n    FROM: item\n    WHERE: i_category IN ('Children','Jewelry','Men') \n      AND i_manager_id IN (21,22,38,39,46,47,66,67,74,93)\n  CTE: filtered_ca (via Q3)\n    FROM: customer_address\n    WHERE: ca_state IN ('AZ','KS','OH','TX','WA')\n  MAIN QUERY (via Q0)\n    FROM: store_sales\n      INNER JOIN filtered_d1 d1 ON ss_sold_date_sk = d1.d_date_sk\n      INNER JOIN filtered_item i ON ss_item_sk = i_item_sk\n      INNER JOIN web_sales ws ON ws_item_sk = i_item_sk\n      INNER JOIN date_dim d2 ON ws_sold_date_sk = d2.d_date_sk\n      INNER JOIN customer c ON ss_customer_sk = c_customer_sk\n      INNER JOIN filtered_ca ca ON c_current_addr_sk = ca_address_sk\n      ... (other joins)\n    WHERE: d2.d_date BETWEEN d1.d_date AND (d1.d_date + interval '30 day')\n      AND ws_wholesale_cost BETWEEN 35 AND 55\n    GROUP BY: cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count\n    ORDER BY: cnt",
    "recommended_examples": [
      "pg_date_cte_explicit_join"
    ]
  },
  {
    "target_id": "t2",
    "family": "E",
    "transform": "multi_dimension_prefetch",
    "relevance_score": 0.9,
    "hypothesis": "Repeated full scans of date_dim (d1/d2) and item under identical filters waste I/O. Materialize filtered versions once for reuse.",
    "target_ir": "S0 [SELECT]\n  CTE: filtered_dates (via Q1)\n    FROM: date_dim\n    WHERE: d_year = 2001 OR d_date IN (SELECT d_date + interval '0-30 days' FROM date_dim WHERE d_year=2001)\n  CTE: filtered_item (via Q2)\n    FROM: item\n    WHERE: i_category IN ('Children','Jewelry','Men') \n      AND i_manager_id IN (21,22,38,39,46,47,66,67,74,93)\n  MAIN QUERY (via Q0)\n    FROM: store_sales\n      INNER JOIN filtered_dates d1 ON ss_sold_date_sk = d1.d_date_sk\n      INNER JOIN filtered_item i ON ss_item_sk = i_item_sk\n      INNER JOIN web_sales ws ON ws_item_sk = i_item_sk\n      INNER JOIN filtered_dates d2 ON ws_sold_date_sk = d2.d_date_sk\n      ... (other joins)\n    WHERE: d2.d_date BETWEEN d1.d_date AND (d1.d_date + interval '30 day')\n    GROUP BY: cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count\n    ORDER BY: cnt",
    "recommended_examples": [
      "multi_dimension_prefetch"
    ]
  },
  {
    "target_id": "t3",
    "family": "F",
    "transform": "join_restructure",
    "relevance_score": 0.85,
    "hypothesis": "Implicit comma joins prevent optimal join ordering. Convert to explicit joins starting with most restrictive CTEs (filtered_item/filtered_d1).",
    "target_ir": "S0 [SELECT]\n  ... (CTEs from t1/t2)\n  MAIN QUERY (via Q0)\n    FROM: filtered_item i\n      INNER JOIN store_sales ss ON i_item_sk = ss_item_sk\n      INNER JOIN filtered_d1 d1 ON ss_sold_date_sk = d1.d_date_sk\n      INNER JOIN web_sales ws ON i_item_sk = ws_item_sk\n      INNER JOIN date_dim d2 ON ws_sold_date_sk = d2.d_date_sk \n        AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + interval '30 day')\n      INNER JOIN customer c ON ss_customer_sk = c_customer_sk\n      INNER JOIN filtered_ca ca ON c_current_addr_sk = ca_address_sk\n      ... (other explicit INNER JOINs)\n    WHERE: ws_wholesale_cost BETWEEN 35 AND 55\n    GROUP BY: cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count\n    ORDER BY: cnt",
    "recommended_examples": [
      "pg_explicit_join_materialized"
    ]
  }
]