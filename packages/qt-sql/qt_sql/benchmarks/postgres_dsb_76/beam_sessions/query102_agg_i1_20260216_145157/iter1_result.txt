{
  "iteration": 1,
  "n_api_calls": 4,
  "best_speedup": 1.16,
  "best_patch_id": "t1_rescue",
  "best_sql": "WITH filtered_d1_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2001), filtered_web_sales AS (SELECT * FROM web_sales WHERE ws_wholesale_cost BETWEEN 35 AND 55) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales JOIN item ON ss_item_sk = i_item_sk JOIN filtered_web_sales ON ws_item_sk = ss_item_sk JOIN filtered_d1_dates AS d1 ON ss_sold_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws_sold_date_sk = d2.d_date_sk JOIN customer ON ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk JOIN inventory ON inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity JOIN warehouse ON ws_warehouse_sk = inv_warehouse_sk AND ws_warehouse_sk = w_warehouse_sk JOIN store ON s_state = w_state JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93) AND ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA') GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
  "patches": [
    {
      "patch_id": "t1_rescue",
      "family": "A+F",
      "transform": "early_filter_then_join_restructure",
      "relevance_score": 0.95,
      "status": "WIN",
      "speedup": 1.16,
      "semantic_passed": true,
      "error": null,
      "original_ms": 952.2,
      "patch_ms": 818.2,
      "output_sql": "WITH filtered_d1_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2001), filtered_web_sales AS (SELECT * FROM web_sales WHERE ws_wholesale_cost BETWEEN 35 AND 55) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales JOIN item ON ss_item_sk = i_item_sk JOIN filtered_web_sales ON ws_item_sk = ss_item_sk JOIN filtered_d1_dates AS d1 ON ss_sold_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws_sold_date_sk = d2.d_date_sk JOIN customer ON ss_customer_sk = c_customer_sk AND ws_bill_customer_sk = c_customer_sk JOIN inventory ON inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity JOIN warehouse ON ws_warehouse_sk = inv_warehouse_sk AND ws_warehouse_sk = w_warehouse_sk JOIN store ON s_state = w_state JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93) AND ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA') GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": true
    },
    {
      "patch_id": "t5",
      "family": "A+B",
      "transform": "early_filter_decorrelate_warehouse",
      "relevance_score": 0.8,
      "status": "REGRESSION",
      "speedup": 0.76,
      "semantic_passed": true,
      "error": null,
      "original_ms": 952.2,
      "patch_ms": 1248.3,
      "output_sql": "WITH filtered_warehouse AS (SELECT w_warehouse_sk, w_state FROM warehouse WHERE w_state IN (SELECT s_state FROM store)), filtered_store_sales AS (SELECT ss_item_sk, ss_customer_sk, ss_sold_date_sk, ss_quantity FROM store_sales INNER JOIN item ON ss_item_sk = i_item_sk INNER JOIN date_dim AS d1 ON ss_sold_date_sk = d1.d_date_sk WHERE d1.d_year = 2001 AND i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93)), filtered_web_sales AS (SELECT ws_item_sk, ws_bill_customer_sk, ws_sold_date_sk, ws_warehouse_sk FROM web_sales INNER JOIN date_dim AS d2 ON ws_sold_date_sk = d2.d_date_sk WHERE d2.d_date BETWEEN (SELECT d_date FROM date_dim WHERE d_date_sk = (SELECT ss_sold_date_sk FROM filtered_store_sales LIMIT 1)) AND (SELECT d_date + INTERVAL '30 DAY' FROM date_dim WHERE d_date_sk = (SELECT ss_sold_date_sk FROM filtered_store_sales LIMIT 1)) AND ws_wholesale_cost BETWEEN 35 AND 55) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM filtered_store_sales AS ss JOIN filtered_web_sales AS ws ON ss.ss_item_sk = ws.ws_item_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk AND ws.ws_bill_customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca_address_sk JOIN customer_demographics AS cd ON c.c_current_cdemo_sk = cd_demo_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd_demo_sk JOIN inventory AS inv ON inv_item_sk = ss.ss_item_sk AND inv_date_sk = ss.ss_sold_date_sk AND inv_warehouse_sk = ws.ws_warehouse_sk JOIN filtered_warehouse AS w ON ws.ws_warehouse_sk = w.w_warehouse_sk JOIN store AS s ON s_state = w.w_state WHERE inv_quantity_on_hand >= ss.ss_quantity AND ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA') GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": true
    },
    {
      "patch_id": "t4",
      "family": "E",
      "transform": "customer_dimension_prefetch",
      "relevance_score": 0.85,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1 structural: COLUMN REF MISMATCH: Original columns missing from rewrite \u2014 ['inv_warehouse_sk']. The rewrite references different table columns.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_customers AS (SELECT c_customer_sk, c_current_cdemo_sk, c_current_hdemo_sk, c_current_addr_sk FROM customer JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA')), customer_demographics_filtered AS (SELECT cd_demo_sk, cd_gender, cd_marital_status, cd_education_status FROM customer_demographics), household_demographics_filtered AS (SELECT hd_demo_sk, hd_vehicle_count FROM household_demographics) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM store_sales JOIN web_sales ON ss_item_sk = ws_item_sk AND ws_bill_customer_sk = ss_customer_sk JOIN date_dim AS d1 ON ss_sold_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws_sold_date_sk = d2.d_date_sk JOIN inventory ON inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity JOIN store ON s_state = w_state JOIN warehouse ON ws_warehouse_sk = w_warehouse_sk JOIN item ON ss_item_sk = i_item_sk JOIN filtered_customers ON ss_customer_sk = c_customer_sk JOIN customer_demographics_filtered ON c_current_cdemo_sk = cd_demo_sk JOIN household_demographics_filtered ON c_current_hdemo_sk = hd_demo_sk WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') AND i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93) AND d1.d_year = 2001 AND ws_wholesale_cost BETWEEN 35 AND 55 GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count ORDER BY cnt;",
      "has_explain": false
    }
  ],
  "explains": {
    "t1_rescue": "Sort  (rows=0, time=515.126)\n  Aggregate  (rows=0, time=515.112)\n    Nested Loop  (rows=0, time=515.109)\n      Nested Loop  (rows=0, time=515.106)\n        Gather Merge  (rows=0, time=515.103)\n          Sort  (rows=0, time=504.661)\n            Nested Loop  (rows=0, time=504.63)\n              Nested Loop  (rows=0, time=504.629)\n                Nested Loop  (rows=0, time=504.628)\n                  Nested Loop  (rows=0, time=504.627)\n                    Nested Loop  (rows=0, time=504.625)\n          ",
    "t5": "Sort  (rows=0, time=1714.333)\n  Gather  (rows=266257, time=1498.886)\n    Nested Loop  (rows=88752, time=966.491)\n      Nested Loop  (rows=1675487, time=338.448)\n        Index Only Scan on date_dim (d1)  (rows=122, time=0.981)\n        Index Only Scan on store_sales  (rows=13771, time=2.11)\n      Memoize  (rows=0, time=0.0)\n        Index Scan on item  (rows=0, time=0.005)\n  Index Scan on date_dim  (rows=1, time=1.674)\n    Limit  (rows=1, time=1.659)\n      CTE Scan (filtered_store_sales)  (rows=1, "
  }
}