{
  "probe_id": "p01",
  "transform_id": "inner_join_conversion",
  "family": "F",
  "dialect": "postgres",
  "hypothesis": "Convert implicit comma joins to explicit INNER JOIN in subqueries y and x to improve join planning and enable early filtering on date_dim.",
  "reasoning_trace": [
    "FROM clause in subqueries y and x uses comma joins: 'wss,store,date_dim d'",
    "Comma joins prevent PostgreSQL from pushing predicates effectively",
    "Explicit JOIN syntax allows better cardinality estimation and plan generation"
  ],
  "target_ir": "Subqueries y and x use explicit INNER JOIN syntax with ON conditions for store_sales-store and date_dim-wss relationships.",
  "steps": [
    {
      "step_id": "s1",
      "op": "replace_block_with_cte_pair",
      "target": {"by_node_id": "S0"},
      "payload": {
        "sql_fragment": "(select s_store_name s_store_name1,wss.d_week_seq d_week_seq1\n        ,s_store_id s_store_id1,sun_sales sun_sales1\n        ,mon_sales mon_sales1,tue_sales tue_sales1\n        ,wed_sales wed_sales1,thu_sales thu_sales1\n        ,fri_sales fri_sales1,sat_sales sat_sales1\n  from wss INNER JOIN store ON wss.ss_store_sk = store.s_store_sk INNER JOIN date_dim d ON d.d_week_seq = wss.d_week_seq\n  where d_month_seq between 1187 and 1187 + 11\n        and s_state in ('AR','CO','IA'\n                    ,'IL','NC','NY','PA','TX')) y"
      }
    },
    {
      "step_id": "s2",
      "op": "replace_block_with_cte_pair",
      "target": {"by_node_id": "S0"},
      "payload": {
        "sql_fragment": "(select s_store_name s_store_name2,wss.d_week_seq d_week_seq2\n        ,s_store_id s_store_id2,sun_sales sun_sales2\n        ,mon_sales mon_sales2,tue_sales tue_sales2\n        ,wed_sales wed_sales2,thu_sales thu_sales2\n        ,fri_sales fri_sales2,sat_sales sat_sales2\n  from wss INNER JOIN store ON wss.ss_store_sk = store.s_store_sk INNER JOIN date_dim d ON d.d_week_seq = wss.d_week_seq\n  where d_month_seq between 1187+ 12 and 1187 + 23\n        and s_state in ('AR','CO','IA'\n                    ,'IL','NC','NY','PA','TX')) x"
      }
    }
  ]
}