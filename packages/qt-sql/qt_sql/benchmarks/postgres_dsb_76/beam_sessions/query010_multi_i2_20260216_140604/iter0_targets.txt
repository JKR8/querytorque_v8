[
  {
    "target_id": "t1",
    "family": "B",
    "transform": "shared_scan_decorrelate",
    "relevance_score": 0.95,
    "hypothesis": "Correlated EXISTS subqueries on store_sales, web_sales, and catalog_sales force nested loops. Decorrelate by precomputing customer eligibility in CTEs and using semi-joins.",
    "target_ir": "S0 [SELECT]\n  CTE: store_eligible (via Q1)\n    SELECT DISTINCT ss_customer_sk\n    FROM store_sales\n    JOIN date_dim ON ss_sold_date_sk = d_date_sk\n    JOIN item ON ss_item_sk = i_item_sk\n    WHERE d_year=1999 AND d_moy BETWEEN 5 AND 8\n      AND i_category IN ('Children','Home','Women')\n      AND i_manager_id BETWEEN 91 AND 100\n      AND ss_sales_price/ss_list_price BETWEEN 0.65 AND 0.75\n  CTE: web_or_catalog_eligible (via Q2)\n    SELECT ws_bill_customer_sk AS customer_sk FROM web_sales\n    JOIN date_dim ON ws_sold_date_sk = d_date_sk\n    JOIN item ON ws_item_sk = i_item_sk\n    WHERE ...\n    UNION\n    SELECT cs_ship_customer_sk FROM catalog_sales\n    JOIN date_dim ON cs_sold_date_sk = d_date_sk\n    JOIN item ON cs_item_sk = i_item_sk\n    WHERE ...\n  MAIN QUERY (via Q0)\n    FROM customer c\n    JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk\n    JOIN customer_demographics cd ON cd_demo_sk = c.c_current_cdemo_sk\n    JOIN store_eligible se ON c.c_customer_sk = se.ss_customer_sk\n    JOIN web_or_catalog_eligible wce ON c.c_customer_sk = wce.customer_sk\n    WHERE ca.ca_county IN (...)\n      AND c.c_birth_month IN (4,5)\n      AND cd.cd_marital_status IN ('U','S','U')\n      AND cd.cd_education_status IN ('College','Secondary','College')\n      AND cd.cd_gender = 'M'",
    "recommended_examples": [
      "pg_shared_scan_decorrelate"
    ]
  },
  {
    "target_id": "t2",
    "family": "E",
    "transform": "multi_dimension_prefetch",
    "relevance_score": 0.85,
    "hypothesis": "date_dim and item filters are redundantly applied in all three sales subqueries. Materialize filtered dimension keys upfront for reuse.",
    "target_ir": "S0 [SELECT]\n  CTE: filtered_dates (via Q1)\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year=1999 AND d_moy BETWEEN 5 AND 8\n  CTE: filtered_items (via Q2)\n    SELECT i_item_sk\n    FROM item\n    WHERE i_category IN ('Children','Home','Women')\n      AND i_manager_id BETWEEN 91 AND 100\n  MAIN QUERY (via Q0)\n    ... (All sales subqueries now reference filtered_dates/filtered_items CTEs instead of base tables)",
    "recommended_examples": [
      "multi_dimension_prefetch"
    ]
  }
]