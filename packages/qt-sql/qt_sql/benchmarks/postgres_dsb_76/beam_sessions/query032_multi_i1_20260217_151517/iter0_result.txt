{
  "iteration": 0,
  "n_api_calls": 19,
  "beam_cost_usd": 0.08644276,
  "beam_cost_priced_calls": 19,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 86102,
    "completion_tokens": 31153,
    "total_tokens": 117255,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 37568
  },
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "p02",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.85,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY') SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales AS cs JOIN item AS i ON i.i_item_sk = cs.cs_item_sk JOIN filtered_dates AS fd ON fd.d_date_sk = cs.cs_sold_date_sk WHERE (i_manufact_id IN (47, 226, 612, 676, 818) OR i_manager_id BETWEEN 71 AND 100) AND i_item_sk = cs_item_sk AND d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY' AND d_date_sk = cs_sold_date_sk AND cs_ext_discount_amt > (SELECT 1.3 * AVG(cs_ext_discount_amt) FROM catalog_sales, date_dim WHERE cs_item_sk = i_item_sk AND d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY' AND d_date_sk = cs_sold_date_sk AND cs_list_price BETWEEN 108 AND 137 AND cs_sales_price / cs_list_price BETWEEN 23 * 0.01 AND 43 * 0.01) ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;",
      "has_explain": false,
      "description": "Create filtered_dates CTE and convert comma joins to explicit INNER JOINs with ON clauses"
    },
    {
      "patch_id": "p03",
      "family": "A",
      "transform": "dimension_cte_isolate",
      "relevance_score": 0.8,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_items AS (SELECT i_item_sk FROM item WHERE i_manufact_id IN (47, 226, 612, 676, 818) OR i_manager_id BETWEEN 71 AND 100) SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales JOIN filtered_items ON filtered_items.i_item_sk = catalog_sales.cs_item_sk, date_dim WHERE (d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY') AND d_date_sk = cs_sold_date_sk AND cs_ext_discount_amt > (SELECT 1.3 * AVG(cs_ext_discount_amt) FROM catalog_sales, date_dim WHERE cs_item_sk = filtered_items.i_item_sk AND d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY' AND d_date_sk = cs_sold_date_sk AND cs_list_price BETWEEN 108 AND 137 AND cs_sales_price / cs_list_price BETWEEN 23 * 0.01 AND 43 * 0.01) ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;",
      "has_explain": false,
      "description": "Create filtered_items CTE with OR condition, then JOIN in main query"
    },
    {
      "patch_id": "p09",
      "family": "F",
      "transform": "materialized_dimension_fact_prefilter",
      "relevance_score": 0.7,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH prefiltered_catalog AS (SELECT cs_item_sk, cs_ext_discount_amt FROM catalog_sales AS cs JOIN date_dim AS d ON d.d_date_sk = cs.cs_sold_date_sk WHERE d.d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY' AND cs.cs_list_price BETWEEN 108 AND 137 AND cs.cs_sales_price / cs.cs_list_price BETWEEN 0.23 AND 0.43) SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM prefiltered_catalog AS pc, item AS i WHERE (i_manufact_id IN (47, 226, 612, 676, 818) OR i_manager_id BETWEEN 71 AND 100) AND i_item_sk = cs_item_sk AND d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY' AND d_date_sk = cs_sold_date_sk AND cs_ext_discount_amt > (SELECT 1.3 * AVG(cs_ext_discount_amt) FROM catalog_sales, date_dim WHERE cs_item_sk = i_item_sk AND d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY' AND d_date_sk = cs_sold_date_sk AND cs_list_price BETWEEN 108 AND 137 AND cs_sales_price / cs_list_price BETWEEN 23 * 0.01 AND 43 * 0.01) ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;",
      "has_explain": false,
      "description": "Create prefiltered_catalog CTE with date join and price filters before item join"
    },
    {
      "patch_id": "p06",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.75,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_items AS (SELECT i_item_sk FROM item WHERE (i_manufact_id IN (47, 226, 612, 676, 818) OR i_manager_id BETWEEN 71 AND 100)), filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY') SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales AS cs JOIN filtered_items AS fi ON cs.cs_item_sk = fi.i_item_sk JOIN filtered_dates AS fd ON cs.cs_sold_date_sk = fd.d_date_sk WHERE cs.cs_ext_discount_amt > (SELECT 1.3 * AVG(cs2.cs_ext_discount_amt) FROM catalog_sales AS cs2 JOIN filtered_dates AS fd2 ON cs2.cs_sold_date_sk = fd2.d_date_sk WHERE cs2.cs_item_sk = fi.i_item_sk AND cs2.cs_list_price BETWEEN 108 AND 137 AND cs2.cs_sales_price / cs2.cs_list_price BETWEEN 23 * 0.01 AND 43 * 0.01) ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;",
      "has_explain": false,
      "description": "Create both filtered_dates AND filtered_items CTEs before main join"
    },
    {
      "patch_id": "p08",
      "family": "C",
      "transform": "single_pass_aggregation",
      "relevance_score": 0.5,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH item_avg_discount AS (SELECT cs_item_sk, 1.3 * AVG(cs_ext_discount_amt) AS threshold FROM catalog_sales AS cs JOIN date_dim AS dd ON dd.d_date_sk = cs.cs_sold_date_sk WHERE dd.d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY' AND cs.cs_list_price BETWEEN 108 AND 137 AND cs.cs_sales_price / cs.cs_list_price BETWEEN 23 * 0.01 AND 43 * 0.01 GROUP BY cs_item_sk) SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales AS cs JOIN item AS i ON i.i_item_sk = cs.cs_item_sk JOIN date_dim AS dd ON dd.d_date_sk = cs.cs_sold_date_sk JOIN item_avg_discount AS iad ON iad.cs_item_sk = cs.cs_item_sk WHERE (i.i_manufact_id IN (47, 226, 612, 676, 818) OR i.i_manager_id BETWEEN 71 AND 100) AND cs.cs_ext_discount_amt > iad.threshold ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;",
      "has_explain": false,
      "description": "Consolidate subquery into main aggregation using CASE expressions"
    },
    {
      "patch_id": "p01",
      "family": "B",
      "transform": "inline_decorrelate_materialized",
      "relevance_score": 0.9,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY'), item_avg_discount AS (SELECT cs_item_sk, 1.3 * AVG(cs_ext_discount_amt) AS threshold FROM catalog_sales AS cs JOIN filtered_dates AS fd ON cs.cs_sold_date_sk = fd.d_date_sk WHERE cs.cs_list_price BETWEEN 108 AND 137 AND cs.cs_sales_price / cs_list_price BETWEEN 23 * 0.01 AND 43 * 0.01 GROUP BY cs_item_sk) SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales AS cs JOIN item AS i ON i.i_item_sk = cs.cs_item_sk JOIN filtered_dates AS fd ON fd.d_date_sk = cs.cs_sold_date_sk JOIN item_avg_discount AS tad ON tad.cs_item_sk = cs.cs_item_sk WHERE (i.i_manufact_id IN (47, 226, 612, 676, 818) OR i.i_manager_id BETWEEN 71 AND 100) AND cs.cs_ext_discount_amt > tad.threshold ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;",
      "has_explain": false,
      "description": "Replace correlated subquery with MATERIALIZED CTEs: 1) filtered_dates CTE, 2) item_avg_discount CTE with GROUP BY cs_item_sk, 3) main query JOINs threshold CTE"
    },
    {
      "patch_id": "p04",
      "family": "B",
      "transform": "early_filter_decorrelate",
      "relevance_score": 0.7,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH item_discount_thresholds AS (SELECT cs_item_sk, 1.3 * AVG(cs_ext_discount_amt) AS threshold FROM catalog_sales JOIN date_dim ON d_date_sk = cs_sold_date_sk WHERE d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY' AND cs_list_price BETWEEN 108 AND 137 AND cs_sales_price / cs_list_price BETWEEN 23 * 0.01 AND 43 * 0.01 GROUP BY cs_item_sk) SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales JOIN item ON i_item_sk = cs_item_sk JOIN date_dim ON d_date_sk = cs_sold_date_sk JOIN item_discount_thresholds AS idt ON idt.cs_item_sk = cs_item_sk WHERE (i_manufact_id IN (47, 226, 612, 676, 818) OR i_manager_id BETWEEN 71 AND 100) AND cs_ext_discount_amt > idt.threshold ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;",
      "has_explain": false,
      "description": "Combine p01+p03: filtered_items CTE + decorrelated threshold CTE without MATERIALIZED keyword"
    },
    {
      "patch_id": "p07",
      "family": "B",
      "transform": "decorrelate",
      "relevance_score": 0.6,
      "status": "DEDUP",
      "speedup": null,
      "semantic_passed": false,
      "error": null,
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH item_discount_thresholds AS (SELECT cs_item_sk, 1.3 * AVG(cs_ext_discount_amt) AS threshold FROM catalog_sales JOIN date_dim ON d_date_sk = cs_sold_date_sk WHERE d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY' AND cs_list_price BETWEEN 108 AND 137 AND cs_sales_price / cs_list_price BETWEEN 0.23 AND 0.43 GROUP BY cs_item_sk) SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales JOIN item ON i_item_sk = cs_item_sk JOIN date_dim ON d_date_sk = cs_sold_date_sk JOIN item_discount_thresholds AS idt ON idt.cs_item_sk = cs_item_sk WHERE (i_manufact_id IN (47, 226, 612, 676, 818) OR i_manager_id BETWEEN 71 AND 100) AND cs_ext_discount_amt > idt.threshold ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;",
      "has_explain": false,
      "description": "Portable version: Create threshold CTE with GROUP BY without PostgreSQL MATERIALIZED hint"
    },
    {
      "patch_id": "p05",
      "family": "D",
      "transform": "or_to_union",
      "relevance_score": 0.4,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Failed to parse/apply PatchPlan",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": "Split OR condition into UNION ALL branches: 1) i_manufact_id IN(...) 2) i_manager_id BETWEEN..."
    },
    {
      "patch_id": "p10",
      "family": "B",
      "transform": "sf_shared_scan_decorrelate",
      "relevance_score": 0.3,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH threshold AS (SELECT 1.3 * AVG(cs_ext_discount_amt) AS threshold_value FROM catalog_sales JOIN date_dim ON d_date_sk = cs_sold_date_sk WHERE d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY' AND cs_list_price BETWEEN 108 AND 137 AND cs_sales_price / cs_list_price BETWEEN 23 * 0.01 AND 43 * 0.01) SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales, item, date_dim, threshold WHERE (i_manufact_id IN (47, 226, 612, 676, 818) OR i_manager_id BETWEEN 71 AND 100) AND i_item_sk = cs_item_sk AND d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY' AND d_date_sk = cs_sold_date_sk AND cs_ext_discount_amt > threshold.threshold_value ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;",
      "has_explain": false,
      "description": "Snowflake pattern: shared_catalog CTE for date+price filters, then derive threshold"
    },
    {
      "patch_id": "snipe_p1",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH item_discount_thresholds AS (SELECT cs_item_sk, 1.3 * AVG(cs_ext_discount_amt) AS threshold FROM catalog_sales JOIN date_dim ON d_date_sk = cs_sold_date_sk WHERE d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY' AND cs_list_price BETWEEN 108 AND 137 AND cs_sales_price / cs_list_price BETWEEN 23 * 0.01 AND 43 * 0.01 GROUP BY cs_item_sk) SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales JOIN item ON i_item_sk = cs_item_sk JOIN date_dim ON d_date_sk = cs_sold_date_sk JOIN item_discount_thresholds AS idt ON idt.cs_item_sk = catalog_sales.cs_item_sk WHERE (i_manufact_id IN (47, 226, 612, 676, 818) OR i_manager_id BETWEEN 71 AND 100) AND cs_ext_discount_amt > idt.threshold ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;",
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p2",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_items AS (SELECT i_item_sk FROM item WHERE i_manufact_id IN (47, 226, 612, 676, 818) OR i_manager_id BETWEEN 71 AND 100), filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY'), item_discount_thresholds AS (SELECT cs_item_sk, 1.3 * AVG(cs_ext_discount_amt) AS threshold FROM catalog_sales JOIN filtered_dates ON d_date_sk = cs_sold_date_sk WHERE cs_list_price BETWEEN 108 AND 137 AND cs_sales_price / cs_list_price BETWEEN 23 * 0.01 AND 43 * 0.01 GROUP BY cs_item_sk) SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales JOIN filtered_items ON filtered_items.i_item_sk = catalog_sales.cs_item_sk JOIN filtered_dates ON filtered_dates.d_date_sk = catalog_sales.cs_sold_date_sk JOIN item_discount_thresholds AS idt ON idt.cs_item_sk = catalog_sales.cs_item_sk WHERE cs_ext_discount_amt > idt.threshold ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;",
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p1",
      "family": "B,F",
      "transform": "decorrelate_with_explicit_joins",
      "relevance_score": 1.0,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY'), item_avg_discount AS (SELECT cs_item_sk, 1.3 * AVG(cs_ext_discount_amt) AS threshold FROM catalog_sales JOIN filtered_dates ON d_date_sk = cs_sold_date_sk WHERE cs_list_price BETWEEN 108 AND 137 AND cs_sales_price / cs_list_price BETWEEN 23 * 0.01 AND 43 * 0.01 GROUP BY cs_item_sk) SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales AS cs JOIN item AS i ON cs.cs_item_sk = i.i_item_sk JOIN filtered_dates AS fd ON fd.d_date_sk = cs.cs_sold_date_sk JOIN item_avg_discount AS tad ON tad.cs_item_sk = cs.cs_item_sk WHERE (i.i_manufact_id IN (47, 226, 612, 676, 818) OR i.i_manager_id BETWEEN 71 AND 100) AND cs.cs_ext_discount_amt > tad.threshold ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;",
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p2",
      "family": "A,B",
      "transform": "dimension_prefetch_with_decorrelation",
      "relevance_score": 1.0,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_items AS (SELECT i_item_sk FROM item WHERE i_manufact_id IN (47, 226, 612, 676, 818) OR i_manager_id BETWEEN 71 AND 100), filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY'), item_avg_discount AS (SELECT cs_item_sk, 1.3 * AVG(cs_ext_discount_amt) AS threshold FROM catalog_sales JOIN filtered_dates ON d_date_sk = cs_sold_date_sk WHERE cs_list_price BETWEEN 108 AND 137 AND cs_sales_price / cs_list_price BETWEEN 23 * 0.01 AND 43 * 0.01 GROUP BY cs_item_sk) SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales AS cs JOIN filtered_items AS fi ON cs.cs_item_sk = fi.i_item_sk JOIN filtered_dates AS fd ON fd.d_date_sk = cs.cs_sold_date_sk JOIN item_avg_discount AS tad ON tad.cs_item_sk = cs.cs_item_sk WHERE cs.cs_ext_discount_amt > tad.threshold ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;",
      "has_explain": false,
      "description": null
    }
  ],
  "explains": {}
}