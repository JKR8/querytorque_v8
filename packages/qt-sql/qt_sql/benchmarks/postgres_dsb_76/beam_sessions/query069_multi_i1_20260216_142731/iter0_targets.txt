[
  {
    "target_id": "t1",
    "family": "B",
    "transform": "shared_scan_decorrelate",
    "relevance_score": 0.95,
    "hypothesis": "Correlated EXISTS/NOT EXISTS subqueries force re-execution per customer row. Decorrelation converts them to single-pass semi-joins using precomputed customer sets.",
    "target_ir": "S0 [SELECT]\n  CTE: store_customers (via Q1)\n    SELECT DISTINCT ss_customer_sk\n    FROM store_sales\n    JOIN date_dim ON ss_sold_date_sk = d_date_sk\n    WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 12\n      AND ss_list_price BETWEEN 80 AND 169\n  CTE: excluded_customers (via Q2)\n    SELECT ws_bill_customer_sk AS cust_sk\n    FROM web_sales\n    JOIN date_dim ON ws_sold_date_sk = d_date_sk\n    WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 12\n      AND ws_list_price BETWEEN 80 AND 169\n    UNION\n    SELECT cs_ship_customer_sk\n    FROM catalog_sales\n    JOIN date_dim ON cs_sold_date_sk = d_date_sk\n    WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 12\n      AND cs_list_price BETWEEN 80 AND 169\n  MAIN QUERY (via Q0)\n    FROM customer c\n    JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk\n    JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk\n    JOIN store_customers sc ON c.c_customer_sk = sc.ss_customer_sk\n    LEFT JOIN excluded_customers ec ON c.c_customer_sk = ec.cust_sk\n    WHERE ca_state IN ('CO','NC','TX')\n      AND cd_marital_status IN ('S','M','U')\n      AND cd_education_status IN ('Primary','College')\n      AND ec.cust_sk IS NULL\n    GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating\n    ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating",
    "recommended_examples": [
      "pg_shared_scan_decorrelate"
    ]
  },
  {
    "target_id": "t2",
    "family": "E",
    "transform": "date_dim_prefetch",
    "relevance_score": 0.85,
    "hypothesis": "Identical date_dim scans repeated 3x in subqueries. Precompute date keys once for reuse.",
    "target_ir": "S0 [SELECT]\n  CTE: date_filter (via Q1)\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_year = 2002 AND d_moy BETWEEN 10 AND 12\n  MAIN QUERY (via Q0)\n    FROM customer c, customer_address ca, customer_demographics\n    WHERE c.c_current_addr_sk = ca.ca_address_sk\n      AND ca_state IN ('CO','NC','TX')\n      AND cd_demo_sk = c.c_current_cdemo_sk\n      AND cd_marital_status IN ('S','M','U')\n      AND cd_education_status IN ('Primary','College')\n      AND exists (SELECT * FROM store_sales, date_filter WHERE c.c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND ss_list_price BETWEEN 80 AND 169)\n      AND not exists (SELECT * FROM web_sales, date_filter WHERE c.c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND ws_list_price BETWEEN 80 AND 169)\n      AND not exists (SELECT * FROM catalog_sales, date_filter WHERE c.c_customer_sk = cs_ship_customer_sk AND cs_sold_date_sk = d_date_sk AND cs_list_price BETWEEN 80 AND 169)\n    GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating\n    ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating",
    "recommended_examples": [
      "multi_dimension_prefetch"
    ]
  },
  {
    "target_id": "t3",
    "family": "F",
    "transform": "explicit_join_restructure",
    "relevance_score": 0.75,
    "hypothesis": "Implicit comma joins prevent optimal predicate pushdown. Convert to explicit INNER JOINs with filtered dimension tables first.",
    "target_ir": "S0 [SELECT]\n  MAIN QUERY (via Q0)\n    FROM customer c\n    INNER JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk AND ca_state IN ('CO','NC','TX')\n    INNER JOIN customer_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk \n      AND cd_marital_status IN ('S','M','U')\n      AND cd_education_status IN ('Primary','College')\n    WHERE exists (...)\n      AND not exists (...)\n      AND not exists (...)\n    GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating\n    ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating",
    "recommended_examples": [
      "pg_explicit_join_materialized"
    ]
  },
  {
    "target_id": "t4",
    "family": "A",
    "transform": "demographics_filter_push",
    "relevance_score": 0.7,
    "hypothesis": "Customer_demographics filters applied late in join sequence. Push cd_marital_status/cd_education_status into customer_demographics scan.",
    "target_ir": "S0 [SELECT]\n  MAIN QUERY (via Q0)\n    FROM customer c, customer_address ca, \n         (SELECT * FROM customer_demographics \n          WHERE cd_marital_status IN ('S','M','U') \n            AND cd_education_status IN ('Primary','College')) cd\n    WHERE c.c_current_addr_sk = ca.ca_address_sk\n      AND ca_state IN ('CO','NC','TX')\n      AND cd.cd_demo_sk = c.c_current_cdemo_sk\n      AND exists (...)\n      AND not exists (...)\n      AND not exists (...)\n    GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating\n    ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating",
    "recommended_examples": [
      "pg_date_cte_explicit_join"
    ]
  }
]