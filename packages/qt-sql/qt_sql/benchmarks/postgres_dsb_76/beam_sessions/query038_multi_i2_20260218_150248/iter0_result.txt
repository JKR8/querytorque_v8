{
  "iteration": 0,
  "n_api_calls": 9,
  "beam_cost_usd": 0.0387412,
  "beam_cost_priced_calls": 9,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 120697,
    "completion_tokens": 23947,
    "total_tokens": 144644,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 24512,
    "reasoning_tokens": 13692
  },
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "p03",
      "family": "F",
      "transform": "materialized_dimension_fact_prefilter",
      "relevance_score": 0.6,
      "status": "NEUTRAL",
      "speedup": 0.97,
      "semantic_passed": true,
      "error": null,
      "original_ms": 1335.5,
      "patch_ms": 1378.9,
      "output_sql": "WITH store_filtered AS (SELECT c.c_last_name, c.c_first_name, d.d_date\nFROM store_sales ss\nJOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk\nJOIN customer c ON ss.ss_customer_sk = c.c_customer_sk\nWHERE d.d_month_seq BETWEEN 1207 AND 1207 + 11\n  AND c.c_birth_month IN (2, 3, 4, 10)\n  AND ss.ss_list_price BETWEEN 241 AND 300\n  AND ss.ss_wholesale_cost BETWEEN 76 AND 96), catalog_filtered AS (SELECT c.c_last_name, c.c_first_name, d.d_date\nFROM catalog_sales cs\nJOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk\nJOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk\nWHERE d.d_month_seq BETWEEN 1207 AND 1207 + 11\n  AND c.c_birth_month IN (2, 3, 4, 10)\n  AND cs.cs_list_price BETWEEN 241 AND 300\n  AND cs.cs_wholesale_cost BETWEEN 76 AND 96), web_filtered AS (SELECT c.c_last_name, c.c_first_name, d.d_date\nFROM web_sales ws\nJOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk\nJOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk\nWHERE d.d_month_seq BETWEEN 1207 AND 1207 + 11\n  AND c.c_birth_month IN (2, 3, 4, 10)\n  AND ws.ws_list_price BETWEEN 241 AND 300\n  AND ws.ws_wholesale_cost BETWEEN 76 AND 96) select  count(*) from (\n    select distinct c_last_name, c_first_name, d_date\n    from store_filtered\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from catalog_filtered\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from web_filtered\n) hot_cust\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Create a CTE that pre-joins filtered date_dim and customer with each fact table separately, materializing the reduced fact rows before distinct and intersect."
    },
    {
      "patch_id": "p04",
      "family": "A",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.55,
      "status": "REGRESSION",
      "speedup": 0.54,
      "semantic_passed": true,
      "error": null,
      "original_ms": 1335.5,
      "patch_ms": 2479.8,
      "output_sql": "WITH filtered_date_dim AS (SELECT d_date_sk, d_date, d_month_seq FROM date_dim WHERE d_month_seq between 1207 and 1207 + 11), channel_1 AS (select distinct c_last_name, c_first_name, d_date\nfrom store_sales\nJOIN filtered_date_dim ON store_sales.ss_sold_date_sk = filtered_date_dim.d_date_sk\n, customer\nwhere store_sales.ss_customer_sk = customer.c_customer_sk\n  and c_birth_month in (2, 3, 4, 10)\n  and ss_list_price between 241 and 300\n  and ss_wholesale_cost BETWEEN 76 AND 96), channel_2 AS (select distinct c_last_name, c_first_name, d_date\nfrom catalog_sales\nJOIN filtered_date_dim ON catalog_sales.cs_sold_date_sk = filtered_date_dim.d_date_sk\n, customer\nwhere catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n  and c_birth_month in (2, 3, 4, 10)\n  and cs_list_price between 241 and 300\n  and cs_wholesale_cost BETWEEN 76 AND 96), channel_3 AS (select distinct c_last_name, c_first_name, d_date\nfrom web_sales\nJOIN filtered_date_dim ON web_sales.ws_sold_date_sk = filtered_date_dim.d_date_sk\n, customer\nwhere web_sales.ws_bill_customer_sk = customer.c_customer_sk\n  and d_month_seq between 1207 and 1207 + 11\n  and c_birth_month in (2, 3, 4, 10)\n  and ws_list_price between 241 and 300\n  and ws_wholesale_cost BETWEEN 76 AND 96) select  count(*) from (\n    select distinct c_last_name, c_first_name, d_date\n    from store_sales\n    JOIN filtered_date_dim ON store_sales.ss_sold_date_sk = filtered_date_dim.d_date_sk\n    , customer\n    where store_sales.ss_customer_sk = customer.c_customer_sk\n      and c_birth_month in (2, 3, 4, 10)\n      and ss_list_price between 241 and 300\n      and ss_wholesale_cost BETWEEN 76 AND 96\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from catalog_sales\n    JOIN filtered_date_dim ON catalog_sales.cs_sold_date_sk = filtered_date_dim.d_date_sk\n    , customer\n    where catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n      and c_birth_month in (2, 3, 4, 10)\n      and cs_list_price between 241 and 300\n      and cs_wholesale_cost BETWEEN 76 AND 96\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from web_sales\n    JOIN filtered_date_dim ON web_sales.ws_sold_date_sk = filtered_date_dim.d_date_sk\n    , customer\n    where web_sales.ws_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1207 and 1207 + 11\n      and c_birth_month in (2, 3, 4, 10)\n      and ws_list_price between 241 and 300\n      and ws_wholesale_cost BETWEEN 76 AND 96\n) hot_cust\nlimit 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Extract filtered date_dim into a CTE, then join it with each fact table using explicit JOIN syntax, keeping other joins as comma joins."
    },
    {
      "patch_id": "p01",
      "family": "D",
      "transform": "intersect_to_exists",
      "relevance_score": 0.75,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Checksum mismatch",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "SELECT COUNT(*) FROM (SELECT DISTINCT c.c_last_name, c.c_first_name, d.d_date FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk WHERE d.d_month_seq BETWEEN 1207 AND 1218 AND c.c_birth_month IN (2, 3, 4, 10) AND ss.ss_list_price BETWEEN 241 AND 300 AND ss.ss_wholesale_cost BETWEEN 76 AND 96 AND EXISTS (SELECT 1 FROM catalog_sales cs JOIN date_dim d2 ON cs.cs_sold_date_sk = d2.d_date_sk JOIN customer c2 ON cs.cs_bill_customer_sk = c2.c_customer_sk WHERE d2.d_month_seq BETWEEN 1207 AND 1218 AND c2.c_birth_month IN (2, 3, 4, 10) AND cs.cs_list_price BETWEEN 241 AND 300 AND cs.cs_wholesale_cost BETWEEN 76 AND 96 AND c2.c_last_name = c.c_last_name AND c2.c_first_name = c.c_first_name AND d2.d_date = d.d_date) AND EXISTS (SELECT 1 FROM web_sales ws JOIN date_dim d3 ON ws.ws_sold_date_sk = d3.d_date_sk JOIN customer c3 ON ws.ws_bill_customer_sk = c3.c_customer_sk WHERE d3.d_month_seq BETWEEN 1207 AND 1218 AND c3.c_birth_month IN (2, 3, 4, 10) AND ws.ws_list_price BETWEEN 241 AND 300 AND ws.ws_wholesale_cost BETWEEN 76 AND 96 AND c3.c_last_name = c.c_last_name AND c3.c_first_name = c.c_first_name AND d3.d_date = d.d_date)) hot_cust LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Replace INTERSECT with EXISTS semi-joins: compute one channel (e.g., store_sales) as base, then filter rows that also exist in other channels via correlated EXISTS on (c_last_name, c_first_name, d_date)."
    },
    {
      "patch_id": "p02",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.7,
      "status": "REGRESSION",
      "speedup": 0.66,
      "semantic_passed": true,
      "error": null,
      "original_ms": 1335.5,
      "patch_ms": 2013.5,
      "output_sql": "WITH filtered_date_dim AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq BETWEEN 1207 AND 1218), filtered_customer AS (SELECT c_customer_sk, c_last_name, c_first_name FROM customer WHERE c_birth_month IN (2, 3, 4, 10)), channel_1 AS (SELECT DISTINCT c.c_last_name, c.c_first_name, d.d_date FROM store_sales ss JOIN filtered_date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN filtered_customer c ON ss.ss_customer_sk = c.c_customer_sk WHERE ss.ss_list_price BETWEEN 241 AND 300 AND ss.ss_wholesale_cost BETWEEN 76 AND 96), channel_2 AS (SELECT DISTINCT c.c_last_name, c.c_first_name, d.d_date FROM catalog_sales cs JOIN filtered_date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN filtered_customer c ON cs.cs_bill_customer_sk = c.c_customer_sk WHERE cs.cs_list_price BETWEEN 241 AND 300 AND cs.cs_wholesale_cost BETWEEN 76 AND 96), channel_3 AS (SELECT DISTINCT c.c_last_name, c.c_first_name, d.d_date FROM web_sales ws JOIN filtered_date_dim d ON ws.ws_sold_date_sk = d.d_date_sk JOIN filtered_customer c ON ws.ws_bill_customer_sk = c.c_customer_sk WHERE ws.ws_list_price BETWEEN 241 AND 300 AND ws.ws_wholesale_cost BETWEEN 76 AND 96) SELECT COUNT(*) FROM (SELECT DISTINCT c_last_name, c_first_name, d_date FROM channel_1 INTERSECT SELECT DISTINCT c_last_name, c_first_name, d_date FROM channel_2 INTERSECT SELECT DISTINCT c_last_name, c_first_name, d_date FROM channel_3) hot_cust LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Pre-filter date_dim and customer into CTEs, then join each fact table with these CTEs using explicit JOIN syntax. Reuse the same dimension CTEs across all three channels."
    },
    {
      "patch_id": "compile_p1",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Checksum mismatch",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "SELECT COUNT(*) FROM (SELECT DISTINCT c_last_name, c_first_name, d_date FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk WHERE d_month_seq BETWEEN 1207 AND 1218 AND c_birth_month IN (2, 3, 4, 10) AND ss_list_price BETWEEN 241 AND 300 AND ss_wholesale_cost BETWEEN 76 AND 96 AND EXISTS (SELECT 1 FROM catalog_sales cs JOIN date_dim d2 ON cs.cs_sold_date_sk = d2.d_date_sk JOIN customer c2 ON cs.cs_bill_customer_sk = c2.c_customer_sk WHERE d2.d_month_seq BETWEEN 1207 AND 1218 AND c2.c_birth_month IN (2, 3, 4, 10) AND cs_list_price BETWEEN 241 AND 300 AND cs_wholesale_cost BETWEEN 76 AND 96 AND c2.c_last_name = c.c_last_name AND c2.c_first_name = c.c_first_name AND d2.d_date = d.d_date) AND EXISTS (SELECT 1 FROM web_sales ws JOIN date_dim d3 ON ws.ws_sold_date_sk = d3.d_date_sk JOIN customer c3 ON ws.ws_bill_customer_sk = c3.c_customer_sk WHERE d3.d_month_seq BETWEEN 1207 AND 1218 AND c3.c_birth_month IN (2, 3, 4, 10) AND ws_list_price BETWEEN 241 AND 300 AND ws_wholesale_cost BETWEEN 76 AND 96 AND c3.c_last_name = c.c_last_name AND c3.c_first_name = c.c_first_name AND d3.d_date = d.d_date)) hot_cust LIMIT 100;",
      "has_explain": false,
      "description": null
    }
  ],
  "explains": {
    "p03": "Limit  (rows=1, time=1560.693)\n  Aggregate  (rows=1, time=1560.691)\n    Subquery Scan (hot_cust)  (rows=45, time=1560.681)\n      SetOp  (rows=45, time=1560.675)\n        Append  (rows=21988, time=1555.5)\n          Subquery Scan (*SELECT* 3)  (rows=21773, time=286.417)\n            Unique  (rows=21773, time=285.338)\n              Gather Merge  (rows=27322, time=283.51)\n                Sort  (rows=13661, time=252.03)\n                  Nested Loop  (rows=13661, time=238.07)\n                    Nested",
    "p04": "Limit  (rows=1, time=2566.489)\n  Index Scan on date_dim  (rows=365, time=0.286)\n  Aggregate  (rows=1, time=2566.486)\n    Subquery Scan (hot_cust)  (rows=45, time=2566.479)\n      SetOp  (rows=45, time=2566.473)\n        Append  (rows=21988, time=2561.296)\n          Subquery Scan (*SELECT* 3)  (rows=21773, time=529.947)\n            Unique  (rows=21773, time=528.866)\n              Sort  (rows=27322, time=527.022)\n                Nested Loop  (rows=27322, time=494.62)\n                  Nested Loop  (",
    "p02": "Limit  (rows=1, time=2020.505)\n  Index Scan on date_dim  (rows=365, time=0.213)\n  Seq Scan on customer  (rows=233218, time=55.335)\n  Aggregate  (rows=1, time=2020.502)\n    Subquery Scan (hot_cust)  (rows=45, time=2020.497)\n      SetOp  (rows=45, time=2020.493)\n        Append  (rows=21988, time=2018.625)\n          Result  (rows=215, time=1677.017)\n            SetOp  (rows=215, time=1676.996)\n              Append  (rows=82642, time=1667.668)\n                Subquery Scan (*SELECT* 2)  (rows=20799,"
  }
}