{
  "iteration": 0,
  "n_api_calls": 4,
  "beam_cost_usd": 0.00841392,
  "beam_cost_priced_calls": 1,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 21350,
    "completion_tokens": 7534,
    "total_tokens": 28884,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 0,
    "reasoning_tokens": 4714
  },
  "best_speedup": 1.3,
  "best_patch_id": "p02",
  "best_sql": "WITH date_cte AS (select d_date_sk, d_date from date_dim where d_date between cast('1998-08-29' as date) and cast('1998-08-29' as date) + interval '30 day'), ssr AS (select  s_store_id as store_id,\n         sum(ss_ext_sales_price) as sales,\n         sum(coalesce(sr_return_amt, 0)) as returns,\n         sum(ss_net_profit - coalesce(sr_net_loss, 0)) as profit\n from store_sales left outer join store_returns on\n        (ss_item_sk = sr_item_sk and ss_ticket_number = sr_ticket_number)\n        JOIN date_cte d on ss_sold_date_sk = d.d_date_sk\n        JOIN store on ss_store_sk = s_store_sk\n        JOIN item on ss_item_sk = i_item_sk\n        JOIN promotion on ss_promo_sk = p_promo_sk\nwhere d.d_date between cast('1998-08-29' as date)\n                  and cast('1998-08-29' as date) + interval '30 day'\n      and i_current_price > 50\n      and p_channel_email = 'N'\n      and p_channel_tv = 'N'\n      and p_channel_radio = 'N'\n      and p_channel_press = 'N'\n      and p_channel_event = 'N'\n      and ss_wholesale_cost BETWEEN 23 AND 38\n      and i_category IN ('Children', 'Sports')\ngroup by s_store_id), csr AS (select  cp_catalog_page_id as catalog_page_id,\n         sum(cs_ext_sales_price) as sales,\n         sum(coalesce(cr_return_amount, 0)) as returns,\n         sum(cs_net_profit - coalesce(cr_net_loss, 0)) as profit\n from catalog_sales left outer join catalog_returns on\n        (cs_item_sk = cr_item_sk and cs_order_number = cr_order_number)\n        JOIN date_cte d on cs_sold_date_sk = d.d_date_sk\n        JOIN catalog_page on cs_catalog_page_sk = cp_catalog_page_sk\n        JOIN item on cs_item_sk = i_item_sk\n        JOIN promotion on cs_promo_sk = p_promo_sk\nwhere d.d_date between cast('1998-08-29' as date)\n                  and cast('1998-08-29' as date) + interval '30 day'\n      and i_current_price > 50\n      and p_channel_email = 'N'\n      and p_channel_tv = 'N'\n      and p_channel_radio = 'N'\n      and p_channel_press = 'N'\n      and p_channel_event = 'N'\n      and cs_wholesale_cost BETWEEN 23 AND 38\n      and i_category IN ('Children', 'Sports')\ngroup by cp_catalog_page_id), wsr AS (select  web_site_id,\n         sum(ws_ext_sales_price) as sales,\n         sum(coalesce(wr_return_amt, 0)) as returns,\n         sum(ws_net_profit - coalesce(wr_net_loss, 0)) as profit\n from web_sales left outer join web_returns on\n        (ws_item_sk = wr_item_sk and ws_order_number = wr_order_number)\n        JOIN date_cte d on ws_sold_date_sk = d.d_date_sk\n        JOIN web_site on ws_web_site_sk = web_site_sk\n        JOIN item on ws_item_sk = i_item_sk\n        JOIN promotion on ws_promo_sk = p_promo_sk\nwhere d.d_date between cast('1998-08-29' as date)\n                  and cast('1998-08-29' as date) + interval '30 day'\n      and i_current_price > 50\n      and p_channel_email = 'N'\n      and p_channel_tv = 'N'\n      and p_channel_radio = 'N'\n      and p_channel_press = 'N'\n      and p_channel_event = 'N'\n      and ws_wholesale_cost BETWEEN 23 AND 38\n      and i_category IN ('Children', 'Sports')\ngroup by web_site_id) SELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, returns, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, returns, profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, returns, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100;",
  "patches": [
    {
      "patch_id": "p02",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.78,
      "status": "WIN",
      "speedup": 1.3,
      "semantic_passed": true,
      "correctness_verified": true,
      "error": null,
      "original_ms": 97.2,
      "patch_ms": 74.6,
      "output_sql": "WITH date_cte AS (select d_date_sk, d_date from date_dim where d_date between cast('1998-08-29' as date) and cast('1998-08-29' as date) + interval '30 day'), ssr AS (select  s_store_id as store_id,\n         sum(ss_ext_sales_price) as sales,\n         sum(coalesce(sr_return_amt, 0)) as returns,\n         sum(ss_net_profit - coalesce(sr_net_loss, 0)) as profit\n from store_sales left outer join store_returns on\n        (ss_item_sk = sr_item_sk and ss_ticket_number = sr_ticket_number)\n        JOIN date_cte d on ss_sold_date_sk = d.d_date_sk\n        JOIN store on ss_store_sk = s_store_sk\n        JOIN item on ss_item_sk = i_item_sk\n        JOIN promotion on ss_promo_sk = p_promo_sk\nwhere d.d_date between cast('1998-08-29' as date)\n                  and cast('1998-08-29' as date) + interval '30 day'\n      and i_current_price > 50\n      and p_channel_email = 'N'\n      and p_channel_tv = 'N'\n      and p_channel_radio = 'N'\n      and p_channel_press = 'N'\n      and p_channel_event = 'N'\n      and ss_wholesale_cost BETWEEN 23 AND 38\n      and i_category IN ('Children', 'Sports')\ngroup by s_store_id), csr AS (select  cp_catalog_page_id as catalog_page_id,\n         sum(cs_ext_sales_price) as sales,\n         sum(coalesce(cr_return_amount, 0)) as returns,\n         sum(cs_net_profit - coalesce(cr_net_loss, 0)) as profit\n from catalog_sales left outer join catalog_returns on\n        (cs_item_sk = cr_item_sk and cs_order_number = cr_order_number)\n        JOIN date_cte d on cs_sold_date_sk = d.d_date_sk\n        JOIN catalog_page on cs_catalog_page_sk = cp_catalog_page_sk\n        JOIN item on cs_item_sk = i_item_sk\n        JOIN promotion on cs_promo_sk = p_promo_sk\nwhere d.d_date between cast('1998-08-29' as date)\n                  and cast('1998-08-29' as date) + interval '30 day'\n      and i_current_price > 50\n      and p_channel_email = 'N'\n      and p_channel_tv = 'N'\n      and p_channel_radio = 'N'\n      and p_channel_press = 'N'\n      and p_channel_event = 'N'\n      and cs_wholesale_cost BETWEEN 23 AND 38\n      and i_category IN ('Children', 'Sports')\ngroup by cp_catalog_page_id), wsr AS (select  web_site_id,\n         sum(ws_ext_sales_price) as sales,\n         sum(coalesce(wr_return_amt, 0)) as returns,\n         sum(ws_net_profit - coalesce(wr_net_loss, 0)) as profit\n from web_sales left outer join web_returns on\n        (ws_item_sk = wr_item_sk and ws_order_number = wr_order_number)\n        JOIN date_cte d on ws_sold_date_sk = d.d_date_sk\n        JOIN web_site on ws_web_site_sk = web_site_sk\n        JOIN item on ws_item_sk = i_item_sk\n        JOIN promotion on ws_promo_sk = p_promo_sk\nwhere d.d_date between cast('1998-08-29' as date)\n                  and cast('1998-08-29' as date) + interval '30 day'\n      and i_current_price > 50\n      and p_channel_email = 'N'\n      and p_channel_tv = 'N'\n      and p_channel_radio = 'N'\n      and p_channel_press = 'N'\n      and p_channel_event = 'N'\n      and ws_wholesale_cost BETWEEN 23 AND 38\n      and i_category IN ('Children', 'Sports')\ngroup by web_site_id) SELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, returns, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, returns, profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, returns, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Isolate date_dim filter into a single CTE and convert comma joins to explicit JOIN syntax in each channel CTE, leaving other dimensions inline."
    },
    {
      "patch_id": "p03",
      "family": "A",
      "transform": "shared_dimension_multi_channel",
      "relevance_score": 0.55,
      "status": "REGRESSION",
      "speedup": 0.01,
      "semantic_passed": true,
      "correctness_verified": true,
      "error": null,
      "original_ms": 97.2,
      "patch_ms": 11257.9,
      "output_sql": "WITH shared_dim AS (select d_date_sk, i_item_sk, p_promo_sk\nfrom date_dim, item, promotion\nwhere d_date between cast('1998-08-29' as date)\n             and cast('1998-08-29' as date) + interval '30 day'\n  and i_current_price > 50\n  and i_category IN ('Children', 'Sports')\n  and p_channel_email = 'N'\n  and p_channel_tv = 'N'\n  and p_channel_radio = 'N'\n  and p_channel_press = 'N'\n  and p_channel_event = 'N'), ssr AS (select  s_store_id as store_id,\n         sum(ss_ext_sales_price) as sales,\n         sum(coalesce(sr_return_amt, 0)) as returns,\n         sum(ss_net_profit - coalesce(sr_net_loss, 0)) as profit\n from store_sales left outer join store_returns on\n        (ss_item_sk = sr_item_sk and ss_ticket_number = sr_ticket_number)\n        join shared_dim on ss_sold_date_sk = shared_dim.d_date_sk\n                          and ss_item_sk = shared_dim.i_item_sk\n                          and ss_promo_sk = shared_dim.p_promo_sk\n     ,\n    store\n where ss_store_sk = s_store_sk\n       and ss_wholesale_cost BETWEEN 23 AND 38\n group by s_store_id), csr AS (select  cp_catalog_page_id as catalog_page_id,\n         sum(cs_ext_sales_price) as sales,\n         sum(coalesce(cr_return_amount, 0)) as returns,\n         sum(cs_net_profit - coalesce(cr_net_loss, 0)) as profit\n from catalog_sales left outer join catalog_returns on\n        (cs_item_sk = cr_item_sk and cs_order_number = cr_order_number)\n        join shared_dim on cs_sold_date_sk = shared_dim.d_date_sk\n                          and cs_item_sk = shared_dim.i_item_sk\n                          and cs_promo_sk = shared_dim.p_promo_sk\n     ,\n    catalog_page\n where cs_catalog_page_sk = cp_catalog_page_sk\n       and cs_wholesale_cost BETWEEN 23 AND 38\n group by cp_catalog_page_id), wsr AS (select  web_site_id,\n         sum(ws_ext_sales_price) as sales,\n         sum(coalesce(wr_return_amt, 0)) as returns,\n         sum(ws_net_profit - coalesce(wr_net_loss, 0)) as profit\n from web_sales left outer join web_returns on\n        (ws_item_sk = wr_item_sk and ws_order_number = wr_order_number)\n        join shared_dim on ws_sold_date_sk = shared_dim.d_date_sk\n                          and ws_item_sk = shared_dim.i_item_sk\n                          and ws_promo_sk = shared_dim.p_promo_sk\n     ,\n    web_site\n where ws_web_site_sk = web_site_sk\n       and ws_wholesale_cost BETWEEN 23 AND 38\n group by web_site_id) SELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, returns, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, returns, profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, returns, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Extract shared dimension filters (date_dim, promotion, item) into a single CTE referenced by all three channel CTEs to avoid redundant scans."
    },
    {
      "patch_id": "p01",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.85,
      "status": "REGRESSION",
      "speedup": 0.68,
      "semantic_passed": true,
      "correctness_verified": true,
      "error": null,
      "original_ms": 97.2,
      "patch_ms": 142.0,
      "output_sql": "WITH date_prefetch AS (select d_date_sk, d_date from date_dim where d_date between cast('1998-08-29' as date) and cast('1998-08-29' as date) + interval '30 day'), promo_prefetch AS (select p_promo_sk, p_channel_email, p_channel_tv, p_channel_radio, p_channel_press, p_channel_event from promotion where p_channel_email = 'N' and p_channel_tv = 'N' and p_channel_radio = 'N' and p_channel_press = 'N' and p_channel_event = 'N'), item_prefetch AS (select i_item_sk, i_current_price, i_category from item where i_current_price > 50 and i_category IN ('Children', 'Sports')), ssr AS (select s_store_id as store_id, sum(ss_ext_sales_price) as sales, sum(coalesce(sr_return_amt, 0)) as returns, sum(ss_net_profit - coalesce(sr_net_loss, 0)) as profit from store_sales left outer join store_returns on (ss_item_sk = sr_item_sk and ss_ticket_number = sr_ticket_number) join date_prefetch on ss_sold_date_sk = date_prefetch.d_date_sk join store on ss_store_sk = s_store_sk join item_prefetch on ss_item_sk = item_prefetch.i_item_sk join promo_prefetch on ss_promo_sk = promo_prefetch.p_promo_sk where date_prefetch.d_date between cast('1998-08-29' as date) and cast('1998-08-29' as date) + interval '30 day' and item_prefetch.i_current_price > 50 and item_prefetch.i_category IN ('Children', 'Sports') and promo_prefetch.p_channel_email = 'N' and promo_prefetch.p_channel_tv = 'N' and promo_prefetch.p_channel_radio = 'N' and promo_prefetch.p_channel_press = 'N' and promo_prefetch.p_channel_event = 'N' and ss_wholesale_cost BETWEEN 23 AND 38 group by s_store_id), csr AS (select cp_catalog_page_id as catalog_page_id, sum(cs_ext_sales_price) as sales, sum(coalesce(cr_return_amount, 0)) as returns, sum(cs_net_profit - coalesce(cr_net_loss, 0)) as profit from catalog_sales left outer join catalog_returns on (cs_item_sk = cr_item_sk and cs_order_number = cr_order_number) join date_prefetch on cs_sold_date_sk = date_prefetch.d_date_sk join catalog_page on cs_catalog_page_sk = cp_catalog_page_sk join item_prefetch on cs_item_sk = item_prefetch.i_item_sk join promo_prefetch on cs_promo_sk = promo_prefetch.p_promo_sk where date_prefetch.d_date between cast('1998-08-29' as date) and cast('1998-08-29' as date) + interval '30 day' and item_prefetch.i_current_price > 50 and item_prefetch.i_category IN ('Children', 'Sports') and promo_prefetch.p_channel_email = 'N' and promo_prefetch.p_channel_tv = 'N' and promo_prefetch.p_channel_radio = 'N' and promo_prefetch.p_channel_press = 'N' and promo_prefetch.p_channel_event = 'N' and cs_wholesale_cost BETWEEN 23 AND 38 group by cp_catalog_page_id), wsr AS (select web_site_id, sum(ws_ext_sales_price) as sales, sum(coalesce(wr_return_amt, 0)) as returns, sum(ws_net_profit - coalesce(wr_net_loss, 0)) as profit from web_sales left outer join web_returns on (ws_item_sk = wr_item_sk and ws_order_number = wr_order_number) join date_prefetch on ws_sold_date_sk = date_prefetch.d_date_sk join web_site on ws_web_site_sk = web_site_sk join item_prefetch on ws_item_sk = item_prefetch.i_item_sk join promo_prefetch on ws_promo_sk = promo_prefetch.p_promo_sk where date_prefetch.d_date between cast('1998-08-29' as date) and cast('1998-08-29' as date) + interval '30 day' and item_prefetch.i_current_price > 50 and item_prefetch.i_category IN ('Children', 'Sports') and promo_prefetch.p_channel_email = 'N' and promo_prefetch.p_channel_tv = 'N' and promo_prefetch.p_channel_radio = 'N' and promo_prefetch.p_channel_press = 'N' and promo_prefetch.p_channel_event = 'N' and ws_wholesale_cost BETWEEN 23 AND 38 group by web_site_id) SELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, returns, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, returns, profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, returns, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100;",
      "has_explain": true,
      "description": "[scout:qwen/qwen3-coder] Convert comma joins to explicit JOIN syntax and pre-filter selective dimensions (date_dim, promotion, item) into separate CTEs before joining with fact tables in each channel CTE."
    },
    {
      "patch_id": "p04",
      "family": "F",
      "transform": "inner_join_conversion",
      "relevance_score": 0.45,
      "status": "Row count mismatch",
      "speedup": 0.0,
      "semantic_passed": true,
      "correctness_verified": false,
      "error": "Row count mismatch: original=14, patch=3",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH ssr AS (select s_store_id as store_id, sum(ss_ext_sales_price) as sales, sum(coalesce(sr_return_amt, 0)) as returns, sum(ss_net_profit - coalesce(sr_net_loss, 0)) as profit from store_sales inner join store_returns on (ss_item_sk = sr_item_sk and ss_ticket_number = sr_ticket_number), date_dim, store, item, promotion where ss_sold_date_sk = d_date_sk and d_date between cast('1998-08-29' as date) and cast('1998-08-29' as date) + interval '30 day' and ss_store_sk = s_store_sk and ss_item_sk = i_item_sk and i_current_price > 50 and ss_promo_sk = p_promo_sk and p_channel_email = 'N' and p_channel_tv = 'N' and p_channel_radio = 'N' and p_channel_press = 'N' and p_channel_event = 'N' and ss_wholesale_cost BETWEEN 23 AND 38 and i_category IN ('Children', 'Sports') group by s_store_id), csr AS (select cp_catalog_page_id as catalog_page_id, sum(cs_ext_sales_price) as sales, sum(coalesce(cr_return_amount, 0)) as returns, sum(cs_net_profit - coalesce(cr_net_loss, 0)) as profit from catalog_sales inner join catalog_returns on (cs_item_sk = cr_item_sk and cs_order_number = cr_order_number), date_dim, catalog_page, item, promotion where cs_sold_date_sk = d_date_sk and d_date between cast('1998-08-29' as date) and cast('1998-08-29' as date) + interval '30 day' and cs_catalog_page_sk = cp_catalog_page_sk and cs_item_sk = i_item_sk and i_current_price > 50 and cs_promo_sk = p_promo_sk and p_channel_email = 'N' and p_channel_tv = 'N' and p_channel_radio = 'N' and p_channel_press = 'N' and p_channel_event = 'N' and cs_wholesale_cost BETWEEN 23 AND 38 and i_category IN ('Children', 'Sports') group by cp_catalog_page_id), wsr AS (select web_site_id, sum(ws_ext_sales_price) as sales, sum(coalesce(wr_return_amt, 0)) as returns, sum(ws_net_profit - coalesce(wr_net_loss, 0)) as profit from web_sales inner join web_returns on (ws_item_sk = wr_item_sk and ws_order_number = wr_order_number), date_dim, web_site, item, promotion where ws_sold_date_sk = d_date_sk and d_date between cast('1998-08-29' as date) and cast('1998-08-29' as date) + interval '30 day' and ws_web_site_sk = web_site_sk and ws_item_sk = i_item_sk and i_current_price > 50 and ws_promo_sk = p_promo_sk and p_channel_email = 'N' and p_channel_tv = 'N' and p_channel_radio = 'N' and p_channel_press = 'N' and p_channel_event = 'N' and ws_wholesale_cost BETWEEN 23 AND 38 and i_category IN ('Children', 'Sports') group by web_site_id) SELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, returns, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, returns, profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, returns, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100;",
      "has_explain": false,
      "description": "[scout:qwen/qwen3-coder] Convert LEFT OUTER JOIN with returns tables to INNER JOIN since returns columns are coalesced with zero and profit calculation uses returns net loss."
    },
    {
      "patch_id": "compile_p02_enhanced",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 1.25,
      "semantic_passed": true,
      "correctness_verified": true,
      "error": null,
      "original_ms": 96.7,
      "patch_ms": 77.4,
      "output_sql": "WITH date_cte AS (SELECT d_date_sk, d_date\nFROM date_dim\nWHERE d_date BETWEEN cast('1998-08-29' AS date) AND cast('1998-08-29' AS date) + interval '30 day'), ssr AS (SELECT s_store_id AS store_id,\n       sum(ss_ext_sales_price) AS sales,\n       sum(coalesce(sr_return_amt, 0)) AS returns,\n       sum(ss_net_profit - coalesce(sr_net_loss, 0)) AS profit\nFROM store_sales\nLEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number)\nJOIN date_cte d ON ss_sold_date_sk = d.d_date_sk\nJOIN store ON ss_store_sk = s_store_sk\nJOIN item ON ss_item_sk = i_item_sk\nJOIN promotion ON ss_promo_sk = p_promo_sk\nWHERE i_current_price > 50\n  AND p_channel_email = 'N'\n  AND p_channel_tv = 'N'\n  AND p_channel_radio = 'N'\n  AND p_channel_press = 'N'\n  AND p_channel_event = 'N'\n  AND ss_wholesale_cost BETWEEN 23 AND 38\n  AND i_category IN ('Children', 'Sports')\nGROUP BY s_store_id), csr AS (SELECT cp_catalog_page_id AS catalog_page_id,\n       sum(cs_ext_sales_price) AS sales,\n       sum(coalesce(cr_return_amount, 0)) AS returns,\n       sum(cs_net_profit - coalesce(cr_net_loss, 0)) AS profit\nFROM catalog_sales\nLEFT OUTER JOIN catalog_returns ON (cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number)\nJOIN date_cte d ON cs_sold_date_sk = d.d_date_sk\nJOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk\nJOIN item ON cs_item_sk = i_item_sk\nJOIN promotion ON cs_promo_sk = p_promo_sk\nWHERE i_current_price > 50\n  AND p_channel_email = 'N'\n  AND p_channel_tv = 'N'\n  AND p_channel_radio = 'N'\n  AND p_channel_press = 'N'\n  AND p_channel_event = 'N'\n  AND cs_wholesale_cost BETWEEN 23 AND 38\n  AND i_category IN ('Children', 'Sports')\nGROUP BY cp_catalog_page_id), wsr AS (SELECT web_site_id,\n       sum(ws_ext_sales_price) AS sales,\n       sum(coalesce(wr_return_amt, 0)) AS returns,\n       sum(ws_net_profit - coalesce(wr_net_loss, 0)) AS profit\nFROM web_sales\nLEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number)\nJOIN date_cte d ON ws_sold_date_sk = d.d_date_sk\nJOIN web_site ON ws_web_site_sk = web_site_sk\nJOIN item ON ws_item_sk = i_item_sk\nJOIN promotion ON ws_promo_sk = p_promo_sk\nWHERE i_current_price > 50\n  AND p_channel_email = 'N'\n  AND p_channel_tv = 'N'\n  AND p_channel_radio = 'N'\n  AND p_channel_press = 'N'\n  AND p_channel_event = 'N'\n  AND ws_wholesale_cost BETWEEN 23 AND 38\n  AND i_category IN ('Children', 'Sports')\nGROUP BY web_site_id) SELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, returns, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, returns, profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, returns, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100;",
      "has_explain": true,
      "description": null
    },
    {
      "patch_id": "compile_date_promo_cte",
      "family": "?",
      "transform": "tree_rewrite",
      "relevance_score": 1.0,
      "status": "WIN",
      "speedup": 1.17,
      "semantic_passed": true,
      "correctness_verified": true,
      "error": null,
      "original_ms": 96.7,
      "patch_ms": 82.7,
      "output_sql": "WITH date_cte AS (SELECT d_date_sk, d_date\nFROM date_dim\nWHERE d_date BETWEEN cast('1998-08-29' AS date) AND cast('1998-08-29' AS date) + interval '30 day'), promo_cte AS (SELECT p_promo_sk\nFROM promotion\nWHERE p_channel_email = 'N'\n  AND p_channel_tv = 'N'\n  AND p_channel_radio = 'N'\n  AND p_channel_press = 'N'\n  AND p_channel_event = 'N'), ssr AS (SELECT s_store_id AS store_id,\n       sum(ss_ext_sales_price) AS sales,\n       sum(coalesce(sr_return_amt, 0)) AS returns,\n       sum(ss_net_profit - coalesce(sr_net_loss, 0)) AS profit\nFROM store_sales\nLEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number)\nJOIN date_cte d ON ss_sold_date_sk = d.d_date_sk\nJOIN store ON ss_store_sk = s_store_sk\nJOIN item ON ss_item_sk = i_item_sk\nJOIN promo_cte p ON ss_promo_sk = p.p_promo_sk\nWHERE i_current_price > 50\n  AND ss_wholesale_cost BETWEEN 23 AND 38\n  AND i_category IN ('Children', 'Sports')\nGROUP BY s_store_id), csr AS (SELECT cp_catalog_page_id AS catalog_page_id,\n       sum(cs_ext_sales_price) AS sales,\n       sum(coalesce(cr_return_amount, 0)) AS returns,\n       sum(cs_net_profit - coalesce(cr_net_loss, 0)) AS profit\nFROM catalog_sales\nLEFT OUTER JOIN catalog_returns ON (cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number)\nJOIN date_cte d ON cs_sold_date_sk = d.d_date_sk\nJOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk\nJOIN item ON cs_item_sk = i_item_sk\nJOIN promo_cte p ON cs_promo_sk = p.p_promo_sk\nWHERE i_current_price > 50\n  AND cs_wholesale_cost BETWEEN 23 AND 38\n  AND i_category IN ('Children', 'Sports')\nGROUP BY cp_catalog_page_id), wsr AS (SELECT web_site_id,\n       sum(ws_ext_sales_price) AS sales,\n       sum(coalesce(wr_return_amt, 0)) AS returns,\n       sum(ws_net_profit - coalesce(wr_net_loss, 0)) AS profit\nFROM web_sales\nLEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number)\nJOIN date_cte d ON ws_sold_date_sk = d.d_date_sk\nJOIN web_site ON ws_web_site_sk = web_site_sk\nJOIN item ON ws_item_sk = i_item_sk\nJOIN promo_cte p ON ws_promo_sk = p.p_promo_sk\nWHERE i_current_price > 50\n  AND ws_wholesale_cost BETWEEN 23 AND 38\n  AND i_category IN ('Children', 'Sports')\nGROUP BY web_site_id) SELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || store_id AS id, sales, returns, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page_id AS id, sales, returns, profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, returns, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100;",
      "has_explain": true,
      "description": null
    }
  ],
  "explains": {
    "p02": "Limit  (cost=3436.19..3436.36 rows=7 width=160) (actual time=74.061..74.101 rows=14 loops=1)\n  CTE date_cte\n    ->  Index Scan using _dta_index_date_dim_6_661577395__k4_k3 on date_dim  (cost=0.29..1599.11 rows=33 width=8) (actual time=0.671..1.331 rows=31 loops=1)\n          Index Cond: ((d_date >= '1998-08-29'::date) AND (d_date <= '1998-09-28 00:00:00'::timestamp without time zone))\n  ->  GroupAggregate  (cost=1837.08..1837.25 rows=7 width=160) (actual time=74.059..74.096 rows=14 loops=1)\n     ",
    "p03": "Limit  (cost=3068034.30..3068036.79 rows=100 width=160) (actual time=11468.346..11468.491 rows=14 loops=1)\n  CTE shared_dim\n    ->  Nested Loop  (cost=0.29..18001.65 rows=629706 width=12) (actual time=0.585..61.264 rows=457281 loops=1)\n          ->  Seq Scan on item  (cost=0.00..8500.00 rows=1363 width=4) (actual time=0.024..27.614 rows=1341 loops=1)\n                Filter: ((i_current_price > '50'::numeric) AND (i_category = ANY ('{Children,Sports}'::bpchar[])))\n                Rows Removed by ",
    "p01": "Limit  (cost=10362.06..10362.23 rows=7 width=160) (actual time=157.571..157.606 rows=14 loops=1)\n  CTE date_prefetch\n    ->  Index Scan using _dta_index_date_dim_6_661577395__k4_k3 on date_dim  (cost=0.29..1599.11 rows=33 width=8) (actual time=0.503..1.178 rows=31 loops=1)\n          Index Cond: ((d_date >= '1998-08-29'::date) AND (d_date <= '1998-09-28 00:00:00'::timestamp without time zone))\n  CTE promo_prefetch\n    ->  Seq Scan on promotion  (cost=0.00..24.25 rows=14 width=14) (actual time=0.0",
    "compile_p02_enhanced": "Limit  (cost=84847.33..84848.95 rows=65 width=160) (actual time=76.042..76.089 rows=14 loops=1)\n  CTE date_cte\n    ->  Index Scan using _dta_index_date_dim_6_661577395__k4_k3 on date_dim  (cost=0.29..1599.11 rows=33 width=8) (actual time=0.670..1.392 rows=31 loops=1)\n          Index Cond: ((d_date >= '1998-08-29'::date) AND (d_date <= '1998-09-28 00:00:00'::timestamp without time zone))\n  ->  GroupAggregate  (cost=83248.22..83249.84 rows=65 width=160) (actual time=76.041..76.086 rows=14 loops=1)",
    "compile_date_promo_cte": "Limit  (cost=85009.07..85010.69 rows=65 width=160) (actual time=78.773..78.813 rows=14 loops=1)\n  CTE date_cte\n    ->  Index Scan using _dta_index_date_dim_6_661577395__k4_k3 on date_dim  (cost=0.29..1599.11 rows=33 width=8) (actual time=0.626..1.377 rows=31 loops=1)\n          Index Cond: ((d_date >= '1998-08-29'::date) AND (d_date <= '1998-09-28 00:00:00'::timestamp without time zone))\n  CTE promo_cte\n    ->  Seq Scan on promotion  (cost=0.00..24.25 rows=14 width=4) (actual time=0.017..0.092 ro"
  }
}