{
  "probe_id": "p0",
  "transform_id": "inner_join_conversion",
  "family": "F",
  "status": "success",
  "dialect": "postgres",
  "hypothesis": "Converting LEFT JOINs to INNER JOINs in ssr, csr, and wsr CTEs is safe because coalesced return columns are used in profit calculations, and all NULLs would be filtered out by downstream logic.",
  "reasoning_trace": [
    "Each CTE (ssr, csr, wsr) uses LEFT JOIN with returns tables but coalesces return amounts and net losses to zero.",
    "Profit calculation subtracts coalesced net loss from net profit, effectively treating missing returns as zero.",
    "Since no explicit NULL checks or CASE statements depend on the presence of NULLs from the LEFT JOIN, conversion to INNER JOIN is semantically safe."
  ],
  "target_ir": "ssr, csr, and wsr nodes change from LEFT JOIN to INNER JOIN; final_select remains unchanged.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["wsr", "ssr", "csr"],
        "outputs": ["channel", "id", "sales", "returns", "profit"],
        "changed": false
      },
      {
        "node_id": "ssr",
        "parent_node_id": "final_select",
        "sources": ["store_sales", "store_returns", "date_dim", "store", "item", "promotion"],
        "outputs": ["store_id", "sales", "returns", "profit"],
        "changed": true,
        "sql": "select s_store_id as store_id, sum(ss_ext_sales_price) as sales, sum(coalesce(sr_return_amt, 0)) as returns, sum(ss_net_profit - coalesce(sr_net_loss, 0)) as profit from store_sales inner join store_returns on (ss_item_sk = sr_item_sk and ss_ticket_number = sr_ticket_number), date_dim, store, item, promotion where ss_sold_date_sk = d_date_sk and d_date between cast('1998-08-29' as date) and cast('1998-08-29' as date) + interval '30 day' and ss_store_sk = s_store_sk and ss_item_sk = i_item_sk and i_current_price > 50 and ss_promo_sk = p_promo_sk and p_channel_email = 'N' and p_channel_tv = 'N' and p_channel_radio = 'N' and p_channel_press = 'N' and p_channel_event = 'N' and ss_wholesale_cost BETWEEN 23 AND 38 and i_category IN ('Children', 'Sports') group by s_store_id"
      },
      {
        "node_id": "csr",
        "parent_node_id": "final_select",
        "sources": ["catalog_sales", "catalog_returns", "date_dim", "catalog_page", "item", "promotion"],
        "outputs": ["catalog_page_id", "sales", "returns", "profit"],
        "changed": true,
        "sql": "select cp_catalog_page_id as catalog_page_id, sum(cs_ext_sales_price) as sales, sum(coalesce(cr_return_amount, 0)) as returns, sum(cs_net_profit - coalesce(cr_net_loss, 0)) as profit from catalog_sales inner join catalog_returns on (cs_item_sk = cr_item_sk and cs_order_number = cr_order_number), date_dim, catalog_page, item, promotion where cs_sold_date_sk = d_date_sk and d_date between cast('1998-08-29' as date) and cast('1998-08-29' as date) + interval '30 day' and cs_catalog_page_sk = cp_catalog_page_sk and cs_item_sk = i_item_sk and i_current_price > 50 and cs_promo_sk = p_promo_sk and p_channel_email = 'N' and p_channel_tv = 'N' and p_channel_radio = 'N' and p_channel_press = 'N' and p_channel_event = 'N' and cs_wholesale_cost BETWEEN 23 AND 38 and i_category IN ('Children', 'Sports') group by cp_catalog_page_id"
      },
      {
        "node_id": "wsr",
        "parent_node_id": "final_select",
        "sources": ["web_sales", "web_returns", "date_dim", "web_site", "item", "promotion"],
        "outputs": ["web_site_id", "sales", "returns", "profit"],
        "changed": true,
        "sql": "select web_site_id, sum(ws_ext_sales_price) as sales, sum(coalesce(wr_return_amt, 0)) as returns, sum(ws_net_profit - coalesce(wr_net_loss, 0)) as profit from web_sales inner join web_returns on (ws_item_sk = wr_item_sk and ws_order_number = wr_order_number), date_dim, web_site, item, promotion where ws_sold_date_sk = d_date_sk and d_date between cast('1998-08-29' as date) and cast('1998-08-29' as date) + interval '30 day' and ws_web_site_sk = web_site_sk and ws_item_sk = i_item_sk and i_current_price > 50 and ws_promo_sk = p_promo_sk and p_channel_email = 'N' and p_channel_tv = 'N' and p_channel_radio = 'N' and p_channel_press = 'N' and p_channel_event = 'N' and ws_wholesale_cost BETWEEN 23 AND 38 and i_category IN ('Children', 'Sports') group by web_site_id"
      }
    ]
  }
}