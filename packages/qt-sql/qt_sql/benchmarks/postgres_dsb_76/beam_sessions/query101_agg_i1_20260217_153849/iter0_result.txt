{
  "iteration": 0,
  "n_api_calls": 19,
  "beam_cost_usd": 0.08990752,
  "beam_cost_priced_calls": 19,
  "beam_cost_unpriced_calls": 0,
  "beam_token_totals": {
    "prompt_tokens": 100071,
    "completion_tokens": 29372,
    "total_tokens": 129443,
    "prompt_cache_hit_tokens": 0,
    "prompt_cache_miss_tokens": 0,
    "cached_tokens": 31232
  },
  "best_speedup": 0.0,
  "best_patch_id": null,
  "best_sql": null,
  "patches": [
    {
      "patch_id": "p03",
      "family": "A",
      "transform": "early_filter",
      "relevance_score": 0.75,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH item_cte AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Electronics', 'Music')) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales, store_returns, web_sales, date_dim AS d1, date_dim AS d2, item_cte, customer, customer_address, household_demographics WHERE ss_ticket_number = sr_ticket_number AND ss_customer_sk = ws_bill_customer_sk AND ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND c_current_hdemo_sk = hd_demo_sk AND ss_item_sk = sr_item_sk AND sr_item_sk = ws_item_sk AND i_item_sk = ss_item_sk AND i_category IN ('Children', 'Electronics', 'Music') AND sr_returned_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ca_state IN ('AR', 'CO', 'NC', 'NY', 'TX') AND d1.d_year = 1998 AND hd_income_band_sk BETWEEN 7 AND 13 AND hd_buy_potential = '0-500' AND ss_sales_price / ss_list_price BETWEEN 35 * 0.01 AND 55 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Pre-filter item table (category IN) into CTE before joining with store_sales"
    },
    {
      "patch_id": "p11",
      "family": "F",
      "transform": "inner_join_conversion",
      "relevance_score": 0.9,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales AS ss INNER JOIN store_returns AS sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk INNER JOIN web_sales AS ws ON ss.ss_customer_sk = ws.ws_bill_customer_sk AND sr.sr_item_sk = ws.ws_item_sk INNER JOIN date_dim AS d1 ON sr.sr_returned_date_sk = d1.d_date_sk INNER JOIN date_dim AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk INNER JOIN item AS i ON i.i_item_sk = ss.ss_item_sk INNER JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk INNER JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE ss_ticket_number = sr_ticket_number AND ss_customer_sk = ws_bill_customer_sk AND ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND c_current_hdemo_sk = hd_demo_sk AND ss_item_sk = sr_item_sk AND sr_item_sk = ws_item_sk AND i_item_sk = ss_item_sk AND i_category IN ('Children', 'Electronics', 'Music') AND sr_returned_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ca_state IN ('AR', 'CO', 'NC', 'NY', 'TX') AND d1.d_year = 1998 AND hd_income_band_sk BETWEEN 7 AND 13 AND hd_buy_potential = '0-500' AND ss_sales_price / ss_list_price BETWEEN 35 * 0.01 AND 55 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Convert all comma-joins to explicit INNER JOIN syntax"
    },
    {
      "patch_id": "p08",
      "family": "F",
      "transform": "materialized_dimension_fact_prefilter",
      "relevance_score": 0.85,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH ss_filtered AS (SELECT * FROM store_sales WHERE ss_sales_price / ss_list_price BETWEEN 0.35 AND 0.55) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM ss_filtered JOIN store_returns ON ss_filtered.ss_ticket_number = sr_ticket_number AND ss_filtered.ss_item_sk = sr_item_sk JOIN web_sales ON ss_filtered.ss_customer_sk = ws_bill_customer_sk AND sr_item_sk = ws_item_sk JOIN date_dim AS d1 ON sr_returned_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws_sold_date_sk = d2.d_date_sk JOIN item ON i_item_sk = ss_filtered.ss_item_sk JOIN customer ON ss_filtered.ss_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk WHERE ss_ticket_number = sr_ticket_number AND ss_customer_sk = ws_bill_customer_sk AND ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND c_current_hdemo_sk = hd_demo_sk AND ss_item_sk = sr_item_sk AND sr_item_sk = ws_item_sk AND i_item_sk = ss_item_sk AND i_category IN ('Children', 'Electronics', 'Music') AND sr_returned_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ca_state IN ('AR', 'CO', 'NC', 'NY', 'TX') AND d1.d_year = 1998 AND hd_income_band_sk BETWEEN 7 AND 13 AND hd_buy_potential = '0-500' AND ss_sales_price / ss_list_price BETWEEN 35 * 0.01 AND 55 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Materialize filtered store_sales (price ratio condition) before dimension joins"
    },
    {
      "patch_id": "p13",
      "family": "A",
      "transform": "date_cte_isolate",
      "relevance_score": 0.78,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH d1_keys AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998), d2_keys AS (SELECT d_date_sk FROM date_dim) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales JOIN store_returns ON ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk JOIN web_sales ON ss_customer_sk = ws_bill_customer_sk AND sr_item_sk = ws_item_sk JOIN d1_keys ON sr_returned_date_sk = d1_keys.d_date_sk JOIN d2_keys ON ws_sold_date_sk = d2_keys.d_date_sk JOIN item ON i_item_sk = ss_item_sk JOIN customer ON ss_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk WHERE ss_ticket_number = sr_ticket_number AND ss_customer_sk = ws_bill_customer_sk AND ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND c_current_hdemo_sk = hd_demo_sk AND ss_item_sk = sr_item_sk AND sr_item_sk = ws_item_sk AND i_item_sk = ss_item_sk AND i_category IN ('Children', 'Electronics', 'Music') AND sr_returned_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ca_state IN ('AR', 'CO', 'NC', 'NY', 'TX') AND d1.d_year = 1998 AND hd_income_band_sk BETWEEN 7 AND 13 AND hd_buy_potential = '0-500' AND ss_sales_price / ss_list_price BETWEEN 35 * 0.01 AND 55 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Materialize d1 and d2 as CTEs with surrogate keys only"
    },
    {
      "patch_id": "p14",
      "family": "B",
      "transform": "early_filter_decorrelate",
      "relevance_score": 0.87,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH hd_filtered AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_income_band_sk BETWEEN 7 AND 13 AND hd_buy_potential = '0-500') SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales JOIN store_returns ON ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk JOIN web_sales ON ss_customer_sk = ws_bill_customer_sk AND sr_item_sk = ws_item_sk JOIN date_dim AS d1 ON sr_returned_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws_sold_date_sk = d2.d_date_sk JOIN item ON i_item_sk = ss_item_sk JOIN customer ON ss_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN hd_filtered ON c_current_hdemo_sk = hd_filtered.hd_demo_sk WHERE i_category IN ('Children', 'Electronics', 'Music') AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ca_state IN ('AR', 'CO', 'NC', 'NY', 'TX') AND d1.d_year = 1998 AND ss_sales_price / ss_list_price BETWEEN 35 * 0.01 AND 55 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Pre-filter household_demographics and push into CTE before customer join"
    },
    {
      "patch_id": "p10",
      "family": "E",
      "transform": "pg_self_join_decomposition",
      "relevance_score": 0.8,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH cust_cte AS (SELECT c_customer_sk, c_first_name, c_last_name FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE ca.ca_state IN ('AR', 'CO', 'NC', 'NY', 'TX') AND hd.hd_income_band_sk BETWEEN 7 AND 13 AND hd.hd_buy_potential = '0-500') SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales, store_returns, web_sales, date_dim AS d1, date_dim AS d2, item, cust_cte WHERE ss_ticket_number = sr_ticket_number AND ss_customer_sk = ws_bill_customer_sk AND ss_customer_sk = cust_cte.c_customer_sk AND ss_item_sk = sr_item_sk AND sr_item_sk = ws_item_sk AND i_item_sk = ss_item_sk AND i_category IN ('Children', 'Electronics', 'Music') AND sr_returned_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND d1.d_year = 1998 AND ss_sales_price / ss_list_price BETWEEN 35 * 0.01 AND 55 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Materialize customer+address+hd join into CTE before fact joins"
    },
    {
      "patch_id": "p02",
      "family": "F",
      "transform": "date_cte_explicit_join",
      "relevance_score": 0.88,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH d1_cte AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 1998), d2_cte AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN (SELECT MIN(d_date) FROM d1_cte) AND (SELECT MIN(d_date) + INTERVAL '90 DAY' FROM d1_cte)) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales AS ss JOIN store_returns AS sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN web_sales AS ws ON ss.ss_customer_sk = ws.ws_bill_customer_sk AND sr.sr_item_sk = ws.ws_item_sk JOIN d1_cte ON sr.sr_returned_date_sk = d1_cte.d_date_sk JOIN d2_cte ON ws.ws_sold_date_sk = d2_cte.d_date_sk JOIN item AS i ON i.i_item_sk = ss.ss_item_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE i.i_category IN ('Children', 'Electronics', 'Music') AND ca.ca_state IN ('AR', 'CO', 'NC', 'NY', 'TX') AND hd.hd_income_band_sk BETWEEN 7 AND 13 AND hd.hd_buy_potential = '0-500' AND ss.ss_sales_price / ss.ss_list_price BETWEEN 35 * 0.01 AND 55 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Materialize d1 (d_year=1998) and d2 as CTEs, convert date joins to explicit INNER JOINs"
    },
    {
      "patch_id": "p01",
      "family": "F",
      "transform": "dimension_prefetch_star",
      "relevance_score": 0.92,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH item_cte AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Electronics', 'Music')), ca_cte AS (SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('AR', 'CO', 'NC', 'NY', 'TX')), hd_cte AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_income_band_sk BETWEEN 7 AND 13 AND hd_buy_potential = '0-500') SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales AS ss JOIN store_returns AS sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN web_sales AS ws ON ss.ss_customer_sk = ws.ws_bill_customer_sk AND sr.sr_item_sk = ws.ws_item_sk JOIN date_dim AS d1 ON sr.sr_returned_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk JOIN item_cte AS i ON i.i_item_sk = ss.ss_item_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk JOIN ca_cte AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN hd_cte AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE d1.d_year = 1998 AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ss.ss_sales_price / ss.ss_list_price BETWEEN 35 * 0.01 AND 55 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Create CTEs for selective dimensions (d1, item, hd, ca) with filters, then rewrite FROM clause with explicit INNER JOINs"
    },
    {
      "patch_id": "p07",
      "family": "A",
      "transform": "prefetch_fact_join",
      "relevance_score": 0.72,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH d1_cte AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998), cte1 AS (SELECT sr_item_sk, sr_ticket_number FROM store_returns AS sr JOIN d1_cte AS d1 ON sr.sr_returned_date_sk = d1.d_date_sk) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales, store_returns, web_sales, date_dim AS d1, date_dim AS d2, item, customer, customer_address, household_demographics WHERE ss_ticket_number = sr_ticket_number AND ss_customer_sk = ws_bill_customer_sk AND ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND c_current_hdemo_sk = hd_demo_sk AND ss_item_sk = sr_item_sk AND sr_item_sk = ws_item_sk AND i_item_sk = ss_item_sk AND i_category IN ('Children', 'Electronics', 'Music') AND sr_returned_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ca_state IN ('AR', 'CO', 'NC', 'NY', 'TX') AND d1.d_year = 1998 AND hd_income_band_sk BETWEEN 7 AND 13 AND hd_buy_potential = '0-500' AND ss_sales_price / ss_list_price BETWEEN 35 * 0.01 AND 55 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Stage reduction: CTE1 = store_returns JOIN d1_cte, CTE2 = CTE1 JOIN store_sales"
    },
    {
      "patch_id": "p05",
      "family": "A",
      "transform": "shared_dimension_multi_channel",
      "relevance_score": 0.7,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH hd_cte AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_income_band_sk BETWEEN 7 AND 13 AND hd_buy_potential = '0-500'), ca_cte AS (SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('AR', 'CO', 'NC', 'NY', 'TX')) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales JOIN store_returns ON ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk JOIN web_sales ON ss_customer_sk = ws_bill_customer_sk AND sr_item_sk = ws_item_sk JOIN date_dim AS d1 ON sr_returned_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws_sold_date_sk = d2.d_date_sk JOIN item ON i_item_sk = ss_item_sk JOIN customer ON ss_customer_sk = c_customer_sk JOIN hd_cte ON c_current_hdemo_sk = hd_cte.hd_demo_sk JOIN ca_cte ON c_current_addr_sk = ca_cte.ca_address_sk WHERE ss_ticket_number = sr_ticket_number AND ss_customer_sk = ws_bill_customer_sk AND ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND c_current_hdemo_sk = hd_demo_sk AND ss_item_sk = sr_item_sk AND sr_item_sk = ws_item_sk AND i_item_sk = ss_item_sk AND i_category IN ('Children', 'Electronics', 'Music') AND sr_returned_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ca_state IN ('AR', 'CO', 'NC', 'NY', 'TX') AND d1.d_year = 1998 AND hd_income_band_sk BETWEEN 7 AND 13 AND hd_buy_potential = '0-500' AND ss_sales_price / ss_list_price BETWEEN 35 * 0.01 AND 55 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Create hd_cte (income_band_sk/buy_potential) and ca_cte (state) CTEs shared across store/web channels"
    },
    {
      "patch_id": "p06",
      "family": "C",
      "transform": "aggregate_pushdown",
      "relevance_score": 0.65,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH ss_agg AS (SELECT ss_customer_sk, COUNT(*) AS ss_cnt FROM store_sales GROUP BY ss_customer_sk) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM ss_agg, store_returns, web_sales, date_dim AS d1, date_dim AS d2, item, customer, customer_address, household_demographics WHERE ss_ticket_number = sr_ticket_number AND ss_customer_sk = ws_bill_customer_sk AND ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND c_current_hdemo_sk = hd_demo_sk AND ss_item_sk = sr_item_sk AND sr_item_sk = ws_item_sk AND i_item_sk = ss_item_sk AND i_category IN ('Children', 'Electronics', 'Music') AND sr_returned_date_sk = d1.d_date_sk AND ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ca_state IN ('AR', 'CO', 'NC', 'NY', 'TX') AND d1.d_year = 1998 AND hd_income_band_sk BETWEEN 7 AND 13 AND hd_buy_potential = '0-500' AND ss_sales_price / ss_list_price BETWEEN 35 * 0.01 AND 55 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Pre-aggregate store_sales by ss_customer_sk before joining with customer"
    },
    {
      "patch_id": "p04",
      "family": "A",
      "transform": "multi_date_range_cte",
      "relevance_score": 0.68,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH d1_cte AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998), d2_range AS (SELECT d_date_sk FROM date_dim AS d2 JOIN d1_cte AS d1 ON d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY')) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales AS ss JOIN store_returns AS sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN web_sales AS ws ON ss.ss_customer_sk = ws.ws_bill_customer_sk AND sr.sr_item_sk = ws.ws_item_sk JOIN d1_cte AS d1 ON sr.sr_returned_date_sk = d1.d_date_sk JOIN d2_range AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk JOIN item AS i ON i.i_item_sk = ss.ss_item_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE i_category IN ('Children', 'Electronics', 'Music') AND ca_state IN ('AR', 'CO', 'NC', 'NY', 'TX') AND hd_income_band_sk BETWEEN 7 AND 13 AND hd_buy_potential = '0-500' AND ss.ss_sales_price / ss.ss_list_price BETWEEN 35 * 0.01 AND 55 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Create d1_cte (d_year=1998) and d2_range CTE (joined with d1_cte for BETWEEN condition)"
    },
    {
      "patch_id": "p09",
      "family": "A",
      "transform": "sf_sk_pushdown_multi_fact",
      "relevance_score": 0.6,
      "status": "ERROR",
      "speedup": null,
      "semantic_passed": false,
      "error": "Synthetic semantic check failed: SyntheticDataGenerator._generate_value() got an unexpected keyword argument 'row_context'",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH sr_filtered AS (SELECT * FROM store_returns WHERE sr_returned_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_year = 1998)) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM store_sales AS ss JOIN sr_filtered AS sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN web_sales AS ws ON ss.ss_customer_sk = ws.ws_bill_customer_sk AND sr.sr_item_sk = ws.ws_item_sk JOIN date_dim AS d1 ON sr.sr_returned_date_sk = d1.d_date_sk JOIN date_dim AS d2 ON ws.ws_sold_date_sk = d2.d_date_sk JOIN item AS i ON i.i_item_sk = ss.ss_item_sk JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE i.i_category IN ('Children', 'Electronics', 'Music') AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 DAY') AND ca_state IN ('AR', 'CO', 'NC', 'NY', 'TX') AND hd_income_band_sk BETWEEN 7 AND 13 AND hd_buy_potential = '0-500' AND ss_sales_price / ss_list_price BETWEEN 35 * 0.01 AND 55 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Push d1.d_date_sk filter into store_returns CTE definition"
    },
    {
      "patch_id": "p12",
      "family": "C",
      "transform": "single_pass_aggregation",
      "relevance_score": 0.55,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Tier-1: LITERAL MISMATCH: Original literals missing from rewrite \u2014 strings: ['90']. The rewrite changed filter values instead of preserving them.",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH unified_sales AS (SELECT ss_customer_sk AS customer_sk, 'store' AS channel, ss_sales_price AS sales_price FROM store_sales UNION ALL SELECT sr_customer_sk, 'return', sr_return_amt FROM store_returns UNION ALL SELECT ws_bill_customer_sk, 'web', ws_sales_price FROM web_sales) SELECT c_customer_sk, c_first_name, c_last_name, COUNT(*) AS cnt FROM unified_sales AS us JOIN customer AS c ON us.customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN item AS i ON us.customer_sk = i.i_item_sk JOIN date_dim AS d1 ON us.customer_sk = d1.d_date_sk JOIN date_dim AS d2 ON us.customer_sk = d2.d_date_sk WHERE i.i_category IN ('Children', 'Electronics', 'Music') AND ca.ca_state IN ('AR', 'CO', 'NC', 'NY', 'TX') AND d1.d_year = 1998 AND hd.hd_income_band_sk BETWEEN 7 AND 13 AND hd.hd_buy_potential = '0-500' AND (us.channel = 'store' OR us.channel = 'web') AND us.sales_price / NULLIF(us.sales_price, 0) BETWEEN 35 * 0.01 AND 55 * 0.01 GROUP BY c_customer_sk, c_first_name, c_last_name ORDER BY cnt;",
      "has_explain": false,
      "description": "Consolidate fact scans into single CTE with CASE-based channel aggregation"
    },
    {
      "patch_id": "snipe_p1",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Step s1 failed: replace_from requires from_sql",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p2",
      "family": "?",
      "transform": "unknown",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Step s3 failed: replace_from requires from_sql",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p1",
      "family": "F",
      "transform": "explicit_join_with_dimension_ctes",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Step s6 failed: replace_where_predicate requires expr_sql",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": null
    },
    {
      "patch_id": "snipe_p2",
      "family": "A",
      "transform": "fact_prefilter",
      "relevance_score": 1.0,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Step s4 failed: replace_where_predicate requires expr_sql",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": null,
      "has_explain": false,
      "description": null
    }
  ],
  "explains": {}
}