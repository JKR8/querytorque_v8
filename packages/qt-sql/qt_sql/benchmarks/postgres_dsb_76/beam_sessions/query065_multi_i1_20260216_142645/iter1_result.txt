{
  "iteration": 1,
  "n_api_calls": 4,
  "best_speedup": 152.12,
  "best_patch_id": "t3",
  "best_sql": "WITH filtered_store AS (SELECT s_store_sk FROM store WHERE s_state IN ('IA', 'IL', 'NC')), filtered_item AS (SELECT i_item_sk FROM item WHERE i_manager_id BETWEEN 80 AND 84) SELECT s_store_name, i_item_desc, sc.revenue, i_current_price, i_wholesale_cost, i_brand FROM store JOIN item ON s_store_sk = i_item_sk, (SELECT ss_store_sk, AVG(revenue) AS ave FROM (SELECT ss_store_sk, ss_item_sk, SUM(ss_sales_price) AS revenue FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN filtered_store AS fs ON ss_store_sk = fs.s_store_sk JOIN filtered_item AS fi ON ss_item_sk = fi.i_item_sk WHERE d_month_seq BETWEEN 1195 AND 1195 + 11 AND ss_sales_price / ss_list_price BETWEEN 38 * 0.01 AND 48 * 0.01 GROUP BY ss_store_sk, ss_item_sk) AS sa GROUP BY ss_store_sk) AS sb JOIN (SELECT ss_store_sk, ss_item_sk, SUM(ss_sales_price) AS revenue FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN filtered_store AS fs ON ss_store_sk = fs.s_store_sk JOIN filtered_item AS fi ON ss_item_sk = fi.i_item_sk WHERE d_month_seq BETWEEN 1195 AND 1195 + 11 AND ss_sales_price / ss_list_price BETWEEN 38 * 0.01 AND 48 * 0.01 GROUP BY ss_store_sk, ss_item_sk) AS sc ON sb.ss_store_sk = sc.ss_store_sk AND sc.revenue <= 0.1 * sb.ave WHERE s_store_sk = sc.ss_store_sk AND i_item_sk = sc.ss_item_sk ORDER BY s_store_name, i_item_desc LIMIT 100;",
  "patches": [
    {
      "patch_id": "t1",
      "family": "E",
      "transform": "base_sales_rescue",
      "relevance_score": 0.98,
      "status": "WIN",
      "speedup": 1.58,
      "semantic_passed": true,
      "error": null,
      "original_ms": 1629.9,
      "patch_ms": 1030.8,
      "output_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1195 AND 1195 + 11), base_sales AS (SELECT ss_store_sk, ss_item_sk, ss_sales_price, ss_list_price FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk WHERE ss_sales_price / ss_list_price BETWEEN 38 * 0.01 AND 48 * 0.01), revenue_per_item AS (SELECT ss_store_sk, ss_item_sk, SUM(ss_sales_price) AS revenue FROM base_sales GROUP BY ss_store_sk, ss_item_sk), avg_revenue_per_store AS (SELECT ss_store_sk, AVG(revenue) AS ave FROM revenue_per_item GROUP BY ss_store_sk) SELECT s_store_name, i_item_desc, sc.revenue, i_current_price, i_wholesale_cost, i_brand FROM store, item, revenue_per_item AS sc, avg_revenue_per_store AS sb WHERE sb.ss_store_sk = sc.ss_store_sk AND sc.revenue <= 0.1 * sb.ave AND s_store_sk = sc.ss_store_sk AND i_item_sk = sc.ss_item_sk AND i_manager_id BETWEEN 80 AND 84 AND s_state IN ('IA', 'IL', 'NC') ORDER BY s_store_name, i_item_desc LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "t3",
      "family": "A",
      "transform": "pushdown_fix_projection",
      "relevance_score": 0.8,
      "status": "WIN",
      "speedup": 152.12,
      "semantic_passed": true,
      "error": null,
      "original_ms": 1629.9,
      "patch_ms": 10.7,
      "output_sql": "WITH filtered_store AS (SELECT s_store_sk FROM store WHERE s_state IN ('IA', 'IL', 'NC')), filtered_item AS (SELECT i_item_sk FROM item WHERE i_manager_id BETWEEN 80 AND 84) SELECT s_store_name, i_item_desc, sc.revenue, i_current_price, i_wholesale_cost, i_brand FROM store JOIN item ON s_store_sk = i_item_sk, (SELECT ss_store_sk, AVG(revenue) AS ave FROM (SELECT ss_store_sk, ss_item_sk, SUM(ss_sales_price) AS revenue FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN filtered_store AS fs ON ss_store_sk = fs.s_store_sk JOIN filtered_item AS fi ON ss_item_sk = fi.i_item_sk WHERE d_month_seq BETWEEN 1195 AND 1195 + 11 AND ss_sales_price / ss_list_price BETWEEN 38 * 0.01 AND 48 * 0.01 GROUP BY ss_store_sk, ss_item_sk) AS sa GROUP BY ss_store_sk) AS sb JOIN (SELECT ss_store_sk, ss_item_sk, SUM(ss_sales_price) AS revenue FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN filtered_store AS fs ON ss_store_sk = fs.s_store_sk JOIN filtered_item AS fi ON ss_item_sk = fi.i_item_sk WHERE d_month_seq BETWEEN 1195 AND 1195 + 11 AND ss_sales_price / ss_list_price BETWEEN 38 * 0.01 AND 48 * 0.01 GROUP BY ss_store_sk, ss_item_sk) AS sc ON sb.ss_store_sk = sc.ss_store_sk AND sc.revenue <= 0.1 * sb.ave WHERE s_store_sk = sc.ss_store_sk AND i_item_sk = sc.ss_item_sk ORDER BY s_store_name, i_item_desc LIMIT 100;",
      "has_explain": true
    },
    {
      "patch_id": "t2",
      "family": "E+A+F",
      "transform": "base_sales_plus_early_filter+explicit_join_with_materialization",
      "relevance_score": 0.9,
      "status": "FAIL",
      "speedup": null,
      "semantic_passed": false,
      "error": "Equivalence execution error: missing FROM-clause entry for table \"sc\"\nLINE 1: ...ost, i_brand FROM store JOIN item ON s_store_sk = sc.ss_stor...\n                                                             ^\n",
      "original_ms": null,
      "patch_ms": null,
      "output_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1195 AND 1195 + 11), base_sales AS (SELECT ss_store_sk, ss_item_sk, SUM(ss_sales_price) AS revenue FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk WHERE ss_sales_price / ss_list_price BETWEEN 38 * 0.01 AND 48 * 0.01 GROUP BY ss_store_sk, ss_item_sk), store_item_stats AS (SELECT ss_store_sk, AVG(revenue) AS ave FROM base_sales GROUP BY ss_store_sk) SELECT s_store_name, i_item_desc, sc.revenue, i_current_price, i_wholesale_cost, i_brand FROM store JOIN item ON s_store_sk = sc.ss_store_sk AND i_item_sk = sc.ss_item_sk JOIN base_sales AS sc ON s_store_sk = sc.ss_store_sk JOIN store_item_stats AS sb ON sb.ss_store_sk = sc.ss_store_sk WHERE sc.revenue <= 0.1 * sb.ave AND i_manager_id BETWEEN 80 AND 84 AND s_state IN ('IA', 'IL', 'NC') ORDER BY s_store_name, i_item_desc LIMIT 100;",
      "has_explain": false
    }
  ],
  "explains": {
    "t1": "Limit  (rows=0, time=990.55)\n  Aggregate  (rows=168630, time=944.146)\n    Gather Merge  (rows=184381, time=879.667)\n      Aggregate  (rows=61460, time=534.324)\n        Sort  (rows=145949, time=505.639)\n          Nested Loop  (rows=145949, time=460.127)\n            Index Only Scan on date_dim  (rows=122, time=1.39)\n            Index Only Scan on store_sales  (rows=1196, time=3.701)\n  Sort  (rows=0, time=989.128)\n    Nested Loop  (rows=0, time=989.096)\n      Hash Join  (rows=0, time=989.094)\n     ",
    "t3": "Limit  (rows=0, time=8.345)\n  Seq Scan on store (store_1)  (rows=1, time=0.023)\n  Seq Scan on item (item_1)  (rows=1, time=0.018)\n  Nested Loop  (rows=0, time=8.343)\n    Gather Merge  (rows=102, time=8.218)\n      Sort  (rows=34, time=0.172)\n        Merge Join  (rows=34, time=0.117)\n          Index Scan on item  (rows=35, time=0.05)\n          Sort  (rows=102, time=0.055)\n            Seq Scan on store  (rows=102, time=0.034)\n    Materialize  (rows=0, time=0.001)\n      Merge Join  (rows=0, time=0.1"
  }
}