{
  "probe_id": "p12",
  "transform_id": "dimension_prefetch_star",
  "family": "F",
  "status": "success",
  "dialect": "postgres",
  "hypothesis": "Pre-filtering selective dimensions into CTEs and using explicit JOINs can improve planner estimates and reduce date_dim scan cost.",
  "reasoning_trace": [
    "Comma-join syntax may prevent optimal join ordering in PostgreSQL.",
    "Selective filters on small dimensions can be materialized into tiny CTEs for efficient hash joins.",
    "Explicit JOINs with CTEs provide stable row estimates and avoid Nested Loop with zero rows."
  ],
  "target_ir": "Each selective dimension (date_dim, store, item, customer_demographics) becomes a CTE; store_sales joins them explicitly.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["store_sales", "cd_filtered", "d_filtered", "s_filtered", "i_filtered"],
        "outputs": ["i_item_id", "s_state", "g_state", "agg1", "agg2", "agg3", "agg4"],
        "changed": true,
        "sql": "WITH cd_filtered AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_gender = 'F' AND cd_marital_status = 'M' AND cd_education_status = 'Primary'),\n     d_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002),\n     s_filtered AS (SELECT s_store_sk FROM store WHERE s_state = 'IA'),\n     i_filtered AS (SELECT i_item_sk FROM item WHERE i_category = 'Sports')\nSELECT i.i_item_id,\n       s.s_state,\n       GROUPING(s.s_state) AS g_state,\n       AVG(ss.ss_quantity) AS agg1,\n       AVG(ss.ss_list_price) AS agg2,\n       AVG(ss.ss_coupon_amt) AS agg3,\n       AVG(ss.ss_sales_price) AS agg4\nFROM store_sales ss\nJOIN cd_filtered cd ON ss.ss_cdemo_sk = cd.cd_demo_sk\nJOIN d_filtered d ON ss.ss_sold_date_sk = d.d_date_sk\nJOIN s_filtered s ON ss.ss_store_sk = s.s_store_sk\nJOIN i_filtered i ON ss.ss_item_sk = i.i_item_sk\nGROUP BY ROLLUP (i.i_item_id, s.s_state)\nORDER BY i.i_item_id, s.s_state\nLIMIT 100"
      }
    ]
  }
}