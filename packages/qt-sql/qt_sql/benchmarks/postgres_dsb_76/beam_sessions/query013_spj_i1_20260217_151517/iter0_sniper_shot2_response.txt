[  {
    "plan_id": "snipe_p1",
    "dialect": "postgres",
    "confidence": 0.85,
    "based_on": "p07",
    "strategy": "Comma join correction with predicate cleanup",
    "hypothesis": "Explicit JOIN syntax with condition pruning will resolve comma-join weakness seen in nested loop explosion. Remove redundant s_store_sk predicate from WHERE clause after making it explicit in JOIN ON.",
    "target_ir": "Explicit INNER JOIN chain with date_dim filtered first",
    "steps": [
      {
        "step_id": "s1",
        "op": "replace_from",
        "target": {"by_node_id": "S0"},
        "payload": {
          "sql_fragment": "store_sales JOIN store ON s_store_sk = ss_store_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk AND d_year = 2001 JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN customer_address ON ss_addr_sk = ca_address_sk"
        }
      },
      {
        "step_id": "s2",
        "op": "delete_expr_subtree",
        "target": {"by_anchor_hash": "73f355482e5a7264"},
        "payload": {"predicate_part": "s_store_sk = ss_store_sk"}
      }
    ]
  },
  {
    "plan_id": "snipe_p2",
    "dialect": "postgres",
    "confidence": 0.72,
    "strategy": "Partial ORâ†’UNION with column preservation",
    "hypothesis": "Split first OR block (hd/cd filters) into UNION ALL while preserving ca_addr ORs intact. Maintain all original column references to avoid semantic breaks.",
    "target_ir": "UNION ALL of 3 branches with shared ca_address OR conditions",
    "steps": [
      {
        "step_id": "s1",
        "op": "replace_body",
        "target": {"by_node_id": "S0"},
        "payload": {
          "sql_fragment": "(SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost FROM store_sales, store, customer_demographics, household_demographics, customer_address, date_dim WHERE s_store_sk = ss_store_sk AND ss_sold_date_sk = d_date_sk AND d_year = 2001 AND ss_hdemo_sk=hd_demo_sk AND cd_demo_sk=ss_cdemo_sk AND cd_marital_status = 'M' AND cd_education_status = '2 yr Degree' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3 UNION ALL SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost FROM store_sales, store, customer_demographics, household_demographics, customer_address, date_dim WHERE s_store_sk = ss_store_sk AND ss_sold_date_sk = d_date_sk AND d_year = 2001 AND ss_hdemo_sk=hd_demo_sk AND cd_demo_sk=ss_cdemo_sk AND cd_marital_status = 'U' AND cd_education_status = 'College' AND ss_sales_price BETWEEN 50.00 AND 100.00 AND hd_dep_count = 1 UNION ALL SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost FROM store_sales, store, customer_demographics, household_demographics, customer_address, date_dim WHERE s_store_sk = ss_store_sk AND ss_sold_date_sk = d_date_sk AND d_year = 2001 AND ss_hdemo_sk=hd_demo_sk AND cd_demo_sk=ss_cdemo_sk AND cd_marital_status = 'S' AND cd_education_status = 'Unknown' AND ss_sales_price BETWEEN 150.00 AND 200.00 AND hd_dep_count = 1)"
        }
      },
      {
        "step_id": "s2",
        "op": "replace_where_predicate",
        "target": {"by_node_id": "S0"},
        "payload": {
          "sql_fragment": "((ss_addr_sk = ca_address_sk AND ca_country = 'United States' AND ca_state IN ('CO', 'NC', 'TX') AND ss_net_profit BETWEEN 100 AND 200) OR (ss_addr_sk = ca_address_sk AND ca_country = 'United States' AND ca_state IN ('AR', 'NY', 'TX') AND ss_net_profit BETWEEN 150 AND 300) OR (ss_addr_sk = ca_address_sk AND ca_country = 'United States' AND ca_state IN ('IA', 'IL', 'NC') AND ss_net_profit BETWEEN 50 AND 250))"
        }
      }
    ]
  }
]