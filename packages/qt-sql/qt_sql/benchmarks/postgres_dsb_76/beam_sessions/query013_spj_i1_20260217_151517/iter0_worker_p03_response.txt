{
  "probe_id": "p01",
  "transform_id": "or_to_union",
  "family": "D",
  "dialect": "postgres",
  "hypothesis": "Splitting the first OR condition (hd/cd filters) into 3 UNION ALL branches may enable index usage on ss_sales_price and reduce Nested Loop amplification.",
  "reasoning_trace": [
    "The first OR block contains 3 distinct hd/cd filter combinations on same columns; splitting enables branch-specific index access.",
    "Each branch retains the second OR condition (ca/addr filters) to preserve original semantics.",
    "Top-level aggregation is maintained via outer query grouping."
  ],
  "target_ir": "Three UNION ALL branches, each with focused hd/cd predicates; ca/addr ORs retained; aggregation hoisted.",
  "steps": [
    {
      "step_id": "s1",
      "op": "replace_body",
      "target": {"by_node_id": "S0"},
      "payload": {
        "sql_fragment": "(select min(ss_quantity) as ss_quantity,\n       min(ss_ext_sales_price) as ss_ext_sales_price,\n       min(ss_ext_wholesale_cost) as ss_ext_wholesale_cost,\n       min(ss_ext_wholesale_cost) as ss_ext_wholesale_cost2\n from (\n  select ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost\n  from store_sales, store, customer_demographics, household_demographics, customer_address, date_dim\n  where s_store_sk = ss_store_sk\n    and ss_sold_date_sk = d_date_sk and d_year = 2001\n    and ss_hdemo_sk=hd_demo_sk\n    and cd_demo_sk = ss_cdemo_sk\n    and cd_marital_status = 'M'\n    and cd_education_status = '2 yr Degree'\n    and ss_sales_price between 100.00 and 150.00\n    and hd_dep_count = 3\n    and ((ss_addr_sk = ca_address_sk\n     and ca_country = 'United States'\n     and ca_state in ('CO', 'NC', 'TX')\n     and ss_net_profit between 100 and 200\n        ) or\n        (ss_addr_sk = ca_address_sk\n     and ca_country = 'United States'\n     and ca_state in ('AR', 'NY', 'TX')\n     and ss_net_profit between 150 and 300\n        ) or\n        (ss_addr_sk = ca_address_sk\n     and ca_country = 'United States'\n     and ca_state in ('IA', 'IL', 'NC')\n     and ss_net_profit between 50 and 250\n        ))\n  UNION ALL\n  select ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost\n  from store_sales, store, customer_demographics, household_demographics, customer_address, date_dim\n  where s_store_sk = ss_store_sk\n    and ss_sold_date_sk = d_date_sk and d_year = 2001\n    and ss_hdemo_sk=hd_demo_sk\n    and cd_demo_sk = ss_cdemo_sk\n    and cd_marital_status = 'U'\n    and cd_education_status = 'College'\n    and ss_sales_price between 50.00 and 100.00\n    and hd_dep_count = 1\n    and ((ss_addr_sk = ca_address_sk\n     and ca_country = 'United States'\n     and ca_state in ('CO', 'NC', 'TX')\n     and ss_net_profit between 100 and 200\n        ) or\n        (ss_addr_sk = ca_address_sk\n     and ca_country = 'United States'\n     and ca_state in ('AR', 'NY', 'TX')\n     and ss_net_profit between 150 and 300\n        ) or\n        (ss_addr_sk = ca_address_sk\n     and ca_country = 'United States'\n     and ca_state in ('IA', 'IL', 'NC')\n     and ss_net_profit between 50 and 250\n        ))\n  UNION ALL\n  select ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost\n  from store_sales, store, customer_demographics, household_demographics, customer_address, date_dim\n  where s_store_sk = ss_store_sk\n    and ss_sold_date_sk = d_date_sk and d_year = 2001\n    and ss_hdemo_sk=hd_demo_sk\n    and cd_demo_sk = ss_cdemo_sk\n    and cd_marital_status = 'S'\n    and cd_education_status = 'Unknown'\n    and ss_sales_price between 150.00 and 200.00\n    and hd_dep_count = 1\n    and ((ss_addr_sk = ca_address_sk\n     and ca_country = 'United States'\n     and ca_state in ('CO', 'NC', 'TX')\n     and ss_net_profit between 100 and 200\n        ) or\n        (ss_addr_sk = ca_address_sk\n     and ca_country = 'United States'\n     and ca_state in ('AR', 'NY', 'TX')\n     and ss_net_profit between 150 and 300\n        ) or\n        (ss_addr_sk = ca_address_sk\n     and ca_country = 'United States'\n     and ca_state in ('IA', 'IL', 'NC')\n     and ss_net_profit between 50 and 250\n        ))\n ) as union_branches)"
      }
    }
  ]
}