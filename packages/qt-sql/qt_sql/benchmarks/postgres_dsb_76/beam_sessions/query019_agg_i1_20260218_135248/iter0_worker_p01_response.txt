{
  "probe_id": "p12",
  "transform_id": "dimension_prefetch_star",
  "family": "F",
  "status": "success",
  "dialect": "postgresql",
  "hypothesis": "Pre-filtering selective dimensions into MATERIALIZED CTEs before joining with store_sales reduces nested-loop amplification and improves cardinality estimates.",
  "reasoning_trace": [
    "Assigned transform targets comma joins with selective dimension filters.",
    "Materializing small filtered dimensions as CTEs enables PostgreSQL to build small hash tables.",
    "Explicit JOIN syntax helps the optimizer reorder joins effectively.",
    "All WHERE conditions are preserved in their respective CTEs or final join."
  ],
  "target_ir": "Each selective dimension is filtered into a CTE; main join uses explicit syntax with pre-filtered dimensions.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": ["store_sales_filtered", "date_dim_cte", "item_cte", "customer_cte", "customer_address_cte", "store_cte"],
        "outputs": ["brand_id", "brand", "i_manufact_id", "i_manufact", "ext_price"],
        "changed": true,
        "sql": "SELECT i_brand_id AS brand_id, i_brand AS brand, i_manufact_id, i_manufact, SUM(ss_ext_sales_price) AS ext_price FROM store_sales_filtered JOIN date_dim_cte ON d_date_sk = ss_sold_date_sk JOIN item_cte ON ss_item_sk = i_item_sk JOIN customer_cte ON ss_customer_sk = c_customer_sk JOIN customer_address_cte ON c_current_addr_sk = ca_address_sk JOIN store_cte ON ss_store_sk = s_store_sk GROUP BY i_brand, i_brand_id, i_manufact_id, i_manufact ORDER BY ext_price DESC, i_brand, i_brand_id, i_manufact_id, i_manufact LIMIT 100"
      },
      {
        "node_id": "store_sales_filtered",
        "parent_node_id": "final_select",
        "sources": ["store_sales"],
        "outputs": ["ss_sold_date_sk", "ss_item_sk", "ss_customer_sk", "ss_store_sk", "ss_ext_sales_price", "ss_wholesale_cost"],
        "changed": true,
        "sql": "SELECT ss_sold_date_sk, ss_item_sk, ss_customer_sk, ss_store_sk, ss_ext_sales_price, ss_wholesale_cost FROM store_sales WHERE ss_wholesale_cost BETWEEN 35 AND 55"
      },
      {
        "node_id": "date_dim_cte",
        "parent_node_id": "final_select",
        "sources": ["date_dim"],
        "outputs": ["d_date_sk"],
        "changed": true,
        "sql": "SELECT d_date_sk FROM date_dim WHERE d_year = 2002 AND d_moy = 4"
      },
      {
        "node_id": "item_cte",
        "parent_node_id": "final_select",
        "sources": ["item"],
        "outputs": ["i_item_sk", "i_brand_id", "i_brand", "i_manufact_id", "i_manufact"],
        "changed": true,
        "sql": "SELECT i_item_sk, i_brand_id, i_brand, i_manufact_id, i_manufact FROM item WHERE i_category = 'Jewelry'"
      },
      {
        "node_id": "customer_cte",
        "parent_node_id": "final_select",
        "sources": ["customer"],
        "outputs": ["c_customer_sk", "c_current_addr_sk"],
        "changed": true,
        "sql": "SELECT c_customer_sk, c_current_addr_sk FROM customer WHERE c_birth_month = 1"
      },
      {
        "node_id": "customer_address_cte",
        "parent_node_id": "final_select",
        "sources": ["customer_address"],
        "outputs": ["ca_address_sk", "ca_zip"],
        "changed": true,
        "sql": "SELECT ca_address_sk, ca_zip FROM customer_address WHERE ca_state = 'IL'"
      },
      {
        "node_id": "store_cte",
        "parent_node_id": "final_select",
        "sources": ["store"],
        "outputs": ["s_store_sk", "s_zip"],
        "changed": true,
        "sql": "SELECT s_store_sk, s_zip FROM store"
      }
    ]
  }
}