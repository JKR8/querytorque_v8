{
  "probe_id": "scout_dimension_prefetch_star",
  "transform_id": "dimension_prefetch_star",
  "family": "F",
  "status": "success",
  "dialect": "postgresql",
  "hypothesis": "Prefetching selective dimensions (date_dim d1, item, customer_address, household_demographics, customer_demographics) into CTEs improves join order flexibility and reduces intermediate row counts by applying filters early.",
  "reasoning_trace": [
    "Comma-join pattern with late non-equi predicates causes fan-out; explicit JOINs with prefiltered dimensions should improve estimates.",
    "Selective dimension tables (item, customer_address, etc.) benefit from early filtering before joining with large fact tables.",
    "PostgreSQL's BitmapOr and index-only scans make OR-splitting unnecessary; CTE-based prefetch avoids fighting engine strengths."
  ],
  "target_ir": "Dimension tables filtered into CTEs; FROM clause replaced with explicit JOINs; WHERE clause simplified.",
  "verification": {
    "executable": true,
    "no_missing_tables": true,
    "alias_consistent": true,
    "no_orphan_scans": true,
    "semantics_preserved": true,
    "null_semantics_safe": true,
    "ctes_selective_or_na": true
  },
  "tree": {
    "root_node_id": "final_select",
    "nodes": [
      {
        "node_id": "final_select",
        "parent_node_id": null,
        "sources": [],
        "outputs": ["cd_gender", "cd_marital_status", "cd_education_status", "hd_vehicle_count", "cnt"],
        "changed": true,
        "sql": "WITH d1_filtered AS (\n  SELECT *\n  FROM date_dim\n  WHERE d_year = 2001\n),\nitem_filtered AS (\n  SELECT *\n  FROM item\n  WHERE i_category IN ('Children', 'Jewelry', 'Men')\n    AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93)\n),\ncustomer_address_filtered AS (\n  SELECT *\n  FROM customer_address\n  WHERE ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA')\n),\nhousehold_demographics_filtered AS (\n  SELECT *\n  FROM household_demographics\n),\ncustomer_demographics_filtered AS (\n  SELECT *\n  FROM customer_demographics\n)\nSELECT \n    cd_gender,\n    cd_marital_status,\n    cd_education_status,\n    hd_vehicle_count,\n    COUNT(*) AS cnt\nFROM\n    store_sales\n    JOIN web_sales ON ws_item_sk = ss_item_sk AND ws_bill_customer_sk = ss_customer_sk\n    JOIN d1_filtered d1 ON ss_sold_date_sk = d1.d_date_sk\n    JOIN date_dim d2 ON ws_sold_date_sk = d2.d_date_sk\n    JOIN customer ON ss_customer_sk = c_customer_sk\n    JOIN inventory ON inv_item_sk = ss_item_sk AND inv_date_sk = ss_sold_date_sk AND inv_quantity_on_hand >= ss_quantity\n    JOIN store ON s_state = w_state\n    JOIN warehouse ON ws_warehouse_sk = w_warehouse_sk\n    JOIN item_filtered i ON ss_item_sk = i.i_item_sk\n    JOIN customer_demographics_filtered cd ON c_current_cdemo_sk = cd.cd_demo_sk\n    JOIN household_demographics_filtered hd ON c_current_hdemo_sk = hd.hd_demo_sk\n    JOIN customer_address_filtered ca ON c_current_addr_sk = ca.ca_address_sk\nWHERE\n    d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 day')\n    AND ws_wholesale_cost BETWEEN 35 AND 55\nGROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count\nORDER BY cnt"
      }
    ]
  }
}