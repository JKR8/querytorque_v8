Worker Role: W3
Family: E
Transform: materialize_cte
Status: OK

--- OUTPUT SQL ---
WITH item_avg_discount AS (SELECT cs_item_sk, 1.3 * AVG(cs_ext_discount_amt) AS threshold FROM catalog_sales, date_dim WHERE d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY' AND d_date_sk = cs_sold_date_sk AND cs_list_price BETWEEN 108 AND 137 AND cs_sales_price / cs_list_price BETWEEN 23 * 0.01 AND 43 * 0.01 GROUP BY cs_item_sk) SELECT SUM(cs_ext_discount_amt) AS "excess discount amount" FROM catalog_sales, item, date_dim, item_avg_discount AS t WHERE (i_manufact_id IN (47, 226, 612, 676, 818) OR i_manager_id BETWEEN 71 AND 100) AND i_item_sk = catalog_sales.cs_item_sk AND d_date BETWEEN '1998-01-06' AND CAST('1998-01-06' AS DATE) + INTERVAL '90 DAY' AND d_date_sk = cs_sold_date_sk AND catalog_sales.cs_item_sk = t.cs_item_sk AND cs_ext_discount_amt > t.threshold ORDER BY SUM(cs_ext_discount_amt) LIMIT 100;