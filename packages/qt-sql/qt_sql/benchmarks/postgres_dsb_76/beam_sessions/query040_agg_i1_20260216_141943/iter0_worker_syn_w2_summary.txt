Worker Role: W2
Family: B
Transform: decorrelate
Status: OK

--- OUTPUT SQL ---
WITH filtered_catalog_data AS (SELECT cs_item_sk, cs_warehouse_sk, cs_sold_date_sk, cs_sales_price, cs_wholesale_cost, cr_refunded_cash FROM catalog_sales LEFT OUTER JOIN catalog_returns ON cs_order_number = cr_order_number AND cs_item_sk = cr_item_sk AND cr_reason_sk = 33), joined_dims AS (SELECT f.cs_sales_price, f.cr_refunded_cash, d.d_date, w.w_state, i.i_item_id FROM filtered_catalog_data AS f INNER JOIN date_dim AS d ON f.cs_sold_date_sk = d.d_date_sk INNER JOIN item AS i ON f.cs_item_sk = i.i_item_sk INNER JOIN warehouse AS w ON f.cs_warehouse_sk = w.w_warehouse_sk WHERE d.d_date BETWEEN (CAST('2002-02-19' AS DATE) - INTERVAL '30 DAY') AND (CAST('2002-02-19' AS DATE) + INTERVAL '30 DAY') AND i.i_category = 'Jewelry' AND i.i_manager_id BETWEEN 61 AND 100 AND f.cs_wholesale_cost BETWEEN 42 AND 61) SELECT w_state, i_item_id, SUM(CASE WHEN (CAST(d_date AS DATE) < CAST('2002-02-19' AS DATE)) THEN cs_sales_price - COALESCE(cr_refunded_cash, 0) ELSE 0 END) AS sales_before, SUM(CASE WHEN (CAST(d_date AS DATE) >= CAST('2002-02-19' AS DATE)) THEN cs_sales_price - COALESCE(cr_refunded_cash, 0) ELSE 0 END) AS sales_after FROM joined_dims WHERE TRUE GROUP BY w_state, i_item_id ORDER BY w_state, i_item_id LIMIT 100;