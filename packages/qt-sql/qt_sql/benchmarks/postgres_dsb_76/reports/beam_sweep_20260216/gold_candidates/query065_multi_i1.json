{
  "query_id": "query065_multi_i1",
  "status": "WIN",
  "best_speedup": 152.121,
  "original_sql": "select \n\ts_store_name,\n\ti_item_desc,\n\tsc.revenue,\n\ti_current_price,\n\ti_wholesale_cost,\n\ti_brand\n from store, item,\n     (select ss_store_sk, avg(revenue) as ave\n \tfrom\n \t    (select  ss_store_sk, ss_item_sk,\n \t\t     sum(ss_sales_price) as revenue\n \t\tfrom store_sales, date_dim\n \t\twhere ss_sold_date_sk = d_date_sk and d_month_seq between 1195 and 1195+11\n    and ss_sales_price / ss_list_price BETWEEN 38 * 0.01 AND 48 * 0.01\n \t\tgroup by ss_store_sk, ss_item_sk) sa\n \tgroup by ss_store_sk) sb,\n     (select  ss_store_sk, ss_item_sk, sum(ss_sales_price) as revenue\n \tfrom store_sales, date_dim\n \twhere ss_sold_date_sk = d_date_sk and d_month_seq between 1195 and 1195+11\n  and ss_sales_price / ss_list_price BETWEEN 38 * 0.01 AND 48 * 0.01\n \tgroup by ss_store_sk, ss_item_sk) sc\n where sb.ss_store_sk = sc.ss_store_sk and\n       sc.revenue <= 0.1 * sb.ave and\n       s_store_sk = sc.ss_store_sk and\n       i_item_sk = sc.ss_item_sk\n       and i_manager_id BETWEEN 80 and 84\n       and s_state in ('IA','IL','NC')\n order by s_store_name, i_item_desc\nlimit 100;",
  "optimized_sql": "WITH filtered_store AS (SELECT s_store_sk FROM store WHERE s_state IN ('IA', 'IL', 'NC')), filtered_item AS (SELECT i_item_sk FROM item WHERE i_manager_id BETWEEN 80 AND 84) SELECT s_store_name, i_item_desc, sc.revenue, i_current_price, i_wholesale_cost, i_brand FROM store JOIN item ON s_store_sk = i_item_sk, (SELECT ss_store_sk, AVG(revenue) AS ave FROM (SELECT ss_store_sk, ss_item_sk, SUM(ss_sales_price) AS revenue FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN filtered_store AS fs ON ss_store_sk = fs.s_store_sk JOIN filtered_item AS fi ON ss_item_sk = fi.i_item_sk WHERE d_month_seq BETWEEN 1195 AND 1195 + 11 AND ss_sales_price / ss_list_price BETWEEN 38 * 0.01 AND 48 * 0.01 GROUP BY ss_store_sk, ss_item_sk) AS sa GROUP BY ss_store_sk) AS sb JOIN (SELECT ss_store_sk, ss_item_sk, SUM(ss_sales_price) AS revenue FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN filtered_store AS fs ON ss_store_sk = fs.s_store_sk JOIN filtered_item AS fi ON ss_item_sk = fi.i_item_sk WHERE d_month_seq BETWEEN 1195 AND 1195 + 11 AND ss_sales_price / ss_list_price BETWEEN 38 * 0.01 AND 48 * 0.01 GROUP BY ss_store_sk, ss_item_sk) AS sc ON sb.ss_store_sk = sc.ss_store_sk AND sc.revenue <= 0.1 * sb.ave WHERE s_store_sk = sc.ss_store_sk AND i_item_sk = sc.ss_item_sk ORDER BY s_store_name, i_item_desc LIMIT 100;",
  "transforms": [
    "pushdown_fix_projection"
  ],
  "n_iterations": 2,
  "n_api_calls": 9,
  "winning_patch": {
    "patch_id": "t3",
    "family": "A",
    "transform": "pushdown_fix_projection",
    "original_ms": 1629.9,
    "patch_ms": 10.7
  }
}