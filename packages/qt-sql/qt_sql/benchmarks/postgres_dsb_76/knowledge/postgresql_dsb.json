{
  "dataset": "postgresql_dsb",
  "last_updated": "2026-02-08T20:24:49.880702",
  "source_runs": [
    "swarm_batch_20260208_142643"
  ],
  "principles": [
    {
      "id": "or_to_union",
      "name": "Or To Union",
      "what": "Applied or_to_union achieving 73.35x speedup",
      "why": "Converting OR to UNION ALL lets optimizer choose independent index paths per branch",
      "when": "WHERE clause has OR conditions over different dimension keys (\u22643 branches)",
      "when_not": "Caused regression on query013_spj_spj, query085_agg, query085_spj_spj, query091_spj_spj, query101_agg (worst: 0.05x)",
      "verified_speedups": [
        73.35242111461433,
        66.32527638993845,
        53.10837425657921,
        3.067018811694743,
        1.7390934770856203,
        1.6973457487323271,
        1.170427997752986
      ],
      "avg_speedup": 28.637,
      "queries": [
        "query010_multi",
        "query013_agg",
        "query023_multi",
        "query054_multi",
        "query065_multi",
        "query072_spj_spj",
        "query080_multi"
      ],
      "transforms": [
        "date_cte_isolate",
        "dimension_cte_isolate",
        "or_to_union",
        "prefetch_fact_join"
      ]
    },
    {
      "id": "decorrelate",
      "name": "Decorrelate",
      "what": "Applied decorrelate, date_cte_isolate, dimension_cte_isolate achieving 122.29x speedup",
      "why": "Correlated subqueries re-execute per outer row; converting to JOIN eliminates per-row overhead; Pre-filtering date dimension into CTE reduces hash join probe table from 73K to ~365 rows; Pre-filtering all dimension tables into CTEs avoids repeated full-table scans",
      "when": "Query has correlated subquery in WHERE or SELECT that references outer table",
      "when_not": "Caused regression on query030_multi, query038_multi, query054_multi, query058_multi, query072_spj_spj, query083_multi, query087_multi (worst: 0.00x)",
      "verified_speedups": [
        122.28628549405371,
        108.83433493033179,
        107.74576725495528,
        11.623200099186304,
        10.946612330947332,
        10.835117003229474,
        4.630291368154034,
        4.103093014813743,
        2.126719235185333,
        1.9521396747351196,
        1.9242588792425155,
        1.7574278136172428,
        1.7413608791729855,
        1.52735815246076,
        1.5244777783663208,
        1.3253961714080202
      ],
      "avg_speedup": 24.68,
      "queries": [
        "query039_multi",
        "query054_multi",
        "query059_multi",
        "query065_multi",
        "query081_multi",
        "query087_multi"
      ],
      "transforms": [
        "date_cte_isolate",
        "decorrelate",
        "dimension_cte_isolate",
        "multi_dimension_prefetch",
        "prefetch_fact_join"
      ]
    },
    {
      "id": "prefetch_fact_join",
      "name": "Prefetch Fact Join",
      "what": "Applied prefetch_fact_join: Created separate pre-filtered CTEs for dimensions (date_dim, item) and fact subsets (store_sales with wholesale_cost filter), materialized distinct item_sk from frequent_ss_items, and converted IN subqueries to explicit joins to enable better plan optimization.",
      "why": "Pre-joining filtered dimensions with fact table before aggregation reduces join input",
      "when": "Query joins filtered dates/dims with large fact table; pre-join reduces probe size",
      "when_not": "Caused regression on query013_spj_spj, query025_agg, query031_multi, query050_spj_spj, query072_spj_spj, query083_multi, query085_agg, query087_multi, query101_agg (worst: 0.04x)",
      "verified_speedups": [
        64.55244269378329,
        3.3232686420331894,
        1.9096524241678212,
        1.1183033701998488
      ],
      "avg_speedup": 17.726,
      "queries": [
        "query023_multi",
        "query050_agg",
        "query080_multi"
      ],
      "transforms": [
        "prefetch_fact_join"
      ]
    },
    {
      "id": "date_cte_isolate",
      "name": "Date Cte Isolate",
      "what": "Applied date_cte_isolate, multi_dimension_prefetch achieving 11.23x speedup",
      "why": "Pre-filtering date dimension into CTE reduces hash join probe table from 73K to ~365 rows; Pre-filtering multiple dimension tables in parallel reduces join fan-out",
      "when": "Query joins date_dim on multiple conditions (year, month, etc.) with fact tables",
      "when_not": "Caused regression on many queries (worst: 0.00x); Rewrite increased execution time \u2014 likely added overhead or prevented optimizer optimizations",
      "verified_speedups": [
        11.232139433447843,
        9.62164454268518,
        5.230518436383954,
        4.427864781544116,
        4.332563879765709,
        4.1871005597949456,
        3.804719650483733,
        3.664518718324099,
        3.5183672412141727,
        3.280025955833233,
        2.020200575455194,
        1.8388338665963029,
        1.8219644169344114,
        1.820888647355756,
        1.5791616753126991,
        1.433334918594728,
        1.3943311758574517,
        1.3639086733889336,
        1.2724570762873264,
        1.2289723178206347,
        1.2090317549808018,
        1.1992900217595654,
        1.1873395682650838,
        1.180915193084758,
        1.1772966331778911,
        1.1760558717497558,
        1.1758970086549476,
        1.1715073534764526,
        1.1648213087268702,
        1.1404043526791572,
        1.1179640420855672,
        1.1119870666322185,
        1.1116793782034127,
        1.1084531937353757,
        1.1048729871954481
      ],
      "avg_speedup": 2.469,
      "queries": [
        "query010_multi",
        "query019_agg",
        "query019_spj_spj",
        "query025_spj_spj",
        "query027_agg",
        "query027_spj_spj",
        "query040_agg",
        "query040_spj_spj",
        "query050_agg",
        "query069_multi",
        "query072_agg",
        "query080_multi",
        "query099_agg",
        "query099_spj_spj",
        "query100_spj_spj",
        "query101_agg",
        "query101_spj_spj",
        "query102_agg",
        "query102_spj_spj"
      ],
      "transforms": [
        "date_cte_isolate",
        "dimension_cte_isolate",
        "multi_date_range_cte",
        "multi_dimension_prefetch",
        "prefetch_fact_join"
      ]
    },
    {
      "id": "pushdown",
      "name": "Pushdown",
      "what": "Applied pushdown: Created separate CTEs for filtered stores and two date ranges, then computed the two periods' aggregations independently with explicit JOINs and early filter pushdown.",
      "why": "Pushing predicates closer to table scans reduces data volume in upper operators",
      "when": "WHERE predicates reference columns from tables deep in the join tree",
      "when_not": "Caused regression on query014_multi, query027_spj_spj, query031_multi, query058_multi, query083_multi, query085_spj_spj, query087_multi, query091_agg (worst: 0.19x)",
      "verified_speedups": [
        4.6799802539183615,
        2.877932543501555,
        1.9303353662366844,
        1.1778171040495835,
        1.1003399162251937
      ],
      "avg_speedup": 2.353,
      "queries": [
        "query019_agg",
        "query059_multi",
        "query072_agg",
        "query080_multi",
        "query094_multi"
      ],
      "transforms": [
        "pushdown"
      ]
    },
    {
      "id": "unknown",
      "name": "Unknown",
      "what": "Applied unknown: Isolated date_dim subquery into a materialized CTE and created pre-filtered dimension CTEs for item and customer before joining with fact tables. Converted implicit joins to explicit JOIN syntax.",
      "why": "",
      "when": "",
      "when_not": "",
      "verified_speedups": [
        2.524130607367415,
        1.8413157512267129,
        1.5782496133672843,
        1.3090493738395756,
        1.3023183424416436,
        1.2228752599892374
      ],
      "avg_speedup": 1.63,
      "queries": [
        "query018_spj_spj",
        "query019_agg",
        "query058_multi",
        "query084_agg",
        "query099_spj_spj",
        "query102_agg"
      ],
      "transforms": []
    },
    {
      "id": "dimension_cte_isolate",
      "name": "Dimension Cte Isolate",
      "what": "Applied dimension_cte_isolate achieving 1.91x speedup",
      "why": "Pre-filtering all dimension tables into CTEs avoids repeated full-table scans",
      "when": "Query joins 2+ dimension tables that could each be pre-filtered independently",
      "when_not": "Caused regression on many queries (worst: 0.00x); PostgreSQL's CTE optimization fence behavior can prevent predicate pushdown",
      "verified_speedups": [
        1.908835330896292,
        1.598830782308037,
        1.3077128182680382
      ],
      "avg_speedup": 1.605,
      "queries": [
        "query072_spj_spj",
        "query084_agg",
        "query084_spj_spj"
      ],
      "transforms": [
        "dimension_cte_isolate"
      ]
    },
    {
      "id": "multi_dimension_prefetch",
      "name": "Multi Dimension Prefetch",
      "what": "Applied multi_dimension_prefetch achieving 2.10x speedup",
      "why": "Pre-filtering multiple dimension tables in parallel reduces join fan-out",
      "when": "Query references multiple dimension tables (date + store, date + item, etc.)",
      "when_not": "Caused regression on many queries (worst: 0.05x); Rewrite increased execution time \u2014 likely added overhead or prevented optimizer optimizations",
      "verified_speedups": [
        2.102927380757268,
        1.9057258662371936,
        1.4104156816846927,
        1.405997493540603,
        1.148035192530136
      ],
      "avg_speedup": 1.595,
      "queries": [
        "query084_agg",
        "query084_spj_spj"
      ],
      "transforms": [
        "multi_dimension_prefetch",
        "prefetch_fact_join"
      ]
    }
  ],
  "anti_patterns": [
    {
      "id": "regression_date_cte_isolate",
      "name": "Regression: Date Cte Isolate",
      "mechanism": "PostgreSQL's CTE optimization fence behavior prevents pushdown of filters across CTE boundaries, forcing full scans of large fact tables.",
      "observed_regressions": [0.09, 0.10, 0.13, 0.14, 0.15, 0.17, 0.17, 0.21, 0.32, 0.33, 0.48, 0.53, 0.54, 0.56, 0.57, 0.57, 0.58, 0.58, 0.59, 0.61, 0.62, 0.68, 0.69, 0.70, 0.70, 0.73, 0.73, 0.74, 0.77, 0.78, 0.78, 0.80, 0.80, 0.81, 0.81, 0.82, 0.82, 0.83, 0.85, 0.88, 0.88, 0.89, 0.90, 0.90, 0.91, 0.93, 0.93],
      "queries": ["query010_multi", "query013_agg", "query013_spj_spj", "query018_agg", "query018_spj_spj", "query019_spj_spj", "query025_agg", "query027_agg", "query027_spj_spj", "query031_multi", "query038_multi", "query040_spj_spj", "query050_spj_spj", "query064_multi", "query069_multi", "query072_agg", "query085_agg", "query085_spj_spj", "query087_multi", "query091_agg", "query091_spj_spj", "query094_multi", "query100_agg", "query101_agg", "query101_spj_spj", "query102_agg", "query102_spj_spj"],
      "avoid_when": "Applying date_cte_isolate to queries similar to the above list"
    },
    {
      "id": "regression_decorrelate",
      "name": "Regression: Decorrelate",
      "mechanism": "Rewrite increased execution time \u2014 likely added overhead or prevented optimizer optimizations",
      "observed_regressions": [0.00, 0.04, 0.06, 0.06, 0.26, 0.31, 0.34, 0.53, 0.60, 0.76, 0.85],
      "queries": ["query030_multi", "query038_multi", "query054_multi", "query058_multi", "query072_spj_spj", "query083_multi", "query087_multi"],
      "avoid_when": "Applying decorrelate to queries similar to query030_multi, query038_multi, query054_multi, query058_multi, query072_spj_spj, query083_multi, query087_multi"
    },
    {
      "id": "regression_or_to_union",
      "name": "Regression: Or To Union",
      "mechanism": "Column resolution errors from CTEs that only select subset of columns, then reference missing columns in main query WHERE clause.",
      "observed_regressions": [0.05, 0.20, 0.45, 0.45, 0.49, 0.68],
      "queries": ["query013_spj_spj", "query085_agg", "query085_spj_spj", "query091_spj_spj", "query101_agg"],
      "avoid_when": "Applying or_to_union to queries similar to query013_spj_spj, query085_agg, query085_spj_spj, query091_spj_spj, query101_agg"
    },
    {
      "id": "regression_prefetch_fact_join",
      "name": "Regression: Prefetch Fact Join",
      "mechanism": "CTEs materialized by default in PostgreSQL, creating temporary tables that eliminated index usage and increased I/O.",
      "observed_regressions": [0.47, 0.58, 0.68],
      "queries": ["query025_agg", "query087_multi", "query101_agg"],
      "avoid_when": "Applying prefetch_fact_join to queries similar to query025_agg, query087_multi, query101_agg"
    },
    {
      "id": "regression_pushdown",
      "name": "Regression: Pushdown",
      "mechanism": "PostgreSQL's optimizer treats CTEs as optimization fences, preventing pushdown of filters across CTE boundaries.",
      "observed_regressions": [0.19, 0.27, 0.30, 0.53, 0.61, 0.62, 0.64, 0.65],
      "queries": ["query014_multi", "query027_spj_spj", "query031_multi", "query058_multi", "query083_multi", "query085_spj_spj", "query087_multi", "query091_agg"],
      "avoid_when": "Applying pushdown to queries similar to query014_multi, query027_spj_spj, query031_multi, query058_multi, query083_multi, query085_spj_spj, query087_multi, query091_agg"
    },
    {
      "id": "regression_single_pass_aggregation",
      "name": "Regression: Single Pass Aggregation",
      "mechanism": "Only addressed dimension table filtering, missing the core bottleneck: multi-way self-join pattern forces repeated scans of aggregated data.",
      "observed_regressions": [0.62, 0.67],
      "queries": ["query031_multi"],
      "avoid_when": "Applying single_pass_aggregation to queries similar to query031_multi"
    },
    {
      "id": "regression_unknown_regression",
      "name": "Regression: Unknown Regression",
      "mechanism": "Triple INTERSECT in cross_items performs expensive set operations on large intermediate results before applying item filters.",
      "observed_regressions": [0.78],
      "queries": ["query014_multi"],
      "avoid_when": "Applying unknown_regression to queries similar to query014_multi"
    },
    {
      "id": "error_execution",
      "name": "Error Pattern: Execution",
      "mechanism": "DISTINCT is not implemented for window functions",
      "observed_regressions": [0.0],
      "queries": ["query094_multi"],
      "avoid_when": "Watch for execution errors when rewriting queries with complex joins/aliases"
    },
    {
      "id": "error_timeout",
      "name": "Error Pattern: Timeout",
      "mechanism": "canceling statement due to statement timeout",
      "observed_regressions": [0.0, 0.0],
      "queries": ["query014_multi", "query085_spj_spj"],
      "avoid_when": "Watch for timeout errors when rewriting queries with complex joins/aliases"
    },
    {
      "id": "error_unknown",
      "name": "Error Pattern: Unknown",
      "mechanism": "operator does not exist: integer = character â€” type mismatch from incorrect join column references",
      "observed_regressions": [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
      "queries": ["query013_spj_spj", "query014_multi", "query019_agg", "query023_multi", "query025_spj_spj", "query030_multi", "query031_multi", "query054_multi", "query058_multi", "query064_multi", "query072_agg", "query075_multi", "query085_agg", "query085_spj_spj", "query091_agg", "query094_multi", "query101_spj_spj", "query102_agg", "query102_spj_spj"],
      "avoid_when": "Watch for unknown errors when rewriting queries with complex joins/aliases"
    },
    {
      "id": "semantic_mismatch_date_cte_isolate",
      "name": "Semantic Mismatch: Date Cte Isolate",
      "mechanism": "Rewrite changed query semantics \u2014 different row counts or values returned",
      "observed_regressions": [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
      "queries": ["query040_agg", "query075_multi", "query099_agg", "query100_agg"],
      "avoid_when": "Applying date_cte_isolate to queries where semantic equivalence is hard to verify"
    },
    {
      "id": "semantic_mismatch_decorrelate",
      "name": "Semantic Mismatch: Decorrelate",
      "mechanism": "Rewrite changed query semantics \u2014 different row counts or values returned",
      "observed_regressions": [0.0, 0.0, 0.0],
      "queries": ["query014_multi", "query059_multi", "query075_multi"],
      "avoid_when": "Applying decorrelate to queries where semantic equivalence is hard to verify"
    },
    {
      "id": "semantic_mismatch_multi_dimension_prefetch",
      "name": "Semantic Mismatch: Multi Dimension Prefetch",
      "mechanism": "Rewrite changed query semantics \u2014 different row counts or values returned",
      "observed_regressions": [0.0],
      "queries": ["query084_agg"],
      "avoid_when": "Applying multi_dimension_prefetch to queries where semantic equivalence is hard to verify"
    },
    {
      "id": "semantic_mismatch_or_to_union",
      "name": "Semantic Mismatch: Or To Union",
      "mechanism": "Rewrite changed query semantics \u2014 different row counts or values returned",
      "observed_regressions": [0.0],
      "queries": ["query100_agg"],
      "avoid_when": "Applying or_to_union to queries where semantic equivalence is hard to verify"
    },
    {
      "id": "semantic_mismatch_prefetch_fact_join",
      "name": "Semantic Mismatch: Prefetch Fact Join",
      "mechanism": "Rewrite changed query semantics \u2014 different row counts or values returned",
      "observed_regressions": [0.0],
      "queries": ["query075_multi"],
      "avoid_when": "Applying prefetch_fact_join to queries where semantic equivalence is hard to verify"
    },
    {
      "id": "semantic_mismatch_union_cte_split",
      "name": "Semantic Mismatch: Union Cte Split",
      "mechanism": "Rewrite changed query semantics \u2014 different row counts or values returned",
      "observed_regressions": [0.0, 0.0],
      "queries": ["query075_multi"],
      "avoid_when": "Applying union_cte_split to queries where semantic equivalence is hard to verify"
    }
  ]
}
