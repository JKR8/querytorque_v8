### Part 1: Modified Logic Tree

```
QUERY: (single statement)
└── [MAIN] main_query  [~]  Cost: 100%  Rows: 100
    ├── WITH (filtered_customer_address, filtered_income_band, prefetched_dims)
    ├── SCAN (customer, customer_demographics, store_returns)
    ├── JOIN (prefetched_dims ON c_current_addr_sk = ca_address_sk AND c_current_hdemo_sk = hd_demo_sk)
    ├── JOIN (customer_demographics ON cd_demo_sk = c_current_cdemo_sk)
    ├── JOIN (store_returns ON sr_cdemo_sk = cd_demo_sk)
    ├── SORT (c_customer_id ASC)
    └── OUTPUT (customer_id, customername)
```

### Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "PostgreSQL v16",
  "rewrite_rules": [
    {"id": "R1", "type": "dimension_prefetch", "description": "Pre-filter selective dimension tables into CTEs to create tiny hash tables", "applied_to": ["filtered_customer_address", "filtered_income_band"]},
    {"id": "R2", "type": "explicit_join_syntax", "description": "Convert comma joins to explicit JOIN syntax", "applied_to": ["prefetched_dims", "main_query"]},
    {"id": "R3", "type": "multi_dimension_merge", "description": "Combine pre-filtered dimensions into single CTE for address+household joins", "applied_to": ["prefetched_dims"]}
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "filtered_customer_address": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT ca_address_sk, ca_location_type, ca_street_type, ca_county, ca_city, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_street_name FROM customer_address WHERE ca_city = 'Mount Vernon'",
        "interfaces": {"outputs": ["ca_address_sk", "ca_location_type", "ca_street_type", "ca_county", "ca_city", "ca_state", "ca_zip", "ca_country", "ca_gmt_offset", "ca_street_name"], "consumes": []}
      },
      "filtered_income_band": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT ib_income_band_sk, ib_lower_bound, ib_upper_bound FROM income_band WHERE ib_lower_bound >= 40374 AND ib_upper_bound <= 90374",
        "interfaces": {"outputs": ["ib_income_band_sk", "ib_lower_bound", "ib_upper_bound"], "consumes": []}
      },
      "prefetched_dims": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT fca.ca_address_sk, hd.hd_demo_sk, hd.hd_income_band_sk FROM filtered_customer_address fca CROSS JOIN filtered_income_band fib INNER JOIN household_demographics hd ON hd.hd_income_band_sk = fib.ib_income_band_sk",
        "interfaces": {"outputs": ["ca_address_sk", "hd_demo_sk", "hd_income_band_sk"], "consumes": ["filtered_customer_address", "filtered_income_band"]}
      },
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT c_customer_id AS customer_id, COALESCE(c_last_name,'') || ', ' || COALESCE(c_first_name,'') AS customername FROM customer INNER JOIN prefetched_dims ON customer.c_current_addr_sk = prefetched_dims.ca_address_sk AND customer.c_current_hdemo_sk = prefetched_dims.hd_demo_sk INNER JOIN customer_demographics ON customer_demographics.cd_demo_sk = customer.c_current_cdemo_sk INNER JOIN store_returns ON store_returns.sr_cdemo_sk = customer_demographics.cd_demo_sk ORDER BY c_customer_id LIMIT 100",
        "interfaces": {"outputs": ["customer_id", "customername"], "consumes": ["prefetched_dims"]}
      }
    },
    "reconstruction_order": ["filtered_customer_address", "filtered_income_band", "prefetched_dims", "main_query"],
    "assembly_template": "WITH filtered_customer_address AS ({filtered_customer_address}), filtered_income_band AS ({filtered_income_band}), prefetched_dims AS ({prefetched_dims}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "runtime_config": [],
  "validation_checks": []
}
```

Changes: Restructured into three CTEs pre-filtering selective dimensions (customer_address, income_band), combined into a single prefetched_dims CTE, then joined explicitly with customer/customer_demographics/store_returns. This isolates dimension filtering and enables hash joins with tiny probe tables.

Expected speedup: 2-3x (from dimension isolation and explicit join planning)