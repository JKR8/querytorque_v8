## Modified Logic Tree

[+] date_dim_cte: CTE isolating date filter (d_year = 2001)
[+] hh_demo_cte: CTE pre-filtering household_demographics (hd_dep_count IN (1,3))
[+] cust_demo_cte: CTE pre-filtering customer_demographics with OR conditions
[+] cust_addr_cte: CTE pre-filtering customer_address (ca_country = 'United States' with state lists)
[=] store: unchanged (small dimension, full scan acceptable)
[~] main_query: Converted comma-joins to explicit INNER JOINs with CTE references
[=] aggregation: unchanged MIN aggregations

## Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "postgresql",
  "rewrite_rules": [
    {"id": "R1", "type": "date_cte_isolate", "description": "Isolate date dimension filter into CTE", "applied_to": ["date_dim_cte"]},
    {"id": "R2", "type": "dimension_prefetch", "description": "Pre-filter selective dimension tables into CTEs", "applied_to": ["hh_demo_cte", "cust_demo_cte", "cust_addr_cte"]},
    {"id": "R3", "type": "explicit_join_syntax", "description": "Convert comma-joins to explicit INNER JOIN syntax", "applied_to": ["main_query"]}
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "date_dim_cte": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT d_date_sk FROM date_dim WHERE d_year = 2001",
        "interfaces": {"outputs": ["d_date_sk"], "consumes": []}
      },
      "hh_demo_cte": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT hd_demo_sk FROM household_demographics WHERE hd_dep_count IN (1, 3)",
        "interfaces": {"outputs": ["hd_demo_sk"], "consumes": []}
      },
      "cust_demo_cte": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE (cd_marital_status = 'M' AND cd_education_status = '2 yr Degree') OR (cd_marital_status = 'U' AND cd_education_status = 'College') OR (cd_marital_status = 'S' AND cd_education_status = 'Unknown')",
        "interfaces": {"outputs": ["cd_demo_sk", "cd_marital_status", "cd_education_status"], "consumes": []}
      },
      "cust_addr_cte": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT ca_address_sk, ca_state FROM customer_address WHERE ca_country = 'United States' AND (ca_state IN ('CO', 'NC', 'TX') OR ca_state IN ('AR', 'NY', 'TX') OR ca_state IN ('IA', 'IL', 'NC'))",
        "interfaces": {"outputs": ["ca_address_sk", "ca_state"], "consumes": []}
      },
      "store": {
        "type": "table",
        "change": "unchanged",
        "sql": "",
        "interfaces": {"outputs": [], "consumes": []}
      },
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT MIN(ss_quantity), MIN(ss_ext_sales_price), MIN(ss_ext_wholesale_cost), MIN(ss_ext_wholesale_cost) FROM store_sales INNER JOIN date_dim_cte ON ss_sold_date_sk = d_date_sk INNER JOIN store ON ss_store_sk = s_store_sk INNER JOIN hh_demo_cte ON ss_hdemo_sk = hd_demo_sk INNER JOIN cust_demo_cte ON ss_cdemo_sk = cd_demo_sk INNER JOIN cust_addr_cte ON ss_addr_sk = ca_address_sk WHERE ((cd_marital_status = 'M' AND cd_education_status = '2 yr Degree' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND ca_state IN ('CO', 'NC', 'TX') AND ss_net_profit BETWEEN 100 AND 200) OR (cd_marital_status = 'U' AND cd_education_status = 'College' AND ss_sales_price BETWEEN 50.00 AND 100.00 AND ca_state IN ('AR', 'NY', 'TX') AND ss_net_profit BETWEEN 150 AND 300) OR (cd_marital_status = 'S' AND cd_education_status = 'Unknown' AND ss_sales_price BETWEEN 150.00 AND 200.00 AND ca_state IN ('IA', 'IL', 'NC') AND ss_net_profit BETWEEN 50 AND 250))",
        "interfaces": {
          "outputs": ["min(ss_quantity)", "min(ss_ext_sales_price)", "min(ss_ext_wholesale_cost)", "min(ss_ext_wholesale_cost)"],
          "consumes": ["date_dim_cte", "hh_demo_cte", "cust_demo_cte", "cust_addr_cte"]
        }
      }
    },
    "reconstruction_order": ["date_dim_cte", "hh_demo_cte", "cust_demo_cte", "cust_addr_cte", "main_query"],
    "assembly_template": "WITH date_dim_cte AS ({date_dim_cte}), hh_demo_cte AS ({hh_demo_cte}), cust_demo_cte AS ({cust_demo_cte}), cust_addr_cte AS ({cust_addr_cte}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "runtime_config": [
    "SET LOCAL enable_nestloop = off",
    "SET LOCAL enable_hashjoin = on",
    "SET LOCAL hash_mem_multiplier = 2.0"
  ],
  "validation_checks": []
}
```

**Changes**: Converted comma-joins to explicit INNER JOINs and pre-filtered all selective dimension tables into materialized CTEs before joining with the fact table. This exploits PostgreSQL's explicit JOIN optimization and reduces join cardinality early.

**Expected speedup**: 2.5x-3.0x. The rewrite addresses PostgreSQL's comma-join weakness by using explicit JOIN syntax, reduces nested loop pressure by pre-filtering dimensions, and enables better hash join planning with smaller dimension sets. The runtime configuration disables nested loops (which were the bottleneck) and boosts hash join memory allocation.