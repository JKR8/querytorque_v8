### Part 1: Modified Logic Tree
```
QUERY: (single statement)
├── [CTE] date_filtered [~] (Previously part of customer_total_return)
│   ├── SCAN (date_dim)
│   └── FILTER (d_year = 2000)
├── [CTE] store_filtered [+] (Extracted from main query)
│   ├── SCAN (store)
│   └── FILTER (s_state IN ('IA','KY','NE'))
├── [CTE] customer_filtered [+] (Extracted from main query)
│   ├── SCAN (customer)
│   └── FILTER (c_birth_month = 4 AND c_birth_year BETWEEN 1987 AND 1993)
├── [CTE] demo_filtered [+] (Extracted from main query)
│   ├── SCAN (customer_demographics)
│   └── FILTER (cd_marital_status IN ('S','S') AND cd_education_status IN ('4 yr Degree','4 yr Degree') AND cd_gender = 'M')
├── [CTE] returns_cte [~] (Now joins date_filtered instead of date_dim directly)
│   ├── SCAN (store_returns)
│   ├── JOIN (INNER, date_filtered ON sr_returned_date_sk = d_date_sk)
│   ├── FILTER (sr_return_amt/sr_return_quantity BETWEEN 115 AND 174)
│   ├── AGG (GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk)
│   └── OUTPUT (ctr_customer_sk, ctr_store_sk, ctr_reason_sk, ctr_total_return)
├── [CTE] subquery_cte [+] (Materializes store averages from returns_cte)
│   ├── SCAN (returns_cte)
│   ├── AGG (GROUP BY ctr_store_sk)
│   └── OUTPUT (ctr_store_sk, store_threshold)
├── [MAIN] explicit_joins [~] (Now uses explicit JOIN syntax with CTEs)
│   ├── JOIN (returns_cte r1 INNER JOIN subquery_cte s ON r1.ctr_store_sk = s.ctr_store_sk)
│   ├── JOIN (INNER JOIN store_filtered sf ON r1.ctr_store_sk = sf.s_store_sk)
│   ├── JOIN (INNER JOIN customer_filtered cf ON r1.ctr_customer_sk = cf.c_customer_sk)
│   ├── JOIN (INNER JOIN demo_filtered df ON cf.c_current_cdemo_sk = df.cd_demo_sk)
│   ├── FILTER (r1.ctr_total_return > s.store_threshold)
│   ├── FILTER (r1.ctr_reason_sk BETWEEN 17 AND 20)
│   ├── SORT (c_customer_id ASC)
│   └── OUTPUT (c_customer_id)
└── [=] LIMIT 100
```

### Part 2: Component Payload JSON
```json
{
  "spec_version": "1.0",
  "dialect": "postgresql",
  "rewrite_rules": [
    {"id": "R1", "type": "multi_dimension_prefetch", "description": "Pre-filter selective dimension tables into CTEs to create tiny hash tables", "applied_to": ["date_filtered", "store_filtered", "customer_filtered", "demo_filtered"]},
    {"id": "R2", "type": "explicit_join_conversion", "description": "Convert comma-separated implicit joins to explicit JOIN syntax for better cardinality estimation", "applied_to": ["returns_cte", "explicit_joins"]},
    {"id": "R3", "type": "correlated_subquery_materialization", "description": "Materialize store-level averages into a separate CTE to eliminate correlated subquery execution", "applied_to": ["subquery_cte"]}
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "date_filtered": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT d_date_sk FROM date_dim WHERE d_year = 2000",
        "interfaces": {"outputs": ["d_date_sk"], "consumes": []}
      },
      "store_filtered": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT s_store_sk FROM store WHERE s_state IN ('IA','KY','NE')",
        "interfaces": {"outputs": ["s_store_sk"], "consumes": []}
      },
      "customer_filtered": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT c_customer_sk, c_current_cdemo_sk, c_customer_id FROM customer WHERE c_birth_month = 4 AND c_birth_year BETWEEN 1987 AND 1993",
        "interfaces": {"outputs": ["c_customer_sk", "c_current_cdemo_sk", "c_customer_id"], "consumes": []}
      },
      "demo_filtered": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT cd_demo_sk FROM customer_demographics WHERE cd_marital_status IN ('S','S') AND cd_education_status IN ('4 yr Degree','4 yr Degree') AND cd_gender = 'M'",
        "interfaces": {"outputs": ["cd_demo_sk"], "consumes": []}
      },
      "returns_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, sr_reason_sk AS ctr_reason_sk, SUM(SR_RETURN_AMT_INC_TAX) AS ctr_total_return FROM store_returns INNER JOIN date_filtered ON sr_returned_date_sk = date_filtered.d_date_sk WHERE sr_return_amt / sr_return_quantity BETWEEN 115 AND 174 GROUP BY sr_customer_sk, sr_store_sk, sr_reason_sk",
        "interfaces": {"outputs": ["ctr_customer_sk", "ctr_store_sk", "ctr_reason_sk", "ctr_total_return"], "consumes": ["date_filtered"]}
      },
      "subquery_cte": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS store_threshold FROM returns_cte GROUP BY ctr_store_sk",
        "interfaces": {"outputs": ["ctr_store_sk", "store_threshold"], "consumes": ["returns_cte"]}
      },
      "explicit_joins": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT cf.c_customer_id FROM returns_cte r1 INNER JOIN subquery_cte s ON r1.ctr_store_sk = s.ctr_store_sk INNER JOIN store_filtered sf ON r1.ctr_store_sk = sf.s_store_sk INNER JOIN customer_filtered cf ON r1.ctr_customer_sk = cf.c_customer_sk INNER JOIN demo_filtered df ON cf.c_current_cdemo_sk = df.cd_demo_sk WHERE r1.ctr_total_return > s.store_threshold AND r1.ctr_reason_sk BETWEEN 17 AND 20 ORDER BY cf.c_customer_id LIMIT 100",
        "interfaces": {"outputs": ["c_customer_id"], "consumes": ["returns_cte", "subquery_cte", "store_filtered", "customer_filtered", "demo_filtered"]}
      }
    },
    "reconstruction_order": ["date_filtered", "store_filtered", "customer_filtered", "demo_filtered", "returns_cte", "subquery_cte", "explicit_joins"],
    "assembly_template": "WITH date_filtered AS ({date_filtered}), store_filtered AS ({store_filtered}), customer_filtered AS ({customer_filtered}), demo_filtered AS ({demo_filtered}), returns_cte AS ({returns_cte}), subquery_cte AS ({subquery_cte}) {explicit_joins}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "runtime_config": [],
  "validation_checks": []
}
```

Changes: Isolated selective dimension filters into CTEs (date, store, customer, demographics) and converted implicit comma joins to explicit INNER JOIN syntax. Materialized the correlated subquery (store averages) into a separate CTE to eliminate repeated execution.

Expected speedup: ~3-4x due to elimination of correlated subquery execution (8,834 repetitions) and better join planning from explicit syntax + pre-filtered dimension hash tables.