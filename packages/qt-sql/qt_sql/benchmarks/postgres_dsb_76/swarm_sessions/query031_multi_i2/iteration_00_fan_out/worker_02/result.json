{
  "worker_id": 2,
  "strategy": "self_join_elimination_pivot",
  "examples_used": [
    "pg_self_join_decomposition",
    "single_pass_aggregation"
  ],
  "optimized_sql": "WITH ss_all_quarters AS (SELECT ca_county, d_qoy, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales, date_dim, customer_address, item WHERE ss_sold_date_sk = d_date_sk AND ss_addr_sk = ca_address_sk AND ss_item_sk = i_item_sk AND i_color IN ('dark', 'puff') AND i_manager_id BETWEEN 15 AND 34 AND ss_list_price BETWEEN 244 AND 258 AND ca_state IN ('KS', 'OH') AND d_year = 1999 AND d_qoy IN (1, 2, 3) GROUP BY ca_county, d_qoy, d_year), ss_pivot AS (SELECT ca_county, d_year, MAX(CASE WHEN d_qoy = 1 THEN store_sales END) AS store_sales_q1, MAX(CASE WHEN d_qoy = 2 THEN store_sales END) AS store_sales_q2, MAX(CASE WHEN d_qoy = 3 THEN store_sales END) AS store_sales_q3 FROM ss_all_quarters GROUP BY ca_county, d_year), ws_all_quarters AS (SELECT ca_county, d_qoy, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales, date_dim, customer_address, item WHERE ws_sold_date_sk = d_date_sk AND ws_bill_addr_sk = ca_address_sk AND ws_item_sk = i_item_sk AND i_color IN ('dark', 'puff') AND i_manager_id BETWEEN 15 AND 34 AND ws_list_price BETWEEN 244 AND 258 AND ca_state IN ('KS', 'OH') AND d_year = 1999 AND d_qoy IN (1, 2, 3) GROUP BY ca_county, d_qoy, d_year), ws_pivot AS (SELECT ca_county, d_year, MAX(CASE WHEN d_qoy = 1 THEN web_sales END) AS web_sales_q1, MAX(CASE WHEN d_qoy = 2 THEN web_sales END) AS web_sales_q2, MAX(CASE WHEN d_qoy = 3 THEN web_sales END) AS web_sales_q3 FROM ws_all_quarters GROUP BY ca_county, d_year) SELECT ss_pivot.ca_county, ss_pivot.d_year, CASE WHEN web_sales_q1 > 0 THEN web_sales_q2 / web_sales_q1 ELSE NULL END AS web_q1_q2_increase, CASE WHEN store_sales_q1 > 0 THEN store_sales_q2 / store_sales_q1 ELSE NULL END AS store_q1_q2_increase, CASE WHEN web_sales_q2 > 0 THEN web_sales_q3 / web_sales_q2 ELSE NULL END AS web_q2_q3_increase, CASE WHEN store_sales_q2 > 0 THEN store_sales_q3 / store_sales_q2 ELSE NULL END AS store_q2_q3_increase FROM ss_pivot JOIN ws_pivot ON ss_pivot.ca_county = ws_pivot.ca_county WHERE CASE WHEN web_sales_q1 > 0 THEN web_sales_q2 / web_sales_q1 ELSE NULL END > CASE WHEN store_sales_q1 > 0 THEN store_sales_q2 / store_sales_q1 ELSE NULL END AND CASE WHEN web_sales_q2 > 0 THEN web_sales_q3 / web_sales_q2 ELSE NULL END > CASE WHEN store_sales_q2 > 0 THEN store_sales_q3 / store_sales_q2 ELSE NULL END ORDER BY ss_pivot.d_year",
  "speedup": 1.7883478966612363,
  "status": "WIN",
  "transforms": [
    "single_pass_aggregation"
  ],
  "hint": "- pg_self_join_decomposition: Apply materializing the fact+dimension scan once a",
  "error_message": null,
  "error_messages": [],
  "error_category": null,
  "set_local_config": {
    "params": {
      "work_mem": "64MB",
      "enable_hashjoin": "on",
      "enable_mergejoin": "off",
      "enable_nestloop": "off",
      "hash_mem_multiplier": "2.0"
    },
    "commands": [
      "SET LOCAL enable_hashjoin = 'on'",
      "SET LOCAL enable_mergejoin = 'off'",
      "SET LOCAL enable_nestloop = 'off'",
      "SET LOCAL hash_mem_multiplier = '2.0'",
      "SET LOCAL work_mem = '64MB'"
    ],
    "config_speedup": 0.7704758268293511,
    "rewrite_only_speedup": 1.7883478966612363
  }
}