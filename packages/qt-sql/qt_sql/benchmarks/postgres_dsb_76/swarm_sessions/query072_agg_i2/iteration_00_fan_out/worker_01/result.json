{
  "worker_id": 1,
  "strategy": "pg_materialized_dimension_fact_prefilter",
  "examples_used": [
    "pg_materialized_dimension_fact_prefilter",
    "pg_dimension_prefetch_star",
    "pg_date_cte_explicit_join"
  ],
  "optimized_sql": "WITH filtered_d1 AS (SELECT d_date_sk, d_week_seq, d_date FROM date_dim WHERE d_year = 1999), filtered_hd AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential = '>10000'), filtered_cd AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_marital_status = 'S' AND cd_dep_count BETWEEN 9 AND 11), filtered_item AS (SELECT i_item_sk, i_item_desc FROM item WHERE i_category IN ('Men', 'Shoes', 'Sports')), filtered_catalog_sales AS (SELECT cs.cs_item_sk, cs.cs_quantity, cs.cs_promo_sk, cs.cs_order_number, cs.cs_ship_date_sk, cs.cs_wholesale_cost, d1.d_date, d1.d_week_seq FROM catalog_sales cs INNER JOIN filtered_d1 d1 ON cs.cs_sold_date_sk = d1.d_date_sk INNER JOIN filtered_hd hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk INNER JOIN filtered_cd cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk INNER JOIN filtered_item i ON i.i_item_sk = cs.cs_item_sk WHERE cs.cs_wholesale_cost BETWEEN 76 AND 96), filtered_inventory AS (SELECT inv.inv_warehouse_sk, inv.inv_date_sk, inv.inv_item_sk, inv.inv_quantity_on_hand FROM inventory inv INNER JOIN filtered_item i ON inv.inv_item_sk = i.i_item_sk), filtered_d2 AS (SELECT d2.d_date_sk, d1.d_week_seq FROM date_dim d2 INNER JOIN filtered_d1 d1 ON d2.d_week_seq = d1.d_week_seq), filtered_d3 AS (SELECT d3.d_date_sk FROM date_dim d3 INNER JOIN filtered_catalog_sales cs ON cs.cs_ship_date_sk = d3.d_date_sk WHERE d3.d_date > cs.d_date + INTERVAL '3 day'), filtered_promotion AS (SELECT p.p_promo_sk, cs.cs_item_sk, cs.cs_order_number FROM promotion p LEFT JOIN filtered_catalog_sales cs ON cs.cs_promo_sk = p.p_promo_sk) SELECT i.i_item_desc, w.w_warehouse_name, cs.d_week_seq, SUM(CASE WHEN p.p_promo_sk IS NULL THEN 1 ELSE 0 END) AS no_promo, SUM(CASE WHEN p.p_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS promo, COUNT(*) AS total_cnt FROM filtered_catalog_sales cs INNER JOIN filtered_inventory inv ON cs.cs_item_sk = inv.inv_item_sk AND inv.inv_quantity_on_hand < cs.cs_quantity INNER JOIN warehouse w ON w.w_warehouse_sk = inv.inv_warehouse_sk INNER JOIN filtered_item i ON i.i_item_sk = cs.cs_item_sk INNER JOIN filtered_d2 d2 ON inv.inv_date_sk = d2.d_date_sk INNER JOIN filtered_d3 d3 ON cs.cs_ship_date_sk = d3.d_date_sk LEFT JOIN filtered_promotion p ON cs.cs_promo_sk = p.p_promo_sk AND cs.cs_item_sk = p.cs_item_sk AND cs.cs_order_number = p.cs_order_number LEFT JOIN catalog_returns cr ON cr.cr_item_sk = cs.cs_item_sk AND cr.cr_order_number = cs.cs_order_number GROUP BY i.i_item_desc, w.w_warehouse_name, cs.d_week_seq ORDER BY total_cnt DESC, i.i_item_desc, w.w_warehouse_name, cs.d_week_seq LIMIT 100",
  "speedup": 12.067285703268267,
  "status": "WIN",
  "transforms": [
    "date_cte_isolate"
  ],
  "hint": "- pg_materialized_dimension_fact_prefilter: Apply the pattern of pre-filtering b",
  "error_message": null,
  "error_messages": [],
  "error_category": null
}