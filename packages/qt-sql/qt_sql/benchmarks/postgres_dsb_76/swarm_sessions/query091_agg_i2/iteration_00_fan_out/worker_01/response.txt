## Part 1: Modified Logic Tree

```
QUERY: (single statement)
└── [~] MAIN: Changed from single block to CTE chain with explicit joins
    ├── [+] date_cte
    │   └── SCAN date_dim (filtered: d_year=2001, d_moy=12)
    ├── [+] call_center_cte  
    │   └── SCAN call_center (unfiltered)
    ├── [+] customer_address_cte
    │   └── SCAN customer_address (filtered: ca_gmt_offset=-6)
    ├── [+] customer_demographics_cte
    │   └── SCAN customer_demographics (filtered: OR condition)
    ├── [+] household_demographics_cte
    │   └── SCAN household_demographics (filtered: hd_buy_potential LIKE '>10000%')
    ├── [+] customer_cte
    │   ├── SCAN customer
    │   ├── JOIN customer_address_cte (INNER ON ca_address_sk=c_current_addr_sk)
    │   ├── JOIN customer_demographics_cte (INNER ON cd_demo_sk=c_current_cdemo_sk)
    │   └── JOIN household_demographics_cte (INNER ON hd_demo_sk=c_current_hdemo_sk)
    ├── [+] catalog_returns_join
    │   ├── SCAN catalog_returns
    │   ├── JOIN date_cte (INNER ON cr_returned_date_sk=d_date_sk)
    │   ├── JOIN call_center_cte (INNER ON cr_call_center_sk=cc_call_center_sk)
    │   └── JOIN customer_cte (INNER ON cr_returning_customer_sk=c_customer_sk)
    ├── [+] aggregation
    │   ├── FROM catalog_returns_join
    │   ├── GROUP BY cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status
    │   └── AGGREGATE SUM(cr_net_loss) AS Returns_Loss
    └── [+] sort
        ├── FROM aggregation
        └── ORDER BY Returns_Loss DESC
```

## Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "PostgreSQL 16",
  "rewrite_rules": [
    {"id": "R1", "type": "dimension_isolation", "description": "Pre-filter selective dimensions into separate CTEs for better cardinality estimation", "applied_to": ["date_cte", "customer_address_cte", "customer_demographics_cte", "household_demographics_cte"]},
    {"id": "R2", "type": "explicit_join_conversion", "description": "Convert comma-separated joins to explicit INNER JOIN syntax", "applied_to": ["customer_cte", "catalog_returns_join"]},
    {"id": "R3", "type": "cte_pipeline", "description": "Structure query as pipeline of CTEs matching logical execution order", "applied_to": ["main_query"]}
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "date_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE d_year = 2001 AND d_moy = 12",
        "interfaces": {"outputs": ["d_date_sk", "d_year", "d_moy"], "consumes": []}
      },
      "call_center_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT cc_call_center_sk, cc_call_center_id, cc_name, cc_manager FROM call_center",
        "interfaces": {"outputs": ["cc_call_center_sk", "cc_call_center_id", "cc_name", "cc_manager"], "consumes": []}
      },
      "customer_address_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT ca_address_sk FROM customer_address WHERE ca_gmt_offset = -6",
        "interfaces": {"outputs": ["ca_address_sk"], "consumes": []}
      },
      "customer_demographics_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE (cd_marital_status = 'M' AND cd_education_status = 'Unknown') OR (cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree')",
        "interfaces": {"outputs": ["cd_demo_sk", "cd_marital_status", "cd_education_status"], "consumes": []}
      },
      "household_demographics_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential LIKE '>10000%'",
        "interfaces": {"outputs": ["hd_demo_sk"], "consumes": []}
      },
      "customer_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT c.c_customer_sk, c.c_current_addr_sk, c.c_current_cdemo_sk, c.c_current_hdemo_sk FROM customer c INNER JOIN customer_address_cte ON ca_address_sk = c.c_current_addr_sk INNER JOIN customer_demographics_cte ON cd_demo_sk = c.c_current_cdemo_sk INNER JOIN household_demographics_cte ON hd_demo_sk = c.c_current_hdemo_sk",
        "interfaces": {"outputs": ["c_customer_sk", "c_current_addr_sk", "c_current_cdemo_sk", "c_current_hdemo_sk"], "consumes": ["customer_address_cte", "customer_demographics_cte", "household_demographics_cte"]}
      },
      "catalog_returns_join": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, cr_net_loss FROM catalog_returns cr INNER JOIN date_cte ON cr_returned_date_sk = d_date_sk INNER JOIN call_center_cte ON cr_call_center_sk = cc_call_center_sk INNER JOIN customer_cte ON cr_returning_customer_sk = c_customer_sk",
        "interfaces": {"outputs": ["cc_call_center_id", "cc_name", "cc_manager", "cd_marital_status", "cd_education_status", "cr_net_loss"], "consumes": ["date_cte", "call_center_cte", "customer_cte"]}
      },
      "aggregation": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, SUM(cr_net_loss) AS Returns_Loss FROM catalog_returns_join GROUP BY cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status",
        "interfaces": {"outputs": ["cc_call_center_id", "cc_name", "cc_manager", "cd_marital_status", "cd_education_status", "Returns_Loss"], "consumes": ["catalog_returns_join"]}
      },
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT cc_call_center_id AS Call_Center, cc_name AS Call_Center_Name, cc_manager AS Manager, Returns_Loss FROM aggregation ORDER BY Returns_Loss DESC",
        "interfaces": {"outputs": ["Call_Center", "Call_Center_Name", "Manager", "Returns_Loss"], "consumes": ["aggregation"]}
      }
    },
    "reconstruction_order": ["date_cte", "call_center_cte", "customer_address_cte", "customer_demographics_cte", "household_demographics_cte", "customer_cte", "catalog_returns_join", "aggregation", "main_query"],
    "assembly_template": "WITH date_cte AS ({date_cte}), call_center_cte AS ({call_center_cte}), customer_address_cte AS ({customer_address_cte}), customer_demographics_cte AS ({customer_demographics_cte}), household_demographics_cte AS ({household_demographics_cte}), customer_cte AS ({customer_cte}), catalog_returns_join AS ({catalog_returns_join}), aggregation AS ({aggregation}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "runtime_config": [],
  "validation_checks": []
}
```

**Changes**: Converted comma-separated joins to explicit INNER JOINs and pre-filtered selective dimensions (date, customer_demographics, household_demographics, customer_address) into separate CTEs. This isolates filter selectivity early and provides PostgreSQL with better cardinality estimates for hash joins.

**Expected speedup**: ~2.0-2.5x based on similar patterns in reference examples. The explicit join syntax combined with pre-materialized small dimension CTEs should enable better parallel hash join planning and eliminate ambiguous comma-join cardinality estimation.