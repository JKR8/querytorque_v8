{
  "worker_id": 4,
  "strategy": "pivot_consolidation",
  "examples_used": [
    "scan_consolidation_pivot",
    "union_consolidation",
    "single_pass_aggregation"
  ],
  "optimized_sql": "WITH filtered_date AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy BETWEEN 3 AND 5), all_sales_unified AS (SELECT ss_customer_sk AS customer_sk, 'store' AS channel FROM store_sales JOIN filtered_date ON ss_sold_date_sk = filtered_date.d_date_sk WHERE ss_list_price BETWEEN 52 AND 141 UNION ALL SELECT ws_bill_customer_sk AS customer_sk, 'web' AS channel FROM web_sales JOIN filtered_date ON ws_sold_date_sk = filtered_date.d_date_sk WHERE ws_list_price BETWEEN 52 AND 141 UNION ALL SELECT cs_ship_customer_sk AS customer_sk, 'catalog' AS channel FROM catalog_sales JOIN filtered_date ON cs_sold_date_sk = filtered_date.d_date_sk WHERE cs_list_price BETWEEN 52 AND 141), filtered_address AS (SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('GA','KY','SD')), filtered_demo AS (SELECT cd_demo_sk, cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating FROM customer_demographics WHERE cd_marital_status IN ('D','W','U') AND cd_education_status IN ('Primary','College')), customer_base AS (SELECT c.c_customer_sk, d.cd_gender, d.cd_marital_status, d.cd_education_status, d.cd_purchase_estimate, d.cd_credit_rating FROM customer c INNER JOIN filtered_address a ON c.c_current_addr_sk = a.ca_address_sk INNER JOIN filtered_demo d ON c.c_current_cdemo_sk = d.cd_demo_sk), pivot_join AS (SELECT cb.*, store.customer_sk AS has_store, web.customer_sk AS has_web, catalog.customer_sk AS has_catalog FROM customer_base cb LEFT JOIN all_sales_unified store ON cb.c_customer_sk = store.customer_sk AND store.channel = 'store' LEFT JOIN all_sales_unified web ON cb.c_customer_sk = web.customer_sk AND web.channel = 'web' LEFT JOIN all_sales_unified catalog ON cb.c_customer_sk = catalog.customer_sk AND catalog.channel = 'catalog'), filter AS (SELECT c_customer_sk, cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating FROM pivot_join WHERE has_store IS NOT NULL AND has_web IS NULL AND has_catalog IS NULL), group_by AS (SELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM filter GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating) SELECT cd_gender, cd_marital_status, cd_education_status, cnt1, cd_purchase_estimate, cnt2, cd_credit_rating, cnt3 FROM group_by ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100",
  "speedup": 0.0,
  "status": "FAIL",
  "transforms": [
    "or_to_union"
  ],
  "hint": "- scan_consolidation_pivot: Consolidate three fact scans into one UNION ALL with",
  "error_message": "INTERFACE: [pivot_join] declares outputs ['c_customer_sk', 'cd_credit_rating', 'cd_education_status', 'cd_gender', 'cd_marital_status', 'cd_purchase_estimate'] but SELECT only produces ['*', 'has_catalog', 'has_store', 'has_web'] | INTERFACE: [pivot_join] SELECT produces ['*'] not declared in outputs | INTERFACE: [filter] SELECT produces ['c_customer_sk'] not declared in outputs | Value mismatch: rows differ between original and optimized",
  "error_messages": [
    "INTERFACE: [pivot_join] declares outputs ['c_customer_sk', 'cd_credit_rating', 'cd_education_status', 'cd_gender', 'cd_marital_status', 'cd_purchase_estimate'] but SELECT only produces ['*', 'has_catalog', 'has_store', 'has_web']",
    "INTERFACE: [pivot_join] SELECT produces ['*'] not declared in outputs",
    "INTERFACE: [filter] SELECT produces ['c_customer_sk'] not declared in outputs",
    "Value mismatch: rows differ between original and optimized"
  ],
  "error_category": "semantic",
  "exploratory": true
}