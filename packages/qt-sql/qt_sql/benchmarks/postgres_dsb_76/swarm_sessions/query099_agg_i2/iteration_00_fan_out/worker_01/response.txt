### Part 1: Modified Logic Tree

```
QUERY: (single statement)
├── [~] WITH filtered_date AS ( ... )  [Isolated date dimension CTE]
├── [~] WITH filtered_warehouse AS ( ... )  [Isolated warehouse dimension CTE]
├── [~] WITH filtered_ship_mode AS ( ... )  [Isolated ship_mode dimension CTE]
├── [~] WITH filtered_call_center AS ( ... )  [Isolated call_center dimension CTE]
├── [~] WITH catalog_sales_join AS ( ... )  [Explicit JOINs between fact and dimension CTEs]
├── [=] main_query (aggregation with explicit column references)
│   ├── [~] FROM catalog_sales_join (instead of comma-separated joins)
│   ├── [=] AGG (GROUP BY)
│   ├── [=] SORT
│   └── [=] OUTPUT
└── [=] LIMIT 100
```

### Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "PostgreSQL v16.11",
  "rewrite_rules": [
    {"id": "R1", "type": "dimension_prefetch", "description": "Pre-filter selective dimensions into separate CTEs", "applied_to": ["filtered_date", "filtered_warehouse", "filtered_ship_mode", "filtered_call_center"]},
    {"id": "R2", "type": "explicit_join", "description": "Convert comma-separated joins to explicit INNER JOIN syntax", "applied_to": ["catalog_sales_join"]}
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "filtered_date": {
        "type": "cte",
        "change": "new",
        "sql": "SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1191 AND 1191 + 23",
        "interfaces": {"outputs": ["d_date_sk"], "consumes": []}
      },
      "filtered_warehouse": {
        "type": "cte",
        "change": "new",
        "sql": "SELECT w_warehouse_sk, w_warehouse_name FROM warehouse WHERE w_gmt_offset = -5",
        "interfaces": {"outputs": ["w_warehouse_sk", "w_warehouse_name"], "consumes": []}
      },
      "filtered_ship_mode": {
        "type": "cte",
        "change": "new",
        "sql": "SELECT sm_ship_mode_sk, sm_type FROM ship_mode WHERE sm_type = 'LIBRARY'",
        "interfaces": {"outputs": ["sm_ship_mode_sk", "sm_type"], "consumes": []}
      },
      "filtered_call_center": {
        "type": "cte",
        "change": "new",
        "sql": "SELECT cc_call_center_sk, cc_name FROM call_center WHERE cc_class = 'medium'",
        "interfaces": {"outputs": ["cc_call_center_sk", "cc_name"], "consumes": []}
      },
      "catalog_sales_join": {
        "type": "cte",
        "change": "new",
        "sql": "SELECT cs.cs_sold_date_sk, cs.cs_ship_date_sk, fw.w_warehouse_name, fsm.sm_type, fcc.cc_name FROM catalog_sales cs INNER JOIN filtered_date fd ON cs.cs_ship_date_sk = fd.d_date_sk INNER JOIN filtered_warehouse fw ON cs.cs_warehouse_sk = fw.w_warehouse_sk INNER JOIN filtered_ship_mode fsm ON cs.cs_ship_mode_sk = fsm.sm_ship_mode_sk INNER JOIN filtered_call_center fcc ON cs.cs_call_center_sk = fcc.cc_call_center_sk WHERE cs.cs_list_price BETWEEN 244 AND 273",
        "interfaces": {"outputs": ["cs_sold_date_sk", "cs_ship_date_sk", "w_warehouse_name", "sm_type", "cc_name"], "consumes": ["filtered_date", "filtered_warehouse", "filtered_ship_mode", "filtered_call_center"]}
      },
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT SUBSTRING(w_warehouse_name,1,20), sm_type, cc_name, SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30 AND cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60 AND cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90 AND cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM catalog_sales_join GROUP BY SUBSTRING(w_warehouse_name,1,20), sm_type, cc_name ORDER BY SUBSTRING(w_warehouse_name,1,20), sm_type, cc_name LIMIT 100",
        "interfaces": {"outputs": ["substring", "sm_type", "cc_name", "30 days", "31-60 days", "61-90 days", "91-120 days", ">120 days"], "consumes": ["catalog_sales_join"]}
      }
    },
    "reconstruction_order": ["filtered_date", "filtered_warehouse", "filtered_ship_mode", "filtered_call_center", "catalog_sales_join", "main_query"],
    "assembly_template": "WITH filtered_date AS ({filtered_date}), filtered_warehouse AS ({filtered_warehouse}), filtered_ship_mode AS ({filtered_ship_mode}), filtered_call_center AS ({filtered_call_center}), catalog_sales_join AS ({catalog_sales_join}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "runtime_config": [],
  "validation_checks": []
}
```

**Changes**: Isolated all selective dimension filters into separate CTEs and converted comma-separated joins to explicit INNER JOINs. This enables PostgreSQL's optimizer to build hash tables from tiny pre-filtered dimension results (2-244 rows each) and perform efficient hash joins with the fact table.

**Expected speedup**: ~3x (combining benefits of dimension prefetching and explicit join syntax).