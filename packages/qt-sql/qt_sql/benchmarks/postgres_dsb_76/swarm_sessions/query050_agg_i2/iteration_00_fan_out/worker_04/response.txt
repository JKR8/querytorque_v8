## Part 1: Modified Logic Tree

```
QUERY: (single statement)
└── [MAIN] main_query  [!]  Cost: 100%  Rows: ~112K
    ├── SCAN (store_sales)
    ├── JOIN (store_returns ON ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk AND ss_customer_sk = sr_customer_sk)
    ├── JOIN (store ON ss_store_sk = s_store_sk)
    ├── JOIN (date_dim d2 ON sr_returned_date_sk = d2.d_date_sk AND d2.d_year = 1999 AND d2.d_moy = 7)
    ├── JOIN (date_dim d1 ON ss_sold_date_sk = d1.d_date_sk AND d1.d_date BETWEEN (d2.d_date - interval '120 day') AND d2.d_date)
    ├── AGG (GROUP BY)
    ├── SORT (s_store_name ASC, s_company_id ASC, s_street_number ASC, s_street_name ASC, s_street_type ASC, s_suite_number ASC, s_city ASC, s_county ASC, s_state ASC, s_zip ASC)
    └── OUTPUT (s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, ...)
```

**Structural changes** (`[!]`):
- Converted comma-separated implicit joins to explicit `INNER JOIN` syntax
- Moved filter predicates (`d2.d_year = 1999 AND d2.d_moy = 7`) into the `JOIN` condition for `d2`
- Moved temporal correlation predicate (`d1.d_date BETWEEN (d2.d_date - interval '120 day') AND d2.d_date`) into the `JOIN` condition for `d1`
- Preserved all semantic invariants (same rows, columns, ordering)

## Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "postgresql",
  "rewrite_rules": [
    {
      "id": "R1",
      "type": "explicit_joins",
      "description": "Convert implicit comma joins to explicit INNER JOIN syntax",
      "applied_to": ["main_query"]
    },
    {
      "id": "R2", 
      "type": "predicate_pushdown",
      "description": "Move d2.d_year/d_moy filters into JOIN condition for early filtering",
      "applied_to": ["main_query"]
    },
    {
      "id": "R3",
      "type": "correlation_pushdown",
      "description": "Move d1.d_date BETWEEN condition into JOIN condition to preserve temporal relationship",
      "applied_to": ["main_query"]
    }
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip, sum(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", sum(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 30) AND (sr_returned_date_sk - ss_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", sum(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 60) AND (sr_returned_date_sk - ss_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", sum(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 90) AND (sr_returned_date_sk - ss_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", sum(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM store_sales INNER JOIN store_returns ON ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk AND ss_customer_sk = sr_customer_sk INNER JOIN store ON ss_store_sk = s_store_sk INNER JOIN date_dim d2 ON sr_returned_date_sk = d2.d_date_sk AND d2.d_year = 1999 AND d2.d_moy = 7 INNER JOIN date_dim d1 ON ss_sold_date_sk = d1.d_date_sk AND d1.d_date BETWEEN (d2.d_date - INTERVAL '120 day') AND d2.d_date GROUP BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip ORDER BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip LIMIT 100",
        "interfaces": {
          "outputs": ["s_store_name", "s_company_id", "s_street_number", "s_street_name", "s_street_type", "s_suite_number", "s_city", "s_county", "s_state", "s_zip", "30 days", "31-60 days", "61-90 days", "91-120 days", ">120 days"],
          "consumes": []
        }
      }
    },
    "reconstruction_order": ["main_query"],
    "assembly_template": "{main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "runtime_config": [],
  "validation_checks": []
}
```

**Changes**: Converted implicit joins to explicit INNER JOIN syntax and pushed correlation/filter predicates into JOIN conditions. This preserves the exact semantic equivalence while eliminating comma-join weakness and allowing the optimizer to better understand the join graph.

**Expected speedup**: 1.05-1.15x due to clearer join semantics for the optimizer while preserving all defensive guards and temporal correlations. No CTEs were introduced to avoid parallelism blocking, and nested loops remain enabled for indexed lookups.