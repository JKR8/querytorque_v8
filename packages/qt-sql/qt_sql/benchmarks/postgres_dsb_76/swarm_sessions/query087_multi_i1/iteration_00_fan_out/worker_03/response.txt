### Part 1: Modified Logic Tree

```
QUERY: (single statement)
└── [MAIN] main_query  [!]
    ├── [~] filtered_date (CTE)
    │   ├── SCAN date_dim  [=]
    │   └── FILTER d_month_seq BETWEEN 1214 AND 1225  [=]
    ├── [~] filtered_customer (CTE)
    │   ├── SCAN customer  [=]
    │   └── FILTER c_birth_year BETWEEN 1955 AND 1961  [=]
    ├── [!] sales_consolidated (CTE)
    │   ├── CROSS JOIN filtered_date × filtered_customer  [+]
    │   ├── LEFT JOIN store_sales  [~] (with CASE flag)
    │   ├── LEFT JOIN catalog_sales  [~] (with CASE flag)
    │   ├── LEFT JOIN web_sales  [~] (with CASE flag)
    │   └── COMPUTE store_flag, catalog_flag, web_flag  [+]
    ├── [~] pivot_filter (CTE)
    │   ├── SCAN sales_consolidated  [=]
    │   └── FILTER store_flag=1 AND catalog_flag=0 AND web_flag=0  [+]
    └── [~] count
        └── AGGREGATE COUNT(*)  [=]
```

**Structural changes:**
- **[!] main_query:** Changed from triple EXCEPT to CTE-based consolidation
- **[+] CROSS JOIN:** Cartesian product of filtered_date × filtered_customer (182 × ~thousands rows)
- **[+] CASE flags:** Added store_flag, catalog_flag, web_flag computed in sales_consolidated
- **[+] pivot_filter:** New filtering step using flag logic instead of EXCEPT
- **Preserved:** All original filters, literals, and DISTINCT semantics via flag construction

### Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "PostgreSQL 16.11",
  "rewrite_rules": [
    {"id": "R1", "type": "except_to_flags", "description": "Convert triple EXCEPT to CASE flags with cross join", "applied_to": ["sales_consolidated", "pivot_filter"]},
    {"id": "R2", "type": "single_pass_aggregation", "description": "Combine three channel scans into one pass with LEFT JOINs", "applied_to": ["sales_consolidated"]}
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "filtered_date": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq BETWEEN 1214 AND 1214 + 11",
        "interfaces": {"outputs": ["d_date_sk", "d_date"], "consumes": []}
      },
      "filtered_customer": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT c_customer_sk, c_last_name, c_first_name FROM customer WHERE c_birth_year BETWEEN 1955 AND 1961",
        "interfaces": {"outputs": ["c_customer_sk", "c_last_name", "c_first_name"], "consumes": []}
      },
      "sales_consolidated": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT fd.d_date_sk, fd.d_date, fc.c_customer_sk, fc.c_last_name, fc.c_first_name, CASE WHEN ss.ss_sold_date_sk IS NOT NULL AND ss.ss_list_price BETWEEN 242 AND 271 AND ss.ss_wholesale_cost BETWEEN 35 AND 45 THEN 1 ELSE 0 END AS store_flag, CASE WHEN cs.cs_sold_date_sk IS NOT NULL AND cs.cs_list_price BETWEEN 242 AND 271 AND cs.cs_wholesale_cost BETWEEN 35 AND 45 THEN 1 ELSE 0 END AS catalog_flag, CASE WHEN ws.ws_sold_date_sk IS NOT NULL AND ws.ws_list_price BETWEEN 242 AND 271 AND ws.ws_wholesale_cost BETWEEN 35 AND 45 THEN 1 ELSE 0 END AS web_flag FROM filtered_date fd CROSS JOIN filtered_customer fc LEFT JOIN store_sales ss ON ss.ss_sold_date_sk = fd.d_date_sk AND ss.ss_customer_sk = fc.c_customer_sk LEFT JOIN catalog_sales cs ON cs.cs_sold_date_sk = fd.d_date_sk AND cs.cs_bill_customer_sk = fc.c_customer_sk LEFT JOIN web_sales ws ON ws.ws_sold_date_sk = fd.d_date_sk AND ws.ws_bill_customer_sk = fc.c_customer_sk",
        "interfaces": {"outputs": ["d_date_sk", "d_date", "c_customer_sk", "c_last_name", "c_first_name", "store_flag", "catalog_flag", "web_flag"], "consumes": ["filtered_date", "filtered_customer"]}
      },
      "pivot_filter": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT c_last_name, c_first_name, d_date FROM sales_consolidated WHERE store_flag = 1 AND catalog_flag = 0 AND web_flag = 0",
        "interfaces": {"outputs": ["c_last_name", "c_first_name", "d_date"], "consumes": ["sales_consolidated"]}
      },
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT COUNT(*) FROM pivot_filter",
        "interfaces": {"outputs": ["count"], "consumes": ["pivot_filter"]}
      }
    },
    "reconstruction_order": ["filtered_date", "filtered_customer", "sales_consolidated", "pivot_filter", "main_query"],
    "assembly_template": "WITH filtered_date AS ({filtered_date}), filtered_customer AS ({filtered_customer}), sales_consolidated AS ({sales_consolidated}), pivot_filter AS ({pivot_filter}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "runtime_config": [],
  "validation_checks": []
}
```

**Changes:** Converted triple EXCEPT to a single-pass consolidation using CASE flags and cross join. Each customer-date combination from filtered dimensions is checked against all three channels in parallel, with flags indicating presence in each channel meeting price/wholesale conditions. The pivot_filter selects store-only combinations (flag=1, others=0), preserving EXCEPT semantics.

**Expected speedup:** Moderate (1.5-2x) due to single pass over fact tables and elimination of multiple redundant scans, though cross join may increase intermediate row count. Defensive CASE guards maintain division safety despite irrelevant context.