{
  "worker_id": 3,
  "strategy": "Single-pass consolidation with pivot",
  "examples_used": [
    "single_pass_aggregation"
  ],
  "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN '2001-02-23' AND CAST('2001-02-23' AS DATE) + INTERVAL '90 DAY'), filtered_items AS (SELECT i_item_sk, i_manufact_id, i_manager_id FROM item WHERE i_manufact_id IN (184, 307, 365, 560, 681) OR i_manager_id BETWEEN 42 AND 71), consolidated_scan AS (SELECT cs.cs_item_sk, cs.cs_ext_discount_amt, CASE WHEN cs.cs_list_price BETWEEN 115 AND 144 AND cs.cs_sales_price / cs.cs_list_price BETWEEN 0.21 AND 0.41 THEN cs.cs_ext_discount_amt END AS subq_discount_amt FROM catalog_sales cs INNER JOIN filtered_dates fd ON cs.cs_sold_date_sk = fd.d_date_sk INNER JOIN filtered_items fi ON cs.cs_item_sk = fi.i_item_sk WHERE (cs.cs_list_price BETWEEN 115 AND 144 AND cs.cs_sales_price / cs.cs_list_price BETWEEN 0.21 AND 0.41) OR (1=1)), pivot_filter AS (SELECT cs_ext_discount_amt FROM (SELECT cs_ext_discount_amt, 1.3 * AVG(subq_discount_amt) OVER (PARTITION BY cs_item_sk) AS threshold FROM consolidated_scan) t WHERE cs_ext_discount_amt > threshold) SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM pivot_filter ORDER BY SUM(cs_ext_discount_amt) LIMIT 100",
  "speedup": 592.7409112935698,
  "status": "WIN",
  "transforms": [
    "decorrelate"
  ],
  "hint": "- Apply single-pass scan pattern using CASE to compute subquery aggregate via wi",
  "error_message": null,
  "error_messages": [],
  "error_category": null,
  "set_local_config": {
    "params": {
      "work_mem": "64MB",
      "enable_hashjoin": "off",
      "enable_nestloop": "off",
      "max_parallel_workers_per_gather": "2"
    },
    "commands": [
      "SET LOCAL enable_hashjoin = 'off'",
      "SET LOCAL enable_nestloop = 'off'",
      "SET LOCAL max_parallel_workers_per_gather = '2'",
      "SET LOCAL work_mem = '64MB'"
    ],
    "config_speedup": 592.7409112935698,
    "rewrite_only_speedup": 390.5470856018294
  }
}