WITH base_scan AS (SELECT ws_item_sk, ws_ext_discount_amt, ws_sales_price, ws_list_price, i_item_sk FROM web_sales INNER JOIN date_dim ON d_date_sk = ws_sold_date_sk INNER JOIN item ON i_item_sk = ws_item_sk WHERE d_date BETWEEN '2002-03-06' AND CAST('2002-03-06' AS DATE) + INTERVAL '90 day' AND (i_manufact_id BETWEEN 566 AND 765 OR i_category IN ('Children', 'Jewelry', 'Men')) AND ws_wholesale_cost BETWEEN 16 AND 36), main_data AS (SELECT ws_item_sk, ws_ext_discount_amt FROM base_scan), subquery_data AS (SELECT ws_item_sk, ws_ext_discount_amt FROM base_scan WHERE ws_sales_price / ws_list_price BETWEEN 35 * 0.01 AND 50 * 0.01), compute_avg AS (SELECT ws_item_sk, 1.3 * AVG(ws_ext_discount_amt) AS threshold FROM subquery_data GROUP BY ws_item_sk), final_join AS (SELECT m.ws_ext_discount_amt FROM main_data m INNER JOIN compute_avg c ON m.ws_item_sk = c.ws_item_sk WHERE m.ws_ext_discount_amt > c.threshold) SELECT SUM(ws_ext_discount_amt) AS "Excess Discount Amount" FROM final_join ORDER BY SUM(ws_ext_discount_amt) ASC LIMIT 100