WITH date_jan1998 AS (SELECT d_date_sk, d_month_seq FROM date_dim WHERE d_year = 1998 AND d_moy = 1), date_range_values AS (SELECT MIN(d_month_seq+1) AS month_start, MAX(d_month_seq+3) AS month_end FROM date_jan1998), my_customers_explicit AS (SELECT DISTINCT c_customer_sk, c_current_addr_sk FROM (SELECT cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk FROM catalog_sales WHERE cs_wholesale_cost BETWEEN 35 AND 65 UNION ALL SELECT ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk FROM web_sales WHERE ws_wholesale_cost BETWEEN 35 AND 65) sales INNER JOIN date_jan1998 ON sales.sold_date_sk = date_jan1998.d_date_sk INNER JOIN item ON sales.item_sk = item.i_item_sk AND item.i_category = 'Electronics' AND item.i_class = 'personal' INNER JOIN customer ON sales.customer_sk = customer.c_customer_sk AND customer.c_birth_year BETWEEN 1928 AND 1941), my_revenue_explicit AS (SELECT my_customers_explicit.c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers_explicit INNER JOIN customer_address ON my_customers_explicit.c_current_addr_sk = customer_address.ca_address_sk INNER JOIN store ON customer_address.ca_state = store.s_state AND customer_address.ca_county = store.s_county AND store.s_state IN ('AR','CO','IA','IL','KY','NC','NM','NY','PA','TX') INNER JOIN store_sales ON my_customers_explicit.c_customer_sk = store_sales.ss_customer_sk AND store_sales.ss_wholesale_cost BETWEEN 35 AND 65 INNER JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk WHERE date_dim.d_month_seq BETWEEN (SELECT month_start FROM date_range_values) AND (SELECT month_end FROM date_range_values) GROUP BY my_customers_explicit.c_customer_sk), segments AS (SELECT CAST((revenue / 50) AS INT) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment * 50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100