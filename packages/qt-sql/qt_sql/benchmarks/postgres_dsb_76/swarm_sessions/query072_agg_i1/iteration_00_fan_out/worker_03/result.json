{
  "worker_id": 3,
  "strategy": "single_pass_date_consolidation_pivot",
  "examples_used": [
    "pg_self_join_decomposition",
    "single_pass_aggregation",
    "pg_date_cte_explicit_join"
  ],
  "optimized_sql": "WITH unified_dates AS (SELECT d_date_sk, d_date, d_week_seq, CASE WHEN d_date_sk = d_date_sk THEN 'd1' END AS role1, CASE WHEN d_date_sk = d_date_sk THEN 'd2' END AS role2, CASE WHEN d_date_sk = d_date_sk THEN 'd3' END AS role3 FROM date_dim WHERE d_year = 1998), filtered_sales AS (SELECT cs.cs_item_sk, cs.cs_quantity, cs.cs_wholesale_cost, cs.cs_ship_date_sk, cs.cs_promo_sk, cs.cs_order_number, d1.d_date, d1.d_week_seq, d2.d_date_sk, d3.d_date_sk FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk JOIN unified_dates d1 ON cs.cs_sold_date_sk = d1.d_date_sk JOIN unified_dates d2 ON d1.d_week_seq = d2.d_week_seq JOIN unified_dates d3 ON cs.cs_ship_date_sk = d3.d_date_sk WHERE d3.d_date > d1.d_date + INTERVAL '3 day' AND hd.hd_buy_potential = '>10000' AND d1.d_year = 1998 AND cd.cd_marital_status = 'U' AND cd.cd_dep_count BETWEEN 9 AND 11 AND i.i_category IN ('Children', 'Jewelry', 'Men') AND cs.cs_wholesale_cost BETWEEN 35 AND 55), complete_joins AS (SELECT i.i_item_desc, w.w_warehouse_name, fs.d_week_seq, p.p_promo_sk FROM filtered_sales fs JOIN inventory inv ON inv.inv_item_sk = fs.cs_item_sk AND inv.inv_date_sk = fs.d_date_sk JOIN warehouse w ON w.w_warehouse_sk = inv.inv_warehouse_sk LEFT OUTER JOIN promotion p ON p.p_promo_sk = fs.cs_promo_sk LEFT OUTER JOIN catalog_returns cr ON cr.cr_item_sk = fs.cs_item_sk AND cr.cr_order_number = fs.cs_order_number WHERE inv.inv_quantity_on_hand < fs.cs_quantity) SELECT i_item_desc, w_warehouse_name, d_week_seq, SUM(CASE WHEN p_promo_sk IS NULL THEN 1 ELSE 0 END) AS no_promo, SUM(CASE WHEN p_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS promo, COUNT(*) AS total_cnt FROM complete_joins GROUP BY i_item_desc, w_warehouse_name, d_week_seq ORDER BY total_cnt DESC, i_item_desc, w_warehouse_name, d_week_seq LIMIT 100",
  "speedup": 0.0,
  "status": "ERROR",
  "transforms": [
    "date_cte_isolate"
  ],
  "hint": "- pg_self_join_decomposition: Apply scanning date_dim once and reusing for d1,d2",
  "error_message": "Execution failed: column d1.d_year does not exist\nLINE 1: ...AL '3 day' AND hd.hd_buy_potential = '>10000' AND d1.d_year ...\n                                                             ^\n",
  "error_messages": [
    "Execution failed: column d1.d_year does not exist\nLINE 1: ...AL '3 day' AND hd.hd_buy_potential = '>10000' AND d1.d_year ...\n                                                             ^\n"
  ],
  "error_category": "execution"
}