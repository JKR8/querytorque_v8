### Part 1: Modified Logic Tree
```
QUERY: (single statement)
├── [CTE] filtered_dates  [+]  New dimension CTE for date filtering
│   ├── SCAN (date_dim)
│   ├── FILTER (d_month_seq BETWEEN 1187 AND 1210)
│   └── OUTPUT (d_date_sk, d_week_seq, d_month_seq, d_day_name)
├── [CTE] filtered_stores  [+]  New dimension CTE for store filtering  
│   ├── SCAN (store)
│   ├── FILTER (s_state IN ('AR','CO','IA','IL','NC','NY','PA','TX'))
│   └── OUTPUT (s_store_sk, s_store_id, s_store_name)
├── [CTE] wss  [~]  Modified to use filtered_dates CTE instead of raw date_dim
│   ├── SCAN (store_sales)
│   ├── JOIN filtered_dates ON d_date_sk = ss_sold_date_sk (explicit INNER JOIN)
│   ├── FILTER (ss_sales_price / ss_list_price BETWEEN 0.57 AND 0.77)
│   ├── AGG (GROUP BY d_week_seq, ss_store_sk)
│   └── OUTPUT (d_week_seq, ss_store_sk, sun_sales..sat_sales)
└── [MAIN] main_query  [~]  Modified to use explicit JOINs and CTEs
    ├── SUBQUERY y: FROM wss JOIN filtered_stores JOIN filtered_dates d (explicit JOINs)
    ├── SUBQUERY x: FROM wss JOIN filtered_stores JOIN filtered_dates d (explicit JOINs)
    ├── JOIN (y.s_store_id = x.s_store_id AND y.d_week_seq = x.d_week_seq - 52) (explicit JOIN)
    ├── SORT (s_store_name1, s_store_id1, d_week_seq1)
    └── OUTPUT (s_store_name1, s_store_id1, d_week_seq1, sun_sales1/sun_sales2..sat_sales1/sat_sales2)
```

### Part 2: Component Payload JSON
```json
{
  "spec_version": "1.0",
  "dialect": "postgresql",
  "rewrite_rules": [
    {
      "id": "R1",
      "type": "dimension_prefiltering",
      "description": "Extract selective date_dim and store filters into CTEs to create tiny hash tables",
      "applied_to": ["filtered_dates", "filtered_stores"]
    },
    {
      "id": "R2", 
      "type": "explicit_join_conversion",
      "description": "Convert comma-separated joins to explicit JOIN syntax for better cardinality estimation",
      "applied_to": ["wss", "main_query"]
    }
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "filtered_dates": {
        "type": "cte",
        "change": "new",
        "sql": "SELECT d_date_sk, d_week_seq, d_month_seq, d_day_name FROM date_dim WHERE d_month_seq BETWEEN 1187 AND 1210",
        "interfaces": {
          "outputs": ["d_date_sk", "d_week_seq", "d_month_seq", "d_day_name"],
          "consumes": []
        }
      },
      "filtered_stores": {
        "type": "cte",
        "change": "new", 
        "sql": "SELECT s_store_sk, s_store_id, s_store_name FROM store WHERE s_state IN ('AR','CO','IA','IL','NC','NY','PA','TX')",
        "interfaces": {
          "outputs": ["s_store_sk", "s_store_id", "s_store_name"],
          "consumes": []
        }
      },
      "wss": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT d_week_seq, ss_store_sk, SUM(CASE WHEN d_day_name='Sunday' THEN ss_sales_price END) AS sun_sales, SUM(CASE WHEN d_day_name='Monday' THEN ss_sales_price END) AS mon_sales, SUM(CASE WHEN d_day_name='Tuesday' THEN ss_sales_price END) AS tue_sales, SUM(CASE WHEN d_day_name='Wednesday' THEN ss_sales_price END) AS wed_sales, SUM(CASE WHEN d_day_name='Thursday' THEN ss_sales_price END) AS thu_sales, SUM(CASE WHEN d_day_name='Friday' THEN ss_sales_price END) AS fri_sales, SUM(CASE WHEN d_day_name='Saturday' THEN ss_sales_price END) AS sat_sales FROM store_sales JOIN filtered_dates ON d_date_sk = ss_sold_date_sk WHERE ss_sales_price / ss_list_price BETWEEN 0.57 AND 0.77 GROUP BY d_week_seq, ss_store_sk",
        "interfaces": {
          "outputs": ["d_week_seq", "ss_store_sk", "sun_sales", "mon_sales", "tue_sales", "wed_sales", "thu_sales", "fri_sales", "sat_sales"],
          "consumes": ["filtered_dates"]
        }
      },
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT y.s_store_name AS s_store_name1, y.s_store_id AS s_store_id1, y.d_week_seq AS d_week_seq1, y.sun_sales / x.sun_sales AS sun_sales1_sun_sales2, y.mon_sales / x.mon_sales AS mon_sales1_mon_sales2, y.tue_sales / x.tue_sales AS tue_sales1_tue_sales2, y.wed_sales / x.wed_sales AS wed_sales1_wed_sales2, y.thu_sales / x.thu_sales AS thu_sales1_thu_sales2, y.fri_sales / x.fri_sales AS fri_sales1_fri_sales2, y.sat_sales / x.sat_sales AS sat_sales1_sat_sales2 FROM (SELECT s_store_name, wss.d_week_seq, s_store_id, sun_sales, mon_sales, tue_sales, wed_sales, thu_sales, fri_sales, sat_sales FROM wss JOIN filtered_stores ON ss_store_sk = s_store_sk JOIN filtered_dates d ON d.d_week_seq = wss.d_week_seq WHERE d.d_month_seq BETWEEN 1187 AND 1198) y JOIN (SELECT s_store_name, wss.d_week_seq, s_store_id, sun_sales, mon_sales, tue_sales, wed_sales, thu_sales, fri_sales, sat_sales FROM wss JOIN filtered_stores ON ss_store_sk = s_store_sk JOIN filtered_dates d ON d.d_week_seq = wss.d_week_seq WHERE d.d_month_seq BETWEEN 1199 AND 1210) x ON y.s_store_id = x.s_store_id AND y.d_week_seq = x.d_week_seq - 52 ORDER BY y.s_store_name, y.s_store_id, y.d_week_seq LIMIT 100",
        "interfaces": {
          "outputs": ["s_store_name1", "s_store_id1", "d_week_seq1", "sun_sales1_sun_sales2", "mon_sales1_mon_sales2", "tue_sales1_tue_sales2", "wed_sales1_wed_sales2", "thu_sales1_thu_sales2", "fri_sales1_fri_sales2", "sat_sales1_sat_sales2"],
          "consumes": ["wss", "filtered_stores", "filtered_dates"]
        }
      }
    },
    "reconstruction_order": ["filtered_dates", "filtered_stores", "wss", "main_query"],
    "assembly_template": "WITH filtered_dates AS ({filtered_dates}), filtered_stores AS ({filtered_stores}), wss AS ({wss}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "runtime_config": [],
  "validation_checks": []
}
```

**Changes**: Introduced two new CTEs (`filtered_dates`, `filtered_stores`) to pre-filter selective dimension tables, and converted all comma joins to explicit JOIN syntax. This follows the "Dimension Isolation + Explicit Joins" pattern from reference examples.

**Expected speedup**: ~2.28x (based on pg_date_cte_explicit_join pattern). The main mechanism is better cardinality estimation from explicit JOINs and hash join planning with tiny pre-filtered dimension tables.