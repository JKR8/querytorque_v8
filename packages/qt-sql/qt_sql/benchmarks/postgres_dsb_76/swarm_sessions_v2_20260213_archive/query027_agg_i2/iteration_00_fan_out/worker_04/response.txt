**Part 1: Modified Logic Tree**

```
QUERY: (single statement)
└── [~] main_query  [Cost: 100%  Rows: ~366]
    ├── [+] WITH clause (CTE structure)
    │   ├── fact_join_explicit (CTE)
    │   │   ├── [~] SCAN (store_sales)
    │   │   │   └── [~] JOINs: comma → explicit INNER JOIN syntax
    │   │   ├── [~] FILTERs: moved from WHERE to JOIN conditions
    │   │   └── [=] OUTPUT: i_item_id, s_state, ss_quantity, ss_list_price, ss_coupon_amt, ss_sales_price
    │   └── aggregation (CTE)
    │       ├── [=] GROUP BY ROLLUP(i_item_id, s_state)
    │       ├── [=] AGGREGATE: AVG(x) AS agg1-4
    │       └── [=] OUTPUT: i_item_id, s_state, g_state, agg1-4
    ├── [=] SORT (i_item_id, s_state)
    └── [=] LIMIT 100
```

**Part 2: Component Payload JSON**

```json
{
  "spec_version": "1.0",
  "dialect": "postgresql",
  "rewrite_rules": [
    {
      "id": "R1",
      "type": "explicit_join_restructure",
      "description": "Convert comma-separated joins to explicit INNER JOIN syntax with filters pushed to JOIN conditions",
      "applied_to": ["fact_join_explicit"]
    },
    {
      "id": "R2",
      "type": "cte_materialization",
      "description": "Break query into materialized CTEs following logical tree structure",
      "applied_to": ["fact_join_explicit", "aggregation"]
    },
    {
      "id": "R3",
      "type": "parallelism_boost",
      "description": "Increase parallel workers for hash joins on filtered dimension tables",
      "applied_to": ["runtime_config"]
    }
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "fact_join_explicit": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT i.i_item_id, s.s_state, ss.ss_quantity, ss.ss_list_price, ss.ss_coupon_amt, ss.ss_sales_price FROM store_sales ss INNER JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk AND d.d_year = 1999 INNER JOIN store s ON ss.ss_store_sk = s.s_store_sk AND s.s_state = 'OH' INNER JOIN item i ON ss.ss_item_sk = i.i_item_sk AND i.i_category = 'Music' INNER JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk AND cd.cd_gender = 'M' AND cd.cd_marital_status = 'W' AND cd.cd_education_status = 'Secondary'",
        "interfaces": {
          "outputs": ["i_item_id", "s_state", "ss_quantity", "ss_list_price", "ss_coupon_amt", "ss_sales_price"],
          "consumes": []
        }
      },
      "aggregation": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT i_item_id, s_state, GROUPING(s_state) AS g_state, AVG(ss_quantity) AS agg1, AVG(ss_list_price) AS agg2, AVG(ss_coupon_amt) AS agg3, AVG(ss_sales_price) AS agg4 FROM fact_join_explicit GROUP BY ROLLUP(i_item_id, s_state)",
        "interfaces": {
          "outputs": ["i_item_id", "s_state", "g_state", "agg1", "agg2", "agg3", "agg4"],
          "consumes": ["fact_join_explicit"]
        }
      },
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT i_item_id, s_state, g_state, agg1, agg2, agg3, agg4 FROM aggregation ORDER BY i_item_id, s_state LIMIT 100",
        "interfaces": {
          "outputs": ["i_item_id", "s_state", "g_state", "agg1", "agg2", "agg3", "agg4"],
          "consumes": ["aggregation"]
        }
      }
    },
    "reconstruction_order": ["fact_join_explicit", "aggregation", "main_query"],
    "assembly_template": "WITH fact_join_explicit AS (MATERIALIZED {fact_join_explicit}), aggregation AS (MATERIALIZED {aggregation}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "runtime_config": ["SET LOCAL max_parallel_workers_per_gather = 4", "SET LOCAL work_mem = '512MB'"],
  "validation_checks": []
}
```

**Changes**: Converted comma joins to explicit INNER JOINs with filters pushed into JOIN conditions, and structured query as materialized CTEs following the target logical tree. This provides better cardinality estimation for the optimizer while preserving exact semantics.

**Expected speedup**: 1.5-2x due to improved join planning and parallelism utilization on the hash joins between fact and heavily-filtered dimension tables.