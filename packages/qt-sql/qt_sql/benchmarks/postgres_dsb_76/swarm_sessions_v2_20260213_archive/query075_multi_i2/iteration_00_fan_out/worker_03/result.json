{
  "worker_id": 3,
  "strategy": "union_consolidation",
  "examples_used": [
    "shared_dimension_multi_channel",
    "union_cte_split",
    "single_pass_aggregation"
  ],
  "optimized_sql": "WITH filtered_item AS (SELECT i_item_sk, i_brand_id, i_class_id, i_category_id, i_manufact_id FROM item WHERE i_category = 'Children'), filtered_date AS (SELECT d_date_sk, d_year FROM date_dim WHERE d_year IN (1998, 1999)), consolidated_returns_sales AS (SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, CASE channel WHEN 'catalog' THEN cs_quantity - COALESCE(cr_return_quantity,0) WHEN 'store' THEN ss_quantity - COALESCE(sr_return_quantity,0) WHEN 'web' THEN ws_quantity - COALESCE(wr_return_quantity,0) END AS sales_cnt, CASE channel WHEN 'catalog' THEN cs_ext_sales_price - COALESCE(cr_return_amount,0.0) WHEN 'store' THEN ss_ext_sales_price - COALESCE(sr_return_amt,0.0) WHEN 'web' THEN ws_ext_sales_price - COALESCE(wr_return_amt,0.0) END AS sales_amt FROM (SELECT 'catalog' as channel, cs_item_sk, cs_order_number, cs_quantity, cs_ext_sales_price, cs_sales_price, cs_list_price, cs_sold_date_sk FROM catalog_sales UNION ALL SELECT 'store', ss_item_sk, ss_ticket_number, ss_quantity, ss_ext_sales_price, ss_sales_price, ss_list_price, ss_sold_date_sk FROM store_sales UNION ALL SELECT 'web', ws_item_sk, ws_order_number, ws_quantity, ws_ext_sales_price, ws_sales_price, ws_list_price, ws_sold_date_sk FROM web_sales) sales JOIN filtered_item ON i_item_sk = sales.cs_item_sk JOIN filtered_date ON d_date_sk = sales.cs_sold_date_sk LEFT JOIN (SELECT 'catalog' as channel, cr_item_sk, cr_order_number, cr_return_quantity, cr_return_amount, cr_reason_sk FROM catalog_returns UNION ALL SELECT 'store', sr_item_sk, sr_ticket_number, sr_return_quantity, sr_return_amt, sr_reason_sk FROM store_returns UNION ALL SELECT 'web', wr_item_sk, wr_order_number, wr_return_quantity, wr_return_amt, wr_reason_sk FROM web_returns) returns ON (sales.channel = returns.channel AND sales.cs_order_number = returns.cr_order_number AND sales.cs_item_sk = returns.cr_item_sk) WHERE (sales.channel='catalog' AND cs_sales_price/cs_list_price BETWEEN 0.69 AND 0.89 AND cr_reason_sk IN (8,18,20,23,41)) OR (sales.channel='store' AND ss_sales_price/ss_list_price BETWEEN 0.69 AND 0.89 AND sr_reason_sk IN (8,18,20,23,41)) OR (sales.channel='web' AND ws_sales_price/ws_list_price BETWEEN 0.69 AND 0.89 AND wr_reason_sk IN (8,18,20,23,41))), all_sales_agg AS (SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, SUM(sales_cnt) AS sales_cnt, SUM(sales_amt) AS sales_amt FROM consolidated_returns_sales GROUP BY d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id) SELECT prev_yr.d_year AS prev_year, curr_yr.d_year AS year, curr_yr.i_brand_id, curr_yr.i_class_id, curr_yr.i_category_id, curr_yr.i_manufact_id, prev_yr.sales_cnt AS prev_yr_cnt, curr_yr.sales_cnt AS curr_yr_cnt, curr_yr.sales_cnt - prev_yr.sales_cnt AS sales_cnt_diff, curr_yr.sales_amt - prev_yr.sales_amt AS sales_amt_diff FROM all_sales AS curr_yr, all_sales AS prev_yr WHERE curr_yr.i_brand_id = prev_yr.i_brand_id AND curr_yr.i_class_id = prev_yr.i_class_id AND curr_yr.i_category_id = prev_yr.i_category_id AND curr_yr.i_manufact_id = prev_yr.i_manufact_id AND curr_yr.d_year = 1999 AND prev_yr.d_year = 1999 - 1 AND prev_yr.sales_cnt > 0 AND CAST(curr_yr.sales_cnt AS DECIMAL(17, 2)) / CAST(prev_yr.sales_cnt AS DECIMAL(17, 2)) < 0.9 ORDER BY sales_cnt_diff, sales_amt_diff LIMIT 100",
  "speedup": 0.0,
  "status": "ERROR",
  "transforms": [
    "or_to_union"
  ],
  "hint": "- shared_dimension_multi_channel: Apply sharing filtered_item and filtered_date ",
  "error_message": "Execution failed: column reference \"channel\" is ambiguous\nLINE 1: ...d, i_class_id, i_category_id, i_manufact_id, CASE channel WH...\n                                                             ^\n",
  "error_messages": [
    "Execution failed: column reference \"channel\" is ambiguous\nLINE 1: ...d, i_class_id, i_category_id, i_manufact_id, CASE channel WH...\n                                                             ^\n"
  ],
  "error_category": "execution"
}