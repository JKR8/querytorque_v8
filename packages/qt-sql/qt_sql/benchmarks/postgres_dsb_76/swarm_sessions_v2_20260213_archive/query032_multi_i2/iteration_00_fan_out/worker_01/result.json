{
  "worker_id": 1,
  "strategy": "Decorrelate via MATERIALIZED CTEs",
  "examples_used": [
    "inline_decorrelate_materialized"
  ],
  "optimized_sql": "WITH filtered_dates AS MATERIALIZED (SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN '2001-02-23' AND CAST('2001-02-23' AS DATE) + INTERVAL '90 DAY'), filtered_items AS MATERIALIZED (SELECT i_item_sk, i_manufact_id, i_manager_id FROM item WHERE i_manufact_id IN (184, 307, 365, 560, 681) OR i_manager_id BETWEEN 42 AND 71), item_thresholds AS MATERIALIZED (SELECT cs_item_sk, 1.3 * AVG(cs_ext_discount_amt) AS threshold FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk WHERE cs_list_price BETWEEN 115 AND 144 AND cs_sales_price / cs_list_price BETWEEN 0.21 AND 0.41 GROUP BY cs_item_sk) SELECT SUM(cs_ext_discount_amt) AS \"excess discount amount\" FROM filtered_items fi JOIN catalog_sales cs ON fi.i_item_sk = cs.cs_item_sk JOIN filtered_dates fd ON cs.cs_sold_date_sk = fd.d_date_sk LEFT JOIN item_thresholds it ON cs.cs_item_sk = it.cs_item_sk WHERE cs.cs_ext_discount_amt > COALESCE(it.threshold, -1) ORDER BY SUM(cs_ext_discount_amt) LIMIT 100",
  "speedup": 595.8176721472202,
  "status": "WIN",
  "transforms": [
    "decorrelate"
  ],
  "hint": "- Apply the 3-CTE decomposition pattern: dimension filter CTEs + threshold CTE. ",
  "error_message": "INTERFACE: [item_thresholds] uses \"d_date_sk\" \u2014 did you mean \"d_date\" from [filtered_dates]? [filtered_dates] only provides ['d_date', 'd_date_sk']",
  "error_messages": [
    "INTERFACE: [item_thresholds] uses \"d_date_sk\" \u2014 did you mean \"d_date\" from [filtered_dates]? [filtered_dates] only provides ['d_date', 'd_date_sk']"
  ],
  "error_category": null,
  "set_local_config": {
    "params": {
      "work_mem": "256MB",
      "hash_mem_multiplier": "2.0",
      "enable_nestloop": "off",
      "enable_mergejoin": "off",
      "max_parallel_workers_per_gather": "2"
    },
    "commands": [
      "SET LOCAL enable_mergejoin = 'off'",
      "SET LOCAL enable_nestloop = 'off'",
      "SET LOCAL hash_mem_multiplier = '2.0'",
      "SET LOCAL max_parallel_workers_per_gather = '2'",
      "SET LOCAL work_mem = '256MB'"
    ],
    "config_speedup": 163.26754579797142,
    "rewrite_only_speedup": 595.8176721472202
  }
}