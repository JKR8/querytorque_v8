WITH filtered_sales_cte AS (SELECT s.ss_ticket_number, s.ss_item_sk, s.ss_customer_sk, s.ss_list_price, i.i_item_sk, i.i_category, i.i_manager_id FROM store_sales s INNER JOIN date_dim d ON s.ss_sold_date_sk = d.d_date_sk INNER JOIN item i ON s.ss_item_sk = i.i_item_sk WHERE d.d_year BETWEEN 1999 AND 1999 + 1 AND s.ss_list_price BETWEEN 115 AND 129 AND (i.i_category IN ('Electronics', 'Men') OR i.i_manager_id BETWEEN 44 AND 63)), paired_items_cte AS (SELECT s1.i_item_sk AS i_item_sk, s2.i_item_sk AS i_item_sk2, s1.ss_customer_sk FROM filtered_sales_cte s1 INNER JOIN filtered_sales_cte s2 ON s1.ss_ticket_number = s2.ss_ticket_number AND s1.i_item_sk < s2.i_item_sk WHERE s1.i_category IN ('Electronics', 'Men') AND s2.i_manager_id BETWEEN 44 AND 63), dimension_join_cte AS (SELECT p.i_item_sk, p.i_item_sk2 FROM paired_items_cte p INNER JOIN customer c ON p.ss_customer_sk = c.c_customer_sk INNER JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk INNER JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE cd.cd_marital_status = 'D' AND cd.cd_education_status = 'College'), final_aggregate AS (SELECT i_item_sk, i_item_sk2 AS i_item_sk, COUNT(*) AS cnt FROM dimension_join_cte GROUP BY i_item_sk, i_item_sk2 ORDER BY cnt) SELECT i_item_sk, i_item_sk, cnt FROM final_aggregate