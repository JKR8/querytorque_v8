WITH date_cte AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '2001-06-06')), item_cte AS (SELECT i_item_sk, i_item_id FROM item WHERE i_manager_id BETWEEN 42 AND 71), customer_cte AS (SELECT c_customer_sk, c_birth_year FROM customer WHERE c_birth_year BETWEEN 1985 AND 1991), ss_items AS (SELECT item_cte.i_item_id AS item_id, customer_cte.c_birth_year AS birth_year, SUM(ss_ext_sales_price) AS ss_item_rev FROM store_sales INNER JOIN date_cte ON store_sales.ss_sold_date_sk = date_cte.d_date_sk INNER JOIN item_cte ON store_sales.ss_item_sk = item_cte.i_item_sk INNER JOIN customer_cte ON store_sales.ss_customer_sk = customer_cte.c_customer_sk WHERE store_sales.ss_list_price BETWEEN 168 AND 197 GROUP BY item_cte.i_item_id, customer_cte.c_birth_year), cs_items AS (SELECT item_cte.i_item_id AS item_id, customer_cte.c_birth_year AS birth_year, SUM(cs_ext_sales_price) AS cs_item_rev FROM catalog_sales INNER JOIN date_cte ON catalog_sales.cs_sold_date_sk = date_cte.d_date_sk INNER JOIN item_cte ON catalog_sales.cs_item_sk = item_cte.i_item_sk INNER JOIN customer_cte ON catalog_sales.cs_bill_customer_sk = customer_cte.c_customer_sk WHERE catalog_sales.cs_list_price BETWEEN 168 AND 197 GROUP BY item_cte.i_item_id, customer_cte.c_birth_year), ws_items AS (SELECT item_cte.i_item_id AS item_id, customer_cte.c_birth_year AS birth_year, SUM(ws_ext_sales_price) AS ws_item_rev FROM web_sales INNER JOIN date_cte ON web_sales.ws_sold_date_sk = date_cte.d_date_sk INNER JOIN item_cte ON web_sales.ws_item_sk = item_cte.i_item_sk INNER JOIN customer_cte ON web_sales.ws_bill_customer_sk = customer_cte.c_customer_sk WHERE web_sales.ws_list_price BETWEEN 168 AND 197 GROUP BY item_cte.i_item_id, customer_cte.c_birth_year) SELECT ss_items.item_id, ss_items.birth_year, ss_item_rev, CASE WHEN (ss_item_rev+cs_item_rev+ws_item_rev) > 0 THEN ss_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 END AS ss_dev, cs_item_rev, CASE WHEN (ss_item_rev+cs_item_rev+ws_item_rev) > 0 THEN cs_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 END AS cs_dev, ws_item_rev, CASE WHEN (ss_item_rev+cs_item_rev+ws_item_rev) > 0 THEN ws_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 END AS ws_dev, (ss_item_rev+cs_item_rev+ws_item_rev)/3 AS average FROM ss_items, cs_items, ws_items WHERE ss_items.item_id = cs_items.item_id AND ss_items.item_id = ws_items.item_id AND ss_items.birth_year = cs_items.birth_year AND ss_items.birth_year = ws_items.birth_year AND ss_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev AND ss_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND cs_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND cs_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND ws_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND ws_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev ORDER BY ss_items.item_id, ss_items.birth_year, ss_item_rev LIMIT 100