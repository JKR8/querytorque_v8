### Part 1: Modified Logic Tree

```
QUERY: (single statement)
├── [CTE] unified_sales_cte  [+]  Cost: N/A  Rows: ~133K
│   ├── SCAN (store_sales, catalog_sales, web_sales via UNION ALL)
│   ├── JOIN (item)
│   ├── JOIN (customer)
│   ├── JOIN (date_dim)
│   ├── FILTER (d_month_seq = scalar subquery)
│   ├── FILTER (sales.list_price BETWEEN 168 AND 197)
│   ├── FILTER (i_manager_id BETWEEN 42 AND 71)
│   ├── FILTER (c_birth_year BETWEEN 1985 AND 1991)
│   ├── AGG (GROUP BY i_item_id, c_birth_year, channel)
│   └── OUTPUT (item_id, birth_year, channel, item_rev)
├── [CTE] pivot_cte  [+]  Cost: N/A  Rows: ~1K
│   ├── SCAN (unified_sales_cte)
│   ├── AGG (GROUP BY item_id, birth_year)
│   ├── PIVOT (channel → ss_item_rev, cs_item_rev, ws_item_rev via CASE)
│   └── OUTPUT (item_id, birth_year, ss_item_rev, cs_item_rev, ws_item_rev)
├── [CTE] cs_items  [-]  Removed
├── [CTE] ss_items  [-]  Removed
├── [CTE] ws_items  [-]  Removed
└── [MAIN] main_query  [~]  Cost: 1%  Rows: ~1K
    ├── SCAN (pivot_cte)  (replaces three-way join)
    ├── FILTER (same revenue proximity constraints)
    ├── COMPUTE (same derived columns with division guards)
    ├── SORT (item_id ASC, birth_year ASC, ss_item_rev ASC)
    └── OUTPUT (same 9 columns)
```

### Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "PostgreSQL 16",
  "rewrite_rules": [
    {"id": "R1", "type": "union_consolidation", "description": "Consolidated three fact-table scans with UNION ALL + channel discriminator", "applied_to": ["unified_sales_cte"]},
    {"id": "R2", "type": "single_pass_aggregation", "description": "Pivot three channel revenues via conditional aggregation in second CTE", "applied_to": ["pivot_cte"]},
    {"id": "R3", "type": "correlated_subquery_simplification", "description": "Replaced IN-subquery with direct d_month_seq equality using scalar subquery", "applied_to": ["unified_sales_cte"]}
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "unified_sales_cte": {
        "type": "cte",
        "change": "new",
        "sql": "SELECT i.i_item_id AS item_id, c.c_birth_year AS birth_year, sales.channel, SUM(sales.ext_sales_price) AS item_rev FROM (SELECT 'store' AS channel, ss_item_sk AS item_sk, ss_sold_date_sk AS sold_date_sk, ss_customer_sk AS customer_sk, ss_ext_sales_price AS ext_sales_price, ss_list_price AS list_price FROM store_sales UNION ALL SELECT 'catalog' AS channel, cs_item_sk AS item_sk, cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_ext_sales_price AS ext_sales_price, cs_list_price AS list_price FROM catalog_sales UNION ALL SELECT 'web' AS channel, ws_item_sk AS item_sk, ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_ext_sales_price AS ext_sales_price, ws_list_price AS list_price FROM web_sales) sales INNER JOIN item i ON sales.item_sk = i.i_item_sk INNER JOIN customer c ON sales.customer_sk = c.c_customer_sk INNER JOIN date_dim d ON sales.sold_date_sk = d.d_date_sk WHERE d.d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '2001-06-06') AND sales.list_price BETWEEN 168 AND 197 AND i.i_manager_id BETWEEN 42 AND 71 AND c.c_birth_year BETWEEN 1985 AND 1991 GROUP BY i.i_item_id, c.c_birth_year, sales.channel",
        "interfaces": {"outputs": ["item_id", "birth_year", "channel", "item_rev"], "consumes": []}
      },
      "pivot_cte": {
        "type": "cte",
        "change": "new",
        "sql": "SELECT item_id, birth_year, SUM(CASE WHEN channel = 'store' THEN item_rev END) AS ss_item_rev, SUM(CASE WHEN channel = 'catalog' THEN item_rev END) AS cs_item_rev, SUM(CASE WHEN channel = 'web' THEN item_rev END) AS ws_item_rev FROM unified_sales_cte GROUP BY item_id, birth_year",
        "interfaces": {"outputs": ["item_id", "birth_year", "ss_item_rev", "cs_item_rev", "ws_item_rev"], "consumes": ["unified_sales_cte"]}
      },
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT item_id, birth_year, ss_item_rev, CASE WHEN (ss_item_rev + cs_item_rev + ws_item_rev) > 0 THEN ss_item_rev/((ss_item_rev + cs_item_rev + ws_item_rev)/3.0) * 100 END AS ss_dev, cs_item_rev, CASE WHEN (ss_item_rev + cs_item_rev + ws_item_rev) > 0 THEN cs_item_rev/((ss_item_rev + cs_item_rev + ws_item_rev)/3.0) * 100 END AS cs_dev, ws_item_rev, CASE WHEN (ss_item_rev + cs_item_rev + ws_item_rev) > 0 THEN ws_item_rev/((ss_item_rev + cs_item_rev + ws_item_rev)/3.0) * 100 END AS ws_dev, (ss_item_rev + cs_item_rev + ws_item_rev)/3.0 AS average FROM pivot_cte WHERE ss_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev AND ss_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND cs_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND cs_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND ws_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND ws_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev ORDER BY item_id, birth_year, ss_item_rev LIMIT 100",
        "interfaces": {"outputs": ["item_id", "birth_year", "ss_item_rev", "ss_dev", "cs_item_rev", "cs_dev", "ws_item_rev", "ws_dev", "average"], "consumes": ["pivot_cte"]}
      }
    },
    "reconstruction_order": ["unified_sales_cte", "pivot_cte", "main_query"],
    "assembly_template": "WITH unified_sales_cte AS ({unified_sales_cte}), pivot_cte AS ({pivot_cte}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "runtime_config": [],
  "validation_checks": []
}
```

**Changes:** Consolidated three separate fact-table scans into a single UNION ALL scan with a channel discriminator, then pivoted via conditional aggregation in a second CTE. This eliminates redundant dimension table scans and the three-way Cartesian join.

**Expected speedup:** 1.5-2x from eliminating 3× redundant dimension table scans and replacing the three-way join with a single-table scan.