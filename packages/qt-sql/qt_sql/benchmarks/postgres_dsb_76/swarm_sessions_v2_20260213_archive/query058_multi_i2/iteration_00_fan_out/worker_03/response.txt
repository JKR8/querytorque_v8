### Part 1: Modified Logic Tree

```
QUERY: (single statement)
├── [CTE] dim_cte  [!]
│   ├── SCAN (item, customer, date_dim)
│   ├── JOIN (CROSS)
│   ├── FILTER (i_manager_id BETWEEN 42 AND 71)
│   ├── FILTER (c_birth_year BETWEEN 1985 AND 1991)
│   ├── SUBQUERY (date_filter)
│   │   ├── SCAN (date_dim)
│   │   └── FILTER (d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '2001-06-06'))
│   └── OUTPUT (i_item_sk, i_item_id, c_customer_sk, c_birth_year, d_date_sk, d_date)
├── [CTE] ss_items  [!]
│   ├── SCAN (store_sales)
│   ├── JOIN (INNER) on dim_cte via (ss_item_sk, ss_sold_date_sk, ss_customer_sk)
│   ├── FILTER (ss_list_price BETWEEN 168 AND 197)
│   ├── AGG (GROUP BY i_item_id, c_birth_year)
│   └── OUTPUT (item_id, birth_year, ss_item_rev)
├── [CTE] cs_items  [!]
│   ├── SCAN (catalog_sales)
│   ├── JOIN (INNER) on dim_cte via (cs_item_sk, cs_sold_date_sk, cs_bill_customer_sk)
│   ├── FILTER (cs_list_price BETWEEN 168 AND 197)
│   ├── AGG (GROUP BY i_item_id, c_birth_year)
│   └── OUTPUT (item_id, birth_year, cs_item_rev)
├── [CTE] ws_items  [!]
│   ├── SCAN (web_sales)
│   ├── JOIN (INNER) on dim_cte via (ws_item_sk, ws_sold_date_sk, ws_bill_customer_sk)
│   ├── FILTER (ws_list_price BETWEEN 168 AND 197)
│   ├── AGG (GROUP BY i_item_id, c_birth_year)
│   └── OUTPUT (item_id, birth_year, ws_item_rev)
└── [MAIN] main_query  [=]
    ├── SCAN (ss_items, cs_items, ws_items)
    ├── JOIN (ss_items.item_id = cs_items.item_id AND ss_items.birth_year = cs_items.birth_year)
    ├── JOIN (ss_items.item_id = ws_items.item_id AND ss_items.birth_year = ws_items.birth_year)
    ├── FILTER (ss_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev)
    ├── FILTER (ss_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev)
    ├── FILTER (cs_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev)
    ├── FILTER (cs_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev)
    ├── FILTER (ws_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev)
    ├── FILTER (ws_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev)
    ├── SORT (item_id ASC, birth_year ASC, ss_item_rev ASC)
    └── OUTPUT (item_id, birth_year, ss_item_rev, ss_dev, cs_item_rev, cs_dev, ws_item_rev, ws_dev, average)
```

### Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "PostgreSQL 16",
  "rewrite_rules": [
    {"id": "R1", "type": "shared_dimension_multi_channel", "description": "Create shared dimension CTE (dim_cte) that pre-filters item, customer, and date dimensions, then reuse across three fact table CTEs", "applied_to": ["dim_cte", "ss_items", "cs_items", "ws_items"]},
    {"id": "R2", "type": "pg_materialized_dimension_fact_prefilter", "description": "Apply MATERIALIZED hint to dim_cte to force pre-filtering of dimensions before joining with large fact tables", "applied_to": ["dim_cte"]}
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "dim_cte": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT item.i_item_sk, item.i_item_id, customer.c_customer_sk, customer.c_birth_year, date_filter.d_date_sk, date_filter.d_date FROM item CROSS JOIN customer CROSS JOIN (SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '2001-06-06')) AS date_filter WHERE item.i_manager_id BETWEEN 42 AND 71 AND customer.c_birth_year BETWEEN 1985 AND 1991",
        "interfaces": {"outputs": ["i_item_sk", "i_item_id", "c_customer_sk", "c_birth_year", "d_date_sk", "d_date"], "consumes": []}
      },
      "ss_items": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT dim_cte.i_item_id AS item_id, dim_cte.c_birth_year AS birth_year, SUM(store_sales.ss_ext_sales_price) AS ss_item_rev FROM store_sales INNER JOIN dim_cte ON store_sales.ss_item_sk = dim_cte.i_item_sk AND store_sales.ss_sold_date_sk = dim_cte.d_date_sk AND store_sales.ss_customer_sk = dim_cte.c_customer_sk WHERE store_sales.ss_list_price BETWEEN 168 AND 197 GROUP BY dim_cte.i_item_id, dim_cte.c_birth_year",
        "interfaces": {"outputs": ["item_id", "birth_year", "ss_item_rev"], "consumes": ["dim_cte"]}
      },
      "cs_items": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT dim_cte.i_item_id AS item_id, dim_cte.c_birth_year AS birth_year, SUM(catalog_sales.cs_ext_sales_price) AS cs_item_rev FROM catalog_sales INNER JOIN dim_cte ON catalog_sales.cs_item_sk = dim_cte.i_item_sk AND catalog_sales.cs_sold_date_sk = dim_cte.d_date_sk AND catalog_sales.cs_bill_customer_sk = dim_cte.c_customer_sk WHERE catalog_sales.cs_list_price BETWEEN 168 AND 197 GROUP BY dim_cte.i_item_id, dim_cte.c_birth_year",
        "interfaces": {"outputs": ["item_id", "birth_year", "cs_item_rev"], "consumes": ["dim_cte"]}
      },
      "ws_items": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT dim_cte.i_item_id AS item_id, dim_cte.c_birth_year AS birth_year, SUM(web_sales.ws_ext_sales_price) AS ws_item_rev FROM web_sales INNER JOIN dim_cte ON web_sales.ws_item_sk = dim_cte.i_item_sk AND web_sales.ws_sold_date_sk = dim_cte.d_date_sk AND web_sales.ws_bill_customer_sk = dim_cte.c_customer_sk WHERE web_sales.ws_list_price BETWEEN 168 AND 197 GROUP BY dim_cte.i_item_id, dim_cte.c_birth_year",
        "interfaces": {"outputs": ["item_id", "birth_year", "ws_item_rev"], "consumes": ["dim_cte"]}
      },
      "main_query": {
        "type": "main_query",
        "change": "unchanged",
        "sql": "",
        "interfaces": {"outputs": ["item_id", "birth_year", "ss_item_rev", "ss_dev", "cs_item_rev", "cs_dev", "ws_item_rev", "ws_dev", "average"], "consumes": ["ss_items", "cs_items", "ws_items"]}
      }
    },
    "reconstruction_order": ["dim_cte", "ss_items", "cs_items", "ws_items", "main_query"],
    "assembly_template": "WITH dim_cte AS (MATERIALIZED {dim_cte}), ss_items AS ({ss_items}), cs_items AS ({cs_items}), ws_items AS ({ws_items}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "runtime_config": [],
  "validation_checks": []
}
```

**Final SQL Assembly:**

```sql
WITH dim_cte AS (MATERIALIZED 
  SELECT item.i_item_sk, item.i_item_id, customer.c_customer_sk, customer.c_birth_year, date_filter.d_date_sk, date_filter.d_date 
  FROM item 
  CROSS JOIN customer 
  CROSS JOIN (
    SELECT d_date_sk, d_date 
    FROM date_dim 
    WHERE d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '2001-06-06')
  ) AS date_filter 
  WHERE item.i_manager_id BETWEEN 42 AND 71 
    AND customer.c_birth_year BETWEEN 1985 AND 1991
), 
ss_items AS (
  SELECT dim_cte.i_item_id AS item_id, dim_cte.c_birth_year AS birth_year, SUM(store_sales.ss_ext_sales_price) AS ss_item_rev 
  FROM store_sales 
  INNER JOIN dim_cte ON store_sales.ss_item_sk = dim_cte.i_item_sk 
    AND store_sales.ss_sold_date_sk = dim_cte.d_date_sk 
    AND store_sales.ss_customer_sk = dim_cte.c_customer_sk 
  WHERE store_sales.ss_list_price BETWEEN 168 AND 197 
  GROUP BY dim_cte.i_item_id, dim_cte.c_birth_year
), 
cs_items AS (
  SELECT dim_cte.i_item_id AS item_id, dim_cte.c_birth_year AS birth_year, SUM(catalog_sales.cs_ext_sales_price) AS cs_item_rev 
  FROM catalog_sales 
  INNER JOIN dim_cte ON catalog_sales.cs_item_sk = dim_cte.i_item_sk 
    AND catalog_sales.cs_sold_date_sk = dim_cte.d_date_sk 
    AND catalog_sales.cs_bill_customer_sk = dim_cte.c_customer_sk 
  WHERE catalog_sales.cs_list_price BETWEEN 168 AND 197 
  GROUP BY dim_cte.i_item_id, dim_cte.c_birth_year
), 
ws_items AS (
  SELECT dim_cte.i_item_id AS item_id, dim_cte.c_birth_year AS birth_year, SUM(web_sales.ws_ext_sales_price) AS ws_item_rev 
  FROM web_sales 
  INNER JOIN dim_cte ON web_sales.ws_item_sk = dim_cte.i_item_sk 
    AND web_sales.ws_sold_date_sk = dim_cte.d_date_sk 
    AND web_sales.ws_bill_customer_sk = dim_cte.c_customer_sk 
  WHERE web_sales.ws_list_price BETWEEN 168 AND 197 
  GROUP BY dim_cte.i_item_id, dim_cte.c_birth_year
)
SELECT ss_items.item_id, ss_items.birth_year, 
  ss_items.ss_item_rev, 
  CASE WHEN (ss_items.ss_item_rev + cs_items.cs_item_rev + ws_items.ws_item_rev) / 3 = 0 THEN NULL 
       ELSE ss_items.ss_item_rev / ((ss_items.ss_item_rev + cs_items.cs_item_rev + ws_items.ws_item_rev) / 3) * 100 
  END AS ss_dev, 
  cs_items.cs_item_rev, 
  CASE WHEN (ss_items.ss_item_rev + cs_items.cs_item_rev + ws_items.ws_item_rev) / 3 = 0 THEN NULL 
       ELSE cs_items.cs_item_rev / ((ss_items.ss_item_rev + cs_items.cs_item_rev + ws_items.ws_item_rev) / 3) * 100 
  END AS cs_dev, 
  ws_items.ws_item_rev, 
  CASE WHEN (ss_items.ss_item_rev + cs_items.cs_item_rev + ws_items.ws_item_rev) / 3 = 0 THEN NULL 
       ELSE ws_items.ws_item_rev / ((ss_items.ss_item_rev + cs_items.cs_item_rev + ws_items.ws_item_rev) / 3) * 100 
  END AS ws_dev, 
  (ss_items.ss_item_rev + cs_items.cs_item_rev + ws_items.ws_item_rev) / 3 AS average 
FROM ss_items, cs_items, ws_items 
WHERE ss_items.item_id = cs_items.item_id 
  AND ss_items.item_id = ws_items.item_id 
  AND ss_items.birth_year = cs_items.birth_year 
  AND ss_items.birth_year = ws_items.birth_year 
  AND ss_items.ss_item_rev BETWEEN 0.9 * cs_items.cs_item_rev AND 1.1 * cs_items.cs_item_rev 
  AND ss_items.ss_item_rev BETWEEN 0.9 * ws_items.ws_item_rev AND 1.1 * ws_items.ws_item_rev 
  AND cs_items.cs_item_rev BETWEEN 0.9 * ss_items.ss_item_rev AND 1.1 * ss_items.ss_item_rev 
  AND cs_items.cs_item_rev BETWEEN 0.9 * ws_items.ws_item_rev AND 1.1 * ws_items.ws_item_rev 
  AND ws_items.ws_item_rev BETWEEN 0.9 * ss_items.ss_item_rev AND 1.1 * ss_items.ss_item_rev 
  AND ws_items.ws_item_rev BETWEEN 0.9 * cs_items.cs_item_rev AND 1.1 * cs_items.cs_item_rev 
ORDER BY ss_items.item_id, ss_items.birth_year, ss_items.ss_item_rev 
LIMIT 100
```

**Changes:** Created a shared dimension CTE (`dim_cte`) that pre-filters item, customer, and date dimensions once, then reused it across all three fact table CTEs. Added `MATERIALIZED` hint to force evaluation of the dimension CTE before joins.

**Expected speedup:** 2-3x due to eliminating redundant dimension filtering (3× scans of item/customer) and replacing correlated subquery with a single date filter CTE.