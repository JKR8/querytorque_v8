{
  "worker_id": 4,
  "strategy": "scan_consolidation_pivot",
  "examples_used": [
    "single_pass_aggregation",
    "channel_bitmap_aggregation"
  ],
  "optimized_sql": "WITH unified_sales_cte AS (SELECT i.i_item_id AS item_id, c.c_birth_year AS birth_year, sales.channel, SUM(sales.ext_sales_price) AS item_rev FROM (SELECT 'store' AS channel, ss_item_sk AS item_sk, ss_sold_date_sk AS sold_date_sk, ss_customer_sk AS customer_sk, ss_ext_sales_price AS ext_sales_price, ss_list_price AS list_price FROM store_sales UNION ALL SELECT 'catalog' AS channel, cs_item_sk AS item_sk, cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_ext_sales_price AS ext_sales_price, cs_list_price AS list_price FROM catalog_sales UNION ALL SELECT 'web' AS channel, ws_item_sk AS item_sk, ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_ext_sales_price AS ext_sales_price, ws_list_price AS list_price FROM web_sales) sales INNER JOIN item i ON sales.item_sk = i.i_item_sk INNER JOIN customer c ON sales.customer_sk = c.c_customer_sk INNER JOIN date_dim d ON sales.sold_date_sk = d.d_date_sk WHERE d.d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_date = '2001-06-06') AND sales.list_price BETWEEN 168 AND 197 AND i.i_manager_id BETWEEN 42 AND 71 AND c.c_birth_year BETWEEN 1985 AND 1991 GROUP BY i.i_item_id, c.c_birth_year, sales.channel), pivot_cte AS (SELECT item_id, birth_year, SUM(CASE WHEN channel = 'store' THEN item_rev END) AS ss_item_rev, SUM(CASE WHEN channel = 'catalog' THEN item_rev END) AS cs_item_rev, SUM(CASE WHEN channel = 'web' THEN item_rev END) AS ws_item_rev FROM unified_sales_cte GROUP BY item_id, birth_year) SELECT item_id, birth_year, ss_item_rev, CASE WHEN (ss_item_rev + cs_item_rev + ws_item_rev) > 0 THEN ss_item_rev/((ss_item_rev + cs_item_rev + ws_item_rev)/3.0) * 100 END AS ss_dev, cs_item_rev, CASE WHEN (ss_item_rev + cs_item_rev + ws_item_rev) > 0 THEN cs_item_rev/((ss_item_rev + cs_item_rev + ws_item_rev)/3.0) * 100 END AS cs_dev, ws_item_rev, CASE WHEN (ss_item_rev + cs_item_rev + ws_item_rev) > 0 THEN ws_item_rev/((ss_item_rev + cs_item_rev + ws_item_rev)/3.0) * 100 END AS ws_dev, (ss_item_rev + cs_item_rev + ws_item_rev)/3.0 AS average FROM pivot_cte WHERE ss_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev AND ss_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND cs_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND cs_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND ws_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND ws_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev ORDER BY item_id, birth_year, ss_item_rev LIMIT 100",
  "speedup": 1.3401857830241466,
  "status": "WIN",
  "transforms": [
    "or_to_union"
  ],
  "hint": "single_pass_aggregation: Apply UNION ALL of fact tables with channel discriminat",
  "error_message": null,
  "error_messages": [],
  "error_category": null,
  "exploratory": true
}