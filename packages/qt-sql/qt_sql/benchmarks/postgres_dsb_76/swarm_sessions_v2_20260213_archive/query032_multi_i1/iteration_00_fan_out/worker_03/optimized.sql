WITH filtered_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN '1998-01-06' AND cast('1998-01-06' as date) + interval '90 day'), sales_date_join AS (SELECT cs_item_sk, cs_ext_discount_amt, cs_sold_date_sk, cs_list_price, cs_sales_price FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk), threshold_compute AS (SELECT cs_item_sk, 1.3 * avg(cs_ext_discount_amt) AS threshold FROM sales_date_join WHERE cs_list_price BETWEEN 108 AND 137 AND cs_sales_price / cs_list_price BETWEEN 23 * 0.01 AND 43 * 0.01 GROUP BY cs_item_sk), main_join AS (SELECT s.cs_ext_discount_amt FROM sales_date_join s JOIN item ON i_item_sk = s.cs_item_sk JOIN threshold_compute t ON s.cs_item_sk = t.cs_item_sk WHERE (i_manufact_id IN (47, 226, 612, 676, 818) OR i_manager_id BETWEEN 71 AND 100) AND s.cs_ext_discount_amt > t.threshold) SELECT SUM(cs_ext_discount_amt) AS "excess discount amount" FROM main_join ORDER BY SUM(cs_ext_discount_amt) ASC LIMIT 100