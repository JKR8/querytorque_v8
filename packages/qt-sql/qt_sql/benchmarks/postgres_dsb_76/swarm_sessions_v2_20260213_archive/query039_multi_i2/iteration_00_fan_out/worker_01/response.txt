### Part 1: Modified Logic Tree

```
QUERY: (two statements)
├── FIRST STATEMENT
│   ├── [CTE] filtered_date [!] Changed from comma-join to explicit CTE
│   ├── [CTE] filtered_item [!] Changed from comma-join to explicit CTE
│   ├── [CTE] filtered_warehouse [!] Changed from comma-join to explicit CTE
│   ├── [CTE] joined_fact [!] Changed from comma-join to explicit JOINs
│   ├── [CTE] aggregated [=]
│   ├── [CTE] filtered_cov [=]
│   └── [MAIN] main_self_join [=] (without cov > 1.5)
└── SECOND STATEMENT
    ├── [CTE] filtered_date [=]
    ├── [CTE] filtered_item [=]
    ├── [CTE] filtered_warehouse [=]
    ├── [CTE] joined_fact [=]
    ├── [CTE] aggregated [=]
    ├── [CTE] filtered_cov [=]
    └── [MAIN] main_self_join [~] Added inv1.cov > 1.5 filter
```

### Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "postgresql",
  "rewrite_rules": [
    {
      "id": "R1",
      "type": "multi_dimension_prefetch",
      "description": "Pre-filter all three selective dimensions (date, item, warehouse) into explicit CTEs with inner joins to avoid comma-separated joins",
      "applied_to": ["filtered_date", "filtered_item", "filtered_warehouse", "joined_fact"]
    }
  ],
  "statements": [
    {
      "target_table": null,
      "change": "modified",
      "components": {
        "filtered_date": {
          "type": "cte",
          "change": "modified",
          "sql": "SELECT d_date_sk, d_moy FROM date_dim WHERE d_year = 2002",
          "interfaces": {
            "outputs": ["d_date_sk", "d_moy"],
            "consumes": []
          }
        },
        "filtered_item": {
          "type": "cte",
          "change": "modified",
          "sql": "SELECT i_item_sk FROM item WHERE i_category IN ('Shoes', 'Sports') AND i_manager_id BETWEEN 42 AND 61",
          "interfaces": {
            "outputs": ["i_item_sk"],
            "consumes": []
          }
        },
        "filtered_warehouse": {
          "type": "cte",
          "change": "modified",
          "sql": "SELECT w_warehouse_sk, w_warehouse_name FROM warehouse",
          "interfaces": {
            "outputs": ["w_warehouse_sk", "w_warehouse_name"],
            "consumes": []
          }
        },
        "joined_fact": {
          "type": "cte",
          "change": "modified",
          "sql": "SELECT w.w_warehouse_sk, w.w_warehouse_name, i.i_item_sk, d.d_moy, inv.inv_quantity_on_hand FROM inventory inv INNER JOIN filtered_date d ON inv.inv_date_sk = d.d_date_sk INNER JOIN filtered_item i ON inv.inv_item_sk = i.i_item_sk INNER JOIN filtered_warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk WHERE inv.inv_quantity_on_hand BETWEEN 791 AND 991",
          "interfaces": {
            "outputs": ["w_warehouse_sk", "w_warehouse_name", "i_item_sk", "d_moy", "inv_quantity_on_hand"],
            "consumes": ["filtered_date", "filtered_item", "filtered_warehouse"]
          }
        },
        "aggregated": {
          "type": "cte",
          "change": "modified",
          "sql": "SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, STDDEV_SAMP(inv_quantity_on_hand) AS stdev, AVG(inv_quantity_on_hand) AS mean FROM joined_fact GROUP BY w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy",
          "interfaces": {
            "outputs": ["w_warehouse_name", "w_warehouse_sk", "i_item_sk", "d_moy", "stdev", "mean"],
            "consumes": ["joined_fact"]
          }
        },
        "filtered_cov": {
          "type": "cte",
          "change": "modified",
          "sql": "SELECT w_warehouse_sk, i_item_sk, d_moy, mean, CASE WHEN mean = 0 THEN NULL ELSE stdev/mean END AS cov FROM aggregated WHERE CASE WHEN mean = 0 THEN 0 ELSE stdev/mean END > 1",
          "interfaces": {
            "outputs": ["w_warehouse_sk", "i_item_sk", "d_moy", "mean", "cov"],
            "consumes": ["aggregated"]
          }
        },
        "main_self_join": {
          "type": "main_query",
          "change": "modified",
          "sql": "SELECT inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov, inv2.w_warehouse_sk, inv2.i_item_sk, inv2.d_moy, inv2.mean, inv2.cov FROM filtered_cov AS inv1 INNER JOIN filtered_cov AS inv2 ON inv1.i_item_sk = inv2.i_item_sk AND inv1.w_warehouse_sk = inv2.w_warehouse_sk WHERE inv1.d_moy = 5 AND inv2.d_moy = 6 ORDER BY inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov, inv2.d_moy, inv2.mean, inv2.cov",
          "interfaces": {
            "outputs": ["inv1.w_warehouse_sk", "inv1.i_item_sk", "inv1.d_moy", "inv1.mean", "inv1.cov", "inv2.w_warehouse_sk", "inv2.i_item_sk", "inv2.d_moy", "inv2.mean", "inv2.cov"],
            "consumes": ["filtered_cov"]
          }
        }
      },
      "reconstruction_order": ["filtered_date", "filtered_item", "filtered_warehouse", "joined_fact", "aggregated", "filtered_cov", "main_self_join"],
      "assembly_template": "WITH filtered_date AS ({filtered_date}), filtered_item AS ({filtered_item}), filtered_warehouse AS ({filtered_warehouse}), joined_fact AS ({joined_fact}), aggregated AS ({aggregated}), filtered_cov AS ({filtered_cov}) {main_self_join}"
    },
    {
      "target_table": null,
      "change": "modified",
      "components": {
        "filtered_date": {
          "type": "cte",
          "change": "unchanged",
          "sql": "",
          "interfaces": {
            "outputs": ["d_date_sk", "d_moy"],
            "consumes": []
          }
        },
        "filtered_item": {
          "type": "cte",
          "change": "unchanged",
          "sql": "",
          "interfaces": {
            "outputs": ["i_item_sk"],
            "consumes": []
          }
        },
        "filtered_warehouse": {
          "type": "cte",
          "change": "unchanged",
          "sql": "",
          "interfaces": {
            "outputs": ["w_warehouse_sk", "w_warehouse_name"],
            "consumes": []
          }
        },
        "joined_fact": {
          "type": "cte",
          "change": "unchanged",
          "sql": "",
          "interfaces": {
            "outputs": ["w_warehouse_sk", "w_warehouse_name", "i_item_sk", "d_moy", "inv_quantity_on_hand"],
            "consumes": []
          }
        },
        "aggregated": {
          "type": "cte",
          "change": "unchanged",
          "sql": "",
          "interfaces": {
            "outputs": ["w_warehouse_name", "w_warehouse_sk", "i_item_sk", "d_moy", "stdev", "mean"],
            "consumes": []
          }
        },
        "filtered_cov": {
          "type": "cte",
          "change": "unchanged",
          "sql": "",
          "interfaces": {
            "outputs": ["w_warehouse_sk", "i_item_sk", "d_moy", "mean", "cov"],
            "consumes": []
          }
        },
        "main_self_join": {
          "type": "main_query",
          "change": "modified",
          "sql": "SELECT inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov, inv2.w_warehouse_sk, inv2.i_item_sk, inv2.d_moy, inv2.mean, inv2.cov FROM filtered_cov AS inv1 INNER JOIN filtered_cov AS inv2 ON inv1.i_item_sk = inv2.i_item_sk AND inv1.w_warehouse_sk = inv2.w_warehouse_sk WHERE inv1.d_moy = 5 AND inv2.d_moy = 6 AND inv1.cov > 1.5 ORDER BY inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov, inv2.d_moy, inv2.mean, inv2.cov",
          "interfaces": {
            "outputs": ["inv1.w_warehouse_sk", "inv1.i_item_sk", "inv1.d_moy", "inv1.mean", "inv1.cov", "inv2.w_warehouse_sk", "inv2.i_item_sk", "inv2.d_moy", "inv2.mean", "inv2.cov"],
            "consumes": ["filtered_cov"]
          }
        }
      },
      "reconstruction_order": ["filtered_date", "filtered_item", "filtered_warehouse", "joined_fact", "aggregated", "filtered_cov", "main_self_join"],
      "assembly_template": "WITH filtered_date AS ({filtered_date}), filtered_item AS ({filtered_item}), filtered_warehouse AS ({filtered_warehouse}), joined_fact AS ({joined_fact}), aggregated AS ({aggregated}), filtered_cov AS ({filtered_cov}) {main_self_join}"
    }
  ],
  "macros": {},
  "frozen_blocks": [],
  "runtime_config": [],
  "validation_checks": []
}
```

Changes: Converted comma-separated joins to explicit inner joins with pre-filtered dimension CTEs, preserving the exact semantic structure from the target logical tree. The CTE approach respects the PostgreSQL optimizer's preference for small hash tables from selective dimension filters.

Expected speedup: ~2.5-3.5x based on the pg_dimension_prefetch_star pattern, as we're providing better cardinality estimates and enabling parallel-safe hash joins instead of blocking CTE materialization.