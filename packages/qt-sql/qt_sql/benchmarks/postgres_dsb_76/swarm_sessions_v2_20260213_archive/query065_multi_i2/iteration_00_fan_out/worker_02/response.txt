### Part 1: Modified Logic Tree

```
MAIN [~] (restructured to CTE pipeline)
├── WITH filtered_date [=]
├── WITH filtered_store [=]
├── WITH store_sales_joined [=]
├── WITH store_item_revenue [=]
├── WITH store_avg [=]
└── FINAL [~] (explicit joins with CTEs)
    ├── JOIN store_item_revenue ON store_avg (ss_store_sk)
    ├── JOIN filtered_store (ss_store_sk = s_store_sk)
    ├── JOIN item (ss_item_sk = i_item_sk)
    ├── FILTER revenue <= 0.1 * ave
    ├── FILTER i_manager_id 10-14
    ├── SORT s_store_name, i_item_desc
    └── LIMIT 100
```

### Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "PostgreSQL 16.11",
  "rewrite_rules": [
    {"id": "R1", "type": "dimension_prefilter", "description": "Isolate selective date and store filters into separate CTEs", "applied_to": ["filtered_date", "filtered_store"]},
    {"id": "R2", "type": "explicit_join_conversion", "description": "Replace comma joins with explicit INNER JOIN syntax throughout", "applied_to": ["store_sales_joined", "final_join"]},
    {"id": "R3", "type": "agg_materialization", "description": "Materialize store-item revenue once, reuse for store average", "applied_to": ["store_item_revenue", "store_avg"]}
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "filtered_date": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1215 AND 1226",
        "interfaces": {"outputs": ["d_date_sk"], "consumes": []}
      },
      "filtered_store": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT s_store_sk, s_store_name FROM store WHERE s_state IN ('KS','OH','SD')",
        "interfaces": {"outputs": ["s_store_sk", "s_store_name"], "consumes": []}
      },
      "store_sales_joined": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT ss_store_sk, ss_item_sk, ss_sales_price FROM store_sales INNER JOIN filtered_date ON store_sales.ss_sold_date_sk = filtered_date.d_date_sk WHERE ss_sales_price / ss_list_price BETWEEN 0.79 AND 0.89",
        "interfaces": {"outputs": ["ss_store_sk", "ss_item_sk", "ss_sales_price"], "consumes": ["filtered_date"]}
      },
      "store_item_revenue": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT ss_store_sk, ss_item_sk, SUM(ss_sales_price) AS revenue FROM store_sales_joined GROUP BY ss_store_sk, ss_item_sk",
        "interfaces": {"outputs": ["ss_store_sk", "ss_item_sk", "revenue"], "consumes": ["store_sales_joined"]}
      },
      "store_avg": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT ss_store_sk, AVG(revenue) AS ave FROM store_item_revenue GROUP BY ss_store_sk",
        "interfaces": {"outputs": ["ss_store_sk", "ave"], "consumes": ["store_item_revenue"]}
      },
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT filtered_store.s_store_name, item.i_item_desc, store_item_revenue.revenue, item.i_current_price, item.i_wholesale_cost, item.i_brand FROM store_item_revenue INNER JOIN store_avg ON store_item_revenue.ss_store_sk = store_avg.ss_store_sk INNER JOIN filtered_store ON store_item_revenue.ss_store_sk = filtered_store.s_store_sk INNER JOIN item ON store_item_revenue.ss_item_sk = item.i_item_sk WHERE store_item_revenue.revenue <= 0.1 * store_avg.ave AND item.i_manager_id BETWEEN 10 AND 14 ORDER BY filtered_store.s_store_name, item.i_item_desc LIMIT 100",
        "interfaces": {"outputs": ["s_store_name", "i_item_desc", "revenue", "i_current_price", "i_wholesale_cost", "i_brand"], "consumes": ["store_item_revenue", "store_avg", "filtered_store"]}
      }
    },
    "reconstruction_order": ["filtered_date", "filtered_store", "store_sales_joined", "store_item_revenue", "store_avg", "main_query"],
    "assembly_template": "WITH filtered_date AS ({filtered_date}), filtered_store AS ({filtered_store}), store_sales_joined AS ({store_sales_joined}), store_item_revenue AS ({store_item_revenue}), store_avg AS ({store_avg}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "runtime_config": [],
  "validation_checks": []
}
```

**Changes**: Isolated selective dimension filters (date, store) into separate CTEs, converted comma joins to explicit INNER JOINs, and materialized the store-item revenue aggregation once for reuse in store-average calculation. This preserves the original logic while enabling better hash join planning with pre-filtered dimension tables.

**Expected speedup**: ~2-3x from improved cardinality estimation and elimination of duplicate store_sales scans.