{
  "worker_id": 2,
  "strategy": "single_pass_aggregation_channel_pivot",
  "examples_used": [
    "single_pass_aggregation",
    "union_cte_split",
    "scan_consolidation_pivot"
  ],
  "optimized_sql": "WITH filtered_date AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN CAST('1998-08-29' AS DATE) AND CAST('1998-08-29' AS DATE) + INTERVAL '30 DAY'), filtered_item AS (SELECT i_item_sk, i_current_price, i_category FROM item WHERE i_current_price > 50 AND i_category IN ('Children', 'Sports')), filtered_promotion AS (SELECT p_promo_sk, p_channel_email, p_channel_tv, p_channel_radio, p_channel_press, p_channel_event FROM promotion WHERE p_channel_email = 'N' AND p_channel_tv = 'N' AND p_channel_radio = 'N' AND p_channel_press = 'N' AND p_channel_event = 'N'), all_sales AS (SELECT sales.channel, sales.item_sk, sales.order_number, sales.location_sk, sales.sales_price, sales.net_profit, sales.wholesale_cost, sales.promo_sk, sales.date_sk FROM (SELECT 'store' AS channel, ss_item_sk AS item_sk, ss_ticket_number AS order_number, ss_store_sk AS location_sk, ss_ext_sales_price AS sales_price, ss_net_profit AS net_profit, ss_wholesale_cost AS wholesale_cost, ss_promo_sk AS promo_sk, ss_sold_date_sk AS date_sk FROM store_sales WHERE ss_wholesale_cost BETWEEN 23 AND 38 UNION ALL SELECT 'catalog' AS channel, cs_item_sk, cs_order_number, cs_catalog_page_sk, cs_ext_sales_price, cs_net_profit, cs_wholesale_cost, cs_promo_sk, cs_sold_date_sk FROM catalog_sales WHERE cs_wholesale_cost BETWEEN 23 AND 38 UNION ALL SELECT 'web' AS channel, ws_item_sk, ws_order_number, ws_web_site_sk, ws_ext_sales_price, ws_net_profit, ws_wholesale_cost, ws_promo_sk, ws_sold_date_sk FROM web_sales WHERE ws_wholesale_cost BETWEEN 23 AND 38) sales INNER JOIN filtered_date ON sales.date_sk = filtered_date.d_date_sk INNER JOIN filtered_item ON sales.item_sk = filtered_item.i_item_sk INNER JOIN filtered_promotion ON sales.promo_sk = filtered_promotion.p_promo_sk), channel_aggregates AS (SELECT channel, id, SUM(sales_price) AS sales, SUM(COALESCE(return_amt, 0)) AS returns, SUM(net_profit - COALESCE(return_loss, 0)) AS profit FROM (SELECT a.channel, a.item_sk, a.order_number, a.location_sk, a.sales_price, a.net_profit, sr.sr_return_amt AS return_amt, sr.sr_net_loss AS return_loss, s.s_store_id AS id FROM all_sales a INNER JOIN store s ON a.location_sk = s.s_store_sk LEFT JOIN store_returns sr ON a.item_sk = sr.sr_item_sk AND a.order_number = sr.sr_ticket_number WHERE a.channel = 'store' UNION ALL SELECT a.channel, a.item_sk, a.order_number, a.location_sk, a.sales_price, a.net_profit, cr.cr_return_amount AS return_amt, cr.cr_net_loss AS return_loss, cp.cp_catalog_page_id AS id FROM all_sales a INNER JOIN catalog_page cp ON a.location_sk = cp.cp_catalog_page_sk LEFT JOIN catalog_returns cr ON a.item_sk = cr.cr_item_sk AND a.order_number = cr.cr_order_number WHERE a.channel = 'catalog' UNION ALL SELECT a.channel, a.item_sk, a.order_number, a.location_sk, a.sales_price, a.net_profit, wr.wr_return_amt AS return_amt, wr.wr_net_loss AS return_loss, web.web_site_id AS id FROM all_sales a INNER JOIN web_site web ON a.location_sk = web.web_site_sk LEFT JOIN web_returns wr ON a.item_sk = wr.wr_item_sk AND a.order_number = wr.wr_order_number WHERE a.channel = 'web') t GROUP BY channel, id) SELECT channel, id, SUM(sales) AS sales, SUM(returns) AS returns, SUM(profit) AS profit FROM (SELECT CASE channel WHEN 'store' THEN 'store channel' WHEN 'catalog' THEN 'catalog channel' WHEN 'web' THEN 'web channel' END AS channel, CASE channel WHEN 'store' THEN 'store' || id WHEN 'catalog' THEN 'catalog_page' || id WHEN 'web' THEN 'web_site' || id END AS id, sales, returns, profit FROM channel_aggregates) t GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100",
  "speedup": 0.041865477619911745,
  "status": "REGRESSION",
  "transforms": [
    "date_cte_isolate"
  ],
  "hint": "- single_pass_aggregation: Apply merging of three fact table scans into one UNIO",
  "error_message": null,
  "error_messages": [],
  "error_category": null
}