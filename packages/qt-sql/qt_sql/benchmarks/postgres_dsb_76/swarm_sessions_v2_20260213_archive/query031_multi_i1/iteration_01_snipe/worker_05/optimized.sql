WITH filtered_date AS (SELECT d_date_sk, d_qoy FROM date_dim WHERE d_year = 1998 AND d_qoy IN (1, 2, 3)), filtered_item AS (SELECT i_item_sk FROM item WHERE i_color IN ('navajo', 'orchid') AND i_manager_id BETWEEN 8 AND 27), filtered_ca AS (SELECT ca_address_sk, ca_county FROM customer_address WHERE ca_state IN ('IA', 'IL')), store_aggregates AS (SELECT fd.d_qoy, fc.ca_county, SUM(ss_ext_sales_price) AS sales FROM store_sales ss INNER JOIN filtered_date fd ON ss.ss_sold_date_sk = fd.d_date_sk INNER JOIN filtered_item fi ON ss.ss_item_sk = fi.i_item_sk INNER JOIN filtered_ca fc ON ss.ss_addr_sk = fc.ca_address_sk WHERE ss.ss_list_price BETWEEN 86 AND 100 GROUP BY fd.d_qoy, fc.ca_county), web_aggregates AS (SELECT fd.d_qoy, fc.ca_county, SUM(ws_ext_sales_price) AS sales FROM web_sales ws INNER JOIN filtered_date fd ON ws.ws_sold_date_sk = fd.d_date_sk INNER JOIN filtered_item fi ON ws.ws_item_sk = fi.i_item_sk INNER JOIN filtered_ca fc ON ws.ws_bill_addr_sk = fc.ca_address_sk WHERE ws.ws_list_price BETWEEN 86 AND 100 GROUP BY fd.d_qoy, fc.ca_county) SELECT ss_q1.ca_county, 1998 AS d_year, CASE WHEN ws_q1.sales > 0 THEN ws_q2.sales / ws_q1.sales ELSE NULL END AS web_q1_q2_increase, CASE WHEN ss_q1.sales > 0 THEN ss_q2.sales / ss_q1.sales ELSE NULL END AS store_q1_q2_increase, CASE WHEN ws_q2.sales > 0 THEN ws_q3.sales / ws_q2.sales ELSE NULL END AS web_q2_q3_increase, CASE WHEN ss_q2.sales > 0 THEN ss_q3.sales / ss_q2.sales ELSE NULL END AS store_q2_q3_increase FROM (SELECT ca_county, sales FROM store_aggregates WHERE d_qoy = 1) ss_q1 INNER JOIN (SELECT ca_county, sales FROM store_aggregates WHERE d_qoy = 2) ss_q2 ON ss_q1.ca_county = ss_q2.ca_county INNER JOIN (SELECT ca_county, sales FROM store_aggregates WHERE d_qoy = 3) ss_q3 ON ss_q2.ca_county = ss_q3.ca_county INNER JOIN (SELECT ca_county, sales FROM web_aggregates WHERE d_qoy = 1) ws_q1 ON ss_q1.ca_county = ws_q1.ca_county INNER JOIN (SELECT ca_county, sales FROM web_aggregates WHERE d_qoy = 2) ws_q2 ON ws_q1.ca_county = ws_q2.ca_county INNER JOIN (SELECT ca_county, sales FROM web_aggregates WHERE d_qoy = 3) ws_q3 ON ws_q2.ca_county = ws_q3.ca_county WHERE CASE WHEN ws_q1.sales > 0 THEN ws_q2.sales / ws_q1.sales ELSE NULL END > CASE WHEN ss_q1.sales > 0 THEN ss_q2.sales / ss_q1.sales ELSE NULL END AND CASE WHEN ws_q2.sales > 0 THEN ws_q3.sales / ws_q2.sales ELSE NULL END > CASE WHEN ss_q2.sales > 0 THEN ss_q3.sales / ss_q2.sales ELSE NULL END ORDER BY 1998