WITH filtered_item AS (SELECT i_item_sk, i_category, i_class FROM item WHERE i_category = 'Electronics' AND i_class = 'personal'), filtered_date AS (SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE d_year = 1998 AND d_moy = 1), filtered_customer AS (SELECT c_customer_sk, c_current_addr_sk, c_birth_year FROM customer WHERE c_birth_year BETWEEN 1928 AND 1941), union_facts AS ((SELECT cs_sold_date_sk AS sold_date_sk, cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk FROM catalog_sales WHERE cs_wholesale_cost BETWEEN 35 AND 65 UNION ALL SELECT ws_sold_date_sk AS sold_date_sk, ws_bill_customer_sk AS customer_sk, ws_item_sk AS item_sk FROM web_sales WHERE ws_wholesale_cost BETWEEN 35 AND 65)), my_customers AS (SELECT DISTINCT filtered_customer.c_customer_sk, filtered_customer.c_current_addr_sk FROM filtered_date INNER JOIN union_facts ON union_facts.sold_date_sk = filtered_date.d_date_sk INNER JOIN filtered_item ON union_facts.item_sk = filtered_item.i_item_sk INNER JOIN filtered_customer ON union_facts.customer_sk = filtered_customer.c_customer_sk), my_revenue AS (SELECT my_customers.c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers INNER JOIN store_sales ON my_customers.c_customer_sk = store_sales.ss_customer_sk INNER JOIN customer_address ON my_customers.c_current_addr_sk = customer_address.ca_address_sk INNER JOIN store ON (customer_address.ca_county = store.s_county AND customer_address.ca_state = store.s_state) INNER JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk WHERE store_sales.ss_wholesale_cost BETWEEN 35 AND 65 AND store.s_state IN ('AR','CO','IA','IL','KY','NC','NM','NY','PA','TX') AND date_dim.d_month_seq BETWEEN (SELECT DISTINCT d_month_seq+1 FROM filtered_date) AND (SELECT DISTINCT d_month_seq+3 FROM filtered_date) GROUP BY my_customers.c_customer_sk), segments AS (SELECT CAST((revenue/50) AS INTEGER) AS segment FROM my_revenue) SELECT segment, COUNT(*) AS num_customers, segment*50 AS segment_base FROM segments GROUP BY segment ORDER BY segment, num_customers LIMIT 100