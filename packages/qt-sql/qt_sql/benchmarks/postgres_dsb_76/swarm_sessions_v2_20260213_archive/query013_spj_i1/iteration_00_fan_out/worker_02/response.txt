## Modified Logic Tree

```
QUERY: (single statement)
└── [MAIN] main_query  [~]  Cost: 100%  Rows: 1
    ├── WITH prefetched_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001)  [+]
    ├── WITH prefetched_household AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_dep_count IN (1, 3))  [+]
    ├── WITH prefetched_customer_demo AS (SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE (cd_marital_status = 'M' AND cd_education_status = '2 yr Degree') OR (cd_marital_status = 'U' AND cd_education_status = 'College') OR (cd_marital_status = 'S' AND cd_education_status = 'Unknown'))  [+]
    ├── WITH prefetched_customer_addr AS (SELECT ca_address_sk, ca_state FROM customer_address WHERE ca_country = 'United States' AND (ca_state IN ('CO', 'NC', 'TX') OR ca_state IN ('AR', 'NY', 'TX') OR ca_state IN ('IA', 'IL', 'NC')))  [+]
    ├── WITH prefetched_store AS (SELECT s_store_sk FROM store)  [+]
    ├── WITH joined_fact AS (SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost FROM store_sales INNER JOIN prefetched_dates ON ss_sold_date_sk = d_date_sk INNER JOIN prefetched_store ON ss_store_sk = s_store_sk INNER JOIN prefetched_household ON ss_hdemo_sk = hd_demo_sk INNER JOIN prefetched_customer_demo ON ss_cdemo_sk = cd_demo_sk INNER JOIN prefetched_customer_addr ON ss_addr_sk = ca_address_sk WHERE ((cd_marital_status = 'M' AND cd_education_status = '2 yr Degree' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3 AND ca_state IN ('CO', 'NC', 'TX') AND ss_net_profit BETWEEN 100 AND 200) OR (cd_marital_status = 'U' AND cd_education_status = 'College' AND ss_sales_price BETWEEN 50.00 AND 100.00 AND hd_dep_count = 1 AND ca_state IN ('AR', 'NY', 'TX') AND ss_net_profit BETWEEN 150 AND 300) OR (cd_marital_status = 'S' AND cd_education_status = 'Unknown' AND ss_sales_price BETWEEN 150.00 AND 200.00 AND hd_dep_count = 1 AND ca_state IN ('IA', 'IL', 'NC') AND ss_net_profit BETWEEN 50 AND 250))))  [+]
    └── OUTPUT (MIN(ss_quantity), MIN(ss_ext_sales_price), MIN(ss_ext_wholesale_cost), MIN(ss_ext_wholesale_cost)) [=]
```

## Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "postgresql",
  "rewrite_rules": [
    {"id": "R1", "type": "pg_dimension_prefetch_star", "description": "Pre-filter all selective dimension tables into CTEs to create tiny hash tables", "applied_to": ["prefetched_dates", "prefetched_household", "prefetched_customer_demo", "prefetched_customer_addr", "prefetched_store"]},
    {"id": "R2", "type": "explicit_join_syntax", "description": "Convert comma-separated implicit joins to explicit INNER JOIN syntax", "applied_to": ["joined_fact"]},
    {"id": "R3", "type": "or_preservation", "description": "Preserve original OR logic in WHERE clause to avoid UNION ALL explosion", "applied_to": ["joined_fact"]}
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "prefetched_dates": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT d_date_sk FROM date_dim WHERE d_year = 2001",
        "interfaces": {"outputs": ["d_date_sk"], "consumes": []}
      },
      "prefetched_household": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT hd_demo_sk FROM household_demographics WHERE hd_dep_count IN (1, 3)",
        "interfaces": {"outputs": ["hd_demo_sk"], "consumes": []}
      },
      "prefetched_customer_demo": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE (cd_marital_status = 'M' AND cd_education_status = '2 yr Degree') OR (cd_marital_status = 'U' AND cd_education_status = 'College') OR (cd_marital_status = 'S' AND cd_education_status = 'Unknown')",
        "interfaces": {"outputs": ["cd_demo_sk", "cd_marital_status", "cd_education_status"], "consumes": []}
      },
      "prefetched_customer_addr": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT ca_address_sk, ca_state FROM customer_address WHERE ca_country = 'United States' AND (ca_state IN ('CO', 'NC', 'TX') OR ca_state IN ('AR', 'NY', 'TX') OR ca_state IN ('IA', 'IL', 'NC'))",
        "interfaces": {"outputs": ["ca_address_sk", "ca_state"], "consumes": []}
      },
      "prefetched_store": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT s_store_sk FROM store",
        "interfaces": {"outputs": ["s_store_sk"], "consumes": []}
      },
      "joined_fact": {
        "type": "cte",
        "change": "added",
        "sql": "SELECT ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost FROM store_sales INNER JOIN prefetched_dates ON ss_sold_date_sk = d_date_sk INNER JOIN prefetched_store ON ss_store_sk = s_store_sk INNER JOIN prefetched_household ON ss_hdemo_sk = hd_demo_sk INNER JOIN prefetched_customer_demo ON ss_cdemo_sk = cd_demo_sk INNER JOIN prefetched_customer_addr ON ss_addr_sk = ca_address_sk WHERE ((cd_marital_status = 'M' AND cd_education_status = '2 yr Degree' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3 AND ca_state IN ('CO', 'NC', 'TX') AND ss_net_profit BETWEEN 100 AND 200) OR (cd_marital_status = 'U' AND cd_education_status = 'College' AND ss_sales_price BETWEEN 50.00 AND 100.00 AND hd_dep_count = 1 AND ca_state IN ('AR', 'NY', 'TX') AND ss_net_profit BETWEEN 150 AND 300) OR (cd_marital_status = 'S' AND cd_education_status = 'Unknown' AND ss_sales_price BETWEEN 150.00 AND 200.00 AND hd_dep_count = 1 AND ca_state IN ('IA', 'IL', 'NC') AND ss_net_profit BETWEEN 50 AND 250))",
        "interfaces": {"outputs": ["ss_quantity", "ss_ext_sales_price", "ss_ext_wholesale_cost"], "consumes": ["prefetched_dates", "prefetched_store", "prefetched_household", "prefetched_customer_demo", "prefetched_customer_addr"]}
      },
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT MIN(ss_quantity), MIN(ss_ext_sales_price), MIN(ss_ext_wholesale_cost), MIN(ss_ext_wholesale_cost) FROM joined_fact",
        "interfaces": {"outputs": ["MIN(ss_quantity)", "MIN(ss_ext_sales_price)", "MIN(ss_ext_wholesale_cost)", "MIN(ss_ext_wholesale_cost)"], "consumes": ["joined_fact"]}
      }
    },
    "reconstruction_order": ["prefetched_dates", "prefetched_household", "prefetched_customer_demo", "prefetched_customer_addr", "prefetched_store", "joined_fact", "main_query"],
    "assembly_template": "WITH prefetched_dates AS ({prefetched_dates}), prefetched_household AS ({prefetched_household}), prefetched_customer_demo AS ({prefetched_customer_demo}), prefetched_customer_addr AS ({prefetched_customer_addr}), prefetched_store AS ({prefetched_store}), joined_fact AS ({joined_fact}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "runtime_config": [
    "SET LOCAL enable_hashjoin = on",
    "SET LOCAL enable_nestloop = off",
    "SET LOCAL work_mem = '32MB'",
    "SET LOCAL hash_mem_multiplier = 2.0"
  ],
  "validation_checks": []
}
```

**Changes**: Replaced comma-separated implicit joins with explicit INNER JOIN syntax and pre-filtered all dimension tables into CTEs, creating small hash tables that PostgreSQL can join efficiently. The OR logic is preserved exactly as in the original WHERE clause to avoid UNION ALL explosion.

**Expected speedup**: ~3.0x due to better hash join planning with pre-materialized small dimension results and explicit join syntax.