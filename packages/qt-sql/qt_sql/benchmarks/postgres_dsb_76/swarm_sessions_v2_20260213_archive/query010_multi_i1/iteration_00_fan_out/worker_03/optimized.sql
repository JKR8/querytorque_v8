WITH filtered_store_sales_cte AS NOT MATERIALIZED (SELECT ss.ss_customer_sk FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk WHERE d.d_year = 1999 AND d.d_moy BETWEEN 8 AND 11 AND i.i_category IN ('Children', 'Electronics', 'Music') AND i.i_manager_id BETWEEN 66 AND 75 AND CASE WHEN ss.ss_list_price > 0 THEN ss.ss_sales_price / ss.ss_list_price BETWEEN 20 * 0.01 AND 30 * 0.01 END), filtered_web_sales_cte AS NOT MATERIALIZED (SELECT ws.ws_bill_customer_sk FROM web_sales ws JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk WHERE d.d_year = 1999 AND d.d_moy BETWEEN 8 AND 11 AND i.i_category IN ('Children', 'Electronics', 'Music') AND i.i_manager_id BETWEEN 66 AND 75 AND CASE WHEN ws.ws_list_price > 0 THEN ws.ws_sales_price / ws.ws_list_price BETWEEN 20 * 0.01 AND 30 * 0.01 END), filtered_catalog_sales_cte AS NOT MATERIALIZED (SELECT cs.cs_ship_customer_sk FROM catalog_sales cs JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk WHERE d.d_year = 1999 AND d.d_moy BETWEEN 8 AND 11 AND i.i_category IN ('Children', 'Electronics', 'Music') AND i.i_manager_id BETWEEN 66 AND 75 AND CASE WHEN cs.cs_list_price > 0 THEN cs.cs_sales_price / cs.cs_list_price BETWEEN 20 * 0.01 AND 30 * 0.01 END), customer_join_cte AS NOT MATERIALIZED (SELECT c.c_current_addr_sk, c.c_current_cdemo_sk FROM customer c INNER JOIN filtered_store_sales_cte ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN filtered_web_sales_cte ws ON c.c_customer_sk = ws.ws_bill_customer_sk LEFT JOIN filtered_catalog_sales_cte cs ON c.c_customer_sk = cs.cs_ship_customer_sk WHERE c.c_birth_month IN (1, 5) AND (ws.ws_bill_customer_sk IS NOT NULL OR cs.cs_ship_customer_sk IS NOT NULL)) SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(*) AS cnt1, cd.cd_purchase_estimate, COUNT(*) AS cnt2, cd.cd_credit_rating, COUNT(*) AS cnt3, cd.cd_dep_count, COUNT(*) AS cnt4, cd.cd_dep_employed_count, COUNT(*) AS cnt5, cd.cd_dep_college_count, COUNT(*) AS cnt6 FROM customer_join_cte cjc INNER JOIN customer_address ca ON cjc.c_current_addr_sk = ca.ca_address_sk INNER JOIN customer_demographics cd ON cjc.c_current_cdemo_sk = cd.cd_demo_sk WHERE ca.ca_county IN ('Grays Harbor County', 'Kootenai County', 'Pike County', 'Thomas County', 'Uinta County') AND cd.cd_marital_status IN ('U', 'M') AND cd.cd_education_status IN ('College', 'Primary', '2 yr Degree') AND cd.cd_gender = 'M' GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, cd.cd_dep_count, cd.cd_dep_employed_count, cd.cd_dep_college_count ORDER BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, cd.cd_dep_count, cd.cd_dep_employed_count, cd.cd_dep_college_count LIMIT 100