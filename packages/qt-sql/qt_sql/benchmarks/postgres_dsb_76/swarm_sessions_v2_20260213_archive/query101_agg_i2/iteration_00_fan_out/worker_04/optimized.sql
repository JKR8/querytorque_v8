WITH filtered_d1 AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2000), date_range AS (SELECT d1.d_date_sk AS d1_date_sk, d1.d_date AS d1_date, d2.d_date_sk AS d2_date_sk FROM date_dim d2 CROSS JOIN filtered_d1 d1 WHERE d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 day')), unified_facts AS (SELECT ss.ss_customer_sk FROM store_sales ss INNER JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk INNER JOIN web_sales ws ON sr.sr_item_sk = ws.ws_item_sk AND ss.ss_customer_sk = ws.ws_bill_customer_sk INNER JOIN item i ON ss.ss_item_sk = i.i_item_sk INNER JOIN date_range dr ON sr.sr_returned_date_sk = dr.d1_date_sk AND ws.ws_sold_date_sk = dr.d2_date_sk WHERE i.i_category IN ('Children', 'Home', 'Women') AND ss.ss_sales_price / ss.ss_list_price BETWEEN 76 * 0.01 AND 96 * 0.01), conditional_aggregation AS (SELECT ss_customer_sk, COUNT(*) AS cnt FROM unified_facts GROUP BY ss_customer_sk), customer_dimensions AS (SELECT c.c_customer_sk, c.c_first_name, c.c_last_name, ca.cnt FROM conditional_aggregation ca INNER JOIN customer c ON ca.ss_customer_sk = c.c_customer_sk INNER JOIN customer_address ca_addr ON c.c_current_addr_sk = ca_addr.ca_address_sk INNER JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE ca_addr.ca_state IN ('AR', 'GA', 'IN', 'KY', 'VA') AND hd.hd_income_band_sk BETWEEN 8 AND 14 AND hd.hd_buy_potential = '501-1000') SELECT c_customer_sk, c_first_name, c_last_name, cnt FROM customer_dimensions ORDER BY cnt