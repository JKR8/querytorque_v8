WITH branch1_filtered_demographics AS (SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE cd_marital_status = 'M' AND cd_education_status = 'Unknown'), branch1_customer AS (SELECT c.c_customer_sk FROM customer c INNER JOIN customer_address ca ON ca.ca_address_sk = c.c_current_addr_sk AND ca.ca_gmt_offset = -6 INNER JOIN branch1_filtered_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk INNER JOIN household_demographics hd ON hd.hd_demo_sk = c.c_current_hdemo_sk AND hd.hd_buy_potential LIKE '>10000%'), branch1_join AS (SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_manager, cd.cd_marital_status, cd.cd_education_status, cr.cr_net_loss FROM catalog_returns cr INNER JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk AND d.d_year = 2001 AND d.d_moy = 12 INNER JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk INNER JOIN branch1_customer c ON cr.cr_returning_customer_sk = c.c_customer_sk INNER JOIN branch1_filtered_demographics cd ON c.c_customer_sk IS NOT NULL), branch2_filtered_demographics AS (SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree'), branch2_customer AS (SELECT c.c_customer_sk FROM customer c INNER JOIN customer_address ca ON ca.ca_address_sk = c.c_current_addr_sk AND ca.ca_gmt_offset = -6 INNER JOIN branch2_filtered_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk INNER JOIN household_demographics hd ON hd.hd_demo_sk = c.c_current_hdemo_sk AND hd.hd_buy_potential LIKE '>10000%'), branch2_join AS (SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_manager, cd.cd_marital_status, cd.cd_education_status, cr.cr_net_loss FROM catalog_returns cr INNER JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk AND d.d_year = 2001 AND d.d_moy = 12 INNER JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk INNER JOIN branch2_customer c ON cr.cr_returning_customer_sk = c.c_customer_sk INNER JOIN branch2_filtered_demographics cd ON c.c_customer_sk IS NOT NULL), union_all AS (SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, cr_net_loss FROM branch1_join UNION ALL SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, cr_net_loss FROM branch2_join), aggregation AS (SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, SUM(cr_net_loss) AS Returns_Loss FROM union_all GROUP BY cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status) SELECT cc_call_center_id AS Call_Center, cc_name AS Call_Center_Name, cc_manager AS Manager, Returns_Loss FROM aggregation ORDER BY Returns_Loss DESC