### Part 1: Modified Logic Tree

```
QUERY: (transformed to CTE-based UNION ALL)
└── [MAIN] main_query [!] Structural change: OR → UNION ALL with branch separation
    ├── WITH CTEs [!]
    │   ├── branch1_filtered_demographics [=]
    │   ├── branch1_customer [=]
    │   ├── branch1_join [=]
    │   ├── branch2_filtered_demographics [=]
    │   ├── branch2_customer [=]
    │   ├── branch2_join [=]
    │   ├── union_all [!] New component combining both branches
    │   ├── aggregation [=]
    │   └── sort [=]
    ├── JOIN (implicit) → explicit INNER JOINs in branch joins
    ├── FILTER (OR condition) → split into two separate branches
    ├── AGG (GROUP BY) [=]
    ├── SORT (SUM(cr_net_loss) DESC) [=]
    └── OUTPUT (Call_Center, Call_Center_Name, Manager, Returns_Loss)
```

### Part 2: Component Payload JSON

```json
{
  "spec_version": "1.0",
  "dialect": "postgresql",
  "rewrite_rules": [
    {"id": "R1", "type": "or_to_union_all", "description": "Split OR condition on customer_demographics into separate CTE branches", "applied_to": ["branch1_filtered_demographics", "branch2_filtered_demographics"]},
    {"id": "R2", "type": "explicit_joins", "description": "Convert implicit comma joins to explicit INNER JOIN syntax", "applied_to": ["branch1_customer", "branch2_customer", "branch1_join", "branch2_join"]},
    {"id": "R3", "type": "cte_extraction", "description": "Extract query plan into explicit CTE structure matching Target Logical Tree", "applied_to": ["branch1_filtered_demographics", "branch1_customer", "branch1_join", "branch2_filtered_demographics", "branch2_customer", "branch2_join", "union_all", "aggregation", "sort"]}
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "branch1_filtered_demographics": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE cd_marital_status = 'M' AND cd_education_status = 'Unknown'",
        "interfaces": {"outputs": ["cd_demo_sk", "cd_marital_status", "cd_education_status"], "consumes": []}
      },
      "branch1_customer": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT c.c_customer_sk FROM customer c INNER JOIN customer_address ca ON ca.ca_address_sk = c.c_current_addr_sk AND ca.ca_gmt_offset = -6 INNER JOIN branch1_filtered_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk INNER JOIN household_demographics hd ON hd.hd_demo_sk = c.c_current_hdemo_sk AND hd.hd_buy_potential LIKE '>10000%'",
        "interfaces": {"outputs": ["c_customer_sk"], "consumes": ["branch1_filtered_demographics"]}
      },
      "branch1_join": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_manager, cd.cd_marital_status, cd.cd_education_status, cr.cr_net_loss FROM catalog_returns cr INNER JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk AND d.d_year = 2001 AND d.d_moy = 12 INNER JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk INNER JOIN branch1_customer c ON cr.cr_returning_customer_sk = c.c_customer_sk INNER JOIN branch1_filtered_demographics cd ON c.c_customer_sk IS NOT NULL",
        "interfaces": {"outputs": ["cc_call_center_id", "cc_name", "cc_manager", "cd_marital_status", "cd_education_status", "cr_net_loss"], "consumes": ["branch1_customer", "branch1_filtered_demographics"]}
      },
      "branch2_filtered_demographics": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT cd_demo_sk, cd_marital_status, cd_education_status FROM customer_demographics WHERE cd_marital_status = 'W' AND cd_education_status = 'Advanced Degree'",
        "interfaces": {"outputs": ["cd_demo_sk", "cd_marital_status", "cd_education_status"], "consumes": []}
      },
      "branch2_customer": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT c.c_customer_sk FROM customer c INNER JOIN customer_address ca ON ca.ca_address_sk = c.c_current_addr_sk AND ca.ca_gmt_offset = -6 INNER JOIN branch2_filtered_demographics cd ON cd.cd_demo_sk = c.c_current_cdemo_sk INNER JOIN household_demographics hd ON hd.hd_demo_sk = c.c_current_hdemo_sk AND hd.hd_buy_potential LIKE '>10000%'",
        "interfaces": {"outputs": ["c_customer_sk"], "consumes": ["branch2_filtered_demographics"]}
      },
      "branch2_join": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_manager, cd.cd_marital_status, cd.cd_education_status, cr.cr_net_loss FROM catalog_returns cr INNER JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk AND d.d_year = 2001 AND d.d_moy = 12 INNER JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk INNER JOIN branch2_customer c ON cr.cr_returning_customer_sk = c.c_customer_sk INNER JOIN branch2_filtered_demographics cd ON c.c_customer_sk IS NOT NULL",
        "interfaces": {"outputs": ["cc_call_center_id", "cc_name", "cc_manager", "cd_marital_status", "cd_education_status", "cr_net_loss"], "consumes": ["branch2_customer", "branch2_filtered_demographics"]}
      },
      "union_all": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, cr_net_loss FROM branch1_join UNION ALL SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, cr_net_loss FROM branch2_join",
        "interfaces": {"outputs": ["cc_call_center_id", "cc_name", "cc_manager", "cd_marital_status", "cd_education_status", "cr_net_loss"], "consumes": ["branch1_join", "branch2_join"]}
      },
      "aggregation": {
        "type": "cte",
        "change": "modified",
        "sql": "SELECT cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status, SUM(cr_net_loss) AS Returns_Loss FROM union_all GROUP BY cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status",
        "interfaces": {"outputs": ["cc_call_center_id", "cc_name", "cc_manager", "cd_marital_status", "cd_education_status", "Returns_Loss"], "consumes": ["union_all"]}
      },
      "sort": {
        "type": "cte",
        "change": "unchanged",
        "sql": "",
        "interfaces": {"outputs": [], "consumes": []}
      },
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT cc_call_center_id AS Call_Center, cc_name AS Call_Center_Name, cc_manager AS Manager, Returns_Loss FROM aggregation ORDER BY Returns_Loss DESC",
        "interfaces": {"outputs": ["Call_Center", "Call_Center_Name", "Manager", "Returns_Loss"], "consumes": ["aggregation"]}
      }
    },
    "reconstruction_order": ["branch1_filtered_demographics", "branch1_customer", "branch1_join", "branch2_filtered_demographics", "branch2_customer", "branch2_join", "union_all", "aggregation", "main_query"],
    "assembly_template": "WITH branch1_filtered_demographics AS ({branch1_filtered_demographics}), branch1_customer AS ({branch1_customer}), branch1_join AS ({branch1_join}), branch2_filtered_demographics AS ({branch2_filtered_demographics}), branch2_customer AS ({branch2_customer}), branch2_join AS ({branch2_join}), union_all AS ({union_all}), aggregation AS ({aggregation}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "runtime_config": [],
  "validation_checks": []
}
```

**Changes**: Converted the OR condition into separate UNION ALL branches with explicit CTE structure, replacing implicit comma joins with explicit INNER JOIN syntax while preserving exact semantic equivalence.

**Expected speedup**: Moderate (5-15%) due to better join reordering opportunities, elimination of OR predicate evaluation overhead, and potential for parallel branch execution.