WITH date_pairs AS (SELECT d1.d_date_sk AS d1_date_sk, d2.d_date_sk AS d2_date_sk, d2.d_date AS d2_date FROM date_dim d1 CROSS JOIN date_dim d2 WHERE d2.d_year = 1999 AND d2.d_moy = 7 AND d1.d_date BETWEEN (d2.d_date - INTERVAL '120 DAY') AND d2.d_date), store_returns_filtered AS (SELECT sr.sr_item_sk, sr.sr_ticket_number, sr.sr_customer_sk, sr.sr_returned_date_sk, dp.d1_date_sk, dp.d2_date FROM store_returns sr JOIN date_pairs dp ON sr.sr_returned_date_sk = dp.d2_date_sk), sales_returns_joined AS (SELECT ss.ss_store_sk, ss.ss_sold_date_sk, srf.sr_returned_date_sk, (srf.sr_returned_date_sk - ss.ss_sold_date_sk) AS return_delay FROM store_sales ss JOIN store_returns_filtered srf ON ss.ss_item_sk = srf.sr_item_sk AND ss.ss_ticket_number = srf.sr_ticket_number AND ss.ss_customer_sk = srf.sr_customer_sk AND ss.ss_sold_date_sk = srf.d1_date_sk), store_joined AS (SELECT s.s_store_name, s.s_company_id, s.s_street_number, s.s_street_name, s.s_street_type, s.s_suite_number, s.s_city, s.s_county, s.s_state, s.s_zip, srj.return_delay FROM sales_returns_joined srj JOIN store s ON srj.ss_store_sk = s.s_store_sk) SELECT s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip, SUM(CASE WHEN return_delay <= 30 THEN 1 ELSE 0 END) AS "30 days", SUM(CASE WHEN return_delay > 30 AND return_delay <= 60 THEN 1 ELSE 0 END) AS "31-60 days", SUM(CASE WHEN return_delay > 60 AND return_delay <= 90 THEN 1 ELSE 0 END) AS "61-90 days", SUM(CASE WHEN return_delay > 90 AND return_delay <= 120 THEN 1 ELSE 0 END) AS "91-120 days", SUM(CASE WHEN return_delay > 120 THEN 1 ELSE 0 END) AS ">120 days" FROM store_joined GROUP BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip ORDER BY s_store_name, s_company_id, s_street_number, s_street_name, s_street_type, s_suite_number, s_city, s_county, s_state, s_zip LIMIT 100