WITH filtered_item AS (SELECT i_item_sk FROM item WHERE i_category IN ('Children', 'Jewelry', 'Men') AND i_manager_id IN (21, 22, 38, 39, 46, 47, 66, 67, 74, 93)), filtered_dates AS (SELECT d1.d_date_sk, d1.d_date, d2.d_date_sk FROM date_dim d1 JOIN date_dim d2 ON d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 DAY') WHERE d1.d_year = 2001), filtered_customer AS (SELECT c_customer_sk, cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count FROM customer JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ca_state IN ('AZ', 'KS', 'OH', 'TX', 'WA')), filtered_warehouse_store AS (SELECT w_warehouse_sk, w_state FROM warehouse JOIN store ON s_state = w_state), fact_join AS (SELECT fc.cd_gender, fc.cd_marital_status, fc.cd_education_status, fc.hd_vehicle_count FROM web_sales ws JOIN filtered_item fi ON ws.ws_item_sk = fi.i_item_sk JOIN filtered_customer fc ON ws.ws_bill_customer_sk = fc.c_customer_sk JOIN filtered_dates fd ON ws.ws_sold_date_sk = fd.d_date_sk JOIN store_sales ss ON ss.ss_item_sk = fi.i_item_sk AND ss.ss_customer_sk = fc.c_customer_sk JOIN inventory inv ON inv.inv_item_sk = ss.ss_item_sk AND inv.inv_date_sk = ss.ss_sold_date_sk AND inv.inv_warehouse_sk = ws.ws_warehouse_sk JOIN filtered_warehouse_store fws ON ws.ws_warehouse_sk = fws.w_warehouse_sk WHERE ws.ws_wholesale_cost BETWEEN 35 AND 55 AND inv.inv_quantity_on_hand >= ss.ss_quantity AND ss.ss_sold_date_sk = fd.d_date_sk), aggregation AS (SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, COUNT(*) AS cnt FROM fact_join GROUP BY cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count) SELECT cd_gender, cd_marital_status, cd_education_status, hd_vehicle_count, cnt FROM aggregation ORDER BY cnt