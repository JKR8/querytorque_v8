### Part 1: Modified Logic Tree
```
QUERY: (single statement)
└── [MAIN] main_query  [~]  Cost: 100%  Rows: ~1
    ├── [~] WITH multi_warehouse_orders_cte AS (SELECT ws_order_number FROM web_sales GROUP BY ws_order_number HAVING COUNT(DISTINCT ws_warehouse_sk) > 1)
    ├── [~] WITH filtered_ws1 AS (SELECT ws_order_number, ws_ext_ship_cost, ws_net_profit FROM web_sales ws1, date_dim, customer_address, web_site WHERE d_date BETWEEN '2002-9-01' AND CAST('2002-9-01' AS DATE) + INTERVAL '60 DAY' AND ws1.ws_ship_date_sk = d_date_sk AND ws1.ws_ship_addr_sk = ca_address_sk AND ca_state IN ('CA','MI','OH','SD','TX','VA') AND ws1.ws_web_site_sk = web_site_sk AND web_gmt_offset >= -5 AND ws1.ws_list_price BETWEEN 237 AND 266 AND NOT EXISTS (SELECT 1 FROM web_returns wr1 WHERE wr1.wr_order_number = ws1.ws_order_number AND wr1.wr_reason_sk IN (7,25,26,52,69)))
    ├── [~] WITH join_multi AS (SELECT f.ws_order_number, f.ws_ext_ship_cost, f.ws_net_profit FROM filtered_ws1 f INNER JOIN multi_warehouse_orders_cte m ON f.ws_order_number = m.ws_order_number)
    ├── [~] SCAN (join_multi) [instead of base tables]
    ├── [~] FILTER (multi_warehouse condition now enforced via CTE join)
    ├── [~] AGGREGATE (COUNT(DISTINCT ws_order_number), SUM(ws_ext_ship_cost), SUM(ws_net_profit))
    └── OUTPUT (order count, total shipping cost, total net profit)
```

### Part 2: Component Payload JSON
```json
{
  "spec_version": "1.0",
  "dialect": "postgresql",
  "rewrite_rules": [
    {"id": "R1", "type": "cte_decomposition", "description": "Decomposed original self-join pattern into explicit CTEs: multi_warehouse_orders_cte, filtered_ws1, join_multi", "applied_to": ["multi_warehouse_orders_cte", "filtered_ws1", "join_multi", "main_query"]}
  ],
  "statements": [{
    "target_table": null,
    "change": "modified",
    "components": {
      "multi_warehouse_orders_cte": {
        "type": "cte",
        "change": "new",
        "sql": "SELECT ws_order_number FROM web_sales GROUP BY ws_order_number HAVING COUNT(DISTINCT ws_warehouse_sk) > 1",
        "interfaces": {"outputs": ["ws_order_number"], "consumes": []}
      },
      "filtered_ws1": {
        "type": "cte",
        "change": "new",
        "sql": "SELECT ws1.ws_order_number, ws1.ws_ext_ship_cost, ws1.ws_net_profit FROM web_sales ws1, date_dim, customer_address, web_site WHERE d_date BETWEEN '2002-9-01' AND CAST('2002-9-01' AS DATE) + INTERVAL '60 DAY' AND ws1.ws_ship_date_sk = date_dim.d_date_sk AND ws1.ws_ship_addr_sk = customer_address.ca_address_sk AND customer_address.ca_state IN ('CA','MI','OH','SD','TX','VA') AND ws1.ws_web_site_sk = web_site.web_site_sk AND web_site.web_gmt_offset >= -5 AND ws1.ws_list_price BETWEEN 237 AND 266 AND NOT EXISTS (SELECT 1 FROM web_returns wr1 WHERE wr1.wr_order_number = ws1.ws_order_number AND wr1.wr_reason_sk IN (7,25,26,52,69))",
        "interfaces": {"outputs": ["ws_order_number", "ws_ext_ship_cost", "ws_net_profit"], "consumes": []}
      },
      "join_multi": {
        "type": "cte",
        "change": "new",
        "sql": "SELECT filtered_ws1.ws_order_number, filtered_ws1.ws_ext_ship_cost, filtered_ws1.ws_net_profit FROM filtered_ws1 INNER JOIN multi_warehouse_orders_cte ON filtered_ws1.ws_order_number = multi_warehouse_orders_cte.ws_order_number",
        "interfaces": {"outputs": ["ws_order_number", "ws_ext_ship_cost", "ws_net_profit"], "consumes": ["multi_warehouse_orders_cte", "filtered_ws1"]}
      },
      "main_query": {
        "type": "main_query",
        "change": "modified",
        "sql": "SELECT COUNT(DISTINCT ws_order_number) AS \"order count\", SUM(ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws_net_profit) AS \"total net profit\" FROM join_multi ORDER BY COUNT(DISTINCT ws_order_number) LIMIT 100",
        "interfaces": {"outputs": ["order count", "total shipping cost", "total net profit"], "consumes": ["join_multi"]}
      }
    },
    "reconstruction_order": ["multi_warehouse_orders_cte", "filtered_ws1", "join_multi", "main_query"],
    "assembly_template": "WITH multi_warehouse_orders_cte AS ({multi_warehouse_orders_cte}), filtered_ws1 AS ({filtered_ws1}), join_multi AS ({join_multi}) {main_query}"
  }],
  "macros": {},
  "frozen_blocks": [],
  "runtime_config": [],
  "validation_checks": []
}
```

**Changes:** Structural decomposition into explicit CTEs following the target logical tree: (1) `multi_warehouse_orders_cte` isolates the multi-warehouse filter, (2) `filtered_ws1` applies date, state, price, GMT offset, and anti-join filters, (3) `join_multi` inner joins them to enforce both conditions, (4) main query aggregates from the pre-joined CTE.

**Expected speedup:** 2-4x due to materialization of multi-warehouse condition once, explicit anti-join preservation, and reduced join cardinality early filtering.