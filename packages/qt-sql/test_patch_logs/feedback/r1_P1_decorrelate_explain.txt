                                                                                                  QUERY PLAN                                                                                                   
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=62680.20..62680.20 rows=1 width=17) (actual time=479.015..479.051 rows=0 loops=1)
   Buffers: shared hit=804523 read=97721, temp read=582 written=583
   CTE customer_total_return
     ->  Finalize GroupAggregate  (cost=62623.82..62649.31 rows=197 width=44) (actual time=406.118..451.093 rows=95599 loops=1)
           Group Key: store_returns.sr_customer_sk, store_returns.sr_store_sk, store_returns.sr_reason_sk
           Buffers: shared hit=803308 read=97649, temp read=243 written=244
           ->  Gather Merge  (cost=62623.82..62644.80 rows=164 width=44) (actual time=406.111..421.655 rows=95661 loops=1)
                 Workers Planned: 2
                 Workers Launched: 2
                 Buffers: shared hit=803308 read=97649, temp read=243 written=244
                 ->  Partial GroupAggregate  (cost=61623.80..61625.85 rows=82 width=44) (actual time=233.683..245.889 rows=31887 loops=3)
                       Group Key: store_returns.sr_customer_sk, store_returns.sr_store_sk, store_returns.sr_reason_sk
                       Buffers: shared hit=803308 read=97649, temp read=243 written=244
                       ->  Sort  (cost=61623.80..61624.00 rows=82 width=18) (actual time=233.674..235.714 rows=31974 loops=3)
                             Sort Key: store_returns.sr_customer_sk, store_returns.sr_store_sk, store_returns.sr_reason_sk
                             Sort Method: quicksort  Memory: 1510kB
                             Buffers: shared hit=803308 read=97649, temp read=243 written=244
                             Worker 0:  Sort Method: quicksort  Memory: 1405kB
                             Worker 1:  Sort Method: external merge  Disk: 1944kB
                             ->  Nested Loop  (cost=0.72..61621.19 rows=82 width=18) (actual time=0.329..225.154 rows=31974 loops=3)
                                   Buffers: shared hit=803294 read=97649
                                   ->  Parallel Index Only Scan using _dta_index_date_dim_6_661577395__k1_k7_k9 on date_dim  (cost=0.29..1677.88 rows=172 width=4) (actual time=0.267..0.492 rows=122 loops=3)
                                         Index Cond: (d_year = 2002)
                                         Heap Fetches: 0
                                         Buffers: shared hit=4 read=280
                                   ->  Index Scan using _dta_index_store_returns_6_1013578649__k1_3_4_10 on store_returns  (cost=0.43..348.35 rows=16 width=22) (actual time=0.010..1.828 rows=263 loops=365)
                                         Index Cond: (sr_returned_date_sk = date_dim.d_date_sk)
                                         Filter: (((sr_return_amt / (sr_return_quantity)::numeric) >= '108'::numeric) AND ((sr_return_amt / (sr_return_quantity)::numeric) <= '167'::numeric))
                                         Rows Removed by Filter: 2612
                                         Buffers: shared hit=803290 read=97369
   ->  Sort  (cost=30.88..30.89 rows=1 width=17) (actual time=479.014..479.016 rows=0 loops=1)
         Sort Key: customer.c_customer_id
         Sort Method: quicksort  Memory: 25kB
         Buffers: shared hit=123890 read=14008, temp read=339 written=339
         ->  Nested Loop  (cost=10.86..30.87 rows=1 width=17) (actual time=479.003..479.005 rows=0 loops=1)
               Buffers: shared hit=123887 read=14008, temp read=339 written=339
               ->  Nested Loop  (cost=10.43..24.31 rows=1 width=21) (actual time=479.002..479.004 rows=0 loops=1)
                     Buffers: shared hit=123887 read=14008, temp read=339 written=339
                     ->  Nested Loop  (cost=10.01..15.86 rows=1 width=4) (actual time=478.489..478.786 rows=30 loops=1)
                           Join Filter: (ctr1.ctr_store_sk = store.s_store_sk)
                           Buffers: shared hit=123833 read=13942, temp read=339 written=339
                           ->  Hash Join  (cost=9.86..15.54 rows=1 width=12) (actual time=478.192..478.366 rows=582 loops=1)
                                 Hash Cond: (customer_total_return.ctr_store_sk = ctr1.ctr_store_sk)
                                 Join Filter: (ctr1.ctr_total_return > ((avg(customer_total_return.ctr_total_return) * 1.2)))
                                 Rows Removed by Join Filter: 1255
                                 Buffers: shared hit=122675 read=13936, temp read=339 written=339
                                 ->  HashAggregate  (cost=4.92..7.88 rows=197 width=36) (actual time=474.527..474.546 rows=52 loops=1)
                                       Group Key: customer_total_return.ctr_store_sk
                                       Batches: 1  Memory Usage: 64kB
                                       Buffers: shared hit=122675 read=13936, temp written=338
                                       ->  CTE Scan on customer_total_return  (cost=0.00..3.94 rows=197 width=36) (actual time=406.121..464.648 rows=95599 loops=1)
                                             Buffers: shared hit=122675 read=13936, temp written=338
                                 ->  Hash  (cost=4.93..4.93 rows=1 width=40) (actual time=3.655..3.655 rows=1837 loops=1)
                                       Buckets: 2048 (originally 1024)  Batches: 1 (originally 1)  Memory Usage: 101kB
                                       Buffers: temp read=339 written=1
                                       ->  CTE Scan on customer_total_return ctr1  (cost=0.00..4.93 rows=1 width=40) (actual time=0.008..3.503 rows=1845 loops=1)
                                             Filter: ((ctr_reason_sk >= 43) AND (ctr_reason_sk <= 46))
                                             Rows Removed by Filter: 93754
                                             Buffers: temp read=339 written=1
                           ->  Index Scan using _dta_index_store_6_885578193__k1_2_6 on store  (cost=0.14..0.31 rows=1 width=4) (actual time=0.000..0.000 rows=0 loops=582)
                                 Index Cond: (s_store_sk = customer_total_return.ctr_store_sk)
                                 Filter: (s_state = ANY ('{IL,KY,TX}'::bpchar[]))
                                 Rows Removed by Filter: 1
                                 Buffers: shared hit=1158 read=6
                     ->  Index Scan using _dta_index_customer_6_949578421__k1_k5 on customer  (cost=0.42..8.45 rows=1 width=25) (actual time=0.007..0.007 rows=0 loops=30)
                           Index Cond: (c_customer_sk = ctr1.ctr_customer_sk)
                           Filter: ((c_birth_year >= 1965) AND (c_birth_year <= 1971) AND (c_birth_month = 2))
                           Rows Removed by Filter: 1
                           Buffers: shared hit=54 read=66
               ->  Index Scan using customer_demographics_pkey on customer_demographics  (cost=0.43..6.56 rows=1 width=4) (never executed)
                     Index Cond: (cd_demo_sk = customer.c_current_cdemo_sk)
                     Filter: ((cd_marital_status = ANY ('{M,M}'::bpchar[])) AND (cd_education_status = ANY ('{"Advanced Degree",College}'::bpchar[])) AND (cd_gender = 'F'::bpchar))
 Planning:
   Buffers: shared hit=549 read=81
 Planning Time: 1.315 ms
 Execution Time: 479.521 ms
(76 rows)

