                                                                                                                QUERY PLAN                                                                                                                 
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=65285.90..65285.90 rows=1 width=17) (actual time=462.005..462.058 rows=100 loops=1)
   Buffers: shared hit=808060 read=98416
   CTE customer_total_return
     ->  GroupAggregate  (cost=65271.29..65271.39 rows=4 width=44) (actual time=313.481..314.066 rows=1845 loops=1)
           Group Key: store_returns.sr_customer_sk, store_returns.sr_store_sk, store_returns.sr_reason_sk
           Buffers: shared hit=804240 read=96706
           ->  Sort  (cost=65271.29..65271.30 rows=4 width=18) (actual time=313.472..313.576 rows=1845 loops=1)
                 Sort Key: store_returns.sr_customer_sk, store_returns.sr_store_sk, store_returns.sr_reason_sk
                 Sort Method: quicksort  Memory: 192kB
                 Buffers: shared hit=804240 read=96706
                 ->  Gather  (cost=1000.73..65271.25 rows=4 width=18) (actual time=1.205..312.761 rows=1845 loops=1)
                       Workers Planned: 2
                       Workers Launched: 2
                       Buffers: shared hit=804237 read=96706
                       ->  Nested Loop  (cost=0.72..64270.85 rows=2 width=18) (actual time=2.018..181.198 rows=615 loops=3)
                             Buffers: shared hit=804237 read=96706
                             ->  Parallel Index Only Scan using _dta_index_date_dim_6_661577395__k1_k7_k9 on date_dim  (cost=0.29..1677.88 rows=172 width=4) (actual time=0.250..0.460 rows=122 loops=3)
                                   Index Cond: (d_year = 2002)
                                   Heap Fetches: 0
                                   Buffers: shared hit=4 read=280
                             ->  Index Scan using _dta_index_store_returns_6_1013578649__k1_3_4_10 on store_returns  (cost=0.43..363.90 rows=1 width=22) (actual time=0.302..1.483 rows=5 loops=365)
                                   Index Cond: (sr_returned_date_sk = date_dim.d_date_sk)
                                   Filter: ((sr_reason_sk >= 43) AND (sr_reason_sk <= 46) AND ((sr_return_amt / (sr_return_quantity)::numeric) >= '108'::numeric) AND ((sr_return_amt / (sr_return_quantity)::numeric) <= '167'::numeric))
                                   Rows Removed by Filter: 2869
                                   Buffers: shared hit=804233 read=96426
   ->  Sort  (cost=14.50..14.51 rows=1 width=17) (actual time=462.004..462.008 rows=100 loops=1)
         Sort Key: customer.c_customer_id
         Sort Method: top-N heapsort  Memory: 38kB
         Buffers: shared hit=808060 read=98416
         ->  Nested Loop  (cost=1.22..14.49 rows=1 width=17) (actual time=319.433..461.620 rows=598 loops=1)
               Buffers: shared hit=808057 read=98416
               ->  Nested Loop  (cost=0.79..14.01 rows=1 width=21) (actual time=319.114..382.181 rows=622 loops=1)
                     Buffers: shared hit=806849 read=97829
                     ->  Nested Loop  (cost=0.37..5.57 rows=1 width=4) (actual time=319.091..320.617 rows=622 loops=1)
                           Join Filter: (ctr1.ctr_store_sk = store.s_store_sk)
                           Buffers: shared hit=805478 read=96712
                           ->  Hash Join  (cost=0.23..0.40 rows=1 width=12) (actual time=314.698..315.484 rows=622 loops=1)
                                 Hash Cond: (customer_total_return.ctr_store_sk = ctr1.ctr_store_sk)
                                 Join Filter: (ctr1.ctr_total_return > ((avg(customer_total_return.ctr_total_return)) * 1.2))
                                 Rows Removed by Join Filter: 1215
                                 Buffers: shared hit=804240 read=96706
                                 ->  HashAggregate  (cost=0.10..0.15 rows=4 width=36) (actual time=0.234..0.321 rows=52 loops=1)
                                       Group Key: customer_total_return.ctr_store_sk
                                       Batches: 1  Memory Usage: 48kB
                                       ->  CTE Scan on customer_total_return  (cost=0.00..0.08 rows=4 width=36) (actual time=0.000..0.058 rows=1845 loops=1)
                                 ->  Hash  (cost=0.08..0.08 rows=4 width=40) (actual time=314.455..314.455 rows=1837 loops=1)
                                       Buckets: 2048 (originally 1024)  Batches: 1 (originally 1)  Memory Usage: 101kB
                                       Buffers: shared hit=804240 read=96706
                                       ->  CTE Scan on customer_total_return ctr1  (cost=0.00..0.08 rows=4 width=40) (actual time=313.483..314.293 rows=1845 loops=1)
                                             Buffers: shared hit=804240 read=96706
                           ->  Index Only Scan using _dta_index_store_6_885578193__k1_2_6 on store  (cost=0.14..5.16 rows=1 width=4) (actual time=0.008..0.008 rows=1 loops=622)
                                 Index Cond: (s_store_sk = customer_total_return.ctr_store_sk)
                                 Heap Fetches: 622
                                 Buffers: shared hit=1238 read=6
                     ->  Index Scan using _dta_index_customer_6_949578421__k1_k5 on customer  (cost=0.42..8.44 rows=1 width=25) (actual time=0.099..0.099 rows=1 loops=622)
                           Index Cond: (c_customer_sk = ctr1.ctr_customer_sk)
                           Buffers: shared hit=1371 read=1117
               ->  Index Only Scan using customer_demographics_pkey on customer_demographics  (cost=0.43..0.49 rows=1 width=4) (actual time=0.127..0.127 rows=1 loops=622)
                     Index Cond: (cd_demo_sk = customer.c_current_cdemo_sk)
                     Heap Fetches: 0
                     Buffers: shared hit=1208 read=587
 Planning:
   Buffers: shared hit=535 read=80
 Planning Time: 1.129 ms
 Execution Time: 462.195 ms
(65 rows)

