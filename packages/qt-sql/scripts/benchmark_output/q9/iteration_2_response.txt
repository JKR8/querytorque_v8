Looking at this query, I can see it has multiple repeated subqueries on `store_sales` with different quantity ranges. Each bucket requires computing `COUNT(*)`, `AVG(ss_ext_sales_price)`, and `AVG(ss_net_profit)` for the same quantity range. This results in 15 scans of `store_sales` (as shown in the execution plan).

The opportunity is to materialize the common computations for each quantity range once, then reference them multiple times.

```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "materialize_cte",
      "nodes": {
        "quantity_1_20_stats": "SELECT COUNT(*) as cnt, AVG(ss_ext_sales_price) as avg_ext_price, AVG(ss_net_profit) as avg_net_profit FROM store_sales WHERE ss_quantity BETWEEN 1 AND 20",
        "quantity_21_40_stats": "SELECT COUNT(*) as cnt, AVG(ss_ext_sales_price) as avg_ext_price, AVG(ss_net_profit) as avg_net_profit FROM store_sales WHERE ss_quantity BETWEEN 21 AND 40",
        "quantity_41_60_stats": "SELECT COUNT(*) as cnt, AVG(ss_ext_sales_price) as avg_ext_price, AVG(ss_net_profit) as avg_net_profit FROM store_sales WHERE ss_quantity BETWEEN 41 AND 60",
        "quantity_61_80_stats": "SELECT COUNT(*) as cnt, AVG(ss_ext_sales_price) as avg_ext_price, AVG(ss_net_profit) as avg_net_profit FROM store_sales WHERE ss_quantity BETWEEN 61 AND 80",
        "quantity_81_100_stats": "SELECT COUNT(*) as cnt, AVG(ss_ext_sales_price) as avg_ext_price, AVG(ss_net_profit) as avg_net_profit FROM store_sales WHERE ss_quantity BETWEEN 81 AND 100",
        "main_query": "SELECT CASE WHEN q1.cnt > 2972190 THEN q1.avg_ext_price ELSE q1.avg_net_profit END AS bucket1, CASE WHEN q2.cnt > 4505785 THEN q2.avg_ext_price ELSE q2.avg_net_profit END AS bucket2, CASE WHEN q3.cnt > 1575726 THEN q3.avg_ext_price ELSE q3.avg_net_profit END AS bucket3, CASE WHEN q4.cnt > 3188917 THEN q4.avg_ext_price ELSE q4.avg_net_profit END AS bucket4, CASE WHEN q5.cnt > 3525216 THEN q5.avg_ext_price ELSE q5.avg_net_profit END AS bucket5 FROM reason CROSS JOIN quantity_1_20_stats q1 CROSS JOIN quantity_21_40_stats q2 CROSS JOIN quantity_41_60_stats q3 CROSS JOIN quantity_61_80_stats q4 CROSS JOIN quantity_81_100_stats q5 WHERE r_reason_sk = 1"
      },
      "invariants_kept": [
        "same result rows",
        "same columns",
        "same aggregation results"
      ],
      "expected_speedup": "3.0x",
      "risk": "low"
    }
  ],
  "explanation": "The original query scans store_sales 15 times (3 metrics × 5 buckets). This rewrite materializes the statistics for each quantity range once, computing all three metrics in a single scan per bucket. The CTEs compute COUNT, AVG(ss_ext_sales_price), and AVG(ss_net_profit) simultaneously. The main query then references these precomputed values via CROSS JOINs (safe since reason has exactly 1 row with r_reason_sk=1). This reduces store_sales scans from 15 to 5, a 3× reduction in I/O."
}
```