WITH date_range AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2002-4-01' AND (CAST('2002-4-01' AS DATE) + INTERVAL '60' DAY)), multi_warehouse_orders AS (SELECT cs_order_number FROM catalog_sales GROUP BY cs_order_number HAVING COUNT(DISTINCT cs_warehouse_sk) > 1), non_returned_orders AS (SELECT cr_order_number FROM catalog_returns)
SELECT COUNT(DISTINCT cs1.cs_order_number) AS "order count", SUM(cs1.cs_ext_ship_cost) AS "total shipping cost", SUM(cs1.cs_net_profit) AS "total net profit" FROM catalog_sales AS cs1 JOIN date_range AS dr ON cs1.cs_ship_date_sk = dr.d_date_sk JOIN customer_address ON cs1.cs_ship_addr_sk = ca_address_sk JOIN call_center ON cs1.cs_call_center_sk = cc_call_center_sk JOIN multi_warehouse_orders AS mwo ON cs1.cs_order_number = mwo.cs_order_number LEFT JOIN non_returned_orders AS nro ON cs1.cs_order_number = nro.cr_order_number WHERE ca_state = 'WV' AND cc_county IN ('Ziebach County', 'Luce County', 'Richland County', 'Daviess County', 'Barrow County') AND nro.cr_order_number IS NULL ORDER BY COUNT(DISTINCT cs1.cs_order_number) LIMIT 100