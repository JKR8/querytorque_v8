Looking at the query and execution plan, I notice the main issue is the complex OR conditions in the WHERE clause that are preventing effective predicate pushdown and join ordering. The query has two sets of OR conditions that are ANDed together, creating a cartesian explosion of possibilities for the optimizer.

Let me use **or_to_union** transform to break down the complex OR conditions into UNION ALL branches:

```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "or_to_union",
      "nodes": {
        "date_filtered_sales": "SELECT ss_sold_date_sk, ss_store_sk, ss_hdemo_sk, ss_cdemo_sk, ss_addr_sk, ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost, ss_sales_price, ss_net_profit FROM store_sales WHERE ss_sold_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_year = 2001)",
        
        "main_query": "SELECT AVG(ss_quantity) as avg_ss_quantity, AVG(ss_ext_sales_price) as avg_ss_ext_sales_price, AVG(ss_ext_wholesale_cost) as avg_ss_ext_wholesale_cost, SUM(ss_ext_wholesale_cost) as sum_ss_ext_wholesale_cost FROM (\n  -- Branch 1: First OR condition from both sets\n  SELECT s.ss_quantity, s.ss_ext_sales_price, s.ss_ext_wholesale_cost\n  FROM date_filtered_sales s\n  JOIN store st ON s.ss_store_sk = st.s_store_sk\n  JOIN household_demographics hd ON s.ss_hdemo_sk = hd.hd_demo_sk AND hd.hd_dep_count = 3\n  JOIN customer_demographics cd ON s.ss_cdemo_sk = cd.cd_demo_sk AND cd.cd_marital_status = 'D' AND cd.cd_education_status = 'Unknown'\n  JOIN customer_address ca ON s.ss_addr_sk = ca.ca_address_sk AND ca.ca_country = 'United States' AND ca.ca_state IN ('SD', 'KS', 'MI')\n  WHERE s.ss_sales_price BETWEEN 100.00 AND 150.00 AND s.ss_net_profit BETWEEN 100 AND 200\n  \n  UNION ALL\n  \n  -- Branch 2: First from set1, second from set2\n  SELECT s.ss_quantity, s.ss_ext_sales_price, s.ss_ext_wholesale_cost\n  FROM date_filtered_sales s\n  JOIN store st ON s.ss_store_sk = st.s_store_sk\n  JOIN household_demographics hd ON s.ss_hdemo_sk = hd.hd_demo_sk AND hd.hd_dep_count = 3\n  JOIN customer_demographics cd ON s.ss_cdemo_sk = cd.cd_demo_sk AND cd.cd_marital_status = 'D' AND cd.cd_education_status = 'Unknown'\n  JOIN customer_address ca ON s.ss_addr_sk = ca.ca_address_sk AND ca.ca_country = 'United States' AND ca.ca_state IN ('MO', 'ND', 'CO')\n  WHERE s.ss_sales_price BETWEEN 100.00 AND 150.00 AND s.ss_net_profit BETWEEN 150 AND 300\n  \n  UNION ALL\n  \n  -- Branch 3: First from set1, third from set2\n  SELECT s.ss_quantity, s.ss_ext_sales_price, s.ss_ext_wholesale_cost\n  FROM date_filtered_sales s\n  JOIN store st ON s.ss_store_sk = st.s_store_sk\n  JOIN household_demographics hd ON s.ss_hdemo_sk = hd.hd_demo_sk AND hd.hd_dep_count = 3\n  JOIN customer_demographics cd ON s.ss_cdemo_sk = cd.cd_demo_sk AND cd.cd_marital_status = 'D' AND cd.cd_education_status = 'Unknown'\n  JOIN customer_address ca ON s.ss_addr_sk = ca.ca_address_sk AND ca.ca_country = 'United States' AND ca.ca_state IN ('NH', 'OH', 'TX')\n  WHERE s.ss_sales_price BETWEEN 100.00 AND 150.00 AND s.ss_net_profit BETWEEN 50 AND 250\n  \n  UNION ALL\n  \n  -- Branch 4: Second from set1, first from set2\n  SELECT s.ss_quantity, s.ss_ext_sales_price, s.ss_ext_wholesale_cost\n  FROM date_filtered_sales s\n  JOIN store st ON s.ss_store_sk = st.s_store_sk\n  JOIN household_demographics hd ON s.ss_hdemo_sk = hd.hd_demo_sk AND hd.hd_dep_count = 1\n  JOIN customer_demographics cd ON s.ss_cdemo_sk = cd.cd_demo_sk AND cd.cd_marital_status = 'S' AND cd.cd_education_status = 'College'\n  JOIN customer_address ca ON s.ss_addr_sk = ca.ca_address_sk AND ca.ca_country = 'United States' AND ca.ca_state IN ('SD', 'KS', 'MI')\n  WHERE s.ss_sales_price BETWEEN 50.00 AND 100.00 AND s.ss_net_profit BETWEEN 100 AND 200\n  \n  UNION ALL\n  \n  -- Branch 5: Second from set1, second from set2\n  SELECT s.ss_quantity, s.ss_ext_sales_price, s.ss_ext_wholesale_cost\n  FROM date_filtered_sales s\n  JOIN store st ON s.ss_store_sk = st.s_store_sk\n  JOIN household_demographics hd ON s.ss_hdemo_sk = hd.hd_demo_sk AND hd.hd_dep_count = 1\n  JOIN customer_demographics cd ON s.ss_cdemo_sk = cd.cd_demo_sk AND cd.cd_marital_status = 'S' AND cd.cd_education_status = 'College'\n  JOIN customer_address ca ON s.ss_addr_sk = ca.ca_address_sk AND ca.ca_country = 'United States' AND ca.ca_state IN ('MO', 'ND', 'CO')\n  WHERE s.ss_sales_price BETWEEN 50.00 AND 100.00 AND s.ss_net_profit BETWEEN 150 AND 300\n  \n  UNION ALL\n  \n  -- Branch 6: Second from set1, third from set2\n  SELECT s.ss_quantity, s.ss_ext_sales_price, s.ss_ext_wholesale_cost\n  FROM date_filtered_sales s\n  JOIN store st ON s.ss_store_sk = st.s_store_sk\n  JOIN household_demographics hd ON s.ss_hdemo_sk = hd.hd_demo_sk AND hd.hd_dep_count = 1\n  JOIN customer_demographics cd ON s.ss_cdemo_sk = cd.cd_demo_sk AND cd.cd_marital_status = 'S' AND cd.cd_education_status = 'College'\n  JOIN customer_address ca ON s.ss_addr_sk = ca.ca_address_sk AND ca.ca_country = 'United States' AND ca.ca_state IN ('NH', 'OH', 'TX')\n  WHERE s.ss_sales_price BETWEEN 50.00 AND 100.00 AND s.ss_net_profit BETWEEN 50 AND 250\n  \n  UNION ALL\n  \n  -- Branch 7: Third from set1, first from set2\n  SELECT s.ss_quantity, s.ss_ext_sales_price, s.ss_ext_wholesale_cost\n  FROM date_filtered_sales s\n  JOIN store st ON s.ss_store_sk = st.s_store_sk\n  JOIN household_demographics hd ON s.ss_hdemo_sk = hd.hd_demo_sk AND hd.hd_dep_count = 1\n  JOIN customer_demographics cd ON s.ss_cdemo_sk = cd.cd_demo_sk AND cd.cd_marital_status = 'M' AND cd.cd_education_status = '4 yr Degree'\n  JOIN customer_address ca ON s.ss_addr_sk = ca.ca_address_sk AND ca.ca_country = 'United States' AND ca.ca_state IN ('SD', 'KS', 'MI')\n  WHERE s.ss_sales_price BETWEEN 150.00 AND 200.00 AND s.ss_net_profit BETWEEN 100 AND 200\n  \n  UNION ALL\n  \n  -- Branch 8: Third from set1, second from set2\n  SELECT s.ss_quantity, s.ss_ext_sales_price, s.ss_ext_wholesale_cost\n  FROM date_filtered_sales s\n  JOIN store st ON s.ss_store_sk = st.s_store_sk\n  JOIN household_demographics hd ON s.ss_hdemo_sk = hd.hd_demo_sk AND hd.hd_dep_count = 1\n  JOIN customer_demographics cd ON s.ss_cdemo_sk = cd.cd_demo_sk AND cd.cd_marital_status = 'M' AND cd.cd_education_status = '4 yr Degree'\n  JOIN customer_address ca ON s.ss_addr_sk = ca.ca_address_sk AND ca.ca_country = 'United States' AND ca.ca_state IN ('MO', 'ND', 'CO')\n  WHERE s.ss_sales_price BETWEEN 150.00 AND 200.00 AND s.ss_net_profit BETWEEN 150 AND 300\n  \n  UNION ALL\n  \n  -- Branch 9: Third from set1, third from set2\n  SELECT s.ss_quantity, s.ss_ext_sales_price, s.ss_ext_wholesale_cost\n  FROM date_filtered_sales s\n  JOIN store st ON s.ss_store_sk = st.s_store_sk\n  JOIN household_demographics hd ON s.ss_hdemo_sk = hd.hd_demo_sk AND hd.hd_dep_count = 1\n  JOIN customer_demographics cd ON s.ss_cdemo_sk = cd.cd_demo_sk AND cd.cd_marital_status = 'M' AND cd.cd_education_status = '4 yr Degree'\n  JOIN customer_address ca ON s.ss_addr_sk = ca.ca_address_sk AND ca.ca_country = 'United States' AND ca.ca_state IN ('NH', 'OH', 'TX')\n  WHERE s.ss_sales_price BETWEEN 150.00 AND 200.00 AND s.ss_net_profit BETWEEN 50 AND 250\n) as all_sales"
      },
      "invariants_kept": [
        "same result rows",
        "same aggregation output",
        "same column output"
      ],
      "expected_speedup": "3.0x",
      "risk": "medium"
    }
  ],
  "explanation": "The original query had complex OR conditions in the WHERE clause: (A1 AND B1 AND C1 AND D1 AND E1) OR (A2 AND B2 AND C2 AND D2 AND E2) OR (A3 AND B3 AND C3 AND D3 AND E3) AND similarly for the second set of ORs. This creates 3x3=9 possible combinations. By breaking them into UNION ALL branches, each branch can have simple AND conditions, allowing the optimizer to push predicates into joins and use better join ordering. This avoids the cartesian explosion of OR condition evaluation and allows each branch to be optimized independently with specific join conditions."
}
```

**Key insight:** The OR conditions create 9 distinct logical combinations (3 from the first set Ã— 3 from the second set). Breaking them into UNION ALL branches allows each branch to have simple AND-only conditions, enabling:
1. Predicate pushdown into joins
2. Better join ordering per branch
3. Elimination of redundant OR evaluation logic
4. Each branch can potentially use indexes more effectively

The `date_filtered_sales` CTE isolates the date filter early, reducing the store_sales scan from the full 3.4B rows to only those from 2001.