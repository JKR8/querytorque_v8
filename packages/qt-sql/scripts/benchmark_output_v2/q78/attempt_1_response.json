```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "pushdown",
      "nodes": {
        "filtered_date_dim": "SELECT d_date_sk FROM date_dim WHERE d_year = 2000",
        "ss_with_returns_2000": "SELECT d_year AS ss_sold_year, ss_item_sk, ss_customer_sk, ss_ticket_number, SUM(ss_quantity) AS ss_qty, SUM(ss_wholesale_cost) AS ss_wc, SUM(ss_sales_price) AS ss_sp FROM store_sales JOIN filtered_date_dim ON ss_sold_date_sk = d_date_sk GROUP BY d_year, ss_item_sk, ss_customer_sk, ss_ticket_number",
        "ss_anti_join_returns": "SELECT ss_sold_year, ss_item_sk, ss_customer_sk, SUM(ss_qty) AS ss_qty, SUM(ss_wc) AS ss_wc, SUM(ss_sp) AS ss_sp FROM ss_with_returns_2000 WHERE NOT EXISTS (SELECT 1 FROM store_returns WHERE sr_ticket_number = ss_ticket_number AND sr_item_sk = ss_item_sk) GROUP BY ss_sold_year, ss_item_sk, ss_customer_sk",
        "ws_with_returns_2000": "SELECT d_year AS ws_sold_year, ws_item_sk, ws_bill_customer_sk AS ws_customer_sk, ws_order_number, SUM(ws_quantity) AS ws_qty, SUM(ws_wholesale_cost) AS ws_wc, SUM(ws_sales_price) AS ws_sp FROM web_sales JOIN filtered_date_dim ON ws_sold_date_sk = d_date_sk GROUP BY d_year, ws_item_sk, ws_bill_customer_sk, ws_order_number",
        "ws_anti_join_returns": "SELECT ws_sold_year, ws_item_sk, ws_customer_sk, SUM(ws_qty) AS ws_qty, SUM(ws_wc) AS ws_wc, SUM(ws_sp) AS ws_sp FROM ws_with_returns_2000 WHERE NOT EXISTS (SELECT 1 FROM web_returns WHERE wr_order_number = ws_order_number AND wr_item_sk = ws_item_sk) GROUP BY ws_sold_year, ws_item_sk, ws_customer_sk",
        "main_query": "SELECT ss_item_sk, ROUND(ss_qty / (COALESCE(ws_qty, 0) + COALESCE(cs_qty, 0)), 2) AS ratio, ss_qty AS store_qty, ss_wc AS store_wholesale_cost, ss_sp AS store_sales_price, COALESCE(ws_qty, 0) + COALESCE(cs_qty, 0) AS other_chan_qty, COALESCE(ws_wc, 0) + COALESCE(cs_wc, 0) AS other_chan_wholesale_cost, COALESCE(ws_sp, 0) + COALESCE(cs_sp, 0) AS other_chan_sales_price FROM ss_anti_join_returns AS ss LEFT JOIN ws_anti_join_returns AS ws ON (ws_sold_year = ss_sold_year AND ws_item_sk = ss_item_sk AND ws_customer_sk = ss_customer_sk) LEFT JOIN cs ON (cs_sold_year = ss_sold_year AND cs_item_sk = ss_item_sk AND cs_customer_sk = ss_customer_sk) WHERE (COALESCE(ws_qty, 0) > 0 OR COALESCE(cs_qty, 0) > 0) ORDER BY ss_item_sk, ss_qty DESC, ss_wc DESC, ss_sp DESC, other_chan_qty, other_chan_wholesale_cost, other_chan_sales_price, ratio LIMIT 100"
      },
      "invariants_kept": [
        "same output columns",
        "same result rows",
        "same ordering",
        "same grouping and aggregation"
      ],
      "expected_speedup": "2.5x",
      "risk": "medium"
    }
  ],
  "explanation": "Applied multiple pushdown optimizations: (1) Extract year=2000 filter into date_dim CTE to reduce fact table scans early. (2) Push anti-join logic (IS NULL check) into separate CTEs using NOT EXISTS, allowing earlier filtering. (3) Group fact tables at ticket/order granularity before anti-join to reduce join cardinality. This reduces store_sales scanning from ~34M to only 2000 data, and web_sales similarly."
}
```