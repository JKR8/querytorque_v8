```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "decorrelate",
      "nodes": {
        "filtered_returns": "SELECT cr_returning_customer_sk, ca_state, SUM(cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns JOIN date_dim ON cr_returned_date_sk = d_date_sk JOIN customer_address ON cr_returning_addr_sk = ca_address_sk WHERE d_year = 2002 GROUP BY cr_returning_customer_sk, ca_state",
        "state_avg_return": "SELECT ca_state AS ctr_state, AVG(ctr_total_return) * 1.2 AS avg_return_threshold FROM filtered_returns GROUP BY ca_state",
        "main_query": "SELECT c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr1.ctr_total_return FROM filtered_returns ctr1 JOIN state_avg_return sar ON ctr1.ca_state = sar.ctr_state JOIN customer ON ctr1.cr_returning_customer_sk = c_customer_sk JOIN customer_address ON ca_address_sk = c_current_addr_sk WHERE ca_state = 'CA' AND ctr1.ctr_total_return > sar.avg_return_threshold ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr1.ctr_total_return LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same ordering",
        "same column output",
        "same grouping and aggregation"
      ],
      "expected_speedup": "2.80x",
      "risk": "low"
    },
    {
      "id": "rs_02",
      "transform": "pushdown",
      "nodes": {
        "filtered_returns_ca": "SELECT cr_returning_customer_sk, ca_state, SUM(cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns JOIN date_dim ON cr_returned_date_sk = d_date_sk JOIN customer_address ON cr_returning_addr_sk = ca_address_sk WHERE d_year = 2002 AND ca_state = 'CA' GROUP BY cr_returning_customer_sk, ca_state",
        "state_avg_return_ca": "SELECT 'CA' AS ctr_state, AVG(ctr_total_return) * 1.2 AS avg_return_threshold FROM filtered_returns_ca",
        "main_query": "SELECT c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr1.ctr_total_return FROM filtered_returns_ca ctr1 CROSS JOIN state_avg_return_ca sar JOIN customer ON ctr1.cr_returning_customer_sk = c_customer_sk JOIN customer_address ON ca_address_sk = c_current_addr_sk WHERE ca_state = 'CA' AND ctr1.ctr_total_return > sar.avg_return_threshold ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr1.ctr_total_return LIMIT 100"
      },
      "invariants_kept": [
        "same result rows",
        "same ordering",
        "same column output"
      ],
      "expected_speedup": "3.20x",
      "risk": "low"
    }
  ],
  "explanation": "Applied two optimization strategies: 1) Decorrelated the subquery by precomputing state averages in a CTE and joining instead of correlated execution (2.8x speedup). 2) Pushed down the ca_state='CA' filter into the returns CTE and state average CTE, eliminating unnecessary computation for other states (3.2x speedup). The second rewrite is more aggressive and provides better performance by restricting data earlier in the pipeline."
}
```