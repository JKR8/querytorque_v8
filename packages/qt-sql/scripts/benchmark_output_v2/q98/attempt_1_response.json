```json
{
  "rewrite_sets": [
    {
      "id": "rs_01",
      "transform": "date_cte_isolate",
      "nodes": {
        "filtered_dates": "SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('2002-05-20' AS DATE) AND (CAST('2002-05-20' AS DATE) + INTERVAL '30' DAY)",
        "filtered_items": "SELECT i_item_sk, i_item_id, i_item_desc, i_category, i_class, i_current_price FROM item WHERE i_category IN ('Sports', 'Music', 'Shoes')",
        "filtered_sales": "SELECT ss_item_sk, ss_ext_sales_price FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk",
        "main_query": "SELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, SUM(ss_ext_sales_price) AS itemrevenue, SUM(ss_ext_sales_price) * 100 / SUM(SUM(ss_ext_sales_price)) OVER (PARTITION BY i_class) AS revenueratio FROM filtered_sales JOIN filtered_items ON ss_item_sk = i_item_sk GROUP BY i_item_id, i_item_desc, i_category, i_class, i_current_price ORDER BY i_category, i_class, i_item_id, i_item_desc, revenueratio"
      },
      "invariants_kept": [
        "same result rows",
        "same output columns",
        "same grouping and aggregation",
        "same window function semantics"
      ],
      "expected_speedup": "8.0x",
      "risk": "low"
    }
  ],
  "explanation": "Extracted date_dim filter into CTE to reduce scan from 73,049 to 31 rows early. Extracted item filter into CTE to reduce scan from 408,000 to 204,000 rows. Joined these filtered CTEs with store_sales, enabling early elimination of irrelevant fact rows before expensive aggregations and window functions. This transforms the plan from scanning all 34.5M store_sales rows to scanning only those matching the filtered date and item dimensions."
}
```