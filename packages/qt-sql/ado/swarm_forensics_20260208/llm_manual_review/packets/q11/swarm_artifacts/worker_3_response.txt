```sql
WITH 
-- Pre-filter date_dim for years 2001 and 2002
date_range AS (
    SELECT d_date_sk, d_year 
    FROM date_dim 
    WHERE d_year IN (2001, 2002)
),
-- Store sales for 2001
store_2001 AS (
    SELECT
        c.c_customer_id AS customer_id,
        c.c_first_name AS customer_first_name,
        c.c_last_name AS customer_last_name,
        c.c_birth_country AS customer_birth_country,
        SUM(ss_ext_list_price - ss_ext_discount_amt) AS year_total
    FROM customer c
    JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk
    JOIN date_range d ON ss.ss_sold_date_sk = d.d_date_sk
    WHERE d.d_year = 2001
    GROUP BY
        c.c_customer_id,
        c.c_first_name,
        c.c_last_name,
        c.c_birth_country
),
-- Store sales for 2002  
store_2002 AS (
    SELECT
        c.c_customer_id AS customer_id,
        c.c_first_name AS customer_first_name,
        c.c_last_name AS customer_last_name,
        c.c_birth_country AS customer_birth_country,
        SUM(ss_ext_list_price - ss_ext_discount_amt) AS year_total
    FROM customer c
    JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk
    JOIN date_range d ON ss.ss_sold_date_sk = d.d_date_sk
    WHERE d.d_year = 2002
    GROUP BY
        c.c_customer_id,
        c.c_first_name,
        c.c_last_name,
        c.c_birth_country
),
-- Web sales for 2001
web_2001 AS (
    SELECT
        c.c_customer_id AS customer_id,
        c.c_first_name AS customer_first_name,
        c.c_last_name AS customer_last_name,
        c.c_birth_country AS customer_birth_country,
        SUM(ws_ext_list_price - ws_ext_discount_amt) AS year_total
    FROM customer c
    JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk
    JOIN date_range d ON ws.ws_sold_date_sk = d.d_date_sk
    WHERE d.d_year = 2001
    GROUP BY
        c.c_customer_id,
        c.c_first_name,
        c.c_last_name,
        c.c_birth_country
),
-- Web sales for 2002
web_2002 AS (
    SELECT
        c.c_customer_id AS customer_id,
        c.c_first_name AS customer_first_name,
        c.c_last_name AS customer_last_name,
        c.c_birth_country AS customer_birth_country,
        SUM(ws_ext_list_price - ws_ext_discount_amt) AS year_total
    FROM customer c
    JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk
    JOIN date_range d ON ws.ws_sold_date_sk = d.d_date_sk
    WHERE d.d_year = 2002
    GROUP BY
        c.c_customer_id,
        c.c_first_name,
        c.c_last_name,
        c.c_birth_country
)
-- Main query joining the pre-aggregated CTEs
SELECT
    s2.customer_id,
    s2.customer_first_name,
    s2.customer_last_name,
    s2.customer_birth_country
FROM store_2001 s1
JOIN store_2002 s2 ON s1.customer_id = s2.customer_id
JOIN web_2001 w1 ON s1.customer_id = w1.customer_id
JOIN web_2002 w2 ON s1.customer_id = w2.customer_id
WHERE s1.year_total > 0
    AND w1.year_total > 0
    AND CASE 
        WHEN w1.year_total > 0 
        THEN w2.year_total * 1.0 / w1.year_total 
        ELSE 0.0 
    END > CASE 
        WHEN s1.year_total > 0 
        THEN s2.year_total * 1.0 / s1.year_total 
        ELSE 0.0 
    END
ORDER BY
    s2.customer_id,
    s2.customer_first_name,
    s2.customer_last_name,
    s2.customer_birth_country
LIMIT 100;
```

**Changes**: Split the monolithic UNION CTE into four separate CTEs for each (channel, year) combination, pre-filtering date_dim early and pushing customer joins into each CTE. This eliminates the expensive 4-way self-join on a large CTE and reduces data movement.

**Expected speedup**: ~2.5-3.5x due to reduced intermediate result size, better predicate pushdown, and elimination of redundant customer joins across channels.