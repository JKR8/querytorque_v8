{
  "id": "DSB_NON_EQUI_JOIN_WINDOW",
  "name": "Dsb Non Equi Join Window",
  "description": "Rewrite non-equi joins with temporal ordering into window function\n      patterns for better estimation.",
  "category": "dsb_specific",
  "priority": "high",
  "verified_speedup": "unknown",
  "example": {
    "before_sql": "-- Purchase, return, repurchase pattern\n      SELECT * FROM web_returns wr\n      JOIN web_sales ws ON wr.wr_item_sk = ws.ws_item_sk\n      JOIN store_sales ss ON ws.ws_item_sk = ss.ss_item_sk\n      WHERE wr.wr_returned_date_sk < ss.ss_sold_date_sk\n        AND ws.ws_sold_date_sk < wr.wr_returned_date_sk;",
    "after_sql": "WITH ordered_events AS MATERIALIZED (\n          SELECT 'web_sale' as event_type, ws_item_sk as item_sk, \n                 ws_sold_date_sk as event_date\n          FROM web_sales\n          UNION ALL\n          SELECT 'web_return', wr_item_sk, wr_returned_date_sk\n          FROM web_returns\n          UNION ALL\n          SELECT 'store_sale', ss_item_sk, ss_sold_date_sk\n          FROM store_sales\n      )\n      SELECT item_sk, array_agg(event_type ORDER BY event_date)\n      FROM ordered_events\n      GROUP BY item_sk\n      HAVING array_agg(event_type ORDER BY event_date) \n             @> ARRAY['web_sale','web_return','store_sale'];",
    "alternative_sql": "",
    "key_insight": "DSB Query 101, 102 patterns with range/temporal constraints.",
    "transforms": [
      "dsb_non_equi_join_window"
    ]
  },
  "metadata": {
    "pg_version": "All",
    "auto_applied_by_pg": "false",
    "research_source": "DSB Benchmark Paper (VLDB 2021)",
    "notes": ""
  }
}