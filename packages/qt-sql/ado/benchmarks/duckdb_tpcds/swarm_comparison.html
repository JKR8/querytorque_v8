<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DeepSeek Swarm vs Previous Best</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #fff; --bg2: #f8fafc; --bg3: #f1f5f9; --brd: #e2e8f0; --brd2: #cbd5e1;
  --t1: #0f172a; --t2: #475569; --t3: #94a3b8;
  --grn: #16a34a; --grn2: #dcfce7;
  --red: #dc2626; --red2: #fef2f2;
  --amb: #d97706; --amb2: #fffbeb;
  --blu: #2563eb; --blu2: #eff6ff;
  --mono: 'DM Mono', monospace;
  --sans: 'DM Sans', -apple-system, system-ui, sans-serif;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: var(--sans); background: var(--bg); color: var(--t1);
  padding: 32px 40px; line-height: 1.6; -webkit-font-smoothing: antialiased;
}
::selection { background: #dbeafe; }
h1 {
  font-size: 28px; font-weight: 700; letter-spacing: -.03em;
  color: var(--t1); margin-bottom: 2px;
}
.subtitle {
  font-size: 15px; color: var(--t2); margin-bottom: 28px;
}
.subtitle span { font-family: var(--mono); font-size: 13px; color: var(--t3); }
.summary { display: flex; gap: 12px; margin-bottom: 28px; flex-wrap: wrap; }
.stat {
  background: var(--bg); border: 1px solid var(--brd); border-radius: 10px;
  padding: 16px 22px; min-width: 130px; transition: border-color .2s, box-shadow .2s;
}
.stat:hover { border-color: var(--brd2); box-shadow: 0 1px 6px rgba(0,0,0,.025); }
.stat .label {
  font-size: 11px; font-family: var(--mono); color: var(--t3);
  letter-spacing: .1em; text-transform: uppercase; display: block;
}
.stat .value { font-size: 28px; font-weight: 700; margin-top: 4px; display: block; }
.stat.win .value { color: var(--grn); }
.stat.improved .value { color: var(--blu); }
.stat.neutral .value { color: var(--t3); }
.stat.regression .value { color: var(--red); }
.stat.error .value { color: var(--amb); }
.stat.avg .value { color: var(--t1); }
.filters {
  margin-bottom: 20px; display: flex; gap: 10px;
  flex-wrap: wrap; align-items: center;
}
.filters label {
  font-size: 13px; font-family: var(--mono); color: var(--t3);
  letter-spacing: .04em; text-transform: uppercase;
}
.filters select, .filters input {
  font-family: var(--sans); font-size: 14px; color: var(--t1);
  background: var(--bg); border: 1px solid var(--brd); border-radius: 6px;
  padding: 6px 12px; outline: none; transition: border-color .15s;
}
.filters select:focus, .filters input:focus {
  border-color: var(--brd2); box-shadow: 0 0 0 3px rgba(148,163,184,.06);
}
.filters input::placeholder { color: var(--t3); }
table { width: 100%; border-collapse: collapse; font-size: 15px; }
th {
  background: var(--bg2); color: var(--t3); text-align: left;
  padding: 10px 14px; border-bottom: 2px solid var(--brd);
  font-size: 11px; font-family: var(--mono); letter-spacing: .08em;
  text-transform: uppercase; cursor: pointer; user-select: none; white-space: nowrap;
}
th:hover { color: var(--t1); }
th .arrow { font-size: 9px; margin-left: 4px; }
td { padding: 10px 14px; border-bottom: 1px solid var(--brd); }
tr:hover td { background: var(--bg2); }
tbody tr { transition: background .1s; }
.speedup { font-weight: 600; font-variant-numeric: tabular-nums; font-family: var(--mono); }
.speedup-high { color: var(--grn); }
.speedup-mid { color: var(--blu); }
.speedup-low { color: var(--t2); }
.speedup-reg { color: var(--red); }
.ms { font-variant-numeric: tabular-nums; font-family: var(--mono); color: var(--t2); }
.source { color: var(--t3); font-size: 13px; }
.num { text-align: right; }
.delta-pos { color: var(--grn); font-weight: 600; font-family: var(--mono); }
.delta-neg { color: var(--red); font-weight: 600; font-family: var(--mono); }
.delta-tie { color: var(--t3); font-family: var(--mono); }
.badge {
  display: inline-block; padding: 2px 10px; border-radius: 12px;
  font-size: 11px; font-weight: 700; font-family: var(--mono);
  letter-spacing: .06em; text-transform: uppercase;
}
.badge-swarm { background: var(--grn2); color: var(--grn); }
.badge-prev { background: var(--blu2); color: var(--blu); }
.badge-tie { background: var(--bg3); color: var(--t3); }
.badge-new { background: var(--amb2); color: var(--amb); }
.merged-col { font-weight: 700; }
#updated {
  font-size: 12px; font-family: var(--mono); color: var(--t3);
  margin-top: 20px; letter-spacing: .02em;
}
@media (max-width: 768px) {
  body { padding: 20px 16px; }
  h1 { font-size: 22px; }
  table { font-size: 13px; }
  th, td { padding: 8px 8px; }
  .stat { min-width: 100px; padding: 12px 14px; }
  .stat .value { font-size: 22px; }
}
</style>
</head>
<body>
<h1>DeepSeek Swarm vs Previous Best</h1>
<div class="subtitle" id="subtitle">Loading...</div>
<div class="summary" id="summary"></div>
<div class="filters">
  <label>Winner</label>
  <select id="statusFilter">
    <option value="all">All</option>
    <option value="swarm">Swarm Wins</option>
    <option value="prev">Prev Wins</option>
    <option value="tie">Tied</option>
    <option value="new">New Entries</option>
  </select>
  <label>Runtime</label>
  <select id="runtimeFilter">
    <option value="0">Any</option>
    <option value="100">100ms+</option>
    <option value="500">500ms+</option>
    <option value="1000">1s+</option>
  </select>
  <label>Search</label>
  <input type="text" id="search" placeholder="query, transform, source..." size="24">
</div>
<table>
  <thead>
    <tr>
      <th data-col="rank">#</th>
      <th data-col="query_id">Query</th>
      <th data-col="baseline_ms" class="num">Baseline (ms)</th>
      <th data-col="prev_speedup" class="num">Prev Best</th>
      <th data-col="prev_source">Prev Source</th>
      <th data-col="swarm_speedup" class="num">Swarm Best</th>
      <th data-col="swarm_worker">Worker</th>
      <th data-col="merged_speedup" class="num">Merged Best</th>
      <th data-col="delta" class="num">Delta</th>
      <th data-col="winner">Winner</th>
    </tr>
  </thead>
  <tbody id="tbody"></tbody>
</table>
<div id="updated"></div>
<script>
var DATA=null,sortCol='merged_speedup',sortAsc=false;
async function load(){try{var r=await fetch('swarm_comparison.json',{cache:'no-store'});if(!r.ok)throw new Error('HTTP '+r.status);DATA=await r.json()}catch(e){document.getElementById('subtitle').innerHTML='<span>Failed to load swarm_comparison.json</span>';document.getElementById('updated').textContent='Open via local web server so fetch() works.';return}renderSummary();renderTable();var s=DATA.summary;document.getElementById('subtitle').innerHTML=DATA.subtitle+' &middot; <span>'+s.total+' queries</span> &middot; DeepSeek R1 swarm (Kimi K2.5 swarm may differ)';if(DATA.updated_at){var dt=new Date(DATA.updated_at);document.getElementById('updated').textContent=!isNaN(dt.getTime())?'Updated '+dt.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric',hour:'2-digit',minute:'2-digit'}):'Updated '+DATA.updated_at}}
function mkStat(l,v,c){return'<div class="stat '+c+'"><span class="label">'+l+'</span><span class="value">'+v+'</span></div>'}
function renderSummary(){var s=DATA.summary;document.getElementById('summary').innerHTML=[mkStat('Swarm Wins',s.swarm_wins,'win'),mkStat('Prev Wins',s.prev_wins,'improved'),mkStat('Tied',s.tied,'neutral'),mkStat('New',s.new_entries,'error'),mkStat('Avg Prev',s.avg_prev.toFixed(2)+'x','avg'),mkStat('Avg Swarm',s.avg_swarm.toFixed(2)+'x','avg'),mkStat('Avg Merged',s.avg_merged.toFixed(2)+'x','avg')].join('')}
function qnum(id){var m=id.match(/q(\d+)/);return m?parseInt(m[1]):9999}
function qsuf(id){var m=id.match(/q\d+(.*)/);return m?m[1]:''}
function pDelta(d){if(!d||d==='N/A')return 0;return parseFloat(d.replace('+','').replace('x',''))}
function spCls(s){if(!s||s<=0)return'speedup-low';if(s>=1.5)return'speedup-high';if(s>=1.1)return'speedup-mid';if(s>=0.95)return'speedup-low';return'speedup-reg'}
function getFiltered(){var q=DATA.queries.slice(),sf=document.getElementById('statusFilter').value,rf=parseInt(document.getElementById('runtimeFilter').value),se=document.getElementById('search').value.toLowerCase().trim();if(sf!=='all')q=q.filter(function(x){return x.winner===sf});if(rf>0)q=q.filter(function(x){return(x.baseline_ms||0)>=rf});if(se)q=q.filter(function(x){return x.query_id.toLowerCase().indexOf(se)>=0||(x.prev_source||'').toLowerCase().indexOf(se)>=0||(x.merged_source||'').toLowerCase().indexOf(se)>=0||(x.swarm_worker||'').toLowerCase().indexOf(se)>=0||(x.swarm_transforms||[]).join(' ').toLowerCase().indexOf(se)>=0||(x.prev_transforms||[]).join(' ').toLowerCase().indexOf(se)>=0});return q}
function renderTable(){var q=getFiltered();q.sort(function(a,b){var va,vb;if(sortCol==='query_id'||sortCol==='rank'){va=qnum(a.query_id)*100+(qsuf(a.query_id)==='a'?1:qsuf(a.query_id)==='b'?2:0);vb=qnum(b.query_id)*100+(qsuf(b.query_id)==='a'?1:qsuf(b.query_id)==='b'?2:0)}else if(sortCol==='delta'){va=pDelta(a.delta);vb=pDelta(b.delta)}else if(['prev_source','swarm_worker','winner','merged_source'].indexOf(sortCol)>=0){va=a[sortCol]||'';vb=b[sortCol]||'';return sortAsc?va.localeCompare(vb):vb.localeCompare(va)}else{va=a[sortCol]||0;vb=b[sortCol]||0}return sortAsc?va-vb:vb-va});document.getElementById('tbody').innerHTML=q.map(function(r,i){var bm=r.baseline_ms?r.baseline_ms.toFixed(0):'—';var ps=r.prev_speedup?r.prev_speedup.toFixed(2)+'x':'—';var ss=r.swarm_speedup?r.swarm_speedup.toFixed(2)+'x':'—';var ms=r.merged_speedup?r.merged_speedup.toFixed(2)+'x':'—';var dc=(r.winner==='swarm'||r.winner==='new')?'delta-pos':r.winner==='prev'?'delta-neg':'delta-tie';var bc=r.winner==='swarm'?'badge-swarm':r.winner==='prev'?'badge-prev':r.winner==='new'?'badge-new':'badge-tie';var bt=r.winner==='swarm'?'SWARM':r.winner==='prev'?'PREV':r.winner==='new'?'NEW':'TIE';return'<tr><td class="num" style="color:var(--t3);font-size:13px">'+(i+1)+'</td><td style="font-weight:600">'+r.query_id+'</td><td class="num ms">'+bm+'</td><td class="num speedup '+spCls(r.prev_speedup)+'">'+ps+'</td><td class="source">'+(r.prev_source||'—')+'</td><td class="num speedup '+spCls(r.swarm_speedup)+'">'+ss+'</td><td class="source" style="font-family:var(--mono)">'+(r.swarm_worker||'—')+'</td><td class="num speedup merged-col '+spCls(r.merged_speedup)+'">'+ms+'</td><td class="num '+dc+'">'+r.delta+'</td><td><span class="badge '+bc+'">'+bt+'</span></td></tr>'}).join('');document.querySelectorAll('th').forEach(function(th){var c=th.dataset.col,ex=th.querySelector('.arrow');if(ex)ex.remove();if(c===sortCol){var sp=document.createElement('span');sp.className='arrow';sp.textContent=sortAsc?' ▲':' ▼';th.appendChild(sp)}})}
document.querySelectorAll('th').forEach(function(th){th.addEventListener('click',function(){var c=th.dataset.col;if(c===sortCol)sortAsc=!sortAsc;else{sortCol=c;sortAsc=false}renderTable()})});
document.getElementById('statusFilter').addEventListener('change',renderTable);
document.getElementById('runtimeFilter').addEventListener('change',renderTable);
document.getElementById('search').addEventListener('input',renderTable);
load();
</script>
</body>
</html>