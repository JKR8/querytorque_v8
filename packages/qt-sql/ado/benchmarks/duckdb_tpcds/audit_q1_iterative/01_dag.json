{
  "nodes": "QueryDag(nodes={'sd_stores': DagNode(node_id='sd_stores', node_type='cte', sql=\"SELECT s_store_sk FROM store WHERE s_state = 'SD'\", tables=['store'], refs=[], flags=[], contract=NodeContract(node_id='sd_stores', output_columns=['s_store_sk'], grain=[], required_predicates=[\"s_state = 'SD'\"], nullable_columns=[]), usage=NodeUsage(node_id='sd_stores', downstream_refs=['s_store_sk'], consumers=['store_customer_returns']), cost=NodeCost(node_id='sd_stores', cost_pct=0.1, row_estimate=35, operators=['SEQ_SCAN[store]'], has_filter=True, join_type=None)), 'store_customer_returns': DagNode(node_id='store_customer_returns', node_type='cte', sql='SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, SUM(SR_FEE) AS ctr_total_return, AVG(SUM(SR_FEE)) OVER (PARTITION BY sr_store_sk) AS store_avg_return FROM store_returns JOIN date_dim ON sr_returned_date_sk = d_date_sk JOIN sd_stores ON sr_store_sk = sd_stores.s_store_sk WHERE d_year = 2000 GROUP BY sr_customer_sk, sr_store_sk', tables=['store_returns', 'date_dim', 'sd_stores'], refs=['sd_stores'], flags=['GROUP_BY', 'WINDOW'], contract=NodeContract(node_id='store_customer_returns', output_columns=['ctr_customer_sk', 'ctr_store_sk', 'ctr_total_return', 'store_avg_return'], grain=['sr_customer_sk', 'sr_store_sk'], required_predicates=['d_year = 2000'], nullable_columns=[]), usage=NodeUsage(node_id='store_customer_returns', downstream_refs=[], consumers=['main_query']), cost=NodeCost(node_id='store_customer_returns', cost_pct=89.2, row_estimate=557705, operators=['SEQ_SCAN[store_returns]', 'SEQ_SCAN[date_dim]', 'HASH_GROUP_BY', 'HASH_JOIN', 'LEFT_DELIM_JOIN'], has_filter=True, join_type='hash')), 'main_query': DagNode(node_id='main_query', node_type='main', sql='SELECT c_customer_id FROM store_customer_returns AS ctr1 JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk WHERE ctr1.ctr_total_return > ctr1.store_avg_return * 1.2 ORDER BY c_customer_id LIMIT 100', tables=['store_customer_returns', 'customer'], refs=['store_customer_returns'], flags=['GROUP_BY'], contract=NodeContract(node_id='main_query', output_columns=['c_customer_id'], grain=[], required_predicates=['ctr1.ctr_total_return > ctr1.store_avg_return * 1.2'], nullable_columns=[]), usage=NodeUsage(node_id='main_query', downstream_refs=[], consumers=[]), cost=NodeCost(node_id='main_query', cost_pct=8.5, row_estimate=539331, operators=['SEQ_SCAN[customer]', 'SEQ_SCAN[CTE_SCAN]', 'SEQ_SCAN[COLUMN_DATA_SCAN]', 'SEQ_SCAN[CTE_SCAN]', 'SEQ_SCAN[DELIM_SCAN]'], has_filter=True, join_type='hash'))}, edges=[('sd_stores', 'store_customer_returns'), ('store_customer_returns', 'main_query')], original_sql=\"WITH sd_stores AS (\\n  SELECT s_store_sk\\n  FROM store\\n  WHERE s_state = 'SD'\\n),\\nstore_customer_returns AS (\\n  SELECT\\n    sr_customer_sk AS ctr_customer_sk,\\n    sr_store_sk AS ctr_store_sk,\\n    SUM(SR_FEE) AS ctr_total_return,\\n    AVG(SUM(SR_FEE)) OVER (PARTITION BY sr_store_sk) AS store_avg_return\\n  FROM store_returns\\n  JOIN date_dim ON sr_returned_date_sk = d_date_sk\\n  JOIN sd_stores ON sr_store_sk = sd_stores.s_store_sk\\n  WHERE d_year = 2000\\n  GROUP BY sr_customer_sk, sr_store_sk\\n)\\nSELECT\\n  c_customer_id\\nFROM store_customer_returns ctr1\\nJOIN customer ON ctr1.ctr_customer_sk = c_customer_sk\\nWHERE ctr1.ctr_total_return > ctr1.store_avg_return * 1.2\\nORDER BY c_customer_id\\nLIMIT 100\")"
}