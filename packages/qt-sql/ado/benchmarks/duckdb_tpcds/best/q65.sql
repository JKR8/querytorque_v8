WITH filtered_sales AS (SELECT ss.ss_store_sk, ss.ss_item_sk, ss.ss_sales_price FROM store_sales AS ss JOIN date_dim AS d ON ss.ss_sold_date_sk = d.d_date_sk WHERE d.d_month_seq BETWEEN 1221 AND 1221 + 11), item_revenue AS (SELECT ss_store_sk, ss_item_sk, SUM(ss_sales_price) AS revenue FROM filtered_sales GROUP BY ss_store_sk, ss_item_sk), store_avg AS (SELECT ss_store_sk, AVG(revenue) AS ave FROM item_revenue GROUP BY ss_store_sk)
SELECT s.s_store_name, i.i_item_desc, ir.revenue, i.i_current_price, i.i_wholesale_cost, i.i_brand FROM item_revenue AS ir JOIN store_avg AS sb ON ir.ss_store_sk = sb.ss_store_sk JOIN store AS s ON s.s_store_sk = ir.ss_store_sk JOIN item AS i ON i.i_item_sk = ir.ss_item_sk WHERE ir.revenue <= 0.1 * sb.ave ORDER BY s.s_store_name, i.i_item_desc LIMIT 100
