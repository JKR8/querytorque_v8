<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DuckDB TPC-DS Leaderboard</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #fff; --bg2: #f8fafc; --bg3: #f1f5f9; --brd: #e2e8f0; --brd2: #cbd5e1;
  --t1: #0f172a; --t2: #475569; --t3: #94a3b8;
  --grn: #16a34a; --grn2: #dcfce7;
  --red: #dc2626; --red2: #fef2f2;
  --amb: #d97706; --amb2: #fffbeb;
  --blu: #2563eb; --blu2: #eff6ff;
  --mono: 'DM Mono', monospace;
  --sans: 'DM Sans', -apple-system, system-ui, sans-serif;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: var(--sans); background: var(--bg); color: var(--t1);
  padding: 32px 40px; line-height: 1.6; -webkit-font-smoothing: antialiased;
}
::selection { background: #dbeafe; }

h1 {
  font-size: 28px; font-weight: 700; letter-spacing: -.03em;
  color: var(--t1); margin-bottom: 2px;
}
.subtitle {
  font-size: 15px; color: var(--t2); margin-bottom: 28px;
}
.subtitle span { font-family: var(--mono); font-size: 13px; color: var(--t3); }

/* ——— summary cards ——— */
.summary { display: flex; gap: 12px; margin-bottom: 28px; flex-wrap: wrap; }
.stat {
  background: var(--bg); border: 1px solid var(--brd); border-radius: 10px;
  padding: 16px 22px; min-width: 130px; transition: border-color .2s, box-shadow .2s;
}
.stat:hover { border-color: var(--brd2); box-shadow: 0 1px 6px rgba(0,0,0,.025); }
.stat .label {
  font-size: 11px; font-family: var(--mono); color: var(--t3);
  letter-spacing: .1em; text-transform: uppercase; display: block;
}
.stat .value { font-size: 28px; font-weight: 700; margin-top: 4px; display: block; }
.stat.win .value { color: var(--grn); }
.stat.improved .value { color: var(--blu); }
.stat.neutral .value { color: var(--t3); }
.stat.regression .value { color: var(--red); }
.stat.error .value { color: var(--amb); }
.stat.avg .value { color: var(--t1); }

/* ——— filters ——— */
.filters {
  margin-bottom: 20px; display: flex; gap: 10px;
  flex-wrap: wrap; align-items: center;
}
.filters label {
  font-size: 13px; font-family: var(--mono); color: var(--t3);
  letter-spacing: .04em; text-transform: uppercase;
}
.filters select, .filters input {
  font-family: var(--sans); font-size: 14px; color: var(--t1);
  background: var(--bg); border: 1px solid var(--brd); border-radius: 6px;
  padding: 6px 12px; outline: none; transition: border-color .15s;
}
.filters select:focus, .filters input:focus {
  border-color: var(--brd2); box-shadow: 0 0 0 3px rgba(148,163,184,.06);
}
.filters input::placeholder { color: var(--t3); }

/* ——— table ——— */
table { width: 100%; border-collapse: collapse; font-size: 15px; }
th {
  background: var(--bg2); color: var(--t3); text-align: left;
  padding: 10px 14px; border-bottom: 2px solid var(--brd);
  font-size: 11px; font-family: var(--mono); letter-spacing: .08em;
  text-transform: uppercase; cursor: pointer; user-select: none; white-space: nowrap;
}
th:hover { color: var(--t1); }
th .arrow { font-size: 9px; margin-left: 4px; }
td { padding: 10px 14px; border-bottom: 1px solid var(--brd); }
tr:hover td { background: var(--bg2); }
tbody tr { transition: background .1s; }

.status-WIN { color: var(--grn); font-weight: 600; }
.status-IMPROVED { color: var(--blu); }
.status-NEUTRAL { color: var(--t3); }
.status-REGRESSION { color: var(--red); }
.status-error, .status-parse_error, .status-wrong_results { color: var(--amb); }

.speedup { font-weight: 600; font-variant-numeric: tabular-nums; font-family: var(--mono); }
.speedup-high { color: var(--grn); }
.speedup-mid { color: var(--blu); }
.speedup-low { color: var(--t2); }
.speedup-reg { color: var(--red); }

.ms { font-variant-numeric: tabular-nums; font-family: var(--mono); color: var(--t2); }
.transform { color: #7c3aed; font-family: var(--mono); font-size: 13px; }
.source { color: var(--t3); font-size: 13px; }
.source-analyst {
  color: #7c3aed; font-weight: 600; font-family: var(--mono); font-size: 13px;
}
.rows-yes { color: var(--grn); }
.rows-no { color: var(--red); font-weight: 700; }
.num { text-align: right; }

#updated {
  font-size: 12px; font-family: var(--mono); color: var(--t3);
  margin-top: 20px; letter-spacing: .02em;
}

@media (max-width: 768px) {
  body { padding: 20px 16px; }
  h1 { font-size: 22px; }
  table { font-size: 13px; }
  th, td { padding: 8px 8px; }
  .stat { min-width: 100px; padding: 12px 14px; }
  .stat .value { font-size: 22px; }
}
</style>
</head>
<body>

<h1>DuckDB TPC-DS SF10 Leaderboard</h1>
<div class="subtitle" id="subtitle">Loading...</div>

<div class="summary" id="summary"></div>

<div class="filters">
  <label>Status</label>
  <select id="statusFilter">
    <option value="all">All</option>
    <option value="WIN">WIN</option>
    <option value="IMPROVED">IMPROVED</option>
    <option value="NEUTRAL">NEUTRAL</option>
    <option value="REGRESSION">REGRESSION</option>
    <option value="error">ERROR</option>
  </select>
  <label>Runtime</label>
  <select id="runtimeFilter">
    <option value="0">Any</option>
    <option value="100">100ms+</option>
    <option value="500">500ms+</option>
    <option value="1000">1s+</option>
  </select>
  <label>Search</label>
  <input type="text" id="search" placeholder="query, transform, source..." size="24">
</div>

<table>
  <thead>
    <tr>
      <th data-col="rank">#</th>
      <th data-col="query_id">Query</th>
      <th data-col="status">Status</th>
      <th data-col="speedup" class="num">Speedup</th>
      <th data-col="original_ms" class="num">Orig (ms)</th>
      <th data-col="optimized_ms" class="num">Opt (ms)</th>
      <th data-col="rows_match">Rows</th>
      <th data-col="transforms">Transform</th>
      <th data-col="source">Source</th>
    </tr>
  </thead>
  <tbody id="tbody"></tbody>
</table>

<div id="updated"></div>

<script>
const INLINE_DATA = {"benchmark":"tpcds","engine":"duckdb","scale_factor":10,"updated_at":"2026-02-07T12:37:30.871405+00:00","source":"DuckDB_TPC-DS_Leaderboard_v3_20260206.csv + analyst_mode","summary":{"total":99,"wins":43,"improved":25,"neutral":13,"regression":18,"errors":0,"avg_speedup":1.6146},"queries":[{"query_id":"q88","status":"WIN","speedup":5.25,"original_ms":2069.88,"optimized_ms":394.26,"transforms":["materialize_cte"],"source":"Retry4W","rows_match":true},{"query_id":"q9","status":"WIN","speedup":4.47,"original_ms":2206.17,"optimized_ms":493.55,"transforms":[],"source":"Retry3W","rows_match":true},{"query_id":"q11","status":"WIN","speedup":4.0,"original_ms":6017.12,"optimized_ms":1504.28,"transforms":[],"source":"Evo","rows_match":true},{"query_id":"q63","status":"WIN","speedup":3.77,"original_ms":387.19,"optimized_ms":102.7,"transforms":["or_to_union"],"source":"Retry3W","rows_match":true},{"query_id":"q40","status":"WIN","speedup":3.35,"original_ms":251.58,"optimized_ms":75.1,"transforms":["date_cte_isolate"],"source":"Retry4W","rows_match":true},{"query_id":"q46","status":"WIN","speedup":3.23,"original_ms":859.94,"optimized_ms":266.24,"transforms":["or_to_union"],"source":"Retry4W","rows_match":true},{"query_id":"q15","status":"WIN","speedup":3.17,"original_ms":150.38,"optimized_ms":47.44,"transforms":["or_to_union"],"source":"Evo","rows_match":true},{"query_id":"q1","status":"WIN","speedup":2.92,"original_ms":239.26,"optimized_ms":81.94,"transforms":["decorrelate"],"source":"Kimi","rows_match":true},{"query_id":"q42","status":"WIN","speedup":2.8,"original_ms":217.87,"optimized_ms":77.81,"transforms":["date_cte_isolate"],"source":"Retry4W","rows_match":true},{"query_id":"q93","status":"WIN","speedup":2.73,"original_ms":2860.55,"optimized_ms":1047.82,"transforms":["decorrelate"],"source":"Kimi","rows_match":true},{"query_id":"q43","status":"WIN","speedup":2.71,"original_ms":618.94,"optimized_ms":228.39,"transforms":["early_filter"],"source":"Retry3W","rows_match":true},{"query_id":"q77","status":"WIN","speedup":2.56,"original_ms":420.65,"optimized_ms":164.32,"transforms":["date_cte_isolate"],"source":"Retry4W","rows_match":true},{"query_id":"q52","status":"WIN","speedup":2.5,"original_ms":238.82,"optimized_ms":95.53,"transforms":["date_cte_isolate"],"source":"Retry4W","rows_match":true},{"query_id":"q21","status":"WIN","speedup":2.43,"original_ms":71.07,"optimized_ms":29.25,"transforms":["date_cte_isolate"],"source":"Retry4W","rows_match":true},{"query_id":"q29","status":"WIN","speedup":2.35,"original_ms":692.5,"optimized_ms":294.68,"transforms":["date_cte_isolate"],"source":"Retry3W","rows_match":true},{"query_id":"q23","status":"WIN","speedup":2.33,"original_ms":24403.59,"optimized_ms":10473.64,"transforms":["date_cte_isolate"],"source":"Retry4W","rows_match":true},{"query_id":"q47","status":"WIN","speedup":2.31,"original_ms":2705.8,"optimized_ms":1171.34,"transforms":["or_to_union"],"source":"Retry4W","rows_match":true},{"query_id":"q99","status":"WIN","speedup":2.3,"original_ms":464.41,"optimized_ms":201.92,"transforms":["date_cte_isolate"],"source":"Retry4W","rows_match":true},{"query_id":"q80","status":"WIN","speedup":2.06,"original_ms":1553.28,"optimized_ms":754.02,"transforms":["date_cte_isolate"],"source":"Retry4W","rows_match":true},{"query_id":"q39","status":"WIN","speedup":2.02,"original_ms":452.21,"optimized_ms":223.87,"transforms":["date_cte_isolate"],"source":"Retry4W","rows_match":true},{"query_id":"q97","status":"WIN","speedup":1.98,"original_ms":2642.65,"optimized_ms":1334.67,"transforms":["date_cte_isolate"],"source":"Retry4W","rows_match":true},{"query_id":"q26","status":"WIN","speedup":1.93,"original_ms":166.96,"optimized_ms":86.51,"transforms":["or_to_union"],"source":"Retry3W","rows_match":true},{"query_id":"q69","status":"WIN","speedup":1.92,"original_ms":441.33,"optimized_ms":229.86,"transforms":["decorrelate"],"source":"Retry4W","rows_match":true},{"query_id":"q5","status":"WIN","speedup":1.89,"original_ms":1169.49,"optimized_ms":618.78,"transforms":[],"source":"Retry3W","rows_match":true},{"query_id":"q14","status":"WIN","speedup":1.88,"original_ms":9210.54,"optimized_ms":4899.22,"transforms":[],"source":"Retry4W","rows_match":true},{"query_id":"q85","status":"WIN","speedup":1.83,"original_ms":459.82,"optimized_ms":251.27,"transforms":["or_to_union"],"source":"Retry4W","rows_match":true},{"query_id":"q54","status":"WIN","speedup":1.81,"original_ms":389.15,"optimized_ms":215.0,"transforms":["date_cte_isolate"],"source":"Retry4W","rows_match":true},{"query_id":"q78","status":"WIN","speedup":1.81,"original_ms":9002.15,"optimized_ms":4973.56,"transforms":["pushdown"],"source":"Retry4W","rows_match":true},{"query_id":"q22","status":"WIN","speedup":1.69,"original_ms":7654.7,"optimized_ms":4529.41,"transforms":["date_cte_isolate"],"source":"Retry3W","rows_match":true},{"query_id":"q96","status":"WIN","speedup":1.64,"original_ms":253.36,"optimized_ms":154.49,"transforms":["early_filter"],"source":"Retry3W","rows_match":true},{"query_id":"q58","status":"WIN","speedup":1.64,"original_ms":269.02,"optimized_ms":164.04,"transforms":["materialize_cte"],"source":"Retry4W","rows_match":true},{"query_id":"q73","status":"WIN","speedup":1.57,"original_ms":450.09,"optimized_ms":286.68,"transforms":["or_to_union"],"source":"Retry3W","rows_match":true},{"query_id":"q90","status":"WIN","speedup":1.57,"original_ms":109.18,"optimized_ms":69.54,"transforms":["materialize_cte"],"source":"Kimi","rows_match":true},{"query_id":"q36","status":"WIN","speedup":1.56,"original_ms":896.61,"optimized_ms":574.75,"transforms":["multi_push_predicate"],"source":"Retry4W","rows_match":true},{"query_id":"q38","status":"IMPROVED","speedup":1.44,"original_ms":1598.84,"optimized_ms":1110.31,"transforms":["date_cte_isolate"],"source":"Retry3W","rows_match":true},{"query_id":"q68","status":"IMPROVED","speedup":1.42,"original_ms":889.66,"optimized_ms":626.52,"transforms":["or_to_union"],"source":"Retry4W","rows_match":true},{"query_id":"q72","status":"IMPROVED","speedup":1.38,"original_ms":1467.27,"optimized_ms":1063.24,"transforms":["semantic_rewrite"],"source":"Retry4W","rows_match":true},{"query_id":"q95","status":"IMPROVED","speedup":1.37,"original_ms":5151.01,"optimized_ms":3759.86,"transforms":["semantic_rewrite"],"source":"Kimi","rows_match":true},{"query_id":"q74","status":"IMPROVED","speedup":1.36,"original_ms":4129.73,"optimized_ms":3036.57,"transforms":["pushdown"],"source":"Kimi","rows_match":true},{"query_id":"q6","status":"IMPROVED","speedup":1.33,"original_ms":418.9,"optimized_ms":314.96,"transforms":[],"source":"Kimi","rows_match":true},{"query_id":"q28","status":"IMPROVED","speedup":1.33,"original_ms":3730.71,"optimized_ms":2805.05,"transforms":["semantic_rewrite"],"source":"Kimi","rows_match":true},{"query_id":"q31","status":"IMPROVED","speedup":1.33,"original_ms":661.33,"optimized_ms":497.24,"transforms":["pushdown"],"source":"Retry4W","rows_match":true},{"query_id":"q10","status":"IMPROVED","speedup":1.32,"original_ms":290.32,"optimized_ms":219.94,"transforms":["date_cte_isolate"],"source":"Retry4W","rows_match":true},{"query_id":"q37","status":"IMPROVED","speedup":1.3,"original_ms":124.4,"optimized_ms":95.69,"transforms":["date_cte_isolate"],"source":"Retry3W","rows_match":true},{"query_id":"q98","status":"IMPROVED","speedup":1.26,"original_ms":384.96,"optimized_ms":305.52,"transforms":["date_cte_isolate"],"source":"Retry4W","rows_match":true},{"query_id":"q83","status":"IMPROVED","speedup":1.24,"original_ms":75.64,"optimized_ms":61.0,"transforms":["materialize_cte"],"source":"Kimi","rows_match":true},{"query_id":"q12","status":"IMPROVED","speedup":1.23,"original_ms":110.27,"optimized_ms":89.65,"transforms":[],"source":"Retry3W","rows_match":true},{"query_id":"q62","status":"IMPROVED","speedup":1.23,"original_ms":413.74,"optimized_ms":336.37,"transforms":["date_cte_isolate"],"source":"Kimi","rows_match":true},{"query_id":"q66","status":"IMPROVED","speedup":1.23,"original_ms":444.51,"optimized_ms":361.39,"transforms":["date_cte_isolate"],"source":"Kimi","rows_match":true},{"query_id":"q84","status":"IMPROVED","speedup":1.22,"original_ms":80.06,"optimized_ms":65.62,"transforms":["reorder_join"],"source":"Kimi","rows_match":true},{"query_id":"q17","status":"IMPROVED","speedup":1.19,"original_ms":864.36,"optimized_ms":726.35,"transforms":[],"source":"Kimi","rows_match":true},{"query_id":"q3","status":"IMPROVED","speedup":1.19,"original_ms":296.3,"optimized_ms":248.99,"transforms":[],"source":"Retry4W","rows_match":true},{"query_id":"q82","status":"IMPROVED","speedup":1.18,"original_ms":264.98,"optimized_ms":224.56,"transforms":["date_cte_isolate"],"source":"Retry3W","rows_match":true},{"query_id":"q19","status":"IMPROVED","speedup":1.16,"original_ms":389.37,"optimized_ms":335.66,"transforms":["date_cte_isolate"],"source":"Retry4W","rows_match":true},{"query_id":"q18","status":"IMPROVED","speedup":1.14,"original_ms":424.41,"optimized_ms":372.29,"transforms":["date_cte_isolate"],"source":"Kimi","rows_match":true},{"query_id":"q41","status":"IMPROVED","speedup":1.14,"original_ms":19.56,"optimized_ms":17.16,"transforms":["or_to_union"],"source":"Kimi","rows_match":true},{"query_id":"q92","status":"IMPROVED","speedup":1.14,"original_ms":95.83,"optimized_ms":84.06,"transforms":["decorrelate"],"source":"Retry4W","rows_match":true},{"query_id":"q20","status":"IMPROVED","speedup":1.13,"original_ms":71.56,"optimized_ms":63.33,"transforms":["date_cte_isolate"],"source":"Retry4W","rows_match":true},{"query_id":"q76","status":"IMPROVED","speedup":1.1,"original_ms":513.1,"optimized_ms":466.45,"transforms":["pushdown"],"source":"Kimi","rows_match":true},{"query_id":"q45","status":"NEUTRAL","speedup":1.08,"original_ms":192.0,"optimized_ms":177.78,"transforms":["or_to_union"],"source":"Kimi","rows_match":true},{"query_id":"q33","status":"NEUTRAL","speedup":1.05,"original_ms":338.52,"optimized_ms":322.4,"transforms":["materialize_cte"],"source":"Kimi","rows_match":true},{"query_id":"q79","status":"NEUTRAL","speedup":1.05,"original_ms":939.75,"optimized_ms":895.0,"transforms":["or_to_union"],"source":"Kimi","rows_match":true},{"query_id":"q4","status":"WIN","speedup":2.91,"original_ms":10208.82,"optimized_ms":3508.19,"transforms":["history_steered"],"source":"analyst_mode","rows_match":true},{"query_id":"q8","status":"NEUTRAL","speedup":1.03,"original_ms":704.29,"optimized_ms":683.78,"transforms":[],"source":"Kimi","rows_match":true},{"query_id":"q49","status":"NEUTRAL","speedup":1.02,"original_ms":534.27,"optimized_ms":523.79,"transforms":["date_cte_isolate"],"source":"Kimi","rows_match":true},{"query_id":"q57","status":"NEUTRAL","speedup":1.02,"original_ms":1316.85,"optimized_ms":1291.03,"transforms":["date_cte_isolate"],"source":"Kimi","rows_match":true},{"query_id":"q60","status":"NEUTRAL","speedup":1.02,"original_ms":378.07,"optimized_ms":370.66,"transforms":["date_cte_isolate"],"source":"Kimi","rows_match":true},{"query_id":"q27","status":"NEUTRAL","speedup":1.02,"original_ms":702.99,"optimized_ms":689.21,"transforms":["date_cte_isolate"],"source":"Retry4W","rows_match":true},{"query_id":"q13","status":"NEUTRAL","speedup":1.01,"original_ms":980.72,"optimized_ms":971.01,"transforms":["or_to_union"],"source":"Kimi","rows_match":true},{"query_id":"q64","status":"NEUTRAL","speedup":1.01,"original_ms":3841.1,"optimized_ms":3803.07,"transforms":["pushdown"],"source":"Kimi","rows_match":true},{"query_id":"q48","status":"NEUTRAL","speedup":1.0,"original_ms":933.9,"optimized_ms":933.9,"transforms":["or_to_union"],"source":"Kimi","rows_match":true},{"query_id":"q25","status":"NEUTRAL","speedup":0.98,"original_ms":515.35,"optimized_ms":525.87,"transforms":["date_cte_isolate"],"source":"Kimi","rows_match":true},{"query_id":"q71","status":"NEUTRAL","speedup":0.96,"original_ms":579.44,"optimized_ms":603.58,"transforms":["or_to_union"],"source":"Kimi","rows_match":true},{"query_id":"q55","status":"REGRESSION","speedup":0.94,"original_ms":227.83,"optimized_ms":242.37,"transforms":["date_cte_isolate"],"source":"Kimi","rows_match":true},{"query_id":"q75","status":"REGRESSION","speedup":0.94,"original_ms":2844.6,"optimized_ms":3026.17,"transforms":["pushdown"],"source":"Kimi","rows_match":true},{"query_id":"q56","status":"REGRESSION","speedup":0.92,"original_ms":349.29,"optimized_ms":379.66,"transforms":["date_cte_isolate"],"source":"Kimi","rows_match":true},{"query_id":"q86","status":"REGRESSION","speedup":0.92,"original_ms":235.86,"optimized_ms":256.37,"transforms":["date_cte_isolate"],"source":"Kimi","rows_match":true},{"query_id":"q50","status":"REGRESSION","speedup":0.91,"original_ms":1007.8,"optimized_ms":1107.47,"transforms":["date_cte_isolate"],"source":"Kimi","rows_match":true},{"query_id":"q91","status":"REGRESSION","speedup":0.89,"original_ms":43.33,"optimized_ms":48.69,"transforms":["or_to_union"],"source":"Retry3W","rows_match":true},{"query_id":"q24","status":"REGRESSION","speedup":0.87,"original_ms":780.29,"optimized_ms":896.89,"transforms":["pushdown"],"source":"Kimi","rows_match":true},{"query_id":"q87","status":"REGRESSION","speedup":0.86,"original_ms":1821.88,"optimized_ms":2118.47,"transforms":["date_cte_isolate"],"source":"Kimi","rows_match":true},{"query_id":"q34","status":"REGRESSION","speedup":0.8,"original_ms":539.91,"optimized_ms":674.89,"transforms":["or_to_union"],"source":"Retry3W","rows_match":true},{"query_id":"q70","status":"REGRESSION","speedup":0.75,"original_ms":1299.73,"optimized_ms":1732.97,"transforms":["date_cte_isolate"],"source":"Kimi","rows_match":true},{"query_id":"q89","status":"REGRESSION","speedup":0.6,"original_ms":521.03,"optimized_ms":868.38,"transforms":["or_to_union"],"source":"Kimi","rows_match":true},{"query_id":"q53","status":"REGRESSION","speedup":0.51,"original_ms":355.59,"optimized_ms":697.24,"transforms":["or_to_union"],"source":"Kimi","rows_match":true},{"query_id":"q61","status":"REGRESSION","speedup":0.4,"original_ms":19.28,"optimized_ms":48.2,"transforms":["materialize_cte"],"source":"Kimi","rows_match":true},{"query_id":"q32","status":"REGRESSION","speedup":0.27,"original_ms":17.4,"optimized_ms":64.44,"transforms":["decorrelate"],"source":"Kimi","rows_match":true},{"query_id":"q94","status":"REGRESSION","speedup":0.24,"original_ms":141.02,"optimized_ms":587.58,"transforms":["date_cte_isolate"],"source":"Retry3W","rows_match":true},{"query_id":"q2","status":"WIN","speedup":2.0971,"original_ms":937.05,"optimized_ms":446.83,"transforms":["pushdown"],"source":"unvalidated","rows_match":true},{"query_id":"q7","status":"REGRESSION","speedup":0.5151,"original_ms":659.97,"optimized_ms":1281.25,"transforms":["date_cte_isolate"],"source":"unvalidated","rows_match":true},{"query_id":"q16","status":"REGRESSION","speedup":0.1434,"original_ms":18.12,"optimized_ms":126.37,"transforms":["semantic_rewrite"],"source":"state_0","rows_match":true},{"query_id":"q30","status":"WIN","speedup":1.1462,"original_ms":63.08,"optimized_ms":55.03,"transforms":["decorrelate"],"source":"state_0","rows_match":true},{"query_id":"q35","status":"WIN","speedup":1.5084,"original_ms":1147.51,"optimized_ms":760.75,"transforms":["date_cte_isolate"],"source":"unvalidated","rows_match":true},{"query_id":"q44","status":"WIN","speedup":1.3654,"original_ms":4.35,"optimized_ms":3.18,"transforms":["materialize_cte"],"source":"state_0","rows_match":true},{"query_id":"q51","status":"WIN","speedup":1.82,"original_ms":7935.14,"optimized_ms":4359.97,"transforms":["history_steered"],"source":"analyst_mode","rows_match":true},{"query_id":"q59","status":"WIN","speedup":1.865,"original_ms":2873.22,"optimized_ms":1540.6,"transforms":["pushdown"],"source":"unvalidated","rows_match":true},{"query_id":"q65","status":"WIN","speedup":1.8342,"original_ms":3547.95,"optimized_ms":1934.33,"transforms":["date_cte_isolate"],"source":"unvalidated","rows_match":true},{"query_id":"q67","status":"REGRESSION","speedup":0.8523,"original_ms":4509.08,"optimized_ms":5290.65,"transforms":["date_cte_isolate"],"source":"state_0","rows_match":true},{"query_id":"q81","status":"WIN","speedup":4.3813,"original_ms":355.19,"optimized_ms":81.07,"transforms":["decorrelate"],"source":"unvalidated","rows_match":true}]};

let DATA = null;
let sortCol = 'speedup';
let sortAsc = false;

function load() {
  DATA = INLINE_DATA;
  renderSummary();
  renderTable();
  document.getElementById('subtitle').innerHTML =
    `<span>${DATA.queries.length} queries</span> &middot; Engine: ${DATA.engine} &middot; SF${DATA.scale_factor} &middot; <span>3-run validated</span>`;
  document.getElementById('updated').textContent = 'Updated ' + new Date(DATA.updated_at).toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric', hour:'2-digit', minute:'2-digit'});
}

function renderSummary() {
  const q = DATA.queries;
  const wins = q.filter(x => x.speedup >= 1.10 && !isError(x)).length;
  const improved = q.filter(x => x.speedup >= 1.05 && x.speedup < 1.10 && !isError(x)).length;
  const neutral = q.filter(x => x.speedup >= 0.95 && x.speedup < 1.05 && !isError(x)).length;
  const regression = q.filter(x => x.speedup > 0 && x.speedup < 0.95 && !isError(x)).length;
  const errors = q.filter(x => isError(x)).length;
  const validSpeeds = q.filter(x => x.speedup > 0 && !isError(x)).map(x => x.speedup);
  const avg = validSpeeds.length ? (validSpeeds.reduce((a,b)=>a+b,0)/validSpeeds.length) : 0;

  document.getElementById('summary').innerHTML = [
    mkStat('Wins', wins, 'win'),
    mkStat('Improved', improved, 'improved'),
    mkStat('Neutral', neutral, 'neutral'),
    mkStat('Regression', regression, 'regression'),
    mkStat('Error', errors, 'error'),
    mkStat('Avg Speedup', avg.toFixed(2) + 'x', 'avg'),
  ].join('');
}

function mkStat(label, value, cls) {
  return `<div class="stat ${cls}"><span class="label">${label}</span><span class="value">${value}</span></div>`;
}

function isError(q) {
  return ['error','parse_error','wrong_results'].includes(q.status);
}

function qnum(qid) {
  const m = qid.match(/q(\d+)/);
  return m ? parseInt(m[1]) : 9999;
}

function getFiltered() {
  let q = [...DATA.queries];
  const sf = document.getElementById('statusFilter').value;
  const rf = parseInt(document.getElementById('runtimeFilter').value);
  const search = document.getElementById('search').value.toLowerCase().trim();

  if (sf !== 'all') {
    if (sf === 'error') q = q.filter(x => isError(x));
    else q = q.filter(x => x.status === sf);
  }
  if (rf > 0) q = q.filter(x => (x.original_ms || 0) >= rf);
  if (search) q = q.filter(x =>
    x.query_id.toLowerCase().includes(search) ||
    (x.transforms || []).join(' ').toLowerCase().includes(search) ||
    (x.source || '').toLowerCase().includes(search)
  );
  return q;
}

function renderTable() {
  let q = getFiltered();

  q.sort((a, b) => {
    let va, vb;
    if (sortCol === 'query_id' || sortCol === 'rank') { va = qnum(a.query_id); vb = qnum(b.query_id); }
    else if (['transforms','source','status'].includes(sortCol)) {
      va = sortCol === 'transforms' ? (a.transforms||[]).join(',') : (a[sortCol]||'');
      vb = sortCol === 'transforms' ? (b.transforms||[]).join(',') : (b[sortCol]||'');
      return sortAsc ? va.localeCompare(vb) : vb.localeCompare(va);
    }
    else if (sortCol === 'rows_match') { va = a.rows_match ? 1 : 0; vb = b.rows_match ? 1 : 0; }
    else { va = a[sortCol] || 0; vb = b[sortCol] || 0; }
    return sortAsc ? va - vb : vb - va;
  });

  document.getElementById('tbody').innerHTML = q.map((r, i) => {
    const sp = r.speedup || 0;
    const spClass = sp >= 1.5 ? 'speedup-high' : sp >= 1.1 ? 'speedup-mid' : sp >= 0.95 ? 'speedup-low' : 'speedup-reg';
    const origMs = r.original_ms ? r.original_ms.toFixed(0) : '\u2014';
    const optMs = r.optimized_ms ? r.optimized_ms.toFixed(0) : '\u2014';
    const rowsClass = r.rows_match === true ? 'rows-yes' : r.rows_match === false ? 'rows-no' : '';
    const rowsText = r.rows_match === true ? '\u2713' : r.rows_match === false ? 'NO' : '\u2014';
    const transforms = (r.transforms || []).join(', ') || '\u2014';
    const srcClass = (r.source || '').includes('analyst') ? 'source-analyst' : 'source';

    return `<tr>
      <td class="num" style="color:var(--t3);font-size:13px">${i+1}</td>
      <td style="font-weight:600">${r.query_id}</td>
      <td class="status-${r.status}">${r.status}</td>
      <td class="num speedup ${spClass}">${sp > 0 ? sp.toFixed(2) + 'x' : '\u2014'}</td>
      <td class="num ms">${origMs}</td>
      <td class="num ms">${optMs}</td>
      <td class="${rowsClass}" style="text-align:center">${rowsText}</td>
      <td class="transform">${transforms}</td>
      <td class="${srcClass}">${r.source || '\u2014'}</td>
    </tr>`;
  }).join('');

  document.querySelectorAll('th').forEach(th => {
    const col = th.dataset.col;
    const existing = th.querySelector('.arrow');
    if (existing) existing.remove();
    if (col === sortCol) {
      const span = document.createElement('span');
      span.className = 'arrow';
      span.textContent = sortAsc ? ' \u25B2' : ' \u25BC';
      th.appendChild(span);
    }
  });
}

document.querySelectorAll('th').forEach(th => {
  th.addEventListener('click', () => {
    const col = th.dataset.col;
    if (col === sortCol) sortAsc = !sortAsc;
    else { sortCol = col; sortAsc = false; }
    renderTable();
  });
});

document.getElementById('statusFilter').addEventListener('change', renderTable);
document.getElementById('runtimeFilter').addEventListener('change', renderTable);
document.getElementById('search').addEventListener('input', renderTable);

load();
</script>
</body>
</html>
