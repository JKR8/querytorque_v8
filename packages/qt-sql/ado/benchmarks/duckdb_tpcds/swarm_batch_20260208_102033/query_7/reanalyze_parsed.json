{
  "failure_analysis": "All attempts fell short because they focused exclusively on predicate pushdown via CTEs, which DuckDB's optimizer already handles automatically. The CTE-based rewrites provided minimal benefit (1.01x-1.15x) because they didn't address the fundamental bottlenecks: 1) Large fact-table scan with no pre-aggregation before dimension joins, 2) No exploitation of columnar layout via column pruning, 3) The OR condition on promotion table forces full table scan despite potential for bloom filter, and 4) All attempts maintained the same 5-way join order without exploring semi-join reductions or fact-table projection pushdown. DuckDB's optimizer already implements predicate pushdown; manual CTEs just add overhead without changing the physical execution plan.",
  "unexplored": "1. **Semi-join transformation**: Convert dimension filters to EXISTS subqueries to enable bloom filter joins.\n2. **Column pruning**: Explicitly select only needed columns from each table to reduce memory bandwidth.\n3. **Aggregate pushdown**: Pre-aggregate store_sales by ss_item_sk before joining dimensions, since dimensions don't affect aggregates except via filtering.\n4. **OR transformation with materialization**: Materialize promotion keys satisfying OR condition once, then use for join.\n5. **Join reordering**: Force join order where smallest filtered dimensions (promotion, date_dim) reduce fact table first.",
  "refined_strategy": "Combine aggressive column pruning, semi-join filters for dimensions, and early aggregation on store_sales. First, create a minimal projection of store_sales with only required columns and pre-aggregate by ss_item_sk (since dimensions only filter, not group). Then use EXISTS-style semi-joins for date_dim and customer_demographics to create bloom filters. Materialize promotion keys as a small lookup table. Finally, join aggregated sales with item only (no other dimensions needed after filtering).",
  "examples": [
    "single_pass_aggregation",
    "or_to_union",
    "prefetch_fact_join"
  ],
  "hint": "Use CTE to pre-aggregate store_sales by item before dimension joins, with EXISTS subqueries for dimension filters, and materialize promotion OR condition as separate UNION ALL subquery. Explicitly select only needed columns."
}