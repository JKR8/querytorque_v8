```sql
WITH filtered_items AS (
  SELECT i_item_sk, i_item_id, i_item_desc, i_category, i_class, i_current_price
  FROM item
  WHERE i_category IN ('Sports', 'Music', 'Shoes')
), filtered_dates AS (
  SELECT d_date_sk
  FROM date_dim
  WHERE d_date BETWEEN CAST('2002-05-20' AS DATE) AND (
    CAST('2002-05-20' AS DATE) + INTERVAL '30' DAY
  )
), prefetched_sales AS (
  SELECT
    i.i_item_id,
    i.i_item_desc,
    i.i_category,
    i.i_class,
    i.i_current_price,
    ss.ss_ext_sales_price
  FROM store_sales ss
  JOIN filtered_items i ON ss.ss_item_sk = i.i_item_sk
  JOIN filtered_dates d ON ss.ss_sold_date_sk = d.d_date_sk
), aggregated AS (
  SELECT
    i_item_id,
    i_item_desc,
    i_category,
    i_class,
    i_current_price,
    SUM(ss_ext_sales_price) AS itemrevenue
  FROM prefetched_sales
  GROUP BY
    i_item_id,
    i_item_desc,
    i_category,
    i_class,
    i_current_price
)
SELECT
  i_item_id,
  i_item_desc,
  i_category,
  i_class,
  i_current_price,
  itemrevenue,
  itemrevenue * 100 / SUM(itemrevenue) OVER (PARTITION BY i_class) AS revenueratio
FROM aggregated
ORDER BY
  i_category,
  i_class,
  i_item_id,
  i_item_desc,
  revenueratio
```

**Changes**: Restructured joins using CTE pipeline: first filter dimension tables (items and dates), then pre-join with fact table to reduce intermediate data, compute aggregation in a single pass, and defer window function computation until final SELECT.

**Expected speedup**: 2-3x from reduced join cardinality and deferred window computation.