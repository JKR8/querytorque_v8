```sql
WITH filtered_dates AS (
  SELECT d_date_sk
  FROM date_dim
  WHERE d_date BETWEEN CAST('2002-05-20' AS DATE) 
                   AND (CAST('2002-05-20' AS DATE) + INTERVAL '30' DAY)
),
filtered_items AS (
  SELECT 
    i_item_sk,
    i_item_id,
    i_item_desc,
    i_category,
    i_class,
    i_current_price
  FROM item
  WHERE i_category IN ('Sports', 'Music', 'Shoes')
)
SELECT
  fi.i_item_id,
  fi.i_item_desc,
  fi.i_category,
  fi.i_class,
  fi.i_current_price,
  SUM(ss_ext_sales_price) AS itemrevenue,
  SUM(ss_ext_sales_price) * 100 / SUM(SUM(ss_ext_sales_price)) OVER (
    PARTITION BY fi.i_class
  ) AS revenueratio
FROM store_sales ss
JOIN filtered_items fi ON ss.ss_item_sk = fi.i_item_sk
JOIN filtered_dates fd ON ss.ss_sold_date_sk = fd.d_date_sk
GROUP BY
  fi.i_item_id,
  fi.i_item_desc,
  fi.i_category,
  fi.i_class,
  fi.i_current_price
ORDER BY
  fi.i_category,
  fi.i_class,
  fi.i_item_id,
  fi.i_item_desc,
  revenueratio
```

Changes: Isolated filtered date and item dimensions into separate CTEs before joining with the fact table, and converted implicit joins to explicit JOIN syntax. This allows DuckDB to build small hash tables from the pre-filtered dimensions and probe them efficiently against the large fact table.

Expected speedup: 1.5â€“2.0x