```sql
WITH filtered_dates AS (
  SELECT d_date_sk
  FROM date_dim
  WHERE d_year IN (1999, 2000)
),
store_sales_filtered AS (
  SELECT
    c_customer_id,
    c_first_name,
    c_last_name,
    d_year,
    STDDEV_SAMP(ss_net_paid) AS year_total,
    's' AS sale_type
  FROM customer
  JOIN store_sales ON c_customer_sk = ss_customer_sk
  JOIN filtered_dates ON ss_sold_date_sk = d_date_sk
  GROUP BY
    c_customer_id,
    c_first_name,
    c_last_name,
    d_year
),
web_sales_filtered AS (
  SELECT
    c_customer_id,
    c_first_name,
    c_last_name,
    d_year,
    STDDEV_SAMP(ws_net_paid) AS year_total,
    'w' AS sale_type
  FROM customer
  JOIN web_sales ON c_customer_sk = ws_bill_customer_sk
  JOIN filtered_dates ON ws_sold_date_sk = d_date_sk
  GROUP BY
    c_customer_id,
    c_first_name,
    c_last_name,
    d_year
),
store_1999 AS (
  SELECT * FROM store_sales_filtered WHERE d_year = 1999
),
store_2000 AS (
  SELECT * FROM store_sales_filtered WHERE d_year = 2000
),
web_1999 AS (
  SELECT * FROM web_sales_filtered WHERE d_year = 1999
),
web_2000 AS (
  SELECT * FROM web_sales_filtered WHERE d_year = 2000
)
SELECT
  s2.customer_id,
  s2.customer_first_name,
  s2.customer_last_name
FROM store_1999 s1
JOIN store_2000 s2 ON s1.customer_id = s2.customer_id
JOIN web_1999 w1 ON s1.customer_id = w1.customer_id
JOIN web_2000 w2 ON s1.customer_id = w2.customer_id
WHERE
  s1.year_total > 0
  AND w1.year_total > 0
  AND (CASE WHEN w1.year_total > 0 THEN w2.year_total / w1.year_total ELSE NULL END) >
      (CASE WHEN s1.year_total > 0 THEN s2.year_total / s1.year_total ELSE NULL END)
ORDER BY
  2, 1, 3
LIMIT 100
```

**Changes**: Created separate CTEs for date filtering, store sales, and web sales. Split the UNION ALL into independent channel CTEs with early year filtering. Replaced the 4-way self-join with direct joins between pre-filtered year/channel CTEs.

**Expected speedup**: 2-3x from reduced intermediate data, early filtering, and more efficient join patterns.