```sql
WITH filtered_household_demographics AS (
  SELECT hd_demo_sk
  FROM household_demographics
  WHERE hd_dep_count = 2
), filtered_web_page AS (
  SELECT wp_web_page_sk
  FROM web_page
  WHERE wp_char_count BETWEEN 5000 AND 5200
), time_am AS (
  SELECT t_time_sk
  FROM time_dim
  WHERE t_hour BETWEEN 10 AND 10 + 1
), time_pm AS (
  SELECT t_time_sk
  FROM time_dim
  WHERE t_hour BETWEEN 16 AND 16 + 1
), am_counts AS (
  SELECT COUNT(*) AS amc
  FROM web_sales
  JOIN time_am ON ws_sold_time_sk = time_am.t_time_sk
  JOIN filtered_household_demographics ON ws_ship_hdemo_sk = filtered_household_demographics.hd_demo_sk
  JOIN filtered_web_page ON ws_web_page_sk = filtered_web_page.wp_web_page_sk
), pm_counts AS (
  SELECT COUNT(*) AS pmc
  FROM web_sales
  JOIN time_pm ON ws_sold_time_sk = time_pm.t_time_sk
  JOIN filtered_household_demographics ON ws_ship_hdemo_sk = filtered_household_demographics.hd_demo_sk
  JOIN filtered_web_page ON ws_web_page_sk = filtered_web_page.wp_web_page_sk
)
SELECT
  CAST(amc AS DECIMAL(15, 4)) / CAST(pmc AS DECIMAL(15, 4)) AS am_pm_ratio
FROM am_counts, pm_counts
ORDER BY am_pm_ratio
LIMIT 100
```

Changes: Isolated dimension tables (household_demographics, web_page, time_dim) into separate CTEs with filters applied early, then reused them in both AM and PM subqueries. Converted implicit joins to explicit JOIN syntax for better optimizer control.

Expected speedup: 1.5â€“2x due to early filtering of dimension tables into small hash tables that can be probed efficiently during fact table joins.