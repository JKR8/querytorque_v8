```sql
WITH 
-- 1. Highly restricted customer set (address + demographics)
filtered_customers AS (
    SELECT 
        c.c_customer_sk,
        c.c_current_cdemo_sk,
        cd.cd_gender,
        cd.cd_marital_status,
        cd.cd_education_status,
        cd.cd_purchase_estimate,
        cd.cd_credit_rating
    FROM customer AS c
    JOIN customer_address AS ca 
        ON c.c_current_addr_sk = ca.ca_address_sk
    JOIN customer_demographics AS cd 
        ON cd.cd_demo_sk = c.c_current_cdemo_sk
    WHERE ca.ca_state IN ('TX', 'VA', 'MI')
),

-- 2. Single-pass flag aggregation per customer
customer_channel_flags AS (
    -- Store sales (must exist)
    SELECT 
        fc.c_customer_sk,
        1 AS has_store,
        0 AS has_web,
        0 AS has_catalog
    FROM filtered_customers fc
    JOIN store_sales ss 
        ON fc.c_customer_sk = ss.ss_customer_sk
    JOIN date_dim d 
        ON ss.ss_sold_date_sk = d.d_date_sk
    WHERE d.d_year = 2000 
        AND d.d_moy BETWEEN 1 AND 1 + 2
    GROUP BY fc.c_customer_sk
    
    UNION ALL
    
    -- Web sales (must not exist)
    SELECT 
        fc.c_customer_sk,
        0 AS has_store,
        1 AS has_web,
        0 AS has_catalog
    FROM filtered_customers fc
    JOIN web_sales ws 
        ON fc.c_customer_sk = ws.ws_bill_customer_sk
    JOIN date_dim d 
        ON ws.ws_sold_date_sk = d.d_date_sk
    WHERE d.d_year = 2000 
        AND d.d_moy BETWEEN 1 AND 1 + 2
    GROUP BY fc.c_customer_sk
    
    UNION ALL
    
    -- Catalog sales (must not exist)
    SELECT 
        fc.c_customer_sk,
        0 AS has_store,
        0 AS has_web,
        1 AS has_catalog
    FROM filtered_customers fc
    JOIN catalog_sales cs 
        ON fc.c_customer_sk = cs.cs_ship_customer_sk
    JOIN date_dim d 
        ON cs.cs_sold_date_sk = d.d_date_sk
    WHERE d.d_year = 2000 
        AND d.d_moy BETWEEN 1 AND 1 + 2
    GROUP BY fc.c_customer_sk
),

-- 3. Aggregate flags per customer
customer_flags AS (
    SELECT 
        c_customer_sk,
        MAX(has_store) AS has_store,
        MAX(has_web) AS has_web,
        MAX(has_catalog) AS has_catalog
    FROM customer_channel_flags
    GROUP BY c_customer_sk
),

-- 4. Customers matching the exact channel criteria
qualified_customers AS (
    SELECT 
        fc.cd_gender,
        fc.cd_marital_status,
        fc.cd_education_status,
        fc.cd_purchase_estimate,
        fc.cd_credit_rating
    FROM filtered_customers fc
    JOIN customer_flags cf 
        ON fc.c_customer_sk = cf.c_customer_sk
    WHERE cf.has_store = 1 
        AND cf.has_web = 0 
        AND cf.has_catalog = 0
)

-- 5. Final aggregation (no repeated joins)
SELECT
    cd_gender,
    cd_marital_status,
    cd_education_status,
    COUNT(*) AS cnt1,
    cd_purchase_estimate,
    COUNT(*) AS cnt2,
    cd_credit_rating,
    COUNT(*) AS cnt3
FROM qualified_customers
GROUP BY
    cd_gender,
    cd_marital_status,
    cd_education_status,
    cd_purchase_estimate,
    cd_credit_rating
ORDER BY
    cd_gender,
    cd_marital_status,
    cd_education_status,
    cd_purchase_estimate,
    cd_credit_rating
LIMIT 100;
```

**Changes**: Restructured query to first create a highly restricted customer set using address and demographic filters, then computed channel existence flags per customer via UNION ALL with early filtering, aggregated flags to identify customers with only store sales, and finally performed demographic grouping on this pre-filtered set. This eliminates correlated subqueries and ensures fact tables are scanned only for relevant customers.

**Expected speedup**: 3-4x due to early fact table restriction and elimination of correlated subqueries.