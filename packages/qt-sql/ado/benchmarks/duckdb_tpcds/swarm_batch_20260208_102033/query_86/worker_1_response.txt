```sql
WITH filtered_dates AS (
    SELECT d_date_sk
    FROM date_dim
    WHERE d_month_seq BETWEEN 1224 AND 1224 + 11
),
sales_with_categories AS (
    SELECT 
        ws_net_paid,
        i_category,
        i_class
    FROM web_sales
    JOIN filtered_dates ON d_date_sk = ws_sold_date_sk
    JOIN item ON i_item_sk = ws_item_sk
)
SELECT
    SUM(ws_net_paid) AS total_sum,
    i_category,
    i_class,
    GROUPING(i_category) + GROUPING(i_class) AS lochierarchy,
    RANK() OVER (
        PARTITION BY GROUPING(i_category) + GROUPING(i_class), 
                     CASE WHEN GROUPING(i_class) = 0 THEN i_category END
        ORDER BY SUM(ws_net_paid) DESC
    ) AS rank_within_parent
FROM sales_with_categories
GROUP BY ROLLUP(i_category, i_class)
ORDER BY
    lochierarchy DESC,
    CASE WHEN lochierarchy = 0 THEN i_category END,
    rank_within_parent
LIMIT 100
```

```
Changes: Created two CTEs to isolate date filtering and join computation, pushing the date filter down before joining with the large fact table.
Expected speedup: 1.5-2x by reducing the web_sales scan to only rows matching the date range, avoiding repeated filtering during aggregation.
```

**Explanation:**
1. **Isolated date filter first**: Created `filtered_dates` CTE to select only the needed date keys, reducing the dimension table early.
2. **Consolidated joins**: Created `sales_with_categories` CTE to join web_sales with both filtered dates and items in one pass, materializing the base dataset with all needed columns.
3. **Preserved semantics**: Maintained the exact ROLLUP aggregation, window function, and ordering logic unchanged.
4. **Safe pushdown**: The date filter is applied before joining with the large web_sales table, significantly reducing the join size while preserving all needed columns for downstream operations.