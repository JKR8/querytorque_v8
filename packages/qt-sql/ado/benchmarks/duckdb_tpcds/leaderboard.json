{
  "benchmark": "tpcds",
  "engine": "duckdb",
  "scale_factor": 10,
  "updated_at": "2026-02-07T19:40:03.406408",
  "summary": {
    "total": 100,
    "wins": 31,
    "improved": 8,
    "neutral": 21,
    "regression": 26,
    "errors": 14,
    "avg_speedup": 1.085
  },
  "queries": [
    {
      "query_id": "q88",
      "status": "WIN",
      "speedup": 3.3224,
      "original_ms": 250.71,
      "optimized_ms": 75.46,
      "original_times": [
        252.52,
        251.68,
        249.74
      ],
      "optimized_times": [
        72.68,
        77.93,
        72.99
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "materialize_cte"
      ],
      "original_sql": "-- start query 88 in stream 0 using template query88.tpl\nselect  *\nfrom\n (select count(*) h8_30_to_9\n from store_sales, household_demographics , time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk   \n     and ss_hdemo_sk = household_demographics.hd_demo_sk \n     and ss_store_sk = s_store_sk\n     and time_dim.t_hour = 8\n     and time_dim.t_minute >= 30\n     and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n          (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n          (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2)) \n     and store.s_store_name = 'ese') s1,\n (select count(*) h9_to_9_30 \n from store_sales, household_demographics , time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n     and ss_hdemo_sk = household_demographics.hd_demo_sk\n     and ss_store_sk = s_store_sk \n     and time_dim.t_hour = 9 \n     and time_dim.t_minute < 30\n     and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n          (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n          (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n     and store.s_store_name = 'ese') s2,\n (select count(*) h9_30_to_10 \n from store_sales, household_demographics , time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n     and ss_hdemo_sk = household_demographics.hd_demo_sk\n     and ss_store_sk = s_store_sk\n     and time_dim.t_hour = 9\n     and time_dim.t_minute >= 30\n     and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n          (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n          (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n     and store.s_store_name = 'ese') s3,\n (select count(*) h10_to_10_30\n from store_sales, household_demographics , time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n     and ss_hdemo_sk = household_demographics.hd_demo_sk\n     and ss_store_sk = s_store_sk\n     and time_dim.t_hour = 10 \n     and time_dim.t_minute < 30\n     and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n          (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n          (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n     and store.s_store_name = 'ese') s4,\n (select count(*) h10_30_to_11\n from store_sales, household_demographics , time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n     and ss_hdemo_sk = household_demographics.hd_demo_sk\n     and ss_store_sk = s_store_sk\n     and time_dim.t_hour = 10 \n     and time_dim.t_minute >= 30\n     and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n          (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n          (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n     and store.s_store_name = 'ese') s5,\n (select count(*) h11_to_11_30\n from store_sales, household_demographics , time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n     and ss_hdemo_sk = household_demographics.hd_demo_sk\n     and ss_store_sk = s_store_sk \n     and time_dim.t_hour = 11\n     and time_dim.t_minute < 30\n     and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n          (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n          (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n     and store.s_store_name = 'ese') s6,\n (select count(*) h11_30_to_12\n from store_sales, household_demographics , time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n     and ss_hdemo_sk = household_demographics.hd_demo_sk\n     and ss_store_sk = s_store_sk\n     and time_dim.t_hour = 11\n     and time_dim.t_minute >= 30\n     and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n          (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n          (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n     and store.s_store_name = 'ese') s7,\n (select count(*) h12_to_12_30\n from store_sales, household_demographics , time_dim, store\n where ss_sold_time_sk = time_dim.t_time_sk\n     and ss_hdemo_sk = household_demographics.hd_demo_sk\n     and ss_store_sk = s_store_sk\n     and time_dim.t_hour = 12\n     and time_dim.t_minute < 30\n     and ((household_demographics.hd_dep_count = -1 and household_demographics.hd_vehicle_count<=-1+2) or\n          (household_demographics.hd_dep_count = 4 and household_demographics.hd_vehicle_count<=4+2) or\n          (household_demographics.hd_dep_count = 3 and household_demographics.hd_vehicle_count<=3+2))\n     and store.s_store_name = 'ese') s8\n;\n\n-- end query 88 in stream 0 using template query88.tpl\n",
      "optimized_sql": "WITH filtered_store AS (SELECT s_store_sk FROM store WHERE s_store_name = 'ese'), filtered_hh AS (SELECT hd_demo_sk FROM household_demographics WHERE (hd_dep_count = 4 AND hd_vehicle_count <= 6) OR (hd_dep_count = 2 AND hd_vehicle_count <= 4) OR (hd_dep_count = 0 AND hd_vehicle_count <= 2)), time_slots AS (SELECT t_time_sk, CASE WHEN t_hour = 8 AND t_minute >= 30 THEN 1 WHEN t_hour = 9 AND t_minute < 30 THEN 2 WHEN t_hour = 9 AND t_minute >= 30 THEN 3 WHEN t_hour = 10 AND t_minute < 30 THEN 4 WHEN t_hour = 10 AND t_minute >= 30 THEN 5 WHEN t_hour = 11 AND t_minute < 30 THEN 6 WHEN t_hour = 11 AND t_minute >= 30 THEN 7 WHEN t_hour = 12 AND t_minute < 30 THEN 8 END AS time_slot FROM time_dim WHERE (t_hour = 8 AND t_minute >= 30) OR (t_hour = 9) OR (t_hour = 10) OR (t_hour = 11) OR (t_hour = 12 AND t_minute < 30)), qualified_sales AS (SELECT ss.sales_price, ts.time_slot FROM (SELECT ss_sold_time_sk, ss_hdemo_sk, ss_store_sk, 1 AS sales_price FROM store_sales) AS ss JOIN time_slots AS ts ON ss.ss_sold_time_sk = ts.t_time_sk JOIN filtered_hh AS hh ON ss.ss_hdemo_sk = hh.hd_demo_sk JOIN filtered_store AS s ON ss.ss_store_sk = s.s_store_sk WHERE NOT ts.time_slot IS NULL)\nSELECT SUM(CASE WHEN time_slot = 1 THEN sales_price END) AS h8_30_to_9, SUM(CASE WHEN time_slot = 2 THEN sales_price END) AS h9_to_9_30, SUM(CASE WHEN time_slot = 3 THEN sales_price END) AS h9_30_to_10, SUM(CASE WHEN time_slot = 4 THEN sales_price END) AS h10_to_10_30, SUM(CASE WHEN time_slot = 5 THEN sales_price END) AS h10_30_to_11, SUM(CASE WHEN time_slot = 6 THEN sales_price END) AS h11_to_11_30, SUM(CASE WHEN time_slot = 7 THEN sales_price END) AS h11_30_to_12, SUM(CASE WHEN time_slot = 8 THEN sales_price END) AS h12_to_12_30 FROM qualified_sales",
      "error": null
    },
    {
      "query_id": "q4",
      "status": "WIN",
      "speedup": 2.91,
      "original_ms": 1694.5,
      "optimized_ms": 582.9,
      "original_times": [
        3551.5,
        1572.7,
        1816.4
      ],
      "optimized_times": [
        667.2,
        634.5,
        531.3
      ],
      "rows_match": true,
      "source": "analyst_mode",
      "transforms": [],
      "original_sql": "-- start query 4 in stream 0 using template query4.tpl\nwith year_total as (\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,c_preferred_cust_flag customer_preferred_cust_flag\n       ,c_birth_country customer_birth_country\n       ,c_login customer_login\n       ,c_email_address customer_email_address\n       ,d_year dyear\n       ,sum(((ss_ext_list_price-ss_ext_wholesale_cost-ss_ext_discount_amt)+ss_ext_sales_price)/2) year_total\n       ,'s' sale_type\n from customer\n     ,store_sales\n     ,date_dim\n where c_customer_sk = ss_customer_sk\n   and ss_sold_date_sk = d_date_sk\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,c_preferred_cust_flag\n         ,c_birth_country\n         ,c_login\n         ,c_email_address\n         ,d_year\n union all\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,c_preferred_cust_flag customer_preferred_cust_flag\n       ,c_birth_country customer_birth_country\n       ,c_login customer_login\n       ,c_email_address customer_email_address\n       ,d_year dyear\n       ,sum((((cs_ext_list_price-cs_ext_wholesale_cost-cs_ext_discount_amt)+cs_ext_sales_price)/2) ) year_total\n       ,'c' sale_type\n from customer\n     ,catalog_sales\n     ,date_dim\n where c_customer_sk = cs_bill_customer_sk\n   and cs_sold_date_sk = d_date_sk\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,c_preferred_cust_flag\n         ,c_birth_country\n         ,c_login\n         ,c_email_address\n         ,d_year\nunion all\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,c_preferred_cust_flag customer_preferred_cust_flag\n       ,c_birth_country customer_birth_country\n       ,c_login customer_login\n       ,c_email_address customer_email_address\n       ,d_year dyear\n       ,sum((((ws_ext_list_price-ws_ext_wholesale_cost-ws_ext_discount_amt)+ws_ext_sales_price)/2) ) year_total\n       ,'w' sale_type\n from customer\n     ,web_sales\n     ,date_dim\n where c_customer_sk = ws_bill_customer_sk\n   and ws_sold_date_sk = d_date_sk\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,c_preferred_cust_flag\n         ,c_birth_country\n         ,c_login\n         ,c_email_address\n         ,d_year\n         )\n  select \n                  t_s_secyear.customer_id\n                 ,t_s_secyear.customer_first_name\n                 ,t_s_secyear.customer_last_name\n                 ,t_s_secyear.customer_birth_country\n from year_total t_s_firstyear\n     ,year_total t_s_secyear\n     ,year_total t_c_firstyear\n     ,year_total t_c_secyear\n     ,year_total t_w_firstyear\n     ,year_total t_w_secyear\n where t_s_secyear.customer_id = t_s_firstyear.customer_id\n   and t_s_firstyear.customer_id = t_c_secyear.customer_id\n   and t_s_firstyear.customer_id = t_c_firstyear.customer_id\n   and t_s_firstyear.customer_id = t_w_firstyear.customer_id\n   and t_s_firstyear.customer_id = t_w_secyear.customer_id\n   and t_s_firstyear.sale_type = 's'\n   and t_c_firstyear.sale_type = 'c'\n   and t_w_firstyear.sale_type = 'w'\n   and t_s_secyear.sale_type = 's'\n   and t_c_secyear.sale_type = 'c'\n   and t_w_secyear.sale_type = 'w'\n   and t_s_firstyear.dyear =  1999\n   and t_s_secyear.dyear = 1999+1\n   and t_c_firstyear.dyear =  1999\n   and t_c_secyear.dyear =  1999+1\n   and t_w_firstyear.dyear = 1999\n   and t_w_secyear.dyear = 1999+1\n   and t_s_firstyear.year_total > 0\n   and t_c_firstyear.year_total > 0\n   and t_w_firstyear.year_total > 0\n   and case when t_c_firstyear.year_total > 0 then t_c_secyear.year_total / t_c_firstyear.year_total else null end\n           > case when t_s_firstyear.year_total > 0 then t_s_secyear.year_total / t_s_firstyear.year_total else null end\n   and case when t_c_firstyear.year_total > 0 then t_c_secyear.year_total / t_c_firstyear.year_total else null end\n           > case when t_w_firstyear.year_total > 0 then t_w_secyear.year_total / t_w_firstyear.year_total else null end\n order by t_s_secyear.customer_id\n         ,t_s_secyear.customer_first_name\n         ,t_s_secyear.customer_last_name\n         ,t_s_secyear.customer_birth_country\n LIMIT 100;\n\n-- end query 4 in stream 0 using template query4.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (\n  SELECT d_date_sk, d_year\n  FROM date_dim\n  WHERE d_year IN (1999, 2000)\n),\nstore_totals AS (\n  SELECT\n    c.c_customer_id AS customer_id,\n    d.d_year AS dyear,\n    SUM(((ss_ext_list_price - ss_ext_wholesale_cost - ss_ext_discount_amt) + ss_ext_sales_price) / 2) AS year_total\n  FROM customer c\n  JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk\n  JOIN filtered_dates d ON ss.ss_sold_date_sk = d.d_date_sk\n  GROUP BY c.c_customer_id, d.d_year\n),\ncatalog_totals AS (\n  SELECT\n    c.c_customer_id AS customer_id,\n    d.d_year AS dyear,\n    SUM(((cs_ext_list_price - cs_ext_wholesale_cost - cs_ext_discount_amt) + cs_ext_sales_price) / 2) AS year_total\n  FROM customer c\n  JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk\n  JOIN filtered_dates d ON cs.cs_sold_date_sk = d.d_date_sk\n  GROUP BY c.c_customer_id, d.d_year\n),\nweb_totals AS (\n  SELECT\n    c.c_customer_id AS customer_id,\n    d.d_year AS dyear,\n    SUM(((ws_ext_list_price - ws_ext_wholesale_cost - ws_ext_discount_amt) + ws_ext_sales_price) / 2) AS year_total\n  FROM customer c\n  JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk\n  JOIN filtered_dates d ON ws.ws_sold_date_sk = d.d_date_sk\n  GROUP BY c.c_customer_id, d.d_year\n),\npivoted AS (\n  SELECT\n    customer_id,\n    MAX(CASE WHEN channel = 's' AND dyear = 1999 THEN year_total END) AS s_1999,\n    MAX(CASE WHEN channel = 's' AND dyear = 2000 THEN year_total END) AS s_2000,\n    MAX(CASE WHEN channel = 'c' AND dyear = 1999 THEN year_total END) AS c_1999,\n    MAX(CASE WHEN channel = 'c' AND dyear = 2000 THEN year_total END) AS c_2000,\n    MAX(CASE WHEN channel = 'w' AND dyear = 1999 THEN year_total END) AS w_1999,\n    MAX(CASE WHEN channel = 'w' AND dyear = 2000 THEN year_total END) AS w_2000\n  FROM (\n    SELECT customer_id, dyear, year_total, 's' AS channel FROM store_totals\n    UNION ALL\n    SELECT customer_id, dyear, year_total, 'c' AS channel FROM catalog_totals\n    UNION ALL\n    SELECT customer_id, dyear, year_total, 'w' AS channel FROM web_totals\n  ) t\n  GROUP BY customer_id\n)\nSELECT\n  c.c_customer_id AS customer_id,\n  c.c_first_name AS customer_first_name,\n  c.c_last_name AS customer_last_name,\n  c.c_birth_country AS customer_birth_country\nFROM pivoted p\nJOIN customer c ON p.customer_id = c.c_customer_id\nWHERE\n  p.s_1999 > 0\n  AND p.c_1999 > 0\n  AND p.w_1999 > 0\n  AND p.c_2000 / p.c_1999 > p.s_2000 / p.s_1999\n  AND p.c_2000 / p.c_1999 > p.w_2000 / p.w_1999\nORDER BY\n  c.c_customer_id,\n  c.c_first_name,\n  c.c_last_name,\n  c.c_birth_country\nLIMIT 100",
      "error": null
    },
    {
      "query_id": "q35",
      "status": "WIN",
      "speedup": 2.4217,
      "original_ms": 214.38,
      "optimized_ms": 88.53,
      "original_times": [
        213.09,
        208.59,
        220.17
      ],
      "optimized_times": [
        101.25,
        86.16,
        90.89
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 35 in stream 0 using template query35.tpl\nselect  \n  ca_state,\n  cd_gender,\n  cd_marital_status,\n  cd_dep_count,\n  count(*) cnt1,\n  max(cd_dep_count),\n  sum(cd_dep_count),\n  max(cd_dep_count),\n  cd_dep_employed_count,\n  count(*) cnt2,\n  max(cd_dep_employed_count),\n  sum(cd_dep_employed_count),\n  max(cd_dep_employed_count),\n  cd_dep_college_count,\n  count(*) cnt3,\n  max(cd_dep_college_count),\n  sum(cd_dep_college_count),\n  max(cd_dep_college_count)\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  cd_demo_sk = c.c_current_cdemo_sk and \n  exists (select *\n          from store_sales,date_dim\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 2001 and\n                d_qoy < 4) and\n   (exists (select *\n            from web_sales,date_dim\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 2001 and\n                  d_qoy < 4) or \n    exists (select * \n            from catalog_sales,date_dim\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 2001 and\n                  d_qoy < 4))\n group by ca_state,\n          cd_gender,\n          cd_marital_status,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\n order by ca_state,\n          cd_gender,\n          cd_marital_status,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\n LIMIT 100;\n\n-- end query 35 in stream 0 using template query35.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001 AND d_qoy < 4), store_customers AS (SELECT DISTINCT ss_customer_sk AS customer_sk FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk), web_customers AS (SELECT DISTINCT ws_bill_customer_sk AS customer_sk FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk), catalog_customers AS (SELECT DISTINCT cs_ship_customer_sk AS customer_sk FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk), branch_web AS (SELECT ca.ca_state, cd.cd_gender, cd.cd_marital_status, cd.cd_dep_count, cd.cd_dep_employed_count, cd.cd_dep_college_count FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics AS cd ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN store_customers AS sc ON c.c_customer_sk = sc.customer_sk JOIN web_customers AS wc ON c.c_customer_sk = wc.customer_sk), branch_catalog AS (SELECT ca.ca_state, cd.cd_gender, cd.cd_marital_status, cd.cd_dep_count, cd.cd_dep_employed_count, cd.cd_dep_college_count FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics AS cd ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN store_customers AS sc ON c.c_customer_sk = sc.customer_sk JOIN catalog_customers AS cc ON c.c_customer_sk = cc.customer_sk), combined_customers AS (SELECT * FROM branch_web UNION ALL SELECT * FROM branch_catalog)\nSELECT ca_state, cd_gender, cd_marital_status, cd_dep_count, COUNT(*) AS cnt1, MAX(cd_dep_count), SUM(cd_dep_count), MAX(cd_dep_count), cd_dep_employed_count, COUNT(*) AS cnt2, MAX(cd_dep_employed_count), SUM(cd_dep_employed_count), MAX(cd_dep_employed_count), cd_dep_college_count, COUNT(*) AS cnt3, MAX(cd_dep_college_count), SUM(cd_dep_college_count), MAX(cd_dep_college_count) FROM combined_customers GROUP BY ca_state, cd_gender, cd_marital_status, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY ca_state, cd_gender, cd_marital_status, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100",
      "error": null
    },
    {
      "query_id": "q59",
      "status": "WIN",
      "speedup": 1.6777,
      "original_ms": 352.95,
      "optimized_ms": 210.37,
      "original_times": [
        378.73,
        368.4,
        337.5
      ],
      "optimized_times": [
        226.77,
        214.33,
        206.42
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "pushdown"
      ],
      "original_sql": "-- start query 59 in stream 0 using template query59.tpl\nwith wss as \n (select d_week_seq,\n        ss_store_sk,\n        sum(case when (d_day_name='Sunday') then ss_sales_price else null end) sun_sales,\n        sum(case when (d_day_name='Monday') then ss_sales_price else null end) mon_sales,\n        sum(case when (d_day_name='Tuesday') then ss_sales_price else  null end) tue_sales,\n        sum(case when (d_day_name='Wednesday') then ss_sales_price else null end) wed_sales,\n        sum(case when (d_day_name='Thursday') then ss_sales_price else null end) thu_sales,\n        sum(case when (d_day_name='Friday') then ss_sales_price else null end) fri_sales,\n        sum(case when (d_day_name='Saturday') then ss_sales_price else null end) sat_sales\n from store_sales,date_dim\n where d_date_sk = ss_sold_date_sk\n group by d_week_seq,ss_store_sk\n )\n  select s_store_name1,s_store_id1,d_week_seq1\n       ,sun_sales1/sun_sales2,mon_sales1/mon_sales2\n       ,tue_sales1/tue_sales2,wed_sales1/wed_sales2,thu_sales1/thu_sales2\n       ,fri_sales1/fri_sales2,sat_sales1/sat_sales2\n from\n (select s_store_name s_store_name1,wss.d_week_seq d_week_seq1\n        ,s_store_id s_store_id1,sun_sales sun_sales1\n        ,mon_sales mon_sales1,tue_sales tue_sales1\n        ,wed_sales wed_sales1,thu_sales thu_sales1\n        ,fri_sales fri_sales1,sat_sales sat_sales1\n  from wss,store,date_dim d\n  where d.d_week_seq = wss.d_week_seq and\n        ss_store_sk = s_store_sk and \n        d_month_seq between 1196 and 1196 + 11) y,\n (select s_store_name s_store_name2,wss.d_week_seq d_week_seq2\n        ,s_store_id s_store_id2,sun_sales sun_sales2\n        ,mon_sales mon_sales2,tue_sales tue_sales2\n        ,wed_sales wed_sales2,thu_sales thu_sales2\n        ,fri_sales fri_sales2,sat_sales sat_sales2\n  from wss,store,date_dim d\n  where d.d_week_seq = wss.d_week_seq and\n        ss_store_sk = s_store_sk and \n        d_month_seq between 1196+ 12 and 1196 + 23) x\n where s_store_id1=s_store_id2\n   and d_week_seq1=d_week_seq2-52\n order by s_store_name1,s_store_id1,d_week_seq1\n LIMIT 100;\n\n-- end query 59 in stream 0 using template query59.tpl\n",
      "optimized_sql": "WITH wss_year1 AS (SELECT d_week_seq, ss_store_sk, SUM(CASE WHEN (d_day_name = 'Sunday') THEN ss_sales_price ELSE NULL END) AS sun_sales, SUM(CASE WHEN (d_day_name = 'Monday') THEN ss_sales_price ELSE NULL END) AS mon_sales, SUM(CASE WHEN (d_day_name = 'Tuesday') THEN ss_sales_price ELSE NULL END) AS tue_sales, SUM(CASE WHEN (d_day_name = 'Wednesday') THEN ss_sales_price ELSE NULL END) AS wed_sales, SUM(CASE WHEN (d_day_name = 'Thursday') THEN ss_sales_price ELSE NULL END) AS thu_sales, SUM(CASE WHEN (d_day_name = 'Friday') THEN ss_sales_price ELSE NULL END) AS fri_sales, SUM(CASE WHEN (d_day_name = 'Saturday') THEN ss_sales_price ELSE NULL END) AS sat_sales FROM store_sales, date_dim WHERE d_date_sk = ss_sold_date_sk AND d_month_seq BETWEEN 1196 AND 1196 + 11 GROUP BY d_week_seq, ss_store_sk), wss_year2 AS (SELECT d_week_seq, ss_store_sk, SUM(CASE WHEN (d_day_name = 'Sunday') THEN ss_sales_price ELSE NULL END) AS sun_sales, SUM(CASE WHEN (d_day_name = 'Monday') THEN ss_sales_price ELSE NULL END) AS mon_sales, SUM(CASE WHEN (d_day_name = 'Tuesday') THEN ss_sales_price ELSE NULL END) AS tue_sales, SUM(CASE WHEN (d_day_name = 'Wednesday') THEN ss_sales_price ELSE NULL END) AS wed_sales, SUM(CASE WHEN (d_day_name = 'Thursday') THEN ss_sales_price ELSE NULL END) AS thu_sales, SUM(CASE WHEN (d_day_name = 'Friday') THEN ss_sales_price ELSE NULL END) AS fri_sales, SUM(CASE WHEN (d_day_name = 'Saturday') THEN ss_sales_price ELSE NULL END) AS sat_sales FROM store_sales, date_dim WHERE d_date_sk = ss_sold_date_sk AND d_month_seq BETWEEN 1196 + 12 AND 1196 + 23 GROUP BY d_week_seq, ss_store_sk), wss AS (SELECT d_week_seq, ss_store_sk, SUM(CASE WHEN (d_day_name = 'Sunday') THEN ss_sales_price ELSE NULL END) AS sun_sales, SUM(CASE WHEN (d_day_name = 'Monday') THEN ss_sales_price ELSE NULL END) AS mon_sales, SUM(CASE WHEN (d_day_name = 'Tuesday') THEN ss_sales_price ELSE NULL END) AS tue_sales, SUM(CASE WHEN (d_day_name = 'Wednesday') THEN ss_sales_price ELSE NULL END) AS wed_sales, SUM(CASE WHEN (d_day_name = 'Thursday') THEN ss_sales_price ELSE NULL END) AS thu_sales, SUM(CASE WHEN (d_day_name = 'Friday') THEN ss_sales_price ELSE NULL END) AS fri_sales, SUM(CASE WHEN (d_day_name = 'Saturday') THEN ss_sales_price ELSE NULL END) AS sat_sales FROM store_sales, date_dim WHERE d_date_sk = ss_sold_date_sk GROUP BY d_week_seq, ss_store_sk)\nSELECT s_store_name1, s_store_id1, d_week_seq1, sun_sales1 / sun_sales2, mon_sales1 / mon_sales2, tue_sales1 / tue_sales2, wed_sales1 / wed_sales2, thu_sales1 / thu_sales2, fri_sales1 / fri_sales2, sat_sales1 / sat_sales2 FROM (SELECT s_store_name AS s_store_name1, wss_year1.d_week_seq AS d_week_seq1, s_store_id AS s_store_id1, sun_sales AS sun_sales1, mon_sales AS mon_sales1, tue_sales AS tue_sales1, wed_sales AS wed_sales1, thu_sales AS thu_sales1, fri_sales AS fri_sales1, sat_sales AS sat_sales1 FROM wss_year1, store WHERE ss_store_sk = s_store_sk) AS y, (SELECT s_store_name AS s_store_name2, wss_year2.d_week_seq AS d_week_seq2, s_store_id AS s_store_id2, sun_sales AS sun_sales2, mon_sales AS mon_sales2, tue_sales AS tue_sales2, wed_sales AS wed_sales2, thu_sales AS thu_sales2, fri_sales AS fri_sales2, sat_sales AS sat_sales2 FROM wss_year2, store WHERE ss_store_sk = s_store_sk) AS x WHERE s_store_id1 = s_store_id2 AND d_week_seq1 = d_week_seq2 - 52 ORDER BY s_store_name1, s_store_id1, d_week_seq1 LIMIT 100",
      "error": null
    },
    {
      "query_id": "q41",
      "status": "WIN",
      "speedup": 1.6316,
      "original_ms": 21.81,
      "optimized_ms": 13.37,
      "original_times": [
        27.66,
        21.07,
        22.55
      ],
      "optimized_times": [
        13.67,
        13.92,
        12.82
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "or_to_union"
      ],
      "original_sql": "-- start query 41 in stream 0 using template query41.tpl\nselect distinct(i_product_name)\n from item i1\n where i_manufact_id between 748 and 748+40 \n   and (select count(*) as item_cnt\n        from item\n        where (i_manufact = i1.i_manufact and\n        ((i_category = 'Women' and \n        (i_color = 'gainsboro' or i_color = 'aquamarine') and \n        (i_units = 'Ounce' or i_units = 'Dozen') and\n        (i_size = 'medium' or i_size = 'economy')\n        ) or\n        (i_category = 'Women' and\n        (i_color = 'chiffon' or i_color = 'violet') and\n        (i_units = 'Ton' or i_units = 'Pound') and\n        (i_size = 'extra large' or i_size = 'small')\n        ) or\n        (i_category = 'Men' and\n        (i_color = 'chartreuse' or i_color = 'blue') and\n        (i_units = 'Each' or i_units = 'Oz') and\n        (i_size = 'N/A' or i_size = 'large')\n        ) or\n        (i_category = 'Men' and\n        (i_color = 'tan' or i_color = 'dodger') and\n        (i_units = 'Bunch' or i_units = 'Tsp') and\n        (i_size = 'medium' or i_size = 'economy')\n        ))) or\n       (i_manufact = i1.i_manufact and\n        ((i_category = 'Women' and \n        (i_color = 'blanched' or i_color = 'tomato') and \n        (i_units = 'Tbl' or i_units = 'Case') and\n        (i_size = 'medium' or i_size = 'economy')\n        ) or\n        (i_category = 'Women' and\n        (i_color = 'almond' or i_color = 'lime') and\n        (i_units = 'Box' or i_units = 'Dram') and\n        (i_size = 'extra large' or i_size = 'small')\n        ) or\n        (i_category = 'Men' and\n        (i_color = 'peru' or i_color = 'saddle') and\n        (i_units = 'Pallet' or i_units = 'Gram') and\n        (i_size = 'N/A' or i_size = 'large')\n        ) or\n        (i_category = 'Men' and\n        (i_color = 'indian' or i_color = 'spring') and\n        (i_units = 'Unknown' or i_units = 'Carton') and\n        (i_size = 'medium' or i_size = 'economy')\n        )))) > 0\n order by i_product_name\n LIMIT 100;\n\n-- end query 41 in stream 0 using template query41.tpl\n",
      "optimized_sql": "-- start query 41 in stream 0 using template query41.tpl\nselect distinct(i_product_name)\n from item i1\n where i_manufact_id between 748 and 748+40 \n   and (select count(*) as item_cnt\n        from item\n        where (i_manufact = i1.i_manufact and\n        ((i_category = 'Women' and \n        (i_color = 'gainsboro' or i_color = 'aquamarine') and \n        (i_units = 'Ounce' or i_units = 'Dozen') and\n        (i_size = 'medium' or i_size = 'economy')\n        ) or\n        (i_category = 'Women' and\n        (i_color = 'chiffon' or i_color = 'violet') and\n        (i_units = 'Ton' or i_units = 'Pound') and\n        (i_size = 'extra large' or i_size = 'small')\n        ) or\n        (i_category = 'Men' and\n        (i_color = 'chartreuse' or i_color = 'blue') and\n        (i_units = 'Each' or i_units = 'Oz') and\n        (i_size = 'N/A' or i_size = 'large')\n        ) or\n        (i_category = 'Men' and\n        (i_color = 'tan' or i_color = 'dodger') and\n        (i_units = 'Bunch' or i_units = 'Tsp') and\n        (i_size = 'medium' or i_size = 'economy')\n        ))) or\n       (i_manufact = i1.i_manufact and\n        ((i_category = 'Women' and \n        (i_color = 'blanched' or i_color = 'tomato') and \n        (i_units = 'Tbl' or i_units = 'Case') and\n        (i_size = 'medium' or i_size = 'economy')\n        ) or\n        (i_category = 'Women' and\n        (i_color = 'almond' or i_color = 'lime') and\n        (i_units = 'Box' or i_units = 'Dram') and\n        (i_size = 'extra large' or i_size = 'small')\n        ) or\n        (i_category = 'Men' and\n        (i_color = 'peru' or i_color = 'saddle') and\n        (i_units = 'Pallet' or i_units = 'Gram') and\n        (i_size = 'N/A' or i_size = 'large')\n        ) or\n        (i_category = 'Men' and\n        (i_color = 'indian' or i_color = 'spring') and\n        (i_units = 'Unknown' or i_units = 'Carton') and\n        (i_size = 'medium' or i_size = 'economy')\n        )))) > 0\n order by i_product_name\n LIMIT 100;\n\n-- end query 41 in stream 0 using template query41.tpl\n",
      "error": null
    },
    {
      "query_id": "q65",
      "status": "WIN",
      "speedup": 1.5981,
      "original_ms": 355.01,
      "optimized_ms": 222.14,
      "original_times": [
        339.93,
        350.36,
        359.65
      ],
      "optimized_times": [
        217.51,
        228.92,
        215.37
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 65 in stream 0 using template query65.tpl\nselect\n\ts_store_name,\n\ti_item_desc,\n\tsc.revenue,\n\ti_current_price,\n\ti_wholesale_cost,\n\ti_brand\n from store, item,\n     (select ss_store_sk, avg(revenue) as ave\n \tfrom\n \t    (select  ss_store_sk, ss_item_sk, \n \t\t     sum(ss_sales_price) as revenue\n \t\tfrom store_sales, date_dim\n \t\twhere ss_sold_date_sk = d_date_sk and d_month_seq between 1221 and 1221+11\n \t\tgroup by ss_store_sk, ss_item_sk) sa\n \tgroup by ss_store_sk) sb,\n     (select  ss_store_sk, ss_item_sk, sum(ss_sales_price) as revenue\n \tfrom store_sales, date_dim\n \twhere ss_sold_date_sk = d_date_sk and d_month_seq between 1221 and 1221+11\n \tgroup by ss_store_sk, ss_item_sk) sc\n where sb.ss_store_sk = sc.ss_store_sk and \n       sc.revenue <= 0.1 * sb.ave and\n       s_store_sk = sc.ss_store_sk and\n       i_item_sk = sc.ss_item_sk\n order by s_store_name, i_item_desc\n LIMIT 100;\n\n-- end query 65 in stream 0 using template query65.tpl\n",
      "optimized_sql": "WITH filtered_sales AS (SELECT ss.ss_store_sk, ss.ss_item_sk, ss.ss_sales_price FROM store_sales AS ss JOIN date_dim AS d ON ss.ss_sold_date_sk = d.d_date_sk WHERE d.d_month_seq BETWEEN 1221 AND 1221 + 11), item_revenue AS (SELECT ss_store_sk, ss_item_sk, SUM(ss_sales_price) AS revenue FROM filtered_sales GROUP BY ss_store_sk, ss_item_sk), store_avg AS (SELECT ss_store_sk, AVG(revenue) AS ave FROM item_revenue GROUP BY ss_store_sk)\nSELECT s.s_store_name, i.i_item_desc, ir.revenue, i.i_current_price, i.i_wholesale_cost, i.i_brand FROM item_revenue AS ir JOIN store_avg AS sb ON ir.ss_store_sk = sb.ss_store_sk JOIN store AS s ON s.s_store_sk = ir.ss_store_sk JOIN item AS i ON i.i_item_sk = ir.ss_item_sk WHERE ir.revenue <= 0.1 * sb.ave ORDER BY s.s_store_name, i.i_item_desc LIMIT 100",
      "error": null
    },
    {
      "query_id": "q27",
      "status": "WIN",
      "speedup": 1.5843,
      "original_ms": 177.32,
      "optimized_ms": 111.92,
      "original_times": [
        169.16,
        174.41,
        180.22
      ],
      "optimized_times": [
        120.18,
        114.25,
        109.59
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 27 in stream 0 using template query27.tpl\nselect i_item_id,\n        s_state, grouping(s_state) g_state,\n        avg(ss_quantity) agg1,\n        avg(ss_list_price) agg2,\n        avg(ss_coupon_amt) agg3,\n        avg(ss_sales_price) agg4\n from store_sales, customer_demographics, date_dim, store, item\n where ss_sold_date_sk = d_date_sk and\n       ss_item_sk = i_item_sk and\n       ss_store_sk = s_store_sk and\n       ss_cdemo_sk = cd_demo_sk and\n       cd_gender = 'F' and\n       cd_marital_status = 'D' and\n       cd_education_status = 'Secondary' and\n       d_year = 1999 and\n       s_state in ('MO','AL', 'MI', 'TN', 'LA', 'SC')\n group by rollup (i_item_id, s_state)\n order by i_item_id\n         ,s_state\n LIMIT 100;\n\n-- end query 27 in stream 0 using template query27.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002), results AS (SELECT i_item_id, s_state, 0 AS g_state, ss_quantity AS agg1, ss_list_price AS agg2, ss_coupon_amt AS agg3, ss_sales_price AS agg4 FROM store_sales, customer_demographics, filtered_dates, store, item WHERE ss_sold_date_sk = d_date_sk AND ss_item_sk = i_item_sk AND ss_store_sk = s_store_sk AND ss_cdemo_sk = cd_demo_sk AND cd_gender = 'M' AND cd_marital_status = 'S' AND cd_education_status = 'College' AND s_state = 'TN')\nSELECT i_item_id, s_state, g_state, agg1, agg2, agg3, agg4 FROM (SELECT i_item_id, s_state, 0 AS g_state, AVG(agg1) AS agg1, AVG(agg2) AS agg2, AVG(agg3) AS agg3, AVG(agg4) AS agg4 FROM results GROUP BY i_item_id, s_state UNION ALL SELECT i_item_id, NULL AS s_state, 1 AS g_state, AVG(agg1) AS agg1, AVG(agg2) AS agg2, AVG(agg3) AS agg3, AVG(agg4) AS agg4 FROM results GROUP BY i_item_id UNION ALL SELECT NULL AS i_item_id, NULL AS s_state, 1 AS g_state, AVG(agg1) AS agg1, AVG(agg2) AS agg2, AVG(agg3) AS agg3, AVG(agg4) AS agg4 FROM results) AS foo ORDER BY i_item_id NULLS FIRST, s_state NULLS FIRST LIMIT 100",
      "error": null
    },
    {
      "query_id": "q61",
      "status": "WIN",
      "speedup": 1.4633,
      "original_ms": 14.02,
      "optimized_ms": 9.58,
      "original_times": [
        19.35,
        13.86,
        14.18
      ],
      "optimized_times": [
        8.99,
        9.09,
        10.07
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "materialize_cte"
      ],
      "original_sql": "-- start query 61 in stream 0 using template query61.tpl\nselect promotions,total,cast(promotions as decimal(15,4))/cast(total as decimal(15,4))*100\nfrom\n  (select sum(ss_ext_sales_price) promotions\n   from  store_sales\n        ,store\n        ,promotion\n        ,date_dim\n        ,customer\n        ,customer_address \n        ,item\n   where ss_sold_date_sk = d_date_sk\n   and   ss_store_sk = s_store_sk\n   and   ss_promo_sk = p_promo_sk\n   and   ss_customer_sk= c_customer_sk\n   and   ca_address_sk = c_current_addr_sk\n   and   ss_item_sk = i_item_sk \n   and   ca_gmt_offset = -7\n   and   i_category = 'Jewelry'\n   and   (p_channel_dmail = 'Y' or p_channel_email = 'Y' or p_channel_tv = 'Y')\n   and   s_gmt_offset = -7\n   and   d_year = 1999\n   and   d_moy  = 11) promotional_sales,\n  (select sum(ss_ext_sales_price) total\n   from  store_sales\n        ,store\n        ,date_dim\n        ,customer\n        ,customer_address\n        ,item\n   where ss_sold_date_sk = d_date_sk\n   and   ss_store_sk = s_store_sk\n   and   ss_customer_sk= c_customer_sk\n   and   ca_address_sk = c_current_addr_sk\n   and   ss_item_sk = i_item_sk\n   and   ca_gmt_offset = -7\n   and   i_category = 'Jewelry'\n   and   s_gmt_offset = -7\n   and   d_year = 1999\n   and   d_moy  = 11) all_sales\norder by promotions, total\n LIMIT 100;\n\n-- end query 61 in stream 0 using template query61.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1999 AND d_moy = 11), base_sales AS (SELECT ss.ss_ext_sales_price, ss.ss_promo_sk FROM store_sales AS ss JOIN filtered_dates AS d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store AS s ON ss.ss_store_sk = s.s_store_sk AND s.s_gmt_offset = -7 JOIN customer AS c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk AND ca.ca_gmt_offset = -7 JOIN item AS i ON ss.ss_item_sk = i.i_item_sk AND i.i_category = 'Jewelry'), promotional_sales AS (SELECT SUM(ss_ext_sales_price) AS promotions FROM (SELECT bs.ss_ext_sales_price FROM base_sales AS bs JOIN promotion AS p ON bs.ss_promo_sk = p.p_promo_sk WHERE p.p_channel_dmail = 'Y' UNION ALL SELECT bs.ss_ext_sales_price FROM base_sales AS bs JOIN promotion AS p ON bs.ss_promo_sk = p.p_promo_sk WHERE p.p_channel_email = 'Y' UNION ALL SELECT bs.ss_ext_sales_price FROM base_sales AS bs JOIN promotion AS p ON bs.ss_promo_sk = p.p_promo_sk WHERE p.p_channel_tv = 'Y') AS t), all_sales AS (SELECT SUM(ss_ext_sales_price) AS total FROM base_sales)\nSELECT promotions, total, CAST(promotions AS DECIMAL(15, 4)) / CAST(total AS DECIMAL(15, 4)) * 100 FROM promotional_sales, all_sales ORDER BY promotions, total LIMIT 100",
      "error": null
    },
    {
      "query_id": "q14",
      "status": "WIN",
      "speedup": 1.4013,
      "original_ms": 691.25,
      "optimized_ms": 493.31,
      "original_times": [
        778.95,
        690.45,
        692.06
      ],
      "optimized_times": [
        488.06,
        505.38,
        481.24
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [],
      "original_sql": "-- start query 14 in stream 0 using template query14.tpl\nwith  cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n     ,iss.i_class_id class_id\n     ,iss.i_category_id category_id\n from store_sales\n     ,item iss\n     ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n   and ss_sold_date_sk = d1.d_date_sk\n   and d1.d_year between 2000 AND 2000 + 2\n intersect \n select ics.i_brand_id\n     ,ics.i_class_id\n     ,ics.i_category_id\n from catalog_sales\n     ,item ics\n     ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n   and cs_sold_date_sk = d2.d_date_sk\n   and d2.d_year between 2000 AND 2000 + 2\n intersect\n select iws.i_brand_id\n     ,iws.i_class_id\n     ,iws.i_category_id\n from web_sales\n     ,item iws\n     ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n   and ws_sold_date_sk = d3.d_date_sk\n   and d3.d_year between 2000 AND 2000 + 2)\n where i_brand_id = brand_id\n      and i_class_id = class_id\n      and i_category_id = category_id\n),\n avg_sales as\n (select avg(quantity*list_price) average_sales\n  from (select ss_quantity quantity\n             ,ss_list_price list_price\n       from store_sales\n           ,date_dim\n       where ss_sold_date_sk = d_date_sk\n         and d_year between 2000 and 2000 + 2\n       union all \n       select cs_quantity quantity \n             ,cs_list_price list_price\n       from catalog_sales\n           ,date_dim\n       where cs_sold_date_sk = d_date_sk\n         and d_year between 2000 and 2000 + 2 \n       union all\n       select ws_quantity quantity\n             ,ws_list_price list_price\n       from web_sales\n           ,date_dim\n       where ws_sold_date_sk = d_date_sk\n         and d_year between 2000 and 2000 + 2) x)\n  select channel, i_brand_id,i_class_id,i_category_id,sum(sales), sum(number_sales)\n from(\n       select 'store' channel, i_brand_id,i_class_id\n             ,i_category_id,sum(ss_quantity*ss_list_price) sales\n             , count(*) number_sales\n       from store_sales\n           ,item\n           ,date_dim\n       where ss_item_sk in (select ss_item_sk from cross_items)\n         and ss_item_sk = i_item_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year = 2000+2 \n         and d_moy = 11\n       group by i_brand_id,i_class_id,i_category_id\n       having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)\n       union all\n       select 'catalog' channel, i_brand_id,i_class_id,i_category_id, sum(cs_quantity*cs_list_price) sales, count(*) number_sales\n       from catalog_sales\n           ,item\n           ,date_dim\n       where cs_item_sk in (select ss_item_sk from cross_items)\n         and cs_item_sk = i_item_sk\n         and cs_sold_date_sk = d_date_sk\n         and d_year = 2000+2 \n         and d_moy = 11\n       group by i_brand_id,i_class_id,i_category_id\n       having sum(cs_quantity*cs_list_price) > (select average_sales from avg_sales)\n       union all\n       select 'web' channel, i_brand_id,i_class_id,i_category_id, sum(ws_quantity*ws_list_price) sales , count(*) number_sales\n       from web_sales\n           ,item\n           ,date_dim\n       where ws_item_sk in (select ss_item_sk from cross_items)\n         and ws_item_sk = i_item_sk\n         and ws_sold_date_sk = d_date_sk\n         and d_year = 2000+2\n         and d_moy = 11\n       group by i_brand_id,i_class_id,i_category_id\n       having sum(ws_quantity*ws_list_price) > (select average_sales from avg_sales)\n ) y\n group by rollup (channel, i_brand_id,i_class_id,i_category_id)\n order by channel,i_brand_id,i_class_id,i_category_id\n LIMIT 100;\nwith  cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n     ,iss.i_class_id class_id\n     ,iss.i_category_id category_id\n from store_sales\n     ,item iss\n     ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n   and ss_sold_date_sk = d1.d_date_sk\n   and d1.d_year between 2000 AND 2000 + 2\n intersect\n select ics.i_brand_id\n     ,ics.i_class_id\n     ,ics.i_category_id\n from catalog_sales\n     ,item ics\n     ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n   and cs_sold_date_sk = d2.d_date_sk\n   and d2.d_year between 2000 AND 2000 + 2\n intersect\n select iws.i_brand_id\n     ,iws.i_class_id\n     ,iws.i_category_id\n from web_sales\n     ,item iws\n     ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n   and ws_sold_date_sk = d3.d_date_sk\n   and d3.d_year between 2000 AND 2000 + 2) x\n where i_brand_id = brand_id\n      and i_class_id = class_id\n      and i_category_id = category_id\n),\n avg_sales as\n(select avg(quantity*list_price) average_sales\n  from (select ss_quantity quantity\n             ,ss_list_price list_price\n       from store_sales\n           ,date_dim\n       where ss_sold_date_sk = d_date_sk\n         and d_year between 2000 and 2000 + 2\n       union all\n       select cs_quantity quantity\n             ,cs_list_price list_price\n       from catalog_sales\n           ,date_dim\n       where cs_sold_date_sk = d_date_sk\n         and d_year between 2000 and 2000 + 2\n       union all\n       select ws_quantity quantity\n             ,ws_list_price list_price\n       from web_sales\n           ,date_dim\n       where ws_sold_date_sk = d_date_sk\n         and d_year between 2000 and 2000 + 2) x)\n  select this_year.channel ty_channel\n                           ,this_year.i_brand_id ty_brand\n                           ,this_year.i_class_id ty_class\n                           ,this_year.i_category_id ty_category\n                           ,this_year.sales ty_sales\n                           ,this_year.number_sales ty_number_sales\n                           ,last_year.channel ly_channel\n                           ,last_year.i_brand_id ly_brand\n                           ,last_year.i_class_id ly_class\n                           ,last_year.i_category_id ly_category\n                           ,last_year.sales ly_sales\n                           ,last_year.number_sales ly_number_sales \n from\n (select 'store' channel, i_brand_id,i_class_id,i_category_id\n        ,sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales \n     ,item\n     ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n   and ss_item_sk = i_item_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_week_seq = (select d_week_seq\n                     from date_dim\n                     where d_year = 2000 + 1\n                       and d_moy = 12\n                       and d_dom = 10)\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) this_year,\n (select 'store' channel, i_brand_id,i_class_id\n        ,i_category_id, sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n     ,item\n     ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n   and ss_item_sk = i_item_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_week_seq = (select d_week_seq\n                     from date_dim\n                     where d_year = 2000\n                       and d_moy = 12\n                       and d_dom = 10)\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) last_year\n where this_year.i_brand_id= last_year.i_brand_id\n   and this_year.i_class_id = last_year.i_class_id\n   and this_year.i_category_id = last_year.i_category_id\n order by this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id\n LIMIT 100;\n\n-- end query 14 in stream 0 using template query14.tpl\n",
      "optimized_sql": "WITH nov_2001_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001 AND d_moy = 11), three_year_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year BETWEEN 1999 AND 2001), materialized_cross_items AS (SELECT ss_item_sk FROM (SELECT i_item_sk AS ss_item_sk FROM item, (SELECT iss.i_brand_id AS brand_id, iss.i_class_id AS class_id, iss.i_category_id AS category_id FROM store_sales JOIN three_year_dates ON store_sales.ss_sold_date_sk = three_year_dates.d_date_sk JOIN item AS iss ON store_sales.ss_item_sk = iss.i_item_sk INTERSECT SELECT ics.i_brand_id, ics.i_class_id, ics.i_category_id FROM catalog_sales JOIN three_year_dates ON catalog_sales.cs_sold_date_sk = three_year_dates.d_date_sk JOIN item AS ics ON catalog_sales.cs_item_sk = ics.i_item_sk INTERSECT SELECT iws.i_brand_id, iws.i_class_id, iws.i_category_id FROM web_sales JOIN three_year_dates ON web_sales.ws_sold_date_sk = three_year_dates.d_date_sk JOIN item AS iws ON web_sales.ws_item_sk = iws.i_item_sk) AS sq1 WHERE i_brand_id = brand_id AND i_class_id = class_id AND i_category_id = category_id) AS items), filtered_store_sales AS (SELECT ss_item_sk, ss_quantity, ss_list_price FROM store_sales JOIN nov_2001_dates ON store_sales.ss_sold_date_sk = nov_2001_dates.d_date_sk WHERE ss_item_sk IN (SELECT ss_item_sk FROM materialized_cross_items)), filtered_catalog_sales AS (SELECT cs_item_sk, cs_quantity, cs_list_price FROM catalog_sales JOIN nov_2001_dates ON catalog_sales.cs_sold_date_sk = nov_2001_dates.d_date_sk WHERE cs_item_sk IN (SELECT ss_item_sk FROM materialized_cross_items)), filtered_web_sales AS (SELECT ws_item_sk, ws_quantity, ws_list_price FROM web_sales JOIN nov_2001_dates ON web_sales.ws_sold_date_sk = nov_2001_dates.d_date_sk WHERE ws_item_sk IN (SELECT ss_item_sk FROM materialized_cross_items)), avg_sales_optimized AS (SELECT AVG(quantity * list_price) AS average_sales FROM (SELECT ss_quantity AS quantity, ss_list_price AS list_price FROM store_sales JOIN three_year_dates ON store_sales.ss_sold_date_sk = three_year_dates.d_date_sk UNION ALL SELECT cs_quantity AS quantity, cs_list_price AS list_price FROM catalog_sales JOIN three_year_dates ON catalog_sales.cs_sold_date_sk = three_year_dates.d_date_sk UNION ALL SELECT ws_quantity AS quantity, ws_list_price AS list_price FROM web_sales JOIN three_year_dates ON web_sales.ws_sold_date_sk = three_year_dates.d_date_sk) AS sq2), cross_items AS (SELECT i_item_sk AS ss_item_sk FROM item, (SELECT iss.i_brand_id AS brand_id, iss.i_class_id AS class_id, iss.i_category_id AS category_id FROM store_sales, item AS iss, date_dim AS d1 WHERE ss_item_sk = iss.i_item_sk AND ss_sold_date_sk = d1.d_date_sk AND d1.d_year BETWEEN 1999 AND 1999 + 2 INTERSECT SELECT ics.i_brand_id, ics.i_class_id, ics.i_category_id FROM catalog_sales, item AS ics, date_dim AS d2 WHERE cs_item_sk = ics.i_item_sk AND cs_sold_date_sk = d2.d_date_sk AND d2.d_year BETWEEN 1999 AND 1999 + 2 INTERSECT SELECT iws.i_brand_id, iws.i_class_id, iws.i_category_id FROM web_sales, item AS iws, date_dim AS d3 WHERE ws_item_sk = iws.i_item_sk AND ws_sold_date_sk = d3.d_date_sk AND d3.d_year BETWEEN 1999 AND 1999 + 2) AS sq1 WHERE i_brand_id = brand_id AND i_class_id = class_id AND i_category_id = category_id), avg_sales AS (SELECT AVG(quantity * list_price) AS average_sales FROM (SELECT ss_quantity AS quantity, ss_list_price AS list_price FROM store_sales, date_dim WHERE ss_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2 UNION ALL SELECT cs_quantity AS quantity, cs_list_price AS list_price FROM catalog_sales, date_dim WHERE cs_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2 UNION ALL SELECT ws_quantity AS quantity, ws_list_price AS list_price FROM web_sales, date_dim WHERE ws_sold_date_sk = d_date_sk AND d_year BETWEEN 1999 AND 1999 + 2) AS sq2)\nSELECT channel, i_brand_id, i_class_id, i_category_id, SUM(sales) AS sum_sales, SUM(number_sales) AS sum_number_sales FROM (SELECT 'store' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ss_quantity * ss_list_price) AS sales, COUNT(*) AS number_sales FROM filtered_store_sales, item WHERE ss_item_sk = i_item_sk GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ss_quantity * ss_list_price) > (SELECT average_sales FROM avg_sales_optimized) UNION ALL SELECT 'catalog' AS channel, i_brand_id, i_class_id, i_category_id, SUM(cs_quantity * cs_list_price) AS sales, COUNT(*) AS number_sales FROM filtered_catalog_sales, item WHERE cs_item_sk = i_item_sk GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(cs_quantity * cs_list_price) > (SELECT average_sales FROM avg_sales_optimized) UNION ALL SELECT 'web' AS channel, i_brand_id, i_class_id, i_category_id, SUM(ws_quantity * ws_list_price) AS sales, COUNT(*) AS number_sales FROM filtered_web_sales, item WHERE ws_item_sk = i_item_sk GROUP BY i_brand_id, i_class_id, i_category_id HAVING SUM(ws_quantity * ws_list_price) > (SELECT average_sales FROM avg_sales_optimized)) AS y GROUP BY ROLLUP (channel, i_brand_id, i_class_id, i_category_id) ORDER BY channel NULLS FIRST, i_brand_id NULLS FIRST, i_class_id NULLS FIRST, i_category_id NULLS FIRST LIMIT 100",
      "error": null
    },
    {
      "query_id": "q44",
      "status": "WIN",
      "speedup": 1.3654,
      "original_ms": 4.35,
      "optimized_ms": 3.18,
      "original_times": [
        4.39,
        4.71,
        3.98
      ],
      "optimized_times": [
        2.98,
        2.87,
        3.5
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "materialize_cte"
      ],
      "original_sql": "-- start query 44 in stream 0 using template query44.tpl\nselect asceding.rnk, i1.i_product_name best_performing, i2.i_product_name worst_performing\nfrom(select *\n     from (select item_sk,rank() over (order by rank_col asc) rnk\n           from (select ss_item_sk item_sk,avg(ss_net_profit) rank_col \n                 from store_sales ss1\n                 where ss_store_sk = 146\n                 group by ss_item_sk\n                 having avg(ss_net_profit) > 0.9*(select avg(ss_net_profit) rank_col\n                                                  from store_sales\n                                                  where ss_store_sk = 146\n                                                    and ss_addr_sk is null\n                                                  group by ss_store_sk))V1)V11\n     where rnk  < 11) asceding,\n    (select *\n     from (select item_sk,rank() over (order by rank_col desc) rnk\n           from (select ss_item_sk item_sk,avg(ss_net_profit) rank_col\n                 from store_sales ss1\n                 where ss_store_sk = 146\n                 group by ss_item_sk\n                 having avg(ss_net_profit) > 0.9*(select avg(ss_net_profit) rank_col\n                                                  from store_sales\n                                                  where ss_store_sk = 146\n                                                    and ss_addr_sk is null\n                                                  group by ss_store_sk))V2)V21\n     where rnk  < 11) descending,\nitem i1,\nitem i2\nwhere asceding.rnk = descending.rnk \n  and i1.i_item_sk=asceding.item_sk\n  and i2.i_item_sk=descending.item_sk\norder by asceding.rnk\n LIMIT 100;\n\n-- end query 44 in stream 0 using template query44.tpl\n",
      "optimized_sql": "WITH threshold_calc AS (SELECT AVG(ss_net_profit) * 0.9 AS profit_threshold FROM store_sales WHERE ss_store_sk = 146 AND ss_addr_sk IS NULL GROUP BY ss_store_sk), qualified_items AS (SELECT ss1.ss_item_sk AS item_sk, AVG(ss1.ss_net_profit) AS rank_col FROM store_sales AS ss1 CROSS JOIN threshold_calc WHERE ss1.ss_store_sk = 146 GROUP BY ss1.ss_item_sk HAVING AVG(ss1.ss_net_profit) > threshold_calc.profit_threshold), ascending AS (SELECT item_sk, rnk FROM (SELECT item_sk, RANK() OVER (ORDER BY rank_col ASC) AS rnk FROM qualified_items) AS t WHERE rnk < 11), descending AS (SELECT item_sk, rnk FROM (SELECT item_sk, RANK() OVER (ORDER BY rank_col DESC) AS rnk FROM qualified_items) AS t WHERE rnk < 11)\nSELECT a.rnk, i1.i_product_name AS best_performing, i2.i_product_name AS worst_performing FROM ascending AS a JOIN descending AS d ON a.rnk = d.rnk JOIN item AS i1 ON i1.i_item_sk = a.item_sk JOIN item AS i2 ON i2.i_item_sk = d.item_sk ORDER BY a.rnk LIMIT 100",
      "error": null
    },
    {
      "query_id": "q80",
      "status": "WIN",
      "speedup": 1.2997,
      "original_ms": 186.24,
      "optimized_ms": 143.3,
      "original_times": [
        240.13,
        199.21,
        173.28
      ],
      "optimized_times": [
        130.66,
        138.49,
        148.11
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 80 in stream 0 using template query80.tpl\nwith ssr as\n (select  s_store_id as store_id,\n          sum(ss_ext_sales_price) as sales,\n          sum(coalesce(sr_return_amt, 0)) as \"returns\",\n          sum(ss_net_profit - coalesce(sr_net_loss, 0)) as profit\n  from store_sales left outer join store_returns on\n         (ss_item_sk = sr_item_sk and ss_ticket_number = sr_ticket_number),\n     date_dim,\n     store,\n     item,\n     promotion\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('1998-08-28' as date) \n                  and (cast('1998-08-28' as date) + INTERVAL 30 DAY)\n       and ss_store_sk = s_store_sk\n       and ss_item_sk = i_item_sk\n       and i_current_price > 50\n       and ss_promo_sk = p_promo_sk\n       and p_channel_tv = 'N'\n group by s_store_id)\n ,\n csr as\n (select  cp_catalog_page_id as catalog_page_id,\n          sum(cs_ext_sales_price) as sales,\n          sum(coalesce(cr_return_amount, 0)) as \"returns\",\n          sum(cs_net_profit - coalesce(cr_net_loss, 0)) as profit\n  from catalog_sales left outer join catalog_returns on\n         (cs_item_sk = cr_item_sk and cs_order_number = cr_order_number),\n     date_dim,\n     catalog_page,\n     item,\n     promotion\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('1998-08-28' as date)\n                  and (cast('1998-08-28' as date) + INTERVAL 30 DAY)\n        and cs_catalog_page_sk = cp_catalog_page_sk\n       and cs_item_sk = i_item_sk\n       and i_current_price > 50\n       and cs_promo_sk = p_promo_sk\n       and p_channel_tv = 'N'\ngroup by cp_catalog_page_id)\n ,\n wsr as\n (select  web_site_id,\n          sum(ws_ext_sales_price) as sales,\n          sum(coalesce(wr_return_amt, 0)) as \"returns\",\n          sum(ws_net_profit - coalesce(wr_net_loss, 0)) as profit\n  from web_sales left outer join web_returns on\n         (ws_item_sk = wr_item_sk and ws_order_number = wr_order_number),\n     date_dim,\n     web_site,\n     item,\n     promotion\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('1998-08-28' as date)\n                  and (cast('1998-08-28' as date) + INTERVAL 30 DAY)\n        and ws_web_site_sk = web_site_sk\n       and ws_item_sk = i_item_sk\n       and i_current_price > 50\n       and ws_promo_sk = p_promo_sk\n       and p_channel_tv = 'N'\ngroup by web_site_id)\n  select channel\n        , id\n        , sum(sales) as sales\n        , sum(\"returns\") as \"returns\"\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || store_id as id\n        , sales\n        , \"returns\"\n        , profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || catalog_page_id as id\n        , sales\n        , \"returns\"\n        , profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , \"returns\"\n        , profit\n from   wsr\n ) x\n group by rollup (channel, id)\n order by channel\n         ,id\n LIMIT 100;\n\n-- end query 80 in stream 0 using template query80.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('2000-08-23' AS DATE) AND CAST('2000-09-22' AS DATE)), filtered_item AS (SELECT i_item_sk FROM item WHERE i_current_price > 50), filtered_promotion AS (SELECT p_promo_sk FROM promotion WHERE p_channel_tv = 'N'), wsr AS (SELECT web_site_id, SUM(ws_ext_sales_price) AS sales, SUM(COALESCE(wr_return_amt, 0)) AS returns_, SUM(ws_net_profit - COALESCE(wr_net_loss, 0)) AS profit FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk JOIN filtered_item ON ws_item_sk = i_item_sk JOIN filtered_promotion ON ws_promo_sk = p_promo_sk LEFT OUTER JOIN web_returns ON (ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number) JOIN web_site ON ws_web_site_sk = web_site_sk GROUP BY web_site_id), ssr AS (SELECT s_store_id AS store_id, SUM(ss_ext_sales_price) AS sales, SUM(COALESCE(sr_return_amt, 0)) AS returns_, SUM(ss_net_profit - COALESCE(sr_net_loss, 0)) AS profit FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN filtered_item ON ss_item_sk = i_item_sk JOIN filtered_promotion ON ss_promo_sk = p_promo_sk LEFT OUTER JOIN store_returns ON (ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number) JOIN store ON ss_store_sk = s_store_sk GROUP BY s_store_id), csr AS (SELECT cp_catalog_page_id AS catalog_page_id, SUM(cs_ext_sales_price) AS sales, SUM(COALESCE(cr_return_amount, 0)) AS returns_, SUM(cs_net_profit - COALESCE(cr_net_loss, 0)) AS profit FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN filtered_item ON cs_item_sk = i_item_sk JOIN filtered_promotion ON cs_promo_sk = p_promo_sk LEFT OUTER JOIN catalog_returns ON (cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number) JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk GROUP BY cp_catalog_page_id)\nSELECT channel, id, SUM(sales) AS sales, SUM(returns_) AS returns_, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, CONCAT('store', store_id) AS id, sales, returns_, profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, CONCAT('catalog_page', catalog_page_id) AS id, sales, returns_, profit FROM csr UNION ALL SELECT 'web channel' AS channel, CONCAT('web_site', web_site_id) AS id, sales, returns_, profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel NULLS FIRST, id NULLS FIRST LIMIT 100",
      "error": null
    },
    {
      "query_id": "q9",
      "status": "WIN",
      "speedup": 1.277,
      "original_ms": 797.63,
      "optimized_ms": 624.62,
      "original_times": [
        862.84,
        793.12,
        802.14
      ],
      "optimized_times": [
        577.0,
        641.93,
        607.31
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [],
      "original_sql": "-- start query 9 in stream 0 using template query9.tpl\nselect case when (select count(*) \n                  from store_sales \n                  where ss_quantity between 1 and 20) > 2972190\n            then (select avg(ss_ext_sales_price) \n                  from store_sales \n                  where ss_quantity between 1 and 20) \n            else (select avg(ss_net_profit)\n                  from store_sales\n                  where ss_quantity between 1 and 20) end bucket1 ,\n       case when (select count(*)\n                  from store_sales\n                  where ss_quantity between 21 and 40) > 4505785\n            then (select avg(ss_ext_sales_price)\n                  from store_sales\n                  where ss_quantity between 21 and 40) \n            else (select avg(ss_net_profit)\n                  from store_sales\n                  where ss_quantity between 21 and 40) end bucket2,\n       case when (select count(*)\n                  from store_sales\n                  where ss_quantity between 41 and 60) > 1575726\n            then (select avg(ss_ext_sales_price)\n                  from store_sales\n                  where ss_quantity between 41 and 60)\n            else (select avg(ss_net_profit)\n                  from store_sales\n                  where ss_quantity between 41 and 60) end bucket3,\n       case when (select count(*)\n                  from store_sales\n                  where ss_quantity between 61 and 80) > 3188917\n            then (select avg(ss_ext_sales_price)\n                  from store_sales\n                  where ss_quantity between 61 and 80)\n            else (select avg(ss_net_profit)\n                  from store_sales\n                  where ss_quantity between 61 and 80) end bucket4,\n       case when (select count(*)\n                  from store_sales\n                  where ss_quantity between 81 and 100) > 3525216\n            then (select avg(ss_ext_sales_price)\n                  from store_sales\n                  where ss_quantity between 81 and 100)\n            else (select avg(ss_net_profit)\n                  from store_sales\n                  where ss_quantity between 81 and 100) end bucket5\nfrom reason\nwhere r_reason_sk = 1\n;\n\n-- end query 9 in stream 0 using template query9.tpl\n",
      "optimized_sql": "WITH sales_stats AS (SELECT COUNT(CASE WHEN ss_quantity BETWEEN 1 AND 20 THEN 1 END) AS cnt1, AVG(CASE WHEN ss_quantity BETWEEN 1 AND 20 THEN ss_ext_sales_price END) AS avg_price1, AVG(CASE WHEN ss_quantity BETWEEN 1 AND 20 THEN ss_net_profit END) AS avg_profit1, COUNT(CASE WHEN ss_quantity BETWEEN 21 AND 40 THEN 1 END) AS cnt2, AVG(CASE WHEN ss_quantity BETWEEN 21 AND 40 THEN ss_ext_sales_price END) AS avg_price2, AVG(CASE WHEN ss_quantity BETWEEN 21 AND 40 THEN ss_net_profit END) AS avg_profit2, COUNT(CASE WHEN ss_quantity BETWEEN 41 AND 60 THEN 1 END) AS cnt3, AVG(CASE WHEN ss_quantity BETWEEN 41 AND 60 THEN ss_ext_sales_price END) AS avg_price3, AVG(CASE WHEN ss_quantity BETWEEN 41 AND 60 THEN ss_net_profit END) AS avg_profit3, COUNT(CASE WHEN ss_quantity BETWEEN 61 AND 80 THEN 1 END) AS cnt4, AVG(CASE WHEN ss_quantity BETWEEN 61 AND 80 THEN ss_ext_sales_price END) AS avg_price4, AVG(CASE WHEN ss_quantity BETWEEN 61 AND 80 THEN ss_net_profit END) AS avg_profit4, COUNT(CASE WHEN ss_quantity BETWEEN 81 AND 100 THEN 1 END) AS cnt5, AVG(CASE WHEN ss_quantity BETWEEN 81 AND 100 THEN ss_ext_sales_price END) AS avg_price5, AVG(CASE WHEN ss_quantity BETWEEN 81 AND 100 THEN ss_net_profit END) AS avg_profit5 FROM store_sales)\nSELECT CASE WHEN s.cnt1 > 2972190 THEN s.avg_price1 ELSE s.avg_profit1 END AS bucket1, CASE WHEN s.cnt2 > 4505785 THEN s.avg_price2 ELSE s.avg_profit2 END AS bucket2, CASE WHEN s.cnt3 > 1575726 THEN s.avg_price3 ELSE s.avg_profit3 END AS bucket3, CASE WHEN s.cnt4 > 3188917 THEN s.avg_price4 ELSE s.avg_profit4 END AS bucket4, CASE WHEN s.cnt5 > 3525216 THEN s.avg_price5 ELSE s.avg_profit5 END AS bucket5 FROM reason AS r, sales_stats AS s WHERE r.r_reason_sk = 1",
      "error": null
    },
    {
      "query_id": "q12",
      "status": "WIN",
      "speedup": 1.2658,
      "original_ms": 36.17,
      "optimized_ms": 28.57,
      "original_times": [
        70.19,
        38.08,
        34.25
      ],
      "optimized_times": [
        30.04,
        28.5,
        28.65
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [],
      "original_sql": "-- start query 12 in stream 0 using template query12.tpl\nselect i_item_id\n      ,i_item_desc \n      ,i_category \n      ,i_class \n      ,i_current_price\n      ,sum(ws_ext_sales_price) as itemrevenue \n      ,sum(ws_ext_sales_price)*100/sum(sum(ws_ext_sales_price)) over\n          (partition by i_class) as revenueratio\nfrom\t\n\tweb_sales\n    \t,item \n    \t,date_dim\nwhere \n\tws_item_sk = i_item_sk \n  \tand i_category in ('Books', 'Sports', 'Men')\n  \tand ws_sold_date_sk = d_date_sk\n\tand d_date between cast('1998-04-06' as date) \n\t\t\t\tand (cast('1998-04-06' as date) + INTERVAL 30 DAY)\ngroup by \n\ti_item_id\n        ,i_item_desc \n        ,i_category\n        ,i_class\n        ,i_current_price\norder by \n\ti_category\n        ,i_class\n        ,i_item_id\n        ,i_item_desc\n        ,revenueratio\n LIMIT 100;\n\n-- end query 12 in stream 0 using template query12.tpl\n",
      "optimized_sql": "WITH filtered_items AS (SELECT i_item_sk, i_item_id, i_item_desc, i_category, i_class, i_current_price FROM item WHERE i_category IN ('Books', 'Sports', 'Men')), filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1998-04-06' AS DATE) AND (CAST('1998-04-06' AS DATE) + INTERVAL '30' DAY)), filtered_sales AS (SELECT ws_item_sk, ws_ext_sales_price FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk)\nSELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, SUM(ws_ext_sales_price) AS itemrevenue, SUM(ws_ext_sales_price) * 100 / SUM(SUM(ws_ext_sales_price)) OVER (PARTITION BY i_class) AS revenueratio FROM filtered_sales JOIN filtered_items ON ws_item_sk = i_item_sk GROUP BY i_item_id, i_item_desc, i_category, i_class, i_current_price ORDER BY i_category, i_class, i_item_id, i_item_desc, revenueratio LIMIT 100",
      "error": null
    },
    {
      "query_id": "q46",
      "status": "WIN",
      "speedup": 1.2335,
      "original_ms": 184.13,
      "optimized_ms": 149.27,
      "original_times": [
        171.2,
        174.07,
        194.19
      ],
      "optimized_times": [
        165.56,
        147.96,
        150.59
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "or_to_union"
      ],
      "original_sql": "-- start query 46 in stream 0 using template query46.tpl\nselect c_last_name\n       ,c_first_name\n       ,ca_city\n       ,bought_city\n       ,ss_ticket_number\n       ,amt,profit \n from\n   (select ss_ticket_number\n          ,ss_customer_sk\n          ,ca_city bought_city\n          ,sum(ss_coupon_amt) amt\n          ,sum(ss_net_profit) profit\n    from store_sales,date_dim,store,household_demographics,customer_address \n    where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n    and store_sales.ss_store_sk = store.s_store_sk  \n    and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n    and store_sales.ss_addr_sk = customer_address.ca_address_sk\n    and (household_demographics.hd_dep_count = 6 or\n         household_demographics.hd_vehicle_count= 0)\n    and date_dim.d_dow in (6,0)\n    and date_dim.d_year in (1999,1999+1,1999+2) \n    and store.s_city in ('Five Points','Centerville','Oak Grove','Fairview','Liberty') \n    group by ss_ticket_number,ss_customer_sk,ss_addr_sk,ca_city) dn,customer,customer_address current_addr\n    where ss_customer_sk = c_customer_sk\n      and customer.c_current_addr_sk = current_addr.ca_address_sk\n      and current_addr.ca_city <> bought_city\n  order by c_last_name\n          ,c_first_name\n          ,ca_city\n          ,bought_city\n          ,ss_ticket_number\n LIMIT 100;\n\n-- end query 46 in stream 0 using template query46.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_dow IN (6, 0) AND d_year IN (1999, 2000, 2001)), filtered_store AS (SELECT s_store_sk FROM store WHERE s_city IN ('Fairview', 'Midway')), filtered_hd AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_dep_count = 4 OR hd_vehicle_count = 3)\nSELECT c_last_name, c_first_name, ca_city, bought_city, ss_ticket_number, amt, profit FROM (SELECT ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city AS bought_city, SUM(ss_coupon_amt) AS amt, SUM(ss_net_profit) AS profit FROM store_sales JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk JOIN filtered_store ON store_sales.ss_store_sk = filtered_store.s_store_sk JOIN filtered_hd ON store_sales.ss_hdemo_sk = filtered_hd.hd_demo_sk JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk GROUP BY ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city) AS dn, customer, customer_address AS current_addr WHERE dn.ss_customer_sk = customer.c_customer_sk AND customer.c_current_addr_sk = current_addr.ca_address_sk AND current_addr.ca_city <> bought_city ORDER BY c_last_name NULLS FIRST, c_first_name NULLS FIRST, ca_city NULLS FIRST, bought_city NULLS FIRST, ss_ticket_number NULLS FIRST LIMIT 100",
      "error": null
    },
    {
      "query_id": "q66",
      "status": "WIN",
      "speedup": 1.2085,
      "original_ms": 66.89,
      "optimized_ms": 55.35,
      "original_times": [
        86.48,
        61.28,
        72.5
      ],
      "optimized_times": [
        53.03,
        56.19,
        54.52
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 66 in stream 0 using template query66.tpl\nselect  \n         w_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n        ,ship_carriers\n        ,year\n \t,sum(jan_sales) as jan_sales\n \t,sum(feb_sales) as feb_sales\n \t,sum(mar_sales) as mar_sales\n \t,sum(apr_sales) as apr_sales\n \t,sum(may_sales) as may_sales\n \t,sum(jun_sales) as jun_sales\n \t,sum(jul_sales) as jul_sales\n \t,sum(aug_sales) as aug_sales\n \t,sum(sep_sales) as sep_sales\n \t,sum(oct_sales) as oct_sales\n \t,sum(nov_sales) as nov_sales\n \t,sum(dec_sales) as dec_sales\n \t,sum(jan_sales/w_warehouse_sq_ft) as jan_sales_per_sq_foot\n \t,sum(feb_sales/w_warehouse_sq_ft) as feb_sales_per_sq_foot\n \t,sum(mar_sales/w_warehouse_sq_ft) as mar_sales_per_sq_foot\n \t,sum(apr_sales/w_warehouse_sq_ft) as apr_sales_per_sq_foot\n \t,sum(may_sales/w_warehouse_sq_ft) as may_sales_per_sq_foot\n \t,sum(jun_sales/w_warehouse_sq_ft) as jun_sales_per_sq_foot\n \t,sum(jul_sales/w_warehouse_sq_ft) as jul_sales_per_sq_foot\n \t,sum(aug_sales/w_warehouse_sq_ft) as aug_sales_per_sq_foot\n \t,sum(sep_sales/w_warehouse_sq_ft) as sep_sales_per_sq_foot\n \t,sum(oct_sales/w_warehouse_sq_ft) as oct_sales_per_sq_foot\n \t,sum(nov_sales/w_warehouse_sq_ft) as nov_sales_per_sq_foot\n \t,sum(dec_sales/w_warehouse_sq_ft) as dec_sales_per_sq_foot\n \t,sum(jan_net) as jan_net\n \t,sum(feb_net) as feb_net\n \t,sum(mar_net) as mar_net\n \t,sum(apr_net) as apr_net\n \t,sum(may_net) as may_net\n \t,sum(jun_net) as jun_net\n \t,sum(jul_net) as jul_net\n \t,sum(aug_net) as aug_net\n \t,sum(sep_net) as sep_net\n \t,sum(oct_net) as oct_net\n \t,sum(nov_net) as nov_net\n \t,sum(dec_net) as dec_net\n from (\n     select \n \tw_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n \t,'GREAT EASTERN' || ',' || 'LATVIAN' as ship_carriers\n       ,d_year as year\n \t,sum(case when d_moy = 1 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as jan_sales\n \t,sum(case when d_moy = 2 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as feb_sales\n \t,sum(case when d_moy = 3 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as mar_sales\n \t,sum(case when d_moy = 4 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as apr_sales\n \t,sum(case when d_moy = 5 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as may_sales\n \t,sum(case when d_moy = 6 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as jun_sales\n \t,sum(case when d_moy = 7 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as jul_sales\n \t,sum(case when d_moy = 8 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as aug_sales\n \t,sum(case when d_moy = 9 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as sep_sales\n \t,sum(case when d_moy = 10 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as oct_sales\n \t,sum(case when d_moy = 11\n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as nov_sales\n \t,sum(case when d_moy = 12\n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as dec_sales\n \t,sum(case when d_moy = 1 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as jan_net\n \t,sum(case when d_moy = 2\n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as feb_net\n \t,sum(case when d_moy = 3 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as mar_net\n \t,sum(case when d_moy = 4 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as apr_net\n \t,sum(case when d_moy = 5 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as may_net\n \t,sum(case when d_moy = 6 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as jun_net\n \t,sum(case when d_moy = 7 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as jul_net\n \t,sum(case when d_moy = 8 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as aug_net\n \t,sum(case when d_moy = 9 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as sep_net\n \t,sum(case when d_moy = 10 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as oct_net\n \t,sum(case when d_moy = 11\n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as nov_net\n \t,sum(case when d_moy = 12\n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as dec_net\n     from\n          web_sales\n         ,warehouse\n         ,date_dim\n         ,time_dim\n \t  ,ship_mode\n     where\n            ws_warehouse_sk =  w_warehouse_sk\n        and ws_sold_date_sk = d_date_sk\n        and ws_sold_time_sk = t_time_sk\n \tand ws_ship_mode_sk = sm_ship_mode_sk\n        and d_year = 1998\n \tand t_time between 48821 and 48821+28800 \n \tand sm_carrier in ('GREAT EASTERN','LATVIAN')\n     group by \n        w_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n       ,d_year\n union all\n     select \n \tw_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n \t,'GREAT EASTERN' || ',' || 'LATVIAN' as ship_carriers\n       ,d_year as year\n \t,sum(case when d_moy = 1 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as jan_sales\n \t,sum(case when d_moy = 2 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as feb_sales\n \t,sum(case when d_moy = 3 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as mar_sales\n \t,sum(case when d_moy = 4 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as apr_sales\n \t,sum(case when d_moy = 5 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as may_sales\n \t,sum(case when d_moy = 6 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as jun_sales\n \t,sum(case when d_moy = 7 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as jul_sales\n \t,sum(case when d_moy = 8 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as aug_sales\n \t,sum(case when d_moy = 9 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as sep_sales\n \t,sum(case when d_moy = 10 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as oct_sales\n \t,sum(case when d_moy = 11\n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as nov_sales\n \t,sum(case when d_moy = 12\n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as dec_sales\n \t,sum(case when d_moy = 1 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as jan_net\n \t,sum(case when d_moy = 2 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as feb_net\n \t,sum(case when d_moy = 3 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as mar_net\n \t,sum(case when d_moy = 4 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as apr_net\n \t,sum(case when d_moy = 5 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as may_net\n \t,sum(case when d_moy = 6 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as jun_net\n \t,sum(case when d_moy = 7 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as jul_net\n \t,sum(case when d_moy = 8 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as aug_net\n \t,sum(case when d_moy = 9 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as sep_net\n \t,sum(case when d_moy = 10 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as oct_net\n \t,sum(case when d_moy = 11\n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as nov_net\n \t,sum(case when d_moy = 12\n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as dec_net\n     from\n          catalog_sales\n         ,warehouse\n         ,date_dim\n         ,time_dim\n \t ,ship_mode\n     where\n            cs_warehouse_sk =  w_warehouse_sk\n        and cs_sold_date_sk = d_date_sk\n        and cs_sold_time_sk = t_time_sk\n \tand cs_ship_mode_sk = sm_ship_mode_sk\n        and d_year = 1998\n \tand t_time between 48821 AND 48821+28800 \n \tand sm_carrier in ('GREAT EASTERN','LATVIAN')\n     group by \n        w_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n       ,d_year\n ) x\n group by \n        w_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n \t,ship_carriers\n       ,year\n order by w_warehouse_name\n LIMIT 100;\n\n-- end query 66 in stream 0 using template query66.tpl\n",
      "optimized_sql": "-- start query 66 in stream 0 using template query66.tpl\nselect  \n         w_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n        ,ship_carriers\n        ,year\n \t,sum(jan_sales) as jan_sales\n \t,sum(feb_sales) as feb_sales\n \t,sum(mar_sales) as mar_sales\n \t,sum(apr_sales) as apr_sales\n \t,sum(may_sales) as may_sales\n \t,sum(jun_sales) as jun_sales\n \t,sum(jul_sales) as jul_sales\n \t,sum(aug_sales) as aug_sales\n \t,sum(sep_sales) as sep_sales\n \t,sum(oct_sales) as oct_sales\n \t,sum(nov_sales) as nov_sales\n \t,sum(dec_sales) as dec_sales\n \t,sum(jan_sales/w_warehouse_sq_ft) as jan_sales_per_sq_foot\n \t,sum(feb_sales/w_warehouse_sq_ft) as feb_sales_per_sq_foot\n \t,sum(mar_sales/w_warehouse_sq_ft) as mar_sales_per_sq_foot\n \t,sum(apr_sales/w_warehouse_sq_ft) as apr_sales_per_sq_foot\n \t,sum(may_sales/w_warehouse_sq_ft) as may_sales_per_sq_foot\n \t,sum(jun_sales/w_warehouse_sq_ft) as jun_sales_per_sq_foot\n \t,sum(jul_sales/w_warehouse_sq_ft) as jul_sales_per_sq_foot\n \t,sum(aug_sales/w_warehouse_sq_ft) as aug_sales_per_sq_foot\n \t,sum(sep_sales/w_warehouse_sq_ft) as sep_sales_per_sq_foot\n \t,sum(oct_sales/w_warehouse_sq_ft) as oct_sales_per_sq_foot\n \t,sum(nov_sales/w_warehouse_sq_ft) as nov_sales_per_sq_foot\n \t,sum(dec_sales/w_warehouse_sq_ft) as dec_sales_per_sq_foot\n \t,sum(jan_net) as jan_net\n \t,sum(feb_net) as feb_net\n \t,sum(mar_net) as mar_net\n \t,sum(apr_net) as apr_net\n \t,sum(may_net) as may_net\n \t,sum(jun_net) as jun_net\n \t,sum(jul_net) as jul_net\n \t,sum(aug_net) as aug_net\n \t,sum(sep_net) as sep_net\n \t,sum(oct_net) as oct_net\n \t,sum(nov_net) as nov_net\n \t,sum(dec_net) as dec_net\n from (\n     select \n \tw_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n \t,'GREAT EASTERN' || ',' || 'LATVIAN' as ship_carriers\n       ,d_year as year\n \t,sum(case when d_moy = 1 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as jan_sales\n \t,sum(case when d_moy = 2 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as feb_sales\n \t,sum(case when d_moy = 3 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as mar_sales\n \t,sum(case when d_moy = 4 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as apr_sales\n \t,sum(case when d_moy = 5 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as may_sales\n \t,sum(case when d_moy = 6 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as jun_sales\n \t,sum(case when d_moy = 7 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as jul_sales\n \t,sum(case when d_moy = 8 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as aug_sales\n \t,sum(case when d_moy = 9 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as sep_sales\n \t,sum(case when d_moy = 10 \n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as oct_sales\n \t,sum(case when d_moy = 11\n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as nov_sales\n \t,sum(case when d_moy = 12\n \t\tthen ws_ext_sales_price* ws_quantity else 0 end) as dec_sales\n \t,sum(case when d_moy = 1 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as jan_net\n \t,sum(case when d_moy = 2\n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as feb_net\n \t,sum(case when d_moy = 3 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as mar_net\n \t,sum(case when d_moy = 4 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as apr_net\n \t,sum(case when d_moy = 5 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as may_net\n \t,sum(case when d_moy = 6 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as jun_net\n \t,sum(case when d_moy = 7 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as jul_net\n \t,sum(case when d_moy = 8 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as aug_net\n \t,sum(case when d_moy = 9 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as sep_net\n \t,sum(case when d_moy = 10 \n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as oct_net\n \t,sum(case when d_moy = 11\n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as nov_net\n \t,sum(case when d_moy = 12\n \t\tthen ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as dec_net\n     from\n          web_sales\n         ,warehouse\n         ,date_dim\n         ,time_dim\n \t  ,ship_mode\n     where\n            ws_warehouse_sk =  w_warehouse_sk\n        and ws_sold_date_sk = d_date_sk\n        and ws_sold_time_sk = t_time_sk\n \tand ws_ship_mode_sk = sm_ship_mode_sk\n        and d_year = 1998\n \tand t_time between 48821 and 48821+28800 \n \tand sm_carrier in ('GREAT EASTERN','LATVIAN')\n     group by \n        w_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n       ,d_year\n union all\n     select \n \tw_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n \t,'GREAT EASTERN' || ',' || 'LATVIAN' as ship_carriers\n       ,d_year as year\n \t,sum(case when d_moy = 1 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as jan_sales\n \t,sum(case when d_moy = 2 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as feb_sales\n \t,sum(case when d_moy = 3 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as mar_sales\n \t,sum(case when d_moy = 4 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as apr_sales\n \t,sum(case when d_moy = 5 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as may_sales\n \t,sum(case when d_moy = 6 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as jun_sales\n \t,sum(case when d_moy = 7 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as jul_sales\n \t,sum(case when d_moy = 8 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as aug_sales\n \t,sum(case when d_moy = 9 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as sep_sales\n \t,sum(case when d_moy = 10 \n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as oct_sales\n \t,sum(case when d_moy = 11\n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as nov_sales\n \t,sum(case when d_moy = 12\n \t\tthen cs_ext_list_price* cs_quantity else 0 end) as dec_sales\n \t,sum(case when d_moy = 1 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as jan_net\n \t,sum(case when d_moy = 2 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as feb_net\n \t,sum(case when d_moy = 3 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as mar_net\n \t,sum(case when d_moy = 4 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as apr_net\n \t,sum(case when d_moy = 5 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as may_net\n \t,sum(case when d_moy = 6 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as jun_net\n \t,sum(case when d_moy = 7 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as jul_net\n \t,sum(case when d_moy = 8 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as aug_net\n \t,sum(case when d_moy = 9 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as sep_net\n \t,sum(case when d_moy = 10 \n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as oct_net\n \t,sum(case when d_moy = 11\n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as nov_net\n \t,sum(case when d_moy = 12\n \t\tthen cs_net_paid_inc_ship_tax * cs_quantity else 0 end) as dec_net\n     from\n          catalog_sales\n         ,warehouse\n         ,date_dim\n         ,time_dim\n \t ,ship_mode\n     where\n            cs_warehouse_sk =  w_warehouse_sk\n        and cs_sold_date_sk = d_date_sk\n        and cs_sold_time_sk = t_time_sk\n \tand cs_ship_mode_sk = sm_ship_mode_sk\n        and d_year = 1998\n \tand t_time between 48821 AND 48821+28800 \n \tand sm_carrier in ('GREAT EASTERN','LATVIAN')\n     group by \n        w_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n       ,d_year\n ) x\n group by \n        w_warehouse_name\n \t,w_warehouse_sq_ft\n \t,w_city\n \t,w_county\n \t,w_state\n \t,w_country\n \t,ship_carriers\n       ,year\n order by w_warehouse_name\n LIMIT 100;\n\n-- end query 66 in stream 0 using template query66.tpl\n",
      "error": null
    },
    {
      "query_id": "q57",
      "status": "WIN",
      "speedup": 1.1961,
      "original_ms": 218.4,
      "optimized_ms": 182.59,
      "original_times": [
        194.23,
        218.4,
        218.41
      ],
      "optimized_times": [
        176.6,
        180.38,
        184.8
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 57 in stream 0 using template query57.tpl\nwith v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 1999 or\n         ( d_year = 1999-1 and d_moy =12) or\n         ( d_year = 1999+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.i_brand\n        ,v1.d_year\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select *\n from v2\n where  d_year = 1999 and\n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n order by sum_sales - avg_monthly_sales, nsum\n LIMIT 100;\n\n-- end query 57 in stream 0 using template query57.tpl\n",
      "optimized_sql": "WITH v1 AS (SELECT i_category, i_brand, cc_name, d_year, d_moy, SUM(cs_sales_price) AS sum_sales, AVG(SUM(cs_sales_price)) OVER (PARTITION BY i_category, i_brand, cc_name, d_year) AS avg_monthly_sales, RANK() OVER (PARTITION BY i_category, i_brand, cc_name ORDER BY d_year, d_moy) AS rn FROM item, catalog_sales, date_dim, call_center WHERE cs_item_sk = i_item_sk AND cs_sold_date_sk = d_date_sk AND cc_call_center_sk = cs_call_center_sk AND (d_year = 1999 OR (d_year = 1999 - 1 AND d_moy = 12) OR (d_year = 1999 + 1 AND d_moy = 1)) GROUP BY i_category, i_brand, cc_name, d_year, d_moy), v2 AS (SELECT v1.i_category, v1.i_brand, v1.cc_name, v1.d_year, v1.d_moy, v1.avg_monthly_sales, v1.sum_sales, v1_lag.sum_sales AS psum, v1_lead.sum_sales AS nsum FROM v1, v1 AS v1_lag, v1 AS v1_lead WHERE v1.i_category = v1_lag.i_category AND v1.i_category = v1_lead.i_category AND v1.i_brand = v1_lag.i_brand AND v1.i_brand = v1_lead.i_brand AND v1.cc_name = v1_lag.cc_name AND v1.cc_name = v1_lead.cc_name AND v1.rn = v1_lag.rn + 1 AND v1.rn = v1_lead.rn - 1)\nSELECT * FROM v2 WHERE d_year = 1999 AND avg_monthly_sales > 0 AND CASE WHEN avg_monthly_sales > 0 THEN ABS(sum_sales - avg_monthly_sales) / avg_monthly_sales ELSE NULL END > 0.1 ORDER BY sum_sales - avg_monthly_sales NULLS FIRST, 1, 2, 3, 4, 5, 6, 7, 8, 9 LIMIT 100",
      "error": null
    },
    {
      "query_id": "q81",
      "status": "WIN",
      "speedup": 1.1956,
      "original_ms": 92.15,
      "optimized_ms": 77.07,
      "original_times": [
        91.41,
        101.53,
        82.76
      ],
      "optimized_times": [
        69.83,
        75.56,
        78.58
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "decorrelate"
      ],
      "original_sql": "-- start query 81 in stream 0 using template query81.tpl\nwith customer_total_return as\n (select cr_returning_customer_sk as ctr_customer_sk\n        ,ca_state as ctr_state, \n \tsum(cr_return_amt_inc_tax) as ctr_total_return\n from catalog_returns\n     ,date_dim\n     ,customer_address\n where cr_returned_date_sk = d_date_sk \n   and d_year =2002\n   and cr_returning_addr_sk = ca_address_sk \n group by cr_returning_customer_sk\n         ,ca_state )\n  select c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name\n                   ,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset\n                  ,ca_location_type,ctr_total_return\n from customer_total_return ctr1\n     ,customer_address\n     ,customer\n where ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2\n \t\t\t  from customer_total_return ctr2 \n                  \t  where ctr1.ctr_state = ctr2.ctr_state)\n       and ca_address_sk = c_current_addr_sk\n       and ca_state = 'CA'\n       and ctr1.ctr_customer_sk = c_customer_sk\n order by c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name\n                   ,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset\n                  ,ca_location_type,ctr_total_return\n LIMIT 100;\n\n-- end query 81 in stream 0 using template query81.tpl\n",
      "optimized_sql": "WITH customer_total_return AS (SELECT cr.cr_returning_customer_sk AS ctr_customer_sk, ca.ca_state AS ctr_state, SUM(cr.cr_return_amt_inc_tax) AS ctr_total_return FROM catalog_returns AS cr JOIN date_dim AS d ON cr.cr_returned_date_sk = d.d_date_sk JOIN customer_address AS ca ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN customer AS c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN customer_address AS ca_current ON c.c_current_addr_sk = ca_current.ca_address_sk WHERE d.d_year = 2002 AND ca_current.ca_state = 'CA' GROUP BY cr.cr_returning_customer_sk, ca.ca_state), state_avg_return AS (SELECT ctr_state, AVG(ctr_total_return) * 1.2 AS avg_return_threshold FROM customer_total_return GROUP BY ctr_state)\nSELECT c.c_customer_id, c.c_salutation, c.c_first_name, c.c_last_name, ca.ca_street_number, ca.ca_street_name, ca.ca_street_type, ca.ca_suite_number, ca.ca_city, ca.ca_county, ca.ca_state, ca.ca_zip, ca.ca_country, ca.ca_gmt_offset, ca.ca_location_type, ctr1.ctr_total_return FROM customer_total_return AS ctr1 JOIN state_avg_return AS sar ON ctr1.ctr_state = sar.ctr_state JOIN customer AS c ON ctr1.ctr_customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ctr1.ctr_total_return > sar.avg_return_threshold ORDER BY c.c_customer_id, c.c_salutation, c.c_first_name, c.c_last_name, ca.ca_street_number, ca.ca_street_name, ca.ca_street_type, ca.ca_suite_number, ca.ca_city, ca.ca_county, ca.ca_state, ca.ca_zip, ca.ca_country, ca.ca_gmt_offset, ca.ca_location_type, ctr1.ctr_total_return LIMIT 100",
      "error": null
    },
    {
      "query_id": "q45",
      "status": "WIN",
      "speedup": 1.1937,
      "original_ms": 76.06,
      "optimized_ms": 63.72,
      "original_times": [
        112.17,
        83.88,
        68.25
      ],
      "optimized_times": [
        64.67,
        62.94,
        64.5
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "or_to_union"
      ],
      "original_sql": "-- start query 45 in stream 0 using template query45.tpl\nselect ca_zip, ca_city, sum(ws_sales_price)\n from web_sales, customer, customer_address, date_dim, item\n where ws_bill_customer_sk = c_customer_sk\n \tand c_current_addr_sk = ca_address_sk \n \tand ws_item_sk = i_item_sk \n \tand ( substr(ca_zip,1,5) in ('85669', '86197','88274','83405','86475', '85392', '85460', '80348', '81792')\n \t      or \n \t      i_item_id in (select i_item_id\n                             from item\n                             where i_item_sk in (2, 3, 5, 7, 11, 13, 17, 19, 23, 29)\n                             )\n \t    )\n \tand ws_sold_date_sk = d_date_sk\n \tand d_qoy = 2 and d_year = 2000\n group by ca_zip, ca_city\n order by ca_zip, ca_city\n LIMIT 100;\n\n-- end query 45 in stream 0 using template query45.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_qoy = 2 AND d_year = 2001), zip_branch AS (SELECT ws_sales_price, ca_zip, ca_city FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk JOIN customer ON ws_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN item ON ws_item_sk = i_item_sk WHERE SUBSTRING(ca_zip, 1, 5) IN ('85669', '86197', '88274', '83405', '86475', '85392', '85460', '80348', '81792')), item_branch AS (SELECT ws_sales_price, ca_zip, ca_city FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk JOIN customer ON ws_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN item ON ws_item_sk = i_item_sk WHERE i_item_sk IN (2, 3, 5, 7, 11, 13, 17, 19, 23, 29))\nSELECT ca_zip, ca_city, SUM(ws_sales_price) FROM (SELECT ws_sales_price, ca_zip, ca_city FROM zip_branch UNION ALL SELECT ws_sales_price, ca_zip, ca_city FROM item_branch) AS combined GROUP BY ca_zip, ca_city ORDER BY ca_zip, ca_city LIMIT 100",
      "error": null
    },
    {
      "query_id": "q8",
      "status": "WIN",
      "speedup": 1.1626,
      "original_ms": 361.76,
      "optimized_ms": 311.18,
      "original_times": [
        365.95,
        379.23,
        344.3
      ],
      "optimized_times": [
        346.53,
        306.9,
        315.45
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [],
      "original_sql": "-- start query 8 in stream 0 using template query8.tpl\nselect s_store_name\n      ,sum(ss_net_profit)\n from store_sales\n     ,date_dim\n     ,store,\n     (select ca_zip\n     from (\n      SELECT substr(ca_zip,1,5) ca_zip\n      FROM customer_address\n      WHERE substr(ca_zip,1,5) IN (\n                          '47602','16704','35863','28577','83910','36201',\n                          '58412','48162','28055','41419','80332',\n                          '38607','77817','24891','16226','18410',\n                          '21231','59345','13918','51089','20317',\n                          '17167','54585','67881','78366','47770',\n                          '18360','51717','73108','14440','21800',\n                          '89338','45859','65501','34948','25973',\n                          '73219','25333','17291','10374','18829',\n                          '60736','82620','41351','52094','19326',\n                          '25214','54207','40936','21814','79077',\n                          '25178','75742','77454','30621','89193',\n                          '27369','41232','48567','83041','71948',\n                          '37119','68341','14073','16891','62878',\n                          '49130','19833','24286','27700','40979',\n                          '50412','81504','94835','84844','71954',\n                          '39503','57649','18434','24987','12350',\n                          '86379','27413','44529','98569','16515',\n                          '27287','24255','21094','16005','56436',\n                          '91110','68293','56455','54558','10298',\n                          '83647','32754','27052','51766','19444',\n                          '13869','45645','94791','57631','20712',\n                          '37788','41807','46507','21727','71836',\n                          '81070','50632','88086','63991','20244',\n                          '31655','51782','29818','63792','68605',\n                          '94898','36430','57025','20601','82080',\n                          '33869','22728','35834','29086','92645',\n                          '98584','98072','11652','78093','57553',\n                          '43830','71144','53565','18700','90209',\n                          '71256','38353','54364','28571','96560',\n                          '57839','56355','50679','45266','84680',\n                          '34306','34972','48530','30106','15371',\n                          '92380','84247','92292','68852','13338',\n                          '34594','82602','70073','98069','85066',\n                          '47289','11686','98862','26217','47529',\n                          '63294','51793','35926','24227','14196',\n                          '24594','32489','99060','49472','43432',\n                          '49211','14312','88137','47369','56877',\n                          '20534','81755','15794','12318','21060',\n                          '73134','41255','63073','81003','73873',\n                          '66057','51184','51195','45676','92696',\n                          '70450','90669','98338','25264','38919',\n                          '59226','58581','60298','17895','19489',\n                          '52301','80846','95464','68770','51634',\n                          '19988','18367','18421','11618','67975',\n                          '25494','41352','95430','15734','62585',\n                          '97173','33773','10425','75675','53535',\n                          '17879','41967','12197','67998','79658',\n                          '59130','72592','14851','43933','68101',\n                          '50636','25717','71286','24660','58058',\n                          '72991','95042','15543','33122','69280',\n                          '11912','59386','27642','65177','17672',\n                          '33467','64592','36335','54010','18767',\n                          '63193','42361','49254','33113','33159',\n                          '36479','59080','11855','81963','31016',\n                          '49140','29392','41836','32958','53163',\n                          '13844','73146','23952','65148','93498',\n                          '14530','46131','58454','13376','13378',\n                          '83986','12320','17193','59852','46081',\n                          '98533','52389','13086','68843','31013',\n                          '13261','60560','13443','45533','83583',\n                          '11489','58218','19753','22911','25115',\n                          '86709','27156','32669','13123','51933',\n                          '39214','41331','66943','14155','69998',\n                          '49101','70070','35076','14242','73021',\n                          '59494','15782','29752','37914','74686',\n                          '83086','34473','15751','81084','49230',\n                          '91894','60624','17819','28810','63180',\n                          '56224','39459','55233','75752','43639',\n                          '55349','86057','62361','50788','31830',\n                          '58062','18218','85761','60083','45484',\n                          '21204','90229','70041','41162','35390',\n                          '16364','39500','68908','26689','52868',\n                          '81335','40146','11340','61527','61794',\n                          '71997','30415','59004','29450','58117',\n                          '69952','33562','83833','27385','61860',\n                          '96435','48333','23065','32961','84919',\n                          '61997','99132','22815','56600','68730',\n                          '48017','95694','32919','88217','27116',\n                          '28239','58032','18884','16791','21343',\n                          '97462','18569','75660','15475')\n     intersect\n      select ca_zip\n      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt\n            FROM customer_address, customer\n            WHERE ca_address_sk = c_current_addr_sk and\n                  c_preferred_cust_flag='Y'\n            group by ca_zip\n            having count(*) > 10)A1)A2) V1\n where ss_store_sk = s_store_sk\n  and ss_sold_date_sk = d_date_sk\n  and d_qoy = 2 and d_year = 1998\n  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))\n group by s_store_name\n order by s_store_name\n LIMIT 100;\n\n-- end query 8 in stream 0 using template query8.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_qoy = 2 AND d_year = 1998), filtered_store_sales AS (SELECT ss_store_sk, ss_net_profit FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk)\nSELECT s_store_name, SUM(ss_net_profit) FROM store_sales, date_dim, store, (SELECT ca_zip FROM (SELECT SUBSTRING(ca_zip, 1, 5) AS ca_zip FROM customer_address WHERE SUBSTRING(ca_zip, 1, 5) IN ('24128', '76232', '65084', '87816', '83926', '77556', '20548', '26231', '43848', '15126', '91137', '61265', '98294', '25782', '17920', '18426', '98235', '40081', '84093', '28577', '55565', '17183', '54601', '67897', '22752', '86284', '18376', '38607', '45200', '21756', '29741', '96765', '23932', '89360', '29839', '25989', '28898', '91068', '72550', '10390', '18845', '47770', '82636', '41367', '76638', '86198', '81312', '37126', '39192', '88424', '72175', '81426', '53672', '10445', '42666', '66864', '66708', '41248', '48583', '82276', '18842', '78890', '49448', '14089', '38122', '34425', '79077', '19849', '43285', '39861', '66162', '77610', '13695', '99543', '83444', '83041', '12305', '57665', '68341', '25003', '57834', '62878', '49130', '81096', '18840', '27700', '23470', '50412', '21195', '16021', '76107', '71954', '68309', '18119', '98359', '64544', '10336', '86379', '27068', '39736', '98569', '28915', '24206', '56529', '57647', '54917', '42961', '91110', '63981', '14922', '36420', '23006', '67467', '32754', '30903', '20260', '31671', '51798', '72325', '85816', '68621', '13955', '36446', '41766', '68806', '16725', '15146', '22744', '35850', '88086', '51649', '18270', '52867', '39972', '96976', '63792', '11376', '94898', '13595', '10516', '90225', '58943', '39371', '94945', '28587', '96576', '57855', '28488', '26105', '83933', '25858', '34322', '44438', '73171', '30122', '34102', '22685', '71256', '78451', '54364', '13354', '45375', '40558', '56458', '28286', '45266', '47305', '69399', '83921', '26233', '11101', '15371', '69913', '35942', '15882', '25631', '24610', '44165', '99076', '33786', '70738', '26653', '14328', '72305', '62496', '22152', '10144', '64147', '48425', '14663', '21076', '18799', '30450', '63089', '81019', '68893', '24996', '51200', '51211', '45692', '92712', '70466', '79994', '22437', '25280', '38935', '71791', '73134', '56571', '14060', '19505', '72425', '56575', '74351', '68786', '51650', '20004', '18383', '76614', '11634', '18906', '15765', '41368', '73241', '76698', '78567', '97189', '28545', '76231', '75691', '22246', '51061', '90578', '56691', '68014', '51103', '94167', '57047', '14867', '73520', '15734', '63435', '25733', '35474', '24676', '94627', '53535', '17879', '15559', '53268', '59166', '11928', '59402', '33282', '45721', '43933', '68101', '33515', '36634', '71286', '19736', '58058', '55253', '67473', '41918', '19515', '36495', '19430', '22351', '77191', '91393', '49156', '50298', '87501', '18652', '53179', '18767', '63193', '23968', '65164', '68880', '21286', '72823', '58470', '67301', '13394', '31016', '70372', '67030', '40604', '24317', '45748', '39127', '26065', '77721', '31029', '31880', '60576', '24671', '45549', '13376', '50016', '33123', '19769', '22927', '97789', '46081', '72151', '15723', '46136', '51949', '68100', '96888', '64528', '14171', '79777', '28709', '11489', '25103', '32213', '78668', '22245', '15798', '27156', '37930', '62971', '21337', '51622', '67853', '10567', '38415', '15455', '58263', '42029', '60279', '37125', '56240', '88190', '50308', '26859', '64457', '89091', '82136', '62377', '36233', '63837', '58078', '17043', '30010', '60099', '28810', '98025', '29178', '87343', '73273', '30469', '64034', '39516', '86057', '21309', '90257', '67875', '40162', '11356', '73650', '61810', '72013', '30431', '22461', '19512', '13375', '55307', '30625', '83849', '68908', '26689', '96451', '38193', '46820', '88885', '84935', '69035', '83144', '47537', '56616', '94983', '48033', '69952', '25486', '61547', '27385', '61860', '58048', '56910', '16807', '17871', '35258', '31387', '35458', '35576') INTERSECT SELECT ca_zip FROM (SELECT SUBSTRING(ca_zip, 1, 5) AS ca_zip, COUNT(*) AS cnt FROM customer_address, customer WHERE ca_address_sk = c_current_addr_sk AND c_preferred_cust_flag = 'Y' GROUP BY ca_zip HAVING COUNT(*) > 10) AS A1) AS A2) AS V1 WHERE ss_store_sk = s_store_sk AND ss_sold_date_sk = d_date_sk AND d_qoy = 2 AND d_year = 1998 AND (SUBSTRING(s_zip, 1, 2) = SUBSTRING(V1.ca_zip, 1, 2)) GROUP BY s_store_name ORDER BY s_store_name LIMIT 100",
      "error": null
    },
    {
      "query_id": "q56",
      "status": "WIN",
      "speedup": 1.1559,
      "original_ms": 64.3,
      "optimized_ms": 55.63,
      "original_times": [
        62.75,
        60.65,
        67.96
      ],
      "optimized_times": [
        59.6,
        55.29,
        55.97
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 56 in stream 0 using template query56.tpl\nwith ss as (\n select i_item_id,sum(ss_ext_sales_price) total_sales\n from\n \tstore_sales,\n \tdate_dim,\n         customer_address,\n         item\n where i_item_id in (select\n     i_item_id\nfrom item\nwhere i_color in ('powder','green','cyan'))\n and     ss_item_sk              = i_item_sk\n and     ss_sold_date_sk         = d_date_sk\n and     d_year                  = 2000\n and     d_moy                   = 2\n and     ss_addr_sk              = ca_address_sk\n and     ca_gmt_offset           = -6 \n group by i_item_id),\n cs as (\n select i_item_id,sum(cs_ext_sales_price) total_sales\n from\n \tcatalog_sales,\n \tdate_dim,\n         customer_address,\n         item\n where\n         i_item_id               in (select\n  i_item_id\nfrom item\nwhere i_color in ('powder','green','cyan'))\n and     cs_item_sk              = i_item_sk\n and     cs_sold_date_sk         = d_date_sk\n and     d_year                  = 2000\n and     d_moy                   = 2\n and     cs_bill_addr_sk         = ca_address_sk\n and     ca_gmt_offset           = -6 \n group by i_item_id),\n ws as (\n select i_item_id,sum(ws_ext_sales_price) total_sales\n from\n \tweb_sales,\n \tdate_dim,\n         customer_address,\n         item\n where\n         i_item_id               in (select\n  i_item_id\nfrom item\nwhere i_color in ('powder','green','cyan'))\n and     ws_item_sk              = i_item_sk\n and     ws_sold_date_sk         = d_date_sk\n and     d_year                  = 2000\n and     d_moy                   = 2\n and     ws_bill_addr_sk         = ca_address_sk\n and     ca_gmt_offset           = -6\n group by i_item_id)\n  select i_item_id ,sum(total_sales) total_sales\n from  (select * from ss \n        union all\n        select * from cs \n        union all\n        select * from ws) tmp1\n group by i_item_id\n order by total_sales,\n          i_item_id\n LIMIT 100;\n\n-- end query 56 in stream 0 using template query56.tpl\n",
      "optimized_sql": "WITH ss AS (SELECT i_item_id, SUM(ss_ext_sales_price) AS total_sales FROM store_sales, date_dim, customer_address, item WHERE i_item_id IN (SELECT i_item_id FROM item WHERE i_color IN ('powder', 'green', 'cyan')) AND ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND d_year = 2000 AND d_moy = 2 AND ss_addr_sk = ca_address_sk AND ca_gmt_offset = -6 GROUP BY i_item_id), cs AS (SELECT i_item_id, SUM(cs_ext_sales_price) AS total_sales FROM catalog_sales, date_dim, customer_address, item WHERE i_item_id IN (SELECT i_item_id FROM item WHERE i_color IN ('powder', 'green', 'cyan')) AND cs_item_sk = i_item_sk AND cs_sold_date_sk = d_date_sk AND d_year = 2000 AND d_moy = 2 AND cs_bill_addr_sk = ca_address_sk AND ca_gmt_offset = -6 GROUP BY i_item_id), ws AS (SELECT i_item_id, SUM(ws_ext_sales_price) AS total_sales FROM web_sales, date_dim, customer_address, item WHERE i_item_id IN (SELECT i_item_id FROM item WHERE i_color IN ('powder', 'green', 'cyan')) AND ws_item_sk = i_item_sk AND ws_sold_date_sk = d_date_sk AND d_year = 2000 AND d_moy = 2 AND ws_bill_addr_sk = ca_address_sk AND ca_gmt_offset = -6 GROUP BY i_item_id) SELECT i_item_id, SUM(total_sales) AS total_sales FROM (SELECT * FROM ss UNION ALL SELECT * FROM cs UNION ALL SELECT * FROM ws) AS tmp1 GROUP BY i_item_id ORDER BY total_sales, i_item_id LIMIT 100",
      "error": null
    },
    {
      "query_id": "q83",
      "status": "WIN",
      "speedup": 1.1558,
      "original_ms": 25.06,
      "optimized_ms": 21.68,
      "original_times": [
        24.68,
        22.55,
        27.56
      ],
      "optimized_times": [
        20.34,
        21.98,
        21.37
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "materialize_cte"
      ],
      "original_sql": "-- start query 83 in stream 0 using template query83.tpl\nwith sr_items as\n (select i_item_id item_id,\n        sum(sr_return_quantity) sr_item_qty\n from store_returns,\n      item,\n      date_dim\n where sr_item_sk = i_item_sk\n and   d_date    in \n\t(select d_date\n\tfrom date_dim\n\twhere d_week_seq in \n\t\t(select d_week_seq\n\t\tfrom date_dim\n\t  where d_date in ('2001-06-06','2001-09-02','2001-11-11')))\n and   sr_returned_date_sk   = d_date_sk\n group by i_item_id),\n cr_items as\n (select i_item_id item_id,\n        sum(cr_return_quantity) cr_item_qty\n from catalog_returns,\n      item,\n      date_dim\n where cr_item_sk = i_item_sk\n and   d_date    in \n\t(select d_date\n\tfrom date_dim\n\twhere d_week_seq in \n\t\t(select d_week_seq\n\t\tfrom date_dim\n\t  where d_date in ('2001-06-06','2001-09-02','2001-11-11')))\n and   cr_returned_date_sk   = d_date_sk\n group by i_item_id),\n wr_items as\n (select i_item_id item_id,\n        sum(wr_return_quantity) wr_item_qty\n from web_returns,\n      item,\n      date_dim\n where wr_item_sk = i_item_sk\n and   d_date    in \n\t(select d_date\n\tfrom date_dim\n\twhere d_week_seq in \n\t\t(select d_week_seq\n\t\tfrom date_dim\n\t\twhere d_date in ('2001-06-06','2001-09-02','2001-11-11')))\n and   wr_returned_date_sk   = d_date_sk\n group by i_item_id)\n  select sr_items.item_id\n       ,sr_item_qty\n       ,sr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 sr_dev\n       ,cr_item_qty\n       ,cr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 cr_dev\n       ,wr_item_qty\n       ,wr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 wr_dev\n       ,(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 average\n from sr_items\n     ,cr_items\n     ,wr_items\n where sr_items.item_id=cr_items.item_id\n   and sr_items.item_id=wr_items.item_id \n order by sr_items.item_id\n         ,sr_item_qty\n LIMIT 100;\n\n-- end query 83 in stream 0 using template query83.tpl\n",
      "optimized_sql": "WITH target_week_dates AS (SELECT DISTINCT d_date_sk FROM date_dim WHERE d_week_seq IN (SELECT d_week_seq FROM date_dim WHERE d_date IN ('2001-06-06', '2001-09-02', '2001-11-11'))), sr_items AS (SELECT i_item_id AS item_id, SUM(sr_return_quantity) AS sr_item_qty FROM store_returns, item, target_week_dates WHERE sr_item_sk = i_item_sk AND sr_returned_date_sk = target_week_dates.d_date_sk GROUP BY i_item_id), cr_items AS (SELECT i_item_id AS item_id, SUM(cr_return_quantity) AS cr_item_qty FROM catalog_returns, item, target_week_dates WHERE cr_item_sk = i_item_sk AND cr_returned_date_sk = target_week_dates.d_date_sk GROUP BY i_item_id), wr_items AS (SELECT i_item_id AS item_id, SUM(wr_return_quantity) AS wr_item_qty FROM web_returns, item, date_dim WHERE wr_item_sk = i_item_sk AND d_date IN (SELECT d_date FROM date_dim WHERE d_week_seq IN (SELECT d_week_seq FROM date_dim WHERE d_date IN ('2001-06-06', '2001-09-02', '2001-11-11'))) AND wr_returned_date_sk = d_date_sk GROUP BY i_item_id) SELECT sr_items.item_id, sr_item_qty, sr_item_qty / (sr_item_qty + cr_item_qty + wr_item_qty) / 3.0 * 100 AS sr_dev, cr_item_qty, cr_item_qty / (sr_item_qty + cr_item_qty + wr_item_qty) / 3.0 * 100 AS cr_dev, wr_item_qty, wr_item_qty / (sr_item_qty + cr_item_qty + wr_item_qty) / 3.0 * 100 AS wr_dev, (sr_item_qty + cr_item_qty + wr_item_qty) / 3.0 AS average FROM sr_items, cr_items, wr_items WHERE sr_items.item_id = cr_items.item_id AND sr_items.item_id = wr_items.item_id ORDER BY sr_items.item_id, sr_item_qty LIMIT 100",
      "error": null
    },
    {
      "query_id": "q70",
      "status": "WIN",
      "speedup": 1.151,
      "original_ms": 206.91,
      "optimized_ms": 179.76,
      "original_times": [
        182.23,
        218.43,
        195.39
      ],
      "optimized_times": [
        188.07,
        184.69,
        174.84
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 70 in stream 0 using template query70.tpl\nselect \n    sum(ss_net_profit) as total_sum\n   ,s_state\n   ,s_county\n   ,grouping(s_state)+grouping(s_county) as lochierarchy\n   ,rank() over (\n \tpartition by grouping(s_state)+grouping(s_county),\n \tcase when grouping(s_county) = 0 then s_state end \n \torder by sum(ss_net_profit) desc) as rank_within_parent\n from\n    store_sales\n   ,date_dim       d1\n   ,store\n where\n    d1.d_month_seq between 1213 and 1213+11\n and d1.d_date_sk = ss_sold_date_sk\n and s_store_sk  = ss_store_sk\n and s_state in\n             ( select s_state\n               from  (select s_state as s_state,\n \t\t\t    rank() over ( partition by s_state order by sum(ss_net_profit) desc) as ranking\n                      from   store_sales, store, date_dim\n                      where  d_month_seq between 1213 and 1213+11\n \t\t\t    and d_date_sk = ss_sold_date_sk\n \t\t\t    and s_store_sk  = ss_store_sk\n                      group by s_state\n                     ) tmp1 \n               where ranking <= 5\n             )\n group by rollup(s_state,s_county)\n order by\n   lochierarchy desc\n  ,case when lochierarchy = 0 then s_state end\n  ,rank_within_parent\n LIMIT 100;\n\n-- end query 70 in stream 0 using template query70.tpl\n",
      "optimized_sql": "SELECT SUM(ss_net_profit) AS total_sum, s_state, s_county, GROUPING(s_state) + GROUPING(s_county) AS lochierarchy, RANK() OVER (PARTITION BY GROUPING(s_state) + GROUPING(s_county), CASE WHEN GROUPING(s_county) = 0 THEN s_state END ORDER BY SUM(ss_net_profit) DESC) AS rank_within_parent FROM store_sales, date_dim AS d1, store WHERE d1.d_month_seq BETWEEN 1213 AND 1213 + 11 AND d1.d_date_sk = ss_sold_date_sk AND s_store_sk = ss_store_sk AND EXISTS(SELECT 1 FROM (SELECT s2.s_state AS s_state, RANK() OVER (PARTITION BY s2.s_state ORDER BY SUM(ss2.ss_net_profit) DESC) AS ranking FROM store_sales AS ss2, store AS s2, date_dim AS d2 WHERE d2.d_month_seq BETWEEN 1213 AND 1213 + 11 AND d2.d_date_sk = ss2.ss_sold_date_sk AND s2.s_store_sk = ss2.ss_store_sk GROUP BY s2.s_state) AS tmp1 WHERE tmp1.s_state = store.s_state AND tmp1.ranking <= 5) GROUP BY ROLLUP (s_state, s_county) ORDER BY lochierarchy DESC, CASE WHEN lochierarchy = 0 THEN s_state END, rank_within_parent LIMIT 100",
      "error": null
    },
    {
      "query_id": "q40",
      "status": "WIN",
      "speedup": 1.1486,
      "original_ms": 50.52,
      "optimized_ms": 43.99,
      "original_times": [
        91.38,
        54.89,
        46.16
      ],
      "optimized_times": [
        45.37,
        43.43,
        44.55
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 40 in stream 0 using template query40.tpl\nselect \n   w_state\n  ,i_item_id\n  ,sum(case when (cast(d_date as date) < cast ('2001-04-02' as date)) \n \t\tthen cs_sales_price - coalesce(cr_refunded_cash,0) else 0 end) as sales_before\n  ,sum(case when (cast(d_date as date) >= cast ('2001-04-02' as date)) \n \t\tthen cs_sales_price - coalesce(cr_refunded_cash,0) else 0 end) as sales_after\n from\n   catalog_sales left outer join catalog_returns on\n       (cs_order_number = cr_order_number \n        and cs_item_sk = cr_item_sk)\n  ,warehouse \n  ,item\n  ,date_dim\n where\n     i_current_price between 0.99 and 1.49\n and i_item_sk          = cs_item_sk\n and cs_warehouse_sk    = w_warehouse_sk \n and cs_sold_date_sk    = d_date_sk\n and d_date between (cast ('2001-04-02' as date) - INTERVAL 30 DAY)\n                and (cast ('2001-04-02' as date) + INTERVAL 30 DAY) \n group by\n    w_state,i_item_id\n order by w_state,i_item_id\n LIMIT 100;\n\n-- end query 40 in stream 0 using template query40.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN CAST('2000-02-10' AS DATE) AND CAST('2000-04-10' AS DATE)), filtered_items AS (SELECT i_item_sk, i_item_id FROM item WHERE i_current_price BETWEEN 0.99 AND 1.49), filtered_catalog_sales AS (SELECT cs_order_number, cs_item_sk, cs_warehouse_sk, cs_sales_price, d_date FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk), filtered_sales_with_items AS (SELECT fcs.*, fi.i_item_id FROM filtered_catalog_sales AS fcs JOIN filtered_items AS fi ON fcs.cs_item_sk = fi.i_item_sk), sales_with_warehouse AS (SELECT fsi.cs_order_number, fsi.cs_item_sk, fsi.cs_sales_price, fsi.d_date, fsi.i_item_id, w.w_state FROM filtered_sales_with_items AS fsi JOIN warehouse AS w ON fsi.cs_warehouse_sk = w.w_warehouse_sk)\nSELECT sw.w_state, sw.i_item_id, SUM(CASE WHEN (CAST(sw.d_date AS DATE) < CAST('2000-03-11' AS DATE)) THEN sw.cs_sales_price - COALESCE(cr.cr_refunded_cash, 0) ELSE 0 END) AS sales_before, SUM(CASE WHEN (CAST(sw.d_date AS DATE) >= CAST('2000-03-11' AS DATE)) THEN sw.cs_sales_price - COALESCE(cr.cr_refunded_cash, 0) ELSE 0 END) AS sales_after FROM sales_with_warehouse AS sw LEFT OUTER JOIN catalog_returns AS cr ON sw.cs_order_number = cr.cr_order_number AND sw.cs_item_sk = cr.cr_item_sk GROUP BY sw.w_state, sw.i_item_id ORDER BY sw.w_state, sw.i_item_id LIMIT 100",
      "error": null
    },
    {
      "query_id": "q30",
      "status": "WIN",
      "speedup": 1.1462,
      "original_ms": 63.08,
      "optimized_ms": 55.03,
      "original_times": [
        73.11,
        62.72,
        63.43
      ],
      "optimized_times": [
        52.09,
        54.18,
        55.89
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "decorrelate"
      ],
      "original_sql": "-- start query 30 in stream 0 using template query30.tpl\nwith customer_total_return as\n (select wr_returning_customer_sk as ctr_customer_sk\n        ,ca_state as ctr_state, \n \tsum(wr_return_amt) as ctr_total_return\n from web_returns\n     ,date_dim\n     ,customer_address\n where wr_returned_date_sk = d_date_sk \n   and d_year =2002\n   and wr_returning_addr_sk = ca_address_sk \n group by wr_returning_customer_sk\n         ,ca_state)\n  select c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag\n       ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address\n       ,c_last_review_date_sk,ctr_total_return\n from customer_total_return ctr1\n     ,customer_address\n     ,customer\n where ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2\n \t\t\t  from customer_total_return ctr2 \n                  \t  where ctr1.ctr_state = ctr2.ctr_state)\n       and ca_address_sk = c_current_addr_sk\n       and ca_state = 'IN'\n       and ctr1.ctr_customer_sk = c_customer_sk\n order by c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag\n                  ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address\n                  ,c_last_review_date_sk,ctr_total_return\n LIMIT 100;\n\n-- end query 30 in stream 0 using template query30.tpl\n",
      "optimized_sql": "WITH filtered_returns AS (SELECT wr.wr_returning_customer_sk, ra.ca_state AS ctr_state, wr.wr_return_amt FROM web_returns AS wr JOIN date_dim AS d ON wr.wr_returned_date_sk = d.d_date_sk JOIN customer_address AS ra ON wr.wr_returning_addr_sk = ra.ca_address_sk JOIN customer AS c ON wr.wr_returning_customer_sk = c.c_customer_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE d.d_year = 2002 AND ca.ca_state = 'IN'), customer_total_return AS (SELECT ctr_customer_sk, ctr_state, SUM(wr_return_amt) AS ctr_total_return FROM filtered_returns GROUP BY ctr_customer_sk, ctr_state), state_avg_return AS (SELECT ctr_state, AVG(ctr_total_return) * 1.2 AS avg_return_threshold FROM customer_total_return GROUP BY ctr_state)\nSELECT c.c_customer_id, c.c_salutation, c.c_first_name, c.c_last_name, c.c_preferred_cust_flag, c.c_birth_day, c.c_birth_month, c.c_birth_year, c.c_birth_country, c.c_login, c.c_email_address, c.c_last_review_date_sk, ctr1.ctr_total_return FROM customer_total_return AS ctr1 JOIN state_avg_return AS sar ON ctr1.ctr_state = sar.ctr_state JOIN customer AS c ON ctr1.ctr_customer_sk = c.c_customer_sk WHERE ctr1.ctr_total_return > sar.avg_return_threshold ORDER BY c.c_customer_id, c.c_salutation, c.c_first_name, c.c_last_name, c.c_preferred_cust_flag, c.c_birth_day, c.c_birth_month, c.c_birth_year, c.c_birth_country, c.c_login, c.c_email_address, c.c_last_review_date_sk, ctr1.ctr_total_return LIMIT 100",
      "error": null
    },
    {
      "query_id": "q23a",
      "status": "WIN",
      "speedup": 1.14,
      "original_ms": 1716.1,
      "optimized_ms": 1502.2,
      "original_times": [
        2811.0,
        1744.1,
        1688.1
      ],
      "optimized_times": [
        1553.7,
        1501.7,
        1502.6
      ],
      "rows_match": true,
      "source": "analyst_mode",
      "transforms": [],
      "original_sql": "with frequent_ss_items as \n (select substr(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim \n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk \n    and d_year in (2000,2000+1,2000+2,2000+3)\n  group by substr(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax \n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (2000,2000+1,2000+2,2000+3) \n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\nfrom\n max_store_sales))\n  select sum(sales)\n from (select cs_quantity*cs_list_price sales\n       from catalog_sales\n           ,date_dim \n       where d_year = 2000 \n         and d_moy = 5 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n      union all\n      select ws_quantity*ws_list_price sales\n       from web_sales \n           ,date_dim \n       where d_year = 2000 \n         and d_moy = 5 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer))\n LIMIT 100;",
      "optimized_sql": "WITH store_sales_filtered AS (\n  SELECT\n    ss_item_sk,\n    ss_customer_sk,\n    ss_quantity,\n    ss_sales_price,\n    d_date\n  FROM store_sales\n  JOIN date_dim ON ss_sold_date_sk = d_date_sk\n  WHERE d_year IN (2000, 2001, 2002, 2003)\n), frequent_ss_items AS (\n  SELECT\n    SUBSTRING(i_item_desc, 1, 30) AS itemdesc,\n    i_item_sk AS item_sk,\n    d_date AS solddate,\n    COUNT(*) AS cnt\n  FROM store_sales_filtered\n  JOIN item ON ss_item_sk = i_item_sk\n  GROUP BY SUBSTRING(i_item_desc, 1, 30), i_item_sk, d_date\n  HAVING COUNT(*) > 4\n), customer_sales_2000_2003 AS (\n  SELECT\n    ss_customer_sk,\n    SUM(ss_quantity * ss_sales_price) AS csales\n  FROM store_sales_filtered\n  GROUP BY ss_customer_sk\n), max_store_sales AS (\n  SELECT MAX(csales) AS tpcds_cmax\n  FROM customer_sales_2000_2003\n), best_ss_customer AS (\n  SELECT\n    c_customer_sk,\n    SUM(ss_quantity * ss_sales_price) AS ssales\n  FROM store_sales\n  JOIN customer ON ss_customer_sk = c_customer_sk\n  WHERE ss_customer_sk IN (SELECT ss_customer_sk FROM customer_sales_2000_2003)\n  GROUP BY c_customer_sk\n  HAVING SUM(ss_quantity * ss_sales_price) > (95 / 100.0) * (SELECT tpcds_cmax FROM max_store_sales)\n), frequent_items AS (\n  SELECT DISTINCT item_sk FROM frequent_ss_items\n), best_customers AS (\n  SELECT DISTINCT c_customer_sk FROM best_ss_customer\n), may_2000_dates AS (\n  SELECT d_date_sk FROM date_dim WHERE d_year = 2000 AND d_moy = 5\n)\nSELECT SUM(sales)\nFROM (\n  SELECT cs_quantity * cs_list_price AS sales\n  FROM catalog_sales\n  JOIN may_2000_dates ON cs_sold_date_sk = d_date_sk\n  JOIN frequent_items ON cs_item_sk = frequent_items.item_sk\n  JOIN best_customers ON cs_bill_customer_sk = best_customers.c_customer_sk\n  UNION ALL\n  SELECT ws_quantity * ws_list_price AS sales\n  FROM web_sales\n  JOIN may_2000_dates ON ws_sold_date_sk = d_date_sk\n  JOIN frequent_items ON ws_item_sk = frequent_items.item_sk\n  JOIN best_customers ON ws_bill_customer_sk = best_customers.c_customer_sk\n)\nLIMIT 100",
      "error": null
    },
    {
      "query_id": "q69",
      "status": "WIN",
      "speedup": 1.1256,
      "original_ms": 96.05,
      "optimized_ms": 85.33,
      "original_times": [
        114.87,
        99.16,
        92.94
      ],
      "optimized_times": [
        89.4,
        95.99,
        74.67
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "decorrelate"
      ],
      "original_sql": "-- start query 69 in stream 0 using template query69.tpl\nselect \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  count(*) cnt1,\n  cd_purchase_estimate,\n  count(*) cnt2,\n  cd_credit_rating,\n  count(*) cnt3\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  ca_state in ('TX','VA','MI') and\n  cd_demo_sk = c.c_current_cdemo_sk and \n  exists (select *\n          from store_sales,date_dim\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 2000 and\n                d_moy between 1 and 1+2) and\n   (not exists (select *\n            from web_sales,date_dim\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 2000 and\n                  d_moy between 1 and 1+2) and\n    not exists (select * \n            from catalog_sales,date_dim\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 2000 and\n                  d_moy between 1 and 1+2))\n group by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n order by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating\n LIMIT 100;\n\n-- end query 69 in stream 0 using template query69.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001 AND d_moy BETWEEN 4 AND 6), store_sales_customers AS (SELECT DISTINCT ss_customer_sk FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk), web_sales_customers AS (SELECT DISTINCT ws_bill_customer_sk FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk), catalog_sales_customers AS (SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk), filtered_ca AS (SELECT ca_address_sk FROM customer_address WHERE ca_state IN ('KY', 'GA', 'NM'))\nSELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3 FROM customer_demographics AS cd JOIN customer AS c ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN filtered_ca AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN store_sales_customers AS ssc ON c.c_customer_sk = ssc.ss_customer_sk LEFT JOIN web_sales_customers AS wsc ON c.c_customer_sk = wsc.ws_bill_customer_sk LEFT JOIN catalog_sales_customers AS csc ON c.c_customer_sk = csc.cs_ship_customer_sk WHERE wsc.ws_bill_customer_sk IS NULL AND csc.cs_ship_customer_sk IS NULL GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating LIMIT 100",
      "error": null
    },
    {
      "query_id": "q53",
      "status": "WIN",
      "speedup": 1.1167,
      "original_ms": 59.17,
      "optimized_ms": 52.99,
      "original_times": [
        57.19,
        56.11,
        62.24
      ],
      "optimized_times": [
        56.39,
        53.35,
        52.63
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "or_to_union"
      ],
      "original_sql": "-- start query 53 in stream 0 using template query53.tpl\nselect * from \n(select i_manufact_id,\nsum(ss_sales_price) sum_sales,\navg(sum(ss_sales_price)) over (partition by i_manufact_id) avg_quarterly_sales\nfrom item, store_sales, date_dim, store\nwhere ss_item_sk = i_item_sk and\nss_sold_date_sk = d_date_sk and\nss_store_sk = s_store_sk and\nd_month_seq in (1200,1200+1,1200+2,1200+3,1200+4,1200+5,1200+6,1200+7,1200+8,1200+9,1200+10,1200+11) and\n((i_category in ('Books','Children','Electronics') and\ni_class in ('personal','portable','reference','self-help') and\ni_brand in ('scholaramalgamalg #14','scholaramalgamalg #7',\n\t\t'exportiunivamalg #9','scholaramalgamalg #9'))\nor(i_category in ('Women','Music','Men') and\ni_class in ('accessories','classical','fragrances','pants') and\ni_brand in ('amalgimporto #1','edu packscholar #1','exportiimporto #1',\n\t\t'importoamalg #1')))\ngroup by i_manufact_id, d_qoy ) tmp1\nwhere case when avg_quarterly_sales > 0 \n\tthen abs (sum_sales - avg_quarterly_sales)/ avg_quarterly_sales \n\telse null end > 0.1\norder by avg_quarterly_sales,\n\t sum_sales,\n\t i_manufact_id\n LIMIT 100;\n\n-- end query 53 in stream 0 using template query53.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_qoy FROM date_dim WHERE d_month_seq IN (1200, 1200 + 1, 1200 + 2, 1200 + 3, 1200 + 4, 1200 + 5, 1200 + 6, 1200 + 7, 1200 + 8, 1200 + 9, 1200 + 10, 1200 + 11)), filtered_sales AS (SELECT i.i_manufact_id, d.d_qoy, ss.ss_sales_price FROM item AS i JOIN store_sales AS ss ON ss.ss_item_sk = i.i_item_sk JOIN filtered_dates AS d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store AS s ON ss.ss_store_sk = s.s_store_sk WHERE i.i_category IN ('Books', 'Children', 'Electronics') AND i.i_class IN ('personal', 'portable', 'reference', 'self-help') AND i.i_brand IN ('scholaramalgamalg #14', 'scholaramalgamalg #7', 'exportiunivamalg #9', 'scholaramalgamalg #9') UNION ALL SELECT i.i_manufact_id, d.d_qoy, ss.ss_sales_price FROM item AS i JOIN store_sales AS ss ON ss.ss_item_sk = i.i_item_sk JOIN filtered_dates AS d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store AS s ON ss.ss_store_sk = s.s_store_sk WHERE i.i_category IN ('Women', 'Music', 'Men') AND i.i_class IN ('accessories', 'classical', 'fragrances', 'pants') AND i.i_brand IN ('amalgimporto #1', 'edu packscholar #1', 'exportiimporto #1', 'importoamalg #1'))\nSELECT * FROM (SELECT i_manufact_id, SUM(ss_sales_price) AS sum_sales, AVG(SUM(ss_sales_price)) OVER (PARTITION BY i_manufact_id) AS avg_quarterly_sales FROM filtered_sales GROUP BY i_manufact_id, d_qoy) AS tmp1 WHERE CASE WHEN avg_quarterly_sales > 0 THEN ABS(sum_sales - avg_quarterly_sales) / avg_quarterly_sales ELSE NULL END > 0.1 ORDER BY avg_quarterly_sales, sum_sales, i_manufact_id LIMIT 100",
      "error": null
    },
    {
      "query_id": "q99",
      "status": "WIN",
      "speedup": 1.1143,
      "original_ms": 80.49,
      "optimized_ms": 72.24,
      "original_times": [
        85.03,
        80.12,
        80.87
      ],
      "optimized_times": [
        73.25,
        73.7,
        70.77
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 99 in stream 0 using template query99.tpl\nselect \n   substr(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\" \n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and \n                 (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\" \n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and \n                 (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\" \n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n                 (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\" \n  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\" \nfrom\n   catalog_sales\n  ,warehouse\n  ,ship_mode\n  ,call_center\n  ,date_dim\nwhere\n    d_month_seq between 1224 and 1224 + 11\nand cs_ship_date_sk   = d_date_sk\nand cs_warehouse_sk   = w_warehouse_sk\nand cs_ship_mode_sk   = sm_ship_mode_sk\nand cs_call_center_sk = cc_call_center_sk\ngroup by\n   substr(w_warehouse_name,1,20)\n  ,sm_type\n  ,cc_name\norder by substr(w_warehouse_name,1,20)\n        ,sm_type\n        ,cc_name\n LIMIT 100;\n\n-- end query 99 in stream 0 using template query99.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1200 AND 1200 + 11), warehouse_with_substr AS (SELECT SUBSTRING(w_warehouse_name, 1, 20) AS w_substr, w_warehouse_sk, w_warehouse_name FROM warehouse)\nSELECT w_substr, sm_type, LOWER(cc_name) AS cc_name_lower, SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM catalog_sales JOIN filtered_dates ON cs_ship_date_sk = d_date_sk JOIN warehouse_with_substr ON cs_warehouse_sk = w_warehouse_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk JOIN call_center ON cs_call_center_sk = cc_call_center_sk GROUP BY w_substr, sm_type, cc_name ORDER BY w_substr NULLS FIRST, sm_type NULLS FIRST, cc_name_lower NULLS FIRST LIMIT 100",
      "error": null
    },
    {
      "query_id": "q50",
      "status": "WIN",
      "speedup": 1.1074,
      "original_ms": 152.62,
      "optimized_ms": 137.81,
      "original_times": [
        133.17,
        149.82,
        155.42
      ],
      "optimized_times": [
        148.29,
        147.89,
        127.73
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 50 in stream 0 using template query50.tpl\nselect \n   s_store_name\n  ,s_company_id\n  ,s_street_number\n  ,s_street_name\n  ,s_street_type\n  ,s_suite_number\n  ,s_city\n  ,s_county\n  ,s_state\n  ,s_zip\n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\" \n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 30) and \n                 (sr_returned_date_sk - ss_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\" \n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 60) and \n                 (sr_returned_date_sk - ss_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\" \n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk > 90) and\n                 (sr_returned_date_sk - ss_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\" \n  ,sum(case when (sr_returned_date_sk - ss_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\" \nfrom\n   store_sales\n  ,store_returns\n  ,store\n  ,date_dim d1\n  ,date_dim d2\nwhere\n    d2.d_year = 2001\nand d2.d_moy  = 8\nand ss_ticket_number = sr_ticket_number\nand ss_item_sk = sr_item_sk\nand ss_sold_date_sk   = d1.d_date_sk\nand sr_returned_date_sk   = d2.d_date_sk\nand ss_customer_sk = sr_customer_sk\nand ss_store_sk = s_store_sk\ngroup by\n   s_store_name\n  ,s_company_id\n  ,s_street_number\n  ,s_street_name\n  ,s_street_type\n  ,s_suite_number\n  ,s_city\n  ,s_county\n  ,s_state\n  ,s_zip\norder by s_store_name\n        ,s_company_id\n        ,s_street_number\n        ,s_street_name\n        ,s_street_type\n        ,s_suite_number\n        ,s_city\n        ,s_county\n        ,s_state\n        ,s_zip\n LIMIT 100;\n\n-- end query 50 in stream 0 using template query50.tpl\n",
      "optimized_sql": "WITH filtered_d2 AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001 AND d_moy = 8), filtered_returns AS (SELECT sr.sr_returned_date_sk, ss.ss_store_sk, ss.ss_sold_date_sk FROM store_returns AS sr JOIN filtered_d2 ON sr.sr_returned_date_sk = filtered_d2.d_date_sk JOIN store_sales AS ss ON sr.sr_ticket_number = ss.ss_ticket_number AND sr.sr_item_sk = ss.ss_item_sk AND sr.sr_customer_sk = ss.ss_customer_sk)\nSELECT s.s_store_name, s.s_company_id, s.s_street_number, s.s_street_name, s.s_street_type, s.s_suite_number, s.s_city, s.s_county, s.s_state, s.s_zip, SUM(CASE WHEN (fr.sr_returned_date_sk - fr.ss_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN (fr.sr_returned_date_sk - fr.ss_sold_date_sk > 30) AND (fr.sr_returned_date_sk - fr.ss_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN (fr.sr_returned_date_sk - fr.ss_sold_date_sk > 60) AND (fr.sr_returned_date_sk - fr.ss_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN (fr.sr_returned_date_sk - fr.ss_sold_date_sk > 90) AND (fr.sr_returned_date_sk - fr.ss_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN (fr.sr_returned_date_sk - fr.ss_sold_date_sk > 120) THEN 1 ELSE 0 END) AS \">120 days\" FROM filtered_returns AS fr JOIN store AS s ON fr.ss_store_sk = s.s_store_sk GROUP BY s.s_store_name, s.s_company_id, s.s_street_number, s.s_street_name, s.s_street_type, s.s_suite_number, s.s_city, s.s_county, s.s_state, s.s_zip ORDER BY s.s_store_name, s.s_company_id, s.s_street_number, s.s_street_name, s.s_street_type, s.s_suite_number, s.s_city, s.s_county, s.s_state, s.s_zip LIMIT 100",
      "error": null
    },
    {
      "query_id": "q84",
      "status": "WIN",
      "speedup": 1.102,
      "original_ms": 21.64,
      "optimized_ms": 19.64,
      "original_times": [
        34.22,
        21.19,
        22.09
      ],
      "optimized_times": [
        19.16,
        19.28,
        20.0
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "reorder_join"
      ],
      "original_sql": "-- start query 84 in stream 0 using template query84.tpl\nselect c_customer_id as customer_id\n       , coalesce(c_last_name,'') || ', ' || coalesce(c_first_name,'') as customername\n from customer\n     ,customer_address\n     ,customer_demographics\n     ,household_demographics\n     ,income_band\n     ,store_returns\n where ca_city\t        =  'Oakwood'\n   and c_current_addr_sk = ca_address_sk\n   and ib_lower_bound   >=  5806\n   and ib_upper_bound   <=  5806 + 50000\n   and ib_income_band_sk = hd_income_band_sk\n   and cd_demo_sk = c_current_cdemo_sk\n   and hd_demo_sk = c_current_hdemo_sk\n   and sr_cdemo_sk = cd_demo_sk\n order by c_customer_id\n LIMIT 100;\n\n-- end query 84 in stream 0 using template query84.tpl\n",
      "optimized_sql": "WITH filtered_income_band AS (SELECT ib_income_band_sk FROM income_band WHERE ib_lower_bound >= 5806 AND ib_upper_bound <= 5806 + 50000), filtered_address AS (SELECT ca_address_sk FROM customer_address WHERE ca_city = 'Oakwood')\nSELECT c.c_customer_id AS customer_id, COALESCE(c.c_last_name, '') || ', ' || COALESCE(c.c_first_name, '') AS customername FROM customer AS c JOIN filtered_address AS a ON c.c_current_addr_sk = a.ca_address_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN filtered_income_band AS ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN customer_demographics AS cd ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN store_returns AS sr ON sr.sr_cdemo_sk = cd.cd_demo_sk ORDER BY c_customer_id LIMIT 100",
      "error": null
    },
    {
      "query_id": "q22",
      "status": "WIN",
      "speedup": 1.1004,
      "original_ms": 4230.21,
      "optimized_ms": 3844.31,
      "original_times": [
        5076.36,
        4443.22,
        4017.19
      ],
      "optimized_times": [
        3807.46,
        3775.12,
        3913.51
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 22 in stream 0 using template query22.tpl\nselect i_product_name\n             ,i_brand\n             ,i_class\n             ,i_category\n             ,avg(inv_quantity_on_hand) qoh\n       from inventory\n           ,date_dim\n           ,item\n       where inv_date_sk=d_date_sk\n              and inv_item_sk=i_item_sk\n              and d_month_seq between 1188 and 1188 + 11\n       group by rollup(i_product_name\n                       ,i_brand\n                       ,i_class\n                       ,i_category)\norder by qoh, i_product_name, i_brand, i_class, i_category\n LIMIT 100;\n\n-- end query 22 in stream 0 using template query22.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1188 AND 1188 + 11)\nSELECT i_product_name, i_brand, i_class, i_category, AVG(inv_quantity_on_hand) AS qoh FROM inventory JOIN filtered_dates ON inv_date_sk = d_date_sk JOIN item ON inv_item_sk = i_item_sk GROUP BY ROLLUP (i_product_name, i_brand, i_class, i_category) ORDER BY qoh, i_product_name, i_brand, i_class, i_category LIMIT 100",
      "error": null
    },
    {
      "query_id": "q43",
      "status": "IMPROVED",
      "speedup": 1.0983,
      "original_ms": 86.09,
      "optimized_ms": 78.39,
      "original_times": [
        102.85,
        100.11,
        72.08
      ],
      "optimized_times": [
        70.44,
        77.39,
        79.39
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "early_filter"
      ],
      "original_sql": "-- start query 43 in stream 0 using template query43.tpl\nselect s_store_name, s_store_id,\n        sum(case when (d_day_name='Sunday') then ss_sales_price else null end) sun_sales,\n        sum(case when (d_day_name='Monday') then ss_sales_price else null end) mon_sales,\n        sum(case when (d_day_name='Tuesday') then ss_sales_price else  null end) tue_sales,\n        sum(case when (d_day_name='Wednesday') then ss_sales_price else null end) wed_sales,\n        sum(case when (d_day_name='Thursday') then ss_sales_price else null end) thu_sales,\n        sum(case when (d_day_name='Friday') then ss_sales_price else null end) fri_sales,\n        sum(case when (d_day_name='Saturday') then ss_sales_price else null end) sat_sales\n from date_dim, store_sales, store\n where d_date_sk = ss_sold_date_sk and\n       s_store_sk = ss_store_sk and\n       s_gmt_offset = -5 and\n       d_year = 2000 \n group by s_store_name, s_store_id\n order by s_store_name, s_store_id,sun_sales,mon_sales,tue_sales,wed_sales,thu_sales,fri_sales,sat_sales\n LIMIT 100;\n\n-- end query 43 in stream 0 using template query43.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_day_name FROM date_dim WHERE d_year = 2000), filtered_stores AS (SELECT s_store_sk, s_store_name, s_store_id FROM store WHERE s_gmt_offset = -5)\nSELECT s.s_store_name, s.s_store_id, SUM(CASE WHEN d.d_day_name = 'Sunday' THEN ss.ss_sales_price END) AS sun_sales, SUM(CASE WHEN d.d_day_name = 'Monday' THEN ss.ss_sales_price END) AS mon_sales, SUM(CASE WHEN d.d_day_name = 'Tuesday' THEN ss.ss_sales_price END) AS tue_sales, SUM(CASE WHEN d.d_day_name = 'Wednesday' THEN ss.ss_sales_price END) AS wed_sales, SUM(CASE WHEN d.d_day_name = 'Thursday' THEN ss.ss_sales_price END) AS thu_sales, SUM(CASE WHEN d.d_day_name = 'Friday' THEN ss.ss_sales_price END) AS fri_sales, SUM(CASE WHEN d.d_day_name = 'Saturday' THEN ss.ss_sales_price END) AS sat_sales FROM filtered_dates AS d JOIN store_sales AS ss ON d.d_date_sk = ss.ss_sold_date_sk JOIN filtered_stores AS s ON s.s_store_sk = ss.ss_store_sk GROUP BY s.s_store_name, s.s_store_id ORDER BY s.s_store_name, s.s_store_id, sun_sales, mon_sales, tue_sales, wed_sales, thu_sales, fri_sales, sat_sales LIMIT 100",
      "error": null
    },
    {
      "query_id": "q37",
      "status": "IMPROVED",
      "speedup": 1.0968,
      "original_ms": 26.53,
      "optimized_ms": 24.19,
      "original_times": [
        25.5,
        21.94,
        31.12
      ],
      "optimized_times": [
        26.01,
        23.46,
        24.92
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 37 in stream 0 using template query37.tpl\nselect i_item_id\n       ,i_item_desc\n       ,i_current_price\n from item, inventory, date_dim, catalog_sales\n where i_current_price between 45 and 45 + 30\n and inv_item_sk = i_item_sk\n and d_date_sk=inv_date_sk\n and d_date between cast('1999-02-21' as date) and (cast('1999-02-21' as date) + INTERVAL 60 DAY)\n and i_manufact_id in (856,707,1000,747)\n and inv_quantity_on_hand between 100 and 500\n and cs_item_sk = i_item_sk\n group by i_item_id,i_item_desc,i_current_price\n order by i_item_id\n LIMIT 100;\n\n-- end query 37 in stream 0 using template query37.tpl\n",
      "optimized_sql": "WITH filtered_items AS (SELECT i_item_sk, i_item_id, i_item_desc, i_current_price FROM item WHERE i_current_price BETWEEN 45 AND 45 + 30 AND i_manufact_id IN (856, 707, 1000, 747)), filtered_inventory AS (SELECT inv_item_sk, inv_date_sk FROM inventory WHERE inv_quantity_on_hand BETWEEN 100 AND 500), filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-02-21' AS DATE) AND (CAST('1999-02-21' AS DATE) + INTERVAL '60' DAY))\nSELECT fi.i_item_id, fi.i_item_desc, fi.i_current_price FROM filtered_items AS fi JOIN filtered_inventory AS inv ON fi.i_item_sk = inv.inv_item_sk JOIN filtered_dates AS d ON inv.inv_date_sk = d.d_date_sk JOIN catalog_sales AS cs ON fi.i_item_sk = cs.cs_item_sk GROUP BY fi.i_item_id, fi.i_item_desc, fi.i_current_price ORDER BY fi.i_item_id LIMIT 100",
      "error": null
    },
    {
      "query_id": "q15",
      "status": "IMPROVED",
      "speedup": 1.0852,
      "original_ms": 51.4,
      "optimized_ms": 47.37,
      "original_times": [
        56.02,
        52.8,
        50.0
      ],
      "optimized_times": [
        47.45,
        47.17,
        47.56
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "or_to_union"
      ],
      "original_sql": "-- start query 15 in stream 0 using template query15.tpl\nselect ca_zip\n       ,sum(cs_sales_price)\n from catalog_sales\n     ,customer\n     ,customer_address\n     ,date_dim\n where cs_bill_customer_sk = c_customer_sk\n \tand c_current_addr_sk = ca_address_sk \n \tand ( substr(ca_zip,1,5) in ('85669', '86197','88274','83405','86475',\n                                   '85392', '85460', '80348', '81792')\n \t      or ca_state in ('CA','WA','GA')\n \t      or cs_sales_price > 500)\n \tand cs_sold_date_sk = d_date_sk\n \tand d_qoy = 1 and d_year = 2001\n group by ca_zip\n order by ca_zip\n LIMIT 100;\n\n-- end query 15 in stream 0 using template query15.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_qoy = 1 AND d_year = 2001), filtered_sales AS (SELECT cs_sales_price, ca_zip FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE SUBSTRING(ca_zip, 1, 5) IN ('85669', '86197', '88274', '83405', '86475', '85392', '85460', '80348', '81792') UNION ALL SELECT cs_sales_price, ca_zip FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ca_state IN ('CA', 'WA', 'GA') UNION ALL SELECT cs_sales_price, ca_zip FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE cs_sales_price > 500)\nSELECT ca_zip, SUM(cs_sales_price) FROM filtered_sales GROUP BY ca_zip ORDER BY ca_zip LIMIT 100",
      "error": null
    },
    {
      "query_id": "q33",
      "status": "IMPROVED",
      "speedup": 1.0835,
      "original_ms": 48.76,
      "optimized_ms": 45.01,
      "original_times": [
        54.71,
        47.46,
        50.07
      ],
      "optimized_times": [
        46.81,
        46.02,
        43.99
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "materialize_cte"
      ],
      "original_sql": "-- start query 33 in stream 0 using template query33.tpl\nwith ss as (\n select\n          i_manufact_id,sum(ss_ext_sales_price) total_sales\n from\n \tstore_sales,\n \tdate_dim,\n         customer_address,\n         item\n where\n         i_manufact_id in (select\n  i_manufact_id\nfrom\n item\nwhere i_category in ('Home'))\n and     ss_item_sk              = i_item_sk\n and     ss_sold_date_sk         = d_date_sk\n and     d_year                  = 2002\n and     d_moy                   = 1\n and     ss_addr_sk              = ca_address_sk\n and     ca_gmt_offset           = -5 \n group by i_manufact_id),\n cs as (\n select\n          i_manufact_id,sum(cs_ext_sales_price) total_sales\n from\n \tcatalog_sales,\n \tdate_dim,\n         customer_address,\n         item\n where\n         i_manufact_id               in (select\n  i_manufact_id\nfrom\n item\nwhere i_category in ('Home'))\n and     cs_item_sk              = i_item_sk\n and     cs_sold_date_sk         = d_date_sk\n and     d_year                  = 2002\n and     d_moy                   = 1\n and     cs_bill_addr_sk         = ca_address_sk\n and     ca_gmt_offset           = -5 \n group by i_manufact_id),\n ws as (\n select\n          i_manufact_id,sum(ws_ext_sales_price) total_sales\n from\n \tweb_sales,\n \tdate_dim,\n         customer_address,\n         item\n where\n         i_manufact_id               in (select\n  i_manufact_id\nfrom\n item\nwhere i_category in ('Home'))\n and     ws_item_sk              = i_item_sk\n and     ws_sold_date_sk         = d_date_sk\n and     d_year                  = 2002\n and     d_moy                   = 1\n and     ws_bill_addr_sk         = ca_address_sk\n and     ca_gmt_offset           = -5\n group by i_manufact_id)\n  select i_manufact_id ,sum(total_sales) total_sales\n from  (select * from ss \n        union all\n        select * from cs \n        union all\n        select * from ws) tmp1\n group by i_manufact_id\n order by total_sales\n LIMIT 100;\n\n-- end query 33 in stream 0 using template query33.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998 AND d_moy = 5), filtered_addresses AS (SELECT ca_address_sk FROM customer_address WHERE ca_gmt_offset = -5), electronics_items AS (SELECT i_item_sk, i_manufact_id FROM item WHERE i_category IN ('Electronics')), ss AS (SELECT i_manufact_id, SUM(ss_ext_sales_price) AS total_sales FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN filtered_addresses ON ss_addr_sk = ca_address_sk JOIN electronics_items ON ss_item_sk = i_item_sk GROUP BY i_manufact_id), ws AS (SELECT i_manufact_id, SUM(ws_ext_sales_price) AS total_sales FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk JOIN filtered_addresses ON ws_bill_addr_sk = ca_address_sk JOIN electronics_items ON ws_item_sk = i_item_sk GROUP BY i_manufact_id), cs AS (SELECT i_manufact_id, SUM(cs_ext_sales_price) AS total_sales FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN filtered_addresses ON cs_bill_addr_sk = ca_address_sk JOIN electronics_items ON cs_item_sk = i_item_sk GROUP BY i_manufact_id)\nSELECT i_manufact_id, SUM(total_sales) AS total_sales FROM (SELECT * FROM ss UNION ALL SELECT * FROM cs UNION ALL SELECT * FROM ws) AS tmp1 GROUP BY i_manufact_id ORDER BY total_sales LIMIT 100",
      "error": null
    },
    {
      "query_id": "q78",
      "status": "IMPROVED",
      "speedup": 1.0802,
      "original_ms": 935.58,
      "optimized_ms": 866.13,
      "original_times": [
        995.14,
        922.17,
        948.99
      ],
      "optimized_times": [
        951.45,
        874.98,
        857.29
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "pushdown"
      ],
      "original_sql": "-- start query 78 in stream 0 using template query78.tpl\nwith ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select\nss_item_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2000\norder by \n  ss_item_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty,\n  other_chan_wholesale_cost,\n  other_chan_sales_price,\n  ratio\n LIMIT 100;\n\n-- end query 78 in stream 0 using template query78.tpl\n",
      "optimized_sql": "WITH ss_filtered AS (SELECT d_year AS ss_sold_year, ss_item_sk, ss_customer_sk, SUM(ss_quantity) AS ss_qty, SUM(ss_wholesale_cost) AS ss_wc, SUM(ss_sales_price) AS ss_sp FROM store_sales LEFT JOIN store_returns ON sr_ticket_number = ss_ticket_number AND ss_item_sk = sr_item_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE sr_ticket_number IS NULL AND d_year = 2000 GROUP BY d_year, ss_item_sk, ss_customer_sk), ws_filtered AS (SELECT d_year AS ws_sold_year, ws_item_sk, ws_bill_customer_sk AS ws_customer_sk, SUM(ws_quantity) AS ws_qty, SUM(ws_wholesale_cost) AS ws_wc, SUM(ws_sales_price) AS ws_sp FROM web_sales LEFT JOIN web_returns ON wr_order_number = ws_order_number AND ws_item_sk = wr_item_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk WHERE wr_order_number IS NULL AND d_year = 2000 GROUP BY d_year, ws_item_sk, ws_bill_customer_sk), cs_filtered AS (SELECT d_year AS cs_sold_year, cs_item_sk, cs_bill_customer_sk AS cs_customer_sk, SUM(cs_quantity) AS cs_qty, SUM(cs_wholesale_cost) AS cs_wc, SUM(cs_sales_price) AS cs_sp FROM catalog_sales LEFT JOIN catalog_returns ON cr_order_number = cs_order_number AND cs_item_sk = cr_item_sk JOIN date_dim ON cs_sold_date_sk = d_date_sk WHERE cr_order_number IS NULL AND d_year = 2000 GROUP BY d_year, cs_item_sk, cs_bill_customer_sk), ws AS (SELECT d_year AS ws_sold_year, ws_item_sk, ws_bill_customer_sk AS ws_customer_sk, SUM(ws_quantity) AS ws_qty, SUM(ws_wholesale_cost) AS ws_wc, SUM(ws_sales_price) AS ws_sp FROM web_sales LEFT JOIN web_returns ON wr_order_number = ws_order_number AND ws_item_sk = wr_item_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk WHERE wr_order_number IS NULL GROUP BY d_year, ws_item_sk, ws_bill_customer_sk), cs AS (SELECT d_year AS cs_sold_year, cs_item_sk, cs_bill_customer_sk AS cs_customer_sk, SUM(cs_quantity) AS cs_qty, SUM(cs_wholesale_cost) AS cs_wc, SUM(cs_sales_price) AS cs_sp FROM catalog_sales LEFT JOIN catalog_returns ON cr_order_number = cs_order_number AND cs_item_sk = cr_item_sk JOIN date_dim ON cs_sold_date_sk = d_date_sk WHERE cr_order_number IS NULL GROUP BY d_year, cs_item_sk, cs_bill_customer_sk), ss AS (SELECT d_year AS ss_sold_year, ss_item_sk, ss_customer_sk, SUM(ss_quantity) AS ss_qty, SUM(ss_wholesale_cost) AS ss_wc, SUM(ss_sales_price) AS ss_sp FROM store_sales LEFT JOIN store_returns ON sr_ticket_number = ss_ticket_number AND ss_item_sk = sr_item_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE sr_ticket_number IS NULL GROUP BY d_year, ss_item_sk, ss_customer_sk)\nSELECT ss_sold_year, ss_item_sk, ss_customer_sk, ROUND((ss_qty * 1.00) / (COALESCE(ws_qty, 0) + COALESCE(cs_qty, 0)), 2) AS ratio, ss_qty AS store_qty, ss_wc AS store_wholesale_cost, ss_sp AS store_sales_price, COALESCE(ws_qty, 0) + COALESCE(cs_qty, 0) AS other_chan_qty, COALESCE(ws_wc, 0) + COALESCE(cs_wc, 0) AS other_chan_wholesale_cost, COALESCE(ws_sp, 0) + COALESCE(cs_sp, 0) AS other_chan_sales_price FROM ss LEFT JOIN ws ON (ws_sold_year = ss_sold_year AND ws_item_sk = ss_item_sk AND ws_customer_sk = ss_customer_sk) LEFT JOIN cs ON (cs_sold_year = ss_sold_year AND cs_item_sk = ss_item_sk AND cs_customer_sk = ss_customer_sk) WHERE (COALESCE(ws_qty, 0) > 0 OR COALESCE(cs_qty, 0) > 0) AND ss_sold_year = 2000 ORDER BY ss_sold_year, ss_item_sk, ss_customer_sk, ss_qty DESC, ss_wc DESC, ss_sp DESC, other_chan_qty, other_chan_wholesale_cost, other_chan_sales_price, ratio LIMIT 100",
      "error": null
    },
    {
      "query_id": "q34",
      "status": "IMPROVED",
      "speedup": 1.0789,
      "original_ms": 87.9,
      "optimized_ms": 81.47,
      "original_times": [
        75.73,
        83.7,
        92.1
      ],
      "optimized_times": [
        79.56,
        79.86,
        83.09
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "or_to_union"
      ],
      "original_sql": "-- start query 34 in stream 0 using template query34.tpl\nselect c_last_name\n       ,c_first_name\n       ,c_salutation\n       ,c_preferred_cust_flag\n       ,ss_ticket_number\n       ,cnt from\n   (select ss_ticket_number\n          ,ss_customer_sk\n          ,count(*) cnt\n    from store_sales,date_dim,store,household_demographics\n    where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n    and store_sales.ss_store_sk = store.s_store_sk  \n    and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n    and (date_dim.d_dom between 1 and 3 or date_dim.d_dom between 25 and 28)\n    and (household_demographics.hd_buy_potential = '1001-5000' or\n         household_demographics.hd_buy_potential = '0-500')\n    and household_demographics.hd_vehicle_count > 0\n    and (case when household_demographics.hd_vehicle_count > 0 \n\tthen household_demographics.hd_dep_count/ household_demographics.hd_vehicle_count \n\telse null \n\tend)  > 1.2\n    and date_dim.d_year in (1998,1998+1,1998+2)\n    and store.s_county in ('Ziebach County','Daviess County','Walker County','Richland County',\n                           'Barrow County','Franklin Parish','Williamson County','Luce County')\n    group by ss_ticket_number,ss_customer_sk) dn,customer\n    where ss_customer_sk = c_customer_sk\n      and cnt between 15 and 20\n    order by c_last_name,c_first_name,c_salutation,c_preferred_cust_flag desc, ss_ticket_number;\n\n-- end query 34 in stream 0 using template query34.tpl\n",
      "optimized_sql": "WITH filtered_sales AS (SELECT ss.ss_ticket_number, ss.ss_customer_sk FROM store_sales AS ss JOIN date_dim AS d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store AS s ON ss.ss_store_sk = s.s_store_sk JOIN household_demographics AS hd ON ss.ss_hdemo_sk = hd.hd_demo_sk WHERE d.d_dom BETWEEN 1 AND 3 AND hd.hd_buy_potential = '1001-5000' AND hd.hd_vehicle_count > 0 AND (CASE WHEN hd.hd_vehicle_count > 0 THEN hd.hd_dep_count / hd.hd_vehicle_count ELSE NULL END) > 1.2 AND d.d_year IN (1998, 1999, 2000) AND s.s_county IN ('Ziebach County', 'Daviess County', 'Walker County', 'Richland County', 'Barrow County', 'Franklin Parish', 'Williamson County', 'Luce County') UNION ALL SELECT ss.ss_ticket_number, ss.ss_customer_sk FROM store_sales AS ss JOIN date_dim AS d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store AS s ON ss.ss_store_sk = s.s_store_sk JOIN household_demographics AS hd ON ss.ss_hdemo_sk = hd.hd_demo_sk WHERE d.d_dom BETWEEN 1 AND 3 AND hd.hd_buy_potential = '0-500' AND hd.hd_vehicle_count > 0 AND (CASE WHEN hd.hd_vehicle_count > 0 THEN hd.hd_dep_count / hd.hd_vehicle_count ELSE NULL END) > 1.2 AND d.d_year IN (1998, 1999, 2000) AND s.s_county IN ('Ziebach County', 'Daviess County', 'Walker County', 'Richland County', 'Barrow County', 'Franklin Parish', 'Williamson County', 'Luce County') UNION ALL SELECT ss.ss_ticket_number, ss.ss_customer_sk FROM store_sales AS ss JOIN date_dim AS d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store AS s ON ss.ss_store_sk = s.s_store_sk JOIN household_demographics AS hd ON ss.ss_hdemo_sk = hd.hd_demo_sk WHERE d.d_dom BETWEEN 25 AND 28 AND hd.hd_buy_potential = '1001-5000' AND hd.hd_vehicle_count > 0 AND (CASE WHEN hd.hd_vehicle_count > 0 THEN hd.hd_dep_count / hd.hd_vehicle_count ELSE NULL END) > 1.2 AND d.d_year IN (1998, 1999, 2000) AND s.s_county IN ('Ziebach County', 'Daviess County', 'Walker County', 'Richland County', 'Barrow County', 'Franklin Parish', 'Williamson County', 'Luce County') UNION ALL SELECT ss.ss_ticket_number, ss.ss_customer_sk FROM store_sales AS ss JOIN date_dim AS d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store AS s ON ss.ss_store_sk = s.s_store_sk JOIN household_demographics AS hd ON ss.ss_hdemo_sk = hd.hd_demo_sk WHERE d.d_dom BETWEEN 25 AND 28 AND hd.hd_buy_potential = '0-500' AND hd.hd_vehicle_count > 0 AND (CASE WHEN hd.hd_vehicle_count > 0 THEN hd.hd_dep_count / hd.hd_vehicle_count ELSE NULL END) > 1.2 AND d.d_year IN (1998, 1999, 2000) AND s.s_county IN ('Ziebach County', 'Daviess County', 'Walker County', 'Richland County', 'Barrow County', 'Franklin Parish', 'Williamson County', 'Luce County')), ticket_counts AS (SELECT ss_ticket_number, ss_customer_sk, COUNT(*) AS cnt FROM filtered_sales GROUP BY ss_ticket_number, ss_customer_sk)\nSELECT c.c_last_name, c.c_first_name, c.c_salutation, c.c_preferred_cust_flag, tc.ss_ticket_number, tc.cnt FROM ticket_counts AS tc JOIN customer AS c ON tc.ss_customer_sk = c.c_customer_sk WHERE tc.cnt BETWEEN 15 AND 20 ORDER BY c.c_last_name, c.c_first_name, c.c_salutation, c.c_preferred_cust_flag DESC, tc.ss_ticket_number",
      "error": null
    },
    {
      "query_id": "q11",
      "status": "IMPROVED",
      "speedup": 1.0643,
      "original_ms": 953.39,
      "optimized_ms": 895.81,
      "original_times": [
        974.51,
        947.45,
        959.33
      ],
      "optimized_times": [
        876.42,
        926.43,
        865.19
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [],
      "original_sql": "-- start query 11 in stream 0 using template query11.tpl\nwith year_total as (\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,c_preferred_cust_flag customer_preferred_cust_flag\n       ,c_birth_country customer_birth_country\n       ,c_login customer_login\n       ,c_email_address customer_email_address\n       ,d_year dyear\n       ,sum(ss_ext_list_price-ss_ext_discount_amt) year_total\n       ,'s' sale_type\n from customer\n     ,store_sales\n     ,date_dim\n where c_customer_sk = ss_customer_sk\n   and ss_sold_date_sk = d_date_sk\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,c_preferred_cust_flag \n         ,c_birth_country\n         ,c_login\n         ,c_email_address\n         ,d_year \n union all\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,c_preferred_cust_flag customer_preferred_cust_flag\n       ,c_birth_country customer_birth_country\n       ,c_login customer_login\n       ,c_email_address customer_email_address\n       ,d_year dyear\n       ,sum(ws_ext_list_price-ws_ext_discount_amt) year_total\n       ,'w' sale_type\n from customer\n     ,web_sales\n     ,date_dim\n where c_customer_sk = ws_bill_customer_sk\n   and ws_sold_date_sk = d_date_sk\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,c_preferred_cust_flag \n         ,c_birth_country\n         ,c_login\n         ,c_email_address\n         ,d_year\n         )\n  select \n                  t_s_secyear.customer_id\n                 ,t_s_secyear.customer_first_name\n                 ,t_s_secyear.customer_last_name\n                 ,t_s_secyear.customer_birth_country\n from year_total t_s_firstyear\n     ,year_total t_s_secyear\n     ,year_total t_w_firstyear\n     ,year_total t_w_secyear\n where t_s_secyear.customer_id = t_s_firstyear.customer_id\n         and t_s_firstyear.customer_id = t_w_secyear.customer_id\n         and t_s_firstyear.customer_id = t_w_firstyear.customer_id\n         and t_s_firstyear.sale_type = 's'\n         and t_w_firstyear.sale_type = 'w'\n         and t_s_secyear.sale_type = 's'\n         and t_w_secyear.sale_type = 'w'\n         and t_s_firstyear.dyear = 2001\n         and t_s_secyear.dyear = 2001+1\n         and t_w_firstyear.dyear = 2001\n         and t_w_secyear.dyear = 2001+1\n         and t_s_firstyear.year_total > 0\n         and t_w_firstyear.year_total > 0\n         and case when t_w_firstyear.year_total > 0 then t_w_secyear.year_total / t_w_firstyear.year_total else 0.0 end\n             > case when t_s_firstyear.year_total > 0 then t_s_secyear.year_total / t_s_firstyear.year_total else 0.0 end\n order by t_s_secyear.customer_id\n         ,t_s_secyear.customer_first_name\n         ,t_s_secyear.customer_last_name\n         ,t_s_secyear.customer_birth_country\n LIMIT 100;\n\n-- end query 11 in stream 0 using template query11.tpl\n",
      "optimized_sql": "WITH year_total AS (SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, c_preferred_cust_flag AS customer_preferred_cust_flag, c_birth_country AS customer_birth_country, c_login AS customer_login, c_email_address AS customer_email_address, d_year AS dyear, SUM(ss_ext_list_price - ss_ext_discount_amt) AS year_total, 's' AS sale_type FROM customer, store_sales, date_dim WHERE c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year IN (2001, 2002) GROUP BY c_customer_id, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_country, c_login, c_email_address, d_year UNION ALL SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, c_preferred_cust_flag AS customer_preferred_cust_flag, c_birth_country AS customer_birth_country, c_login AS customer_login, c_email_address AS customer_email_address, d_year AS dyear, SUM(ws_ext_list_price - ws_ext_discount_amt) AS year_total, 'w' AS sale_type FROM customer, web_sales, date_dim WHERE c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year IN (2001, 2002) GROUP BY c_customer_id, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_country, c_login, c_email_address, d_year) SELECT t_s_secyear.customer_id, t_s_secyear.customer_first_name, t_s_secyear.customer_last_name, t_s_secyear.customer_birth_country FROM year_total AS t_s_firstyear, year_total AS t_s_secyear, year_total AS t_w_firstyear, year_total AS t_w_secyear WHERE t_s_secyear.customer_id = t_s_firstyear.customer_id AND t_s_firstyear.customer_id = t_w_secyear.customer_id AND t_s_firstyear.customer_id = t_w_firstyear.customer_id AND t_s_firstyear.sale_type = 's' AND t_w_firstyear.sale_type = 'w' AND t_s_secyear.sale_type = 's' AND t_w_secyear.sale_type = 'w' AND t_s_firstyear.dyear = 2001 AND t_s_secyear.dyear = 2001 + 1 AND t_w_firstyear.dyear = 2001 AND t_w_secyear.dyear = 2001 + 1 AND t_s_firstyear.year_total > 0 AND t_w_firstyear.year_total > 0 AND CASE WHEN t_w_firstyear.year_total > 0 THEN t_w_secyear.year_total / t_w_firstyear.year_total ELSE 0.0 END > CASE WHEN t_s_firstyear.year_total > 0 THEN t_s_secyear.year_total / t_s_firstyear.year_total ELSE 0.0 END ORDER BY t_s_secyear.customer_id, t_s_secyear.customer_first_name, t_s_secyear.customer_last_name, t_s_secyear.customer_birth_country LIMIT 100",
      "error": null
    },
    {
      "query_id": "q7",
      "status": "IMPROVED",
      "speedup": 1.0504,
      "original_ms": 106.36,
      "optimized_ms": 101.26,
      "original_times": [
        267.0,
        117.67,
        95.05
      ],
      "optimized_times": [
        104.44,
        103.31,
        99.21
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 7 in stream 0 using template query7.tpl\nselect i_item_id, \n        avg(ss_quantity) agg1,\n        avg(ss_list_price) agg2,\n        avg(ss_coupon_amt) agg3,\n        avg(ss_sales_price) agg4 \n from store_sales, customer_demographics, date_dim, item, promotion\n where ss_sold_date_sk = d_date_sk and\n       ss_item_sk = i_item_sk and\n       ss_cdemo_sk = cd_demo_sk and\n       ss_promo_sk = p_promo_sk and\n       cd_gender = 'F' and \n       cd_marital_status = 'W' and\n       cd_education_status = 'College' and\n       (p_channel_email = 'N' or p_channel_event = 'N') and\n       d_year = 2001 \n group by i_item_id\n order by i_item_id\n LIMIT 100;\n\n-- end query 7 in stream 0 using template query7.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001), filtered_demographics AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_gender = 'F' AND cd_marital_status = 'W' AND cd_education_status = 'College'), promo_filtered_sales AS (SELECT i.i_item_id, ss.ss_quantity, ss.ss_list_price, ss.ss_coupon_amt, ss.ss_sales_price FROM store_sales AS ss JOIN filtered_dates AS d ON ss.ss_sold_date_sk = d.d_date_sk JOIN filtered_demographics AS cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN item AS i ON ss.ss_item_sk = i.i_item_sk JOIN promotion AS p ON ss.ss_promo_sk = p.p_promo_sk WHERE p.p_channel_email = 'N' UNION ALL SELECT i.i_item_id, ss.ss_quantity, ss.ss_list_price, ss.ss_coupon_amt, ss.ss_sales_price FROM store_sales AS ss JOIN filtered_dates AS d ON ss.ss_sold_date_sk = d.d_date_sk JOIN filtered_demographics AS cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN item AS i ON ss.ss_item_sk = i.i_item_sk JOIN promotion AS p ON ss.ss_promo_sk = p.p_promo_sk WHERE p.p_channel_event = 'N')\nSELECT i_item_id, AVG(ss_quantity) AS agg1, AVG(ss_list_price) AS agg2, AVG(ss_coupon_amt) AS agg3, AVG(ss_sales_price) AS agg4 FROM promo_filtered_sales GROUP BY i_item_id ORDER BY i_item_id LIMIT 100",
      "error": null
    },
    {
      "query_id": "q39",
      "status": "NEUTRAL",
      "speedup": 1.0488,
      "original_ms": 234.02,
      "optimized_ms": 223.14,
      "original_times": [
        222.71,
        242.07,
        225.96
      ],
      "optimized_times": [
        217.02,
        223.68,
        222.59
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "pushdown"
      ],
      "original_sql": "-- start query 39 in stream 0 using template query39.tpl\nwith inv as\n(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n       ,stdev,mean, case mean when 0 then null else stdev/mean end cov\n from(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n            ,stddev_samp(inv_quantity_on_hand) stdev,avg(inv_quantity_on_hand) mean\n      from inventory\n          ,item\n          ,warehouse\n          ,date_dim\n      where inv_item_sk = i_item_sk\n        and inv_warehouse_sk = w_warehouse_sk\n        and inv_date_sk = d_date_sk\n        and d_year =1998\n      group by w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy) foo\n where case mean when 0 then 0 else stdev/mean end > 1)\nselect inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean, inv1.cov\n        ,inv2.w_warehouse_sk,inv2.i_item_sk,inv2.d_moy,inv2.mean, inv2.cov\nfrom inv inv1,inv inv2\nwhere inv1.i_item_sk = inv2.i_item_sk\n  and inv1.w_warehouse_sk =  inv2.w_warehouse_sk\n  and inv1.d_moy=1\n  and inv2.d_moy=1+1\norder by inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean,inv1.cov\n        ,inv2.d_moy,inv2.mean, inv2.cov\n;\nwith inv as\n(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n       ,stdev,mean, case mean when 0 then null else stdev/mean end cov\n from(select w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy\n            ,stddev_samp(inv_quantity_on_hand) stdev,avg(inv_quantity_on_hand) mean\n      from inventory\n          ,item\n          ,warehouse\n          ,date_dim\n      where inv_item_sk = i_item_sk\n        and inv_warehouse_sk = w_warehouse_sk\n        and inv_date_sk = d_date_sk\n        and d_year =1998\n      group by w_warehouse_name,w_warehouse_sk,i_item_sk,d_moy) foo\n where case mean when 0 then 0 else stdev/mean end > 1)\nselect inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean, inv1.cov\n        ,inv2.w_warehouse_sk,inv2.i_item_sk,inv2.d_moy,inv2.mean, inv2.cov\nfrom inv inv1,inv inv2\nwhere inv1.i_item_sk = inv2.i_item_sk\n  and inv1.w_warehouse_sk =  inv2.w_warehouse_sk\n  and inv1.d_moy=1\n  and inv2.d_moy=1+1\n  and inv1.cov > 1.5\norder by inv1.w_warehouse_sk,inv1.i_item_sk,inv1.d_moy,inv1.mean,inv1.cov\n        ,inv2.d_moy,inv2.mean, inv2.cov\n;\n\n-- end query 39 in stream 0 using template query39.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_moy FROM date_dim WHERE d_year = 2001), inv AS (SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, STDDEV_SAMP(inv_quantity_on_hand) * 1.000 AS stdev, AVG(inv_quantity_on_hand) AS mean, CASE mean WHEN 0 THEN NULL ELSE stdev / mean END AS cov FROM inventory JOIN filtered_dates ON inv_date_sk = d_date_sk JOIN item ON inv_item_sk = i_item_sk JOIN warehouse ON inv_warehouse_sk = w_warehouse_sk GROUP BY w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy HAVING CASE mean WHEN 0 THEN 0 ELSE stdev / NULLIF(mean, 0) END > 1)\nSELECT inv1.w_warehouse_sk AS wsk1, inv1.i_item_sk AS isk1, inv1.d_moy AS dmoy1, inv1.mean AS mean1, inv1.cov AS cov1, inv2.w_warehouse_sk, inv2.i_item_sk, inv2.d_moy, inv2.mean, inv2.cov FROM inv AS inv1, inv AS inv2 WHERE inv1.i_item_sk = inv2.i_item_sk AND inv1.w_warehouse_sk = inv2.w_warehouse_sk AND inv1.d_moy = 1 AND inv2.d_moy = 1 + 1 ORDER BY inv1.w_warehouse_sk NULLS FIRST, inv1.i_item_sk NULLS FIRST, inv1.d_moy NULLS FIRST, inv1.mean NULLS FIRST, inv1.cov NULLS FIRST, inv2.d_moy NULLS FIRST, inv2.mean NULLS FIRST, inv2.cov NULLS FIRST",
      "error": null
    },
    {
      "query_id": "q3",
      "status": "NEUTRAL",
      "speedup": 1.0444,
      "original_ms": 36.88,
      "optimized_ms": 35.31,
      "original_times": [
        380.99,
        37.63,
        36.12
      ],
      "optimized_times": [
        39.42,
        35.55,
        35.06
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [],
      "original_sql": "-- start query 3 in stream 0 using template query3.tpl\nselect dt.d_year \n       ,item.i_brand_id brand_id \n       ,item.i_brand brand\n       ,sum(ss_sales_price) sum_agg\n from  date_dim dt \n      ,store_sales\n      ,item\n where dt.d_date_sk = store_sales.ss_sold_date_sk\n   and store_sales.ss_item_sk = item.i_item_sk\n   and item.i_manufact_id = 816\n   and dt.d_moy=11\n group by dt.d_year\n      ,item.i_brand\n      ,item.i_brand_id\n order by dt.d_year\n         ,sum_agg desc\n         ,brand_id\n LIMIT 100;\n\n-- end query 3 in stream 0 using template query3.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_year FROM date_dim WHERE d_moy = 11), filtered_items AS (SELECT i_item_sk, i_brand_id, i_brand FROM item WHERE i_manufact_id = 128)\nSELECT dt.d_year, item.i_brand_id AS brand_id, item.i_brand AS brand, SUM(ss_ext_sales_price) AS sum_agg FROM store_sales JOIN filtered_dates AS dt ON store_sales.ss_sold_date_sk = dt.d_date_sk JOIN filtered_items AS item ON store_sales.ss_item_sk = item.i_item_sk GROUP BY dt.d_year, item.i_brand, item.i_brand_id ORDER BY dt.d_year, sum_agg DESC, brand_id LIMIT 100",
      "error": null
    },
    {
      "query_id": "q91",
      "status": "ERROR",
      "speedup": 1.0274,
      "original_ms": 30.9,
      "optimized_ms": 30.08,
      "original_times": [
        38.1,
        29.21,
        32.59
      ],
      "optimized_times": [
        31.58,
        32.84,
        27.32
      ],
      "rows_match": false,
      "source": "state_0",
      "transforms": [
        "or_to_union"
      ],
      "original_sql": "-- start query 91 in stream 0 using template query91.tpl\nselect  \n        cc_call_center_id Call_Center,\n        cc_name Call_Center_Name,\n        cc_manager Manager,\n        sum(cr_net_loss) Returns_Loss\nfrom\n        call_center,\n        catalog_returns,\n        date_dim,\n        customer,\n        customer_address,\n        customer_demographics,\n        household_demographics\nwhere\n        cr_call_center_sk       = cc_call_center_sk\nand     cr_returned_date_sk     = d_date_sk\nand     cr_returning_customer_sk= c_customer_sk\nand     cd_demo_sk              = c_current_cdemo_sk\nand     hd_demo_sk              = c_current_hdemo_sk\nand     ca_address_sk           = c_current_addr_sk\nand     d_year                  = 2001 \nand     d_moy                   = 11\nand     ( (cd_marital_status       = 'M' and cd_education_status     = 'Unknown')\n        or(cd_marital_status       = 'W' and cd_education_status     = 'Advanced Degree'))\nand     hd_buy_potential like '1001-5000%'\nand     ca_gmt_offset           = -6\ngroup by cc_call_center_id,cc_name,cc_manager,cd_marital_status,cd_education_status\norder by sum(cr_net_loss) desc;\n\n-- end query 91 in stream 0 using template query91.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001 AND d_moy = 11), filtered_returns AS (SELECT cr.cr_net_loss, cc.cc_call_center_id, cc.cc_name, cc.cc_manager, cd.cd_marital_status, cd.cd_education_status FROM catalog_returns AS cr JOIN filtered_dates AS d ON cr.cr_returned_date_sk = d.d_date_sk JOIN call_center AS cc ON cr.cr_call_center_sk = cc.cc_call_center_sk JOIN customer AS c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN customer_demographics AS cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE cd.cd_marital_status = 'M' AND cd.cd_education_status = 'Unknown' AND hd.hd_buy_potential LIKE '1001-5000%' AND ca.ca_gmt_offset = -6 UNION ALL SELECT cr.cr_net_loss, cc.cc_call_center_id, cc.cc_name, cc.cc_manager, cd.cd_marital_status, cd.cd_education_status FROM catalog_returns AS cr JOIN filtered_dates AS d ON cr.cr_returned_date_sk = d.d_date_sk JOIN call_center AS cc ON cr.cr_call_center_sk = cc.cc_call_center_sk JOIN customer AS c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN customer_demographics AS cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics AS hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE cd.cd_marital_status = 'W' AND cd.cd_education_status = 'Advanced Degree' AND hd.hd_buy_potential LIKE '1001-5000%' AND ca.ca_gmt_offset = -6)\nSELECT cc_call_center_id AS Call_Center, cc_name AS Call_Center_Name, cc_manager AS Manager, SUM(cr_net_loss) AS Returns_Loss FROM filtered_returns GROUP BY cc_call_center_id, cc_name, cc_manager, cd_marital_status, cd_education_status ORDER BY SUM(cr_net_loss) DESC",
      "error": null
    },
    {
      "query_id": "q55",
      "status": "NEUTRAL",
      "speedup": 1.0251,
      "original_ms": 33.9,
      "optimized_ms": 33.07,
      "original_times": [
        35.97,
        32.59,
        35.2
      ],
      "optimized_times": [
        33.55,
        34.66,
        31.47
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 55 in stream 0 using template query55.tpl\nselect i_brand_id brand_id, i_brand brand,\n \tsum(ss_ext_sales_price) ext_price\n from date_dim, store_sales, item\n where d_date_sk = ss_sold_date_sk\n \tand ss_item_sk = i_item_sk\n \tand i_manager_id=100\n \tand d_moy=12\n \tand d_year=2000\n group by i_brand, i_brand_id\n order by ext_price desc, i_brand_id\n LIMIT 100;\n\n-- end query 55 in stream 0 using template query55.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2000 AND d_moy = 12), filtered_items AS (SELECT i_item_sk, i_brand_id, i_brand FROM item WHERE i_manager_id = 100)\nSELECT i_brand_id AS brand_id, i_brand AS brand, SUM(ss_ext_sales_price) AS ext_price FROM store_sales JOIN filtered_dates AS fd ON ss_sold_date_sk = fd.d_date_sk JOIN filtered_items AS fi ON ss_item_sk = fi.i_item_sk GROUP BY i_brand, i_brand_id ORDER BY ext_price DESC, i_brand_id LIMIT 100",
      "error": null
    },
    {
      "query_id": "q68",
      "status": "NEUTRAL",
      "speedup": 1.0159,
      "original_ms": 141.03,
      "optimized_ms": 138.83,
      "original_times": [
        244.65,
        139.16,
        142.9
      ],
      "optimized_times": [
        118.52,
        155.55,
        122.11
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "or_to_union"
      ],
      "original_sql": "-- start query 68 in stream 0 using template query68.tpl\nselect c_last_name\n       ,c_first_name\n       ,ca_city\n       ,bought_city\n       ,ss_ticket_number\n       ,extended_price\n       ,extended_tax\n       ,list_price\n from (select ss_ticket_number\n             ,ss_customer_sk\n             ,ca_city bought_city\n             ,sum(ss_ext_sales_price) extended_price \n             ,sum(ss_ext_list_price) list_price\n             ,sum(ss_ext_tax) extended_tax \n       from store_sales\n           ,date_dim\n           ,store\n           ,household_demographics\n           ,customer_address \n       where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n         and store_sales.ss_store_sk = store.s_store_sk  \n        and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n        and store_sales.ss_addr_sk = customer_address.ca_address_sk\n        and date_dim.d_dom between 1 and 2 \n        and (household_demographics.hd_dep_count = 8 or\n             household_demographics.hd_vehicle_count= -1)\n        and date_dim.d_year in (1998,1998+1,1998+2)\n        and store.s_city in ('Pleasant Hill','Five Points')\n       group by ss_ticket_number\n               ,ss_customer_sk\n               ,ss_addr_sk,ca_city) dn\n      ,customer\n      ,customer_address current_addr\n where ss_customer_sk = c_customer_sk\n   and customer.c_current_addr_sk = current_addr.ca_address_sk\n   and current_addr.ca_city <> bought_city\n order by c_last_name\n         ,ss_ticket_number\n LIMIT 100;\n\n-- end query 68 in stream 0 using template query68.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_dom BETWEEN 1 AND 2 AND d_year IN (1999, 2000, 2001)), filtered_stores AS (SELECT s_store_sk FROM store WHERE s_city IN ('Fairview', 'Midway')), filtered_hh_demo AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_dep_count = 4 OR hd_vehicle_count = 3), store_sales_agg AS (SELECT ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city AS bought_city, SUM(ss_ext_sales_price) AS extended_price, SUM(ss_ext_list_price) AS list_price, SUM(ss_ext_tax) AS extended_tax FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN filtered_stores ON ss_store_sk = s_store_sk JOIN filtered_hh_demo ON ss_hdemo_sk = hd_demo_sk JOIN customer_address ON ss_addr_sk = ca_address_sk GROUP BY ss_ticket_number, ss_customer_sk, ss_addr_sk, ca_city)\nSELECT c_last_name, c_first_name, ca_city, bought_city, ss_ticket_number, extended_price, extended_tax, list_price FROM store_sales_agg AS dn JOIN customer ON ss_customer_sk = c_customer_sk JOIN customer_address AS current_addr ON customer.c_current_addr_sk = current_addr.ca_address_sk WHERE current_addr.ca_city <> bought_city ORDER BY c_last_name NULLS FIRST, ss_ticket_number NULLS FIRST LIMIT 100",
      "error": null
    },
    {
      "query_id": "q23",
      "status": "NEUTRAL",
      "speedup": 1.0151,
      "original_ms": 1853.72,
      "optimized_ms": 1826.06,
      "original_times": [
        1792.72,
        1876.81,
        1830.64
      ],
      "optimized_times": [
        1755.02,
        1829.44,
        1822.68
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 23 in stream 0 using template query23.tpl\nwith frequent_ss_items as \n (select substr(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim \n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk \n    and d_year in (2000,2000+1,2000+2,2000+3)\n  group by substr(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax \n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (2000,2000+1,2000+2,2000+3) \n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\nfrom\n max_store_sales))\n  select sum(sales)\n from (select cs_quantity*cs_list_price sales\n       from catalog_sales\n           ,date_dim \n       where d_year = 2000 \n         and d_moy = 5 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n      union all\n      select ws_quantity*ws_list_price sales\n       from web_sales \n           ,date_dim \n       where d_year = 2000 \n         and d_moy = 5 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer))\n LIMIT 100;\nwith frequent_ss_items as\n (select substr(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (2000,2000 + 1,2000 + 2,2000 + 3)\n  group by substr(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (2000,2000+1,2000+2,2000+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 2000 \n         and d_moy = 5 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 2000 \n         and d_moy = 5 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n       group by c_last_name,c_first_name) \n     order by c_last_name,c_first_name,sales\n LIMIT 100;\n\n-- end query 23 in stream 0 using template query23.tpl\n",
      "optimized_sql": "WITH date_years AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year IN (2000, 2001, 2002, 2003)), date_month AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_year = 2000 AND d_moy = 2), frequent_ss_items AS (SELECT itemdesc, i_item_sk AS item_sk, d_date AS solddate, COUNT(*) AS cnt FROM store_sales, date_years, (SELECT SUBSTRING(i_item_desc, 1, 30) AS itemdesc, * FROM item) AS sq1 WHERE ss_sold_date_sk = d_date_sk AND ss_item_sk = i_item_sk GROUP BY itemdesc, i_item_sk, d_date HAVING COUNT(*) > 4), max_store_sales AS (SELECT MAX(csales) AS tpcds_cmax FROM (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS csales FROM store_sales, customer, date_years WHERE ss_customer_sk = c_customer_sk AND ss_sold_date_sk = d_date_sk GROUP BY c_customer_sk) AS sq2), best_ss_customer AS (SELECT c_customer_sk, SUM(ss_quantity * ss_sales_price) AS ssales FROM store_sales, customer, max_store_sales WHERE ss_customer_sk = c_customer_sk GROUP BY c_customer_sk HAVING SUM(ss_quantity * ss_sales_price) > (50 / 100.0) * MAX(tpcds_cmax))\nSELECT c_last_name, c_first_name, sales FROM (SELECT c_last_name, c_first_name, SUM(cs_quantity * cs_list_price) AS sales FROM catalog_sales, customer, date_month, frequent_ss_items, best_ss_customer WHERE cs_sold_date_sk = d_date_sk AND cs_item_sk = item_sk AND cs_bill_customer_sk = best_ss_customer.c_customer_sk AND cs_bill_customer_sk = customer.c_customer_sk GROUP BY c_last_name, c_first_name UNION ALL SELECT c_last_name, c_first_name, SUM(ws_quantity * ws_list_price) AS sales FROM web_sales, customer, date_month, frequent_ss_items, best_ss_customer WHERE ws_sold_date_sk = d_date_sk AND ws_item_sk = item_sk AND ws_bill_customer_sk = best_ss_customer.c_customer_sk AND ws_bill_customer_sk = customer.c_customer_sk GROUP BY c_last_name, c_first_name) AS sq3 ORDER BY c_last_name NULLS FIRST, c_first_name NULLS FIRST, sales NULLS FIRST LIMIT 100",
      "error": null
    },
    {
      "query_id": "q20",
      "status": "NEUTRAL",
      "speedup": 1.0109,
      "original_ms": 30.98,
      "optimized_ms": 30.64,
      "original_times": [
        33.14,
        29.39,
        32.57
      ],
      "optimized_times": [
        28.93,
        32.34,
        28.95
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 20 in stream 0 using template query20.tpl\nselect i_item_id\n       ,i_item_desc \n       ,i_category \n       ,i_class \n       ,i_current_price\n       ,sum(cs_ext_sales_price) as itemrevenue \n       ,sum(cs_ext_sales_price)*100/sum(sum(cs_ext_sales_price)) over\n           (partition by i_class) as revenueratio\n from\tcatalog_sales\n     ,item \n     ,date_dim\n where cs_item_sk = i_item_sk \n   and i_category in ('Shoes', 'Books', 'Women')\n   and cs_sold_date_sk = d_date_sk\n and d_date between cast('2002-01-26' as date) \n \t\t\t\tand (cast('2002-01-26' as date) + INTERVAL 30 DAY)\n group by i_item_id\n         ,i_item_desc \n         ,i_category\n         ,i_class\n         ,i_current_price\n order by i_category\n         ,i_class\n         ,i_item_id\n         ,i_item_desc\n         ,revenueratio\n LIMIT 100;\n\n-- end query 20 in stream 0 using template query20.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-02-22' AS DATE) AND CAST('1999-03-24' AS DATE)), filtered_items AS (SELECT i_item_sk, i_item_id, i_item_desc, i_category, i_class, i_current_price FROM item WHERE i_category IN ('Sports', 'Books', 'Home')), catalog_sales_filtered AS (SELECT cs.cs_ext_sales_price, cs.cs_item_sk, i.i_item_id, i.i_item_desc, i.i_category, i.i_class, i.i_current_price FROM catalog_sales AS cs JOIN filtered_dates AS fd ON cs.cs_sold_date_sk = fd.d_date_sk JOIN filtered_items AS i ON cs.cs_item_sk = i.i_item_sk)\nSELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, SUM(cs_ext_sales_price) AS itemrevenue, SUM(cs_ext_sales_price) * 100.0000 / SUM(SUM(cs_ext_sales_price)) OVER (PARTITION BY i_class) AS revenueratio FROM catalog_sales_filtered GROUP BY i_item_id, i_item_desc, i_category, i_class, i_current_price ORDER BY i_category NULLS FIRST, i_class NULLS FIRST, i_item_id NULLS FIRST, i_item_desc NULLS FIRST, revenueratio NULLS FIRST LIMIT 100",
      "error": null
    },
    {
      "query_id": "q26",
      "status": "NEUTRAL",
      "speedup": 1.0093,
      "original_ms": 156.07,
      "optimized_ms": 154.62,
      "original_times": [
        169.8,
        159.41,
        152.73
      ],
      "optimized_times": [
        155.13,
        147.77,
        161.47
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "or_to_union"
      ],
      "original_sql": "-- start query 26 in stream 0 using template query26.tpl\nselect i_item_id, \n        avg(cs_quantity) agg1,\n        avg(cs_list_price) agg2,\n        avg(cs_coupon_amt) agg3,\n        avg(cs_sales_price) agg4 \n from catalog_sales, customer_demographics, date_dim, item, promotion\n where cs_sold_date_sk = d_date_sk and\n       cs_item_sk = i_item_sk and\n       cs_bill_cdemo_sk = cd_demo_sk and\n       cs_promo_sk = p_promo_sk and\n       cd_gender = 'M' and \n       cd_marital_status = 'S' and\n       cd_education_status = 'Unknown' and\n       (p_channel_email = 'N' or p_channel_event = 'N') and\n       d_year = 2001 \n group by i_item_id\n order by i_item_id\n LIMIT 100;\n\n-- end query 26 in stream 0 using template query26.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001), filtered_sales AS (SELECT i.i_item_id, cs.cs_quantity, cs.cs_list_price, cs.cs_coupon_amt, cs.cs_sales_price FROM catalog_sales AS cs JOIN filtered_dates AS d ON cs.cs_sold_date_sk = d.d_date_sk JOIN customer_demographics AS cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN item AS i ON cs.cs_item_sk = i.i_item_sk JOIN promotion AS p ON cs.cs_promo_sk = p.p_promo_sk WHERE cd.cd_gender = 'M' AND cd.cd_marital_status = 'S' AND cd.cd_education_status = 'Unknown' AND p.p_channel_email = 'N' UNION ALL SELECT i.i_item_id, cs.cs_quantity, cs.cs_list_price, cs.cs_coupon_amt, cs.cs_sales_price FROM catalog_sales AS cs JOIN filtered_dates AS d ON cs.cs_sold_date_sk = d.d_date_sk JOIN customer_demographics AS cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN item AS i ON cs.cs_item_sk = i.i_item_sk JOIN promotion AS p ON cs.cs_promo_sk = p.p_promo_sk WHERE cd.cd_gender = 'M' AND cd.cd_marital_status = 'S' AND cd.cd_education_status = 'Unknown' AND p.p_channel_event = 'N')\nSELECT i_item_id, AVG(cs_quantity) AS agg1, AVG(cs_list_price) AS agg2, AVG(cs_coupon_amt) AS agg3, AVG(cs_sales_price) AS agg4 FROM filtered_sales GROUP BY i_item_id ORDER BY i_item_id LIMIT 100",
      "error": null
    },
    {
      "query_id": "q62",
      "status": "NEUTRAL",
      "speedup": 1.0039,
      "original_ms": 43.99,
      "optimized_ms": 43.82,
      "original_times": [
        46.81,
        44.91,
        43.07
      ],
      "optimized_times": [
        43.76,
        44.16,
        43.48
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 62 in stream 0 using template query62.tpl\nselect \n   substr(w_warehouse_name,1,20)\n  ,sm_type\n  ,web_name\n  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk <= 30 ) then 1 else 0 end)  as \"30 days\" \n  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk > 30) and \n                 (ws_ship_date_sk - ws_sold_date_sk <= 60) then 1 else 0 end )  as \"31-60 days\" \n  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk > 60) and \n                 (ws_ship_date_sk - ws_sold_date_sk <= 90) then 1 else 0 end)  as \"61-90 days\" \n  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk > 90) and\n                 (ws_ship_date_sk - ws_sold_date_sk <= 120) then 1 else 0 end)  as \"91-120 days\" \n  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk  > 120) then 1 else 0 end)  as \">120 days\" \nfrom\n   web_sales\n  ,warehouse\n  ,ship_mode\n  ,web_site\n  ,date_dim\nwhere\n    d_month_seq between 1194 and 1194 + 11\nand ws_ship_date_sk   = d_date_sk\nand ws_warehouse_sk   = w_warehouse_sk\nand ws_ship_mode_sk   = sm_ship_mode_sk\nand ws_web_site_sk    = web_site_sk\ngroup by\n   substr(w_warehouse_name,1,20)\n  ,sm_type\n  ,web_name\norder by substr(w_warehouse_name,1,20)\n        ,sm_type\n       ,web_name\n LIMIT 100;\n\n-- end query 62 in stream 0 using template query62.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1194 AND 1194 + 11), filtered_sales AS (SELECT ws_warehouse_sk, ws_ship_mode_sk, ws_web_site_sk, (ws_ship_date_sk - ws_sold_date_sk) AS days_diff FROM web_sales JOIN filtered_dates ON ws_ship_date_sk = d_date_sk)\nSELECT SUBSTRING(w_warehouse_name, 1, 20), sm_type, web_name, SUM(CASE WHEN days_diff <= 30 THEN 1 ELSE 0 END) AS \"30 days\", SUM(CASE WHEN days_diff > 30 AND days_diff <= 60 THEN 1 ELSE 0 END) AS \"31-60 days\", SUM(CASE WHEN days_diff > 60 AND days_diff <= 90 THEN 1 ELSE 0 END) AS \"61-90 days\", SUM(CASE WHEN days_diff > 90 AND days_diff <= 120 THEN 1 ELSE 0 END) AS \"91-120 days\", SUM(CASE WHEN days_diff > 120 THEN 1 ELSE 0 END) AS \">120 days\" FROM filtered_sales JOIN warehouse ON ws_warehouse_sk = w_warehouse_sk JOIN ship_mode ON ws_ship_mode_sk = sm_ship_mode_sk JOIN web_site ON ws_web_site_sk = web_site_sk GROUP BY SUBSTRING(w_warehouse_name, 1, 20), sm_type, web_name ORDER BY SUBSTRING(w_warehouse_name, 1, 20), sm_type, web_name LIMIT 100",
      "error": null
    },
    {
      "query_id": "q63",
      "status": "ERROR",
      "speedup": 1.0,
      "original_ms": 0,
      "optimized_ms": 0,
      "original_times": [],
      "optimized_times": [],
      "rows_match": null,
      "source": "state_0",
      "transforms": [
        "or_to_union"
      ],
      "original_sql": "-- start query 63 in stream 0 using template query63.tpl\nselect * \nfrom (select i_manager_id\n             ,sum(ss_sales_price) sum_sales\n             ,avg(sum(ss_sales_price)) over (partition by i_manager_id) avg_monthly_sales\n      from item\n          ,store_sales\n          ,date_dim\n          ,store\n      where ss_item_sk = i_item_sk\n        and ss_sold_date_sk = d_date_sk\n        and ss_store_sk = s_store_sk\n        and d_month_seq in (1181,1181+1,1181+2,1181+3,1181+4,1181+5,1181+6,1181+7,1181+8,1181+9,1181+10,1181+11)\n        and ((    i_category in ('Books','Children','Electronics')\n              and i_class in ('personal','portable','reference','self-help')\n              and i_brand in ('scholaramalgamalg #14','scholaramalgamalg #7',\n\t\t                  'exportiunivamalg #9','scholaramalgamalg #9'))\n           or(    i_category in ('Women','Music','Men')\n              and i_class in ('accessories','classical','fragrances','pants')\n              and i_brand in ('amalgimporto #1','edu packscholar #1','exportiimporto #1',\n\t\t                 'importoamalg #1')))\ngroup by i_manager_id, d_moy) tmp1\nwhere case when avg_monthly_sales > 0 then abs (sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\norder by i_manager_id\n        ,avg_monthly_sales\n        ,sum_sales\n LIMIT 100;\n\n-- end query 63 in stream 0 using template query63.tpl\n",
      "optimized_sql": "-- start query 63 in stream 0 using template query63.tpl\nselect * \nfrom (select i_manager_id\n             ,sum(ss_sales_price) sum_sales\n             ,avg(sum(ss_sales_price)) over (partition by i_manager_id) avg_monthly_sales\n      from item\n          ,store_sales\n          ,date_dim\n          ,store\n      where ss_item_sk = i_item_sk\n        and ss_sold_date_sk = d_date_sk\n        and ss_store_sk = s_store_sk\n        and d_month_seq in (1181,1181+1,1181+2,1181+3,1181+4,1181+5,1181+6,1181+7,1181+8,1181+9,1181+10,1181+11)\n        and ((    i_category in ('Books','Children','Electronics')\n              and i_class in ('personal','portable','reference','self-help')\n              and i_brand in ('scholaramalgamalg #14','scholaramalgamalg #7',\n\t\t                  'exportiunivamalg #9','scholaramalgamalg #9'))\n           or(    i_category in ('Women','Music','Men')\n              and i_class in ('accessories','classical','fragrances','pants')\n              and i_brand in ('amalgimporto #1','edu packscholar #1','exportiimporto #1',\n\t\t                 'importoamalg #1')))\ngroup by i_manager_id, d_moy) tmp1\nwhere case when avg_monthly_sales > 0 then abs (sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\norder by i_manager_id\n        ,avg_monthly_sales\n        ,sum_sales\n LIMIT 100;\n\n-- end query 63 in stream 0 using template query63.tpl\n",
      "error": null
    },
    {
      "query_id": "q29",
      "status": "NEUTRAL",
      "speedup": 0.9991,
      "original_ms": 121.07,
      "optimized_ms": 121.17,
      "original_times": [
        126.96,
        122.32,
        119.81
      ],
      "optimized_times": [
        142.52,
        122.92,
        119.43
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 29 in stream 0 using template query29.tpl\nselect  \n     i_item_id\n    ,i_item_desc\n    ,s_store_id\n    ,s_store_name\n    ,avg(ss_quantity)        as store_sales_quantity\n    ,avg(sr_return_quantity) as store_returns_quantity\n    ,avg(cs_quantity)        as catalog_sales_quantity\n from\n    store_sales\n   ,store_returns\n   ,catalog_sales\n   ,date_dim             d1\n   ,date_dim             d2\n   ,date_dim             d3\n   ,store\n   ,item\n where\n     d1.d_moy               = 4 \n and d1.d_year              = 1999\n and d1.d_date_sk           = ss_sold_date_sk\n and i_item_sk              = ss_item_sk\n and s_store_sk             = ss_store_sk\n and ss_customer_sk         = sr_customer_sk\n and ss_item_sk             = sr_item_sk\n and ss_ticket_number       = sr_ticket_number\n and sr_returned_date_sk    = d2.d_date_sk\n and d2.d_moy               between 4 and  4 + 3 \n and d2.d_year              = 1999\n and sr_customer_sk         = cs_bill_customer_sk\n and sr_item_sk             = cs_item_sk\n and cs_sold_date_sk        = d3.d_date_sk     \n and d3.d_year              in (1999,1999+1,1999+2)\n group by\n    i_item_id\n   ,i_item_desc\n   ,s_store_id\n   ,s_store_name\n order by\n    i_item_id \n   ,i_item_desc\n   ,s_store_id\n   ,s_store_name\n LIMIT 100;\n\n-- end query 29 in stream 0 using template query29.tpl\n",
      "optimized_sql": "WITH d1_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_moy = 4 AND d_year = 1999), d2_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 4 AND 7 AND d_year = 1999), d3_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_year IN (1999, 2000, 2001)), filtered_store_sales AS (SELECT ss.ss_item_sk, ss.ss_store_sk, ss.ss_customer_sk, ss.ss_ticket_number, ss.ss_quantity FROM store_sales AS ss JOIN d1_filtered AS d1 ON ss.ss_sold_date_sk = d1.d_date_sk), filtered_store_returns AS (SELECT sr.sr_customer_sk, sr.sr_item_sk, sr.sr_ticket_number, sr.sr_return_quantity FROM store_returns AS sr JOIN d2_filtered AS d2 ON sr.sr_returned_date_sk = d2.d_date_sk), filtered_catalog_sales AS (SELECT cs.cs_bill_customer_sk, cs.cs_item_sk, cs.cs_quantity FROM catalog_sales AS cs JOIN d3_filtered AS d3 ON cs.cs_sold_date_sk = d3.d_date_sk)\nSELECT i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name, AVG(ss.ss_quantity) AS store_sales_quantity, AVG(sr.sr_return_quantity) AS store_returns_quantity, AVG(cs.cs_quantity) AS catalog_sales_quantity FROM filtered_store_sales AS ss JOIN item AS i ON ss.ss_item_sk = i.i_item_sk JOIN store AS s ON ss.ss_store_sk = s.s_store_sk JOIN filtered_store_returns AS sr ON ss.ss_customer_sk = sr.sr_customer_sk AND ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number JOIN filtered_catalog_sales AS cs ON sr.sr_customer_sk = cs.cs_bill_customer_sk AND sr.sr_item_sk = cs.cs_item_sk GROUP BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name ORDER BY i.i_item_id, i.i_item_desc, s.s_store_id, s.s_store_name LIMIT 100",
      "error": null
    },
    {
      "query_id": "q38",
      "status": "NEUTRAL",
      "speedup": 0.9978,
      "original_ms": 174.49,
      "optimized_ms": 174.88,
      "original_times": [
        183.0,
        176.22,
        172.76
      ],
      "optimized_times": [
        159.46,
        174.04,
        175.72
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 38 in stream 0 using template query38.tpl\nselect count(*) from (\n    select distinct c_last_name, c_first_name, d_date\n    from store_sales, date_dim, customer\n          where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n      and store_sales.ss_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1183 and 1183 + 11\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from catalog_sales, date_dim, customer\n          where catalog_sales.cs_sold_date_sk = date_dim.d_date_sk\n      and catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1183 and 1183 + 11\n  intersect\n    select distinct c_last_name, c_first_name, d_date\n    from web_sales, date_dim, customer\n          where web_sales.ws_sold_date_sk = date_dim.d_date_sk\n      and web_sales.ws_bill_customer_sk = customer.c_customer_sk\n      and d_month_seq between 1183 and 1183 + 11\n) hot_cust\n LIMIT 100;\n\n-- end query 38 in stream 0 using template query38.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq BETWEEN 1183 AND 1183 + 11), store_customers AS (SELECT DISTINCT c_last_name, c_first_name, d_date FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN customer ON ss_customer_sk = c_customer_sk), catalog_customers AS (SELECT DISTINCT c_last_name, c_first_name, d_date FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk), web_customers AS (SELECT DISTINCT c_last_name, c_first_name, d_date FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk JOIN customer ON ws_bill_customer_sk = c_customer_sk)\nSELECT COUNT(*) FROM (SELECT * FROM store_customers INTERSECT SELECT * FROM catalog_customers INTERSECT SELECT * FROM web_customers) AS hot_cust LIMIT 100",
      "error": null
    },
    {
      "query_id": "q42",
      "status": "NEUTRAL",
      "speedup": 0.9959,
      "original_ms": 35.94,
      "optimized_ms": 36.09,
      "original_times": [
        34.47,
        38.01,
        33.88
      ],
      "optimized_times": [
        31.96,
        33.4,
        38.78
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 42 in stream 0 using template query42.tpl\nselect dt.d_year\n \t,item.i_category_id\n \t,item.i_category\n \t,sum(ss_ext_sales_price)\n from \tdate_dim dt\n \t,store_sales\n \t,item\n where dt.d_date_sk = store_sales.ss_sold_date_sk\n \tand store_sales.ss_item_sk = item.i_item_sk\n \tand item.i_manager_id = 1  \t\n \tand dt.d_moy=11\n \tand dt.d_year=2002\n group by \tdt.d_year\n \t\t,item.i_category_id\n \t\t,item.i_category\n order by       sum(ss_ext_sales_price) desc,dt.d_year\n \t\t,item.i_category_id\n \t\t,item.i_category\n LIMIT 100;\n\n-- end query 42 in stream 0 using template query42.tpl\n",
      "optimized_sql": "WITH filtered_date AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2000 AND d_moy = 11), filtered_item AS (SELECT i_item_sk, i_category_id, i_category FROM item WHERE i_manager_id = 1)\nSELECT 2000 AS d_year, i.i_category_id, i.i_category, SUM(ss.ss_ext_sales_price) FROM filtered_date AS d JOIN store_sales AS ss ON d.d_date_sk = ss.ss_sold_date_sk JOIN filtered_item AS i ON ss.ss_item_sk = i.i_item_sk GROUP BY i.i_category_id, i.i_category ORDER BY SUM(ss.ss_ext_sales_price) DESC, d_year, i.i_category_id, i.i_category LIMIT 100",
      "error": null
    },
    {
      "query_id": "q77",
      "status": "NEUTRAL",
      "speedup": 0.9914,
      "original_ms": 58.39,
      "optimized_ms": 58.9,
      "original_times": [
        60.75,
        58.28,
        58.51
      ],
      "optimized_times": [
        63.49,
        58.04,
        59.76
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 77 in stream 0 using template query77.tpl\nwith ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('1998-08-05' as date) \n                  and (cast('1998-08-05' as date) + INTERVAL 30 DAY) \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as \"returns\",\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('1998-08-05' as date)\n                  and (cast('1998-08-05' as date) + INTERVAL 30 DAY)\n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('1998-08-05' as date)\n                  and (cast('1998-08-05' as date) + INTERVAL 30 DAY)\n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as \"returns\",\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('1998-08-05' as date)\n                  and (cast('1998-08-05' as date) + INTERVAL 30 DAY)\n group by cr_call_center_sk\n ), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('1998-08-05' as date)\n                  and (cast('1998-08-05' as date) + INTERVAL 30 DAY)\n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as \"returns\",\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('1998-08-05' as date)\n                  and (cast('1998-08-05' as date) + INTERVAL 30 DAY)\n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n  select channel\n        , id\n        , sum(sales) as sales\n        , sum(\"returns\") as \"returns\"\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(\"returns\", 0) as \"returns\"\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , \"returns\"\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(\"returns\", 0) AS \"returns\"\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by rollup (channel, id)\n order by channel\n         ,id\n LIMIT 100;\n\n-- end query 77 in stream 0 using template query77.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('2000-08-23' AS DATE) AND CAST('2000-09-22' AS DATE)), ss AS (SELECT s_store_sk, SUM(ss_ext_sales_price) AS sales, SUM(ss_net_profit) AS profit FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN store ON ss_store_sk = s_store_sk GROUP BY s_store_sk), sr AS (SELECT s_store_sk, SUM(sr_return_amt) AS returns_, SUM(sr_net_loss) AS profit_loss FROM store_returns JOIN filtered_dates ON sr_returned_date_sk = d_date_sk JOIN store ON sr_store_sk = s_store_sk GROUP BY s_store_sk), cs AS (SELECT cs_call_center_sk, SUM(cs_ext_sales_price) AS sales, SUM(cs_net_profit) AS profit FROM catalog_sales, date_dim WHERE cs_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('2000-08-23' AS DATE) AND CAST('2000-09-22' AS DATE) GROUP BY cs_call_center_sk), cr AS (SELECT cr_call_center_sk, SUM(cr_return_amount) AS returns_, SUM(cr_net_loss) AS profit_loss FROM catalog_returns, date_dim WHERE cr_returned_date_sk = d_date_sk AND d_date BETWEEN CAST('2000-08-23' AS DATE) AND CAST('2000-09-22' AS DATE) GROUP BY cr_call_center_sk), ws AS (SELECT wp_web_page_sk, SUM(ws_ext_sales_price) AS sales, SUM(ws_net_profit) AS profit FROM web_sales, date_dim, web_page WHERE ws_sold_date_sk = d_date_sk AND d_date BETWEEN CAST('2000-08-23' AS DATE) AND CAST('2000-09-22' AS DATE) AND ws_web_page_sk = wp_web_page_sk GROUP BY wp_web_page_sk), wr AS (SELECT wp_web_page_sk, SUM(wr_return_amt) AS returns_, SUM(wr_net_loss) AS profit_loss FROM web_returns, date_dim, web_page WHERE wr_returned_date_sk = d_date_sk AND d_date BETWEEN CAST('2000-08-23' AS DATE) AND CAST('2000-09-22' AS DATE) AND wr_web_page_sk = wp_web_page_sk GROUP BY wp_web_page_sk)\nSELECT channel, id, SUM(sales) AS sales, SUM(returns_) AS returns_, SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, ss.s_store_sk AS id, sales, COALESCE(returns_, 0) AS returns_, (profit - COALESCE(profit_loss, 0)) AS profit FROM ss LEFT JOIN sr ON ss.s_store_sk = sr.s_store_sk UNION ALL SELECT 'catalog channel' AS channel, cs_call_center_sk AS id, sales, returns_, (profit - profit_loss) AS profit FROM cs, cr UNION ALL SELECT 'web channel' AS channel, ws.wp_web_page_sk AS id, sales, COALESCE(returns_, 0) AS returns_, (profit - COALESCE(profit_loss, 0)) AS profit FROM ws LEFT JOIN wr ON ws.wp_web_page_sk = wr.wp_web_page_sk) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel NULLS FIRST, id NULLS FIRST, returns_ DESC LIMIT 100",
      "error": null
    },
    {
      "query_id": "q19",
      "status": "NEUTRAL",
      "speedup": 0.99,
      "original_ms": 56.8,
      "optimized_ms": 57.37,
      "original_times": [
        58.68,
        55.73,
        57.88
      ],
      "optimized_times": [
        57.16,
        55.5,
        59.25
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 19 in stream 0 using template query19.tpl\nselect i_brand_id brand_id, i_brand brand, i_manufact_id, i_manufact,\n \tsum(ss_ext_sales_price) ext_price\n from date_dim, store_sales, item,customer,customer_address,store\n where d_date_sk = ss_sold_date_sk\n   and ss_item_sk = i_item_sk\n   and i_manager_id=2\n   and d_moy=12\n   and d_year=1999\n   and ss_customer_sk = c_customer_sk \n   and c_current_addr_sk = ca_address_sk\n   and substr(ca_zip,1,5) <> substr(s_zip,1,5) \n   and ss_store_sk = s_store_sk \n group by i_brand\n      ,i_brand_id\n      ,i_manufact_id\n      ,i_manufact\n order by ext_price desc\n         ,i_brand\n         ,i_brand_id\n         ,i_manufact_id\n         ,i_manufact\n LIMIT 100;\n\n-- end query 19 in stream 0 using template query19.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_moy = 11 AND d_year = 1998), filtered_items AS (SELECT i_item_sk, i_brand_id, i_brand, i_manufact_id, i_manufact FROM item WHERE i_manager_id = 8), filtered_stores AS (SELECT s_store_sk, s_zip FROM store)\nSELECT i_brand_id AS brand_id, i_brand AS brand, i_manufact_id, i_manufact, SUM(ss_ext_sales_price) AS ext_price FROM store_sales JOIN filtered_dates ON d_date_sk = ss_sold_date_sk JOIN filtered_items ON ss_item_sk = i_item_sk JOIN customer ON ss_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN filtered_stores ON ss_store_sk = s_store_sk AND SUBSTRING(ca_zip, 1, 5) <> SUBSTRING(s_zip, 1, 5) GROUP BY i_brand, i_brand_id, i_manufact_id, i_manufact ORDER BY ext_price DESC, i_brand, i_brand_id, i_manufact_id, i_manufact LIMIT 100",
      "error": null
    },
    {
      "query_id": "q49",
      "status": "NEUTRAL",
      "speedup": 0.9835,
      "original_ms": 86.1,
      "optimized_ms": 87.55,
      "original_times": [
        148.17,
        87.95,
        84.26
      ],
      "optimized_times": [
        83.14,
        85.54,
        89.55
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 49 in stream 0 using template query49.tpl\nselect channel, item, return_ratio, return_rank, currency_rank from\n (select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.wr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.wr_return_amt,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\t web_sales ws left outer join web_returns wr \n \t\t\ton (ws.ws_order_number = wr.wr_order_number and \n \t\t\tws.ws_item_sk = wr.wr_item_sk)\n                 ,date_dim\n \t\twhere \n \t\t\twr.wr_return_amt > 10000 \n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 12\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where \n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select \n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect \n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.cr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.cr_return_amount,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.cr_order_number and \n \t\t\tcs.cs_item_sk = cr.cr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tcr.cr_return_amount > 10000 \n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 12\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where \n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select \n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.sr_return_quantity,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.sr_return_amt,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.sr_ticket_number and sts.ss_item_sk = sr.sr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tsr.sr_return_amt > 10000 \n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0 \n                         and sts.ss_quantity > 0\n                         and ss_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 12\n \t\tgroup by sts.ss_item_sk\n \t) in_store\n ) store\n where  (\n store.return_rank <= 10\n or \n store.currency_rank <= 10\n )\n )\n order by 1,4,5,2\n LIMIT 100;\n\n-- end query 49 in stream 0 using template query49.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001 AND d_moy = 12), web_agg AS (SELECT ws.ws_item_sk AS item, ws.ws_order_number, ws.ws_item_sk, ws.ws_quantity, ws.ws_net_paid, wr.wr_return_quantity, wr.wr_return_amt FROM web_sales AS ws LEFT OUTER JOIN web_returns AS wr ON (ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk AND wr.wr_return_amt > 10000), filtered_dates WHERE ws.ws_net_profit > 1 AND ws.ws_net_paid > 0 AND ws.ws_quantity > 0 AND ws.ws_sold_date_sk = filtered_dates.d_date_sk), catalog_agg AS (SELECT cs.cs_item_sk AS item, cs.cs_order_number, cs.cs_item_sk, cs.cs_quantity, cs.cs_net_paid, cr.cr_return_quantity, cr.cr_return_amount FROM catalog_sales AS cs LEFT OUTER JOIN catalog_returns AS cr ON (cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk AND cr.cr_return_amount > 10000), filtered_dates WHERE cs.cs_net_profit > 1 AND cs.cs_net_paid > 0 AND cs.cs_quantity > 0 AND cs.cs_sold_date_sk = filtered_dates.d_date_sk), store_agg AS (SELECT sts.ss_item_sk AS item, sts.ss_ticket_number, sts.ss_item_sk, sts.ss_quantity, sts.ss_net_paid, sr.sr_return_quantity, sr.sr_return_amt FROM store_sales AS sts LEFT OUTER JOIN store_returns AS sr ON (sts.ss_ticket_number = sr.sr_ticket_number AND sts.ss_item_sk = sr.sr_item_sk AND sr.sr_return_amt > 10000), filtered_dates WHERE sts.ss_net_profit > 1 AND sts.ss_net_paid > 0 AND sts.ss_quantity > 0 AND sts.ss_sold_date_sk = filtered_dates.d_date_sk)\nSELECT channel, item, return_ratio, return_rank, currency_rank FROM (SELECT 'web' AS channel, web.item, web.return_ratio, web.return_rank, web.currency_rank FROM (SELECT item, return_ratio, currency_ratio, RANK() OVER (ORDER BY return_ratio) AS return_rank, RANK() OVER (ORDER BY currency_ratio) AS currency_rank FROM (SELECT item, (CAST(SUM(COALESCE(wr_return_quantity, 0)) AS DECIMAL(15, 4)) / CAST(SUM(COALESCE(ws_quantity, 0)) AS DECIMAL(15, 4))) AS return_ratio, (CAST(SUM(COALESCE(wr_return_amt, 0)) AS DECIMAL(15, 4)) / CAST(SUM(COALESCE(ws_net_paid, 0)) AS DECIMAL(15, 4))) AS currency_ratio FROM web_agg GROUP BY item) AS in_web) AS web WHERE (web.return_rank <= 10 OR web.currency_rank <= 10) UNION SELECT 'catalog' AS channel, catalog.item, catalog.return_ratio, catalog.return_rank, catalog.currency_rank FROM (SELECT item, return_ratio, currency_ratio, RANK() OVER (ORDER BY return_ratio) AS return_rank, RANK() OVER (ORDER BY currency_ratio) AS currency_rank FROM (SELECT item, (CAST(SUM(COALESCE(cr_return_quantity, 0)) AS DECIMAL(15, 4)) / CAST(SUM(COALESCE(cs_quantity, 0)) AS DECIMAL(15, 4))) AS return_ratio, (CAST(SUM(COALESCE(cr_return_amount, 0)) AS DECIMAL(15, 4)) / CAST(SUM(COALESCE(cs_net_paid, 0)) AS DECIMAL(15, 4))) AS currency_ratio FROM catalog_agg GROUP BY item) AS in_cat) AS catalog WHERE (catalog.return_rank <= 10 OR catalog.currency_rank <= 10) UNION SELECT 'store' AS channel, store.item, store.return_ratio, store.return_rank, store.currency_rank FROM (SELECT item, return_ratio, currency_ratio, RANK() OVER (ORDER BY return_ratio) AS return_rank, RANK() OVER (ORDER BY currency_ratio) AS currency_rank FROM (SELECT item, (CAST(SUM(COALESCE(sr_return_quantity, 0)) AS DECIMAL(15, 4)) / CAST(SUM(COALESCE(ss_quantity, 0)) AS DECIMAL(15, 4))) AS return_ratio, (CAST(SUM(COALESCE(sr_return_amt, 0)) AS DECIMAL(15, 4)) / CAST(SUM(COALESCE(ss_net_paid, 0)) AS DECIMAL(15, 4))) AS currency_ratio FROM store_agg GROUP BY item) AS in_store) AS store WHERE (store.return_rank <= 10 OR store.currency_rank <= 10)) AS sq1 ORDER BY 1 NULLS FIRST, 4 NULLS FIRST, 5 NULLS FIRST, 2 NULLS FIRST LIMIT 100",
      "error": null
    },
    {
      "query_id": "q86",
      "status": "NEUTRAL",
      "speedup": 0.9826,
      "original_ms": 45.02,
      "optimized_ms": 45.81,
      "original_times": [
        44.99,
        44.44,
        45.59
      ],
      "optimized_times": [
        44.93,
        43.84,
        47.79
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 86 in stream 0 using template query86.tpl\nselect  \n    sum(ws_net_paid) as total_sum\n   ,i_category\n   ,i_class\n   ,grouping(i_category)+grouping(i_class) as lochierarchy\n   ,rank() over (\n \tpartition by grouping(i_category)+grouping(i_class),\n \tcase when grouping(i_class) = 0 then i_category end \n \torder by sum(ws_net_paid) desc) as rank_within_parent\n from\n    web_sales\n   ,date_dim       d1\n   ,item\n where\n    d1.d_month_seq between 1224 and 1224+11\n and d1.d_date_sk = ws_sold_date_sk\n and i_item_sk  = ws_item_sk\n group by rollup(i_category,i_class)\n order by\n   lochierarchy desc,\n   case when lochierarchy = 0 then i_category end,\n   rank_within_parent\n LIMIT 100;\n\n-- end query 86 in stream 0 using template query86.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1224 AND 1224 + 11), filtered_sales AS (SELECT ws_net_paid, ws_item_sk FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk)\nSELECT SUM(ws_net_paid) AS total_sum, i_category, i_class, GROUPING(i_category) + GROUPING(i_class) AS lochierarchy, RANK() OVER (PARTITION BY GROUPING(i_category) + GROUPING(i_class), CASE WHEN GROUPING(i_class) = 0 THEN i_category END ORDER BY SUM(ws_net_paid) DESC) AS rank_within_parent FROM filtered_sales JOIN item ON ws_item_sk = i_item_sk GROUP BY ROLLUP (i_category, i_class) ORDER BY lochierarchy DESC, CASE WHEN lochierarchy = 0 THEN i_category END, rank_within_parent LIMIT 100",
      "error": null
    },
    {
      "query_id": "q79",
      "status": "NEUTRAL",
      "speedup": 0.9766,
      "original_ms": 133.65,
      "optimized_ms": 136.85,
      "original_times": [
        135.99,
        135.71,
        131.59
      ],
      "optimized_times": [
        115.54,
        131.48,
        142.22
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "or_to_union"
      ],
      "original_sql": "-- start query 79 in stream 0 using template query79.tpl\nselect\n  c_last_name,c_first_name,substr(s_city,1,30),ss_ticket_number,amt,profit\n  from\n   (select ss_ticket_number\n          ,ss_customer_sk\n          ,store.s_city\n          ,sum(ss_coupon_amt) amt\n          ,sum(ss_net_profit) profit\n    from store_sales,date_dim,store,household_demographics\n    where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n    and store_sales.ss_store_sk = store.s_store_sk  \n    and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n    and (household_demographics.hd_dep_count = 5 or household_demographics.hd_vehicle_count > 4)\n    and date_dim.d_dow = 1\n    and date_dim.d_year in (1998,1998+1,1998+2) \n    and store.s_number_employees between 200 and 295\n    group by ss_ticket_number,ss_customer_sk,ss_addr_sk,store.s_city) ms,customer\n    where ss_customer_sk = c_customer_sk\n order by c_last_name,c_first_name,substr(s_city,1,30), profit\n LIMIT 100;\n\n-- end query 79 in stream 0 using template query79.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_dow = 1 AND d_year IN (1999, 2000, 2001)), filtered_store AS (SELECT s_store_sk, s_city FROM store WHERE s_number_employees BETWEEN 200 AND 295), filtered_hd AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_dep_count = 6 OR hd_vehicle_count > 2), store_sales_summary AS (SELECT ss_ticket_number, ss_customer_sk, ss_addr_sk, fs.s_city, SUM(ss_coupon_amt) AS amt, SUM(ss_net_profit) AS profit FROM store_sales AS ss JOIN filtered_dates AS fd ON ss.ss_sold_date_sk = fd.d_date_sk JOIN filtered_store AS fs ON ss.ss_store_sk = fs.s_store_sk JOIN filtered_hd AS fhd ON ss.ss_hdemo_sk = fhd.hd_demo_sk GROUP BY ss_ticket_number, ss_customer_sk, ss_addr_sk, fs.s_city)\nSELECT c_last_name, c_first_name, SUBSTRING(s_city, 1, 30), ss_ticket_number, amt, profit FROM store_sales_summary AS ms JOIN customer ON ms.ss_customer_sk = c_customer_sk ORDER BY c_last_name NULLS FIRST, c_first_name NULLS FIRST, SUBSTRING(s_city, 1, 30) NULLS FIRST, profit NULLS FIRST, ss_ticket_number LIMIT 100",
      "error": null
    },
    {
      "query_id": "q96",
      "status": "NEUTRAL",
      "speedup": 0.9756,
      "original_ms": 28.19,
      "optimized_ms": 28.9,
      "original_times": [
        30.72,
        29.07,
        27.32
      ],
      "optimized_times": [
        28.45,
        26.23,
        31.57
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "early_filter"
      ],
      "original_sql": "-- start query 96 in stream 0 using template query96.tpl\nselect count(*) \nfrom store_sales\n    ,household_demographics \n    ,time_dim, store\nwhere ss_sold_time_sk = time_dim.t_time_sk   \n    and ss_hdemo_sk = household_demographics.hd_demo_sk \n    and ss_store_sk = s_store_sk\n    and time_dim.t_hour = 8\n    and time_dim.t_minute >= 30\n    and household_demographics.hd_dep_count = 3\n    and store.s_store_name = 'ese'\norder by count(*)\n LIMIT 100;\n\n-- end query 96 in stream 0 using template query96.tpl\n",
      "optimized_sql": "WITH filtered_time AS (SELECT t_time_sk FROM time_dim WHERE t_hour = 8 AND t_minute >= 30), filtered_household AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_dep_count = 3), filtered_store AS (SELECT s_store_sk FROM store WHERE s_store_name = 'ese')\nSELECT COUNT(*) FROM store_sales JOIN filtered_time ON ss_sold_time_sk = filtered_time.t_time_sk JOIN filtered_household ON ss_hdemo_sk = filtered_household.hd_demo_sk JOIN filtered_store ON ss_store_sk = filtered_store.s_store_sk ORDER BY COUNT(*) LIMIT 100",
      "error": null
    },
    {
      "query_id": "q98",
      "status": "NEUTRAL",
      "speedup": 0.9698,
      "original_ms": 97.26,
      "optimized_ms": 100.29,
      "original_times": [
        107.56,
        99.44,
        95.08
      ],
      "optimized_times": [
        99.41,
        91.16,
        109.43
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 98 in stream 0 using template query98.tpl\nselect i_item_id\n      ,i_item_desc \n      ,i_category \n      ,i_class \n      ,i_current_price\n      ,sum(ss_ext_sales_price) as itemrevenue \n      ,sum(ss_ext_sales_price)*100/sum(sum(ss_ext_sales_price)) over\n          (partition by i_class) as revenueratio\nfrom\t\n\tstore_sales\n    \t,item \n    \t,date_dim\nwhere \n\tss_item_sk = i_item_sk \n  \tand i_category in ('Sports', 'Music', 'Shoes')\n  \tand ss_sold_date_sk = d_date_sk\n\tand d_date between cast('2002-05-20' as date) \n\t\t\t\tand (cast('2002-05-20' as date) + INTERVAL 30 DAY)\ngroup by \n\ti_item_id\n        ,i_item_desc \n        ,i_category\n        ,i_class\n        ,i_current_price\norder by \n\ti_category\n        ,i_class\n        ,i_item_id\n        ,i_item_desc\n        ,revenueratio;\n\n-- end query 98 in stream 0 using template query98.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-02-22' AS DATE) AND CAST('1999-03-24' AS DATE))\nSELECT i_item_id, i_item_desc, i_category, i_class, i_current_price, SUM(ss_ext_sales_price) AS itemrevenue, SUM(ss_ext_sales_price) * 100.0000 / SUM(SUM(ss_ext_sales_price)) OVER (PARTITION BY i_class) AS revenueratio FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN item ON ss_item_sk = i_item_sk WHERE i_category IN ('Sports', 'Books', 'Home') GROUP BY i_item_id, i_item_desc, i_category, i_class, i_current_price ORDER BY i_category NULLS FIRST, i_class NULLS FIRST, i_item_id NULLS FIRST, i_item_desc NULLS FIRST, revenueratio NULLS FIRST",
      "error": null
    },
    {
      "query_id": "q75",
      "status": "NEUTRAL",
      "speedup": 0.9686,
      "original_ms": 325.44,
      "optimized_ms": 335.98,
      "original_times": [
        335.95,
        327.27,
        323.62
      ],
      "optimized_times": [
        308.97,
        359.21,
        312.75
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "pushdown"
      ],
      "original_sql": "-- start query 75 in stream 0 using template query75.tpl\nWITH all_sales AS (\n SELECT d_year\n       ,i_brand_id\n       ,i_class_id\n       ,i_category_id\n       ,i_manufact_id\n       ,SUM(sales_cnt) AS sales_cnt\n       ,SUM(sales_amt) AS sales_amt\n FROM (SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,cs_quantity - COALESCE(cr_return_quantity,0) AS sales_cnt\n             ,cs_ext_sales_price - COALESCE(cr_return_amount,0.0) AS sales_amt\n       FROM catalog_sales JOIN item ON i_item_sk=cs_item_sk\n                          JOIN date_dim ON d_date_sk=cs_sold_date_sk\n                          LEFT JOIN catalog_returns ON (cs_order_number=cr_order_number \n                                                    AND cs_item_sk=cr_item_sk)\n       WHERE i_category='Home'\n       UNION\n       SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,ss_quantity - COALESCE(sr_return_quantity,0) AS sales_cnt\n             ,ss_ext_sales_price - COALESCE(sr_return_amt,0.0) AS sales_amt\n       FROM store_sales JOIN item ON i_item_sk=ss_item_sk\n                        JOIN date_dim ON d_date_sk=ss_sold_date_sk\n                        LEFT JOIN store_returns ON (ss_ticket_number=sr_ticket_number \n                                                AND ss_item_sk=sr_item_sk)\n       WHERE i_category='Home'\n       UNION\n       SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,ws_quantity - COALESCE(wr_return_quantity,0) AS sales_cnt\n             ,ws_ext_sales_price - COALESCE(wr_return_amt,0.0) AS sales_amt\n       FROM web_sales JOIN item ON i_item_sk=ws_item_sk\n                      JOIN date_dim ON d_date_sk=ws_sold_date_sk\n                      LEFT JOIN web_returns ON (ws_order_number=wr_order_number \n                                            AND ws_item_sk=wr_item_sk)\n       WHERE i_category='Home') sales_detail\n GROUP BY d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id)\n select prev_yr.d_year AS prev_year\n                          ,curr_yr.d_year AS year\n                          ,curr_yr.i_brand_id\n                          ,curr_yr.i_class_id\n                          ,curr_yr.i_category_id\n                          ,curr_yr.i_manufact_id\n                          ,prev_yr.sales_cnt AS prev_yr_cnt\n                          ,curr_yr.sales_cnt AS curr_yr_cnt\n                          ,curr_yr.sales_cnt-prev_yr.sales_cnt AS sales_cnt_diff\n                          ,curr_yr.sales_amt-prev_yr.sales_amt AS sales_amt_diff\n FROM all_sales curr_yr, all_sales prev_yr\n WHERE curr_yr.i_brand_id=prev_yr.i_brand_id\n   AND curr_yr.i_class_id=prev_yr.i_class_id\n   AND curr_yr.i_category_id=prev_yr.i_category_id\n   AND curr_yr.i_manufact_id=prev_yr.i_manufact_id\n   AND curr_yr.d_year=1999\n   AND prev_yr.d_year=1999-1\n   AND CAST(curr_yr.sales_cnt AS DECIMAL(17,2))/CAST(prev_yr.sales_cnt AS DECIMAL(17,2))<0.9\n ORDER BY sales_cnt_diff,sales_amt_diff\n LIMIT 100;\n\n-- end query 75 in stream 0 using template query75.tpl\n",
      "optimized_sql": "WITH all_sales AS (SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, SUM(sales_cnt) AS sales_cnt, SUM(sales_amt) AS sales_amt FROM (SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, cs_quantity - COALESCE(cr_return_quantity, 0) AS sales_cnt, cs_ext_sales_price - COALESCE(cr_return_amount, 0.0) AS sales_amt FROM catalog_sales JOIN item ON i_item_sk = cs_item_sk JOIN date_dim ON d_date_sk = cs_sold_date_sk LEFT JOIN catalog_returns ON (cs_order_number = cr_order_number AND cs_item_sk = cr_item_sk) WHERE i_category = 'Home' AND d_year IN (1998, 1999) UNION SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, ss_quantity - COALESCE(sr_return_quantity, 0) AS sales_cnt, ss_ext_sales_price - COALESCE(sr_return_amt, 0.0) AS sales_amt FROM store_sales JOIN item ON i_item_sk = ss_item_sk JOIN date_dim ON d_date_sk = ss_sold_date_sk LEFT JOIN store_returns ON (ss_ticket_number = sr_ticket_number AND ss_item_sk = sr_item_sk) WHERE i_category = 'Home' AND d_year IN (1998, 1999) UNION SELECT d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id, ws_quantity - COALESCE(wr_return_quantity, 0) AS sales_cnt, ws_ext_sales_price - COALESCE(wr_return_amt, 0.0) AS sales_amt FROM web_sales JOIN item ON i_item_sk = ws_item_sk JOIN date_dim ON d_date_sk = ws_sold_date_sk LEFT JOIN web_returns ON (ws_order_number = wr_order_number AND ws_item_sk = wr_item_sk) WHERE i_category = 'Home' AND d_year IN (1998, 1999)) AS sales_detail GROUP BY d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id) SELECT prev_yr.d_year AS prev_year, curr_yr.d_year AS year, curr_yr.i_brand_id, curr_yr.i_class_id, curr_yr.i_category_id, curr_yr.i_manufact_id, prev_yr.sales_cnt AS prev_yr_cnt, curr_yr.sales_cnt AS curr_yr_cnt, curr_yr.sales_cnt - prev_yr.sales_cnt AS sales_cnt_diff, curr_yr.sales_amt - prev_yr.sales_amt AS sales_amt_diff FROM all_sales AS curr_yr, all_sales AS prev_yr WHERE curr_yr.i_brand_id = prev_yr.i_brand_id AND curr_yr.i_class_id = prev_yr.i_class_id AND curr_yr.i_category_id = prev_yr.i_category_id AND curr_yr.i_manufact_id = prev_yr.i_manufact_id AND curr_yr.d_year = 1999 AND prev_yr.d_year = 1999 - 1 AND CAST(curr_yr.sales_cnt AS DECIMAL(17, 2)) / CAST(prev_yr.sales_cnt AS DECIMAL(17, 2)) < 0.9 ORDER BY sales_cnt_diff, sales_amt_diff LIMIT 100",
      "error": null
    },
    {
      "query_id": "q87",
      "status": "NEUTRAL",
      "speedup": 0.9653,
      "original_ms": 253.82,
      "optimized_ms": 262.95,
      "original_times": [
        259.29,
        264.55,
        243.09
      ],
      "optimized_times": [
        276.32,
        269.89,
        256.02
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 87 in stream 0 using template query87.tpl\nselect count(*) \nfrom ((select distinct c_last_name, c_first_name, d_date\n       from store_sales, date_dim, customer\n       where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n         and store_sales.ss_customer_sk = customer.c_customer_sk\n         and d_month_seq between 1184 and 1184+11)\n       except\n      (select distinct c_last_name, c_first_name, d_date\n       from catalog_sales, date_dim, customer\n       where catalog_sales.cs_sold_date_sk = date_dim.d_date_sk\n         and catalog_sales.cs_bill_customer_sk = customer.c_customer_sk\n         and d_month_seq between 1184 and 1184+11)\n       except\n      (select distinct c_last_name, c_first_name, d_date\n       from web_sales, date_dim, customer\n       where web_sales.ws_sold_date_sk = date_dim.d_date_sk\n         and web_sales.ws_bill_customer_sk = customer.c_customer_sk\n         and d_month_seq between 1184 and 1184+11)\n) cool_cust\n;\n\n-- end query 87 in stream 0 using template query87.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_month_seq BETWEEN 1184 AND 1184 + 11), store_branch AS (SELECT DISTINCT c_last_name, c_first_name, d_date FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN customer ON ss_customer_sk = c_customer_sk), catalog_branch AS (SELECT DISTINCT c_last_name, c_first_name, d_date FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk JOIN customer ON cs_bill_customer_sk = c_customer_sk), web_branch AS (SELECT DISTINCT c_last_name, c_first_name, d_date FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk JOIN customer ON ws_bill_customer_sk = c_customer_sk)\nSELECT COUNT(*) FROM ((SELECT * FROM store_branch) EXCEPT (SELECT * FROM catalog_branch) EXCEPT (SELECT * FROM web_branch)) AS cool_cust",
      "error": null
    },
    {
      "query_id": "q5",
      "status": "NEUTRAL",
      "speedup": 0.9574,
      "original_ms": 109.69,
      "optimized_ms": 114.57,
      "original_times": [
        528.33,
        106.88,
        112.5
      ],
      "optimized_times": [
        121.47,
        114.98,
        114.17
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [],
      "original_sql": "-- start query 5 in stream 0 using template query5.tpl\nwith ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as \"returns\",\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('2000-08-19' as date) \n                  and (cast('2000-08-19' as date) + INTERVAL 14 DAY)\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as \"returns\",\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('2000-08-19' as date)\n                  and (cast('2000-08-19' as date) + INTERVAL 14 DAY)\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as \"returns\",\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('2000-08-19' as date)\n                  and (cast('2000-08-19' as date) + INTERVAL 14 DAY)\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n  select channel\n        , id\n        , sum(sales) as sales\n        , sum(\"returns\") as \"returns\"\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , \"returns\"\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , \"returns\"\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , \"returns\"\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by rollup (channel, id)\n order by channel\n         ,id\n LIMIT 100;\n\n-- end query 5 in stream 0 using template query5.tpl\n",
      "optimized_sql": "WITH ssr AS (SELECT s_store_id, SUM(sales_price) AS sales, SUM(profit) AS profit, SUM(return_amt) AS \"returns\", SUM(net_loss) AS profit_loss FROM (SELECT ss_store_sk AS store_sk, ss_sold_date_sk AS date_sk, ss_ext_sales_price AS sales_price, ss_net_profit AS profit, CAST(0 AS DECIMAL(7, 2)) AS return_amt, CAST(0 AS DECIMAL(7, 2)) AS net_loss FROM store_sales UNION ALL SELECT sr_store_sk AS store_sk, sr_returned_date_sk AS date_sk, CAST(0 AS DECIMAL(7, 2)) AS sales_price, CAST(0 AS DECIMAL(7, 2)) AS profit, sr_return_amt AS return_amt, sr_net_loss AS net_loss FROM store_returns) AS salesreturns, date_dim, store WHERE date_sk = d_date_sk AND d_date BETWEEN CAST('2000-08-19' AS DATE) AND (CAST('2000-08-19' AS DATE) + INTERVAL '14' DAY) AND store_sk = s_store_sk GROUP BY s_store_id), csr AS (SELECT cp_catalog_page_id, SUM(sales_price) AS sales, SUM(profit) AS profit, SUM(return_amt) AS \"returns\", SUM(net_loss) AS profit_loss FROM (SELECT cs_catalog_page_sk AS page_sk, cs_sold_date_sk AS date_sk, cs_ext_sales_price AS sales_price, cs_net_profit AS profit, CAST(0 AS DECIMAL(7, 2)) AS return_amt, CAST(0 AS DECIMAL(7, 2)) AS net_loss FROM catalog_sales UNION ALL SELECT cr_catalog_page_sk AS page_sk, cr_returned_date_sk AS date_sk, CAST(0 AS DECIMAL(7, 2)) AS sales_price, CAST(0 AS DECIMAL(7, 2)) AS profit, cr_return_amount AS return_amt, cr_net_loss AS net_loss FROM catalog_returns) AS salesreturns, date_dim, catalog_page WHERE date_sk = d_date_sk AND d_date BETWEEN CAST('2000-08-19' AS DATE) AND (CAST('2000-08-19' AS DATE) + INTERVAL '14' DAY) AND page_sk = cp_catalog_page_sk GROUP BY cp_catalog_page_id), wsr AS (SELECT web_site_id, SUM(sales_price) AS sales, SUM(profit) AS profit, SUM(return_amt) AS \"returns\", SUM(net_loss) AS profit_loss FROM (SELECT ws_web_site_sk AS wsr_web_site_sk, ws_sold_date_sk AS date_sk, ws_ext_sales_price AS sales_price, ws_net_profit AS profit, CAST(0 AS DECIMAL(7, 2)) AS return_amt, CAST(0 AS DECIMAL(7, 2)) AS net_loss FROM web_sales UNION ALL SELECT ws_web_site_sk AS wsr_web_site_sk, wr_returned_date_sk AS date_sk, CAST(0 AS DECIMAL(7, 2)) AS sales_price, CAST(0 AS DECIMAL(7, 2)) AS profit, wr_return_amt AS return_amt, wr_net_loss AS net_loss FROM web_returns LEFT OUTER JOIN web_sales ON (wr_item_sk = ws_item_sk AND wr_order_number = ws_order_number)) AS salesreturns, date_dim, web_site WHERE date_sk = d_date_sk AND d_date BETWEEN CAST('2000-08-19' AS DATE) AND (CAST('2000-08-19' AS DATE) + INTERVAL '14' DAY) AND wsr_web_site_sk = web_site_sk GROUP BY web_site_id) SELECT channel, id, SUM(sales) AS sales, SUM(\"returns\") AS \"returns\", SUM(profit) AS profit FROM (SELECT 'store channel' AS channel, 'store' || s_store_id AS id, sales, \"returns\", (profit - profit_loss) AS profit FROM ssr UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || cp_catalog_page_id AS id, sales, \"returns\", (profit - profit_loss) AS profit FROM csr UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site_id AS id, sales, \"returns\", (profit - profit_loss) AS profit FROM wsr) AS x GROUP BY ROLLUP (channel, id) ORDER BY channel, id LIMIT 100",
      "error": null
    },
    {
      "query_id": "q10",
      "status": "REGRESSION",
      "speedup": 0.9497,
      "original_ms": 59.22,
      "optimized_ms": 62.36,
      "original_times": [
        70.96,
        58.95,
        59.49
      ],
      "optimized_times": [
        67.4,
        65.5,
        59.21
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 10 in stream 0 using template query10.tpl\nselect \n  cd_gender,\n  cd_marital_status,\n  cd_education_status,\n  count(*) cnt1,\n  cd_purchase_estimate,\n  count(*) cnt2,\n  cd_credit_rating,\n  count(*) cnt3,\n  cd_dep_count,\n  count(*) cnt4,\n  cd_dep_employed_count,\n  count(*) cnt5,\n  cd_dep_college_count,\n  count(*) cnt6\n from\n  customer c,customer_address ca,customer_demographics\n where\n  c.c_current_addr_sk = ca.ca_address_sk and\n  ca_county in ('Storey County','Marquette County','Warren County','Cochran County','Kandiyohi County') and\n  cd_demo_sk = c.c_current_cdemo_sk and \n  exists (select *\n          from store_sales,date_dim\n          where c.c_customer_sk = ss_customer_sk and\n                ss_sold_date_sk = d_date_sk and\n                d_year = 2001 and\n                d_moy between 1 and 1+3) and\n   (exists (select *\n            from web_sales,date_dim\n            where c.c_customer_sk = ws_bill_customer_sk and\n                  ws_sold_date_sk = d_date_sk and\n                  d_year = 2001 and\n                  d_moy between 1 ANd 1+3) or \n    exists (select * \n            from catalog_sales,date_dim\n            where c.c_customer_sk = cs_ship_customer_sk and\n                  cs_sold_date_sk = d_date_sk and\n                  d_year = 2001 and\n                  d_moy between 1 and 1+3))\n group by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\n order by cd_gender,\n          cd_marital_status,\n          cd_education_status,\n          cd_purchase_estimate,\n          cd_credit_rating,\n          cd_dep_count,\n          cd_dep_employed_count,\n          cd_dep_college_count\n LIMIT 100;\n\n-- end query 10 in stream 0 using template query10.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2002 AND d_moy BETWEEN 1 AND 4), store_sales_customers AS (SELECT DISTINCT ss_customer_sk FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk), web_sales_customers AS (SELECT DISTINCT ws_bill_customer_sk FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk), catalog_sales_customers AS (SELECT DISTINCT cs_ship_customer_sk FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk), qualified_customers AS (SELECT ss_customer_sk FROM store_sales_customers INTERSECT (SELECT ws_bill_customer_sk FROM web_sales_customers UNION SELECT cs_ship_customer_sk FROM catalog_sales_customers))\nSELECT cd_gender, cd_marital_status, cd_education_status, COUNT(*) AS cnt1, cd_purchase_estimate, COUNT(*) AS cnt2, cd_credit_rating, COUNT(*) AS cnt3, cd_dep_count, COUNT(*) AS cnt4, cd_dep_employed_count, COUNT(*) AS cnt5, cd_dep_college_count, COUNT(*) AS cnt6 FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics AS cd ON cd_demo_sk = c.c_current_cdemo_sk WHERE ca_county IN ('Rush County', 'Toole County', 'Jefferson County', 'Dona Ana County', 'La Porte County') AND c.c_customer_sk IN (SELECT ss_customer_sk FROM qualified_customers) GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count ORDER BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, cd_dep_count, cd_dep_employed_count, cd_dep_college_count LIMIT 100",
      "error": null
    },
    {
      "query_id": "q85",
      "status": "REGRESSION",
      "speedup": 0.9478,
      "original_ms": 81.82,
      "optimized_ms": 86.33,
      "original_times": [
        99.35,
        79.56,
        84.08
      ],
      "optimized_times": [
        79.43,
        75.33,
        97.32
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "or_to_union"
      ],
      "original_sql": "-- start query 85 in stream 0 using template query85.tpl\nselect substr(r_reason_desc,1,20)\n       ,avg(ws_quantity)\n       ,avg(wr_refunded_cash)\n       ,avg(wr_fee)\n from web_sales, web_returns, web_page, customer_demographics cd1,\n      customer_demographics cd2, customer_address, date_dim, reason \n where ws_web_page_sk = wp_web_page_sk\n   and ws_item_sk = wr_item_sk\n   and ws_order_number = wr_order_number\n   and ws_sold_date_sk = d_date_sk and d_year = 2000\n   and cd1.cd_demo_sk = wr_refunded_cdemo_sk \n   and cd2.cd_demo_sk = wr_returning_cdemo_sk\n   and ca_address_sk = wr_refunded_addr_sk\n   and r_reason_sk = wr_reason_sk\n   and\n   (\n    (\n     cd1.cd_marital_status = 'M'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = '4 yr Degree'\n     and \n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 100.00 and 150.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'S'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Secondary' \n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 50.00 and 100.00\n    )\n   or\n    (\n     cd1.cd_marital_status = 'W'\n     and\n     cd1.cd_marital_status = cd2.cd_marital_status\n     and\n     cd1.cd_education_status = 'Advanced Degree'\n     and\n     cd1.cd_education_status = cd2.cd_education_status\n     and\n     ws_sales_price between 150.00 and 200.00\n    )\n   )\n   and\n   (\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('FL', 'TX', 'DE')\n     and ws_net_profit between 100 and 200  \n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('IN', 'ND', 'ID')\n     and ws_net_profit between 150 and 300  \n    )\n    or\n    (\n     ca_country = 'United States'\n     and\n     ca_state in ('MT', 'IL', 'OH')\n     and ws_net_profit between 50 and 250  \n    )\n   )\ngroup by r_reason_desc\norder by substr(r_reason_desc,1,20)\n        ,avg(ws_quantity)\n        ,avg(wr_refunded_cash)\n        ,avg(wr_fee)\n LIMIT 100;\n\n-- end query 85 in stream 0 using template query85.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2000), filtered_addresses AS (SELECT ca_address_sk, ca_country, ca_state FROM customer_address WHERE ca_country = 'United States' AND ca_state IN ('IN', 'OH', 'NJ', 'WI', 'CT', 'KY', 'LA', 'IA', 'AR'))\nSELECT SUBSTRING(r_reason_desc, 1, 20), AVG(ws_quantity) AS avg1, AVG(wr_refunded_cash) AS avg2, AVG(wr_fee) FROM web_sales JOIN web_returns ON ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number JOIN web_page ON ws_web_page_sk = wp_web_page_sk JOIN customer_demographics AS cd1 ON cd1.cd_demo_sk = wr_refunded_cdemo_sk JOIN customer_demographics AS cd2 ON cd2.cd_demo_sk = wr_returning_cdemo_sk JOIN filtered_addresses ON ca_address_sk = wr_refunded_addr_sk JOIN filtered_dates ON ws_sold_date_sk = d_date_sk JOIN reason ON r_reason_sk = wr_reason_sk WHERE ((cd1.cd_marital_status = 'M' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'Advanced Degree' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 100.00 AND 150.00) OR (cd1.cd_marital_status = 'S' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = 'College' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 50.00 AND 100.00) OR (cd1.cd_marital_status = 'W' AND cd1.cd_marital_status = cd2.cd_marital_status AND cd1.cd_education_status = '2 yr Degree' AND cd1.cd_education_status = cd2.cd_education_status AND ws_sales_price BETWEEN 150.00 AND 200.00)) AND ((ca_country = 'United States' AND ca_state IN ('IN', 'OH', 'NJ') AND ws_net_profit BETWEEN 100 AND 200) OR (ca_country = 'United States' AND ca_state IN ('WI', 'CT', 'KY') AND ws_net_profit BETWEEN 150 AND 300) OR (ca_country = 'United States' AND ca_state IN ('LA', 'IA', 'AR') AND ws_net_profit BETWEEN 50 AND 250)) GROUP BY r_reason_desc ORDER BY SUBSTRING(r_reason_desc, 1, 20), AVG(ws_quantity), AVG(wr_refunded_cash), AVG(wr_fee) LIMIT 100",
      "error": null
    },
    {
      "query_id": "q89",
      "status": "REGRESSION",
      "speedup": 0.9439,
      "original_ms": 81.91,
      "optimized_ms": 86.77,
      "original_times": [
        91.11,
        79.73,
        84.09
      ],
      "optimized_times": [
        82.86,
        85.39,
        88.15
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "or_to_union"
      ],
      "original_sql": "-- start query 89 in stream 0 using template query89.tpl\nselect *\nfrom(\nselect i_category, i_class, i_brand,\n       s_store_name, s_company_name,\n       d_moy,\n       sum(ss_sales_price) sum_sales,\n       avg(sum(ss_sales_price)) over\n         (partition by i_category, i_brand, s_store_name, s_company_name)\n         avg_monthly_sales\nfrom item, store_sales, date_dim, store\nwhere ss_item_sk = i_item_sk and\n      ss_sold_date_sk = d_date_sk and\n      ss_store_sk = s_store_sk and\n      d_year in (1999) and\n        ((i_category in ('Jewelry','Shoes','Electronics') and\n          i_class in ('semi-precious','athletic','portable')\n         )\n      or (i_category in ('Men','Music','Women') and\n          i_class in ('accessories','rock','maternity') \n        ))\ngroup by i_category, i_class, i_brand,\n         s_store_name, s_company_name, d_moy) tmp1\nwhere case when (avg_monthly_sales <> 0) then (abs(sum_sales - avg_monthly_sales) / avg_monthly_sales) else null end > 0.1\norder by sum_sales - avg_monthly_sales, s_store_name\n LIMIT 100;\n\n-- end query 89 in stream 0 using template query89.tpl\n",
      "optimized_sql": "WITH sales_branch_1 AS (SELECT i.i_category, i.i_class, i.i_brand, s.s_store_name, s.s_company_name, d.d_moy, SUM(ss.ss_sales_price) AS sum_sales FROM item AS i JOIN store_sales AS ss ON ss.ss_item_sk = i.i_item_sk JOIN date_dim AS d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store AS s ON ss.ss_store_sk = s.s_store_sk WHERE d.d_year = 1999 AND i.i_category IN ('Jewelry', 'Shoes', 'Electronics') AND i.i_class IN ('semi-precious', 'athletic', 'portable') GROUP BY i.i_category, i.i_class, i.i_brand, s.s_store_name, s.s_company_name, d.d_moy), sales_branch_2 AS (SELECT i.i_category, i.i_class, i.i_brand, s.s_store_name, s.s_company_name, d.d_moy, SUM(ss.ss_sales_price) AS sum_sales FROM item AS i JOIN store_sales AS ss ON ss.ss_item_sk = i.i_item_sk JOIN date_dim AS d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store AS s ON ss.ss_store_sk = s.s_store_sk WHERE d.d_year = 1999 AND i.i_category IN ('Men', 'Music', 'Women') AND i.i_class IN ('accessories', 'rock', 'maternity') GROUP BY i.i_category, i.i_class, i.i_brand, s.s_store_name, s.s_company_name, d.d_moy), tmp1 AS (SELECT i_category, i_class, i_brand, s_store_name, s_company_name, d_moy, sum_sales, AVG(sum_sales) OVER (PARTITION BY i_category, i_brand, s_store_name, s_company_name) AS avg_monthly_sales FROM (SELECT * FROM sales_branch_1 UNION ALL SELECT * FROM sales_branch_2) AS unioned_sales)\nSELECT * FROM tmp1 WHERE CASE WHEN (avg_monthly_sales <> 0) THEN (ABS(sum_sales - avg_monthly_sales) / avg_monthly_sales) ELSE NULL END > 0.1 ORDER BY sum_sales - avg_monthly_sales, s_store_name LIMIT 100",
      "error": null
    },
    {
      "query_id": "q28",
      "status": "REGRESSION",
      "speedup": 0.9177,
      "original_ms": 327.47,
      "optimized_ms": 356.85,
      "original_times": [
        393.46,
        333.0,
        321.93
      ],
      "optimized_times": [
        374.27,
        374.88,
        338.82
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "semantic_rewrite"
      ],
      "original_sql": "-- start query 28 in stream 0 using template query28.tpl\nselect *\nfrom (select avg(ss_list_price) B1_LP\n            ,count(ss_list_price) B1_CNT\n            ,count(distinct ss_list_price) B1_CNTD\n      from store_sales\n      where ss_quantity between 0 and 5\n        and (ss_list_price between 131 and 131+10 \n             or ss_coupon_amt between 16798 and 16798+1000\n             or ss_wholesale_cost between 25 and 25+20)) B1,\n     (select avg(ss_list_price) B2_LP\n            ,count(ss_list_price) B2_CNT\n            ,count(distinct ss_list_price) B2_CNTD\n      from store_sales\n      where ss_quantity between 6 and 10\n        and (ss_list_price between 145 and 145+10\n          or ss_coupon_amt between 14792 and 14792+1000\n          or ss_wholesale_cost between 46 and 46+20)) B2,\n     (select avg(ss_list_price) B3_LP\n            ,count(ss_list_price) B3_CNT\n            ,count(distinct ss_list_price) B3_CNTD\n      from store_sales\n      where ss_quantity between 11 and 15\n        and (ss_list_price between 150 and 150+10\n          or ss_coupon_amt between 6600 and 6600+1000\n          or ss_wholesale_cost between 9 and 9+20)) B3,\n     (select avg(ss_list_price) B4_LP\n            ,count(ss_list_price) B4_CNT\n            ,count(distinct ss_list_price) B4_CNTD\n      from store_sales\n      where ss_quantity between 16 and 20\n        and (ss_list_price between 91 and 91+10\n          or ss_coupon_amt between 13493 and 13493+1000\n          or ss_wholesale_cost between 36 and 36+20)) B4,\n     (select avg(ss_list_price) B5_LP\n            ,count(ss_list_price) B5_CNT\n            ,count(distinct ss_list_price) B5_CNTD\n      from store_sales\n      where ss_quantity between 21 and 25\n        and (ss_list_price between 0 and 0+10\n          or ss_coupon_amt between 7629 and 7629+1000\n          or ss_wholesale_cost between 6 and 6+20)) B5,\n     (select avg(ss_list_price) B6_LP\n            ,count(ss_list_price) B6_CNT\n            ,count(distinct ss_list_price) B6_CNTD\n      from store_sales\n      where ss_quantity between 26 and 30\n        and (ss_list_price between 89 and 89+10\n          or ss_coupon_amt between 15257 and 15257+1000\n          or ss_wholesale_cost between 31 and 31+20)) B6\n LIMIT 100;\n\n-- end query 28 in stream 0 using template query28.tpl\n",
      "optimized_sql": "-- start query 28 in stream 0 using template query28.tpl\nselect *\nfrom (select avg(ss_list_price) B1_LP\n            ,count(ss_list_price) B1_CNT\n            ,count(distinct ss_list_price) B1_CNTD\n      from store_sales\n      where ss_quantity between 0 and 5\n        and (ss_list_price between 131 and 131+10 \n             or ss_coupon_amt between 16798 and 16798+1000\n             or ss_wholesale_cost between 25 and 25+20)) B1,\n     (select avg(ss_list_price) B2_LP\n            ,count(ss_list_price) B2_CNT\n            ,count(distinct ss_list_price) B2_CNTD\n      from store_sales\n      where ss_quantity between 6 and 10\n        and (ss_list_price between 145 and 145+10\n          or ss_coupon_amt between 14792 and 14792+1000\n          or ss_wholesale_cost between 46 and 46+20)) B2,\n     (select avg(ss_list_price) B3_LP\n            ,count(ss_list_price) B3_CNT\n            ,count(distinct ss_list_price) B3_CNTD\n      from store_sales\n      where ss_quantity between 11 and 15\n        and (ss_list_price between 150 and 150+10\n          or ss_coupon_amt between 6600 and 6600+1000\n          or ss_wholesale_cost between 9 and 9+20)) B3,\n     (select avg(ss_list_price) B4_LP\n            ,count(ss_list_price) B4_CNT\n            ,count(distinct ss_list_price) B4_CNTD\n      from store_sales\n      where ss_quantity between 16 and 20\n        and (ss_list_price between 91 and 91+10\n          or ss_coupon_amt between 13493 and 13493+1000\n          or ss_wholesale_cost between 36 and 36+20)) B4,\n     (select avg(ss_list_price) B5_LP\n            ,count(ss_list_price) B5_CNT\n            ,count(distinct ss_list_price) B5_CNTD\n      from store_sales\n      where ss_quantity between 21 and 25\n        and (ss_list_price between 0 and 0+10\n          or ss_coupon_amt between 7629 and 7629+1000\n          or ss_wholesale_cost between 6 and 6+20)) B5,\n     (select avg(ss_list_price) B6_LP\n            ,count(ss_list_price) B6_CNT\n            ,count(distinct ss_list_price) B6_CNTD\n      from store_sales\n      where ss_quantity between 26 and 30\n        and (ss_list_price between 89 and 89+10\n          or ss_coupon_amt between 15257 and 15257+1000\n          or ss_wholesale_cost between 31 and 31+20)) B6\n LIMIT 100;\n\n-- end query 28 in stream 0 using template query28.tpl\n",
      "error": null
    },
    {
      "query_id": "q92",
      "status": "REGRESSION",
      "speedup": 0.9157,
      "original_ms": 28.33,
      "optimized_ms": 30.94,
      "original_times": [
        29.2,
        27.87,
        28.79
      ],
      "optimized_times": [
        28.73,
        30.48,
        31.4
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "decorrelate"
      ],
      "original_sql": "-- start query 92 in stream 0 using template query92.tpl\nselect \n   sum(ws_ext_discount_amt)  as \"Excess Discount Amount\" \nfrom \n    web_sales \n   ,item \n   ,date_dim\nwhere\ni_manufact_id = 320\nand i_item_sk = ws_item_sk \nand d_date between '2002-02-26' and \n        (cast('2002-02-26' as date) + INTERVAL 90 DAY)\nand d_date_sk = ws_sold_date_sk \nand ws_ext_discount_amt  \n     > ( \n         SELECT \n            1.3 * avg(ws_ext_discount_amt) \n         FROM \n            web_sales \n           ,date_dim\n         WHERE \n              ws_item_sk = i_item_sk \n          and d_date between '2002-02-26' and\n                             (cast('2002-02-26' as date) + INTERVAL 90 DAY)\n          and d_date_sk = ws_sold_date_sk \n      ) \norder by sum(ws_ext_discount_amt)\n LIMIT 100;\n\n-- end query 92 in stream 0 using template query92.tpl\n",
      "optimized_sql": "WITH date_range AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2000-01-27' AND CAST('2000-04-26' AS DATE)), web_sales_filtered AS (SELECT ws_item_sk, ws_ext_discount_amt, ws_sold_date_sk FROM web_sales AS ws JOIN date_range AS dr ON ws.ws_sold_date_sk = dr.d_date_sk), item_filtered AS (SELECT i_item_sk FROM item WHERE i_manufact_id = 350), item_avg_discount AS (SELECT wf.ws_item_sk, AVG(wf.ws_ext_discount_amt) AS avg_discount FROM web_sales_filtered AS wf JOIN item_filtered AS i ON wf.ws_item_sk = i.i_item_sk GROUP BY wf.ws_item_sk)\nSELECT SUM(wf.ws_ext_discount_amt) AS \"Excess Discount Amount\" FROM web_sales_filtered AS wf JOIN item_filtered AS i ON wf.ws_item_sk = i.i_item_sk JOIN item_avg_discount AS avgd ON wf.ws_item_sk = avgd.ws_item_sk WHERE wf.ws_ext_discount_amt > 1.3 * avgd.avg_discount ORDER BY SUM(wf.ws_ext_discount_amt) LIMIT 100",
      "error": null
    },
    {
      "query_id": "q36",
      "status": "REGRESSION",
      "speedup": 0.9137,
      "original_ms": 566.59,
      "optimized_ms": 620.07,
      "original_times": [
        606.59,
        567.02,
        566.15
      ],
      "optimized_times": [
        583.97,
        620.57,
        619.57
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "multi_push_predicate"
      ],
      "original_sql": "-- start query 36 in stream 0 using template query36.tpl\nselect \n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,grouping(i_category)+grouping(i_class) as lochierarchy\n   ,rank() over (\n \tpartition by grouping(i_category)+grouping(i_class),\n \tcase when grouping(i_class) = 0 then i_category end \n \torder by sum(ss_net_profit)/sum(ss_ext_sales_price) asc) as rank_within_parent\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n and d1.d_date_sk = ss_sold_date_sk\n and i_item_sk  = ss_item_sk \n and s_store_sk  = ss_store_sk\n and s_state in ('SD','TN','GA','SC',\n                 'MO','AL','MI','OH')\n group by rollup(i_category,i_class)\n order by\n   lochierarchy desc\n  ,case when lochierarchy = 0 then i_category end\n  ,rank_within_parent\n LIMIT 100;\n\n-- end query 36 in stream 0 using template query36.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001), filtered_store AS (SELECT s_store_sk FROM store WHERE s_state = 'TN'), results AS (SELECT SUM(ss_net_profit) AS ss_net_profit, SUM(ss_ext_sales_price) AS ss_ext_sales_price, (SUM(ss_net_profit) * 1.0000) / SUM(ss_ext_sales_price) AS gross_margin, i_category, i_class, 0 AS g_category, 0 AS g_class FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN item ON i_item_sk = ss_item_sk JOIN filtered_store ON s_store_sk = ss_store_sk GROUP BY i_category, i_class), results_rollup AS (SELECT gross_margin, i_category, i_class, 0 AS t_category, 0 AS t_class, 0 AS lochierarchy FROM results UNION SELECT (SUM(ss_net_profit) * 1.0000) / SUM(ss_ext_sales_price) AS gross_margin, i_category, NULL AS i_class, 0 AS t_category, 1 AS t_class, 1 AS lochierarchy FROM results GROUP BY i_category UNION SELECT (SUM(ss_net_profit) * 1.0000) / SUM(ss_ext_sales_price) AS gross_margin, NULL AS i_category, NULL AS i_class, 1 AS t_category, 1 AS t_class, 2 AS lochierarchy FROM results)\nSELECT gross_margin, i_category, i_class, lochierarchy, RANK() OVER (PARTITION BY lochierarchy, CASE WHEN t_class = 0 THEN i_category END ORDER BY gross_margin ASC) AS rank_within_parent FROM results_rollup ORDER BY lochierarchy DESC NULLS FIRST, CASE WHEN lochierarchy = 0 THEN i_category END NULLS FIRST, rank_within_parent NULLS FIRST LIMIT 100",
      "error": null
    },
    {
      "query_id": "q47",
      "status": "REGRESSION",
      "speedup": 0.9092,
      "original_ms": 414.68,
      "optimized_ms": 456.1,
      "original_times": [
        446.6,
        414.54,
        414.81
      ],
      "optimized_times": [
        451.92,
        469.71,
        442.49
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "or_to_union"
      ],
      "original_sql": "-- start query 47 in stream 0 using template query47.tpl\nwith v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select *\n from v2\n where  d_year = 2001 and    \n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n order by sum_sales - avg_monthly_sales, nsum\n LIMIT 100;\n\n-- end query 47 in stream 0 using template query47.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE d_year = 1999 UNION ALL SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE d_year = 1998 AND d_moy = 12 UNION ALL SELECT d_date_sk, d_year, d_moy FROM date_dim WHERE d_year = 2000 AND d_moy = 1), v1 AS (SELECT i_category, i_brand, s_store_name, s_company_name, d_year, d_moy, SUM(ss_sales_price) AS sum_sales, AVG(SUM(ss_sales_price)) OVER (PARTITION BY i_category, i_brand, s_store_name, s_company_name, d_year) AS avg_monthly_sales, RANK() OVER (PARTITION BY i_category, i_brand, s_store_name, s_company_name ORDER BY d_year, d_moy) AS rn FROM item, store_sales, filtered_dates, store WHERE ss_item_sk = i_item_sk AND ss_sold_date_sk = d_date_sk AND ss_store_sk = s_store_sk GROUP BY i_category, i_brand, s_store_name, s_company_name, d_year, d_moy), v2 AS (SELECT v1.i_category, v1.i_brand, v1.s_store_name, v1.s_company_name, v1.d_year, v1.d_moy, v1.avg_monthly_sales, v1.sum_sales, v1_lag.sum_sales AS psum, v1_lead.sum_sales AS nsum FROM v1, v1 AS v1_lag, v1 AS v1_lead WHERE v1.i_category = v1_lag.i_category AND v1.i_category = v1_lead.i_category AND v1.i_brand = v1_lag.i_brand AND v1.i_brand = v1_lead.i_brand AND v1.s_store_name = v1_lag.s_store_name AND v1.s_store_name = v1_lead.s_store_name AND v1.s_company_name = v1_lag.s_company_name AND v1.s_company_name = v1_lead.s_company_name AND v1.rn = v1_lag.rn + 1 AND v1.rn = v1_lead.rn - 1)\nSELECT * FROM v2 WHERE d_year = 1999 AND avg_monthly_sales > 0 AND CASE WHEN avg_monthly_sales > 0 THEN ABS(sum_sales - avg_monthly_sales) / avg_monthly_sales ELSE NULL END > 0.1 ORDER BY sum_sales - avg_monthly_sales, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 LIMIT 100",
      "error": null
    },
    {
      "query_id": "q97",
      "status": "REGRESSION",
      "speedup": 0.9048,
      "original_ms": 272.61,
      "optimized_ms": 301.3,
      "original_times": [
        273.1,
        275.42,
        269.8
      ],
      "optimized_times": [
        282.93,
        313.74,
        288.86
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 97 in stream 0 using template query97.tpl\nwith ssci as (\nselect ss_customer_sk customer_sk\n      ,ss_item_sk item_sk\nfrom store_sales,date_dim\nwhere ss_sold_date_sk = d_date_sk\n  and d_month_seq between 1214 and 1214 + 11\ngroup by ss_customer_sk\n        ,ss_item_sk),\ncsci as(\n select cs_bill_customer_sk customer_sk\n      ,cs_item_sk item_sk\nfrom catalog_sales,date_dim\nwhere cs_sold_date_sk = d_date_sk\n  and d_month_seq between 1214 and 1214 + 11\ngroup by cs_bill_customer_sk\n        ,cs_item_sk)\n select sum(case when ssci.customer_sk is not null and csci.customer_sk is null then 1 else 0 end) store_only\n      ,sum(case when ssci.customer_sk is null and csci.customer_sk is not null then 1 else 0 end) catalog_only\n      ,sum(case when ssci.customer_sk is not null and csci.customer_sk is not null then 1 else 0 end) store_and_catalog\nfrom ssci full outer join csci on (ssci.customer_sk=csci.customer_sk\n                               and ssci.item_sk = csci.item_sk)\n LIMIT 100;\n\n-- end query 97 in stream 0 using template query97.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1200 AND 1200 + 11), ssci AS (SELECT ss_customer_sk AS customer_sk, ss_item_sk AS item_sk FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk GROUP BY ss_customer_sk, ss_item_sk), csci AS (SELECT cs_bill_customer_sk AS customer_sk, cs_item_sk AS item_sk FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk GROUP BY cs_bill_customer_sk, cs_item_sk)\nSELECT SUM(CASE WHEN NOT ssci.customer_sk IS NULL AND csci.customer_sk IS NULL THEN 1 ELSE 0 END) AS store_only, SUM(CASE WHEN ssci.customer_sk IS NULL AND NOT csci.customer_sk IS NULL THEN 1 ELSE 0 END) AS catalog_only, SUM(CASE WHEN NOT ssci.customer_sk IS NULL AND NOT csci.customer_sk IS NULL THEN 1 ELSE 0 END) AS store_and_catalog FROM ssci FULL OUTER JOIN csci ON (ssci.customer_sk = csci.customer_sk AND ssci.item_sk = csci.item_sk) LIMIT 100",
      "error": null
    },
    {
      "query_id": "q17",
      "status": "REGRESSION",
      "speedup": 0.9034,
      "original_ms": 105.63,
      "optimized_ms": 116.93,
      "original_times": [
        123.63,
        104.2,
        107.05
      ],
      "optimized_times": [
        107.89,
        117.63,
        116.22
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [],
      "original_sql": "-- start query 17 in stream 0 using template query17.tpl\nselect i_item_id\n       ,i_item_desc\n       ,s_state\n       ,count(ss_quantity) as store_sales_quantitycount\n       ,avg(ss_quantity) as store_sales_quantityave\n       ,stddev_samp(ss_quantity) as store_sales_quantitystdev\n       ,stddev_samp(ss_quantity)/avg(ss_quantity) as store_sales_quantitycov\n       ,count(sr_return_quantity) as store_returns_quantitycount\n       ,avg(sr_return_quantity) as store_returns_quantityave\n       ,stddev_samp(sr_return_quantity) as store_returns_quantitystdev\n       ,stddev_samp(sr_return_quantity)/avg(sr_return_quantity) as store_returns_quantitycov\n       ,count(cs_quantity) as catalog_sales_quantitycount ,avg(cs_quantity) as catalog_sales_quantityave\n       ,stddev_samp(cs_quantity) as catalog_sales_quantitystdev\n       ,stddev_samp(cs_quantity)/avg(cs_quantity) as catalog_sales_quantitycov\n from store_sales\n     ,store_returns\n     ,catalog_sales\n     ,date_dim d1\n     ,date_dim d2\n     ,date_dim d3\n     ,store\n     ,item\n where d1.d_quarter_name = '2001Q1'\n   and d1.d_date_sk = ss_sold_date_sk\n   and i_item_sk = ss_item_sk\n   and s_store_sk = ss_store_sk\n   and ss_customer_sk = sr_customer_sk\n   and ss_item_sk = sr_item_sk\n   and ss_ticket_number = sr_ticket_number\n   and sr_returned_date_sk = d2.d_date_sk\n   and d2.d_quarter_name in ('2001Q1','2001Q2','2001Q3')\n   and sr_customer_sk = cs_bill_customer_sk\n   and sr_item_sk = cs_item_sk\n   and cs_sold_date_sk = d3.d_date_sk\n   and d3.d_quarter_name in ('2001Q1','2001Q2','2001Q3')\n group by i_item_id\n         ,i_item_desc\n         ,s_state\n order by i_item_id\n         ,i_item_desc\n         ,s_state\n LIMIT 100;\n\n-- end query 17 in stream 0 using template query17.tpl\n",
      "optimized_sql": "-- start query 17 in stream 0 using template query17.tpl\nselect i_item_id\n       ,i_item_desc\n       ,s_state\n       ,count(ss_quantity) as store_sales_quantitycount\n       ,avg(ss_quantity) as store_sales_quantityave\n       ,stddev_samp(ss_quantity) as store_sales_quantitystdev\n       ,stddev_samp(ss_quantity)/avg(ss_quantity) as store_sales_quantitycov\n       ,count(sr_return_quantity) as store_returns_quantitycount\n       ,avg(sr_return_quantity) as store_returns_quantityave\n       ,stddev_samp(sr_return_quantity) as store_returns_quantitystdev\n       ,stddev_samp(sr_return_quantity)/avg(sr_return_quantity) as store_returns_quantitycov\n       ,count(cs_quantity) as catalog_sales_quantitycount ,avg(cs_quantity) as catalog_sales_quantityave\n       ,stddev_samp(cs_quantity) as catalog_sales_quantitystdev\n       ,stddev_samp(cs_quantity)/avg(cs_quantity) as catalog_sales_quantitycov\n from store_sales\n     ,store_returns\n     ,catalog_sales\n     ,date_dim d1\n     ,date_dim d2\n     ,date_dim d3\n     ,store\n     ,item\n where d1.d_quarter_name = '2001Q1'\n   and d1.d_date_sk = ss_sold_date_sk\n   and i_item_sk = ss_item_sk\n   and s_store_sk = ss_store_sk\n   and ss_customer_sk = sr_customer_sk\n   and ss_item_sk = sr_item_sk\n   and ss_ticket_number = sr_ticket_number\n   and sr_returned_date_sk = d2.d_date_sk\n   and d2.d_quarter_name in ('2001Q1','2001Q2','2001Q3')\n   and sr_customer_sk = cs_bill_customer_sk\n   and sr_item_sk = cs_item_sk\n   and cs_sold_date_sk = d3.d_date_sk\n   and d3.d_quarter_name in ('2001Q1','2001Q2','2001Q3')\n group by i_item_id\n         ,i_item_desc\n         ,s_state\n order by i_item_id\n         ,i_item_desc\n         ,s_state\n LIMIT 100;\n\n-- end query 17 in stream 0 using template query17.tpl\n",
      "error": null
    },
    {
      "query_id": "q48",
      "status": "REGRESSION",
      "speedup": 0.9019,
      "original_ms": 151.17,
      "optimized_ms": 167.62,
      "original_times": [
        154.65,
        157.97,
        144.36
      ],
      "optimized_times": [
        187.56,
        172.45,
        162.78
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "or_to_union"
      ],
      "original_sql": "-- start query 48 in stream 0 using template query48.tpl\nselect sum (ss_quantity)\n from store_sales, store, customer_demographics, customer_address, date_dim\n where s_store_sk = ss_store_sk\n and  ss_sold_date_sk = d_date_sk and d_year = 1999\n and  \n (\n  (\n   cd_demo_sk = ss_cdemo_sk\n   and \n   cd_marital_status = 'U'\n   and \n   cd_education_status = 'Primary'\n   and \n   ss_sales_price between 100.00 and 150.00  \n   )\n or\n  (\n  cd_demo_sk = ss_cdemo_sk\n   and \n   cd_marital_status = 'W'\n   and \n   cd_education_status = 'College'\n   and \n   ss_sales_price between 50.00 and 100.00   \n  )\n or \n (\n  cd_demo_sk = ss_cdemo_sk\n  and \n   cd_marital_status = 'D'\n   and \n   cd_education_status = '2 yr Degree'\n   and \n   ss_sales_price between 150.00 and 200.00  \n )\n )\n and\n (\n  (\n  ss_addr_sk = ca_address_sk\n  and\n  ca_country = 'United States'\n  and\n  ca_state in ('MD', 'MN', 'IA')\n  and ss_net_profit between 0 and 2000  \n  )\n or\n  (ss_addr_sk = ca_address_sk\n  and\n  ca_country = 'United States'\n  and\n  ca_state in ('VA', 'IL', 'TX')\n  and ss_net_profit between 150 and 3000 \n  )\n or\n  (ss_addr_sk = ca_address_sk\n  and\n  ca_country = 'United States'\n  and\n  ca_state in ('MI', 'WI', 'IN')\n  and ss_net_profit between 50 and 25000 \n  )\n )\n;\n\n-- end query 48 in stream 0 using template query48.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2000), filtered_stores AS (SELECT s_store_sk FROM store), branch_1 AS (SELECT ss_quantity FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN filtered_stores ON s_store_sk = ss_store_sk JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk JOIN customer_address ON ss_addr_sk = ca_address_sk WHERE cd_marital_status = 'M' AND cd_education_status = '4 yr Degree' AND ss_sales_price BETWEEN 100.00 AND 150.00 AND ca_country = 'United States' AND ca_state IN ('CO', 'OH', 'TX') AND ss_net_profit BETWEEN 0 AND 2000), branch_2 AS (SELECT ss_quantity FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN filtered_stores ON s_store_sk = ss_store_sk JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk JOIN customer_address ON ss_addr_sk = ca_address_sk WHERE cd_marital_status = 'D' AND cd_education_status = '2 yr Degree' AND ss_sales_price BETWEEN 50.00 AND 100.00 AND ca_country = 'United States' AND ca_state IN ('OR', 'MN', 'KY') AND ss_net_profit BETWEEN 150 AND 3000), branch_3 AS (SELECT ss_quantity FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN filtered_stores ON s_store_sk = ss_store_sk JOIN customer_demographics ON cd_demo_sk = ss_cdemo_sk JOIN customer_address ON ss_addr_sk = ca_address_sk WHERE cd_marital_status = 'S' AND cd_education_status = 'College' AND ss_sales_price BETWEEN 150.00 AND 200.00 AND ca_country = 'United States' AND ca_state IN ('VA', 'CA', 'MS') AND ss_net_profit BETWEEN 50 AND 25000)\nSELECT SUM(ss_quantity) FROM (SELECT * FROM branch_1 UNION ALL SELECT * FROM branch_2 UNION ALL SELECT * FROM branch_3) AS combined",
      "error": null
    },
    {
      "query_id": "q71",
      "status": "REGRESSION",
      "speedup": 0.8911,
      "original_ms": 82.26,
      "optimized_ms": 92.31,
      "original_times": [
        81.75,
        76.24,
        88.27
      ],
      "optimized_times": [
        86.92,
        90.9,
        93.72
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "or_to_union"
      ],
      "original_sql": "-- start query 71 in stream 0 using template query71.tpl\nselect i_brand_id brand_id, i_brand brand,t_hour,t_minute,\n \tsum(ext_price) ext_price\n from item, (select ws_ext_sales_price as ext_price, \n                        ws_sold_date_sk as sold_date_sk,\n                        ws_item_sk as sold_item_sk,\n                        ws_sold_time_sk as time_sk  \n                 from web_sales,date_dim\n                 where d_date_sk = ws_sold_date_sk\n                   and d_moy=12\n                   and d_year=1998\n                 union all\n                 select cs_ext_sales_price as ext_price,\n                        cs_sold_date_sk as sold_date_sk,\n                        cs_item_sk as sold_item_sk,\n                        cs_sold_time_sk as time_sk\n                 from catalog_sales,date_dim\n                 where d_date_sk = cs_sold_date_sk\n                   and d_moy=12\n                   and d_year=1998\n                 union all\n                 select ss_ext_sales_price as ext_price,\n                        ss_sold_date_sk as sold_date_sk,\n                        ss_item_sk as sold_item_sk,\n                        ss_sold_time_sk as time_sk\n                 from store_sales,date_dim\n                 where d_date_sk = ss_sold_date_sk\n                   and d_moy=12\n                   and d_year=1998\n                 ) tmp,time_dim\n where\n   sold_item_sk = i_item_sk\n   and i_manager_id=1\n   and time_sk = t_time_sk\n   and (t_meal_time = 'breakfast' or t_meal_time = 'dinner')\n group by i_brand, i_brand_id,t_hour,t_minute\n order by ext_price desc, i_brand_id\n ;\n\n-- end query 71 in stream 0 using template query71.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_moy = 11 AND d_year = 1999), filtered_time AS (SELECT t_time_sk, t_hour, t_minute FROM time_dim WHERE t_meal_time = 'breakfast' OR t_meal_time = 'dinner'), sales_union AS (SELECT ws_ext_sales_price AS ext_price, ws_sold_date_sk AS sold_date_sk, ws_item_sk AS sold_item_sk, ws_sold_time_sk AS time_sk FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk UNION ALL SELECT cs_ext_sales_price AS ext_price, cs_sold_date_sk AS sold_date_sk, cs_item_sk AS sold_item_sk, cs_sold_time_sk AS time_sk FROM catalog_sales JOIN filtered_dates ON cs_sold_date_sk = d_date_sk UNION ALL SELECT ss_ext_sales_price AS ext_price, ss_sold_date_sk AS sold_date_sk, ss_item_sk AS sold_item_sk, ss_sold_time_sk AS time_sk FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk)\nSELECT i_brand_id AS brand_id, i_brand AS brand, t_hour, t_minute, SUM(ext_price) AS ext_price FROM sales_union JOIN item ON sold_item_sk = i_item_sk AND i_manager_id = 1 JOIN filtered_time ON time_sk = t_time_sk GROUP BY i_brand, i_brand_id, t_hour, t_minute ORDER BY ext_price DESC NULLS FIRST, i_brand_id NULLS FIRST, t_hour NULLS FIRST",
      "error": null
    },
    {
      "query_id": "q51",
      "status": "WIN",
      "speedup": 1.82,
      "original_ms": 1643.1,
      "optimized_ms": 902.1,
      "original_times": [
        1742.3,
        1642.2,
        1643.9
      ],
      "optimized_times": [
        705.1,
        1089.8,
        714.3
      ],
      "rows_match": true,
      "source": "analyst_mode",
      "transforms": [
        "window_elimination",
        "full_outer_to_inner_join"
      ],
      "original_sql": "-- start query 51 in stream 0 using template query51.tpl\nWITH web_v1 as (\nselect\n  ws_item_sk item_sk, d_date,\n  sum(sum(ws_sales_price))\n      over (partition by ws_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom web_sales\n    ,date_dim\nwhere ws_sold_date_sk=d_date_sk\n  and d_month_seq between 1216 and 1216+11\n  and ws_item_sk is not NULL\ngroup by ws_item_sk, d_date),\nstore_v1 as (\nselect\n  ss_item_sk item_sk, d_date,\n  sum(sum(ss_sales_price))\n      over (partition by ss_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom store_sales\n    ,date_dim\nwhere ss_sold_date_sk=d_date_sk\n  and d_month_seq between 1216 and 1216+11\n  and ss_item_sk is not NULL\ngroup by ss_item_sk, d_date)\n select *\nfrom (select item_sk\n     ,d_date\n     ,web_sales\n     ,store_sales\n     ,max(web_sales)\n         over (partition by item_sk order by d_date rows between unbounded preceding and current row) web_cumulative\n     ,max(store_sales)\n         over (partition by item_sk order by d_date rows between unbounded preceding and current row) store_cumulative\n     from (select case when web.item_sk is not null then web.item_sk else store.item_sk end item_sk\n                 ,case when web.d_date is not null then web.d_date else store.d_date end d_date\n                 ,web.cume_sales web_sales\n                 ,store.cume_sales store_sales\n           from web_v1 web full outer join store_v1 store on (web.item_sk = store.item_sk\n                                                          and web.d_date = store.d_date)\n          )x )y\nwhere web_cumulative > store_cumulative\norder by item_sk\n        ,d_date\n LIMIT 100;\n\n-- end query 51 in stream 0 using template query51.tpl\n",
      "optimized_sql": "WITH web_v1 AS (\n  SELECT\n    ws_item_sk AS item_sk,\n    d_date,\n    SUM(SUM(ws_sales_price)) OVER (\n      PARTITION BY ws_item_sk\n      ORDER BY d_date\n      rows BETWEEN UNBOUNDED preceding AND CURRENT ROW\n    ) AS cume_sales\n  FROM web_sales, date_dim\n  WHERE\n    ws_sold_date_sk = d_date_sk\n    AND d_month_seq BETWEEN 1216 AND 1216 + 11\n    AND NOT ws_item_sk IS NULL\n  GROUP BY\n    ws_item_sk,\n    d_date\n), store_v1 AS (\n  SELECT\n    ss_item_sk AS item_sk,\n    d_date,\n    SUM(SUM(ss_sales_price)) OVER (\n      PARTITION BY ss_item_sk\n      ORDER BY d_date\n      rows BETWEEN UNBOUNDED preceding AND CURRENT ROW\n    ) AS cume_sales\n  FROM store_sales, date_dim\n  WHERE\n    ss_sold_date_sk = d_date_sk\n    AND d_month_seq BETWEEN 1216 AND 1216 + 11\n    AND NOT ss_item_sk IS NULL\n  GROUP BY\n    ss_item_sk,\n    d_date\n)\nSELECT\n  COALESCE(web.item_sk, store.item_sk) AS item_sk,\n  COALESCE(web.d_date, store.d_date) AS d_date,\n  web.cume_sales AS web_sales,\n  store.cume_sales AS store_sales,\n  web.cume_sales AS web_cumulative,\n  store.cume_sales AS store_cumulative\nFROM web_v1 AS web\nINNER JOIN store_v1 AS store\n  ON web.item_sk = store.item_sk AND web.d_date = store.d_date\nWHERE web.cume_sales > store.cume_sales\nORDER BY item_sk, d_date\nLIMIT 100",
      "error": null
    },
    {
      "query_id": "q73",
      "status": "REGRESSION",
      "speedup": 0.8739,
      "original_ms": 112.25,
      "optimized_ms": 128.45,
      "original_times": [
        127.31,
        106.22,
        118.28
      ],
      "optimized_times": [
        135.63,
        130.46,
        126.44
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "or_to_union"
      ],
      "original_sql": "-- start query 73 in stream 0 using template query73.tpl\nselect c_last_name\n       ,c_first_name\n       ,c_salutation\n       ,c_preferred_cust_flag \n       ,ss_ticket_number\n       ,cnt from\n   (select ss_ticket_number\n          ,ss_customer_sk\n          ,count(*) cnt\n    from store_sales,date_dim,store,household_demographics\n    where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n    and store_sales.ss_store_sk = store.s_store_sk  \n    and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n    and date_dim.d_dom between 1 and 2 \n    and (household_demographics.hd_buy_potential = '501-1000' or\n         household_demographics.hd_buy_potential = 'Unknown')\n    and household_demographics.hd_vehicle_count > 0\n    and case when household_demographics.hd_vehicle_count > 0 then \n             household_demographics.hd_dep_count/ household_demographics.hd_vehicle_count else null end > 1\n    and date_dim.d_year in (2000,2000+1,2000+2)\n    and store.s_county in ('Fairfield County','Walker County','Daviess County','Barrow County')\n    group by ss_ticket_number,ss_customer_sk) dj,customer\n    where ss_customer_sk = c_customer_sk\n      and cnt between 1 and 5\n    order by cnt desc, c_last_name asc;\n\n-- end query 73 in stream 0 using template query73.tpl\n",
      "optimized_sql": "-- start query 73 in stream 0 using template query73.tpl\nselect c_last_name\n       ,c_first_name\n       ,c_salutation\n       ,c_preferred_cust_flag \n       ,ss_ticket_number\n       ,cnt from\n   (select ss_ticket_number\n          ,ss_customer_sk\n          ,count(*) cnt\n    from store_sales,date_dim,store,household_demographics\n    where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n    and store_sales.ss_store_sk = store.s_store_sk  \n    and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n    and date_dim.d_dom between 1 and 2 \n    and (household_demographics.hd_buy_potential = '501-1000' or\n         household_demographics.hd_buy_potential = 'Unknown')\n    and household_demographics.hd_vehicle_count > 0\n    and case when household_demographics.hd_vehicle_count > 0 then \n             household_demographics.hd_dep_count/ household_demographics.hd_vehicle_count else null end > 1\n    and date_dim.d_year in (2000,2000+1,2000+2)\n    and store.s_county in ('Fairfield County','Walker County','Daviess County','Barrow County')\n    group by ss_ticket_number,ss_customer_sk) dj,customer\n    where ss_customer_sk = c_customer_sk\n      and cnt between 1 and 5\n    order by cnt desc, c_last_name asc;\n\n-- end query 73 in stream 0 using template query73.tpl\n",
      "error": null
    },
    {
      "query_id": "q67",
      "status": "REGRESSION",
      "speedup": 0.8523,
      "original_ms": 4509.08,
      "optimized_ms": 5290.65,
      "original_times": [
        4809.97,
        4540.04,
        4478.13
      ],
      "optimized_times": [
        4677.24,
        4999.69,
        5581.6
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 67 in stream 0 using template query67.tpl\nselect *\nfrom (select i_category\n            ,i_class\n            ,i_brand\n            ,i_product_name\n            ,d_year\n            ,d_qoy\n            ,d_moy\n            ,s_store_id\n            ,sumsales\n            ,rank() over (partition by i_category order by sumsales desc) rk\n      from (select i_category\n                  ,i_class\n                  ,i_brand\n                  ,i_product_name\n                  ,d_year\n                  ,d_qoy\n                  ,d_moy\n                  ,s_store_id\n                  ,sum(coalesce(ss_sales_price*ss_quantity,0)) sumsales\n            from store_sales\n                ,date_dim\n                ,store\n                ,item\n       where  ss_sold_date_sk=d_date_sk\n          and ss_item_sk=i_item_sk\n          and ss_store_sk = s_store_sk\n          and d_month_seq between 1206 and 1206+11\n       group by  rollup(i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy,s_store_id))dw1) dw2\nwhere rk <= 100\norder by i_category\n        ,i_class\n        ,i_brand\n        ,i_product_name\n        ,d_year\n        ,d_qoy\n        ,d_moy\n        ,s_store_id\n        ,sumsales\n        ,rk\n LIMIT 100;\n\n-- end query 67 in stream 0 using template query67.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_year, d_qoy, d_moy FROM date_dim WHERE d_month_seq BETWEEN 1206 AND 1206 + 11), dw1 AS (SELECT i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy, s_store_id, SUM(COALESCE(ss_sales_price * ss_quantity, 0)) AS sumsales FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN store ON ss_store_sk = s_store_sk JOIN item ON ss_item_sk = i_item_sk GROUP BY ROLLUP (i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy, s_store_id)), dw2 AS (SELECT i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy, s_store_id, sumsales, RANK() OVER (PARTITION BY i_category ORDER BY sumsales DESC) AS rk FROM dw1)\nSELECT * FROM dw2 WHERE rk <= 100 ORDER BY i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy, s_store_id, sumsales, rk LIMIT 100",
      "error": null
    },
    {
      "query_id": "q6",
      "status": "REGRESSION",
      "speedup": 0.8484,
      "original_ms": 49.89,
      "optimized_ms": 58.81,
      "original_times": [
        56.51,
        47.83,
        51.96
      ],
      "optimized_times": [
        61.72,
        59.38,
        58.23
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [],
      "original_sql": "-- start query 6 in stream 0 using template query6.tpl\nselect a.ca_state state, count(*) cnt\n from customer_address a\n     ,customer c\n     ,store_sales s\n     ,date_dim d\n     ,item i\n where       a.ca_address_sk = c.c_current_addr_sk\n \tand c.c_customer_sk = s.ss_customer_sk\n \tand s.ss_sold_date_sk = d.d_date_sk\n \tand s.ss_item_sk = i.i_item_sk\n \tand d.d_month_seq = \n \t     (select distinct (d_month_seq)\n \t      from date_dim\n               where d_year = 2002\n \t        and d_moy = 3 )\n \tand i.i_current_price > 1.2 * \n             (select avg(j.i_current_price) \n \t     from item j \n \t     where j.i_category = i.i_category)\n group by a.ca_state\n having count(*) >= 10\n order by cnt, a.ca_state\n LIMIT 100;\n\n-- end query 6 in stream 0 using template query6.tpl\n",
      "optimized_sql": "WITH target_month AS (SELECT DISTINCT d_month_seq FROM date_dim WHERE d_year = 2002 AND d_moy = 3), category_avg AS (SELECT i_category, AVG(i_current_price) * 1.2 AS price_threshold FROM item GROUP BY i_category)\nSELECT a.ca_state AS state, COUNT(*) AS cnt FROM customer_address AS a JOIN customer AS c ON a.ca_address_sk = c.c_current_addr_sk JOIN store_sales AS s ON c.c_customer_sk = s.ss_customer_sk JOIN date_dim AS d ON s.ss_sold_date_sk = d.d_date_sk JOIN target_month AS tm ON d.d_month_seq = tm.d_month_seq JOIN item AS i ON s.ss_item_sk = i.i_item_sk JOIN category_avg AS ca ON i.i_category = ca.i_category WHERE i.i_current_price > ca.price_threshold GROUP BY a.ca_state HAVING COUNT(*) >= 10 ORDER BY cnt, a.ca_state LIMIT 100",
      "error": null
    },
    {
      "query_id": "q32",
      "status": "REGRESSION",
      "speedup": 0.8205,
      "original_ms": 13.88,
      "optimized_ms": 16.92,
      "original_times": [
        13.89,
        11.86,
        15.91
      ],
      "optimized_times": [
        18.06,
        16.78,
        17.06
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "decorrelate"
      ],
      "original_sql": "-- start query 32 in stream 0 using template query32.tpl\nselect sum(cs_ext_discount_amt)  as \"excess discount amount\" \nfrom \n   catalog_sales \n   ,item \n   ,date_dim\nwhere\ni_manufact_id = 29\nand i_item_sk = cs_item_sk \nand d_date between '1999-01-07' and \n        (cast('1999-01-07' as date) + INTERVAL 90 DAY)\nand d_date_sk = cs_sold_date_sk \nand cs_ext_discount_amt  \n     > ( \n         select \n            1.3 * avg(cs_ext_discount_amt) \n         from \n            catalog_sales \n           ,date_dim\n         where \n              cs_item_sk = i_item_sk \n          and d_date between '1999-01-07' and\n                             (cast('1999-01-07' as date) + INTERVAL 90 DAY)\n          and d_date_sk = cs_sold_date_sk \n      )\n LIMIT 100;\n\n-- end query 32 in stream 0 using template query32.tpl\n",
      "optimized_sql": "WITH date_range AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '1999-01-07' AND (CAST('1999-01-07' AS DATE) + INTERVAL '90' DAY)), target_items AS (SELECT i_item_sk FROM item WHERE i_manufact_id = 29), item_avg_discount AS (SELECT cs_item_sk, 1.3 * AVG(cs_ext_discount_amt) AS avg_discount_threshold FROM catalog_sales JOIN date_range ON cs_sold_date_sk = d_date_sk GROUP BY cs_item_sk)\nSELECT SUM(cs.cs_ext_discount_amt) AS \"excess discount amount\" FROM catalog_sales AS cs JOIN target_items AS ti ON cs.cs_item_sk = ti.i_item_sk JOIN date_range AS dr ON cs.cs_sold_date_sk = dr.d_date_sk JOIN item_avg_discount AS iad ON cs.cs_item_sk = iad.cs_item_sk WHERE cs.cs_ext_discount_amt > iad.avg_discount_threshold LIMIT 100",
      "error": null
    },
    {
      "query_id": "q58",
      "status": "REGRESSION",
      "speedup": 0.7822,
      "original_ms": 46.34,
      "optimized_ms": 59.24,
      "original_times": [
        50.47,
        44.96,
        47.71
      ],
      "optimized_times": [
        58.19,
        58.22,
        60.26
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "materialize_cte"
      ],
      "original_sql": "-- start query 58 in stream 0 using template query58.tpl\nwith ss_items as\n (select i_item_id item_id\n        ,sum(ss_ext_sales_price) ss_item_rev \n from store_sales\n     ,item\n     ,date_dim\n where ss_item_sk = i_item_sk\n   and d_date in (select d_date\n                  from date_dim\n                  where d_week_seq = (select d_week_seq \n                                      from date_dim\n                                      where d_date = '2001-03-24'))\n   and ss_sold_date_sk   = d_date_sk\n group by i_item_id),\n cs_items as\n (select i_item_id item_id\n        ,sum(cs_ext_sales_price) cs_item_rev\n  from catalog_sales\n      ,item\n      ,date_dim\n where cs_item_sk = i_item_sk\n  and  d_date in (select d_date\n                  from date_dim\n                  where d_week_seq = (select d_week_seq \n                                      from date_dim\n                                      where d_date = '2001-03-24'))\n  and  cs_sold_date_sk = d_date_sk\n group by i_item_id),\n ws_items as\n (select i_item_id item_id\n        ,sum(ws_ext_sales_price) ws_item_rev\n  from web_sales\n      ,item\n      ,date_dim\n where ws_item_sk = i_item_sk\n  and  d_date in (select d_date\n                  from date_dim\n                  where d_week_seq =(select d_week_seq \n                                     from date_dim\n                                     where d_date = '2001-03-24'))\n  and ws_sold_date_sk   = d_date_sk\n group by i_item_id)\n  select ss_items.item_id\n       ,ss_item_rev\n       ,ss_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 ss_dev\n       ,cs_item_rev\n       ,cs_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 cs_dev\n       ,ws_item_rev\n       ,ws_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 ws_dev\n       ,(ss_item_rev+cs_item_rev+ws_item_rev)/3 average\n from ss_items,cs_items,ws_items\n where ss_items.item_id=cs_items.item_id\n   and ss_items.item_id=ws_items.item_id \n   and ss_item_rev between 0.9 * cs_item_rev and 1.1 * cs_item_rev\n   and ss_item_rev between 0.9 * ws_item_rev and 1.1 * ws_item_rev\n   and cs_item_rev between 0.9 * ss_item_rev and 1.1 * ss_item_rev\n   and cs_item_rev between 0.9 * ws_item_rev and 1.1 * ws_item_rev\n   and ws_item_rev between 0.9 * ss_item_rev and 1.1 * ss_item_rev\n   and ws_item_rev between 0.9 * cs_item_rev and 1.1 * cs_item_rev\n order by ss_items.item_id\n         ,ss_item_rev\n LIMIT 100;\n\n-- end query 58 in stream 0 using template query58.tpl\n",
      "optimized_sql": "WITH target_week AS (SELECT d_week_seq FROM date_dim WHERE d_date = '2000-01-03'), filtered_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_week_seq = (SELECT d_week_seq FROM target_week)), ss_items AS (SELECT i_item_id AS item_id, SUM(ss_ext_sales_price) AS ss_item_rev FROM store_sales JOIN item ON ss_item_sk = i_item_sk JOIN filtered_dates ON ss_sold_date_sk = d_date_sk GROUP BY i_item_id), ws_items AS (SELECT i_item_id AS item_id, SUM(ws_ext_sales_price) AS ws_item_rev FROM web_sales JOIN item ON ws_item_sk = i_item_sk JOIN filtered_dates ON ws_sold_date_sk = d_date_sk GROUP BY i_item_id), cs_items AS (SELECT i_item_id AS item_id, SUM(cs_ext_sales_price) AS cs_item_rev FROM catalog_sales, item, date_dim WHERE cs_item_sk = i_item_sk AND d_date IN (SELECT d_date FROM date_dim WHERE d_week_seq = (SELECT d_week_seq FROM date_dim WHERE d_date = '2000-01-03')) AND cs_sold_date_sk = d_date_sk GROUP BY i_item_id)\nSELECT ss_items.item_id, ss_item_rev, ss_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ss_dev, cs_item_rev, cs_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS cs_dev, ws_item_rev, ws_item_rev / ((ss_item_rev + cs_item_rev + ws_item_rev) / 3) * 100 AS ws_dev, (ss_item_rev + cs_item_rev + ws_item_rev) / 3 AS average FROM ss_items, cs_items, ws_items WHERE ss_items.item_id = cs_items.item_id AND ss_items.item_id = ws_items.item_id AND ss_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev AND ss_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND cs_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND cs_item_rev BETWEEN 0.9 * ws_item_rev AND 1.1 * ws_item_rev AND ws_item_rev BETWEEN 0.9 * ss_item_rev AND 1.1 * ss_item_rev AND ws_item_rev BETWEEN 0.9 * cs_item_rev AND 1.1 * cs_item_rev ORDER BY ss_items.item_id NULLS FIRST, ss_item_rev NULLS FIRST LIMIT 100",
      "error": null
    },
    {
      "query_id": "q72",
      "status": "REGRESSION",
      "speedup": 0.7701,
      "original_ms": 348.02,
      "optimized_ms": 451.91,
      "original_times": [
        635.83,
        352.74,
        343.29
      ],
      "optimized_times": [
        498.86,
        479.89,
        423.94
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "semantic_rewrite"
      ],
      "original_sql": "-- start query 72 in stream 0 using template query72.tpl\nselect i_item_desc\n      ,w_warehouse_name\n      ,d1.d_week_seq\n      ,sum(case when p_promo_sk is null then 1 else 0 end) no_promo\n      ,sum(case when p_promo_sk is not null then 1 else 0 end) promo\n      ,count(*) total_cnt\nfrom catalog_sales\njoin inventory on (cs_item_sk = inv_item_sk)\njoin warehouse on (w_warehouse_sk=inv_warehouse_sk)\njoin item on (i_item_sk = cs_item_sk)\njoin customer_demographics on (cs_bill_cdemo_sk = cd_demo_sk)\njoin household_demographics on (cs_bill_hdemo_sk = hd_demo_sk)\njoin date_dim d1 on (cs_sold_date_sk = d1.d_date_sk)\njoin date_dim d2 on (inv_date_sk = d2.d_date_sk)\njoin date_dim d3 on (cs_ship_date_sk = d3.d_date_sk)\nleft outer join promotion on (cs_promo_sk=p_promo_sk)\nleft outer join catalog_returns on (cr_item_sk = cs_item_sk and cr_order_number = cs_order_number)\nwhere d1.d_week_seq = d2.d_week_seq\n  and inv_quantity_on_hand < cs_quantity \n  and d3.d_date > d1.d_date + 5\n  and hd_buy_potential = '501-1000'\n  and d1.d_year = 2002\n  and cd_marital_status = 'W'\ngroup by i_item_desc,w_warehouse_name,d1.d_week_seq\norder by total_cnt desc, i_item_desc, w_warehouse_name, d1.d_week_seq\n LIMIT 100;\n\n-- end query 72 in stream 0 using template query72.tpl\n",
      "optimized_sql": "WITH filtered_d1 AS (SELECT d_date_sk, d_date, d_week_seq FROM date_dim WHERE d_year = 1999), filtered_d2 AS (SELECT d_date_sk, d_week_seq FROM date_dim WHERE d_week_seq IN (SELECT d_week_seq FROM filtered_d1)), filtered_d3 AS (SELECT d_date_sk, d_date FROM date_dim), filtered_cd AS (SELECT cd_demo_sk FROM customer_demographics WHERE cd_marital_status = 'D'), filtered_hd AS (SELECT hd_demo_sk FROM household_demographics WHERE hd_buy_potential = '>10000')\nSELECT i_item_desc, w_warehouse_name, fd1.d_week_seq, SUM(CASE WHEN p_promo_sk IS NULL THEN 1 ELSE 0 END) AS no_promo, SUM(CASE WHEN NOT p_promo_sk IS NULL THEN 1 ELSE 0 END) AS promo, COUNT(*) AS total_cnt FROM catalog_sales AS cs JOIN filtered_d1 AS fd1 ON cs.cs_sold_date_sk = fd1.d_date_sk JOIN filtered_d2 AS fd2 ON fd1.d_week_seq = fd2.d_week_seq JOIN filtered_d3 AS fd3 ON cs.cs_ship_date_sk = fd3.d_date_sk AND fd3.d_date > fd1.d_date + 5 JOIN inventory AS inv ON inv.inv_item_sk = cs.cs_item_sk AND inv.inv_date_sk = fd2.d_date_sk AND inv.inv_quantity_on_hand < cs.cs_quantity JOIN warehouse AS w ON w.w_warehouse_sk = inv.inv_warehouse_sk JOIN item AS i ON i.i_item_sk = cs.cs_item_sk JOIN filtered_cd AS cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN filtered_hd AS hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk LEFT OUTER JOIN promotion AS p ON cs.cs_promo_sk = p.p_promo_sk LEFT OUTER JOIN catalog_returns AS cr ON cr.cr_item_sk = cs.cs_item_sk AND cr.cr_order_number = cs.cs_order_number GROUP BY i_item_desc, w_warehouse_name, fd1.d_week_seq ORDER BY total_cnt DESC NULLS FIRST, i_item_desc NULLS FIRST, w_warehouse_name NULLS FIRST, fd1.d_week_seq NULLS FIRST LIMIT 100",
      "error": null
    },
    {
      "query_id": "q1",
      "status": "REGRESSION",
      "speedup": 0.7078,
      "original_ms": 21.54,
      "optimized_ms": 30.43,
      "original_times": [
        102.52,
        20.95,
        22.12
      ],
      "optimized_times": [
        29.89,
        27.72,
        33.14
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "decorrelate"
      ],
      "original_sql": "-- start query 1 in stream 0 using template query1.tpl\nwith customer_total_return as\n(select sr_customer_sk as ctr_customer_sk\n,sr_store_sk as ctr_store_sk\n,sum(SR_FEE) as ctr_total_return\nfrom store_returns\n,date_dim\nwhere sr_returned_date_sk = d_date_sk\nand d_year =2000\ngroup by sr_customer_sk\n,sr_store_sk)\n select c_customer_id\nfrom customer_total_return ctr1\n,store\n,customer\nwhere ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2\nfrom customer_total_return ctr2\nwhere ctr1.ctr_store_sk = ctr2.ctr_store_sk)\nand s_store_sk = ctr1.ctr_store_sk\nand s_state = 'SD'\nand ctr1.ctr_customer_sk = c_customer_sk\norder by c_customer_id\n LIMIT 100;\n\n-- end query 1 in stream 0 using template query1.tpl\n",
      "optimized_sql": "WITH filtered_returns AS (SELECT sr.sr_customer_sk, sr.sr_store_sk, sr.SR_FEE FROM store_returns AS sr JOIN date_dim AS d ON sr.sr_returned_date_sk = d.d_date_sk JOIN store AS s ON sr.sr_store_sk = s.s_store_sk WHERE d.d_year = 2000 AND s.s_state = 'SD'), customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, SUM(SR_FEE) AS ctr_total_return FROM filtered_returns GROUP BY sr_customer_sk, sr_store_sk), store_avg_return AS (SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS avg_return_threshold FROM customer_total_return GROUP BY ctr_store_sk)\nSELECT c.c_customer_id FROM customer_total_return AS ctr1 JOIN store_avg_return AS sar ON ctr1.ctr_store_sk = sar.ctr_store_sk JOIN customer AS c ON ctr1.ctr_customer_sk = c.c_customer_sk WHERE ctr1.ctr_total_return > sar.avg_return_threshold ORDER BY c.c_customer_id LIMIT 100",
      "error": null
    },
    {
      "query_id": "q74",
      "status": "REGRESSION",
      "speedup": 0.6814,
      "original_ms": 493.27,
      "optimized_ms": 723.96,
      "original_times": [
        470.07,
        478.27,
        508.27
      ],
      "optimized_times": [
        769.92,
        764.29,
        683.63
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "pushdown"
      ],
      "original_sql": "-- start query 74 in stream 0 using template query74.tpl\nwith year_total as (\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,d_year as year\n       ,stddev_samp(ss_net_paid) year_total\n       ,'s' sale_type\n from customer\n     ,store_sales\n     ,date_dim\n where c_customer_sk = ss_customer_sk\n   and ss_sold_date_sk = d_date_sk\n   and d_year in (1999,1999+1)\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,d_year\n union all\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,d_year as year\n       ,stddev_samp(ws_net_paid) year_total\n       ,'w' sale_type\n from customer\n     ,web_sales\n     ,date_dim\n where c_customer_sk = ws_bill_customer_sk\n   and ws_sold_date_sk = d_date_sk\n   and d_year in (1999,1999+1)\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,d_year\n         )\n  select\n        t_s_secyear.customer_id, t_s_secyear.customer_first_name, t_s_secyear.customer_last_name\n from year_total t_s_firstyear\n     ,year_total t_s_secyear\n     ,year_total t_w_firstyear\n     ,year_total t_w_secyear\n where t_s_secyear.customer_id = t_s_firstyear.customer_id\n         and t_s_firstyear.customer_id = t_w_secyear.customer_id\n         and t_s_firstyear.customer_id = t_w_firstyear.customer_id\n         and t_s_firstyear.sale_type = 's'\n         and t_w_firstyear.sale_type = 'w'\n         and t_s_secyear.sale_type = 's'\n         and t_w_secyear.sale_type = 'w'\n         and t_s_firstyear.year = 1999\n         and t_s_secyear.year = 1999+1\n         and t_w_firstyear.year = 1999\n         and t_w_secyear.year = 1999+1\n         and t_s_firstyear.year_total > 0\n         and t_w_firstyear.year_total > 0\n         and case when t_w_firstyear.year_total > 0 then t_w_secyear.year_total / t_w_firstyear.year_total else null end\n           > case when t_s_firstyear.year_total > 0 then t_s_secyear.year_total / t_s_firstyear.year_total else null end\n order by 2,1,3\n LIMIT 100;\n\n-- end query 74 in stream 0 using template query74.tpl\n",
      "optimized_sql": "WITH year_total AS (SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, d_year AS year, STDDEV_SAMP(ss_net_paid) AS year_total, 's' AS sale_type FROM customer, store_sales, date_dim WHERE c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year IN (1999, 1999 + 1) GROUP BY c_customer_id, c_first_name, c_last_name, d_year UNION ALL SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, d_year AS year, STDDEV_SAMP(ws_net_paid) AS year_total, 'w' AS sale_type FROM customer, web_sales, date_dim WHERE c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year IN (1999, 1999 + 1) GROUP BY c_customer_id, c_first_name, c_last_name, d_year), year_total_store AS (SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, d_year AS year, STDDEV_SAMP(ss_net_paid) AS year_total FROM customer, store_sales, date_dim WHERE c_customer_sk = ss_customer_sk AND ss_sold_date_sk = d_date_sk AND d_year IN (1999, 1999 + 1) GROUP BY c_customer_id, c_first_name, c_last_name, d_year), year_total_web AS (SELECT c_customer_id AS customer_id, c_first_name AS customer_first_name, c_last_name AS customer_last_name, d_year AS year, STDDEV_SAMP(ws_net_paid) AS year_total FROM customer, web_sales, date_dim WHERE c_customer_sk = ws_bill_customer_sk AND ws_sold_date_sk = d_date_sk AND d_year IN (1999, 1999 + 1) GROUP BY c_customer_id, c_first_name, c_last_name, d_year)\nSELECT t_s_secyear.customer_id, t_s_secyear.customer_first_name, t_s_secyear.customer_last_name FROM year_total_store AS t_s_firstyear, year_total_store AS t_s_secyear, year_total_web AS t_w_firstyear, year_total_web AS t_w_secyear WHERE t_s_secyear.customer_id = t_s_firstyear.customer_id AND t_s_firstyear.customer_id = t_w_secyear.customer_id AND t_s_firstyear.customer_id = t_w_firstyear.customer_id AND t_s_firstyear.year = 1999 AND t_s_secyear.year = 1999 + 1 AND t_w_firstyear.year = 1999 AND t_w_secyear.year = 1999 + 1 AND t_s_firstyear.year_total > 0 AND t_w_firstyear.year_total > 0 AND CASE WHEN t_w_firstyear.year_total > 0 THEN t_w_secyear.year_total / t_w_firstyear.year_total ELSE NULL END > CASE WHEN t_s_firstyear.year_total > 0 THEN t_s_secyear.year_total / t_s_firstyear.year_total ELSE NULL END ORDER BY 2, 1, 3 LIMIT 100",
      "error": null
    },
    {
      "query_id": "q90",
      "status": "REGRESSION",
      "speedup": 0.5941,
      "original_ms": 16.21,
      "optimized_ms": 27.28,
      "original_times": [
        61.85,
        16.91,
        15.51
      ],
      "optimized_times": [
        23.77,
        27.1,
        27.46
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "early_filter"
      ],
      "original_sql": "-- start query 90 in stream 0 using template query90.tpl\nselect cast(amc as decimal(15,4))/cast(pmc as decimal(15,4)) am_pm_ratio\n from ( select count(*) amc\n       from web_sales, household_demographics , time_dim, web_page\n       where ws_sold_time_sk = time_dim.t_time_sk\n         and ws_ship_hdemo_sk = household_demographics.hd_demo_sk\n         and ws_web_page_sk = web_page.wp_web_page_sk\n         and time_dim.t_hour between 10 and 10+1\n         and household_demographics.hd_dep_count = 2\n         and web_page.wp_char_count between 5000 and 5200) at_tbl,\n      ( select count(*) pmc\n       from web_sales, household_demographics , time_dim, web_page\n       where ws_sold_time_sk = time_dim.t_time_sk\n         and ws_ship_hdemo_sk = household_demographics.hd_demo_sk\n         and ws_web_page_sk = web_page.wp_web_page_sk\n         and time_dim.t_hour between 16 and 16+1\n         and household_demographics.hd_dep_count = 2\n         and web_page.wp_char_count between 5000 and 5200) pt\n order by am_pm_ratio\n LIMIT 100;\n\n-- end query 90 in stream 0 using template query90.tpl\n",
      "optimized_sql": "WITH filtered_web_data AS (SELECT CASE WHEN t.t_hour BETWEEN 10 AND 11 THEN 1 END AS am_flag, CASE WHEN t.t_hour BETWEEN 16 AND 17 THEN 1 END AS pm_flag FROM web_sales AS ws JOIN household_demographics AS hd ON ws.ws_ship_hdemo_sk = hd.hd_demo_sk JOIN time_dim AS t ON ws.ws_sold_time_sk = t.t_time_sk JOIN web_page AS wp ON ws.ws_web_page_sk = wp.wp_web_page_sk WHERE hd.hd_dep_count = 2 AND wp.wp_char_count BETWEEN 5000 AND 5200 AND (t.t_hour BETWEEN 10 AND 11 OR t.t_hour BETWEEN 16 AND 17)), counts AS (SELECT COUNT(am_flag) AS amc, COUNT(pm_flag) AS pmc FROM filtered_web_data)\nSELECT CAST(amc AS DECIMAL(15, 4)) / CAST(pmc AS DECIMAL(15, 4)) AS am_pm_ratio FROM counts ORDER BY am_pm_ratio LIMIT 100",
      "error": null
    },
    {
      "query_id": "q95",
      "status": "REGRESSION",
      "speedup": 0.5363,
      "original_ms": 390.42,
      "optimized_ms": 728.05,
      "original_times": [
        407.7,
        388.35,
        392.5
      ],
      "optimized_times": [
        698.24,
        744.92,
        711.17
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "semantic_rewrite"
      ],
      "original_sql": "-- start query 95 in stream 0 using template query95.tpl\nwith ws_wh as\n(select ws1.ws_order_number,ws1.ws_warehouse_sk wh1,ws2.ws_warehouse_sk wh2\n from web_sales ws1,web_sales ws2\n where ws1.ws_order_number = ws2.ws_order_number\n   and ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk)\n select \n   count(distinct ws_order_number) as \"order count\"\n  ,sum(ws_ext_ship_cost) as \"total shipping cost\"\n  ,sum(ws_net_profit) as \"total net profit\"\nfrom\n   web_sales ws1\n  ,date_dim\n  ,customer_address\n  ,web_site\nwhere\n    d_date between '1999-2-01' and \n           (cast('1999-2-01' as date) + INTERVAL 60 DAY)\nand ws1.ws_ship_date_sk = d_date_sk\nand ws1.ws_ship_addr_sk = ca_address_sk\nand ca_state = 'NC'\nand ws1.ws_web_site_sk = web_site_sk\nand web_company_name = 'pri'\nand ws1.ws_order_number in (select ws_order_number\n                            from ws_wh)\nand ws1.ws_order_number in (select wr_order_number\n                            from web_returns,ws_wh\n                            where wr_order_number = ws_wh.ws_order_number)\norder by count(distinct ws_order_number)\n LIMIT 100;\n\n-- end query 95 in stream 0 using template query95.tpl\n",
      "optimized_sql": "WITH ws_wh AS (SELECT ws1.ws_order_number, ws1.ws_warehouse_sk AS wh1, ws2.ws_warehouse_sk AS wh2 FROM web_sales AS ws1, web_sales AS ws2 WHERE ws1.ws_order_number = ws2.ws_order_number AND ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk)\nSELECT COUNT(DISTINCT ws_order_number) AS \"order count\", SUM(ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws_net_profit) AS \"total net profit\" FROM web_sales AS ws1 JOIN date_dim ON ws1.ws_ship_date_sk = d_date_sk JOIN customer_address ON ws1.ws_ship_addr_sk = ca_address_sk JOIN web_site ON ws1.ws_web_site_sk = web_site_sk WHERE d_date BETWEEN '1999-2-01' AND (CAST('1999-2-01' AS DATE) + INTERVAL '60' DAY) AND ca_state = 'NC' AND web_company_name = 'pri' AND EXISTS(SELECT 1 FROM ws_wh WHERE ws_wh.ws_order_number = ws1.ws_order_number) AND EXISTS(SELECT 1 FROM web_returns JOIN ws_wh ON wr_order_number = ws_wh.ws_order_number WHERE wr_order_number = ws1.ws_order_number) ORDER BY COUNT(DISTINCT ws_order_number) LIMIT 100",
      "error": null
    },
    {
      "query_id": "q25",
      "status": "REGRESSION",
      "speedup": 0.4996,
      "original_ms": 31.06,
      "optimized_ms": 62.17,
      "original_times": [
        45.19,
        37.06,
        25.06
      ],
      "optimized_times": [
        70.36,
        60.5,
        63.85
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 25 in stream 0 using template query25.tpl\nselect \n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n ,sum(ss_net_profit) as store_sales_profit\n ,sum(sr_net_loss) as store_returns_loss\n ,sum(cs_net_profit) as catalog_sales_profit\n from\n store_sales\n ,store_returns\n ,catalog_sales\n ,date_dim d1\n ,date_dim d2\n ,date_dim d3\n ,store\n ,item\n where\n d1.d_moy = 4\n and d1.d_year = 2000\n and d1.d_date_sk = ss_sold_date_sk\n and i_item_sk = ss_item_sk\n and s_store_sk = ss_store_sk\n and ss_customer_sk = sr_customer_sk\n and ss_item_sk = sr_item_sk\n and ss_ticket_number = sr_ticket_number\n and sr_returned_date_sk = d2.d_date_sk\n and d2.d_moy               between 4 and  10\n and d2.d_year              = 2000\n and sr_customer_sk = cs_bill_customer_sk\n and sr_item_sk = cs_item_sk\n and cs_sold_date_sk = d3.d_date_sk\n and d3.d_moy               between 4 and  10 \n and d3.d_year              = 2000\n group by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n order by\n i_item_id\n ,i_item_desc\n ,s_store_id\n ,s_store_name\n LIMIT 100;\n\n-- end query 25 in stream 0 using template query25.tpl\n",
      "optimized_sql": "WITH filtered_d1 AS (SELECT d_date_sk FROM date_dim WHERE d_moy = 4 AND d_year = 2001), filtered_d2 AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 4 AND 10 AND d_year = 2001), filtered_d3 AS (SELECT d_date_sk FROM date_dim WHERE d_moy BETWEEN 4 AND 10 AND d_year = 2001), filtered_store_sales AS (SELECT ss_item_sk, ss_customer_sk, ss_ticket_number, ss_store_sk, ss_net_profit FROM store_sales JOIN filtered_d1 ON ss_sold_date_sk = d_date_sk), filtered_store_returns AS (SELECT sr_item_sk, sr_customer_sk, sr_ticket_number, sr_net_loss FROM store_returns JOIN filtered_d2 ON sr_returned_date_sk = d_date_sk), filtered_catalog_sales AS (SELECT cs_item_sk, cs_bill_customer_sk, cs_net_profit FROM catalog_sales JOIN filtered_d3 ON cs_sold_date_sk = d_date_sk)\nSELECT i_item_id, i_item_desc, s_store_id, s_store_name, SUM(ss_net_profit) AS store_sales_profit, SUM(sr_net_loss) AS store_returns_loss, SUM(cs_net_profit) AS catalog_sales_profit FROM filtered_store_sales JOIN item ON i_item_sk = ss_item_sk JOIN store ON s_store_sk = ss_store_sk JOIN filtered_store_returns ON ss_customer_sk = sr_customer_sk AND ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number JOIN filtered_catalog_sales ON sr_customer_sk = cs_bill_customer_sk AND sr_item_sk = cs_item_sk GROUP BY i_item_id, i_item_desc, s_store_id, s_store_name ORDER BY i_item_id, i_item_desc, s_store_id, s_store_name LIMIT 100",
      "error": null
    },
    {
      "query_id": "q31",
      "status": "REGRESSION",
      "speedup": 0.4936,
      "original_ms": 99.38,
      "optimized_ms": 201.32,
      "original_times": [
        125.71,
        106.43,
        92.32
      ],
      "optimized_times": [
        208.37,
        197.36,
        205.28
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "pushdown"
      ],
      "original_sql": "-- start query 31 in stream 0 using template query31.tpl\nwith ss as\n (select ca_county,d_qoy, d_year,sum(ss_ext_sales_price) as store_sales\n from store_sales,date_dim,customer_address\n where ss_sold_date_sk = d_date_sk\n  and ss_addr_sk=ca_address_sk\n group by ca_county,d_qoy, d_year),\n ws as\n (select ca_county,d_qoy, d_year,sum(ws_ext_sales_price) as web_sales\n from web_sales,date_dim,customer_address\n where ws_sold_date_sk = d_date_sk\n  and ws_bill_addr_sk=ca_address_sk\n group by ca_county,d_qoy, d_year)\n select \n        ss1.ca_county\n       ,ss1.d_year\n       ,ws2.web_sales/ws1.web_sales web_q1_q2_increase\n       ,ss2.store_sales/ss1.store_sales store_q1_q2_increase\n       ,ws3.web_sales/ws2.web_sales web_q2_q3_increase\n       ,ss3.store_sales/ss2.store_sales store_q2_q3_increase\n from\n        ss ss1\n       ,ss ss2\n       ,ss ss3\n       ,ws ws1\n       ,ws ws2\n       ,ws ws3\n where\n    ss1.d_qoy = 1\n    and ss1.d_year = 2000\n    and ss1.ca_county = ss2.ca_county\n    and ss2.d_qoy = 2\n    and ss2.d_year = 2000\n and ss2.ca_county = ss3.ca_county\n    and ss3.d_qoy = 3\n    and ss3.d_year = 2000\n    and ss1.ca_county = ws1.ca_county\n    and ws1.d_qoy = 1\n    and ws1.d_year = 2000\n    and ws1.ca_county = ws2.ca_county\n    and ws2.d_qoy = 2\n    and ws2.d_year = 2000\n    and ws1.ca_county = ws3.ca_county\n    and ws3.d_qoy = 3\n    and ws3.d_year =2000\n    and case when ws1.web_sales > 0 then ws2.web_sales/ws1.web_sales else null end \n       > case when ss1.store_sales > 0 then ss2.store_sales/ss1.store_sales else null end\n    and case when ws2.web_sales > 0 then ws3.web_sales/ws2.web_sales else null end\n       > case when ss2.store_sales > 0 then ss3.store_sales/ss2.store_sales else null end\n order by web_q1_q2_increase;\n\n-- end query 31 in stream 0 using template query31.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_qoy, d_year FROM date_dim WHERE d_year = 2000 AND d_qoy IN (1, 2, 3)), ss AS (SELECT ca_county, d_qoy, d_year, SUM(ss_ext_sales_price) AS store_sales FROM store_sales JOIN filtered_dates ON ss_sold_date_sk = d_date_sk JOIN customer_address ON ss_addr_sk = ca_address_sk GROUP BY ca_county, d_qoy, d_year), ws AS (SELECT ca_county, d_qoy, d_year, SUM(ws_ext_sales_price) AS web_sales FROM web_sales JOIN filtered_dates ON ws_sold_date_sk = d_date_sk JOIN customer_address ON ws_bill_addr_sk = ca_address_sk GROUP BY ca_county, d_qoy, d_year)\nSELECT ss1.ca_county, ss1.d_year, (ws2.web_sales * 1.0000) / NULLIF(ws1.web_sales, 0) AS web_q1_q2_increase, (ss2.store_sales * 1.0000) / NULLIF(ss1.store_sales, 0) AS store_q1_q2_increase, (ws3.web_sales * 1.0000) / NULLIF(ws2.web_sales, 0) AS web_q2_q3_increase, (ss3.store_sales * 1.0000) / NULLIF(ss2.store_sales, 0) AS store_q2_q3_increase FROM ss AS ss1 JOIN ss AS ss2 ON ss1.ca_county = ss2.ca_county AND ss2.d_qoy = 2 JOIN ss AS ss3 ON ss2.ca_county = ss3.ca_county AND ss3.d_qoy = 3 JOIN ws AS ws1 ON ss1.ca_county = ws1.ca_county AND ws1.d_qoy = 1 JOIN ws AS ws2 ON ws1.ca_county = ws2.ca_county AND ws2.d_qoy = 2 JOIN ws AS ws3 ON ws1.ca_county = ws3.ca_county AND ws3.d_qoy = 3 WHERE ss1.d_qoy = 1 AND CASE WHEN ws1.web_sales > 0 THEN (ws2.web_sales * 1.0000) / NULLIF(ws1.web_sales, 0) ELSE NULL END > CASE WHEN ss1.store_sales > 0 THEN (ss2.store_sales * 1.0000) / NULLIF(ss1.store_sales, 0) ELSE NULL END AND CASE WHEN ws2.web_sales > 0 THEN (ws3.web_sales * 1.0000) / NULLIF(ws2.web_sales, 0) ELSE NULL END > CASE WHEN ss2.store_sales > 0 THEN (ss3.store_sales * 1.0000) / NULLIF(ss2.store_sales, 0) ELSE NULL END ORDER BY ss1.ca_county",
      "error": null
    },
    {
      "query_id": "q93",
      "status": "REGRESSION",
      "speedup": 0.3397,
      "original_ms": 109.3,
      "optimized_ms": 321.73,
      "original_times": [
        108.64,
        107.46,
        111.15
      ],
      "optimized_times": [
        314.82,
        353.66,
        289.79
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "early_filter"
      ],
      "original_sql": "-- start query 93 in stream 0 using template query93.tpl\nselect ss_customer_sk\n            ,sum(act_sales) sumsales\n      from (select ss_item_sk\n                  ,ss_ticket_number\n                  ,ss_customer_sk\n                  ,case when sr_return_quantity is not null then (ss_quantity-sr_return_quantity)*ss_sales_price\n                                                            else (ss_quantity*ss_sales_price) end act_sales\n            from store_sales left outer join store_returns on (sr_item_sk = ss_item_sk\n                                                               and sr_ticket_number = ss_ticket_number)\n                ,reason\n            where sr_reason_sk = r_reason_sk\n              and r_reason_desc = 'duplicate purchase') t\n      group by ss_customer_sk\n      order by sumsales, ss_customer_sk\n LIMIT 100;\n\n-- end query 93 in stream 0 using template query93.tpl\n",
      "optimized_sql": "WITH filtered_reason AS (SELECT r_reason_sk FROM reason WHERE r_reason_desc = 'duplicate purchase'), filtered_returns AS (SELECT sr_item_sk, sr_ticket_number, sr_return_quantity FROM store_returns JOIN filtered_reason ON sr_reason_sk = r_reason_sk)\nSELECT ss_customer_sk, SUM(act_sales) AS sumsales FROM (SELECT ss.ss_customer_sk, CASE WHEN NOT fr.sr_return_quantity IS NULL THEN (ss.ss_quantity - fr.sr_return_quantity) * ss.ss_sales_price ELSE (ss.ss_quantity * ss.ss_sales_price) END AS act_sales FROM store_sales AS ss JOIN filtered_returns AS fr ON (fr.sr_item_sk = ss.ss_item_sk AND fr.sr_ticket_number = ss.ss_ticket_number)) AS t GROUP BY ss_customer_sk ORDER BY sumsales, ss_customer_sk LIMIT 100",
      "error": null
    },
    {
      "query_id": "q16",
      "status": "REGRESSION",
      "speedup": 0.1434,
      "original_ms": 18.12,
      "optimized_ms": 126.37,
      "original_times": [
        40.4,
        19.11,
        17.14
      ],
      "optimized_times": [
        162.37,
        122.17,
        130.58
      ],
      "rows_match": true,
      "source": "state_0",
      "transforms": [
        "semantic_rewrite"
      ],
      "original_sql": "-- start query 16 in stream 0 using template query16.tpl\nselect \n   count(distinct cs_order_number) as \"order count\"\n  ,sum(cs_ext_ship_cost) as \"total shipping cost\"\n  ,sum(cs_net_profit) as \"total net profit\"\nfrom\n   catalog_sales cs1\n  ,date_dim\n  ,customer_address\n  ,call_center\nwhere\n    d_date between '2002-4-01' and \n           (cast('2002-4-01' as date) + INTERVAL 60 DAY)\nand cs1.cs_ship_date_sk = d_date_sk\nand cs1.cs_ship_addr_sk = ca_address_sk\nand ca_state = 'WV'\nand cs1.cs_call_center_sk = cc_call_center_sk\nand cc_county in ('Ziebach County','Luce County','Richland County','Daviess County',\n                  'Barrow County'\n)\nand exists (select *\n            from catalog_sales cs2\n            where cs1.cs_order_number = cs2.cs_order_number\n              and cs1.cs_warehouse_sk <> cs2.cs_warehouse_sk)\nand not exists(select *\n               from catalog_returns cr1\n               where cs1.cs_order_number = cr1.cr_order_number)\norder by count(distinct cs_order_number)\n LIMIT 100;\n\n-- end query 16 in stream 0 using template query16.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2002-4-01' AND (CAST('2002-4-01' AS DATE) + INTERVAL '60' DAY)), filtered_addresses AS (SELECT ca_address_sk FROM customer_address WHERE ca_state = 'WV'), filtered_call_centers AS (SELECT cc_call_center_sk FROM call_center WHERE cc_county IN ('Ziebach County', 'Luce County', 'Richland County', 'Daviess County', 'Barrow County')), multi_warehouse_orders AS (SELECT cs_order_number FROM catalog_sales GROUP BY cs_order_number HAVING COUNT(DISTINCT cs_warehouse_sk) > 1), returned_orders AS (SELECT DISTINCT cr_order_number FROM catalog_returns), filtered_sales AS (SELECT cs.cs_order_number, cs.cs_ext_ship_cost, cs.cs_net_profit FROM catalog_sales AS cs JOIN filtered_dates AS fd ON cs.cs_ship_date_sk = fd.d_date_sk JOIN filtered_addresses AS fa ON cs.cs_ship_addr_sk = fa.ca_address_sk JOIN filtered_call_centers AS fcc ON cs.cs_call_center_sk = fcc.cc_call_center_sk JOIN multi_warehouse_orders AS mwo ON cs.cs_order_number = mwo.cs_order_number LEFT JOIN returned_orders AS ro ON cs.cs_order_number = ro.cr_order_number WHERE ro.cr_order_number IS NULL)\nSELECT COUNT(DISTINCT cs_order_number) AS \"order count\", SUM(cs_ext_ship_cost) AS \"total shipping cost\", SUM(cs_net_profit) AS \"total net profit\" FROM filtered_sales ORDER BY COUNT(DISTINCT cs_order_number) LIMIT 100",
      "error": null
    },
    {
      "query_id": "q2",
      "status": "ERROR",
      "speedup": 0,
      "original_ms": 0,
      "optimized_ms": 0,
      "original_times": [],
      "optimized_times": [],
      "rows_match": null,
      "source": "state_0",
      "transforms": [
        "pushdown"
      ],
      "original_sql": "-- start query 2 in stream 0 using template query2.tpl\nwith wscs as\n (select sold_date_sk\n        ,sales_price\n  from (select ws_sold_date_sk sold_date_sk\n              ,ws_ext_sales_price sales_price\n        from web_sales \n        union all\n        select cs_sold_date_sk sold_date_sk\n              ,cs_ext_sales_price sales_price\n        from catalog_sales)),\n wswscs as \n (select d_week_seq,\n        sum(case when (d_day_name='Sunday') then sales_price else null end) sun_sales,\n        sum(case when (d_day_name='Monday') then sales_price else null end) mon_sales,\n        sum(case when (d_day_name='Tuesday') then sales_price else  null end) tue_sales,\n        sum(case when (d_day_name='Wednesday') then sales_price else null end) wed_sales,\n        sum(case when (d_day_name='Thursday') then sales_price else null end) thu_sales,\n        sum(case when (d_day_name='Friday') then sales_price else null end) fri_sales,\n        sum(case when (d_day_name='Saturday') then sales_price else null end) sat_sales\n from wscs\n     ,date_dim\n where d_date_sk = sold_date_sk\n group by d_week_seq)\n select d_week_seq1\n       ,round(sun_sales1/sun_sales2,2)\n       ,round(mon_sales1/mon_sales2,2)\n       ,round(tue_sales1/tue_sales2,2)\n       ,round(wed_sales1/wed_sales2,2)\n       ,round(thu_sales1/thu_sales2,2)\n       ,round(fri_sales1/fri_sales2,2)\n       ,round(sat_sales1/sat_sales2,2)\n from\n (select wswscs.d_week_seq d_week_seq1\n        ,sun_sales sun_sales1\n        ,mon_sales mon_sales1\n        ,tue_sales tue_sales1\n        ,wed_sales wed_sales1\n        ,thu_sales thu_sales1\n        ,fri_sales fri_sales1\n        ,sat_sales sat_sales1\n  from wswscs,date_dim \n  where date_dim.d_week_seq = wswscs.d_week_seq and\n        d_year = 1998) y,\n (select wswscs.d_week_seq d_week_seq2\n        ,sun_sales sun_sales2\n        ,mon_sales mon_sales2\n        ,tue_sales tue_sales2\n        ,wed_sales wed_sales2\n        ,thu_sales thu_sales2\n        ,fri_sales fri_sales2\n        ,sat_sales sat_sales2\n  from wswscs\n      ,date_dim \n  where date_dim.d_week_seq = wswscs.d_week_seq and\n        d_year = 1998+1) z\n where d_week_seq1=d_week_seq2-53\n order by d_week_seq1;\n\n-- end query 2 in stream 0 using template query2.tpl\n",
      "optimized_sql": "WITH wscs AS (SELECT sold_date_sk, sales_price FROM (SELECT ws_sold_date_sk AS sold_date_sk, ws_ext_sales_price AS sales_price FROM web_sales UNION ALL SELECT cs_sold_date_sk AS sold_date_sk, cs_ext_sales_price AS sales_price FROM catalog_sales)), wswscs AS (SELECT d_week_seq, SUM(CASE WHEN (d_day_name = 'Sunday') THEN sales_price ELSE NULL END) AS sun_sales, SUM(CASE WHEN (d_day_name = 'Monday') THEN sales_price ELSE NULL END) AS mon_sales, SUM(CASE WHEN (d_day_name = 'Tuesday') THEN sales_price ELSE NULL END) AS tue_sales, SUM(CASE WHEN (d_day_name = 'Wednesday') THEN sales_price ELSE NULL END) AS wed_sales, SUM(CASE WHEN (d_day_name = 'Thursday') THEN sales_price ELSE NULL END) AS thu_sales, SUM(CASE WHEN (d_day_name = 'Friday') THEN sales_price ELSE NULL END) AS fri_sales, SUM(CASE WHEN (d_day_name = 'Saturday') THEN sales_price ELSE NULL END) AS sat_sales FROM wscs, date_dim WHERE d_date_sk = sold_date_sk AND d_year IN (1998, 1999) GROUP BY d_week_seq) SELECT d_week_seq1, ROUND(sun_sales1 / sun_sales2, 2), ROUND(mon_sales1 / mon_sales2, 2), ROUND(tue_sales1 / tue_sales2, 2), ROUND(wed_sales1 / wed_sales2, 2), ROUND(thu_sales1 / thu_sales2, 2), ROUND(fri_sales1 / fri_sales2, 2), ROUND(sat_sales1 / sat_sales2, 2) FROM (SELECT wswscs.d_week_seq AS d_week_seq1, sun_sales AS sun_sales1, mon_sales AS mon_sales1, tue_sales AS tue_sales1, wed_sales AS wed_sales1, thu_sales AS thu_sales1, fri_sales AS fri_sales1, sat_sales AS sat_sales1 FROM wswscs, date_dim WHERE date_dim.d_week_seq = wswscs.d_week_seq AND d_year = 1998) AS y, (SELECT wswscs.d_week_seq AS d_week_seq2, sun_sales AS sun_sales2, mon_sales AS mon_sales2, tue_sales AS tue_sales2, wed_sales AS wed_sales2, thu_sales AS thu_sales2, fri_sales AS fri_sales2, sat_sales AS sat_sales2 FROM wswscs, date_dim WHERE date_dim.d_week_seq = wswscs.d_week_seq AND d_year = 1998 + 1) AS z WHERE d_week_seq1 = d_week_seq2 - 53 ORDER BY d_week_seq1",
      "error": null
    },
    {
      "query_id": "q13",
      "status": "ERROR",
      "speedup": 0,
      "original_ms": 0,
      "optimized_ms": 0,
      "original_times": [],
      "optimized_times": [],
      "rows_match": null,
      "source": "state_0",
      "transforms": [
        "or_to_union"
      ],
      "original_sql": "-- start query 13 in stream 0 using template query13.tpl\nselect avg(ss_quantity)\n       ,avg(ss_ext_sales_price)\n       ,avg(ss_ext_wholesale_cost)\n       ,sum(ss_ext_wholesale_cost)\n from store_sales\n     ,store\n     ,customer_demographics\n     ,household_demographics\n     ,customer_address\n     ,date_dim\n where s_store_sk = ss_store_sk\n and  ss_sold_date_sk = d_date_sk and d_year = 2001\n and((ss_hdemo_sk=hd_demo_sk\n  and cd_demo_sk = ss_cdemo_sk\n  and cd_marital_status = 'D'\n  and cd_education_status = 'Unknown'\n  and ss_sales_price between 100.00 and 150.00\n  and hd_dep_count = 3   \n     )or\n     (ss_hdemo_sk=hd_demo_sk\n  and cd_demo_sk = ss_cdemo_sk\n  and cd_marital_status = 'S'\n  and cd_education_status = 'College'\n  and ss_sales_price between 50.00 and 100.00   \n  and hd_dep_count = 1\n     ) or \n     (ss_hdemo_sk=hd_demo_sk\n  and cd_demo_sk = ss_cdemo_sk\n  and cd_marital_status = 'M'\n  and cd_education_status = '4 yr Degree'\n  and ss_sales_price between 150.00 and 200.00 \n  and hd_dep_count = 1  \n     ))\n and((ss_addr_sk = ca_address_sk\n  and ca_country = 'United States'\n  and ca_state in ('SD', 'KS', 'MI')\n  and ss_net_profit between 100 and 200  \n     ) or\n     (ss_addr_sk = ca_address_sk\n  and ca_country = 'United States'\n  and ca_state in ('MO', 'ND', 'CO')\n  and ss_net_profit between 150 and 300  \n     ) or\n     (ss_addr_sk = ca_address_sk\n  and ca_country = 'United States'\n  and ca_state in ('NH', 'OH', 'TX')\n  and ss_net_profit between 50 and 250  \n     ))\n;\n\n-- end query 13 in stream 0 using template query13.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_year = 2001), filtered_store_sales AS (SELECT ss_store_sk, ss_hdemo_sk, ss_cdemo_sk, ss_addr_sk, ss_quantity, ss_ext_sales_price, ss_ext_wholesale_cost, ss_sales_price, ss_net_profit FROM store_sales JOIN filtered_dates ON store_sales.ss_sold_date_sk = filtered_dates.d_date_sk)\nSELECT AVG(ss_quantity) AS avg1, AVG(ss_ext_sales_price) AS avg2, AVG(ss_ext_wholesale_cost) AS avg3, SUM(ss_ext_wholesale_cost) FROM filtered_store_sales AS fss, store, customer_demographics, household_demographics, customer_address WHERE s_store_sk = fss.ss_store_sk AND ((fss.ss_hdemo_sk = hd_demo_sk AND cd_demo_sk = fss.ss_cdemo_sk AND cd_marital_status = 'M' AND cd_education_status = 'Advanced Degree' AND fss.ss_sales_price BETWEEN 100.00 AND 150.00 AND hd_dep_count = 3) OR (fss.ss_hdemo_sk = hd_demo_sk AND cd_demo_sk = fss.ss_cdemo_sk AND cd_marital_status = 'S' AND cd_education_status = 'College' AND fss.ss_sales_price BETWEEN 50.00 AND 100.00 AND hd_dep_count = 1) OR (fss.ss_hdemo_sk = hd_demo_sk AND cd_demo_sk = fss.ss_cdemo_sk AND cd_marital_status = 'W' AND cd_education_status = '2 yr Degree' AND fss.ss_sales_price BETWEEN 150.00 AND 200.00 AND hd_dep_count = 1)) AND ((fss.ss_addr_sk = ca_address_sk AND ca_country = 'United States' AND ca_state IN ('TX', 'OH', 'TX') AND fss.ss_net_profit BETWEEN 100 AND 200) OR (fss.ss_addr_sk = ca_address_sk AND ca_country = 'United States' AND ca_state IN ('OR', 'NM', 'KY') AND fss.ss_net_profit BETWEEN 150 AND 300) OR (fss.ss_addr_sk = ca_address_sk AND ca_country = 'United States' AND ca_state IN ('VA', 'TX', 'MS') AND fss.ss_net_profit BETWEEN 50 AND 250))",
      "error": null
    },
    {
      "query_id": "q18",
      "status": "ERROR",
      "speedup": 0,
      "original_ms": 0,
      "optimized_ms": 0,
      "original_times": [],
      "optimized_times": [],
      "rows_match": null,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 18 in stream 0 using template query18.tpl\nselect i_item_id,\n        ca_country,\n        ca_state, \n        ca_county,\n        avg( cast(cs_quantity as decimal(12,2))) agg1,\n        avg( cast(cs_list_price as decimal(12,2))) agg2,\n        avg( cast(cs_coupon_amt as decimal(12,2))) agg3,\n        avg( cast(cs_sales_price as decimal(12,2))) agg4,\n        avg( cast(cs_net_profit as decimal(12,2))) agg5,\n        avg( cast(c_birth_year as decimal(12,2))) agg6,\n        avg( cast(cd1.cd_dep_count as decimal(12,2))) agg7\n from catalog_sales, customer_demographics cd1, \n      customer_demographics cd2, customer, customer_address, date_dim, item\n where cs_sold_date_sk = d_date_sk and\n       cs_item_sk = i_item_sk and\n       cs_bill_cdemo_sk = cd1.cd_demo_sk and\n       cs_bill_customer_sk = c_customer_sk and\n       cd1.cd_gender = 'F' and \n       cd1.cd_education_status = 'Advanced Degree' and\n       c_current_cdemo_sk = cd2.cd_demo_sk and\n       c_current_addr_sk = ca_address_sk and\n       c_birth_month in (10,7,8,4,1,2) and\n       d_year = 1998 and\n       ca_state in ('WA','GA','NC'\n                   ,'ME','WY','OK','IN')\n group by rollup (i_item_id, ca_country, ca_state, ca_county)\n order by ca_country,\n        ca_state, \n        ca_county,\n\ti_item_id\n LIMIT 100;\n\n-- end query 18 in stream 0 using template query18.tpl\n",
      "optimized_sql": "WITH filtered_date_dim AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998), filtered_cd1 AS (SELECT cd_demo_sk, cd_dep_count FROM customer_demographics WHERE cd_gender = 'F' AND cd_education_status = 'Advanced Degree'), filtered_customer AS (SELECT c_customer_sk, c_current_cdemo_sk, c_current_addr_sk, c_birth_year FROM customer WHERE c_birth_month IN (10, 7, 8, 4, 1, 2)), filtered_customer_address AS (SELECT ca_address_sk, ca_country, ca_state, ca_county FROM customer_address WHERE ca_state IN ('WA', 'GA', 'NC', 'ME', 'WY', 'OK', 'IN'))\nSELECT i_item_id, ca_country, ca_state, ca_county, AVG(CAST(cs_quantity AS DECIMAL(12, 2))) AS agg1, AVG(CAST(cs_list_price AS DECIMAL(12, 2))) AS agg2, AVG(CAST(cs_coupon_amt AS DECIMAL(12, 2))) AS agg3, AVG(CAST(cs_sales_price AS DECIMAL(12, 2))) AS agg4, AVG(CAST(cs_net_profit AS DECIMAL(12, 2))) AS agg5, AVG(CAST(c_birth_year AS DECIMAL(12, 2))) AS agg6, AVG(CAST(cd1.cd_dep_count AS DECIMAL(12, 2))) AS agg7 FROM catalog_sales JOIN filtered_date_dim ON cs_sold_date_sk = d_date_sk JOIN item ON cs_item_sk = i_item_sk JOIN filtered_cd1 AS cd1 ON cs_bill_cdemo_sk = cd1.cd_demo_sk JOIN filtered_customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_demographics AS cd2 ON c_current_cdemo_sk = cd2.cd_demo_sk JOIN filtered_customer_address ON c_current_addr_sk = ca_address_sk GROUP BY ROLLUP (i_item_id, ca_country, ca_state, ca_county) ORDER BY ca_country, ca_state, ca_county, i_item_id LIMIT 100",
      "error": null
    },
    {
      "query_id": "q21",
      "status": "ERROR",
      "speedup": 0,
      "original_ms": 0,
      "optimized_ms": 0,
      "original_times": [],
      "optimized_times": [],
      "rows_match": null,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 21 in stream 0 using template query21.tpl\nselect *\n from(select w_warehouse_name\n            ,i_item_id\n            ,sum(case when (cast(d_date as date) < cast ('2002-02-27' as date))\n\t                then inv_quantity_on_hand \n                      else 0 end) as inv_before\n            ,sum(case when (cast(d_date as date) >= cast ('2002-02-27' as date))\n                      then inv_quantity_on_hand \n                      else 0 end) as inv_after\n   from inventory\n       ,warehouse\n       ,item\n       ,date_dim\n   where i_current_price between 0.99 and 1.49\n     and i_item_sk          = inv_item_sk\n     and inv_warehouse_sk   = w_warehouse_sk\n     and inv_date_sk    = d_date_sk\n     and d_date between (cast ('2002-02-27' as date) - INTERVAL 30 DAY)\n                    and (cast ('2002-02-27' as date) + INTERVAL 30 DAY)\n   group by w_warehouse_name, i_item_id) x\n where (case when inv_before > 0 \n             then inv_after / inv_before \n             else null\n             end) between 2.0/3.0 and 3.0/2.0\n order by w_warehouse_name\n         ,i_item_id\n LIMIT 100;\n\n-- end query 21 in stream 0 using template query21.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_date FROM date_dim WHERE d_date BETWEEN CAST('2000-02-10' AS DATE) AND CAST('2000-04-10' AS DATE)), filtered_items AS (SELECT i_item_sk, i_item_id FROM item WHERE i_current_price BETWEEN 0.99 AND 1.49)\nSELECT w_warehouse_name, i_item_id, SUM(CASE WHEN (CAST(d_date AS DATE) < CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) AS inv_before, SUM(CASE WHEN (CAST(d_date AS DATE) >= CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) AS inv_after FROM inventory JOIN filtered_dates ON inv_date_sk = d_date_sk JOIN filtered_items ON inv_item_sk = i_item_sk JOIN warehouse ON inv_warehouse_sk = w_warehouse_sk GROUP BY w_warehouse_name, i_item_id HAVING SUM(CASE WHEN (CAST(d_date AS DATE) < CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) > 0 AND (CASE WHEN SUM(CASE WHEN (CAST(d_date AS DATE) < CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) > 0 THEN (SUM(CASE WHEN (CAST(d_date AS DATE) >= CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) * 1.000) / SUM(CASE WHEN (CAST(d_date AS DATE) < CAST('2000-03-11' AS DATE)) THEN inv_quantity_on_hand ELSE 0 END) ELSE NULL END) BETWEEN 2.000 / 3.000 AND 3.000 / 2.000 ORDER BY w_warehouse_name NULLS FIRST, i_item_id NULLS FIRST LIMIT 100",
      "error": null
    },
    {
      "query_id": "q24",
      "status": "ERROR",
      "speedup": 0,
      "original_ms": 0,
      "optimized_ms": 0,
      "original_times": [],
      "optimized_times": [],
      "rows_match": null,
      "source": "state_0",
      "transforms": [
        "pushdown"
      ],
      "original_sql": "-- start query 24 in stream 0 using template query24.tpl\nwith ssales as\n(select c_last_name\n      ,c_first_name\n      ,s_store_name\n      ,ca_state\n      ,s_state\n      ,i_color\n      ,i_current_price\n      ,i_manager_id\n      ,i_units\n      ,i_size\n      ,sum(ss_net_profit) netpaid\nfrom store_sales\n    ,store_returns\n    ,store\n    ,item\n    ,customer\n    ,customer_address\nwhere ss_ticket_number = sr_ticket_number\n  and ss_item_sk = sr_item_sk\n  and ss_customer_sk = c_customer_sk\n  and ss_item_sk = i_item_sk\n  and ss_store_sk = s_store_sk\n  and c_current_addr_sk = ca_address_sk\n  and c_birth_country <> upper(ca_country)\n  and s_zip = ca_zip\nand s_market_id=8\ngroup by c_last_name\n        ,c_first_name\n        ,s_store_name\n        ,ca_state\n        ,s_state\n        ,i_color\n        ,i_current_price\n        ,i_manager_id\n        ,i_units\n        ,i_size)\nselect c_last_name\n      ,c_first_name\n      ,s_store_name\n      ,sum(netpaid) paid\nfrom ssales\nwhere i_color = 'beige'\ngroup by c_last_name\n        ,c_first_name\n        ,s_store_name\nhaving sum(netpaid) > (select 0.05*avg(netpaid)\n                                 from ssales)\norder by c_last_name\n        ,c_first_name\n        ,s_store_name\n;\nwith ssales as\n(select c_last_name\n      ,c_first_name\n      ,s_store_name\n      ,ca_state\n      ,s_state\n      ,i_color\n      ,i_current_price\n      ,i_manager_id\n      ,i_units\n      ,i_size\n      ,sum(ss_net_profit) netpaid\nfrom store_sales\n    ,store_returns\n    ,store\n    ,item\n    ,customer\n    ,customer_address\nwhere ss_ticket_number = sr_ticket_number\n  and ss_item_sk = sr_item_sk\n  and ss_customer_sk = c_customer_sk\n  and ss_item_sk = i_item_sk\n  and ss_store_sk = s_store_sk\n  and c_current_addr_sk = ca_address_sk\n  and c_birth_country <> upper(ca_country)\n  and s_zip = ca_zip\n  and s_market_id = 8\ngroup by c_last_name\n        ,c_first_name\n        ,s_store_name\n        ,ca_state\n        ,s_state\n        ,i_color\n        ,i_current_price\n        ,i_manager_id\n        ,i_units\n        ,i_size)\nselect c_last_name\n      ,c_first_name\n      ,s_store_name\n      ,sum(netpaid) paid\nfrom ssales\nwhere i_color = 'blue'\ngroup by c_last_name\n        ,c_first_name\n        ,s_store_name\nhaving sum(netpaid) > (select 0.05*avg(netpaid)\n                           from ssales)\norder by c_last_name\n        ,c_first_name\n        ,s_store_name\n;\n\n-- end query 24 in stream 0 using template query24.tpl\n",
      "optimized_sql": "-- start query 24 in stream 0 using template query24.tpl\nwith ssales as\n(select c_last_name\n      ,c_first_name\n      ,s_store_name\n      ,ca_state\n      ,s_state\n      ,i_color\n      ,i_current_price\n      ,i_manager_id\n      ,i_units\n      ,i_size\n      ,sum(ss_net_profit) netpaid\nfrom store_sales\n    ,store_returns\n    ,store\n    ,item\n    ,customer\n    ,customer_address\nwhere ss_ticket_number = sr_ticket_number\n  and ss_item_sk = sr_item_sk\n  and ss_customer_sk = c_customer_sk\n  and ss_item_sk = i_item_sk\n  and ss_store_sk = s_store_sk\n  and c_current_addr_sk = ca_address_sk\n  and c_birth_country <> upper(ca_country)\n  and s_zip = ca_zip\nand s_market_id=8\ngroup by c_last_name\n        ,c_first_name\n        ,s_store_name\n        ,ca_state\n        ,s_state\n        ,i_color\n        ,i_current_price\n        ,i_manager_id\n        ,i_units\n        ,i_size)\nselect c_last_name\n      ,c_first_name\n      ,s_store_name\n      ,sum(netpaid) paid\nfrom ssales\nwhere i_color = 'beige'\ngroup by c_last_name\n        ,c_first_name\n        ,s_store_name\nhaving sum(netpaid) > (select 0.05*avg(netpaid)\n                                 from ssales)\norder by c_last_name\n        ,c_first_name\n        ,s_store_name\n;\nwith ssales as\n(select c_last_name\n      ,c_first_name\n      ,s_store_name\n      ,ca_state\n      ,s_state\n      ,i_color\n      ,i_current_price\n      ,i_manager_id\n      ,i_units\n      ,i_size\n      ,sum(ss_net_profit) netpaid\nfrom store_sales\n    ,store_returns\n    ,store\n    ,item\n    ,customer\n    ,customer_address\nwhere ss_ticket_number = sr_ticket_number\n  and ss_item_sk = sr_item_sk\n  and ss_customer_sk = c_customer_sk\n  and ss_item_sk = i_item_sk\n  and ss_store_sk = s_store_sk\n  and c_current_addr_sk = ca_address_sk\n  and c_birth_country <> upper(ca_country)\n  and s_zip = ca_zip\n  and s_market_id = 8\ngroup by c_last_name\n        ,c_first_name\n        ,s_store_name\n        ,ca_state\n        ,s_state\n        ,i_color\n        ,i_current_price\n        ,i_manager_id\n        ,i_units\n        ,i_size)\nselect c_last_name\n      ,c_first_name\n      ,s_store_name\n      ,sum(netpaid) paid\nfrom ssales\nwhere i_color = 'blue'\ngroup by c_last_name\n        ,c_first_name\n        ,s_store_name\nhaving sum(netpaid) > (select 0.05*avg(netpaid)\n                           from ssales)\norder by c_last_name\n        ,c_first_name\n        ,s_store_name\n;\n\n-- end query 24 in stream 0 using template query24.tpl\n",
      "error": null
    },
    {
      "query_id": "q52",
      "status": "ERROR",
      "speedup": 0,
      "original_ms": 0,
      "optimized_ms": 0,
      "original_times": [],
      "optimized_times": [],
      "rows_match": null,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 52 in stream 0 using template query52.tpl\nselect dt.d_year\n \t,item.i_brand_id brand_id\n \t,item.i_brand brand\n \t,sum(ss_ext_sales_price) ext_price\n from date_dim dt\n     ,store_sales\n     ,item\n where dt.d_date_sk = store_sales.ss_sold_date_sk\n    and store_sales.ss_item_sk = item.i_item_sk\n    and item.i_manager_id = 1\n    and dt.d_moy=12\n    and dt.d_year=2002\n group by dt.d_year\n \t,item.i_brand\n \t,item.i_brand_id\n order by dt.d_year\n \t,ext_price desc\n \t,brand_id\n LIMIT 100;\n\n-- end query 52 in stream 0 using template query52.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk, d_year FROM date_dim WHERE d_moy = 11 AND d_year = 2000), filtered_items AS (SELECT i_item_sk, i_brand_id, i_brand FROM item WHERE i_manager_id = 1), joined_facts AS (SELECT ss_ext_sales_price, fd.d_year, fi.i_brand_id, fi.i_brand FROM store_sales AS ss JOIN filtered_dates AS fd ON ss.ss_sold_date_sk = fd.d_date_sk JOIN filtered_items AS fi ON ss.ss_item_sk = fi.i_item_sk)\nSELECT d_year, i_brand_id AS brand_id, i_brand AS brand, SUM(ss_ext_sales_price) AS ext_price FROM joined_facts GROUP BY d_year, i_brand, i_brand_id ORDER BY d_year, ext_price DESC, brand_id LIMIT 100",
      "error": null
    },
    {
      "query_id": "q54",
      "status": "ERROR",
      "speedup": 0,
      "original_ms": 0,
      "optimized_ms": 0,
      "original_times": [],
      "optimized_times": [],
      "rows_match": null,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 54 in stream 0 using template query54.tpl\nwith my_customers as (\n select distinct c_customer_sk\n        , c_current_addr_sk\n from   \n        ( select cs_sold_date_sk sold_date_sk,\n                 cs_bill_customer_sk customer_sk,\n                 cs_item_sk item_sk\n          from   catalog_sales\n          union all\n          select ws_sold_date_sk sold_date_sk,\n                 ws_bill_customer_sk customer_sk,\n                 ws_item_sk item_sk\n          from   web_sales\n         ) cs_or_ws_sales,\n         item,\n         date_dim,\n         customer\n where   sold_date_sk = d_date_sk\n         and item_sk = i_item_sk\n         and i_category = 'Women'\n         and i_class = 'maternity'\n         and c_customer_sk = cs_or_ws_sales.customer_sk\n         and d_moy = 5\n         and d_year = 1998\n )\n , my_revenue as (\n select c_customer_sk,\n        sum(ss_ext_sales_price) as revenue\n from   my_customers,\n        store_sales,\n        customer_address,\n        store,\n        date_dim\n where  c_current_addr_sk = ca_address_sk\n        and ca_county = s_county\n        and ca_state = s_state\n        and ss_sold_date_sk = d_date_sk\n        and c_customer_sk = ss_customer_sk\n        and d_month_seq between (select distinct d_month_seq+1\n                                 from   date_dim where d_year = 1998 and d_moy = 5)\n                           and  (select distinct d_month_seq+3\n                                 from   date_dim where d_year = 1998 and d_moy = 5)\n group by c_customer_sk\n )\n , segments as\n (select cast((revenue/50) as int) as segment\n  from   my_revenue\n )\n  select segment, count(*) as num_customers, segment*50 as segment_base\n from segments\n group by segment\n order by segment, num_customers\n LIMIT 100;\n\n-- end query 54 in stream 0 using template query54.tpl\n",
      "optimized_sql": "WITH filtered_dates_my_customers AS (SELECT d_date_sk FROM date_dim WHERE d_moy = 12 AND d_year = 1998), filtered_items AS (SELECT i_item_sk FROM item WHERE i_category = 'Women' AND i_class = 'maternity'), cs_sales_filtered AS (SELECT cs_sold_date_sk, cs_bill_customer_sk FROM catalog_sales JOIN filtered_dates_my_customers ON catalog_sales.cs_sold_date_sk = filtered_dates_my_customers.d_date_sk JOIN filtered_items ON catalog_sales.cs_item_sk = filtered_items.i_item_sk), ws_sales_filtered AS (SELECT ws_sold_date_sk, ws_bill_customer_sk FROM web_sales JOIN filtered_dates_my_customers ON web_sales.ws_sold_date_sk = filtered_dates_my_customers.d_date_sk JOIN filtered_items ON web_sales.ws_item_sk = filtered_items.i_item_sk), cs_or_ws_sales_union AS (SELECT cs_bill_customer_sk AS customer_sk FROM cs_sales_filtered UNION ALL SELECT ws_bill_customer_sk AS customer_sk FROM ws_sales_filtered), my_customers AS (SELECT DISTINCT c_customer_sk, c_current_addr_sk FROM cs_or_ws_sales_union, customer WHERE c_customer_sk = cs_or_ws_sales_union.customer_sk), base_month_seq AS (SELECT DISTINCT d_month_seq FROM date_dim WHERE d_year = 1998 AND d_moy = 12), date_range_dates AS (SELECT d_date_sk FROM date_dim, base_month_seq WHERE d_month_seq BETWEEN base_month_seq.d_month_seq + 1 AND base_month_seq.d_month_seq + 3), filtered_store_sales AS (SELECT ss_customer_sk, ss_ext_sales_price FROM store_sales JOIN date_range_dates ON store_sales.ss_sold_date_sk = date_range_dates.d_date_sk), my_revenue AS (SELECT c_customer_sk, SUM(ss_ext_sales_price) AS revenue FROM my_customers, filtered_store_sales, customer_address, store WHERE my_customers.c_current_addr_sk = ca_address_sk AND ca_county = s_county AND ca_state = s_state AND my_customers.c_customer_sk = filtered_store_sales.ss_customer_sk GROUP BY c_customer_sk), segments AS (SELECT CAST(ROUND(revenue / 50) AS INT) AS SEGMENT FROM my_revenue)\nSELECT SEGMENT, COUNT(*) AS num_customers, SEGMENT * 50 AS segment_base FROM segments GROUP BY SEGMENT ORDER BY SEGMENT NULLS FIRST, num_customers NULLS FIRST, segment_base LIMIT 100",
      "error": null
    },
    {
      "query_id": "q60",
      "status": "ERROR",
      "speedup": 0,
      "original_ms": 0,
      "optimized_ms": 0,
      "original_times": [],
      "optimized_times": [],
      "rows_match": null,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 60 in stream 0 using template query60.tpl\nwith ss as (\n select\n          i_item_id,sum(ss_ext_sales_price) total_sales\n from\n \tstore_sales,\n \tdate_dim,\n         customer_address,\n         item\n where\n         i_item_id in (select\n  i_item_id\nfrom\n item\nwhere i_category in ('Children'))\n and     ss_item_sk              = i_item_sk\n and     ss_sold_date_sk         = d_date_sk\n and     d_year                  = 2000\n and     d_moy                   = 8\n and     ss_addr_sk              = ca_address_sk\n and     ca_gmt_offset           = -7 \n group by i_item_id),\n cs as (\n select\n          i_item_id,sum(cs_ext_sales_price) total_sales\n from\n \tcatalog_sales,\n \tdate_dim,\n         customer_address,\n         item\n where\n         i_item_id               in (select\n  i_item_id\nfrom\n item\nwhere i_category in ('Children'))\n and     cs_item_sk              = i_item_sk\n and     cs_sold_date_sk         = d_date_sk\n and     d_year                  = 2000\n and     d_moy                   = 8\n and     cs_bill_addr_sk         = ca_address_sk\n and     ca_gmt_offset           = -7 \n group by i_item_id),\n ws as (\n select\n          i_item_id,sum(ws_ext_sales_price) total_sales\n from\n \tweb_sales,\n \tdate_dim,\n         customer_address,\n         item\n where\n         i_item_id               in (select\n  i_item_id\nfrom\n item\nwhere i_category in ('Children'))\n and     ws_item_sk              = i_item_sk\n and     ws_sold_date_sk         = d_date_sk\n and     d_year                  = 2000\n and     d_moy                   = 8\n and     ws_bill_addr_sk         = ca_address_sk\n and     ca_gmt_offset           = -7\n group by i_item_id)\n  select  \n  i_item_id\n,sum(total_sales) total_sales\n from  (select * from ss \n        union all\n        select * from cs \n        union all\n        select * from ws) tmp1\n group by i_item_id\n order by i_item_id\n      ,total_sales\n LIMIT 100;\n\n-- end query 60 in stream 0 using template query60.tpl\n",
      "optimized_sql": "WITH date_filtered AS (SELECT d_date_sk FROM date_dim WHERE d_year = 1998 AND d_moy = 9), address_filtered AS (SELECT ca_address_sk FROM customer_address WHERE ca_gmt_offset = -5), music_items AS (SELECT i_item_id, i_item_sk FROM item WHERE i_category = 'Music'), ss AS (SELECT i.i_item_id, SUM(ss_ext_sales_price) AS total_sales FROM store_sales AS ss JOIN music_items AS i ON ss.ss_item_sk = i.i_item_sk JOIN date_filtered AS d ON ss.ss_sold_date_sk = d.d_date_sk JOIN address_filtered AS a ON ss.ss_addr_sk = a.ca_address_sk GROUP BY i.i_item_id), ws AS (SELECT i.i_item_id, SUM(ws_ext_sales_price) AS total_sales FROM web_sales AS ws JOIN music_items AS i ON ws.ws_item_sk = i.i_item_sk JOIN date_filtered AS d ON ws.ws_sold_date_sk = d.d_date_sk JOIN address_filtered AS a ON ws.ws_bill_addr_sk = a.ca_address_sk GROUP BY i.i_item_id), cs AS (SELECT i.i_item_id, SUM(cs_ext_sales_price) AS total_sales FROM catalog_sales AS cs JOIN music_items AS i ON cs.cs_item_sk = i.i_item_sk JOIN date_filtered AS d ON cs.cs_sold_date_sk = d.d_date_sk JOIN address_filtered AS a ON cs.cs_bill_addr_sk = a.ca_address_sk GROUP BY i.i_item_id)\nSELECT i_item_id, SUM(total_sales) AS total_sales FROM (SELECT * FROM ss UNION ALL SELECT * FROM cs UNION ALL SELECT * FROM ws) AS tmp1 GROUP BY i_item_id ORDER BY i_item_id, total_sales LIMIT 100",
      "error": null
    },
    {
      "query_id": "q64",
      "status": "ERROR",
      "speedup": 0,
      "original_ms": 0,
      "optimized_ms": 0,
      "original_times": [],
      "optimized_times": [],
      "rows_match": null,
      "source": "state_0",
      "transforms": [
        "pushdown"
      ],
      "original_sql": "-- start query 64 in stream 0 using template query64.tpl\nwith cs_ui as\n (select cs_item_sk\n        ,sum(cs_ext_list_price) as sale,sum(cr_refunded_cash+cr_reversed_charge+cr_store_credit) as refund\n  from catalog_sales\n      ,catalog_returns\n  where cs_item_sk = cr_item_sk\n    and cs_order_number = cr_order_number\n  group by cs_item_sk\n  having sum(cs_ext_list_price)>2*sum(cr_refunded_cash+cr_reversed_charge+cr_store_credit)),\ncross_sales as\n (select i_product_name product_name\n     ,i_item_sk item_sk\n     ,s_store_name store_name\n     ,s_zip store_zip\n     ,ad1.ca_street_number b_street_number\n     ,ad1.ca_street_name b_street_name\n     ,ad1.ca_city b_city\n     ,ad1.ca_zip b_zip\n     ,ad2.ca_street_number c_street_number\n     ,ad2.ca_street_name c_street_name\n     ,ad2.ca_city c_city\n     ,ad2.ca_zip c_zip\n     ,d1.d_year as syear\n     ,d2.d_year as fsyear\n     ,d3.d_year s2year\n     ,count(*) cnt\n     ,sum(ss_wholesale_cost) s1\n     ,sum(ss_list_price) s2\n     ,sum(ss_coupon_amt) s3\n  FROM   store_sales\n        ,store_returns\n        ,cs_ui\n        ,date_dim d1\n        ,date_dim d2\n        ,date_dim d3\n        ,store\n        ,customer\n        ,customer_demographics cd1\n        ,customer_demographics cd2\n        ,promotion\n        ,household_demographics hd1\n        ,household_demographics hd2\n        ,customer_address ad1\n        ,customer_address ad2\n        ,income_band ib1\n        ,income_band ib2\n        ,item\n  WHERE  ss_store_sk = s_store_sk AND\n         ss_sold_date_sk = d1.d_date_sk AND\n         ss_customer_sk = c_customer_sk AND\n         ss_cdemo_sk= cd1.cd_demo_sk AND\n         ss_hdemo_sk = hd1.hd_demo_sk AND\n         ss_addr_sk = ad1.ca_address_sk and\n         ss_item_sk = i_item_sk and\n         ss_item_sk = sr_item_sk and\n         ss_ticket_number = sr_ticket_number and\n         ss_item_sk = cs_ui.cs_item_sk and\n         c_current_cdemo_sk = cd2.cd_demo_sk AND\n         c_current_hdemo_sk = hd2.hd_demo_sk AND\n         c_current_addr_sk = ad2.ca_address_sk and\n         c_first_sales_date_sk = d2.d_date_sk and\n         c_first_shipto_date_sk = d3.d_date_sk and\n         ss_promo_sk = p_promo_sk and\n         hd1.hd_income_band_sk = ib1.ib_income_band_sk and\n         hd2.hd_income_band_sk = ib2.ib_income_band_sk and\n         cd1.cd_marital_status <> cd2.cd_marital_status and\n         i_color in ('blanched','medium','brown','chocolate','burlywood','drab') and\n         i_current_price between 23 and 23 + 10 and\n         i_current_price between 23 + 1 and 23 + 15\ngroup by i_product_name\n       ,i_item_sk\n       ,s_store_name\n       ,s_zip\n       ,ad1.ca_street_number\n       ,ad1.ca_street_name\n       ,ad1.ca_city\n       ,ad1.ca_zip\n       ,ad2.ca_street_number\n       ,ad2.ca_street_name\n       ,ad2.ca_city\n       ,ad2.ca_zip\n       ,d1.d_year\n       ,d2.d_year\n       ,d3.d_year\n)\nselect cs1.product_name\n     ,cs1.store_name\n     ,cs1.store_zip\n     ,cs1.b_street_number\n     ,cs1.b_street_name\n     ,cs1.b_city\n     ,cs1.b_zip\n     ,cs1.c_street_number\n     ,cs1.c_street_name\n     ,cs1.c_city\n     ,cs1.c_zip\n     ,cs1.syear\n     ,cs1.cnt\n     ,cs1.s1 as s11\n     ,cs1.s2 as s21\n     ,cs1.s3 as s31\n     ,cs2.s1 as s12\n     ,cs2.s2 as s22\n     ,cs2.s3 as s32\n     ,cs2.syear\n     ,cs2.cnt\nfrom cross_sales cs1,cross_sales cs2\nwhere cs1.item_sk=cs2.item_sk and\n     cs1.syear = 2001 and\n     cs2.syear = 2001 + 1 and\n     cs2.cnt <= cs1.cnt and\n     cs1.store_name = cs2.store_name and\n     cs1.store_zip = cs2.store_zip\norder by cs1.product_name\n       ,cs1.store_name\n       ,cs2.cnt\n       ,cs1.s1\n       ,cs2.s1;\n\n-- end query 64 in stream 0 using template query64.tpl\n",
      "optimized_sql": "WITH filtered_d1 AS (SELECT d_date_sk, d_year FROM date_dim WHERE d_year IN (1999, 2000)), filtered_items AS (SELECT i_item_sk, i_product_name, i_current_price FROM item WHERE i_color IN ('purple', 'burlywood', 'indian', 'spring', 'floral', 'medium') AND i_current_price BETWEEN 64 AND 74 AND i_current_price BETWEEN 65 AND 79), cs_ui_optimized AS (SELECT cs_item_sk, SUM(cs_ext_list_price) AS sale, SUM(cr_refunded_cash + cr_reversed_charge + cr_store_credit) AS refund FROM catalog_sales JOIN catalog_returns ON cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number GROUP BY cs_item_sk HAVING SUM(cs_ext_list_price) > 2 * SUM(cr_refunded_cash + cr_reversed_charge + cr_store_credit)), filtered_customer_demographics AS (SELECT cd_demo_sk FROM customer_demographics), filtered_household_demographics AS (SELECT hd_demo_sk, hd_income_band_sk FROM household_demographics), filtered_promotion AS (SELECT p_promo_sk FROM promotion), filtered_income_band AS (SELECT ib_income_band_sk FROM income_band), cross_sales_optimized AS (SELECT i_product_name AS product_name, i_item_sk AS item_sk, s_store_name AS store_name, s_zip AS store_zip, ad1.ca_street_number AS b_street_number, ad1.ca_street_name AS b_street_name, ad1.ca_city AS b_city, ad1.ca_zip AS b_zip, ad2.ca_street_number AS c_street_number, ad2.ca_street_name AS c_street_name, ad2.ca_city AS c_city, ad2.ca_zip AS c_zip, d1.d_year AS syear, d2.d_year AS fsyear, d3.d_year AS s2year, COUNT(*) AS cnt, SUM(ss_wholesale_cost) AS s1, SUM(ss_list_price) AS s2, SUM(ss_coupon_amt) AS s3 FROM store_sales JOIN filtered_d1 AS d1 ON ss_sold_date_sk = d1.d_date_sk JOIN store ON ss_store_sk = s_store_sk JOIN filtered_items ON ss_item_sk = i_item_sk JOIN store_returns ON ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number JOIN cs_ui_optimized ON ss_item_sk = cs_ui_optimized.cs_item_sk JOIN customer ON ss_customer_sk = c_customer_sk JOIN customer_demographics AS cd1 ON ss_cdemo_sk = cd1.cd_demo_sk JOIN customer_demographics AS cd2 ON c_current_cdemo_sk = cd2.cd_demo_sk JOIN household_demographics AS hd1 ON ss_hdemo_sk = hd1.hd_demo_sk JOIN household_demographics AS hd2 ON c_current_hdemo_sk = hd2.hd_demo_sk JOIN customer_address AS ad1 ON ss_addr_sk = ad1.ca_address_sk JOIN customer_address AS ad2 ON c_current_addr_sk = ad2.ca_address_sk JOIN date_dim AS d2 ON c_first_sales_date_sk = d2.d_date_sk JOIN date_dim AS d3 ON c_first_shipto_date_sk = d3.d_date_sk JOIN filtered_promotion ON ss_promo_sk = p_promo_sk JOIN filtered_income_band AS ib1 ON hd1.hd_income_band_sk = ib1.ib_income_band_sk JOIN filtered_income_band AS ib2 ON hd2.hd_income_band_sk = ib2.ib_income_band_sk WHERE cd1.cd_marital_status <> cd2.cd_marital_status GROUP BY i_product_name, i_item_sk, s_store_name, s_zip, ad1.ca_street_number, ad1.ca_street_name, ad1.ca_city, ad1.ca_zip, ad2.ca_street_number, ad2.ca_street_name, ad2.ca_city, ad2.ca_zip, d1.d_year, d2.d_year, d3.d_year), cs_ui AS (SELECT cs_item_sk, SUM(cs_ext_list_price) AS sale, SUM(cr_refunded_cash + cr_reversed_charge + cr_store_credit) AS refund FROM catalog_sales, catalog_returns WHERE cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number GROUP BY cs_item_sk HAVING SUM(cs_ext_list_price) > 2 * SUM(cr_refunded_cash + cr_reversed_charge + cr_store_credit)), cross_sales AS (SELECT i_product_name AS product_name, i_item_sk AS item_sk, s_store_name AS store_name, s_zip AS store_zip, ad1.ca_street_number AS b_street_number, ad1.ca_street_name AS b_street_name, ad1.ca_city AS b_city, ad1.ca_zip AS b_zip, ad2.ca_street_number AS c_street_number, ad2.ca_street_name AS c_street_name, ad2.ca_city AS c_city, ad2.ca_zip AS c_zip, d1.d_year AS syear, d2.d_year AS fsyear, d3.d_year AS s2year, COUNT(*) AS cnt, SUM(ss_wholesale_cost) AS s1, SUM(ss_list_price) AS s2, SUM(ss_coupon_amt) AS s3 FROM store_sales, store_returns, cs_ui, date_dim AS d1, date_dim AS d2, date_dim AS d3, store, customer, customer_demographics AS cd1, customer_demographics AS cd2, promotion, household_demographics AS hd1, household_demographics AS hd2, customer_address AS ad1, customer_address AS ad2, income_band AS ib1, income_band AS ib2, item WHERE ss_store_sk = s_store_sk AND ss_sold_date_sk = d1.d_date_sk AND ss_customer_sk = c_customer_sk AND ss_cdemo_sk = cd1.cd_demo_sk AND ss_hdemo_sk = hd1.hd_demo_sk AND ss_addr_sk = ad1.ca_address_sk AND ss_item_sk = i_item_sk AND ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number AND ss_item_sk = cs_ui.cs_item_sk AND c_current_cdemo_sk = cd2.cd_demo_sk AND c_current_hdemo_sk = hd2.hd_demo_sk AND c_current_addr_sk = ad2.ca_address_sk AND c_first_sales_date_sk = d2.d_date_sk AND c_first_shipto_date_sk = d3.d_date_sk AND ss_promo_sk = p_promo_sk AND hd1.hd_income_band_sk = ib1.ib_income_band_sk AND hd2.hd_income_band_sk = ib2.ib_income_band_sk AND cd1.cd_marital_status <> cd2.cd_marital_status AND i_color IN ('purple', 'burlywood', 'indian', 'spring', 'floral', 'medium') AND i_current_price BETWEEN 64 AND 64 + 10 AND i_current_price BETWEEN 64 + 1 AND 64 + 15 GROUP BY i_product_name, i_item_sk, s_store_name, s_zip, ad1.ca_street_number, ad1.ca_street_name, ad1.ca_city, ad1.ca_zip, ad2.ca_street_number, ad2.ca_street_name, ad2.ca_city, ad2.ca_zip, d1.d_year, d2.d_year, d3.d_year)\nSELECT cs1.product_name, cs1.store_name, cs1.store_zip, cs1.b_street_number, cs1.b_street_name, cs1.b_city, cs1.b_zip, cs1.c_street_number, cs1.c_street_name, cs1.c_city, cs1.c_zip, cs1.syear AS cs1syear, cs1.cnt AS cs1cnt, cs1.s1 AS s11, cs1.s2 AS s21, cs1.s3 AS s31, cs2.s1 AS s12, cs2.s2 AS s22, cs2.s3 AS s32, cs2.syear, cs2.cnt FROM cross_sales AS cs1, cross_sales AS cs2 WHERE cs1.item_sk = cs2.item_sk AND cs1.syear = 1999 AND cs2.syear = 1999 + 1 AND cs2.cnt <= cs1.cnt AND cs1.store_name = cs2.store_name AND cs1.store_zip = cs2.store_zip ORDER BY cs1.product_name, cs1.store_name, cs2.cnt, cs1.s1, cs2.s1",
      "error": null
    },
    {
      "query_id": "q76",
      "status": "ERROR",
      "speedup": 0,
      "original_ms": 0,
      "optimized_ms": 0,
      "original_times": [],
      "optimized_times": [],
      "rows_match": null,
      "source": "state_0",
      "transforms": [
        "pushdown"
      ],
      "original_sql": "-- start query 76 in stream 0 using template query76.tpl\nselect channel, col_name, d_year, d_qoy, i_category, COUNT(*) sales_cnt, SUM(ext_sales_price) sales_amt FROM (\n        SELECT 'store' as channel, 'ss_hdemo_sk' col_name, d_year, d_qoy, i_category, ss_ext_sales_price ext_sales_price\n         FROM store_sales, item, date_dim\n         WHERE ss_hdemo_sk IS NULL\n           AND ss_sold_date_sk=d_date_sk\n           AND ss_item_sk=i_item_sk\n        UNION ALL\n        SELECT 'web' as channel, 'ws_bill_addr_sk' col_name, d_year, d_qoy, i_category, ws_ext_sales_price ext_sales_price\n         FROM web_sales, item, date_dim\n         WHERE ws_bill_addr_sk IS NULL\n           AND ws_sold_date_sk=d_date_sk\n           AND ws_item_sk=i_item_sk\n        UNION ALL\n        SELECT 'catalog' as channel, 'cs_warehouse_sk' col_name, d_year, d_qoy, i_category, cs_ext_sales_price ext_sales_price\n         FROM catalog_sales, item, date_dim\n         WHERE cs_warehouse_sk IS NULL\n           AND cs_sold_date_sk=d_date_sk\n           AND cs_item_sk=i_item_sk) foo\nGROUP BY channel, col_name, d_year, d_qoy, i_category\nORDER BY channel, col_name, d_year, d_qoy, i_category\n LIMIT 100;\n\n-- end query 76 in stream 0 using template query76.tpl\n",
      "optimized_sql": "WITH store_sales_agg AS (SELECT 'store' AS channel, 'ss_hdemo_sk' AS col_name, d_year, d_qoy, i_category, COUNT(*) AS sales_cnt, SUM(ss_ext_sales_price) AS sales_amt FROM store_sales, item, date_dim WHERE ss_hdemo_sk IS NULL AND ss_sold_date_sk = d_date_sk AND ss_item_sk = i_item_sk GROUP BY d_year, d_qoy, i_category), web_sales_agg AS (SELECT 'web' AS channel, 'ws_bill_addr_sk' AS col_name, d_year, d_qoy, i_category, COUNT(*) AS sales_cnt, SUM(ws_ext_sales_price) AS sales_amt FROM web_sales, item, date_dim WHERE ws_bill_addr_sk IS NULL AND ws_sold_date_sk = d_date_sk AND ws_item_sk = i_item_sk GROUP BY d_year, d_qoy, i_category), catalog_sales_agg AS (SELECT 'catalog' AS channel, 'cs_warehouse_sk' AS col_name, d_year, d_qoy, i_category, COUNT(*) AS sales_cnt, SUM(cs_ext_sales_price) AS sales_amt FROM catalog_sales, item, date_dim WHERE cs_warehouse_sk IS NULL AND cs_sold_date_sk = d_date_sk AND cs_item_sk = i_item_sk GROUP BY d_year, d_qoy, i_category)\nSELECT channel, col_name, d_year, d_qoy, i_category, sales_cnt, sales_amt FROM store_sales_agg UNION ALL SELECT channel, col_name, d_year, d_qoy, i_category, sales_cnt, sales_amt FROM web_sales_agg UNION ALL SELECT channel, col_name, d_year, d_qoy, i_category, sales_cnt, sales_amt FROM catalog_sales_agg ORDER BY channel, col_name, d_year, d_qoy, i_category LIMIT 100",
      "error": null
    },
    {
      "query_id": "q82",
      "status": "ERROR",
      "speedup": 0,
      "original_ms": 0,
      "optimized_ms": 0,
      "original_times": [],
      "optimized_times": [],
      "rows_match": null,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 82 in stream 0 using template query82.tpl\nselect i_item_id\n       ,i_item_desc\n       ,i_current_price\n from item, inventory, date_dim, store_sales\n where i_current_price between 17 and 17+30\n and inv_item_sk = i_item_sk\n and d_date_sk=inv_date_sk\n and d_date between cast('1999-07-09' as date) and (cast('1999-07-09' as date) + INTERVAL 60 DAY)\n and i_manufact_id in (639,169,138,339)\n and inv_quantity_on_hand between 100 and 500\n and ss_item_sk = i_item_sk\n group by i_item_id,i_item_desc,i_current_price\n order by i_item_id\n LIMIT 100;\n\n-- end query 82 in stream 0 using template query82.tpl\n",
      "optimized_sql": "WITH filtered_item AS (SELECT i_item_sk, i_item_id, i_item_desc, i_current_price FROM item WHERE i_current_price BETWEEN 17 AND 17 + 30 AND i_manufact_id IN (639, 169, 138, 339)), filtered_inventory AS (SELECT inv_item_sk, inv_date_sk FROM inventory WHERE inv_quantity_on_hand BETWEEN 100 AND 500), filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN CAST('1999-07-09' AS DATE) AND (CAST('1999-07-09' AS DATE) + INTERVAL '60' DAY)), filtered_sales AS (SELECT ss_item_sk FROM store_sales)\nSELECT i.i_item_id, i.i_item_desc, i.i_current_price FROM filtered_item AS i JOIN filtered_inventory AS inv ON i.i_item_sk = inv.inv_item_sk JOIN filtered_dates AS d ON inv.inv_date_sk = d.d_date_sk JOIN filtered_sales AS ss ON i.i_item_sk = ss.ss_item_sk GROUP BY i.i_item_id, i.i_item_desc, i.i_current_price ORDER BY i.i_item_id LIMIT 100",
      "error": null
    },
    {
      "query_id": "q94",
      "status": "ERROR",
      "speedup": 0,
      "original_ms": 0,
      "optimized_ms": 0,
      "original_times": [],
      "optimized_times": [],
      "rows_match": null,
      "source": "state_0",
      "transforms": [
        "date_cte_isolate"
      ],
      "original_sql": "-- start query 94 in stream 0 using template query94.tpl\nselect \n   count(distinct ws_order_number) as \"order count\"\n  ,sum(ws_ext_ship_cost) as \"total shipping cost\"\n  ,sum(ws_net_profit) as \"total net profit\"\nfrom\n   web_sales ws1\n  ,date_dim\n  ,customer_address\n  ,web_site\nwhere\n    d_date between '2000-2-01' and \n           (cast('2000-2-01' as date) + INTERVAL 60 DAY)\nand ws1.ws_ship_date_sk = d_date_sk\nand ws1.ws_ship_addr_sk = ca_address_sk\nand ca_state = 'OK'\nand ws1.ws_web_site_sk = web_site_sk\nand web_company_name = 'pri'\nand exists (select *\n            from web_sales ws2\n            where ws1.ws_order_number = ws2.ws_order_number\n              and ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk)\nand not exists(select *\n               from web_returns wr1\n               where ws1.ws_order_number = wr1.wr_order_number)\norder by count(distinct ws_order_number)\n LIMIT 100;\n\n-- end query 94 in stream 0 using template query94.tpl\n",
      "optimized_sql": "WITH filtered_dates AS (SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN '2000-2-01' AND (CAST('2000-2-01' AS DATE) + INTERVAL '60' DAY)), filtered_addresses AS (SELECT ca_address_sk FROM customer_address WHERE ca_state = 'OK'), filtered_sites AS (SELECT web_site_sk FROM web_site WHERE web_company_name = 'pri'), multi_warehouse_orders AS (SELECT ws_order_number FROM web_sales GROUP BY ws_order_number HAVING COUNT(DISTINCT ws_warehouse_sk) > 1), orders_with_returns AS (SELECT DISTINCT wr_order_number FROM web_returns)\nSELECT COUNT(DISTINCT ws1.ws_order_number) AS \"order count\", SUM(ws1.ws_ext_ship_cost) AS \"total shipping cost\", SUM(ws1.ws_net_profit) AS \"total net profit\" FROM web_sales AS ws1 JOIN filtered_dates ON ws1.ws_ship_date_sk = filtered_dates.d_date_sk JOIN filtered_addresses ON ws1.ws_ship_addr_sk = filtered_addresses.ca_address_sk JOIN filtered_sites ON ws1.ws_web_site_sk = filtered_sites.web_site_sk JOIN multi_warehouse_orders AS mwo ON ws1.ws_order_number = mwo.ws_order_number LEFT JOIN orders_with_returns AS owr ON ws1.ws_order_number = owr.wr_order_number WHERE owr.wr_order_number IS NULL ORDER BY COUNT(DISTINCT ws1.ws_order_number) LIMIT 100",
      "error": null
    }
  ]
}