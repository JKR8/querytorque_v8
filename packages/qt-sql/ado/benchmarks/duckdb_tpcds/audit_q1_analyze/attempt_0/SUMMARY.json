{
  "query_id": "query_1",
  "total_attempts": 3,
  "best_attempt": 1,
  "best_speedup": 1.85,
  "best_status": "WIN",
  "all_attempts": [
    {
      "attempt": 1,
      "status": "WIN",
      "speedup": 1.85,
      "error": "",
      "optimized_sql": "WITH sd_stores AS (\n  SELECT s_store_sk\n  FROM store\n  WHERE s_state = 'SD'\n),\nstore_customer_returns AS (\n  SELECT\n    sr_customer_sk AS ctr_customer_sk,\n    sr_store_sk AS ctr_store_sk,\n    SUM(SR_FEE) AS ctr_total_return,\n    AVG(SUM(SR_FEE)) OVER (PARTITION BY sr_store_sk) AS store_avg_return\n  FROM store_returns\n  JOIN date_dim ON sr_returned_date_sk = d_date_sk\n  JOIN sd_stores ON sr_store_sk = sd_stores.s_store_sk\n  WHERE d_year = 2000\n  GROUP BY sr_customer_sk, sr_store_sk\n)\nSELECT\n  c_customer_id\nFROM store_customer_returns ctr1\nJOIN customer ON ctr1.ctr_customer_sk = c_customer_sk\nWHERE ctr1.ctr_total_return > ctr1.store_avg_return * 1.2\nORDER BY c_customer_id\nLIMIT 100",
      "transforms": []
    },
    {
      "attempt": 2,
      "status": "WIN",
      "speedup": 1.58,
      "error": "",
      "optimized_sql": "WITH sd_stores AS (\n    SELECT s_store_sk\n    FROM store\n    WHERE s_state = 'SD'\n),\ncustomer_store_returns AS (\n    SELECT\n        sr_customer_sk AS ctr_customer_sk,\n        sr_store_sk AS ctr_store_sk,\n        SUM(SR_FEE) AS ctr_total_return\n    FROM store_returns\n    INNER JOIN date_dim ON sr_returned_date_sk = d_date_sk\n    INNER JOIN sd_stores ON sr_store_sk = sd_stores.s_store_sk\n    WHERE d_year = 2000\n    GROUP BY sr_customer_sk, sr_store_sk\n),\nstore_avg_returns AS (\n    SELECT\n        ctr_store_sk,\n        AVG(ctr_total_return) AS avg_total_return\n    FROM customer_store_returns\n    GROUP BY ctr_store_sk\n)\nSELECT\n    c_customer_id\nFROM customer_store_returns ctr1\nINNER JOIN store_avg_returns sar ON ctr1.ctr_store_sk = sar.ctr_store_sk\nINNER JOIN customer ON ctr1.ctr_customer_sk = c_customer_sk\nWHERE ctr1.ctr_total_return > sar.avg_total_return * 1.2\nORDER BY c_customer_id\nLIMIT 100",
      "transforms": []
    },
    {
      "attempt": 3,
      "status": "WIN",
      "speedup": 1.48,
      "error": "",
      "optimized_sql": "WITH filtered_stores AS (\n  SELECT s_store_sk\n  FROM store\n  WHERE s_state = 'SD'\n),\nfiltered_dates AS (\n  SELECT d_date_sk\n  FROM date_dim\n  WHERE d_year = 2000\n),\nstore_returns_filtered AS (\n  SELECT\n    sr.sr_customer_sk,\n    sr.sr_store_sk,\n    sr.sr_fee\n  FROM store_returns sr\n  INNER JOIN filtered_dates fd ON sr.sr_returned_date_sk = fd.d_date_sk\n  INNER JOIN filtered_stores fs ON sr.sr_store_sk = fs.s_store_sk\n),\ncustomer_store_totals AS (\n  SELECT\n    sr_customer_sk AS ctr_customer_sk,\n    sr_store_sk AS ctr_store_sk,\n    SUM(sr_fee) AS ctr_total_return,\n    AVG(SUM(sr_fee)) OVER (PARTITION BY sr_store_sk) AS store_avg_return\n  FROM store_returns_filtered\n  GROUP BY sr_customer_sk, sr_store_sk\n)\nSELECT\n  c.c_customer_id\nFROM customer_store_totals ctr\nINNER JOIN customer c ON ctr.ctr_customer_sk = c.c_customer_sk\nWHERE ctr.ctr_total_return > ctr.store_avg_return * 1.2\nORDER BY c.c_customer_id\nLIMIT 100",
      "transforms": []
    }
  ]
}