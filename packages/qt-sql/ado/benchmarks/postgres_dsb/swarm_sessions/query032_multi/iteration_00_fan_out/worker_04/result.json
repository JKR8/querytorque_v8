{
  "worker_id": 4,
  "strategy": "structural_decorrelate_union",
  "examples_used": [
    "inline_decorrelate_materialized",
    "pg_self_join_decomposition",
    "early_filter_decorrelate"
  ],
  "optimized_sql": "WITH filtered_items AS (\n    SELECT i_item_sk\n    FROM item\n    WHERE i_manufact_id IN (1, 78, 97, 516, 521)\n       OR i_manager_id BETWEEN 25 AND 54\n),\ndate_range AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_date BETWEEN '1999-03-07' AND CAST('1999-03-07' AS DATE) + INTERVAL '90 DAY'\n),\nfiltered_sales AS (\n    SELECT cs_item_sk, cs_ext_discount_amt\n    FROM catalog_sales\n    JOIN date_range ON cs_sold_date_sk = d_date_sk\n),\nitem_thresholds AS (\n    SELECT fs.cs_item_sk,\n           1.3 * AVG(cs_ext_discount_amt) AS threshold\n    FROM filtered_sales fs\n    JOIN catalog_sales cs ON fs.cs_item_sk = cs.cs_item_sk\n    JOIN date_range dr ON cs.cs_sold_date_sk = dr.d_date_sk\n    WHERE cs.cs_list_price BETWEEN 16 AND 45\n      AND cs.cs_sales_price / cs.cs_list_price BETWEEN 63 * 0.01 AND 83 * 0.01\n    GROUP BY fs.cs_item_sk\n)\nSELECT SUM(fs.cs_ext_discount_amt) AS \"excess discount amount\"\nFROM filtered_sales fs\nJOIN filtered_items fi ON fs.cs_item_sk = fi.i_item_sk\nJOIN item_thresholds it ON fs.cs_item_sk = it.cs_item_sk\nWHERE fs.cs_ext_discount_amt > it.threshold\nORDER BY SUM(fs.cs_ext_discount_amt)\nLIMIT 100",
  "speedup": 0.0,
  "status": "ERROR",
  "transforms": [
    "decorrelate",
    "date_cte_isolate",
    "dimension_cte_isolate"
  ],
  "hint": "Transform the OR condition into UNION ALL, decorrelate the subquery by precomputing averages per item, and use early filtering to reduce data volume.",
  "error_message": "Execution failed: column reference \"cs_ext_discount_amt\" is ambiguous\nLINE 19:            1.3 * AVG(cs_ext_discount_amt) AS threshold\n                              ^\n",
  "error_messages": [
    "Execution failed: column reference \"cs_ext_discount_amt\" is ambiguous\nLINE 19:            1.3 * AVG(cs_ext_discount_amt) AS threshold\n                              ^\n"
  ],
  "error_category": "execution"
}