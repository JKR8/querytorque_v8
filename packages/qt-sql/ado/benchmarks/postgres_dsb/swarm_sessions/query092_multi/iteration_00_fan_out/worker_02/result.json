{
  "worker_id": 2,
  "strategy": "moderate_cte_isolation",
  "examples_used": [
    "pg_dimension_prefetch_star",
    "CTE_OPTIMIZATION_FENCE_MATERIALIZED",
    "CORRELATED_WHERE_TO_DERIVED_TABLE"
  ],
  "optimized_sql": "WITH filtered_date AS (\n    SELECT d_date_sk\n    FROM date_dim\n    WHERE d_date BETWEEN '1998-03-13' AND CAST('1998-03-13' AS DATE) + INTERVAL '90 DAY'\n),\nfiltered_item AS (\n    SELECT i_item_sk\n    FROM item\n    WHERE i_manufact_id BETWEEN 341 AND 540 \n       OR i_category IN ('Home', 'Men', 'Music')\n),\nitem_avg_discount AS (\n    SELECT \n        ws_item_sk,\n        1.3 * AVG(ws_ext_discount_amt) AS threshold\n    FROM web_sales\n    INNER JOIN filtered_date ON d_date_sk = ws_sold_date_sk\n    WHERE ws_wholesale_cost BETWEEN 26 AND 46\n      AND ws_sales_price / ws_list_price BETWEEN 34 * 0.01 AND 49 * 0.01\n    GROUP BY ws_item_sk\n)\nSELECT\n  SUM(ws_ext_discount_amt) AS \"Excess Discount Amount\"\nFROM web_sales\nINNER JOIN filtered_item ON i_item_sk = ws_item_sk\nINNER JOIN filtered_date ON d_date_sk = ws_sold_date_sk\nLEFT JOIN item_avg_discount ON ws_item_sk = item_avg_discount.ws_item_sk\nWHERE ws_wholesale_cost BETWEEN 26 AND 46\n  AND ws_ext_discount_amt > COALESCE(item_avg_discount.threshold, -1)\nORDER BY\n  SUM(ws_ext_discount_amt)\nLIMIT 100",
  "speedup": 0.0,
  "status": "ERROR",
  "transforms": [
    "decorrelate",
    "date_cte_isolate",
    "dimension_cte_isolate"
  ],
  "hint": "Use CTEs to pre-filter dimension tables and control evaluation order, then rewrite the correlated subquery as a derived table join to reduce repeated computation.",
  "error_message": "Execution failed: column reference \"ws_item_sk\" is ambiguous\nLINE 27: LEFT JOIN item_avg_discount ON ws_item_sk = item_avg_discoun...\n                                        ^\n",
  "error_messages": [
    "Execution failed: column reference \"ws_item_sk\" is ambiguous\nLINE 27: LEFT JOIN item_avg_discount ON ws_item_sk = item_avg_discoun...\n                                        ^\n"
  ],
  "error_category": "execution"
}