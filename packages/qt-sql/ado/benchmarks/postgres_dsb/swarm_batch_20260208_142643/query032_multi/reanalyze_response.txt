FAILURE_ANALYSIS:
All previous attempts failed because they didn't address the fundamental performance bottleneck: the correlated subquery executes for every qualifying row in the outer query, causing O(nÂ²) complexity. While attempts like CTE materialization and explicit joins improved join efficiency, they didn't eliminate the correlation. The "early_filter_decorrelate" attempt only achieved 1.13x because it likely attempted basic decorrelation without handling the complex conditional logic (OR predicates in item filters, price ratio conditions in subquery). Window functions or lateral joins weren't applied to compute item-specific averages in a single pass.

UNEXPLORED_OPPORTUNITIES:
1. **Complete decorrelation via derived table**: Precompute item-specific average discounts with all subquery conditions in a single pass, then join back.
2. **Lateral join optimization**: Use LATERAL to compute item averages once per item while sharing date_dim filtering.
3. **Conditional aggregation**: Combine outer and subquery logic using CASE statements in aggregated CTEs.
4. **Partial materialization**: Create filtered materialized subsets of catalog_sales for both date ranges before joining.

REFINED_STRATEGY:
Create two pre-filtered CTEs: one for the main query's date-item joins, another for item-average calculations. Then join via item key with computed averages. Specifically:
1. Filter date_dim once for the 90-day range into a CTE.
2. Create an items CTE with the OR conditions pre-evaluated.
3. Create an item_avg CTE that computes 1.3*average(cs_ext_discount_amt) per item using the same date range and subquery conditions.
4. Join the main tables with the precomputed averages via item key, applying the discount filter directly.

EXAMPLES: pg_self_join_decomposition, pg_date_cte_explicit_join, pg_materialized_dimension_fact_prefilter
HINT: Use explicit JOIN syntax with CTEs, ensure date_dim filtering happens once, and avoid correlated execution by pre-aggregating item averages with all subquery conditions (list_price 16-45, price ratio 63%-83%). Test with EXPLAIN to verify the subquery is eliminated.