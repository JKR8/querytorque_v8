WITH filtered_customer_address AS (
    SELECT ca_address_sk
    FROM customer_address
    WHERE ca_county IN (
        'Hickman County',
        'Ohio County',
        'Parke County',
        'Pointe Coupee Parish',
        'Siskiyou County'
    )
),
filtered_customer_demographics AS (
    SELECT
        cd_demo_sk,
        cd_gender,
        cd_marital_status,
        cd_education_status,
        cd_purchase_estimate,
        cd_credit_rating,
        cd_dep_count,
        cd_dep_employed_count,
        cd_dep_college_count
    FROM customer_demographics
    WHERE cd_marital_status IN ('S', 'U', 'M')
      AND cd_education_status IN ('Secondary', 'Advanced Degree', '4 yr Degree')
      AND cd_gender = 'M'
),
filtered_date AS (
    SELECT d_date_sk
    FROM date_dim
    WHERE d_year = 1998
      AND d_moy BETWEEN 4 AND 7
),
filtered_item AS (
    SELECT i_item_sk
    FROM item
    WHERE i_category IN ('Children', 'Electronics', 'Men')
      AND i_manager_id BETWEEN 51 AND 60
)
SELECT
    cd.cd_gender,
    cd.cd_marital_status,
    cd.cd_education_status,
    COUNT(*) AS cnt1,
    cd.cd_purchase_estimate,
    COUNT(*) AS cnt2,
    cd.cd_credit_rating,
    COUNT(*) AS cnt3,
    cd.cd_dep_count,
    COUNT(*) AS cnt4,
    cd.cd_dep_employed_count,
    COUNT(*) AS cnt5,
    cd.cd_dep_college_count,
    COUNT(*) AS cnt6
FROM customer AS c
JOIN filtered_customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk
JOIN filtered_customer_demographics AS cd ON cd.cd_demo_sk = c.c_current_cdemo_sk
WHERE c.c_birth_month IN (3, 8)
  AND EXISTS(
      SELECT 1
      FROM store_sales
      JOIN filtered_date ON store_sales.ss_sold_date_sk = filtered_date.d_date_sk
      JOIN filtered_item ON store_sales.ss_item_sk = filtered_item.i_item_sk
      WHERE c.c_customer_sk = store_sales.ss_customer_sk
        AND store_sales.ss_sales_price / store_sales.ss_list_price BETWEEN 11 * 0.01 AND 21 * 0.01
  )
  AND (
      EXISTS(
          SELECT 1
          FROM web_sales
          JOIN filtered_date ON web_sales.ws_sold_date_sk = filtered_date.d_date_sk
          JOIN filtered_item ON web_sales.ws_item_sk = filtered_item.i_item_sk
          WHERE c.c_customer_sk = web_sales.ws_bill_customer_sk
            AND web_sales.ws_sales_price / web_sales.ws_list_price BETWEEN 11 * 0.01 AND 21 * 0.01
      )
      OR EXISTS(
          SELECT 1
          FROM catalog_sales
          JOIN filtered_date ON catalog_sales.cs_sold_date_sk = filtered_date.d_date_sk
          JOIN filtered_item ON catalog_sales.cs_item_sk = filtered_item.i_item_sk
          WHERE c.c_customer_sk = catalog_sales.cs_ship_customer_sk
            AND catalog_sales.cs_sales_price / catalog_sales.cs_list_price BETWEEN 11 * 0.01 AND 21 * 0.01
      )
  )
GROUP BY
    cd.cd_gender,
    cd.cd_marital_status,
    cd.cd_education_status,
    cd.cd_purchase_estimate,
    cd.cd_credit_rating,
    cd.cd_dep_count,
    cd.cd_dep_employed_count,
    cd.cd_dep_college_count
ORDER BY
    cd.cd_gender,
    cd.cd_marital_status,
    cd.cd_education_status,
    cd.cd_purchase_estimate,
    cd.cd_credit_rating,
    cd.cd_dep_count,
    cd.cd_dep_employed_count,
    cd.cd_dep_college_count
LIMIT 100;

Changes: Restructured using CTEs to pre-filter all dimension tables (customer_address, customer_demographics, date_dim, item) with their respective filters, then joined explicitly. Converted implicit joins to explicit JOIN syntax.

Expected speedup: 1.8-2.5x from better cardinality estimates and reduced join sizes.