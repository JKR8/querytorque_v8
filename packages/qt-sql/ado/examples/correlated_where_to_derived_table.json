{
  "id": "CORRELATED_WHERE_TO_DERIVED_TABLE",
  "name": "Correlated Where To Derived Table",
  "description": "Convert correlated subqueries in WHERE clause to derived table joins\n      when PostgreSQL fails to decorrelate automatically.",
  "category": "subquery_transformations",
  "priority": "medium",
  "verified_speedup": "unknown",
  "example": {
    "before_sql": "SELECT * FROM employees emp\n      WHERE salary > (\n          SELECT AVG(salary) FROM employees \n          WHERE department = emp.department\n      );",
    "after_sql": "SELECT emp.*\n      FROM employees emp\n      JOIN (\n          SELECT department, AVG(salary) AS avg_salary\n          FROM employees\n          GROUP BY department\n      ) dept_avg ON emp.department = dept_avg.department\n      WHERE emp.salary > dept_avg.avg_salary;",
    "alternative_sql": "",
    "key_insight": "Queries comparing row values against group aggregates. Common pattern\n      for \"above average\" type queries.",
    "transforms": [
      "correlated_where_to_derived_table"
    ]
  },
  "metadata": {
    "pg_version": "All",
    "auto_applied_by_pg": "false",
    "research_source": "",
    "notes": ""
  }
}