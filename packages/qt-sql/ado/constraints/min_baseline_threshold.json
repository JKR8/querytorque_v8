{
  "id": "MIN_BASELINE_THRESHOLD",
  "severity": "HIGH",
  "description": "Do not apply CTE-based transforms to queries with very short baseline runtimes. CTE materialization overhead dominates when the query is already fast.",
  "failure_rate": "Caused 0.14x-0.59x regressions on queries under 50ms",
  "observed_failures": [
    {
      "query": "Q25",
      "regression": "0.50x (31ms -> 62ms)",
      "baseline_ms": 31,
      "transform": "prefetch_fact_join with 6 CTEs",
      "type": "CTE_OVERHEAD_ON_FAST_QUERY"
    },
    {
      "query": "Q90",
      "regression": "0.59x (16ms -> 27ms)",
      "baseline_ms": 16,
      "transform": "multi_dimension_prefetch with 4 CTEs + UNION ALL",
      "type": "CTE_OVERHEAD_ON_FAST_QUERY"
    },
    {
      "query": "Q16",
      "regression": "0.14x (18ms -> 126ms)",
      "baseline_ms": 18,
      "transform": "materialize_cte with 2 full-scan CTEs",
      "type": "CTE_OVERHEAD_ON_FAST_QUERY"
    }
  ],
  "constraint_rules": [
    {
      "rule": "CHECK_BASELINE_RUNTIME",
      "description": "If the Execution Plan shows estimated or actual runtime under 50ms, prefer minimal rewrites. DuckDB already optimizes simple star-join patterns efficiently."
    }
  ],
  "prompt_instruction": "If the query execution plan shows very fast runtime (under 100ms), be conservative with CTE-based transforms. Each CTE adds materialization overhead (hash table creation, intermediate result storage). On fast queries, this overhead can exceed the filtering benefit. Prefer minimal changes or no change over adding multiple CTEs to an already-fast query."
}
