{
  "id": "KEEP_EXISTS_AS_EXISTS",
  "severity": "CRITICAL",
  "description": "Preserve EXISTS/NOT EXISTS subqueries as-is. Converting to IN/NOT IN or to JOINs risks NULL-handling semantic changes.",
  "observed_failures": [
    {
      "problem": "Converting NOT EXISTS to NOT IN changes behavior when the subquery column contains NULLs. NOT IN with NULLs returns no rows.",
      "type": "NULL_SEMANTIC_CHANGE"
    },
    {
      "problem": "Converting EXISTS to JOIN can produce duplicate rows when the subquery matches multiple rows per outer row.",
      "type": "DUPLICATE_ROW_INTRODUCTION"
    }
  ],
  "constraint_rules": [
    {
      "rule": "NO_EXISTS_TO_IN",
      "description": "Do not convert EXISTS/NOT EXISTS to IN/NOT IN. NULL semantics differ."
    },
    {
      "rule": "NO_EXISTS_TO_JOIN",
      "description": "Do not convert EXISTS/NOT EXISTS to JOINs without careful analysis. Duplicates may be introduced."
    }
  ],
  "prompt_instruction": "Preserve EXISTS/NOT EXISTS subqueries as-is. Do NOT convert them to IN/NOT IN or to JOINs â€” this risks NULL-handling semantic changes and can introduce duplicate rows."
}
