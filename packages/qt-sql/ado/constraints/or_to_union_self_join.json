{
  "id": "OR_TO_UNION_SELF_JOIN",
  "severity": "CRITICAL",
  "description": "Never apply or_to_union on queries with self-joins. Splitting OR conditions on self-joined tables creates multiple independent scans that cannot share the self-join optimization, causing severe regressions.",
  "observed_failures": [
    {
      "query": "Q23",
      "regression": "0.51x",
      "problem": "Self-join on store_sales was split into separate UNION branches, each requiring its own full self-join, doubling execution time.",
      "type": "SELF_JOIN_SPLIT"
    }
  ],
  "constraint_rules": [
    {
      "rule": "NO_OR_TO_UNION_ON_SELF_JOINS",
      "description": "If a query contains a self-join (same table aliased twice), do not apply or_to_union. The self-join must remain in a single query block to share the scan."
    }
  ],
  "prompt_instruction": "Never apply or_to_union when the query contains a self-join (the same table appears twice with different aliases). Splitting self-join queries into UNION branches forces each branch to independently perform the self-join, doubling or tripling execution time. Observed 0.51x regression on Q23."
}
