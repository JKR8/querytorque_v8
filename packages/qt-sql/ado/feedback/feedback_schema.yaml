# ADO Rewrite Feedback Schema
# Used to provide structured feedback to improve future rewrites

schema_version: "1.0"

fields:
  query_id:
    type: string
    required: true
    description: "DSB query identifier (e.g., query072_agg)"

  rewrite_id:
    type: string
    required: true
    description: "Unique identifier for this rewrite attempt"

  transform_used:
    type: string
    required: true
    description: "Transform type claimed by the model"

  validation:
    type: object
    required: true
    fields:
      syntax_valid: {type: boolean}
      semantic_valid: {type: boolean}
      rows_match: {type: boolean}

  performance:
    type: object
    required: true
    fields:
      original_ms: {type: number}
      optimized_ms: {type: number}
      speedup: {type: number}
      claimed_speedup: {type: string}
      speedup_accurate: {type: boolean}

  diagnosis:
    type: object
    required: true
    fields:
      bottleneck_identified:
        type: boolean
        description: "Did the model correctly identify the query bottleneck?"

      actual_bottleneck:
        type: string
        description: "What is the actual performance bottleneck?"

      why_ineffective:
        type: string
        description: "Why didn't the rewrite achieve expected speedup?"

  recommendations:
    type: list
    required: true
    description: "Specific actionable recommendations for improvement"
    items:
      type: object
      fields:
        category:
          type: string
          enum: [technique, estimation, bottleneck, syntax]
        recommendation: {type: string}
        example: {type: string, required: false}

  suggested_transforms:
    type: list
    description: "Rule IDs from ado/examples/ to try instead"
    items:
      type: string
      note: "Must match a rule ID in ado/examples/*.json (lowercase with underscores)"

  learning_priority:
    type: string
    enum: [critical, high, medium, low]
    description: "How important is this feedback for model improvement"
