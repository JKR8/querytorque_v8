SELECT t7.D_WEEK_SEQ1, ROUND(t7.SUN_SALES1 / t16.SUN_SALES2, 2) AS R1, ROUND(t7.MON_SALES1 / t16.MON_SALES2, 2) AS R2, ROUND(t7.TUE_SALES1 / t16.TUE_SALES2, 2) AS R3, ROUND(t7.WED_SALES1 / t16.WED_SALES2, 2) AS R4, ROUND(t7.THU_SALES1 / t16.THU_SALES2, 2) AS R5, ROUND(t7.FRI_SALES1 / t16.FRI_SALES2, 2) AS R6, ROUND(t7.SAT_SALES1 / t16.SAT_SALES2, 2)
FROM (SELECT t5.D_WEEK_SEQ AS D_WEEK_SEQ1, t5.SUN_SALES AS SUN_SALES1, t5.MON_SALES AS MON_SALES1, t5.TUE_SALES AS TUE_SALES1, t5.WED_SALES AS WED_SALES1, t5.THU_SALES AS THU_SALES1, t5.FRI_SALES AS FRI_SALES1, t5.SAT_SALES AS SAT_SALES1
FROM (SELECT date_dim.d_week_seq AS D_WEEK_SEQ, SUM(t2.SALES_PRICE) FILTER (WHERE date_dim.d_day_name = 'Sunday' IS TRUE) AS SUN_SALES, SUM(t2.SALES_PRICE) FILTER (WHERE date_dim.d_day_name = 'Monday' IS TRUE) AS MON_SALES, SUM(t2.SALES_PRICE) FILTER (WHERE date_dim.d_day_name = 'Tuesday' IS TRUE) AS TUE_SALES, SUM(t2.SALES_PRICE) FILTER (WHERE date_dim.d_day_name = 'Wednesday' IS TRUE) AS WED_SALES, SUM(t2.SALES_PRICE) FILTER (WHERE date_dim.d_day_name = 'Thursday' IS TRUE) AS THU_SALES, SUM(t2.SALES_PRICE) FILTER (WHERE date_dim.d_day_name = 'Friday' IS TRUE) AS FRI_SALES, SUM(t2.SALES_PRICE) FILTER (WHERE date_dim.d_day_name = 'Saturday' IS TRUE) AS SAT_SALES
FROM (SELECT *
FROM (SELECT ws_sold_date_sk AS SOLD_DATE_SK, ws_ext_sales_price AS SALES_PRICE
FROM web_sales
UNION ALL
SELECT cs_sold_date_sk AS SOLD_DATE_SK, cs_ext_sales_price AS SALES_PRICE
FROM catalog_sales) AS t1) AS t2
INNER JOIN date_dim ON t2.SOLD_DATE_SK = date_dim.d_date_sk
GROUP BY date_dim.d_week_seq) AS t5
INNER JOIN (SELECT *
FROM date_dim
WHERE d_year = 2001) AS t6 ON t5.D_WEEK_SEQ = t6.d_week_seq) AS t7
INNER JOIN (SELECT t14.D_WEEK_SEQ AS D_WEEK_SEQ2, t14.SUN_SALES AS SUN_SALES2, t14.MON_SALES AS MON_SALES2, t14.TUE_SALES AS TUE_SALES2, t14.WED_SALES AS WED_SALES2, t14.THU_SALES AS THU_SALES2, t14.FRI_SALES AS FRI_SALES2, t14.SAT_SALES AS SAT_SALES2
FROM (SELECT date_dim1.d_week_seq AS D_WEEK_SEQ, SUM(t11.SALES_PRICE) FILTER (WHERE date_dim1.d_day_name = 'Sunday' IS TRUE) AS SUN_SALES, SUM(t11.SALES_PRICE) FILTER (WHERE date_dim1.d_day_name = 'Monday' IS TRUE) AS MON_SALES, SUM(t11.SALES_PRICE) FILTER (WHERE date_dim1.d_day_name = 'Tuesday' IS TRUE) AS TUE_SALES, SUM(t11.SALES_PRICE) FILTER (WHERE date_dim1.d_day_name = 'Wednesday' IS TRUE) AS WED_SALES, SUM(t11.SALES_PRICE) FILTER (WHERE date_dim1.d_day_name = 'Thursday' IS TRUE) AS THU_SALES, SUM(t11.SALES_PRICE) FILTER (WHERE date_dim1.d_day_name = 'Friday' IS TRUE) AS FRI_SALES, SUM(t11.SALES_PRICE) FILTER (WHERE date_dim1.d_day_name = 'Saturday' IS TRUE) AS SAT_SALES
FROM (SELECT *
FROM (SELECT ws_sold_date_sk AS SOLD_DATE_SK, ws_ext_sales_price AS SALES_PRICE
FROM web_sales
UNION ALL
SELECT cs_sold_date_sk AS SOLD_DATE_SK, cs_ext_sales_price AS SALES_PRICE
FROM catalog_sales) AS t10) AS t11
INNER JOIN date_dim AS date_dim1 ON t11.SOLD_DATE_SK = date_dim1.d_date_sk
GROUP BY date_dim1.d_week_seq) AS t14
INNER JOIN (SELECT *
FROM date_dim
WHERE d_year = CAST(2001 + 1 AS BIGINT)) AS t15 ON t14.D_WEEK_SEQ = t15.d_week_seq) AS t16 ON t7.D_WEEK_SEQ1 = t16.D_WEEK_SEQ2 - 53
ORDER BY t7.D_WEEK_SEQ1 NULLS FIRST