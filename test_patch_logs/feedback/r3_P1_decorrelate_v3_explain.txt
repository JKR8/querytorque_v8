                                                                                                  QUERY PLAN                                                                                                   
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=102249.68..102250.95 rows=100 width=17) (actual time=809.428..811.288 rows=100 loops=1)
   Buffers: shared hit=803120 read=111784, temp read=1559 written=2251
   CTE customer_total_return
     ->  Finalize GroupAggregate  (cost=62623.82..62649.31 rows=197 width=44) (actual time=413.090..460.799 rows=95599 loops=1)
           Group Key: store_returns.sr_customer_sk, store_returns.sr_store_sk, store_returns.sr_reason_sk
           Buffers: shared hit=802977 read=97980, temp read=243 written=244
           ->  Gather Merge  (cost=62623.82..62644.80 rows=164 width=44) (actual time=413.079..430.611 rows=95661 loops=1)
                 Workers Planned: 2
                 Workers Launched: 2
                 Buffers: shared hit=802977 read=97980, temp read=243 written=244
                 ->  Partial GroupAggregate  (cost=61623.80..61625.85 rows=82 width=44) (actual time=234.453..246.459 rows=31887 loops=3)
                       Group Key: store_returns.sr_customer_sk, store_returns.sr_store_sk, store_returns.sr_reason_sk
                       Buffers: shared hit=802977 read=97980, temp read=243 written=244
                       ->  Sort  (cost=61623.80..61624.00 rows=82 width=18) (actual time=234.443..236.502 rows=31974 loops=3)
                             Sort Key: store_returns.sr_customer_sk, store_returns.sr_store_sk, store_returns.sr_reason_sk
                             Sort Method: quicksort  Memory: 1510kB
                             Buffers: shared hit=802977 read=97980, temp read=243 written=244
                             Worker 0:  Sort Method: quicksort  Memory: 1405kB
                             Worker 1:  Sort Method: external merge  Disk: 1944kB
                             ->  Nested Loop  (cost=0.72..61621.19 rows=82 width=18) (actual time=0.355..226.406 rows=31974 loops=3)
                                   Buffers: shared hit=802963 read=97980
                                   ->  Parallel Index Only Scan using _dta_index_date_dim_6_661577395__k1_k7_k9 on date_dim  (cost=0.29..1677.88 rows=172 width=4) (actual time=0.281..0.486 rows=122 loops=3)
                                         Index Cond: (d_year = 2002)
                                         Heap Fetches: 0
                                         Buffers: shared hit=4 read=280
                                   ->  Index Scan using _dta_index_store_returns_6_1013578649__k1_3_4_10 on store_returns  (cost=0.43..348.35 rows=16 width=22) (actual time=0.011..1.839 rows=263 loops=365)
                                         Index Cond: (sr_returned_date_sk = date_dim.d_date_sk)
                                         Filter: (((sr_return_amt / (sr_return_quantity)::numeric) >= '108'::numeric) AND ((sr_return_amt / (sr_return_quantity)::numeric) <= '167'::numeric))
                                         Rows Removed by Filter: 2612
                                         Buffers: shared hit=802959 read=97700
   ->  Nested Loop  (cost=39600.37..81795694540472.52 rows=6465412800000000 width=17) (actual time=809.427..810.154 rows=100 loops=1)
         Buffers: shared hit=121696 read=28862, temp read=1316 written=2007
         ->  Nested Loop  (cost=39600.37..978034540466.23 rows=63386400000000 width=17) (actual time=809.409..810.108 rows=1 loops=1)
               Buffers: shared hit=121696 read=28857, temp read=1316 written=2007
               ->  Gather Merge  (cost=39588.55..97821.79 rows=500000 width=17) (actual time=324.676..325.371 rows=1 loops=1)
                     Workers Planned: 2
                     Workers Launched: 2
                     Buffers: shared hit=143 read=13798, temp read=1315 written=1668
                     ->  Sort  (cost=38588.52..39109.36 rows=208333 width=17) (actual time=319.170..319.257 rows=910 loops=3)
                           Sort Key: customer.c_customer_id
                           Sort Method: external merge  Disk: 4960kB
                           Buffers: shared hit=143 read=13798, temp read=1315 written=1668
                           Worker 0:  Sort Method: external merge  Disk: 4152kB
                           Worker 1:  Sort Method: external merge  Disk: 4152kB
                           ->  Parallel Seq Scan on customer  (cost=0.00..15910.33 rows=208333 width=17) (actual time=0.157..236.378 rows=166667 loops=3)
                                 Buffers: shared hit=30 read=13797
               ->  Materialize  (cost=11.82..2630981.44 rows=126772800 width=0) (actual time=484.731..484.734 rows=1 loops=1)
                     Buffers: shared hit=121553 read=15059, temp read=1 written=339
                     ->  Nested Loop  (cost=11.82..1625712.44 rows=126772800 width=0) (actual time=484.729..484.732 rows=1 loops=1)
                           Buffers: shared hit=121553 read=15059, temp read=1 written=339
                           ->  Seq Scan on customer_demographics  (cost=0.00..41036.00 rows=1920800 width=0) (actual time=0.323..0.323 rows=1 loops=1)
                                 Buffers: shared read=1
                           ->  Materialize  (cost=11.82..16.61 rows=66 width=0) (actual time=484.405..484.407 rows=1 loops=1)
                                 Buffers: shared hit=121553 read=15058, temp read=1 written=339
                                 ->  Hash Join  (cost=11.82..16.28 rows=66 width=0) (actual time=484.404..484.406 rows=1 loops=1)
                                       Hash Cond: (ctr1.ctr_store_sk = customer_total_return.ctr_store_sk)
                                       Join Filter: (ctr1.ctr_total_return > ((avg(customer_total_return.ctr_total_return)) * 1.2))
                                       Rows Removed by Join Filter: 1
                                       Buffers: shared hit=121553 read=15058, temp read=1 written=339
                                       ->  CTE Scan on customer_total_return ctr1  (cost=0.00..3.94 rows=197 width=36) (actual time=413.092..413.099 rows=2 loops=1)
                                             Buffers: shared hit=121553 read=15058, temp read=1 written=1
                                       ->  Hash  (cost=9.36..9.36 rows=197 width=36) (actual time=71.293..71.294 rows=51 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 11kB
                                             Buffers: temp written=338
                                             ->  HashAggregate  (cost=4.92..7.39 rows=197 width=36) (actual time=71.276..71.286 rows=52 loops=1)
                                                   Group Key: customer_total_return.ctr_store_sk
                                                   Batches: 1  Memory Usage: 64kB
                                                   Buffers: temp written=338
                                                   ->  CTE Scan on customer_total_return  (cost=0.00..3.94 rows=197 width=36) (actual time=0.000..61.249 rows=95599 loops=1)
                                                         Buffers: temp written=338
         ->  Materialize  (cost=0.00..6.53 rows=102 width=0) (actual time=0.016..0.040 rows=100 loops=1)
               Buffers: shared read=5
               ->  Seq Scan on store  (cost=0.00..6.02 rows=102 width=0) (actual time=0.015..0.030 rows=100 loops=1)
                     Buffers: shared read=5
 Planning:
   Buffers: shared hit=532 read=72
 Planning Time: 1.027 ms
 Execution Time: 812.181 ms
(78 rows)

