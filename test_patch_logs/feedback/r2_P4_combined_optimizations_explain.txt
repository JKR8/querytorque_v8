                                                                                                  QUERY PLAN                                                                                                   
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=496253.61..496253.61 rows=1 width=17) (actual time=6680.434..6680.496 rows=0 loops=1)
   Buffers: shared hit=802448 read=98637, temp read=627211 written=583
   CTE customer_total_return
     ->  Finalize GroupAggregate  (cost=63287.37..63853.12 rows=4369 width=44) (actual time=379.560..426.068 rows=95599 loops=1)
           Group Key: store_returns.sr_customer_sk, store_returns.sr_store_sk, store_returns.sr_reason_sk
           Buffers: shared hit=802391 read=98566, temp read=243 written=244
           ->  Gather Merge  (cost=63287.37..63753.01 rows=3640 width=44) (actual time=379.551..396.322 rows=95661 loops=1)
                 Workers Planned: 2
                 Workers Launched: 2
                 Buffers: shared hit=802391 read=98566, temp read=243 written=244
                 ->  Partial GroupAggregate  (cost=62287.34..62332.84 rows=1820 width=44) (actual time=223.494..235.187 rows=31887 loops=3)
                       Group Key: store_returns.sr_customer_sk, store_returns.sr_store_sk, store_returns.sr_reason_sk
                       Buffers: shared hit=802391 read=98566, temp read=243 written=244
                       ->  Sort  (cost=62287.34..62291.89 rows=1820 width=18) (actual time=223.484..225.612 rows=31974 loops=3)
                             Sort Key: store_returns.sr_customer_sk, store_returns.sr_store_sk, store_returns.sr_reason_sk
                             Sort Method: quicksort  Memory: 1510kB
                             Buffers: shared hit=802391 read=98566, temp read=243 written=244
                             Worker 0:  Sort Method: external merge  Disk: 1944kB
                             Worker 1:  Sort Method: quicksort  Memory: 1405kB
                             ->  Nested Loop  (cost=0.72..62188.79 rows=1820 width=18) (actual time=0.288..216.118 rows=31974 loops=3)
                                   Buffers: shared hit=802377 read=98566
                                   ->  Parallel Index Only Scan using _dta_index_date_dim_6_661577395__k1_k7_k9 on date_dim  (cost=0.29..1677.88 rows=172 width=4) (actual time=0.232..0.446 rows=122 loops=3)
                                         Index Cond: (d_year = 2002)
                                         Heap Fetches: 0
                                         Buffers: shared hit=4 read=280
                                   ->  Index Scan using _dta_index_store_returns_6_1013578649__k1_3_4_10 on store_returns  (cost=0.43..348.35 rows=346 width=22) (actual time=0.010..1.754 rows=263 loops=365)
                                         Index Cond: (sr_returned_date_sk = date_dim.d_date_sk)
                                         Filter: ((sr_return_amt >= ((108 * sr_return_quantity))::numeric) AND (sr_return_amt <= ((167 * sr_return_quantity))::numeric))
                                         Rows Removed by Filter: 2612
                                         Buffers: shared hit=802373 read=98286
   ->  Sort  (cost=432400.48..432400.49 rows=1 width=17) (actual time=6680.432..6680.434 rows=0 loops=1)
         Sort Key: customer.c_customer_id
         Sort Method: quicksort  Memory: 25kB
         Buffers: shared hit=121744 read=14995, temp read=626968 written=339
         ->  Nested Loop  (cost=0.85..432400.47 rows=1 width=17) (actual time=6680.422..6680.423 rows=0 loops=1)
               Buffers: shared hit=121741 read=14995, temp read=626968 written=339
               ->  Nested Loop  (cost=0.42..432393.91 rows=1 width=21) (actual time=6680.421..6680.423 rows=0 loops=1)
                     Buffers: shared hit=121741 read=14995, temp read=626968 written=339
                     ->  Nested Loop  (cost=0.00..432385.45 rows=1 width=4) (actual time=749.954..6679.389 rows=30 loops=1)
                           Join Filter: (ctr1.ctr_store_sk = store.s_store_sk)
                           Rows Removed by Join Filter: 5089
                           Buffers: shared hit=121687 read=14929, temp read=626968 written=339
                           ->  CTE Scan on customer_total_return ctr1  (cost=0.00..432378.08 rows=7 width=8) (actual time=439.393..6677.600 rows=582 loops=1)
                                 Filter: ((ctr_reason_sk >= 43) AND (ctr_reason_sk <= 46) AND (ctr_total_return > (SubPlan 2)))
                                 Rows Removed by Filter: 95017
                                 Buffers: shared hit=121687 read=14924, temp read=626968 written=339
                                 SubPlan 2
                                   ->  Subquery Scan on sa  (cost=0.00..98.94 rows=21 width=32) (actual time=3.409..3.409 rows=1 loops=1845)
                                         Buffers: temp read=625116 written=338
                                         ->  GroupAggregate  (cost=0.00..98.73 rows=21 width=36) (actual time=3.408..3.408 rows=1 loops=1845)
                                               Group Key: customer_total_return.ctr_store_sk
                                               Buffers: temp read=625116 written=338
                                               ->  CTE Scan on customer_total_return  (cost=0.00..98.30 rows=22 width=36) (actual time=0.016..3.235 rows=2450 loops=1845)
                                                     Filter: (ctr_store_sk = ctr1.ctr_store_sk)
                                                     Rows Removed by Filter: 93149
                                                     Buffers: temp read=625116 written=338
                           ->  Materialize  (cost=0.00..6.45 rows=9 width=4) (actual time=0.001..0.002 rows=9 loops=582)
                                 Buffers: shared read=5
                                 ->  Seq Scan on store  (cost=0.00..6.40 rows=9 width=4) (actual time=0.017..0.039 rows=9 loops=1)
                                       Filter: (s_state = ANY ('{IL,KY,TX}'::bpchar[]))
                                       Rows Removed by Filter: 93
                                       Buffers: shared read=5
                     ->  Index Scan using _dta_index_customer_6_949578421__k1_k5 on customer  (cost=0.42..8.45 rows=1 width=25) (actual time=0.031..0.031 rows=0 loops=30)
                           Index Cond: (c_customer_sk = ctr1.ctr_customer_sk)
                           Filter: ((c_birth_year >= 1965) AND (c_birth_year <= 1971) AND (c_birth_month = 2))
                           Rows Removed by Filter: 1
                           Buffers: shared hit=54 read=66
               ->  Index Scan using customer_demographics_pkey on customer_demographics  (cost=0.43..6.57 rows=1 width=4) (never executed)
                     Index Cond: (cd_demo_sk = customer.c_current_cdemo_sk)
                     Filter: ((cd_marital_status = 'M'::bpchar) AND (cd_gender = 'F'::bpchar) AND ((cd_education_status = 'Advanced Degree'::bpchar) OR (cd_education_status = 'College'::bpchar)))
 Planning:
   Buffers: shared hit=499 read=82
 Planning Time: 1.096 ms
 Execution Time: 6681.250 ms
(74 rows)

