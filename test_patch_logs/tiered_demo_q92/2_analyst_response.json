[
  {
    "target_id": "t1",
    "family": "B",
    "transform": "inline_decorrelate",
    "relevance_score": 0.95,
    "hypothesis": "Correlated scalar subquery re-scans web_sales+date_dim per outer row via probe(). Decorrelate: pre-compute per-item threshold via GROUP BY in CTE, then JOIN back. Converts O(N*items) probe to O(N+M) hash join.",
    "target_ir": "S0 [SELECT]\n  CTE: item_thresholds  (via CTE_Q_S0_item_thresholds)\n    FROM: web_sales, date_dim\n    WHERE: d_date BETWEEN '2002-02-26' AND ... AND d_date_sk = ws_sold_date_sk\n    GROUP BY: ws_item_sk\n    SELECT: ws_item_sk, 1.3 * AVG(ws_ext_discount_amt) AS threshold\n  MAIN QUERY (via Q_S0)\n    FROM: web_sales ws, item i, date_dim d, item_thresholds t\n    WHERE: i.i_manufact_id = 320 AND i.i_item_sk = ws.ws_item_sk\n      AND d.d_date BETWEEN ... AND d.d_date_sk = ws.ws_sold_date_sk\n      AND ws.ws_ext_discount_amt > t.threshold\n      AND t.ws_item_sk = ws.ws_item_sk\n    ORDER BY: SUM(ws_ext_discount_amt)\n    LIMIT: 100",
    "recommended_examples": [
      "sf_inline_decorrelate"
    ]
  },
  {
    "target_id": "t2",
    "family": "A",
    "transform": "date_filter_pushdown",
    "relevance_score": 0.72,
    "hypothesis": "Date filter d_date BETWEEN '2002-02-26' AND +90 days scans all 7214 partitions. Extract into filtered CTE to enable partition pruning before the costly join.",
    "target_ir": "S0 [SELECT]\n  CTE: date_range  (via CTE_Q_S0_date_range)\n    FROM: date_dim\n    WHERE: d_date BETWEEN '2002-02-26' AND CAST('2002-02-26' AS DATE) + INTERVAL '90 DAY'\n    SELECT: d_date_sk\n  MAIN QUERY (via Q_S0)\n    FROM: web_sales ws, item i, date_range dr\n    WHERE: i.i_manufact_id = 320 AND i.i_item_sk = ws.ws_item_sk\n      AND dr.d_date_sk = ws.ws_sold_date_sk\n      AND ws.ws_ext_discount_amt > (subquery)\n    ORDER BY: SUM(ws_ext_discount_amt)\n    LIMIT: 100",
    "recommended_examples": [
      "sf_inline_decorrelate"
    ]
  },
  {
    "target_id": "t3",
    "family": "F",
    "transform": "explicit_join_reorder",
    "relevance_score": 0.6,
    "hypothesis": "Three-table comma join (web_sales, item, date_dim) leaves join order to optimizer. Explicit INNER JOIN with item filter first reduces probe input to web_sales.",
    "target_ir": "S0 [SELECT]\n  MAIN QUERY (via Q_S0)\n    FROM: item i\n      INNER JOIN web_sales ws ON i.i_item_sk = ws.ws_item_sk\n      INNER JOIN date_dim d ON d.d_date_sk = ws.ws_sold_date_sk\n    WHERE: i.i_manufact_id = 320\n      AND d.d_date BETWEEN '2002-02-26' AND ...\n      AND ws.ws_ext_discount_amt > (subquery)\n    ORDER BY: SUM(ws_ext_discount_amt)\n    LIMIT: 100",
    "recommended_examples": [
      "inner_join_conversion"
    ]
  },
  {
    "target_id": "t4",
    "family": "E",
    "transform": "shared_scan_materialize",
    "relevance_score": 0.55,
    "hypothesis": "web_sales scanned twice (outer + subquery) with overlapping date filter. Materialize the web_sales+date_dim join once, reuse for both outer and threshold.",
    "target_ir": "S0 [SELECT]\n  CTE: ws_dated  (via CTE_Q_S0_ws_dated)\n    FROM: web_sales ws INNER JOIN date_dim d ON d.d_date_sk = ws.ws_sold_date_sk\n    WHERE: d.d_date BETWEEN '2002-02-26' AND ...\n    SELECT: ws.ws_item_sk, ws.ws_ext_discount_amt\n  CTE: item_thresholds  (via CTE_Q_S0_item_thresholds)\n    FROM: ws_dated\n    GROUP BY: ws_item_sk\n    SELECT: ws_item_sk, 1.3 * AVG(ws_ext_discount_amt) AS threshold\n  MAIN QUERY (via Q_S0)\n    FROM: ws_dated wd, item i, item_thresholds t\n    WHERE: i.i_manufact_id = 320 AND i.i_item_sk = wd.ws_item_sk\n      AND wd.ws_ext_discount_amt > t.threshold AND t.ws_item_sk = wd.ws_item_sk\n    ORDER BY: SUM(ws_ext_discount_amt)\n    LIMIT: 100",
    "recommended_examples": [
      "sf_shared_scan_decorrelate"
    ]
  }
]