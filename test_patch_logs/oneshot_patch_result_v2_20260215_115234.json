{
  "query_id": "query_1",
  "mode": "oneshot_patch",
  "status": "WIN",
  "best_speedup": 2.379576700306033,
  "n_iterations": 1,
  "n_api_calls": 1,
  "best_transforms": [
    "decorrelate_store_avg"
  ],
  "best_sql": "/* start query 1 in stream 0 using template query1.tpl */ WITH customer_total_return AS (SELECT sr_customer_sk AS ctr_customer_sk, sr_store_sk AS ctr_store_sk, SUM(SR_FEE) AS ctr_total_return FROM store_returns, date_dim WHERE sr_returned_date_sk = d_date_sk AND d_year = 2000 GROUP BY sr_customer_sk, sr_store_sk), store_avg AS (SELECT ctr_store_sk, AVG(ctr_total_return) * 1.2 AS avg_threshold FROM customer_total_return GROUP BY ctr_store_sk) SELECT c_customer_id FROM customer_total_return AS ctr1, store, customer, store_avg WHERE ctr1.ctr_total_return > store_avg.avg_threshold AND ctr1.ctr_store_sk = store_avg.ctr_store_sk AND s_store_sk = ctr1.ctr_store_sk AND s_state = 'SD' AND ctr1.ctr_customer_sk = c_customer_sk ORDER BY c_customer_id LIMIT 100;\n\n/* end query 1 in stream 0 using template query1.tpl */;",
  "original_sql": "-- start query 1 in stream 0 using template query1.tpl\nwith customer_total_return as\n(select sr_customer_sk as ctr_customer_sk\n,sr_store_sk as ctr_store_sk\n,sum(SR_FEE) as ctr_total_return\nfrom store_returns\n,date_dim\nwhere sr_returned_date_sk = d_date_sk\nand d_year =2000\ngroup by sr_customer_sk\n,sr_store_sk)\n select c_customer_id\nfrom customer_total_return ctr1\n,store\n,customer\nwhere ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2\nfrom customer_total_return ctr2\nwhere ctr1.ctr_store_sk = ctr2.ctr_store_sk)\nand s_store_sk = ctr1.ctr_store_sk\nand s_state = 'SD'\nand ctr1.ctr_customer_sk = c_customer_sk\norder by c_customer_id\n LIMIT 100;\n\n-- end query 1 in stream 0 using template query1.tpl\n",
  "iterations": [
    {
      "iteration": 0,
      "n_api_calls": 1,
      "best_speedup": 2.38,
      "best_patch_id": "t1_family_b",
      "patches": [
        {
          "patch_id": "t1_family_b",
          "family": "B",
          "transform": "decorrelate_store_avg",
          "relevance_score": 0.95,
          "status": "WIN",
          "speedup": 2.38,
          "semantic_passed": true,
          "error": null,
          "original_ms": 211.9,
          "patch_ms": 89.0
        },
        {
          "patch_id": "t2_family_a",
          "family": "A",
          "transform": "early_store_filter",
          "relevance_score": 0.85,
          "status": "REGRESSION",
          "speedup": 0.91,
          "semantic_passed": true,
          "error": null,
          "original_ms": 150.3,
          "patch_ms": 164.5
        },
        {
          "patch_id": "t3_family_e",
          "family": "E",
          "transform": "cte_materialization",
          "relevance_score": 0.75,
          "status": "ERROR",
          "speedup": 0.0,
          "semantic_passed": true,
          "error": "001003 (42000): 01c26b1c-3205-654c-0000-0002fcfef085: SQL compilation error:\nsyntax error line 1 at position 30 unexpected 'MATERIALIZED'.\nsyntax error line 1 at position 270 unexpected 'SELECT'.",
          "original_ms": null,
          "patch_ms": null
        },
        {
          "patch_id": "t4_family_c",
          "family": "C",
          "transform": "agg_pushdown",
          "relevance_score": 0.65,
          "status": "WIN",
          "speedup": 1.33,
          "semantic_passed": true,
          "error": null,
          "original_ms": 333.9,
          "patch_ms": 251.3
        }
      ]
    }
  ],
  "elapsed_seconds": 641.9055647850037
}